From m_zouhairy at skno.by  Wed Aug  1 06:18:51 2018
From: m_zouhairy at skno.by (Vacheslav)
Date: Wed, 1 Aug 2018 09:18:51 +0300
Subject: [squid-users] microsoft list
In-Reply-To: <1fc09ac8-c53d-3c08-fb61-86f55f8af8d9@treenet.co.nz>
References: <470501d428a3$d6a70f80$83f52e80$@skno.by>
 <0a3c04d2-8d48-a074-fa5c-1a7480d8158a@netpilot.com>
 <582201d428c2$2557bb20$70073160$@skno.by>
 <1fc09ac8-c53d-3c08-fb61-86f55f8af8d9@treenet.co.nz>
Message-ID: <0bc901d4295f$84582c70$8d088550$@skno.by>


-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Amos Jeffries
Sent: Tuesday, July 31, 2018 7:34 PM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] microsoft list

On 31/07/18 23:32, Vacheslav wrote:
> Satanic greetings, you really think you are the smartest of us all that we can't think of your stupid suggestion?
> 

>Please be civil. The response you received was a reasonable answer to your question.

You won't find any more civil love than that.

>Both the TechNet article linked and the Squid FAQ config example for Windows Update contains lists of domains that service uses.

>Blocking the rest of Microsoft and all of Akamai *by URL* is a much more difficult proposition. Between them they host a very large percentage of Internet domains.

Your last sentence is totally false. I found an open source handy piece of software which lets you choose how much you would like to block, even skype if desired, too bad there isn't a donate button on github or am I missing it?
So I just copied the domains inserted in the hosts file and plugged it in ufdbguard and the people who use this squid have considerably less traffic than others.

>Amos
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users




From mzgmedia at gmail.com  Wed Aug  1 14:19:35 2018
From: mzgmedia at gmail.com (mzgmedia)
Date: Wed, 1 Aug 2018 09:19:35 -0500 (CDT)
Subject: [squid-users] socks on squid, still working?
In-Reply-To: <e57a1e85-ff11-2c23-350d-0a335ec50a25@treenet.co.nz>
References: <1532898741964-0.post@n4.nabble.com>
 <e57a1e85-ff11-2c23-350d-0a335ec50a25@treenet.co.nz>
Message-ID: <1533133175630-0.post@n4.nabble.com>

the export of variable doesn't seems to work for me

export CFLAGS=" -Dbind=SOCKSbind "
export CXXFLAGS=" -Dbind=SOCKSbind "
export LDADD=" -lsocks "

so I'm trying to do  via

./configure --build=x86_64-redhat-linux-gnu --host=x86_64-redhat-linux-gnu
--target=x86_64-redhat-linux-gnu \
..
..
..
--enable-follow-x-forwarded-for=no \
'build_alias=x86_64-redhat-linux-gnu' 'host_alias=x86_64-redhat-linux-gnu'
'target_alias=x86_64-redhat-linux-gnu' \
'CFLAGS=-Dbind=SOCKSbind -ltcmalloc_minimal -Os -ffunction-sections
-fdata-sections  -Wl,--gc-sections -Wl,--build-id=none -pipe -fexceptions
-march=native ' \
'CXXFLAGS=-Dbind=SOCKSbind -ltcmalloc_minimal -Os -ffunction-sections
-fdata-sections -Wl,--gc-sections -Wl,--build-id=none  -pipe  -fexceptions
-march=native' \
'LDADD=-lsocks '

so I don't think that lsocks is taken?

I'm using centos6



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From squid3 at treenet.co.nz  Wed Aug  1 14:44:15 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 2 Aug 2018 02:44:15 +1200
Subject: [squid-users] socks on squid, still working?
In-Reply-To: <1533133175630-0.post@n4.nabble.com>
References: <1532898741964-0.post@n4.nabble.com>
 <e57a1e85-ff11-2c23-350d-0a335ec50a25@treenet.co.nz>
 <1533133175630-0.post@n4.nabble.com>
Message-ID: <910bdd1c-05a3-daf7-3661-48406c5eeedc@treenet.co.nz>

On 02/08/18 02:19, mzgmedia wrote:
> the export of variable doesn't seems to work for me
> 
> export CFLAGS=" -Dbind=SOCKSbind "
> export CXXFLAGS=" -Dbind=SOCKSbind "
> export LDADD=" -lsocks "
> 

As I said earlier, you need to check the library symbol names match the
ones you are telling the compiler to use instead of bind().

The error you had earlier was that the SOCKSbind name could not be found
in any library. Squid code does not use that function name anywhere, so
that error could only happen if the export *was* working - but the
library not being found.


> so I'm trying to do  via
> 
> ./configure --build=x86_64-redhat-linux-gnu --host=x86_64-redhat-linux-gnu
> --target=x86_64-redhat-linux-gnu \
> ..
> ..
> ..
> --enable-follow-x-forwarded-for=no \
> 'build_alias=x86_64-redhat-linux-gnu' 'host_alias=x86_64-redhat-linux-gnu'
> 'target_alias=x86_64-redhat-linux-gnu' \
> 'CFLAGS=-Dbind=SOCKSbind -ltcmalloc_minimal -Os -ffunction-sections
> -fdata-sections  -Wl,--gc-sections -Wl,--build-id=none -pipe -fexceptions
> -march=native ' \
> 'CXXFLAGS=-Dbind=SOCKSbind -ltcmalloc_minimal -Os -ffunction-sections
> -fdata-sections -Wl,--gc-sections -Wl,--build-id=none  -pipe  -fexceptions
> -march=native' \

AFAIK you should not combine cross-compilation (--build/--host/--target)
with -march=native (compile optimizations for local machines CPU
specific abilities).


> 'LDADD=-lsocks '
> 
> so I don't think that lsocks is taken?
> 

Do you have libsocks development version installed in the OS default
location?

Amos


From heiler.bemerguy at cinbesa.com.br  Wed Aug  1 14:52:53 2018
From: heiler.bemerguy at cinbesa.com.br (Heiler Bemerguy)
Date: Wed, 1 Aug 2018 11:52:53 -0300
Subject: [squid-users] *.dl.delivery.mp.microsoft.com/filestreamingservice
Message-ID: <df33a78f-9b14-a2f0-3797-c1b7bd2d09a8@cinbesa.com.br>

An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180801/f52c189c/attachment.htm>

From chip_pop at hotmail.com  Wed Aug  1 17:32:21 2018
From: chip_pop at hotmail.com (joseph)
Date: Wed, 1 Aug 2018 12:32:21 -0500 (CDT)
Subject: [squid-users]
	*.dl.delivery.mp.microsoft.com/filestreamingservice
In-Reply-To: <df33a78f-9b14-a2f0-3797-c1b7bd2d09a8@cinbesa.com.br>
References: <df33a78f-9b14-a2f0-3797-c1b7bd2d09a8@cinbesa.com.br>
Message-ID: <1533144741227-0.post@n4.nabble.com>

yes but its expensive since squid dose not have partial caching
acl force_full_download url_regex \.esd \.exe \.psf \.cab \.ipa \.zip \.pkg
\.msp
range_offset_limit -1  force_full_download
quick_abort_min -1 force_full_download
quick_abort_max 0 KB 
quick_abort_pct 100 



-----
************************** 
***** Crash to the future  ****
**************************
--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From mzgmedia at gmail.com  Wed Aug  1 19:19:29 2018
From: mzgmedia at gmail.com (mzgmedia)
Date: Wed, 1 Aug 2018 14:19:29 -0500 (CDT)
Subject: [squid-users] socks on squid, still working?
In-Reply-To: <1532898741964-0.post@n4.nabble.com>
References: <1532898741964-0.post@n4.nabble.com>
Message-ID: <1533151169658-0.post@n4.nabble.com>

thank you for the answers, I really appreciated

"Do you have libsocks development version installed in the OS default 
location? "
is possible to tell me the name of the package or the path, I've installed
via yum all the packages which had "sock" on the name/description but still
doesn't work



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From chip_pop at hotmail.com  Wed Aug  1 21:34:28 2018
From: chip_pop at hotmail.com (joseph)
Date: Wed, 1 Aug 2018 16:34:28 -0500 (CDT)
Subject: [squid-users] compiler Error
Message-ID: <1533159268604-0.post@n4.nabble.com>

hi after i upgrade my debian i got gcc 8  and warnings being treated as
errors

cache_cf.cc: In function ???void parse_time_t(time_t*)???:
cache_cf.cc:2981:36: error: ???tval??? may be used uninitialized in this
function [-Werror=maybe-uninitialized]
     *var = static_cast<time_t>(tval/1000);
                                ~~~~^~~~~



-----
************************** 
***** Crash to the future  ****
**************************
--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From Antony.Stone at squid.open.source.it  Wed Aug  1 21:41:39 2018
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Wed, 1 Aug 2018 23:41:39 +0200
Subject: [squid-users] compiler Error
In-Reply-To: <1533159268604-0.post@n4.nabble.com>
References: <1533159268604-0.post@n4.nabble.com>
Message-ID: <201808012341.39239.Antony.Stone@squid.open.source.it>

On Wednesday 01 August 2018 at 23:34:28, joseph wrote:

> hi after i upgrade my debian i got gcc 8

So, maybe this is a Debian or a GCC problem, rather than a Squid problem?

> and warnings being treated as errors

Have you tried compiling anything other than Squid to see whether the problem 
is with Squid or with the GCC defaults?

> cache_cf.cc: In function ???void parse_time_t(time_t*)???:
> cache_cf.cc:2981:36: error: ???tval??? may be used uninitialized in this
> function [-Werror=maybe-uninitialized]
>      *var = static_cast<time_t>(tval/1000);
>                                 ~~~~^~~~~

That does seem rather paranoid to me - "may be used uninitialized..." as an 
error!?

Anyway, tell us exactly how you were building Squid when this happened, and we 
may have some more ideas about what to do about it.


Antony.

-- 
This sentence contains exacly three erors.

                                                   Please reply to the list;
                                                         please *don't* CC me.


From rousskov at measurement-factory.com  Wed Aug  1 21:48:21 2018
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Wed, 1 Aug 2018 15:48:21 -0600
Subject: [squid-users] compiler Error
In-Reply-To: <1533159268604-0.post@n4.nabble.com>
References: <1533159268604-0.post@n4.nabble.com>
Message-ID: <6456c653-4f9f-a607-24c2-87ec5bbd6474@measurement-factory.com>

On 08/01/2018 03:34 PM, joseph wrote:
> hi after i upgrade my debian i got gcc 8  and warnings being treated as
> errors
> 
> cache_cf.cc: In function ???void parse_time_t(time_t*)???:
> cache_cf.cc:2981:36: error: ???tval??? may be used uninitialized in this
> function [-Werror=maybe-uninitialized]
>      *var = static_cast<time_t>(tval/1000);
>                                 ~~~~^~~~~


GCC is confused, but the affected code should be rewritten to avoid that
confusion (e.g., parseTimeLine() should probably return the parsed value
and throw on errors). Quality patches welcome.

Meanwhile, consider ./configuring with --disable-strict-error-checking

Alex.


From chip_pop at hotmail.com  Wed Aug  1 21:49:24 2018
From: chip_pop at hotmail.com (joseph)
Date: Wed, 1 Aug 2018 16:49:24 -0500 (CDT)
Subject: [squid-users] compiler Error
In-Reply-To: <201808012341.39239.Antony.Stone@squid.open.source.it>
References: <1533159268604-0.post@n4.nabble.com>
 <201808012341.39239.Antony.Stone@squid.open.source.it>
Message-ID: <1533160164100-0.post@n4.nabble.com>

ya gcc 8 is paranoid strict every one know that i disable
-Wno-maybe-uninitialized
got more and more and now gcc8 is standard in debian  so yadij  know all
about he start converting code hoop he will continue spetial the bad one
pconn.cc: In member function ???void PconnPool::push(const
ConnectionPointer&, const char*)???:
pconn.cc:435:32: error: ???%s??? directive output may be truncated writing
up to 777 bytes into a region of size 51 [-Werror=format-truncation=]
     snprintf(desc, FD_DESC_SZ, "Idle server: %s", aKey);
                                ^~~~~~~~~~~~~~~~~
pconn.cc:435:13: note: ???snprintf??? output between 14 and 791 bytes into a
destination of size 64
     snprintf(desc, FD_DESC_SZ, "Idle server: %s", aKey);
     ~~~~~~~~^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~



-----
************************** 
***** Crash to the future  ****
**************************
--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From helen.rai at nepallink.net  Thu Aug  2 07:05:48 2018
From: helen.rai at nepallink.net (Helen Rai)
Date: Thu, 2 Aug 2018 12:50:48 +0545
Subject: [squid-users] Squid proxy server to log HTTPS traffic
In-Reply-To: <bc9a13a7-9463-57d6-bba9-982a37096176@treenet.co.nz>
References: <CAKWnCHTgDCupzAbhFPQBwZ6KkWvuFuaQKi5Vos=kJugb16Q0Zg@mail.gmail.com>
 <bc9a13a7-9463-57d6-bba9-982a37096176@treenet.co.nz>
Message-ID: <CAKWnCHRWhk96_UbZ-BXyhaDe1xKcdQQ3o_tfu1QXSbHHg5Jvww@mail.gmail.com>

Hi,

The MikroTik router I am using has 24 ports.
There is 4 department and for each department 4 ports of Mikrotik is given.
That is
Department A has 4 computers and each of them is connected with ethernet
cable from port 4,5,6 and 7 of Mikrotik Router.
Department B, C, and D have the same number of the computer as Department A
and they are connected to 8,9,10,11 and 12,13,14,15 and 16,17,18,19 port of
Mikrotik respectively with the ethernet cable.
Each department is in different network (different private IP range).
Each department is later combined into each bridge interface.
Port 20 of Mikrotik is connected to Unifi-AP, which is broadcasting WiFi
signals. Mobile devices and Laptop which are not connected via ethernet
cable uses WiFi signals.
One of the port from Department A is connected to Raspberry Pi where squid
is configured.
Now what I want to do is log all the web traffic that is requested from
those devices which are using WiFi.
I have attached the configuration of squid and Mikrotik which I had done
for HTTP. (Please note that when I had done this for HTTP, the squid wasn't
configured with --enable-SSL or --enable-crtd)

I had referred some online sites to do for HTTPS but none of them worked.
Please help if anyone knows how to log all HTTPS request.

I have attached document regarding the rules applied in Mikrotik and squid3
configuration for HTTP.



----
Helen Rai
Platform operations, Nepallink
44260822 || 9841262275 || support at nepallink.net <abuse at nepallink.net>
http://www.nepallink.net || Link Road, Khusibu
<http://www.facebook.com/pages/NepalLink-Network/334213043398796>
<http://twitter.com/nepallink>

On Mon, Jul 30, 2018 at 7:34 PM, Amos Jeffries <squid3 at treenet.co.nz> wrote:

> On 30/07/18 22:58, Helen Rai wrote:
> > Hi,
> >
> > I am using  Mikrotik Routerboard Model CRS125-24G-1S-2HnD which Links
> > the internal network with WAN. One of the port is connected with WiFi
> > Router which is broadcasting WiFi signal. Some of the devices work on
> > WiFi network. I have installed squid3 (Version 3.5.27) in Raspberry Pi
> > which is also connected with Mikrotik. Squid is installed with
> --enable-SSL.
> >
>
> The --enable-ssl option was removed in Squid-3.5.
> <http://www.squid-cache.org/Versions/v3/3.5/squid-3.5.28-
> RELEASENOTES.html#ss4.3>.
> Use --with-openssl instead, and ensure the Debian libssl1.0-dev package
> is installed when building.
>
> To see any URLs inside the HTTPS you will need --enable-ssl-crtd.
>
>
> > Now, what I want to do is Redirect or log all the HTTP and HTTPS
> > requests are done from devices which are in WiFi network to squid proxy
> > server.
> >
> > I have tried doing it for months now, I am able to log all HTTP traffic
> > but am unable to do it for HTTPS.
> >
> > Please help me with this and if you need any detail from me, please
> > contact me.
> >
>
> If using the correct build option(s) does not resolve your problem we
> will need to know what the Mikrotik routign settings, Rasberry Pi
> routing and NAT settings, and squid.conf *_port lines are to provide any
> assistance.
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180802/a460595c/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Mikrotik_rules
Type: application/octet-stream
Size: 320 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180802/a460595c/attachment.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: squid_conf
Type: application/octet-stream
Size: 1104 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180802/a460595c/attachment-0001.obj>

From squid3 at treenet.co.nz  Thu Aug  2 09:45:39 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 2 Aug 2018 21:45:39 +1200
Subject: [squid-users] socks on squid, still working?
In-Reply-To: <1533151169658-0.post@n4.nabble.com>
References: <1532898741964-0.post@n4.nabble.com>
 <1533151169658-0.post@n4.nabble.com>
Message-ID: <ca689bfc-fe57-99a9-f893-f6ca9cb4c5b4@treenet.co.nz>

On 02/08/18 07:19, mzgmedia wrote:
> thank you for the answers, I really appreciated
> 
> "Do you have libsocks development version installed in the OS default 
> location? "
> is possible to tell me the name of the package or the path, I've installed
> via yum all the packages which had "sock" on the name/description but still
> doesn't work

Unfortunately I don't know what SOCKS library is called on your OS. It
is usually libsocks-dev or libsocks-devel. Though it may omit the "lib"
part of the name, and may include numerics.

Someone more familiar with your OS may be able to assist better. AFAIK
that should be the only detail you need to get sorted properly.

Amos


From squid3 at treenet.co.nz  Thu Aug  2 10:44:13 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 2 Aug 2018 22:44:13 +1200
Subject: [squid-users] Squid proxy server to log HTTPS traffic
In-Reply-To: <CAKWnCHRWhk96_UbZ-BXyhaDe1xKcdQQ3o_tfu1QXSbHHg5Jvww@mail.gmail.com>
References: <CAKWnCHTgDCupzAbhFPQBwZ6KkWvuFuaQKi5Vos=kJugb16Q0Zg@mail.gmail.com>
 <bc9a13a7-9463-57d6-bba9-982a37096176@treenet.co.nz>
 <CAKWnCHRWhk96_UbZ-BXyhaDe1xKcdQQ3o_tfu1QXSbHHg5Jvww@mail.gmail.com>
Message-ID: <f368e817-5c27-b03a-696e-a31a73b4a378@treenet.co.nz>

On 02/08/18 19:05, Helen Rai wrote:
> Now what I want to do is log all the web traffic that is requested from
> those devices which are using WiFi.
> I have attached the configuration of squid and Mikrotik which I had done
> for HTTP. (Please note that when I had done this for HTTP, the squid
> wasn't configured with --enable-SSL or --enable-crtd)
> 

Yes, those options are required to handle the TLS which is part of
HTTPS. HTTP is not encrypted. Or rather: --with-openssl is required

Since you are rebuilding it with these extra options I recommend using
the Squid-4 code from the Debian Sid repository if you can. It contains
much better handling for HTTPS traffic which will be useful later to
avoid non-HTTPS traffic arriving on port 443.


> I had referred some online sites to do for HTTPS but none of them
> worked. Please help if anyone knows how to log all HTTPS request.
> 
> I have attached document regarding the rules applied in Mikrotik and
> squid3 configuration for HTTP.
> 

Okay. So first thing to do is fix some mistakes in your squid.conf

* "transparent" has long ago been replaced by "intercept"

 http_port 3127 intercept

* remove incomplete / broken config line

 #http_access deny

* remove the first two of these repeated lines:

 http_access allow localhost
 ...
 http_access allow localhost
 http_access allow localhost
 ...

* stop using "localhost" as the ACL name to represent Department-A.
Localhost is a reserved term in networking with a very specific meaning
(different to what you are using it for) which is also baked into Squid
default configuration settings.

Instead use an ACL which names the thing being matched. For example:

 acl Department-A src 10.0.7.0/24


* move your custom setting down below the default security http_access
rules. Those are the deny lines referring to SSL_ports and Safe_ports.

Your http_access lines should now look nice and simple, like this:


 http_access deny !Safe_ports
 http_access deny CONNECT !SSL_ports

 acl test dstdomain "/etc/squid3/acl/test"
 http_access deny test

 acl Department-A src 10.0.7.0/24
 http_access allow Department-A

 http_access deny all


*** Your HTTP traffic should still be fully operational and doing what
you want after these changes. If not something is broken we need to fix
before continuing.


Second, add the pieces necessary for handling port 443 traffic to
squid.conf.

You *will* need to generate a self-signed CA certificate with the
signing-cert (CA) and and HTTP server properties to use SSL-Bump features.
  But that will only need to be installed on clients machine *if* you go
as far as decrypting the HTTPS traffic or producing errors for clients.
This is where Squid-4 handles TLS far more cleanly than Squid-3.5.


 # A port to receive port 443 traffic from Mikrotik
 https_port 3129 intercept ssl-bump cert=/etc/squid3/your-CA.pem

 ... note the 's' in that directive name. A typo there breaks HTTPS in
confusing ways.


 # SSL-Bump rules to peek at details for logging, then relay the traffic
 acl step1 at_step SslBump1
 ssl_bump peek step1
 ssl_bump splice all

 # Squid-4 can pass any non-HTTPS through or omit the below line to
deliver error pages signed by the your-CA.pem certificate.

  on_unsupported_protocol tunnel


Thirdly, you need to add an entry to the Raspberry Pi NAT rules. Same as
for the port 80 NAT rule that should also exist, but for port 443.

 ** at this point you should be able to test the Raspberry PI is working
for HTTPS by setting a test machine to have the R-Pi IP address as its
gateway and requesting any https:// URL in a Browser, or wget, curl,
squidclient etc.


Lastly, when Squid is happily running with all that add to your Mikrotik
config a second line identical to the first one in your attachment -
except that it ends with "dst-port=443".

 As soon as that line is active in your router the HTTPS traffic should
start arriving and being logged at the Squid.



Please be aware of the following details:

* Do expect to see at least half of HTTPS traffic being CONNECT with
raw-IPs and 0 bytes transferred. That is from the first step of
SSL-Bump'ing. They should be followed by another CONNECT with the TLS
SNI domain name and correct size of data transferred (one-way, to client).


* The SNI is only accurate for honest clients. It can be forged and the
real HTTPS messages be using another domain name hosted on the same
server/CDN network.
 However, to be properly sure that the traffic inside the TLS is going
to the domain the SNI claimed you will have to fully decrypt the traffic
(bump action) and that means installing your CA cert on all clients
machines. Plus configuring dynamic cert generation on the https_port line.
 Start with getting the above non-decrypt setup working before going
near bumping.


Amos


From squid3 at treenet.co.nz  Thu Aug  2 10:54:42 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 2 Aug 2018 22:54:42 +1200
Subject: [squid-users] compiler Error
In-Reply-To: <1533160164100-0.post@n4.nabble.com>
References: <1533159268604-0.post@n4.nabble.com>
 <201808012341.39239.Antony.Stone@squid.open.source.it>
 <1533160164100-0.post@n4.nabble.com>
Message-ID: <c58c3587-0ecc-f344-c3cc-af34aa36274f@treenet.co.nz>

On 02/08/18 09:49, joseph wrote:
> ya gcc 8 is paranoid strict every one know that i disable
> -Wno-maybe-uninitialized
> got more and more and now gcc8 is standard in debian  so yadij  know all
> about he start converting code hoop he will continue spetial the bad one
> pconn.cc: In member function ???void PconnPool::push(const
> ConnectionPointer&, const char*)???:
> pconn.cc:435:32: error: ???%s??? directive output may be truncated writing
> up to 777 bytes into a region of size 51 [-Werror=format-truncation=]
>      snprintf(desc, FD_DESC_SZ, "Idle server: %s", aKey);
>                                 ^~~~~~~~~~~~~~~~~
> pconn.cc:435:13: note: ???snprintf??? output between 14 and 791 bytes into a
> destination of size 64
>      snprintf(desc, FD_DESC_SZ, "Idle server: %s", aKey);
>      ~~~~~~~~^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
> 


The Debian Sid repository has 4.1 code with an early version of the
GCC-8 patch in it. That should build fine with the sanitizers Debian
auto-enable plus a few others we auto-enable upstream.

If you are building from Squid Project repository or tarballs, please
use the latest snapshot of the v4 branch (not v4.0 which is obsolete).
The final GCC-8 fixes did not quite make it in time for 4.1 release, but
are already included for 4.2 which should be available in a few days.

Note that there are still some sanitizers that we cannot enable because
either they have bad false positives, or the code is not yet fixed. If
you enable such checks YMMV. Bug reports and patches/ github PR are
welcome but please use the proper process for submission. Not just
informing the world that you don't know how to compile Squid :-P.

Amos


From chip_pop at hotmail.com  Thu Aug  2 12:06:02 2018
From: chip_pop at hotmail.com (joseph)
Date: Thu, 2 Aug 2018 07:06:02 -0500 (CDT)
Subject: [squid-users] compiler Error
In-Reply-To: <c58c3587-0ecc-f344-c3cc-af34aa36274f@treenet.co.nz>
References: <1533159268604-0.post@n4.nabble.com>
 <201808012341.39239.Antony.Stone@squid.open.source.it>
 <1533160164100-0.post@n4.nabble.com>
 <c58c3587-0ecc-f344-c3cc-af34aa36274f@treenet.co.nz>
Message-ID: <1533211562251-0.post@n4.nabble.com>

thank you for the long detail i use the latest source and squid 5
i never use repo squid 
and i do know how to compile just if you dont want me to report issu then
fine
tks



-----
************************** 
***** Crash to the future  ****
**************************
--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From squid3 at treenet.co.nz  Thu Aug  2 12:34:37 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 3 Aug 2018 00:34:37 +1200
Subject: [squid-users] compiler Error
In-Reply-To: <1533211562251-0.post@n4.nabble.com>
References: <1533159268604-0.post@n4.nabble.com>
 <201808012341.39239.Antony.Stone@squid.open.source.it>
 <1533160164100-0.post@n4.nabble.com>
 <c58c3587-0ecc-f344-c3cc-af34aa36274f@treenet.co.nz>
 <1533211562251-0.post@n4.nabble.com>
Message-ID: <bc64c23b-276a-3206-e0a0-94d9369c6a6c@treenet.co.nz>

On 03/08/18 00:06, joseph wrote:
> thank you for the long detail i use the latest source and squid 5
> i never use repo squid 
> and i do know how to compile just if you dont want me to report issu then
> fine
> tks
> 

The thing is I want the issue reported where the rest of the dev team
can also see it. Not just thrown in here where dozens or hundreds emails
will flood it out of my inbox before I get a chance to try to replicate
it next week.

Amos


From belle at bazuin.nl  Thu Aug  2 13:46:08 2018
From: belle at bazuin.nl (=?windows-1252?Q?L.P.H._van_Belle?=)
Date: Thu, 2 Aug 2018 15:46:08 +0200
Subject: [squid-users] assertion failed
Message-ID: <vmime.5b630b20.155a.743a8de030386d20@ms249-lin-003.rotterdam.bazuin.nl>

Hai, 
?
Im testing squid 4.1 on Debian Stretch, i've rebuilded the Debian Sid 4.1 to Stretch. 
Everything looks good, i only see one failed line in cache.log ( see below. ) 
this is the default configuration, only 1 change made. 
in debian we have : /etc/squid/conf.d/debian.conf 
# Squid configuration settings for Debian
#
?
# Logs are managed by logrotate on Debian
logfile_rotate 0
?
# For extra security Debian packages only allow
# localhost to use the proxy on new installs
#
http_access allow localnet??????????????? << i enable only the localnet. 

?
If i google for "assertion failed: comm.cc:428: "!isOpen(conn->fd)"?
i get only 3 hits, is someone knows what this is, because i cant figure this out. 
?
?
The is the content.
2018/08/02 06:25:01| Set Current Directory to /var/spool/squid
2018/08/02 06:25:01 kid1| storeDirWriteCleanLogs: Starting...
2018/08/02 06:25:01 kid1|?? Finished.? Wrote 0 entries.
2018/08/02 06:25:01 kid1|?? Took 0.00 seconds (? 0.00 entries/sec).
2018/08/02 06:25:01 kid1| logfileRotate: daemon:/var/log/squid/access.log
2018/08/02 06:25:01 kid1| logfileRotate: daemon:/var/log/squid/access.log
2018/08/02 06:25:01 kid1| assertion failed: comm.cc:428: "!isOpen(conn->fd)"??????????????? <<< This one ? 
2018/08/02 06:25:01 kid1| Set Current Directory to /var/spool/squid
2018/08/02 06:25:01 kid1| Starting Squid Cache version 4.1 for x86_64-pc-linux-gnu...
2018/08/02 06:25:01 kid1| Service Name: squid
2018/08/02 06:25:01 kid1| Process ID 26222
2018/08/02 06:25:01 kid1| Process Roles: worker
2018/08/02 06:25:01 kid1| With 1024 file descriptors available
2018/08/02 06:25:01 kid1| Initializing IP Cache...
2018/08/02 06:25:01 kid1| DNS Socket created at [::], FD 5
2018/08/02 06:25:01 kid1| DNS Socket created at 0.0.0.0, FD 9
2018/08/02 06:25:01 kid1| Adding domain internal.domain.tld from /etc/resolv.conf
2018/08/02 06:25:01 kid1| Adding nameserver 127.0.0.1 from /etc/resolv.conf
2018/08/02 06:25:01 kid1| Adding nameserver 192.168.0.1 from /etc/resolv.conf
2018/08/02 06:25:01 kid1| Adding nameserver 192.168.0.2 from /etc/resolv.conf
2018/08/02 06:25:01 kid1| Logfile: opening log daemon:/var/log/squid/access.log
2018/08/02 06:25:01 kid1| Logfile Daemon: opening log /var/log/squid/access.log
2018/08/02 06:25:01 kid1| Local cache digest enabled; rebuild/rewrite every 3600/3600 sec
2018/08/02 06:25:01 kid1| Store logging disabled
2018/08/02 06:25:01 kid1| Swap maxSize 0 + 262144 KB, estimated 20164 objects
2018/08/02 06:25:01 kid1| Target number of buckets: 1008
2018/08/02 06:25:01 kid1| Using 8192 Store buckets
2018/08/02 06:25:01 kid1| Max Mem? size: 262144 KB
2018/08/02 06:25:01 kid1| Max Swap size: 0 KB
2018/08/02 06:25:01 kid1| Using Least Load store dir selection
2018/08/02 06:25:01 kid1| Set Current Directory to /var/spool/squid
2018/08/02 06:25:01 kid1| Finished loading MIME types and icons.
2018/08/02 06:25:01 kid1| HTCP Disabled.
2018/08/02 06:25:01 kid1| Pinger socket opened on FD 14
2018/08/02 06:25:01 kid1| Squid plugin modules loaded: 0
2018/08/02 06:25:01 kid1| Adaptation support is off.
2018/08/02 06:25:01 kid1| Accepting HTTP Socket connections at local=[::]:3128 remote=[::] FD 12 flags=9
2018/08/02 06:25:01| pinger: Initialising ICMP pinger ...
2018/08/02 06:25:01| pinger: ICMP socket opened.
2018/08/02 06:25:01| pinger: ICMPv6 socket opened
2018/08/02 06:25:02 kid1| storeLateRelease: released 0 objects
2018/08/02 07:10:26 kid1| Logfile: opening log stdio:/var/spool/squid/netdb.state
2018/08/02 07:10:26 kid1| netdbSaveState stdio:/var/spool/squid/netdb.state: (0) No error.

?
?
Best regards, 
?
Louis
?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180802/b7dfa66c/attachment.htm>

From rousskov at measurement-factory.com  Thu Aug  2 15:43:25 2018
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Thu, 2 Aug 2018 09:43:25 -0600
Subject: [squid-users] assertion failed
In-Reply-To: <vmime.5b630b20.155a.743a8de030386d20@ms249-lin-003.rotterdam.bazuin.nl>
References: <vmime.5b630b20.155a.743a8de030386d20@ms249-lin-003.rotterdam.bazuin.nl>
Message-ID: <5ebcef2b-4f9b-b06e-0854-7b696a11dc54@measurement-factory.com>

On 08/02/2018 07:46 AM, L.P.H. van Belle wrote:
 ?
> If i google for "assertion failed: comm.cc:428: "!isOpen(conn->fd)"?
> i get only 3 hits, is someone knows what this is, because i cant figure
> this out.

When facing an assertion, one should check Squid bugzilla:
https://bugs.squid-cache.org/show_bug.cgi?id=4796

Alex.
?
> 2018/08/02 06:25:01 kid1| storeDirWriteCleanLogs: Starting...
> 2018/08/02 06:25:01 kid1| logfileRotate: daemon:/var/log/squid/access.log
> 2018/08/02 06:25:01 kid1| logfileRotate: daemon:/var/log/squid/access.log
> 2018/08/02 06:25:01 kid1| assertion failed: comm.cc:428: "!isOpen(conn->fd)"




From heiler.bemerguy at cinbesa.com.br  Thu Aug  2 15:50:26 2018
From: heiler.bemerguy at cinbesa.com.br (Heiler Bemerguy)
Date: Thu, 2 Aug 2018 12:50:26 -0300
Subject: [squid-users]
	*.dl.delivery.mp.microsoft.com/filestreamingservice
In-Reply-To: <1533144741227-0.post@n4.nabble.com>
References: <df33a78f-9b14-a2f0-3797-c1b7bd2d09a8@cinbesa.com.br>
 <1533144741227-0.post@n4.nabble.com>
Message-ID: <ce03583b-e879-b1c8-8237-2b08d64153d6@cinbesa.com.br>

Em 01/08/2018 14:32, joseph escreveu:
> yes but its expensive since squid dose not have partial caching
> acl force_full_download url_regex \.esd \.exe \.psf \.cab \.ipa \.zip \.pkg
> \.msp
> range_offset_limit -1  force_full_download
> quick_abort_min -1 force_full_download
> quick_abort_max 0 KB
> quick_abort_pct 100
>
>
Last time I tried to force full downloads, it only used more bandwidth 
and the files were NOT saved. I have an old bug report still open about 
that.

It seems Rock Store won't EVER save an object if two users are 
downloading it simultaneously...

Thanks anyway,
Heiler


From squid3 at treenet.co.nz  Thu Aug  2 16:05:18 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 3 Aug 2018 04:05:18 +1200
Subject: [squid-users]
	*.dl.delivery.mp.microsoft.com/filestreamingservice
In-Reply-To: <ce03583b-e879-b1c8-8237-2b08d64153d6@cinbesa.com.br>
References: <df33a78f-9b14-a2f0-3797-c1b7bd2d09a8@cinbesa.com.br>
 <1533144741227-0.post@n4.nabble.com>
 <ce03583b-e879-b1c8-8237-2b08d64153d6@cinbesa.com.br>
Message-ID: <7e71ada1-4a74-fc5f-91ce-2274dafefe61@treenet.co.nz>

On 03/08/18 03:50, Heiler Bemerguy wrote:
> Em 01/08/2018 14:32, joseph escreveu:
>> yes but its expensive since squid dose not have partial caching
>> acl force_full_download url_regex \.esd \.exe \.psf \.cab \.ipa \.zip
>> \.pkg
>> \.msp

urlpath_regex would be better, and maybe adding the (\?.*)?$ to ensure
the extension is a filename and not query parameter (unless you see a
lot of filenames in the query part). The above catches many domain names
and forces full download on all objects they contain.


>> range_offset_limit -1? force_full_download
>> quick_abort_min -1 force_full_download
>> quick_abort_max 0 KB
>> quick_abort_pct 100
>>
>>
> Last time I tried to force full downloads, it only used more bandwidth
> and the files were NOT saved. I have an old bug report still open about
> that.
> 
> It seems Rock Store won't EVER save an object if two users are
> downloading it simultaneously...

Things on that front have changed in the latest few releases. It may be
time to re-test with Squid-4 and update the bug reports on it.

Amos


From helen.rai at nepallink.net  Fri Aug  3 04:38:33 2018
From: helen.rai at nepallink.net (Helen Rai)
Date: Fri, 3 Aug 2018 10:23:33 +0545
Subject: [squid-users] Squid proxy server to log HTTPS traffic
In-Reply-To: <f368e817-5c27-b03a-696e-a31a73b4a378@treenet.co.nz>
References: <CAKWnCHTgDCupzAbhFPQBwZ6KkWvuFuaQKi5Vos=kJugb16Q0Zg@mail.gmail.com>
 <bc9a13a7-9463-57d6-bba9-982a37096176@treenet.co.nz>
 <CAKWnCHRWhk96_UbZ-BXyhaDe1xKcdQQ3o_tfu1QXSbHHg5Jvww@mail.gmail.com>
 <f368e817-5c27-b03a-696e-a31a73b4a378@treenet.co.nz>
Message-ID: <CAKWnCHSyikFZZ9K0K0c4Cmd80RHQcNzD3k8epWKv-kjQpAQKZA@mail.gmail.com>

HI,

Thanks, will try and update.

----
Helen Rai
Platform operations, Nepallink
44260822 || 9841262275 || support at nepallink.net <abuse at nepallink.net>
http://www.nepallink.net || Link Road, Khusibu
<http://www.facebook.com/pages/NepalLink-Network/334213043398796>
<http://twitter.com/nepallink>

On Thu, Aug 2, 2018 at 4:29 PM, Amos Jeffries <squid3 at treenet.co.nz> wrote:

> On 02/08/18 19:05, Helen Rai wrote:
> > Now what I want to do is log all the web traffic that is requested from
> > those devices which are using WiFi.
> > I have attached the configuration of squid and Mikrotik which I had done
> > for HTTP. (Please note that when I had done this for HTTP, the squid
> > wasn't configured with --enable-SSL or --enable-crtd)
> >
>
> Yes, those options are required to handle the TLS which is part of
> HTTPS. HTTP is not encrypted. Or rather: --with-openssl is required
>
> Since you are rebuilding it with these extra options I recommend using
> the Squid-4 code from the Debian Sid repository if you can. It contains
> much better handling for HTTPS traffic which will be useful later to
> avoid non-HTTPS traffic arriving on port 443.
>
>
> > I had referred some online sites to do for HTTPS but none of them
> > worked. Please help if anyone knows how to log all HTTPS request.
> >
> > I have attached document regarding the rules applied in Mikrotik and
> > squid3 configuration for HTTP.
> >
>
> Okay. So first thing to do is fix some mistakes in your squid.conf
>
> * "transparent" has long ago been replaced by "intercept"
>
>  http_port 3127 intercept
>
> * remove incomplete / broken config line
>
>  #http_access deny
>
> * remove the first two of these repeated lines:
>
>  http_access allow localhost
>  ...
>  http_access allow localhost
>  http_access allow localhost
>  ...
>
> * stop using "localhost" as the ACL name to represent Department-A.
> Localhost is a reserved term in networking with a very specific meaning
> (different to what you are using it for) which is also baked into Squid
> default configuration settings.
>
> Instead use an ACL which names the thing being matched. For example:
>
>  acl Department-A src 10.0.7.0/24
>
>
> * move your custom setting down below the default security http_access
> rules. Those are the deny lines referring to SSL_ports and Safe_ports.
>
> Your http_access lines should now look nice and simple, like this:
>
>
>  http_access deny !Safe_ports
>  http_access deny CONNECT !SSL_ports
>
>  acl test dstdomain "/etc/squid3/acl/test"
>  http_access deny test
>
>  acl Department-A src 10.0.7.0/24
>  http_access allow Department-A
>
>  http_access deny all
>
>
> *** Your HTTP traffic should still be fully operational and doing what
> you want after these changes. If not something is broken we need to fix
> before continuing.
>
>
> Second, add the pieces necessary for handling port 443 traffic to
> squid.conf.
>
> You *will* need to generate a self-signed CA certificate with the
> signing-cert (CA) and and HTTP server properties to use SSL-Bump features.
>   But that will only need to be installed on clients machine *if* you go
> as far as decrypting the HTTPS traffic or producing errors for clients.
> This is where Squid-4 handles TLS far more cleanly than Squid-3.5.
>
>
>  # A port to receive port 443 traffic from Mikrotik
>  https_port 3129 intercept ssl-bump cert=/etc/squid3/your-CA.pem
>
>  ... note the 's' in that directive name. A typo there breaks HTTPS in
> confusing ways.
>
>
>  # SSL-Bump rules to peek at details for logging, then relay the traffic
>  acl step1 at_step SslBump1
>  ssl_bump peek step1
>  ssl_bump splice all
>
>  # Squid-4 can pass any non-HTTPS through or omit the below line to
> deliver error pages signed by the your-CA.pem certificate.
>
>   on_unsupported_protocol tunnel
>
>
> Thirdly, you need to add an entry to the Raspberry Pi NAT rules. Same as
> for the port 80 NAT rule that should also exist, but for port 443.
>
>  ** at this point you should be able to test the Raspberry PI is working
> for HTTPS by setting a test machine to have the R-Pi IP address as its
> gateway and requesting any https:// URL in a Browser, or wget, curl,
> squidclient etc.
>
>
> Lastly, when Squid is happily running with all that add to your Mikrotik
> config a second line identical to the first one in your attachment -
> except that it ends with "dst-port=443".
>
>  As soon as that line is active in your router the HTTPS traffic should
> start arriving and being logged at the Squid.
>
>
>
> Please be aware of the following details:
>
> * Do expect to see at least half of HTTPS traffic being CONNECT with
> raw-IPs and 0 bytes transferred. That is from the first step of
> SSL-Bump'ing. They should be followed by another CONNECT with the TLS
> SNI domain name and correct size of data transferred (one-way, to client).
>
>
> * The SNI is only accurate for honest clients. It can be forged and the
> real HTTPS messages be using another domain name hosted on the same
> server/CDN network.
>  However, to be properly sure that the traffic inside the TLS is going
> to the domain the SNI claimed you will have to fully decrypt the traffic
> (bump action) and that means installing your CA cert on all clients
> machines. Plus configuring dynamic cert generation on the https_port line.
>  Start with getting the above non-decrypt setup working before going
> near bumping.
>
>
> Amos
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180803/e6c59dfa/attachment.htm>

From belle at bazuin.nl  Fri Aug  3 07:40:29 2018
From: belle at bazuin.nl (=?windows-1252?Q?L.P.H._van_Belle?=)
Date: Fri, 3 Aug 2018 09:40:29 +0200
Subject: [squid-users] assertion failed
In-Reply-To: <5ebcef2b-4f9b-b06e-0854-7b696a11dc54@measurement-factory.com>
References: <vmime.5b630b20.155a.743a8de030386d20@ms249-lin-003.rotterdam.bazuin.nl>
Message-ID: <vmime.5b6406ed.559c.67ede27b32aff93d@ms249-lin-003.rotterdam.bazuin.nl>

Hello Alex, 

Thank you for the reply and the bug report link. 
Totaly forgot to check the bugzilla, sorry for that. 

I did read it and that exact what it is. 

I also can confirm that the assertion only happens with the logrotate. 
Squid does not crash so that looks all ok to me, i just dont like the messages in my logs. 
So for now i changed the logrotate, which eliminated the message. 
>From the default debian logrotate, and yes, i would preffer squid -k rotate also. 
But for now, i'll restart. 

I changed logrotate to: 

prerotate
   test ! -x /usr/sbin/sarg-reports || /usr/sbin/sarg-reports daily
Endscript

postrotate
if [ -d /run/systemd/system ] && command systemctl >/dev/null 2>&1 && systemctl is-active --quiet squid.service; then
   systemctl restart squid.service
elif [ -f /var/run/squid.pid ]; then
   test ! -e /var/run/squid.pid || test ! -x /usr/sbin/squid || /usr/sbin/squid -k rotate
fi
endscript

Best regards, 

Louis



> -----Oorspronkelijk bericht-----
> Van: Alex Rousskov [mailto:rousskov at measurement-factory.com] 
> Verzonden: donderdag 2 augustus 2018 17:43
> Aan: L.P.H. van Belle; squid-users at squid-cache.org
> Onderwerp: Re: [squid-users] assertion failed
> 
> On 08/02/2018 07:46 AM, L.P.H. van Belle wrote:
>  ?
> > If i google for "assertion failed: comm.cc:428: "!isOpen(conn->fd)"?
> > i get only 3 hits, is someone knows what this is, because i 
> cant figure
> > this out.
> 
> When facing an assertion, one should check Squid bugzilla:
> https://bugs.squid-cache.org/show_bug.cgi?id=4796
> 
> Alex.
> ?
> > 2018/08/02 06:25:01 kid1| storeDirWriteCleanLogs: Starting...
> > 2018/08/02 06:25:01 kid1| logfileRotate: 
> daemon:/var/log/squid/access.log
> > 2018/08/02 06:25:01 kid1| logfileRotate: 
> daemon:/var/log/squid/access.log
> > 2018/08/02 06:25:01 kid1| assertion failed: comm.cc:428: 
> "!isOpen(conn->fd)"
> 
> 
> 



From rousskov at measurement-factory.com  Fri Aug  3 15:34:58 2018
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Fri, 3 Aug 2018 09:34:58 -0600
Subject: [squid-users] assertion failed
In-Reply-To: <vmime.5b6406ed.559c.67ede27b32aff93d@ms249-lin-003.rotterdam.bazuin.nl>
References: <vmime.5b630b20.155a.743a8de030386d20@ms249-lin-003.rotterdam.bazuin.nl>
 <vmime.5b6406ed.559c.67ede27b32aff93d@ms249-lin-003.rotterdam.bazuin.nl>
Message-ID: <a8825134-3282-0988-419e-52a1433526b0@measurement-factory.com>

On 08/03/2018 01:40 AM, L.P.H. van Belle wrote:

> I also can confirm that the assertion only happens with the logrotate. 
> Squid does not crash 

When a Squid process hits an assertion, that process should crash. The
only (highly questionable) exception to that rule in the current code,
AFAICT, is hitting an assertion while shutting down. I would not rely on
that exception long-term.

Most likely, your Squid worker does crash and is restarted by the master
process.

Alex.


>> -----Oorspronkelijk bericht-----
>> Van: Alex Rousskov [mailto:rousskov at measurement-factory.com] 
>> Verzonden: donderdag 2 augustus 2018 17:43
>> Aan: L.P.H. van Belle; squid-users at squid-cache.org
>> Onderwerp: Re: [squid-users] assertion failed
>>
>> On 08/02/2018 07:46 AM, L.P.H. van Belle wrote:
>>  ?
>>> If i google for "assertion failed: comm.cc:428: "!isOpen(conn->fd)"?
>>> i get only 3 hits, is someone knows what this is, because i 
>> cant figure
>>> this out.
>>
>> When facing an assertion, one should check Squid bugzilla:
>> https://bugs.squid-cache.org/show_bug.cgi?id=4796
>>
>> Alex.
>> ?
>>> 2018/08/02 06:25:01 kid1| storeDirWriteCleanLogs: Starting...
>>> 2018/08/02 06:25:01 kid1| logfileRotate: 
>> daemon:/var/log/squid/access.log
>>> 2018/08/02 06:25:01 kid1| logfileRotate: 
>> daemon:/var/log/squid/access.log
>>> 2018/08/02 06:25:01 kid1| assertion failed: comm.cc:428: 
>> "!isOpen(conn->fd)"
>>
>>
>>
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 



From heiler.bemerguy at cinbesa.com.br  Fri Aug  3 15:56:26 2018
From: heiler.bemerguy at cinbesa.com.br (Heiler Bemerguy)
Date: Fri, 3 Aug 2018 12:56:26 -0300
Subject: [squid-users] Compiler optimization flags
Message-ID: <80e4cf58-c0ec-e020-bfb9-d7220837efb4@cinbesa.com.br>

Hey guys,

Which CFLAGS and CXXFLAGS do you use when compiling Squid 4?

We have a 12-core Xeon 12mb cache machine, with GCC 4.9.2 only for 
Squid, and I know that the default "O2" GCC optimization level tries to 
conserve some memory (stack, cache, etc), maybe wasting our resources..


-- 
Atenciosamente,

Heiler Bensimon Bemerguy - CINBESA
Analista de Redes, Wi-Fi,
Virtualiza??o e Servi?os Internet
(55) 91 98151-4894



From SKumpf at ouc.com  Fri Aug  3 19:06:09 2018
From: SKumpf at ouc.com (Kumpf, Scott)
Date: Fri, 3 Aug 2018 19:06:09 +0000
Subject: [squid-users] splunk 3.5.27-Sec Advisories
In-Reply-To: <A86ADD33-B029-496B-A9AC-BDE3C11D71C8@diladele.com>
References: <0549660147b84efc8c0daf6f5c8f648b@ouc.com>,
 <060e0538-5851-71ae-8eeb-11a0a6fb7474@treenet.co.nz>
 <A86ADD33-B029-496B-A9AC-BDE3C11D71C8@diladele.com>
Message-ID: <b03bd17922cd488397220964149b2292@ouc.com>

Greetings,

Checking in to see how the new Squid for Windows build is coming along, is there an update?  Is there a tentative release date? 

*Subject is incorrect---ignore 'splunk'

Scott Kumpf
Sr. Network Engineer-EMS (Contractor)
Orlando Utilities Commission
Office: (407) 434-4305 / Cell: (386) 547-2698
Email: skumpf at ouc.com




-----Original Message-----
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Rafael Akchurin
Sent: Saturday, July 28, 2018 1:36 AM
To: Amos Jeffries <squid3 at treenet.co.nz>
Cc: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] splunk 3.5.27-Sec Advisories

Hello Amos, Scott,

Will try building now. Shall be possible by the end of next week I hope.

Best regards,
Rafael Akchurin

> Op 28 jul. 2018 om 07:23 heeft Amos Jeffries <squid3 at treenet.co.nz> het volgende geschreven:
>
>> On 28/07/18 08:48, Kumpf, Scott wrote:
>> Greetings,
>>
>> The organization I work for is running Splunk for Windows version 3.5.27 which is impacted by 3 security vulnerabilities that were released earlier this year.  From what I can tell, our squid implementation was installed using an MSI package from Diladele.  It is my understanding per the advisories, the first point of contact for support is the maintainer/package vendor.  Diladele referred me back to Squid Developers and the only version that they have made available is version 3.5.27.  As I am not too familiar with source code packaging or compiling, I am in search for some guidance on available options to mitigate or remediate these vulnerabilities.  I believe 2 of them have workarounds that can be implemented by modifying the squid.conf.
>> As I  am not aware of how to determine how this version was configured at time of build therefore am not 100% certain if my implementation is even vulnerable.  Supposing the software is at risk, the advisories indicate there are patches available for each issue, however, I'm not clear on what to do with the information that the patch link presents.
>>
>
> The command line "squid -v" will list the build options used for your 
> particular binary along with its particular version. The advisory 
> section titled "Determining if your version is vulnerable:" is a 
> checklist to compare against your Squid. One statement there should 
> match your particular Squid installation.
>
> The fixes for all these are in our 3.5.28 bundle from 10 days ago. I 
> have not made the official announcements yet (thanks for the reminder) 
> so Diladele may have not been aware.
>
> I've cc'd Rafael on this reply and also opened an issue in the tracker 
> specifically notifying of the release so they can start on that while 
> I do the write-up. 
> <https://github.com/diladele/squid-windows/issues/81>
>
>
> HTH
> Amos
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users

________________________________

DISCLAIMER:
Florida has a very broad public records law. As a result, any written communication created or received by Orlando Utilities Commission officials and employees will be made available to the public and media, upon request, unless otherwise exempt. Under Florida law, email addresses are public records. If you do not want your email address released in response to a public records request, do not send electronic mail to this office. Instead, contact our office by phone or in writing.

From rafael.akchurin at diladele.com  Fri Aug  3 20:53:14 2018
From: rafael.akchurin at diladele.com (Rafael Akchurin)
Date: Fri, 3 Aug 2018 20:53:14 +0000
Subject: [squid-users] splunk 3.5.27-Sec Advisories
In-Reply-To: <b03bd17922cd488397220964149b2292@ouc.com>
References: <0549660147b84efc8c0daf6f5c8f648b@ouc.com>,
 <060e0538-5851-71ae-8eeb-11a0a6fb7474@treenet.co.nz>
 <A86ADD33-B029-496B-A9AC-BDE3C11D71C8@diladele.com>,
 <b03bd17922cd488397220964149b2292@ouc.com>
Message-ID: <D1389259-5316-4CE2-99BD-71326653041D@diladele.com>

We are waiting on it. Sorry summer time :)

Best regards,
Rafael Akchurin

> Op 3 aug. 2018 om 21:06 heeft Kumpf, Scott <SKumpf at ouc.com> het volgende geschreven:
> 
> Greetings,
> 
> Checking in to see how the new Squid for Windows build is coming along, is there an update?  Is there a tentative release date? 
> 
> *Subject is incorrect---ignore 'splunk'
> 
> Scott Kumpf
> Sr. Network Engineer-EMS (Contractor)
> Orlando Utilities Commission
> Office: (407) 434-4305 / Cell: (386) 547-2698
> Email: skumpf at ouc.com
> 
> 
> 
> 
> -----Original Message-----
> From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Rafael Akchurin
> Sent: Saturday, July 28, 2018 1:36 AM
> To: Amos Jeffries <squid3 at treenet.co.nz>
> Cc: squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] splunk 3.5.27-Sec Advisories
> 
> Hello Amos, Scott,
> 
> Will try building now. Shall be possible by the end of next week I hope.
> 
> Best regards,
> Rafael Akchurin
> 
>>> Op 28 jul. 2018 om 07:23 heeft Amos Jeffries <squid3 at treenet.co.nz> het volgende geschreven:
>>> 
>>> On 28/07/18 08:48, Kumpf, Scott wrote:
>>> Greetings,
>>> 
>>> The organization I work for is running Splunk for Windows version 3.5.27 which is impacted by 3 security vulnerabilities that were released earlier this year.  From what I can tell, our squid implementation was installed using an MSI package from Diladele.  It is my understanding per the advisories, the first point of contact for support is the maintainer/package vendor.  Diladele referred me back to Squid Developers and the only version that they have made available is version 3.5.27.  As I am not too familiar with source code packaging or compiling, I am in search for some guidance on available options to mitigate or remediate these vulnerabilities.  I believe 2 of them have workarounds that can be implemented by modifying the squid.conf.
>>> As I  am not aware of how to determine how this version was configured at time of build therefore am not 100% certain if my implementation is even vulnerable.  Supposing the software is at risk, the advisories indicate there are patches available for each issue, however, I'm not clear on what to do with the information that the patch link presents.
>>> 
>> 
>> The command line "squid -v" will list the build options used for your 
>> particular binary along with its particular version. The advisory 
>> section titled "Determining if your version is vulnerable:" is a 
>> checklist to compare against your Squid. One statement there should 
>> match your particular Squid installation.
>> 
>> The fixes for all these are in our 3.5.28 bundle from 10 days ago. I 
>> have not made the official announcements yet (thanks for the reminder) 
>> so Diladele may have not been aware.
>> 
>> I've cc'd Rafael on this reply and also opened an issue in the tracker 
>> specifically notifying of the release so they can start on that while 
>> I do the write-up. 
>> <https://github.com/diladele/squid-windows/issues/81>
>> 
>> 
>> HTH
>> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 
> ________________________________
> 
> DISCLAIMER:
> Florida has a very broad public records law. As a result, any written communication created or received by Orlando Utilities Commission officials and employees will be made available to the public and media, upon request, unless otherwise exempt. Under Florida law, email addresses are public records. If you do not want your email address released in response to a public records request, do not send electronic mail to this office. Instead, contact our office by phone or in writing.


From rightkicktech at gmail.com  Sat Aug  4 15:29:14 2018
From: rightkicktech at gmail.com (Alex K)
Date: Sat, 4 Aug 2018 18:29:14 +0300
Subject: [squid-users] Bounces
Message-ID: <CABMULtJqo+ysDWmajbksZcwx7-Cnostyw6hNbG6oji++u7GPsg@mail.gmail.com>

Hi all,

I have been receiving lately the following from the list:

Your membership in the mailing list squid-users has been disabled due
to excessive bounces

Any known issues with the list?
Alex
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180804/10d0b1b2/attachment.htm>

From uhlar at fantomas.sk  Sat Aug  4 15:48:18 2018
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Sat, 4 Aug 2018 17:48:18 +0200
Subject: [squid-users] Bounces
In-Reply-To: <CABMULtJqo+ysDWmajbksZcwx7-Cnostyw6hNbG6oji++u7GPsg@mail.gmail.com>
References: <CABMULtJqo+ysDWmajbksZcwx7-Cnostyw6hNbG6oji++u7GPsg@mail.gmail.com>
Message-ID: <20180804154818.GA30250@fantomas.sk>

On 04.08.18 18:29, Alex K wrote:
>I have been receiving lately the following from the list:
>
>Your membership in the mailing list squid-users has been disabled due
>to excessive bounces
>
>Any known issues with the list?

I don't think so. It's possible that your mailserver (gmail) refused some
mail in the last few days.

Did not happen to me. I don't know if gmail provides logs related to your
account...

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
You have the right to remain silent. Anything you say will be misquoted,
then used against you. 


From squid.expire2019 at suelze.de  Sat Aug  4 16:18:12 2018
From: squid.expire2019 at suelze.de (Goetz Schultz)
Date: Sat, 4 Aug 2018 17:18:12 +0100
Subject: [squid-users]  Bounces
In-Reply-To: <20180804154818.GA30250@fantomas.sk>
References: <CABMULtJqo+ysDWmajbksZcwx7-Cnostyw6hNbG6oji++u7GPsg@mail.gmail.com>
 <20180804154818.GA30250@fantomas.sk>
Message-ID: <d5b49ed3-0572-f8e4-08b9-67eb17dd4031@suelze.de>

It seems this happens from time to time. Despite my setting to "accept
all", I have drops from various mailing lists due to bounces. Why? No idea.


Thanks and regards

  Goetz R. Schultz

On 04/08/18 16:48, Matus UHLAR - fantomas wrote:
> On 04.08.18 18:29, Alex K wrote:
>> I have been receiving lately the following from the list:
>>
>> Your membership in the mailing list squid-users has been disabled due
>> to excessive bounces
>>
>> Any known issues with the list?
> 
> I don't think so. It's possible that your mailserver (gmail) refused some
> mail in the last few days.
> 
> Did not happen to me. I don't know if gmail provides logs related to your
> account...
> 



---------------------------->8------------------------------

  /"\
  \ /  ASCII Ribbon Campaign
   X   against HTML e-mail
  / \ 
 This message transmitted on 100% recycled electrons.
----------------------------8<------------------------------


From tarotapprentice at yahoo.com  Sat Aug  4 17:55:56 2018
From: tarotapprentice at yahoo.com (TarotApprentice)
Date: Sat, 4 Aug 2018 17:55:56 +0000 (UTC)
Subject: [squid-users] Bounces
References: <2012213544.2105017.1533405356185.ref@mail.yahoo.com>
Message-ID: <2012213544.2105017.1533405356185@mail.yahoo.com>

I get them all the time. Yahoo seems to be particularly bad.

MarkJ


--------------------------------------------
On Sat, 4/8/18, Alex K <rightkicktech at gmail.com> wrote:

 Subject: [squid-users] Bounces
 To: squid-users at lists.squid-cache.org
 Received: Saturday, 4 August, 2018, 5:29 PM
 
 Hi all,?
 I have been receiving lately the following from
 the list:
 Your
 membership in the mailing list squid-users has been disabled
 due
 to
 excessive bounces
 
 Any known
 issues with the list?Alex_______________________________________________
 squid-users mailing list
 squid-users at lists.squid-cache.org
 http://lists.squid-cache.org/listinfo/squid-users
 
 -----Inline Attachment Follows-----
 
 


From rightkicktech at gmail.com  Sat Aug  4 19:04:05 2018
From: rightkicktech at gmail.com (Alex K)
Date: Sat, 4 Aug 2018 22:04:05 +0300
Subject: [squid-users] Bounces
In-Reply-To: <d5b49ed3-0572-f8e4-08b9-67eb17dd4031@suelze.de>
References: <CABMULtJqo+ysDWmajbksZcwx7-Cnostyw6hNbG6oji++u7GPsg@mail.gmail.com>
 <20180804154818.GA30250@fantomas.sk>
 <d5b49ed3-0572-f8e4-08b9-67eb17dd4031@suelze.de>
Message-ID: <CABMULtJ81cb+puzwSaNSbKVau44bLNowYWX6a6VEFfUkna1Oww@mail.gmail.com>

I am using the same account to many other lists without such bounce
reports. It could be that others are not sending such reports. I will see
if i can find any logs at gtmail.

Thanx,
Alex



On Aug 4, 2018 19:18, "Goetz Schultz" <squid.expire2019 at suelze.de> wrote:

It seems this happens from time to time. Despite my setting to "accept
all", I have drops from various mailing lists due to bounces. Why? No idea.


Thanks and regards

  Goetz R. Schultz


On 04/08/18 16:48, Matus UHLAR - fantomas wrote:
> On 04.08.18 18:29, Alex K wrote:
>> I have been receiving lately the following from the list:
>>
>> Your membership in the mailing list squid-users has been disabled due
>> to excessive bounces
>>
>> Any known issues with the list?
>
> I don't think so. It's possible that your mailserver (gmail) refused some
> mail in the last few days.
>
> Did not happen to me. I don't know if gmail provides logs related to your
> account...
>



---------------------------->8------------------------------

  /"\
  \ /  ASCII Ribbon Campaign
   X   against HTML e-mail
  / \
 This message transmitted on 100% recycled electrons.
----------------------------8<------------------------------

_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180804/338d04a2/attachment.htm>

From heiler.bemerguy at cinbesa.com.br  Sun Aug  5 02:41:18 2018
From: heiler.bemerguy at cinbesa.com.br (Heiler Bemerguy)
Date: Sat, 4 Aug 2018 23:41:18 -0300
Subject: [squid-users] 4.1 exception PageStack.cc(106)
Message-ID: <4c1aca29-f1f3-631f-00bb-199dc4430ef0@cinbesa.com.br>

2018/08/04 04:42:59 kid1| FATAL: Dying from an exception handling 
failure; exception: check failed: false
 ??? exception location: mem/PageStack.cc(106) push

Then it tries to run again and again every kid but they always die:

2018/08/04 04:43:05 kid1| FATAL: kid1 registration timed out
2018/08/04 04:43:05 kid1| Squid Cache (Version 4.1-20180725-r86244dd): 
Terminated abnormally.
CPU Usage: 0.036 seconds = 0.016 user + 0.020 sys
Maximum Resident Size: 155984 KB
Page faults with physical i/o: 0


Squid Cache: Version 4.1-20180725-r86244dd
Service Name: squid

This binary uses OpenSSL 1.0.1t? 3 May 2016. For legal restrictions on 
distribution see https://www.openssl.org/source/license.html

configure options:? '--enable-delay-pools' '--with-openssl' 
'--enable-htcp' '--disable-maintainer-mode' 
'--disable-dependency-tracking' '--disable-wccp' '--disable-snmp' 
'--enable-inline' '--enable-async-io=32' '--enable-storeio=aufs,rock' 
'--enable-underscores' '--enable-removal-policies=lru,heap' 
'--enable-http-violations' '--disable-ident-lookups' 
'--with-large-files' '--enable-ssl' '--enable-ltdl-convenience' 
'--prefix=/usr' '--localstatedir=/var' '--libexecdir=/lib/squid' 
'--srcdir=.' '--datadir=/usr/share/squid' '--sysconfdir=/etc/squid' 
'--with-default-user=proxy' '--with-logdir=/var/log' 
'--with-pidfile=/var/run/squid.pid' '--with-filedescriptors=16384' 
'--with-aufs-threads=32' '--disable-translation'

-- 
Atenciosamente,

Heiler Bensimon Bemerguy - CINBESA
Analista de Redes, Wi-Fi,
Virtualiza??o e Servi?os Internet
(55) 91 98151-4894



From loginmogin at gmail.com  Sun Aug  5 04:03:41 2018
From: loginmogin at gmail.com (login mogin)
Date: Sat, 4 Aug 2018 21:03:41 -0700
Subject: [squid-users] Bounces
In-Reply-To: <CABMULtJ81cb+puzwSaNSbKVau44bLNowYWX6a6VEFfUkna1Oww@mail.gmail.com>
References: <CABMULtJqo+ysDWmajbksZcwx7-Cnostyw6hNbG6oji++u7GPsg@mail.gmail.com>
 <20180804154818.GA30250@fantomas.sk>
 <d5b49ed3-0572-f8e4-08b9-67eb17dd4031@suelze.de>
 <CABMULtJ81cb+puzwSaNSbKVau44bLNowYWX6a6VEFfUkna1Oww@mail.gmail.com>
Message-ID: <CAJbsrUksx6UXTp8CwvK4YOre+qvvXfFC55++gN=QhnGK4Eip5Q@mail.gmail.com>

Happened to me as well, kind of a gmail <--> lists.squid-cache.org thing I
guess.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180804/6a69088e/attachment.htm>

From squid3 at treenet.co.nz  Sun Aug  5 07:55:14 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sun, 5 Aug 2018 19:55:14 +1200
Subject: [squid-users] Bounces
In-Reply-To: <CAJbsrUksx6UXTp8CwvK4YOre+qvvXfFC55++gN=QhnGK4Eip5Q@mail.gmail.com>
References: <CABMULtJqo+ysDWmajbksZcwx7-Cnostyw6hNbG6oji++u7GPsg@mail.gmail.com>
 <20180804154818.GA30250@fantomas.sk>
 <d5b49ed3-0572-f8e4-08b9-67eb17dd4031@suelze.de>
 <CABMULtJ81cb+puzwSaNSbKVau44bLNowYWX6a6VEFfUkna1Oww@mail.gmail.com>
 <CAJbsrUksx6UXTp8CwvK4YOre+qvvXfFC55++gN=QhnGK4Eip5Q@mail.gmail.com>
Message-ID: <77a8bb3f-2f17-25cb-8cfb-6069b2199f4e@treenet.co.nz>

On 05/08/18 16:03, login mogin wrote:
> Happened to me as well, kind of a gmail <-->?lists.squid-cache.org
> <http://lists.squid-cache.org> thing I guess.
> 

We have in the past seen a few issues where peoples accounts got hacked
and their address used to deliver spam. This can result in badly
configured ISPs blocking anything incoming from those addresses with a
full bounce back at us when a 5xx error should have been used.

Or the boring old "normal" reason - your ISP just decided to block
receipt of our mailing list posts to your subscribed address.

Or the LetsEncrypt script broke on us yet again (seems to do so for a
few hours / days almost every update). Any ISPs actually checking the
DKIM signatures can block list mail while the STARTTLS sorts itself out
and get bounces recorded against your subscription.

Alternatively, if you are still trying to post to the @squid-cache.org
mailing list address the listserver will register that as a delivery
error which gets aggregated into the "bounce" category.
 NP: those lists have been dead for *years* now, if this is you please
fix your address books.


As that message from our listserver said "Your membership in the mailing
list squid-users has been disabled due to excessive bounces".

For anyone else seeing this now or in future:

The disable is specific to an individual subscription. If the listserver
mentioned any way to re-enable your account please do that. Or your can
try unsubscribe and re-subscribe.

If you still need help after trying those please contact our noc@
mailing list.

If *that* noc@ contact attempt gets bounced/rejected our bugzilla has a
"Project Services" product you can register issues with. Just be aware
that makes a permanent public bug record.


Amos


From squid3 at treenet.co.nz  Sun Aug  5 08:47:27 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sun, 5 Aug 2018 20:47:27 +1200
Subject: [squid-users] 4.1 exception PageStack.cc(106)
In-Reply-To: <4c1aca29-f1f3-631f-00bb-199dc4430ef0@cinbesa.com.br>
References: <4c1aca29-f1f3-631f-00bb-199dc4430ef0@cinbesa.com.br>
Message-ID: <c36ef8c3-6600-4d15-cad2-4983a7970c0f@treenet.co.nz>

On 05/08/18 14:41, Heiler Bemerguy wrote:
> 2018/08/04 04:42:59 kid1| FATAL: Dying from an exception handling
> failure; exception: check failed: false
> ??? exception location: mem/PageStack.cc(106) push
> 

What are your cache_mem and cache_dir settings?

And what *-bit type (eg 16, 32, 64, 128) is the machine displaying these
errors?

Amos


From ahmed.zaeem at netstream.ps  Mon Aug  6 11:20:37 2018
From: ahmed.zaeem at netstream.ps (--Ahmad--)
Date: Mon, 6 Aug 2018 14:20:37 +0300
Subject: [squid-users] want to ask about DNS resolution in firefox as an
	example
Message-ID: <A75C6C35-F6FC-4D29-9D25-1504628D487C@netstream.ps>

Hello Folks ,

i want to ask 

now i  squid proxy  in USA .

im in France and i have french ip address and MY isp has DNS French .


now if i use squid (USA) on my pc in (FR)

and i try to access google.com <http://google.com/>

the question is being asked is , who will resolve the google website ip  ?


the proxy  ?

or my network card ?

i mean which DNS is playing the role ?
and how to force the DNS to be from squid  , in case to prevent DNS leak ?

thanks 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180806/ef66fae4/attachment.htm>

From Antony.Stone at squid.open.source.it  Mon Aug  6 11:24:38 2018
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Mon, 6 Aug 2018 13:24:38 +0200
Subject: [squid-users] want to ask about DNS resolution in firefox as an
	example
In-Reply-To: <A75C6C35-F6FC-4D29-9D25-1504628D487C@netstream.ps>
References: <A75C6C35-F6FC-4D29-9D25-1504628D487C@netstream.ps>
Message-ID: <201808061324.38986.Antony.Stone@squid.open.source.it>

On Monday 06 August 2018 at 13:20:37, --Ahmad-- wrote:

> Hello Folks ,
> 
> i want to ask
> 
> now i  squid proxy  in USA .
> 
> im in France and i have french ip address

So, unless you've done something pretty complicated with your networking, you 
will have configured your browser to explicitly use Squid as a proxy (ie: 
you're not using Squid in intercept mode).

> the question is being asked is , who will resolve the google website ip  ?

Squid, using whatever DNS servers the machine Squid is running on are pointing 
to.


Antony.

-- 
What do you call a dinosaur with only one eye?  A Doyouthinkesaurus.

                                                   Please reply to the list;
                                                         please *don't* CC me.


From ahmed.zaeem at netstream.ps  Mon Aug  6 11:32:32 2018
From: ahmed.zaeem at netstream.ps (--Ahmad--)
Date: Mon, 6 Aug 2018 14:32:32 +0300
Subject: [squid-users] want to ask about DNS resolution in firefox as an
 example
In-Reply-To: <201808061324.38986.Antony.Stone@squid.open.source.it>
References: <A75C6C35-F6FC-4D29-9D25-1504628D487C@netstream.ps>
 <201808061324.38986.Antony.Stone@squid.open.source.it>
Message-ID: <F63C5559-822B-4FA5-B677-A317BAC9F38F@netstream.ps>

can you explain please ?

im in FR and access my site from US proxy but visits show location as FR not US

what could be the reason ?

thats why i ask about DNS leak plz advise !

thanks



> On 6 Aug 2018, at 14:24, Antony Stone <Antony.Stone at squid.open.source.it> wrote:
> 
> On Monday 06 August 2018 at 13:20:37, --Ahmad-- wrote:
> 
>> Hello Folks ,
>> 
>> i want to ask
>> 
>> now i  squid proxy  in USA .
>> 
>> im in France and i have french ip address
> 
> So, unless you've done something pretty complicated with your networking, you 
> will have configured your browser to explicitly use Squid as a proxy (ie: 
> you're not using Squid in intercept mode).
> 
>> the question is being asked is , who will resolve the google website ip  ?
> 
> Squid, using whatever DNS servers the machine Squid is running on are pointing 
> to.
> 
> 
> Antony.
> 
> -- 
> What do you call a dinosaur with only one eye?  A Doyouthinkesaurus.
> 
>                                                   Please reply to the list;
>                                                         please *don't* CC me.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



From Antony.Stone at squid.open.source.it  Mon Aug  6 11:39:12 2018
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Mon, 6 Aug 2018 13:39:12 +0200
Subject: [squid-users] want to ask about DNS resolution in firefox as an
	example
In-Reply-To: <F63C5559-822B-4FA5-B677-A317BAC9F38F@netstream.ps>
References: <A75C6C35-F6FC-4D29-9D25-1504628D487C@netstream.ps>
 <201808061324.38986.Antony.Stone@squid.open.source.it>
 <F63C5559-822B-4FA5-B677-A317BAC9F38F@netstream.ps>
Message-ID: <201808061339.12479.Antony.Stone@squid.open.source.it>

On Monday 06 August 2018 at 13:32:32, --Ahmad-- wrote:

> can you explain please ?
> 
> im in FR and access my site from US proxy but visits show location as FR
> not US

Give us an example - what exactly do you mean by "visits show location"?

> what could be the reason ?

Cookies on your computer, javascript in web pages, browser language 
preferences, locally cached content...

I'm sure I haven't thought of everything.

> thats why i ask about DNS leak plz advise !

What does https://whatsmyip.com/ tell you?


Antony.

-- 
I conclude that there are two ways of constructing a software design: One way 
is to make it so simple that there are _obviously_ no deficiencies, and the 
other way is to make it so complicated that there are no _obvious_ 
deficiencies.

 - C A R Hoare

                                                   Please reply to the list;
                                                         please *don't* CC me.


From admin at sneakerspace.co.uk  Mon Aug  6 12:08:35 2018
From: admin at sneakerspace.co.uk (Sneaker Space LTD)
Date: Mon, 6 Aug 2018 13:08:35 +0100
Subject: [squid-users] Increasing Squid 128 Max Connection Limit
Message-ID: <CAGzU65o8v5syY2d4_Anr+=uY+AorM6ggdLw3aMyxXAxnH3ZRpQ@mail.gmail.com>

Hello,
Im looking for help in regards to compiling and installing squid on a Linux
server with the option to increase its max connection limit. I understand
after some research that ,  '   ./configure
CXXFLAGS="-DMAXTCPLISTENPORTS=XXX" '  , is the configuration option to use
but after hours of attempts and paying 2 different freelancers to try and
get it to work, I still cant seem to get its max connection limit
increased. If anyone has any knowledge on how to get it done your help
would be greatly appreciated.

Thanks and Have a good day!
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180806/cbc46304/attachment.htm>

From heiler.bemerguy at cinbesa.com.br  Mon Aug  6 15:32:49 2018
From: heiler.bemerguy at cinbesa.com.br (Heiler Bemerguy)
Date: Mon, 6 Aug 2018 12:32:49 -0300
Subject: [squid-users] 4.1 exception PageStack.cc(106)
In-Reply-To: <c36ef8c3-6600-4d15-cad2-4983a7970c0f@treenet.co.nz>
References: <4c1aca29-f1f3-631f-00bb-199dc4430ef0@cinbesa.com.br>
 <c36ef8c3-6600-4d15-cad2-4983a7970c0f@treenet.co.nz>
Message-ID: <6d584580-96e1-4d85-4579-068333f7f827@cinbesa.com.br>

Em 05/08/2018 05:47, Amos Jeffries escreveu:
> On 05/08/18 14:41, Heiler Bemerguy wrote:
>> 2018/08/04 04:42:59 kid1| FATAL: Dying from an exception handling
>> failure; exception: check failed: false
>>  ??? exception location: mem/PageStack.cc(106) push
>>
> What are your cache_mem and cache_dir settings?

workers 5
cache_mem 5500 MB
cache_dir rock /cache2 130000 min-size=1 max-size=196608
cache_dir rock /cache3 130000 min-size=196609 max-size=624288
cache_dir rock /cache4 130000 min-size=624289 max-swap-rate=500 
swap-timeout=500

> And what *-bit type (eg 16, 32, 64, 128) is the machine displaying these
> errors?
How can I get that?!


-- 
Atenciosamente,

Heiler Bensimon Bemerguy - CINBESA
Analista de Redes, Wi-Fi,
Virtualiza??o e Servi?os Internet
(55) 91 98151-4894



From rousskov at measurement-factory.com  Mon Aug  6 16:01:12 2018
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Mon, 6 Aug 2018 10:01:12 -0600
Subject: [squid-users] Increasing Squid 128 Max Connection Limit
In-Reply-To: <CAGzU65o8v5syY2d4_Anr+=uY+AorM6ggdLw3aMyxXAxnH3ZRpQ@mail.gmail.com>
References: <CAGzU65o8v5syY2d4_Anr+=uY+AorM6ggdLw3aMyxXAxnH3ZRpQ@mail.gmail.com>
Message-ID: <441b334c-fdc5-ff40-34f1-26d45956b93a@measurement-factory.com>

On 08/06/2018 06:08 AM, Sneaker Space LTD wrote:

> Im looking for help in regards to compiling and installing squid on a
> Linux server with the option to increase its max connection limit. 

Do you want to increase the maximum number of concurrent connections
that your Squid can handle OR do you want to use more than 128 listening
ports with your Squid? The two things are virtually unrelated but your
question mixes them up...

If it is the former, what is your current limit and why do you think you
need to increase it? What Squid version and operating system you are
using? Have you checked ulimits? Post Squid cache.log output at startup.
In most cases, this is a general "increase the number of file
descriptors available to a program" problem, but perhaps your situation
is different.

If it is the latter, why do you think you need more than 128 listening
ports and why do you think rebuilding from scratch (after "make clean")
with DMAXTCPLISTENPORTS=XXX did not work?

Alex.


From squid3 at treenet.co.nz  Mon Aug  6 16:39:01 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 7 Aug 2018 04:39:01 +1200
Subject: [squid-users] 4.1 exception PageStack.cc(106)
In-Reply-To: <6d584580-96e1-4d85-4579-068333f7f827@cinbesa.com.br>
References: <4c1aca29-f1f3-631f-00bb-199dc4430ef0@cinbesa.com.br>
 <c36ef8c3-6600-4d15-cad2-4983a7970c0f@treenet.co.nz>
 <6d584580-96e1-4d85-4579-068333f7f827@cinbesa.com.br>
Message-ID: <5838b285-1934-aa1b-2138-ba5d806350d8@treenet.co.nz>

On 07/08/18 03:32, Heiler Bemerguy wrote:
> Em 05/08/2018 05:47, Amos Jeffries escreveu:
>> On 05/08/18 14:41, Heiler Bemerguy wrote:
>>> 2018/08/04 04:42:59 kid1| FATAL: Dying from an exception handling
>>> failure; exception: check failed: false
>>> ???? exception location: mem/PageStack.cc(106) push
>>>
>> What are your cache_mem and cache_dir settings?
> 
> workers 5
> cache_mem 5500 MB
> cache_dir rock /cache2 130000 min-size=1 max-size=196608
> cache_dir rock /cache3 130000 min-size=196609 max-size=624288
> cache_dir rock /cache4 130000 min-size=624289 max-swap-rate=500
> swap-timeout=500
> 
>> And what *-bit type (eg 16, 32, 64, 128) is the machine displaying these
>> errors?
> How can I get that?!

That depends on your OS.  On Linux "uname -a" provides the relevant type
info. I'm not sure for other OS which lack that tool.

Amos


From heiler.bemerguy at cinbesa.com.br  Mon Aug  6 16:53:07 2018
From: heiler.bemerguy at cinbesa.com.br (Heiler Bemerguy)
Date: Mon, 6 Aug 2018 13:53:07 -0300
Subject: [squid-users] 4.1 exception PageStack.cc(106)
In-Reply-To: <5838b285-1934-aa1b-2138-ba5d806350d8@treenet.co.nz>
References: <4c1aca29-f1f3-631f-00bb-199dc4430ef0@cinbesa.com.br>
 <c36ef8c3-6600-4d15-cad2-4983a7970c0f@treenet.co.nz>
 <6d584580-96e1-4d85-4579-068333f7f827@cinbesa.com.br>
 <5838b285-1934-aa1b-2138-ba5d806350d8@treenet.co.nz>
Message-ID: <676bbeb2-75a2-6624-cbf7-e7edbe4ea414@cinbesa.com.br>

Em 06/08/2018 13:39, Amos Jeffries escreveu:
>
>> workers 5
>> cache_mem 5500 MB
>> cache_dir rock /cache2 130000 min-size=1 max-size=196608
>> cache_dir rock /cache3 130000 min-size=196609 max-size=624288
>> cache_dir rock /cache4 130000 min-size=624289 max-swap-rate=500
>> swap-timeout=500
>>
>>> And what *-bit type (eg 16, 32, 64, 128) is the machine displaying these
>>> errors?
>> How can I get that?!
> That depends on your OS.  On Linux "uname -a" provides the relevant type
> info. I'm not sure for other OS which lack that tool.

Linux proxy 3.16.0-4-amd64 #1 SMP Debian 3.16.43-2+deb8u1 (2017-06-18) 
x86_64 GNU/Linux

-- 
Atenciosamente,

Heiler Bensimon Bemerguy - CINBESA
Analista de Redes, Wi-Fi,
Virtualiza??o e Servi?os Internet
(55) 91 98151-4894



From uhlar at fantomas.sk  Mon Aug  6 17:24:25 2018
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Mon, 6 Aug 2018 19:24:25 +0200
Subject: [squid-users] 4.1 exception PageStack.cc(106)
In-Reply-To: <676bbeb2-75a2-6624-cbf7-e7edbe4ea414@cinbesa.com.br>
References: <4c1aca29-f1f3-631f-00bb-199dc4430ef0@cinbesa.com.br>
 <c36ef8c3-6600-4d15-cad2-4983a7970c0f@treenet.co.nz>
 <6d584580-96e1-4d85-4579-068333f7f827@cinbesa.com.br>
 <5838b285-1934-aa1b-2138-ba5d806350d8@treenet.co.nz>
 <676bbeb2-75a2-6624-cbf7-e7edbe4ea414@cinbesa.com.br>
Message-ID: <20180806172425.GA9186@fantomas.sk>

>Em 06/08/2018 13:39, Amos Jeffries escreveu:
>>
>>>workers 5
>>>cache_mem 5500 MB
>>>cache_dir rock /cache2 130000 min-size=1 max-size=196608
>>>cache_dir rock /cache3 130000 min-size=196609 max-size=624288
>>>cache_dir rock /cache4 130000 min-size=624289 max-swap-rate=500
>>>swap-timeout=500
>>>
>>>>And what *-bit type (eg 16, 32, 64, 128) is the machine displaying these
>>>>errors?
>>>How can I get that?!
>>That depends on your OS.  On Linux "uname -a" provides the relevant type
>>info. I'm not sure for other OS which lack that tool.

On 06.08.18 13:53, Heiler Bemerguy wrote:
>Linux proxy 3.16.0-4-amd64 #1 SMP Debian 3.16.43-2+deb8u1 (2017-06-18) 
>x86_64 GNU/Linux

on debian, also:

dpkg --print-architecture

and

dpkg -s squid squid3

are important.

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Honk if you love peace and quiet. 


From srnhari at gmail.com  Mon Aug  6 17:44:22 2018
From: srnhari at gmail.com (Hariharan Sethuraman)
Date: Mon, 6 Aug 2018 23:14:22 +0530
Subject: [squid-users] Squid drops authorization header before forwarding
Message-ID: <CANfnjg+WsgmR+wyVSwJs8_N5OK0rBx9R57BkyPoRriB4-FN=yw@mail.gmail.com>

 Hi,

I have my squid as reverse proxy (without any auth) between my client and a
web server.  My HTTP request from client has an Authorization in its HTTP
header which I wanted it to be forwarded to target server. But from
cache.log I see squid is dropping before sending it to my web server, could
someone help on what I am missing?

Thanks,
Hari
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180806/7dba9490/attachment.htm>

From uhlar at fantomas.sk  Mon Aug  6 17:49:50 2018
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Mon, 6 Aug 2018 19:49:50 +0200
Subject: [squid-users] Squid drops authorization header before forwarding
In-Reply-To: <CANfnjg+WsgmR+wyVSwJs8_N5OK0rBx9R57BkyPoRriB4-FN=yw@mail.gmail.com>
References: <CANfnjg+WsgmR+wyVSwJs8_N5OK0rBx9R57BkyPoRriB4-FN=yw@mail.gmail.com>
Message-ID: <20180806174949.GA9852@fantomas.sk>

On 06.08.18 23:14, Hariharan Sethuraman wrote:
>I have my squid as reverse proxy (without any auth) between my client and a
>web server.  My HTTP request from client has an Authorization in its HTTP
>header which I wanted it to be forwarded to target server. But from
>cache.log I see squid is dropping before sending it to my web server, could
>someone help on what I am missing?

did you configure proxy manually in the browser or do you use intercepting?

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Remember half the people you know are below average. 


From uhlar at fantomas.sk  Mon Aug  6 17:53:21 2018
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Mon, 6 Aug 2018 19:53:21 +0200
Subject: [squid-users] Squid drops authorization header before forwarding
In-Reply-To: <20180806174949.GA9852@fantomas.sk>
References: <CANfnjg+WsgmR+wyVSwJs8_N5OK0rBx9R57BkyPoRriB4-FN=yw@mail.gmail.com>
 <20180806174949.GA9852@fantomas.sk>
Message-ID: <20180806175321.GB9852@fantomas.sk>

>On 06.08.18 23:14, Hariharan Sethuraman wrote:
>>I have my squid as reverse proxy (without any auth) between my client and a
>>web server.  My HTTP request from client has an Authorization in its HTTP
>>header which I wanted it to be forwarded to target server. But from
>>cache.log I see squid is dropping before sending it to my web server, could
>>someone help on what I am missing?

On 06.08.18 19:49, Matus UHLAR - fantomas wrote:
>did you configure proxy manually in the browser or do you use intercepting?

oh, sorry, now I read "reverse proxy".
what is the http_port line?

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Despite the cost of living, have you noticed how popular it remains? 


From srnhari at gmail.com  Mon Aug  6 17:59:15 2018
From: srnhari at gmail.com (Hariharan Sethuraman)
Date: Mon, 6 Aug 2018 23:29:15 +0530
Subject: [squid-users] Squid drops authorization header before forwarding
In-Reply-To: <20180806175321.GB9852@fantomas.sk>
References: <CANfnjg+WsgmR+wyVSwJs8_N5OK0rBx9R57BkyPoRriB4-FN=yw@mail.gmail.com>
 <20180806174949.GA9852@fantomas.sk> <20180806175321.GB9852@fantomas.sk>
Message-ID: <CANfnjgLy5KovAeX4nk9ajZYsDBwFQKBgwdZ9m_XPpc_YGQWZ=w@mail.gmail.com>

I tried allow_direct as well as defaultsite under accel.
Wondering if I should recompile squid with enable-http-violation and use
below ACL /

request_header_access Authorization deny all



On Mon, Aug 6, 2018 at 11:23 PM, Matus UHLAR - fantomas <uhlar at fantomas.sk>
wrote:

> On 06.08.18 23:14, Hariharan Sethuraman wrote:
>>
>>> I have my squid as reverse proxy (without any auth) between my client
>>> and a
>>> web server.  My HTTP request from client has an Authorization in its HTTP
>>> header which I wanted it to be forwarded to target server. But from
>>> cache.log I see squid is dropping before sending it to my web server,
>>> could
>>> someone help on what I am missing?
>>>
>>
> On 06.08.18 19:49, Matus UHLAR - fantomas wrote:
>
>> did you configure proxy manually in the browser or do you use
>> intercepting?
>>
>
> oh, sorry, now I read "reverse proxy".
> what is the http_port line?
>
> --
> Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
> Warning: I wish NOT to receive e-mail advertising to this address.
> Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
> Despite the cost of living, have you noticed how popular it remains?
> _______________________________________________
>
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180806/78220397/attachment.htm>

From srnhari at gmail.com  Tue Aug  7 04:28:17 2018
From: srnhari at gmail.com (Hariharan Sethuraman)
Date: Tue, 7 Aug 2018 09:58:17 +0530
Subject: [squid-users] Squid drops authorization header before forwarding
In-Reply-To: <CANfnjgLy5KovAeX4nk9ajZYsDBwFQKBgwdZ9m_XPpc_YGQWZ=w@mail.gmail.com>
References: <CANfnjg+WsgmR+wyVSwJs8_N5OK0rBx9R57BkyPoRriB4-FN=yw@mail.gmail.com>
 <20180806174949.GA9852@fantomas.sk> <20180806175321.GB9852@fantomas.sk>
 <CANfnjgLy5KovAeX4nk9ajZYsDBwFQKBgwdZ9m_XPpc_YGQWZ=w@mail.gmail.com>
Message-ID: <CANfnjg+Z557oxTMcSwFfuYauDR2qMRdsqqE+J-xh0CkRT+PwLQ@mail.gmail.com>

I found that login=PASS in cache_peer directive helped.

Thanks,
Hari

On Mon, Aug 6, 2018 at 11:29 PM, Hariharan Sethuraman <srnhari at gmail.com>
wrote:

> I tried allow_direct as well as defaultsite under accel.
> Wondering if I should recompile squid with enable-http-violation and use
> below ACL /
>
> request_header_access Authorization deny all
>
>
>
> On Mon, Aug 6, 2018 at 11:23 PM, Matus UHLAR - fantomas <uhlar at fantomas.sk
> > wrote:
>
>> On 06.08.18 23:14, Hariharan Sethuraman wrote:
>>>
>>>> I have my squid as reverse proxy (without any auth) between my client
>>>> and a
>>>> web server.  My HTTP request from client has an Authorization in its
>>>> HTTP
>>>> header which I wanted it to be forwarded to target server. But from
>>>> cache.log I see squid is dropping before sending it to my web server,
>>>> could
>>>> someone help on what I am missing?
>>>>
>>>
>> On 06.08.18 19:49, Matus UHLAR - fantomas wrote:
>>
>>> did you configure proxy manually in the browser or do you use
>>> intercepting?
>>>
>>
>> oh, sorry, now I read "reverse proxy".
>> what is the http_port line?
>>
>> --
>> Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
>> Warning: I wish NOT to receive e-mail advertising to this address.
>> Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
>> Despite the cost of living, have you noticed how popular it remains?
>> _______________________________________________
>>
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180807/1ca00449/attachment.htm>

From squid3 at treenet.co.nz  Tue Aug  7 06:31:39 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 7 Aug 2018 18:31:39 +1200
Subject: [squid-users] Squid drops authorization header before forwarding
In-Reply-To: <CANfnjg+Z557oxTMcSwFfuYauDR2qMRdsqqE+J-xh0CkRT+PwLQ@mail.gmail.com>
References: <CANfnjg+WsgmR+wyVSwJs8_N5OK0rBx9R57BkyPoRriB4-FN=yw@mail.gmail.com>
 <20180806174949.GA9852@fantomas.sk> <20180806175321.GB9852@fantomas.sk>
 <CANfnjgLy5KovAeX4nk9ajZYsDBwFQKBgwdZ9m_XPpc_YGQWZ=w@mail.gmail.com>
 <CANfnjg+Z557oxTMcSwFfuYauDR2qMRdsqqE+J-xh0CkRT+PwLQ@mail.gmail.com>
Message-ID: <a00c7c02-34a7-88cf-7851-e707d33fac5b@treenet.co.nz>

On 07/08/18 16:28, Hariharan Sethuraman wrote:
> I found that login=PASS in cache_peer directive helped.
> 

Indeed. cache_peer controls what Squid sends to that particular peer server.

> 
> On Mon, Aug 6, 2018 at 11:29 PM, Hariharan Sethuraman wrote:
> 
>     I tried allow_direct as well as defaultsite under accel.
>     Wondering if I should recompile squid with enable-http-violation and
>     use below ACL?/
> 
>     request_header_access Authorization deny all
> 

This tells Squid that it is forbidden from sending Authorization headers
to the origin server. If you still have it in your config after the
experiments you will need to remove.

Amos


From rightkicktech at gmail.com  Tue Aug  7 07:45:31 2018
From: rightkicktech at gmail.com (Alex K)
Date: Tue, 7 Aug 2018 10:45:31 +0300
Subject: [squid-users] Squid File descriptors warning
Message-ID: <CABMULtLN+gXEwV00+_ufKXkd+H9c-BN6WdEip=g+=3A413YrYA@mail.gmail.com>

Hi all,

I observed the following warning at squid cache logs:

WARNING! Your cache is running out of filedescriptors

Googling around I tried to increase the default file descriptors of the
system (I am runnign Debian9 x64 bit), by setting at /etc/sysctl.conf:

fs.file-max=802762

Restarted system. Still was receiving the warnings.

When checking further I observed that I have the following default limits:


ulimit -a
core file size          (blocks, -c) 0
data seg size           (kbytes, -d) unlimited
scheduling priority             (-e) 0
file size               (blocks, -f) unlimited
pending signals                 (-i) 15338
max locked memory       (kbytes, -l) 64
max memory size         (kbytes, -m) unlimited
*open files                      (-n) 1024*
pipe size            (512 bytes, -p) 8
POSIX message queues     (bytes, -q) 819200
real-time priority              (-r) 0
stack size              (kbytes, -s) 8192
cpu time               (seconds, -t) unlimited
max user processes              (-u) 15338
virtual memory          (kbytes, -v) unlimited
file locks                      (-x) unlimited


Where the "open files" seems to be the related one.

I set also the following at squid conf:

max_filedescriptors 65535

I am running a compiled version 3.5.23.

I am not sure I have done the correct steps or if I need to tweak the
ulimits also.
Any experience from your side?

Thanx,
alex
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180807/6a83bad5/attachment.htm>

From squid3 at treenet.co.nz  Tue Aug  7 08:26:27 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 7 Aug 2018 20:26:27 +1200
Subject: [squid-users] Squid File descriptors warning
In-Reply-To: <CABMULtLN+gXEwV00+_ufKXkd+H9c-BN6WdEip=g+=3A413YrYA@mail.gmail.com>
References: <CABMULtLN+gXEwV00+_ufKXkd+H9c-BN6WdEip=g+=3A413YrYA@mail.gmail.com>
Message-ID: <747ce45d-94dd-c2f3-5a70-f23aa421d2bf@treenet.co.nz>

On 07/08/18 19:45, Alex K wrote:
> Hi all,
> 
> I observed the following warning at squid cache logs:
> 
> WARNING! Your cache is running out of filedescriptors
> 
> Googling around I tried to increase the default file descriptors of the
> system (I am runnign Debian9 x64 bit), by setting at /etc/sysctl.conf:
> 
...
> 
> I am running a compiled version 3.5.23.
> 
> I am not sure I have done the correct steps or if I need to tweak the
> ulimits also.
> Any experience from your side?

The init script installed with Squid 3.x on Debian sets the limit to 64K
file descriptors.

What is Squid startup logging for file descriptors available?
 Probably in the system /var/log/messages log, if not cache.log.

Amos


From belle at bazuin.nl  Tue Aug  7 08:44:03 2018
From: belle at bazuin.nl (=?windows-1252?Q?L.P.H._van_Belle?=)
Date: Tue, 7 Aug 2018 10:44:03 +0200
Subject: [squid-users] Squid File descriptors warning
In-Reply-To: <CABMULtLN+gXEwV00+_ufKXkd+H9c-BN6WdEip=g+=3A413YrYA@mail.gmail.com>
References: <CABMULtLN+gXEwV00+_ufKXkd+H9c-BN6WdEip=g+=3A413YrYA@mail.gmail.com>
Message-ID: <vmime.5b695bd3.4c2f.380f50c5757fb583@ms249-lin-003.rotterdam.bazuin.nl>

I do know there is/was a bug the systemd isnt picking up the filedescriptors with systemd, you might have hit?it. 
Im suspecting your start script is a sysv script invoked by systemd. 
?
Try to set the limits within the start script (sysv) so the correct users ( running squid ) gets the filedescriptors.
?
I run Debian 9, with a recompiled squid from debian sid and that work fine for me atm. 
If you use the 4.1 from sid, add the following changes also. 

/etc/logrotate.d/squid 
??????? postrotate
??????????? if [ -d /run/systemd/system ] && command systemctl >/dev/null 2>&1 && systemctl is-active --quiet squid.service; then
??????????????? systemctl restart squid.service
??????????? elif [ -f /var/run/squid.pid ]; then
??????????????? test ! -e /var/run/squid.pid || test ! -x /usr/sbin/squid || /usr/sbin/squid -k rotate
??????????? fi
??????? endscript
?

Try the following and the below the command created the file /etc/systemd/system/squid.service.d/override.conf 
Add there the following. 
?
systemctl edit squid
[Unit]
After=network.target network-online.target nss-lookup.target
Wants=network-online.target
?
[Service]
LimitNOFILE=8192:65535
User=proxy
Group=proxy
?
?
Greetz, 
?
Louis
?
?

Van: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] Namens Alex K
Verzonden: dinsdag 7 augustus 2018 9:46
Aan: squid-users at lists.squid-cache.org
Onderwerp: [squid-users] Squid File descriptors warning



Hi all, 



I observed the following warning at squid cache logs: 



WARNING! Your cache is running out of filedescriptors


Googling around I tried to increase the default file descriptors of the system (I am runnign Debian9 x64 bit), by setting at /etc/sysctl.conf: 



fs.file-max=802762


Restarted system. Still was receiving the warnings. 



When checking further I observed that I have the following default limits: 





ulimit -a
core file size????????? (blocks, -c) 0
data seg size?????????? (kbytes, -d) unlimited
scheduling priority???????????? (-e) 0
file size?????????????? (blocks, -f) unlimited
pending signals???????????????? (-i) 15338
max locked memory?????? (kbytes, -l) 64
max memory size???????? (kbytes, -m) unlimited
open files????????????????????? (-n) 1024
pipe size??????????? (512 bytes, -p) 8
POSIX message queues???? (bytes, -q) 819200
real-time priority????????????? (-r) 0
stack size????????????? (kbytes, -s) 8192
cpu time?????????????? (seconds, -t) unlimited
max user processes????????????? (-u) 15338
virtual memory????????? (kbytes, -v) unlimited
file locks????????????????????? (-x) unlimited





Where the "open files" seems to be the related one. 



I set also the following at squid conf: 



max_filedescriptors 65535


I am running a compiled version 3.5.23. 



I am not sure I have done the correct steps or if I need to tweak the ulimits also.

Any experience from your side?


Thanx, 

alex




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180807/2497bd5c/attachment.htm>

From squid3 at treenet.co.nz  Tue Aug  7 09:05:03 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 7 Aug 2018 21:05:03 +1200
Subject: [squid-users] Squid File descriptors warning
In-Reply-To: <vmime.5b695bd3.4c2f.380f50c5757fb583@ms249-lin-003.rotterdam.bazuin.nl>
References: <CABMULtLN+gXEwV00+_ufKXkd+H9c-BN6WdEip=g+=3A413YrYA@mail.gmail.com>
 <vmime.5b695bd3.4c2f.380f50c5757fb583@ms249-lin-003.rotterdam.bazuin.nl>
Message-ID: <9ba808fd-cec1-65fb-fe0f-bd5e86d67732@treenet.co.nz>

On 07/08/18 20:44, L.P.H. van Belle wrote:
> I do know there is/was a bug the systemd isnt picking up the
> filedescriptors with systemd, you might have hit?it.
> Im suspecting your start script is a sysv script invoked by systemd.
> ?

squid-3.5 builds are using sysV init.d scripts.

Amos


From rightkicktech at gmail.com  Tue Aug  7 09:17:31 2018
From: rightkicktech at gmail.com (Alex K)
Date: Tue, 7 Aug 2018 12:17:31 +0300
Subject: [squid-users] Squid File descriptors warning
In-Reply-To: <747ce45d-94dd-c2f3-5a70-f23aa421d2bf@treenet.co.nz>
References: <CABMULtLN+gXEwV00+_ufKXkd+H9c-BN6WdEip=g+=3A413YrYA@mail.gmail.com>
 <747ce45d-94dd-c2f3-5a70-f23aa421d2bf@treenet.co.nz>
Message-ID: <CABMULtKi5gxVu+b83e4BszNGarOwDtzg2MygFGkiPo85OOkHfw@mail.gmail.com>

On Tue, Aug 7, 2018 at 11:26 AM, Amos Jeffries <squid3 at treenet.co.nz> wrote:

> On 07/08/18 19:45, Alex K wrote:
> > Hi all,
> >
> > I observed the following warning at squid cache logs:
> >
> > WARNING! Your cache is running out of filedescriptors
> >
> > Googling around I tried to increase the default file descriptors of the
> > system (I am runnign Debian9 x64 bit), by setting at /etc/sysctl.conf:
> >
> ...
> >
> > I am running a compiled version 3.5.23.
> >
> > I am not sure I have done the correct steps or if I need to tweak the
> > ulimits also.
> > Any experience from your side?
>
> The init script installed with Squid 3.x on Debian sets the limit to 64K
> file descriptors.


> What is Squid startup logging for file descriptors available?
>  Probably in the system /var/log/messages log, if not cache.log.
>

After having set the parameter at squid.conf I get:

With 65535 file descriptors available

Without settings it I get:

With 4096 file descriptors available

Which seems to be the value I have set at /etc/systemd/system.conf and
/etc/systemd/user.conf:

DefaultLimitNOFILE=4096

Setting such values at /etc/security/limits.conf as below, doesn't seem to
affect anything:

proxy            soft    nofile          4096
proxy            hard    nofile          1048576

Without settings any limits I get:

With 1024 file descriptors available

which seems to be reflecting the default value reported from ulimit -a.



> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180807/2edca102/attachment.htm>

From belle at bazuin.nl  Tue Aug  7 09:25:40 2018
From: belle at bazuin.nl (=?windows-1252?Q?L.P.H._van_Belle?=)
Date: Tue, 7 Aug 2018 11:25:40 +0200
Subject: [squid-users] Squid File descriptors warning
In-Reply-To: <9ba808fd-cec1-65fb-fe0f-bd5e86d67732@treenet.co.nz>
References: <vmime.5b695bd3.4c2f.380f50c5757fb583@ms249-lin-003.rotterdam.bazuin.nl>
Message-ID: <vmime.5b696594.6351.77654f0c1c289cd4@ms249-lin-003.rotterdam.bazuin.nl>

Hai Amos, 

Yes, true, but if systemd-sysv is installed, and it probley is, you might hit this bug. 
Systemd is calling the sysv script. 

I tried to find it, the bug report but ive to much things here trown at my head atm, sorry.

My production squid = 3.5.27 and no problems.  ( also rebuilded from sid at the time.)
The squid 4.1 from debian sid runs fine also. 

My best advice, checkout that 4.1 example for systemd and start using that. 


Greetz, 

Louis



> -----Oorspronkelijk bericht-----
> Van: squid-users 
> [mailto:squid-users-bounces at lists.squid-cache.org] Namens 
> Amos Jeffries
> Verzonden: dinsdag 7 augustus 2018 11:05
> Aan: squid-users at lists.squid-cache.org
> Onderwerp: Re: [squid-users] Squid File descriptors warning
> 
> On 07/08/18 20:44, L.P.H. van Belle wrote:
> > I do know there is/was a bug the systemd isnt picking up the
> > filedescriptors with systemd, you might have hit?it.
> > Im suspecting your start script is a sysv script invoked by systemd.
> > ?
> 
> squid-3.5 builds are using sysV init.d scripts.
> 
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 



From Sarfaraz.Ahmad at deshaw.com  Tue Aug  7 09:55:11 2018
From: Sarfaraz.Ahmad at deshaw.com (Ahmad, Sarfaraz)
Date: Tue, 7 Aug 2018 09:55:11 +0000
Subject: [squid-users] Squid returns NONE_ABORTED/000 and high response time
 but the internet access itself looks okay
Message-ID: <217289d6732b409c9104165913b4c2ce@mbxtoa3.winmail.deshaw.com>

Hi,

I am WCCPv2 for redirecting traffic to Squid.
Intermittently I see these messages in access.log and the internet for clients goes away.

1533612202.312  79102 <ip> NONE_ABORTED/000 0 CONNECT 198.22.156.64:443 - HIER_NONE/- -
1533612202.312  82632 <ip> NONE_ABORTED/000 0 CONNECT 173.194.142.186:443 - HIER_NONE/- -
1533612202.312  16030 <ip> NONE_ABORTED/000 0 CONNECT 172.217.15.67:443 - HIER_NONE/- -
1533612202.312  78477 <ip> NONE_ABORTED/000 0 CONNECT 173.194.142.186:443 - HIER_NONE/- -

But I can access internet on the host running squid itself just fine yet Squid reports those messages with high response times (the second column).
I gather from http://lists.squid-cache.org/pipermail/squid-users/2016-February/009295.html that HIER_NONE implies no remote server was contacted. (or could be contacted ?)

Note: I replaced internal IP addresses with <ip> tag. Please don't get confused.

We use an ICAP service. Could that play a role here ?
Any thoughts ?

Regards,
Sarfaraz
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180807/cf545084/attachment.htm>

From squid3 at treenet.co.nz  Tue Aug  7 12:34:18 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 8 Aug 2018 00:34:18 +1200
Subject: [squid-users] Squid returns NONE_ABORTED/000 and high response
 time but the internet access itself looks okay
In-Reply-To: <217289d6732b409c9104165913b4c2ce@mbxtoa3.winmail.deshaw.com>
References: <217289d6732b409c9104165913b4c2ce@mbxtoa3.winmail.deshaw.com>
Message-ID: <f6f2f9b5-bd5d-e3cc-bbea-1c304d1a877e@treenet.co.nz>

On 07/08/18 21:55, Ahmad, Sarfaraz wrote:
> Hi,
> 
> ?
> 
> I am WCCPv2 for redirecting traffic to Squid.
> 

Squid version?

> Intermittently I see these messages in access.log and the internet for
> clients goes away.
> 
> ?
> 
> 1533612202.312? 79102 <ip> NONE_ABORTED/000 0 CONNECT 198.22.156.64:443
> - HIER_NONE/- -
> 
> 1533612202.312? 82632 <ip> NONE_ABORTED/000 0 CONNECT
> 173.194.142.186:443 - HIER_NONE/- -
> 
> 1533612202.312? 16030 <ip> NONE_ABORTED/000 0 CONNECT 172.217.15.67:443
> - HIER_NONE/- -
> 
> 1533612202.312? 78477 <ip> NONE_ABORTED/000 0 CONNECT
> 173.194.142.186:443 - HIER_NONE/- -
> 
> ?
> 
> But I can access internet on the host running squid itself just fine yet
> Squid reports those messages with high response times (the second column).
> 
...> ?
> 
> We use an ICAP service. Could that play a role here ?

A lot of things *might* play a role there.

> 
> Any thoughts ?

Trace the traffic.

What did the client actually send to Squid?
  It's probably not a port-80 style CONNECT request.

What does Squid send back to the client?

Does Squid complete the TLS handshake?

What are your SSL-Bump settings?


Amos


From srnhari at gmail.com  Tue Aug  7 13:04:13 2018
From: srnhari at gmail.com (Hariharan Sethuraman)
Date: Tue, 7 Aug 2018 18:34:13 +0530
Subject: [squid-users] Reverse proxy and TUNNEL to same cache peer
Message-ID: <CANfnjgKM_5ZTppD7F=bDvtLqVvtRDmyHGFRh1DPajh9iaErL5g@mail.gmail.com>

Hi,

We have our company proxy and this is how the topology is expected to look
like for the deployment:

Client
-------------------squid-host.com---------------------------company-proxy------------Internet

Now I need to allow reverse proxy(3128) for some request from the client
and tunnel (3129) as well.

Configuration:
http_port 3128 accel allow-direct
http_port 3129
never_direct allow all
always_direct deny all
...
cache_peer company-proxy parent 80       0  no-query no-digest login=PASS
originserver
url_rewrite_access allow all
url_rewrite_program  /usr/bin/python ./rewriter_program.py

Usecases:

1) Reverse proxy: Now I can successfully get the response for the query
like curl -X GET http://squid-host.com:3128/microsoftapi/api/something.
Basically I rewrite URL to https://microsft.com/api/something and through
company-proxy I get the response successfully from e.g., microsoft.com.

2) Tunnel: It fails when the client do a query like curl -x
http://squid-host.com:3129 -X GET https://googlecloudapis.com/api/something
< HTTP/1.1 503 Service Unavailable
< Server: squid/3.5.20
< Mime-Version: 1.0
< Date: Tue, 07 Aug 2018 12:36:07 GMT
< Content-Type: text/html;charset=utf-8
< Content-Length: 3879
< X-Squid-Error: ERR_CANNOT_FORWARD 0
< Vary: Accept-Language
< Content-Language: en
<
* The requested URL returned error: 503
* CONNECT phase completed!
* Connection #0 to host squidhostname.com left intact
Now, if I remove the origin server, the TUNNEL goes through and getting the
response but the reverse proxy fails.

Could you let me know how I can handle both tunneling and reverse proxy
through same cache peer?

Thanks,
Hari
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180807/6370a4fb/attachment.htm>

From squid3 at treenet.co.nz  Tue Aug  7 14:01:11 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 8 Aug 2018 02:01:11 +1200
Subject: [squid-users] 4.1 exception PageStack.cc(106)
In-Reply-To: <676bbeb2-75a2-6624-cbf7-e7edbe4ea414@cinbesa.com.br>
References: <4c1aca29-f1f3-631f-00bb-199dc4430ef0@cinbesa.com.br>
 <c36ef8c3-6600-4d15-cad2-4983a7970c0f@treenet.co.nz>
 <6d584580-96e1-4d85-4579-068333f7f827@cinbesa.com.br>
 <5838b285-1934-aa1b-2138-ba5d806350d8@treenet.co.nz>
 <676bbeb2-75a2-6624-cbf7-e7edbe4ea414@cinbesa.com.br>
Message-ID: <74f7efa3-bb71-b98c-554d-9d8d25be4bc6@treenet.co.nz>

On 07/08/18 04:53, Heiler Bemerguy wrote:
> Em 06/08/2018 13:39, Amos Jeffries escreveu:
>>
>>> workers 5
>>> cache_mem 5500 MB
>>> cache_dir rock /cache2 130000 min-size=1 max-size=196608
>>> cache_dir rock /cache3 130000 min-size=196609 max-size=624288
>>> cache_dir rock /cache4 130000 min-size=624289 max-swap-rate=500
>>> swap-timeout=500

The number of slots these cache_dir require is 0-800 million, 800-1600
million, and 2.4+ billion. The latter is outside of the range of values
which the 32-bit slot IDs can be assigned. I think this is where your
initial exception is coming from.

You need to increase the slot sizes to be larger than the default 32KB
on at least that large caches.


>>>
>>>> And what *-bit type (eg 16, 32, 64, 128) is the machine displaying
>>>> these
>>>> errors?
>>> How can I get that?!
>> That depends on your OS.? On Linux "uname -a" provides the relevant type
>> info. I'm not sure for other OS which lack that tool.
> 
> Linux proxy 3.16.0-4-amd64 #1 SMP Debian 3.16.43-2+deb8u1 (2017-06-18)
> x86_64 GNU/Linux
> 


Amos


From Sarfaraz.Ahmad at deshaw.com  Tue Aug  7 14:14:56 2018
From: Sarfaraz.Ahmad at deshaw.com (Ahmad, Sarfaraz)
Date: Tue, 7 Aug 2018 14:14:56 +0000
Subject: [squid-users] Squid returns NONE_ABORTED/000 and high response
 time but the internet access itself looks okay
In-Reply-To: <f6f2f9b5-bd5d-e3cc-bbea-1c304d1a877e@treenet.co.nz>
References: <217289d6732b409c9104165913b4c2ce@mbxtoa3.winmail.deshaw.com>
 <f6f2f9b5-bd5d-e3cc-bbea-1c304d1a877e@treenet.co.nz>
Message-ID: <4bf524c23d684889b6ae32ea8537f095@mbxtoa3.winmail.deshaw.com>

I cannot reproduce this. This is intermittent.  In Chrome's dev tools, it appeared to take over 20 secs to setup the TCP connection.
I am SSL bumping all TLS connections unless they match certain ACLs. So it is safe to assume that the vast majority of the traffic was bumped.

I don't see any TLS handshake failure messages in cache.log. I think the access.log messages I posted earlier are fake CONNECT requests created using TCP-level info (the response time logged there is directly proportionate to what I see in Chrome's dev tools). Guessing that Squid would send TCP SYN-ACK only after it receives SYN-ACK from remote/origin server.
I don?t think ICAP(reqmod) would come into the picture yet either (assuming that even the TCP connections have not been set up yet) so that is safe to rule out. Am I right here ?

Also restarting squid service fixed this.  I had a python script running in the background that was able to GET a webpage using requests module(timeout set to 30) but Squid apparently couldn't even set up a TCP connection.

- Sarfaraz



-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Amos Jeffries
Sent: Tuesday, August 7, 2018 6:04 PM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Squid returns NONE_ABORTED/000 and high response time but the internet access itself looks okay

On 07/08/18 21:55, Ahmad, Sarfaraz wrote:
> Hi,
> 
> ?
> 
> I am WCCPv2 for redirecting traffic to Squid.
> 

Squid version?

> Intermittently I see these messages in access.log and the internet for 
> clients goes away.
> 
> ?
> 
> 1533612202.312? 79102 <ip> NONE_ABORTED/000 0 CONNECT 
> 198.22.156.64:443
> - HIER_NONE/- -
> 
> 1533612202.312? 82632 <ip> NONE_ABORTED/000 0 CONNECT
> 173.194.142.186:443 - HIER_NONE/- -
> 
> 1533612202.312? 16030 <ip> NONE_ABORTED/000 0 CONNECT 
> 172.217.15.67:443
> - HIER_NONE/- -
> 
> 1533612202.312? 78477 <ip> NONE_ABORTED/000 0 CONNECT
> 173.194.142.186:443 - HIER_NONE/- -
> 
> ?
> 
> But I can access internet on the host running squid itself just fine 
> yet Squid reports those messages with high response times (the second column).
> 
...> ?
> 
> We use an ICAP service. Could that play a role here ?

A lot of things *might* play a role there.

> 
> Any thoughts ?

Trace the traffic.

What did the client actually send to Squid?
  It's probably not a port-80 style CONNECT request.

What does Squid send back to the client?

Does Squid complete the TLS handshake?

What are your SSL-Bump settings?


Amos
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users

From jascha.sticher at tds.fujitsu.com  Tue Aug  7 14:37:16 2018
From: jascha.sticher at tds.fujitsu.com (Sticher, Jascha)
Date: Tue, 7 Aug 2018 14:37:16 +0000
Subject: [squid-users] Squid returns NONE_ABORTED/000 and high response
 time but the internet access itself looks okay
In-Reply-To: <4bf524c23d684889b6ae32ea8537f095@mbxtoa3.winmail.deshaw.com>
References: <217289d6732b409c9104165913b4c2ce@mbxtoa3.winmail.deshaw.com>
 <f6f2f9b5-bd5d-e3cc-bbea-1c304d1a877e@treenet.co.nz>
 <4bf524c23d684889b6ae32ea8537f095@mbxtoa3.winmail.deshaw.com>
Message-ID: <E286ADE35F919742812E3076A36122E701BFCD35C3@tdsnsumbx2vp>

Hi,

most times we encountered this error message it had something to do with IPv4 DNS queries being answered too slowly or not at all (as in: only AAAA-records in the reply). If this occurring with some sites only, that could be the case.

You could verify this by sniffing your DNS queries from the squid. We solved >99% of these error with the following two lines - a couple of sites needed entries in /etc/hosts, because their nameservers were broken.


> dns_timeout 10 seconds
> forward_max_tries 25


Kind regards,

Jascha Sticher


-----Urspr?ngliche Nachricht-----
Von: squid-users <squid-users-bounces at lists.squid-cache.org> Im Auftrag von Ahmad, Sarfaraz
Gesendet: Dienstag, 7. August 2018 16:15
An: Amos Jeffries <squid3 at treenet.co.nz>; squid-users at lists.squid-cache.org
Betreff: Re: [squid-users] Squid returns NONE_ABORTED/000 and high response time but the internet access itself looks okay

I cannot reproduce this. This is intermittent.  In Chrome's dev tools, it appeared to take over 20 secs to setup the TCP connection.
I am SSL bumping all TLS connections unless they match certain ACLs. So it is safe to assume that the vast majority of the traffic was bumped.

I don't see any TLS handshake failure messages in cache.log. I think the access.log messages I posted earlier are fake CONNECT requests created using TCP-level info (the response time logged there is directly proportionate to what I see in Chrome's dev tools). Guessing that Squid would send TCP SYN-ACK only after it receives SYN-ACK from remote/origin server.
I don?t think ICAP(reqmod) would come into the picture yet either (assuming that even the TCP connections have not been set up yet) so that is safe to rule out. Am I right here ?

Also restarting squid service fixed this.  I had a python script running in the background that was able to GET a webpage using requests module(timeout set to 30) but Squid apparently couldn't even set up a TCP connection.

- Sarfaraz



-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Amos Jeffries
Sent: Tuesday, August 7, 2018 6:04 PM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Squid returns NONE_ABORTED/000 and high response time but the internet access itself looks okay

On 07/08/18 21:55, Ahmad, Sarfaraz wrote:
> Hi,
> 
> ?
> 
> I am WCCPv2 for redirecting traffic to Squid.
> 

Squid version?

> Intermittently I see these messages in access.log and the internet for 
> clients goes away.
> 
> ?
> 
> 1533612202.312? 79102 <ip> NONE_ABORTED/000 0 CONNECT 
> 198.22.156.64:443
> - HIER_NONE/- -
> 
> 1533612202.312? 82632 <ip> NONE_ABORTED/000 0 CONNECT
> 173.194.142.186:443 - HIER_NONE/- -
> 
> 1533612202.312? 16030 <ip> NONE_ABORTED/000 0 CONNECT 
> 172.217.15.67:443
> - HIER_NONE/- -
> 
> 1533612202.312? 78477 <ip> NONE_ABORTED/000 0 CONNECT
> 173.194.142.186:443 - HIER_NONE/- -
> 
> ?
> 
> But I can access internet on the host running squid itself just fine 
> yet Squid reports those messages with high response times (the second column).
> 
...> ?
> 
> We use an ICAP service. Could that play a role here ?

A lot of things *might* play a role there.

> 
> Any thoughts ?

Trace the traffic.

What did the client actually send to Squid?
  It's probably not a port-80 style CONNECT request.

What does Squid send back to the client?

Does Squid complete the TLS handshake?

What are your SSL-Bump settings?


Amos
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users

From vh1988 at yahoo.com.ar  Tue Aug  7 15:20:28 2018
From: vh1988 at yahoo.com.ar (Julian Perconti)
Date: Tue, 7 Aug 2018 12:20:28 -0300
Subject: [squid-users] Delay pools in squid4 not working with https
In-Reply-To: <034101d41eb6$f6c53ef0$e44fbcd0$@ngtech.co.il>
References: <54444655-7fa0-ec9a-ea6e-505697d6bb0a@gmail.com>
 <44ca2b8a-2f8d-2e47-b902-f7589e6d5fe4@treenet.co.nz>
 <034101d41eb6$f6c53ef0$e44fbcd0$@ngtech.co.il>
Message-ID: <003d01d42e62$2f5cf180$8e16d480$@yahoo.com.ar>

Hi, 

Yesterday i have compiled squid 4.2.

When site is spliced delay_pools still does not working.

Any news?

> -----Mensaje original-----
> De: squid-users <squid-users-bounces at lists.squid-cache.org> En nombre de
> Eliezer Croitoru
> Enviado el: mi?rcoles, 18 de julio de 2018 13:47
> Para: squid-users at lists.squid-cache.org
> Asunto: Re: [squid-users] Delay pools in squid4 not working with https
> 
> Just to mention QUIC related wiki links:
> - https://wiki.squid-
> cache.org/KnowledgeBase/Block%20QUIC%20protocol?highlight=%28QUIC%
> 29
> - https://wiki.squid-
> cache.org/ConfigExamples/Intercept/CiscoIOSv15Wccp2?highlight=%28QUIC
> %29#QUIC.2FSPDY_protocol_blocking
> 
> Eliezer
> 
> ----
> Eliezer Croitoru
> Linux System Administrator
> Mobile: +972-5-28704261
> Email: eliezer at ngtech.co.il
> 
> 
> 
> -----Original Message-----
> From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On
> Behalf Of Amos Jeffries
> Sent: Wednesday, July 11, 2018 12:35 AM
> To: squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] Delay pools in squid4 not working with https
> 
> On 11/07/18 07:50, Paolo Marzari wrote:
> > My home server just updated from 3.5.27, everything is working fine,
> > but delay pools seems broken to me.
> > I capped some devices to 240kb/s and tried to download a debian ISO
> > with one of them...all good, 240kb/s.
> > Then I tried a speed test, results = 2.2mb/s, that's the whole ADSL speed.
> >
> > So I tried youtube videos, no cap at all, same problem with facebook.
> > Revert to 3.5.27 and delays works again with every type of traffic.
> >
> > I think there's something wrong with https traffic.
> >
> 
> a) is it actually HTTPS traffic?
> 
> b) are the bytes going through the proxy 2.2Mbps or 240kbps ?
> 
> I ask because Google/YouTube and Facebook are services using HTTP/2 with
> high compression features as much as possible. So while the proxy is set to
> transfer X bytes per second, when hidden inside "HTTPS" those X bytes may
> show up as 90*X bytes of traffic when decompressed by a Browser.
> 
> Or the transfer may be QUIC protocol, completely bypassing the HTTP the
> proxy is counting.
> 
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



From squid3 at treenet.co.nz  Tue Aug  7 15:33:48 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 8 Aug 2018 03:33:48 +1200
Subject: [squid-users] Squid returns NONE_ABORTED/000 and high response
 time but the internet access itself looks okay
In-Reply-To: <4bf524c23d684889b6ae32ea8537f095@mbxtoa3.winmail.deshaw.com>
References: <217289d6732b409c9104165913b4c2ce@mbxtoa3.winmail.deshaw.com>
 <f6f2f9b5-bd5d-e3cc-bbea-1c304d1a877e@treenet.co.nz>
 <4bf524c23d684889b6ae32ea8537f095@mbxtoa3.winmail.deshaw.com>
Message-ID: <6fe9615e-47e2-0e2c-89fc-30a2c5d3c7be@treenet.co.nz>

On 08/08/18 02:14, Ahmad, Sarfaraz wrote:
> I cannot reproduce this. This is intermittent.  In Chrome's dev
> tools, it appeared to take over 20 secs to setup the TCP connection. 
> I am SSL bumping all TLS connections unless they match certain ACLs.
> So it is safe to assume that the vast majority of the traffic was
> bumped.
> 
> I don't see any TLS handshake failure messages in cache.log. I think
> the access.log messages I posted earlier are fake CONNECT requests
> created using TCP-level info (the response time logged there is
> directly proportionate to what I see in Chrome's dev tools). Guessing
> that Squid would send TCP SYN-ACK only after it receives SYN-ACK from
> remote/origin server.

Your guess is wrong. The TCP level setup is only between Squid and the
client. It has to have completed before the TLS stuff can begin.

The first fake-CONNECT is done after TCP connection setup to see whether
the client is allowed to perform TLS inside it - and how Squid handles
that TLS.


> I don?t think ICAP(reqmod) would come into the
> picture yet either (assuming that even the TCP connections have not
> been set up yet) so that is safe to rule out. Am I right here ?

You are right about that in relation to TCP.

But TCP is already over and done with by the time the fake-CONNECT gets
generated. So wrong about ICAP's lack of involvement - it may (or not) be.

NP: The only thing fake about the early CONNECT's is that the client did
not actually generate it. They are handled in Squid same as a regular
CONNECT message would be.

Amos


From squid3 at treenet.co.nz  Tue Aug  7 15:37:53 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 8 Aug 2018 03:37:53 +1200
Subject: [squid-users] Reverse proxy and TUNNEL to same cache peer
In-Reply-To: <CANfnjgKM_5ZTppD7F=bDvtLqVvtRDmyHGFRh1DPajh9iaErL5g@mail.gmail.com>
References: <CANfnjgKM_5ZTppD7F=bDvtLqVvtRDmyHGFRh1DPajh9iaErL5g@mail.gmail.com>
Message-ID: <7d72b267-88d9-c69c-5a48-3c2a99d8b6dd@treenet.co.nz>

On 08/08/18 01:04, Hariharan Sethuraman wrote:
> Hi,
> 
> We have our company proxy and this is how the topology is expected to
> look like for the deployment:
> 
> Client
> -------------------squid-host.com---------------------------company-proxy------------Internet
> 
> Now I need to allow reverse proxy(3128) for some request from the client
> and tunnel (3129) as well.

This reads like you don't understand what either of those terms mean.

Your proxies port 3129 is setup for forward-proxy traffic.

"tunnel" is and action that can be done by clients. Also the term used
to describe the *payload* of a CONNECT message. The action a
forward-proxy performs when receiving a CONNECT is usually to setup a
tunnel CONNECT-ion for non-HTTP use.

Using port 3128 for reverse-proxy traffic is a very bad idea. That port
is a well-known port and also reserved for explicit / forward-proxy traffic.


> 
> Configuration:
> http_port 3128 accel allow-direct
> http_port 3129
> never_direct allow all
> always_direct deny all
> ...
> cache_peer company-proxy parent 80? ? ? ?0? no-query no-digest
> login=PASS originserver
> url_rewrite_access allow all
> url_rewrite_program? /usr/bin/python ./rewriter_program.py
> 
> Usecases:
> 
> 1) Reverse proxy: Now I can successfully get the response for the query
> like curl -X GET http://squid-host.com:3128/microsoftapi/api/something.
> Basically I rewrite URL to https://microsft.com/api/something and
> through company-proxy I get the response successfully from e.g.,
> microsoft.com <http://microsoft.com>.

Re-writing message URLs across the insecure / secure boundary is a very
bad idea. All Cookies and other things in both message headers and
payload content which are tied to either the TLS or the Origin state
will be broken.

The client thinks it is talking to an insecure server, and the server
thinks it is connected to a secure client. They also have very different
ideas about the Origin scope for stateful security things - especially
when re-writing across domains like this. That means they each believe
different range of actions are valid, and that impacts on what they
expect the other agents behaviour to be in reaction to any given message.


> 
> 2) Tunnel: It fails when the client do a query like curl -x
> http://squid-host.com:3129 -X GET https://googlecloudapis.com/api/something
> < HTTP/1.1 503 Service Unavailable
> < Server: squid/3.5.20
> < Mime-Version: 1.0
> < Date: Tue, 07 Aug 2018 12:36:07 GMT
> < Content-Type: text/html;charset=utf-8
> < Content-Length: 3879
> < X-Squid-Error: ERR_CANNOT_FORWARD 0
> < Vary: Accept-Language
> < Content-Language: en
> <
> * The requested URL returned error: 503
> * CONNECT phase completed!
> * Connection #0 to host squidhostname.com <http://squidhostname.com>
> left intact
> Now, if I remove the origin server, the TUNNEL goes through and getting
> the response but the reverse proxy fails.
> 

Please add the --verbose option to your curl test commands to see what
is actually being sent to the proxy. Then test what your re-writer is
causing to happen on those received URI.

Note that all the re-writer does is change the URI. It does not change
the method or other request details. If it produces an invalid or
unreachable URI there is nothing Squid can do but present the client
with an error.



> Could you let me know how I can handle both tunneling and reverse proxy
> through same cache peer?

Both are already supported and work without any fancy setup. I think you
are hitting something else which should become clearer when you see what
curl is actually doing.

Amos


From srnhari at gmail.com  Tue Aug  7 16:01:27 2018
From: srnhari at gmail.com (Hariharan Sethuraman)
Date: Tue, 7 Aug 2018 21:31:27 +0530
Subject: [squid-users] Reverse proxy and TUNNEL to same cache peer
In-Reply-To: <7d72b267-88d9-c69c-5a48-3c2a99d8b6dd@treenet.co.nz>
References: <CANfnjgKM_5ZTppD7F=bDvtLqVvtRDmyHGFRh1DPajh9iaErL5g@mail.gmail.com>
 <7d72b267-88d9-c69c-5a48-3c2a99d8b6dd@treenet.co.nz>
Message-ID: <CANfnjgJF7TDD3HOkNQsEJP5rHrJvkDKHubs1U1tb4z_wQzAosA@mail.gmail.com>

Thanks Amos: yes agree that I should have told forward proxy.

When I remove the originserver option from cache_peer, the forward proxy is
working so which means the rewriter is not precluding from happening. Does
that give any clue to us?

Moreover the reverse proxy is in next hop to the client and not in
internet. Time being, we are ok to have insecure channel between client and
squid. Do you have any sample config that that uses a parent proxy to do
both forward/reverse proxy? Or do you see my config is good enough for this
requirement.

On Tue, Aug 7, 2018 at 9:07 PM, Amos Jeffries <squid3 at treenet.co.nz> wrote:

> On 08/08/18 01:04, Hariharan Sethuraman wrote:
> > Hi,
> >
> > We have our company proxy and this is how the topology is expected to
> > look like for the deployment:
> >
> > Client
> > -------------------squid-host.com---------------------------
> company-proxy------------Internet
> >
> > Now I need to allow reverse proxy(3128) for some request from the client
> > and tunnel (3129) as well.
>
> This reads like you don't understand what either of those terms mean.
>
> Your proxies port 3129 is setup for forward-proxy traffic.
>
> "tunnel" is and action that can be done by clients. Also the term used
> to describe the *payload* of a CONNECT message. The action a
> forward-proxy performs when receiving a CONNECT is usually to setup a
> tunnel CONNECT-ion for non-HTTP use.
>
> Using port 3128 for reverse-proxy traffic is a very bad idea. That port
> is a well-known port and also reserved for explicit / forward-proxy
> traffic.
>
>
> >
> > Configuration:
> > http_port 3128 accel allow-direct
> > http_port 3129
> > never_direct allow all
> > always_direct deny all
> > ...
> > cache_peer company-proxy parent 80       0  no-query no-digest
> > login=PASS originserver
> > url_rewrite_access allow all
> > url_rewrite_program  /usr/bin/python ./rewriter_program.py
> >
> > Usecases:
> >
> > 1) Reverse proxy: Now I can successfully get the response for the query
> > like curl -X GET http://squid-host.com:3128/microsoftapi/api/something.
> > Basically I rewrite URL to https://microsft.com/api/something and
> > through company-proxy I get the response successfully from e.g.,
> > microsoft.com <http://microsoft.com>.
>
> Re-writing message URLs across the insecure / secure boundary is a very
> bad idea. All Cookies and other things in both message headers and
> payload content which are tied to either the TLS or the Origin state
> will be broken.
>
> The client thinks it is talking to an insecure server, and the server
> thinks it is connected to a secure client. They also have very different
> ideas about the Origin scope for stateful security things - especially
> when re-writing across domains like this. That means they each believe
> different range of actions are valid, and that impacts on what they
> expect the other agents behaviour to be in reaction to any given message.
>
>
> >
> > 2) Tunnel: It fails when the client do a query like curl -x
> > http://squid-host.com:3129 -X GET https://googlecloudapis.com/
> api/something
> > < HTTP/1.1 503 Service Unavailable
> > < Server: squid/3.5.20
> > < Mime-Version: 1.0
> > < Date: Tue, 07 Aug 2018 12:36:07 GMT
> > < Content-Type: text/html;charset=utf-8
> > < Content-Length: 3879
> > < X-Squid-Error: ERR_CANNOT_FORWARD 0
> > < Vary: Accept-Language
> > < Content-Language: en
> > <
> > * The requested URL returned error: 503
> > * CONNECT phase completed!
> > * Connection #0 to host squidhostname.com <http://squidhostname.com>
> > left intact
> > Now, if I remove the origin server, the TUNNEL goes through and getting
> > the response but the reverse proxy fails.
> >
>
> Please add the --verbose option to your curl test commands to see what
> is actually being sent to the proxy. Then test what your re-writer is
> causing to happen on those received URI.
>
> Note that all the re-writer does is change the URI. It does not change
> the method or other request details. If it produces an invalid or
> unreachable URI there is nothing Squid can do but present the client
> with an error.
>
>
>
> > Could you let me know how I can handle both tunneling and reverse proxy
> > through same cache peer?
>
> Both are already supported and work without any fancy setup. I think you
> are hitting something else which should become clearer when you see what
> curl is actually doing.
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180807/3dcb3850/attachment.htm>

From rousskov at measurement-factory.com  Tue Aug  7 16:17:31 2018
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Tue, 7 Aug 2018 10:17:31 -0600
Subject: [squid-users] Delay pools in squid4 not working with https
In-Reply-To: <003d01d42e62$2f5cf180$8e16d480$@yahoo.com.ar>
References: <54444655-7fa0-ec9a-ea6e-505697d6bb0a@gmail.com>
 <44ca2b8a-2f8d-2e47-b902-f7589e6d5fe4@treenet.co.nz>
 <034101d41eb6$f6c53ef0$e44fbcd0$@ngtech.co.il>
 <003d01d42e62$2f5cf180$8e16d480$@yahoo.com.ar>
Message-ID: <f4181b1d-8980-ea02-bd98-d1380087527d@measurement-factory.com>

On 08/07/2018 09:20 AM, Julian Perconti wrote:

> Yesterday i have compiled squid 4.2.
> 
> When site is spliced delay_pools still does not working.
> 
> Any news?

The latest information and suggestions I have is at
http://lists.squid-cache.org/pipermail/squid-users/2018-July/018636.html

Alex.


>> -----Mensaje original-----
>> De: squid-users <squid-users-bounces at lists.squid-cache.org> En nombre de
>> Eliezer Croitoru
>> Enviado el: mi?rcoles, 18 de julio de 2018 13:47
>> Para: squid-users at lists.squid-cache.org
>> Asunto: Re: [squid-users] Delay pools in squid4 not working with https
>>
>> Just to mention QUIC related wiki links:
>> - https://wiki.squid-
>> cache.org/KnowledgeBase/Block%20QUIC%20protocol?highlight=%28QUIC%
>> 29
>> - https://wiki.squid-
>> cache.org/ConfigExamples/Intercept/CiscoIOSv15Wccp2?highlight=%28QUIC
>> %29#QUIC.2FSPDY_protocol_blocking
>>
>> Eliezer
>>
>> ----
>> Eliezer Croitoru
>> Linux System Administrator
>> Mobile: +972-5-28704261
>> Email: eliezer at ngtech.co.il
>>
>>
>>
>> -----Original Message-----
>> From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On
>> Behalf Of Amos Jeffries
>> Sent: Wednesday, July 11, 2018 12:35 AM
>> To: squid-users at lists.squid-cache.org
>> Subject: Re: [squid-users] Delay pools in squid4 not working with https
>>
>> On 11/07/18 07:50, Paolo Marzari wrote:
>>> My home server just updated from 3.5.27, everything is working fine,
>>> but delay pools seems broken to me.
>>> I capped some devices to 240kb/s and tried to download a debian ISO
>>> with one of them...all good, 240kb/s.
>>> Then I tried a speed test, results = 2.2mb/s, that's the whole ADSL speed.
>>>
>>> So I tried youtube videos, no cap at all, same problem with facebook.
>>> Revert to 3.5.27 and delays works again with every type of traffic.
>>>
>>> I think there's something wrong with https traffic.
>>>
>>
>> a) is it actually HTTPS traffic?
>>
>> b) are the bytes going through the proxy 2.2Mbps or 240kbps ?
>>
>> I ask because Google/YouTube and Facebook are services using HTTP/2 with
>> high compression features as much as possible. So while the proxy is set to
>> transfer X bytes per second, when hidden inside "HTTPS" those X bytes may
>> show up as 90*X bytes of traffic when decompressed by a Browser.
>>
>> Or the transfer may be QUIC protocol, completely bypassing the HTTP the
>> proxy is counting.
>>
>> Amos
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
>>
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 



From squid3 at treenet.co.nz  Tue Aug  7 16:30:06 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 8 Aug 2018 04:30:06 +1200
Subject: [squid-users] Reverse proxy and TUNNEL to same cache peer
In-Reply-To: <CANfnjgJF7TDD3HOkNQsEJP5rHrJvkDKHubs1U1tb4z_wQzAosA@mail.gmail.com>
References: <CANfnjgKM_5ZTppD7F=bDvtLqVvtRDmyHGFRh1DPajh9iaErL5g@mail.gmail.com>
 <7d72b267-88d9-c69c-5a48-3c2a99d8b6dd@treenet.co.nz>
 <CANfnjgJF7TDD3HOkNQsEJP5rHrJvkDKHubs1U1tb4z_wQzAosA@mail.gmail.com>
Message-ID: <5e34a4bd-7a61-c965-7d22-bfc6a6c49377@treenet.co.nz>

On 08/08/18 04:01, Hariharan Sethuraman wrote:
> Thanks Amos: yes agree that I should have told forward proxy.
> 
> When I remove the originserver option from cache_peer, the forward proxy
> is working so which means the rewriter is not precluding from happening.
> Does that give any clue to us??
> 

Ah, cant believe I missed that. If the parent proxy is your access to
the Internet then is *not* a reverse-proxy. It cannot be and receive
proxy<->proxy traffic.

Any attempt to change the scheme is erased because the scheme is not
part of origin-form message syntax.


> Moreover the reverse proxy is in next hop to the client and not in
> internet. Time being, we are ok to have insecure channel between client
> and squid. Do you have any sample config that that uses a parent proxy
> to do both forward/reverse proxy? Or do you see my config is good enough
> for this requirement.
> 

The traffic types have different syntax. It is possible to have a parent
proxy which receives both, but that has to be different ports and
different cache_peer links between them.

Amos


From rousskov at measurement-factory.com  Tue Aug  7 16:30:30 2018
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Tue, 7 Aug 2018 10:30:30 -0600
Subject: [squid-users] 4.1 exception PageStack.cc(106)
In-Reply-To: <74f7efa3-bb71-b98c-554d-9d8d25be4bc6@treenet.co.nz>
References: <4c1aca29-f1f3-631f-00bb-199dc4430ef0@cinbesa.com.br>
 <c36ef8c3-6600-4d15-cad2-4983a7970c0f@treenet.co.nz>
 <6d584580-96e1-4d85-4579-068333f7f827@cinbesa.com.br>
 <5838b285-1934-aa1b-2138-ba5d806350d8@treenet.co.nz>
 <676bbeb2-75a2-6624-cbf7-e7edbe4ea414@cinbesa.com.br>
 <74f7efa3-bb71-b98c-554d-9d8d25be4bc6@treenet.co.nz>
Message-ID: <443fd26f-ebf1-0930-67ad-3a02e57aca83@measurement-factory.com>

On 08/07/2018 08:01 AM, Amos Jeffries wrote:
> On 07/08/18 04:53, Heiler Bemerguy wrote:
>> Em 06/08/2018 13:39, Amos Jeffries escreveu:
>>>> cache_mem 5500 MB
>>>> cache_dir rock /cache2 130000 min-size=1 max-size=196608
>>>> cache_dir rock /cache3 130000 min-size=196609 max-size=624288
>>>> cache_dir rock /cache4 130000 min-size=624289 max-swap-rate=500
>>>> swap-timeout=500


> The number of slots these cache_dir require is 0-800 million, 800-1600
> million, and 2.4+ billion.


What makes you think that? AFAICT, all three cache_dirs have the same
130'000 MB size and, hence, each requires 8'320'000 default 16KB slots:

    130000 * 1024 / 16 = 8320000

Alex.


From rightkicktech at gmail.com  Tue Aug  7 16:56:49 2018
From: rightkicktech at gmail.com (Alex K)
Date: Tue, 7 Aug 2018 19:56:49 +0300
Subject: [squid-users] Squid and ICMP
Message-ID: <CABMULtJTYcEbteCbk7t2eZCr-WrmWVX-KgYpUUZnfrV7AeBpwA@mail.gmail.com>

Hi all,

I have a box with fairly restrictive firewall.
I see that the box blocks connections of squid to the requested sites when
squid tries to reach/send ICMP to them:

2018/08/07 16:51:57| Error sending to ICMP packet to 213.133.127.247. ERR:
(1) Operation not permitted
2018/08/07 16:51:59| Error sending to ICMP packet to 194.55.30.166. ERR:
(1) Operation not permitted
2018/08/07 16:52:00| Error sending to ICMP packet to 93.184.220.29. ERR:
(1) Operation not permitted
2018/08/07 16:52:00| Error sending to ICMP packet to 72.21.202.25. ERR: (1)
Operation not permitted
2018/08/07 16:52:02| Error sending to ICMP packet to 54.182.206.90. ERR:
(1) Operation not permitted
2018/08/07 16:52:18| Error sending to ICMP packet to 54.239.220.40. ERR:
(1) Operation not permitted
2018/08/07 16:52:18| Error sending to ICMP packet to 62.38.6.83. ERR: (1)
Operation not permitted
2018/08/07 16:52:20| Error sending to ICMP packet to 13.32.16.243. ERR: (1)
Operation not permitted

Anyone knows why squid is sending ICMP? Is this needed?
I am running 3.5.23 in tproxy mode with SSL splicing.


Thanx,
Alex
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180807/c278f3de/attachment.htm>

From alex at dvm.esines.cu  Tue Aug  7 16:59:19 2018
From: alex at dvm.esines.cu (=?UTF-8?Q?Alex_Guti=c3=a9rrez_Mart=c3=adnez?=)
Date: Tue, 7 Aug 2018 12:59:19 -0400
Subject: [squid-users] ntml auth
Message-ID: <a78f3fe0-7637-c377-ede2-d8bca9a030e3@dvm.esines.cu>

#Hello community, I am trying to connect my squid to my AD using ntml (i 
can't use Kerberos). The problem is that I have not found a way to make 
the groups I have in the AD look in the squid.

#this is my current config using ldap using basic auth

auth_param basic program / usr / lib / squid / basic_ldap_auth -P -R -b 
"dc = mi, dc = company, dc = cu" -D cn = proxy, ou = ST, dc = mi, dc = 
company, dc = cu -W /etc/squid/ldap.txt -f sAMAccountName =% s -v 3 -s 
sub -h 192.168.1.10
external_acl_type Group% LOGIN / usr / lib / squid / ext_ldap_group_acl 
-R -b "dc = mi, dc = company, dc = cu" -D cn = proxy, ou = ST, dc = mi, 
dc = company, dc = cu -W /etc/squid/ldap.txt -f "(& (objectclass = user) 
(sAMAccountName =% u) (memberof = cn =% g, dc = mi, dc = company, dc = 
cu))" -h 192.168.1.10
auth_param basic children 10
auth_param basic realm apolo.mi.empresa.cu
auth_param basic credentialsttl 2 hour
acl basic_ldap_auth proxy_auth REQUIRED
http_access deny! basic_ldap_auth

#from here i get 2 group
#
#i1 and i2
###########################
acl i1 external Group Internet1
acl i2 external Group Internet2

#################################################################################################### 
#####

#my configuration for ntml is

auth_param ntlm program / usr / bin / ntlm_auth --diagnostics 
--helper-protocol = squid-2.5-ntlmssp --domain = my.company.cu
auth_param ntlm children 10
auth_param ntlm keep_alive off
auth_param ntlm credentialsttl 2 hour


#What I want is to know how to use the groups that are in my active 
directory, specifically Internet1 and Internet2.

#Every time I run "squid -k parse" it shows me an error in the line 
where I define the external groups.

#I am running version 3.5.27

-- 
Saludos Cordiales

Lic. Alex Guti?rrez Mart?nez

Tel. +53 7 2710327

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180807/f2bc0c80/attachment.htm>

From squid3 at treenet.co.nz  Tue Aug  7 17:04:41 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 8 Aug 2018 05:04:41 +1200
Subject: [squid-users] 4.1 exception PageStack.cc(106)
In-Reply-To: <443fd26f-ebf1-0930-67ad-3a02e57aca83@measurement-factory.com>
References: <4c1aca29-f1f3-631f-00bb-199dc4430ef0@cinbesa.com.br>
 <c36ef8c3-6600-4d15-cad2-4983a7970c0f@treenet.co.nz>
 <6d584580-96e1-4d85-4579-068333f7f827@cinbesa.com.br>
 <5838b285-1934-aa1b-2138-ba5d806350d8@treenet.co.nz>
 <676bbeb2-75a2-6624-cbf7-e7edbe4ea414@cinbesa.com.br>
 <74f7efa3-bb71-b98c-554d-9d8d25be4bc6@treenet.co.nz>
 <443fd26f-ebf1-0930-67ad-3a02e57aca83@measurement-factory.com>
Message-ID: <38734e9c-0673-7292-d77b-2919ccaa92b8@treenet.co.nz>

On 08/08/18 04:30, Alex Rousskov wrote:
> On 08/07/2018 08:01 AM, Amos Jeffries wrote:
>> On 07/08/18 04:53, Heiler Bemerguy wrote:
>>> Em 06/08/2018 13:39, Amos Jeffries escreveu:
>>>>> cache_mem 5500 MB
>>>>> cache_dir rock /cache2 130000 min-size=1 max-size=196608
>>>>> cache_dir rock /cache3 130000 min-size=196609 max-size=624288
>>>>> cache_dir rock /cache4 130000 min-size=624289 max-swap-rate=500
>>>>> swap-timeout=500
> 
> 
>> The number of slots these cache_dir require is 0-800 million, 800-1600
>> million, and 2.4+ billion.
> 
> 
> What makes you think that? AFAICT, all three cache_dirs have the same
> 130'000 MB size and, hence, each requires 8'320'000 default 16KB slots:
> 
>     130000 * 1024 / 16 = 8320000
> 


I was working from the number slots needed to store the files Squid is
going to try to put in there (the 2^27 sfileno).

You are right, its the other way around.

Do you have any idea then why the cunt of used slots should be over 2^32
? the exception being encountered is thrown when used slot count (an
int) exceeds the value of largest available slot index (an uint32_t).

Amos


From Sarfaraz.Ahmad at deshaw.com  Tue Aug  7 17:15:11 2018
From: Sarfaraz.Ahmad at deshaw.com (Ahmad, Sarfaraz)
Date: Tue, 7 Aug 2018 17:15:11 +0000
Subject: [squid-users] Squid returns NONE_ABORTED/000 and high response
 time but the internet access itself looks okay
In-Reply-To: <6fe9615e-47e2-0e2c-89fc-30a2c5d3c7be@treenet.co.nz>
References: <217289d6732b409c9104165913b4c2ce@mbxtoa3.winmail.deshaw.com>
 <f6f2f9b5-bd5d-e3cc-bbea-1c304d1a877e@treenet.co.nz>
 <4bf524c23d684889b6ae32ea8537f095@mbxtoa3.winmail.deshaw.com>
 <6fe9615e-47e2-0e2c-89fc-30a2c5d3c7be@treenet.co.nz>
Message-ID: <40618ba7d1664af89f12fa1b73f59132@mbxtoa3.winmail.deshaw.com>

>> Your guess is wrong. The TCP level setup is only between Squid and the client. It has to have completed before the TLS stuff can begin.
So when does Squid start setting up the TCP connection with the origin server ? After setting up a TCP connection with client and identifying it to be TLS ? 

What would this log message likely mean then ? I was reading that as 78477ms was the time it took for Squid to connect to 173.194.142.186 on port 443 and Squid and client(not the origin server) had already established a TCP connection beforehand (while it(squid) tries connecting to the remote server on port 443).
1533612202.312  78477 <ip> NONE_ABORTED/000 0 CONNECT 173.194.142.186:443 - HIER_NONE/- -

That would imply two things.
1) It took a lot of time for clients to set up a TCP connection with Squid given Chrome's dev tools 
2) Second, Squid took a while to establish a connection with origin server. 

Moreover, my ICAP settings look like this,
icap_service localicap reqmod_precache icap://127.0.0.1:1345/reqmod bypass=on routing=off on-overload=wait

ICAP would come into the picture only after I see a GET request in the access.log, right? 

Regards,
Sarfaraz

-----Original Message-----
From: Amos Jeffries <squid3 at treenet.co.nz> 
Sent: Tuesday, August 7, 2018 9:04 PM
To: Ahmad, Sarfaraz <Sarfaraz.Ahmad at deshaw.com>; squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Squid returns NONE_ABORTED/000 and high response time but the internet access itself looks okay

On 08/08/18 02:14, Ahmad, Sarfaraz wrote:
> I cannot reproduce this. This is intermittent.  In Chrome's dev tools, 
> it appeared to take over 20 secs to setup the TCP connection.
> I am SSL bumping all TLS connections unless they match certain ACLs.
> So it is safe to assume that the vast majority of the traffic was 
> bumped.
> 
> I don't see any TLS handshake failure messages in cache.log. I think 
> the access.log messages I posted earlier are fake CONNECT requests 
> created using TCP-level info (the response time logged there is 
> directly proportionate to what I see in Chrome's dev tools). Guessing 
> that Squid would send TCP SYN-ACK only after it receives SYN-ACK from 
> remote/origin server.

Your guess is wrong. The TCP level setup is only between Squid and the client. It has to have completed before the TLS stuff can begin.

The first fake-CONNECT is done after TCP connection setup to see whether the client is allowed to perform TLS inside it - and how Squid handles that TLS.


> I don?t think ICAP(reqmod) would come into the picture yet either 
> (assuming that even the TCP connections have not been set up yet) so 
> that is safe to rule out. Am I right here ?

You are right about that in relation to TCP.

But TCP is already over and done with by the time the fake-CONNECT gets generated. So wrong about ICAP's lack of involvement - it may (or not) be.

NP: The only thing fake about the early CONNECT's is that the client did not actually generate it. They are handled in Squid same as a regular CONNECT message would be.

Amos

From squid3 at treenet.co.nz  Tue Aug  7 17:43:36 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 8 Aug 2018 05:43:36 +1200
Subject: [squid-users] Squid returns NONE_ABORTED/000 and high response
 time but the internet access itself looks okay
In-Reply-To: <40618ba7d1664af89f12fa1b73f59132@mbxtoa3.winmail.deshaw.com>
References: <217289d6732b409c9104165913b4c2ce@mbxtoa3.winmail.deshaw.com>
 <f6f2f9b5-bd5d-e3cc-bbea-1c304d1a877e@treenet.co.nz>
 <4bf524c23d684889b6ae32ea8537f095@mbxtoa3.winmail.deshaw.com>
 <6fe9615e-47e2-0e2c-89fc-30a2c5d3c7be@treenet.co.nz>
 <40618ba7d1664af89f12fa1b73f59132@mbxtoa3.winmail.deshaw.com>
Message-ID: <1fcb5a95-1a1d-c67c-30ce-571a4613aac7@treenet.co.nz>

On 08/08/18 05:15, Ahmad, Sarfaraz wrote:
>>> Your guess is wrong. The TCP level setup is only between Squid and the client. It has to have completed before the TLS stuff can begin.
> So when does Squid start setting up the TCP connection with the origin server ? After setting up a TCP connection with client and identifying it to be TLS ?

As late as it can be done. How late that is depends on your SSL-Bump
setup, any ICAP or other changes being made to the fake-CONNECT request,
maybe even your cache contents.

Anyhow, there is no sign of a server connection existing. So whatever is
happening is one of the early parts of TLS handshake.


> 
> What would this log message likely mean then ? I was reading that as 78477ms was the time it took for Squid to connect to 173.194.142.186 on port 443 and Squid and client(not the origin server) had already established a TCP connection beforehand (while it(squid) tries connecting to the remote server on port 443).
> 1533612202.312  78477 <ip> NONE_ABORTED/000 0 CONNECT 173.194.142.186:443 - HIER_NONE/- -
> 

The client "<ip>" opened a TCP connection to 173.194.142.186:443 - which
was intercepted and delivered to this Squid. The client disconnected
after 78 seconds.
 That is all that can be known about what did happen from this log entry.

The list of things which did not (or could not have) happen is longer:

No server connection was made.
No bytes delivered to the client.
 and a lot of other things cannot have happened.


> That would imply two things.
> 1) It took a lot of time for clients to set up a TCP connection with Squid given Chrome's dev tools

The client->Squid TCP setup seems to be completed. Either Squid is
waiting for TLS handshake from the client to arrive, or something is
hung in the processing of the clientHello stages.

NP: the 0-bytes number in the log is how much Squid delivered to the
client. There may be some bytes the client delivered to Squid which are
not accounted.



> 2) Second, Squid took a while to establish a connection with origin server.

I don't think Squid got that far. There is no server IP following the
"HEIR_NONE/". The "-" part specifically says there is no known server IP.

We know that the server IP:port should be 173.194.142.186:443 because
those are the details on the CONNECT message URI. Squid has not gone far
enough into the processing of that message to identify that detail.


> 
> Moreover, my ICAP settings look like this,
> icap_service localicap reqmod_precache icap://127.0.0.1:1345/reqmod bypass=on routing=off on-overload=wait
> 
> ICAP would come into the picture only after I see a GET request in the access.log, right?

ICAP should be passed any HTTP request. Since Squid is handling the
CONNECT message the ICAP should be invoked for them as well. I don't
recall of it actually is or not.

Also, note that at no point have I confirmed that is is ICAP being the
problem (nor ruled it out). You are the one focusing on that
possibility. There are other possibilities such as SSL-Bump issues,
http_access delays and the like. Even client_delay_pool's may be the
problem.


Amos


From heiler.bemerguy at cinbesa.com.br  Tue Aug  7 17:49:15 2018
From: heiler.bemerguy at cinbesa.com.br (Heiler Bemerguy)
Date: Tue, 7 Aug 2018 14:49:15 -0300
Subject: [squid-users] 4.1 exception PageStack.cc(106)
In-Reply-To: <74f7efa3-bb71-b98c-554d-9d8d25be4bc6@treenet.co.nz>
References: <4c1aca29-f1f3-631f-00bb-199dc4430ef0@cinbesa.com.br>
 <c36ef8c3-6600-4d15-cad2-4983a7970c0f@treenet.co.nz>
 <6d584580-96e1-4d85-4579-068333f7f827@cinbesa.com.br>
 <5838b285-1934-aa1b-2138-ba5d806350d8@treenet.co.nz>
 <676bbeb2-75a2-6624-cbf7-e7edbe4ea414@cinbesa.com.br>
 <74f7efa3-bb71-b98c-554d-9d8d25be4bc6@treenet.co.nz>
Message-ID: <492a916a-a5ae-73d1-c066-b1160af9df66@cinbesa.com.br>

Em 07/08/2018 11:01, Amos Jeffries escreveu:
> On 07/08/18 04:53, Heiler Bemerguy wrote:
>> Em 06/08/2018 13:39, Amos Jeffries escreveu:
>>>> workers 5
>>>> cache_mem 5500 MB
>>>> cache_dir rock /cache2 130000 min-size=1 max-size=196608
>>>> cache_dir rock /cache3 130000 min-size=196609 max-size=624288
>>>> cache_dir rock /cache4 130000 min-size=624289 max-swap-rate=500
>>>> swap-timeout=500
> The number of slots these cache_dir require is 0-800 million, 800-1600
> million, and 2.4+ billion. The latter is outside of the range of values
> which the 32-bit slot IDs can be assigned. I think this is where your
> initial exception is coming from.
>
> You need to increase the slot sizes to be larger than the default 32KB
> on at least that large caches.
>
>

This was changed from 3.5.27 ?? It used to work flawlessy just before 
the upgrade to 4.1. (now 4.2). And shouldn't this crash only the disker, 
not the worker?

Thanks


-- 
Atenciosamente,

Heiler Bensimon Bemerguy - CINBESA
Analista de Redes, Wi-Fi,
Virtualiza??o e Servi?os Internet
(55) 91 98151-4894



From rousskov at measurement-factory.com  Tue Aug  7 17:55:36 2018
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Tue, 7 Aug 2018 11:55:36 -0600
Subject: [squid-users] 4.1 exception PageStack.cc(106)
In-Reply-To: <38734e9c-0673-7292-d77b-2919ccaa92b8@treenet.co.nz>
References: <4c1aca29-f1f3-631f-00bb-199dc4430ef0@cinbesa.com.br>
 <c36ef8c3-6600-4d15-cad2-4983a7970c0f@treenet.co.nz>
 <6d584580-96e1-4d85-4579-068333f7f827@cinbesa.com.br>
 <5838b285-1934-aa1b-2138-ba5d806350d8@treenet.co.nz>
 <676bbeb2-75a2-6624-cbf7-e7edbe4ea414@cinbesa.com.br>
 <74f7efa3-bb71-b98c-554d-9d8d25be4bc6@treenet.co.nz>
 <443fd26f-ebf1-0930-67ad-3a02e57aca83@measurement-factory.com>
 <38734e9c-0673-7292-d77b-2919ccaa92b8@treenet.co.nz>
Message-ID: <e9a0dcd9-07f1-cac3-0d76-3d679c54a4cb@measurement-factory.com>

On 08/07/2018 11:04 AM, Amos Jeffries wrote:

> Do you have any idea then why the cunt of used slots should be over
> 2^32?

I suspect this is a Squid bug. We have seen the same symptoms while
working on not-directly-related bug 4823. I do not know whether OP
suffers from the same underlying problem. Unfortunately, I do not
remember the exact explanation for the bug we saw.

FWIW, there is a work-in-progress Factory PR that may eventually fix
this bug as a side effect of other upcoming Rock improvements[1]. That
PR, including its description, is not ready for the official review, and
may change a lot until it is ready.

Alex.
[1] https://github.com/measurement-factory/squid/pull/10


From harariboy at gmail.com  Tue Aug  7 17:57:02 2018
From: harariboy at gmail.com (avi_h)
Date: Tue, 7 Aug 2018 12:57:02 -0500 (CDT)
Subject: [squid-users] want to ask about DNS resolution in firefox as an
	example
In-Reply-To: <201808061339.12479.Antony.Stone@squid.open.source.it>
References: <A75C6C35-F6FC-4D29-9D25-1504628D487C@netstream.ps>
 <201808061324.38986.Antony.Stone@squid.open.source.it>
 <F63C5559-822B-4FA5-B677-A317BAC9F38F@netstream.ps>
 <201808061339.12479.Antony.Stone@squid.open.source.it>
Message-ID: <1533664622401-0.post@n4.nabble.com>

You probably also want to check for WebRTC leak: 
https://www.expressvpn.com/webrtc-leak-test
<https://www.expressvpn.com/webrtc-leak-test>  



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From squid3 at treenet.co.nz  Tue Aug  7 18:05:19 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 8 Aug 2018 06:05:19 +1200
Subject: [squid-users] ntml auth
In-Reply-To: <a78f3fe0-7637-c377-ede2-d8bca9a030e3@dvm.esines.cu>
References: <a78f3fe0-7637-c377-ede2-d8bca9a030e3@dvm.esines.cu>
Message-ID: <c0b5adb4-fb2b-671f-a625-ade80d998131@treenet.co.nz>

On 08/08/18 04:59, Alex Guti?rrez Mart?nez wrote:
> #Hello community, I am trying to connect my squid to my AD using ntml (i
> can't use Kerberos).

Why not?


> The problem is that I have not found a way to make
> the groups I have in the AD look in the squid.
> 
> #this is my current config using ldap using basic auth
> 
> auth_param basic program / usr / lib / squid / basic_ldap_auth -P -R -b
> "dc = mi, dc = company, dc = cu" -D cn = proxy, ou = ST, dc = mi, dc =
> company, dc = cu -W /etc/squid/ldap.txt -f sAMAccountName =% s -v 3 -s
> sub -h 192.168.1.10
> external_acl_type Group% LOGIN / usr / lib / squid / ext_ldap_group_acl
> -R -b "dc = mi, dc = company, dc = cu" -D cn = proxy, ou = ST, dc = mi,
> dc = company, dc = cu -W /etc/squid/ldap.txt -f "(& (objectclass = user)
> (sAMAccountName =% u) (memberof = cn =% g, dc = mi, dc = company, dc =
> cu))" -h 192.168.1.10

NP: I hope all those spaces inside the paths and helper parameters are
an artifact from your emailer. If they exist in your config file that
could be causing problems.


> auth_param basic children 10
> auth_param basic realm apolo.mi.empresa.cu
> auth_param basic credentialsttl 2 hour
> acl basic_ldap_auth proxy_auth REQUIRED
> http_access deny! basic_ldap_auth
> 
> #from here i get 2 group
> #
> #i1 and i2
> ###########################
> acl i1 external Group Internet1
> acl i2 external Group Internet2
> 
> ####################################################################################################
> #####
> 
> #my configuration for ntml is
> 
> auth_param ntlm program / usr / bin / ntlm_auth --diagnostics
> --helper-protocol = squid-2.5-ntlmssp --domain = my.company.cu
> auth_param ntlm children 10
> auth_param ntlm keep_alive off
> auth_param ntlm credentialsttl 2 hour


"credentialsttl" is not a valid configuration setting for NTLM. All NTLM
credentials are valid for exactly and only the length the TCP connection
using them is alive.

Every new TCP connection needs its own credentials and 3-message
authentication handshake to set those up. This is part of why NTLM has
such horribly bad performance and why the default recommended config has
"keep_alive on".


> 
> 
> #What I want is to know how to use the groups that are in my active
> directory, specifically Internet1 and Internet2.
> 

You need some policy for what each group is allowed (or not allowed) to
do with the proxy. We cannot make that kind of decision for you, only
help you configure your policy to be enforced correctly.

If you don't already have any such policy then there is no point even
looking up the groups.



> #Every time I run "squid -k parse" it shows me an error in the line
> where I define the external groups.

You have a line defining a helper to lookup group names in LDAP, and two
lines defining ACL checks to test some group names.

 Which of those do you have an error with?

 and what is this error you mention?


Amos


From heiler.bemerguy at cinbesa.com.br  Tue Aug  7 18:17:15 2018
From: heiler.bemerguy at cinbesa.com.br (Heiler Bemerguy)
Date: Tue, 7 Aug 2018 15:17:15 -0300
Subject: [squid-users] 4.1 exception PageStack.cc(106)
In-Reply-To: <e9a0dcd9-07f1-cac3-0d76-3d679c54a4cb@measurement-factory.com>
References: <4c1aca29-f1f3-631f-00bb-199dc4430ef0@cinbesa.com.br>
 <c36ef8c3-6600-4d15-cad2-4983a7970c0f@treenet.co.nz>
 <6d584580-96e1-4d85-4579-068333f7f827@cinbesa.com.br>
 <5838b285-1934-aa1b-2138-ba5d806350d8@treenet.co.nz>
 <676bbeb2-75a2-6624-cbf7-e7edbe4ea414@cinbesa.com.br>
 <74f7efa3-bb71-b98c-554d-9d8d25be4bc6@treenet.co.nz>
 <443fd26f-ebf1-0930-67ad-3a02e57aca83@measurement-factory.com>
 <38734e9c-0673-7292-d77b-2919ccaa92b8@treenet.co.nz>
 <e9a0dcd9-07f1-cac3-0d76-3d679c54a4cb@measurement-factory.com>
Message-ID: <426ceeb5-a6f1-50c7-5017-553dc09be19b@cinbesa.com.br>

An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180807/b3da0e3f/attachment.htm>

From squid3 at treenet.co.nz  Tue Aug  7 18:20:39 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 8 Aug 2018 06:20:39 +1200
Subject: [squid-users] Squid and ICMP
In-Reply-To: <CABMULtJTYcEbteCbk7t2eZCr-WrmWVX-KgYpUUZnfrV7AeBpwA@mail.gmail.com>
References: <CABMULtJTYcEbteCbk7t2eZCr-WrmWVX-KgYpUUZnfrV7AeBpwA@mail.gmail.com>
Message-ID: <748b6e2d-15c5-607f-9d3c-27d3cf3183b8@treenet.co.nz>

On 08/08/18 04:56, Alex K wrote:
> Hi all,
> 
> I have a box with fairly restrictive firewall.
> I see that the box blocks connections of squid to the requested sites
> when squid tries to reach/send ICMP to them:
> 
> 2018/08/07 16:51:57| Error sending to ICMP packet to 213.133.127.247.
> ERR: (1) Operation not permitted
> 2018/08/07 16:51:59| Error sending to ICMP packet to 194.55.30.166. ERR:
> (1) Operation not permitted
> 2018/08/07 16:52:00| Error sending to ICMP packet to 93.184.220.29. ERR:
> (1) Operation not permitted
> 2018/08/07 16:52:00| Error sending to ICMP packet to 72.21.202.25. ERR:
> (1) Operation not permitted
> 2018/08/07 16:52:02| Error sending to ICMP packet to 54.182.206.90. ERR:
> (1) Operation not permitted
> 2018/08/07 16:52:18| Error sending to ICMP packet to 54.239.220.40. ERR:
> (1) Operation not permitted
> 2018/08/07 16:52:18| Error sending to ICMP packet to 62.38.6.83. ERR:
> (1) Operation not permitted
> 2018/08/07 16:52:20| Error sending to ICMP packet to 13.32.16.243. ERR:
> (1) Operation not permitted
> 
> Anyone knows why squid is sending ICMP?

To find the fastest route for its outbound HTTP messages when cache_peer
are used, and to bootstrap the ARP and MTU discovery processes before
server TCP connections have to use the information they provide.

> Is this needed?

Maybe. You can safely configure "pinger_enable off" if you don't care
about a small (few milli- or micro-seconds) latency increase on TCP
connection setup.

Please note however that ICMP is not an optional protocol. It is
mandatory for correct working of TCP. Only a few things like these echo
packets are safely blocked.

Amos


From rightkicktech at gmail.com  Tue Aug  7 18:34:52 2018
From: rightkicktech at gmail.com (Alex K)
Date: Tue, 7 Aug 2018 21:34:52 +0300
Subject: [squid-users] Squid and ICMP
In-Reply-To: <748b6e2d-15c5-607f-9d3c-27d3cf3183b8@treenet.co.nz>
References: <CABMULtJTYcEbteCbk7t2eZCr-WrmWVX-KgYpUUZnfrV7AeBpwA@mail.gmail.com>
 <748b6e2d-15c5-607f-9d3c-27d3cf3183b8@treenet.co.nz>
Message-ID: <CABMULt+_r_G8xWC_Hs1fyAYVD5QTgbU6XE-JwH70EXXKzAu0Gw@mail.gmail.com>

Thanx Amos,

It is clear.

Alex

On Tue, Aug 7, 2018 at 9:20 PM, Amos Jeffries <squid3 at treenet.co.nz> wrote:

> On 08/08/18 04:56, Alex K wrote:
> > Hi all,
> >
> > I have a box with fairly restrictive firewall.
> > I see that the box blocks connections of squid to the requested sites
> > when squid tries to reach/send ICMP to them:
> >
> > 2018/08/07 16:51:57| Error sending to ICMP packet to 213.133.127.247.
> > ERR: (1) Operation not permitted
> > 2018/08/07 16:51:59| Error sending to ICMP packet to 194.55.30.166. ERR:
> > (1) Operation not permitted
> > 2018/08/07 16:52:00| Error sending to ICMP packet to 93.184.220.29. ERR:
> > (1) Operation not permitted
> > 2018/08/07 16:52:00| Error sending to ICMP packet to 72.21.202.25. ERR:
> > (1) Operation not permitted
> > 2018/08/07 16:52:02| Error sending to ICMP packet to 54.182.206.90. ERR:
> > (1) Operation not permitted
> > 2018/08/07 16:52:18| Error sending to ICMP packet to 54.239.220.40. ERR:
> > (1) Operation not permitted
> > 2018/08/07 16:52:18| Error sending to ICMP packet to 62.38.6.83. ERR:
> > (1) Operation not permitted
> > 2018/08/07 16:52:20| Error sending to ICMP packet to 13.32.16.243. ERR:
> > (1) Operation not permitted
> >
> > Anyone knows why squid is sending ICMP?
>
> To find the fastest route for its outbound HTTP messages when cache_peer
> are used, and to bootstrap the ARP and MTU discovery processes before
> server TCP connections have to use the information they provide.
>
> > Is this needed?
>
> Maybe. You can safely configure "pinger_enable off" if you don't care
> about a small (few milli- or micro-seconds) latency increase on TCP
> connection setup.
>
> Please note however that ICMP is not an optional protocol. It is
> mandatory for correct working of TCP. Only a few things like these echo
> packets are safely blocked.
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180807/631deb3e/attachment.htm>

From srnhari at gmail.com  Wed Aug  8 00:37:57 2018
From: srnhari at gmail.com (Hariharan Sethuraman)
Date: Wed, 8 Aug 2018 06:07:57 +0530
Subject: [squid-users] Reverse proxy and TUNNEL to same cache peer
In-Reply-To: <5e34a4bd-7a61-c965-7d22-bfc6a6c49377@treenet.co.nz>
References: <CANfnjgKM_5ZTppD7F=bDvtLqVvtRDmyHGFRh1DPajh9iaErL5g@mail.gmail.com>
 <7d72b267-88d9-c69c-5a48-3c2a99d8b6dd@treenet.co.nz>
 <CANfnjgJF7TDD3HOkNQsEJP5rHrJvkDKHubs1U1tb4z_wQzAosA@mail.gmail.com>
 <5e34a4bd-7a61-c965-7d22-bfc6a6c49377@treenet.co.nz>
Message-ID: <CANfnjgLcpdXKS-7AvNMo1JgNz143mKRNm8rZtMta=ZFbogG9PQ@mail.gmail.com>

Yes correct, the parent Proxy is a forward, but the squid will have to do
both from client aspect.

Can I run two instances of squid - forward and reverse separately
considering my configuration is good enough?

On Tue, 7 Aug 2018, 22:00 Amos Jeffries, <squid3 at treenet.co.nz> wrote:

> On 08/08/18 04:01, Hariharan Sethuraman wrote:
> > Thanks Amos: yes agree that I should have told forward proxy.
> >
> > When I remove the originserver option from cache_peer, the forward proxy
> > is working so which means the rewriter is not precluding from happening.
> > Does that give any clue to us?
> >
>
> Ah, cant believe I missed that. If the parent proxy is your access to
> the Internet then is *not* a reverse-proxy. It cannot be and receive
> proxy<->proxy traffic.
>
> Any attempt to change the scheme is erased because the scheme is not
> part of origin-form message syntax.
>
>
> > Moreover the reverse proxy is in next hop to the client and not in
> > internet. Time being, we are ok to have insecure channel between client
> > and squid. Do you have any sample config that that uses a parent proxy
> > to do both forward/reverse proxy? Or do you see my config is good enough
> > for this requirement.
> >
>
> The traffic types have different syntax. It is possible to have a parent
> proxy which receives both, but that has to be different ports and
> different cache_peer links between them.
>
> Amos
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180808/fc557c4f/attachment.htm>

From tin at new-life.org.au  Wed Aug  8 03:41:15 2018
From: tin at new-life.org.au (Tim Bates)
Date: Wed, 8 Aug 2018 13:41:15 +1000
Subject: [squid-users] want to ask about DNS resolution in firefox as an
 example
In-Reply-To: <201808061339.12479.Antony.Stone@squid.open.source.it>
References: <A75C6C35-F6FC-4D29-9D25-1504628D487C@netstream.ps>
 <201808061324.38986.Antony.Stone@squid.open.source.it>
 <F63C5559-822B-4FA5-B677-A317BAC9F38F@netstream.ps>
 <201808061339.12479.Antony.Stone@squid.open.source.it>
Message-ID: <911a9ac3-1e2c-ec87-3674-7505d1d4c85a@new-life.org.au>

On 06/08/18 21:39, Antony Stone wrote:
> On Monday 06 August 2018 at 13:32:32, --Ahmad-- wrote:
>> what could be the reason ?
> Cookies on your computer, javascript in web pages, browser language
> preferences, locally cached content...
>
> I'm sure I haven't thought of everything.
Some sites check for the X-Forwarded-For header too... Which is probably 
showing the public French IP address if no VPN or similar is in use.

TB


From srnhari at gmail.com  Wed Aug  8 04:25:16 2018
From: srnhari at gmail.com (Hariharan Sethuraman)
Date: Wed, 8 Aug 2018 09:55:16 +0530
Subject: [squid-users] Reverse proxy and TUNNEL to same cache peer
In-Reply-To: <CANfnjgLcpdXKS-7AvNMo1JgNz143mKRNm8rZtMta=ZFbogG9PQ@mail.gmail.com>
References: <CANfnjgKM_5ZTppD7F=bDvtLqVvtRDmyHGFRh1DPajh9iaErL5g@mail.gmail.com>
 <7d72b267-88d9-c69c-5a48-3c2a99d8b6dd@treenet.co.nz>
 <CANfnjgJF7TDD3HOkNQsEJP5rHrJvkDKHubs1U1tb4z_wQzAosA@mail.gmail.com>
 <5e34a4bd-7a61-c965-7d22-bfc6a6c49377@treenet.co.nz>
 <CANfnjgLcpdXKS-7AvNMo1JgNz143mKRNm8rZtMta=ZFbogG9PQ@mail.gmail.com>
Message-ID: <CANfnjg+2QBxP9--VGivJutE4kjO0ndUyd=C5JHQwhsvtMf_Wtg@mail.gmail.com>

> The traffic types have different syntax. It is possible to have a parent
> proxy which receives both, but that has to be different ports and
> different cache_peer links between them.

As I said in same cache_peer (without changing the parent proxy port), both
forward (removed originserver option) and reverse (with origin server
option) works.
For now, I will go with two squid instances one instance for forward and
other for reverse till I get an answer.

On Wed, Aug 8, 2018 at 6:07 AM, Hariharan Sethuraman <srnhari at gmail.com>
wrote:

> Yes correct, the parent Proxy is a forward, but the squid will have to do
> both from client aspect.
>
> Can I run two instances of squid - forward and reverse separately
> considering my configuration is good enough?
>
> On Tue, 7 Aug 2018, 22:00 Amos Jeffries, <squid3 at treenet.co.nz> wrote:
>
>> On 08/08/18 04:01, Hariharan Sethuraman wrote:
>> > Thanks Amos: yes agree that I should have told forward proxy.
>> >
>> > When I remove the originserver option from cache_peer, the forward proxy
>> > is working so which means the rewriter is not precluding from happening.
>> > Does that give any clue to us?
>> >
>>
>> Ah, cant believe I missed that. If the parent proxy is your access to
>> the Internet then is *not* a reverse-proxy. It cannot be and receive
>> proxy<->proxy traffic.
>>
>> Any attempt to change the scheme is erased because the scheme is not
>> part of origin-form message syntax.
>>
>>
>> > Moreover the reverse proxy is in next hop to the client and not in
>> > internet. Time being, we are ok to have insecure channel between client
>> > and squid. Do you have any sample config that that uses a parent proxy
>> > to do both forward/reverse proxy? Or do you see my config is good enough
>> > for this requirement.
>> >
>>
>> The traffic types have different syntax. It is possible to have a parent
>> proxy which receives both, but that has to be different ports and
>> different cache_peer links between them.
>>
>> Amos
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180808/f644dcd4/attachment.htm>

From srnhari at gmail.com  Wed Aug  8 04:49:44 2018
From: srnhari at gmail.com (Hariharan Sethuraman)
Date: Wed, 8 Aug 2018 10:19:44 +0530
Subject: [squid-users] Reverse proxy and TUNNEL to same cache peer
In-Reply-To: <CANfnjg+2QBxP9--VGivJutE4kjO0ndUyd=C5JHQwhsvtMf_Wtg@mail.gmail.com>
References: <CANfnjgKM_5ZTppD7F=bDvtLqVvtRDmyHGFRh1DPajh9iaErL5g@mail.gmail.com>
 <7d72b267-88d9-c69c-5a48-3c2a99d8b6dd@treenet.co.nz>
 <CANfnjgJF7TDD3HOkNQsEJP5rHrJvkDKHubs1U1tb4z_wQzAosA@mail.gmail.com>
 <5e34a4bd-7a61-c965-7d22-bfc6a6c49377@treenet.co.nz>
 <CANfnjgLcpdXKS-7AvNMo1JgNz143mKRNm8rZtMta=ZFbogG9PQ@mail.gmail.com>
 <CANfnjg+2QBxP9--VGivJutE4kjO0ndUyd=C5JHQwhsvtMf_Wtg@mail.gmail.com>
Message-ID: <CANfnjgLVCgi-v_4-zCKDsdLJjY_ObctmmbGiGiRwPJiOQ1G1xw@mail.gmail.com>

I think giving name helped to fwd/reverse to same parent proxy port:
cache_peer parent-proxy.domain.com parent 80       0  no-query no-digest
login=PASS originserver name=reverseproxy
cache_peer parent-proxy.domain.com parent 80       0  no-query no-digest
login=PASS name=forwardproxy


On Wed, Aug 8, 2018 at 9:55 AM, Hariharan Sethuraman <srnhari at gmail.com>
wrote:

> > The traffic types have different syntax. It is possible to have a parent
> > proxy which receives both, but that has to be different ports and
> > different cache_peer links between them.
>
> As I said in same cache_peer (without changing the parent proxy port),
> both forward (removed originserver option) and reverse (with origin server
> option) works.
> For now, I will go with two squid instances one instance for forward and
> other for reverse till I get an answer.
>
> On Wed, Aug 8, 2018 at 6:07 AM, Hariharan Sethuraman <srnhari at gmail.com>
> wrote:
>
>> Yes correct, the parent Proxy is a forward, but the squid will have to do
>> both from client aspect.
>>
>> Can I run two instances of squid - forward and reverse separately
>> considering my configuration is good enough?
>>
>> On Tue, 7 Aug 2018, 22:00 Amos Jeffries, <squid3 at treenet.co.nz> wrote:
>>
>>> On 08/08/18 04:01, Hariharan Sethuraman wrote:
>>> > Thanks Amos: yes agree that I should have told forward proxy.
>>> >
>>> > When I remove the originserver option from cache_peer, the forward
>>> proxy
>>> > is working so which means the rewriter is not precluding from
>>> happening.
>>> > Does that give any clue to us?
>>> >
>>>
>>> Ah, cant believe I missed that. If the parent proxy is your access to
>>> the Internet then is *not* a reverse-proxy. It cannot be and receive
>>> proxy<->proxy traffic.
>>>
>>> Any attempt to change the scheme is erased because the scheme is not
>>> part of origin-form message syntax.
>>>
>>>
>>> > Moreover the reverse proxy is in next hop to the client and not in
>>> > internet. Time being, we are ok to have insecure channel between client
>>> > and squid. Do you have any sample config that that uses a parent proxy
>>> > to do both forward/reverse proxy? Or do you see my config is good
>>> enough
>>> > for this requirement.
>>> >
>>>
>>> The traffic types have different syntax. It is possible to have a parent
>>> proxy which receives both, but that has to be different ports and
>>> different cache_peer links between them.
>>>
>>> Amos
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180808/5d798f36/attachment.htm>

From squid3 at treenet.co.nz  Wed Aug  8 12:20:37 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 9 Aug 2018 00:20:37 +1200
Subject: [squid-users] Reverse proxy and TUNNEL to same cache peer
In-Reply-To: <CANfnjgLVCgi-v_4-zCKDsdLJjY_ObctmmbGiGiRwPJiOQ1G1xw@mail.gmail.com>
References: <CANfnjgKM_5ZTppD7F=bDvtLqVvtRDmyHGFRh1DPajh9iaErL5g@mail.gmail.com>
 <7d72b267-88d9-c69c-5a48-3c2a99d8b6dd@treenet.co.nz>
 <CANfnjgJF7TDD3HOkNQsEJP5rHrJvkDKHubs1U1tb4z_wQzAosA@mail.gmail.com>
 <5e34a4bd-7a61-c965-7d22-bfc6a6c49377@treenet.co.nz>
 <CANfnjgLcpdXKS-7AvNMo1JgNz143mKRNm8rZtMta=ZFbogG9PQ@mail.gmail.com>
 <CANfnjg+2QBxP9--VGivJutE4kjO0ndUyd=C5JHQwhsvtMf_Wtg@mail.gmail.com>
 <CANfnjgLVCgi-v_4-zCKDsdLJjY_ObctmmbGiGiRwPJiOQ1G1xw@mail.gmail.com>
Message-ID: <4fd1cb11-df5d-7f7c-1c91-8b6b55636771@treenet.co.nz>

On 08/08/18 16:49, Hariharan Sethuraman wrote:
> I think giving name helped to fwd/reverse to same parent proxy port:
> cache_peer parent-proxy.domain.com <http://parent-proxy.domain.com>
> parent 80? ? ? ?0? no-query no-digest login=PASS originserver
> name=reverseproxy
> cache_peer parent-proxy.domain.com <http://parent-proxy.domain.com>
> parent 80? ? ? ?0? no-query no-digest login=PASS name=forwardproxy
> 

The problem is what that parent proxy is doing with the requests it
receives. The cache_peer with "originserver" option sends origin-form
URLs, the other sends absolute-form URLs.

By delivering them to port 80 you can expect it to automatically
re-write the URLs back to the http:// scheme. Which fixes some safety
issues broken by your re-writer - by undoing what your re-writer is
trying to do.

Amos


From Sarfaraz.Ahmad at deshaw.com  Wed Aug  8 16:03:56 2018
From: Sarfaraz.Ahmad at deshaw.com (Ahmad, Sarfaraz)
Date: Wed, 8 Aug 2018 16:03:56 +0000
Subject: [squid-users] Squid returns NONE_ABORTED/000 and high response
 time but the internet access itself looks okay
In-Reply-To: <1fcb5a95-1a1d-c67c-30ce-571a4613aac7@treenet.co.nz>
References: <217289d6732b409c9104165913b4c2ce@mbxtoa3.winmail.deshaw.com>
 <f6f2f9b5-bd5d-e3cc-bbea-1c304d1a877e@treenet.co.nz>
 <4bf524c23d684889b6ae32ea8537f095@mbxtoa3.winmail.deshaw.com>
 <6fe9615e-47e2-0e2c-89fc-30a2c5d3c7be@treenet.co.nz>
 <40618ba7d1664af89f12fa1b73f59132@mbxtoa3.winmail.deshaw.com>
 <1fcb5a95-1a1d-c67c-30ce-571a4613aac7@treenet.co.nz>
Message-ID: <09cdc9f8986843869f35c5626820a041@mbxtoa3.winmail.deshaw.com>

>> As late as it can be done. How late that is depends on your SSL-Bump setup, any ICAP or other changes being made to the fake-CONNECT request, maybe even your cache contents.
All I am doing is peeking at Step1 (Client SNI) and then bumping vast majority of connections, splicing very few. Caching is completely disabled.

>> The client "<ip>" opened a TCP connection to 173.194.142.186:443 - which was intercepted and delivered to this Squid. The client disconnected after 78 seconds.
This doesn't explain why I saw 20+secs for TCP in Chrome dev tools'.  From Chrome's dev tools, it looks like setting up TLS did not take long but setting up TCP surely did.

 >> We know that the server IP:port should be 173.194.142.186:443 because those are the details on the CONNECT message URI. Squid has not gone far enough into the processing of that message to identify that detail.
What would usually be the next step here? Could DNS be involved ?


-----Original Message-----
From: Amos Jeffries <squid3 at treenet.co.nz> 
Sent: Tuesday, August 7, 2018 11:14 PM
To: Ahmad, Sarfaraz <Sarfaraz.Ahmad at deshaw.com>; squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Squid returns NONE_ABORTED/000 and high response time but the internet access itself looks okay

On 08/08/18 05:15, Ahmad, Sarfaraz wrote:
>>> Your guess is wrong. The TCP level setup is only between Squid and the client. It has to have completed before the TLS stuff can begin.
> So when does Squid start setting up the TCP connection with the origin server ? After setting up a TCP connection with client and identifying it to be TLS ?

As late as it can be done. How late that is depends on your SSL-Bump setup, any ICAP or other changes being made to the fake-CONNECT request, maybe even your cache contents.

Anyhow, there is no sign of a server connection existing. So whatever is happening is one of the early parts of TLS handshake.


> 
> What would this log message likely mean then ? I was reading that as 78477ms was the time it took for Squid to connect to 173.194.142.186 on port 443 and Squid and client(not the origin server) had already established a TCP connection beforehand (while it(squid) tries connecting to the remote server on port 443).
> 1533612202.312  78477 <ip> NONE_ABORTED/000 0 CONNECT 
> 173.194.142.186:443 - HIER_NONE/- -
> 

The client "<ip>" opened a TCP connection to 173.194.142.186:443 - which was intercepted and delivered to this Squid. The client disconnected after 78 seconds.
 That is all that can be known about what did happen from this log entry.

The list of things which did not (or could not have) happen is longer:

No server connection was made.
No bytes delivered to the client.
 and a lot of other things cannot have happened.


> That would imply two things.
> 1) It took a lot of time for clients to set up a TCP connection with 
> Squid given Chrome's dev tools

The client->Squid TCP setup seems to be completed. Either Squid is waiting for TLS handshake from the client to arrive, or something is hung in the processing of the clientHello stages.

NP: the 0-bytes number in the log is how much Squid delivered to the client. There may be some bytes the client delivered to Squid which are not accounted.



> 2) Second, Squid took a while to establish a connection with origin server.

I don't think Squid got that far. There is no server IP following the "HEIR_NONE/". The "-" part specifically says there is no known server IP.

We know that the server IP:port should be 173.194.142.186:443 because those are the details on the CONNECT message URI. Squid has not gone far enough into the processing of that message to identify that detail.


> 
> Moreover, my ICAP settings look like this, icap_service localicap 
> reqmod_precache icap://127.0.0.1:1345/reqmod bypass=on routing=off 
> on-overload=wait
> 
> ICAP would come into the picture only after I see a GET request in the access.log, right?

ICAP should be passed any HTTP request. Since Squid is handling the CONNECT message the ICAP should be invoked for them as well. I don't recall of it actually is or not.

Also, note that at no point have I confirmed that is is ICAP being the problem (nor ruled it out). You are the one focusing on that possibility. There are other possibilities such as SSL-Bump issues, http_access delays and the like. Even client_delay_pool's may be the problem.


Amos

From erdosain9 at gmail.com  Fri Aug 10 13:15:08 2018
From: erdosain9 at gmail.com (erdosain9)
Date: Fri, 10 Aug 2018 08:15:08 -0500 (CDT)
Subject: [squid-users] Squid as reverse proxy for two or more webs
Message-ID: <1533906908681-0.post@n4.nabble.com>

Hi to all.
I was reading several tutorials and I can not find what I'm doing wrong.
I want to use squid to redirect to these two sites that are both within my
domain.

In my internal dns I have declared both servers, with their corresponding
ips, also squid.

reverse.mydomain.lan 192.168.1.21 (SQUID)

php.mydomain.lan 192.168.1.223
ticket.mydomain.lan 192.168.1.246

In addition to the internal DNS, I have the / etc / hosts configured with
these values:
[root at squidReverse ~]# cat /etc/hosts
127.0.0.1   localhost localhost.localdomain localhost4
localhost4.localdomain4
#::1         localhost localhost.localdomain localhost6
localhost6.localdomain6
192.168.1.21  reverse.mydomain.lan
192.168.1.246 ticket.mydomain.lan 
192.168.1.223 php.mydomain.lan


This is the configuration of the squid referring to the reverse proxy:

http_port 192.168.1.21:80 accel vhost

cache_peer 192.168.1.246 parent 80 0 proxy-only name=ticket
cache_peer 192.168.1.223 parent 80 0 proxy-only name=php

acl ticket_acl dstdomain .MYDOMAIN.lan
http_access allow ticket_acl
cache_peer_access ticket allow ticket_acl


acl php_acl dstdomain .MYDOMAIN.lan
http_access allow php_acl
cache_peer_access php allow php_acl

With this config when i go to reverse.mydomain.lan (from a web browser) i
get the ticket web, but how i can go to the second web?? php web??

I dont get it. if i go to ticket.reverse.mydomain.lan i dont nothing, It
does not even come to squid, neither with php.reverse.mydomian.lan

Thanks to all.






--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From jascha.sticher at tds.fujitsu.com  Fri Aug 10 13:42:49 2018
From: jascha.sticher at tds.fujitsu.com (Sticher, Jascha)
Date: Fri, 10 Aug 2018 13:42:49 +0000
Subject: [squid-users] Squid as reverse proxy for two or more webs
In-Reply-To: <1533906908681-0.post@n4.nabble.com>
References: <1533906908681-0.post@n4.nabble.com>
Message-ID: <E286ADE35F919742812E3076A36122E701BFCD3CF4@tdsnsumbx2vp>

Hi,

> acl ticket_acl dstdomain .MYDOMAIN.lan
This matches *.mydomain.lan - php.mydomain.lan as well as ticket.mydomain.lan

As the configuration is used top-to-bottom, the first of the cache_peers will be used (as only one parent is used).

Use more specific ACLs to mitigate this:

acl ticket_acl dstdomain ticket.MYDOMAIN.lan
acl php_acl dstdomain php.MYDOMAIN.lan


Kind regards,
Jascha


-----Urspr?ngliche Nachricht-----
Von: squid-users <squid-users-bounces at lists.squid-cache.org> Im Auftrag von erdosain9
Gesendet: Freitag, 10. August 2018 15:15
An: squid-users at lists.squid-cache.org
Betreff: [squid-users] Squid as reverse proxy for two or more webs

Hi to all.
I was reading several tutorials and I can not find what I'm doing wrong.
I want to use squid to redirect to these two sites that are both within my
domain.

In my internal dns I have declared both servers, with their corresponding
ips, also squid.

reverse.mydomain.lan 192.168.1.21 (SQUID)

php.mydomain.lan 192.168.1.223
ticket.mydomain.lan 192.168.1.246

In addition to the internal DNS, I have the / etc / hosts configured with
these values:
[root at squidReverse ~]# cat /etc/hosts
127.0.0.1   localhost localhost.localdomain localhost4
localhost4.localdomain4
#::1         localhost localhost.localdomain localhost6
localhost6.localdomain6
192.168.1.21  reverse.mydomain.lan
192.168.1.246 ticket.mydomain.lan 
192.168.1.223 php.mydomain.lan


This is the configuration of the squid referring to the reverse proxy:

http_port 192.168.1.21:80 accel vhost

cache_peer 192.168.1.246 parent 80 0 proxy-only name=ticket
cache_peer 192.168.1.223 parent 80 0 proxy-only name=php

acl ticket_acl dstdomain .MYDOMAIN.lan
http_access allow ticket_acl
cache_peer_access ticket allow ticket_acl


acl php_acl dstdomain .MYDOMAIN.lan
http_access allow php_acl
cache_peer_access php allow php_acl

With this config when i go to reverse.mydomain.lan (from a web browser) i
get the ticket web, but how i can go to the second web?? php web??

I dont get it. if i go to ticket.reverse.mydomain.lan i dont nothing, It
does not even come to squid, neither with php.reverse.mydomian.lan

Thanks to all.






--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users

From squid3 at treenet.co.nz  Fri Aug 10 13:52:22 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 11 Aug 2018 01:52:22 +1200
Subject: [squid-users] Squid as reverse proxy for two or more webs
In-Reply-To: <1533906908681-0.post@n4.nabble.com>
References: <1533906908681-0.post@n4.nabble.com>
Message-ID: <53cf93d8-0b08-ce56-5467-310c1a8acd3e@treenet.co.nz>

On 11/08/18 01:15, erdosain9 wrote:
> Hi to all.
> I was reading several tutorials and I can not find what I'm doing wrong.
> I want to use squid to redirect to these two sites that are both within my
> domain.
> 
> In my internal dns I have declared both servers, with their corresponding
> ips, also squid.
> 
> reverse.mydomain.lan 192.168.1.21 (SQUID)
> 

So "reverse.mydomain.lan" is the public name which your users/clients
are browsing ...


> php.mydomain.lan 192.168.1.223
> ticket.mydomain.lan 192.168.1.246

.. and clients never connect to the above directly. So these domains are
never to be accessed by users/clients.

If (as I suspect) the above statements are not true, then your naming is
the first thing that is wrong.

The domain name(s) which your clients access should point to the proxy.
There can be multiple.

> 
> In addition to the internal DNS, I have the / etc / hosts configured with
> these values:
> [root at squidReverse ~]# cat /etc/hosts
> 127.0.0.1   localhost localhost.localdomain localhost4
> localhost4.localdomain4
> #::1         localhost localhost.localdomain localhost6
> localhost6.localdomain6
> 192.168.1.21  reverse.mydomain.lan
> 192.168.1.246 ticket.mydomain.lan 
> 192.168.1.223 php.mydomain.lan
> 

These entries are not required when internal DNS is properly configured.

(FYI: Current Squid versions can also use multicast-DNS for LAN servers
if you use the standardized .local TLD for internal server names. That
is not related to your problem though.)

> 
> This is the configuration of the squid referring to the reverse proxy:
> 
> http_port 192.168.1.21:80 accel vhost
> 
> cache_peer 192.168.1.246 parent 80 0 proxy-only name=ticket
> cache_peer 192.168.1.223 parent 80 0 proxy-only name=php
> 
> acl ticket_acl dstdomain .MYDOMAIN.lan
> http_access allow ticket_acl
> cache_peer_access ticket allow ticket_acl
> 
> 
> acl php_acl dstdomain .MYDOMAIN.lan
> http_access allow php_acl
> cache_peer_access php allow php_acl
> 
> With this config when i go to reverse.mydomain.lan (from a web browser) i
> get the ticket web, but how i can go to the second web?? php web??

Right now your ticket_acl and php_acl are exactly the same. So they are
telling Squid that both peers are providing identical content (ie both
are authoritative for anything inside *.mydomain.lan). The first of the
available peers will be used, unless it starts to overload then the
second will start receiving the traffic.


To send traffic to one of the peers and not the other you need some way
to distinguish between them.

Normally you would have the ticket.* and php.* domain names both
pointing at Squid (192.168.1.21) so your ACLs can check for and use the
domain name to identify which peer is supposed to receive it.

The cache_peer use raw-IP like you have, or a *different* server name
from DNS pointing at the particular peer which can serve the content
your ACLs let Squid send to it.

The config example you want to follow is
<https://wiki.squid-cache.org/ConfigExamples/Reverse/MultipleWebservers>.


Amos


From squid3 at treenet.co.nz  Fri Aug 10 05:41:24 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 10 Aug 2018 17:41:24 +1200
Subject: [squid-users] [squid-announce] Squid 4.2 is available
Message-ID: <28241c64-b221-ca2f-1e68-6ed28c332174@treenet.co.nz>

The Squid HTTP Proxy team is very pleased to announce the availability
of the Squid-4.2 release!


This release is a bug fix release resolving several issues found in the
prior Squid releases.


The major changes to be aware of:


* Regression: Restored support for the https_port clientca option

This TLS/SSL option was incorrectly stating this option as no longer
supported in configurations other than those using "ssl-bump" option.
It was also not loading the CA certificate correctly in any build.

This release removes those incorrect notices and fixes loading of
the CA certificate.

There are still signs of possible issues challenging for client X.509
certificate during TLS handshake which have not yet been confirmed and
tracked down. There are also indications that the remaining issue(s)
could be advanced OpenSSL options implicitly preventing the challenge.


* Regression Bug 4870: milliseconds logformats prepend 0s instead of
  spaces

This bug appears when a milliseconds (%tu, %tr, %dt, %<pt, %>pt)
logformat macro is used with a specific minimum output string size
indicated. The result is a value prefixed with 0's which log processors
can confuse with octal notation in some common circumstances. This
release now correctly pads with whitespace unless 0's are explicitly
indicated by the macro syntax.


* Bug 4843 pt3: GCC-8 fixes and refactoring

This release completes the formal support for GCC-8 compiler changes. At
least in relation to the features and build settings normally produced
by ./configure options.

There are known to be some issues when building with custom compiler
flags for higher than normal optimization and extended warnings. While
such custom builds are intentionally permitted they are not officially
supported by the Squid Project core developers.


* Bug 4861: HTTPMSGLOCK missing pointer safety

This bug can appear when eCAP adaptors are being used along with
SSL-Bump of intercepted HTTPS traffic. It is also present in
Squid-3.5.27 and older but does not have any externally triggerable effects.


* Fix %>ru logging of huge URLs

When dealing with an HTTP request header that Squid can parse but that
contain request URI length exceeding the 8K limit, Squid should log the
URL (prefix) instead of a dash. Logging the URL helps with triaging
these unusual requests. The older %ru macro was already logging these
huge URLs, but %>ru macro was logging a dash. Now both log the URL (or
its prefix).

See the logformat documentation for more details on these macros
behaviour <http://www.squid-cache.org/Doc/config/logformat/>



  All users of Squid-4 are urged to upgrade to this release as soon as
  possible.

  All users of Squid-3 are encouraged to upgrade where possible.


See the ChangeLog for the full list of changes in this and earlier
releases.

Please refer to the release notes at
http://www.squid-cache.org/Versions/v4/RELEASENOTES.html
when you are ready to make the switch to Squid-4

This new release can be downloaded from our HTTP or FTP servers

  http://www.squid-cache.org/Versions/v4/
  ftp://ftp.squid-cache.org/pub/squid/
  ftp://ftp.squid-cache.org/pub/archive/4/

or the mirrors. For a list of mirror sites see

  http://www.squid-cache.org/Download/http-mirrors.html
  http://www.squid-cache.org/Download/mirrors.html

If you encounter any issues with this release please file a bug report.
  http://bugs.squid-cache.org/


Amos Jeffries
_______________________________________________
squid-announce mailing list
squid-announce at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-announce

From erdosain9 at gmail.com  Fri Aug 10 13:54:01 2018
From: erdosain9 at gmail.com (erdosain9)
Date: Fri, 10 Aug 2018 08:54:01 -0500 (CDT)
Subject: [squid-users] Squid as reverse proxy for two or more webs
In-Reply-To: <E286ADE35F919742812E3076A36122E701BFCD3CF4@tdsnsumbx2vp>
References: <1533906908681-0.post@n4.nabble.com>
 <E286ADE35F919742812E3076A36122E701BFCD3CF4@tdsnsumbx2vp>
Message-ID: <1533909241604-0.post@n4.nabble.com>

Ok, thanks. I change that.

Now, if i go to reverse.mydomain.lan i get this error:

"Unable to forward this request at this time."

1533909140.268      0 192.168.6.20 TCP_IMS_HIT/304 355 GET
http://reverse.mydomain.lan/squid-internal-static/icons/SN.png - HIER_NONE/-
image/png

but what would be the url that i have to wrote to go to each site??
(sorry my ignorance)

Thanks again






--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From Antony.Stone at squid.open.source.it  Fri Aug 10 14:00:24 2018
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Fri, 10 Aug 2018 16:00:24 +0200
Subject: [squid-users] Squid as reverse proxy for two or more webs
In-Reply-To: <1533909241604-0.post@n4.nabble.com>
References: <1533906908681-0.post@n4.nabble.com>
 <E286ADE35F919742812E3076A36122E701BFCD3CF4@tdsnsumbx2vp>
 <1533909241604-0.post@n4.nabble.com>
Message-ID: <201808101600.24993.Antony.Stone@squid.open.source.it>

On Friday 10 August 2018 at 15:54:01, erdosain9 wrote:

> Ok, thanks. I change that.

1. Changed what?

2. Show us your current DNS entries, and tell us which steps you followed from 
https://wiki.squid-cache.org/ConfigExamples/Reverse/MultipleWebservers

> Now, if i go to reverse.mydomain.lan i get this error:

Why would you go to that address?

Surely you are trying to trying to get requests for:

php.mydomain.lan
ticket.mydomain.lan

to work?

3. What happens when you ask for those in your browser?


Antony.

-- 
What do you get when you cross a joke with a rhetorical question?

                                                   Please reply to the list;
                                                         please *don't* CC me.


From erdosain9 at gmail.com  Fri Aug 10 14:26:31 2018
From: erdosain9 at gmail.com (erdosain9)
Date: Fri, 10 Aug 2018 09:26:31 -0500 (CDT)
Subject: [squid-users] Squid as reverse proxy for two or more webs
In-Reply-To: <53cf93d8-0b08-ce56-5467-310c1a8acd3e@treenet.co.nz>
References: <1533906908681-0.post@n4.nabble.com>
 <53cf93d8-0b08-ce56-5467-310c1a8acd3e@treenet.co.nz>
Message-ID: <1533911191967-0.post@n4.nabble.com>


> php.mydomain.lan 192.168.1.223
> ticket.mydomain.lan 192.168.1.246

>.. and clients never connect to the above directly. So these domains are
>never to be accessed by users/clients.

The client can connect directly from the domain. (i mean they can connect
directly in work, but i want to do this (proxy reverse, for when they are at
home...) I dont public yet nothing of this, im trying to do it first inside
my network.

>If (as I suspect) the above statements are not true, then your naming is
>the first thing that is wrong.

Why?

>The domain name(s) which your clients access should point to the proxy.
>There can be multiple.

I dont get this.

>Right now your ticket_acl and php_acl are exactly the same. So they are
>telling Squid that both peers are providing identical content (ie both
>are authoritative for anything inside *.mydomain.lan). The first of the
>available peers will be used, unless it starts to overload then the
>second will start receiving the traffic.


>To send traffic to one of the peers and not the other you need some way
>to distinguish between them.

>Normally you would have the ticket.* and php.* domain names both
>pointing at Squid (192.168.1.21) so your ACLs can check for and use the
>domain name to identify which peer is supposed to receive it.

I create two entries pointing to squid in DNS now.
site1.mydomain.lan
site2.mydomain.lan

>The config example you want to follow is
>&lt;https://wiki.squid-cache.org/ConfigExamples/Reverse/MultipleWebservers&gt;.

I read that... but i dont get what im doing wrong.


this is the config now.

http_port 192.168.1.21:80 accel vhost


cache_peer 192.168.1.246 parent 80 0 proxy-only name=site1
cache_peer 192.168.1.223 parent 80 0 proxy-only name=site2


acl soporte_acl dstdomain ticket.MYDOMAIN.lan
http_access allow soporte_acl
cache_peer_access site1 allow soporte_acl


acl phplists_acl dstdomain php.MYDOMAIN.lan
http_access allow phplists_acl
cache_peer_access site2 allow phplists_acl

------------------------------------------------------------

But, i get this error

" Unable to forward this request at this time."

1533911112.071      1 192.168.6.20 TCP_MISS/500 4605 GET
http://site1.MYDOMAIN.lan/ - HIER_NONE/- text/html
1533911112.193      0 192.168.6.20 TCP_MEM_HIT_ABORTED/200 4274 GET
http://reverse.MYDOMAIN.lan/squid-internal-static/icons/SN.png - HIER_NONE/-
image/png
1533911124.117      0 192.168.6.20 TCP_MISS/500 4605 GET
http://site2.MYDOMAIN.lan/ - HIER_NONE/- text/html
1533911124.217      0 192.168.6.20 TCP_MEM_HIT_ABORTED/200 4274 GET
http://reverse.MYDOMAIN.lan/squid-internal-static/icons/SN.png - HIER_NONE/-
image/png

Thanks to all.



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From Antony.Stone at squid.open.source.it  Fri Aug 10 14:36:28 2018
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Fri, 10 Aug 2018 16:36:28 +0200
Subject: [squid-users] Squid as reverse proxy for two or more webs
In-Reply-To: <1533911191967-0.post@n4.nabble.com>
References: <1533906908681-0.post@n4.nabble.com>
 <53cf93d8-0b08-ce56-5467-310c1a8acd3e@treenet.co.nz>
 <1533911191967-0.post@n4.nabble.com>
Message-ID: <201808101636.28808.Antony.Stone@squid.open.source.it>

On Friday 10 August 2018 at 16:26:31, erdosain9 wrote:

> > php.mydomain.lan 192.168.1.223
> > ticket.mydomain.lan 192.168.1.246
> >
> >.. and clients never connect to the above directly. So these domains are
> >never to be accessed by users/clients.
> 
> The client can connect directly from the domain. (i mean they can connect
> directly in work, but i want to do this (proxy reverse, for when they are
> at home...) I dont public yet nothing of this, im trying to do it first
> inside my network.

Ah, it might have been helpful for you to mention that in the first place.

> >If (as I suspect) the above statements are not true, then your naming is
> >the first thing that is wrong.
> 
> Why?

Because the name the clients connect to myst resolve to the IP address of 
Squid, for it work as a reverse proxy.

> >The domain name(s) which your clients access should point to the proxy.
> >There can be multiple.
> 
> I dont get this.

If name.domain.lan points to 10.20.30.40, then a client browser requesting 
http://name.domain.lan will start talking to machine 10.20.30.40

If you want that to be the real server, that's fine.

If you want that machine to be squid acting as a reverse proxy, that's fine 
too.

The point is that the IP address must point to the machine you want the client 
to connect to.

> >Right now your ticket_acl and php_acl are exactly the same. So they are
> >telling Squid that both peers are providing identical content (ie both
> >are authoritative for anything inside *.mydomain.lan). The first of the
> >available peers will be used, unless it starts to overload then the
> >second will start receiving the traffic.
> >
> >
> >To send traffic to one of the peers and not the other you need some way
> >to distinguish between them.
> >
> >Normally you would have the ticket.* and php.* domain names both
> >pointing at Squid (192.168.1.21) so your ACLs can check for and use the
> >domain name to identify which peer is supposed to receive it.
> 
> I create two entries pointing to squid in DNS now.
> site1.mydomain.lan
> site2.mydomain.lan

So, both of those resolve to 192.168.1.21, right?

> > The config example you want to follow is
> > https://wiki.squid-cache.org/ConfigExamples/Reverse/MultipleWebservers

> 
> I read that... but i dont get what im doing wrong.

You want to follow the section:

Switching on Domains

Using cache_peer_access: 

cache_peer ip.of.server1 parent 80 0 no-query originserver name=server_1
acl sites_server_1 dstdomain www.example.com example.com
cache_peer_access server_1 allow sites_server_1

> this is the config now.
> 
> http_port 192.168.1.21:80 accel vhost
> 
> cache_peer 192.168.1.246 parent 80 0 proxy-only name=site1
> cache_peer 192.168.1.223 parent 80 0 proxy-only name=site2

You are missing "originserver" at the very least.  Otherwise Squid expects to 
find another proxy at the IP address.

> acl soporte_acl dstdomain ticket.MYDOMAIN.lan
> http_access allow soporte_acl
> cache_peer_access site1 allow soporte_acl
> 
> acl phplists_acl dstdomain php.MYDOMAIN.lan
> http_access allow phplists_acl
> cache_peer_access site2 allow phplists_acl
> 
> ------------------------------------------------------------
> 
> But, i get this error
> 
> " Unable to forward this request at this time."

...when you requested what as a URL?

> 1533911112.071      1 192.168.6.20 TCP_MISS/500 4605 GET
> http://site1.MYDOMAIN.lan/ - HIER_NONE/- text/html

Looks like you entered "site1.mydomain.lan" into your browser.

Try "ticket.mydomain.lan" (after correcting the above config problems) instead.

> 1533911112.193      0 192.168.6.20 TCP_MEM_HIT_ABORTED/200 4274 GET
> http://reverse.MYDOMAIN.lan/squid-internal-static/icons/SN.png -
> HIER_NONE/- image/png
> 1533911124.117      0 192.168.6.20 TCP_MISS/500 4605 GET
> http://site2.MYDOMAIN.lan/ - HIER_NONE/- text/html
> 1533911124.217      0 192.168.6.20 TCP_MEM_HIT_ABORTED/200 4274 GET
> http://reverse.MYDOMAIN.lan/squid-internal-static/icons/SN.png -
> HIER_NONE/- image/png


Antony.

-- 
Salad is what food eats.

                                                   Please reply to the list;
                                                         please *don't* CC me.


From erdosain9 at gmail.com  Fri Aug 10 14:56:33 2018
From: erdosain9 at gmail.com (erdosain9)
Date: Fri, 10 Aug 2018 09:56:33 -0500 (CDT)
Subject: [squid-users] Squid as reverse proxy for two or more webs
In-Reply-To: <201808101636.28808.Antony.Stone@squid.open.source.it>
References: <1533906908681-0.post@n4.nabble.com>
 <53cf93d8-0b08-ce56-5467-310c1a8acd3e@treenet.co.nz>
 <1533911191967-0.post@n4.nabble.com>
 <201808101636.28808.Antony.Stone@squid.open.source.it>
Message-ID: <1533912993198-0.post@n4.nabble.com>

Antony Stone wrote
>> I create two entries pointing to squid in DNS now.
>> site1.mydomain.lan
>> site2.mydomain.lan
> 
> So, both of those resolve to 192.168.1.21, right?
> 
> Yes, the resolve to the ip of squid.
> 
>> > The config example you want to follow is
>> > https://wiki.squid-cache.org/ConfigExamples/Reverse/MultipleWebservers
> 
>> 
>> I read that... but i dont get what im doing wrong.
> 
> You want to follow the section:
> 
> Switching on Domains
> 
> Using cache_peer_access: 
> 
> cache_peer ip.of.server1 parent 80 0 no-query originserver name=server_1
> acl sites_server_1 dstdomain www.example.com example.com
> cache_peer_access server_1 allow sites_server_1
> 
>> this is the config now.
>> 
>> http_port 192.168.1.21:80 accel vhost
>> 
>> cache_peer 192.168.1.246 parent 80 0 proxy-only name=site1
>> cache_peer 192.168.1.223 parent 80 0 proxy-only name=site2
> 
> You are missing "originserver" at the very least.  Otherwise Squid expects
> to 
> find another proxy at the IP address.
> 
> Oh, sorry. I try with that config too. anyway i dont know about that.
> thanks.
> 
> ...when you requested what as a URL?
> site1.mydomain.lan
> 
>> 1533911112.071      1 192.168.6.20 TCP_MISS/500 4605 GET
>> http://site1.MYDOMAIN.lan/ - HIER_NONE/- text/html
> 
> Looks like you entered "site1.mydomain.lan" into your browser.
> 
> Yep.
> 
> Try "ticket.mydomain.lan" (after correcting the above config problems)
> instead.
> 
> Well, if if put ticket.mydomain.lan i go directly to the server i want to
> go.
> 
> This is:
> 
> ticket.mydomian.lan ----------------------------> Server  1
> php.mydomian.lan ------------------------------> Server 2
> 
> site1.mydomain.lan --------------------------------> squid
> site2.mydomian.lan --------------------------------> squid
> 
> for my config i expect that when squid receive site1 go to
> ticket.mydomain.lan
> and for site2 go to php.mydomain.lan
> 
> Thanks to all.





--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From squid3 at treenet.co.nz  Fri Aug 10 15:25:10 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 11 Aug 2018 03:25:10 +1200
Subject: [squid-users] Squid as reverse proxy for two or more webs
In-Reply-To: <1533912993198-0.post@n4.nabble.com>
References: <1533906908681-0.post@n4.nabble.com>
 <53cf93d8-0b08-ce56-5467-310c1a8acd3e@treenet.co.nz>
 <1533911191967-0.post@n4.nabble.com>
 <201808101636.28808.Antony.Stone@squid.open.source.it>
 <1533912993198-0.post@n4.nabble.com>
Message-ID: <1055c185-d668-6530-756d-caf5be0a13a9@treenet.co.nz>

On 11/08/18 02:56, erdosain9 wrote:
> Antony Stone wrote
>>> I create two entries pointing to squid in DNS now.
>>> site1.mydomain.lan
>>> site2.mydomain.lan
>>
>> So, both of those resolve to 192.168.1.21, right?
>>
>> Yes, the resolve to the ip of squid.
>>
>>>> The config example you want to follow is
>>>> https://wiki.squid-cache.org/ConfigExamples/Reverse/MultipleWebservers
>>
>>>
>>> I read that... but i dont get what im doing wrong.
>>
>> You want to follow the section:
>>
>> Switching on Domains
>>
>> Using cache_peer_access: 
>>
>> cache_peer ip.of.server1 parent 80 0 no-query originserver name=server_1
>> acl sites_server_1 dstdomain www.example.com example.com
>> cache_peer_access server_1 allow sites_server_1
>>
>>> this is the config now.
>>>
>>> http_port 192.168.1.21:80 accel vhost
>>>
>>> cache_peer 192.168.1.246 parent 80 0 proxy-only name=site1
>>> cache_peer 192.168.1.223 parent 80 0 proxy-only name=site2
>>
>> You are missing "originserver" at the very least.  Otherwise Squid expects
>> to 
>> find another proxy at the IP address.
>>
>> Oh, sorry. I try with that config too. anyway i dont know about that.
>> thanks.
>>

You are also missing the ACL parts which determine which domain goes to
which cache_peer server.


>> ...when you requested what as a URL?
>> site1.mydomain.lan
>>
>>> 1533911112.071      1 192.168.6.20 TCP_MISS/500 4605 GET
>>> http://site1.MYDOMAIN.lan/ - HIER_NONE/- text/html
>>
>> Looks like you entered "site1.mydomain.lan" into your browser.
>>
>> Yep.
>>
>> Try "ticket.mydomain.lan" (after correcting the above config problems)
>> instead.
>>
> Well, if if put ticket.mydomain.lan i go directly to the server i want to
> go.
>

This is why the domain name you want the clients to contact to be
pointing at Squid, not the origin servers.

Squid passes on the domain name it received from the client. Examples
below using your current config ...


> This is:
>
> ticket.mydomian.lan ----------------------------> Server  1
> php.mydomian.lan ------------------------------> Server 2
>
> site1.mydomain.lan --------------------------------> squid
> site2.mydomian.lan --------------------------------> squid
>
> for my config i expect that when squid receive site1 go to
> ticket.mydomain.lan
> and for site2 go to php.mydomain.lan
>

Then site1.* and site2.* are the domains which those origin servers need
to be hosting - not ticket.* or php.*.

The request flow looks like this:

* client requests http://site1.mydomain.lan/ which goes to Squid because
A for that domain is Squid IP.

* Squid sends request for http://site1.mydomain.lan/ to server
ticket.mydomain.lan because cache_peer_access said it was allowed there.

* Server ticket.mydomain.lan receives request for
http://site1.mydomain.lan/ from Squid.


At no point does any URL or HTTP message contain "ticket.mydomain.lan".
I think this is where you are getting confused - thinking that the
origin server names mean something when they do not.

You do *not* need a domain DNS entries to point at the origin for that
origin to provide responses for it.


This is also why you need to test the setup which will actually be used
when the proxy is made to be "in production". Testing with fake domain
setup only ensures the fake domains work, the reals ones may be fatally
broken.

Amos


From Edward.Cheadle at cambiahealth.com  Fri Aug 10 15:51:09 2018
From: Edward.Cheadle at cambiahealth.com (Cheadle, Edward)
Date: Fri, 10 Aug 2018 15:51:09 +0000
Subject: [squid-users] Squid.conf Includes
Message-ID: <07ED46E0-C1D0-43A7-85B0-F83CE92B7A6D@contoso.com>

I am very new to squid and have been trying to research an issue with the squid.conf file.  I see you can split the squid.conf file into different a number of different files using includes.

If I do split the rules up, does it increase the speed of processing the rules?    I was told it does, but in looking at information on the squid site, in how rules are processed, I can?t find anything that would lead me to believe that splitting out the rules into separate files would speed anything up.

The reason this is an issue, is because on AWS we have a load balancer and we spin up an instance and if it takes too long it tends to stop the instance.

IMPORTANT NOTICE: This communication, including any attachment, contains information that may be confidential or privileged, and is intended solely for the entity or individual to whom it is addressed.  If you are not the intended recipient, you should delete this message and are hereby notified that any disclosure, copying, or distribution of this message is strictly prohibited.  Nothing in this email, including any attachment, is intended to be a legally binding signature.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180810/3762cc65/attachment.htm>

From squid3 at treenet.co.nz  Fri Aug 10 16:04:04 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 11 Aug 2018 04:04:04 +1200
Subject: [squid-users] Squid.conf Includes
In-Reply-To: <07ED46E0-C1D0-43A7-85B0-F83CE92B7A6D@contoso.com>
References: <07ED46E0-C1D0-43A7-85B0-F83CE92B7A6D@contoso.com>
Message-ID: <dfae49dc-55d7-d6c9-9e79-6ba93d03e90c@treenet.co.nz>

On 11/08/18 03:51, Cheadle, Edward wrote:
> I am very new to squid and have been trying to research an issue with
> the squid.conf file.? I see you can split the squid.conf file into
> different a number of different files using includes.
> 
> ?
> 
> If I do split the rules up, does it increase the speed of processing the
> rules???? I was told it does, but in looking at information on the squid
> site, in how rules are processed, I can?t find anything that would lead
> me to believe that splitting out the rules into separate files would
> speed anything up.
> 

It does not speed up config loading AFAIK. It just simplifies
administration of certain installation and policy designs.

Amos


From rousskov at measurement-factory.com  Fri Aug 10 16:08:00 2018
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Fri, 10 Aug 2018 10:08:00 -0600
Subject: [squid-users] Squid.conf Includes
In-Reply-To: <07ED46E0-C1D0-43A7-85B0-F83CE92B7A6D@contoso.com>
References: <07ED46E0-C1D0-43A7-85B0-F83CE92B7A6D@contoso.com>
Message-ID: <ec9e6eed-05cf-b3bd-6a0b-37a0608ee820@measurement-factory.com>

On 08/10/2018 09:51 AM, Cheadle, Edward wrote:

> If I do split the rules up, does it increase the speed of processing the
> rules?

If by "processing" you mean applying configured rules to traffic at
runtime, then the answer is "no". At runtime, Squid uses compiled rules,
and compiled rule application/checking speed does not depend on where
the rule were loaded/compiled from.


> I was told it does, but in looking at information on the squid
> site, in how rules are processed, I can?t find anything that would lead
> me to believe that splitting out the rules into separate files would
> speed anything up.

If the deployment environment loads/reads few large files slower than it
loads/reads many small files, then it is possible that using many small
configuration files will speed up Squid configuration.

Also, loading lots of ACL values/parameters from a file might be faster
than loading lots of ACL values/parameters embedded in squid.conf
(because it might be easier for Squid to find where each value
starts/ends in an external parameter file), but I have not tested that
theory, and, again, this theory only applies to Squid (re)configuration
delay, not runtime processing/performance.


> The reason this is an issue, is because on AWS we have a load balancer
> and we spin up an instance and if it takes too long it tends to stop the
> instance.

What is the approximate total size of your Squid configuration,
including all the external files that Squid has to load/parse while
configuring itself? What is the current startup delay with a
trivial/small rule set? What is the additional startup delay from
parsing all those rules?

Alex.


From piuschungath at gmail.com  Fri Aug 10 18:05:25 2018
From: piuschungath at gmail.com (pius)
Date: Fri, 10 Aug 2018 13:05:25 -0500 (CDT)
Subject: [squid-users] Have issue with "https_port ssl-bump intercept"
Message-ID: <1533924325185-0.post@n4.nabble.com>

I am getting IP address of the client instead of the domain name I requested. 

I am trying curl -iv https://www.google.com from a client machine
(10.222.17.106). I am not getting google.com in the access log and getting
TCP_DENIED. Looks like traffic is blocked before checking the certificate( I
am not sure ). And HTTP works fine (curl -iv http://www.google.com). I have
included LOG for from both requests. Please help.

##############
HTTPS REQUEST
1533917193.498      0 10.222.25.60 TCP_DENIED/200 0 CONNECT
10.222.17.106:3130 - HIER_NONE/- -
##############
HTTP REQUEST
1533917208.934     35 10.222.25.60 TCP_MISS/200 11561 GET
http://www.google.com/ - HIER_DIRECT/216.58.212.100 text/html 
##############




################################################################################
Here is my squid.conf
###############
http_port 3128

http_port 0.0.0.0:3129 ssl-bump  \
  cert=/etc/squid/ssl_cert/cert.pem \
  generate-host-certificates=on dynamic_cert_mem_cache_size=4MB

https_port 0.0.0.0:3130 ssl-bump intercept \
  cert=/etc/squid/ssl_cert/cert.pem \
  generate-host-certificates=on dynamic_cert_mem_cache_size=4MB

acl step1 at_step SslBump1
acl step2 at_step SslBump2
acl ssl_exclude_domains ssl::server_name "/etc/squid/exclude_domains.conf"

ssl_bump splice localhost
ssl_bump peek step1 all
ssl_bump splice ssl_exclude_domains
ssl_bump stare step2 all
ssl_bump bump all



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From erdosain9 at gmail.com  Fri Aug 10 18:13:06 2018
From: erdosain9 at gmail.com (erdosain9)
Date: Fri, 10 Aug 2018 13:13:06 -0500 (CDT)
Subject: [squid-users] Squid as reverse proxy for two or more webs
In-Reply-To: <1055c185-d668-6530-756d-caf5be0a13a9@treenet.co.nz>
References: <1533906908681-0.post@n4.nabble.com>
 <53cf93d8-0b08-ce56-5467-310c1a8acd3e@treenet.co.nz>
 <1533911191967-0.post@n4.nabble.com>
 <201808101636.28808.Antony.Stone@squid.open.source.it>
 <1533912993198-0.post@n4.nabble.com>
 <1055c185-d668-6530-756d-caf5be0a13a9@treenet.co.nz>
Message-ID: <1533924786679-0.post@n4.nabble.com>

Thanks to all!!
Now is working fine.

Just, one question to know... i make this accessible from the internet...
so, i create some acl 0.0.0.0/0 and it's working.
But.. this is a security issue??? or it's ok declare that ACL.
Thanks to all.



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From rousskov at measurement-factory.com  Fri Aug 10 18:27:57 2018
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Fri, 10 Aug 2018 12:27:57 -0600
Subject: [squid-users] Have issue with "https_port ssl-bump intercept"
In-Reply-To: <1533924325185-0.post@n4.nabble.com>
References: <1533924325185-0.post@n4.nabble.com>
Message-ID: <35064290-e6e6-569a-6c27-5f25624e9735@measurement-factory.com>

On 08/10/2018 12:05 PM, pius wrote:
> I am getting IP address of the client instead of the domain name I requested. 

I suspect you are getting your Squid https_port address
(10.222.17.106:3130) rather than the client IP address (10.222.25.60).
Logging Squid IP instead of the intended server IP feels wrong to me,
but that is not why things do not otherwise "work" in your test.

Your test request is probably not getting through because your
http_access rules (or equivalent) deny the (fake) CONNECT request to
216.58.212.100 (or whatever one of the www.google.com server IPs is in
your environment). Check your access control rules while keeping in mind
that the initial (i.e. step1) fake CONNECT request on an intercepting
https_port has nothing but TCP/IP-level information.


HTH,

Alex.


> I am trying curl -iv https://www.google.com from a client machine
> (10.222.17.106). I am not getting google.com in the access log and getting
> TCP_DENIED. Looks like traffic is blocked before checking the certificate( I
> am not sure ). And HTTP works fine (curl -iv http://www.google.com). I have
> included LOG for from both requests. Please help.
> 
> ##############
> HTTPS REQUEST
> 1533917193.498      0 10.222.25.60 TCP_DENIED/200 0 CONNECT
> 10.222.17.106:3130 - HIER_NONE/- -
> ##############
> HTTP REQUEST
> 1533917208.934     35 10.222.25.60 TCP_MISS/200 11561 GET
> http://www.google.com/ - HIER_DIRECT/216.58.212.100 text/html 
> ##############
> 
> 
> 
> 
> ################################################################################
> Here is my squid.conf
> ###############
> http_port 3128
> 
> http_port 0.0.0.0:3129 ssl-bump  \
>   cert=/etc/squid/ssl_cert/cert.pem \
>   generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
> 
> https_port 0.0.0.0:3130 ssl-bump intercept \
>   cert=/etc/squid/ssl_cert/cert.pem \
>   generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
> 
> acl step1 at_step SslBump1
> acl step2 at_step SslBump2
> acl ssl_exclude_domains ssl::server_name "/etc/squid/exclude_domains.conf"
> 
> ssl_bump splice localhost
> ssl_bump peek step1 all
> ssl_bump splice ssl_exclude_domains
> ssl_bump stare step2 all
> ssl_bump bump all
> 


From piuschungath at gmail.com  Fri Aug 10 19:04:28 2018
From: piuschungath at gmail.com (pius)
Date: Fri, 10 Aug 2018 14:04:28 -0500 (CDT)
Subject: [squid-users] Have issue with "https_port ssl-bump intercept"
In-Reply-To: <35064290-e6e6-569a-6c27-5f25624e9735@measurement-factory.com>
References: <1533924325185-0.post@n4.nabble.com>
 <35064290-e6e6-569a-6c27-5f25624e9735@measurement-factory.com>
Message-ID: <1533927868704-0.post@n4.nabble.com>

Hi,

Thanks for the reply. 

I had an ACL whitelist for IPs. I tried the test again removing that. 

Now I get an error

TAG_NONE/200 0 CONNECT. Still, I am not getting server IP or domain name and
got squid IP instead. (10.222.17.106:3130).

Does that mean, the request is still blocked in step 1 Or is that Google
won't accept fake CONNECT request? 

I saw documentation to use DNS server on the same server of squid







--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From rousskov at measurement-factory.com  Fri Aug 10 20:28:04 2018
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Fri, 10 Aug 2018 14:28:04 -0600
Subject: [squid-users] Have issue with "https_port ssl-bump intercept"
In-Reply-To: <1533927868704-0.post@n4.nabble.com>
References: <1533924325185-0.post@n4.nabble.com>
 <35064290-e6e6-569a-6c27-5f25624e9735@measurement-factory.com>
 <1533927868704-0.post@n4.nabble.com>
Message-ID: <a5b0cd00-a61d-f31d-8fe2-61b3397f23c3@measurement-factory.com>

On 08/10/2018 01:04 PM, pius wrote:

> I had an ACL whitelist for IPs. I tried the test again removing that. 

Sounds more like a blacklist than whitelist if removing the rule
_allows_ the request.


> Now I get an error TAG_NONE/200 0 CONNECT.

That is a good sign. The fake CONNECT request was not denied. Please
post all the access.log lines as you did before to show the whole picture.

And what does curl say?


> Still, I am not getting server IP or domain name and
> got squid IP instead. (10.222.17.106:3130).

Ignore that detail for now.


> Does that mean, the request is still blocked in step 1 Or is that Google
> won't accept fake CONNECT request?

Neither, and Google does not receive CONNECT requests (fake or real) --
they are handled internally by Squid.

Please see the following wiki page for what is really going on at
various steps: https://wiki.squid-cache.org/Features/SslPeekAndSplice


HTH,

Alex.


From Antony.Stone at squid.open.source.it  Fri Aug 10 21:43:57 2018
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Fri, 10 Aug 2018 23:43:57 +0200
Subject: [squid-users] Squid as reverse proxy for two or more webs
In-Reply-To: <1533924786679-0.post@n4.nabble.com>
References: <1533906908681-0.post@n4.nabble.com>
 <1055c185-d668-6530-756d-caf5be0a13a9@treenet.co.nz>
 <1533924786679-0.post@n4.nabble.com>
Message-ID: <201808102343.57900.Antony.Stone@squid.open.source.it>

On Friday 10 August 2018 at 20:13:06, erdosain9 wrote:

> Thanks to all!!
> Now is working fine.
> 
> Just, one question to know... i make this accessible from the internet...
> so, i create some acl 0.0.0.0/0 and it's working.
> But.. this is a security issue??? or it's ok declare that ACL.

If you want everyone / anyone on the Intenet to be able to get to your 
servers, that is the obvious (and correct) ACL to use.


Regards,


Antony.

-- 
Bill Gates has personally assured the Spanish Academy that he will never allow 
the upside-down question mark to disappear from Microsoft word-processing 
programs, which must be reassuring for millions of Spanish-speaking people, 
though just a piddling afterthought as far as he's concerned.

 - Lynne Truss, "Eats, Shoots and Leaves"

                                                   Please reply to the list;
                                                         please *don't* CC me.


From vh1988 at yahoo.com.ar  Fri Aug 10 23:21:32 2018
From: vh1988 at yahoo.com.ar (Julian Perconti)
Date: Fri, 10 Aug 2018 20:21:32 -0300
Subject: [squid-users] [squid-announce] Squid 4.2 is available
In-Reply-To: <28241c64-b221-ca2f-1e68-6ed28c332174@treenet.co.nz>
References: <28241c64-b221-ca2f-1e68-6ed28c332174@treenet.co.nz>
Message-ID: <006701d43100$e23e1ef0$a6ba5cd0$@yahoo.com.ar>

> De: squid-users <squid-users-bounces at lists.squid-cache.org> En nombre de
> Amos Jeffries
> Enviado el: viernes, 10 de agosto de 2018 02:41
> Para: squid-announce at lists.squid-cache.org
> Asunto: [squid-users] [squid-announce] Squid 4.2 is available
> 
> The Squid HTTP Proxy team is very pleased to announce the availability of the
> Squid-4.2 release!
> 
> 

Works great! 
And I realized an important performance improvement.

Thank You!

> 
> 
> Amos Jeffries
> _______________________________________________
> squid-announce mailing list
> squid-announce at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-announce
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



From Walter.H at mathemainzel.info  Sat Aug 11 09:46:32 2018
From: Walter.H at mathemainzel.info (Walter H.)
Date: Sat, 11 Aug 2018 11:46:32 +0200
Subject: [squid-users] [squid-announce] Squid 4.2 is available
In-Reply-To: <28241c64-b221-ca2f-1e68-6ed28c332174@treenet.co.nz>
References: <28241c64-b221-ca2f-1e68-6ed28c332174@treenet.co.nz>
Message-ID: <5B6EB078.6070608@mathemainzel.info>

On 10.08.2018 07:41, Amos Jeffries wrote:
> The Squid HTTP Proxy team is very pleased to announce the availability
> of the Squid-4.2 release!
>
>

will there be a RPM for latest CentOS 6 available?

Walter

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 3491 bytes
Desc: S/MIME Cryptographic Signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180811/4a251a95/attachment.bin>

From rafal.sanocki at gmail.com  Sat Aug 11 10:09:45 2018
From: rafal.sanocki at gmail.com (=?UTF-8?B?UmFmYcWCIFM=?=)
Date: Sat, 11 Aug 2018 12:09:45 +0200
Subject: [squid-users] Have issue with "https_port ssl-bump intercept"
In-Reply-To: <35064290-e6e6-569a-6c27-5f25624e9735@measurement-factory.com>
References: <1533924325185-0.post@n4.nabble.com>
 <35064290-e6e6-569a-6c27-5f25624e9735@measurement-factory.com>
Message-ID: <CAJn2xVVwRTSjr12rjLa+8exD6-JC0tJEuvSVTeR=f0qdhZ3ynA@mail.gmail.com>

W dniu pt., 10.08.2018 o 20:28 Alex Rousskov <
rousskov at measurement-factory.com> napisa?(a):

> On 08/10/2018 12:05 PM, pius wrote:
> > I am getting IP address of the client instead of the domain name I
> requested.
>
> I suspect you are getting your Squid https_port address
> (10.222.17.106:3130) rather than the client IP address (10.222.25.60).
> Logging Squid IP instead of the intended server IP feels wrong to me,
> but that is not why things do not otherwise "work" in your test.
>
> Your test request is probably not getting through because your
> http_access rules (or equivalent) deny the (fake) CONNECT request to
> 216.58.212.100 (or whatever one of the www.google.com server IPs is in
> your environment). Check your access control rules while keeping in mind
> that the initial (i.e. step1) fake CONNECT request on an intercepting
> https_port has nothing but TCP/IP-level information.
>
>
> HTH,
>
> Alex.
>
>
> > I am trying curl -iv https://www.google.com from a client machine
> > (10.222.17.106). I am not getting google.com in the access log and
> getting
> > TCP_DENIED. Looks like traffic is blocked before checking the
> certificate( I
> > am not sure ). And HTTP works fine (curl -iv http://www.google.com). I
> have
> > included LOG for from both requests. Please help.
> >
> > ##############
> > HTTPS REQUEST
> > 1533917193.498      0 10.222.25.60 TCP_DENIED/200 0 CONNECT
> > 10.222.17.106:3130 - HIER_NONE/- -
> > ##############
> > HTTP REQUEST
> > 1533917208.934     35 10.222.25.60 TCP_MISS/200 11561 GET
> > http://www.google.com/ - HIER_DIRECT/216.58.212.100 text/html
> > ##############
> >
> >
> >
> >
> >
> ################################################################################
> > Here is my squid.conf
> > ###############
> > http_port 3128
> >
> > http_port 0.0.0.0:3129 ssl-bump  \
> >   cert=/etc/squid/ssl_cert/cert.pem \
> >   generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
> >
> > https_port 0.0.0.0:3130 ssl-bump intercept \
> >   cert=/etc/squid/ssl_cert/cert.pem \
> >   generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
> >
> > acl step1 at_step SslBump1
> > acl step2 at_step SslBump2
> > acl ssl_exclude_domains ssl::server_name
> "/etc/squid/exclude_domains.conf"
> >
> > ssl_bump splice localhost
> > ssl_bump peek step1 all
> > ssl_bump splice ssl_exclude_domains
> > ssl_bump stare step2 all
> > ssl_bump bump all
> >
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180811/f701b21c/attachment.htm>

From squid3 at treenet.co.nz  Sat Aug 11 13:26:40 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sun, 12 Aug 2018 01:26:40 +1200
Subject: [squid-users] Squid as reverse proxy for two or more webs
In-Reply-To: <201808102343.57900.Antony.Stone@squid.open.source.it>
References: <1533906908681-0.post@n4.nabble.com>
 <1055c185-d668-6530-756d-caf5be0a13a9@treenet.co.nz>
 <1533924786679-0.post@n4.nabble.com>
 <201808102343.57900.Antony.Stone@squid.open.source.it>
Message-ID: <42ad5949-f3d3-6a32-d1b9-59ffd460aa04@treenet.co.nz>

On 11/08/18 09:43, Antony Stone wrote:
> On Friday 10 August 2018 at 20:13:06, erdosain9 wrote:
> 
>> Thanks to all!!
>> Now is working fine.
>>
>> Just, one question to know... i make this accessible from the internet...
>> so, i create some acl 0.0.0.0/0 and it's working.

That is almost but deceptively not quite the same as "allow all".

>> But.. this is a security issue??? or it's ok declare that ACL.
> 
> If you want everyone / anyone on the Intenet to be able to get to your 
> servers, that is the obvious (and correct) ACL to use.

No, sorry. It is not.

The correct config is to use:

 http_access allow foo

Where "foo" is the same ACLs you use on cache_peer_access to determine
which traffic goes to the peers.

That way Squid is able to block random other domains that virus scans
etc try to use to detect open proxies.

Amos


From Antony.Stone at squid.open.source.it  Sat Aug 11 13:35:14 2018
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Sat, 11 Aug 2018 15:35:14 +0200
Subject: [squid-users] Squid as reverse proxy for two or more webs
In-Reply-To: <42ad5949-f3d3-6a32-d1b9-59ffd460aa04@treenet.co.nz>
References: <1533906908681-0.post@n4.nabble.com>
 <201808102343.57900.Antony.Stone@squid.open.source.it>
 <42ad5949-f3d3-6a32-d1b9-59ffd460aa04@treenet.co.nz>
Message-ID: <201808111535.14848.Antony.Stone@squid.open.source.it>

On Saturday 11 August 2018 at 15:26:40, Amos Jeffries wrote:

> On 11/08/18 09:43, Antony Stone wrote:
> > On Friday 10 August 2018 at 20:13:06, erdosain9 wrote:
> >> Thanks to all!!
> >> Now is working fine.
> >> 
> >> Just, one question to know... i make this accessible from the
> >> internet... so, i create some acl 0.0.0.0/0 and it's working.
> 
> That is almost but deceptively not quite the same as "allow all".

Nice description :)

> >> But.. this is a security issue??? or it's ok declare that ACL.
> > 
> > If you want everyone / anyone on the Intenet to be able to get to your
> > servers, that is the obvious (and correct) ACL to use.
> 
> No, sorry. It is not.
> 
> The correct config is to use:
> 
>  http_access allow foo
> 
> Where "foo" is the same ACLs you use on cache_peer_access to determine
> which traffic goes to the peers.
> 
> That way Squid is able to block random other domains that virus scans
> etc try to use to detect open proxies.

Hm, I had thought that since this Squid was only configured to be a reverse 
proxy for the two servers under discussion, allowing access from anywhere 
would still only offer those two destinations?

It wouldn't offer forward-proxy services with that configuration, surely?


Antony.

-- 
Wanted: telepath.   You know where to apply.

                                                   Please reply to the list;
                                                         please *don't* CC me.


From squid3 at treenet.co.nz  Sun Aug 12 18:20:12 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Mon, 13 Aug 2018 06:20:12 +1200
Subject: [squid-users] Squid as reverse proxy for two or more webs
In-Reply-To: <201808111535.14848.Antony.Stone@squid.open.source.it>
References: <1533906908681-0.post@n4.nabble.com>
 <201808102343.57900.Antony.Stone@squid.open.source.it>
 <42ad5949-f3d3-6a32-d1b9-59ffd460aa04@treenet.co.nz>
 <201808111535.14848.Antony.Stone@squid.open.source.it>
Message-ID: <990689be-6237-c0c3-d7c2-f404124116b3@treenet.co.nz>

On 12/08/18 01:35, Antony Stone wrote:
> On Saturday 11 August 2018 at 15:26:40, Amos Jeffries wrote:
> 
>> On 11/08/18 09:43, Antony Stone wrote:
>>> On Friday 10 August 2018 at 20:13:06, erdosain9 wrote:
>>>> Thanks to all!!
>>>> Now is working fine.
>>>>
>>>> Just, one question to know... i make this accessible from the
>>>> internet... so, i create some acl 0.0.0.0/0 and it's working.
>>
>> That is almost but deceptively not quite the same as "allow all".
> 
> Nice description :)
> 
>>>> But.. this is a security issue??? or it's ok declare that ACL.
>>>
>>> If you want everyone / anyone on the Intenet to be able to get to your
>>> servers, that is the obvious (and correct) ACL to use.
>>
>> No, sorry. It is not.
>>
>> The correct config is to use:
>>
>>  http_access allow foo
>>
>> Where "foo" is the same ACLs you use on cache_peer_access to determine
>> which traffic goes to the peers.
>>
>> That way Squid is able to block random other domains that virus scans
>> etc try to use to detect open proxies.
> 
> Hm, I had thought that since this Squid was only configured to be a reverse 
> proxy for the two servers under discussion, allowing access from anywhere 
> would still only offer those two destinations?
> 
> It wouldn't offer forward-proxy services with that configuration, surely?

That is an implicit default, yes. But can be altered by several common
setups. We don't know what erdosain9's full config is (or will become),
so do not know if one of those cases is happening (or will happen later).

It is generally better to go with this explicit allow/deny than relying
on the implicit behaviour. One can always move to the implicit later if
its needed for performance - but backtracking may surprise users if they
were relying on the broken bits being broken.

Amos


From vh1988 at yahoo.com.ar  Sun Aug 12 22:09:01 2018
From: vh1988 at yahoo.com.ar (Julian Perconti)
Date: Sun, 12 Aug 2018 19:09:01 -0300
Subject: [squid-users] About SSL peek-n-splice/bump configurations
Message-ID: <000301d43289$14ed4770$3ec7d650$@yahoo.com.ar>

Hi,

I would like to know which of these two cfg's are "better" or "more secure"
when a site/domain is spliced, bumped, etc.

Here the lines...

# mandatory lines:

acl noBumpSites ssl::server_name_regex -i "/etc/squid/url.nobump"

acl step1 at_step SslBump1
acl step2 at_step SslBump2
acl step3 at_step SslBump3

_______________

# ssl_bump option 1: (with this I don't see the domain in "TUNNEL" line,
just the IP addr.)

ssl_bump peek step1
ssl_bump peek step2 noBumpSites
ssl_bump splice step3 noBumpSites
ssl_bump stare step2
ssl_bump bump step3

# ssl_bump option 2: (with this I see the domain in "TUNNEL" line.)

ssl_bump peek step1
ssl_bump splice noBumpSites
ssl_bump bump all


And (if possible) could anyone explain the differnce between these 2 cfg's ?

The peek-n-splice config (for me) was never clearly.

Thank you in advance,

All the best



From rousskov at measurement-factory.com  Sun Aug 12 23:49:58 2018
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Sun, 12 Aug 2018 17:49:58 -0600
Subject: [squid-users] About SSL peek-n-splice/bump configurations
In-Reply-To: <000301d43289$14ed4770$3ec7d650$@yahoo.com.ar>
References: <000301d43289$14ed4770$3ec7d650$@yahoo.com.ar>
Message-ID: <58014777-2b9c-7630-80dd-877c2d2af9d2@measurement-factory.com>

On 08/12/2018 04:09 PM, Julian Perconti wrote:

> I would like to know which of these two cfg's are "better" or "more secure"
> when a site/domain is spliced, bumped, etc.

It is impossible to answer that question without knowing how _you_
define "better" or "more secure".


> acl noBumpSites ssl::server_name_regex -i "/etc/squid/url.nobump"

> # ssl_bump option 1: (with this I don't see the domain in "TUNNEL" line,
> just the IP addr.)
> 
> ssl_bump peek step1
> ssl_bump peek step2 noBumpSites
> ssl_bump splice step3 noBumpSites
> ssl_bump stare step2
> ssl_bump bump step3
> 
> # ssl_bump option 2: (with this I see the domain in "TUNNEL" line.)
> 
> ssl_bump peek step1
> ssl_bump splice noBumpSites
> ssl_bump bump all
> 
> 
> And (if possible) could anyone explain the differnce between these 2 cfg's ?

Bugs notwithstanding, Option 1 looks at the TLS server Hello details
(step2) before splicing or bumping the connections (at step3). Option 2
does not -- it splices or bumps based on TLS client Hello info only.

Option 1 should give Squid/you more information about the server when
splicing the two connections. For example, you can use server
certificate info during step3 and when logging.

Option 1 should give the client more information about the server when
bumping the client -- the client will get a mimicked server certificate
detail with this option.

I believe the information obtained at each step is documented at
https://wiki.squid-cache.org/Features/SslPeekAndSplice

Please note that your

  ssl_bump splice step3 noBumpSites

is a bit risky because your noBumpSites may match differently on each
step (as it gets more reliable information). It could match at step2 but
not match at step3 or vice versa, but the decision to splice (or bump)
is essentially made at step2 -- if you peeked at step2, then you should
be splicing or terminating at step3 (and if you stared at step2, then
you should be bumping or terminating at step3). Your rules may not
follow that principle if noBumpSites matching changes.


> with Option 1 I don't see the domain in "TUNNEL" line,
> just the IP addr.)

I doubt that is how it is supposed to work. When splicing, Option 1
should have the same or more information so it should log the domain
name if Option 2 has the domain name. If you are comparing log lines for
identical transactions, then this could be a Squid bug.

Alex.


From jrbmanzo.epics at gmail.com  Mon Aug 13 00:30:30 2018
From: jrbmanzo.epics at gmail.com (John Renzi Manzo)
Date: Mon, 13 Aug 2018 08:30:30 +0800
Subject: [squid-users] Help Team Squid
Message-ID: <CAPWPuhpbpMJu4jBYfxvb=oM3uEJGL3HOqtLg+T7fNZFkhz+fkQ@mail.gmail.com>

Good day team squid,
                 Please help me,
                 I am using squid 3.0 in our windows server 2012 r2, i
already configure it.
                 Ban sites and allow specific ip addresses to browse all
sites, but the problem is is i cannot open our website. Please see attached
file for your reference.
                  What will i do to access our website?
                  Thank you in advance.

Renz
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180813/ef5737f6/attachment.htm>

From vh1988 at yahoo.com.ar  Mon Aug 13 00:57:01 2018
From: vh1988 at yahoo.com.ar (Julian Perconti)
Date: Sun, 12 Aug 2018 21:57:01 -0300
Subject: [squid-users] About SSL peek-n-splice/bump configurations
In-Reply-To: <58014777-2b9c-7630-80dd-877c2d2af9d2@measurement-factory.com>
References: <000301d43289$14ed4770$3ec7d650$@yahoo.com.ar>
 <58014777-2b9c-7630-80dd-877c2d2af9d2@measurement-factory.com>
Message-ID: <001801d432a0$8d102a30$a7307e90$@yahoo.com.ar>

> -----Mensaje original-----
> De: Alex Rousskov <rousskov at measurement-factory.com>
> Enviado el: domingo, 12 de agosto de 2018 20:50
> Para: Julian Perconti <vh1988 at yahoo.com.ar>; squid-users at lists.squid-
> cache.org
> Asunto: Re: [squid-users] About SSL peek-n-splice/bump configurations
> 
> On 08/12/2018 04:09 PM, Julian Perconti wrote:
> 
> > I would like to know which of these two cfg's are "better" or "more secure"
> > when a site/domain is spliced, bumped, etc.
> 
> It is impossible to answer that question without knowing how _you_ define
> "better" or "more secure".

First of all: I am relative new in the "ssl/tls filtering world". There are many things I dont understand very well yet.

You might be right and I probably wrong. 

I tried to meant, "security" from the client-side accessing to a non-bumped or spliced site, i.g.: bank website... client-side "privacy" or an a -real- man-in-the-middle attack due to squid in the middle.

Is well-known that there is no system /network/o.s. 100% secure but, I dont know why, I always thought or stil think that with a https proxy/filtering, the security or "the things" tooggles more risky if this one did not exist. Even squid 100% correctly configured and server well secured.

> 
> 
> > acl noBumpSites ssl::server_name_regex -i "/etc/squid/url.nobump"
> 
> > # ssl_bump option 1: (with this I don't see the domain in "TUNNEL"
> > line, just the IP addr.)
> >
> > ssl_bump peek step1
> > ssl_bump peek step2 noBumpSites
> > ssl_bump splice step3 noBumpSites
> > ssl_bump stare step2
> > ssl_bump bump step3
> >
> > # ssl_bump option 2: (with this I see the domain in "TUNNEL" line.)
> >
> > ssl_bump peek step1
> > ssl_bump splice noBumpSites
> > ssl_bump bump all
> >
> >
> > And (if possible) could anyone explain the differnce between these 2 cfg's
> ?
> 
> Bugs notwithstanding, Option 1 looks at the TLS server Hello details
> (step2) before splicing or bumping the connections (at step3). Option 2 does
> not -- it splices or bumps based on TLS client Hello info only.
> 

What does squid when I dont specify the step?

For example:

What does squid do with..:
ssl_bump splice step3 noBumpSites

...And what it do instead with this?:
ssl_bump splice noBumpSites

> Option 1 should give Squid/you more information about the server when
> splicing the two connections. For example, you can use server certificate info
> during step3 and when logging.
> 
> Option 1 should give the client more information about the server when
> bumping the client -- the client will get a mimicked server certificate detail
> with this option.
> 
> I believe the information obtained at each step is documented at
> https://wiki.squid-cache.org/Features/SslPeekAndSplice

Yes, but many things are pretty complex to understand well, even making tests.

> 
> Please note that your
> 
>   ssl_bump splice step3 noBumpSites
> 
> is a bit risky because your noBumpSites may match differently on each step
> (as it gets more reliable information). It could match at step2 but not match
> at step3 or vice versa, but the decision to splice (or bump) is essentially made
> at step2 -- if you peeked at step2, then you should be splicing or terminating
> at step3 (and if you stared at step2, then you should be bumping or
> terminating at step3). Your rules may not follow that principle if noBumpSites
> matching changes.

I Will consider this. 

So, Would You prefer option 2? For now, I am testing that option.

>
> 
> > with Option 1 I don't see the domain in "TUNNEL" line, just the IP
> > addr.)
> 
> I doubt that is how it is supposed to work. When splicing, Option 1 should
> have the same or more information so it should log the domain name if
> Option 2 has the domain name. If you are comparing log lines for identical
> transactions, then this could be a Squid bug.
> 

I dont know, I just tell what happen in the access.log when I switching between these ssl_bump configs.

> Alex.

Thank You

P.S.: squid versi?n 4.2 on debian 9.5



From squid3 at treenet.co.nz  Mon Aug 13 01:04:21 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Mon, 13 Aug 2018 13:04:21 +1200
Subject: [squid-users] Help Team Squid
In-Reply-To: <CAPWPuhpbpMJu4jBYfxvb=oM3uEJGL3HOqtLg+T7fNZFkhz+fkQ@mail.gmail.com>
References: <CAPWPuhpbpMJu4jBYfxvb=oM3uEJGL3HOqtLg+T7fNZFkhz+fkQ@mail.gmail.com>
Message-ID: <6aa280f5-4430-04f4-3470-b2d33743e790@treenet.co.nz>

On 13/08/18 12:30, John Renzi Manzo wrote:
> Good day team squid,
> ? ? ? ? ? ? ? ? ?Please help me,
> ? ? ? ? ? ? ? ? ?I am using squid 3.0 in our windows server 2012 r2, i
> already configure it.

First thing is please try an upgrade. Squid-3.0 was deprecated in 2010.

For more current packages see
<https://wiki.squid-cache.org/KnowledgeBase/Windows>

> ? ? ? ? ? ? ? ? ?Ban sites and allow specific ip addresses to browse all
> sites, but the problem is is i cannot open our website. Please see
> attached file for your reference.

No attached config file.


Amos


From rousskov at measurement-factory.com  Mon Aug 13 05:00:41 2018
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Sun, 12 Aug 2018 23:00:41 -0600
Subject: [squid-users] About SSL peek-n-splice/bump configurations
In-Reply-To: <001801d432a0$8d102a30$a7307e90$@yahoo.com.ar>
References: <000301d43289$14ed4770$3ec7d650$@yahoo.com.ar>
 <58014777-2b9c-7630-80dd-877c2d2af9d2@measurement-factory.com>
 <001801d432a0$8d102a30$a7307e90$@yahoo.com.ar>
Message-ID: <6eb5660d-8025-eedd-3ed9-47d30bf22e62@measurement-factory.com>

On 08/12/2018 06:57 PM, Julian Perconti wrote:
>> De: Alex Rousskov <rousskov at measurement-factory.com>
>> Enviado el: domingo, 12 de agosto de 2018 20:50
>> Para: Julian Perconti <vh1988 at yahoo.com.ar>; squid-users at lists.squid-cache.org
>> Asunto: Re: [squid-users] About SSL peek-n-splice/bump configurations
>>
>> On 08/12/2018 04:09 PM, Julian Perconti wrote:
>>> I would like to know which of these two cfg's are "better" or "more secure"
>>> when a site/domain is spliced, bumped, etc.

>> It is impossible to answer that question without knowing how _you_ define
>> "better" or "more secure".


> I tried to meant, "security" from the client-side accessing to a
> non-bumped or spliced site, i.g.: bank website... client-side
> "privacy" or an a -real- man-in-the-middle attack due to squid in the
> middle.

A splicing Squid does not perform a man-in-the-middle attack on TLS or
HTTP traffic. It essentially acts as a TCP/IP-level proxy and can log
TLS handshake details. In some environments, doing all that improves
"privacy" and "security". In others, it makes things worse (for some
definition of "privacy" and "security").

A bumping Squid performs a man-in-the-middle attack on TLS traffic.
After a successful attack, it essentially acts as an HTTP-level proxy
and can log or even alter TLS and HTTP traffic. In some environments,
doing all that improves "privacy" and "security" (for some definition of
"privacy" and "security"). In others, it makes things worse.

You would have to ask a much more specific question to get a more
specific (but still correct) answer.


> Is well-known that there is no system /network/o.s. 100% secure but,
> I dont know why, I always thought or stil think that with a https
> proxy/filtering, the security or "the things" tooggles more risky if
> this one did not exist. Even squid 100% correctly configured and
> server well secured.

There are examples where deploying a splicing or even bumping Squid
improves security of the humans and/or machines that are trusting Squid
to examine and/or police their traffic. There are counter-examples as
well. And I am sure that many installations can be viewed as both,
depending on who gets to define "privacy", "security", and the "right
balance" between the two.


> What does squid when I dont specify the step?

Bugs notwithstanding, Squid should either

* bump if you were staring during the previous (explicitly configured)
step or

* splice otherwise (including cases when no previous step was explicitly
configured or existed).

I would not rely on this (correct) behavior without testing (at least)
your Squid version (at least). I know that early SslBump implementations
had bugs in that area.


> For example:
> 
> What does squid do with..:
> ssl_bump splice step3 noBumpSites

Assuming there are no other rules, Squid should splice at step1 (see the
"splice otherwise" rule above).


> ...And what it do instead with this?:
> ssl_bump splice noBumpSites

Assuming there are no other rules, Squid should splice at step1. It will
do that when noBumpSites matches (naturally) and if noBumpSites does not
match (per the "splice otherwise" rule above).


> So, Would You prefer option 2?

Sorry, I cannot answer this question -- too many unknown variables. It
is like asking a doctor whether she prefers to treat the patient with
drug A or drug B when the doctor does not know what the patient is
suffering from and what the patient's treatment preferences/goals are.


>>> with Option 1 I don't see the domain in "TUNNEL" line, just the IP
>>> addr.)

>> I doubt that is how it is supposed to work. When splicing, Option 1 should
>> have the same or more information so it should log the domain name if
>> Option 2 has the domain name. If you are comparing log lines for identical
>> transactions, then this could be a Squid bug.

> I dont know, I just tell what happen in the access.log when I
> switching between these ssl_bump configs.

Yes, and I am just describing what should be happening (IMO). If what is
actually happening bothers you, and it does not match what should be
happening, and nobody comes up with a better explanation, then consider
filing a bug report and working with developers to address the problem.


HTH,

Alex.


From piuschungath at gmail.com  Mon Aug 13 08:32:03 2018
From: piuschungath at gmail.com (pius)
Date: Mon, 13 Aug 2018 03:32:03 -0500 (CDT)
Subject: [squid-users] Have issue with "https_port ssl-bump intercept"
In-Reply-To: <a5b0cd00-a61d-f31d-8fe2-61b3397f23c3@measurement-factory.com>
References: <1533924325185-0.post@n4.nabble.com>
 <35064290-e6e6-569a-6c27-5f25624e9735@measurement-factory.com>
 <1533927868704-0.post@n4.nabble.com>
 <a5b0cd00-a61d-f31d-8fe2-61b3397f23c3@measurement-factory.com>
Message-ID: <1534149123813-0.post@n4.nabble.com>

Hi,

Thanks for the reply. I haven't got access to log on weekend, sorry about
the late reply.

I google about this error. I got some answer like connect message is in
plain text and squid is expecting a TCP communication and it gets rejected
in lower level before getting to step 2. I am not sure that maybe my issue.
Please check logs and let me know what I am doing wrong

####### curl #####
* About to connect() to proxy 10.222.17.106 port 3130 (#0)
*   Trying 10.222.17.106...
* Connected to 10.222.17.106 (10.222.17.106) port 3130 (#0)
* Establish HTTP proxy tunnel to www.google.com:443
> CONNECT www.google.com:443 HTTP/1.1
> Host: www.google.com:443
> User-Agent: curl/7.29.0
> Proxy-Connection: Keep-Alive
> 
* Recv failure: Connection reset by peer
* Received HTTP code 0 from proxy after CONNECT
* Connection #0 to host 10.222.17.106 left intact
curl: (56) Recv failure: Connection reset by peer

###### access.log ####
1534148669.183      0 10.222.25.60 TCP_DENIED/200 0 CONNECT
10.222.17.106:3130 - HIER_NONE/- -
############






--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From skupko.sk at gmail.com  Mon Aug 13 12:33:56 2018
From: skupko.sk at gmail.com (Peter Viskup)
Date: Mon, 13 Aug 2018 14:33:56 +0200
Subject: [squid-users] HTTP Request method CNT from Windows clients
Message-ID: <CAPa6PsEAZnzBQeUzMAfMt8R-q9K+fvN8xLcUatpFZNUgSNuAxg@mail.gmail.com>

Does anybody seen this in Squid logs already?
httpRqMethod CNT

There is no destination IP nor request host logged. All clients are
Windows machines. Requests are rejected due to not supported HTTP
method.

The complete log entry example:

13/Aug/2018:14:26:18 +0200 10.x.y.z 63740 -> - - responseTime=0
httpXFF=- httpRqProto=1.1 httpRqMethod=CNT httpRqHost=- httpURI=-
httpRef=- httpRsStatus=400 httpRqBytes=283 httpRsBytes=3688 httpUA="-"
httpRqCT="-" httpRsCT="text/html;charset=utf-8" httpRsServer=squid
mime=text/html icapResult=- icapTimeTotal=0 icapTimeRq=- icapTimeRs=-
squidStatus=NONE:HIER_NONE squidError=- squidErrorDetail=-
proxyPort=3128 proxyIP=10.x.c.c proxyNode=10.x.c.a sslBumpMode=-
sslSNI="-" sslClientProto="TLS/1.2" sslServerProto="-"
sslClientCipher="ECDHE-RSA-AES256-GCM-SHA384" sslServerCipher="-"
sslSubject="-" sslIssuer="-" sslCertErrors="-"

-- 
Peter


From piuschungath at gmail.com  Mon Aug 13 13:48:24 2018
From: piuschungath at gmail.com (pius)
Date: Mon, 13 Aug 2018 08:48:24 -0500 (CDT)
Subject: [squid-users] Have issue with "https_port ssl-bump intercept"
In-Reply-To: <1534149123813-0.post@n4.nabble.com>
References: <1533924325185-0.post@n4.nabble.com>
 <35064290-e6e6-569a-6c27-5f25624e9735@measurement-factory.com>
 <1533927868704-0.post@n4.nabble.com>
 <a5b0cd00-a61d-f31d-8fe2-61b3397f23c3@measurement-factory.com>
 <1534149123813-0.post@n4.nabble.com>
Message-ID: <1534168104650-0.post@n4.nabble.com>

Hi,

I made some improvement. I added "ssl_bump splice all" and now it passing
through the step 1, but I can't whitelist the domain I want to connect
through the squid now. I am getting a new error 


###### cache.log ###########
2018/08/13 13:37:02 kid1| SECURITY ALERT: Host header forgery detected on
local=10.222.17.106:3130 remote=10.222.25.60:59108 FD 14 flags=33
(intercepted port does not match 443)
2018/08/13 13:37:02 kid1| SECURITY ALERT: By user agent: curl/7.29.0
2018/08/13 13:37:02 kid1| SECURITY ALERT: on URL: www.google.com:443
2018/08/13 13:37:02 kid1| abandoning local=10.222.17.106:3130
remote=10.222.25.60:59108 FD 14 flags=33
#####################


Can you please help. 




--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From belle at bazuin.nl  Mon Aug 13 14:58:41 2018
From: belle at bazuin.nl (=?windows-1252?Q?L.P.H._van_Belle?=)
Date: Mon, 13 Aug 2018 16:58:41 +0200
Subject: [squid-users] Squid 4.2 is available ( debian stretch )
In-Reply-To: <28241c64-b221-ca2f-1e68-6ed28c332174@treenet.co.nz>
References: <28241c64-b221-ca2f-1e68-6ed28c332174@treenet.co.nz>
Message-ID: <vmime.5b719ca1.51e6.36b7c2675a3bf831@ms249-lin-003.rotterdam.bazuin.nl>

Hai, 

Thank you for the new release.

If people want to test against Debian, i've create Debian Stretch packages for Squid 4.2 today. 
I am testing them as we speak and if you want to test them, you can find them here: 
https://downloads.van-belle.nl 

I took the Debian squid GIT sources for this rebuild against Debian Stretch.
Build logs are avaible through the dowloads link.
Drop me a note how they are working, if they are ok, i'll put them on my repo.
I've keept all settings the default in these tests. Only enabled the "localnet" 

Im using the following systemd service settings. 

The defaults, +  ( systemctl edit squid.service ) 
# /etc/systemd/system/squid.service.d/override.conf
[Service]
# The default is 1024, increase this if needed.
LimitNOFILE=4096

For squid 4.1, i changed the logrotate file a bit. 
I added systemd part and changed reload to restart, due to assertion fail. 

A part of : /etc/logrotate.d/squid
        postrotate
            if [ -d /run/systemd/system ] && command systemctl >/dev/null 2>&1 && systemctl is-active --quiet squid.service; then
                systemctl reload squid.service
            elif [ -f /var/run/squid.pid ]; then
                test ! -e /var/run/squid.pid || test ! -x /usr/sbin/squid || /usr/sbin/squid -k rotate
            fi
        endscript

After the upgrade to 4.2, i change the restart back to reload, and no assertion failed anymore in 4.2 :-).  

My questions for 4.2 is: 
Anyone any idea why we see 2x "2018/08/13 16:30:57| Created PID file (/var/run/squid.pid)"  in the start up process?  
I notice this in the cache.log, i tested this with a normal start/stop and restart and reboot.

The Log part. ( from a restart ) 
2018/08/13 16:30:26 kid1| Preparing for shutdown after 0 requests
2018/08/13 16:30:26 kid1| Waiting 30 seconds for active connections to finish
2018/08/13 16:30:26 kid1| Closing HTTP(S) port [::]:3128
2018/08/13 16:30:26 kid1| Closing Pinger socket on FD 14
2018/08/13 16:30:33| Pinger exiting.
2018/08/13 16:30:57 kid1| Shutdown: NTLM authentication.
2018/08/13 16:30:57 kid1| Shutdown: Negotiate authentication.
2018/08/13 16:30:57 kid1| Shutdown: Digest authentication.
2018/08/13 16:30:57 kid1| Shutdown: Basic authentication.
2018/08/13 16:30:57 kid1| Shutting down...
2018/08/13 16:30:57 kid1| storeDirWriteCleanLogs: Starting...
2018/08/13 16:30:57 kid1|   Finished.  Wrote 0 entries.
2018/08/13 16:30:57 kid1|   Took 0.00 seconds (  0.00 entries/sec).
CPU Usage: 0.044 seconds = 0.044 user + 0.000 sys
Maximum Resident Size: 94112 KB
Page faults with physical i/o: 0
2018/08/13 16:30:57 kid1| Logfile: closing log daemon:/var/log/squid/access.log
2018/08/13 16:30:57 kid1| Logfile Daemon: closing log daemon:/var/log/squid/access.log
2018/08/13 16:30:57 kid1| Open FD UNSTARTED    10 IPC UNIX STREAM Parent
2018/08/13 16:30:57 kid1| Squid Cache (Version 4.2): Exiting normally.
2018/08/13 16:30:57| Removing PID file (/var/run/squid.pid)
2018/08/13 16:30:57| Created PID file (/var/run/squid.pid)
2018/08/13 16:30:57 kid1| Set Current Directory to /var/spool/squid
2018/08/13 16:30:57 kid1| Creating missing swap directories
2018/08/13 16:30:57 kid1| No cache_dir stores are configured.
2018/08/13 16:30:57| Removing PID file (/var/run/squid.pid)
2018/08/13 16:30:57| Created PID file (/var/run/squid.pid)
2018/08/13 16:30:57 kid1| Set Current Directory to /var/spool/squid
2018/08/13 16:30:57 kid1| Starting Squid Cache version 4.2 for x86_64-pc-linux-gnu...
2018/08/13 16:30:57 kid1| Service Name: squid
2018/08/13 16:30:57 kid1| Process ID 1658
2018/08/13 16:30:57 kid1| Process Roles: worker
2018/08/13 16:30:57 kid1| With 4096 file descriptors available
2018/08/13 16:30:57 kid1| Initializing IP Cache...


Greetz, 

Louis




From rousskov at measurement-factory.com  Mon Aug 13 16:01:57 2018
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Mon, 13 Aug 2018 10:01:57 -0600
Subject: [squid-users] Squid 4.2 is available ( debian stretch )
In-Reply-To: <vmime.5b719ca1.51e6.36b7c2675a3bf831@ms249-lin-003.rotterdam.bazuin.nl>
References: <28241c64-b221-ca2f-1e68-6ed28c332174@treenet.co.nz>
 <vmime.5b719ca1.51e6.36b7c2675a3bf831@ms249-lin-003.rotterdam.bazuin.nl>
Message-ID: <d6b96174-40f4-9067-dc8b-06d563cf4b09@measurement-factory.com>

On 08/13/2018 08:58 AM, L.P.H. van Belle wrote:

> My questions for 4.2 is: 
> Anyone any idea why we see 2x "2018/08/13 16:30:57| Created PID file (/var/run/squid.pid)"  in the start up process?  

Your scripts are probably starting Squid twice, first with the -z option
(to create cache_dir directories if they are missing and exit) and then
once again without that option (to serve traffic).

IIRC, older Squids did not create the PID file while creating cache_dir
directories, leading to nasty conflicts between concurrent Squid
instances. Future Squids should create missing directories automatically
(in most cases), but I am not aware of anybody sponsoring that feature.

HTH,

Alex.


> 2018/08/13 16:30:57| Created PID file (/var/run/squid.pid)
> 2018/08/13 16:30:57 kid1| Set Current Directory to /var/spool/squid
> 2018/08/13 16:30:57 kid1| Creating missing swap directories
> 2018/08/13 16:30:57 kid1| No cache_dir stores are configured.
> 2018/08/13 16:30:57| Removing PID file (/var/run/squid.pid)
> 2018/08/13 16:30:57| Created PID file (/var/run/squid.pid)
> 2018/08/13 16:30:57 kid1| Set Current Directory to /var/spool/squid
> 2018/08/13 16:30:57 kid1| Starting Squid Cache version 4.2 for x86_64-pc-linux-gnu...
> 2018/08/13 16:30:57 kid1| Service Name: squid
> 2018/08/13 16:30:57 kid1| Process ID 1658
> 2018/08/13 16:30:57 kid1| Process Roles: worker
> 2018/08/13 16:30:57 kid1| With 4096 file descriptors available
> 2018/08/13 16:30:57 kid1| Initializing IP Cache...


From piuschungath at gmail.com  Mon Aug 13 17:06:38 2018
From: piuschungath at gmail.com (pius)
Date: Mon, 13 Aug 2018 12:06:38 -0500 (CDT)
Subject: [squid-users] Have issue with "https_port ssl-bump intercept"
In-Reply-To: <1534168104650-0.post@n4.nabble.com>
References: <1533924325185-0.post@n4.nabble.com>
 <35064290-e6e6-569a-6c27-5f25624e9735@measurement-factory.com>
 <1533927868704-0.post@n4.nabble.com>
 <a5b0cd00-a61d-f31d-8fe2-61b3397f23c3@measurement-factory.com>
 <1534149123813-0.post@n4.nabble.com> <1534168104650-0.post@n4.nabble.com>
Message-ID: <1534179998578-0.post@n4.nabble.com>

Hi,

It will be great if anybody can help.

I can see that the client can talk to squid and squid communicating to
google. But it responding with an error. 

###### Curl Log #####

]# curl https://www.google.com -iv
* About to connect() to www.google.com port 443 (#0)
*   Trying 216.58.204.68...
* Connected to www.google.com (216.58.204.68) port 443 (#0)
* Initializing NSS with certpath: sql:/etc/pki/nssdb
*   CAfile: /etc/pki/tls/certs/ca-bundle.crt
  CApath: none
* NSS error -12263 (SSL_ERROR_RX_RECORD_TOO_LONG)
* SSL received a record that exceeded the maximum permissible length.
* Closing connection 0
curl: (35) SSL received a record that exceeded the maximum permissible
length.

############# access.log #####

1534179809.818      0 10.222.17.37 TCP_DENIED/403 3605 CONNECT
216.58.204.68:443 - HIER_NONE/- text/html
1534179809.900      0 10.222.17.37 TAG_NONE/400 0 NONE error:invalid-request
- HIER_NONE/- text/html
#######





--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From squid3 at treenet.co.nz  Mon Aug 13 18:42:05 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 14 Aug 2018 06:42:05 +1200
Subject: [squid-users] HTTP Request method CNT from Windows clients
In-Reply-To: <CAPa6PsEAZnzBQeUzMAfMt8R-q9K+fvN8xLcUatpFZNUgSNuAxg@mail.gmail.com>
References: <CAPa6PsEAZnzBQeUzMAfMt8R-q9K+fvN8xLcUatpFZNUgSNuAxg@mail.gmail.com>
Message-ID: <a5f73eb5-8507-5914-31cb-2ece15d67744@treenet.co.nz>

On 14/08/18 00:33, Peter Viskup wrote:
> Does anybody seen this in Squid logs already?
> httpRqMethod CNT
> 
> There is no destination IP nor request host logged. All clients are
> Windows machines. Requests are rejected due to not supported HTTP
> method.

That is odd because Squid does support unknown request methods these days.

More likely those are just some binary octets that happen to match up to
those letters in ASCII being bump'd and sent to the HTTP processing.

What version of Squid are you using? if it is anything less than 4.2
please upgrade.

> 
> The complete log entry example:
> 
> 13/Aug/2018:14:26:18 +0200 10.x.y.z 63740 -> - - responseTime=0
> httpXFF=- httpRqProto=1.1 httpRqMethod=CNT httpRqHost=- httpURI=-
> httpRef=- httpRsStatus=400 httpRqBytes=283 httpRsBytes=3688 httpUA="-"
> httpRqCT="-" httpRsCT="text/html;charset=utf-8" httpRsServer=squid
> mime=text/html icapResult=- icapTimeTotal=0 icapTimeRq=- icapTimeRs=-
> squidStatus=NONE:HIER_NONE squidError=- squidErrorDetail=-
> proxyPort=3128 proxyIP=10.x.c.c proxyNode=10.x.c.a sslBumpMode=-
> sslSNI="-" sslClientProto="TLS/1.2" sslServerProto="-"
> sslClientCipher="ECDHE-RSA-AES256-GCM-SHA384" sslServerCipher="-"
> sslSubject="-" sslIssuer="-" sslCertErrors="-"
> 


Amos


From eliezer at ngtech.co.il  Mon Aug 13 19:46:04 2018
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Mon, 13 Aug 2018 22:46:04 +0300
Subject: [squid-users] [squid-announce] Squid 4.2 is available
In-Reply-To: <5B6EB078.6070608@mathemainzel.info>
References: <28241c64-b221-ca2f-1e68-6ed28c332174@treenet.co.nz>
 <5B6EB078.6070608@mathemainzel.info>
Message-ID: <001601d4333e$45ad9620$d108c260$@ngtech.co.il>

I need to test it but I didn't had plans to release 4.X branch for CentOS 6.
It takes me time to test it and I hope I will have more time for it.

Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: eliezer at ngtech.co.il


-----Original Message-----
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Walter H.
Sent: Saturday, August 11, 2018 12:47 PM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] [squid-announce] Squid 4.2 is available

On 10.08.2018 07:41, Amos Jeffries wrote:
> The Squid HTTP Proxy team is very pleased to announce the availability 
> of the Squid-4.2 release!
>
>

will there be a RPM for latest CentOS 6 available?

Walter




From dan at getbusi.com  Mon Aug 13 23:45:15 2018
From: dan at getbusi.com (Dan Charlesworth)
Date: Tue, 14 Aug 2018 09:45:15 +1000
Subject: [squid-users] [squid-announce] Squid 4.2 is available
In-Reply-To: <001601d4333e$45ad9620$d108c260$@ngtech.co.il>
References: <28241c64-b221-ca2f-1e68-6ed28c332174@treenet.co.nz>
 <5B6EB078.6070608@mathemainzel.info>
 <001601d4333e$45ad9620$d108c260$@ngtech.co.il>
Message-ID: <CAN8nrKCBW+i+VEbChwZR1K=CtJAQGL=UsBJeHk+9zUU476t0zA@mail.gmail.com>

I'd be all over any Squid 4 RPMs for EL6, for what that's worth.

I had downloaded your source RPM for EL7 at one point and tried to build
one for EL6. Dealing with the compiler issues was a bit beyond me though,
sadly.

On Tue, 14 Aug 2018 at 05:46, Eliezer Croitoru <eliezer at ngtech.co.il> wrote:

> I need to test it but I didn't had plans to release 4.X branch for CentOS
> 6.
> It takes me time to test it and I hope I will have more time for it.
>
> Eliezer
>
> ----
> Eliezer Croitoru
> Linux System Administrator
> Mobile: +972-5-28704261
> Email: eliezer at ngtech.co.il
>
>
> -----Original Message-----
> From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On
> Behalf Of Walter H.
> Sent: Saturday, August 11, 2018 12:47 PM
> To: squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] [squid-announce] Squid 4.2 is available
>
> On 10.08.2018 07:41, Amos Jeffries wrote:
> > The Squid HTTP Proxy team is very pleased to announce the availability
> > of the Squid-4.2 release!
> >
> >
>
> will there be a RPM for latest CentOS 6 available?
>
> Walter
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>


-- 
Getbusi
p +61 3 6165 1555
e dan at getbusi.com
w getbusi.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180814/06588f49/attachment.htm>

From eliezer at ngtech.co.il  Tue Aug 14 00:43:14 2018
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Tue, 14 Aug 2018 03:43:14 +0300
Subject: [squid-users] [squid-announce] Squid 4.2 is available
In-Reply-To: <CAN8nrKCBW+i+VEbChwZR1K=CtJAQGL=UsBJeHk+9zUU476t0zA@mail.gmail.com>
References: <28241c64-b221-ca2f-1e68-6ed28c332174@treenet.co.nz>
 <5B6EB078.6070608@mathemainzel.info>
 <001601d4333e$45ad9620$d108c260$@ngtech.co.il>
 <CAN8nrKCBW+i+VEbChwZR1K=CtJAQGL=UsBJeHk+9zUU476t0zA@mail.gmail.com>
Message-ID: <01d001d43367$c9324530$5b96cf90$@ngtech.co.il>

Well? there is a need to move forward to CentOS 7 if possible.

Squid 4.x has couple compiler compatibility which I do not remember but it was mentioned in the wiki and the release notes.

 

Thanks,

Eliezer

 

----

 <http://ngtech.co.il/lmgtfy/> Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: eliezer at ngtech.co.il



 

From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Dan Charlesworth
Sent: Tuesday, August 14, 2018 2:45 AM
To: squid-users <squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] [squid-announce] Squid 4.2 is available

 

I'd be all over any Squid 4 RPMs for EL6, for what that's worth.

 

I had downloaded your source RPM for EL7 at one point and tried to build one for EL6. Dealing with the compiler issues was a bit beyond me though, sadly.

 

On Tue, 14 Aug 2018 at 05:46, Eliezer Croitoru <eliezer at ngtech.co.il <mailto:eliezer at ngtech.co.il> > wrote:

I need to test it but I didn't had plans to release 4.X branch for CentOS 6.
It takes me time to test it and I hope I will have more time for it.

Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: eliezer at ngtech.co.il <mailto:eliezer at ngtech.co.il> 


-----Original Message-----
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org <mailto:squid-users-bounces at lists.squid-cache.org> ] On Behalf Of Walter H.
Sent: Saturday, August 11, 2018 12:47 PM
To: squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> 
Subject: Re: [squid-users] [squid-announce] Squid 4.2 is available

On 10.08.2018 07:41, Amos Jeffries wrote:
> The Squid HTTP Proxy team is very pleased to announce the availability 
> of the Squid-4.2 release!
>
>

will there be a RPM for latest CentOS 6 available?

Walter


_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> 
http://lists.squid-cache.org/listinfo/squid-users




 

-- 

Getbusi
p +61 3 6165 1555
e dan at getbusi.com <mailto:dan at getbusi.com> 
w getbusi.com <http://getbusi.com> 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180814/569b8b4f/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 11297 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180814/569b8b4f/attachment.png>

From eliezer at ngtech.co.il  Tue Aug 14 00:45:07 2018
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Tue, 14 Aug 2018 03:45:07 +0300
Subject: [squid-users] [squid-announce] Squid 3.5.28 is available
In-Reply-To: <9613c3c7-4014-8b99-ec2a-2c71de224414@treenet.co.nz>
References: <9613c3c7-4014-8b99-ec2a-2c71de224414@treenet.co.nz>
Message-ID: <01e401d43368$0c2dcad0$24896070$@ngtech.co.il>

The RPM's for 3.5.28 are out for a while now.

Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: eliezer at ngtech.co.il



-----Original Message-----
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Amos Jeffries
Sent: Tuesday, July 31, 2018 9:09 AM
To: squid-announce at lists.squid-cache.org
Subject: [squid-users] [squid-announce] Squid 3.5.28 is available

The Squid HTTP Proxy team is very pleased to announce the availability of the Squid-3.5.28 release!



This release is a security fix release resolving several major issues found in the prior Squid releases.

    REMINDER: This and older releases are already deprecated by
              Squid-4.1 availability.


The major changes to be aware of:

* SQUID-2018:1 / CVE-2018-1000024
  Crash processing SSL-Bumped traffic containing ESI

  http://www.squid-cache.org/Advisories/SQUID-2018_1.txt

This problem allows a remote server delivering certain ESI response syntax to trigger a denial of service for all clients accessing the Squid service.

Squid-3.5 is also vulnerable to some regular ESI server responses also triggering this issue.

This problem is limited to the Squid custom ESI parser.
Squid built to use libxml2 or libexpat XML parsers do not have this problem.


* SQUID-2018:2 / CVE-2018-1000027
  Crash handling responses to internally generated requests

  http://www.squid-cache.org/Advisories/SQUID-2018_2.txt

Due to incorrect pointer handling Squid is vulnerable to denial of service attack when processing ESI responses or downloading intermediate CA certificates.

This problem allows a remote client delivering certain HTTP requests in conjunction with certain trusted server responses to trigger a denial of service for all clients accessing the Squid service.


* SQUID-2018:3 / CVE-2018-1172
  Crash in ESI Response processing

  http://www.squid-cache.org/Advisories/SQUID-2018_3.txt

This problem allows a remote server delivering ESI responses to trigger a denial of service for all clients accessing the Squid service.

This problem is limited to Squid operating as reverse proxy.


* Bug 4829: IPC shared memory leaks when disker queue overflows

This bug occurs when Squid is configured with rock only storage. After a long period of high load or a shorter period of extremely high load, disk IO drops entirely. Even after giving Squid time to recover and then resuming a low load the diskers were just not doing anything.

A lot of "run out of shared memory pages for IPC I/O" errors may be seen during the high load, which continues to remain on smaller loads after the recovery time.


* Bug 4767: SMP breaks IPv6 SNMP and cache manager queries

This problem appears as a crash when Squid is operating with multiple workers and receiving IPv6 SNMP queries.


* Bug 2821: Ignore Content-Range in non-206 responses

Squid used to honor Content-Range header in HTTP 200 OK (and possibly other non-206) responses, truncating (and possibly enlarging) some response bodies. RFC 7233 declares Content-Range meaningless for standard HTTP status codes other than 206 and 416. Squid now relays meaningless Content-Range as is, without using its value.


* SSL-Bump: fix authentication with schemes other than Basic

Squid-3.4.5 included a fix for handling Basic authentication of a CONNECT tunnel which is being bump'ed. Requests within it were intended to inherit the credentials of the tunnel. Allowing Squid ACLs to use authentication tests on the bumped traffic.

This release finally extends that fix to make bumped traffic inherit the authentication credentials from the CONNECT tunnel regardless of authentication type.


* TPROXY: Fix clientside_mark and client port logging

The clientside_mark ACL was not working with TPROXY because a conntrack query could not find connmark without a true client port.

This also affected helpers and ACLs using client dst-port number prior to logging when traffic was received with TPROXY.


* Fix "Cannot assign requested address" for to-origin TPROXY FTP data

This release adds the capability for TPROXY to be used on Native FTP traffic (received at ftp_port). Prior releases would present the above error when establishing FTP data connection and abort the transaction.



 All users of Squid-3 with SSL-Bump functionality are encouraged to upgrade to this release as soon as possible.

 All other users of Squid-3 are encouraged to upgrade to this release as time permits.


 See the ChangeLog for the full list of changes in this and earlier  releases.

Please refer to the release notes at
http://www.squid-cache.org/Versions/v3/3.5/RELEASENOTES.html
when you are ready to make the switch to Squid-3.5

Upgrade tip:
  "squid -k parse" is starting to display even more
   useful hints about squid.conf changes.

This new release can be downloaded from our HTTP or FTP servers

 http://www.squid-cache.org/Versions/v3/3.5/
 ftp://ftp.squid-cache.org/pub/squid/
 ftp://ftp.squid-cache.org/pub/archive/3.5/

or the mirrors. For a list of mirror sites see

 http://www.squid-cache.org/Download/http-mirrors.html
 http://www.squid-cache.org/Download/mirrors.html

If you encounter any issues with this release please file a bug report.
http://bugs.squid-cache.org/


Amos Jeffries
_______________________________________________
squid-announce mailing list
squid-announce at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-announce
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From belle at bazuin.nl  Tue Aug 14 06:00:08 2018
From: belle at bazuin.nl (=?windows-1252?Q?L.P.H._van_Belle?=)
Date: Tue, 14 Aug 2018 08:00:08 +0200
Subject: [squid-users] Squid 4.2 is available ( debian stretch )
In-Reply-To: <d6b96174-40f4-9067-dc8b-06d563cf4b09@measurement-factory.com>
References: <vmime.5b719ca1.51e6.36b7c2675a3bf831@ms249-lin-003.rotterdam.bazuin.nl>
Message-ID: <vmime.5b726fe8.3e6c.727b9f58121a4a68@ms249-lin-003.rotterdam.bazuin.nl>

Hai Alex, 

Ah, yes, your totaly right. 
Just checked the systemd service file again and it shows. 

ExecStartPre=/usr/sbin/squid --foreground -z
ExecStart=/usr/sbin/squid -sYC

Sorry for the stupic question. Should have seen that. 
But thank you for the reply. 

Greetz, 

Louis


> -----Oorspronkelijk bericht-----
> Van: Alex Rousskov [mailto:rousskov at measurement-factory.com] 
> Verzonden: maandag 13 augustus 2018 18:02
> Aan: L.P.H. van Belle; squid-users at lists.squid-cache.org
> Onderwerp: Re: [squid-users] Squid 4.2 is available ( debian stretch )
> 
> On 08/13/2018 08:58 AM, L.P.H. van Belle wrote:
> 
> > My questions for 4.2 is: 
> > Anyone any idea why we see 2x "2018/08/13 16:30:57| Created 
> PID file (/var/run/squid.pid)"  in the start up process?  
> 
> Your scripts are probably starting Squid twice, first with 
> the -z option
> (to create cache_dir directories if they are missing and 
> exit) and then
> once again without that option (to serve traffic).
> 
> IIRC, older Squids did not create the PID file while creating 
> cache_dir
> directories, leading to nasty conflicts between concurrent Squid
> instances. Future Squids should create missing directories 
> automatically
> (in most cases), but I am not aware of anybody sponsoring 
> that feature.
> 
> HTH,
> 
> Alex.
> 
> 
> > 2018/08/13 16:30:57| Created PID file (/var/run/squid.pid)
> > 2018/08/13 16:30:57 kid1| Set Current Directory to /var/spool/squid
> > 2018/08/13 16:30:57 kid1| Creating missing swap directories
> > 2018/08/13 16:30:57 kid1| No cache_dir stores are configured.
> > 2018/08/13 16:30:57| Removing PID file (/var/run/squid.pid)
> > 2018/08/13 16:30:57| Created PID file (/var/run/squid.pid)
> > 2018/08/13 16:30:57 kid1| Set Current Directory to /var/spool/squid
> > 2018/08/13 16:30:57 kid1| Starting Squid Cache version 4.2 
> for x86_64-pc-linux-gnu...
> > 2018/08/13 16:30:57 kid1| Service Name: squid
> > 2018/08/13 16:30:57 kid1| Process ID 1658
> > 2018/08/13 16:30:57 kid1| Process Roles: worker
> > 2018/08/13 16:30:57 kid1| With 4096 file descriptors available
> > 2018/08/13 16:30:57 kid1| Initializing IP Cache...
> 
> 



From eliezer at ngtech.co.il  Tue Aug 14 08:01:23 2018
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Tue, 14 Aug 2018 11:01:23 +0300
Subject: [squid-users] microsoft list
In-Reply-To: <0bc901d4295f$84582c70$8d088550$@skno.by>
References: <470501d428a3$d6a70f80$83f52e80$@skno.by>
 <0a3c04d2-8d48-a074-fa5c-1a7480d8158a@netpilot.com>
 <582201d428c2$2557bb20$70073160$@skno.by>
 <1fc09ac8-c53d-3c08-fb61-86f55f8af8d9@treenet.co.nz>
 <0bc901d4295f$84582c70$8d088550$@skno.by>
Message-ID: <00ac01d433a4$fe9afbd0$fbd0f370$@ngtech.co.il>

Can you share this git with us?
We are probably not updated enough.
It will probably help others too so.

Can you please share it with us?

Thanks,
Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: eliezer at ngtech.co.il


-----Original Message-----
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Vacheslav
Sent: Wednesday, August 1, 2018 9:19 AM
To: 'Amos Jeffries' <squid3 at treenet.co.nz>; squid-users at lists.squid-cache.org
Subject: Re: [squid-users] microsoft list


-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Amos Jeffries
Sent: Tuesday, July 31, 2018 7:34 PM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] microsoft list

On 31/07/18 23:32, Vacheslav wrote:
> Satanic greetings, you really think you are the smartest of us all that we can't think of your stupid suggestion?
> 

>Please be civil. The response you received was a reasonable answer to your question.

You won't find any more civil love than that.

>Both the TechNet article linked and the Squid FAQ config example for Windows Update contains lists of domains that service uses.

>Blocking the rest of Microsoft and all of Akamai *by URL* is a much more difficult proposition. Between them they host a very large percentage of Internet domains.

Your last sentence is totally false. I found an open source handy piece of software which lets you choose how much you would like to block, even skype if desired, too bad there isn't a donate button on github or am I missing it?
So I just copied the domains inserted in the hosts file and plugged it in ufdbguard and the people who use this squid have considerably less traffic than others.

>Amos
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users


_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From m_zouhairy at skno.by  Tue Aug 14 11:08:25 2018
From: m_zouhairy at skno.by (Vacheslav)
Date: Tue, 14 Aug 2018 14:08:25 +0300
Subject: [squid-users] microsoft list
In-Reply-To: <00ac01d433a4$fe9afbd0$fbd0f370$@ngtech.co.il>
References: <470501d428a3$d6a70f80$83f52e80$@skno.by>
 <0a3c04d2-8d48-a074-fa5c-1a7480d8158a@netpilot.com>
 <582201d428c2$2557bb20$70073160$@skno.by>
 <1fc09ac8-c53d-3c08-fb61-86f55f8af8d9@treenet.co.nz>
 <0bc901d4295f$84582c70$8d088550$@skno.by>
 <00ac01d433a4$fe9afbd0$fbd0f370$@ngtech.co.il>
Message-ID: <b64501d433bf$1f2add60$5d809820$@skno.by>

Well since you asked and are actually interested, I am going to reveal the secret just like Vanunu and  Rabin. The program is called disable win track!
But what I don't understand is that too many people get to understand stuff like split and peak and tls and even tougher technical stuff but when it comes to health, they just trust their wizard is giving them the right magic potion! No one would break a thermometer and drink its contents but that is exactly what most do to their dearest beloved ones with disaster loaded needles!

-----Original Message-----
From: Eliezer Croitoru <eliezer at ngtech.co.il> 
Sent: Tuesday, August 14, 2018 11:01 AM
To: 'Vacheslav' <m_zouhairy at skno.by>
Cc: squid-users at lists.squid-cache.org
Subject: RE: [squid-users] microsoft list

>Can you share this git with us?
>We are probably not updated enough.
>It will probably help others too so.

Can you please share it with us?

Thanks,
Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: eliezer at ngtech.co.il


-----Original Message-----
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Vacheslav
Sent: Wednesday, August 1, 2018 9:19 AM
To: 'Amos Jeffries' <squid3 at treenet.co.nz>; squid-users at lists.squid-cache.org
Subject: Re: [squid-users] microsoft list


-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Amos Jeffries
Sent: Tuesday, July 31, 2018 7:34 PM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] microsoft list

On 31/07/18 23:32, Vacheslav wrote:
> Satanic greetings, you really think you are the smartest of us all that we can't think of your stupid suggestion?
> 

>Please be civil. The response you received was a reasonable answer to your question.

You won't find any more civil love than that.

>Both the TechNet article linked and the Squid FAQ config example for Windows Update contains lists of domains that service uses.

>Blocking the rest of Microsoft and all of Akamai *by URL* is a much more difficult proposition. Between them they host a very large percentage of Internet domains.

Your last sentence is totally false. I found an open source handy piece of software which lets you choose how much you would like to block, even skype if desired, too bad there isn't a donate button on github or am I missing it?
So I just copied the domains inserted in the hosts file and plugged it in ufdbguard and the people who use this squid have considerably less traffic than others.

>Amos
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users


_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users





From Antony.Stone at squid.open.source.it  Tue Aug 14 11:25:39 2018
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Tue, 14 Aug 2018 13:25:39 +0200
Subject: [squid-users] microsoft list
In-Reply-To: <b64501d433bf$1f2add60$5d809820$@skno.by>
References: <470501d428a3$d6a70f80$83f52e80$@skno.by>
 <00ac01d433a4$fe9afbd0$fbd0f370$@ngtech.co.il>
 <b64501d433bf$1f2add60$5d809820$@skno.by>
Message-ID: <201808141325.39532.Antony.Stone@squid.open.source.it>

On Tuesday 14 August 2018 at 13:08:25, Vacheslav wrote:

> Well since you asked and are actually interested, I am going to reveal the
> secret just like Vanunu and  Rabin. The program is called disable win
> track!

So, this is https://github.com/10se1ucgo/DisableWinTracking/releases ?

> But what I don't understand is that too many people get to
> understand stuff like split and peak and tls and even tougher technical
> stuff but when it comes to health, they just trust their wizard is giving
> them the right magic potion! No one would break a thermometer and drink
> its contents but that is exactly what most do to their dearest beloved
> ones with disaster loaded needles!

Er, what?

This is still the Squid cache users' mailing list, isn't it?

Antony.

> -----Original Message-----
> From: Eliezer Croitoru <eliezer at ngtech.co.il>
> Sent: Tuesday, August 14, 2018 11:01 AM
> To: 'Vacheslav' <m_zouhairy at skno.by>
> Cc: squid-users at lists.squid-cache.org
> Subject: RE: [squid-users] microsoft list
> 
> >Can you share this git with us?
> >We are probably not updated enough.
> >It will probably help others too so.
> 
> Can you please share it with us?
> 
> Thanks,
> Eliezer
> 
> ----
> Eliezer Croitoru
> Linux System Administrator
> Mobile: +972-5-28704261
> Email: eliezer at ngtech.co.il
> 
> 
> -----Original Message-----
> From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On
> Behalf Of Vacheslav Sent: Wednesday, August 1, 2018 9:19 AM
> To: 'Amos Jeffries' <squid3 at treenet.co.nz>;
> squid-users at lists.squid-cache.org Subject: Re: [squid-users] microsoft
> list
> 
> 
> -----Original Message-----
> From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of
> Amos Jeffries Sent: Tuesday, July 31, 2018 7:34 PM
> To: squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] microsoft list
> 
> On 31/07/18 23:32, Vacheslav wrote:
> > Satanic greetings, you really think you are the smartest of us all that
> > we can't think of your stupid suggestion?
> >
> >Please be civil. The response you received was a reasonable answer to your
> >question.
> 
> You won't find any more civil love than that.
> 
> >Both the TechNet article linked and the Squid FAQ config example for
> >Windows Update contains lists of domains that service uses.
> >
> >Blocking the rest of Microsoft and all of Akamai *by URL* is a much more
> >difficult proposition. Between them they host a very large percentage of
> >Internet domains.
> 
> Your last sentence is totally false. I found an open source handy piece of
> software which lets you choose how much you would like to block, even
> skype if desired, too bad there isn't a donate button on github or am I
> missing it? So I just copied the domains inserted in the hosts file and
> plugged it in ufdbguard and the people who use this squid have
> considerably less traffic than others.


-- 
This space intentionally has nothing but text explaining why this space has 
nothing but text explaining that this space would otherwise have been left 
blank, and would otherwise have been left blank.

                                                   Please reply to the list;
                                                         please *don't* CC me.


From m_zouhairy at skno.by  Tue Aug 14 12:54:19 2018
From: m_zouhairy at skno.by (Vacheslav)
Date: Tue, 14 Aug 2018 15:54:19 +0300
Subject: [squid-users] microsoft list
In-Reply-To: <201808141325.39532.Antony.Stone@squid.open.source.it>
References: <470501d428a3$d6a70f80$83f52e80$@skno.by>
 <00ac01d433a4$fe9afbd0$fbd0f370$@ngtech.co.il>
 <b64501d433bf$1f2add60$5d809820$@skno.by>
 <201808141325.39532.Antony.Stone@squid.open.source.it>
Message-ID: <d4a601d433cd$ea5b20e0$bf1162a0$@skno.by>

Well, I am not talking to those who use microwaves and consider snickers a great food

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Antony Stone
Sent: Tuesday, August 14, 2018 2:26 PM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] microsoft list

On Tuesday 14 August 2018 at 13:08:25, Vacheslav wrote:

> Well since you asked and are actually interested, I am going to reveal 
> the secret just like Vanunu and  Rabin. The program is called disable 
> win track!

So, this is https://github.com/10se1ucgo/DisableWinTracking/releases ?

> But what I don't understand is that too many people get to understand 
> stuff like split and peak and tls and even tougher technical stuff but 
> when it comes to health, they just trust their wizard is giving them 
> the right magic potion! No one would break a thermometer and drink its 
> contents but that is exactly what most do to their dearest beloved 
> ones with disaster loaded needles!

Er, what?

This is still the Squid cache users' mailing list, isn't it?

Antony.

> -----Original Message-----
> From: Eliezer Croitoru <eliezer at ngtech.co.il>
> Sent: Tuesday, August 14, 2018 11:01 AM
> To: 'Vacheslav' <m_zouhairy at skno.by>
> Cc: squid-users at lists.squid-cache.org
> Subject: RE: [squid-users] microsoft list
> 
> >Can you share this git with us?
> >We are probably not updated enough.
> >It will probably help others too so.
> 
> Can you please share it with us?
> 
> Thanks,
> Eliezer
> 
> ----
> Eliezer Croitoru
> Linux System Administrator
> Mobile: +972-5-28704261
> Email: eliezer at ngtech.co.il
> 
> 
> -----Original Message-----
> From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] 
> On Behalf Of Vacheslav Sent: Wednesday, August 1, 2018 9:19 AM
> To: 'Amos Jeffries' <squid3 at treenet.co.nz>; 
> squid-users at lists.squid-cache.org Subject: Re: [squid-users] microsoft 
> list
> 
> 
> -----Original Message-----
> From: squid-users <squid-users-bounces at lists.squid-cache.org> On 
> Behalf Of Amos Jeffries Sent: Tuesday, July 31, 2018 7:34 PM
> To: squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] microsoft list
> 
> On 31/07/18 23:32, Vacheslav wrote:
> > Satanic greetings, you really think you are the smartest of us all 
> > that we can't think of your stupid suggestion?
> >
> >Please be civil. The response you received was a reasonable answer to 
> >your question.
> 
> You won't find any more civil love than that.
> 
> >Both the TechNet article linked and the Squid FAQ config example for 
> >Windows Update contains lists of domains that service uses.
> >
> >Blocking the rest of Microsoft and all of Akamai *by URL* is a much 
> >more difficult proposition. Between them they host a very large 
> >percentage of Internet domains.
> 
> Your last sentence is totally false. I found an open source handy 
> piece of software which lets you choose how much you would like to 
> block, even skype if desired, too bad there isn't a donate button on 
> github or am I missing it? So I just copied the domains inserted in 
> the hosts file and plugged it in ufdbguard and the people who use this 
> squid have considerably less traffic than others.


--
This space intentionally has nothing but text explaining why this space has nothing but text explaining that this space would otherwise have been left blank, and would otherwise have been left blank.

                                                   Please reply to the list;
                                                         please *don't* CC me.
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users




From eliezer at ngtech.co.il  Wed Aug 15 07:35:04 2018
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Wed, 15 Aug 2018 10:35:04 +0300
Subject: [squid-users] microsoft list
In-Reply-To: <b64501d433bf$1f2add60$5d809820$@skno.by>
References: <470501d428a3$d6a70f80$83f52e80$@skno.by>
 <0a3c04d2-8d48-a074-fa5c-1a7480d8158a@netpilot.com>
 <582201d428c2$2557bb20$70073160$@skno.by>
 <1fc09ac8-c53d-3c08-fb61-86f55f8af8d9@treenet.co.nz>
 <0bc901d4295f$84582c70$8d088550$@skno.by>
 <00ac01d433a4$fe9afbd0$fbd0f370$@ngtech.co.il>
 <b64501d433bf$1f2add60$5d809820$@skno.by>
Message-ID: <002501d4346a$7bb71200$73253600$@ngtech.co.il>

Well..
It's a Squid-Cache mailing list but you wrote a very long sentence and it's hard to understand.
Health is important and trusting the Wizard is only when he proved himself worthy of it.
Microsoft have been proving that it's worth honor....
If you specifically do not like their updates or caching computability or security then you are in the right place.
Microwave is nice and has benefits and losses but.. it gives easier lives to many.

Here we try to be direct and to not hold a mystery in the text.
You are welcome to add some more technical details to the subject if we do not know about it.

I will try to look at the git repository and learn.

All The Bests,
Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: eliezer at ngtech.co.il


-----Original Message-----
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Vacheslav
Sent: Tuesday, August 14, 2018 2:08 PM
Cc: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] microsoft list

Well since you asked and are actually interested, I am going to reveal the secret just like Vanunu and  Rabin. The program is called disable win track!
But what I don't understand is that too many people get to understand stuff like split and peak and tls and even tougher technical stuff but when it comes to health, they just trust their wizard is giving them the right magic potion!
No one would break a thermometer and drink its contents but that is exactly what most do to their dearest beloved ones with disaster loaded needles!

-----Original Message-----
From: Eliezer Croitoru <eliezer at ngtech.co.il> 
Sent: Tuesday, August 14, 2018 11:01 AM
To: 'Vacheslav' <m_zouhairy at skno.by>
Cc: squid-users at lists.squid-cache.org
Subject: RE: [squid-users] microsoft list

>Can you share this git with us?
>We are probably not updated enough.
>It will probably help others too so.

Can you please share it with us?

Thanks,
Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: eliezer at ngtech.co.il


-----Original Message-----
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Vacheslav
Sent: Wednesday, August 1, 2018 9:19 AM
To: 'Amos Jeffries' <squid3 at treenet.co.nz>; squid-users at lists.squid-cache.org
Subject: Re: [squid-users] microsoft list


-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Amos Jeffries
Sent: Tuesday, July 31, 2018 7:34 PM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] microsoft list

On 31/07/18 23:32, Vacheslav wrote:
> Satanic greetings, you really think you are the smartest of us all that we can't think of your stupid suggestion?
> 

>Please be civil. The response you received was a reasonable answer to your question.

You won't find any more civil love than that.

>Both the TechNet article linked and the Squid FAQ config example for Windows Update contains lists of domains that service uses.

>Blocking the rest of Microsoft and all of Akamai *by URL* is a much more difficult proposition. Between them they host a very large percentage of Internet domains.

Your last sentence is totally false. I found an open source handy piece of software which lets you choose how much you would like to block, even skype if desired, too bad there isn't a donate button on github or am I missing it?
So I just copied the domains inserted in the hosts file and plugged it in ufdbguard and the people who use this squid have considerably less traffic than others.

>Amos
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users


_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From ma.katrina.b.de.leon at accenture.com  Wed Aug 15 09:19:22 2018
From: ma.katrina.b.de.leon at accenture.com (De Leon, Ma Katrina B.)
Date: Wed, 15 Aug 2018 09:19:22 +0000
Subject: [squid-users] TLS Connection Upgrade for Windows
Message-ID: <BL2P114MB01454C299BE74EA51050AAB1C43F0@BL2P114MB0145.NAMP114.PROD.OUTLOOK.COM>

Hi,

I've seen several discussions on using Squid proxy to upgrade client TLS connections using ssl_bump. But all of the existing discussions applies to Linux/Unix Systems.
Can anyone confirm if this is also applicable or possible for Windows? I am trying to integrate our application (SAP PI) which uses TLS 1.0 to Salesforce which only allows TLS 1.1 and above.
Any response is very much appreciated. Thank you!

Best Regards,
De Leon


________________________________

This message is for the designated recipient only and may contain privileged, proprietary, or otherwise confidential information. If you have received it in error, please notify the sender immediately and delete the original. Any other use of the e-mail by you is prohibited. Where allowed by local law, electronic communications with Accenture and its affiliates, including e-mail and instant messaging (including content), may be scanned by our systems for the purposes of information security and assessment of internal compliance with Accenture policy. Your privacy is important to us. Accenture uses your personal data only in compliance with data protection laws. For further information on how Accenture processes your personal data, please see our privacy statement at https://www.accenture.com/us-en/privacy-policy.
______________________________________________________________________________________

www.accenture.com


From squid3 at treenet.co.nz  Wed Aug 15 13:18:56 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 16 Aug 2018 01:18:56 +1200
Subject: [squid-users] TLS Connection Upgrade for Windows
In-Reply-To: <BL2P114MB01454C299BE74EA51050AAB1C43F0@BL2P114MB0145.NAMP114.PROD.OUTLOOK.COM>
References: <BL2P114MB01454C299BE74EA51050AAB1C43F0@BL2P114MB0145.NAMP114.PROD.OUTLOOK.COM>
Message-ID: <0033f39e-871d-0274-a56e-5953aed2eb62@treenet.co.nz>

On 15/08/18 21:19, De Leon, Ma Katrina B. wrote:
> Hi,
> 
> I've seen several discussions on using Squid proxy to upgrade client TLS connections using ssl_bump. But all of the existing discussions applies to Linux/Unix Systems.
> Can anyone confirm if this is also applicable or possible for Windows? I am trying to integrate our application (SAP PI) which uses TLS 1.0 to Salesforce which only allows TLS 1.1 and above.

The SSL-Bump features are not specific to any OS. They rely solely on
the Squid and OpenSSL versions being used.

The problems you will encounter with Windows is its lack of NAT or
TPROXY capabilities. So port 443 traffic cannot be intercepted into the
proxy in the first place (same for port 80, etc).

Amos


From admin at daraksun.com  Wed Aug 15 16:26:16 2018
From: admin at daraksun.com (Oldman)
Date: Wed, 15 Aug 2018 11:26:16 -0500 (CDT)
Subject: [squid-users] Do I need to be technical to use squid proxy?
Message-ID: <1534350376533-0.post@n4.nabble.com>

I found a script and automatically created squid proxy in a centos vps
then set up the proxy in my pc and am using it 
I am good in learning but not very technical . while trying to figure out 
all those tcp denied and other logs I realized it is very technical
Isn't there easy to manage  way for non technical person like me?



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From Antony.Stone at squid.open.source.it  Wed Aug 15 16:44:59 2018
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Wed, 15 Aug 2018 18:44:59 +0200
Subject: [squid-users] Do I need to be technical to use squid proxy?
In-Reply-To: <1534350376533-0.post@n4.nabble.com>
References: <1534350376533-0.post@n4.nabble.com>
Message-ID: <201808151844.59373.Antony.Stone@squid.open.source.it>

On Wednesday 15 August 2018 at 18:26:16, Oldman wrote:

> I found a script and automatically created squid proxy in a centos vps
> then set up the proxy in my pc and am using it
> I am good in learning but not very technical . while trying to figure out
> all those tcp denied and other logs I realized it is very technical
> Isn't there easy to manage  way for non technical person like me?

Sorry, but why is a non-technical person trying to manage a proxy server?

To answer the question in your subject line "Do I need to be technical to use 
squid proxy?", the answer is definitely "no".  So long as you can use a 
browser, you can use Squid proxy, but if you want to *manage* the proxy, 
that's a different matter, and you need to have at least a certain amount of 
familiarity with networking concepts and client-server communications.

Maybe it helps to look at your request completely differently - what are you 
trying to *achieve* with Squid?  Tell us that and we might be able to help you 
do it.


Regards,


Antony.

-- 
Ren? Descartes walks in to a bar.
The barman asks him "Do you want a drink?"
Descartes says "I think not," and disappears.

                                                   Please reply to the list;
                                                         please *don't* CC me.


From admin at daraksun.com  Wed Aug 15 17:27:07 2018
From: admin at daraksun.com (Oldman)
Date: Wed, 15 Aug 2018 12:27:07 -0500 (CDT)
Subject: [squid-users] Do I need to be technical to use squid proxy?
In-Reply-To: <201808151844.59373.Antony.Stone@squid.open.source.it>
References: <1534350376533-0.post@n4.nabble.com>
 <201808151844.59373.Antony.Stone@squid.open.source.it>
Message-ID: <1534354027176-0.post@n4.nabble.com>

Thanks
I know a little on how to use ssh , install some thing etc.
Just creating squid proxy for home use , my kids  and I was also curious 

Every thing is installed and it seems to work except some log files that I
have no idea what it means and how I can resolve. I searched in internet but
the answers seem to be complicated.

OK my question

What do you think about my squid configuration?  here ? I can't see any
cache logs

https://pastebin.com/raw/5jghjapu





--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From Antony.Stone at squid.open.source.it  Wed Aug 15 18:03:37 2018
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Wed, 15 Aug 2018 20:03:37 +0200
Subject: [squid-users] Do I need to be technical to use squid proxy?
In-Reply-To: <1534354027176-0.post@n4.nabble.com>
References: <1534350376533-0.post@n4.nabble.com>
 <201808151844.59373.Antony.Stone@squid.open.source.it>
 <1534354027176-0.post@n4.nabble.com>
Message-ID: <201808152003.37817.Antony.Stone@squid.open.source.it>

On Wednesday 15 August 2018 at 19:27:07, Oldman wrote:

> What do you think about my squid configuration?  here ? I can't see any
> cache logs

> cache_log /dev/null

You do understand what "/dev/null" means, do you?

> acl SSL_ports port 1-65535
> acl Safe_ports port 1-65535

This suggests to me that your lack of familiarity with networking may be 
dangerous.


Antony.

-- 
Police have found a cartoonist dead in his house.  They say that details are 
currently sketchy.

                                                   Please reply to the list;
                                                         please *don't* CC me.


From admin at daraksun.com  Wed Aug 15 18:34:26 2018
From: admin at daraksun.com (Oldman)
Date: Wed, 15 Aug 2018 13:34:26 -0500 (CDT)
Subject: [squid-users] Do I need to be technical to use squid proxy?
In-Reply-To: <201808152003.37817.Antony.Stone@squid.open.source.it>
References: <1534350376533-0.post@n4.nabble.com>
 <201808151844.59373.Antony.Stone@squid.open.source.it>
 <1534354027176-0.post@n4.nabble.com>
 <201808152003.37817.Antony.Stone@squid.open.source.it>
Message-ID: <1534358066183-0.post@n4.nabble.com>

No sir I do not understand that is why I am here trying to just come up with
some configuration that helps me keep the squid swimming :)

About being dangerous  please guide me what to remove or add  

I suppose you are telling me that
>acl SSL_ports port 1-65535 
> acl Safe_ports port 1-65535

Are dangerous ?  Please guide me should I remove them all?







--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From Antony.Stone at squid.open.source.it  Wed Aug 15 18:58:20 2018
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Wed, 15 Aug 2018 20:58:20 +0200
Subject: [squid-users] Do I need to be technical to use squid proxy?
In-Reply-To: <1534358066183-0.post@n4.nabble.com>
References: <1534350376533-0.post@n4.nabble.com>
 <201808152003.37817.Antony.Stone@squid.open.source.it>
 <1534358066183-0.post@n4.nabble.com>
Message-ID: <201808152058.20589.Antony.Stone@squid.open.source.it>

On Wednesday 15 August 2018 at 20:34:26, Oldman wrote:

> No sir I do not understand

Okay, "/dev/null" means "discard the output".  That is why:

	cache_log /dev/null

produces no cache log file.

> that is why I am here trying to just come up with some configuration that
> helps me keep the squid swimming :)
> 
> About being dangerous  please guide me what to remove or add
> 
> I suppose you are telling me that
> 
> > acl SSL_ports port 1-65535
> > acl Safe_ports port 1-65535
> 
> Are dangerous ?  Please guide me should I remove them all?

I recommend you simply do not change them from the defaults.

In general, do not change anything in the default Squid config file unless you 
know why you need to change it.


Regards


Antony.

-- 
It may not seem obvious, but (6 x 5 + 5) x 5 - 55 equals 5!

                                                   Please reply to the list;
                                                         please *don't* CC me.


From admin at daraksun.com  Wed Aug 15 19:07:43 2018
From: admin at daraksun.com (Oldman)
Date: Wed, 15 Aug 2018 14:07:43 -0500 (CDT)
Subject: [squid-users] What is a typical squid conf file
Message-ID: <1534360063476-0.post@n4.nabble.com>

For a typical user who uses squid proxy at home for caching purpose
have dropbox , google drive etc  skype running 
on pc , mac , ios  all together 5 

Main reason is caching and controling kids 


Thanks

I am not technical 



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From admin at daraksun.com  Wed Aug 15 19:09:57 2018
From: admin at daraksun.com (Oldman)
Date: Wed, 15 Aug 2018 14:09:57 -0500 (CDT)
Subject: [squid-users] Do I need to be technical to use squid proxy?
In-Reply-To: <201808152058.20589.Antony.Stone@squid.open.source.it>
References: <1534350376533-0.post@n4.nabble.com>
 <201808151844.59373.Antony.Stone@squid.open.source.it>
 <1534354027176-0.post@n4.nabble.com>
 <201808152003.37817.Antony.Stone@squid.open.source.it>
 <1534358066183-0.post@n4.nabble.com>
 <201808152058.20589.Antony.Stone@squid.open.source.it>
Message-ID: <1534360197331-0.post@n4.nabble.com>

Thanks

I won't change any thing unless I am sure here. 

What was dangerous ?  Did you mean I could be hacked with that configuration
file?



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From Antony.Stone at squid.open.source.it  Wed Aug 15 19:20:44 2018
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Wed, 15 Aug 2018 21:20:44 +0200
Subject: [squid-users] Do I need to be technical to use squid proxy?
In-Reply-To: <1534360197331-0.post@n4.nabble.com>
References: <1534350376533-0.post@n4.nabble.com>
 <201808152058.20589.Antony.Stone@squid.open.source.it>
 <1534360197331-0.post@n4.nabble.com>
Message-ID: <201808152120.44186.Antony.Stone@squid.open.source.it>

On Wednesday 15 August 2018 at 21:09:57, Oldman wrote:

> Thanks
> 
> I won't change any thing unless I am sure here.

Well, you've certainly changed quite a lot of the standard config in the file 
you showed us earlier.

> What was dangerous ?  Did you mean I could be hacked with that
> configuration file?

I seriously doubt you can be "hacked" (whatever you specifically mean by that) 
but only because you are running the Squid proxy on a domestic network and it 
is therefore almost certainly unreachable from the Internet.

However, defining "safe ports" to be "any port at all" means your proxy can be 
used for quite a number of protocols other than HTTP/S (for example, SMTP) and 
since this is almost certainly not what you want this proxy to be (ab)used 
for, you should stick the the default definition of safe ports which is 
designed to prevent this sort of abuse.

Just out of interest, what made you make the changes you did to the standard 
config?


Antony.

-- 
"The future is already here.   It's just not evenly distributed yet."

 - William Gibson

                                                   Please reply to the list;
                                                         please *don't* CC me.


From Antony.Stone at squid.open.source.it  Wed Aug 15 19:20:42 2018
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Wed, 15 Aug 2018 21:20:42 +0200
Subject: [squid-users] What is a typical squid conf file
In-Reply-To: <1534360063476-0.post@n4.nabble.com>
References: <1534360063476-0.post@n4.nabble.com>
Message-ID: <201808152120.42228.Antony.Stone@squid.open.source.it>

On Wednesday 15 August 2018 at 21:07:43, Oldman wrote:

> For a typical user

That's an "interesting" thing to define :)

> who uses squid proxy at home for caching purpose
> have dropbox , google drive etc  skype running
> on pc , mac , ios  all together 5

My recommendation is to use the default squid.conf file and see if you run into 
any problems.  If you do, come back and ask here with as much detail as you 
can gather on what the problem is, what shows up in the Squid log files when 
the problem is occurring, and how to trigger the problem.

> Main reason is caching

You should be aware that caching is less and less effective with modern web 
server practices.

I'm not saying it's not worth doing, but you won't get the cache hit rates we 
enjoyed 10 years ago.

> and controling kids

Maybe you need to define "controlling" a little more so we know what you want 
to do?

For example, is your primary objective to prevent them getting to sites you 
don't approve of, or finding out what sites they've been looking at after 
they've been there?


Antony.

-- 
"It is easy to be blinded to the essential uselessness of them by the sense of 
achievement you get from getting them to work at all. In other words - and 
this is the rock solid principle on which the whole of the Corporation's 
Galaxy-wide success is founded - their fundamental design flaws are completely 
hidden by their superficial design flaws."

 - Douglas Noel Adams

                                                   Please reply to the list;
                                                         please *don't* CC me.


From david at articatech.com  Wed Aug 15 23:58:10 2018
From: david at articatech.com (David Touzeau)
Date: Thu, 16 Aug 2018 01:58:10 +0200
Subject: [squid-users] v4.2 url_rewrite Uri.cc line 371 bad URL parsing on
	SSL
Message-ID: <000a01d434f3$d2bf32b0$783d9810$@articatech.com>

Hi, 

 

I have written my own url_rewrite helper

 

On SSL sites, the helper answering a redirect to a remote denied php  page.

 

With HTTP, no issue but on SSL there is a different behavior

 

My helper return 

 

rewrite-url= https://192.168.1.122:443/myguard.php?rule-id=0
<https://192.168.1.122:443/ufdbguard.php?rule-id=0&SquidGuardIPWeb=aHR0cDovL
zE5Mi4xNjguMS4xMjI=&clientaddr=192.168.1.1&clientname=192.168.1.1&clientuser
=unknown&clientgroup=default&targetgroup=P109&url=http%3A%2F%2Fwww.youporn.c
om>
&SquidGuardIPWeb=aHR0cDovLzE5Mi4xNjguMS4xMjI=&clientaddr=192.168.1.1&clientn
ame=192.168.1.1&clientuser=unknown&clientgroup=default&targetgroup=P109&url=
http%3A%2F%2Fwww.youporn.com

 

but according to debug, the Uri.cc understand : host='https', port='443',
path=''

 

In this case, squid try to connect to an https machine name and return bad
503

 

 

 

018/08/16 01:42:59.681 kid1| 84,3| Reply.cc(63) finalize: helper Result = OK

2018/08/16 01:42:59.681 kid1| 61,5| redirect.cc(83) redirectHandleReply:
reply={result=OK, notes={webfiltering: block,0,P109; status: 302;
rewrite-url:
https://192.168.1.122:443/myguard.php?rule-id=0&SquidGuardIPWeb=aHR0cDovLzE5
Mi4xNjguMS4xMjI=&clientaddr=192.168.1.1&clientname=192.168.1.1&clientuser=un
known&clientgroup=default&targetgroup=P109&url=http%3A%2F%2Fwww.youporn.com;
}}

2018/08/16 01:42:59.681 kid1| 85,5| client_side_request.cc(1197)
clientRedirectDone: 'www.youporn.com:443' result={result=OK,
notes={webfiltering: block,0,P109; status: 302; rewrite-url:
https://192.168.1.122:443/myguard.php?rule-id=0&SquidGuardIPWeb=aHR0cDovLzE5
Mi4xNjguMS4xMjI=&clientaddr=192.168.1.1&clientname=192.168.1.1&clientuser=un
known&clientgroup=default&targetgroup=P109&url=http%3A%2F%2Fwww.youporn.com;
}}

 

Here  -------------------> Uri.cc did not understand correctly the returned
URL.

 

2018/08/16 01:42:59.681 kid1| 23,3| Uri.cc(371) parse: Split URL
'https://192.168.1.122:443/myguard.php?rule-id=0&SquidGuardIPWeb=aHR0cDovLzE
5Mi4xNjguMS4xMjI=&clientaddr=192.168.1.1&clientname=192.168.1.1&clientuser=u
nknown&clientgroup=default&targetgroup=P109&url=http%3A%2F%2Fwww.youporn.com
' into proto='', host='https', port='443', path=''

 

 

2018/08/16 01:42:59.681 kid1| 24,7| SBuf.cc(212) append: from c-string to id
SBuf346713

2018/08/16 01:42:59.681 kid1| 24,7| SBuf.cc(160) rawSpace: reserving 0 for
SBuf346713

2018/08/16 01:42:59.681 kid1| 24,7| SBuf.cc(167) rawSpace: SBuf346713 not
growing

2018/08/16 01:42:59.681 kid1| 24,6| SBuf.cc(99) assign: SBuf346714 from
c-string, n=4294967295)

2018/08/16 01:42:59.682 kid1| 24,7| SBuf.cc(212) append: from c-string to id
SBuf346714

2018/08/16 01:42:59.682 kid1| 24,7| SBuf.cc(160) rawSpace: reserving 0 for
SBuf346714

2018/08/16 01:42:59.682 kid1| 24,7| SBuf.cc(167) rawSpace: SBuf346714 not
growing

2018/08/16 01:42:59.682 kid1| 24,6| SBuf.cc(99) assign: SBuf346709 from
c-string, n=4294967295)

2018/08/16 01:42:59.682 kid1| 24,7| SBuf.cc(212) append: from c-string to id
SBuf346709

2018/08/16 01:42:59.682 kid1| 24,7| SBuf.cc(160) rawSpace: reserving 0 for
SBuf346709

2018/08/16 01:42:59.682 kid1| 24,7| SBuf.cc(167) rawSpace: SBuf346709 not
growing

 

Here ------------> Address.cc did not find the https machine.

2018/08/16 01:42:59.682 kid1| 14,3| Address.cc(382) lookupHostIP: Given
Non-IP 'https.domain.local': Name or service not known

 

 

Did i miss something ???

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180816/1cbe57bb/attachment.htm>

From squid3 at treenet.co.nz  Thu Aug 16 01:50:30 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 16 Aug 2018 13:50:30 +1200
Subject: [squid-users] v4.2 url_rewrite Uri.cc line 371 bad URL parsing
 on SSL
In-Reply-To: <000a01d434f3$d2bf32b0$783d9810$@articatech.com>
References: <000a01d434f3$d2bf32b0$783d9810$@articatech.com>
Message-ID: <ee87f360-7a02-3382-ca79-262ddfc7fceb@treenet.co.nz>

On 16/08/18 11:58, David Touzeau wrote:
> Hi,
> 
> ?
> 
> I have written my own url_rewrite helper
> 
> ?
> 
> On SSL sites, the helper answering a redirect to a remote denied php? page.
> 

No your helper *rewrite* the URL without changing any other properties
of the request message. This can be seen clearly in the use of
"rewrite-url=" instead of "url=".

The difference is important when it comes to the type of message being
processed.

> 
> With HTTP, no issue but on SSL there is a different behavior
> 
> My helper return
> 
> rewrite-url=?https://192.168.1.122:443/myguard.php?rule-id=0&....
> 
> but according to debug, the Uri.cc understand?: host='https',
> port='443', path=''
> 
> In this case, squid try to connect to an https machine?name and return
> bad 503
> 
> ?
...
> 
> Did i miss something????
> 

Look at the input received by the helper. HTTPS uses CONNECT requests.
Those messages have authority-form URI not URLs. The above behaviour is
what happens when your helpers response is interpreted according to
authority-form syntax.

<https://tools.ietf.org/html/rfc7230#section-5.3.3>


You can prevent the SSL-Bump CONNECT messages being sent to the
re-writer with:
  url_rewrite_access deny CONNECT

OR,
 you can try to do a proper redirect by having the helper send:
  OK status=302 url=...


The latter *might* work. Depending on whether the client handles
redirection on CONNECT requests. Browsers don't support anything other
than 200 status. Other clients have a mix of behaviours so its somewhat
unreliable.

Amos


From admin at daraksun.com  Thu Aug 16 04:18:46 2018
From: admin at daraksun.com (Oldman)
Date: Wed, 15 Aug 2018 23:18:46 -0500 (CDT)
Subject: [squid-users] Do I need to be technical to use squid proxy?
In-Reply-To: <201808152120.44186.Antony.Stone@squid.open.source.it>
References: <1534350376533-0.post@n4.nabble.com>
 <201808151844.59373.Antony.Stone@squid.open.source.it>
 <1534354027176-0.post@n4.nabble.com>
 <201808152003.37817.Antony.Stone@squid.open.source.it>
 <1534358066183-0.post@n4.nabble.com>
 <201808152058.20589.Antony.Stone@squid.open.source.it>
 <1534360197331-0.post@n4.nabble.com>
 <201808152120.44186.Antony.Stone@squid.open.source.it>
Message-ID: <1534393126777-0.post@n4.nabble.com>

No anthony I did not change the conf file as I said in my first post I used
an automated squid installation script and installed it in my vps

this is the one

https://github.com/centminmod/squid-proxy-installer/blob/master/spi

Now can you kindly send me the default squid conf file ?

Thanks



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From amajer at suse.de  Thu Aug 16 06:41:33 2018
From: amajer at suse.de (Adam Majer)
Date: Thu, 16 Aug 2018 08:41:33 +0200
Subject: [squid-users] Do I need to be technical to use squid proxy?
In-Reply-To: <1534358066183-0.post@n4.nabble.com>
References: <1534350376533-0.post@n4.nabble.com>
 <201808151844.59373.Antony.Stone@squid.open.source.it>
 <1534354027176-0.post@n4.nabble.com>
 <201808152003.37817.Antony.Stone@squid.open.source.it>
 <1534358066183-0.post@n4.nabble.com>
Message-ID: <6441b6f1-7c46-d610-7419-2210666e1de6@suse.de>

On 08/15/2018 08:34 PM, Oldman wrote:
> No sir I do not understand that is why I am here trying to just come up with
> some configuration that helps me keep the squid swimming :)
> 
> About being dangerous  please guide me what to remove or add  
> 
> I suppose you are telling me that
>> acl SSL_ports port 1-65535 
>> acl Safe_ports port 1-65535
> 
> Are dangerous ?  Please guide me should I remove them all?

It's dangerous to run random code from random site. The things you list
downloads,

wget -O /etc/squid/squid.conf
https://raw.githubusercontent.com/hidden-refuge/squid-proxy-installer/master/spi-rhel5664.conf
--no-check-certificate;;

which is a big WTF in the first place.

1. the --no-check-certificate flag
2. the file there is different from the repository file

If you want to install squid, install it from your distribution's
source, not just run some random program you find in Google's search
engine. All distros have squid available. And at least those squid
versions don't come with malicious config files.

Best of luck,
Adam


From admin at daraksun.com  Thu Aug 16 06:59:10 2018
From: admin at daraksun.com (Oldman)
Date: Thu, 16 Aug 2018 01:59:10 -0500 (CDT)
Subject: [squid-users] Do I need to be technical to use squid proxy?
In-Reply-To: <6441b6f1-7c46-d610-7419-2210666e1de6@suse.de>
References: <1534350376533-0.post@n4.nabble.com>
 <201808151844.59373.Antony.Stone@squid.open.source.it>
 <1534354027176-0.post@n4.nabble.com>
 <201808152003.37817.Antony.Stone@squid.open.source.it>
 <1534358066183-0.post@n4.nabble.com>
 <6441b6f1-7c46-d610-7419-2210666e1de6@suse.de>
Message-ID: <1534402750502-0.post@n4.nabble.com>

Thanks a lot . I take your advice  delete every thing and install a new os
but I will need help 
Can you please point me to one online tutuorial that is easy to understand
and I can just
enter command ?  I will install centos I suppose



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From uhlar at fantomas.sk  Thu Aug 16 07:22:54 2018
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Thu, 16 Aug 2018 09:22:54 +0200
Subject: [squid-users] Do I need to be technical to use squid proxy?
In-Reply-To: <201808152120.44186.Antony.Stone@squid.open.source.it>
References: <1534350376533-0.post@n4.nabble.com>
 <201808152058.20589.Antony.Stone@squid.open.source.it>
 <1534360197331-0.post@n4.nabble.com>
 <201808152120.44186.Antony.Stone@squid.open.source.it>
Message-ID: <20180816072254.GA18282@fantomas.sk>

>On Wednesday 15 August 2018 at 21:09:57, Oldman wrote:
>> I won't change any thing unless I am sure here.

On 15.08.18 21:20, Antony Stone wrote:
>Well, you've certainly changed quite a lot of the standard config in the file
>you showed us earlier.

>> What was dangerous ?  Did you mean I could be hacked with that
>> configuration file?

>I seriously doubt you can be "hacked" (whatever you specifically mean by that)
>but only because you are running the Squid proxy on a domestic network and it
>is therefore almost certainly unreachable from the Internet.

in which case I ask if you (OP, Oldman) are really sure that your proxy is
not accessible from the internet.

Otherwise, any weak password in /etc/squid/passwd can be guessed by
attackers and your squid could be abused.

>However, defining "safe ports" to be "any port at all" means your proxy can be
>used for quite a number of protocols other than HTTP/S (for example, SMTP) and
>since this is almost certainly not what you want this proxy to be (ab)used
>for, you should stick the the default definition of safe ports which is
>designed to prevent this sort of abuse.
>
>Just out of interest, what made you make the changes you did to the standard
>config?

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Linux is like a teepee: no Windows, no Gates and an apache inside...


From david at articatech.com  Thu Aug 16 07:34:47 2018
From: david at articatech.com (David Touzeau)
Date: Thu, 16 Aug 2018 09:34:47 +0200
Subject: [squid-users] v4.2 url_rewrite Uri.cc line 371 bad URL parsing
	on SSL
In-Reply-To: <ee87f360-7a02-3382-ca79-262ddfc7fceb@treenet.co.nz>
References: <000a01d434f3$d2bf32b0$783d9810$@articatech.com>
 <ee87f360-7a02-3382-ca79-262ddfc7fceb@treenet.co.nz>
Message-ID: <005101d43533$9bc8cf60$d35a6e20$@articatech.com>

Thanks Amos for details.

Working like a charm now.

Instead of sending https://192.168.1.122:443/myguard.php?rule-id=0&.... 

Helper sends 192.168.1.122:443 


" url_rewrite_access deny CONNECT" is not a solution because, everything using SSL today ( thanks to Google that wants to encrypt all the Net and make proxies/Firewall/ICAP unusable )  and many Porn/Malwares/Hacking/Hacked websites using SSL.




-----Message d'origine-----
De : squid-users <squid-users-bounces at lists.squid-cache.org> De la part de Amos Jeffries
Envoy? : jeudi 16 ao?t 2018 03:51
? : squid-users at lists.squid-cache.org
Objet : Re: [squid-users] v4.2 url_rewrite Uri.cc line 371 bad URL parsing on SSL

On 16/08/18 11:58, David Touzeau wrote:
> Hi,
> 
>  
> 
> I have written my own url_rewrite helper
> 
>  
> 
> On SSL sites, the helper answering a redirect to a remote denied php  page.
> 

No your helper *rewrite* the URL without changing any other properties of the request message. This can be seen clearly in the use of "rewrite-url=" instead of "url=".

The difference is important when it comes to the type of message being processed.

> 
> With HTTP, no issue but on SSL there is a different behavior
> 
> My helper return
> 
> rewrite-url= https://192.168.1.122:443/myguard.php?rule-id=0&....
> 
> but according to debug, the Uri.cc understand : host='https', 
> port='443', path=''
> 
> In this case, squid try to connect to an https machine name and return 
> bad 503
> 
>  
...
> 
> Did i miss something ???
> 

Look at the input received by the helper. HTTPS uses CONNECT requests.
Those messages have authority-form URI not URLs. The above behaviour is what happens when your helpers response is interpreted according to authority-form syntax.

<https://tools.ietf.org/html/rfc7230#section-5.3.3>


You can prevent the SSL-Bump CONNECT messages being sent to the re-writer with:
  url_rewrite_access deny CONNECT

OR,
 you can try to do a proper redirect by having the helper send:
  OK status=302 url=...


The latter *might* work. Depending on whether the client handles redirection on CONNECT requests. Browsers don't support anything other than 200 status. Other clients have a mix of behaviours so its somewhat unreliable.

Amos
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From mikes at surcouf.co.uk  Thu Aug 16 08:16:58 2018
From: mikes at surcouf.co.uk (Mike Surcouf)
Date: Thu, 16 Aug 2018 08:16:58 +0000
Subject: [squid-users] [squid-announce] Squid 4.2 is available
In-Reply-To: <01d001d43367$c9324530$5b96cf90$@ngtech.co.il>
References: <28241c64-b221-ca2f-1e68-6ed28c332174@treenet.co.nz>
 <5B6EB078.6070608@mathemainzel.info>
 <001601d4333e$45ad9620$d108c260$@ngtech.co.il>
 <CAN8nrKCBW+i+VEbChwZR1K=CtJAQGL=UsBJeHk+9zUU476t0zA@mail.gmail.com>
 <01d001d43367$c9324530$5b96cf90$@ngtech.co.il>
Message-ID: <2197768425D7F5479A0FFB3FEC212F7FF642E398@aesmail.surcouf.local>

I hung onto CentOS 6 for a while but it?s no longer secure enough.  You really ought to move versions.

I would prefer to see Eliezer efforts used to make 4.2 available in the stable repo.

Thanks

Mike

From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Eliezer Croitoru
Sent: 14 August 2018 01:43
To: 'Dan Charlesworth'
Cc: 'squid-users'
Subject: Re: [squid-users] [squid-announce] Squid 4.2 is available

Well? there is a need to move forward to CentOS 7 if possible.
Squid 4.x has couple compiler compatibility which I do not remember but it was mentioned in the wiki and the release notes.

Thanks,
Eliezer

----
Eliezer Croitoru<http://ngtech.co.il/lmgtfy/>
Linux System Administrator
Mobile: +972-5-28704261
Email: eliezer at ngtech.co.il
[cid:image001.png at 01D43541.E269D500]

From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Dan Charlesworth
Sent: Tuesday, August 14, 2018 2:45 AM
To: squid-users <squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] [squid-announce] Squid 4.2 is available

I'd be all over any Squid 4 RPMs for EL6, for what that's worth.

I had downloaded your source RPM for EL7 at one point and tried to build one for EL6. Dealing with the compiler issues was a bit beyond me though, sadly.

On Tue, 14 Aug 2018 at 05:46, Eliezer Croitoru <eliezer at ngtech.co.il<mailto:eliezer at ngtech.co.il>> wrote:
I need to test it but I didn't had plans to release 4.X branch for CentOS 6.
It takes me time to test it and I hope I will have more time for it.

Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: eliezer at ngtech.co.il<mailto:eliezer at ngtech.co.il>


-----Original Message-----
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org<mailto:squid-users-bounces at lists.squid-cache.org>] On Behalf Of Walter H.
Sent: Saturday, August 11, 2018 12:47 PM
To: squid-users at lists.squid-cache.org<mailto:squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] [squid-announce] Squid 4.2 is available

On 10.08.2018 07:41, Amos Jeffries wrote:
> The Squid HTTP Proxy team is very pleased to announce the availability
> of the Squid-4.2 release!
>
>

will there be a RPM for latest CentOS 6 available?

Walter


_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org<mailto:squid-users at lists.squid-cache.org>
http://lists.squid-cache.org/listinfo/squid-users


--
Getbusi
p +61 3 6165 1555
e dan at getbusi.com<mailto:dan at getbusi.com>
w getbusi.com<http://getbusi.com>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180816/b7efff0a/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 11297 bytes
Desc: image001.png
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180816/b7efff0a/attachment.png>

From m_zouhairy at skno.by  Thu Aug 16 08:32:44 2018
From: m_zouhairy at skno.by (Vacheslav)
Date: Thu, 16 Aug 2018 11:32:44 +0300
Subject: [squid-users] microsoft list
In-Reply-To: <002501d4346a$7bb71200$73253600$@ngtech.co.il>
References: <470501d428a3$d6a70f80$83f52e80$@skno.by>
 <0a3c04d2-8d48-a074-fa5c-1a7480d8158a@netpilot.com>
 <582201d428c2$2557bb20$70073160$@skno.by>
 <1fc09ac8-c53d-3c08-fb61-86f55f8af8d9@treenet.co.nz>
 <0bc901d4295f$84582c70$8d088550$@skno.by>
 <00ac01d433a4$fe9afbd0$fbd0f370$@ngtech.co.il>
 <b64501d433bf$1f2add60$5d809820$@skno.by>
 <002501d4346a$7bb71200$73253600$@ngtech.co.il>
Message-ID: <394001d4353b$b452e0e0$1cf8a2a0$@skno.by>

It's not nice to practice hypocrisy, he who believes in evolution goes to magicians! 

-----Original Message-----
From: Eliezer Croitoru <eliezer at ngtech.co.il> 
Sent: Wednesday, August 15, 2018 10:35 AM
To: 'Vacheslav' <m_zouhairy at skno.by>
Cc: squid-users at lists.squid-cache.org
Subject: RE: [squid-users] microsoft list

Well..
It's a Squid-Cache mailing list but you wrote a very long sentence and it's hard to understand.
Health is important and trusting the Wizard is only when he proved himself worthy of it.
Microsoft have been proving that it's worth honor....
If you specifically do not like their updates or caching computability or security then you are in the right place.
Microwave is nice and has benefits and losses but.. it gives easier lives to many.

Here we try to be direct and to not hold a mystery in the text.
You are welcome to add some more technical details to the subject if we do not know about it.

I will try to look at the git repository and learn.

All The Bests,
Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: eliezer at ngtech.co.il


-----Original Message-----
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Vacheslav
Sent: Tuesday, August 14, 2018 2:08 PM
Cc: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] microsoft list

Well since you asked and are actually interested, I am going to reveal the secret just like Vanunu and  Rabin. The program is called disable win track!
But what I don't understand is that too many people get to understand stuff like split and peak and tls and even tougher technical stuff but when it comes to health, they just trust their wizard is giving them the right magic potion!
No one would break a thermometer and drink its contents but that is exactly what most do to their dearest beloved ones with disaster loaded needles!

-----Original Message-----
From: Eliezer Croitoru <eliezer at ngtech.co.il> 
Sent: Tuesday, August 14, 2018 11:01 AM
To: 'Vacheslav' <m_zouhairy at skno.by>
Cc: squid-users at lists.squid-cache.org
Subject: RE: [squid-users] microsoft list

>Can you share this git with us?
>We are probably not updated enough.
>It will probably help others too so.

Can you please share it with us?

Thanks,
Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: eliezer at ngtech.co.il


-----Original Message-----
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Vacheslav
Sent: Wednesday, August 1, 2018 9:19 AM
To: 'Amos Jeffries' <squid3 at treenet.co.nz>; squid-users at lists.squid-cache.org
Subject: Re: [squid-users] microsoft list


-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Amos Jeffries
Sent: Tuesday, July 31, 2018 7:34 PM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] microsoft list

On 31/07/18 23:32, Vacheslav wrote:
> Satanic greetings, you really think you are the smartest of us all that we can't think of your stupid suggestion?
> 

>Please be civil. The response you received was a reasonable answer to your question.

You won't find any more civil love than that.

>Both the TechNet article linked and the Squid FAQ config example for Windows Update contains lists of domains that service uses.

>Blocking the rest of Microsoft and all of Akamai *by URL* is a much more difficult proposition. Between them they host a very large percentage of Internet domains.

Your last sentence is totally false. I found an open source handy piece of software which lets you choose how much you would like to block, even skype if desired, too bad there isn't a donate button on github or am I missing it?
So I just copied the domains inserted in the hosts file and plugged it in ufdbguard and the people who use this squid have considerably less traffic than others.

>Amos
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users


_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users





From piuschungath at gmail.com  Thu Aug 16 09:15:59 2018
From: piuschungath at gmail.com (pius)
Date: Thu, 16 Aug 2018 04:15:59 -0500 (CDT)
Subject: [squid-users] Have issue with "https_port ssl-bump intercept"
In-Reply-To: <1534179998578-0.post@n4.nabble.com>
References: <1533924325185-0.post@n4.nabble.com>
 <35064290-e6e6-569a-6c27-5f25624e9735@measurement-factory.com>
 <1533927868704-0.post@n4.nabble.com>
 <a5b0cd00-a61d-f31d-8fe2-61b3397f23c3@measurement-factory.com>
 <1534149123813-0.post@n4.nabble.com> <1534168104650-0.post@n4.nabble.com>
 <1534179998578-0.post@n4.nabble.com>
Message-ID: <1534410959319-0.post@n4.nabble.com>

Hi,

We are planning to control the traffic that goes out from the network. Few
of them are HTTPS. we managed to whitelist HTTP traffic that going out the
network. And we are really happy about it. Now only worry we got is the
HTTPS traffic. 

I listen 2 port in squid.  3129(HTTP) and 3130 (HTTPS). 

When we communicate https traffic to the outside world, we prefer to use
3130 so that we will have an end to end encryption. But at the same time, I
need to whitelist some domain name so that only those domain name can be
communicated safely. Is this is possible in squid? 



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From admin at daraksun.com  Thu Aug 16 09:39:29 2018
From: admin at daraksun.com (Oldman)
Date: Thu, 16 Aug 2018 04:39:29 -0500 (CDT)
Subject: [squid-users] Allow one country only be able to use squid proxy?
Message-ID: <1534412369606-0.post@n4.nabble.com>

I can get block of a country ip from

https://www.ip2location.com/blockvisitorsbycountry.aspx

Where to put that in conf file so I from a particular country only can
access internet?



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From Antony.Stone at squid.open.source.it  Thu Aug 16 09:50:23 2018
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Thu, 16 Aug 2018 11:50:23 +0200
Subject: [squid-users] Allow one country only be able to use squid proxy?
In-Reply-To: <1534412369606-0.post@n4.nabble.com>
References: <1534412369606-0.post@n4.nabble.com>
Message-ID: <201808161150.23565.Antony.Stone@squid.open.source.it>

On Thursday 16 August 2018 at 11:39:29, Oldman wrote:

> I can get block of a country ip from
> 
> https://www.ip2location.com/blockvisitorsbycountry.aspx
> 
> Where to put that in conf file so I from a particular country only can
> access internet?

Er, you are suggesting that you will run a Squid proxy which can be used by 
anyone with an IP address in a certain country?

Who are you trying to provide proxy services to?


Antony.

-- 
"Measuring average network latency is about as useful as measuring the mean 
temperature of patients in a hospital."

 - St?phane Bortzmeyer

                                                   Please reply to the list;
                                                         please *don't* CC me.


From m_zouhairy at skno.by  Thu Aug 16 09:53:16 2018
From: m_zouhairy at skno.by (Vacheslav)
Date: Thu, 16 Aug 2018 12:53:16 +0300
Subject: [squid-users] Allow one country only be able to use squid proxy?
In-Reply-To: <201808161150.23565.Antony.Stone@squid.open.source.it>
References: <1534412369606-0.post@n4.nabble.com>
 <201808161150.23565.Antony.Stone@squid.open.source.it>
Message-ID: <496901d43546$f4a824b0$ddf86e10$@skno.by>

Why not just use an ad & porn blocking dns server?

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Antony Stone
Sent: Thursday, August 16, 2018 12:50 PM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Allow one country only be able to use squid proxy?

On Thursday 16 August 2018 at 11:39:29, Oldman wrote:

> I can get block of a country ip from
> 
> https://www.ip2location.com/blockvisitorsbycountry.aspx
> 
> Where to put that in conf file so I from a particular country only can 
> access internet?

>Er, you are suggesting that you will run a Squid proxy which can be used by anyone with an IP address in a certain country?

>Who are you trying to provide proxy services to?


Antony.

--
"Measuring average network latency is about as useful as measuring the mean temperature of patients in a hospital."

 - St?phane Bortzmeyer

                                                   Please reply to the list;
                                                         please *don't* CC me.
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users




From Antony.Stone at squid.open.source.it  Thu Aug 16 09:56:43 2018
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Thu, 16 Aug 2018 11:56:43 +0200
Subject: [squid-users] Allow one country only be able to use squid proxy?
In-Reply-To: <496901d43546$f4a824b0$ddf86e10$@skno.by>
References: <1534412369606-0.post@n4.nabble.com>
 <201808161150.23565.Antony.Stone@squid.open.source.it>
 <496901d43546$f4a824b0$ddf86e10$@skno.by>
Message-ID: <201808161156.43822.Antony.Stone@squid.open.source.it>

On Thursday 16 August 2018 at 11:53:16, Vacheslav wrote:

> Why not just use an ad & porn blocking dns server?

Because that does something totally different from what Oldman appears to be 
trying to do?


Antony.

> -----Original Message-----
> From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of
> Antony Stone Sent: Thursday, August 16, 2018 12:50 PM
> To: squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] Allow one country only be able to use squid
> proxy?
> 
> On Thursday 16 August 2018 at 11:39:29, Oldman wrote:
> > I can get block of a country ip from
> > 
> > https://www.ip2location.com/blockvisitorsbycountry.aspx
> > 
> > Where to put that in conf file so I from a particular country only can
> > access internet?
> >
> >Er, you are suggesting that you will run a Squid proxy which can be used
> >by anyone with an IP address in a certain country?
> >
> >Who are you trying to provide proxy services to?
> 
> Antony.

-- 
I have an excellent memory.
I can't think of a single thing I've forgotten.

                                                   Please reply to the list;
                                                         please *don't* CC me.


From admin at daraksun.com  Thu Aug 16 10:14:04 2018
From: admin at daraksun.com (Oldman)
Date: Thu, 16 Aug 2018 05:14:04 -0500 (CDT)
Subject: [squid-users] simple question Installed squid right now all
 internet access is blocked
Message-ID: <1534414444192-0.post@n4.nabble.com>

OK I am newbie so please bear with me

I am just learning nothing special no serious project

what to change in my conf so I can access internet :)



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From squid3 at treenet.co.nz  Thu Aug 16 10:14:45 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 16 Aug 2018 22:14:45 +1200
Subject: [squid-users] v4.2 url_rewrite Uri.cc line 371 bad URL parsing
 on SSL
In-Reply-To: <005101d43533$9bc8cf60$d35a6e20$@articatech.com>
References: <000a01d434f3$d2bf32b0$783d9810$@articatech.com>
 <ee87f360-7a02-3382-ca79-262ddfc7fceb@treenet.co.nz>
 <005101d43533$9bc8cf60$d35a6e20$@articatech.com>
Message-ID: <63d77def-0123-8928-c9a8-c3f7f8a19bf8@treenet.co.nz>

On 16/08/18 19:34, David Touzeau wrote:
> Thanks Amos for details.
> 
> Working like a charm now.
> 
> Instead of sending https://192.168.1.122:443/myguard.php?rule-id=0&.... 
> 
> Helper sends 192.168.1.122:443 
> 

That is only useful if the server at that IP:port can present the client
with a TLS certificate valid for the server the client thinks it is
connected to. ie all the SSL-Bump equivalent logics are in that server.

In which case there is likely no point to having the traffic NAT'ed to
Squid. Just have your NAT and/or routing send it directly into that server.

> 
> " url_rewrite_access deny CONNECT" is not a solution because, everything using SSL today ( thanks to Google that wants to encrypt all the Net and make proxies/Firewall/ICAP unusable )  and many Porn/Malwares/Hacking/Hacked websites using SSL.
> 

If you are SSL-Bump'ing in Squid then you need to not rewrite the
initial CONNECT message (or two) - doing so will interfere the server
which bumping is interacting with.

IIRC the at_step ACL type can be used in the *_access rules as well to
skip ("deny CONNECT foo") the helper query until the ssl_bump processing
is expected to be completed.

Amos


From Antony.Stone at squid.open.source.it  Thu Aug 16 10:27:15 2018
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Thu, 16 Aug 2018 12:27:15 +0200
Subject: [squid-users] simple question Installed squid right now all
	internet access is blocked
In-Reply-To: <1534414444192-0.post@n4.nabble.com>
References: <1534414444192-0.post@n4.nabble.com>
Message-ID: <201808161227.15264.Antony.Stone@squid.open.source.it>

On Thursday 16 August 2018 at 12:14:04, Oldman wrote:

> OK I am newbie so please bear with me
> 
> I am just learning nothing special no serious project
> 
> what to change in my conf so I can access internet :)

Let's start with some basics...

1. What operating system have you installed Squid onto?

2. Which version have you installed?

3. How did you install Squid?

4. Did you follow any documentation telling you how to install and configure 
Squid?  If yes, show us the URL of the documentation you followed.

5. Are you using the standard Squid config file?  See
https://wiki.squid-cache.org/SquidFaq/ConfiguringSquid for examples.

6. Have you made any changes to the installed config file?  If so, give us 
details.

7. I'm assuming you are using a browser to access web sites via Squid.  Have 
you configured that browser to use a proxy, and entered the IP address and port 
number of Squid so the browser knows where to find it?

8. You say "all Internet access is blocked".  Give us details of how you know 
this - copy and paste error messages, tell us which application/s are 
producing the messages, and preferably show us what appears in the Squid 
access log when you try to access the Internet.

Basically, please understand that we can only help you if we know:

 - what you're trying to acheive
 - what you've done so far
 - what's going wrong

otherwise we're just making guesses about your computer, your network, and 
your setup, which may be quite inaccurate.


Regards,


Antony.

-- 
I lay awake all night wondering where the sun went, and then it dawned on me.

                                                   Please reply to the list;
                                                         please *don't* CC me.


From admin at daraksun.com  Thu Aug 16 10:35:40 2018
From: admin at daraksun.com (Oldman)
Date: Thu, 16 Aug 2018 05:35:40 -0500 (CDT)
Subject: [squid-users] simple question Installed squid right now all
 internet access is blocked
In-Reply-To: <201808161227.15264.Antony.Stone@squid.open.source.it>
References: <1534414444192-0.post@n4.nabble.com>
 <201808161227.15264.Antony.Stone@squid.open.source.it>
Message-ID: <1534415740272-0.post@n4.nabble.com>

See I took your invoice and deleted every thing
installed Centos 6  32  bit in my VPS

then yum install squid  I installed it

I have configured my browser correctly and this is my conf file 

https://pastebin.com/raw/hxkMNbss







--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From Antony.Stone at squid.open.source.it  Thu Aug 16 10:48:18 2018
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Thu, 16 Aug 2018 12:48:18 +0200
Subject: [squid-users] simple question Installed squid right now all
	internet access is blocked
In-Reply-To: <1534415740272-0.post@n4.nabble.com>
References: <1534414444192-0.post@n4.nabble.com>
 <201808161227.15264.Antony.Stone@squid.open.source.it>
 <1534415740272-0.post@n4.nabble.com>
Message-ID: <201808161248.18762.Antony.Stone@squid.open.source.it>

On Thursday 16 August 2018 at 12:35:40, Oldman wrote:

> See I took your invoice and deleted every thing
> installed Centos 6  32  bit in my VPS
> 
> then yum install squid  I installed it

Okay, I'm going to guess that you're using Squid 3.4 then.

> I have configured my browser correctly and this is my conf file
> 
> https://pastebin.com/raw/hxkMNbss

That looks much better than the first config file you showed us :)

Note that the cache_dir directive is still commented-out, so you won't be 
doing any caching with that setup, but that's not important right now; it 
won't be blocking access to web sites.


Now we just need an answer to my question 8.


Regards,


Antony.

-- 
Never automate fully anything that does not have a manual override capability. 
Never design anything that cannot work under degraded conditions in emergency.

                                                   Please reply to the list;
                                                         please *don't* CC me.


From squid3 at treenet.co.nz  Thu Aug 16 10:59:04 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 16 Aug 2018 22:59:04 +1200
Subject: [squid-users] Do I need to be technical to use squid proxy?
In-Reply-To: <1534402750502-0.post@n4.nabble.com>
References: <1534350376533-0.post@n4.nabble.com>
 <201808151844.59373.Antony.Stone@squid.open.source.it>
 <1534354027176-0.post@n4.nabble.com>
 <201808152003.37817.Antony.Stone@squid.open.source.it>
 <1534358066183-0.post@n4.nabble.com>
 <6441b6f1-7c46-d610-7419-2210666e1de6@suse.de>
 <1534402750502-0.post@n4.nabble.com>
Message-ID: <d532d96e-efcf-3cb1-fb1b-af6c0a26db45@treenet.co.nz>

On 16/08/18 18:59, Oldman wrote:
> Thanks a lot . I take your advice  delete every thing and install a new os
> but I will need help 

That is not what was being suggested (unless you installed the whole OS
from a source without knowing what was going on). Just using safe
practices when installing software.

Reading that script it does use your OS providers package installer and
repository. So that part is safe enough.

The weird parts are how it then completely replaces your squid.conf with
its own broken config file and some (wrong) claims it makes about
htpasswd hashing.

You should be able to just drop in the default config for your Squid
version. Which should be one of these:

<https://wiki.squid-cache.org/SquidFaq/ConfiguringSquid#Do_you_have_a_squid.conf_example.3F>

OR, a squid.conf.default file containing the above with a few more
comments should have been installed with your Squid.


A Squid using those defaults should "just work". So your needed
technical know-how scales with the complexity of what you are trying to
do - from none (default setup) to expert (lots of custom config).


eg. if you have sufficient technical know-how to read that installer
script and understand it - then choosing to run it can be okay as you
should then also know how to fix the broken bits in it.


> Can you please point me to one online tutuorial that is easy to understand
> and I can just
> enter command ?  I will install centos I suppose

If you are already familiar with that OS then sure. Just be aware CentOS
is targeted at corporate installations, so a moderate level of expertise
is assumed and building/patching ones own software more common in that
community.

distrowatch.com is a pretty good resource for getting into OpenSource
systems. For example; it lists the top-ten most popular OS distributions
as currently:

Rank 	Distribution
1 	Manjaro
2 	Mint
3 	Ubuntu
4 	Debian
5 	elementary
6 	Solus
7 	MX Linux
8 	Antergos
9 	Fedora
10 	openSUSE

The distro popularity tends to mean they are more polished and easier to
use than the less popular OS (which likewise tend to be more targeted at
specific uses). Or at very least there are a lot of people knowing about
them to be found.

[Manjaro being #1 surprises me. The others all match what I have heard
from many sources in terms of OS people are finding easy to use.]

Tutorials and How-To's should be readily available for most OS. Via your
favourite search engine, if not the distribution itself. If you cannot
find something you understand for a particular OS it's likely not a good
choice to be installing as a beginner.

That level of help is technically off-topic here. Once you have a
machine you can use, help with the Squid installation and setup parts is
what we are all about.

HTH
Amos


From admin at daraksun.com  Thu Aug 16 11:05:31 2018
From: admin at daraksun.com (Oldman)
Date: Thu, 16 Aug 2018 06:05:31 -0500 (CDT)
Subject: [squid-users] simple question Installed squid right now all
 internet access is blocked
In-Reply-To: <201808161248.18762.Antony.Stone@squid.open.source.it>
References: <1534414444192-0.post@n4.nabble.com>
 <201808161227.15264.Antony.Stone@squid.open.source.it>
 <1534415740272-0.post@n4.nabble.com>
 <201808161248.18762.Antony.Stone@squid.open.source.it>
Message-ID: <1534417531388-0.post@n4.nabble.com>

Abour your question number 8

This is the screenshot

https://ibb.co/j4DcLp

I just tested trying to access websites





--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From Antony.Stone at squid.open.source.it  Thu Aug 16 11:11:39 2018
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Thu, 16 Aug 2018 13:11:39 +0200
Subject: [squid-users] simple question Installed squid right now all
	internet access is blocked
In-Reply-To: <1534417531388-0.post@n4.nabble.com>
References: <1534414444192-0.post@n4.nabble.com>
 <201808161248.18762.Antony.Stone@squid.open.source.it>
 <1534417531388-0.post@n4.nabble.com>
Message-ID: <201808161311.39975.Antony.Stone@squid.open.source.it>

On Thursday 16 August 2018 at 13:05:31, Oldman wrote:

> Abour your question number 8
> 
> This is the screenshot
> 
> https://ibb.co/j4DcLp
> 
> I just tested trying to access websites

Okay, so firstly that tells me you're using Squid 3.1.23 and not 3.4 as I had 
assumed for CentOS 6.

Secondly please tell us:

 - the IP address of the computer you're running the browser on

 - the IP address of the machine running Squid

 - what appears in Squid's access log (probably found at 
/var/log/squid/access.log, but I'm not a CentOS user, so this might not be 
completely accurate) when you try to visit a website.


Regards,


Antony.

-- 
I bought a book about anti-gravity.  The reviews say you can't put it down.

                                                   Please reply to the list;
                                                         please *don't* CC me.


From squid3 at treenet.co.nz  Thu Aug 16 11:17:24 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 16 Aug 2018 23:17:24 +1200
Subject: [squid-users] Have issue with "https_port ssl-bump intercept"
In-Reply-To: <1534410959319-0.post@n4.nabble.com>
References: <1533924325185-0.post@n4.nabble.com>
 <35064290-e6e6-569a-6c27-5f25624e9735@measurement-factory.com>
 <1533927868704-0.post@n4.nabble.com>
 <a5b0cd00-a61d-f31d-8fe2-61b3397f23c3@measurement-factory.com>
 <1534149123813-0.post@n4.nabble.com> <1534168104650-0.post@n4.nabble.com>
 <1534179998578-0.post@n4.nabble.com> <1534410959319-0.post@n4.nabble.com>
Message-ID: <2216dbb6-daad-650c-eefe-4c2f1e2f697c@treenet.co.nz>

On 16/08/18 21:15, pius wrote:
> Hi,
> 
> We are planning to control the traffic that goes out from the network. Few
> of them are HTTPS. we managed to whitelist HTTP traffic that going out the
> network. And we are really happy about it. Now only worry we got is the
> HTTPS traffic. 
> 
> I listen 2 port in squid.  3129(HTTP) and 3130 (HTTPS). 
> 
> When we communicate https traffic to the outside world, we prefer to use
> 3130 so that we will have an end to end encryption. But at the same time, I
> need to whitelist some domain name so that only those domain name can be
> communicated safely. Is this is possible in squid?

Yes, provided that:
 1) only the domain name is wanted, and
 2 a) the client sends TLS SNI, and
 2 b) the server certificate confirms the TLS SNI

In that one case, you can use SSL-Bump peek and splice to retain the
encryption.

 acl whitelist ssl::server_name ...

 acl step1 at_step SslBump1
 acl step2 at_step SslBump2

 ssl_bump peek all
 ssl_bump splice whitelist
 ssl_bump terminate all

NP: you will still have to configure Squid with a self-signed CA cert
for the odd situations when Squid has to 'bump' to deliver errors to the
client.

Care also has to be taken to "allow" the CONNECT messages SSl-Bump
processing uses. These may appear in http_access etc. with raw-IP:port
only OR with non-whitelisted domains from TLS SNI.

The above config will only whitelist after the server cert is known and
should terminate TLS without any HTTP(S) error page being delivered to
clients - but can only do so if http_access does _not_ cause a "deny"
part way through the handshake (eg from on-whitelisted SNI names).


BTW; Please also be aware that TLS is *not* "end-to-end". It is only
point-to-point encryption. It is a mistake to think of it as fully
end-to-end. There are very likely multiple HTTP(S) network hops at both
client and server ends which are encrypted differently or unencrypted.

Amos


From admin at daraksun.com  Thu Aug 16 11:22:38 2018
From: admin at daraksun.com (Oldman)
Date: Thu, 16 Aug 2018 06:22:38 -0500 (CDT)
Subject: [squid-users] simple question Installed squid right now all
 internet access is blocked
In-Reply-To: <201808161311.39975.Antony.Stone@squid.open.source.it>
References: <1534414444192-0.post@n4.nabble.com>
 <201808161227.15264.Antony.Stone@squid.open.source.it>
 <1534415740272-0.post@n4.nabble.com>
 <201808161248.18762.Antony.Stone@squid.open.source.it>
 <1534417531388-0.post@n4.nabble.com>
 <201808161311.39975.Antony.Stone@squid.open.source.it>
Message-ID: <1534418558710-0.post@n4.nabble.com>

The answer is simple :)

Are you kidding? Why do you want my proxy  ip ?

I do not have the knowledge but did you think I was stupid?

Ha Ha  you do not want to help 



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From Antony.Stone at squid.open.source.it  Thu Aug 16 11:27:00 2018
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Thu, 16 Aug 2018 13:27:00 +0200
Subject: [squid-users] simple question Installed squid right now all
	internet access is blocked
In-Reply-To: <1534418558710-0.post@n4.nabble.com>
References: <1534414444192-0.post@n4.nabble.com>
 <201808161311.39975.Antony.Stone@squid.open.source.it>
 <1534418558710-0.post@n4.nabble.com>
Message-ID: <201808161327.00386.Antony.Stone@squid.open.source.it>

On Thursday 16 August 2018 at 13:22:38, Oldman wrote:

> The answer is simple :)
> 
> Are you kidding?

No.

> Why do you want my proxy  ip ?

Because it may be relevant to understanding why your proxy is disallowing 
requests from your computer.

> I do not have the knowledge but did you think I was stupid?

No, I do not think you are stupid; you are clearly just inexperienced with 
networking.

> Ha Ha  you do not want to help

You can believe that if you choose to.  I think I have been extremely helpful 
to you so far, especially given the amount of information you have provided 
about what you are trying to do and what problems you're running into.

At the very least, show us what appears in your Squid access log file when you 
make a request from the browser.


Antony.

-- 
The Magic Words are Squeamish Ossifrage.

                                                   Please reply to the list;
                                                         please *don't* CC me.


From admin at daraksun.com  Thu Aug 16 11:29:04 2018
From: admin at daraksun.com (Oldman)
Date: Thu, 16 Aug 2018 06:29:04 -0500 (CDT)
Subject: [squid-users] simple question Installed squid right now all
 internet access is blocked
In-Reply-To: <201808161327.00386.Antony.Stone@squid.open.source.it>
References: <1534414444192-0.post@n4.nabble.com>
 <201808161227.15264.Antony.Stone@squid.open.source.it>
 <1534415740272-0.post@n4.nabble.com>
 <201808161248.18762.Antony.Stone@squid.open.source.it>
 <1534417531388-0.post@n4.nabble.com>
 <201808161311.39975.Antony.Stone@squid.open.source.it>
 <1534418558710-0.post@n4.nabble.com>
 <201808161327.00386.Antony.Stone@squid.open.source.it>
Message-ID: <1534418944831-0.post@n4.nabble.com>

You wanted to know my server ip  and did you expect me to publish this
online?

I chose to beleive you are wasting my time :)

I am sorry I do not want to be rude but you are wasting my time.



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From alex at nanogherkin.com  Thu Aug 16 11:36:50 2018
From: alex at nanogherkin.com (Alex Crow)
Date: Thu, 16 Aug 2018 12:36:50 +0100
Subject: [squid-users] simple question Installed squid right now all
 internet access is blocked
In-Reply-To: <1534418944831-0.post@n4.nabble.com>
References: <1534414444192-0.post@n4.nabble.com>
 <201808161227.15264.Antony.Stone@squid.open.source.it>
 <1534415740272-0.post@n4.nabble.com>
 <201808161248.18762.Antony.Stone@squid.open.source.it>
 <1534417531388-0.post@n4.nabble.com>
 <201808161311.39975.Antony.Stone@squid.open.source.it>
 <1534418558710-0.post@n4.nabble.com>
 <201808161327.00386.Antony.Stone@squid.open.source.it>
 <1534418944831-0.post@n4.nabble.com>
Message-ID: <22edeaf5-3d98-0a38-ca8a-6b114e5933b0@nanogherkin.com>

If it's an internal/RFC1918? IP then it makes no difference to your 
security in telling the list. If it's a public IP address then I hope 
you have your squid firewalled off from the internet.

If you at least paste your access.log and cache.log it will help.

Alex


On 16/08/18 12:29, Oldman wrote:
> You wanted to know my server ip  and did you expect me to publish this
> online?
>
> I chose to beleive you are wasting my time :)
>
> I am sorry I do not want to be rude but you are wasting my time.
>
>
>
> --
> Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



From Antony.Stone at squid.open.source.it  Thu Aug 16 11:38:46 2018
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Thu, 16 Aug 2018 13:38:46 +0200
Subject: [squid-users] simple question Installed squid right now all
	internet access is blocked
In-Reply-To: <1534418944831-0.post@n4.nabble.com>
References: <1534414444192-0.post@n4.nabble.com>
 <201808161327.00386.Antony.Stone@squid.open.source.it>
 <1534418944831-0.post@n4.nabble.com>
Message-ID: <201808161338.46966.Antony.Stone@squid.open.source.it>

On Thursday 16 August 2018 at 13:29:04, Oldman wrote:

> You wanted to know my server ip  and did you expect me to publish this
> online?

Well, let's just discuss "public" and "private" IP addresses for a moment.

If your proxy server's IP address starts with 192.168, then nobody on the 
Internet can get to it - it is only accessible to you on your local network.

The same applies if the address starts with 10, or with 172 followed by 
anything between 16 and 31.

If, on the other hand, your proxy's IP address does not match any of the 
above, then you are running it on a public IP address, and your configuration 
file is only allowing access from private addresses, which cannot be routed 
over the Internet.

That would be an explanation of why your proxy is denying access to your 
browser.

I would seriously question the wisdom of running a Squid proxy on a public IP 
address given your level of knowledge about networking, however.

> I chose to beleive you are wasting my time :)
> 
> I am sorry I do not want to be rude but you are wasting my time.

In fact, you are wasting mine.

You have come here to get help from people who know more about Squid and 
networking than you do, and both I and others have spent time giving you 
advice and helping you to achieve what you want.

If you do not want to give us the information we need to understand what your 
setup is and what might be wrong with it, that's entirely up to you.


Regards,


Antony.

-- 
My life is going completely according to plan.

I do sometimes wish it had been *my* plan, though.

                                                   Please reply to the list;
                                                         please *don't* CC me.


From Antony.Stone at squid.open.source.it  Thu Aug 16 11:50:47 2018
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Thu, 16 Aug 2018 13:50:47 +0200
Subject: [squid-users] simple question Installed squid right now all
	internet access is blocked
In-Reply-To: <22edeaf5-3d98-0a38-ca8a-6b114e5933b0@nanogherkin.com>
References: <1534414444192-0.post@n4.nabble.com>
 <1534418944831-0.post@n4.nabble.com>
 <22edeaf5-3d98-0a38-ca8a-6b114e5933b0@nanogherkin.com>
Message-ID: <201808161350.47403.Antony.Stone@squid.open.source.it>

On Thursday 16 August 2018 at 13:36:50, Alex Crow wrote:

> If it's an internal/RFC1918 IP then it makes no difference to your
> security in telling the list.

Just in case you (Oldman) don't understand this reference, it's a document 
which explains in far more detail than I just did what a private IP address 
is.

https://tools.ietf.org/html/rfc1918

You might find https://en.wikipedia.org/wiki/Private_network a little more 
accessible.

> If it's a public IP address then I hope you have your squid firewalled off
> from the internet.

Hear hear.

> If you at least paste your access.log and cache.log it will help.

Agreed.

> On 16/08/18 12:29, Oldman wrote:
> > You wanted to know my server ip  and did you expect me to publish this
> > online?
> > 
> > I chose to beleive you are wasting my time :)
> > 
> > I am sorry I do not want to be rude but you are wasting my time.

Regards,


Antony.

-- 
Python is executable pseudocode.
Perl is executable line noise.

                                                   Please reply to the list;
                                                         please *don't* CC me.


From squid3 at treenet.co.nz  Thu Aug 16 12:03:05 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 17 Aug 2018 00:03:05 +1200
Subject: [squid-users] Have issue with "https_port ssl-bump intercept"
In-Reply-To: <2216dbb6-daad-650c-eefe-4c2f1e2f697c@treenet.co.nz>
References: <1533924325185-0.post@n4.nabble.com>
 <35064290-e6e6-569a-6c27-5f25624e9735@measurement-factory.com>
 <1533927868704-0.post@n4.nabble.com>
 <a5b0cd00-a61d-f31d-8fe2-61b3397f23c3@measurement-factory.com>
 <1534149123813-0.post@n4.nabble.com> <1534168104650-0.post@n4.nabble.com>
 <1534179998578-0.post@n4.nabble.com> <1534410959319-0.post@n4.nabble.com>
 <2216dbb6-daad-650c-eefe-4c2f1e2f697c@treenet.co.nz>
Message-ID: <bcc77c36-9002-4e9b-ff7f-c76b99da1b13@treenet.co.nz>

On 16/08/18 23:17, Amos Jeffries wrote:>
> The above config will only whitelist after the server cert is known and
> should terminate TLS without any HTTP(S) error page being delivered to
> clients - but can only do so if http_access does _not_ cause a "deny"
> part way through the handshake (eg from on-whitelisted SNI names).

Sorry that should read:  "from non-whitelisted SNI names"

Amos


From squid3 at treenet.co.nz  Thu Aug 16 12:31:34 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 17 Aug 2018 00:31:34 +1200
Subject: [squid-users] simple question Installed squid right now all
 internet access is blocked
In-Reply-To: <201808161350.47403.Antony.Stone@squid.open.source.it>
References: <1534414444192-0.post@n4.nabble.com>
 <1534418944831-0.post@n4.nabble.com>
 <22edeaf5-3d98-0a38-ca8a-6b114e5933b0@nanogherkin.com>
 <201808161350.47403.Antony.Stone@squid.open.source.it>
Message-ID: <f0a3ac64-0a98-dd37-8bc0-91b601b1f05a@treenet.co.nz>

On 16/08/18 23:50, Antony Stone wrote:
> On Thursday 16 August 2018 at 13:36:50, Alex Crow wrote:
> 
>> If it's an internal/RFC1918 IP then it makes no difference to your
>> security in telling the list.
> 
> Just in case you (Oldman) don't understand this reference, it's a document 
> which explains in far more detail than I just did what a private IP address 
> is.
> 
> https://tools.ietf.org/html/rfc1918
> 
> You might find https://en.wikipedia.org/wiki/Private_network a little more 
> accessible.
> 
>> If it's a public IP address then I hope you have your squid firewalled off
>> from the internet.
> 
> Hear hear.
> 
>> If you at least paste your access.log and cache.log it will help.
> 
> Agreed.

If it helps, I do not think the Squid IP is necessary at this point. The
error message happening shows the Browser is successfully contacting the
proxy. It just not permitted through.

Oldman:
 if you really don't want to reveal any of your IPs at all you can
replace them in the published details with a placeholder value. So long
as you pick a unique placeholder for each IP and use them consistently
through the discussion. So we can a) see clearly when two different IPs
are occuring (eg to point out when they should be the same etc.).


If you still don't want to say. Then all we can do is point you at the
FAQ about how to write access controls. Maybe it will teach you how to
write the necessary rules yourself.

 <https://wiki.squid-cache.org/SquidFaq/SquidAcl>

 see particularly the sections above "How do I allow my clients to use
the cache?".

That FAQ says (what I think is) the solution to your problem, but the
sections above the answer are needed to understand what values need
entering into *your* particular squid.conf which may differ from the FAQ
answer.

As Anthony said the 172.* IPs are already allowed in the default config
so a simple cut-n-paste of the FAQ example text into your squid.conf at
"INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS" won't
change anything.


HTH
Amos


From robertocarna36 at gmail.com  Thu Aug 16 12:43:56 2018
From: robertocarna36 at gmail.com (Roberto Carna)
Date: Thu, 16 Aug 2018 09:43:56 -0300
Subject: [squid-users] Squid + Squidguard Youtube URL video filtering
Message-ID: <CAG2Qp6v4zATdvvVYivjHuuv2GhTdkxBYEmqoOA_FZu78kwrkWQ@mail.gmail.com>

Dear, I have Squid + Squidguard working OK.

Squidguard is filtering the entire www.youtube.com website.

But now I have to permit just one video from Youtube:

https://www.youtube.com/embed/ff9sDLGtnK8?rel=0&showinfo=0

I have added the below URL as an exception in Squidguard:

www.youtube.com/embed/ff9sDLGtnK8?rel=0&showinfo=0

but after that I can't see it, still blocked.

How can I enable just this URL from Squidguard preferently blocking
the rest of Youtube ???

Maybe do I have to use some escape symbols in the URL from Squidguard
excepction list?

Special thanks.


From squid3 at treenet.co.nz  Thu Aug 16 12:47:39 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 17 Aug 2018 00:47:39 +1200
Subject: [squid-users] simple question Installed squid right now all
 internet access is blocked
In-Reply-To: <f0a3ac64-0a98-dd37-8bc0-91b601b1f05a@treenet.co.nz>
References: <1534414444192-0.post@n4.nabble.com>
 <1534418944831-0.post@n4.nabble.com>
 <22edeaf5-3d98-0a38-ca8a-6b114e5933b0@nanogherkin.com>
 <201808161350.47403.Antony.Stone@squid.open.source.it>
 <f0a3ac64-0a98-dd37-8bc0-91b601b1f05a@treenet.co.nz>
Message-ID: <a755ac11-f712-3b8d-0e02-fe76da5346b6@treenet.co.nz>

On second thought; were you wanting to use authentication or something
other than IPs to permit access to the proxy? such as what that
installer script was trying to setup for you.
That would be a different solution, but also on that FAQ page at 8.1
"Using Proxy Authentication".

Amos


From Antony.Stone at squid.open.source.it  Thu Aug 16 13:01:20 2018
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Thu, 16 Aug 2018 15:01:20 +0200
Subject: [squid-users] simple question Installed squid right now all
	internet access is blocked
In-Reply-To: <a755ac11-f712-3b8d-0e02-fe76da5346b6@treenet.co.nz>
References: <1534414444192-0.post@n4.nabble.com>
 <f0a3ac64-0a98-dd37-8bc0-91b601b1f05a@treenet.co.nz>
 <a755ac11-f712-3b8d-0e02-fe76da5346b6@treenet.co.nz>
Message-ID: <201808161501.20317.Antony.Stone@squid.open.source.it>

On Thursday 16 August 2018 at 14:47:39, Amos Jeffries wrote:

> On second thought; were you wanting to use authentication or something
> other than IPs to permit access to the proxy? such as what that installer
> script was trying to setup for you.

Based on "I am just learning nothing special no serious project" and "Just 
creating squid proxy for home use, my kids and I was also curious", I thought 
that was unlikely.

> That would be a different solution, but also on that FAQ page at 8.1
> "Using Proxy Authentication".

My guess is that Oldman has installed Squid on a Virtual Server he's obtained 
from some Internet-based hosting provider, and is then trying to access it 
from a browser on his home network.

If that's true (Oldman, I'm hoping you're still following this discussion, and 
have realised that people are genuinely trying to help you), then the Squid 
proxy will need a couple of lines such as:

	acl homenet src aa.bb.cc.dd
	http_access allow homenet

where aa.bb.cc.dd is the public IP of your home Internet connection.  If you 
don't know what this is, you can find out from https://whatsmyip.com/ (without 
using the proxy, of course).

I still advise extreme caution in running a Squid server on a public IP 
address, however.


Regards,


Antony.

-- 
This email was created using 100% recycled electrons.

                                                   Please reply to the list;
                                                         please *don't* CC me.


From squid3 at treenet.co.nz  Thu Aug 16 13:17:54 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 17 Aug 2018 01:17:54 +1200
Subject: [squid-users] Squid + Squidguard Youtube URL video filtering
In-Reply-To: <CAG2Qp6v4zATdvvVYivjHuuv2GhTdkxBYEmqoOA_FZu78kwrkWQ@mail.gmail.com>
References: <CAG2Qp6v4zATdvvVYivjHuuv2GhTdkxBYEmqoOA_FZu78kwrkWQ@mail.gmail.com>
Message-ID: <b8023bc9-78c9-eab7-36d3-f1cffcfc06b5@treenet.co.nz>

On 17/08/18 00:43, Roberto Carna wrote:
> Dear, I have Squid + Squidguard working OK.
> 
> Squidguard is filtering the entire www.youtube.com website.
> 
> But now I have to permit just one video from Youtube:
> 
> https://www.youtube.com/embed/ff9sDLGtnK8?rel=0&showinfo=0
> 
> I have added the below URL as an exception in Squidguard:
> 
> www.youtube.com/embed/ff9sDLGtnK8?rel=0&showinfo=0
> 
> but after that I can't see it, still blocked.
> 
> How can I enable just this URL from Squidguard preferently blocking
> the rest of Youtube ???

Unfortunately only with a great deal of difficulty.

The "?v=..." and "/embed/..." URLs are just public identifiers to access
the YouTube APIs. At the HTTP level they result in a quite long series
of sub-requests, redirections and the like bouncing all over the
youtube.* and googlevideos.* and googleapis.* domains.
 Yes all of them are involved multiple times. So whitelisting is an
all-or-nothing prospect, with other G services being implicitly
whitelisted as side effects.


Also, whenever the way to decipher the above maze of traffic gets
published so we can do things like what you ask. YT shortly afterwards
change how it operates - usually towards even more complexity. This has
happened too many times to be coincidence IMO.


Amos


From m_zouhairy at skno.by  Thu Aug 16 14:01:41 2018
From: m_zouhairy at skno.by (Vacheslav)
Date: Thu, 16 Aug 2018 17:01:41 +0300
Subject: [squid-users] Squid + Squidguard Youtube URL video filtering
In-Reply-To: <b8023bc9-78c9-eab7-36d3-f1cffcfc06b5@treenet.co.nz>
References: <CAG2Qp6v4zATdvvVYivjHuuv2GhTdkxBYEmqoOA_FZu78kwrkWQ@mail.gmail.com>
 <b8023bc9-78c9-eab7-36d3-f1cffcfc06b5@treenet.co.nz>
Message-ID: <2fc301d43569$a8c30ba0$fa4922e0$@skno.by>

Wouldn't it be better to try it in ufdbguard?

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Amos Jeffries
Sent: Thursday, August 16, 2018 4:18 PM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Squid + Squidguard Youtube URL video filtering

On 17/08/18 00:43, Roberto Carna wrote:
> Dear, I have Squid + Squidguard working OK.
> 
> Squidguard is filtering the entire www.youtube.com website.
> 
> But now I have to permit just one video from Youtube:
> 
> https://www.youtube.com/embed/ff9sDLGtnK8?rel=0&showinfo=0
> 
> I have added the below URL as an exception in Squidguard:
> 
> www.youtube.com/embed/ff9sDLGtnK8?rel=0&showinfo=0
> 
> but after that I can't see it, still blocked.
> 
> How can I enable just this URL from Squidguard preferently blocking 
> the rest of Youtube ???

>Unfortunately only with a great deal of difficulty.

>The "?v=..." and "/embed/..." URLs are just public identifiers to access the YouTube APIs. At the HTTP level they result in a quite long series of sub-requests, redirections and the like bouncing all over the
youtube.* and googlevideos.* and googleapis.* domains.
 Yes all of them are involved multiple times. So whitelisting is an all-or-nothing prospect, with other G services being implicitly whitelisted as side effects.


>Also, whenever the way to decipher the above maze of traffic gets published so we can do things like what you ask. YT shortly afterwards change how it operates - usually towards even more complexity. This has happened too many times to be coincidence IMO.


>Amos
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users




From rightkicktech at gmail.com  Thu Aug 16 15:16:42 2018
From: rightkicktech at gmail.com (Alex K)
Date: Thu, 16 Aug 2018 18:16:42 +0300
Subject: [squid-users] simple question Installed squid right now all
 internet access is blocked
In-Reply-To: <1534418944831-0.post@n4.nabble.com>
References: <1534414444192-0.post@n4.nabble.com>
 <201808161227.15264.Antony.Stone@squid.open.source.it>
 <1534415740272-0.post@n4.nabble.com>
 <201808161248.18762.Antony.Stone@squid.open.source.it>
 <1534417531388-0.post@n4.nabble.com>
 <201808161311.39975.Antony.Stone@squid.open.source.it>
 <1534418558710-0.post@n4.nabble.com>
 <201808161327.00386.Antony.Stone@squid.open.source.it>
 <1534418944831-0.post@n4.nabble.com>
Message-ID: <CABMULtL5jBce=7r3UwNgk7qs4bx7bK4+m=yBKWQQ1OFY+qnrPg@mail.gmail.com>

Why i have the feeling that this is a troll?




On Thu, Aug 16, 2018, 14:29 Oldman <admin at daraksun.com> wrote:

> You wanted to know my server ip  and did you expect me to publish this
> online?
>
> I chose to beleive you are wasting my time :)
>
> I am sorry I do not want to be rude but you are wasting my time.
>
Why you don't hire a tech then to set this up for you? You don't provide
the requested info regardless how patiently it has been asked and you
demand in the same time help... Providing internal ip details and not
public ones has zero security implications...

>
>
>
> --
> Sent from:
> http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180816/44317525/attachment.htm>

From Antony.Stone at squid.open.source.it  Thu Aug 16 17:34:33 2018
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Thu, 16 Aug 2018 19:34:33 +0200
Subject: [squid-users] simple question Installed squid right now all
	internet access is blocked
In-Reply-To: <CABMULtL5jBce=7r3UwNgk7qs4bx7bK4+m=yBKWQQ1OFY+qnrPg@mail.gmail.com>
References: <1534414444192-0.post@n4.nabble.com>
 <1534418944831-0.post@n4.nabble.com>
 <CABMULtL5jBce=7r3UwNgk7qs4bx7bK4+m=yBKWQQ1OFY+qnrPg@mail.gmail.com>
Message-ID: <201808161934.33709.Antony.Stone@squid.open.source.it>

On Thursday 16 August 2018 at 17:16:42, Alex K wrote:

> Why i have the feeling that this is a troll?

I know what you mean.  I had for the most part put Oldman's attitude down to 
ignorance of networking and related technical stuff, however given the stunning 
silence on his part since he accused us (or mostly me) of wanting to get 
access to his Squid server and claiming that I was wasting his time, I'm 
thinking that either:

a) you're right, and our collective reasonableness has made him realise that 
we're not easily trolled, so he's gone somewhere else, or

b) he's considered that there might actually be something useful in what 
several people here have been telling him, so he's gone away to read some more 
(hopefully useful) documentation about Squid and how to use it.

Either way it bemuses me that someone who introduces himself as "not very 
technical" chooses to have the email address admin at daraksun.com

If he's the admin, I wonder what the user experience is like...

> On Thu, Aug 16, 2018, 14:29 Oldman <admin at daraksun.com> wrote:
> > You wanted to know my server ip  and did you expect me to publish this
> > online?
> > 
> > I chose to beleive you are wasting my time :)
> > 
> > I am sorry I do not want to be rude but you are wasting my time.
> 
> Why you don't hire a tech then to set this up for you? You don't provide
> the requested info regardless how patiently it has been asked and you
> demand in the same time help... Providing internal ip details and not
> public ones has zero security implications...

Oh well,


Antony.

-- 
The Royal Society for the Prevention of Cruelty to Animals was formed in 1824.
The National Society for the Prevention of Cruelty to Children was not formed 
until 1884.
That says something about the British.

                                                   Please reply to the list;
                                                         please *don't* CC me.


From robertocarna36 at gmail.com  Thu Aug 16 19:51:08 2018
From: robertocarna36 at gmail.com (Roberto Carna)
Date: Thu, 16 Aug 2018 16:51:08 -0300
Subject: [squid-users] Squid + Squidguard Youtube URL video filtering
In-Reply-To: <b8023bc9-78c9-eab7-36d3-f1cffcfc06b5@treenet.co.nz>
References: <CAG2Qp6v4zATdvvVYivjHuuv2GhTdkxBYEmqoOA_FZu78kwrkWQ@mail.gmail.com>
 <b8023bc9-78c9-eab7-36d3-f1cffcfc06b5@treenet.co.nz>
Message-ID: <CAG2Qp6snUrKpxA0uBxa-4HK=RmZ7WvwTTgkJWV5gAWqww7nL+w@mail.gmail.com>

Dear Amos, I've tried to sniff the HTTP requests when I ask for:

https://www.youtube.com/embed/ff9sDLGtnK8?rel=0&showinfo=0

After that I've created a Squidguard exception list as below:

ytimg.com
googlevideo.com
googleapis.com
www.youtube.com/embed/ff9sDLGtnK8?rel=0&showinfo=0

But I can't see the video yet.

Please I need to know if using Squidguard it's just impossible to do
this exception, so in this case I forget it.

Thanks a lot again!!!


2018-08-16 10:17 GMT-03:00 Amos Jeffries <squid3 at treenet.co.nz>:
> On 17/08/18 00:43, Roberto Carna wrote:
>> Dear, I have Squid + Squidguard working OK.
>>
>> Squidguard is filtering the entire www.youtube.com website.
>>
>> But now I have to permit just one video from Youtube:
>>
>> https://www.youtube.com/embed/ff9sDLGtnK8?rel=0&showinfo=0
>>
>> I have added the below URL as an exception in Squidguard:
>>
>> www.youtube.com/embed/ff9sDLGtnK8?rel=0&showinfo=0
>>
>> but after that I can't see it, still blocked.
>>
>> How can I enable just this URL from Squidguard preferently blocking
>> the rest of Youtube ???
>
> Unfortunately only with a great deal of difficulty.
>
> The "?v=..." and "/embed/..." URLs are just public identifiers to access
> the YouTube APIs. At the HTTP level they result in a quite long series
> of sub-requests, redirections and the like bouncing all over the
> youtube.* and googlevideos.* and googleapis.* domains.
>  Yes all of them are involved multiple times. So whitelisting is an
> all-or-nothing prospect, with other G services being implicitly
> whitelisted as side effects.
>
>
> Also, whenever the way to decipher the above maze of traffic gets
> published so we can do things like what you ask. YT shortly afterwards
> change how it operates - usually towards even more complexity. This has
> happened too many times to be coincidence IMO.
>
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users


From rightkicktech at gmail.com  Thu Aug 16 22:05:10 2018
From: rightkicktech at gmail.com (Alex K)
Date: Fri, 17 Aug 2018 01:05:10 +0300
Subject: [squid-users] Squid + Squidguard Youtube URL video filtering
In-Reply-To: <CAG2Qp6snUrKpxA0uBxa-4HK=RmZ7WvwTTgkJWV5gAWqww7nL+w@mail.gmail.com>
References: <CAG2Qp6v4zATdvvVYivjHuuv2GhTdkxBYEmqoOA_FZu78kwrkWQ@mail.gmail.com>
 <b8023bc9-78c9-eab7-36d3-f1cffcfc06b5@treenet.co.nz>
 <CAG2Qp6snUrKpxA0uBxa-4HK=RmZ7WvwTTgkJWV5gAWqww7nL+w@mail.gmail.com>
Message-ID: <CABMULtJbAcjnZM-0NF2A-ZMJhJSDuo3mKUFPq=REmWFQWL6dmQ@mail.gmail.com>

On Thu, Aug 16, 2018, 22:51 Roberto Carna <robertocarna36 at gmail.com> wrote:

> Dear Amos, I've tried to sniff the HTTP requests when I ask for:
>
> https://www.youtube.com/embed/ff9sDLGtnK8?rel=0&showinfo=0
>
> After that I've created a Squidguard exception list as below:
>
> ytimg.com
> googlevideo.com
> googleapis.com
> www.youtube.com/embed/ff9sDLGtnK8?rel=0&showinfo=0

You may need to escape special characters (? is one). I would try:
www.youtube.com/embed/ff9sDLGtnK8
<http://www.youtube.com/embed/ff9sDLGtnK8?rel=0&showinfo=0>*

I assume you are putting above at the urls definition and rebuilding the
file?

What is access.log reporting?


>
> But I can't see the video yet.
>
> Please I need to know if using Squidguard it's just impossible to do
> this exception, so in this case I forget it.
>
> Thanks a lot again!!!
>
>
> 2018-08-16 10:17 GMT-03:00 Amos Jeffries <squid3 at treenet.co.nz>:
> > On 17/08/18 00:43, Roberto Carna wrote:
> >> Dear, I have Squid + Squidguard working OK.
> >>
> >> Squidguard is filtering the entire www.youtube.com website.
> >>
> >> But now I have to permit just one video from Youtube:
> >>
> >> https://www.youtube.com/embed/ff9sDLGtnK8?rel=0&showinfo=0
> >>
> >> I have added the below URL as an exception in Squidguard:
> >>
> >> www.youtube.com/embed/ff9sDLGtnK8?rel=0&showinfo=0
> >>
> >> but after that I can't see it, still blocked.
> >>
> >> How can I enable just this URL from Squidguard preferently blocking
> >> the rest of Youtube ???
> >
> > Unfortunately only with a great deal of difficulty.
> >
> > The "?v=..." and "/embed/..." URLs are just public identifiers to access
> > the YouTube APIs. At the HTTP level they result in a quite long series
> > of sub-requests, redirections and the like bouncing all over the
> > youtube.* and googlevideos.* and googleapis.* domains.
> >  Yes all of them are involved multiple times. So whitelisting is an
> > all-or-nothing prospect, with other G services being implicitly
> > whitelisted as side effects.
> >
> >
> > Also, whenever the way to decipher the above maze of traffic gets
> > published so we can do things like what you ask. YT shortly afterwards
> > change how it operates - usually towards even more complexity. This has
> > happened too many times to be coincidence IMO.
> >
> >
> > Amos
> > _______________________________________________
> > squid-users mailing list
> > squid-users at lists.squid-cache.org
> > http://lists.squid-cache.org/listinfo/squid-users
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180817/83ed0829/attachment.htm>

From marcus.kool at urlfilterdb.com  Fri Aug 17 00:53:36 2018
From: marcus.kool at urlfilterdb.com (Marcus Kool)
Date: Thu, 16 Aug 2018 21:53:36 -0300
Subject: [squid-users] Squid + Squidguard Youtube URL video filtering
In-Reply-To: <2fc301d43569$a8c30ba0$fa4922e0$@skno.by>
References: <CAG2Qp6v4zATdvvVYivjHuuv2GhTdkxBYEmqoOA_FZu78kwrkWQ@mail.gmail.com>
 <b8023bc9-78c9-eab7-36d3-f1cffcfc06b5@treenet.co.nz>
 <2fc301d43569$a8c30ba0$fa4922e0$@skno.by>
Message-ID: <ddbce007-e3e4-d2de-ca61-4e043e1de09d@urlfilterdb.com>

yes, with ufdbguard you put
    youtube.com/watch?v=VIDEOID
in a urls file and create a URL table with ufdbGenTable.
ufdbGenTable adds many URLs automagically, i.e.
    youtube.com/embed/VIDEOID
    youtube.com/get_video_info?video_id=VIDEOID
    ytimg.googleusercontent.com/vi/VIDEOID
and many more.

Marcus

On 16/08/18 11:01, Vacheslav wrote:
> Wouldn't it be better to try it in ufdbguard?
> 
> -----Original Message-----
> From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Amos Jeffries
> Sent: Thursday, August 16, 2018 4:18 PM
> To: squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] Squid + Squidguard Youtube URL video filtering
> 
> On 17/08/18 00:43, Roberto Carna wrote:
>> Dear, I have Squid + Squidguard working OK.
>>
>> Squidguard is filtering the entire www.youtube.com website.
>>
>> But now I have to permit just one video from Youtube:
>>
>> https://www.youtube.com/embed/ff9sDLGtnK8?rel=0&showinfo=0
>>
>> I have added the below URL as an exception in Squidguard:
>>
>> www.youtube.com/embed/ff9sDLGtnK8?rel=0&showinfo=0
>>
>> but after that I can't see it, still blocked.
>>
>> How can I enable just this URL from Squidguard preferently blocking
>> the rest of Youtube ???
> 
>> Unfortunately only with a great deal of difficulty.
> 
>> The "?v=..." and "/embed/..." URLs are just public identifiers to access the YouTube APIs. At the HTTP level they result in a quite long series of sub-requests, redirections and the like bouncing all over the
> youtube.* and googlevideos.* and googleapis.* domains.
>   Yes all of them are involved multiple times. So whitelisting is an all-or-nothing prospect, with other G services being implicitly whitelisted as side effects.
> 
> 
>> Also, whenever the way to decipher the above maze of traffic gets published so we can do things like what you ask. YT shortly afterwards change how it operates - usually towards even more complexity. This has happened too many times to be coincidence IMO.
> 
> 
>> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 


From rafael.akchurin at diladele.com  Fri Aug 17 05:55:14 2018
From: rafael.akchurin at diladele.com (Rafael Akchurin)
Date: Fri, 17 Aug 2018 05:55:14 +0000
Subject: [squid-users] Squid + Squidguard Youtube URL video filtering
In-Reply-To: <CAG2Qp6snUrKpxA0uBxa-4HK=RmZ7WvwTTgkJWV5gAWqww7nL+w@mail.gmail.com>
References: <CAG2Qp6v4zATdvvVYivjHuuv2GhTdkxBYEmqoOA_FZu78kwrkWQ@mail.gmail.com>
 <b8023bc9-78c9-eab7-36d3-f1cffcfc06b5@treenet.co.nz>
 <CAG2Qp6snUrKpxA0uBxa-4HK=RmZ7WvwTTgkJWV5gAWqww7nL+w@mail.gmail.com>
Message-ID: <AM0PR04MB4753882C9E9A5CB1137EB2E08F3D0@AM0PR04MB4753.eurprd04.prod.outlook.com>

Hello Roberto,

Another way is to have a dedicated YouTube API rewriter or say ICAP filter (as we do in Web Safety version 6.4) and try to allow/block video by parsing out the video ID from request URL and looking up its related meta information on the fly in YouTube database.

See our rewriter in Web Safety ICAP filter for Squid available as part of virtual appliance at https://www.diladele.com/virtual_appliance.html.  The code in Python in /opt/websafety/bin/youtube_guard.py and if very easy to understand.

Please note our guard assumes the video partials from googlevideo.com are allowed. If you need to further prevent access to these partials and allow only your video no matter what - then keeping a close eye on the https://github.com/rg3/youtube-dl project is a must.

Please note in Web Safety 6.4 (ICAP for Squid) we have rewritten that functionality in golang to allow specifying different allow/deny videos/categories/channels per different group of proxy users. So be sure to get version 6.3.

Best regards,
Rafael Akchurin
Diladele B.V.
https://www.diladele.com

 

-----Original Message-----
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Roberto Carna
Sent: Thursday, August 16, 2018 9:51 PM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Squid + Squidguard Youtube URL video filtering

Dear Amos, I've tried to sniff the HTTP requests when I ask for:

https://www.youtube.com/embed/ff9sDLGtnK8?rel=0&showinfo=0

After that I've created a Squidguard exception list as below:

ytimg.com
googlevideo.com
googleapis.com
www.youtube.com/embed/ff9sDLGtnK8?rel=0&showinfo=0

But I can't see the video yet.

Please I need to know if using Squidguard it's just impossible to do this exception, so in this case I forget it.

Thanks a lot again!!!


2018-08-16 10:17 GMT-03:00 Amos Jeffries <squid3 at treenet.co.nz>:
> On 17/08/18 00:43, Roberto Carna wrote:
>> Dear, I have Squid + Squidguard working OK.
>>
>> Squidguard is filtering the entire www.youtube.com website.
>>
>> But now I have to permit just one video from Youtube:
>>
>> https://www.youtube.com/embed/ff9sDLGtnK8?rel=0&showinfo=0
>>
>> I have added the below URL as an exception in Squidguard:
>>
>> www.youtube.com/embed/ff9sDLGtnK8?rel=0&showinfo=0
>>
>> but after that I can't see it, still blocked.
>>
>> How can I enable just this URL from Squidguard preferently blocking 
>> the rest of Youtube ???
>
> Unfortunately only with a great deal of difficulty.
>
> The "?v=..." and "/embed/..." URLs are just public identifiers to 
> access the YouTube APIs. At the HTTP level they result in a quite long 
> series of sub-requests, redirections and the like bouncing all over 
> the
> youtube.* and googlevideos.* and googleapis.* domains.
>  Yes all of them are involved multiple times. So whitelisting is an 
> all-or-nothing prospect, with other G services being implicitly 
> whitelisted as side effects.
>
>
> Also, whenever the way to decipher the above maze of traffic gets 
> published so we can do things like what you ask. YT shortly afterwards 
> change how it operates - usually towards even more complexity. This 
> has happened too many times to be coincidence IMO.
>
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users

From piuschungath at gmail.com  Fri Aug 17 08:39:05 2018
From: piuschungath at gmail.com (pius)
Date: Fri, 17 Aug 2018 03:39:05 -0500 (CDT)
Subject: [squid-users] Have issue with "https_port ssl-bump intercept"
In-Reply-To: <2216dbb6-daad-650c-eefe-4c2f1e2f697c@treenet.co.nz>
References: <1533924325185-0.post@n4.nabble.com>
 <35064290-e6e6-569a-6c27-5f25624e9735@measurement-factory.com>
 <1533927868704-0.post@n4.nabble.com>
 <a5b0cd00-a61d-f31d-8fe2-61b3397f23c3@measurement-factory.com>
 <1534149123813-0.post@n4.nabble.com> <1534168104650-0.post@n4.nabble.com>
 <1534179998578-0.post@n4.nabble.com> <1534410959319-0.post@n4.nabble.com>
 <2216dbb6-daad-650c-eefe-4c2f1e2f697c@treenet.co.nz>
Message-ID: <1534495145960-0.post@n4.nabble.com>

Hi Amos,


Thanks for the reply. It makes more things clear. 

I do apologize for a Friday message in advance.

I will explain a bit more about my situation. We are using Jfrog artifactory
in our private network. Artifactory host lots of remote repos. We are
planning lock down the artifactory using squid. So in my case artifactory is
the client. 

artifactory ------> Squid(whitelist) -----> Internet
                            http (3129) / https (3130)

I followed the steps from your message. I trust the self-signed squid
certificate in artifactory. Now I error I am getting is in artifactory is 

"Connection to remote repository failed: Host name 'repo.jenkins-ci.org'
does not match the certificate subject provided by the peer
(CN=130.211.20.35)"

Looks like artifactory is requesting repo.jenkins-ci.org to squid without
enough information about domain name. May be that why squid created a ssl
certificate in behalf of artifactory with a IP address and instead of domain
name. So how can map the ip to a domain name ? DNS server ? 




--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From squid3 at treenet.co.nz  Fri Aug 17 08:59:40 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 17 Aug 2018 20:59:40 +1200
Subject: [squid-users] Have issue with "https_port ssl-bump intercept"
In-Reply-To: <1534495145960-0.post@n4.nabble.com>
References: <1533924325185-0.post@n4.nabble.com>
 <35064290-e6e6-569a-6c27-5f25624e9735@measurement-factory.com>
 <1533927868704-0.post@n4.nabble.com>
 <a5b0cd00-a61d-f31d-8fe2-61b3397f23c3@measurement-factory.com>
 <1534149123813-0.post@n4.nabble.com> <1534168104650-0.post@n4.nabble.com>
 <1534179998578-0.post@n4.nabble.com> <1534410959319-0.post@n4.nabble.com>
 <2216dbb6-daad-650c-eefe-4c2f1e2f697c@treenet.co.nz>
 <1534495145960-0.post@n4.nabble.com>
Message-ID: <13e52d4d-6e26-63a0-045a-15d022f6cb89@treenet.co.nz>

On 17/08/18 20:39, pius wrote:
> Hi Amos,
> 
> 
> Thanks for the reply. It makes more things clear. 
> 
> I do apologize for a Friday message in advance.
> 
> I will explain a bit more about my situation. We are using Jfrog artifactory
> in our private network. Artifactory host lots of remote repos. We are
> planning lock down the artifactory using squid. So in my case artifactory is
> the client. 
> 
> artifactory ------> Squid(whitelist) -----> Internet
>                             http (3129) / https (3130)
> 
> I followed the steps from your message. I trust the self-signed squid
> certificate in artifactory. Now I error I am getting is in artifactory is 
> 
> "Connection to remote repository failed: Host name 'repo.jenkins-ci.org'
> does not match the certificate subject provided by the peer
> (CN=130.211.20.35)"
> 
> Looks like artifactory is requesting repo.jenkins-ci.org to squid without
> enough information about domain name. May be that why squid created a ssl
> certificate in behalf of artifactory with a IP address and instead of domain
> name. So how can map the ip to a domain name ? DNS server ? 
> 

With the config I provided Squid should only send the custom cert to the
client if there is a problem connecting to the upstream server of your
http_access rules perform a "deny" action.

 Are you able to identify which of those is going on?
 your Squid access.log and/or cache.log should have some hints.

Amos


From m_zouhairy at skno.by  Fri Aug 17 12:27:35 2018
From: m_zouhairy at skno.by (Vacheslav)
Date: Fri, 17 Aug 2018 15:27:35 +0300
Subject: [squid-users] simple question Installed squid right now all
	internet access is blocked
In-Reply-To: <CABMULtL5jBce=7r3UwNgk7qs4bx7bK4+m=yBKWQQ1OFY+qnrPg@mail.gmail.com>
References: <1534414444192-0.post@n4.nabble.com>
 <201808161227.15264.Antony.Stone@squid.open.source.it>
 <1534415740272-0.post@n4.nabble.com>
 <201808161248.18762.Antony.Stone@squid.open.source.it>
 <1534417531388-0.post@n4.nabble.com>
 <201808161311.39975.Antony.Stone@squid.open.source.it>
 <1534418558710-0.post@n4.nabble.com>
 <201808161327.00386.Antony.Stone@squid.open.source.it>
 <1534418944831-0.post@n4.nabble.com>
 <CABMULtL5jBce=7r3UwNgk7qs4bx7bK4+m=yBKWQQ1OFY+qnrPg@mail.gmail.com>
Message-ID: <14d6301d43625$ad8b62b0$08a22810$@skno.by>

What you could say, why do I feel like he is trolling, although I would still think this is slander, but of course condemning is much worse than slander!

 

From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Alex K
Sent: Thursday, August 16, 2018 6:17 PM
To: Oldman <admin at daraksun.com>
Cc: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] simple question Installed squid right now all internet access is blocked

 

Why i have the feeling that this is a troll?

 

 

 

On Thu, Aug 16, 2018, 14:29 Oldman <admin at daraksun.com <mailto:admin at daraksun.com> > wrote:

You wanted to know my server ip  and did you expect me to publish this
online?

I chose to beleive you are wasting my time :)

I am sorry I do not want to be rude but you are wasting my time.

Why you don't hire a tech then to set this up for you? You don't provide the requested info regardless how patiently it has been asked and you demand in the same time help... Providing internal ip details and not public ones has zero security implications...




--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> 
http://lists.squid-cache.org/listinfo/squid-users

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180817/ec09c5b8/attachment.htm>

From marcus.kool at urlfilterdb.com  Fri Aug 17 12:51:17 2018
From: marcus.kool at urlfilterdb.com (Marcus Kool)
Date: Fri, 17 Aug 2018 09:51:17 -0300
Subject: [squid-users] Squid + Squidguard Youtube URL video filtering
In-Reply-To: <20180817011136.24867842B9@ms1.urlfilterdb.com>
References: <20180817011136.24867842B9@ms1.urlfilterdb.com>
Message-ID: <6efd458c-1378-998a-e492-7f29dca660c7@urlfilterdb.com>

OP asked about blocking Youtube but allowing a single Youtube video.
How would you do that with a couple of DNS entries ?

Marcus

On 16/08/18 22:11, SQUIDBLACKLIST.ORG wrote:
> This might be painfully obvious to some who are in the know, but, filtering youtube video content can be done with a lot less effort by simply adding a couple dns entries for Googles safesearch servers.
> 
> #justsayin
> 
> 
> 
> Signed,
> 
> Benjamin E. Nichols
> Founder & ?Chief Architect
> http://www.squidblacklist.org
> 1-405-301-9516
> 
> -------- Original message --------
> From: Marcus Kool <marcus.kool at urlfilterdb.com>
> Date: 8/16/18 7:53 PM (GMT-06:00)
> To: squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] Squid + Squidguard Youtube URL video filtering
> 
> yes, with ufdbguard you put
>  ??? youtube.com/watch?v=VIDEOID
> in a urls file and create a URL table with ufdbGenTable.
> ufdbGenTable adds many URLs automagically, i.e.
>  ??? youtube.com/embed/VIDEOID
>  ??? youtube.com/get_video_info?video_id=VIDEOID
>  ??? ytimg.googleusercontent.com/vi/VIDEOID
> and many more.
> 
> Marcus
> 
> On 16/08/18 11:01, Vacheslav wrote:
>  > Wouldn't it be better to try it in ufdbguard?
>  >
>  > -----Original Message-----
>  > From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Amos Jeffries
>  > Sent: Thursday, August 16, 2018 4:18 PM
>  > To: squid-users at lists.squid-cache.org
>  > Subject: Re: [squid-users] Squid + Squidguard Youtube URL video filtering
>  >
>  > On 17/08/18 00:43, Roberto Carna wrote:
>  >> Dear, I have Squid + Squidguard working OK.
>  >>
>  >> Squidguard is filtering the entire www.youtube.com website.
>  >>
>  >> But now I have to permit just one video from Youtube:
>  >>
>  >> https://www.youtube.com/embed/ff9sDLGtnK8?rel=0&showinfo=0
>  >>
>  >> I have added the below URL as an exception in Squidguard:
>  >>
>  >> www.youtube.com/embed/ff9sDLGtnK8?rel=0&showinfo=0
>  >>
>  >> but after that I can't see it, still blocked.
>  >>
>  >> How can I enable just this URL from Squidguard preferently blocking
>  >> the rest of Youtube ???
>  >
>  >> Unfortunately only with a great deal of difficulty.
>  >
>  >> The "?v=..." and "/embed/..." URLs are just public identifiers to access the YouTube APIs. At the HTTP level they result in a quite long series of sub-requests, redirections and the like bouncing 
> all over the
>  > youtube.* and googlevideos.* and googleapis.* domains.
>  >?? Yes all of them are involved multiple times. So whitelisting is an all-or-nothing prospect, with other G services being implicitly whitelisted as side effects.
>  >
>  >
>  >> Also, whenever the way to decipher the above maze of traffic gets published so we can do things like what you ask. YT shortly afterwards change how it operates - usually towards even more 
> complexity. This has happened too many times to be coincidence IMO.
>  >
>  >
>  >> Amos
>  > _______________________________________________
>  > squid-users mailing list
>  > squid-users at lists.squid-cache.org
>  > http://lists.squid-cache.org/listinfo/squid-users
>  >
>  >
>  > _______________________________________________
>  > squid-users mailing list
>  > squid-users at lists.squid-cache.org
>  > http://lists.squid-cache.org/listinfo/squid-users
>  >
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users


From robertocarna36 at gmail.com  Fri Aug 17 14:27:09 2018
From: robertocarna36 at gmail.com (Roberto Carna)
Date: Fri, 17 Aug 2018 11:27:09 -0300
Subject: [squid-users] Squid + Squidguard Youtube URL video filtering
In-Reply-To: <6efd458c-1378-998a-e492-7f29dca660c7@urlfilterdb.com>
References: <20180817011136.24867842B9@ms1.urlfilterdb.com>
 <6efd458c-1378-998a-e492-7f29dca660c7@urlfilterdb.com>
Message-ID: <CAG2Qp6sF3gH+RqW0Xf4TnJsZ+_zpFHHO3prS+BBbW3Xnb+PXPg@mail.gmail.com>

Dear Marcus, please can you tell me the way to do what you suggest?

Suppose I want to block youtube.com but enable only one URL video
"https://www.youtube.com/embed/ff9sDLGtnK8?rel=0&showinfo=0".

How should I set te DNS entries please?

Regards,

2018-08-17 9:51 GMT-03:00 Marcus Kool <marcus.kool at urlfilterdb.com>:
> OP asked about blocking Youtube but allowing a single Youtube video.
> How would you do that with a couple of DNS entries ?
>
> Marcus
>
> On 16/08/18 22:11, SQUIDBLACKLIST.ORG wrote:
>>
>> This might be painfully obvious to some who are in the know, but,
>> filtering youtube video content can be done with a lot less effort by simply
>> adding a couple dns entries for Googles safesearch servers.
>>
>> #justsayin
>>
>>
>>
>> Signed,
>>
>> Benjamin E. Nichols
>> Founder &  Chief Architect
>> http://www.squidblacklist.org
>> 1-405-301-9516
>>
>> -------- Original message --------
>> From: Marcus Kool <marcus.kool at urlfilterdb.com>
>> Date: 8/16/18 7:53 PM (GMT-06:00)
>> To: squid-users at lists.squid-cache.org
>> Subject: Re: [squid-users] Squid + Squidguard Youtube URL video filtering
>>
>> yes, with ufdbguard you put
>>      youtube.com/watch?v=VIDEOID
>> in a urls file and create a URL table with ufdbGenTable.
>> ufdbGenTable adds many URLs automagically, i.e.
>>      youtube.com/embed/VIDEOID
>>      youtube.com/get_video_info?video_id=VIDEOID
>>      ytimg.googleusercontent.com/vi/VIDEOID
>> and many more.
>>
>> Marcus
>>
>> On 16/08/18 11:01, Vacheslav wrote:
>>  > Wouldn't it be better to try it in ufdbguard?
>>  >
>>  > -----Original Message-----
>>  > From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf
>> Of Amos Jeffries
>>  > Sent: Thursday, August 16, 2018 4:18 PM
>>  > To: squid-users at lists.squid-cache.org
>>  > Subject: Re: [squid-users] Squid + Squidguard Youtube URL video
>> filtering
>>  >
>>  > On 17/08/18 00:43, Roberto Carna wrote:
>>  >> Dear, I have Squid + Squidguard working OK.
>>  >>
>>  >> Squidguard is filtering the entire www.youtube.com website.
>>  >>
>>  >> But now I have to permit just one video from Youtube:
>>  >>
>>  >> https://www.youtube.com/embed/ff9sDLGtnK8?rel=0&showinfo=0
>>  >>
>>  >> I have added the below URL as an exception in Squidguard:
>>  >>
>>  >> www.youtube.com/embed/ff9sDLGtnK8?rel=0&showinfo=0
>>  >>
>>  >> but after that I can't see it, still blocked.
>>  >>
>>  >> How can I enable just this URL from Squidguard preferently blocking
>>  >> the rest of Youtube ???
>>  >
>>  >> Unfortunately only with a great deal of difficulty.
>>  >
>>  >> The "?v=..." and "/embed/..." URLs are just public identifiers to
>> access the YouTube APIs. At the HTTP level they result in a quite long
>> series of sub-requests, redirections and the like bouncing all over the
>>  > youtube.* and googlevideos.* and googleapis.* domains.
>>  >   Yes all of them are involved multiple times. So whitelisting is an
>> all-or-nothing prospect, with other G services being implicitly whitelisted
>> as side effects.
>>  >
>>  >
>>  >> Also, whenever the way to decipher the above maze of traffic gets
>> published so we can do things like what you ask. YT shortly afterwards
>> change how it operates - usually towards even more complexity. This has
>> happened too many times to be coincidence IMO.
>>  >
>>  >
>>  >> Amos
>>  > _______________________________________________
>>  > squid-users mailing list
>>  > squid-users at lists.squid-cache.org
>>  > http://lists.squid-cache.org/listinfo/squid-users
>>  >
>>  >
>>  > _______________________________________________
>>  > squid-users mailing list
>>  > squid-users at lists.squid-cache.org
>>  > http://lists.squid-cache.org/listinfo/squid-users
>>  >
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users


From marcus.kool at urlfilterdb.com  Fri Aug 17 16:22:44 2018
From: marcus.kool at urlfilterdb.com (Marcus Kool)
Date: Fri, 17 Aug 2018 13:22:44 -0300
Subject: [squid-users] Squid + Squidguard Youtube URL video filtering
In-Reply-To: <CAG2Qp6sF3gH+RqW0Xf4TnJsZ+_zpFHHO3prS+BBbW3Xnb+PXPg@mail.gmail.com>
References: <20180817011136.24867842B9@ms1.urlfilterdb.com>
 <6efd458c-1378-998a-e492-7f29dca660c7@urlfilterdb.com>
 <CAG2Qp6sF3gH+RqW0Xf4TnJsZ+_zpFHHO3prS+BBbW3Xnb+PXPg@mail.gmail.com>
Message-ID: <33610608-0e5a-dadd-17fb-4afc8e43bbfe@urlfilterdb.com>

I cannot tell you how to do it with DNS entries since I think it is impossible and therefore I asked Benjamin to explain.

Allowing one single video and blocking all other videos on Youtube is not easy.
One cannot block by domain but must filter by full URL.
When HTTPS is used, full URLs can only be obtained/filtered using ssl_bump in peek+bump mode which is doable but not easy.
Once you have peek+bump working you can make two categories in ufdbGuard:
    category youtube with
       youtube.com/watch
    category allowedyoutubevideos with
       youtube.com/watch?v=ff9sDLGtnK8
and an acl like
    acl {
       allSystems {
          pass allowedyoutubevideos !youtube ...
       }
    ...

The above allows access to www.youtube.com but not to the blocked videos.
This is necessary since the youtube site also uses a set of URLs like
     https://www.youtube.com/sw.js
     https://www.youtube.com/service_ajax?name=signalServiceEndpoint
     etc.
which all must be allowed to be able to display/allow your single video.

Marcus


On 17/08/18 11:27, Roberto Carna wrote:
> Dear Marcus, please can you tell me the way to do what you suggest?
> 
> Suppose I want to block youtube.com but enable only one URL video
> "https://www.youtube.com/embed/ff9sDLGtnK8?rel=0&showinfo=0".
> 
> How should I set te DNS entries please?
> 
> Regards,
> 
> 2018-08-17 9:51 GMT-03:00 Marcus Kool <marcus.kool at urlfilterdb.com>:
>> OP asked about blocking Youtube but allowing a single Youtube video.
>> How would you do that with a couple of DNS entries ?
>>
>> Marcus
>>
>> On 16/08/18 22:11, SQUIDBLACKLIST.ORG wrote:
>>>
>>> This might be painfully obvious to some who are in the know, but,
>>> filtering youtube video content can be done with a lot less effort by simply
>>> adding a couple dns entries for Googles safesearch servers.
>>>
>>> #justsayin
>>>
>>>
>>>
>>> Signed,
>>>
>>> Benjamin E. Nichols
>>> Founder &  Chief Architect
>>> http://www.squidblacklist.org
>>> 1-405-301-9516
>>>
>>> -------- Original message --------
>>> From: Marcus Kool <marcus.kool at urlfilterdb.com>
>>> Date: 8/16/18 7:53 PM (GMT-06:00)
>>> To: squid-users at lists.squid-cache.org
>>> Subject: Re: [squid-users] Squid + Squidguard Youtube URL video filtering
>>>
>>> yes, with ufdbguard you put
>>>       youtube.com/watch?v=VIDEOID
>>> in a urls file and create a URL table with ufdbGenTable.
>>> ufdbGenTable adds many URLs automagically, i.e.
>>>       youtube.com/embed/VIDEOID
>>>       youtube.com/get_video_info?video_id=VIDEOID
>>>       ytimg.googleusercontent.com/vi/VIDEOID
>>> and many more.
>>>
>>> Marcus
>>>
>>> On 16/08/18 11:01, Vacheslav wrote:
>>>   > Wouldn't it be better to try it in ufdbguard?
>>>   >
>>>   > -----Original Message-----
>>>   > From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf
>>> Of Amos Jeffries
>>>   > Sent: Thursday, August 16, 2018 4:18 PM
>>>   > To: squid-users at lists.squid-cache.org
>>>   > Subject: Re: [squid-users] Squid + Squidguard Youtube URL video
>>> filtering
>>>   >
>>>   > On 17/08/18 00:43, Roberto Carna wrote:
>>>   >> Dear, I have Squid + Squidguard working OK.
>>>   >>
>>>   >> Squidguard is filtering the entire www.youtube.com website.
>>>   >>
>>>   >> But now I have to permit just one video from Youtube:
>>>   >>
>>>   >> https://www.youtube.com/embed/ff9sDLGtnK8?rel=0&showinfo=0
>>>   >>
>>>   >> I have added the below URL as an exception in Squidguard:
>>>   >>
>>>   >> www.youtube.com/embed/ff9sDLGtnK8?rel=0&showinfo=0
>>>   >>
>>>   >> but after that I can't see it, still blocked.
>>>   >>
>>>   >> How can I enable just this URL from Squidguard preferently blocking
>>>   >> the rest of Youtube ???
>>>   >
>>>   >> Unfortunately only with a great deal of difficulty.
>>>   >
>>>   >> The "?v=..." and "/embed/..." URLs are just public identifiers to
>>> access the YouTube APIs. At the HTTP level they result in a quite long
>>> series of sub-requests, redirections and the like bouncing all over the
>>>   > youtube.* and googlevideos.* and googleapis.* domains.
>>>   >   Yes all of them are involved multiple times. So whitelisting is an
>>> all-or-nothing prospect, with other G services being implicitly whitelisted
>>> as side effects.
>>>   >
>>>   >
>>>   >> Also, whenever the way to decipher the above maze of traffic gets
>>> published so we can do things like what you ask. YT shortly afterwards
>>> change how it operates - usually towards even more complexity. This has
>>> happened too many times to be coincidence IMO.
>>>   >
>>>   >
>>>   >> Amos
>>>   > _______________________________________________
>>>   > squid-users mailing list
>>>   > squid-users at lists.squid-cache.org
>>>   > http://lists.squid-cache.org/listinfo/squid-users
>>>   >
>>>   >
>>>   > _______________________________________________
>>>   > squid-users mailing list
>>>   > squid-users at lists.squid-cache.org
>>>   > http://lists.squid-cache.org/listinfo/squid-users
>>>   >
>>> _______________________________________________
>>> squid-users mailing list
>>> squid-users at lists.squid-cache.org
>>> http://lists.squid-cache.org/listinfo/squid-users
>>
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
> 
> 


From christof.gerber1 at gmail.com  Mon Aug 20 09:10:17 2018
From: christof.gerber1 at gmail.com (Christof Gerber)
Date: Mon, 20 Aug 2018 11:10:17 +0200
Subject: [squid-users] Fetch missing certificate feature of Squid_v4
Message-ID: <CAFyThpL=k2WfNuc9X3k3ZBGtkC_u1XNDtfnhzdVZRBG0+BhXPg@mail.gmail.com>

I am wondering how to verify the feature "Fetch missing certificate"
which was added to Squid v4.
https://github.com/squid-cache/squid/commit/55369ae649646901d3038c63217386174d01eb7b

I tried to trigger the feature by requesting some domains via squid
which lack the intermediate certificate (e.g. www.facworld.com,
taas.citrix.com, karantina.genelsigorta.com).

Because of the following observation I believe something is not
working correctly:
1. Curl retruns with a "SSL certificate problem: Invalid certificate
chain" in all three cases
2. By enabling 33,5 83,5 81,5 88,3 logging and analysing the log trace
I get the feeling that the code of the feature is not called (->
missing certificate not downloaded). See the log trace in the
attachment

I verified that these domains deliver an incomplete certificate by:
$ openssl s_client -connect taas.citrix.com:443 -showcerts -verify 32
-CApath  $path/to/root/certs/
Which returns "Verify return code: 21 (unable to verify the first
certificate)" for all of them

Question:
1. How to verify that the feature is working? Am I doing something wrong?
2. Is this feature always on or do I have to configure/enable it in Squid v4?

Squid Cache: Version v4.0-6d8f397398995c4512cb045920ee2747cc6b14f8

-- 
Christof Gerber
Email: christof.gerber1 at gmail.com
-------------- next part --------------
A non-text attachment was scrubbed...
Name: logs_squid4-facworld
Type: application/octet-stream
Size: 25615 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180820/dfcce10b/attachment.obj>

From squid3 at treenet.co.nz  Mon Aug 20 12:18:28 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 21 Aug 2018 00:18:28 +1200
Subject: [squid-users] Fetch missing certificate feature of Squid_v4
In-Reply-To: <CAFyThpL=k2WfNuc9X3k3ZBGtkC_u1XNDtfnhzdVZRBG0+BhXPg@mail.gmail.com>
References: <CAFyThpL=k2WfNuc9X3k3ZBGtkC_u1XNDtfnhzdVZRBG0+BhXPg@mail.gmail.com>
Message-ID: <80770d73-d75a-32d9-eace-a0ce055c9916@treenet.co.nz>

On 20/08/18 9:10 PM, Christof Gerber wrote:
> I am wondering how to verify the feature "Fetch missing certificate"
> which was added to Squid v4.
> https://github.com/squid-cache/squid/commit/55369ae649646901d3038c63217386174d01eb7b
> 
> I tried to trigger the feature by requesting some domains via squid
> which lack the intermediate certificate (e.g. www.facworld.com,
> taas.citrix.com, karantina.genelsigorta.com).
> 
> Because of the following observation I believe something is not
> working correctly:
> 1. Curl retruns with a "SSL certificate problem: Invalid certificate
> chain" in all three cases

This is the chain received by curl. Not the chain received by Squid.

To get this from curl either Squid is not even involved in any TLS with
the broken cert chain (splice, regular tunneling, not using the proxy).
Or, the CA cert chain you configured Squid to use is itself incomplete.


> 2. By enabling 33,5 83,5 81,5 88,3 logging and analysing the log trace
> I get the feeling that the code of the feature is not called (->
> missing certificate not downloaded). See the log trace in the
> attachment

Log trace says Squid identified http://aia.entrust.net/l1k-chain256.cer
as the missing CA and downloaded it. AFAICT the verification then passed
and bump proceeded to happen.

> 
> I verified that these domains deliver an incomplete certificate by:
> $ openssl s_client -connect taas.citrix.com:443 -showcerts -verify 32
> -CApath  $path/to/root/certs/
> Which returns "Verify return code: 21 (unable to verify the first
> certificate)" for all of them
> 
> Question:
> 1. How to verify that the feature is working?

AFAIK, just what you did. The problem seems to be not understanding the
log resulting.

...
2018/08/20 10:37:26.975 kid1| 83,5| PeerConnector.cc(712)
checkForMissingCertificates: SSL server sent 1 certificates
...
2018/08/20 10:37:26.976 kid1| 33,3| Downloader.cc(226) handleReply:
Object data transfer successfully complete
...
2018/08/20 10:37:27.089 kid1| 83,5| PeekingPeerConnector.cc(353)
serverCertificateVerified: HTTPS server CN: www.facworld.com bumped:
local=213.156.236.180:59365 remote=208.227.150.131:443 FD 17 flags=1
..
2018/08/20 10:37:27.091 kid1| 33,5| client_side.cc(2917)
getTlsContextFromCache: Cached SSL certificate for www.facworld.com is valid
...


> Am I doing something wrong?

Maybe. It only can D/L *if* the present certificate provides a URL for
its absent CA certificate. Not all types of incomplete chains have that
required info.


> 2. Is this feature always on or do I have to configure/enable it in Squid v4?

Always on.


> 
> Squid Cache: Version v4.0-6d8f397398995c4512cb045920ee2747cc6b14f8
> 

Uhm, Squid code at 6d8f397 self-identify as 4.2.


Amos


From piuschungath at gmail.com  Mon Aug 20 13:03:43 2018
From: piuschungath at gmail.com (pius)
Date: Mon, 20 Aug 2018 08:03:43 -0500 (CDT)
Subject: [squid-users] Have issue with "https_port ssl-bump intercept"
In-Reply-To: <13e52d4d-6e26-63a0-045a-15d022f6cb89@treenet.co.nz>
References: <35064290-e6e6-569a-6c27-5f25624e9735@measurement-factory.com>
 <1533927868704-0.post@n4.nabble.com>
 <a5b0cd00-a61d-f31d-8fe2-61b3397f23c3@measurement-factory.com>
 <1534149123813-0.post@n4.nabble.com> <1534168104650-0.post@n4.nabble.com>
 <1534179998578-0.post@n4.nabble.com> <1534410959319-0.post@n4.nabble.com>
 <2216dbb6-daad-650c-eefe-4c2f1e2f697c@treenet.co.nz>
 <1534495145960-0.post@n4.nabble.com>
 <13e52d4d-6e26-63a0-045a-15d022f6cb89@treenet.co.nz>
Message-ID: <1534770223397-0.post@n4.nabble.com>

Thanks for the reply.

That really helped. I had an ACL for network and that blocked the https
traffic coming through. 

It has been a journey settling it up. But without you guys help I think I
was not able to do it. Thanks for all help. Much appreciated.

Few settings that help with debugging and fixing it
debug_options ALL,9 => full debug
dns_v4_first on =>  http://www.squid-cache.org/Doc/config/dns_v4_first/
ssl::server_name_regex =>
http://www.squid-cache.org/Versions/v3/3.5/cfgman/acl.html





--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From jon at jmcnetworks.co.uk  Mon Aug 20 16:15:56 2018
From: jon at jmcnetworks.co.uk (Jon Cuthbert)
Date: Mon, 20 Aug 2018 17:15:56 +0100
Subject: [squid-users] NTLM Authentication / Centos 7
Message-ID: <CAEQToEJ=qfmt_Ae8p=6fcmAJanibitiqiXYy-mLaJrgHZiocVg@mail.gmail.com>

On a new installation, I can not get the ntlm_auth working correctly:
Squid - v 3.5.20

2018/08/20 17:00:27| helperOpenServers: Starting 1/5 'ntlm_auth' processes
2018/08/20 17:00:27| WARNING: basicauthenticator #Hlpr243 exited
2018/08/20 17:00:27| Too few basicauthenticator processes are running (need
1/5)
2018/08/20 17:00:27| Starting new helpers
2018/08/20 17:00:27| helperOpenServers: Starting 1/5 'ntlm_auth' processes
2018/08/20 17:00:27| WARNING: basicauthenticator #Hlpr244 exited
2018/08/20 17:00:27| Too few basicauthenticator processes are running (need
1/5)
2018/08/20 17:00:27| Starting new helpers
2018/08/20 17:00:27| helperOpenServers: Starting 1/5 'ntlm_auth' processes

The ntlm_auth process respawns constantly, with the following error once
the request & user authentication attempt is sent from the browser:
'helperOpenServers: Starting 1/10 'ntlm_auth' processes
username must be specified!'

Above is with auth_param ntlm # commented out but the same happens if ntlm
is first.

squid.conf file contains:

auth_param ntlm program /usr/bin/ntlm_auth
-?helper-protocol=squid-2.5-ntlmssp
auth_param ntlm children 10
auth_param basic program /usr/bin/ntlm_auth
-?helper-protocol=squid-2.5-basic
auth_param basic children 5
acl AuthorizedUsers proxy_auth REQUIRED
http_access allow all AuthorizedUsers



The following ownerships are in place:
root:wbpriv /var/lib/samba/winbindd_privileged/
root:wbpriv /var/run/samba/winbindd/pipe

wbinfo - works for both plaintext & challenge/response
wbinfo -t works

/usr/bin/ntlm_auth --helper-protocol=squid-2.5-basic
works correctly - (if a space is left after the c basic, otherwise it
complains about username - I've tried squid.conf leaving a space as well)

/usr/bin/ntlm_auth -?helper-protocol=squid-2.5-ntlmssp
gives BH SPNEGO request invalid prefix - assume related to Negotiate, but
will investigate after basic authentication in case related).

I've looked at as many install instructions as possible, and this should be
okay?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180820/e777d50c/attachment.htm>

From mmartinez at asoprofarma.com  Mon Aug 20 17:20:52 2018
From: mmartinez at asoprofarma.com (Marcelo J. Martinez)
Date: Mon, 20 Aug 2018 14:20:52 -0300 (ART)
Subject: [squid-users] https requests the squid rejects the connection
Message-ID: <118941316.144712.1534785652369.JavaMail.zimbra@asoprofarma.com>

hello, 
sorry but I do not write in english I had to translate it with google.

I have a problem with the proxy server, install it with the default parameters with the following modifications:

acl SSL_ports port 443 21
acl Safe_ports port 80 # http
acl Safe_ports port 21 # ftp
acl Safe_ports port 443 # https
#acl Safe_ports port 70 # gopher
#acl Safe_ports port 210 # wais
#acl Safe_ports port 1025-65535 # unregistered ports
#acl Safe_ports port 280 # http-mgmt
#acl Safe_ports port 488 # gss-http
#acl Safe_ports port 591 # filemaker
#acl Safe_ports port 777 # multilingual http
acl CONNECT method CONNECT

# Only allow cachemgr access from localhost
http_access allow manager localhost
http_access deny manager
# Deny requests to unknown ports
http_access deny! Safe_ports
# Deny CONNECT to other than SSL ports
http_access deny CONNECT! SSL_ports
#

probe with several configurations but I can not save the problem.

what would be the correct configuration to work well?.

For http requests works fine.
example:

ERROR
El URL solicitado no se ha podido conseguir

Se encontr? el siguiente error al intentar recuperar la direcci?n URL: http://argenteam.net/

    Acceso Denegado

La configuraci?n de control de acceso evita que su solicitud sea permitida en este momento. Por favor, p?ngase en contacto con su proveedor de servicios si cree que esto es incorrecto.


For https requests the squid rejects the connection.
example:
url: https://www.youtube.com

El servidor proxy est? rechazando las conexiones

Firefox est? configurado para usar un servidor proxy que est? rechazando las conexiones.

    Verifique las opciones de proxy para confirmar que est?n correctas.

-- 
-- 
-- 
Marcelo J. Martinez 
PROGRAMADOR Y SOPORTE T?CNICO 
DEPARTAMENTO DE DESARROLLOS INFORMATICOS 
--------------------------------- 
Asoprofarma Coop. Prov. Ltda. 
Crisologo Larralde 6342 (C1431AQH) 
C.A.B.A. Buenos Aires Argentina 
Tel Directo (54 11) 4573 8034 
[ mailto:mmartinez at asoprofarma.com | mmartinez at asoprofarma.com ]
El contenido del presente mensaje y sus adjuntos es privado, estrictamente confidencial y exclusivo para su destinatario, pudiendo contener informacion protegida por normas legales y de secreto profesional. Bajo ninguna circunstancia su contenido puede ser transmitido o revelado a terceros ni divulgado en forma alguna. En consecuencia de haberlo recibido por error, solicitamos contactar al remitente y eliminarlo de su sistema. AHORRE PAPEL. PIENSE ANTES DE IMPRIMIR.



From uhlar at fantomas.sk  Mon Aug 20 18:26:08 2018
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Mon, 20 Aug 2018 20:26:08 +0200
Subject: [squid-users] https requests the squid rejects the connection
In-Reply-To: <118941316.144712.1534785652369.JavaMail.zimbra@asoprofarma.com>
References: <118941316.144712.1534785652369.JavaMail.zimbra@asoprofarma.com>
Message-ID: <20180820182608.GA31436@fantomas.sk>

On 20.08.18 14:20, Marcelo J. Martinez wrote:
>I have a problem with the proxy server, install it with the default parameters with the following modifications:

># Deny requests to unknown ports
>http_access deny! Safe_ports

this has to be:

http_access deny !Safe_ports

># Deny CONNECT to other than SSL ports
>http_access deny CONNECT! SSL_ports

and
http_access deny CONNECT !SSL_ports

...you put the ! to the bad place.

>example:
>
>ERROR
>El URL solicitado no se ha podido conseguir

relevant line from log file could show us, but first fix the above.


-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Silvester Stallone: Father of the RISC concept.


From mmartinez at asoprofarma.com  Mon Aug 20 18:45:19 2018
From: mmartinez at asoprofarma.com (Marcelo J. Martinez)
Date: Mon, 20 Aug 2018 15:45:19 -0300 (ART)
Subject: [squid-users] https requests the squid rejects the connection
In-Reply-To: <20180820182608.GA31436@fantomas.sk>
References: <118941316.144712.1534785652369.JavaMail.zimbra@asoprofarma.com>
 <20180820182608.GA31436@fantomas.sk>
Message-ID: <1606496886.144797.1534790719902.JavaMail.zimbra@asoprofarma.com>

sorry, it's a mistake to copy and paste.
the configuration is:

# Only allow cachemgr access from localhost
http_access allow manager localhost
http_access deny manager
# Deny requests to unknown ports
http_access deny !Safe_ports
# Deny CONNECT to other than SSL ports
http_access deny CONNECT !SSL_ports




----- Mensaje original -----
De: "Matus UHLAR - fantomas" <uhlar at fantomas.sk>
Para: "Posting address" <squid-users at lists.squid-cache.org>
Enviados: Lunes, 20 de Agosto 2018 15:26:08
Asunto: Re: [squid-users] https requests the squid rejects the connection

On 20.08.18 14:20, Marcelo J. Martinez wrote:
>I have a problem with the proxy server, install it with the default parameters with the following modifications:

># Deny requests to unknown ports
>http_access deny! Safe_ports

this has to be:

http_access deny !Safe_ports

># Deny CONNECT to other than SSL ports
>http_access deny CONNECT! SSL_ports

and
http_access deny CONNECT !SSL_ports

...you put the ! to the bad place.

>example:
>
>ERROR
>El URL solicitado no se ha podido conseguir

relevant line from log file could show us, but first fix the above.


-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Silvester Stallone: Father of the RISC concept.
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users
El contenido del presente mensaje y sus adjuntos es privado, estrictamente confidencial y exclusivo para su destinatario, pudiendo contener informacion protegida por normas legales y de secreto profesional. Bajo ninguna circunstancia su contenido puede ser transmitido o revelado a terceros ni divulgado en forma alguna. En consecuencia de haberlo recibido por error, solicitamos contactar al remitente y eliminarlo de su sistema. AHORRE PAPEL. PIENSE ANTES DE IMPRIMIR.



From Antony.Stone at squid.open.source.it  Mon Aug 20 18:49:47 2018
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Mon, 20 Aug 2018 20:49:47 +0200
Subject: [squid-users] https requests the squid rejects the connection
In-Reply-To: <118941316.144712.1534785652369.JavaMail.zimbra@asoprofarma.com>
References: <118941316.144712.1534785652369.JavaMail.zimbra@asoprofarma.com>
Message-ID: <201808202049.48015.Antony.Stone@squid.open.source.it>

On Monday 20 August 2018 at 19:20:52, Marcelo J. Martinez wrote:

> hello,
> sorry but I do not write in english I had to translate it with google.
> 
> I have a problem with the proxy server, install it with the default
> parameters with the following modifications:

1. Which version of Squid do you have installed?

2. Which operating system / distribution, and version, have you installed it 
on?

3. Have you configured your browser to use the proxy, or are you using Squid's 
intercept mode to proxy connectiosn which the browser thinks are going direct 
from it to the web server?


Antony.

-- 
"The future is already here.   It's just not evenly distributed yet."

 - William Gibson

                                                   Please reply to the list;
                                                         please *don't* CC me.


From mmartinez at asoprofarma.com  Mon Aug 20 19:03:39 2018
From: mmartinez at asoprofarma.com (Marcelo J. Martinez)
Date: Mon, 20 Aug 2018 16:03:39 -0300 (ART)
Subject: [squid-users] https requests the squid rejects the connection
In-Reply-To: <201808202049.48015.Antony.Stone@squid.open.source.it>
References: <118941316.144712.1534785652369.JavaMail.zimbra@asoprofarma.com>
 <201808202049.48015.Antony.Stone@squid.open.source.it>
Message-ID: <1547933606.144829.1534791819376.JavaMail.zimbra@asoprofarma.com>

1. Squid's version is 3.5.27

2. That this run on an Ubuntu 18.04.1 LTS (GNU / Linux 4.15.0-32-generic x86_64)

3. Configure in browser to use proxy port 3128 http and use the same configuration for https, ftp and SOCKS.


----- Mensaje original -----
De: "Antony Stone" <Antony.Stone at squid.open.source.it>
Para: "Posting address" <squid-users at lists.squid-cache.org>
Enviados: Lunes, 20 de Agosto 2018 15:49:47
Asunto: Re: [squid-users] https requests the squid rejects the connection

On Monday 20 August 2018 at 19:20:52, Marcelo J. Martinez wrote:

> hello,
> sorry but I do not write in english I had to translate it with google.
> 
> I have a problem with the proxy server, install it with the default
> parameters with the following modifications:

1. Which version of Squid do you have installed?

2. Which operating system / distribution, and version, have you installed it 
on?

3. Have you configured your browser to use the proxy, or are you using Squid's 
intercept mode to proxy connectiosn which the browser thinks are going direct 
from it to the web server?


Antony.

-- 
"The future is already here.   It's just not evenly distributed yet."

 - William Gibson

                                                   Please reply to the list;
                                                         please *don't* CC me.
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users
El contenido del presente mensaje y sus adjuntos es privado, estrictamente confidencial y exclusivo para su destinatario, pudiendo contener informacion protegida por normas legales y de secreto profesional. Bajo ninguna circunstancia su contenido puede ser transmitido o revelado a terceros ni divulgado en forma alguna. En consecuencia de haberlo recibido por error, solicitamos contactar al remitente y eliminarlo de su sistema. AHORRE PAPEL. PIENSE ANTES DE IMPRIMIR.



From squid3 at treenet.co.nz  Mon Aug 20 19:54:09 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 21 Aug 2018 07:54:09 +1200
Subject: [squid-users] NTLM Authentication / Centos 7
In-Reply-To: <CAEQToEJ=qfmt_Ae8p=6fcmAJanibitiqiXYy-mLaJrgHZiocVg@mail.gmail.com>
References: <CAEQToEJ=qfmt_Ae8p=6fcmAJanibitiqiXYy-mLaJrgHZiocVg@mail.gmail.com>
Message-ID: <0e690fcb-9f11-80e8-8204-7bdc4256300f@treenet.co.nz>

On 21/08/18 4:15 AM, Jon Cuthbert wrote:
> On a new installation, I can not get the ntlm_auth working correctly:
> Squid - v 3.5.20?
> 
> 2018/08/20 17:00:27| helperOpenServers: Starting 1/5 'ntlm_auth' processes
> 2018/08/20 17:00:27| WARNING: basicauthenticator #Hlpr243 exited
> 2018/08/20 17:00:27| Too few basicauthenticator processes are running
> (need 1/5)
> 2018/08/20 17:00:27| Starting new helpers
> 2018/08/20 17:00:27| helperOpenServers: Starting 1/5 'ntlm_auth' processes
> 2018/08/20 17:00:27| WARNING: basicauthenticator #Hlpr244 exited
> 2018/08/20 17:00:27| Too few basicauthenticator processes are running
> (need 1/5)
> 2018/08/20 17:00:27| Starting new helpers
> 2018/08/20 17:00:27| helperOpenServers: Starting 1/5 'ntlm_auth' processes
> 
> The ntlm_auth process respawns constantly, with the following error once
> the request & user authentication attempt is sent from the browser:
> 'helperOpenServers: Starting 1/10 'ntlm_auth' processes
> username must be specified!'
> 
> Above is with auth_param ntlm # commented out but the same happens if
> ntlm is first.
> 
> squid.conf file contains:
> 
> auth_param ntlm program /usr/bin/ntlm_auth
> -?helper-protocol=squid-2.5-ntlmssp
> auth_param ntlm children 10
> auth_param basic program /usr/bin/ntlm_auth
> -?helper-protocol=squid-2.5-basic
> auth_param basic children 5
> acl AuthorizedUsers proxy_auth REQUIRED

> http_access allow all AuthorizedUsers

This use of "all" does nothing but add confusion.

Also, what then do the other lines in your config then say to do with
the NTLM type-1 requests (no credentials) and failed-login requests?

Note those are different types of message. "http_access allow" only
handles completed + successful logins.

This is why our recommended and example configs always have three parts
and a "deny" action associated to the login:


 # ... things which don't require login credentials
 http_access deny login
 # ... things which depend on credentials


> 
> The following ownerships are in place:
> root:wbpriv /var/lib/samba/winbindd_privileged/? ?
> root:wbpriv /var/run/samba/winbindd/pipe
> 
> wbinfo - works for both plaintext & challenge/response
> wbinfo -t works

Is the proxy user a member of that wbpriv group, AND the old
cache_effective_* directives _absent_ from your squid.conf.


> 
> /usr/bin/ntlm_auth --helper-protocol=squid-2.5-basic?
> works correctly - (if a space is left after the c basic, otherwise it
> complains about username - I've tried squid.conf leaving a space as well)

That's odd.

> 
> /usr/bin/ntlm_auth -?helper-protocol=squid-2.5-ntlmssp
> gives BH SPNEGO request invalid prefix - assume related to Negotiate,
> but will investigate after basic authentication in case related).
> 
> I've looked at as many install instructions as possible, and this should
> be okay?


The "BH SPEGNO" indicates that the client/ Browser is *not* sending NTLM
authentication in the HTTP messages labled "Proxy-Authorization: NTLM ..."

Have you considered configuring Kerberos instead? All MS products since
WinXP should be defaulting to that more secure scheme.

Amos


From squid3 at treenet.co.nz  Mon Aug 20 20:02:44 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 21 Aug 2018 08:02:44 +1200
Subject: [squid-users] https requests the squid rejects the connection
In-Reply-To: <1606496886.144797.1534790719902.JavaMail.zimbra@asoprofarma.com>
References: <118941316.144712.1534785652369.JavaMail.zimbra@asoprofarma.com>
 <20180820182608.GA31436@fantomas.sk>
 <1606496886.144797.1534790719902.JavaMail.zimbra@asoprofarma.com>
Message-ID: <6cb7ee2a-aa10-56e3-78e0-d9ecc7bdda06@treenet.co.nz>

On 21/08/18 6:45 AM, Marcelo J. Martinez wrote:
> sorry, it's a mistake to copy and paste.
> the configuration is:
> 
> # Only allow cachemgr access from localhost
> http_access allow manager localhost
> http_access deny manager
> # Deny requests to unknown ports
> http_access deny !Safe_ports
> # Deny CONNECT to other than SSL ports
> http_access deny CONNECT !SSL_ports
> 

FYI: current recommended config has the manager lines after the CONNECT
line, that makes Squid a tiny bit faster and safer against CONNECT to
the manager URLs.

That will not solve your current issue though. As Matus said the log
entry (access.log) for the transaction is needed for more info about
what is going on - in particular the URL which is being denied.

I suspect it is simply a normal HTTP request to a port you were not
expecting. You did reduce the Safe_Ports ACL definition significantly.

Amos


From mmartinez at asoprofarma.com  Mon Aug 20 20:19:27 2018
From: mmartinez at asoprofarma.com (Marcelo J. Martinez)
Date: Mon, 20 Aug 2018 17:19:27 -0300 (ART)
Subject: [squid-users] https requests the squid rejects the connection
In-Reply-To: <6cb7ee2a-aa10-56e3-78e0-d9ecc7bdda06@treenet.co.nz>
References: <118941316.144712.1534785652369.JavaMail.zimbra@asoprofarma.com>
 <20180820182608.GA31436@fantomas.sk>
 <1606496886.144797.1534790719902.JavaMail.zimbra@asoprofarma.com>
 <6cb7ee2a-aa10-56e3-78e0-d9ecc7bdda06@treenet.co.nz>
Message-ID: <2137370086.144899.1534796367801.JavaMail.zimbra@asoprofarma.com>

access.log:

1534782486.761      0 10.10.1.101 TCP_DENIED/403 3917 CONNECT aus5.mozilla.org:443 - HIER_NONE/- text/html
1534782486.767      0 10.10.1.101 TCP_DENIED/403 3926 CONNECT redirector.gvt1.com:443 - HIER_NONE/- text/html
1534782486.768      0 10.10.1.101 TCP_DENIED/403 4221 GET http://ciscobinary.openh264.org/openh264-win64-0410d336bb748149a4f560eb6108090f078254b1.zip - HIER_NONE/- text/html
1534782606.751      0 10.10.1.101 TCP_DENIED/403 3989 CONNECT blocklists.settings.services.mozilla.com:443 - HIER_NONE/- text/html
1534782606.754      0 10.10.1.101 TCP_DENIED/403 3980 CONNECT firefox.settings.services.mozilla.com:443 - HIER_NONE/- text/html
1534783061.435      0 10.10.1.101 TCP_DENIED/403 3914 CONNECT www.youtube.com:443 - HIER_NONE/- text/html
1534783486.477      0 10.10.1.101 TCP_DENIED/403 4123 GET http://argenteam.net/ - HIER_NONE/- text/html
1534783486.506      0 10.10.1.101 TCP_DENIED/403 4169 GET http://smbserver2:3128/squid-internal-static/icons/SN.png - HIER_NONE/- text/html
1534785311.331      0 10.10.1.101 TCP_DENIED/403 3914 CONNECT www.youtube.com:443 - HIER_NONE/- text/html
1534788567.647      0 10.10.1.101 TCP_DENIED/403 3950 CONNECT safebrowsing.googleapis.com:443 - HIER_NONE/- text/html
1534791437.517      0 10.10.1.101 TCP_DENIED/403 3917 CONNECT aus5.mozilla.org:443 - HIER_NONE/- text/html

Bear in mind that the server is configured to reject the connection from my ip, the problem is that:
with http queries, the normal squid error page appears.
with https queries, the browser informs me that the proxy rejected the connection and the normal squid page does not appear.

----- Mensaje original -----
De: "Amos Jeffries" <squid3 at treenet.co.nz>
Para: "Posting address" <squid-users at lists.squid-cache.org>
Enviados: Lunes, 20 de Agosto 2018 17:02:44
Asunto: Re: [squid-users] https requests the squid rejects the connection

On 21/08/18 6:45 AM, Marcelo J. Martinez wrote:
> sorry, it's a mistake to copy and paste.
> the configuration is:
> 
> # Only allow cachemgr access from localhost
> http_access allow manager localhost
> http_access deny manager
> # Deny requests to unknown ports
> http_access deny !Safe_ports
> # Deny CONNECT to other than SSL ports
> http_access deny CONNECT !SSL_ports
> 

FYI: current recommended config has the manager lines after the CONNECT
line, that makes Squid a tiny bit faster and safer against CONNECT to
the manager URLs.

That will not solve your current issue though. As Matus said the log
entry (access.log) for the transaction is needed for more info about
what is going on - in particular the URL which is being denied.

I suspect it is simply a normal HTTP request to a port you were not
expecting. You did reduce the Safe_Ports ACL definition significantly.

Amos
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users
El contenido del presente mensaje y sus adjuntos es privado, estrictamente confidencial y exclusivo para su destinatario, pudiendo contener informacion protegida por normas legales y de secreto profesional. Bajo ninguna circunstancia su contenido puede ser transmitido o revelado a terceros ni divulgado en forma alguna. En consecuencia de haberlo recibido por error, solicitamos contactar al remitente y eliminarlo de su sistema. AHORRE PAPEL. PIENSE ANTES DE IMPRIMIR.



From squid3 at treenet.co.nz  Mon Aug 20 20:28:55 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 21 Aug 2018 08:28:55 +1200
Subject: [squid-users] https requests the squid rejects the connection
In-Reply-To: <2137370086.144899.1534796367801.JavaMail.zimbra@asoprofarma.com>
References: <118941316.144712.1534785652369.JavaMail.zimbra@asoprofarma.com>
 <20180820182608.GA31436@fantomas.sk>
 <1606496886.144797.1534790719902.JavaMail.zimbra@asoprofarma.com>
 <6cb7ee2a-aa10-56e3-78e0-d9ecc7bdda06@treenet.co.nz>
 <2137370086.144899.1534796367801.JavaMail.zimbra@asoprofarma.com>
Message-ID: <2eef3abc-39fc-fc9e-8f0d-675d132427b9@treenet.co.nz>

On 21/08/18 8:19 AM, Marcelo J. Martinez wrote:
> access.log:
> 
> 1534782486.761      0 10.10.1.101 TCP_DENIED/403 3917 CONNECT aus5.mozilla.org:443 - HIER_NONE/- text/html
> 1534782486.767      0 10.10.1.101 TCP_DENIED/403 3926 CONNECT redirector.gvt1.com:443 - HIER_NONE/- text/html
> 1534782486.768      0 10.10.1.101 TCP_DENIED/403 4221 GET http://ciscobinary.openh264.org/openh264-win64-0410d336bb748149a4f560eb6108090f078254b1.zip - HIER_NONE/- text/html
> 1534782606.751      0 10.10.1.101 TCP_DENIED/403 3989 CONNECT blocklists.settings.services.mozilla.com:443 - HIER_NONE/- text/html
> 1534782606.754      0 10.10.1.101 TCP_DENIED/403 3980 CONNECT firefox.settings.services.mozilla.com:443 - HIER_NONE/- text/html
> 1534783061.435      0 10.10.1.101 TCP_DENIED/403 3914 CONNECT www.youtube.com:443 - HIER_NONE/- text/html
> 1534783486.477      0 10.10.1.101 TCP_DENIED/403 4123 GET http://argenteam.net/ - HIER_NONE/- text/html
> 1534783486.506      0 10.10.1.101 TCP_DENIED/403 4169 GET http://smbserver2:3128/squid-internal-static/icons/SN.png - HIER_NONE/- text/html
> 1534785311.331      0 10.10.1.101 TCP_DENIED/403 3914 CONNECT www.youtube.com:443 - HIER_NONE/- text/html
> 1534788567.647      0 10.10.1.101 TCP_DENIED/403 3950 CONNECT safebrowsing.googleapis.com:443 - HIER_NONE/- text/html
> 1534791437.517      0 10.10.1.101 TCP_DENIED/403 3917 CONNECT aus5.mozilla.org:443 - HIER_NONE/- text/html
> 
> Bear in mind that the server is configured to reject the connection from my ip, the problem is that:
> with http queries, the normal squid error page appears.
> with https queries, the browser informs me that the proxy rejected the connection and the normal squid page does not appear.
> 

This is intentional behaviour by the Browsers. Squid does send the same
error page if the CONNECT tunnel is rejected, but they all refuse to
display anything but their own text. There were some workarounds that
worked some time ago, but those have also been blocked in recent years.

I do mean "refuse" above. The Browser authors have repeatedly been asked
to re-asses and always close the bugs as WONTFIX citing security risks
which are demonstrably false, or ignore it.


There is nothing Squid (or we) can do about it these days short of fully
decrypting the client TLS and injecting a fake response containing the
error page. Yes that is as nasty as it sounds (maybe more) and assumes
that the traffic on port 443 actually is HTTPS instead of something else.

Amos


From squid3 at treenet.co.nz  Mon Aug 20 20:30:59 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 21 Aug 2018 08:30:59 +1200
Subject: [squid-users] https requests the squid rejects the connection
In-Reply-To: <2137370086.144899.1534796367801.JavaMail.zimbra@asoprofarma.com>
References: <118941316.144712.1534785652369.JavaMail.zimbra@asoprofarma.com>
 <20180820182608.GA31436@fantomas.sk>
 <1606496886.144797.1534790719902.JavaMail.zimbra@asoprofarma.com>
 <6cb7ee2a-aa10-56e3-78e0-d9ecc7bdda06@treenet.co.nz>
 <2137370086.144899.1534796367801.JavaMail.zimbra@asoprofarma.com>
Message-ID: <a6238bc5-d7ca-c6a5-f3f1-8d917d8adaf7@treenet.co.nz>

On 21/08/18 8:19 AM, Marcelo J. Martinez wrote:
> access.log:
> 1534783486.506      0 10.10.1.101 TCP_DENIED/403 4169 GET http://smbserver2:3128/squid-internal-static/icons/SN.png - HIER_NONE/- text/html

Note that this port 3128 for showing the Squid error page details is
itself being blocked. That would be your Safe_Ports restriction in this
case.

Amos


From squid3 at treenet.co.nz  Mon Aug 20 20:43:25 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 21 Aug 2018 08:43:25 +1200
Subject: [squid-users] NTLM Authentication / Centos 7
In-Reply-To: <0e690fcb-9f11-80e8-8204-7bdc4256300f@treenet.co.nz>
References: <CAEQToEJ=qfmt_Ae8p=6fcmAJanibitiqiXYy-mLaJrgHZiocVg@mail.gmail.com>
 <0e690fcb-9f11-80e8-8204-7bdc4256300f@treenet.co.nz>
Message-ID: <5c14c8d6-f896-ce3e-0a7c-50bf938db754@treenet.co.nz>

On 21/08/18 7:54 AM, Amos Jeffries wrote:
> 
>  # ... things which don't require login credentials
>  http_access deny login

Oops. That should be "deny !login"

>  # ... things which depend on credentials
> 

Amos


From belle at bazuin.nl  Tue Aug 21 07:09:36 2018
From: belle at bazuin.nl (=?windows-1252?Q?L.P.H._van_Belle?=)
Date: Tue, 21 Aug 2018 09:09:36 +0200
Subject: [squid-users] NTLM Authentication / Centos 7
In-Reply-To: <0e690fcb-9f11-80e8-8204-7bdc4256300f@treenet.co.nz>
References: <CAEQToEJ=qfmt_Ae8p=6fcmAJanibitiqiXYy-mLaJrgHZiocVg@mail.gmail.com>
Message-ID: <vmime.5b7bbab0.5f8b.4eadfad02d6db0@ms249-lin-003.rotterdam.bazuin.nl>

> Also, what then do the other lines in your config then say to do with
> the NTLM type-1 requests (no credentials) and failed-login requests?

No this happend after the last security update of samba. 

This is due to a samba update.
SECURITY UPDATE: Weak authentication protocol allowed 
CVE-2018-1139-*.patch: Do not allow ntlmv1 over SMB1

You can easily test this, add 'ntlm auth = yes' to smb.conf and
restart. If this cures your problem, then you have two choices, leave
it alone and put up with a possibly insecure server, or fix your
clients to only use NTLMv2 and remove the line from smb.conf.

Greetz, 

Louis



From ygirardin at olfeo.com  Tue Aug 21 10:16:54 2018
From: ygirardin at olfeo.com (ygirardin)
Date: Tue, 21 Aug 2018 12:16:54 +0200
Subject: [squid-users] [Squid Rewritter] Issue with the concurrency option
Message-ID: <aad7bb04-db1e-0d58-a7bf-63ce44bb1aec@olfeo.com>

Hi,


I'm working on updating my squid which was running under the 3.3.8 
version to the new 4.2 release.


I'm using rewriter with concurency like this

url_rewrite_children 100 startup=10 idle=2 concurrency=5 queue-size=10 
on-persistent-overload=ERR


So according to the documation I should be receive data with channel-id 
going through 0 to concurrency. It was the case in 3.3.8 but with 4.2 I 
never received anything in channel 0 and I sometimes receive data on my 
helper stdin with channel id bigger than 5

This is what I receive


6 http://10.1.39.1:9123/redirect/?SessionID=64012081 10.1.0.39/10.1.0.39 
- GET myip=10.1.39.1 myport=3128

Is that normal ?


Thanks





From sis at open.ch  Tue Aug 21 11:22:33 2018
From: sis at open.ch (Simon Staeheli)
Date: Tue, 21 Aug 2018 11:22:33 +0000
Subject: [squid-users] Git tag strategy in Squids GitHub repo
Message-ID: <D14E36CE-1FA8-4B6F-B35A-909214A84F91@open.ch>

Hi there

We build Squid directly from its sources (https://github.com/squid-cache/squid.git) and not via the tar.gz from squid-cache.org . Is there a clear strategy how you guys use git tags? It looks like as there are some SQUID_4_0_X tags but they were never updated since Squid 4 became stable. 

It would be awesome if there is tag pointing to every official Squid release. 

Best
Simon
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4622 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180821/35c408b0/attachment.bin>

From squid3 at treenet.co.nz  Tue Aug 21 14:20:41 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 22 Aug 2018 02:20:41 +1200
Subject: [squid-users] NTLM Authentication / Centos 7
In-Reply-To: <vmime.5b7bbab0.5f8b.4eadfad02d6db0@ms249-lin-003.rotterdam.bazuin.nl>
References: <CAEQToEJ=qfmt_Ae8p=6fcmAJanibitiqiXYy-mLaJrgHZiocVg@mail.gmail.com>
 <vmime.5b7bbab0.5f8b.4eadfad02d6db0@ms249-lin-003.rotterdam.bazuin.nl>
Message-ID: <1988e485-edea-8065-f070-2af16f189533@treenet.co.nz>

On 21/08/18 7:09 PM, L.P.H. van Belle wrote:
>> Also, what then do the other lines in your config then say to do with
>> the NTLM type-1 requests (no credentials) and failed-login requests?
> 
> No this happend after the last security update of samba.
> 

"No" to what ? My Q above was in regards to the omitted http_access
behaviour.


The 'type-1' I am speaking of is the initial NTLM credentials token. Not
the version number. All LanManager based exchanges (LM 1.0, LM4, LM
32-bit, SMB LM, NTLMv1 NTLMv2, NTLMv2 extended) begin with a type-1 token.


> This is due to a samba update.
> SECURITY UPDATE: Weak authentication protocol allowed 
> CVE-2018-1139-*.patch: Do not allow ntlmv1 over SMB1
> 
> You can easily test this, add 'ntlm auth = yes' to smb.conf and
> restart. If this cures your problem, then you have two choices, leave
> it alone and put up with a possibly insecure server, or fix your
> clients to only use NTLMv2 and remove the line from smb.conf.
> 

Yes, that is worth testing for.

Amos


From jon at jmcnetworks.co.uk  Tue Aug 21 14:25:54 2018
From: jon at jmcnetworks.co.uk (Jon Cuthbert)
Date: Tue, 21 Aug 2018 15:25:54 +0100
Subject: [squid-users] NTLM Authentication / Centos 7
In-Reply-To: <1988e485-edea-8065-f070-2af16f189533@treenet.co.nz>
References: <CAEQToEJ=qfmt_Ae8p=6fcmAJanibitiqiXYy-mLaJrgHZiocVg@mail.gmail.com>
 <vmime.5b7bbab0.5f8b.4eadfad02d6db0@ms249-lin-003.rotterdam.bazuin.nl>
 <1988e485-edea-8065-f070-2af16f189533@treenet.co.nz>
Message-ID: <CAEQToELJGheo=kQAnJeLxmVsjmN2GibTYS6hqsBQzroAmi6Zew@mail.gmail.com>

Hi,

I got this working in the end, the issue was with the '-' on the
--helper-protocol being wrong. I'm assuming this was caused during a copy
/paste rather than typing as I was looking at web pages when creating the
file. I noticed the 2nd - seemed longer.

Thank you for the help though.

Jon



On Tue, Aug 21, 2018 at 3:21 PM Amos Jeffries <squid3 at treenet.co.nz> wrote:

> On 21/08/18 7:09 PM, L.P.H. van Belle wrote:
> >> Also, what then do the other lines in your config then say to do with
> >> the NTLM type-1 requests (no credentials) and failed-login requests?
> >
> > No this happend after the last security update of samba.
> >
>
> "No" to what ? My Q above was in regards to the omitted http_access
> behaviour.
>
>
> The 'type-1' I am speaking of is the initial NTLM credentials token. Not
> the version number. All LanManager based exchanges (LM 1.0, LM4, LM
> 32-bit, SMB LM, NTLMv1 NTLMv2, NTLMv2 extended) begin with a type-1 token.
>
>
> > This is due to a samba update.
> > SECURITY UPDATE: Weak authentication protocol allowed
> > CVE-2018-1139-*.patch: Do not allow ntlmv1 over SMB1
> >
> > You can easily test this, add 'ntlm auth = yes' to smb.conf and
> > restart. If this cures your problem, then you have two choices, leave
> > it alone and put up with a possibly insecure server, or fix your
> > clients to only use NTLMv2 and remove the line from smb.conf.
> >
>
> Yes, that is worth testing for.
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>


-- 

Jon Cuthbert
jon at jmcnetworks.co.uk
+44 7961 915060 <javascript:void(0);>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180821/2e214543/attachment.htm>

From squid3 at treenet.co.nz  Tue Aug 21 14:53:36 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 22 Aug 2018 02:53:36 +1200
Subject: [squid-users] [Squid Rewritter] Issue with the concurrency
	option
In-Reply-To: <aad7bb04-db1e-0d58-a7bf-63ce44bb1aec@olfeo.com>
References: <aad7bb04-db1e-0d58-a7bf-63ce44bb1aec@olfeo.com>
Message-ID: <69e1ad4b-21eb-b654-bf13-fa45f0f82e4b@treenet.co.nz>

On 21/08/18 10:16 PM, ygirardin wrote:
> Hi,
> 
> I'm working on updating my squid which was running under the 3.3.8
> version to the new 4.2 release.
> 
> 
> I'm using rewriter with concurency like this
> 
> url_rewrite_children 100 startup=10 idle=2 concurrency=5 queue-size=10
> on-persistent-overload=ERR
> 
> 
> So according to the documation I should be receive data with channel-id
> going through 0 to concurrency.

Which documentation is giving you that?

'concurrency' is the limit on number of requests Squid has in flight to
the helper.

The channel-ID is an opaque value that should be unique for each line
sent to the helper.


> It was the case in 3.3.8 but with 4.2 I
> never received anything in channel 0 and I sometimes receive data on my
> helper stdin with channel id bigger than 5
> 
> This is what I receive
> 
> 
> 6 http://10.1.39.1:9123/redirect/?SessionID=64012081 10.1.0.39/10.1.0.39
> - GET myip=10.1.39.1 myport=3128
> 
> Is that normal ?
> 

Yes.

The on-persistent-overload=ERR option allows for more than the N of
concurrency=N requests to be not-yet-responded in the helper at once.
Squid does not tell the helper which lookups it has given up on and
produced the ERR for - it just sends another lookup.

Amos


From belle at bazuin.nl  Tue Aug 21 14:57:39 2018
From: belle at bazuin.nl (=?windows-1252?Q?L.P.H._van_Belle?=)
Date: Tue, 21 Aug 2018 16:57:39 +0200
Subject: [squid-users] NTLM Authentication / Centos 7
In-Reply-To: <1988e485-edea-8065-f070-2af16f189533@treenet.co.nz>
References: <vmime.5b7bbab0.5f8b.4eadfad02d6db0@ms249-lin-003.rotterdam.bazuin.nl>
Message-ID: <vmime.5b7c2863.7706.5ceb88b56b5c2313@ms249-lin-003.rotterdam.bazuin.nl>


Ah, sorry Amos, 

I was understanding you ment the Question was about the NTLM auth itself not the token. 
My mis understanding.  :-/ 

Greetz, 

Louis


> -----Oorspronkelijk bericht-----
> Van: squid-users 
> [mailto:squid-users-bounces at lists.squid-cache.org] Namens 
> Amos Jeffries
> Verzonden: dinsdag 21 augustus 2018 16:21
> Aan: squid-users at lists.squid-cache.org
> Onderwerp: Re: [squid-users] NTLM Authentication / Centos 7
> 
> On 21/08/18 7:09 PM, L.P.H. van Belle wrote:
> >> Also, what then do the other lines in your config then say 
> to do with
> >> the NTLM type-1 requests (no credentials) and failed-login 
> requests?
> > 
> > No this happend after the last security update of samba.
> > 
> 
> "No" to what ? My Q above was in regards to the omitted http_access
> behaviour.
> 
> 
> The 'type-1' I am speaking of is the initial NTLM credentials 
> token. Not
> the version number. All LanManager based exchanges (LM 1.0, LM4, LM
> 32-bit, SMB LM, NTLMv1 NTLMv2, NTLMv2 extended) begin with a 
> type-1 token.
> 
> 
> > This is due to a samba update.
> > SECURITY UPDATE: Weak authentication protocol allowed 
> > CVE-2018-1139-*.patch: Do not allow ntlmv1 over SMB1
> > 
> > You can easily test this, add 'ntlm auth = yes' to smb.conf and
> > restart. If this cures your problem, then you have two 
> choices, leave
> > it alone and put up with a possibly insecure server, or fix your
> > clients to only use NTLMv2 and remove the line from smb.conf.
> > 
> 
> Yes, that is worth testing for.
> 
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 



From rousskov at measurement-factory.com  Tue Aug 21 21:05:02 2018
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Tue, 21 Aug 2018 15:05:02 -0600
Subject: [squid-users] [Squid Rewritter] Issue with the concurrency
	option
In-Reply-To: <69e1ad4b-21eb-b654-bf13-fa45f0f82e4b@treenet.co.nz>
References: <aad7bb04-db1e-0d58-a7bf-63ce44bb1aec@olfeo.com>
 <69e1ad4b-21eb-b654-bf13-fa45f0f82e4b@treenet.co.nz>
Message-ID: <a35c34b1-601d-04d8-55cd-dbf3a767b742@measurement-factory.com>

On 08/21/2018 08:53 AM, Amos Jeffries wrote:
> On 21/08/18 10:16 PM, ygirardin wrote:
>> I'm working on updating my squid which was running under the 3.3.8
>> version to the new 4.2 release.

>> according to the documation I should be receive data with channel-id
>> going through 0 to concurrency.


> Which documentation is giving you that?

FWIW, 0..concurrency numbering of the first helper request field is a
very natural (but no longer correct) interpretation of that field name
-- "channel ID". IMHO, Squid documentation should be rewritten to use
"transaction ID" instead. Pull requests and wiki updates are welcomed.

What used to be a small channel ID from a 0..concurrency interval, is
now an ever-increasing/unique (within a helper instance scope) 64-bit
transaction ID. There is (a somewhat veiled IMHO) explanation about that
in Squid v4 release notes:

http://www.squid-cache.org/Versions/v4/RELEASENOTES.html#ss2.2


HTH,

Alex.


From ahmed.zaeem at netstream.ps  Tue Aug 21 21:42:11 2018
From: ahmed.zaeem at netstream.ps (--Ahmad--)
Date: Wed, 22 Aug 2018 00:42:11 +0300
Subject: [squid-users] tcp_miss_aborted driving me crazy !
Message-ID: <4BA938BB-8905-427D-BBDC-84DB94F1125C@netstream.ps>


Hello Folks :

i have frequent Down on website that using it for IPV6 outgoing addresses :
below logs as you see , some have TCP_Miss and some have problems as TCP_MISS_ABORTED .

the TCP_MISS_ABORTED seems down request and i dont know whats the wrong there as long i see the name is resolved of website and we can ping it 

based on logs below , the   website ip address  is ? >2400:cb00:2048:1::681b:99de 


21/Aug/2018:16:26:42 -0400   5575 94.130.239.213 36722 184.75.223.131 13071 TCP_MISS/200 425 GET http://extlikes.org/ip.php - HIER_DIRECT/ extlikes.org 2400:cb00:2048:1::681b:99de 
21/Aug/2018:16:26:42 -0400   5673 94.130.239.213 52172 184.75.223.131 13022 TCP_MISS/200 425 GET http://extlikes.org/ip.php - HIER_DIRECT/ extlikes.org 2400:cb00:2048:1::681b:99de 
21/Aug/2018:16:26:42 -0400   5673 94.130.239.213 43942 184.75.223.131 13026 TCP_MISS/200 425 GET http://extlikes.org/ip.php - HIER_DIRECT/ extlikes.org 2400:cb00:2048:1::681b:99de 
21/Aug/2018:16:26:42 -0400   5673 94.130.239.213 49560 184.75.223.131 13010 TCP_MISS/200 425 GET http://extlikes.org/ip.php - HIER_DIRECT/ extlikes.org 2400:cb00:2048:1::681b:99de 
21/Aug/2018:16:26:42 -0400   5673 94.130.239.213 37166 184.75.223.131 13001 TCP_MISS/200 425 GET http://extlikes.org/ip.php - HIER_DIRECT/ extlikes.org 2400:cb00:2048:1::681b:99de 
21/Aug/2018:16:26:42 -0400   5673 94.130.239.213 47320 184.75.223.131 13015 TCP_MISS/200 425 GET http://extlikes.org/ip.php - HIER_DIRECT/ extlikes.org 2400:cb00:2048:1::681b:99de 
21/Aug/2018:16:26:42 -0400   5707 94.130.239.213 60090 184.75.223.131 13016 TCP_MISS/200 425 GET http://extlikes.org/ip.php - HIER_DIRECT/ extlikes.org 2400:cb00:2048:1::681b:99de 
21/Aug/2018:16:26:36 -0400  38905 94.130.239.213 38342 184.75.223.131 11807 TCP_MISS_ABORTED/0 0 GET http://extlikes.org/ip.php - HIER_DIRECT/ extlikes.org 2400:cb00:2048:1::681b:99de 
21/Aug/2018:16:26:36 -0400  38884 94.130.239.213 39622 184.75.223.131 11718 TCP_MISS_ABORTED/0 0 GET http://extlikes.org/ip.php - HIER_DIRECT/ extlikes.org 2400:cb00:2048:1::681b:99de 
21/Aug/2018:16:26:36 -0400  38843 94.130.239.213 40526 184.75.223.131 11852 TCP_MISS_ABORTED/0 0 GET http://extlikes.org/ip.php - HIER_DIRECT/ extlikes.org 2400:cb00:2048:1::681b:99de 
21/Aug/2018:16:26:36 -0400  38781 94.130.239.213 42524 184.75.223.131 11893 TCP_MISS_ABORTED/0 0 GET http://extlikes.org/ip.php - HIER_DIRECT/ extlikes.org 2400:cb00:2048:1::681b:99de 
21/Aug/2018:16:26:36 -0400  38724 94.130.239.213 48742 184.75.223.131 11552 TCP_MISS_ABORTED/0 0 GET http://extlikes.org/ip.php - HIER_DIRECT/ extlikes.org 2400:cb00:2048:1::681b:99de 
21/Aug/2018:16:26:35 -0400  38656 94.130.239.213 55278 184.75.223.131 11913 TCP_MISS_ABORTED/0 0 GET http://extlikes.org/ip.php - HIER_DIRECT/ extlikes.org 2400:cb00:2048:1::681b:99de 



as you see above , some request go ok and others dont go , and i hope i find explanation why the TCP_miss aborted occurs as long as i can ping it from an iPV6 address .
my outgoing  addresses are IPV6 

all is IPV6 purse addresses , 

looking forward to help me out 

kind regards 

From rousskov at measurement-factory.com  Tue Aug 21 22:47:04 2018
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Tue, 21 Aug 2018 16:47:04 -0600
Subject: [squid-users] tcp_miss_aborted driving me crazy !
In-Reply-To: <4BA938BB-8905-427D-BBDC-84DB94F1125C@netstream.ps>
References: <4BA938BB-8905-427D-BBDC-84DB94F1125C@netstream.ps>
Message-ID: <4be5f064-270b-6d31-a875-dfad6f19529d@measurement-factory.com>

On 08/21/2018 03:42 PM, --Ahmad-- wrote:

> the TCP_MISS_ABORTED seems down request and i dont know whats the
> wrong there

Assuming the second column in the sanitized access.log output below is
transaction response time, it looks like the client aborts (i.e. closes
the connection) if it receives no response from Squid for ~38 seconds. I
do not know why the server did not respond for so long or why Squid did
not forward the response to the client for so long. You may be able to
distinguish these two cases using a packet capture.


> 16:26:42  5575 ip1 36722 ip2 13071 TCP_MISS/200 425 GET ...
> 16:26:42  5673 ip1 52172 ip2 13022 TCP_MISS/200 425 GET ...
> 16:26:42  5673 ip1 43942 ip2 13026 TCP_MISS/200 425 GET ...
> 16:26:42  5673 ip1 49560 ip2 13010 TCP_MISS/200 425 GET ...
> 16:26:42  5673 ip1 37166 ip2 13001 TCP_MISS/200 425 GET ...
> 16:26:42  5673 ip1 47320 ip2 13015 TCP_MISS/200 425 GET ...
> 16:26:42  5707 ip1 60090 ip2 13016 TCP_MISS/200 425 GET ...
> 16:26:36 38905 ip1 38342 ip2 11807 TCP_MISS_ABORTED/0 0 GET ...
> 16:26:36 38884 ip1 39622 ip2 11718 TCP_MISS_ABORTED/0 0 GET ...
> 16:26:36 38843 ip1 40526 ip2 11852 TCP_MISS_ABORTED/0 0 GET ...
> 16:26:36 38781 ip1 42524 ip2 11893 TCP_MISS_ABORTED/0 0 GET ...
> 16:26:36 38724 ip1 48742 ip2 11552 TCP_MISS_ABORTED/0 0 GET ...
> 16:26:35 38656 ip1 55278 ip2 11913 TCP_MISS_ABORTED/0 0 GET ...

What logformat do you use? Did you reorder these records or were they
logged by Squid in the decreasing timestamp order?

The requests in each of the two groups above look concurrent to me. Do
you explicitly turn collapsed_forwarding on in your squid.conf? If you
do, does turning collapsed forwarding off solve this problem?


> as long as i can ping it from an iPV6 address

This is probably not an IP connectivity problem but a TCP- or HTTP-level
problem. You may want to try curl or wget to reproduce it without Squid.


HTH,

Alex.


From squid3 at treenet.co.nz  Wed Aug 22 02:57:13 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 22 Aug 2018 14:57:13 +1200
Subject: [squid-users] [Squid Rewritter] Issue with the concurrency
	option
In-Reply-To: <a35c34b1-601d-04d8-55cd-dbf3a767b742@measurement-factory.com>
References: <aad7bb04-db1e-0d58-a7bf-63ce44bb1aec@olfeo.com>
 <69e1ad4b-21eb-b654-bf13-fa45f0f82e4b@treenet.co.nz>
 <a35c34b1-601d-04d8-55cd-dbf3a767b742@measurement-factory.com>
Message-ID: <d85b65bc-cee5-b411-8d87-45cc5f72fcff@treenet.co.nz>

On 22/08/18 9:05 AM, Alex Rousskov wrote:
> On 08/21/2018 08:53 AM, Amos Jeffries wrote:
>> On 21/08/18 10:16 PM, ygirardin wrote:
>>> I'm working on updating my squid which was running under the 3.3.8
>>> version to the new 4.2 release.
> 
>>> according to the documation I should be receive data with channel-id
>>> going through 0 to concurrency.
> 
> 
>> Which documentation is giving you that?
> 
> FWIW, 0..concurrency numbering of the first helper request field is a
> very natural (but no longer correct) interpretation of that field name
> -- "channel ID". IMHO, Squid documentation should be rewritten to use
> "transaction ID" instead. Pull requests and wiki updates are welcomed.

That won't help if it is external documentation. Which is why I asked.
All but one place we have simply calls it "channel-ID", that one says
"channel number" but no text about how it behaves.

Amos


From squid3 at treenet.co.nz  Wed Aug 22 03:05:45 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 22 Aug 2018 15:05:45 +1200
Subject: [squid-users] Git tag strategy in Squids GitHub repo
In-Reply-To: <D14E36CE-1FA8-4B6F-B35A-909214A84F91@open.ch>
References: <D14E36CE-1FA8-4B6F-B35A-909214A84F91@open.ch>
Message-ID: <80c8a489-f8cc-c582-db9e-6b86265d8da3@treenet.co.nz>

On 21/08/18 11:22 PM, Simon Staeheli wrote:
> Hi there
> 
> We build Squid directly from its sources (https://github.com/squid-cache/squid.git) and not via the tar.gz from squid-cache.org . Is there a clear strategy how you guys use git tags? It looks like as there are some SQUID_4_0_X tags but they were never updated since Squid 4 became stable. 
> 
> It would be awesome if there is tag pointing to every official Squid release. 
> 

Formally each release is supposed to have a SQUID_N_N(_X) tag.

However, our auto-commit bot the QA team came up with does not do
tagging. And tags from third-party repositories (ie my release staging
one) are not imported by the github PR process.

Amos


From m_zouhairy at skno.by  Wed Aug 22 07:27:02 2018
From: m_zouhairy at skno.by (Vacheslav)
Date: Wed, 22 Aug 2018 10:27:02 +0300
Subject: [squid-users] Git tag strategy in Squids GitHub repo
In-Reply-To: <80c8a489-f8cc-c582-db9e-6b86265d8da3@treenet.co.nz>
References: <D14E36CE-1FA8-4B6F-B35A-909214A84F91@open.ch>
 <80c8a489-f8cc-c582-db9e-6b86265d8da3@treenet.co.nz>
Message-ID: <0c8401d439e9$856b1e20$90415a60$@skno.by>



-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Amos Jeffries
Sent: Wednesday, August 22, 2018 6:06 AM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Git tag strategy in Squids GitHub repo

On 21/08/18 11:22 PM, Simon Staeheli wrote:
> Hi there
> 
> We build Squid directly from its sources (https://github.com/squid-cache/squid.git) and not via the tar.gz from squid-cache.org . Is there a clear strategy how you guys use git tags? It looks like as there are some SQUID_4_0_X tags but they were never updated since Squid 4 became stable. 
> 
> It would be awesome if there is tag pointing to every official Squid release. 
> 

>Formally each release is supposed to have a SQUID_N_N(_X) tag.

>However, our auto-commit bot the QA team came up with does not do tagging. And tags from third-party repositories (ie my release staging
one) are not imported by the github PR process.

So Why not ask them to fix that?

>Amos
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users




From squid3 at treenet.co.nz  Wed Aug 22 14:02:51 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 23 Aug 2018 02:02:51 +1200
Subject: [squid-users] Git tag strategy in Squids GitHub repo
In-Reply-To: <0c8401d439e9$856b1e20$90415a60$@skno.by>
References: <D14E36CE-1FA8-4B6F-B35A-909214A84F91@open.ch>
 <80c8a489-f8cc-c582-db9e-6b86265d8da3@treenet.co.nz>
 <0c8401d439e9$856b1e20$90415a60$@skno.by>
Message-ID: <141053c0-3c51-6a08-4f67-a9de81acdee5@treenet.co.nz>

On 22/08/18 7:27 PM, Vacheslav wrote:
> 
> -----Original Message-----
> From: Amos Jeffries
> 
> On 21/08/18 11:22 PM, Simon Staeheli wrote:
>> Hi there
>>
>> We build Squid directly from its sources (https://github.com/squid-cache/squid.git) and not via the tar.gz from squid-cache.org . Is there a clear strategy how you guys use git tags? It looks like as there are some SQUID_4_0_X tags but they were never updated since Squid 4 became stable. 
>>
>> It would be awesome if there is tag pointing to every official Squid release. 
>>
> 
>> Formally each release is supposed to have a SQUID_N_N(_X) tag.
> 
>> However, our auto-commit bot the QA team came up with does not do tagging. And tags from third-party repositories (ie my release staging
> one) are not imported by the github PR process.
> 
> So Why not ask them to fix that?
> 

What makes you think I didn't do that most obvious of things?

Amos


From m_zouhairy at skno.by  Wed Aug 22 14:16:04 2018
From: m_zouhairy at skno.by (Vacheslav)
Date: Wed, 22 Aug 2018 17:16:04 +0300
Subject: [squid-users] Git tag strategy in Squids GitHub repo
In-Reply-To: <141053c0-3c51-6a08-4f67-a9de81acdee5@treenet.co.nz>
References: <D14E36CE-1FA8-4B6F-B35A-909214A84F91@open.ch>
 <80c8a489-f8cc-c582-db9e-6b86265d8da3@treenet.co.nz>
 <0c8401d439e9$856b1e20$90415a60$@skno.by>
 <141053c0-3c51-6a08-4f67-a9de81acdee5@treenet.co.nz>
Message-ID: <6ad601d43a22$a97fc890$fc7f59b0$@skno.by>



-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Amos Jeffries
Sent: Wednesday, August 22, 2018 5:03 PM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Git tag strategy in Squids GitHub repo

On 22/08/18 7:27 PM, Vacheslav wrote:
> 
> -----Original Message-----
> From: Amos Jeffries
> 
> On 21/08/18 11:22 PM, Simon Staeheli wrote:
>> Hi there
>>
>> We build Squid directly from its sources (https://github.com/squid-cache/squid.git) and not via the tar.gz from squid-cache.org . Is there a clear strategy how you guys use git tags? It looks like as there are some SQUID_4_0_X tags but they were never updated since Squid 4 became stable. 
>>
>> It would be awesome if there is tag pointing to every official Squid release. 
>>
> 
>> Formally each release is supposed to have a SQUID_N_N(_X) tag.
> 
>> However, our auto-commit bot the QA team came up with does not do tagging. And tags from third-party repositories (ie my release staging
> one) are not imported by the github PR process.
> 
> So Why not ask them to fix that?
> 

>What makes you think I didn't do that most obvious of things?

Well the language you used is the one I use when I am talking about a resource which belongs to an enemy of mine!

>Amos
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users




From rousskov at measurement-factory.com  Wed Aug 22 14:50:56 2018
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Wed, 22 Aug 2018 08:50:56 -0600
Subject: [squid-users] Git tag strategy in Squids GitHub repo
In-Reply-To: <80c8a489-f8cc-c582-db9e-6b86265d8da3@treenet.co.nz>
References: <D14E36CE-1FA8-4B6F-B35A-909214A84F91@open.ch>
 <80c8a489-f8cc-c582-db9e-6b86265d8da3@treenet.co.nz>
Message-ID: <b43261ad-b707-c5fb-eb45-c2dd62482a6b@measurement-factory.com>

On 08/21/2018 09:05 PM, Amos Jeffries wrote:
> On 21/08/18 11:22 PM, Simon Staeheli wrote:
>> It would be awesome if there is tag pointing to every official Squid release. 

> our auto-commit bot the QA team came up with does not do tagging.

Very true. It also does not water plants.


> And tags from third-party repositories (ie my release staging
> one) are not imported by the github PR process.

True again and still irrelevant. GitHub does not import lightweight tags
when merging PRs because those tags are not a part of a PR branch and
are not supposed to be imported by git design.

GitHub certainly supports release tagging. The PR merging bot is not
(and probably should not be) responsible for releases, including release
tagging.

FWIW, in March 2018 email to Amos, I have already tried to explain the
design approach behind git tagging and offered a specific short-term
tagging solution. I did not get a response.

Alex.


From m_zouhairy at skno.by  Wed Aug 22 14:55:19 2018
From: m_zouhairy at skno.by (Vacheslav)
Date: Wed, 22 Aug 2018 17:55:19 +0300
Subject: [squid-users] Git tag strategy in Squids GitHub repo
In-Reply-To: <b43261ad-b707-c5fb-eb45-c2dd62482a6b@measurement-factory.com>
References: <D14E36CE-1FA8-4B6F-B35A-909214A84F91@open.ch>
 <80c8a489-f8cc-c582-db9e-6b86265d8da3@treenet.co.nz>
 <b43261ad-b707-c5fb-eb45-c2dd62482a6b@measurement-factory.com>
Message-ID: <718a01d43a28$2525bcc0$6f713640$@skno.by>



-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Alex Rousskov
Sent: Wednesday, August 22, 2018 5:51 PM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Git tag strategy in Squids GitHub repo

On 08/21/2018 09:05 PM, Amos Jeffries wrote:
> On 21/08/18 11:22 PM, Simon Staeheli wrote:
>> It would be awesome if there is tag pointing to every official Squid release. 

> our auto-commit bot the QA team came up with does not do tagging.

>Very true. It also does not water plants.


> And tags from third-party repositories (ie my release staging
> one) are not imported by the github PR process.

>True again and still irrelevant. GitHub does not import lightweight tags when merging PRs because those tags are not a part of a PR branch and are not supposed to be imported by git design.

>GitHub certainly supports release tagging. The PR merging bot is not (and probably should not be) responsible for releases, including release tagging.

>FWIW, in March 2018 email to Amos, I have already tried to explain the design approach behind git tagging and offered a specific short-term tagging solution. I did not get a response.

>Alex.

I get this all the time it's never me, it's everybody else who is out to get me :)
Like it wasn't the driver, the port on the switch was blocking, i.e I'm the innocent good guy!
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users




From rodrigo.root.rj at gmail.com  Wed Aug 22 23:13:39 2018
From: rodrigo.root.rj at gmail.com (Rodrigo Cunha)
Date: Wed, 22 Aug 2018 20:13:39 -0300
Subject: [squid-users] Error_directory to https not work
Message-ID: <CAOGexv9Yxuyr8dL+avaMdy0Cg=24ovf30yBRkW2c78LnGb+ZKg@mail.gmail.com>

Dears,
My squid_http work fine and deny request to https too. But when i request
https(secure port 443) links deny in file (black_list) my squid not report
error_directory files, when i send request to http(insecure port 80) domain
the squid report with error_directory.

What a happen with my squid?Follow my squid.conf.

###
### Configura??es Locais ###
cache_mgr rodrigo.root.rj at gmail.com
visible_hostname lamplus.oduvaldocozzi.intranet
error_directory /usr/share/squid3/errors/pt-br/
###
### Squid Generico Cache ###
cache_mem 512
maximum_object_size_in_memory 4 MB
cache_dir  ufs /var/cache/squid3 3000 16 256
access_log /var/log/squid3/access.log squid

cache_mem 256 MB
cache_swap_low 90
cache_swap_high 95
maximum_object_size 10000 KB
minimum_object_size 0 KB
maximum_object_size_in_memory 4000 KB


acl SSL_ports port 443
acl Safe_ports port 80          # http
acl Safe_ports port 21          # ftp
acl Safe_ports port 443         # https
acl Safe_ports port 70          # gopher
acl Safe_ports port 210         # wais
acl Safe_ports port 1025-65535  # unregistered ports
acl Safe_ports port 280         # http-mgmt
acl Safe_ports port 488         # gss-http
acl Safe_ports port 591         # filemaker
acl Safe_ports port 777         # multiling http
acl CONNECT method CONNECT

###
### ACL ###
acl local1 src 10.0.0.0/24
acl local2 src 10.0.1.0/24
acl blacklist dstdomain "/etc/squid3/negados.list.acl"
#acl fb dstdomain .facebook.com
###
### Controle de Acesso ###
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow localhost manager
http_access deny manager
http_access allow localhost
http_access deny blacklist
#http_access deny fb
http_access allow local1
http_access allow local2
http_access deny all
http_port 3128


-- 
Atenciosamente,
Rodrigo da Silva Cunha
S?o Gon?alo, RJ - Brasil
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180822/8946a6e1/attachment.htm>

From squid3 at treenet.co.nz  Thu Aug 23 04:36:45 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 23 Aug 2018 16:36:45 +1200
Subject: [squid-users] Error_directory to https not work
In-Reply-To: <CAOGexv9Yxuyr8dL+avaMdy0Cg=24ovf30yBRkW2c78LnGb+ZKg@mail.gmail.com>
References: <CAOGexv9Yxuyr8dL+avaMdy0Cg=24ovf30yBRkW2c78LnGb+ZKg@mail.gmail.com>
Message-ID: <e32c23df-9328-a622-e563-9005e2839f20@treenet.co.nz>

On 23/08/18 11:13 AM, Rodrigo Cunha wrote:
> Dears,
> My squid_http work fine and deny request to https too. But when i
> request https(secure port 443) links deny in file (black_list) my squid
> not report error_directory files, when i send request to http(insecure
> port 80) domain the squid report with error_directory.
> 
> What a happen with my squid?Follow my squid.conf.
> 

Nothing particular happened.

HTTPS is sent differently through proxies. Using CONNECT requests with
encrypted content. More details on that can be found at
<https://wiki.squid-cache.org/Features/HTTPS>.

Browsers in particular refuse to display error messages sent in response
to CONNECT requests. I think you will find the Squid does send the error
page but the Browser is refusing to display it.


The only thing you can do about this sad situation is use SSL-Bump
feature on the encrypted traffic so Squid can send the error message
within an encrypted response - which the Browser does display *if* it
trusts the proxy TLS certificate used by SSL-Bump.

Please be aware:
  SSL-Bump feature is sometimes forbidden or restricted-use by law. So
please get proper legal advice before using it. Anyone helping you setup
the feature will be assuming that you have done that due diligence check.


HTH
Amos


From ygirardin at olfeo.com  Thu Aug 23 06:56:40 2018
From: ygirardin at olfeo.com (Yann Girardin)
Date: Thu, 23 Aug 2018 08:56:40 +0200
Subject: [squid-users] [Squid Rewritter] Issue with the
	concurrency	option
In-Reply-To: <d85b65bc-cee5-b411-8d87-45cc5f72fcff@treenet.co.nz>
References: <aad7bb04-db1e-0d58-a7bf-63ce44bb1aec@olfeo.com>
 <69e1ad4b-21eb-b654-bf13-fa45f0f82e4b@treenet.co.nz>
 <a35c34b1-601d-04d8-55cd-dbf3a767b742@measurement-factory.com>
 <d85b65bc-cee5-b411-8d87-45cc5f72fcff@treenet.co.nz>
Message-ID: <DEE553E0920CFA41BAF85A4B9C6FC3498F27657880@EXCHANGESRV1.olfeo-lab.net>

The documentation is directly extract from the squid website :

http://www.squid-cache.org/Doc/config/url_rewrite_program/

Thanks for the feedback

-----Message d'origine-----
De?: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] De la part de Amos Jeffries
Envoy??: mercredi 22 ao?t 2018 04:57
??: squid-users at lists.squid-cache.org
Objet?: Re: [squid-users] [Squid Rewritter] Issue with the concurrency option

On 22/08/18 9:05 AM, Alex Rousskov wrote:
> On 08/21/2018 08:53 AM, Amos Jeffries wrote:
>> On 21/08/18 10:16 PM, ygirardin wrote:
>>> I'm working on updating my squid which was running under the 3.3.8
>>> version to the new 4.2 release.
> 
>>> according to the documation I should be receive data with channel-id
>>> going through 0 to concurrency.
> 
> 
>> Which documentation is giving you that?
> 
> FWIW, 0..concurrency numbering of the first helper request field is a
> very natural (but no longer correct) interpretation of that field name
> -- "channel ID". IMHO, Squid documentation should be rewritten to use
> "transaction ID" instead. Pull requests and wiki updates are welcomed.

That won't help if it is external documentation. Which is why I asked.
All but one place we have simply calls it "channel-ID", that one says
"channel number" but no text about how it behaves.

Amos
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users

From a.zubarev at generium.ru  Thu Aug 23 13:22:21 2018
From: a.zubarev at generium.ru (=?koi8-r?B?+tXCwdLF1yDhzMXL08HOxNIg4czFy9PBzsTSz9fJ3g==?=)
Date: Thu, 23 Aug 2018 13:22:21 +0000
Subject: [squid-users] Transparent squid configuration problem.
Message-ID: <61EF6F4DD37F1245B186602EACC06454BA556B28@MEX1.generium.corp>

Hi! I have some problems with configuration of squid.

What I need:
http/https transparent proxy server based on Debian Stretch with some blacklisted and whitelisted domains

I've used many tutorials and squid.wiki through installation process and it almost work! But I have the last problem.

When I tried to connect to some websites like a https://habr.com I have  got HTTP ERROR 503. Ive tried to find solution at forums but no one helped me. I know the answer is simple and its here but cannt find it by myself.

Here is my squid.conf, cache.log, access.log and iptables script.

Please help! :)

Squid.conf:

dns_v4_first on

acl network src 10.84.0.0/16

acl SSL_ports port 443
acl Safe_ports port 80        # http
acl Safe_ports port 21        # ftp
acl Safe_ports port 443        # https
acl Safe_ports port 70        # gopher
acl Safe_ports port 210        # wais
acl Safe_ports port 1025-65535    # unregistered ports
acl Safe_ports port 280        # http-mgmt
acl Safe_ports port 488        # gss-http
acl Safe_ports port 591        # filemaker
acl Safe_ports port 777        # multiling http
acl blacklist dstdomain "/etc/squid/acls/social_networks.txt" # list of blocked websites here
acl CONNECT method CONNECT

http_access deny blacklist
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports

http_access allow all

http_port 3130

http_port 3128 intercept
https_port 3129 intercept ssl-bump cert=/etc/squid/ssl_cert/vproxy2.pem key=/etc/squid/ssl_cert/vproxy2.pem

#always_direct allow all
ssl_bump server-first all
#sslproxy_cert_error deny all
#sslproxy_flags DONT_VERIFY_PEER

sslcrtd_program /usr/lib/squid/ssl_crtd -s /var/lib/ssl_db -M 4MB
sslcrtd_children 8 startup=1 idle=1

coredump_dir /var/spool/squid

# Add any of your own refresh_pattern entries above these.
refresh_pattern ^ftp:        1440    20%    10080
refresh_pattern ^gopher:    1440    0%    1440
refresh_pattern -i (/cgi-bin/|\?) 0    0%    0
refresh_pattern .        0    20%    4320

shutdown_lifetime 1 second

cache.log:

Maximum Resident Size: 123312 KB
Page faults with physical i/o: 7
2018/08/23 16:19:27 kid1| Logfile: closing log daemon:/var/log/squid/access.log
2018/08/23 16:19:27 kid1| Logfile Daemon: closing log daemon:/var/log/squid/access.log
2018/08/23 16:19:27 kid1| Open FD UNSTARTED     6 DNS Socket IPv6
2018/08/23 16:19:27 kid1| Open FD READ/WRITE    7 DNS Socket IPv4
2018/08/23 16:19:27 kid1| Open FD UNSTARTED    10 IPC UNIX STREAM Parent
2018/08/23 16:19:27 kid1| Squid Cache (Version 3.5.23): Exiting normally.
2018/08/23 16:19:32 kid1| Set Current Directory to /var/spool/squid
2018/08/23 16:19:32 kid1| Starting Squid Cache version 3.5.23 for x86_64-pc-linux-gnu...
2018/08/23 16:19:32 kid1| Service Name: squid
2018/08/23 16:19:32 kid1| Process ID 1209
2018/08/23 16:19:32 kid1| Process Roles: worker
2018/08/23 16:19:32 kid1| With 65535 file descriptors available
2018/08/23 16:19:32 kid1| Initializing IP Cache...
2018/08/23 16:19:32 kid1| DNS Socket created at [::], FD 6
2018/08/23 16:19:32 kid1| DNS Socket created at 0.0.0.0, FD 7
2018/08/23 16:19:32 kid1| Adding domain generium.corp from /etc/resolv.conf
2018/08/23 16:19:32 kid1| Adding nameserver 10.84.10.110 from /etc/resolv.conf
2018/08/23 16:19:32 kid1| Adding nameserver 10.83.10.120 from /etc/resolv.conf
2018/08/23 16:19:32 kid1| Logfile: opening log daemon:/var/log/squid/access.log
2018/08/23 16:19:32 kid1| Logfile Daemon: opening log /var/log/squid/access.log
2018/08/23 16:19:32 kid1| Local cache digest enabled; rebuild/rewrite every 3600/3600 sec
2018/08/23 16:19:32 kid1| Store logging disabled
2018/08/23 16:19:32 kid1| Swap maxSize 0 + 262144 KB, estimated 20164 objects
2018/08/23 16:19:32 kid1| Target number of buckets: 1008
2018/08/23 16:19:32 kid1| Using 8192 Store buckets
2018/08/23 16:19:32 kid1| Max Mem  size: 262144 KB
2018/08/23 16:19:32 kid1| Max Swap size: 0 KB
2018/08/23 16:19:32 kid1| Using Least Load store dir selection
2018/08/23 16:19:32 kid1| Set Current Directory to /var/spool/squid
2018/08/23 16:19:32 kid1| Finished loading MIME types and icons.
2018/08/23 16:19:32 kid1| HTCP Disabled.
2018/08/23 16:19:32 kid1| Pinger socket opened on FD 16
2018/08/23 16:19:32 kid1| Squid plugin modules loaded: 0
2018/08/23 16:19:32 kid1| Adaptation support is off.
2018/08/23 16:19:32 kid1| Accepting HTTP Socket connections at local=[::]:3130 remote=[::] FD 12 flags=9
2018/08/23 16:19:32 kid1| Accepting NAT intercepted HTTP Socket connections at local=[::]:3128 remote=[::] FD 13 flags=41
2018/08/23 16:19:32 kid1| Accepting NAT intercepted SSL bumped HTTPS Socket connections at local=[::]:3129 remote=[::] FD 14 flags=41
2018/08/23 16:19:32| pinger: Initialising ICMP pinger ...
2018/08/23 16:19:32| pinger: ICMP socket opened.
2018/08/23 16:19:32| pinger: ICMPv6 socket opened
2018/08/23 16:19:32| Pinger exiting.
2018/08/23 16:19:33 kid1| storeLateRelease: released 0 objects

Accesslog:

1535030545.214      0 10.84.77.52 TAG_NONE/503 382 GET https://habr.com/ - ORIGINAL_DST/178.248.237.68 text/html
1535030545.442    608 10.84.77.52 TAG_NONE/200 0 CONNECT 52.4.157.193:443 - ORIGINAL_DST/52.4.157.193 -
1535030545.442    617 10.84.77.52 TAG_NONE/200 0 CONNECT 52.204.140.44:443 - ORIGINAL_DST/52.204.140.44 -
1535030545.717    422 10.84.77.52 TAG_NONE/200 0 CONNECT 52.204.140.44:443 - ORIGINAL_DST/52.204.140.44 -
1535030545.879     36 10.84.77.52 TCP_MISS/204 415 POST https://www.google.ru/gen_204? - ORIGINAL_DST/64.233.162.94 text/html
1535030546.522     77 10.84.77.52 TAG_NONE/200 0 CONNECT 178.248.237.68:443 - ORIGINAL_DST/178.248.237.68 -
1535030546.623     95 10.84.77.52 TAG_NONE/200 0 CONNECT 178.248.237.68:443 - ORIGINAL_DST/178.248.237.68 -
1535030546.625      0 10.84.77.52 TAG_NONE/503 382 GET https://habr.com/ - ORIGINAL_DST/178.248.237.68 text/html

??????????? ? ??????????????????: ??? ??????????? ????????? ? ????? ?????????, ??????????? ? ????, ????? ????????? ???????????????? ??????????. ????????? ?????????? ??? ? ???, ??? ???? ??? ????????? ?? ????????????? ???, ?????????????, ??????????? ??? ??????????????? ??????????, ???????????? ? ????????? ?????????, ? ????? ????????????? ????? ???????? ?? ?????? ???? ?????????? ?????? ?????????. ???? ?? ???????? ??? ????????? ?? ??????, ??????????, ???????? ?? ???? ??????????? ?? ??????????? ????? ? ??????? ??? ?????????. Confidentiality notice: This e-mail transmission and any attachments included may contain confidential information. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or reliance upon the content of this e-mail is strictly prohibited. If you have received this e-mail transmission in error, please notify sender by e-mail and then delete this message from your inbox.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180823/e6c087d7/attachment.htm>

From erdosain9 at gmail.com  Thu Aug 23 13:33:23 2018
From: erdosain9 at gmail.com (erdosain9)
Date: Thu, 23 Aug 2018 08:33:23 -0500 (CDT)
Subject: [squid-users] Squid Reverse HTTPS Let's Encrypt
Message-ID: <1535031203659-0.post@n4.nabble.com>

Hi.
I have Squid configured as a proxy reverse.
The DNS are configured too. The clients can access from outside without
problem.
It is working well.

But I want to serve web pages with https and I would like to use Let's
Encrypt (or something similar) so clients do not have to accept an invalid
certificate.

I wanted to know if this is possible. 

Somebody can give me a hand??

this is my config so far:

---------------------------------------------------------------------------------------------------------------------------

http_port 192.168.1.21:80 accel defaultsite=soporte.mydomain.ar vhost

cache_peer 192.168.1.246 parent 80 0 no-query no-digest originserver
name=soporte
acl soporte_acl dstdomain soporte.mydomain.ar
http_access allow soporte_acl
cache_peer_access soporte allow soporte_acl

cache_peer 192.168.1.223 parent 80 0 no-query no-digest originserver 
name=phplists
acl phplists_acl dstdomain phplists.mydomain.ar
http_access allow phplists_acl
cache_peer_access phplists allow phplists_acl

cache_peer 192.168.1.107 parent 80 0 no-query no-digest originserver 
name=owncloud
acl owncloud_acl dstdomain owncloud.mydomain.ar
http_access allow owncloud_acl
cache_peer_access owncloud allow owncloud_acl

cache_peer 192.168.1.167 parent 443 0 no-query no-digest originserver
name=micro
acl micro_acl dstdomain microimporta.com.ar
http_access allow micro_acl
cache_peer_access micro allow micro_acl

--------------------------------------------------------------------------------------------------------

I read that i have to put squid earing in 443 like this with the certificate

https_port 443 cert=/path/to/cert.pem key=/path/to/private.key (here is
where i put the let's encrypt certificate?? this will work?)

The servers have to have configured let's encrypt?
Squid has to have configured let's encrypt?
Both have to have them configured?

(is the term "have to have" in English well used? :-)

Greetings and many thanks to all.



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From belle at bazuin.nl  Thu Aug 23 13:38:27 2018
From: belle at bazuin.nl (=?windows-1252?Q?L.P.H._van_Belle?=)
Date: Thu, 23 Aug 2018 15:38:27 +0200
Subject: [squid-users] Transparent squid configuration problem.
In-Reply-To: <61EF6F4DD37F1245B186602EACC06454BA556B28@MEX1.generium.corp>
References: <61EF6F4DD37F1245B186602EACC06454BA556B28@MEX1.generium.corp>
Message-ID: <vmime.5b7eb8d3.4f0e.2fb6dbc5e166283@ms249-lin-003.rotterdam.bazuin.nl>

i noticed the following :??? dig caa habr.com
;; ANSWER SECTION:
habr.com.?????????????? 3600??? IN????? CAA???? 0 iodef "mailto:iodef at habr.com"
habr.com.?????????????? 3600??? IN????? CAA???? 0 issue "comodoca.com"

So you cant bump this site, its protecting its certificates with a CAA/DANE?dns record. 
?
Greetz, 
?
Louis
?
?
?

Van: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] Namens ??????? ????????? ?????????????
Verzonden: donderdag 23 augustus 2018 15:22
Aan: squid-users at lists.squid-cache.org
Onderwerp: [squid-users] Transparent squid configuration problem.




Hi! I have some problems with configuration of squid.

?

What I need:

http/https transparent proxy server based on Debian Stretch with some blacklisted and whitelisted domains

?

I?ve used many tutorials and squid.wiki through installation process and it almost work! But I have the last problem.

?

When I tried to connect to some websites like a https://habr.com I have ?got HTTP ERROR 503. Ive tried to find solution at forums but no one helped me. I know the answer is simple and its here but cannt find it by myself.

?

Here is my squid.conf, cache.log, access.log and iptables script.

?

Please help! J

?

Squid.conf:

?

dns_v4_first on

?

acl network src 10.84.0.0/16

?

acl SSL_ports port 443

acl Safe_ports port 80??????? # http

acl Safe_ports port 21??????? # ftp

acl Safe_ports port 443??????? # https

acl Safe_ports port 70??????? # gopher

acl Safe_ports port 210??????? # wais

acl Safe_ports port 1025-65535??? # unregistered ports

acl Safe_ports port 280??????? # http-mgmt

acl Safe_ports port 488??????? # gss-http

acl Safe_ports port 591??????? # filemaker

acl Safe_ports port 777??????? # multiling http

acl blacklist dstdomain "/etc/squid/acls/social_networks.txt" # list of blocked websites here

acl CONNECT method CONNECT

?

http_access deny blacklist

http_access deny !Safe_ports

http_access deny CONNECT !SSL_ports

?

http_access allow all

?

http_port 3130

?

http_port 3128 intercept

https_port 3129 intercept ssl-bump cert=/etc/squid/ssl_cert/vproxy2.pem key=/etc/squid/ssl_cert/vproxy2.pem

?

#always_direct allow all

ssl_bump server-first all

#sslproxy_cert_error deny all

#sslproxy_flags DONT_VERIFY_PEER

?

sslcrtd_program /usr/lib/squid/ssl_crtd -s /var/lib/ssl_db -M 4MB

sslcrtd_children 8 startup=1 idle=1

?

coredump_dir /var/spool/squid

?

# Add any of your own refresh_pattern entries above these.

refresh_pattern ^ftp:??????? 1440??? 20%??? 10080

refresh_pattern ^gopher:??? 1440??? 0%??? 1440

refresh_pattern -i (/cgi-bin/|\?) 0??? 0%??? 0

refresh_pattern .??????? 0??? 20%??? 4320

?

shutdown_lifetime 1 second

?

cache.log:

?

Maximum Resident Size: 123312 KB

Page faults with physical i/o: 7

2018/08/23 16:19:27 kid1| Logfile: closing log daemon:/var/log/squid/access.log

2018/08/23 16:19:27 kid1| Logfile Daemon: closing log daemon:/var/log/squid/access.log

2018/08/23 16:19:27 kid1| Open FD UNSTARTED???? 6 DNS Socket IPv6

2018/08/23 16:19:27 kid1| Open FD READ/WRITE??? 7 DNS Socket IPv4

2018/08/23 16:19:27 kid1| Open FD UNSTARTED??? 10 IPC UNIX STREAM Parent

2018/08/23 16:19:27 kid1| Squid Cache (Version 3.5.23): Exiting normally.

2018/08/23 16:19:32 kid1| Set Current Directory to /var/spool/squid

2018/08/23 16:19:32 kid1| Starting Squid Cache version 3.5.23 for x86_64-pc-linux-gnu...

2018/08/23 16:19:32 kid1| Service Name: squid

2018/08/23 16:19:32 kid1| Process ID 1209

2018/08/23 16:19:32 kid1| Process Roles: worker

2018/08/23 16:19:32 kid1| With 65535 file descriptors available

2018/08/23 16:19:32 kid1| Initializing IP Cache...

2018/08/23 16:19:32 kid1| DNS Socket created at [::], FD 6

2018/08/23 16:19:32 kid1| DNS Socket created at 0.0.0.0, FD 7

2018/08/23 16:19:32 kid1| Adding domain generium.corp from /etc/resolv.conf

2018/08/23 16:19:32 kid1| Adding nameserver 10.84.10.110 from /etc/resolv.conf

2018/08/23 16:19:32 kid1| Adding nameserver 10.83.10.120 from /etc/resolv.conf

2018/08/23 16:19:32 kid1| Logfile: opening log daemon:/var/log/squid/access.log

2018/08/23 16:19:32 kid1| Logfile Daemon: opening log /var/log/squid/access.log

2018/08/23 16:19:32 kid1| Local cache digest enabled; rebuild/rewrite every 3600/3600 sec

2018/08/23 16:19:32 kid1| Store logging disabled

2018/08/23 16:19:32 kid1| Swap maxSize 0 + 262144 KB, estimated 20164 objects

2018/08/23 16:19:32 kid1| Target number of buckets: 1008

2018/08/23 16:19:32 kid1| Using 8192 Store buckets

2018/08/23 16:19:32 kid1| Max Mem? size: 262144 KB

2018/08/23 16:19:32 kid1| Max Swap size: 0 KB

2018/08/23 16:19:32 kid1| Using Least Load store dir selection

2018/08/23 16:19:32 kid1| Set Current Directory to /var/spool/squid

2018/08/23 16:19:32 kid1| Finished loading MIME types and icons.

2018/08/23 16:19:32 kid1| HTCP Disabled.

2018/08/23 16:19:32 kid1| Pinger socket opened on FD 16

2018/08/23 16:19:32 kid1| Squid plugin modules loaded: 0

2018/08/23 16:19:32 kid1| Adaptation support is off.

2018/08/23 16:19:32 kid1| Accepting HTTP Socket connections at local=[::]:3130 remote=[::] FD 12 flags=9

2018/08/23 16:19:32 kid1| Accepting NAT intercepted HTTP Socket connections at local=[::]:3128 remote=[::] FD 13 flags=41

2018/08/23 16:19:32 kid1| Accepting NAT intercepted SSL bumped HTTPS Socket connections at local=[::]:3129 remote=[::] FD 14 flags=41

2018/08/23 16:19:32| pinger: Initialising ICMP pinger ...

2018/08/23 16:19:32| pinger: ICMP socket opened.

2018/08/23 16:19:32| pinger: ICMPv6 socket opened

2018/08/23 16:19:32| Pinger exiting.

2018/08/23 16:19:33 kid1| storeLateRelease: released 0 objects

?

Accesslog:

?

1535030545.214????? 0 10.84.77.52 TAG_NONE/503 382 GET https://habr.com/ - ORIGINAL_DST/178.248.237.68 text/html

1535030545.442??? 608 10.84.77.52 TAG_NONE/200 0 CONNECT 52.4.157.193:443 - ORIGINAL_DST/52.4.157.193 -

1535030545.442??? 617 10.84.77.52 TAG_NONE/200 0 CONNECT 52.204.140.44:443 - ORIGINAL_DST/52.204.140.44 -

1535030545.717??? 422 10.84.77.52 TAG_NONE/200 0 CONNECT 52.204.140.44:443 - ORIGINAL_DST/52.204.140.44 -

1535030545.879???? 36 10.84.77.52 TCP_MISS/204 415 POST https://www.google.ru/gen_204? - ORIGINAL_DST/64.233.162.94 text/html

1535030546.522???? 77 10.84.77.52 TAG_NONE/200 0 CONNECT 178.248.237.68:443 - ORIGINAL_DST/178.248.237.68 -

1535030546.623???? 95 10.84.77.52 TAG_NONE/200 0 CONNECT 178.248.237.68:443 - ORIGINAL_DST/178.248.237.68 -

1535030546.625????? 0 10.84.77.52 TAG_NONE/503 382 GET https://habr.com/ - ORIGINAL_DST/178.248.237.68 text/html

?

??????????? ? ??????????????????: ??? ??????????? ????????? ? ????? ?????????, ??????????? ? ????, ????? ????????? ???????????????? ??????????. ????????? ?????????? ??? ? ???, ??? ???? ??? ????????? ?? ????????????? ???, ?????????????, ??????????? ??? ??????????????? ??????????, ???????????? ? ????????? ?????????, ? ????? ????????????? ????? ???????? ?? ?????? ???? ?????????? ?????? ?????????. ???? ?? ???????? ??? ????????? ?? ??????, ??????????, ???????? ?? ???? ??????????? ?? ??????????? ????? ? ??????? ??? ?????????. Confidentiality notice: This e-mail transmission and any attachments included may contain confidential information. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or reliance upon the content of this e-mail is strictly prohibited. If you have received this e-mail transmission in error, please notify sender by e-mail and then delete this message from your inbox. 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180823/a3ddc6a7/attachment.htm>

From a.zubarev at generium.ru  Thu Aug 23 13:41:40 2018
From: a.zubarev at generium.ru (=?koi8-r?B?+tXCwdLF1yDhzMXL08HOxNIg4czFy9PBzsTSz9fJ3g==?=)
Date: Thu, 23 Aug 2018 13:41:40 +0000
Subject: [squid-users] Transparent squid configuration problem.
In-Reply-To: <vmime.5b7eb8d3.4f0e.2fb6dbc5e166283@ms249-lin-003.rotterdam.bazuin.nl>
References: <61EF6F4DD37F1245B186602EACC06454BA556B28@MEX1.generium.corp>
 <vmime.5b7eb8d3.4f0e.2fb6dbc5e166283@ms249-lin-003.rotterdam.bazuin.nl>
Message-ID: <61EF6F4DD37F1245B186602EACC06454BA556BBC@MEX1.generium.corp>

Thank you, Louis!
Is there some workaround? May be I can to put that's kind of sites without filtering?

From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of L.P.H. van Belle
Sent: Thursday, August 23, 2018 4:38 PM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Transparent squid configuration problem.

i noticed the following :    dig caa habr.com
;; ANSWER SECTION:
habr.com.               3600    IN      CAA     0 iodef "mailto:iodef at habr.com"
habr.com.               3600    IN      CAA     0 issue "comodoca.com"
So you cant bump this site, its protecting its certificates with a CAA/DANE dns record.

Greetz,

Louis




________________________________
Van: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] Namens ??????? ????????? ?????????????
Verzonden: donderdag 23 augustus 2018 15:22
Aan: squid-users at lists.squid-cache.org<mailto:squid-users at lists.squid-cache.org>
Onderwerp: [squid-users] Transparent squid configuration problem.
Hi! I have some problems with configuration of squid.

What I need:
http/https transparent proxy server based on Debian Stretch with some blacklisted and whitelisted domains

I've used many tutorials and squid.wiki through installation process and it almost work! But I have the last problem.

When I tried to connect to some websites like a https://habr.com I have  got HTTP ERROR 503. Ive tried to find solution at forums but no one helped me. I know the answer is simple and its here but cannt find it by myself.

Here is my squid.conf, cache.log, access.log and iptables script.

Please help! :)

Squid.conf:

dns_v4_first on

acl network src 10.84.0.0/16

acl SSL_ports port 443
acl Safe_ports port 80        # http
acl Safe_ports port 21        # ftp
acl Safe_ports port 443        # https
acl Safe_ports port 70        # gopher
acl Safe_ports port 210        # wais
acl Safe_ports port 1025-65535    # unregistered ports
acl Safe_ports port 280        # http-mgmt
acl Safe_ports port 488        # gss-http
acl Safe_ports port 591        # filemaker
acl Safe_ports port 777        # multiling http
acl blacklist dstdomain "/etc/squid/acls/social_networks.txt" # list of blocked websites here
acl CONNECT method CONNECT

http_access deny blacklist
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports

http_access allow all

http_port 3130

http_port 3128 intercept
https_port 3129 intercept ssl-bump cert=/etc/squid/ssl_cert/vproxy2.pem key=/etc/squid/ssl_cert/vproxy2.pem

#always_direct allow all
ssl_bump server-first all
#sslproxy_cert_error deny all
#sslproxy_flags DONT_VERIFY_PEER

sslcrtd_program /usr/lib/squid/ssl_crtd -s /var/lib/ssl_db -M 4MB
sslcrtd_children 8 startup=1 idle=1

coredump_dir /var/spool/squid

# Add any of your own refresh_pattern entries above these.
refresh_pattern ^ftp:        1440    20%    10080
refresh_pattern ^gopher:    1440    0%    1440
refresh_pattern -i (/cgi-bin/|\?) 0    0%    0
refresh_pattern .        0    20%    4320

shutdown_lifetime 1 second

cache.log:

Maximum Resident Size: 123312 KB
Page faults with physical i/o: 7
2018/08/23 16:19:27 kid1| Logfile: closing log daemon:/var/log/squid/access.log
2018/08/23 16:19:27 kid1| Logfile Daemon: closing log daemon:/var/log/squid/access.log
2018/08/23 16:19:27 kid1| Open FD UNSTARTED     6 DNS Socket IPv6
2018/08/23 16:19:27 kid1| Open FD READ/WRITE    7 DNS Socket IPv4
2018/08/23 16:19:27 kid1| Open FD UNSTARTED    10 IPC UNIX STREAM Parent
2018/08/23 16:19:27 kid1| Squid Cache (Version 3.5.23): Exiting normally.
2018/08/23 16:19:32 kid1| Set Current Directory to /var/spool/squid
2018/08/23 16:19:32 kid1| Starting Squid Cache version 3.5.23 for x86_64-pc-linux-gnu...
2018/08/23 16:19:32 kid1| Service Name: squid
2018/08/23 16:19:32 kid1| Process ID 1209
2018/08/23 16:19:32 kid1| Process Roles: worker
2018/08/23 16:19:32 kid1| With 65535 file descriptors available
2018/08/23 16:19:32 kid1| Initializing IP Cache...
2018/08/23 16:19:32 kid1| DNS Socket created at [::], FD 6
2018/08/23 16:19:32 kid1| DNS Socket created at 0.0.0.0, FD 7
2018/08/23 16:19:32 kid1| Adding domain generium.corp from /etc/resolv.conf
2018/08/23 16:19:32 kid1| Adding nameserver 10.84.10.110 from /etc/resolv.conf
2018/08/23 16:19:32 kid1| Adding nameserver 10.83.10.120 from /etc/resolv.conf
2018/08/23 16:19:32 kid1| Logfile: opening log daemon:/var/log/squid/access.log
2018/08/23 16:19:32 kid1| Logfile Daemon: opening log /var/log/squid/access.log
2018/08/23 16:19:32 kid1| Local cache digest enabled; rebuild/rewrite every 3600/3600 sec
2018/08/23 16:19:32 kid1| Store logging disabled
2018/08/23 16:19:32 kid1| Swap maxSize 0 + 262144 KB, estimated 20164 objects
2018/08/23 16:19:32 kid1| Target number of buckets: 1008
2018/08/23 16:19:32 kid1| Using 8192 Store buckets
2018/08/23 16:19:32 kid1| Max Mem  size: 262144 KB
2018/08/23 16:19:32 kid1| Max Swap size: 0 KB
2018/08/23 16:19:32 kid1| Using Least Load store dir selection
2018/08/23 16:19:32 kid1| Set Current Directory to /var/spool/squid
2018/08/23 16:19:32 kid1| Finished loading MIME types and icons.
2018/08/23 16:19:32 kid1| HTCP Disabled.
2018/08/23 16:19:32 kid1| Pinger socket opened on FD 16
2018/08/23 16:19:32 kid1| Squid plugin modules loaded: 0
2018/08/23 16:19:32 kid1| Adaptation support is off.
2018/08/23 16:19:32 kid1| Accepting HTTP Socket connections at local=[::]:3130 remote=[::] FD 12 flags=9
2018/08/23 16:19:32 kid1| Accepting NAT intercepted HTTP Socket connections at local=[::]:3128 remote=[::] FD 13 flags=41
2018/08/23 16:19:32 kid1| Accepting NAT intercepted SSL bumped HTTPS Socket connections at local=[::]:3129 remote=[::] FD 14 flags=41
2018/08/23 16:19:32| pinger: Initialising ICMP pinger ...
2018/08/23 16:19:32| pinger: ICMP socket opened.
2018/08/23 16:19:32| pinger: ICMPv6 socket opened
2018/08/23 16:19:32| Pinger exiting.
2018/08/23 16:19:33 kid1| storeLateRelease: released 0 objects

Accesslog:

1535030545.214      0 10.84.77.52 TAG_NONE/503 382 GET https://habr.com/ - ORIGINAL_DST/178.248.237.68 text/html
1535030545.442    608 10.84.77.52 TAG_NONE/200 0 CONNECT 52.4.157.193:443 - ORIGINAL_DST/52.4.157.193 -
1535030545.442    617 10.84.77.52 TAG_NONE/200 0 CONNECT 52.204.140.44:443 - ORIGINAL_DST/52.204.140.44 -
1535030545.717    422 10.84.77.52 TAG_NONE/200 0 CONNECT 52.204.140.44:443 - ORIGINAL_DST/52.204.140.44 -
1535030545.879     36 10.84.77.52 TCP_MISS/204 415 POST https://www.google.ru/gen_204? - ORIGINAL_DST/64.233.162.94 text/html
1535030546.522     77 10.84.77.52 TAG_NONE/200 0 CONNECT 178.248.237.68:443 - ORIGINAL_DST/178.248.237.68 -
1535030546.623     95 10.84.77.52 TAG_NONE/200 0 CONNECT 178.248.237.68:443 - ORIGINAL_DST/178.248.237.68 -
1535030546.625      0 10.84.77.52 TAG_NONE/503 382 GET https://habr.com/ - ORIGINAL_DST/178.248.237.68 text/html

??????????? ? ??????????????????: ??? ??????????? ????????? ? ????? ?????????, ??????????? ? ????, ????? ????????? ???????????????? ??????????. ????????? ?????????? ??? ? ???, ??? ???? ??? ????????? ?? ????????????? ???, ?????????????, ??????????? ??? ??????????????? ??????????, ???????????? ? ????????? ?????????, ? ????? ????????????? ????? ???????? ?? ?????? ???? ?????????? ?????? ?????????. ???? ?? ???????? ??? ????????? ?? ??????, ??????????, ???????? ?? ???? ??????????? ?? ??????????? ????? ? ??????? ??? ?????????. Confidentiality notice: This e-mail transmission and any attachments included may contain confidential information. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or reliance upon the content of this e-mail is strictly prohibited. If you have received this e-mail transmission in error, please notify sender by e-mail and then delete this message from your inbox.
??????????? ? ??????????????????: ??? ??????????? ????????? ? ????? ?????????, ??????????? ? ????, ????? ????????? ???????????????? ??????????. ????????? ?????????? ??? ? ???, ??? ???? ??? ????????? ?? ????????????? ???, ?????????????, ??????????? ??? ??????????????? ??????????, ???????????? ? ????????? ?????????, ? ????? ????????????? ????? ???????? ?? ?????? ???? ?????????? ?????? ?????????. ???? ?? ???????? ??? ????????? ?? ??????, ??????????, ???????? ?? ???? ??????????? ?? ??????????? ????? ? ??????? ??? ?????????. Confidentiality notice: This e-mail transmission and any attachments included may contain confidential information. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or reliance upon the content of this e-mail is strictly prohibited. If you have received this e-mail transmission in error, please notify sender by e-mail and then delete this message from your inbox.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180823/ba02c230/attachment.htm>

From belle at bazuin.nl  Thu Aug 23 14:21:39 2018
From: belle at bazuin.nl (=?windows-1252?Q?L.P.H._van_Belle?=)
Date: Thu, 23 Aug 2018 16:21:39 +0200
Subject: [squid-users] Transparent squid configuration problem.
In-Reply-To: <61EF6F4DD37F1245B186602EACC06454BA556BBC@MEX1.generium.corp>
References: <vmime.5b7eb8d3.4f0e.2fb6dbc5e166283@ms249-lin-003.rotterdam.bazuin.nl>
Message-ID: <vmime.5b7ec2f3.7527.160262a5769a3ea3@ms249-lin-003.rotterdam.bazuin.nl>

If i may suggest.. 
?
Use the squid version from debian sid. 
Rebuilding these to stretch isnt that hard. 
?
add? the sid sources, run : apt-get update
apt-get build-dep squid
apt-get source squid -b 
then create a file repo ( or http repo ) and install squid. 

or, if you dont want to rebuild them. you can get them here. 
http://downloads.van-belle.nl/squid/?
A squid 4.1 and 4.2 are available for Stretch im using now the 4.2 version. 
?
If thats no option then have a look at https://wiki.squid-cache.org/Features/SslPeekAndSplice? 
See the configuration example, that a good example.? 
Change "bank" in habr.com?? ;-)? 
?
?
Greetz, 
?
Louis
?
Van: ??????? ????????? ????????????? [mailto:a.zubarev at generium.ru] 
Verzonden: donderdag 23 augustus 2018 15:42
Aan: L.P.H. van Belle; squid-users at lists.squid-cache.org
Onderwerp: RE: [squid-users] Transparent squid configuration problem.




Thank you, Louis! 

Is there some workaround? May be I can to put that?s kind of sites without filtering?



From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of L.P.H. van Belle
Sent: Thursday, August 23, 2018 4:38 PM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Transparent squid configuration problem.





i noticed the following :??? dig caa habr.com
;; ANSWER SECTION:
habr.com.?????????????? 3600??? IN????? CAA???? 0 iodef "mailto:iodef at habr.com"
habr.com.?????????????? 3600??? IN????? CAA???? 0 issue "comodoca.com"


So you cant bump this site, its protecting its certificates with a CAA/DANE?dns record. 



Greetz, 



Louis










Van: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] Namens ??????? ????????? ?????????????
Verzonden: donderdag 23 augustus 2018 15:22
Aan: squid-users at lists.squid-cache.org
Onderwerp: [squid-users] Transparent squid configuration problem.

Hi! I have some problems with configuration of squid.



What I need:

http/https transparent proxy server based on Debian Stretch with some blacklisted and whitelisted domains



I?ve used many tutorials and squid.wiki through installation process and it almost work! But I have the last problem.



When I tried to connect to some websites like a https://habr.com I have ?got HTTP ERROR 503. Ive tried to find solution at forums but no one helped me. I know the answer is simple and its here but cannt find it by myself.



Here is my squid.conf, cache.log, access.log and iptables script.



Please help! J



Squid.conf:



dns_v4_first on



acl network src 10.84.0.0/16



acl SSL_ports port 443

acl Safe_ports port 80??????? # http

acl Safe_ports port 21??????? # ftp

acl Safe_ports port 443??????? # https

acl Safe_ports port 70??????? # gopher

acl Safe_ports port 210??????? # wais

acl Safe_ports port 1025-65535??? # unregistered ports

acl Safe_ports port 280??????? # http-mgmt

acl Safe_ports port 488??????? # gss-http

acl Safe_ports port 591??????? # filemaker

acl Safe_ports port 777??????? # multiling http

acl blacklist dstdomain "/etc/squid/acls/social_networks.txt" # list of blocked websites here

acl CONNECT method CONNECT



http_access deny blacklist

http_access deny !Safe_ports

http_access deny CONNECT !SSL_ports



http_access allow all



http_port 3130



http_port 3128 intercept

https_port 3129 intercept ssl-bump cert=/etc/squid/ssl_cert/vproxy2.pem key=/etc/squid/ssl_cert/vproxy2.pem



#always_direct allow all

ssl_bump server-first all

#sslproxy_cert_error deny all

#sslproxy_flags DONT_VERIFY_PEER



sslcrtd_program /usr/lib/squid/ssl_crtd -s /var/lib/ssl_db -M 4MB

sslcrtd_children 8 startup=1 idle=1



coredump_dir /var/spool/squid



# Add any of your own refresh_pattern entries above these.

refresh_pattern ^ftp:??????? 1440??? 20%??? 10080

refresh_pattern ^gopher:??? 1440??? 0%??? 1440

refresh_pattern -i (/cgi-bin/|\?) 0??? 0%??? 0

refresh_pattern .??????? 0??? 20%??? 4320



shutdown_lifetime 1 second



cache.log:



Maximum Resident Size: 123312 KB

Page faults with physical i/o: 7

2018/08/23 16:19:27 kid1| Logfile: closing log daemon:/var/log/squid/access.log

2018/08/23 16:19:27 kid1| Logfile Daemon: closing log daemon:/var/log/squid/access.log

2018/08/23 16:19:27 kid1| Open FD UNSTARTED???? 6 DNS Socket IPv6

2018/08/23 16:19:27 kid1| Open FD READ/WRITE??? 7 DNS Socket IPv4

2018/08/23 16:19:27 kid1| Open FD UNSTARTED??? 10 IPC UNIX STREAM Parent

2018/08/23 16:19:27 kid1| Squid Cache (Version 3.5.23): Exiting normally.

2018/08/23 16:19:32 kid1| Set Current Directory to /var/spool/squid

2018/08/23 16:19:32 kid1| Starting Squid Cache version 3.5.23 for x86_64-pc-linux-gnu...

2018/08/23 16:19:32 kid1| Service Name: squid

2018/08/23 16:19:32 kid1| Process ID 1209

2018/08/23 16:19:32 kid1| Process Roles: worker

2018/08/23 16:19:32 kid1| With 65535 file descriptors available

2018/08/23 16:19:32 kid1| Initializing IP Cache...

2018/08/23 16:19:32 kid1| DNS Socket created at [::], FD 6

2018/08/23 16:19:32 kid1| DNS Socket created at 0.0.0.0, FD 7

2018/08/23 16:19:32 kid1| Adding domain generium.corp from /etc/resolv.conf

2018/08/23 16:19:32 kid1| Adding nameserver 10.84.10.110 from /etc/resolv.conf

2018/08/23 16:19:32 kid1| Adding nameserver 10.83.10.120 from /etc/resolv.conf

2018/08/23 16:19:32 kid1| Logfile: opening log daemon:/var/log/squid/access.log

2018/08/23 16:19:32 kid1| Logfile Daemon: opening log /var/log/squid/access.log

2018/08/23 16:19:32 kid1| Local cache digest enabled; rebuild/rewrite every 3600/3600 sec

2018/08/23 16:19:32 kid1| Store logging disabled

2018/08/23 16:19:32 kid1| Swap maxSize 0 + 262144 KB, estimated 20164 objects

2018/08/23 16:19:32 kid1| Target number of buckets: 1008

2018/08/23 16:19:32 kid1| Using 8192 Store buckets

2018/08/23 16:19:32 kid1| Max Mem? size: 262144 KB

2018/08/23 16:19:32 kid1| Max Swap size: 0 KB

2018/08/23 16:19:32 kid1| Using Least Load store dir selection

2018/08/23 16:19:32 kid1| Set Current Directory to /var/spool/squid

2018/08/23 16:19:32 kid1| Finished loading MIME types and icons.

2018/08/23 16:19:32 kid1| HTCP Disabled.

2018/08/23 16:19:32 kid1| Pinger socket opened on FD 16

2018/08/23 16:19:32 kid1| Squid plugin modules loaded: 0

2018/08/23 16:19:32 kid1| Adaptation support is off.

2018/08/23 16:19:32 kid1| Accepting HTTP Socket connections at local=[::]:3130 remote=[::] FD 12 flags=9

2018/08/23 16:19:32 kid1| Accepting NAT intercepted HTTP Socket connections at local=[::]:3128 remote=[::] FD 13 flags=41

2018/08/23 16:19:32 kid1| Accepting NAT intercepted SSL bumped HTTPS Socket connections at local=[::]:3129 remote=[::] FD 14 flags=41

2018/08/23 16:19:32| pinger: Initialising ICMP pinger ...

2018/08/23 16:19:32| pinger: ICMP socket opened.

2018/08/23 16:19:32| pinger: ICMPv6 socket opened

2018/08/23 16:19:32| Pinger exiting.

2018/08/23 16:19:33 kid1| storeLateRelease: released 0 objects



Accesslog:



1535030545.214????? 0 10.84.77.52 TAG_NONE/503 382 GET https://habr.com/ - ORIGINAL_DST/178.248.237.68 text/html

1535030545.442??? 608 10.84.77.52 TAG_NONE/200 0 CONNECT 52.4.157.193:443 - ORIGINAL_DST/52.4.157.193 -

1535030545.442??? 617 10.84.77.52 TAG_NONE/200 0 CONNECT 52.204.140.44:443 - ORIGINAL_DST/52.204.140.44 -

1535030545.717??? 422 10.84.77.52 TAG_NONE/200 0 CONNECT 52.204.140.44:443 - ORIGINAL_DST/52.204.140.44 -

1535030545.879???? 36 10.84.77.52 TCP_MISS/204 415 POST https://www.google.ru/gen_204? - ORIGINAL_DST/64.233.162.94 text/html

1535030546.522???? 77 10.84.77.52 TAG_NONE/200 0 CONNECT 178.248.237.68:443 - ORIGINAL_DST/178.248.237.68 -

1535030546.623???? 95 10.84.77.52 TAG_NONE/200 0 CONNECT 178.248.237.68:443 - ORIGINAL_DST/178.248.237.68 -

1535030546.625????? 0 10.84.77.52 TAG_NONE/503 382 GET https://habr.com/ - ORIGINAL_DST/178.248.237.68 text/html



??????????? ? ??????????????????: ??? ??????????? ????????? ? ????? ?????????, ??????????? ? ????, ????? ????????? ???????????????? ??????????. ????????? ?????????? ??? ? ???, ??? ???? ??? ????????? ?? ????????????? ???, ?????????????, ??????????? ??? ??????????????? ??????????, ???????????? ? ????????? ?????????, ? ????? ????????????? ????? ???????? ?? ?????? ???? ?????????? ?????? ?????????. ???? ?? ???????? ??? ????????? ?? ??????, ??????????, ???????? ?? ???? ??????????? ?? ??????????? ????? ? ??????? ??? ?????????. Confidentiality notice: This e-mail transmission and any attachments included may contain confidential information. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or reliance upon the content of this e-mail is strictly prohibited. If you have received this e-mail transmission in error, please notify sender by e-mail and then delete this message from your inbox. 

??????????? ? ??????????????????: ??? ??????????? ????????? ? ????? ?????????, ??????????? ? ????, ????? ????????? ???????????????? ??????????. ????????? ?????????? ??? ? ???, ??? ???? ??? ????????? ?? ????????????? ???, ?????????????, ??????????? ??? ??????????????? ??????????, ???????????? ? ????????? ?????????, ? ????? ????????????? ????? ???????? ?? ?????? ???? ?????????? ?????? ?????????. ???? ?? ???????? ??? ????????? ?? ??????, ??????????, ???????? ?? ???? ??????????? ?? ??????????? ????? ? ??????? ??? ?????????. Confidentiality notice: This e-mail transmission and any attachments included may contain confidential information. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or reliance upon the content of this e-mail is strictly prohibited. If you have received this e-mail transmission in error, please notify sender by e-mail and then delete this message from your inbox. 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180823/d8c0466e/attachment.htm>

From rousskov at measurement-factory.com  Thu Aug 23 14:22:26 2018
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Thu, 23 Aug 2018 08:22:26 -0600
Subject: [squid-users] Squid Reverse HTTPS Let's Encrypt
In-Reply-To: <1535031203659-0.post@n4.nabble.com>
References: <1535031203659-0.post@n4.nabble.com>
Message-ID: <e6022745-c502-d878-447f-c93bba19c80f@measurement-factory.com>

On 08/23/2018 07:33 AM, erdosain9 wrote:

> I have Squid configured as a proxy reverse.
> The DNS are configured too. The clients can access from outside without
> problem.
> It is working well.


> But I want to serve web pages with https and I would like to use Let's
> Encrypt (or something similar) so clients do not have to accept an invalid
> certificate.
> 
> I wanted to know if this is possible. 

It is. You can use any well-known CA, including Let's Encrypt, to obtain
a well-trusted certificate for your reverse proxy.


> The servers have to have configured let's encrypt?

The machine running Squid needs to be configured to use Let's Encrypt.
It usually boils down to installing Let's Encrypt automation
scripts/agents for generating/renewing certificates.

The origin servers behind your reverse proxy do not have to use
encryption and, if they use it, do not have to be configured to use
Let's Encrypt. It is your choice whether to encrypt Squid-origin
communication at all and, if yes, whether to use Let's Encrypt for that
encryption.


> Squid has to have configured let's encrypt?

Squid https_port can be configured with the Let's Encrypt-provided
certificate and private key, but Squid itself does not know where that
certificate and key came from. This is similar to, say, Apache httpd
configuration -- Apache does not know anything about Let's Encrypt, but
Let's Encrypt-generated certificates can be integrated with Apache httpd
configuration.


When you figure all the details out, consider publishing them on Squid
wiki for others to reuse.


HTH,

Alex.


From rodrigo.root.rj at gmail.com  Thu Aug 23 18:33:04 2018
From: rodrigo.root.rj at gmail.com (Rodrigo Cunha)
Date: Thu, 23 Aug 2018 15:33:04 -0300
Subject: [squid-users] Error_directory to https not work
In-Reply-To: <e32c23df-9328-a622-e563-9005e2839f20@treenet.co.nz>
References: <CAOGexv9Yxuyr8dL+avaMdy0Cg=24ovf30yBRkW2c78LnGb+ZKg@mail.gmail.com>
 <e32c23df-9328-a622-e563-9005e2839f20@treenet.co.nz>
Message-ID: <CAOGexv-K4X4OQt0Ztixgv=nLS=Bo9aNK3HFQMw2vmxboAQhmnQ@mail.gmail.com>

Tks Amos, i don't will use this feature. If that problem is a commom error,
i dont care.
Tks.

Em qui, 23 de ago de 2018 ?s 01:37, Amos Jeffries <squid3 at treenet.co.nz>
escreveu:

> On 23/08/18 11:13 AM, Rodrigo Cunha wrote:
> > Dears,
> > My squid_http work fine and deny request to https too. But when i
> > request https(secure port 443) links deny in file (black_list) my squid
> > not report error_directory files, when i send request to http(insecure
> > port 80) domain the squid report with error_directory.
> >
> > What a happen with my squid?Follow my squid.conf.
> >
>
> Nothing particular happened.
>
> HTTPS is sent differently through proxies. Using CONNECT requests with
> encrypted content. More details on that can be found at
> <https://wiki.squid-cache.org/Features/HTTPS>.
>
> Browsers in particular refuse to display error messages sent in response
> to CONNECT requests. I think you will find the Squid does send the error
> page but the Browser is refusing to display it.
>
>
> The only thing you can do about this sad situation is use SSL-Bump
> feature on the encrypted traffic so Squid can send the error message
> within an encrypted response - which the Browser does display *if* it
> trusts the proxy TLS certificate used by SSL-Bump.
>
> Please be aware:
>   SSL-Bump feature is sometimes forbidden or restricted-use by law. So
> please get proper legal advice before using it. Anyone helping you setup
> the feature will be assuming that you have done that due diligence check.
>
>
> HTH
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>


-- 
Atenciosamente,
Rodrigo da Silva Cunha
S?o Gon?alo, RJ - Brasil
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180823/a085b6fc/attachment.htm>

From rodrigo.root.rj at gmail.com  Thu Aug 23 18:40:49 2018
From: rodrigo.root.rj at gmail.com (Rodrigo Cunha)
Date: Thu, 23 Aug 2018 15:40:49 -0300
Subject: [squid-users] Transparent squid configuration problem.
In-Reply-To: <61EF6F4DD37F1245B186602EACC06454BA556BBC@MEX1.generium.corp>
References: <61EF6F4DD37F1245B186602EACC06454BA556B28@MEX1.generium.corp>
 <vmime.5b7eb8d3.4f0e.2fb6dbc5e166283@ms249-lin-003.rotterdam.bazuin.nl>
 <61EF6F4DD37F1245B186602EACC06454BA556BBC@MEX1.generium.corp>
Message-ID: <CAOGexv8tTpno6k_FcZu4u83cM6odgJKd-ZU-aRUKK8j8pjaCAg@mail.gmail.com>

Squid not work with transparent proxy in https, that request is processed
directily in your browser for security pollices.Setup your browser with
proxy and test, transparent for https not work.Only requests to http
websites.

If a server process requests https betwen client and server, that server is
a "man in the meadle",that  is problem of security for customers in your
network.

Em qui, 23 de ago de 2018 ?s 10:42, ??????? ????????? ????????????? <
a.zubarev at generium.ru> escreveu:

> Thank you, Louis!
>
> Is there some workaround? May be I can to put that?s kind of sites without
> filtering?
>
>
>
> *From:* squid-users <squid-users-bounces at lists.squid-cache.org> *On
> Behalf Of *L.P.H. van Belle
> *Sent:* Thursday, August 23, 2018 4:38 PM
> *To:* squid-users at lists.squid-cache.org
> *Subject:* Re: [squid-users] Transparent squid configuration problem.
>
>
>
> i noticed the following :    dig caa habr.com
> ;; ANSWER SECTION:
> habr.com.               3600    IN      CAA     0 iodef "
> mailto:iodef at habr.com <iodef at habr.com>"
> habr.com.               3600    IN      CAA     0 issue "comodoca.com"
>
> So you cant bump this site, its protecting its certificates with a
> CAA/DANE dns record.
>
>
>
> Greetz,
>
>
>
> Louis
>
>
>
>
>
>
>
>
>
> ------------------------------
>
> *Van:* squid-users [mailto:squid-users-bounces at lists.squid-cache.org
> <squid-users-bounces at lists.squid-cache.org>] *Namens *??????? ?????????
> ?????????????
> *Verzonden:* donderdag 23 augustus 2018 15:22
> *Aan:* squid-users at lists.squid-cache.org
> *Onderwerp:* [squid-users] Transparent squid configuration problem.
>
> Hi! I have some problems with configuration of squid.
>
>
>
> What I need:
>
> http/https transparent proxy server based on Debian Stretch with some
> blacklisted and whitelisted domains
>
>
>
> I?ve used many tutorials and squid.wiki through installation process and
> it almost work! But I have the last problem.
>
>
>
> When I tried to connect to some websites like a https://habr.com I have
>  got HTTP ERROR 503. Ive tried to find solution at forums but no one helped
> me. I know the answer is simple and its here but cannt find it by myself.
>
>
>
> Here is my squid.conf, cache.log, access.log and iptables script.
>
>
>
> Please help! J
>
>
>
> Squid.conf:
>
>
>
> dns_v4_first on
>
>
>
> acl network src 10.84.0.0/16
>
>
>
> acl SSL_ports port 443
>
> acl Safe_ports port 80        # http
>
> acl Safe_ports port 21        # ftp
>
> acl Safe_ports port 443        # https
>
> acl Safe_ports port 70        # gopher
>
> acl Safe_ports port 210        # wais
>
> acl Safe_ports port 1025-65535    # unregistered ports
>
> acl Safe_ports port 280        # http-mgmt
>
> acl Safe_ports port 488        # gss-http
>
> acl Safe_ports port 591        # filemaker
>
> acl Safe_ports port 777        # multiling http
>
> acl blacklist dstdomain "/etc/squid/acls/social_networks.txt" # list of
> blocked websites here
>
> acl CONNECT method CONNECT
>
>
>
> http_access deny blacklist
>
> http_access deny !Safe_ports
>
> http_access deny CONNECT !SSL_ports
>
>
>
> http_access allow all
>
>
>
> http_port 3130
>
>
>
> http_port 3128 intercept
>
> https_port 3129 intercept ssl-bump cert=/etc/squid/ssl_cert/vproxy2.pem
> key=/etc/squid/ssl_cert/vproxy2.pem
>
>
>
> #always_direct allow all
>
> ssl_bump server-first all
>
> #sslproxy_cert_error deny all
>
> #sslproxy_flags DONT_VERIFY_PEER
>
>
>
> sslcrtd_program /usr/lib/squid/ssl_crtd -s /var/lib/ssl_db -M 4MB
>
> sslcrtd_children 8 startup=1 idle=1
>
>
>
> coredump_dir /var/spool/squid
>
>
>
> # Add any of your own refresh_pattern entries above these.
>
> refresh_pattern ^ftp:        1440    20%    10080
>
> refresh_pattern ^gopher:    1440    0%    1440
>
> refresh_pattern -i (/cgi-bin/|\?) 0    0%    0
>
> refresh_pattern .        0    20%    4320
>
>
>
> shutdown_lifetime 1 second
>
>
>
> cache.log:
>
>
>
> Maximum Resident Size: 123312 KB
>
> Page faults with physical i/o: 7
>
> 2018/08/23 16:19:27 kid1| Logfile: closing log
> daemon:/var/log/squid/access.log
>
> 2018/08/23 16:19:27 kid1| Logfile Daemon: closing log
> daemon:/var/log/squid/access.log
>
> 2018/08/23 16:19:27 kid1| Open FD UNSTARTED     6 DNS Socket IPv6
>
> 2018/08/23 16:19:27 kid1| Open FD READ/WRITE    7 DNS Socket IPv4
>
> 2018/08/23 16:19:27 kid1| Open FD UNSTARTED    10 IPC UNIX STREAM Parent
>
> 2018/08/23 16:19:27 kid1| Squid Cache (Version 3.5.23): Exiting normally.
>
> 2018/08/23 16:19:32 kid1| Set Current Directory to /var/spool/squid
>
> 2018/08/23 16:19:32 kid1| Starting Squid Cache version 3.5.23 for
> x86_64-pc-linux-gnu...
>
> 2018/08/23 16:19:32 kid1| Service Name: squid
>
> 2018/08/23 16:19:32 kid1| Process ID 1209
>
> 2018/08/23 16:19:32 kid1| Process Roles: worker
>
> 2018/08/23 16:19:32 kid1| With 65535 file descriptors available
>
> 2018/08/23 16:19:32 kid1| Initializing IP Cache...
>
> 2018/08/23 16:19:32 kid1| DNS Socket created at [::], FD 6
>
> 2018/08/23 16:19:32 kid1| DNS Socket created at 0.0.0.0, FD 7
>
> 2018/08/23 16:19:32 kid1| Adding domain generium.corp from /etc/resolv.conf
>
> 2018/08/23 16:19:32 kid1| Adding nameserver 10.84.10.110 from
> /etc/resolv.conf
>
> 2018/08/23 16:19:32 kid1| Adding nameserver 10.83.10.120 from
> /etc/resolv.conf
>
> 2018/08/23 16:19:32 kid1| Logfile: opening log
> daemon:/var/log/squid/access.log
>
> 2018/08/23 16:19:32 kid1| Logfile Daemon: opening log
> /var/log/squid/access.log
>
> 2018/08/23 16:19:32 kid1| Local cache digest enabled; rebuild/rewrite
> every 3600/3600 sec
>
> 2018/08/23 16:19:32 kid1| Store logging disabled
>
> 2018/08/23 16:19:32 kid1| Swap maxSize 0 + 262144 KB, estimated 20164
> objects
>
> 2018/08/23 16:19:32 kid1| Target number of buckets: 1008
>
> 2018/08/23 16:19:32 kid1| Using 8192 Store buckets
>
> 2018/08/23 16:19:32 kid1| Max Mem  size: 262144 KB
>
> 2018/08/23 16:19:32 kid1| Max Swap size: 0 KB
>
> 2018/08/23 16:19:32 kid1| Using Least Load store dir selection
>
> 2018/08/23 16:19:32 kid1| Set Current Directory to /var/spool/squid
>
> 2018/08/23 16:19:32 kid1| Finished loading MIME types and icons.
>
> 2018/08/23 16:19:32 kid1| HTCP Disabled.
>
> 2018/08/23 16:19:32 kid1| Pinger socket opened on FD 16
>
> 2018/08/23 16:19:32 kid1| Squid plugin modules loaded: 0
>
> 2018/08/23 16:19:32 kid1| Adaptation support is off.
>
> 2018/08/23 16:19:32 kid1| Accepting HTTP Socket connections at
> local=[::]:3130 remote=[::] FD 12 flags=9
>
> 2018/08/23 16:19:32 kid1| Accepting NAT intercepted HTTP Socket
> connections at local=[::]:3128 remote=[::] FD 13 flags=41
>
> 2018/08/23 16:19:32 kid1| Accepting NAT intercepted SSL bumped HTTPS
> Socket connections at local=[::]:3129 remote=[::] FD 14 flags=41
>
> 2018/08/23 16:19:32| pinger: Initialising ICMP pinger ...
>
> 2018/08/23 16:19:32| pinger: ICMP socket opened.
>
> 2018/08/23 16:19:32| pinger: ICMPv6 socket opened
>
> 2018/08/23 16:19:32| Pinger exiting.
>
> 2018/08/23 16:19:33 kid1| storeLateRelease: released 0 objects
>
>
>
> Accesslog:
>
>
>
> 1535030545.214      0 10.84.77.52 TAG_NONE/503 382 GET https://habr.com/
> - ORIGINAL_DST/178.248.237.68 text/html
>
> 1535030545.442    608 10.84.77.52 TAG_NONE/200 0 CONNECT 52.4.157.193:443
> - ORIGINAL_DST/52.4.157.193 -
>
> 1535030545.442    617 10.84.77.52 TAG_NONE/200 0 CONNECT 52.204.140.44:443
> - ORIGINAL_DST/52.204.140.44 -
>
> 1535030545.717    422 10.84.77.52 TAG_NONE/200 0 CONNECT 52.204.140.44:443
> - ORIGINAL_DST/52.204.140.44 -
>
> 1535030545.879     36 10.84.77.52 TCP_MISS/204 415 POST
> https://www.google.ru/gen_204? - ORIGINAL_DST/64.233.162.94 text/html
>
> 1535030546.522     77 10.84.77.52 TAG_NONE/200 0 CONNECT
> 178.248.237.68:443 - ORIGINAL_DST/178.248.237.68 -
>
> 1535030546.623     95 10.84.77.52 TAG_NONE/200 0 CONNECT
> 178.248.237.68:443 - ORIGINAL_DST/178.248.237.68 -
>
> 1535030546.625      0 10.84.77.52 TAG_NONE/503 382 GET https://habr.com/
> - ORIGINAL_DST/178.248.237.68 text/html
>
>
>
> ??????????? ? ??????????????????: ??? ??????????? ????????? ? ?????
> ?????????, ??????????? ? ????, ????? ????????? ???????????????? ??????????.
> ????????? ?????????? ??? ? ???, ??? ???? ??? ????????? ?? ?????????????
> ???, ?????????????, ??????????? ??? ??????????????? ??????????,
> ???????????? ? ????????? ?????????, ? ????? ????????????? ????? ???????? ??
> ?????? ???? ?????????? ?????? ?????????. ???? ?? ???????? ??? ????????? ??
> ??????, ??????????, ???????? ?? ???? ??????????? ?? ??????????? ????? ?
> ??????? ??? ?????????. Confidentiality notice: This e-mail transmission and
> any attachments included may contain confidential information. If you are
> not the intended recipient, you are hereby notified that any disclosure,
> copying, distribution, or reliance upon the content of this e-mail is
> strictly prohibited. If you have received this e-mail transmission in
> error, please notify sender by e-mail and then delete this message from
> your inbox.
>
> ??????????? ? ??????????????????: ??? ??????????? ????????? ? ?????
> ?????????, ??????????? ? ????, ????? ????????? ???????????????? ??????????.
> ????????? ?????????? ??? ? ???, ??? ???? ??? ????????? ?? ?????????????
> ???, ?????????????, ??????????? ??? ??????????????? ??????????,
> ???????????? ? ????????? ?????????, ? ????? ????????????? ????? ???????? ??
> ?????? ???? ?????????? ?????? ?????????. ???? ?? ???????? ??? ????????? ??
> ??????, ??????????, ???????? ?? ???? ??????????? ?? ??????????? ????? ?
> ??????? ??? ?????????. Confidentiality notice: This e-mail transmission and
> any attachments included may contain confidential information. If you are
> not the intended recipient, you are hereby notified that any disclosure,
> copying, distribution, or reliance upon the content of this e-mail is
> strictly prohibited. If you have received this e-mail transmission in
> error, please notify sender by e-mail and then delete this message from
> your inbox.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>


-- 
Atenciosamente,
Rodrigo da Silva Cunha
S?o Gon?alo, RJ - Brasil
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180823/9090fe71/attachment.htm>

From service.mv at gmail.com  Thu Aug 23 18:50:20 2018
From: service.mv at gmail.com (neok)
Date: Thu, 23 Aug 2018 13:50:20 -0500 (CDT)
Subject: [squid-users] How many network cards do I need?
Message-ID: <1535050220082-0.post@n4.nabble.com>

Hello, everyone, a little question.
Do I need 2 network cards for an explicit squid server 3.5.20 setup? Or can
I do it with just one card?

Thank you very much for your help.
Have a nice day!

Gabriel



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From Antony.Stone at squid.open.source.it  Thu Aug 23 19:08:20 2018
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Thu, 23 Aug 2018 21:08:20 +0200
Subject: [squid-users] How many network cards do I need?
In-Reply-To: <1535050220082-0.post@n4.nabble.com>
References: <1535050220082-0.post@n4.nabble.com>
Message-ID: <201808232108.20442.Antony.Stone@squid.open.source.it>

On Thursday 23 August 2018 at 20:50:20, neok wrote:

> Do I need 2 network cards for an explicit squid server 3.5.20 setup? Or can
> I do it with just one card?

One works fine.


Antony.

-- 
Is it venison for dinner again?  Oh deer.

                                                   Please reply to the list;
                                                         please *don't* CC me.


From rousskov at measurement-factory.com  Thu Aug 23 19:32:09 2018
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Thu, 23 Aug 2018 13:32:09 -0600
Subject: [squid-users] Transparent squid configuration problem.
In-Reply-To: <CAOGexv8tTpno6k_FcZu4u83cM6odgJKd-ZU-aRUKK8j8pjaCAg@mail.gmail.com>
References: <61EF6F4DD37F1245B186602EACC06454BA556B28@MEX1.generium.corp>
 <vmime.5b7eb8d3.4f0e.2fb6dbc5e166283@ms249-lin-003.rotterdam.bazuin.nl>
 <61EF6F4DD37F1245B186602EACC06454BA556BBC@MEX1.generium.corp>
 <CAOGexv8tTpno6k_FcZu4u83cM6odgJKd-ZU-aRUKK8j8pjaCAg@mail.gmail.com>
Message-ID: <89b15df4-0a67-3a6a-88bd-b335c98c216b@measurement-factory.com>

On 08/23/2018 12:40 PM, Rodrigo Cunha wrote:
> Squid not work with transparent proxy in https,

That statement is misleading or incorrect. Squid can be configured to
successfully intercept HTTPS traffic in many environments. Intercepted
TLS traffic can then be inspected and spliced (or even bumped to the
HTTP level where possible and necessary).


> that request is processed directily in your browser for security
> pollices.

Yes, but so is every request, including HTTPS requests that go through
proxy/CONNECT tunnels. Intercepting proxies do not change much compared
to forward proxies as far as browser HTTPS policies are concerned.
Browsers consider them all to be (a part of) the untrusted internet
between the client and the origin server.


> If a server process requests https betwen client and server, that server
> is a "man in the meadle",

The same applies to processing HTTPS requests that go through
proxy/CONNECT tunnels. Both intercepting and forward proxies are men in
the middle.


I am writing this correction just to reduce confusion for others that
might find this email thread later. This correction itself does not
address the OP problem.


Alex.


> Em qui, 23 de ago de 2018 ?s 10:42, ??????? ????????? ?????????????
> <a.zubarev at generium.ru <mailto:a.zubarev at generium.ru>> escreveu:
> 
>     Thank you, Louis! ____
> 
>     Is there some workaround? May be I can to put that?s kind of sites
>     without filtering?____
> 
>     __?__
> 
>     *From:*squid-users <squid-users-bounces at lists.squid-cache.org
>     <mailto:squid-users-bounces at lists.squid-cache.org>> *On Behalf Of
>     *L.P.H. van Belle
>     *Sent:* Thursday, August 23, 2018 4:38 PM
>     *To:* squid-users at lists.squid-cache.org
>     <mailto:squid-users at lists.squid-cache.org>
>     *Subject:* Re: [squid-users] Transparent squid configuration
>     problem.____
> 
>     __?__
> 
>     i noticed the following :??? dig caa habr.com <http://habr.com>
>     ;; ANSWER SECTION:
>     habr.com <http://habr.com>.?????????????? 3600??? IN????? CAA???? 0
>     iodef "mailto:iodef at habr.com"
>     habr.com <http://habr.com>.?????????????? 3600??? IN????? CAA???? 0
>     issue "comodoca.com <http://comodoca.com>"____
> 
>     So you cant bump this site, its protecting its certificates with a
>     CAA/DANE?dns record. ____
> 
>     ?____
> 
>     Greetz, ____
> 
>     ?____
> 
>     Louis____
> 
>     ?____
> 
>     ?____
> 
>     ?____
> 
>     __?__
> 
>         ------------------------------------------------------------------------
> 
>         *Van:*squid-users
>         [mailto:squid-users-bounces at lists.squid-cache.org] *Namens
>         *??????? ????????? ?????????????
>         *Verzonden:* donderdag 23 augustus 2018 15:22
>         *Aan:* squid-users at lists.squid-cache.org
>         <mailto:squid-users at lists.squid-cache.org>
>         *Onderwerp:* [squid-users] Transparent squid configuration
>         problem.____
> 
>         Hi! I have some problems with configuration of squid.____
> 
>         __?__
> 
>         What I need:____
> 
>         http/https transparent proxy server based on Debian Stretch with
>         some blacklisted and whitelisted domains____
> 
>         __?__
> 
>         I?ve used many tutorials and squid.wiki through installation
>         process and it almost work! But I have the last problem.____
> 
>         __?__
> 
>         When I tried to connect to some websites like a https://habr.com
>         I have ?got HTTP ERROR 503. Ive tried to find solution at forums
>         but no one helped me. I know the answer is simple and its here
>         but cannt find it by myself.____
> 
>         __?__
> 
>         Here is my squid.conf, cache.log, access.log and iptables
>         script.____
> 
>         __?__
> 
>         Please help! J____
> 
>         __?__
> 
>         Squid.conf:____
> 
>         __?__
> 
>         dns_v4_first on____
> 
>         __?__
> 
>         acl network src 10.84.0.0/16 <http://10.84.0.0/16>____
> 
>         __?__
> 
>         acl SSL_ports port 443____
> 
>         acl Safe_ports port 80??????? # http____
> 
>         acl Safe_ports port 21??????? # ftp____
> 
>         acl Safe_ports port 443??????? # https____
> 
>         acl Safe_ports port 70??????? # gopher____
> 
>         acl Safe_ports port 210??????? # wais____
> 
>         acl Safe_ports port 1025-65535??? # unregistered ports____
> 
>         acl Safe_ports port 280??????? # http-mgmt____
> 
>         acl Safe_ports port 488??????? # gss-http____
> 
>         acl Safe_ports port 591??????? # filemaker____
> 
>         acl Safe_ports port 777??????? # multiling http____
> 
>         acl blacklist dstdomain "/etc/squid/acls/social_networks.txt" #
>         list of blocked websites here____
> 
>         acl CONNECT method CONNECT____
> 
>         __?__
> 
>         http_access deny blacklist____
> 
>         http_access deny !Safe_ports____
> 
>         http_access deny CONNECT !SSL_ports____
> 
>         __?__
> 
>         http_access allow all____
> 
>         __?__
> 
>         http_port 3130____
> 
>         __?__
> 
>         http_port 3128 intercept____
> 
>         https_port 3129 intercept ssl-bump
>         cert=/etc/squid/ssl_cert/vproxy2.pem
>         key=/etc/squid/ssl_cert/vproxy2.pem____
> 
>         __?__
> 
>         #always_direct allow all____
> 
>         ssl_bump server-first all____
> 
>         #sslproxy_cert_error deny all____
> 
>         #sslproxy_flags DONT_VERIFY_PEER____
> 
>         __?__
> 
>         sslcrtd_program /usr/lib/squid/ssl_crtd -s /var/lib/ssl_db -M
>         4MB____
> 
>         sslcrtd_children 8 startup=1 idle=1____
> 
>         __?__
> 
>         coredump_dir /var/spool/squid____
> 
>         __?__
> 
>         # Add any of your own refresh_pattern entries above these.____
> 
>         refresh_pattern ^ftp:??????? 1440??? 20%??? 10080____
> 
>         refresh_pattern ^gopher:??? 1440??? 0%??? 1440____
> 
>         refresh_pattern -i (/cgi-bin/|\?) 0??? 0%??? 0____
> 
>         refresh_pattern .??????? 0??? 20%??? 4320____
> 
>         __?__
> 
>         shutdown_lifetime 1 second____
> 
>         __?__
> 
>         cache.log:____
> 
>         __?__
> 
>         Maximum Resident Size: 123312 KB____
> 
>         Page faults with physical i/o: 7____
> 
>         2018/08/23 16:19:27 kid1| Logfile: closing log
>         daemon:/var/log/squid/access.log____
> 
>         2018/08/23 16:19:27 kid1| Logfile Daemon: closing log
>         daemon:/var/log/squid/access.log____
> 
>         2018/08/23 16:19:27 kid1| Open FD UNSTARTED???? 6 DNS Socket
>         IPv6____
> 
>         2018/08/23 16:19:27 kid1| Open FD READ/WRITE??? 7 DNS Socket
>         IPv4____
> 
>         2018/08/23 16:19:27 kid1| Open FD UNSTARTED??? 10 IPC UNIX
>         STREAM Parent____
> 
>         2018/08/23 16:19:27 kid1| Squid Cache (Version 3.5.23): Exiting
>         normally.____
> 
>         2018/08/23 16:19:32 kid1| Set Current Directory to
>         /var/spool/squid____
> 
>         2018/08/23 16:19:32 kid1| Starting Squid Cache version 3.5.23
>         for x86_64-pc-linux-gnu...____
> 
>         2018/08/23 16:19:32 kid1| Service Name: squid____
> 
>         2018/08/23 16:19:32 kid1| Process ID 1209____
> 
>         2018/08/23 16:19:32 kid1| Process Roles: worker____
> 
>         2018/08/23 16:19:32 kid1| With 65535 file descriptors available____
> 
>         2018/08/23 16:19:32 kid1| Initializing IP Cache...____
> 
>         2018/08/23 16:19:32 kid1| DNS Socket created at [::], FD 6____
> 
>         2018/08/23 16:19:32 kid1| DNS Socket created at 0.0.0.0, FD 7____
> 
>         2018/08/23 16:19:32 kid1| Adding domain generium.corp from
>         /etc/resolv.conf____
> 
>         2018/08/23 16:19:32 kid1| Adding nameserver 10.84.10.110 from
>         /etc/resolv.conf____
> 
>         2018/08/23 16:19:32 kid1| Adding nameserver 10.83.10.120 from
>         /etc/resolv.conf____
> 
>         2018/08/23 16:19:32 kid1| Logfile: opening log
>         daemon:/var/log/squid/access.log____
> 
>         2018/08/23 16:19:32 kid1| Logfile Daemon: opening log
>         /var/log/squid/access.log____
> 
>         2018/08/23 16:19:32 kid1| Local cache digest enabled;
>         rebuild/rewrite every 3600/3600 sec____
> 
>         2018/08/23 16:19:32 kid1| Store logging disabled____
> 
>         2018/08/23 16:19:32 kid1| Swap maxSize 0 + 262144 KB, estimated
>         20164 objects____
> 
>         2018/08/23 16:19:32 kid1| Target number of buckets: 1008____
> 
>         2018/08/23 16:19:32 kid1| Using 8192 Store buckets____
> 
>         2018/08/23 16:19:32 kid1| Max Mem? size: 262144 KB____
> 
>         2018/08/23 16:19:32 kid1| Max Swap size: 0 KB____
> 
>         2018/08/23 16:19:32 kid1| Using Least Load store dir selection____
> 
>         2018/08/23 16:19:32 kid1| Set Current Directory to
>         /var/spool/squid____
> 
>         2018/08/23 16:19:32 kid1| Finished loading MIME types and icons.____
> 
>         2018/08/23 16:19:32 kid1| HTCP Disabled.____
> 
>         2018/08/23 16:19:32 kid1| Pinger socket opened on FD 16____
> 
>         2018/08/23 16:19:32 kid1| Squid plugin modules loaded: 0____
> 
>         2018/08/23 16:19:32 kid1| Adaptation support is off.____
> 
>         2018/08/23 16:19:32 kid1| Accepting HTTP Socket connections at
>         local=[::]:3130 remote=[::] FD 12 flags=9____
> 
>         2018/08/23 16:19:32 kid1| Accepting NAT intercepted HTTP Socket
>         connections at local=[::]:3128 remote=[::] FD 13 flags=41____
> 
>         2018/08/23 16:19:32 kid1| Accepting NAT intercepted SSL bumped
>         HTTPS Socket connections at local=[::]:3129 remote=[::] FD 14
>         flags=41____
> 
>         2018/08/23 16:19:32| pinger: Initialising ICMP pinger ...____
> 
>         2018/08/23 16:19:32| pinger: ICMP socket opened.____
> 
>         2018/08/23 16:19:32| pinger: ICMPv6 socket opened____
> 
>         2018/08/23 16:19:32| Pinger exiting.____
> 
>         2018/08/23 16:19:33 kid1| storeLateRelease: released 0 objects____
> 
>         __?__
> 
>         Accesslog:____
> 
>         __?__
> 
>         1535030545.214????? 0 10.84.77.52 TAG_NONE/503 382 GET
>         https://habr.com/ - ORIGINAL_DST/178.248.237.68
>         <http://178.248.237.68> text/html____
> 
>         1535030545.442??? 608 10.84.77.52 TAG_NONE/200 0 CONNECT
>         52.4.157.193:443 <http://52.4.157.193:443> -
>         ORIGINAL_DST/52.4.157.193 <http://52.4.157.193> -____
> 
>         1535030545.442??? 617 10.84.77.52 TAG_NONE/200 0 CONNECT
>         52.204.140.44:443 <http://52.204.140.44:443> -
>         ORIGINAL_DST/52.204.140.44 <http://52.204.140.44> -____
> 
>         1535030545.717??? 422 10.84.77.52 TAG_NONE/200 0 CONNECT
>         52.204.140.44:443 <http://52.204.140.44:443> -
>         ORIGINAL_DST/52.204.140.44 <http://52.204.140.44> -____
> 
>         1535030545.879???? 36 10.84.77.52 TCP_MISS/204 415 POST
>         https://www.google.ru/gen_204? - ORIGINAL_DST/64.233.162.94
>         <http://64.233.162.94> text/html____
> 
>         1535030546.522???? 77 10.84.77.52 TAG_NONE/200 0 CONNECT
>         178.248.237.68:443 <http://178.248.237.68:443> -
>         ORIGINAL_DST/178.248.237.68 <http://178.248.237.68> -____
> 
>         1535030546.623???? 95 10.84.77.52 TAG_NONE/200 0 CONNECT
>         178.248.237.68:443 <http://178.248.237.68:443> -
>         ORIGINAL_DST/178.248.237.68 <http://178.248.237.68> -____
> 
>         1535030546.625????? 0 10.84.77.52 TAG_NONE/503 382 GET
>         https://habr.com/ - ORIGINAL_DST/178.248.237.68
>         <http://178.248.237.68> text/html____
> 
>         __?__
> 
>         ??????????? ? ??????????????????: ??? ??????????? ????????? ?
>         ????? ?????????, ??????????? ? ????, ????? ?????????
>         ???????????????? ??????????. ????????? ?????????? ??? ? ???, ???
>         ???? ??? ????????? ?? ????????????? ???, ?????????????,
>         ??????????? ??? ??????????????? ??????????, ???????????? ?
>         ????????? ?????????, ? ????? ????????????? ????? ???????? ??
>         ?????? ???? ?????????? ?????? ?????????. ???? ?? ???????? ???
>         ????????? ?? ??????, ??????????, ???????? ?? ???? ??????????? ??
>         ??????????? ????? ? ??????? ??? ?????????. Confidentiality
>         notice: This e-mail transmission and any attachments included
>         may contain confidential information. If you are not the
>         intended recipient, you are hereby notified that any disclosure,
>         copying, distribution, or reliance upon the content of this
>         e-mail is strictly prohibited. If you have received this e-mail
>         transmission in error, please notify sender by e-mail and then
>         delete this message from your inbox. ____
> 
>     ??????????? ? ??????????????????: ??? ??????????? ????????? ? ?????
>     ?????????, ??????????? ? ????, ????? ????????? ????????????????
>     ??????????. ????????? ?????????? ??? ? ???, ??? ???? ??? ?????????
>     ?? ????????????? ???, ?????????????, ??????????? ??? ???????????????
>     ??????????, ???????????? ? ????????? ?????????, ? ?????
>     ????????????? ????? ???????? ?? ?????? ???? ?????????? ??????
>     ?????????. ???? ?? ???????? ??? ????????? ?? ??????, ??????????,
>     ???????? ?? ???? ??????????? ?? ??????????? ????? ? ??????? ???
>     ?????????. Confidentiality notice: This e-mail transmission and any
>     attachments included may contain confidential information. If you
>     are not the intended recipient, you are hereby notified that any
>     disclosure, copying, distribution, or reliance upon the content of
>     this e-mail is strictly prohibited. If you have received this e-mail
>     transmission in error, please notify sender by e-mail and then
>     delete this message from your inbox.
>     _______________________________________________
>     squid-users mailing list
>     squid-users at lists.squid-cache.org
>     <mailto:squid-users at lists.squid-cache.org>
>     http://lists.squid-cache.org/listinfo/squid-users
> 
> 
> 
> -- 
> Atenciosamente,
> Rodrigo da Silva Cunha
> S?o Gon?alo, RJ - Brasil
> 
> 
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 



From rodrigo.root.rj at gmail.com  Thu Aug 23 21:05:15 2018
From: rodrigo.root.rj at gmail.com (Rodrigo Cunha)
Date: Thu, 23 Aug 2018 18:05:15 -0300
Subject: [squid-users] Transparent squid configuration problem.
In-Reply-To: <89b15df4-0a67-3a6a-88bd-b335c98c216b@measurement-factory.com>
References: <61EF6F4DD37F1245B186602EACC06454BA556B28@MEX1.generium.corp>
 <vmime.5b7eb8d3.4f0e.2fb6dbc5e166283@ms249-lin-003.rotterdam.bazuin.nl>
 <61EF6F4DD37F1245B186602EACC06454BA556BBC@MEX1.generium.corp>
 <CAOGexv8tTpno6k_FcZu4u83cM6odgJKd-ZU-aRUKK8j8pjaCAg@mail.gmail.com>
 <89b15df4-0a67-3a6a-88bd-b335c98c216b@measurement-factory.com>
Message-ID: <CAOGexv8d7byxymKR7Yc-st-7XrCGAD7jgwCVzJGC1X533nA0iw@mail.gmail.com>

Tks, you have how-to for configure transparent proxy in squid current
version or in old versions to https?I want test in my envirimont lab.


Em qui, 23 de ago de 2018 ?s 16:32, Alex Rousskov <
rousskov at measurement-factory.com> escreveu:

> On 08/23/2018 12:40 PM, Rodrigo Cunha wrote:
> > Squid not work with transparent proxy in https,
>
> That statement is misleading or incorrect. Squid can be configured to
> successfully intercept HTTPS traffic in many environments. Intercepted
> TLS traffic can then be inspected and spliced (or even bumped to the
> HTTP level where possible and necessary).
>
>
> > that request is processed directily in your browser for security
> > pollices.
>
> Yes, but so is every request, including HTTPS requests that go through
> proxy/CONNECT tunnels. Intercepting proxies do not change much compared
> to forward proxies as far as browser HTTPS policies are concerned.
> Browsers consider them all to be (a part of) the untrusted internet
> between the client and the origin server.
>
>
> > If a server process requests https betwen client and server, that server
> > is a "man in the meadle",
>
> The same applies to processing HTTPS requests that go through
> proxy/CONNECT tunnels. Both intercepting and forward proxies are men in
> the middle.
>
>
> I am writing this correction just to reduce confusion for others that
> might find this email thread later. This correction itself does not
> address the OP problem.
>
>
> Alex.
>
>
> > Em qui, 23 de ago de 2018 ?s 10:42, ??????? ????????? ?????????????
> > <a.zubarev at generium.ru <mailto:a.zubarev at generium.ru>> escreveu:
> >
> >     Thank you, Louis! ____
> >
> >     Is there some workaround? May be I can to put that?s kind of sites
> >     without filtering?____
> >
> >     __ __
> >
> >     *From:*squid-users <squid-users-bounces at lists.squid-cache.org
> >     <mailto:squid-users-bounces at lists.squid-cache.org>> *On Behalf Of
> >     *L.P.H. van Belle
> >     *Sent:* Thursday, August 23, 2018 4:38 PM
> >     *To:* squid-users at lists.squid-cache.org
> >     <mailto:squid-users at lists.squid-cache.org>
> >     *Subject:* Re: [squid-users] Transparent squid configuration
> >     problem.____
> >
> >     __ __
> >
> >     i noticed the following :    dig caa habr.com <http://habr.com>
> >     ;; ANSWER SECTION:
> >     habr.com <http://habr.com>.               3600    IN      CAA     0
> >     iodef "mailto:iodef at habr.com"
> >     habr.com <http://habr.com>.               3600    IN      CAA     0
> >     issue "comodoca.com <http://comodoca.com>"____
> >
> >     So you cant bump this site, its protecting its certificates with a
> >     CAA/DANE dns record. ____
> >
> >      ____
> >
> >     Greetz, ____
> >
> >      ____
> >
> >     Louis____
> >
> >      ____
> >
> >      ____
> >
> >      ____
> >
> >     __ __
> >
> >
>  ------------------------------------------------------------------------
> >
> >         *Van:*squid-users
> >         [mailto:squid-users-bounces at lists.squid-cache.org] *Namens
> >         *??????? ????????? ?????????????
> >         *Verzonden:* donderdag 23 augustus 2018 15:22
> >         *Aan:* squid-users at lists.squid-cache.org
> >         <mailto:squid-users at lists.squid-cache.org>
> >         *Onderwerp:* [squid-users] Transparent squid configuration
> >         problem.____
> >
> >         Hi! I have some problems with configuration of squid.____
> >
> >         __ __
> >
> >         What I need:____
> >
> >         http/https transparent proxy server based on Debian Stretch with
> >         some blacklisted and whitelisted domains____
> >
> >         __ __
> >
> >         I?ve used many tutorials and squid.wiki through installation
> >         process and it almost work! But I have the last problem.____
> >
> >         __ __
> >
> >         When I tried to connect to some websites like a https://habr.com
> >         I have  got HTTP ERROR 503. Ive tried to find solution at forums
> >         but no one helped me. I know the answer is simple and its here
> >         but cannt find it by myself.____
> >
> >         __ __
> >
> >         Here is my squid.conf, cache.log, access.log and iptables
> >         script.____
> >
> >         __ __
> >
> >         Please help! J____
> >
> >         __ __
> >
> >         Squid.conf:____
> >
> >         __ __
> >
> >         dns_v4_first on____
> >
> >         __ __
> >
> >         acl network src 10.84.0.0/16 <http://10.84.0.0/16>____
> >
> >         __ __
> >
> >         acl SSL_ports port 443____
> >
> >         acl Safe_ports port 80        # http____
> >
> >         acl Safe_ports port 21        # ftp____
> >
> >         acl Safe_ports port 443        # https____
> >
> >         acl Safe_ports port 70        # gopher____
> >
> >         acl Safe_ports port 210        # wais____
> >
> >         acl Safe_ports port 1025-65535    # unregistered ports____
> >
> >         acl Safe_ports port 280        # http-mgmt____
> >
> >         acl Safe_ports port 488        # gss-http____
> >
> >         acl Safe_ports port 591        # filemaker____
> >
> >         acl Safe_ports port 777        # multiling http____
> >
> >         acl blacklist dstdomain "/etc/squid/acls/social_networks.txt" #
> >         list of blocked websites here____
> >
> >         acl CONNECT method CONNECT____
> >
> >         __ __
> >
> >         http_access deny blacklist____
> >
> >         http_access deny !Safe_ports____
> >
> >         http_access deny CONNECT !SSL_ports____
> >
> >         __ __
> >
> >         http_access allow all____
> >
> >         __ __
> >
> >         http_port 3130____
> >
> >         __ __
> >
> >         http_port 3128 intercept____
> >
> >         https_port 3129 intercept ssl-bump
> >         cert=/etc/squid/ssl_cert/vproxy2.pem
> >         key=/etc/squid/ssl_cert/vproxy2.pem____
> >
> >         __ __
> >
> >         #always_direct allow all____
> >
> >         ssl_bump server-first all____
> >
> >         #sslproxy_cert_error deny all____
> >
> >         #sslproxy_flags DONT_VERIFY_PEER____
> >
> >         __ __
> >
> >         sslcrtd_program /usr/lib/squid/ssl_crtd -s /var/lib/ssl_db -M
> >         4MB____
> >
> >         sslcrtd_children 8 startup=1 idle=1____
> >
> >         __ __
> >
> >         coredump_dir /var/spool/squid____
> >
> >         __ __
> >
> >         # Add any of your own refresh_pattern entries above these.____
> >
> >         refresh_pattern ^ftp:        1440    20%    10080____
> >
> >         refresh_pattern ^gopher:    1440    0%    1440____
> >
> >         refresh_pattern -i (/cgi-bin/|\?) 0    0%    0____
> >
> >         refresh_pattern .        0    20%    4320____
> >
> >         __ __
> >
> >         shutdown_lifetime 1 second____
> >
> >         __ __
> >
> >         cache.log:____
> >
> >         __ __
> >
> >         Maximum Resident Size: 123312 KB____
> >
> >         Page faults with physical i/o: 7____
> >
> >         2018/08/23 16:19:27 kid1| Logfile: closing log
> >         daemon:/var/log/squid/access.log____
> >
> >         2018/08/23 16:19:27 kid1| Logfile Daemon: closing log
> >         daemon:/var/log/squid/access.log____
> >
> >         2018/08/23 16:19:27 kid1| Open FD UNSTARTED     6 DNS Socket
> >         IPv6____
> >
> >         2018/08/23 16:19:27 kid1| Open FD READ/WRITE    7 DNS Socket
> >         IPv4____
> >
> >         2018/08/23 16:19:27 kid1| Open FD UNSTARTED    10 IPC UNIX
> >         STREAM Parent____
> >
> >         2018/08/23 16:19:27 kid1| Squid Cache (Version 3.5.23): Exiting
> >         normally.____
> >
> >         2018/08/23 16:19:32 kid1| Set Current Directory to
> >         /var/spool/squid____
> >
> >         2018/08/23 16:19:32 kid1| Starting Squid Cache version 3.5.23
> >         for x86_64-pc-linux-gnu...____
> >
> >         2018/08/23 16:19:32 kid1| Service Name: squid____
> >
> >         2018/08/23 16:19:32 kid1| Process ID 1209____
> >
> >         2018/08/23 16:19:32 kid1| Process Roles: worker____
> >
> >         2018/08/23 16:19:32 kid1| With 65535 file descriptors
> available____
> >
> >         2018/08/23 16:19:32 kid1| Initializing IP Cache...____
> >
> >         2018/08/23 16:19:32 kid1| DNS Socket created at [::], FD 6____
> >
> >         2018/08/23 16:19:32 kid1| DNS Socket created at 0.0.0.0, FD 7____
> >
> >         2018/08/23 16:19:32 kid1| Adding domain generium.corp from
> >         /etc/resolv.conf____
> >
> >         2018/08/23 16:19:32 kid1| Adding nameserver 10.84.10.110 from
> >         /etc/resolv.conf____
> >
> >         2018/08/23 16:19:32 kid1| Adding nameserver 10.83.10.120 from
> >         /etc/resolv.conf____
> >
> >         2018/08/23 16:19:32 kid1| Logfile: opening log
> >         daemon:/var/log/squid/access.log____
> >
> >         2018/08/23 16:19:32 kid1| Logfile Daemon: opening log
> >         /var/log/squid/access.log____
> >
> >         2018/08/23 16:19:32 kid1| Local cache digest enabled;
> >         rebuild/rewrite every 3600/3600 sec____
> >
> >         2018/08/23 16:19:32 kid1| Store logging disabled____
> >
> >         2018/08/23 16:19:32 kid1| Swap maxSize 0 + 262144 KB, estimated
> >         20164 objects____
> >
> >         2018/08/23 16:19:32 kid1| Target number of buckets: 1008____
> >
> >         2018/08/23 16:19:32 kid1| Using 8192 Store buckets____
> >
> >         2018/08/23 16:19:32 kid1| Max Mem  size: 262144 KB____
> >
> >         2018/08/23 16:19:32 kid1| Max Swap size: 0 KB____
> >
> >         2018/08/23 16:19:32 kid1| Using Least Load store dir
> selection____
> >
> >         2018/08/23 16:19:32 kid1| Set Current Directory to
> >         /var/spool/squid____
> >
> >         2018/08/23 16:19:32 kid1| Finished loading MIME types and
> icons.____
> >
> >         2018/08/23 16:19:32 kid1| HTCP Disabled.____
> >
> >         2018/08/23 16:19:32 kid1| Pinger socket opened on FD 16____
> >
> >         2018/08/23 16:19:32 kid1| Squid plugin modules loaded: 0____
> >
> >         2018/08/23 16:19:32 kid1| Adaptation support is off.____
> >
> >         2018/08/23 16:19:32 kid1| Accepting HTTP Socket connections at
> >         local=[::]:3130 remote=[::] FD 12 flags=9____
> >
> >         2018/08/23 16:19:32 kid1| Accepting NAT intercepted HTTP Socket
> >         connections at local=[::]:3128 remote=[::] FD 13 flags=41____
> >
> >         2018/08/23 16:19:32 kid1| Accepting NAT intercepted SSL bumped
> >         HTTPS Socket connections at local=[::]:3129 remote=[::] FD 14
> >         flags=41____
> >
> >         2018/08/23 16:19:32| pinger: Initialising ICMP pinger ...____
> >
> >         2018/08/23 16:19:32| pinger: ICMP socket opened.____
> >
> >         2018/08/23 16:19:32| pinger: ICMPv6 socket opened____
> >
> >         2018/08/23 16:19:32| Pinger exiting.____
> >
> >         2018/08/23 16:19:33 kid1| storeLateRelease: released 0
> objects____
> >
> >         __ __
> >
> >         Accesslog:____
> >
> >         __ __
> >
> >         1535030545.214      0 10.84.77.52 TAG_NONE/503 382 GET
> >         https://habr.com/ - ORIGINAL_DST/178.248.237.68
> >         <http://178.248.237.68> text/html____
> >
> >         1535030545.442    608 10.84.77.52 TAG_NONE/200 0 CONNECT
> >         52.4.157.193:443 <http://52.4.157.193:443> -
> >         ORIGINAL_DST/52.4.157.193 <http://52.4.157.193> -____
> >
> >         1535030545.442    617 10.84.77.52 TAG_NONE/200 0 CONNECT
> >         52.204.140.44:443 <http://52.204.140.44:443> -
> >         ORIGINAL_DST/52.204.140.44 <http://52.204.140.44> -____
> >
> >         1535030545.717    422 10.84.77.52 TAG_NONE/200 0 CONNECT
> >         52.204.140.44:443 <http://52.204.140.44:443> -
> >         ORIGINAL_DST/52.204.140.44 <http://52.204.140.44> -____
> >
> >         1535030545.879     36 10.84.77.52 TCP_MISS/204 415 POST
> >         https://www.google.ru/gen_204? - ORIGINAL_DST/64.233.162.94
> >         <http://64.233.162.94> text/html____
> >
> >         1535030546.522     77 10.84.77.52 TAG_NONE/200 0 CONNECT
> >         178.248.237.68:443 <http://178.248.237.68:443> -
> >         ORIGINAL_DST/178.248.237.68 <http://178.248.237.68> -____
> >
> >         1535030546.623     95 10.84.77.52 TAG_NONE/200 0 CONNECT
> >         178.248.237.68:443 <http://178.248.237.68:443> -
> >         ORIGINAL_DST/178.248.237.68 <http://178.248.237.68> -____
> >
> >         1535030546.625      0 10.84.77.52 TAG_NONE/503 382 GET
> >         https://habr.com/ - ORIGINAL_DST/178.248.237.68
> >         <http://178.248.237.68> text/html____
> >
> >         __ __
> >
> >         ??????????? ? ??????????????????: ??? ??????????? ????????? ?
> >         ????? ?????????, ??????????? ? ????, ????? ?????????
> >         ???????????????? ??????????. ????????? ?????????? ??? ? ???, ???
> >         ???? ??? ????????? ?? ????????????? ???, ?????????????,
> >         ??????????? ??? ??????????????? ??????????, ???????????? ?
> >         ????????? ?????????, ? ????? ????????????? ????? ???????? ??
> >         ?????? ???? ?????????? ?????? ?????????. ???? ?? ???????? ???
> >         ????????? ?? ??????, ??????????, ???????? ?? ???? ??????????? ??
> >         ??????????? ????? ? ??????? ??? ?????????. Confidentiality
> >         notice: This e-mail transmission and any attachments included
> >         may contain confidential information. If you are not the
> >         intended recipient, you are hereby notified that any disclosure,
> >         copying, distribution, or reliance upon the content of this
> >         e-mail is strictly prohibited. If you have received this e-mail
> >         transmission in error, please notify sender by e-mail and then
> >         delete this message from your inbox. ____
> >
> >     ??????????? ? ??????????????????: ??? ??????????? ????????? ? ?????
> >     ?????????, ??????????? ? ????, ????? ????????? ????????????????
> >     ??????????. ????????? ?????????? ??? ? ???, ??? ???? ??? ?????????
> >     ?? ????????????? ???, ?????????????, ??????????? ??? ???????????????
> >     ??????????, ???????????? ? ????????? ?????????, ? ?????
> >     ????????????? ????? ???????? ?? ?????? ???? ?????????? ??????
> >     ?????????. ???? ?? ???????? ??? ????????? ?? ??????, ??????????,
> >     ???????? ?? ???? ??????????? ?? ??????????? ????? ? ??????? ???
> >     ?????????. Confidentiality notice: This e-mail transmission and any
> >     attachments included may contain confidential information. If you
> >     are not the intended recipient, you are hereby notified that any
> >     disclosure, copying, distribution, or reliance upon the content of
> >     this e-mail is strictly prohibited. If you have received this e-mail
> >     transmission in error, please notify sender by e-mail and then
> >     delete this message from your inbox.
> >     _______________________________________________
> >     squid-users mailing list
> >     squid-users at lists.squid-cache.org
> >     <mailto:squid-users at lists.squid-cache.org>
> >     http://lists.squid-cache.org/listinfo/squid-users
> >
> >
> >
> > --
> > Atenciosamente,
> > Rodrigo da Silva Cunha
> > S?o Gon?alo, RJ - Brasil
> >
> >
> >
> > _______________________________________________
> > squid-users mailing list
> > squid-users at lists.squid-cache.org
> > http://lists.squid-cache.org/listinfo/squid-users
> >
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>


-- 
Atenciosamente,
Rodrigo da Silva Cunha
S?o Gon?alo, RJ - Brasil
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180823/24dbac98/attachment.htm>

From squid3 at treenet.co.nz  Fri Aug 24 01:31:29 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 24 Aug 2018 13:31:29 +1200
Subject: [squid-users] Transparent squid configuration problem.
In-Reply-To: <CAOGexv8d7byxymKR7Yc-st-7XrCGAD7jgwCVzJGC1X533nA0iw@mail.gmail.com>
References: <61EF6F4DD37F1245B186602EACC06454BA556B28@MEX1.generium.corp>
 <vmime.5b7eb8d3.4f0e.2fb6dbc5e166283@ms249-lin-003.rotterdam.bazuin.nl>
 <61EF6F4DD37F1245B186602EACC06454BA556BBC@MEX1.generium.corp>
 <CAOGexv8tTpno6k_FcZu4u83cM6odgJKd-ZU-aRUKK8j8pjaCAg@mail.gmail.com>
 <89b15df4-0a67-3a6a-88bd-b335c98c216b@measurement-factory.com>
 <CAOGexv8d7byxymKR7Yc-st-7XrCGAD7jgwCVzJGC1X533nA0iw@mail.gmail.com>
Message-ID: <20d29c94-976a-426e-0768-1c1e4354233c@treenet.co.nz>

On 24/08/18 9:05 AM, Rodrigo Cunha wrote:
> Tks, you have how-to for configure transparent proxy in squid current
> version or in old versions to https?I want test in my envirimont lab.
> 

That would be the SSL-Bump features I mentioned to you the other day.
The latest info is at
<https://wiki.squid-cache.org/Features/SslPeekAndSplice>

Amos


From sis at open.ch  Fri Aug 24 08:41:54 2018
From: sis at open.ch (Simon Staeheli)
Date: Fri, 24 Aug 2018 08:41:54 +0000
Subject: [squid-users] Git tag strategy in Squids GitHub repo
Message-ID: <B08F3EE4-709A-4855-9155-0583602AD979@open.ch>

> FWIW, in March 2018 email to Amos, I have already tried to explain the design approach behind git tagging and offered a specific short-term tagging solution. I did not get a response.

@Amos, according to squid-caches GitHub commit history it looks like as you are doing the releases. Would it be possible to come up with a proper git tagging solution?

Maybe the one proposed by Alex in March or even your own? 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4622 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180824/39e4eff6/attachment.bin>

From squid3 at treenet.co.nz  Fri Aug 24 11:50:21 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 24 Aug 2018 23:50:21 +1200
Subject: [squid-users] Git tag strategy in Squids GitHub repo
In-Reply-To: <B08F3EE4-709A-4855-9155-0583602AD979@open.ch>
References: <B08F3EE4-709A-4855-9155-0583602AD979@open.ch>
Message-ID: <1334e333-ed39-c843-e612-3fb58b4ea873@treenet.co.nz>

On 24/08/18 8:41 PM, Simon Staeheli wrote:
>> FWIW, in March 2018 email to Amos, I have already tried to explain the design approach behind git tagging and offered a specific short-term tagging solution. I did not get a response.
> 

Ah, sorry I forgot or did not realize you were waiting on that.

The next opportunity I had for tagging the release checkouts was 4.2
which got tagged with SQUID_4_2 accordingly for PR 272.

As you can see that tag still does not exist in the master repository.


> @Amos, according to squid-caches GitHub commit history it looks like as you are doing the releases. Would it be possible to come up with a proper git tagging solution?
> 

I am officially the maintainer, yes.


> Maybe the one proposed by Alex in March or even your own? 
> 

Alex "proposal" was to teach me about the git command line option(s) to
push tags to the repository. Which has worked fine .. for the repo I was
using. It has not helped with the public github one you are using.


The Anubis bot gateways all changes to the master repository - so to me
it seems like a reasonable place to be handling the issue of some PR
needing to be tagged as release. Especially since they have scripted
content that can be checked for.
 I'd rather have Anubis do the tagging than pulling in random tags from
any contributors repos.

Amos


From rousskov at measurement-factory.com  Fri Aug 24 14:31:06 2018
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Fri, 24 Aug 2018 08:31:06 -0600
Subject: [squid-users] Git tag strategy in Squids GitHub repo
In-Reply-To: <1334e333-ed39-c843-e612-3fb58b4ea873@treenet.co.nz>
References: <B08F3EE4-709A-4855-9155-0583602AD979@open.ch>
 <1334e333-ed39-c843-e612-3fb58b4ea873@treenet.co.nz>
Message-ID: <63705c94-0513-5177-d7fd-38f95b241ada@measurement-factory.com>

On 08/24/2018 05:50 AM, Amos Jeffries wrote:
> The next opportunity I had for tagging the release checkouts was 4.2
> which got tagged with SQUID_4_2 accordingly for PR 272.

> As you can see that tag still does not exist in the master repository.

Naturally. As I have tried to explain, tags are unrelated to GitHub PRs
and git branches. The official repository does not know what you tag in
your own repository, and GitHub cannot (correctly) automatically copy
tags between repositories because tags are independent names or objects
that can be (and often are!) specific to a repository.

FWIW, many projects use merge bots and protected GitHub branches. I have
not checked each project, so I am sure there are exceptions, but am not
aware of any of those projects tagging releases automatically. In fact,
the "gold standard" for tagging involves a human signing the tag! I am
not implying we must sign tags; this paragraph is only meant to
illustrate that what you think should be happening usually does not. The
previous paragraph (and my previous emails) explain that it probably
does not happen because it goes against git design.

As you know from my March email, GitHub actually has a web interface for
doing releases. Naturally, that functionality is based on tags. That
GitHub interface even allows you to tag a release! Again, I am not
saying we must use that interface or the underlying GitHub API. This
paragraph exists to provide one more example of releases/tagging being
treated separately from PRs and code commits. It also shows that you
have other tools to tag a release if you do not want to or cannot use
git command line.


> Alex "proposal" was to teach me about the git command line option(s) to
> push tags to the repository. 

That was a small part of my email. A far more important (IMO) part was
about the nature of git tags. It looks like neither part had a desirable
effect.


> Which has worked fine .. for the repo I was using. It has not helped
> with the public github one you are using.

Why not? In other words, what did you do to push a tag from one
repository into another, and what happened when you did that? It is
difficult for me to help unless you tell me that you need help and
provide sufficient information to triage the problem.

Needless to say, you should experiment on unofficial repositories.


> The Anubis bot gateways all changes to the master repository

That assertion is incorrect. For example, Anubis does not (and IMO
should not) deal with branch creation and release tagging.


> - so to me it seems like a reasonable place to be handling the issue
> of some PR needing to be tagged as release.

Your suggestion to teach Anubis to tag releases is certainly reasonable.
However, I still think it is wrong to place a highly sensitive and
unrelated to PR merging act into a PR merging bot. Perhaps more
importantly, while we are discussing that suggestion, nothing stops you
from properly tagging all of the official releases now AFAICT.


> I'd rather have Anubis do the tagging than pulling in random tags from
> any contributors repos.

Me too, but that is a false dichotomy. The correct short-term solution
is, IMHO, to learn how to manually tag past official releases and tag them.

Alex.


From EricL at daveramsey.com  Sat Aug 25 14:35:32 2018
From: EricL at daveramsey.com (Eric Lackey)
Date: Sat, 25 Aug 2018 14:35:32 +0000
Subject: [squid-users] Squid ssl_bump always makes outbound connection
Message-ID: <DM6PR10MB2700DC96340B08316DC61B3DC3350@DM6PR10MB2700.namprd10.prod.outlook.com>

Using squid-4.2-1.el7.x86_64

I'm looking at ways to optimize Squid when using ssl_bump. We use the peek & splice approach now and it works pretty well.

While running some tests, I noticed that Squid always makes an outbound connection to the remote server regardless of when I terminate the connection. I'm trying to build a configuration that denies traffic immediately if the client SNI header doesn't match without making a connection to the remote host.

Here is a very simple configuration that should terminate all connections after step1. The connection is terminated, but by running a tcpdump at the same time, I see that Squid still makes an outbound connection.

acl step1 at_step SslBump1
ssl_bump terminate step1

I would expect that if I terminate after step1, the connection to the remote server should never be made. Can anyone help me understand why Squid would still make the outbound connection in this instance?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180825/982e2a19/attachment.htm>

From davidjesse091 at aol.com  Mon Aug 27 00:53:38 2018
From: davidjesse091 at aol.com (davidjesse091 at aol.com)
Date: Sun, 26 Aug 2018 20:53:38 -0400
Subject: [squid-users] Forward to SOCKS proxy?
Message-ID: <16578df356a-1ebb-e6b4@webjas-vad172.srv.aolmail.net>

Can Squid be used to convert incoming HTTP proxy requests to a SOCKS server? 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180826/7f18aa66/attachment.htm>

From Antony.Stone at squid.open.source.it  Mon Aug 27 10:24:49 2018
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Mon, 27 Aug 2018 12:24:49 +0200
Subject: [squid-users] Forward to SOCKS proxy?
In-Reply-To: <16578df356a-1ebb-e6b4@webjas-vad172.srv.aolmail.net>
References: <16578df356a-1ebb-e6b4@webjas-vad172.srv.aolmail.net>
Message-ID: <201808271224.49206.Antony.Stone@squid.open.source.it>

On Monday 27 August 2018 at 02:53:38, davidjesse091 at aol.com wrote:

> Can Squid be used to convert incoming HTTP proxy requests to a SOCKS
> server?

https://wiki.squid-cache.org/Features/Socks

Antony.

-- 
This is not a rehearsal.
This is Real Life.

                                                   Please reply to the list;
                                                         please *don't* CC me.


From zohar9292 at gmail.com  Mon Aug 27 14:04:16 2018
From: zohar9292 at gmail.com (zo_av)
Date: Mon, 27 Aug 2018 09:04:16 -0500 (CDT)
Subject: [squid-users] Transparent Squid Proxy - ERR_EMPTY_RESPONSE
Message-ID: <1535378656348-0.post@n4.nabble.com>

I'm trying to redirect all of my subnet traffic to a transparent squid proxy
using iptables on the router gateway (the squid proxy is located in the
LAN). 

I can browse sites that are https but can't access http sites, the error
that appears in the browser "ERR_EMPTY_RESPONSE" 

also I got this errors in the cache.log file: 
NF getsockopt(ORIGINAL_DST) failed on local=192.168.0.110:3129 
NAT/TPROXY lookup failed to locate original IPs on local=192.168.0.110:3129 

I'm using: 
Squid version:3.5.27 The iptables lines that we used for the redirection:
192.168.0.110:3129 - the squid box port+IP. 192.168.0.1 - the router's IP. 

iptables: 

iptables -t nat -A PREROUTING -p tcp --dport 80 -j DNAT --to-destination
192.168.0.110:3129 

iptables -t nat -A POSTROUTING -p tcp -d 192.168.0.110 --dport 3129 -j SNAT
--to-source 192.168.0.1 

squid.conf 

These are the lines that we have changed/added to the squid.conf: 

acl localnet src 192.168.0.0/24 

http_access allow localnet 
http_port 3128 
http_port 3129 intercept



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From rousskov at measurement-factory.com  Mon Aug 27 14:40:17 2018
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Mon, 27 Aug 2018 08:40:17 -0600
Subject: [squid-users] Squid ssl_bump always makes outbound connection
In-Reply-To: <DM6PR10MB2700DC96340B08316DC61B3DC3350@DM6PR10MB2700.namprd10.prod.outlook.com>
References: <DM6PR10MB2700DC96340B08316DC61B3DC3350@DM6PR10MB2700.namprd10.prod.outlook.com>
Message-ID: <e395e002-53b3-376b-86cb-774fc0dcb402@measurement-factory.com>

On 08/25/2018 08:35 AM, Eric Lackey wrote:
> Using?squid-4.2-1.el7.x86_64

> acl step1 at_step SslBump1
> ssl_bump terminate step1

> I would expect that if I terminate after step1, the connection to the
> remote server should?never be made. Can anyone help me understand why
> Squid would still make the outbound connection in this instance?

Sounds like a Squid bug to me. There were several bugs related to
handing final step1 configurations because SslBump developers often did
not test them when modifying other SslBump aspects. Some of those bugs
still remain. This could be one of them.

I suggest filing a Squid bug report with a single-transaction ALL,9
cache.log attached.


Good luck,

Alex.


From Antony.Stone at squid.open.source.it  Mon Aug 27 14:58:38 2018
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Mon, 27 Aug 2018 16:58:38 +0200
Subject: [squid-users] Transparent Squid Proxy - ERR_EMPTY_RESPONSE
In-Reply-To: <1535378656348-0.post@n4.nabble.com>
References: <1535378656348-0.post@n4.nabble.com>
Message-ID: <201808271658.39023.Antony.Stone@squid.open.source.it>

On Monday 27 August 2018 at 16:04:16, zo_av wrote:

> I'm trying to redirect all of my subnet traffic to a transparent squid
> proxy using iptables on the router gateway (the squid proxy is located in
> the LAN).

So long as you use policy routing for this, and not address translation, it's 
possible.

> I can browse sites that are https but can't access http sites, the error
> that appears in the browser "ERR_EMPTY_RESPONSE"
> 
> also I got this errors in the cache.log file:
> NF getsockopt(ORIGINAL_DST) failed on local=192.168.0.110:3129
> NAT/TPROXY lookup failed to locate original IPs on local=192.168.0.110:3129

Sounds like you're using NAT and not routing :(

> I'm using:
> Squid version:3.5.27 The iptables lines that we used for the redirection:
> 192.168.0.110:3129 - the squid box port+IP. 192.168.0.1 - the router's IP.
> 
> iptables:
> 
> iptables -t nat -A PREROUTING -p tcp --dport 80 -j DNAT --to-destination
> 192.168.0.110:3129
> 
> iptables -t nat -A POSTROUTING -p tcp -d 192.168.0.110 --dport 3129 -j SNAT
> --to-source 192.168.0.1

Nope; won't work.

> squid.conf
> 
> These are the lines that we have changed/added to the squid.conf:
> 
> acl localnet src 192.168.0.0/24
> 
> http_access allow localnet
> http_port 3128
> http_port 3129 intercept

Please see https://wiki.squid-cache.org/ConfigExamples/Intercept/LinuxDnat and 
be aware of the NOTE: NAT configuration will only work when used *on* the squid 
box.

https://wiki.squid-cache.org/ConfigExamples/Intercept/IptablesPolicyRoute will 
help you with the setup you need in your situation.


Regards,


Antony.

-- 
The lottery is a tax for people who can't do maths.

                                                   Please reply to the list;
                                                         please *don't* CC me.


From maxonico at gmail.com  Mon Aug 27 19:13:00 2018
From: maxonico at gmail.com (Maximiliano Santa Cruz)
Date: Mon, 27 Aug 2018 16:13:00 -0300
Subject: [squid-users] Uninitialized SSL certificate database directory
Message-ID: <CAEVtZkvzRqJG38AbvEWHCmeC6wYBVKchWRu=-TjTduOuZ7YhcA@mail.gmail.com>

Hello everybody.

I've been struggling with this error:

(ssl_crtd): Uninitialized SSL certificate database directory:
/var/lib/ssl_db. To initialize, run "ssl_crtd -c -s /var/lib/ssl_db".

I've tried a lot of workarounds from this mailing list but none of them
worked for me, these are the permissions that I have:

[root at localhost admin]#  /usr/lib64/squid/ssl_crtd -c -s /var/lib/ssl_db

[root at localhost admin]# ll /var/lib/ssl_db
total 4
drwxr-xr-x. 2 squid squid 6 Aug 27 15:06 certs
-rw-r--r--. 1 squid squid 0 Aug 27 15:06 index.txt
-rw-r--r--. 1 squid squid 1 Aug 27 15:06 size

I get the error when:

[root at localhost admin]# systemctl restart squid

Then I tried:

[root at localhost admin]# chmod -R a+w /var/lib/ssl_db
[root at localhost admin]# ll /var/lib/ssl_db
total 4
drwxrwxrwx. 2 squid squid 6 Aug 27 15:06 certs
-rw-rw-rw-. 1 squid squid 0 Aug 27 15:06 index.txt
-rw-rw-rw-. 1 squid squid 1 Aug 27 15:06 size

Same error.

OS: CentOS 7
[root at localhost admin]# squid -v
Squid Cache: Version 3.5.27
Service Name: squid

Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180827/287ec75a/attachment.htm>

From srnhari at gmail.com  Tue Aug 28 04:32:08 2018
From: srnhari at gmail.com (Hariharan Sethuraman)
Date: Tue, 28 Aug 2018 10:02:08 +0530
Subject: [squid-users] Cache_peer login password encryption
Message-ID: <CANfnjgK+ExGNwjgP5__3z7rmTpDBt7iOwPfLn=pK=H4qX0Uumw@mail.gmail.com>

Hi,

How do I encrypt the password in squid.conf in cache_peer config?

Thanks,
Hari
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180828/f24bd9e7/attachment.htm>

From denisk19957 at gmail.com  Tue Aug 28 07:04:34 2018
From: denisk19957 at gmail.com (=?UTF-8?B?0JTQtdC90LjRgSDQodGC0LXQv9Cw0L3QvtCy?=)
Date: Tue, 28 Aug 2018 14:04:34 +0700
Subject: [squid-users] Fwd: [squid-bugs] squid-3.5.27 pfSense
In-Reply-To: <ab32a9d6-aac2-57d5-72ac-30c9e2eb2d3f@treenet.co.nz>
References: <CAOcgsfo0DH=cpabtcjLVB0qGanApZoXV30Qsy7PSCX21HYc0qQ@mail.gmail.com>
 <ab32a9d6-aac2-57d5-72ac-30c9e2eb2d3f@treenet.co.nz>
Message-ID: <CAOcgsfoE-gMLydAnOEKOriEAOwa_n8hc8atnSr2TeWkESq6MzQ@mail.gmail.com>

---------- Forwarded message ---------
From: Amos Jeffries <squid3 at treenet.co.nz>
Date: ??, 27 ???. 2018 ?. ? 19:55
Subject: Re: [squid-bugs] squid-3.5.27 pfSense
To: ????? ???????? <denisk19957 at gmail.com>, <
squid-bugs at lists.squid-cache.org>


Please be aware that Squid-3.5 is no longer supported. Especially when
using SSL-Bump features.

You have configured your proxy to generate certificates without any
information about the server being contacted. The behaviour described is
expected to occur with that config.
 Please direct this request for help to the squid-users mailing list.


Cheers
Amos


On 27/08/18 10:26 PM, ????? ???????? wrote:
> Good day!
> I have a some problem: after working of 15-20 minutes (with squid.conf)
> appears problem with SubjectAlternativeName for any HTTPS websites (for
> more details see
>
https://forum.netgate.com/topic/134054/squid-3-5-27-ssl-custom-works-few-minutes-mitm-breakdown
> ).
> I attach configuration squid file and debug logs of last 5 minutes of
Squid
> working.
>  cache.log
> <
https://drive.google.com/file/d/15PYj86Qv-pdiwSHV_0oLC8BsS-oCkzIV/view?usp=drive_web
>
>  squid.conf
> <
https://drive.google.com/file/d/1IVT4VqIOELuAtQYd981ugpsrbaIEUp0O/view?usp=drive_web
>
> _______________________________________________
> squid-bugs mailing list
> squid-bugs at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-bugs
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180828/e0cc7fd3/attachment.htm>

From squid3 at treenet.co.nz  Tue Aug 28 11:28:30 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 28 Aug 2018 23:28:30 +1200
Subject: [squid-users] Uninitialized SSL certificate database directory
In-Reply-To: <CAEVtZkvzRqJG38AbvEWHCmeC6wYBVKchWRu=-TjTduOuZ7YhcA@mail.gmail.com>
References: <CAEVtZkvzRqJG38AbvEWHCmeC6wYBVKchWRu=-TjTduOuZ7YhcA@mail.gmail.com>
Message-ID: <8fa1cb4e-35cb-574e-fc81-7376aeb5db49@treenet.co.nz>

On 28/08/18 7:13 AM, Maximiliano Santa Cruz wrote:
> 
> Hello everybody.
> 
> I've been struggling with this error:
> 
> (ssl_crtd): Uninitialized SSL certificate database directory:
> /var/lib/ssl_db. To initialize, run "ssl_crtd -c -s /var/lib/ssl_db".
> 
> I've tried a lot of workarounds from this mailing list but none of them
> worked for me, these are the permissions that I have:
> 
> [root at localhost admin]#??/usr/lib64/squid/ssl_crtd -c -s /var/lib/ssl_db
> 
> [root at localhost admin]# ll /var/lib/ssl_db
> total 4
> drwxr-xr-x. 2 squid squid 6 Aug 27 15:06 certs
> -rw-r--r--. 1 squid squid 0 Aug 27 15:06 index.txt
> -rw-r--r--. 1 squid squid 1 Aug 27 15:06 size
> 

Have you updated SELinux permissions after creating or changing the
directory?

 test -x /sbin/restorecon && restorecon /var/lib/ssl_db


> 
> OS: CentOS 7
> [root at localhost admin]# squid -v
> Squid Cache: Version 3.5.27
> Service Name: squid
> 

Missing the configure options which will say what --with-default-user=
was set to. That account needs to match the one with rights to the
directory - it may not be "squid".


Also, please update to Squid-4. It has much better support for SSL-Bump
features than squid-3.x. Eliezer has packages available


Amos


From squid3 at treenet.co.nz  Tue Aug 28 11:30:12 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 28 Aug 2018 23:30:12 +1200
Subject: [squid-users] Cache_peer login password encryption
In-Reply-To: <CANfnjgK+ExGNwjgP5__3z7rmTpDBt7iOwPfLn=pK=H4qX0Uumw@mail.gmail.com>
References: <CANfnjgK+ExGNwjgP5__3z7rmTpDBt7iOwPfLn=pK=H4qX0Uumw@mail.gmail.com>
Message-ID: <acc575d2-c90b-fbdc-8e92-0e140d2b65cc@treenet.co.nz>

On 28/08/18 4:32 PM, Hariharan Sethuraman wrote:
> Hi,
> 
> How do I encrypt the password in squid.conf in cache_peer config?
> 

Why? the only passwords you put into squid.conf directly are for Basic
authentication which gets sent in plain text over the network. So there
is no point encrypting for the config file.

Amos


From scotty_beamer at web.de  Tue Aug 28 12:04:02 2018
From: scotty_beamer at web.de (scotty_beamer at web.de)
Date: Tue, 28 Aug 2018 14:04:02 +0200
Subject: [squid-users] Streaming TV (e.g. ZDF) does not work
Message-ID: <trinity-5544d580-137e-4ce2-a734-ee82749455c1-1535457842893@3c-app-webde-bs09>

An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180828/53b6a717/attachment.htm>

From squid3 at treenet.co.nz  Tue Aug 28 12:06:44 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 29 Aug 2018 00:06:44 +1200
Subject: [squid-users] Cache_peer login password encryption
In-Reply-To: <CANfnjgLMg3FJTUDa7-Uqjqv2PZZJhqjFk28q-xumOEtwDzQzzQ@mail.gmail.com>
References: <CANfnjgK+ExGNwjgP5__3z7rmTpDBt7iOwPfLn=pK=H4qX0Uumw@mail.gmail.com>
 <acc575d2-c90b-fbdc-8e92-0e140d2b65cc@treenet.co.nz>
 <CANfnjgLMg3FJTUDa7-Uqjqv2PZZJhqjFk28q-xumOEtwDzQzzQ@mail.gmail.com>
Message-ID: <68afc87c-92a8-ff62-09fa-507391e5bd57@treenet.co.nz>

On 28/08/18 11:52 PM, Hariharan Sethuraman wrote:
> Thanks Amos, let me explain my understanding. Please correct if wrong.
> The parent proxy (that is configured in cache_peer) does a basic
> authentication with the squid which will be transferred in plain text
> even if communication with cache_peer is going to be https based. Correct?
> 

You mean the connection to the peer uses TLS ?
 In that case the encryption is taken care of by the TLS layer. The
proxy and its peer are still talking regular HTTP over that connection.

The Basic auth password still needs to be unencrypted for Squid to
generate the correct HTTP message headers for the peer.

If you need secure passwords use Kerberos (Negotiate auth) between the
peers.

Amos


From maxonico at gmail.com  Tue Aug 28 13:08:19 2018
From: maxonico at gmail.com (Maximiliano Santa Cruz)
Date: Tue, 28 Aug 2018 10:08:19 -0300
Subject: [squid-users] Uninitialized SSL certificate database directory
In-Reply-To: <8fa1cb4e-35cb-574e-fc81-7376aeb5db49@treenet.co.nz>
References: <CAEVtZkvzRqJG38AbvEWHCmeC6wYBVKchWRu=-TjTduOuZ7YhcA@mail.gmail.com>
 <8fa1cb4e-35cb-574e-fc81-7376aeb5db49@treenet.co.nz>
Message-ID: <CAEVtZksAsexEkCv+BWuRA15-tosA6EH_gc5fDJrjna41NDiUaA@mail.gmail.com>

Thanks for your answer, here's the output after the upgrade:

[root at localhost ssl_cert]# squid -v
Squid Cache: Version 4.1
Service Name: squid

'--with-default-user=squid'

Error:

[root at localhost ssl_cert]# /usr/lib64/squid/security_file_certgen -c -s
/usr/local/squid/var/cache/squid/ssl_db -M 4MB
Initialization SSL db...
/usr/lib64/squid/security_file_certgen: Cannot create
/usr/local/squid/var/cache/squid/ssl_db

>From the cache.log:

2018/08/28 09:00:36 kid1| Set Current Directory to /var/spool/squid
(security_file_certgen): Uninitialized SSL certificate database directory:
/usr/local/squid/var/cache/squid/ssl_db. To initialize, run
"security_file_certgen -c -s /usr/local/squid/var/cache/squid/ssl_db".
...
2018/08/28 09:00:37 kid1| Accepting NAT intercepted SSL bumped HTTPS Socket
connections at local=[::]:3129 remote=[::] FD 17 flags=41
2018/08/28 09:00:37 kid1| WARNING: /usr/lib64/squid/security_file_certgen
-s /usr/local/squid/var/cache/squid/ssl_db -M 4MB #Hlpr1 exited
2018/08/28 09:00:37 kid1| Too few /usr/lib64/squid/security_file_certgen -s
/usr/local/squid/var/cache/squid/ssl_db -M 4MB processes are running (need
1/8)


Permissions:

drwxrwxrwx. 2 squid squid 6 Aug 28 08:45 ssl_db
drwxrwxrwx. 3 squid squid 20 Aug 28 08:45 squid
drwxrwxrwx. 3 squid squid 19 Aug 28 08:45 cache
drwxrwxrwx. 3 squid squid 19 Aug 28 08:45 var
drwxrwxrwx. 3 squid squid 17 Aug 28 08:45 squid

Status:

[root at localhost /]# systemctl status squid
? squid.service - Squid Web Proxy Server
   Loaded: loaded (/usr/lib/systemd/system/squid.service; enabled; vendor
preset: disabled)
   Active: failed (Result: exit-code) since Tue 2018-08-28 09:00:37 EDT;
2min 5s ago
     Docs: man:squid(8)
  Process: 4993 ExecStop=/usr/sbin/squidshut.sh (code=exited, status=255)

It doesn't matter if I create /squid with squid.squid user.group
permissions with rwx, the error is always the same.

I'm downloading https://www.pfsense.org, will try from there. Also attached
the squid.conf just in case.

Regards.

El mar., 28 ago. 2018 a las 8:28, Amos Jeffries (<squid3 at treenet.co.nz>)
escribi?:

> On 28/08/18 7:13 AM, Maximiliano Santa Cruz wrote:
> >
> > Hello everybody.
> >
> > I've been struggling with this error:
> >
> > (ssl_crtd): Uninitialized SSL certificate database directory:
> > /var/lib/ssl_db. To initialize, run "ssl_crtd -c -s /var/lib/ssl_db".
> >
> > I've tried a lot of workarounds from this mailing list but none of them
> > worked for me, these are the permissions that I have:
> >
> > [root at localhost admin]#  /usr/lib64/squid/ssl_crtd -c -s /var/lib/ssl_db
> >
> > [root at localhost admin]# ll /var/lib/ssl_db
> > total 4
> > drwxr-xr-x. 2 squid squid 6 Aug 27 15:06 certs
> > -rw-r--r--. 1 squid squid 0 Aug 27 15:06 index.txt
> > -rw-r--r--. 1 squid squid 1 Aug 27 15:06 size
> >
>
> Have you updated SELinux permissions after creating or changing the
> directory?
>
>  test -x /sbin/restorecon && restorecon /var/lib/ssl_db
>
>
> >
> > OS: CentOS 7
> > [root at localhost admin]# squid -v
> > Squid Cache: Version 3.5.27
> > Service Name: squid
> >
>
> Missing the configure options which will say what --with-default-user=
> was set to. That account needs to match the one with rights to the
> directory - it may not be "squid".
>
>
> Also, please update to Squid-4. It has much better support for SSL-Bump
> features than squid-3.x. Eliezer has packages available
>
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>


-- 
http://maxonico.dpi-studio.com.ar
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180828/3c8c421f/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: squid.conf
Type: application/octet-stream
Size: 2025 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180828/3c8c421f/attachment.obj>

From squid3 at treenet.co.nz  Wed Aug 29 02:41:21 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 29 Aug 2018 14:41:21 +1200
Subject: [squid-users] Uninitialized SSL certificate database directory
In-Reply-To: <CAEVtZksAsexEkCv+BWuRA15-tosA6EH_gc5fDJrjna41NDiUaA@mail.gmail.com>
References: <CAEVtZkvzRqJG38AbvEWHCmeC6wYBVKchWRu=-TjTduOuZ7YhcA@mail.gmail.com>
 <8fa1cb4e-35cb-574e-fc81-7376aeb5db49@treenet.co.nz>
 <CAEVtZksAsexEkCv+BWuRA15-tosA6EH_gc5fDJrjna41NDiUaA@mail.gmail.com>
Message-ID: <57867e3d-a451-ce1c-d4b6-d61057140f25@treenet.co.nz>

On 29/08/18 1:08 AM, Maximiliano Santa Cruz wrote:
> Thanks for your answer, here's the output after the upgrade:
> 
> [root at localhost ssl_cert]# squid -v
> Squid Cache: Version 4.1
> Service Name: squid
> 
> '--with-default-user=squid'?
> 
> Error:
> 
> [root at localhost ssl_cert]# /usr/lib64/squid/security_file_certgen -c -s
> /usr/local/squid/var/cache/squid/ssl_db -M 4MB
> Initialization SSL db...
> /usr/lib64/squid/security_file_certgen: Cannot create
> /usr/local/squid/var/cache/squid/ssl_db
> 
...
> Permissions:
> 
> drwxrwxrwx. 2 squid squid 6 Aug 28 08:45 ssl_db

Aha. This directory cannot be created because it already exists.

Run these:

 rm -rf /usr/local/squid/var/cache/squid/ssl_db

 su squid

 /usr/lib64/squid/security_file_certgen -c \
   -s /usr/local/squid/var/cache/squid/ssl_db \
   -M 4MB


Amos


From squid3 at treenet.co.nz  Wed Aug 29 02:44:24 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 29 Aug 2018 14:44:24 +1200
Subject: [squid-users] Streaming TV (e.g. ZDF) does not work
In-Reply-To: <trinity-5544d580-137e-4ce2-a734-ee82749455c1-1535457842893@3c-app-webde-bs09>
References: <trinity-5544d580-137e-4ce2-a734-ee82749455c1-1535457842893@3c-app-webde-bs09>
Message-ID: <9aeb1bb6-4b7e-3006-865d-e61e7e7c3e02@treenet.co.nz>

On 29/08/18 12:04 AM, scotty_beamer wrote:
> Hello!
> ?
> I am using squid for more than 10 years now, and today I am having a
> problem with streaming german tv.
> ?
> I am trying to open the following link.
> ?
> https://www.zdf.de/live-tv
> ?
> The browser seams to load data, but the stream never starts. I have not
> idea what could cause this problem.
> ?
> I have a german ip and if i masq the pc and route it everything works
> fine, what tells me it can not be geoip filtering.
> ?

What do you mean exactly by "masq the pc and route it" ?

What log information do you have about the two events? (failure and success)


Amos


From Walter.H at mathemainzel.info  Wed Aug 29 14:16:59 2018
From: Walter.H at mathemainzel.info (Walter H.)
Date: Wed, 29 Aug 2018 16:16:59 +0200
Subject: [squid-users] Error Message alert handshake failure
Message-ID: <5B86AADB.2020305@mathemainzel.info>

Hello,

what does this message

2018/08/29 16:11:28 kid1| Error negotiating SSL on FD 22: 
error:14077410:SSL routines:SSL23_GET_SERVER_HELLO:sslv3 alert handshake 
failure (1/-1/0)

in cache.log mean?

Thanks,
Walter


-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 3491 bytes
Desc: S/MIME Cryptographic Signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180829/3f7b2d8e/attachment.bin>

From a.zubarev at generium.ru  Wed Aug 29 14:29:43 2018
From: a.zubarev at generium.ru (=?koi8-r?B?+tXCwdLF1yDhzMXL08HOxNIg4czFy9PBzsTSz9fJ3g==?=)
Date: Wed, 29 Aug 2018 14:29:43 +0000
Subject: [squid-users] Transparent squid configuration problem.
In-Reply-To: <vmime.5b7ec2f3.7527.160262a5769a3ea3@ms249-lin-003.rotterdam.bazuin.nl>
References: <vmime.5b7eb8d3.4f0e.2fb6dbc5e166283@ms249-lin-003.rotterdam.bazuin.nl>
 <vmime.5b7ec2f3.7527.160262a5769a3ea3@ms249-lin-003.rotterdam.bazuin.nl>
Message-ID: <61EF6F4DD37F1245B186602EACC06454BA56170C@MEX1.generium.corp>

Thank you, Louis!

I've dowloaded Squid v. 4.2 from Sid, rebuilded it and configured to use ssl_bump  for whitelisted websites at step 2 (apple.com, google.com, etc.).
Without bumping some sites that using round-robin were unavailable with "SECURITY ALERT: Host header forgery detected..."
Now all is working at test environment.

I think thread is closed, thanks for help! It was cool!

From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of L.P.H. van Belle
Sent: Thursday, August 23, 2018 5:22 PM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Transparent squid configuration problem.

If i may suggest..

Use the squid version from debian sid.
Rebuilding these to stretch isnt that hard.

add  the sid sources, run : apt-get update
apt-get build-dep squid
apt-get source squid -b
then create a file repo ( or http repo ) and install squid.

or, if you dont want to rebuild them. you can get them here.
http://downloads.van-belle.nl/squid/
A squid 4.1 and 4.2 are available for Stretch im using now the 4.2 version.

If thats no option then have a look at https://wiki.squid-cache.org/Features/SslPeekAndSplice
See the configuration example, that a good example.
Change "bank" in habr.com   ;-)


Greetz,

Louis

________________________________
Van: ??????? ????????? ????????????? [mailto:a.zubarev at generium.ru]
Verzonden: donderdag 23 augustus 2018 15:42
Aan: L.P.H. van Belle; squid-users at lists.squid-cache.org<mailto:squid-users at lists.squid-cache.org>
Onderwerp: RE: [squid-users] Transparent squid configuration problem.
Thank you, Louis!
Is there some workaround? May be I can to put that's kind of sites without filtering?
From: squid-users <squid-users-bounces at lists.squid-cache.org<mailto:squid-users-bounces at lists.squid-cache.org>> On Behalf Of L.P.H. van Belle
Sent: Thursday, August 23, 2018 4:38 PM
To: squid-users at lists.squid-cache.org<mailto:squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] Transparent squid configuration problem.
i noticed the following :    dig caa habr.com
;; ANSWER SECTION:
habr.com.               3600    IN      CAA     0 iodef "mailto:iodef at habr.com"
habr.com.               3600    IN      CAA     0 issue "comodoca.com"
So you cant bump this site, its protecting its certificates with a CAA/DANE dns record.
Greetz,
Louis
________________________________
Van: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] Namens ??????? ????????? ?????????????
Verzonden: donderdag 23 augustus 2018 15:22
Aan: squid-users at lists.squid-cache.org<mailto:squid-users at lists.squid-cache.org>
Onderwerp: [squid-users] Transparent squid configuration problem.
Hi! I have some problems with configuration of squid.
What I need:
http/https transparent proxy server based on Debian Stretch with some blacklisted and whitelisted domains
I've used many tutorials and squid.wiki through installation process and it almost work! But I have the last problem.
When I tried to connect to some websites like a https://habr.com I have  got HTTP ERROR 503. Ive tried to find solution at forums but no one helped me. I know the answer is simple and its here but cannt find it by myself.
Here is my squid.conf, cache.log, access.log and iptables script.
Please help! :)
Squid.conf:
dns_v4_first on
acl network src 10.84.0.0/16
acl SSL_ports port 443
acl Safe_ports port 80        # http
acl Safe_ports port 21        # ftp
acl Safe_ports port 443        # https
acl Safe_ports port 70        # gopher
acl Safe_ports port 210        # wais
acl Safe_ports port 1025-65535    # unregistered ports
acl Safe_ports port 280        # http-mgmt
acl Safe_ports port 488        # gss-http
acl Safe_ports port 591        # filemaker
acl Safe_ports port 777        # multiling http
acl blacklist dstdomain "/etc/squid/acls/social_networks.txt" # list of blocked websites here
acl CONNECT method CONNECT
http_access deny blacklist
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow all
http_port 3130
http_port 3128 intercept
https_port 3129 intercept ssl-bump cert=/etc/squid/ssl_cert/vproxy2.pem key=/etc/squid/ssl_cert/vproxy2.pem
#always_direct allow all
ssl_bump server-first all
#sslproxy_cert_error deny all
#sslproxy_flags DONT_VERIFY_PEER
sslcrtd_program /usr/lib/squid/ssl_crtd -s /var/lib/ssl_db -M 4MB
sslcrtd_children 8 startup=1 idle=1
coredump_dir /var/spool/squid
# Add any of your own refresh_pattern entries above these.
refresh_pattern ^ftp:        1440    20%    10080
refresh_pattern ^gopher:    1440    0%    1440
refresh_pattern -i (/cgi-bin/|\?) 0    0%    0
refresh_pattern .        0    20%    4320
shutdown_lifetime 1 second
cache.log:
Maximum Resident Size: 123312 KB
Page faults with physical i/o: 7
2018/08/23 16:19:27 kid1| Logfile: closing log daemon:/var/log/squid/access.log
2018/08/23 16:19:27 kid1| Logfile Daemon: closing log daemon:/var/log/squid/access.log
2018/08/23 16:19:27 kid1| Open FD UNSTARTED     6 DNS Socket IPv6
2018/08/23 16:19:27 kid1| Open FD READ/WRITE    7 DNS Socket IPv4
2018/08/23 16:19:27 kid1| Open FD UNSTARTED    10 IPC UNIX STREAM Parent
2018/08/23 16:19:27 kid1| Squid Cache (Version 3.5.23): Exiting normally.
2018/08/23 16:19:32 kid1| Set Current Directory to /var/spool/squid
2018/08/23 16:19:32 kid1| Starting Squid Cache version 3.5.23 for x86_64-pc-linux-gnu...
2018/08/23 16:19:32 kid1| Service Name: squid
2018/08/23 16:19:32 kid1| Process ID 1209
2018/08/23 16:19:32 kid1| Process Roles: worker
2018/08/23 16:19:32 kid1| With 65535 file descriptors available
2018/08/23 16:19:32 kid1| Initializing IP Cache...
2018/08/23 16:19:32 kid1| DNS Socket created at [::], FD 6
2018/08/23 16:19:32 kid1| DNS Socket created at 0.0.0.0, FD 7
2018/08/23 16:19:32 kid1| Adding domain generium.corp from /etc/resolv.conf
2018/08/23 16:19:32 kid1| Adding nameserver 10.84.10.110 from /etc/resolv.conf
2018/08/23 16:19:32 kid1| Adding nameserver 10.83.10.120 from /etc/resolv.conf
2018/08/23 16:19:32 kid1| Logfile: opening log daemon:/var/log/squid/access.log
2018/08/23 16:19:32 kid1| Logfile Daemon: opening log /var/log/squid/access.log
2018/08/23 16:19:32 kid1| Local cache digest enabled; rebuild/rewrite every 3600/3600 sec
2018/08/23 16:19:32 kid1| Store logging disabled
2018/08/23 16:19:32 kid1| Swap maxSize 0 + 262144 KB, estimated 20164 objects
2018/08/23 16:19:32 kid1| Target number of buckets: 1008
2018/08/23 16:19:32 kid1| Using 8192 Store buckets
2018/08/23 16:19:32 kid1| Max Mem  size: 262144 KB
2018/08/23 16:19:32 kid1| Max Swap size: 0 KB
2018/08/23 16:19:32 kid1| Using Least Load store dir selection
2018/08/23 16:19:32 kid1| Set Current Directory to /var/spool/squid
2018/08/23 16:19:32 kid1| Finished loading MIME types and icons.
2018/08/23 16:19:32 kid1| HTCP Disabled.
2018/08/23 16:19:32 kid1| Pinger socket opened on FD 16
2018/08/23 16:19:32 kid1| Squid plugin modules loaded: 0
2018/08/23 16:19:32 kid1| Adaptation support is off.
2018/08/23 16:19:32 kid1| Accepting HTTP Socket connections at local=[::]:3130 remote=[::] FD 12 flags=9
2018/08/23 16:19:32 kid1| Accepting NAT intercepted HTTP Socket connections at local=[::]:3128 remote=[::] FD 13 flags=41
2018/08/23 16:19:32 kid1| Accepting NAT intercepted SSL bumped HTTPS Socket connections at local=[::]:3129 remote=[::] FD 14 flags=41
2018/08/23 16:19:32| pinger: Initialising ICMP pinger ...
2018/08/23 16:19:32| pinger: ICMP socket opened.
2018/08/23 16:19:32| pinger: ICMPv6 socket opened
2018/08/23 16:19:32| Pinger exiting.
2018/08/23 16:19:33 kid1| storeLateRelease: released 0 objects
Accesslog:
1535030545.214      0 10.84.77.52 TAG_NONE/503 382 GET https://habr.com/ - ORIGINAL_DST/178.248.237.68 text/html
1535030545.442    608 10.84.77.52 TAG_NONE/200 0 CONNECT 52.4.157.193:443 - ORIGINAL_DST/52.4.157.193 -
1535030545.442    617 10.84.77.52 TAG_NONE/200 0 CONNECT 52.204.140.44:443 - ORIGINAL_DST/52.204.140.44 -
1535030545.717    422 10.84.77.52 TAG_NONE/200 0 CONNECT 52.204.140.44:443 - ORIGINAL_DST/52.204.140.44 -
1535030545.879     36 10.84.77.52 TCP_MISS/204 415 POST https://www.google.ru/gen_204? - ORIGINAL_DST/64.233.162.94 text/html
1535030546.522     77 10.84.77.52 TAG_NONE/200 0 CONNECT 178.248.237.68:443 - ORIGINAL_DST/178.248.237.68 -
1535030546.623     95 10.84.77.52 TAG_NONE/200 0 CONNECT 178.248.237.68:443 - ORIGINAL_DST/178.248.237.68 -
1535030546.625      0 10.84.77.52 TAG_NONE/503 382 GET https://habr.com/ - ORIGINAL_DST/178.248.237.68 text/html
??????????? ? ??????????????????: ??? ??????????? ????????? ? ????? ?????????, ??????????? ? ????, ????? ????????? ???????????????? ??????????. ????????? ?????????? ??? ? ???, ??? ???? ??? ????????? ?? ????????????? ???, ?????????????, ??????????? ??? ??????????????? ??????????, ???????????? ? ????????? ?????????, ? ????? ????????????? ????? ???????? ?? ?????? ???? ?????????? ?????? ?????????. ???? ?? ???????? ??? ????????? ?? ??????, ??????????, ???????? ?? ???? ??????????? ?? ??????????? ????? ? ??????? ??? ?????????. Confidentiality notice: This e-mail transmission and any attachments included may contain confidential information. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or reliance upon the content of this e-mail is strictly prohibited. If you have received this e-mail transmission in error, please notify sender by e-mail and then delete this message from your inbox.
??????????? ? ??????????????????: ??? ??????????? ????????? ? ????? ?????????, ??????????? ? ????, ????? ????????? ???????????????? ??????????. ????????? ?????????? ??? ? ???, ??? ???? ??? ????????? ?? ????????????? ???, ?????????????, ??????????? ??? ??????????????? ??????????, ???????????? ? ????????? ?????????, ? ????? ????????????? ????? ???????? ?? ?????? ???? ?????????? ?????? ?????????. ???? ?? ???????? ??? ????????? ?? ??????, ??????????, ???????? ?? ???? ??????????? ?? ??????????? ????? ? ??????? ??? ?????????. Confidentiality notice: This e-mail transmission and any attachments included may contain confidential information. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or reliance upon the content of this e-mail is strictly prohibited. If you have received this e-mail transmission in error, please notify sender by e-mail and then delete this message from your inbox.
??????????? ? ??????????????????: ??? ??????????? ????????? ? ????? ?????????, ??????????? ? ????, ????? ????????? ???????????????? ??????????. ????????? ?????????? ??? ? ???, ??? ???? ??? ????????? ?? ????????????? ???, ?????????????, ??????????? ??? ??????????????? ??????????, ???????????? ? ????????? ?????????, ? ????? ????????????? ????? ???????? ?? ?????? ???? ?????????? ?????? ?????????. ???? ?? ???????? ??? ????????? ?? ??????, ??????????, ???????? ?? ???? ??????????? ?? ??????????? ????? ? ??????? ??? ?????????. Confidentiality notice: This e-mail transmission and any attachments included may contain confidential information. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or reliance upon the content of this e-mail is strictly prohibited. If you have received this e-mail transmission in error, please notify sender by e-mail and then delete this message from your inbox.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180829/7d2c80e9/attachment.htm>

From squid3 at treenet.co.nz  Wed Aug 29 16:54:58 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 30 Aug 2018 04:54:58 +1200
Subject: [squid-users] Error Message alert handshake failure
In-Reply-To: <5B86AADB.2020305@mathemainzel.info>
References: <5B86AADB.2020305@mathemainzel.info>
Message-ID: <984f677b-8542-fe8f-3bdc-c589f1f2bc43@treenet.co.nz>

On 30/08/18 2:16 AM, Walter H. wrote:
> Hello,
> 
> what does this message
> 
> 2018/08/29 16:11:28 kid1| Error negotiating SSL on FD 22:
> error:14077410:SSL routines:SSL23_GET_SERVER_HELLO:sslv3 alert handshake
> failure (1/-1/0)
> 
> in cache.log mean?

The OpenSSL used by your proxy is attempting to negotiate some feature
of TLS/SSL the remote server does not like (eg. SSLv3). The remote
server is rejecting the TLS connection. Probably because there is no
alternative feature that it will accept from the one(s) the proxy is
requesting.

If this is happening during a regular proxy->server connection then
likely your OpenSSL config settings need adjusting or library upgrading.

If this is happening during SSL-Bump, that is commonly seen when admin
attempts to restrict the available features to only the modern "safe"
ciphers etc. Only the set which are *also* supported by the client can
be negotiated with the server.


Amos


From eliezer at ngtech.co.il  Wed Aug 29 21:14:57 2018
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Thu, 30 Aug 2018 00:14:57 +0300
Subject: [squid-users] Squid ssl_bump always makes outbound connection
In-Reply-To: <DM6PR10MB2700DC96340B08316DC61B3DC3350@DM6PR10MB2700.namprd10.prod.outlook.com>
References: <DM6PR10MB2700DC96340B08316DC61B3DC3350@DM6PR10MB2700.namprd10.prod.outlook.com>
Message-ID: <003801d43fdd$597f3c20$0c7db460$@ngtech.co.il>

Thanks for testing.

 

I didn't got to this level yet.

I am trying to test couple aspects but I believe that this step is so fast
that I didn't noticed it even there.

 

Thanks,

Eliezer

 

----

Eliezer Croitoru <http://ngtech.co.il/lmgtfy/> 
Linux System Administrator
Mobile: +972-5-28704261
Email: eliezer at ngtech.co.il



 

From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On
Behalf Of Eric Lackey
Sent: Saturday, August 25, 2018 5:36 PM
To: squid-users at lists.squid-cache.org
Subject: [squid-users] Squid ssl_bump always makes outbound connection

 

Using squid-4.2-1.el7.x86_64

 

I'm looking at ways to optimize Squid when using ssl_bump. We use the peek &
splice approach now and it works pretty well.  

 

While running some tests, I noticed that Squid always makes an outbound
connection to the remote server regardless of when I terminate the
connection. I'm trying to build a configuration that denies traffic
immediately if the client SNI header doesn't match without making a
connection to the remote host.

 

Here is a very simple configuration that should terminate all connections
after step1. The connection is terminated, but by running a tcpdump at the
same time, I see that Squid still makes an outbound connection.

 

acl step1 at_step SslBump1

ssl_bump terminate step1

 

I would expect that if I terminate after step1, the connection to the remote
server should never be made. Can anyone help me understand why Squid would
still make the outbound connection in this instance? 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180830/08e6b907/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 11298 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180830/08e6b907/attachment.png>

From squid at mail.verwaiser.de  Thu Aug 30 14:03:09 2018
From: squid at mail.verwaiser.de (Verwaiser)
Date: Thu, 30 Aug 2018 09:03:09 -0500 (CDT)
Subject: [squid-users] supress some special error messages fromm access.log
Message-ID: <1535637789695-0.post@n4.nabble.com>

Hello,
since updating our proxy (now squid 4.03) I get very very many error
messages like the following examples:

/192.168.12.120 - - [30/Aug/2018:12:11:51 +0200] "NONE
error:transaction-end-before-headers NONE/0.0" 0 0 NONE:HIER_NONE
192.168.12.37 - biew [30/Aug/2018:12:11:51 +0200] "CONNECT
ad11.adfarm1.adition.com:443 HTTP/1.1" 200 1004 TCP_TUNNEL:HIER_DIRECT
192.168.12.117 - - [30/Aug/2018:12:11:51 +0200] "NONE
error:transaction-end-before-headers NONE/0.0" 0 0 NONE:HIER_NONE
192.168.12.37 - - [30/Aug/2018:12:11:52 +0200] "NONE
error:transaction-end-before-headers NONE/0.0" 0 0 NONE:HIER_NONE
192.168.12.135 - - [30/Aug/2018:12:11:52 +0200] "NONE
error:transaction-end-before-headers NONE/0.0" 0 0 NONE:HIER_NONE
192.168.12.52 - - [30/Aug/2018:12:11:52 +0200] "NONE
error:transaction-end-before-headers NONE/0.0" 0 0 NONE:HIER_NONE
192.168.12.135 - - [30/Aug/2018:12:11:52 +0200] "NONE
error:transaction-end-before-headers NONE/0.0" 0 0 NONE:HIER_NONE
192.168.12.220 - - [30/Aug/2018:12:11:52 +0200] "NONE
error:transaction-end-before-headers NONE/0.0" 0 0 NONE:HIER_NONE
192.168.12.52 - - [30/Aug/2018:12:11:52 +0200] "NONE
error:transaction-end-before-headers NONE/0.0" 0 0 NONE:HIER_NONE/

How can I get rid of these messages? Is it possible to construct an ACL like 

/acl noTransactionError url_regex -i "error:transaction-end-before-headers"
access_log none noTransactionError /

(doesnt work...)

Holger



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From rousskov at measurement-factory.com  Thu Aug 30 16:14:34 2018
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Thu, 30 Aug 2018 10:14:34 -0600
Subject: [squid-users] supress some special error messages fromm
 access.log
In-Reply-To: <1535637789695-0.post@n4.nabble.com>
References: <1535637789695-0.post@n4.nabble.com>
Message-ID: <e55c7506-aee4-3921-c048-d20049ecb1fe@measurement-factory.com>

On 08/30/2018 08:03 AM, Verwaiser wrote:

> since updating our proxy (now squid 4.03) I get very very many error
> messages like the following examples:
> 
> /192.168.12.120 - - [30/Aug/2018:12:11:51 +0200] "NONE
> error:transaction-end-before-headers NONE/0.0" 0 0 NONE:HIER_NONE

AFAIK, the following email summarizes the current status of those
transaction-end-before-headers log entries:
http://lists.squid-cache.org/pipermail/squid-users/2017-June/015781.html


> How can I get rid of these messages? Is it possible to construct an ACL

Probably yes. Look at your access log entries and try (a combination of)
simple ACLs that are likely to match logged default/zero values: port,
localport, proto, method, http_status, hier_code, and has.

When designing your ACLs, be as restrictive as you can to minimize the
chance of false positives (that you will never see logged and so you
will not know that they exist). It may be a good idea to log all matches
into a separate log so that you can easily double check that they all
have error:transaction-end-before-headers.

Once you figure it out, please post the winning combination here.


> like
> /acl noTransactionError url_regex -i "error:transaction-end-before-headers"
> access_log none noTransactionError /
> 
> (doesnt work...)

If url_regex does not work in this context, it is a bug. The same bug
probably makes the workaround mentioned above possible. You can
facilitate fixing this bug instead of fiddling with ACLs, of course.


HTH,

Alex.


From denisk19957 at gmail.com  Fri Aug 31 04:16:42 2018
From: denisk19957 at gmail.com (=?UTF-8?B?0JTQtdC90LjRgSDQodGC0LXQv9Cw0L3QvtCy?=)
Date: Fri, 31 Aug 2018 11:16:42 +0700
Subject: [squid-users] Fwd: squid-3.5.27 pfSense
In-Reply-To: <CAOcgsfo0DH=cpabtcjLVB0qGanApZoXV30Qsy7PSCX21HYc0qQ@mail.gmail.com>
References: <CAOcgsfo0DH=cpabtcjLVB0qGanApZoXV30Qsy7PSCX21HYc0qQ@mail.gmail.com>
Message-ID: <CAOcgsfrQ=5vHrQZUHE8O_FPnHgo2pBwOHQQzD_GMj7uZ2BpFtA@mail.gmail.com>

Good day!
I have a some problem: after working of 15-20 minutes (with squid.conf)
appears problem with SubjectAlternativeName for any HTTPS websites (for
more details see
https://forum.netgate.com/topic/134054/squid-3-5-27-ssl-custom-works-few-minutes-mitm-breakdown
).
I attach configuration squid file and debug logs of last 5 minutes of Squid
working.
 cache.log
<https://drive.google.com/file/d/15PYj86Qv-pdiwSHV_0oLC8BsS-oCkzIV/view?usp=drive_web>
 squid.conf
<https://drive.google.com/file/d/1IVT4VqIOELuAtQYd981ugpsrbaIEUp0O/view?usp=drive_web>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180831/1d79dfdf/attachment.htm>

From denisk19957 at gmail.com  Fri Aug 31 08:59:03 2018
From: denisk19957 at gmail.com (=?UTF-8?B?0JTQtdC90LjRgSDQodGC0LXQv9Cw0L3QvtCy?=)
Date: Fri, 31 Aug 2018 15:59:03 +0700
Subject: [squid-users] =?utf-8?q?=28no_subject=29?=
Message-ID: <CAOcgsfpZ_Y1tyqX-Z47prGOf6BdJGrsy5_yGJoesFErXr3LDHA@mail.gmail.com>

Good day!
I have a some problem with Squid-3.5.27: after working of 15-20 minutes
appears problem with SubjectAlternativeName for any HTTPS websites (for
more details see
https://forum.netgate.com/topic/134054/squid-3-5-27-ssl-custom-works-few-minutes-mitm-breakdown
).
P.S. I can attach logs of last 5 minutes Squid's working and config file in
next message.

P.P.S. I was writing  such message few times with attached files, but I
think, that it was dropped by antispam filters
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180831/8f8d1055/attachment.htm>

From denisk19957 at gmail.com  Fri Aug 31 09:06:17 2018
From: denisk19957 at gmail.com (=?UTF-8?B?0JTQtdC90LjRgSDQodGC0LXQv9Cw0L3QvtCy?=)
Date: Fri, 31 Aug 2018 16:06:17 +0700
Subject: [squid-users] Fwd:  (no subject)
In-Reply-To: <CAOcgsfpZ_Y1tyqX-Z47prGOf6BdJGrsy5_yGJoesFErXr3LDHA@mail.gmail.com>
References: <CAOcgsfpZ_Y1tyqX-Z47prGOf6BdJGrsy5_yGJoesFErXr3LDHA@mail.gmail.com>
Message-ID: <CAOcgsfp9HEiCKNXeQrWQUXM2eR_j-EAEKO2wh19QW3vw-soh7Q@mail.gmail.com>

Good day!
I have a some problem with Squid-3.5.27: after working of 15-20 minutes
appears problem with SubjectAlternativeName for any HTTPS websites (for
more details see
https://forum.netgate.com/topic/134054/squid-3-5-27-ssl-custom-works-few-minutes-mitm-breakdown
).
P.S. I can attach logs of last 5 minutes Squid's working and config file in
next message.

P.P.S. I was writing  such message few times with attached files, but I
think, that it was dropped by antispam filters
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180831/ce8adca5/attachment.htm>

From Antony.Stone at squid.open.source.it  Fri Aug 31 09:49:17 2018
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Fri, 31 Aug 2018 11:49:17 +0200
Subject: [squid-users] (no subject)
In-Reply-To: <CAOcgsfpZ_Y1tyqX-Z47prGOf6BdJGrsy5_yGJoesFErXr3LDHA@mail.gmail.com>
References: <CAOcgsfpZ_Y1tyqX-Z47prGOf6BdJGrsy5_yGJoesFErXr3LDHA@mail.gmail.com>
Message-ID: <201808311149.17414.Antony.Stone@squid.open.source.it>

On Friday 31 August 2018 at 10:59:03, ????? ???????? wrote:

> Good day!
> I have a some problem with Squid-3.5.27: after working of 15-20 minutes
> appears problem with SubjectAlternativeName for any HTTPS websites (for
> more details see
> https://forum.netgate.com/topic/134054/squid-3-5-27-ssl-custom-works-few-mi
> nutes-mitm-breakdown ).
> P.S. I can attach logs of last 5 minutes Squid's working and config file in
> next message.
> 
> P.P.S. I was writing  such message few times with attached files, but I
> think, that it was dropped by antispam filters

Making sure you have a Subject line would be a good start to dealing with that 
problem.


Antony.

-- 
Don't procrastinate - put it off until tomorrow.

                                                   Please reply to the list;
                                                         please *don't* CC me.


From denisk19957 at gmail.com  Fri Aug 31 09:53:13 2018
From: denisk19957 at gmail.com (=?UTF-8?B?0JTQtdC90LjRgSDQodGC0LXQv9Cw0L3QvtCy?=)
Date: Fri, 31 Aug 2018 16:53:13 +0700
Subject: [squid-users] Squid-3.5.27 MITM stopped work after few minutes
Message-ID: <CAOcgsfrk0YqQR049ZxvubZDDYn4MBydPgoU=RQDhhycoOQOFQw@mail.gmail.com>

Good day!
I have a some problem with Squid-3.5.27: after working of 15-20 minutes
appears problem with SubjectAlternativeName for any HTTPS websites (for
more details see
https://forum.netgate.com/topic/134054/squid-3-5-27-ssl-custom-works-few-minutes-mitm-breakdown
).
P.S. I can attach logs of last 5 minutes Squid's working and config file in
next message.

P.P.S. I was writing  such message few times with attached files, but I
think, that it was dropped by antispam filters
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180831/1d484ebe/attachment.htm>

From Antony.Stone at squid.open.source.it  Fri Aug 31 10:03:26 2018
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Fri, 31 Aug 2018 12:03:26 +0200
Subject: [squid-users] Squid-3.5.27 MITM stopped work after few minutes
In-Reply-To: <CAOcgsfrk0YqQR049ZxvubZDDYn4MBydPgoU=RQDhhycoOQOFQw@mail.gmail.com>
References: <CAOcgsfrk0YqQR049ZxvubZDDYn4MBydPgoU=RQDhhycoOQOFQw@mail.gmail.com>
Message-ID: <201808311203.26691.Antony.Stone@squid.open.source.it>

On Friday 31 August 2018 at 11:53:13, ????? ???????? wrote:

> Good day!
> I have a some problem with Squid-3.5.27: after working of 15-20 minutes
> appears problem with SubjectAlternativeName for any HTTPS websites (for
> more details see
> https://forum.netgate.com/topic/134054/squid-3-5-27-ssl-custom-works-few-mi
> nutes-mitm-breakdown ).

That thread seems to deal exclusively with Chrome as the browser.

Please can you try the same tests with other browsers (Firefox, Safari, Opera, 
Edge, whatever you have available) and report whether the results are 
different?

> P.S. I can attach logs of last 5 minutes Squid's working and config file in
> next message.

Yes, please do that (rather than posting multiple copies of the same message).


Regards,


Antony.

-- 
There's a good theatrical performance about puns on in the West End.  It's a 
play on words.

                                                   Please reply to the list;
                                                         please *don't* CC me.


From denisk19957 at gmail.com  Fri Aug 31 11:12:00 2018
From: denisk19957 at gmail.com (=?UTF-8?B?0JTQtdC90LjRgSDQodGC0LXQv9Cw0L3QvtCy?=)
Date: Fri, 31 Aug 2018 18:12:00 +0700
Subject: [squid-users] Fwd: Squid-3.5.27 MITM stopped work after few minutes
In-Reply-To: <CAOcgsfp0ppk1-St7r1b4EsURofh_fe8sbqA0AYp8+NFCH7F3Bg@mail.gmail.com>
References: <CAOcgsfrk0YqQR049ZxvubZDDYn4MBydPgoU=RQDhhycoOQOFQw@mail.gmail.com>
 <201808311203.26691.Antony.Stone@squid.open.source.it>
 <CAOcgsfp0ppk1-St7r1b4EsURofh_fe8sbqA0AYp8+NFCH7F3Bg@mail.gmail.com>
Message-ID: <CAOcgsfqygedTtA+uG5ogqpSgLuB8TpjD3jn_feqvwVfSKuNaMA@mail.gmail.com>

 cache.log
<https://drive.google.com/file/d/15PYj86Qv-pdiwSHV_0oLC8BsS-oCkzIV/view?usp=drive_web>

 squid.conf
<https://drive.google.com/file/d/1IVT4VqIOELuAtQYd981ugpsrbaIEUp0O/view?usp=drive_web>

Such problem appears on Firefox browser too.

P.S. Sorry for spamming of the same message copies
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180831/9665d0a3/attachment.htm>

From squid3 at treenet.co.nz  Fri Aug 31 13:05:44 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 1 Sep 2018 01:05:44 +1200
Subject: [squid-users] Fwd: Squid-3.5.27 MITM stopped work after few
 minutes
In-Reply-To: <CAOcgsfqygedTtA+uG5ogqpSgLuB8TpjD3jn_feqvwVfSKuNaMA@mail.gmail.com>
References: <CAOcgsfrk0YqQR049ZxvubZDDYn4MBydPgoU=RQDhhycoOQOFQw@mail.gmail.com>
 <201808311203.26691.Antony.Stone@squid.open.source.it>
 <CAOcgsfp0ppk1-St7r1b4EsURofh_fe8sbqA0AYp8+NFCH7F3Bg@mail.gmail.com>
 <CAOcgsfqygedTtA+uG5ogqpSgLuB8TpjD3jn_feqvwVfSKuNaMA@mail.gmail.com>
Message-ID: <f54fc02d-7d18-f593-d31c-091c36c864f2@treenet.co.nz>

On 31/08/18 11:12 PM, ????? ???????? wrote:
> 
> 
> ?cache.log
> <https://drive.google.com/file/d/15PYj86Qv-pdiwSHV_0oLC8BsS-oCkzIV/view?usp=drive_web>
> 
> ?squid.conf
> <https://drive.google.com/file/d/1IVT4VqIOELuAtQYd981ugpsrbaIEUp0O/view?usp=drive_web>
> 
> Such problem appears on Firefox browser too.
> 

The cache.log is not very useful because you configured Squid to not
even check any TLS/SSL problems:

 sslproxy_flags DONT_VERIFY_PEER


... and you told Squid not to bother telling you about any problems that
did come up:

  sslproxy_cert_error allow all

Please remove those lines from your config. They are both extremely bad
ideas. The problems still happen and still cause more issues - but only
your clients/users can see the nasty behaviour they cause.
 You *want* Squid to inform you about security problems. So you have a
chance to fix them before users come knocking.


Along with that your ssl_bump configuration tells Squid to peek at the
TLS clientHello and bump immediately - before any details such as server
name or server certificate features are known:

 # step 1 or step2 - only if domain is known AND matches
 ssl_bump splice noBump

 # step1 always
 ssl_bump peek step1

 # step2 always
 ssl_bump bump all

 # step3 never reached.


That is what we call client-first bumping and the behaviour you describe
as happening (certs generated when only IPs are known) is expected. That
and many other related problems are the reasons it was deprecated in
Squid-3.4 and replaced with the peek and splice feature.

If that type of bumping is what you want then the problem is something
you chose to happen. The side effects are yours.

Otherwise you need to have a rule doing "stare" action at step2 to get
server details before bumping - which then is at step3.
 Be aware that with stare any sites in noBump which Squid could not
identify at the step1 and step2 phases cannot be spliced but have to be
bump'd or terminate'd.


Amos


From ahmed.zaeem at netstream.ps  Fri Aug 31 15:44:41 2018
From: ahmed.zaeem at netstream.ps (--Ahmad--)
Date: Fri, 31 Aug 2018 18:44:41 +0300
Subject: [squid-users] internet squid with https and just for domain
 resolution not for caching or so
Message-ID: <523CA091-849F-4FB3-B0CA-E24ED096F57D@netstream.ps>

Dear Folks .

i ask here 

if i wan to enable squid into intercpt/transparent or transparent TCP_connect 

i dont want to decrypt the message 

all what i need say client requested google.com <http://google.com/>

i can from router to send the packet to the proxy server via PBR or so and all what i need is squid intercept this msg and do the name resolution and based on it , it has the tcp_outgoing address as IPV6 address

agian  dont  want any certificate error or so 

possible ?



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180831/981f84eb/attachment.htm>

From Antony.Stone at squid.open.source.it  Fri Aug 31 16:45:17 2018
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Fri, 31 Aug 2018 18:45:17 +0200
Subject: [squid-users] internet squid with https and just for domain
	resolution not for caching or so
In-Reply-To: <523CA091-849F-4FB3-B0CA-E24ED096F57D@netstream.ps>
References: <523CA091-849F-4FB3-B0CA-E24ED096F57D@netstream.ps>
Message-ID: <201808311845.18112.Antony.Stone@squid.open.source.it>

On Friday 31 August 2018 at 17:44:41, --Ahmad-- wrote:

> Dear Folks .
> 
> i ask here
> 
> if i wan to enable squid into intercpt/transparent or transparent
> TCP_connect
> 
> i dont want to decrypt the message
> 
> all what i need say client requested google.com <http://google.com/>

I assume you meant to say https://google.com ?

> i can from router to send the packet to the proxy server via PBR or so and
> all what i need is squid intercept this msg and do the name resolution and
> based on it , it has the tcp_outgoing address as IPV6 address
> 
> agian  dont  want any certificate error or so
> 
> possible ?

No.

If the client is configured not to use a proxy (and you say you want to use 
intercept mode) then the client itslf will already have done the DNS lookup 
(otherwise it wouldn't know which IP address to send the request to).

If Squid then intercepts the request, it will already have a destination IP 
address, and Squid has no reason to do a DNS lookup.  If it didn't and perhaps 
found a different IP address than the client did (which is entirely possible 
with CDNs etc) and decided to send the request there instead, things would 
break once the reply got back to the client because it would see a reply from 
an address it didn't send a request to.

If in fact you are asking how to convert IPv4 requests to IPv6 requests then I 
seriously doubt that this can be done using Squid in intercept mode at all 
(however I've never wanted to try it).



Antony.

-- 
"I find the whole business of religion profoundly interesting.  But it does 
mystify me that otherwise intelligent people take it seriously."

 - Douglas Adams

                                                   Please reply to the list;
                                                         please *don't* CC me.


From rousskov at measurement-factory.com  Fri Aug 31 16:57:44 2018
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Fri, 31 Aug 2018 10:57:44 -0600
Subject: [squid-users] internet squid with https and just for domain
 resolution not for caching or so
In-Reply-To: <523CA091-849F-4FB3-B0CA-E24ED096F57D@netstream.ps>
References: <523CA091-849F-4FB3-B0CA-E24ED096F57D@netstream.ps>
Message-ID: <c439eab7-acbc-d6c4-d484-86fd63e2f4f6@measurement-factory.com>

On 08/31/2018 09:44 AM, --Ahmad-- wrote:

> if i wan to enable squid into intercpt/transparent or transparent
> TCP_connect?
> 
> i dont want to decrypt the message?
> 
> all what i need say client requested google.com

Extracting intended domain name information is usually possible today by
examining TLS SNI values.

However, the few folks controlling most of the world HTTPS traffic are
working on making domain name information unavailable to (or at least
essentially unusable by) proxies. Thus, I would not expect SNI-based
logic to work long-term.

Alex.


