<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid proxy server to log HTTPS traffic
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20proxy%20server%20to%20log%20HTTPS%20traffic&In-Reply-To=%3CCAKWnCHRWhk96_UbZ-BXyhaDe1xKcdQQ3o_tfu1QXSbHHg5Jvww%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018824.html">
   <LINK REL="Next"  HREF="018828.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid proxy server to log HTTPS traffic</H1>
    <B>Helen Rai</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20proxy%20server%20to%20log%20HTTPS%20traffic&In-Reply-To=%3CCAKWnCHRWhk96_UbZ-BXyhaDe1xKcdQQ3o_tfu1QXSbHHg5Jvww%40mail.gmail.com%3E"
       TITLE="[squid-users] Squid proxy server to log HTTPS traffic">helen.rai at nepallink.net
       </A><BR>
    <I>Thu Aug  2 07:05:48 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="018824.html">[squid-users] compiler Error
</A></li>
        <LI>Next message (by thread): <A HREF="018828.html">[squid-users] Squid proxy server to log HTTPS traffic
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18826">[ date ]</a>
              <a href="thread.html#18826">[ thread ]</a>
              <a href="subject.html#18826">[ subject ]</a>
              <a href="author.html#18826">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

The MikroTik router I am using has 24 ports.
There is 4 department and for each department 4 ports of Mikrotik is given.
That is
Department A has 4 computers and each of them is connected with ethernet
cable from port 4,5,6 and 7 of Mikrotik Router.
Department B, C, and D have the same number of the computer as Department A
and they are connected to 8,9,10,11 and 12,13,14,15 and 16,17,18,19 port of
Mikrotik respectively with the ethernet cable.
Each department is in different network (different private IP range).
Each department is later combined into each bridge interface.
Port 20 of Mikrotik is connected to Unifi-AP, which is broadcasting WiFi
signals. Mobile devices and Laptop which are not connected via ethernet
cable uses WiFi signals.
One of the port from Department A is connected to Raspberry Pi where squid
is configured.
Now what I want to do is log all the web traffic that is requested from
those devices which are using WiFi.
I have attached the configuration of squid and Mikrotik which I had done
for HTTP. (Please note that when I had done this for HTTP, the squid wasn't
configured with --enable-SSL or --enable-crtd)

I had referred some online sites to do for HTTPS but none of them worked.
Please help if anyone knows how to log all HTTPS request.

I have attached document regarding the rules applied in Mikrotik and squid3
configuration for HTTP.



----
Helen Rai
Platform operations, Nepallink
44260822 || 9841262275 || <A HREF="https://lists.squid-cache.org/listinfo/squid-users">support at nepallink.net</A> &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">abuse at nepallink.net</A>&gt;
<A HREF="http://www.nepallink.net">http://www.nepallink.net</A> || Link Road, Khusibu
&lt;<A HREF="http://www.facebook.com/pages/NepalLink-Network/334213043398796">http://www.facebook.com/pages/NepalLink-Network/334213043398796</A>&gt;
&lt;<A HREF="http://twitter.com/nepallink">http://twitter.com/nepallink</A>&gt;

On Mon, Jul 30, 2018 at 7:34 PM, Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; wrote:

&gt;<i> On 30/07/18 22:58, Helen Rai wrote:
</I>&gt;<i> &gt; Hi,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I am using  Mikrotik Routerboard Model CRS125-24G-1S-2HnD which Links
</I>&gt;<i> &gt; the internal network with WAN. One of the port is connected with WiFi
</I>&gt;<i> &gt; Router which is broadcasting WiFi signal. Some of the devices work on
</I>&gt;<i> &gt; WiFi network. I have installed squid3 (Version 3.5.27) in Raspberry Pi
</I>&gt;<i> &gt; which is also connected with Mikrotik. Squid is installed with
</I>&gt;<i> --enable-SSL.
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> The --enable-ssl option was removed in Squid-3.5.
</I>&gt;<i> &lt;<A HREF="http://www.squid-cache.org/Versions/v3/3.5/squid-3.5.28-">http://www.squid-cache.org/Versions/v3/3.5/squid-3.5.28-</A>
</I>&gt;<i> RELEASENOTES.html#ss4.3&gt;.
</I>&gt;<i> Use --with-openssl instead, and ensure the Debian libssl1.0-dev package
</I>&gt;<i> is installed when building.
</I>&gt;<i>
</I>&gt;<i> To see any URLs inside the HTTPS you will need --enable-ssl-crtd.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; Now, what I want to do is Redirect or log all the HTTP and HTTPS
</I>&gt;<i> &gt; requests are done from devices which are in WiFi network to squid proxy
</I>&gt;<i> &gt; server.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I have tried doing it for months now, I am able to log all HTTP traffic
</I>&gt;<i> &gt; but am unable to do it for HTTPS.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Please help me with this and if you need any detail from me, please
</I>&gt;<i> &gt; contact me.
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> If using the correct build option(s) does not resolve your problem we
</I>&gt;<i> will need to know what the Mikrotik routign settings, Rasberry Pi
</I>&gt;<i> routing and NAT settings, and squid.conf *_port lines are to provide any
</I>&gt;<i> assistance.
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20180802/a460595c/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20180802/a460595c/attachment.htm</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Mikrotik_rules
Type: application/octet-stream
Size: 320 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20180802/a460595c/attachment.obj">http://lists.squid-cache.org/pipermail/squid-users/attachments/20180802/a460595c/attachment.obj</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: squid_conf
Type: application/octet-stream
Size: 1104 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20180802/a460595c/attachment-0001.obj">http://lists.squid-cache.org/pipermail/squid-users/attachments/20180802/a460595c/attachment-0001.obj</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="018824.html">[squid-users] compiler Error
</A></li>
	<LI>Next message (by thread): <A HREF="018828.html">[squid-users] Squid proxy server to log HTTPS traffic
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18826">[ date ]</a>
              <a href="thread.html#18826">[ thread ]</a>
              <a href="subject.html#18826">[ subject ]</a>
              <a href="author.html#18826">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
