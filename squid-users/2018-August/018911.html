<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid as reverse proxy for two or more webs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20as%20reverse%20proxy%20for%20two%20or%20more%20webs&In-Reply-To=%3C1533911191967-0.post%40n4.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018906.html">
   <LINK REL="Next"  HREF="018912.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid as reverse proxy for two or more webs</H1>
    <B>erdosain9</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20as%20reverse%20proxy%20for%20two%20or%20more%20webs&In-Reply-To=%3C1533911191967-0.post%40n4.nabble.com%3E"
       TITLE="[squid-users] Squid as reverse proxy for two or more webs">erdosain9 at gmail.com
       </A><BR>
    <I>Fri Aug 10 14:26:31 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="018906.html">[squid-users] Squid as reverse proxy for two or more webs
</A></li>
        <LI>Next message (by thread): <A HREF="018912.html">[squid-users] Squid as reverse proxy for two or more webs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18911">[ date ]</a>
              <a href="thread.html#18911">[ thread ]</a>
              <a href="subject.html#18911">[ subject ]</a>
              <a href="author.html#18911">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
&gt;<i> php.mydomain.lan 192.168.1.223
</I>&gt;<i> ticket.mydomain.lan 192.168.1.246
</I>
&gt;<i>.. and clients never connect to the above directly. So these domains are
</I>&gt;<i>never to be accessed by users/clients.
</I>
The client can connect directly from the domain. (i mean they can connect
directly in work, but i want to do this (proxy reverse, for when they are at
home...) I dont public yet nothing of this, im trying to do it first inside
my network.

&gt;<i>If (as I suspect) the above statements are not true, then your naming is
</I>&gt;<i>the first thing that is wrong.
</I>
Why?

&gt;<i>The domain name(s) which your clients access should point to the proxy.
</I>&gt;<i>There can be multiple.
</I>
I dont get this.

&gt;<i>Right now your ticket_acl and php_acl are exactly the same. So they are
</I>&gt;<i>telling Squid that both peers are providing identical content (ie both
</I>&gt;<i>are authoritative for anything inside *.mydomain.lan). The first of the
</I>&gt;<i>available peers will be used, unless it starts to overload then the
</I>&gt;<i>second will start receiving the traffic.
</I>

&gt;<i>To send traffic to one of the peers and not the other you need some way
</I>&gt;<i>to distinguish between them.
</I>
&gt;<i>Normally you would have the ticket.* and php.* domain names both
</I>&gt;<i>pointing at Squid (192.168.1.21) so your ACLs can check for and use the
</I>&gt;<i>domain name to identify which peer is supposed to receive it.
</I>
I create two entries pointing to squid in DNS now.
site1.mydomain.lan
site2.mydomain.lan

&gt;<i>The config example you want to follow is
</I>&gt;<i>&lt;<A HREF="https://wiki.squid-cache.org/ConfigExamples/Reverse/MultipleWebservers&amp;gt;.">https://wiki.squid-cache.org/ConfigExamples/Reverse/MultipleWebservers&gt;.</A>
</I>
I read that... but i dont get what im doing wrong.


this is the config now.

http_port 192.168.1.21:80 accel vhost


cache_peer 192.168.1.246 parent 80 0 proxy-only name=site1
cache_peer 192.168.1.223 parent 80 0 proxy-only name=site2


acl soporte_acl dstdomain ticket.MYDOMAIN.lan
http_access allow soporte_acl
cache_peer_access site1 allow soporte_acl


acl phplists_acl dstdomain php.MYDOMAIN.lan
http_access allow phplists_acl
cache_peer_access site2 allow phplists_acl

------------------------------------------------------------

But, i get this error

&quot; Unable to forward this request at this time.&quot;

1533911112.071      1 192.168.6.20 TCP_MISS/500 4605 GET
<A HREF="http://site1.MYDOMAIN.lan/">http://site1.MYDOMAIN.lan/</A> - HIER_NONE/- text/html
1533911112.193      0 192.168.6.20 TCP_MEM_HIT_ABORTED/200 4274 GET
<A HREF="http://reverse.MYDOMAIN.lan/squid-internal-static/icons/SN.png">http://reverse.MYDOMAIN.lan/squid-internal-static/icons/SN.png</A> - HIER_NONE/-
image/png
1533911124.117      0 192.168.6.20 TCP_MISS/500 4605 GET
<A HREF="http://site2.MYDOMAIN.lan/">http://site2.MYDOMAIN.lan/</A> - HIER_NONE/- text/html
1533911124.217      0 192.168.6.20 TCP_MEM_HIT_ABORTED/200 4274 GET
<A HREF="http://reverse.MYDOMAIN.lan/squid-internal-static/icons/SN.png">http://reverse.MYDOMAIN.lan/squid-internal-static/icons/SN.png</A> - HIER_NONE/-
image/png

Thanks to all.



--
Sent from: <A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html">http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html</A>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="018906.html">[squid-users] Squid as reverse proxy for two or more webs
</A></li>
	<LI>Next message (by thread): <A HREF="018912.html">[squid-users] Squid as reverse proxy for two or more webs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18911">[ date ]</a>
              <a href="thread.html#18911">[ thread ]</a>
              <a href="subject.html#18911">[ subject ]</a>
              <a href="author.html#18911">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
