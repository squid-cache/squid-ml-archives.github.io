<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] About SSL peek-n-splice/bump configurations
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20About%20SSL%20peek-n-splice/bump%20configurations&In-Reply-To=%3C58014777-2b9c-7630-80dd-877c2d2af9d2%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018930.html">
   <LINK REL="Next"  HREF="018933.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] About SSL peek-n-splice/bump configurations</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20About%20SSL%20peek-n-splice/bump%20configurations&In-Reply-To=%3C58014777-2b9c-7630-80dd-877c2d2af9d2%40measurement-factory.com%3E"
       TITLE="[squid-users] About SSL peek-n-splice/bump configurations">rousskov at measurement-factory.com
       </A><BR>
    <I>Sun Aug 12 23:49:58 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="018930.html">[squid-users] About SSL peek-n-splice/bump configurations
</A></li>
        <LI>Next message (by thread): <A HREF="018933.html">[squid-users] About SSL peek-n-splice/bump configurations
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18931">[ date ]</a>
              <a href="thread.html#18931">[ thread ]</a>
              <a href="subject.html#18931">[ subject ]</a>
              <a href="author.html#18931">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 08/12/2018 04:09 PM, Julian Perconti wrote:

&gt;<i> I would like to know which of these two cfg's are &quot;better&quot; or &quot;more secure&quot;
</I>&gt;<i> when a site/domain is spliced, bumped, etc.
</I>
It is impossible to answer that question without knowing how _you_
define &quot;better&quot; or &quot;more secure&quot;.


&gt;<i> acl noBumpSites ssl::server_name_regex -i &quot;/etc/squid/url.nobump&quot;
</I>
&gt;<i> # ssl_bump option 1: (with this I don't see the domain in &quot;TUNNEL&quot; line,
</I>&gt;<i> just the IP addr.)
</I>&gt;<i> 
</I>&gt;<i> ssl_bump peek step1
</I>&gt;<i> ssl_bump peek step2 noBumpSites
</I>&gt;<i> ssl_bump splice step3 noBumpSites
</I>&gt;<i> ssl_bump stare step2
</I>&gt;<i> ssl_bump bump step3
</I>&gt;<i> 
</I>&gt;<i> # ssl_bump option 2: (with this I see the domain in &quot;TUNNEL&quot; line.)
</I>&gt;<i> 
</I>&gt;<i> ssl_bump peek step1
</I>&gt;<i> ssl_bump splice noBumpSites
</I>&gt;<i> ssl_bump bump all
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> And (if possible) could anyone explain the differnce between these 2 cfg's ?
</I>
Bugs notwithstanding, Option 1 looks at the TLS server Hello details
(step2) before splicing or bumping the connections (at step3). Option 2
does not -- it splices or bumps based on TLS client Hello info only.

Option 1 should give Squid/you more information about the server when
splicing the two connections. For example, you can use server
certificate info during step3 and when logging.

Option 1 should give the client more information about the server when
bumping the client -- the client will get a mimicked server certificate
detail with this option.

I believe the information obtained at each step is documented at
<A HREF="https://wiki.squid-cache.org/Features/SslPeekAndSplice">https://wiki.squid-cache.org/Features/SslPeekAndSplice</A>

Please note that your

  ssl_bump splice step3 noBumpSites

is a bit risky because your noBumpSites may match differently on each
step (as it gets more reliable information). It could match at step2 but
not match at step3 or vice versa, but the decision to splice (or bump)
is essentially made at step2 -- if you peeked at step2, then you should
be splicing or terminating at step3 (and if you stared at step2, then
you should be bumping or terminating at step3). Your rules may not
follow that principle if noBumpSites matching changes.


&gt;<i> with Option 1 I don't see the domain in &quot;TUNNEL&quot; line,
</I>&gt;<i> just the IP addr.)
</I>
I doubt that is how it is supposed to work. When splicing, Option 1
should have the same or more information so it should log the domain
name if Option 2 has the domain name. If you are comparing log lines for
identical transactions, then this could be a Squid bug.

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="018930.html">[squid-users] About SSL peek-n-splice/bump configurations
</A></li>
	<LI>Next message (by thread): <A HREF="018933.html">[squid-users] About SSL peek-n-splice/bump configurations
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18931">[ date ]</a>
              <a href="thread.html#18931">[ thread ]</a>
              <a href="subject.html#18931">[ subject ]</a>
              <a href="author.html#18931">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
