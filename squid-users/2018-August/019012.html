<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid + Squidguard Youtube URL video filtering
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20%2B%20Squidguard%20Youtube%20URL%20video%20filtering&In-Reply-To=%3C33610608-0e5a-dadd-17fb-4afc8e43bbfe%40urlfilterdb.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019011.html">
   <LINK REL="Next"  HREF="019013.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid + Squidguard Youtube URL video filtering</H1>
    <B>Marcus Kool</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20%2B%20Squidguard%20Youtube%20URL%20video%20filtering&In-Reply-To=%3C33610608-0e5a-dadd-17fb-4afc8e43bbfe%40urlfilterdb.com%3E"
       TITLE="[squid-users] Squid + Squidguard Youtube URL video filtering">marcus.kool at urlfilterdb.com
       </A><BR>
    <I>Fri Aug 17 16:22:44 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019011.html">[squid-users] Squid + Squidguard Youtube URL video filtering
</A></li>
        <LI>Next message (by thread): <A HREF="019013.html">[squid-users] Fetch missing certificate feature of Squid_v4
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19012">[ date ]</a>
              <a href="thread.html#19012">[ thread ]</a>
              <a href="subject.html#19012">[ subject ]</a>
              <a href="author.html#19012">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I cannot tell you how to do it with DNS entries since I think it is impossible and therefore I asked Benjamin to explain.

Allowing one single video and blocking all other videos on Youtube is not easy.
One cannot block by domain but must filter by full URL.
When HTTPS is used, full URLs can only be obtained/filtered using ssl_bump in peek+bump mode which is doable but not easy.
Once you have peek+bump working you can make two categories in ufdbGuard:
    category youtube with
       youtube.com/watch
    category allowedyoutubevideos with
       youtube.com/watch?v=ff9sDLGtnK8
and an acl like
    acl {
       allSystems {
          pass allowedyoutubevideos !youtube ...
       }
    ...

The above allows access to www.youtube.com but not to the blocked videos.
This is necessary since the youtube site also uses a set of URLs like
     <A HREF="https://www.youtube.com/sw.js">https://www.youtube.com/sw.js</A>
     <A HREF="https://www.youtube.com/service_ajax?name=signalServiceEndpoint">https://www.youtube.com/service_ajax?name=signalServiceEndpoint</A>
     etc.
which all must be allowed to be able to display/allow your single video.

Marcus


On 17/08/18 11:27, Roberto Carna wrote:
&gt;<i> Dear Marcus, please can you tell me the way to do what you suggest?
</I>&gt;<i> 
</I>&gt;<i> Suppose I want to block youtube.com but enable only one URL video
</I>&gt;<i> &quot;<A HREF="https://www.youtube.com/embed/ff9sDLGtnK8?rel=0&amp;showinfo=0">https://www.youtube.com/embed/ff9sDLGtnK8?rel=0&amp;showinfo=0</A>&quot;.
</I>&gt;<i> 
</I>&gt;<i> How should I set te DNS entries please?
</I>&gt;<i> 
</I>&gt;<i> Regards,
</I>&gt;<i> 
</I>&gt;<i> 2018-08-17 9:51 GMT-03:00 Marcus Kool &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">marcus.kool at urlfilterdb.com</A>&gt;:
</I>&gt;&gt;<i> OP asked about blocking Youtube but allowing a single Youtube video.
</I>&gt;&gt;<i> How would you do that with a couple of DNS entries ?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Marcus
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On 16/08/18 22:11, SQUIDBLACKLIST.ORG wrote:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> This might be painfully obvious to some who are in the know, but,
</I>&gt;&gt;&gt;<i> filtering youtube video content can be done with a lot less effort by simply
</I>&gt;&gt;&gt;<i> adding a couple dns entries for Googles safesearch servers.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> #justsayin
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Signed,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Benjamin E. Nichols
</I>&gt;&gt;&gt;<i> Founder &amp;  Chief Architect
</I>&gt;&gt;&gt;<i> <A HREF="http://www.squidblacklist.org">http://www.squidblacklist.org</A>
</I>&gt;&gt;&gt;<i> 1-405-301-9516
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> -------- Original message --------
</I>&gt;&gt;&gt;<i> From: Marcus Kool &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">marcus.kool at urlfilterdb.com</A>&gt;
</I>&gt;&gt;&gt;<i> Date: 8/16/18 7:53 PM (GMT-06:00)
</I>&gt;&gt;&gt;<i> To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;&gt;<i> Subject: Re: [squid-users] Squid + Squidguard Youtube URL video filtering
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> yes, with ufdbguard you put
</I>&gt;&gt;&gt;<i>       youtube.com/watch?v=VIDEOID
</I>&gt;&gt;&gt;<i> in a urls file and create a URL table with ufdbGenTable.
</I>&gt;&gt;&gt;<i> ufdbGenTable adds many URLs automagically, i.e.
</I>&gt;&gt;&gt;<i>       youtube.com/embed/VIDEOID
</I>&gt;&gt;&gt;<i>       youtube.com/get_video_info?video_id=VIDEOID
</I>&gt;&gt;&gt;<i>       ytimg.googleusercontent.com/vi/VIDEOID
</I>&gt;&gt;&gt;<i> and many more.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Marcus
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> On 16/08/18 11:01, Vacheslav wrote:
</I>&gt;&gt;&gt;<i>   &gt; Wouldn't it be better to try it in ufdbguard?
</I>&gt;&gt;&gt;<i>   &gt;
</I>&gt;&gt;&gt;<i>   &gt; -----Original Message-----
</I>&gt;&gt;&gt;<i>   &gt; From: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; On Behalf
</I>&gt;&gt;&gt;<i> Of Amos Jeffries
</I>&gt;&gt;&gt;<i>   &gt; Sent: Thursday, August 16, 2018 4:18 PM
</I>&gt;&gt;&gt;<i>   &gt; To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;&gt;<i>   &gt; Subject: Re: [squid-users] Squid + Squidguard Youtube URL video
</I>&gt;&gt;&gt;<i> filtering
</I>&gt;&gt;&gt;<i>   &gt;
</I>&gt;&gt;&gt;<i>   &gt; On 17/08/18 00:43, Roberto Carna wrote:
</I>&gt;&gt;&gt;<i>   &gt;&gt; Dear, I have Squid + Squidguard working OK.
</I>&gt;&gt;&gt;<i>   &gt;&gt;
</I>&gt;&gt;&gt;<i>   &gt;&gt; Squidguard is filtering the entire www.youtube.com website.
</I>&gt;&gt;&gt;<i>   &gt;&gt;
</I>&gt;&gt;&gt;<i>   &gt;&gt; But now I have to permit just one video from Youtube:
</I>&gt;&gt;&gt;<i>   &gt;&gt;
</I>&gt;&gt;&gt;<i>   &gt;&gt; <A HREF="https://www.youtube.com/embed/ff9sDLGtnK8?rel=0&amp;showinfo=0">https://www.youtube.com/embed/ff9sDLGtnK8?rel=0&amp;showinfo=0</A>
</I>&gt;&gt;&gt;<i>   &gt;&gt;
</I>&gt;&gt;&gt;<i>   &gt;&gt; I have added the below URL as an exception in Squidguard:
</I>&gt;&gt;&gt;<i>   &gt;&gt;
</I>&gt;&gt;&gt;<i>   &gt;&gt; www.youtube.com/embed/ff9sDLGtnK8?rel=0&amp;showinfo=0
</I>&gt;&gt;&gt;<i>   &gt;&gt;
</I>&gt;&gt;&gt;<i>   &gt;&gt; but after that I can't see it, still blocked.
</I>&gt;&gt;&gt;<i>   &gt;&gt;
</I>&gt;&gt;&gt;<i>   &gt;&gt; How can I enable just this URL from Squidguard preferently blocking
</I>&gt;&gt;&gt;<i>   &gt;&gt; the rest of Youtube ???
</I>&gt;&gt;&gt;<i>   &gt;
</I>&gt;&gt;&gt;<i>   &gt;&gt; Unfortunately only with a great deal of difficulty.
</I>&gt;&gt;&gt;<i>   &gt;
</I>&gt;&gt;&gt;<i>   &gt;&gt; The &quot;?v=...&quot; and &quot;/embed/...&quot; URLs are just public identifiers to
</I>&gt;&gt;&gt;<i> access the YouTube APIs. At the HTTP level they result in a quite long
</I>&gt;&gt;&gt;<i> series of sub-requests, redirections and the like bouncing all over the
</I>&gt;&gt;&gt;<i>   &gt; youtube.* and googlevideos.* and googleapis.* domains.
</I>&gt;&gt;&gt;<i>   &gt;   Yes all of them are involved multiple times. So whitelisting is an
</I>&gt;&gt;&gt;<i> all-or-nothing prospect, with other G services being implicitly whitelisted
</I>&gt;&gt;&gt;<i> as side effects.
</I>&gt;&gt;&gt;<i>   &gt;
</I>&gt;&gt;&gt;<i>   &gt;
</I>&gt;&gt;&gt;<i>   &gt;&gt; Also, whenever the way to decipher the above maze of traffic gets
</I>&gt;&gt;&gt;<i> published so we can do things like what you ask. YT shortly afterwards
</I>&gt;&gt;&gt;<i> change how it operates - usually towards even more complexity. This has
</I>&gt;&gt;&gt;<i> happened too many times to be coincidence IMO.
</I>&gt;&gt;&gt;<i>   &gt;
</I>&gt;&gt;&gt;<i>   &gt;
</I>&gt;&gt;&gt;<i>   &gt;&gt; Amos
</I>&gt;&gt;&gt;<i>   &gt; _______________________________________________
</I>&gt;&gt;&gt;<i>   &gt; squid-users mailing list
</I>&gt;&gt;&gt;<i>   &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;&gt;<i>   &gt; <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;&gt;&gt;<i>   &gt;
</I>&gt;&gt;&gt;<i>   &gt;
</I>&gt;&gt;&gt;<i>   &gt; _______________________________________________
</I>&gt;&gt;&gt;<i>   &gt; squid-users mailing list
</I>&gt;&gt;&gt;<i>   &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;&gt;<i>   &gt; <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;&gt;&gt;<i>   &gt;
</I>&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019011.html">[squid-users] Squid + Squidguard Youtube URL video filtering
</A></li>
	<LI>Next message (by thread): <A HREF="019013.html">[squid-users] Fetch missing certificate feature of Squid_v4
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19012">[ date ]</a>
              <a href="thread.html#19012">[ thread ]</a>
              <a href="subject.html#19012">[ subject ]</a>
              <a href="author.html#19012">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
