<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] https requests the squid rejects the connection
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20https%20requests%20the%20squid%20rejects%20the%20connection&In-Reply-To=%3C2137370086.144899.1534796367801.JavaMail.zimbra%40asoprofarma.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019023.html">
   <LINK REL="Next"  HREF="019025.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] https requests the squid rejects the connection</H1>
    <B>Marcelo J. Martinez</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20https%20requests%20the%20squid%20rejects%20the%20connection&In-Reply-To=%3C2137370086.144899.1534796367801.JavaMail.zimbra%40asoprofarma.com%3E"
       TITLE="[squid-users] https requests the squid rejects the connection">mmartinez at asoprofarma.com
       </A><BR>
    <I>Mon Aug 20 20:19:27 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019023.html">[squid-users] https requests the squid rejects the connection
</A></li>
        <LI>Next message (by thread): <A HREF="019025.html">[squid-users] https requests the squid rejects the connection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19024">[ date ]</a>
              <a href="thread.html#19024">[ thread ]</a>
              <a href="subject.html#19024">[ subject ]</a>
              <a href="author.html#19024">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>access.log:

1534782486.761      0 10.10.1.101 TCP_DENIED/403 3917 CONNECT aus5.mozilla.org:443 - HIER_NONE/- text/html
1534782486.767      0 10.10.1.101 TCP_DENIED/403 3926 CONNECT redirector.gvt1.com:443 - HIER_NONE/- text/html
1534782486.768      0 10.10.1.101 TCP_DENIED/403 4221 GET <A HREF="http://ciscobinary.openh264.org/openh264-win64-0410d336bb748149a4f560eb6108090f078254b1.zip">http://ciscobinary.openh264.org/openh264-win64-0410d336bb748149a4f560eb6108090f078254b1.zip</A> - HIER_NONE/- text/html
1534782606.751      0 10.10.1.101 TCP_DENIED/403 3989 CONNECT blocklists.settings.services.mozilla.com:443 - HIER_NONE/- text/html
1534782606.754      0 10.10.1.101 TCP_DENIED/403 3980 CONNECT firefox.settings.services.mozilla.com:443 - HIER_NONE/- text/html
1534783061.435      0 10.10.1.101 TCP_DENIED/403 3914 CONNECT www.youtube.com:443 - HIER_NONE/- text/html
1534783486.477      0 10.10.1.101 TCP_DENIED/403 4123 GET <A HREF="http://argenteam.net/">http://argenteam.net/</A> - HIER_NONE/- text/html
1534783486.506      0 10.10.1.101 TCP_DENIED/403 4169 GET <A HREF="http://smbserver2:3128/squid-internal-static/icons/SN.png">http://smbserver2:3128/squid-internal-static/icons/SN.png</A> - HIER_NONE/- text/html
1534785311.331      0 10.10.1.101 TCP_DENIED/403 3914 CONNECT www.youtube.com:443 - HIER_NONE/- text/html
1534788567.647      0 10.10.1.101 TCP_DENIED/403 3950 CONNECT safebrowsing.googleapis.com:443 - HIER_NONE/- text/html
1534791437.517      0 10.10.1.101 TCP_DENIED/403 3917 CONNECT aus5.mozilla.org:443 - HIER_NONE/- text/html

Bear in mind that the server is configured to reject the connection from my ip, the problem is that:
with http queries, the normal squid error page appears.
with https queries, the browser informs me that the proxy rejected the connection and the normal squid page does not appear.

----- Mensaje original -----
De: &quot;Amos Jeffries&quot; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;
Para: &quot;Posting address&quot; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
Enviados: Lunes, 20 de Agosto 2018 17:02:44
Asunto: Re: [squid-users] https requests the squid rejects the connection

On 21/08/18 6:45 AM, Marcelo J. Martinez wrote:
&gt;<i> sorry, it's a mistake to copy and paste.
</I>&gt;<i> the configuration is:
</I>&gt;<i> 
</I>&gt;<i> # Only allow cachemgr access from localhost
</I>&gt;<i> http_access allow manager localhost
</I>&gt;<i> http_access deny manager
</I>&gt;<i> # Deny requests to unknown ports
</I>&gt;<i> http_access deny !Safe_ports
</I>&gt;<i> # Deny CONNECT to other than SSL ports
</I>&gt;<i> http_access deny CONNECT !SSL_ports
</I>&gt;<i> 
</I>
FYI: current recommended config has the manager lines after the CONNECT
line, that makes Squid a tiny bit faster and safer against CONNECT to
the manager URLs.

That will not solve your current issue though. As Matus said the log
entry (access.log) for the transaction is needed for more info about
what is going on - in particular the URL which is being denied.

I suspect it is simply a normal HTTP request to a port you were not
expecting. You did reduce the Safe_Ports ACL definition significantly.

Amos
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
El contenido del presente mensaje y sus adjuntos es privado, estrictamente confidencial y exclusivo para su destinatario, pudiendo contener informacion protegida por normas legales y de secreto profesional. Bajo ninguna circunstancia su contenido puede ser transmitido o revelado a terceros ni divulgado en forma alguna. En consecuencia de haberlo recibido por error, solicitamos contactar al remitente y eliminarlo de su sistema. AHORRE PAPEL. PIENSE ANTES DE IMPRIMIR.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019023.html">[squid-users] https requests the squid rejects the connection
</A></li>
	<LI>Next message (by thread): <A HREF="019025.html">[squid-users] https requests the squid rejects the connection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19024">[ date ]</a>
              <a href="thread.html#19024">[ thread ]</a>
              <a href="subject.html#19024">[ subject ]</a>
              <a href="author.html#19024">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
