<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] https requests the squid rejects the connection
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20https%20requests%20the%20squid%20rejects%20the%20connection&In-Reply-To=%3C2eef3abc-39fc-fc9e-8f0d-675d132427b9%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019024.html">
   <LINK REL="Next"  HREF="019026.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] https requests the squid rejects the connection</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20https%20requests%20the%20squid%20rejects%20the%20connection&In-Reply-To=%3C2eef3abc-39fc-fc9e-8f0d-675d132427b9%40treenet.co.nz%3E"
       TITLE="[squid-users] https requests the squid rejects the connection">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon Aug 20 20:28:55 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019024.html">[squid-users] https requests the squid rejects the connection
</A></li>
        <LI>Next message (by thread): <A HREF="019026.html">[squid-users] https requests the squid rejects the connection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19025">[ date ]</a>
              <a href="thread.html#19025">[ thread ]</a>
              <a href="subject.html#19025">[ subject ]</a>
              <a href="author.html#19025">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 21/08/18 8:19 AM, Marcelo J. Martinez wrote:
&gt;<i> access.log:
</I>&gt;<i> 
</I>&gt;<i> 1534782486.761      0 10.10.1.101 TCP_DENIED/403 3917 CONNECT aus5.mozilla.org:443 - HIER_NONE/- text/html
</I>&gt;<i> 1534782486.767      0 10.10.1.101 TCP_DENIED/403 3926 CONNECT redirector.gvt1.com:443 - HIER_NONE/- text/html
</I>&gt;<i> 1534782486.768      0 10.10.1.101 TCP_DENIED/403 4221 GET <A HREF="http://ciscobinary.openh264.org/openh264-win64-0410d336bb748149a4f560eb6108090f078254b1.zip">http://ciscobinary.openh264.org/openh264-win64-0410d336bb748149a4f560eb6108090f078254b1.zip</A> - HIER_NONE/- text/html
</I>&gt;<i> 1534782606.751      0 10.10.1.101 TCP_DENIED/403 3989 CONNECT blocklists.settings.services.mozilla.com:443 - HIER_NONE/- text/html
</I>&gt;<i> 1534782606.754      0 10.10.1.101 TCP_DENIED/403 3980 CONNECT firefox.settings.services.mozilla.com:443 - HIER_NONE/- text/html
</I>&gt;<i> 1534783061.435      0 10.10.1.101 TCP_DENIED/403 3914 CONNECT www.youtube.com:443 - HIER_NONE/- text/html
</I>&gt;<i> 1534783486.477      0 10.10.1.101 TCP_DENIED/403 4123 GET <A HREF="http://argenteam.net/">http://argenteam.net/</A> - HIER_NONE/- text/html
</I>&gt;<i> 1534783486.506      0 10.10.1.101 TCP_DENIED/403 4169 GET <A HREF="http://smbserver2:3128/squid-internal-static/icons/SN.png">http://smbserver2:3128/squid-internal-static/icons/SN.png</A> - HIER_NONE/- text/html
</I>&gt;<i> 1534785311.331      0 10.10.1.101 TCP_DENIED/403 3914 CONNECT www.youtube.com:443 - HIER_NONE/- text/html
</I>&gt;<i> 1534788567.647      0 10.10.1.101 TCP_DENIED/403 3950 CONNECT safebrowsing.googleapis.com:443 - HIER_NONE/- text/html
</I>&gt;<i> 1534791437.517      0 10.10.1.101 TCP_DENIED/403 3917 CONNECT aus5.mozilla.org:443 - HIER_NONE/- text/html
</I>&gt;<i> 
</I>&gt;<i> Bear in mind that the server is configured to reject the connection from my ip, the problem is that:
</I>&gt;<i> with http queries, the normal squid error page appears.
</I>&gt;<i> with https queries, the browser informs me that the proxy rejected the connection and the normal squid page does not appear.
</I>&gt;<i> 
</I>
This is intentional behaviour by the Browsers. Squid does send the same
error page if the CONNECT tunnel is rejected, but they all refuse to
display anything but their own text. There were some workarounds that
worked some time ago, but those have also been blocked in recent years.

I do mean &quot;refuse&quot; above. The Browser authors have repeatedly been asked
to re-asses and always close the bugs as WONTFIX citing security risks
which are demonstrably false, or ignore it.


There is nothing Squid (or we) can do about it these days short of fully
decrypting the client TLS and injecting a fake response containing the
error page. Yes that is as nasty as it sounds (maybe more) and assumes
that the traffic on port 443 actually is HTTPS instead of something else.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019024.html">[squid-users] https requests the squid rejects the connection
</A></li>
	<LI>Next message (by thread): <A HREF="019026.html">[squid-users] https requests the squid rejects the connection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19025">[ date ]</a>
              <a href="thread.html#19025">[ thread ]</a>
              <a href="subject.html#19025">[ subject ]</a>
              <a href="author.html#19025">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
