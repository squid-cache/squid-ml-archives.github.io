<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Uninitialized SSL certificate database directory
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Uninitialized%20SSL%20certificate%20database%20directory&In-Reply-To=%3CCAEVtZksAsexEkCv%2BBWuRA15-tosA6EH_gc5fDJrjna41NDiUaA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019073.html">
   <LINK REL="Next"  HREF="019078.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Uninitialized SSL certificate database directory</H1>
    <B>Maximiliano Santa Cruz</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Uninitialized%20SSL%20certificate%20database%20directory&In-Reply-To=%3CCAEVtZksAsexEkCv%2BBWuRA15-tosA6EH_gc5fDJrjna41NDiUaA%40mail.gmail.com%3E"
       TITLE="[squid-users] Uninitialized SSL certificate database directory">maxonico at gmail.com
       </A><BR>
    <I>Tue Aug 28 13:08:19 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019073.html">[squid-users] Uninitialized SSL certificate database directory
</A></li>
        <LI>Next message (by thread): <A HREF="019078.html">[squid-users] Uninitialized SSL certificate database directory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19077">[ date ]</a>
              <a href="thread.html#19077">[ thread ]</a>
              <a href="subject.html#19077">[ subject ]</a>
              <a href="author.html#19077">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks for your answer, here's the output after the upgrade:

[<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at localhost</A> ssl_cert]# squid -v
Squid Cache: Version 4.1
Service Name: squid

'--with-default-user=squid'

Error:

[<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at localhost</A> ssl_cert]# /usr/lib64/squid/security_file_certgen -c -s
/usr/local/squid/var/cache/squid/ssl_db -M 4MB
Initialization SSL db...
/usr/lib64/squid/security_file_certgen: Cannot create
/usr/local/squid/var/cache/squid/ssl_db

&gt;<i>From the cache.log:
</I>
2018/08/28 09:00:36 kid1| Set Current Directory to /var/spool/squid
(security_file_certgen): Uninitialized SSL certificate database directory:
/usr/local/squid/var/cache/squid/ssl_db. To initialize, run
&quot;security_file_certgen -c -s /usr/local/squid/var/cache/squid/ssl_db&quot;.
...
2018/08/28 09:00:37 kid1| Accepting NAT intercepted SSL bumped HTTPS Socket
connections at local=[::]:3129 remote=[::] FD 17 flags=41
2018/08/28 09:00:37 kid1| WARNING: /usr/lib64/squid/security_file_certgen
-s /usr/local/squid/var/cache/squid/ssl_db -M 4MB #Hlpr1 exited
2018/08/28 09:00:37 kid1| Too few /usr/lib64/squid/security_file_certgen -s
/usr/local/squid/var/cache/squid/ssl_db -M 4MB processes are running (need
1/8)


Permissions:

drwxrwxrwx. 2 squid squid 6 Aug 28 08:45 ssl_db
drwxrwxrwx. 3 squid squid 20 Aug 28 08:45 squid
drwxrwxrwx. 3 squid squid 19 Aug 28 08:45 cache
drwxrwxrwx. 3 squid squid 19 Aug 28 08:45 var
drwxrwxrwx. 3 squid squid 17 Aug 28 08:45 squid

Status:

[<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at localhost</A> /]# systemctl status squid
&#9679; squid.service - Squid Web Proxy Server
   Loaded: loaded (/usr/lib/systemd/system/squid.service; enabled; vendor
preset: disabled)
   Active: failed (Result: exit-code) since Tue 2018-08-28 09:00:37 EDT;
2min 5s ago
     Docs: man:squid(8)
  Process: 4993 ExecStop=/usr/sbin/squidshut.sh (code=exited, status=255)

It doesn't matter if I create /squid with squid.squid user.group
permissions with rwx, the error is always the same.

I'm downloading <A HREF="https://www.pfsense.org,">https://www.pfsense.org,</A> will try from there. Also attached
the squid.conf just in case.

Regards.

El mar., 28 ago. 2018 a las 8:28, Amos Jeffries (&lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;)
escribi&#243;:

&gt;<i> On 28/08/18 7:13 AM, Maximiliano Santa Cruz wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Hello everybody.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I've been struggling with this error:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; (ssl_crtd): Uninitialized SSL certificate database directory:
</I>&gt;<i> &gt; /var/lib/ssl_db. To initialize, run &quot;ssl_crtd -c -s /var/lib/ssl_db&quot;.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I've tried a lot of workarounds from this mailing list but none of them
</I>&gt;<i> &gt; worked for me, these are the permissions that I have:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; [<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at localhost</A> admin]#  /usr/lib64/squid/ssl_crtd -c -s /var/lib/ssl_db
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; [<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at localhost</A> admin]# ll /var/lib/ssl_db
</I>&gt;<i> &gt; total 4
</I>&gt;<i> &gt; drwxr-xr-x. 2 squid squid 6 Aug 27 15:06 certs
</I>&gt;<i> &gt; -rw-r--r--. 1 squid squid 0 Aug 27 15:06 index.txt
</I>&gt;<i> &gt; -rw-r--r--. 1 squid squid 1 Aug 27 15:06 size
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> Have you updated SELinux permissions after creating or changing the
</I>&gt;<i> directory?
</I>&gt;<i>
</I>&gt;<i>  test -x /sbin/restorecon &amp;&amp; restorecon /var/lib/ssl_db
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; OS: CentOS 7
</I>&gt;<i> &gt; [<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at localhost</A> admin]# squid -v
</I>&gt;<i> &gt; Squid Cache: Version 3.5.27
</I>&gt;<i> &gt; Service Name: squid
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> Missing the configure options which will say what --with-default-user=
</I>&gt;<i> was set to. That account needs to match the one with rights to the
</I>&gt;<i> directory - it may not be &quot;squid&quot;.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Also, please update to Squid-4. It has much better support for SSL-Bump
</I>&gt;<i> features than squid-3.x. Eliezer has packages available
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>

-- 
<A HREF="http://maxonico.dpi-studio.com.ar">http://maxonico.dpi-studio.com.ar</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20180828/3c8c421f/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20180828/3c8c421f/attachment.htm</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: squid.conf
Type: application/octet-stream
Size: 2025 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20180828/3c8c421f/attachment.obj">http://lists.squid-cache.org/pipermail/squid-users/attachments/20180828/3c8c421f/attachment.obj</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019073.html">[squid-users] Uninitialized SSL certificate database directory
</A></li>
	<LI>Next message (by thread): <A HREF="019078.html">[squid-users] Uninitialized SSL certificate database directory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19077">[ date ]</a>
              <a href="thread.html#19077">[ thread ]</a>
              <a href="subject.html#19077">[ subject ]</a>
              <a href="author.html#19077">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
