<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Why does Squid4 do socket(AF_NETLINK, SOCK_RAW, NETLINK_NETFILTER) = -1 EACCES (Permission denied) ?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Why%20does%20Squid4%20do%20socket%28AF_NETLINK%2C%20SOCK_RAW%2C%0A%20NETLINK_NETFILTER%29%20%3D%20-1%20EACCES%20%28Permission%20denied%29%20%3F&In-Reply-To=%3Cc0ce406a-4894-46a9-8bc9-0977457f7225%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019772.html">
   <LINK REL="Next"  HREF="019787.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Why does Squid4 do socket(AF_NETLINK, SOCK_RAW, NETLINK_NETFILTER) = -1 EACCES (Permission denied) ?</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Why%20does%20Squid4%20do%20socket%28AF_NETLINK%2C%20SOCK_RAW%2C%0A%20NETLINK_NETFILTER%29%20%3D%20-1%20EACCES%20%28Permission%20denied%29%20%3F&In-Reply-To=%3Cc0ce406a-4894-46a9-8bc9-0977457f7225%40treenet.co.nz%3E"
       TITLE="[squid-users] Why does Squid4 do socket(AF_NETLINK, SOCK_RAW, NETLINK_NETFILTER) = -1 EACCES (Permission denied) ?">squid3 at treenet.co.nz
       </A><BR>
    <I>Sat Dec  1 11:11:53 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019772.html">[squid-users] Define and use a variable in squid.conf (Was: What happens when duplicate external_acl_type are mentioned)
</A></li>
        <LI>Next message (by thread): <A HREF="019787.html">[squid-users] Why does Squid4 do socket(AF_NETLINK, SOCK_RAW,	NETLINK_NETFILTER) = -1 EACCES (Permission denied) ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19756">[ date ]</a>
              <a href="thread.html#19756">[ thread ]</a>
              <a href="subject.html#19756">[ subject ]</a>
              <a href="author.html#19756">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 1/12/18 3:43 am, Ahmad, Sarfaraz wrote:
&gt;<i> I think almost every time squid opens a TCP connection, It also tried to
</I>&gt;<i> open a raw socket of type AF_NETLINK. Syscall pasted below.
</I>&gt;<i> 
</I>...&gt;
&gt;<i> Any thoughts ?
</I>&gt;<i> 
</I>

* To receive NAT intercepted connections Squid needs access to the
system NAT table to identify what origin server the client was actually
trying to get to before it was diverted into Squid.

* To send traffic with TPROXY interception Squid must setup the socket
for sending the spoofed IP addresses.

* To perform Netfilter MARK operations (both fetch and set) Squid uses
Netfilter Conntrack APIs.

* To fetch EUI information about connections received or sent after they
are open via POSIX getsockopt() or BSD ioctl() APIs. This is optional
and on by default (eui_lookup to configure)

Any of those may be defined by your system Netfilter libraries in terms
of AF_NETLINK traffic in the background. If they are doing things like
that then the ICMP sockets and (less likely) UDS sockets may also be
affected.

If the behaviour is as repeatable as you say you can use a ALL,9 level
cache .log trace to see what exactly Squid is trying to do at the time
it happens.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019772.html">[squid-users] Define and use a variable in squid.conf (Was: What happens when duplicate external_acl_type are mentioned)
</A></li>
	<LI>Next message (by thread): <A HREF="019787.html">[squid-users] Why does Squid4 do socket(AF_NETLINK, SOCK_RAW,	NETLINK_NETFILTER) = -1 EACCES (Permission denied) ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19756">[ date ]</a>
              <a href="thread.html#19756">[ thread ]</a>
              <a href="subject.html#19756">[ subject ]</a>
              <a href="author.html#19756">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
