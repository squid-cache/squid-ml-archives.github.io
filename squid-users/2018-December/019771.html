<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Performance issue /cache_dir / cache_mem / SMP	workers
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Performance%20issue%20/cache_dir%20/%20cache_mem%20/%20SMP%0A%09workers&In-Reply-To=%3C1543851777570-0.post%40n4.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019763.html">
   <LINK REL="Next"  HREF="019773.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Performance issue /cache_dir / cache_mem / SMP	workers</H1>
    <B>pacolo</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Performance%20issue%20/cache_dir%20/%20cache_mem%20/%20SMP%0A%09workers&In-Reply-To=%3C1543851777570-0.post%40n4.nabble.com%3E"
       TITLE="[squid-users] Performance issue /cache_dir / cache_mem / SMP	workers">pacolopezvelasco at gmail.com
       </A><BR>
    <I>Mon Dec  3 15:42:57 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019763.html">[squid-users] squid disable ipv6 outbound traffic
</A></li>
        <LI>Next message (by thread): <A HREF="019773.html">[squid-users] cache manager / webmin in SMP mode
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19771">[ date ]</a>
              <a href="thread.html#19771">[ thread ]</a>
              <a href="subject.html#19771">[ subject ]</a>
              <a href="author.html#19771">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Amos,


&gt;<i>If you have a mix of &quot;/cache${process_number}&quot; and &quot;/cache1&quot; in your
</I>&gt;<i>config files you may still be mixing SMP-aware and SMP-disabled access
</I>&gt;<i>to the &quot;/cache1&quot; path.
</I>
That's exactly what happened to us, as I mentioned, we are new in the
Squid's world. I have several years of experience in Blue Coat proxies, but
these settings were preconfigured in their system.

&gt;<i>By your mention of &quot;backend.conf&quot; I assume you are trying to use
</I>&gt;<i>something based on our example SMP CARP cluster configuration.
</I>&gt;<i>If that is correct please compare what you have to the current example
</I>&gt;<i>config &lt;<A HREF="https://wiki.squid-cache.org/ConfigExamples/SmpCarpCluster&amp;gt;.">https://wiki.squid-cache.org/ConfigExamples/SmpCarpCluster&gt;.</A>
</I>
&gt;<i>It has had a few changes since initially written, and people
</I>&gt;<i>copy-pasting it into tutorials without linking back to our info have got
</I>&gt;<i>various bugs in their texts. Sometimes because they copied old versions
</I>&gt;<i>that no longer work, or because they made arbitrary changes without
</I>&gt;<i>properly understanding the consequences.
</I>
We followed that example, but it was last edited at 2013-03-23 04:15, so it
has a mixture of AUFS and Rock caches, that's why I missunderstood the
/cache${process_number} with the cache modes.

As you say, there's a lot of info into the tutorials released on the web,
but it's difficult to find the information updated with the most updated
version of Squid.

Maybe it will be worth an update of this example, it would save you some
time not having to reply to people that missunderstood that info.


&gt;<i>So the fix is to:
</I>&gt;<i>
</I>&gt;<i>1) stop Squid.
</I>&gt;<i>
</I>&gt;<i>2) make sure it is fully shutdown with no residual instances or
</I>&gt;<i>processes running.
</I>&gt;<i>
</I>&gt;<i>3) make sure the SMP /dev/shm sockets opened by Squid are fully gone.
</I>&gt;<i>Delete manually if necessary.
</I>&gt;<i>
</I>&gt;<i>4) make sure the PID file is fully gone. Delete manually if necessary.
</I>&gt;<i>
</I>&gt;<i>5) erase everything in the /cache1 directory.
</I>&gt;<i>
</I>&gt;<i>5a) optionally: erase any other caches you may have.
</I>&gt;<i>  This will speed up the -z process, but only the cache showing errors
</I>&gt;<i>actually needs to be fully clean to fix this error message.
</I>&gt;<i>
</I>&gt;<i>6) run &quot;squid -z&quot; manually and wait until it completes.
</I>&gt;<i>
</I>&gt;<i>7) start Squid.
</I>

The procedure worked perfectly.

But unfortunately, we faced other issues...

kid1| TCP connection to localhost/4003 failed
kid1| Detected DEAD Parent: backend-kid3
kid1| temporary disabling (Service Unavailable) digest from localhost

So, we changed the cache_peer definition from localhost to 127.0.0.1, as
suggested in <A HREF="https://wiki.squid-cache.org/Features/IPv6.">https://wiki.squid-cache.org/Features/IPv6.</A>
And that was all to make Squid running.

Your help is much appreciated.

Thanks!
Paco.



--
Sent from: <A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html">http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html</A>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019763.html">[squid-users] squid disable ipv6 outbound traffic
</A></li>
	<LI>Next message (by thread): <A HREF="019773.html">[squid-users] cache manager / webmin in SMP mode
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19771">[ date ]</a>
              <a href="thread.html#19771">[ thread ]</a>
              <a href="subject.html#19771">[ subject ]</a>
              <a href="author.html#19771">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
