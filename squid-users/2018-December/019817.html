<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] HTTPS proxy setup questions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20HTTPS%20proxy%20setup%20questions&In-Reply-To=%3CCAFODohi9M3pp1iGLmYZp00wrEMA5qomGHsJxrLEyTqmY0ZQeJQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019803.html">
   <LINK REL="Next"  HREF="019819.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] HTTPS proxy setup questions</H1>
    <B>Subhish Pillai</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20HTTPS%20proxy%20setup%20questions&In-Reply-To=%3CCAFODohi9M3pp1iGLmYZp00wrEMA5qomGHsJxrLEyTqmY0ZQeJQ%40mail.gmail.com%3E"
       TITLE="[squid-users] HTTPS proxy setup questions">subhish.pillai at broadcom.com
       </A><BR>
    <I>Fri Dec 14 19:03:17 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019803.html">[squid-users] HTTPS proxy setup questions
</A></li>
        <LI>Next message (by thread): <A HREF="019819.html">[squid-users] HTTPS proxy setup questions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19817">[ date ]</a>
              <a href="thread.html#19817">[ thread ]</a>
              <a href="subject.html#19817">[ subject ]</a>
              <a href="author.html#19817">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I was able to get https working over the http connect tunnel, but I was
still having issues with my client application connecting over the proxy.
After some research it so happens that we have implemented the HTTPS proxy
on the client side with libcurl. (implementing this - &quot;
<A HREF="https://daniel.haxx.se/blog/2016/11/26/https-proxy-with-curl/">https://daniel.haxx.se/blog/2016/11/26/https-proxy-with-curl/</A>&quot;).

So now my use case for the squid proxy is to be able to accept a
HTTPS_proxy request from the client and tunnel it forward to the
destination server. For that I copied over the CA bundle from the client
into the proxy server and pointed the &quot;tls-cert&quot; option to that file --

https_port 3128 tls-cert=/etc/squid/ssl_cert/ca-bundle.crt

I get the following error when starting the squid server --
*Dec 14 10:03:42 squid[131539]: FATAL: No valid signing certificate
configured for HTTPS_port [::]:3128*

How do I get this to work without having to create self-signed certs on the
proxy server and importing that into the client ca-bundle.

Am I missing any config steps in the squid.conf file? I think I have
misunderstood the function of the &quot;tls-cert&quot; and &quot;tls-cafile&quot; options in
the https_port line.

Thanks again for all the help!

Subhish


On Wed, Dec 12, 2018 at 6:53 PM Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; wrote:

&gt;<i> On 13/12/18 12:50 pm, Subhish Pillai wrote:
</I>&gt;<i> &gt; Thanks Alex, that was very helpful.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Based on your explanation, I just want to use squid as a blind TCP
</I>&gt;<i> &gt; tunnel carrying the HTTPS connection from client to app server.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; In that case, I don't need to use ssl_bump feature and the ssl_crtd
</I>&gt;<i> &gt; program for certificate management, is that correct?
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> Going by the description you gave of the client configuration, it should
</I>&gt;<i> be.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; Would this config file work to setup the TCP tunnel --
</I>&gt;<i>
</I>&gt;<i> ...
</I>&gt;<i> &gt; ## Allow server side certificate errors such as untrusted certificates,
</I>&gt;<i> &gt; otherwise the connection is closed for such errors
</I>&gt;<i> &gt; sslproxy_cert_error allow all
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ## Accept certificates that fail verification (should only be needed if
</I>&gt;<i> &gt; using 'sslproxy_cert_error allow all')
</I>&gt;<i> &gt; sslproxy_flags DONT_VERIFY_PEER
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> These sslproxy_* options only apply when Squid is actively performing
</I>&gt;<i> TLS to upstream servers. They have no place in the &quot;blind tunnel&quot;
</I>&gt;<i> situation.
</I>&gt;<i> (They also are deprecated in Squid-4, replaced by the
</I>&gt;<i> tls_outgoing_options directive
</I>&gt;<i> &lt;<A HREF="http://www.squid-cache.org/Doc/config/tls_outgoing_options/">http://www.squid-cache.org/Doc/config/tls_outgoing_options/</A>&gt;).
</I>&gt;<i>
</I>&gt;<i> If the client software is sending CONNECT requests containing the HTTPS
</I>&gt;<i> traffic, then there is absolutely nothing your config needs to do than
</I>&gt;<i> let them send those requests to the proxy (as the default config does).
</I>&gt;<i>
</I>&gt;<i> You do not even need Squid to be built with TLS/SSL support. That is the
</I>&gt;<i> meaning of &quot;blind&quot; in this setup.
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>

-- 

*Subhish Pillai*

R&amp;D Software Quality Engineer

Broadcom | Brocade Storage Networking

T (720) 462-2900
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20181214/d10f353b/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20181214/d10f353b/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019803.html">[squid-users] HTTPS proxy setup questions
</A></li>
	<LI>Next message (by thread): <A HREF="019819.html">[squid-users] HTTPS proxy setup questions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19817">[ date ]</a>
              <a href="thread.html#19817">[ thread ]</a>
              <a href="subject.html#19817">[ subject ]</a>
              <a href="author.html#19817">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
