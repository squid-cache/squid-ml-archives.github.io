<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] HTTPS proxy setup questions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20HTTPS%20proxy%20setup%20questions&In-Reply-To=%3Cd15c0a01-0b8c-4d01-7c92-bdb1b45967a9%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019817.html">
   <LINK REL="Next"  HREF="019832.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] HTTPS proxy setup questions</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20HTTPS%20proxy%20setup%20questions&In-Reply-To=%3Cd15c0a01-0b8c-4d01-7c92-bdb1b45967a9%40measurement-factory.com%3E"
       TITLE="[squid-users] HTTPS proxy setup questions">rousskov at measurement-factory.com
       </A><BR>
    <I>Fri Dec 14 21:33:37 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019817.html">[squid-users] HTTPS proxy setup questions
</A></li>
        <LI>Next message (by thread): <A HREF="019832.html">[squid-users] HTTPS proxy setup questions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19819">[ date ]</a>
              <a href="thread.html#19819">[ thread ]</a>
              <a href="subject.html#19819">[ subject ]</a>
              <a href="author.html#19819">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 12/14/18 12:03 PM, Subhish Pillai wrote:

&gt;<i> my use case for the squid proxy is to be able to accept a
</I>&gt;<i> HTTPS_proxy request from the client and tunnel it forward to the
</I>&gt;<i> destination server. 
</I>
&gt;<i> How do I get this to work without having to create self-signed certs on
</I>&gt;<i> the proxy server and importing that into the client ca-bundle. 
</I>
Get a server certificate from a CA authority that the client trusts,
issued for the Squid proxy domain. Give Squid that certificate. For
example, you may be able to use a free letsencrypt.org CA.

An HTTPS proxy needs a certificate it can sign its traffic with. That
certificate must be issued by a client-trusted CA. Whether that is a
fake CA that you operate (what you may have referred to as a
&quot;self-signed cert&quot; above) or a real CA trusted by millions of other
clients (e.g., letsencrypt), is your choice.


&gt;<i> For that I copied over the CA bundle from the client
</I>&gt;<i> into the proxy server and pointed the &quot;tls-cert&quot; option to that file
</I>
Why? Please suggest specific documentation changes that would remove the
implication that doing the above has something to do with your goals.
That option is for specifying the signing certificate (i.e. the
certificate the proxy is going to sign traffic with).


&gt;<i> Am I missing any config steps in the squid.conf file?
</I>
You are missing a clientca or tls-cafile option that triggers client
certificate request (from Squid to client) and gives Squid CA
certificates to trust when validating the client-supplied certificate.
This is unrelated to the Squid signing certificate discussed above.

Alex.


&gt;<i> On Wed, Dec 12, 2018 at 6:53 PM Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>
</I>&gt;<i> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i>     On 13/12/18 12:50 pm, Subhish Pillai wrote:
</I>&gt;<i>     &gt; Thanks Alex, that was very helpful.
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; Based on your explanation, I just want to use squid as a blind TCP
</I>&gt;<i>     &gt; tunnel carrying the HTTPS connection from client to app server.&#160;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; In that case, I don't need to use ssl_bump feature and the ssl_crtd
</I>&gt;<i>     &gt; program for certificate management, is that correct?
</I>&gt;<i>     &gt;
</I>&gt;<i> 
</I>&gt;<i>     Going by the description you gave of the client configuration, it
</I>&gt;<i>     should be.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     &gt; Would this config file work to setup the TCP tunnel --
</I>&gt;<i> 
</I>&gt;<i>     ...
</I>&gt;<i>     &gt; ## Allow server side certificate errors such as untrusted
</I>&gt;<i>     certificates,
</I>&gt;<i>     &gt; otherwise the connection is closed for such errors
</I>&gt;<i>     &gt; sslproxy_cert_error allow all
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; ## Accept certificates that fail verification (should only be
</I>&gt;<i>     needed if
</I>&gt;<i>     &gt; using 'sslproxy_cert_error allow all')
</I>&gt;<i>     &gt; sslproxy_flags DONT_VERIFY_PEER
</I>&gt;<i>     &gt;
</I>&gt;<i> 
</I>&gt;<i>     These sslproxy_* options only apply when Squid is actively performing
</I>&gt;<i>     TLS to upstream servers. They have no place in the &quot;blind tunnel&quot;
</I>&gt;<i>     situation.
</I>&gt;<i>     (They also are deprecated in Squid-4, replaced by the
</I>&gt;<i>     tls_outgoing_options directive
</I>&gt;<i>     &lt;<A HREF="http://www.squid-cache.org/Doc/config/tls_outgoing_options/">http://www.squid-cache.org/Doc/config/tls_outgoing_options/</A>&gt;).
</I>&gt;<i> 
</I>&gt;<i>     If the client software is sending CONNECT requests containing the HTTPS
</I>&gt;<i>     traffic, then there is absolutely nothing your config needs to do than
</I>&gt;<i>     let them send those requests to the proxy (as the default config does).
</I>&gt;<i> 
</I>&gt;<i>     You do not even need Squid to be built with TLS/SSL support. That is the
</I>&gt;<i>     meaning of &quot;blind&quot; in this setup.
</I>&gt;<i> 
</I>&gt;<i>     Amos
</I>&gt;<i>     _______________________________________________
</I>&gt;<i>     squid-users mailing list
</I>&gt;<i>     <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i>     <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> -- 
</I>&gt;<i> 
</I>&gt;<i> *Subhish Pillai*
</I>&gt;<i> 
</I>&gt;<i> R&amp;D Software Quality Engineer
</I>&gt;<i> 
</I>&gt;<i> Broadcom | Brocade Storage Networking
</I>&gt;<i> 
</I>&gt;<i> T&#160;(720) 462-2900
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019817.html">[squid-users] HTTPS proxy setup questions
</A></li>
	<LI>Next message (by thread): <A HREF="019832.html">[squid-users] HTTPS proxy setup questions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19819">[ date ]</a>
              <a href="thread.html#19819">[ thread ]</a>
              <a href="subject.html#19819">[ subject ]</a>
              <a href="author.html#19819">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
