<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] SslBump Peek and Splice using Squid-4.1-5 in Amazon1 Linux with Squid Helpers
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SslBump%20Peek%20and%20Splice%20using%20Squid-4.1-5%20in%0A%20Amazon1%20Linux%20with%20Squid%20Helpers&In-Reply-To=%3CCAE53ZLC1m-qPk_t4pnaNS95bwkNJouuVafAnKSF9CLqtR1mpjg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019794.html">
   <LINK REL="Next"  HREF="019838.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] SslBump Peek and Splice using Squid-4.1-5 in Amazon1 Linux with Squid Helpers</H1>
    <B>Mike Quentel</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SslBump%20Peek%20and%20Splice%20using%20Squid-4.1-5%20in%0A%20Amazon1%20Linux%20with%20Squid%20Helpers&In-Reply-To=%3CCAE53ZLC1m-qPk_t4pnaNS95bwkNJouuVafAnKSF9CLqtR1mpjg%40mail.gmail.com%3E"
       TITLE="[squid-users] SslBump Peek and Splice using Squid-4.1-5 in Amazon1 Linux with Squid Helpers">mike.quentel.rbc at gmail.com
       </A><BR>
    <I>Tue Dec 18 20:31:34 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019794.html">[squid-users] SslBump Peek and Splice using Squid-4.1-5 in Amazon1 Linux with Squid Helpers
</A></li>
        <LI>Next message (by thread): <A HREF="019838.html">[squid-users] SslBump Peek and Splice using Squid-4.1-5 in	Amazon1 Linux with Squid Helpers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19833">[ date ]</a>
              <a href="thread.html#19833">[ thread ]</a>
              <a href="subject.html#19833">[ subject ]</a>
              <a href="author.html#19833">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Resending this message using corrected subject line...

Many thanks Enrico and Amos for the advice you each shared. I have
incorporated the suggested changes into squid.conf and almost have the
desired results in Squid.

Squid is successfully blocking access to TLS sites by an IP address,
but not the same sites using the domain names.

For example, Squid blocking the IP address (taken from nslookup) of
www.google.com successfully works (ERR_ACCESS_DENIED):
<A HREF="https://172.217.1.4">https://172.217.1.4</A>

But, attempting to access <A HREF="https://www.google.com">https://www.google.com</A> will still download
the page (200).

How can I force Squid to block the TLS FQDN versions of web sites that
are not in the white list?

This is the updated squid.conf:

---

visible_hostname squid

http_port 3129 intercept

sslcrtd_children 10

acl CONNECT method CONNECT

acl url_domains dstdomain .amazonaws.com
acl url_domains dstdomain .docker.io
acl url_domains dstdomain .docker.com
acl url_domains dstdomain .congiu.com

https_port 3130 ssl-bump intercept generate-host-certificates=3Don
dynamic_cert_mem_cache_size=3D100MB cert=3D/etc/squid/squid.pem
acl SSL_ports port 443
http_access allow SSL_ports

acl tls_servers ssl::server_name .amazonaws.com
acl tls_servers ssl::server_name .docker.io
acl tls_servers ssl::server_name .docker.com
acl tls_servers ssl::server_name .congiu.com
acl tls_servers ssl::server_name .fedoraproject.org
acl tls_servers ssl::server_name mirror.csclub.uwaterloo.ca
acl tls_servers ssl::server_name .sumologic.com

acl step1 at_step SslBump1
acl step2 at_step SslBump2
acl step3 at_step SslBump3

always_direct allow url_domains
sslproxy_cert_error allow all

http_access deny CONNECT !SSL_Ports
http_access allow url_domains
http_access allow tls_servers
http_access deny all

cache deny all

ssl_bump peek step1 all
ssl_bump peek step2 tls_servers
ssl_bump splice step3 tls_servers
ssl_bump stare step2
ssl_bump bump step3
ssl_bump terminate step2 all

# debug_options ALL,1 80,5
debug_options ALL,1 33,4

---

Thanks, Mike Quentel

On Tue, 11 Dec 2018 at 18:08, &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-request at lists.squid-cache.org</A>&gt; w=
rote:
&gt;<i>
</I>&gt;<i> Send squid-users mailing list submissions to
</I>&gt;<i>         <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i>
</I>&gt;<i> To subscribe or unsubscribe via the World Wide Web, visit
</I>&gt;<i>         <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> or, via email, send a message with subject or body 'help' to
</I>&gt;<i>         <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-request at lists.squid-cache.org</A>
</I>&gt;<i>
</I>&gt;<i> You can reach the person managing the list at
</I>&gt;<i>         <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-owner at lists.squid-cache.org</A>
</I>&gt;<i>
</I>&gt;<i> When replying, please edit your Subject line so it is more specific
</I>&gt;<i> than &quot;Re: Contents of squid-users digest...&quot;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Today's Topics:
</I>&gt;<i>
</I>&gt;<i>    1. SslBump Peek and Splice using Squid-4.1-5 in Amazon1      Linux
</I>&gt;<i>       with Squid Helpers (Mike Quentel)
</I>&gt;<i>    2. Re: SslBump Peek and Splice using Squid-4.1-5 in  Amazon1
</I>&gt;<i>       Linux with Squid Helpers (Enrico Heine)
</I>&gt;<i>    3. Re: SslBump Peek and Splice using Squid-4.1-5 in Amazon1
</I>&gt;<i>       Linux with Squid Helpers (Amos Jeffries)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ----------------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i> Message: 1
</I>&gt;<i> Date: Tue, 11 Dec 2018 10:41:56 -0500
</I>&gt;<i> From: Mike Quentel &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">mike.quentel.rbc at gmail.com</A>&gt;
</I>&gt;<i> To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> Subject: [squid-users] SslBump Peek and Splice using Squid-4.1-5 in
</I>&gt;<i>         Amazon1 Linux with Squid Helpers
</I>&gt;<i> Message-ID:
</I>&gt;<i>         &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">CAE53ZLD9oqt0cUKsrwHSDo8nDEo2Midty0SFMFo842-3u9ovAw at mail.gmail.c</A>=
</I>om&gt;
&gt;<i> Content-Type: text/plain; charset=3D&quot;UTF-8&quot;
</I>&gt;<i>
</I>&gt;<i> Hi, I have been unsuccessfully trying to get Squid-4.1-5 in AWS
</I>&gt;<i> (Amazon 1 Linux) to allow transparent proxy of certain domains, as
</I>&gt;<i> well as IPs associated with those domains, whilst rejecting everything
</I>&gt;<i> else.
</I>&gt;<i>
</I>&gt;<i> I have been referencing documentation at
</I>&gt;<i> <A HREF="https://wiki.squid-cache.org/Features/SslPeekAndSplice">https://wiki.squid-cache.org/Features/SslPeekAndSplice</A>
</I>&gt;<i>
</I>&gt;<i> Version of Squid: 4.1-5 for Amazon 1 Linux available at
</I>&gt;<i> <A HREF="http://faster.ngtech.co.il/repo/amzn/1/beta/x86_64/">http://faster.ngtech.co.il/repo/amzn/1/beta/x86_64/</A> (many thanks to
</I>&gt;<i> @elico for these packages) specifically, the following:
</I>&gt;<i>
</I>&gt;<i> 1) <A HREF="http://faster.ngtech.co.il/repo/amzn/1/beta/x86_64/squid-4.1-5.amzn1.x=">http://faster.ngtech.co.il/repo/amzn/1/beta/x86_64/squid-4.1-5.amzn1.x=</A>
</I>86_64.rpm
&gt;<i> 2) <A HREF="http://faster.ngtech.co.il/repo/amzn/1/beta/x86_64/squid-helpers-4.1-5=">http://faster.ngtech.co.il/repo/amzn/1/beta/x86_64/squid-helpers-4.1-5=</A>
</I>.amzn1.x86_64.rpm
&gt;<i>
</I>&gt;<i> Example of tests that I am running:
</I>&gt;<i>
</I>&gt;<i> 1) curl -kv <A HREF="https://service.us2.sumologic.com">https://service.us2.sumologic.com</A> (EXPECTED: successfully
</I>&gt;<i> accessed; OBSERVED: successfully accessed)
</I>&gt;<i> 2) curl -kv <A HREF="https://54.149.155.70">https://54.149.155.70</A> (EXPECTED: successfully accessed
</I>&gt;<i> because it resolves to service.us2.sumologic.com; OBSERVED:
</I>&gt;<i> &quot;Certificate does not match domainname&quot;  [No Error] (TLS code:
</I>&gt;<i> SQUID_X509_V_ERR_DOMAIN_MISMATCH))
</I>&gt;<i> 3) curl -kv <A HREF="https://www.google.com">https://www.google.com</A> (EXPECTED: failed to access;
</I>&gt;<i> OBSERVED: failed to access)
</I>&gt;<i> 4) curl -kv <A HREF="https://172.217.13.164">https://172.217.13.164</A> (EXPECTED: failed to access;
</I>&gt;<i> OBSERVED: &quot;Certificate does not match domainname&quot;  [No Error] (TLS
</I>&gt;<i> code: SQUID_X509_V_ERR_DOMAIN_MISMATCH))
</I>&gt;<i>
</I>&gt;<i> Below is the latest version of the squid.conf being used. Apologies
</I>&gt;<i> for any obvious errors--new to Squid here. I have been grappling with
</I>&gt;<i> this for weeks, with many iterations of squid.conf so any advice is
</I>&gt;<i> greatly appreciated; many thanks in advance.
</I>&gt;<i>
</I>&gt;<i> ---
</I>&gt;<i>
</I>&gt;<i> visible_hostname squid
</I>&gt;<i>
</I>&gt;<i> host_verify_strict off
</I>&gt;<i>
</I>&gt;<i> # Handling HTTP requests
</I>&gt;<i> http_port 3128
</I>&gt;<i> http_port 3129 intercept
</I>&gt;<i>
</I>&gt;<i> sslcrtd_children 10
</I>&gt;<i>
</I>&gt;<i> acl CONNECT method CONNECT
</I>&gt;<i>
</I>&gt;<i> # AWS services domain
</I>&gt;<i> acl allowed_http_sites dstdomain .amazonaws.com
</I>&gt;<i> # docker hub registry
</I>&gt;<i> acl allowed_http_sites dstdomain .docker.io
</I>&gt;<i> acl allowed_http_sites dstdomain .docker.com
</I>&gt;<i> acl allowed_http_sites dstdomain www.congiu.net
</I>&gt;<i>
</I>&gt;<i> # Handling HTTPS requests
</I>&gt;<i> # https_port 3130 intercept ssl-bump generate-host-certificates=3Don
</I>&gt;<i> dynamic_cert_mem_cache_size=3D100MB cert=3D/etc/squid/squid.pem
</I>&gt;<i> https_port 3130 intercept ssl-bump dynamic_cert_mem_cache_size=3D100MB
</I>&gt;<i> cert=3D/etc/squid/squid.pem
</I>&gt;<i> acl SSL_port port 443
</I>&gt;<i>
</I>&gt;<i> # AWS services domain
</I>&gt;<i> acl allowed_https_sites ssl::server_name .amazonaws.com
</I>&gt;<i> # docker hub registry
</I>&gt;<i> acl allowed_https_sites ssl::server_name .docker.io
</I>&gt;<i> acl allowed_https_sites ssl::server_name .docker.com
</I>&gt;<i>
</I>&gt;<i> # project specific
</I>&gt;<i> acl allowed_https_sites ssl::server_name www.congiu.net
</I>&gt;<i> acl allowed_https_sites ssl::server_name mirrors.fedoraproject.org
</I>&gt;<i> acl allowed_https_sites ssl::server_name mirror.csclub.uwaterloo.ca
</I>&gt;<i>
</I>&gt;<i> # nslookup resolved IPs for collectors.sumologic.com
</I>&gt;<i> # workaround solution to support sumologic collector
</I>&gt;<i> acl allowed_https_sites ssl::server_name .sumologic.com
</I>&gt;<i> # THE FOLLOWING TWO LINES DO NOT SEEM TO WORK AS EXPECTED
</I>&gt;<i> # acl allowed_https_sites ssl::server_name --server-provided
</I>&gt;<i> service.sumologic.com sslflags=3DDONT_VERIFY_PEER
</I>&gt;<i> # acl allowed_https_sites ssl::server_name --server-provided
</I>&gt;<i> service.us2.sumologic.com sslflags=3DDONT_VERIFY_PEER
</I>&gt;<i>
</I>&gt;<i> acl step1 at_step SslBump1
</I>&gt;<i> acl step2 at_step SslBump2
</I>&gt;<i> acl step3 at_step SslBump3
</I>&gt;<i>
</I>&gt;<i> ssl_bump peek step1 all
</I>&gt;<i> ssl_bump peek step2 allowed_https_sites
</I>&gt;<i> # <A HREF="http://lists.squid-cache.org/pipermail/squid-users/2018-September/01915=">http://lists.squid-cache.org/pipermail/squid-users/2018-September/01915=</A>
</I>0.html
&gt;<i> ssl_bump bump
</I>&gt;<i> ssl_bump splice step3 allowed_https_sites
</I>&gt;<i> ssl_bump bump
</I>&gt;<i> ssl_bump terminate step2 all
</I>&gt;<i>
</I>&gt;<i> http_access allow CONNECT
</I>&gt;<i>
</I>&gt;<i> # http_access allow SSL_port
</I>&gt;<i>
</I>&gt;<i> http_access deny CONNECT !allowed_https_sites
</I>&gt;<i> http_access deny CONNECT !allowed_http_sites
</I>&gt;<i> http_access allow allowed_https_sites
</I>&gt;<i> http_access allow allowed_http_sites
</I>&gt;<i> http_access deny all
</I>&gt;<i>
</I>&gt;<i> cache deny all
</I>&gt;<i>
</I>&gt;<i> debug_options &quot;ALL,9&quot;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ------------------------------
</I>&gt;<i>
</I>&gt;<i> Message: 2
</I>&gt;<i> Date: Tue, 11 Dec 2018 18:53:23 +0100
</I>&gt;<i> From: Enrico Heine &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">flashdown at data-core.org</A>&gt;
</I>&gt;<i> To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>, Mike Quentel
</I>&gt;<i>         &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">mike.quentel.rbc at gmail.com</A>&gt;
</I>&gt;<i> Subject: Re: [squid-users] SslBump Peek and Splice using Squid-4.1-5
</I>&gt;<i>         in      Amazon1 Linux with Squid Helpers
</I>&gt;<i> Message-ID: &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">33156AE7-7EFA-4B8D-8B75-059534D73251 at data-core.org</A>&gt;
</I>&gt;<i> Content-Type: text/plain; charset=3D&quot;utf-8&quot;
</I>&gt;<i>
</I>&gt;<i> Dear Mike,
</I>&gt;<i>
</I>&gt;<i> Please checkout the following and let us know if you need further help.
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://www.squid-cache.org/Doc/config/sslproxy_cert_error/">http://www.squid-cache.org/Doc/config/sslproxy_cert_error/</A>
</I>&gt;<i>
</I>&gt;<i> Best regards,
</I>&gt;<i>
</I>&gt;<i> Flashdown
</I>&gt;<i>
</I>&gt;<i> Am 11. Dezember 2018 16:41:56 MEZ schrieb Mike Quentel &lt;mike.quentel.rbc@=
</I>gmail.com&gt;:
&gt;<i> &gt;Hi, I have been unsuccessfully trying to get Squid-4.1-5 in AWS
</I>&gt;<i> &gt;(Amazon 1 Linux) to allow transparent proxy of certain domains, as
</I>&gt;<i> &gt;well as IPs associated with those domains, whilst rejecting everything
</I>&gt;<i> &gt;else.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;I have been referencing documentation at
</I>&gt;<i> &gt;<A HREF="https://wiki.squid-cache.org/Features/SslPeekAndSplice">https://wiki.squid-cache.org/Features/SslPeekAndSplice</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;Version of Squid: 4.1-5 for Amazon 1 Linux available at
</I>&gt;<i> &gt;<A HREF="http://faster.ngtech.co.il/repo/amzn/1/beta/x86_64/">http://faster.ngtech.co.il/repo/amzn/1/beta/x86_64/</A> (many thanks to
</I>&gt;<i> &gt;@elico for these packages) specifically, the following:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;1)
</I>&gt;<i> &gt;<A HREF="http://faster.ngtech.co.il/repo/amzn/1/beta/x86_64/squid-4.1-5.amzn1.x86=">http://faster.ngtech.co.il/repo/amzn/1/beta/x86_64/squid-4.1-5.amzn1.x86=</A>
</I>_64.rpm
&gt;<i> &gt;2)
</I>&gt;<i> &gt;<A HREF="http://faster.ngtech.co.il/repo/amzn/1/beta/x86_64/squid-helpers-4.1-5.a=">http://faster.ngtech.co.il/repo/amzn/1/beta/x86_64/squid-helpers-4.1-5.a=</A>
</I>mzn1.x86_64.rpm
&gt;<i> &gt;
</I>&gt;<i> &gt;Example of tests that I am running:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;1) curl -kv <A HREF="https://service.us2.sumologic.com">https://service.us2.sumologic.com</A> (EXPECTED: successfully
</I>&gt;<i> &gt;accessed; OBSERVED: successfully accessed)
</I>&gt;<i> &gt;2) curl -kv <A HREF="https://54.149.155.70">https://54.149.155.70</A> (EXPECTED: successfully accessed
</I>&gt;<i> &gt;because it resolves to service.us2.sumologic.com; OBSERVED:
</I>&gt;<i> &gt;&quot;Certificate does not match domainname&quot;  [No Error] (TLS code:
</I>&gt;<i> &gt;SQUID_X509_V_ERR_DOMAIN_MISMATCH))
</I>&gt;<i> &gt;3) curl -kv <A HREF="https://www.google.com">https://www.google.com</A> (EXPECTED: failed to access;
</I>&gt;<i> &gt;OBSERVED: failed to access)
</I>&gt;<i> &gt;4) curl -kv <A HREF="https://172.217.13.164">https://172.217.13.164</A> (EXPECTED: failed to access;
</I>&gt;<i> &gt;OBSERVED: &quot;Certificate does not match domainname&quot;  [No Error] (TLS
</I>&gt;<i> &gt;code: SQUID_X509_V_ERR_DOMAIN_MISMATCH))
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;Below is the latest version of the squid.conf being used. Apologies
</I>&gt;<i> &gt;for any obvious errors--new to Squid here. I have been grappling with
</I>&gt;<i> &gt;this for weeks, with many iterations of squid.conf so any advice is
</I>&gt;<i> &gt;greatly appreciated; many thanks in advance.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;---
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;visible_hostname squid
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;host_verify_strict off
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;# Handling HTTP requests
</I>&gt;<i> &gt;http_port 3128
</I>&gt;<i> &gt;http_port 3129 intercept
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;sslcrtd_children 10
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;acl CONNECT method CONNECT
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;# AWS services domain
</I>&gt;<i> &gt;acl allowed_http_sites dstdomain .amazonaws.com
</I>&gt;<i> &gt;# docker hub registry
</I>&gt;<i> &gt;acl allowed_http_sites dstdomain .docker.io
</I>&gt;<i> &gt;acl allowed_http_sites dstdomain .docker.com
</I>&gt;<i> &gt;acl allowed_http_sites dstdomain www.congiu.net
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;# Handling HTTPS requests
</I>&gt;<i> &gt;# https_port 3130 intercept ssl-bump generate-host-certificates=3Don
</I>&gt;<i> &gt;dynamic_cert_mem_cache_size=3D100MB cert=3D/etc/squid/squid.pem
</I>&gt;<i> &gt;https_port 3130 intercept ssl-bump dynamic_cert_mem_cache_size=3D100MB
</I>&gt;<i> &gt;cert=3D/etc/squid/squid.pem
</I>&gt;<i> &gt;acl SSL_port port 443
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;# AWS services domain
</I>&gt;<i> &gt;acl allowed_https_sites ssl::server_name .amazonaws.com
</I>&gt;<i> &gt;# docker hub registry
</I>&gt;<i> &gt;acl allowed_https_sites ssl::server_name .docker.io
</I>&gt;<i> &gt;acl allowed_https_sites ssl::server_name .docker.com
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;# project specific
</I>&gt;<i> &gt;acl allowed_https_sites ssl::server_name www.congiu.net
</I>&gt;<i> &gt;acl allowed_https_sites ssl::server_name mirrors.fedoraproject.org
</I>&gt;<i> &gt;acl allowed_https_sites ssl::server_name mirror.csclub.uwaterloo.ca
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;# nslookup resolved IPs for collectors.sumologic.com
</I>&gt;<i> &gt;# workaround solution to support sumologic collector
</I>&gt;<i> &gt;acl allowed_https_sites ssl::server_name .sumologic.com
</I>&gt;<i> &gt;# THE FOLLOWING TWO LINES DO NOT SEEM TO WORK AS EXPECTED
</I>&gt;<i> &gt;# acl allowed_https_sites ssl::server_name --server-provided
</I>&gt;<i> &gt;service.sumologic.com sslflags=3DDONT_VERIFY_PEER
</I>&gt;<i> &gt;# acl allowed_https_sites ssl::server_name --server-provided
</I>&gt;<i> &gt;service.us2.sumologic.com sslflags=3DDONT_VERIFY_PEER
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;acl step1 at_step SslBump1
</I>&gt;<i> &gt;acl step2 at_step SslBump2
</I>&gt;<i> &gt;acl step3 at_step SslBump3
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;ssl_bump peek step1 all
</I>&gt;<i> &gt;ssl_bump peek step2 allowed_https_sites
</I>&gt;<i> &gt;#
</I>&gt;<i> &gt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/2018-September/019150=">http://lists.squid-cache.org/pipermail/squid-users/2018-September/019150=</A>
</I>.html
&gt;<i> &gt;ssl_bump bump
</I>&gt;<i> &gt;ssl_bump splice step3 allowed_https_sites
</I>&gt;<i> &gt;ssl_bump bump
</I>&gt;<i> &gt;ssl_bump terminate step2 all
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;http_access allow CONNECT
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;# http_access allow SSL_port
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;http_access deny CONNECT !allowed_https_sites
</I>&gt;<i> &gt;http_access deny CONNECT !allowed_http_sites
</I>&gt;<i> &gt;http_access allow allowed_https_sites
</I>&gt;<i> &gt;http_access allow allowed_http_sites
</I>&gt;<i> &gt;http_access deny all
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;cache deny all
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;debug_options &quot;ALL,9&quot;
</I>&gt;<i> &gt;_______________________________________________
</I>&gt;<i> &gt;squid-users mailing list
</I>&gt;<i> &gt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> &gt;<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Diese Nachricht wurde von meinem Android-Ger=C3=A4t mit K-9 Mail gesendet=
</I>.
&gt;<i> -------------- next part --------------
</I>&gt;<i> An HTML attachment was scrubbed...
</I>&gt;<i> URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/2018=">http://lists.squid-cache.org/pipermail/squid-users/attachments/2018=</A>
</I>1211/f46270b6/attachment-0001.html&gt;
&gt;<i>
</I>&gt;<i> ------------------------------
</I>&gt;<i>
</I>&gt;<i> Message: 3
</I>&gt;<i> Date: Wed, 12 Dec 2018 12:07:49 +1300
</I>&gt;<i> From: Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;
</I>&gt;<i> To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> Subject: Re: [squid-users] SslBump Peek and Splice using Squid-4.1-5
</I>&gt;<i>         in Amazon1 Linux with Squid Helpers
</I>&gt;<i> Message-ID: &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">15dc44bc-ef9e-02a6-f4bb-0d05087f5a3b at treenet.co.nz</A>&gt;
</I>&gt;<i> Content-Type: text/plain; charset=3Dutf-8
</I>&gt;<i>
</I>&gt;<i> On 12/12/18 6:53 am, Enrico Heine wrote:
</I>&gt;<i> &gt; Dear Mike,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Please checkout the following and let us know if you need further help.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; <A HREF="http://www.squid-cache.org/Doc/config/sslproxy_cert_error/">http://www.squid-cache.org/Doc/config/sslproxy_cert_error/</A>
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> Before you use it though, please consider what the words &quot;Certificate
</I>&gt;<i> does not match domainname&quot; actually *mean*.
</I>&gt;<i>
</I>&gt;<i> This Squid is configured to deliver a single specific custom-built
</I>&gt;<i> certificate to all clients who contact the proxy. Yet the proxy is being
</I>&gt;<i> used to receive TLS traffic for any domain and the admin is passing test
</I>&gt;<i> traffic for multiple different domains and raw-IP addresses.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; Best regards,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Flashdown
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Am 11. Dezember 2018 16:41:56 MEZ schrieb Mike Quentel:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     Hi, I have been unsuccessfully trying to get Squid-4.1-5 in AWS
</I>&gt;<i> &gt;     (Amazon 1 Linux) to allow transparent proxy of certain domains, as
</I>&gt;<i> &gt;     well as IPs associated with those domains, whilst rejecting everyth=
</I>ing
&gt;<i> &gt;     else.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     I have been referencing documentation at
</I>&gt;<i> &gt;     <A HREF="https://wiki.squid-cache.org/Features/SslPeekAndSplice">https://wiki.squid-cache.org/Features/SslPeekAndSplice</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     Version of Squid: 4.1-5 for Amazon 1 Linux available at
</I>&gt;<i> &gt;     <A HREF="http://faster.ngtech.co.il/repo/amzn/1/beta/x86_64/">http://faster.ngtech.co.il/repo/amzn/1/beta/x86_64/</A> (many thanks to
</I>&gt;<i> &gt;     @elico for these packages) specifically, the following:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     1) <A HREF="http://faster.ngtech.co.il/repo/amzn/1/beta/x86_64/squid-4.1-5.a=">http://faster.ngtech.co.il/repo/amzn/1/beta/x86_64/squid-4.1-5.a=</A>
</I>mzn1.x86_64.rpm
&gt;<i> &gt;     2) <A HREF="http://faster.ngtech.co.il/repo/amzn/1/beta/x86_64/squid-helpers=">http://faster.ngtech.co.il/repo/amzn/1/beta/x86_64/squid-helpers=</A>
</I>-4.1-5.amzn1.x86_64.rpm
&gt;<i> &gt;
</I>&gt;<i> &gt;     Example of tests that I am running:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     1) curl -kv <A HREF="https://service.us2.sumologic.com">https://service.us2.sumologic.com</A> (EXPECTED: successful=
</I>ly
&gt;<i> &gt;     accessed; OBSERVED: successfully accessed)
</I>&gt;<i>
</I>&gt;<i> The TLS SNI contains &quot;service.us2.sumologic.com&quot;, and
</I>&gt;<i>  - the server produced an X.509 certificate for that domain, and
</I>&gt;<i>  - your server_name ACL matches it as a sub-domain of &quot;.sumologic.com&quot;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Note that the -k parameter for curl only disables security on the
</I>&gt;<i> curl&lt;-&gt;Squid TSL connection. It has nothing to do with the
</I>&gt;<i> Squid&lt;-&gt;origin connections.
</I>&gt;<i>
</I>&gt;<i> You should really be using &quot;curl --cacert /etc/squid/squid.pem&quot; or
</I>&gt;<i> connections without the -k to test what actually happens for clients
</I>&gt;<i> when their traffic goes through your system.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt;     2) curl -kv <A HREF="https://54.149.155.70">https://54.149.155.70</A> (EXPECTED: successfully accessed
</I>&gt;<i> &gt;     because it resolves to service.us2.sumologic.com; OBSERVED:
</I>&gt;<i> &gt;     &quot;Certificate does not match domainname&quot;  [No Error] (TLS code:
</I>&gt;<i> &gt;     SQUID_X509_V_ERR_DOMAIN_MISMATCH))
</I>&gt;<i>
</I>&gt;<i> IMO the expectation is what is wrong here.
</I>&gt;<i>
</I>&gt;<i> The TLS SNI does not exist, and
</I>&gt;<i>  - being intercepted traffic the CONNECT authority is
</I>&gt;<i> &quot;54.149.155.70:443&quot;, and
</I>&gt;<i>  - the server produced an X.509 certificate with SubjectName of either
</I>&gt;<i> &quot;54.149.155.70&quot; or something else not matching your server_name ACL entri=
</I>es.
&gt;<i>
</I>&gt;<i> FYI: server_name is a text-string matching ACL. I expect you will find
</I>&gt;<i> there is no reverse-DNS being performed during the ssl_bump testing,
</I>&gt;<i> only later after contact the server has already been decided to allow.
</I>&gt;<i> You can confirm that with the debug log your test produced. Look for the
</I>&gt;<i> lines saying what each ACL is checking for and against.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt;     3) curl -kv <A HREF="https://www.google.com">https://www.google.com</A> (EXPECTED: failed to access;
</I>&gt;<i> &gt;     OBSERVED: failed to access)
</I>&gt;<i>
</I>&gt;<i> &quot;failed to access&quot; is a gross over-simplification. This transaction is
</I>&gt;<i> both allowed and not-allowed at the same time.
</I>&gt;<i>
</I>&gt;<i> If you look into the log I expect you will see this sequence happening:
</I>&gt;<i>
</I>&gt;<i>  * the http_access rules *allow* the CONNECT tunnel, then
</I>&gt;<i>
</I>&gt;<i>  * the ssl_bump rules select do &quot;bump&quot; action at Step-2 (aka. using only
</I>&gt;<i> the TLS clientHello details), then
</I>&gt;<i>
</I>&gt;<i>  * curl -k ignores the small problem that you are not presenting the
</I>&gt;<i> X.509 keys belonging to Google.
</I>&gt;<i>
</I>&gt;<i>  * the decrypted GET request inside the tunnel gets rejected because:
</I>&gt;<i>  - the &quot;allowed_https_sites&quot; ACL has no X.509 server details to test
</I>&gt;<i> against, so does not match.
</I>&gt;<i>   - the &quot;allowed_http_sites&quot; ACL does not match either
</I>&gt;<i>   - the &quot;http_access deny all&quot; matches everything reaching it.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt;     4) curl -kv <A HREF="https://172.217.13.164">https://172.217.13.164</A> (EXPECTED: failed to access;
</I>&gt;<i> &gt;     OBSERVED: &quot;Certificate does not match domainname&quot;  [No Error] (TLS
</I>&gt;<i> &gt;     code: SQUID_X509_V_ERR_DOMAIN_MISMATCH))
</I>&gt;<i>
</I>&gt;<i> Same thing going on as for test (2).
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     Below is the latest version of the squid.conf being used. Apologies
</I>&gt;<i> &gt;     for any obvious errors--new to Squid here. I have been grappling wi=
</I>th
&gt;<i> &gt;     this for weeks, with many iterations of squid.conf so any advice is
</I>&gt;<i> &gt;     greatly appreciated; many thanks in advance.
</I>&gt;<i> &gt;     -------------------------------------------------------------------=
</I>-----
&gt;<i> &gt;     visible_hostname squid
</I>&gt;<i>
</I>&gt;<i> You have connected this proxy to the Internet. The above is required by
</I>&gt;<i> Internet RFCs to be a FQDN (fully qualified domain name).
</I>&gt;<i>
</I>&gt;<i> Even if you do not want to follow that requirements it MUST be a unique
</I>&gt;<i> name.  If any of your HTTP traffic ever goes through another proxy
</I>&gt;<i> sharing this *very common* config mistake you will encounter forwarding
</I>&gt;<i> loop errors.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     host_verify_strict off
</I>&gt;<i>
</I>&gt;<i> This is the default. No need to configure it.
</I>&gt;<i>
</I>&gt;<i> Also, if you added that because the errors you mentioned are talking
</I>&gt;<i> about domain verification - be aware that HTTP &quot;Host:&quot; header
</I>&gt;<i> verification is quite a different thing from TLS certificate verification=
</I>.
&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     # Handling HTTP requests
</I>&gt;<i> &gt;     http_port 3128
</I>&gt;<i> &gt;     http_port 3129 intercept
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     sslcrtd_children 10
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     acl CONNECT method CONNECT
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     # AWS services domain
</I>&gt;<i> &gt;     acl allowed_http_sites dstdomain .amazonaws.com
</I>&gt;<i> &gt;     # docker hub registry
</I>&gt;<i> &gt;     acl allowed_http_sites dstdomain .docker.io
</I>&gt;<i> &gt;     acl allowed_http_sites dstdomain .docker.com
</I>&gt;<i> &gt;     acl allowed_http_sites dstdomain www.congiu.net
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     # Handling HTTPS requests
</I>&gt;<i> &gt;     # https_port 3130 intercept ssl-bump generate-host-certificates=3Do=
</I>n
&gt;<i> &gt;     dynamic_cert_mem_cache_size=3D100MB cert=3D/etc/squid/squid.pem
</I>&gt;<i> &gt;     https_port 3130 intercept ssl-bump dynamic_cert_mem_cache_size=3D10=
</I>0MB
&gt;<i> &gt;     cert=3D/etc/squid/squid.pem
</I>&gt;<i>
</I>&gt;<i> FYI: both the lines above behave identical because the generate-*
</I>&gt;<i> setting you removed was being set to its default value anyway.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt;     acl SSL_port port 443
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     # AWS services domain
</I>&gt;<i> &gt;     acl allowed_https_sites ssl::server_name .amazonaws.com
</I>&gt;<i> &gt;     # docker hub registry
</I>&gt;<i> &gt;     acl allowed_https_sites ssl::server_name .docker.io
</I>&gt;<i> &gt;     acl allowed_https_sites ssl::server_name .docker.com
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     # project specific
</I>&gt;<i> &gt;     acl allowed_https_sites ssl::server_name www.congiu.net
</I>&gt;<i> &gt;     acl allowed_https_sites ssl::server_name mirrors.fedoraproject.org
</I>&gt;<i> &gt;     acl allowed_https_sites ssl::server_name mirror.csclub.uwaterloo.ca
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     # nslookup resolved IPs for collectors.sumologic.com
</I>&gt;<i> &gt;     # workaround solution to support sumologic collector
</I>&gt;<i> &gt;     acl allowed_https_sites ssl::server_name .sumologic.com
</I>&gt;<i> &gt;     # THE FOLLOWING TWO LINES DO NOT SEEM TO WORK AS EXPECTED
</I>&gt;<i>
</I>&gt;<i> The expectation is wrong here.
</I>&gt;<i>
</I>&gt;<i> The string &quot;sslflags=3DDONT_VERIFY_PEER&quot; is not a valid domain nor server
</I>&gt;<i> hostname. So highly unlikely that the X.509 certificate SubjectName or
</I>&gt;<i> AltSubjectName from the origin server will contain that string.
</I>&gt;<i>
</I>&gt;<i> Also, the flag sets the ACL matching algorithm. When that is set the ACL
</I>&gt;<i> cannot match during a ssl_bump &quot;peek step1&quot; cycle.
</I>&gt;<i>
</I>&gt;<i> So one should expect this ACL to stop working when these lines are
</I>&gt;<i> added. Not expect that it would do anything useful.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> FYI: The string &quot;sslflags=3DDONT_VERIFY_PEER&quot; is the name and value of a
</I>&gt;<i> option other directives elsewhere in squid.conf can use. But it is a
</I>&gt;<i> very, very, very bad idea to do so - even 'just for testing'.
</I>&gt;<i>
</I>&gt;<i>  The flag DONT_VERIFY_PEER disables all of TLS security checks - meaning
</I>&gt;<i> the connection actively becomes *less* safe than regular/plain-text TCP
</I>&gt;<i> connections, while simultaneously hiding all resulting issues from
</I>&gt;<i> *your* admin view. Users still have problems, you just cannot see any
</I>&gt;<i> hint of them.
</I>&gt;<i>  So please purge that setting from any configs and documents you come
</I>&gt;<i> across. Investigate and fix any TLS problems that appear, don't just
</I>&gt;<i> hide the error messages and pretend everything works.
</I>&gt;<i>  Same reason not to be using the equivalent &quot;curl -k&quot; option for testing
</I>&gt;<i> TLS validation/verification problems.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt;     # acl allowed_https_sites ssl::server_name --server-provided
</I>&gt;<i> &gt;     service.sumologic.com sslflags=3DDONT_VERIFY_PEER
</I>&gt;<i> &gt;     # acl allowed_https_sites ssl::server_name --server-provided
</I>&gt;<i> &gt;     service.us2.sumologic.com sslflags=3DDONT_VERIFY_PEER
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     acl step1 at_step SslBump1
</I>&gt;<i> &gt;     acl step2 at_step SslBump2
</I>&gt;<i> &gt;     acl step3 at_step SslBump3
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     ssl_bump peek step1 all
</I>&gt;<i>
</I>&gt;<i> The &quot;all&quot; here is useless and only adds confusion to anyone who thinks
</I>&gt;<i> it has any meaning.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt;     ssl_bump peek step2 allowed_https_sites
</I>&gt;<i> &gt;     # <A HREF="http://lists.squid-cache.org/pipermail/squid-users/2018-September=">http://lists.squid-cache.org/pipermail/squid-users/2018-September=</A>
</I>/019150.html
&gt;<i>
</I>&gt;<i> The author of that did not understand how the ssl-bump processing was
</I>&gt;<i> working. That entire message thread is them attempting to learn and IMO
</I>&gt;<i> still not quite understanding the ideas in the end.
</I>&gt;<i>
</I>&gt;<i> Blindly copying into your config from experiments by someone who does
</I>&gt;<i> not understand what they are doing is not a good idea. Use an actually
</I>&gt;<i> known-working config example (the Squid wiki has several), or try to
</I>&gt;<i> design your own based on your own understanding. At the very least we
</I>&gt;<i> can see from your self-designed attempt what you may be thinking and
</I>&gt;<i> hopefully teach you where any mistakes are visible.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt;     ssl_bump bump
</I>&gt;<i>
</I>&gt;<i> Please be aware that when this line when reached at step2 it performs
</I>&gt;<i> &quot;client-first&quot; bumping of the TLS.
</I>&gt;<i>
</I>&gt;<i> That means bumping and performing TLS handshake without any real X.509
</I>&gt;<i> server details for your allowed_https_sites ACL to use. Only
</I>&gt;<i> client-provided claims about what server they are contacting (which may
</I>&gt;<i> be outright lies). This has side-effects on what your ssl::server_name
</I>&gt;<i> vs dstdomain ACL do in the later http_access checks.
</I>&gt;<i>
</I>&gt;<i> Specifically when the server_name and the URL domain are different
</I>&gt;<i> things a simple as testing one first can change permissions for the
</I>&gt;<i> client in the other.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt;     ssl_bump splice step3 allowed_https_sites
</I>&gt;<i>
</I>&gt;<i> So some of your traffic will splice from the above line - but only
</I>&gt;<i> because of the peek (step2) then bump (step3) combination being impossibl=
</I>e.
&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt;     ssl_bump bump
</I>&gt;<i>
</I>&gt;<i> There is already an unrestricted &quot;bump&quot; action earlier. This line does
</I>&gt;<i> nothing even if it were possibly reached.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt;     ssl_bump terminate step2 all
</I>&gt;<i>
</I>&gt;<i> There is a peek action specified earlier for step2, with an unrestricted
</I>&gt;<i> bump action as a fallback when allowed_https_sites fails to match. This
</I>&gt;<i> line is never reachable.
</I>&gt;<i>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     http_access allow CONNECT
</I>&gt;<i>
</I>&gt;<i> Ouch. Really do not do the above. The default config file shipped with
</I>&gt;<i> Squid starts with these lines for very good reasons:
</I>&gt;<i>
</I>&gt;<i> &quot;
</I>&gt;<i>   http_access deny !Safe_ports
</I>&gt;<i>   http_access deny CONNECT !SSL_ports
</I>&gt;<i>   http_access allow localhost manager
</I>&gt;<i>   http_access deny manager
</I>&gt;<i>
</I>&gt;<i>   #
</I>&gt;<i>   # INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
</I>&gt;<i>   #
</I>&gt;<i> &quot;
</I>&gt;<i>
</I>&gt;<i> Those reasons (DoS and proxy relay security vulnerabilities) are still
</I>&gt;<i> very much relevant in your setup, with no reason to remove them. So
</I>&gt;<i> please add them back before you continue testing things, with your
</I>&gt;<i> custom http_access rules *underneath* that comment line.
</I>&gt;<i>
</I>&gt;<i> Also, the default SSL_ports is already setup in a way that meets your
</I>&gt;<i> requirements. You can adjust Safe_ports to be only the same port, or use
</I>&gt;<i> the default set of safe-for-HTTP ports.
</I>&gt;<i>
</I>&gt;<i> FYI: the config you have right now allows any malicious origin server
</I>&gt;<i> receiving trafic on port 443 to present a X.509 certificate claiming to b=
</I>e.
&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     # http_access allow SSL_port
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     http_access deny CONNECT !allowed_https_sites
</I>&gt;<i> &gt;     http_access deny CONNECT !allowed_http_sites
</I>&gt;<i>
</I>&gt;<i> The above two lines do nothing in your current config. CONNECT requests
</I>&gt;<i> are *always* allowed by the line you had earlier.
</I>&gt;<i>
</I>&gt;<i> Once you move back to the default security checks these will start to do
</I>&gt;<i> things. It would probably be best to remove the two lines above to
</I>&gt;<i> prevent the unexpected new behaviour from confusing you further.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt;     http_access allow allowed_https_sites
</I>&gt;<i> &gt;     http_access allow allowed_http_sites
</I>&gt;<i>
</I>&gt;<i> These ACLs are very badly named.
</I>&gt;<i>
</I>&gt;<i> * The one called &quot;allowed_https_sites&quot;:
</I>&gt;<i>  - will *not* match against HTTPS traffic arriving on port 3128 unless
</I>&gt;<i> the CONNECT authority-uri names a domain in your list.
</I>&gt;<i>
</I>&gt;<i> - *will* match against HTTP traffic on port 3128 and port 3129 with
</I>&gt;<i> &quot;<A HREF="https://">https://</A>&quot; URLs.
</I>&gt;<i>
</I>&gt;<i> * The one called &quot;allowed_http_sites&quot; *will* match against HTTPS traffic
</I>&gt;<i> arriving on any port.
</I>&gt;<i>
</I>&gt;<i>  --&gt; meaning that for both of them the &quot;https&quot; and &quot;http&quot; word in their
</I>&gt;<i> name is deceptive.
</I>&gt;<i>
</I>&gt;<i> * Both these ACLs are used to *deny* traffic.
</I>&gt;<i>  --&gt; meaning the &quot;allowed&quot; word in their name is deceptive.
</I>&gt;<i>
</I>&gt;<i> What you are left with is just &quot;sites&quot; which is so vague as to be
</I>&gt;<i> meaningless.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> It would be a lot clearer if you renamed them:
</I>&gt;<i>  - &quot;allowed_https_sites&quot; to &quot;tls_servers&quot;
</I>&gt;<i>  - &quot;allowed_http_sites&quot; to &quot;url_domains&quot;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt;     http_access deny all
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     cache deny all
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     debug_options &quot;ALL,9&quot;
</I>&gt;<i>
</I>&gt;<i> Cheers
</I>&gt;<i> Amos
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ------------------------------
</I>&gt;<i>
</I>&gt;<i> Subject: Digest Footer
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ------------------------------
</I>&gt;<i>
</I>&gt;<i> End of squid-users Digest, Vol 52, Issue 13
</I>&gt;<i> *******************************************
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019794.html">[squid-users] SslBump Peek and Splice using Squid-4.1-5 in Amazon1 Linux with Squid Helpers
</A></li>
	<LI>Next message (by thread): <A HREF="019838.html">[squid-users] SslBump Peek and Splice using Squid-4.1-5 in	Amazon1 Linux with Squid Helpers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19833">[ date ]</a>
              <a href="thread.html#19833">[ thread ]</a>
              <a href="subject.html#19833">[ subject ]</a>
              <a href="author.html#19833">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
