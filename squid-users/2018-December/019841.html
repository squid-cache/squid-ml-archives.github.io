<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid https: using non-self-signed cert
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20https%3A%20using%20non-self-signed%20cert&In-Reply-To=%3C0ea76ed4-df2c-3695-7db2-c6c88d513b81%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019836.html">
   <LINK REL="Next"  HREF="019835.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid https: using non-self-signed cert</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20https%3A%20using%20non-self-signed%20cert&In-Reply-To=%3C0ea76ed4-df2c-3695-7db2-c6c88d513b81%40treenet.co.nz%3E"
       TITLE="[squid-users] squid https: using non-self-signed cert">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Dec 19 16:49:10 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019836.html">[squid-users] squid https: using non-self-signed cert
</A></li>
        <LI>Next message (by thread): <A HREF="019835.html">[squid-users] Advice - Squid Proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19841">[ date ]</a>
              <a href="thread.html#19841">[ thread ]</a>
              <a href="subject.html#19841">[ subject ]</a>
              <a href="author.html#19841">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 20/12/18 4:32 am, Meridoff wrote:
&gt;<i> 1) I just try to intercept https traffic. I use https_port ...
</I>&gt;<i> cert=cert.pem capath=/dir . So squid can generate &#160;sertificates based on
</I>&gt;<i> file.cert as Root CA.
</I>&gt;<i> 
</I>
Yes.

&gt;<i> So, my file.cert is combined from cert and key files. And it is not
</I>&gt;<i> sefl-signed.
</I>
Please change your focus away from the &quot;self-signed&quot; term. As I wrote
earlier it is just a way of saying &quot;Root CA&quot;.

The relevant thing is the &quot;CA&quot; part. What is special about CA is that
those certificates can be used to sign other certificates.
 Or in other words: CA cert are &quot;signing SSL certificate&quot;.


&gt;<i> Checked by openssl:&#160;
</I>&gt;<i> openssl verify cert.pem
</I>&gt;<i> cert.pem: CN = *.xxx.com &lt;<A HREF="http://xxx.com">http://xxx.com</A>&gt;
</I>&gt;<i> error 20 at 0 depth lookup:unable to get local issuer certificate
</I>&gt;<i> And squid complains too:&#160;FATAL: No valid signing SSL certificate configured
</I>&gt;<i> 
</I>
These are very different messages.

OpenSSL is complaining that the PEM file contains a certificate which
cannot be validated by any CA it trusts.

Squid is complaining that the PEM file does not contain a CA cert + CA
key it can use for signing when generating leaf certificates.


&gt;<i> I think squid want to know who signed this cert - all cert chain to root
</I>&gt;<i> cert. From where squid sholud know where to get all intermidiate CA
</I>&gt;<i> certs for this cert.pem file ?
</I>

You have this slightly backwards. The PEM file is where Squid gets the
CA chain.

The PEM file should contain the CA cert + CA key Squid will be using to
generate leaf certs, plus any extra CA chain up to some CA the clients
trust.


&gt;<i> 
</I>&gt;<i> 2) In capath dir: is it neccesary to put here files in hash-format (as
</I>&gt;<i> &quot;man verify&quot; for -CApath says): I mean for example 1234abcde.0 PEM-file
</I>&gt;<i> in this dir.
</I>
Skip this. Like I said earlier that option is about other things not
relevant to your problem.

Your problem is that you are trying to use a leaf certificate for HTTPS
interception. You need a CA certificate.

The PEM file can contain:
 * an intermediary CA cert, or
 * a root CA cert (aka self-signed cert), or
 * a chain of intermediary CA certs, or
 * a chain of intermediary CA certs and their root CA cert.


Notice the constant detail in all those: &quot;CA cert&quot;.


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019836.html">[squid-users] squid https: using non-self-signed cert
</A></li>
	<LI>Next message (by thread): <A HREF="019835.html">[squid-users] Advice - Squid Proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19841">[ date ]</a>
              <a href="thread.html#19841">[ thread ]</a>
              <a href="subject.html#19841">[ subject ]</a>
              <a href="author.html#19841">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
