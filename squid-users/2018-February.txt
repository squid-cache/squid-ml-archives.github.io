From skupko.sk at gmail.com  Fri Feb  2 10:42:40 2018
From: skupko.sk at gmail.com (Peter Viskup)
Date: Fri, 2 Feb 2018 11:42:40 +0100
Subject: [squid-users] Squid service-name macro one config and different
	ports
Message-ID: <CAPa6PsGa4q6PJfH9S5knjhEHKQC=Euf-b14fd07NufgGThn+HQ@mail.gmail.com>

Want to run multiple instances of Squid4 on the same server with different
ports and one configuration file.
Not sure whether (and how) the http_port and snmp_port options can be made
as conditional options in squid.conf.
At the moment it looks like it is not possible.

The workaround can be to use separate configuration file for each instance
(inst1.conf, inst2.cond) and include the "global" part of the configuration
in both of them or separate files with the same global part.

Does somebody of you have other proposal?

Thank you.

Peter
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180202/a63c1359/attachment.htm>

From squid3 at treenet.co.nz  Fri Feb  2 11:13:01 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 3 Feb 2018 00:13:01 +1300
Subject: [squid-users] Squid service-name macro one config and different
 ports
In-Reply-To: <CAPa6PsGa4q6PJfH9S5knjhEHKQC=Euf-b14fd07NufgGThn+HQ@mail.gmail.com>
References: <CAPa6PsGa4q6PJfH9S5knjhEHKQC=Euf-b14fd07NufgGThn+HQ@mail.gmail.com>
Message-ID: <6e8f2078-4655-a331-13b9-7b01c2a24ce9@treenet.co.nz>

On 02/02/18 23:42, Peter Viskup wrote:
> Want to run multiple instances of Squid4 on the same server with
> different ports and one configuration file.
> Not sure whether (and how) the http_port and snmp_port options can be
> made as conditional options in squid.conf.
> At the moment it looks like it is not possible.

"conditional" on what exactly?

When run properly as multi-tenant instances with the -n namespace
separation the Squid instances know nothing about each other. So there
is no possible way to configure "I am X not Y" conditions.


That said the namespace is provided as a config macro for a reason.
Which is to make it possible to do this:

squid.conf:
 ...
 include /etc/squid/${service_name}.conf
 ...

With the unique parts being in the per-service / instance config files.


Or you can do it the other way around, with -f parameters pointing each
instance at a unique master config file, each of which includes the
shared config file.

see <http://www.squid-cache.org/Versions/v3/3.5/RELEASENOTES.html#ss2.3>


Amos


From skupko.sk at gmail.com  Fri Feb  2 11:55:34 2018
From: skupko.sk at gmail.com (Peter Viskup)
Date: Fri, 2 Feb 2018 12:55:34 +0100
Subject: [squid-users] Squid service-name macro one config and different
	ports
In-Reply-To: <6e8f2078-4655-a331-13b9-7b01c2a24ce9@treenet.co.nz>
References: <CAPa6PsGa4q6PJfH9S5knjhEHKQC=Euf-b14fd07NufgGThn+HQ@mail.gmail.com>
 <6e8f2078-4655-a331-13b9-7b01c2a24ce9@treenet.co.nz>
Message-ID: <CAPa6PsFKJzunvj4OsoAfzSKPn_gwShJv8VNfGwTP+L5ER1fgLw@mail.gmail.com>

On Fri, Feb 2, 2018 at 12:13 PM, Amos Jeffries <squid3 at treenet.co.nz> wrote:
>
> On 02/02/18 23:42, Peter Viskup wrote:
> > Want to run multiple instances of Squid4 on the same server with
> > different ports and one configuration file.
> > Not sure whether (and how) the http_port and snmp_port options can be
> > made as conditional options in squid.conf.
> > At the moment it looks like it is not possible.
>
> "conditional" on what exactly?
>
> When run properly as multi-tenant instances with the -n namespace
> separation the Squid instances know nothing about each other. So there
> is no possible way to configure "I am X not Y" conditions.
>
>
> That said the namespace is provided as a config macro for a reason.
> Which is to make it possible to do this:
>
> squid.conf:
>  ...
>  include /etc/squid/${service_name}.conf
>  ...

This is exactly I was looking for.

This way I would be able to use one global config with service
specific includes.

Thank you.

Peter


From robertocarna36 at gmail.com  Fri Feb  2 14:42:09 2018
From: robertocarna36 at gmail.com (Roberto Carna)
Date: Fri, 2 Feb 2018 11:42:09 -0300
Subject: [squid-users] I can't understand the SSL connectios interception
 concept in explicit mode
Message-ID: <CAG2Qp6s1FE0w1W3Z-vgMS0iZmJrH4uy=+k3sFh4s+y-JkH+7og@mail.gmail.com>

Dear, I can't understand an important concept:

I know that in transparent proxy mode, I have to intercept HTTPS
traffic in order to proxy and filter it.

But I read in the pfSense's Squid help that in explicit mode there is
no need to intercept the HTTPS traffic in order to proxy and filter
it....why is this possible? I think the explicit Squid proxy has to
intercept traffic in order to porxy and eventually filter it....

Please can you explain me this concept?

Special thanks


From uhlar at fantomas.sk  Fri Feb  2 15:06:04 2018
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Fri, 2 Feb 2018 16:06:04 +0100
Subject: [squid-users] I can't understand the SSL connectios
 interception concept in explicit mode
In-Reply-To: <CAG2Qp6s1FE0w1W3Z-vgMS0iZmJrH4uy=+k3sFh4s+y-JkH+7og@mail.gmail.com>
References: <CAG2Qp6s1FE0w1W3Z-vgMS0iZmJrH4uy=+k3sFh4s+y-JkH+7og@mail.gmail.com>
Message-ID: <20180202150604.GA7089@fantomas.sk>

On 02.02.18 11:42, Roberto Carna wrote:
>Dear, I can't understand an important concept:
>
>I know that in transparent proxy mode, I have to intercept HTTPS
>traffic in order to proxy and filter it.
>
>But I read in the pfSense's Squid help that in explicit mode there is
>no need to intercept the HTTPS traffic in order to proxy and filter
>it....why is this possible? I think the explicit Squid proxy has to
>intercept traffic in order to porxy and eventually filter it....
>
>Please can you explain me this concept?

explicit mode is where the client explicitly connect to the proxy and asks
it to CONNECT to the server. There's no need to intercept the connection
because the connection is done to the proxy.
-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
WinError #98652: Operation completed successfully.


From robertocarna36 at gmail.com  Fri Feb  2 15:12:54 2018
From: robertocarna36 at gmail.com (Roberto Carna)
Date: Fri, 2 Feb 2018 12:12:54 -0300
Subject: [squid-users] I can't understand the SSL connectios
 interception concept in explicit mode
In-Reply-To: <20180202150604.GA7089@fantomas.sk>
References: <CAG2Qp6s1FE0w1W3Z-vgMS0iZmJrH4uy=+k3sFh4s+y-JkH+7og@mail.gmail.com>
 <20180202150604.GA7089@fantomas.sk>
Message-ID: <CAG2Qp6vexiULAcboHpns1dJeZ1oifk3_ZWV0jn58qgO_YbtPnw@mail.gmail.com>

OK Matus, now I understand....but let me ask one more question:

In explicit mode, is it possible that a given person with Squid
advanced knowledge can see the plain text of the traffic? Because if
this person is the admin of the proxy server, I think it may be a way
to read the plain content of the connection user-remote server.

Thanks a lot again !!!

2018-02-02 12:06 GMT-03:00 Matus UHLAR - fantomas <uhlar at fantomas.sk>:
> On 02.02.18 11:42, Roberto Carna wrote:
>>
>> Dear, I can't understand an important concept:
>>
>> I know that in transparent proxy mode, I have to intercept HTTPS
>> traffic in order to proxy and filter it.
>>
>> But I read in the pfSense's Squid help that in explicit mode there is
>> no need to intercept the HTTPS traffic in order to proxy and filter
>> it....why is this possible? I think the explicit Squid proxy has to
>> intercept traffic in order to porxy and eventually filter it....
>>
>> Please can you explain me this concept?
>
>
> explicit mode is where the client explicitly connect to the proxy and asks
> it to CONNECT to the server. There's no need to intercept the connection
> because the connection is done to the proxy.
> --
> Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
> Warning: I wish NOT to receive e-mail advertising to this address.
> Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
> WinError #98652: Operation completed successfully.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users


From rousskov at measurement-factory.com  Fri Feb  2 15:18:26 2018
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Fri, 2 Feb 2018 08:18:26 -0700
Subject: [squid-users] Squid service-name macro one config and different
 ports
In-Reply-To: <CAPa6PsGa4q6PJfH9S5knjhEHKQC=Euf-b14fd07NufgGThn+HQ@mail.gmail.com>
References: <CAPa6PsGa4q6PJfH9S5knjhEHKQC=Euf-b14fd07NufgGThn+HQ@mail.gmail.com>
Message-ID: <790048ef-4bf4-44d1-ca3f-93ce52f8f757@measurement-factory.com>

On 02/02/2018 03:42 AM, Peter Viskup wrote:
> Want to run multiple instances of Squid4 on the same server with
> different ports and one configuration file.

Set the service name to the port number and use the ${service_name}
squid.conf macro.

Needless to say, if your configurations differ by more than port
numbers, then using ${service_name} in include directives, as suggested
by Amos, offers a lot more flexibility.

Alex.


From acrow at integrafin.co.uk  Fri Feb  2 15:25:02 2018
From: acrow at integrafin.co.uk (Alex Crow)
Date: Fri, 2 Feb 2018 15:25:02 +0000
Subject: [squid-users] I can't understand the SSL connectios
 interception concept in explicit mode
In-Reply-To: <CAG2Qp6vexiULAcboHpns1dJeZ1oifk3_ZWV0jn58qgO_YbtPnw@mail.gmail.com>
References: <CAG2Qp6s1FE0w1W3Z-vgMS0iZmJrH4uy=+k3sFh4s+y-JkH+7og@mail.gmail.com>
 <20180202150604.GA7089@fantomas.sk>
 <CAG2Qp6vexiULAcboHpns1dJeZ1oifk3_ZWV0jn58qgO_YbtPnw@mail.gmail.com>
Message-ID: <af240f7b-770f-42fb-4949-c394113f4444@integrafin.co.uk>

On 02/02/18 15:12, Roberto Carna wrote:
> OK Matus, now I understand....but let me ask one more question:
>
> In explicit mode, is it possible that a given person with Squid
> advanced knowledge can see the plain text of the traffic? Because if
> this person is the admin of the proxy server, I think it may be a way
> to read the plain content of the connection user-remote server.
>
> Thanks a lot again !!!
>
>
Unless you are using ssl-bump/peek and splice (which will be show up a 
warning in the browser if squid's CA in not installed in its list of 
authorities) the traffic is tunneled through squid still encrypted. You 
can't see anything but the domain part of the URL.

If you are bumping, and have installed CAs into browsers, just, of 
course it's possible for a proxy admin to see the plaintext.

Cheers

Alex
--
This message is intended only for the addressee and may contain
confidential information. Unless you are that person, you may not
disclose its contents or use it in any way and are requested to delete
the message along with any attachments and notify us immediately.
This email is not intended to, nor should it be taken to, constitute advice.
The information provided is correct to our knowledge & belief and must not
be used as a substitute for obtaining tax, regulatory, investment, legal or
any other appropriate advice.

"Transact" is operated by Integrated Financial Arrangements Ltd.
29 Clement's Lane, London EC4N 7AE. Tel: (020) 7608 4900 Fax: (020) 7608 5300.
(Registered office: as above; Registered in England and Wales under
number: 3727592). Authorised and regulated by the Financial Conduct
Authority (entered on the Financial Services Register; no. 190856).


From eliezer at ngtech.co.il  Sat Feb  3 23:06:28 2018
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Sun, 4 Feb 2018 01:06:28 +0200
Subject: [squid-users] SMP mode and StoreID rewriter
In-Reply-To: <1287464f-5368-be4d-e734-883a703c96c2@measurement-factory.com>
References: <CAHvB88wUQvJ8H-ywxeVgJss7UwL+N8zmU1FRrs8hd9v_+HQmCQ@mail.gmail.com>
 <1287464f-5368-be4d-e734-883a703c96c2@measurement-factory.com>
Message-ID: <161001d39d43$9f5c1ca0$de1455e0$@ngtech.co.il>

Hey,

For most StoreID helpers you won't care about this but the other option is StoreID ICAP server integration but I didn't had enough time to work on it.
If you can run "ps aux" and share the relevant StoreID helpers lines it would help to understand how significant it is.
For most systems couple MB of RES\RSS memory is fine but if it grows over time or for some reason consumes lots of memory you should rethink\re-design the helper.

Eliezer

* I'm not following the users list these days so FW the post to my email directly

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: eliezer at ngtech.co.il



-----Original Message-----
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Alex Rousskov
Sent: Thursday, January 11, 2018 06:31
To: Ivan Larionov <xeron.oskom at gmail.com>; squid-users at lists.squid-cache.org
Subject: Re: [squid-users] SMP mode and StoreID rewriter

On 01/10/2018 06:31 PM, Ivan Larionov wrote:

> I just wanted to make sure it's ok to see store_id_program started for
> every child or may be it's sort of a bug.

It is "sort of a bug" -- Squid should not start store_id_program (and
many other helpers!) for some kids. Many Squid features are not made
SMP-aware yet, and features that "work fine" in SMP mode are often
ignored by developers and their sponsors. Quality patches welcome!

Ideally, workers should even be able to share helper processes, but that
is a huge change compared to simply not starting unnecessary helpers.


> May be it should be started only for "worker" or only for "disk"?

Yes, only for "worker" IIRC: Diskers do not deal with HTTP, and Store ID
is an HTTP-request-to-Store-ID translator.

Alex.
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From eliezer at ngtech.co.il  Sun Feb  4 00:10:35 2018
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Sun, 4 Feb 2018 02:10:35 +0200
Subject: [squid-users] Squid 4.0.23 beta RPM's are available
Message-ID: <161701d39d4c$942e6460$bc8b2d20$@ngtech.co.il>

Hey All,

I have just published 4.0.23 RPM's+SRPM's beta packages for:
SLES 12
OpenSUSE Leap 42.3
Oracle Enterprise Linux 7
CentOS 7

All The Bests,
Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: eliezer at ngtech.co.il



-----Original Message-----
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Amos Jeffries
Sent: Sunday, January 21, 2018 09:52
To: squid-announce at lists.squid-cache.org
Subject: [squid-users] [squid-announce] Squid 4.0.23 beta is available

The Squid HTTP Proxy team is very pleased to announce the availability of the Squid-4.0.23 release!


This release is a security vulnerability and bug fix release resolving several issues found in the prior Squid releases.


The major changes to be aware of:

* SQUID-2018:1 Denial of Service issue in ESI Response processing.

Squid would crash when receiving certain ESI syntax from its origin servers. This is particularly problematic for servers which only deliver the relevant syntax on uncommon responses so are not easily detected.

The SSL-Bump feature for HTTPS interception was entangled with reverse-proxy processing (and in some cases may still be). Making use of the SSL-Bump feature also at risk of encountering the responses from servers. Both splice and bump actions are affected.


The fix for Squid-4 is to remove the affected ESI custom parser entirely. The use of libxml2 or libexpat is now required for ESI support. The default behaviour is to auto-select the most preferred library built against.

Installations explicitly choosing "esi_parser custom" in their squid.conf will need to change to one of the above mentioned libraries.


Please see the accompanying ADVISORY for details on determining your 
proxy vulnerability and for patches applicable to older versions.


* SQUID-2018:2 Denial of Service issue in HTTP Message processing.

Squid generating ESI sub-requests and requests by the new auto-Download 
feature for intermediary TLS certificates could lead to crashes when 
preparing to log the transaction. This issue can be triggered on demand 
by clients.

Please see the accompanying ADVISORY for details on determining your 
proxy vulnerability and for patches applicable to older versions.


* Bug 4679: User names not sent to url_rewrite_program

This bug appeared as missing user name in url_rewrite_extras parameters 
to the re-writer program when that name was retrieved via an 
authorization mechanism instead of authorization. Specifically IDENT 
protocol or external ACL helpers.


* Bug 4631: security_file_certgen helper without disk cache

This helpers reliance on disk cache management can slow it down on some 
systems which are otherwise able to generate certificates fast. Running 
it purely from memory is now a possibility to avoid these performance 
issues. However, there is no memory cache as yet so this memory-only 
operation requires generating new certificates on every lookup.

Admin encountering significant speed issues with SSL-Bump are encouraged 
to try this helper behaviour. Others


* Nettle v3.4 support

The Nettle library API used by Squid has undergone several updates 
across its 3.3 and 3.4 releases which make recent Squid not able to 
build with these recent libraries.

This Squid now supports the Nettle-3.4 API, with backward compatibility 
provided if older Nettle versions are being used.


* Fix %<Hs, %<pt, %<tt, %<bs calculation bugs for error responses

These logformat macros/codes were not producing accurate outputs in 
certain transactions. Most issues were related to CONNECT tunnel 
transactions, although some issues occurred in other transactions. All 
known issues with these macros/codes are fixed in this Squid release.



  All users of Squid-4.x are urged to upgrade to this release as
soon as possible.

  All users of Squid-3 are encouraged to test this release out and plan
for upgrades where possible.


  See the ChangeLog for the full list of changes in this and earlier
  releases.

Please refer to the release notes at
http://www.squid-cache.org/Versions/v4/RELEASENOTES.html
when you are ready to make the switch to Squid-4

This new release can be downloaded from our HTTP or FTP servers

  http://www.squid-cache.org/Versions/v4/
  ftp://ftp.squid-cache.org/pub/squid/
  ftp://ftp.squid-cache.org/pub/archive/4/

or the mirrors. For a list of mirror sites see

  http://www.squid-cache.org/Download/http-mirrors.html
  http://www.squid-cache.org/Download/mirrors.html

If you encounter any issues with this release please file a bug report.
http://bugs.squid-cache.org/


Amos Jeffries
_______________________________________________
squid-announce mailing list
squid-announce at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-announce
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From eliezer at ngtech.co.il  Sun Feb  4 00:12:12 2018
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Sun, 4 Feb 2018 02:12:12 +0200
Subject: [squid-users] 4.0.23 release in Debian
In-Reply-To: <ead2f401-72db-5fdd-39e2-548fe7dc6bc9@treenet.co.nz>
References: <E447B375-ABA3-413A-B103-1E167AA39052@yahoo.com>
 <ead2f401-72db-5fdd-39e2-548fe7dc6bc9@treenet.co.nz>
Message-ID: <161901d39d4c$ce282890$6a7879b0$@ngtech.co.il>

I would try to release DEB package for Debian and Ubuntu on my free time.

Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: eliezer at ngtech.co.il



-----Original Message-----
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Amos Jeffries
Sent: Monday, January 22, 2018 12:19
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] 4.0.23 release in Debian

On 22/01/18 22:37, TarotApprentice wrote:
> Given today?s announcement of squid 4.0.23, are there plans for Debian to pick it up?
> 
> Currently they have 4.0.21 in experimental and 3.5.23 in their other repos. Emails to the squid maintainers at Debian go unanswered.


Did you mail Luigi directly or the
pkg-squid-devel at lists.alioth.debian.org team list?
  I don't see anything coming to the list if so.

As to your question; Updates to the stable Debian are in the hands of
the Debian Security Team. There were no advance notices so all the OS
updates are yet to happen.
 I'm preparing the experimental package updates now. Others in the
pkg-squid team to check and upload, so time varies.

Amos
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From chip_pop at hotmail.com  Sun Feb  4 09:11:07 2018
From: chip_pop at hotmail.com (joseph)
Date: Sun, 4 Feb 2018 02:11:07 -0700 (MST)
Subject: [squid-users] write thread ?
Message-ID: <1517735467131-0.post@n4.nabble.com>

is there any future fix for the write thread 

#define ASYNC_OPEN 1
#define ASYNC_CLOSE 0
#define ASYNC_CREATE 1
#define ASYNC_WRITE 0
#define ASYNC_READ 1

if i enable ASYNC_WRITE  1   #define ASYNC_CLOSE 1
i get
 WARNING: failed to unpack metadata because store entry metadata is
corrupted
    exception location: StoreMetaUnpacker.cc(43) checkBuffer

 cannot unlink mem_node  while write_pending



-----
************************** 
***** Crash to the future  ****
**************************
--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From ahmed.zaeem at netstream.ps  Sun Feb  4 09:53:22 2018
From: ahmed.zaeem at netstream.ps (--Ahmad--)
Date: Sun, 4 Feb 2018 11:53:22 +0200
Subject: [squid-users] need outgoing addresses without duplication over big
	pool of addresses
Message-ID: <983F1400-B0E6-47EF-BEE9-81B5A30E687A@netstream.ps>

Hello Folks .

I?m trying to deploy squid with IPV6 solution that can give me outgoing address without any duplication .

say i have 10 millions of ip addresses on server ( IPV6 addresses ) /64 subnet .

and i have single port as back connect that will rotate the eternal ip address from that list of addresses for each request 


I?m aware of squid random acl but there is like 1.5 % duplication over 1 hour  which i guess its normal behaviour for rotation random protocol .

my question is  :

what options in squid ACL or random algorithm that can randomise each request without any kind of duplication .

is there a way that we let squid on each request have outgoing address in sequence way .

say i have 10 millions of ips

and if i i made 10 millions of request i have 10 million non duplication outgoing address ?

plz let me know if this can be done from squid 

or  other tools like HA
or operation system itself .

i was searching BTW about NAT66 but couldn?t find any way to make NAT from IPV6 to other IPV6 

i know No nat needed with IPV6 , but i found new kernels do support MASQ in IPV6 Nat .

lets hope we have great discussion and best practise on achieving the goal above .


cheers 

From flashdown at data-core.org  Sun Feb  4 11:06:46 2018
From: flashdown at data-core.org (Enrico Heine)
Date: Sun, 04 Feb 2018 12:06:46 +0100
Subject: [squid-users] 4.0.23 release in Debian
In-Reply-To: <161901d39d4c$ce282890$6a7879b0$@ngtech.co.il>
References: <E447B375-ABA3-413A-B103-1E167AA39052@yahoo.com>
 <ead2f401-72db-5fdd-39e2-548fe7dc6bc9@treenet.co.nz>
 <161901d39d4c$ce282890$6a7879b0$@ngtech.co.il>
Message-ID: <BE3F14D0-5B24-49B2-A843-B54053A08CD9@data-core.org>

Already asked the responsible guys, if I can support them by packaging squid for debian since this is what I already do for my company and there is no reason for not sharing it or building it in my spare time at home. Unfortunately I never got an answer so I thought ok, I can't force them to allow me to contribute something back. I would also have been gratefull for just becoming an uploader to experimental only. Saad story, I guess they are to busy to even listening for people trying to help.

Am 4. Februar 2018 01:12:12 MEZ schrieb Eliezer Croitoru <eliezer at ngtech.co.il>:
>I would try to release DEB package for Debian and Ubuntu on my free
>time.
>
>Eliezer
>
>----
>Eliezer Croitoru
>Linux System Administrator
>Mobile: +972-5-28704261
>Email: eliezer at ngtech.co.il
>
>
>
>-----Original Message-----
>From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On
>Behalf Of Amos Jeffries
>Sent: Monday, January 22, 2018 12:19
>To: squid-users at lists.squid-cache.org
>Subject: Re: [squid-users] 4.0.23 release in Debian
>
>On 22/01/18 22:37, TarotApprentice wrote:
>> Given today?s announcement of squid 4.0.23, are there plans for
>Debian to pick it up?
>> 
>> Currently they have 4.0.21 in experimental and 3.5.23 in their other
>repos. Emails to the squid maintainers at Debian go unanswered.
>
>
>Did you mail Luigi directly or the
>pkg-squid-devel at lists.alioth.debian.org team list?
>  I don't see anything coming to the list if so.
>
>As to your question; Updates to the stable Debian are in the hands of
>the Debian Security Team. There were no advance notices so all the OS
>updates are yet to happen.
> I'm preparing the experimental package updates now. Others in the
>pkg-squid team to check and upload, so time varies.
>
>Amos
>_______________________________________________
>squid-users mailing list
>squid-users at lists.squid-cache.org
>http://lists.squid-cache.org/listinfo/squid-users
>
>_______________________________________________
>squid-users mailing list
>squid-users at lists.squid-cache.org
>http://lists.squid-cache.org/listinfo/squid-users

-- 
Diese Nachricht wurde von meinem Android-Ger?t mit K-9 Mail gesendet.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180204/94bfb20d/attachment.htm>

From squid3 at treenet.co.nz  Sun Feb  4 18:40:17 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Mon, 5 Feb 2018 07:40:17 +1300
Subject: [squid-users] 4.0.23 release in Debian
In-Reply-To: <BE3F14D0-5B24-49B2-A843-B54053A08CD9@data-core.org>
References: <E447B375-ABA3-413A-B103-1E167AA39052@yahoo.com>
 <ead2f401-72db-5fdd-39e2-548fe7dc6bc9@treenet.co.nz>
 <161901d39d4c$ce282890$6a7879b0$@ngtech.co.il>
 <BE3F14D0-5B24-49B2-A843-B54053A08CD9@data-core.org>
Message-ID: <548a23b1-f6d1-979d-f2a4-1e2766b07cd2@treenet.co.nz>

On 05/02/18 00:06, Enrico Heine wrote:
> Already asked the responsible guys, if I can support them by packaging
> squid for debian since this is what I already do for my company and
> there is no reason for not sharing it or building it in my spare time at
> home. Unfortunately I never got an answer so I thought ok, I can't force
> them to allow me to contribute something back. I would also have been
> gratefull for just becoming an uploader to experimental only. Saad
> story, I guess they are to busy to even listening for people trying to help.
> 

Who did you contact? The Debian 'squid' and 'squid3' packages are being
maintained by a team these days. I have not seen any messages from you
going to that mailing list:
<https://alioth.debian.org/mail/?group_id=100852>


Amos


From eliezer at ngtech.co.il  Mon Feb  5 03:00:16 2018
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Mon, 5 Feb 2018 05:00:16 +0200
Subject: [squid-users] 4.0.23 release in Debian
In-Reply-To: <548a23b1-f6d1-979d-f2a4-1e2766b07cd2@treenet.co.nz>
References: <E447B375-ABA3-413A-B103-1E167AA39052@yahoo.com>
 <ead2f401-72db-5fdd-39e2-548fe7dc6bc9@treenet.co.nz>
 <161901d39d4c$ce282890$6a7879b0$@ngtech.co.il>
 <BE3F14D0-5B24-49B2-A843-B54053A08CD9@data-core.org>
 <548a23b1-f6d1-979d-f2a4-1e2766b07cd2@treenet.co.nz>
Message-ID: <17c701d39e2d$73179a80$5946cf80$@ngtech.co.il>

It seems they are not even trying to block spam...

Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: eliezer at ngtech.co.il



-----Original Message-----
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Amos Jeffries
Sent: Sunday, February 4, 2018 20:40
To: Enrico Heine <flashdown at data-core.org>; squid-users at lists.squid-cache.org
Subject: Re: [squid-users] 4.0.23 release in Debian

On 05/02/18 00:06, Enrico Heine wrote:
> Already asked the responsible guys, if I can support them by packaging
> squid for debian since this is what I already do for my company and
> there is no reason for not sharing it or building it in my spare time at
> home. Unfortunately I never got an answer so I thought ok, I can't force
> them to allow me to contribute something back. I would also have been
> gratefull for just becoming an uploader to experimental only. Saad
> story, I guess they are to busy to even listening for people trying to help.
> 

Who did you contact? The Debian 'squid' and 'squid3' packages are being
maintained by a team these days. I have not seen any messages from you
going to that mailing list:
<https://alioth.debian.org/mail/?group_id=100852>


Amos
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From eliezer at ngtech.co.il  Mon Feb  5 03:05:26 2018
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Mon, 5 Feb 2018 05:05:26 +0200
Subject: [squid-users] need outgoing addresses without duplication over
	big	pool of addresses
In-Reply-To: <983F1400-B0E6-47EF-BEE9-81B5A30E687A@netstream.ps>
References: <983F1400-B0E6-47EF-BEE9-81B5A30E687A@netstream.ps>
Message-ID: <17c901d39e2e$2ba4a110$82ede330$@ngtech.co.il>

Hey Ahmad,

What you need is a router\nat proxy that can do this for you.
Squid alone cannot do that.
If you really need such a thing you will need to write a router which supports tproxy and will be the edge of your squid or another proxy.
What can do in another way is to write a backend proxy that intercepts the connections and hands them over to the local squid instance with a PROXY protocol enabled and this will force squid to fake the outgoing address of the "client" that the backend states the client is.
It's not simple to handle but with enough knowledge it is possible.
I know it works for IPv4 but I think that Squid-Cache yet to support the PROXY protocol with IPv6.
If ineed squid supports IPv6 then it's doable but I believe you will need another software then Squid-Cache which will be customized only for your requirement.

All The Bests,
Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: eliezer at ngtech.co.il



-----Original Message-----
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of --Ahmad--
Sent: Sunday, February 4, 2018 11:53
To: squid-users at squid-cache.org
Subject: [squid-users] need outgoing addresses without duplication over big pool of addresses

Hello Folks .

I?m trying to deploy squid with IPV6 solution that can give me outgoing address without any duplication .

say i have 10 millions of ip addresses on server ( IPV6 addresses ) /64 subnet .

and i have single port as back connect that will rotate the eternal ip address from that list of addresses for each request 


I?m aware of squid random acl but there is like 1.5 % duplication over 1 hour  which i guess its normal behaviour for rotation random protocol .

my question is  :

what options in squid ACL or random algorithm that can randomise each request without any kind of duplication .

is there a way that we let squid on each request have outgoing address in sequence way .

say i have 10 millions of ips

and if i i made 10 millions of request i have 10 million non duplication outgoing address ?

plz let me know if this can be done from squid 

or  other tools like HA
or operation system itself .

i was searching BTW about NAT66 but couldn?t find any way to make NAT from IPV6 to other IPV6 

i know No nat needed with IPV6 , but i found new kernels do support MASQ in IPV6 Nat .

lets hope we have great discussion and best practise on achieving the goal above .


cheers 
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From flashdown at data-core.org  Mon Feb  5 09:21:23 2018
From: flashdown at data-core.org (Flashdown)
Date: Mon, 05 Feb 2018 10:21:23 +0100
Subject: [squid-users] 4.0.23 release in Debian
In-Reply-To: <17c701d39e2d$73179a80$5946cf80$@ngtech.co.il>
References: <E447B375-ABA3-413A-B103-1E167AA39052@yahoo.com>
 <ead2f401-72db-5fdd-39e2-548fe7dc6bc9@treenet.co.nz>
 <161901d39d4c$ce282890$6a7879b0$@ngtech.co.il>
 <BE3F14D0-5B24-49B2-A843-B54053A08CD9@data-core.org>
 <548a23b1-f6d1-979d-f2a4-1e2766b07cd2@treenet.co.nz>
 <17c701d39e2d$73179a80$5946cf80$@ngtech.co.il>
Message-ID: <53581439320f2fd3c562e8785acd4399@data-core.org>

Well, I've forwarded my old mail just now after subcribing to this list 
which I did sent directly to luigi and manty because I was unaware of 
these mailing lists. Thank you Amos!

Am 2018-02-05 04:00, schrieb Eliezer Croitoru:
> It seems they are not even trying to block spam...
> 
> Eliezer
> 
> ----
> Eliezer Croitoru
> Linux System Administrator
> Mobile: +972-5-28704261
> Email: eliezer at ngtech.co.il
> 
> 
> 
> -----Original Message-----
> From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org]
> On Behalf Of Amos Jeffries
> Sent: Sunday, February 4, 2018 20:40
> To: Enrico Heine <flashdown at data-core.org>; 
> squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] 4.0.23 release in Debian
> 
> On 05/02/18 00:06, Enrico Heine wrote:
>> Already asked the responsible guys, if I can support them by packaging
>> squid for debian since this is what I already do for my company and
>> there is no reason for not sharing it or building it in my spare time 
>> at
>> home. Unfortunately I never got an answer so I thought ok, I can't 
>> force
>> them to allow me to contribute something back. I would also have been
>> gratefull for just becoming an uploader to experimental only. Saad
>> story, I guess they are to busy to even listening for people trying to 
>> help.
>> 
> 
> Who did you contact? The Debian 'squid' and 'squid3' packages are being
> maintained by a team these days. I have not seen any messages from you
> going to that mailing list:
> <https://alioth.debian.org/mail/?group_id=100852>
> 
> 
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users


From erdosain9 at gmail.com  Mon Feb  5 14:54:26 2018
From: erdosain9 at gmail.com (erdosain9)
Date: Mon, 5 Feb 2018 07:54:26 -0700 (MST)
Subject: [squid-users] Problem with Kerberos ticket keytab
Message-ID: <1517842466776-0.post@n4.nabble.com>

Hi to all.

The squid was working fine, but i made a mistake and... delete the
proxy.keytab. I try to do it again, but make a mistake in the syntax

wrong syntax (the real name is not squidproxy.domain.lan is
squid.domain.lan):

msktutil -c -b "CN=COMPUTERS" -s HTTP/squidproxy.domain.lan -k
/etc/squid/PROXY.keytab --computer-name SQUIDPROXY-K --upn
HTTP/squidproxy.domain.lan --server adw-1.domain.lan --verbose --enctypes 28

now i put well the syntax, but the keytab is wrong... why??

well syntax:

msktutil -c -b "CN=COMPUTERS" -s HTTP/squid.domain.lan -h squid.domain.lan
-k /etc/squid/PROXY.keytab --computer-name SQUIDPROXY-K --upn
HTTP/squid.domain.lan --server adw-1.domain.lan --verbose --enctypes 28


[root at squid squid]# ktutil 
ktutil:  read_kt PROXY.keytab 
ktutil:  l
slot KVNO Principal
---- ----
---------------------------------------------------------------------
   1   18                 squidproxy-k$@DOMAIN.LAN
   2   18                 squidproxy-k$@DOMAIN.LAN
   3   18                 squidproxy-k$@DOMAIN.LAN
   4   18    HTTP/squidproxy.DOMAIN.lan at DOMAIN.LAN
   5   18    HTTP/squidproxy.DOMAIN.lan at DOMAIN.LAN
   6   18    HTTP/squidproxy.DOMAIN.lan at DOMAIN.LAN
   7   18         host/squid.DOMAIN.lan at DOMAIN.LAN
   8   18         host/squid.DOMAIN.lan at DOMAIN.LAN
   9   18         host/squid.DOMAIN.lan at DOMAIN.LAN
  10   18         HTTP/squid.DOMAIN.lan at DOMAIN.LAN
  11   18         HTTP/squid.DOMAIN.lan at DOMAIN.LAN
  12   18         HTTP/squid.DOMAIN.lan at DOMAIN.LAN


Why squidproxy.DOMAIN.LAN????????? what can i do to solve this???

Thanks to all!!



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From flashdown at data-core.org  Mon Feb  5 15:12:29 2018
From: flashdown at data-core.org (Flashdown)
Date: Mon, 05 Feb 2018 16:12:29 +0100
Subject: [squid-users] Problem with Kerberos ticket keytab
In-Reply-To: <1517842466776-0.post@n4.nabble.com>
References: <1517842466776-0.post@n4.nabble.com>
Message-ID: <C7FE6E82-B003-4F3C-84A1-2FBDDA43F62B@data-core.org>

Delete the Computer Object in Active Directory to clear these spn's up.

Am 5. Februar 2018 15:54:26 MEZ schrieb erdosain9 <erdosain9 at gmail.com>:
>Hi to all.
>
>The squid was working fine, but i made a mistake and... delete the
>proxy.keytab. I try to do it again, but make a mistake in the syntax
>
>wrong syntax (the real name is not squidproxy.domain.lan is
>squid.domain.lan):
>
>msktutil -c -b "CN=COMPUTERS" -s HTTP/squidproxy.domain.lan -k
>/etc/squid/PROXY.keytab --computer-name SQUIDPROXY-K --upn
>HTTP/squidproxy.domain.lan --server adw-1.domain.lan --verbose
>--enctypes 28
>
>now i put well the syntax, but the keytab is wrong... why??
>
>well syntax:
>
>msktutil -c -b "CN=COMPUTERS" -s HTTP/squid.domain.lan -h
>squid.domain.lan
>-k /etc/squid/PROXY.keytab --computer-name SQUIDPROXY-K --upn
>HTTP/squid.domain.lan --server adw-1.domain.lan --verbose --enctypes 28
>
>
>[root at squid squid]# ktutil 
>ktutil:  read_kt PROXY.keytab 
>ktutil:  l
>slot KVNO Principal
>---- ----
>---------------------------------------------------------------------
>   1   18                 squidproxy-k$@DOMAIN.LAN
>   2   18                 squidproxy-k$@DOMAIN.LAN
>   3   18                 squidproxy-k$@DOMAIN.LAN
>   4   18    HTTP/squidproxy.DOMAIN.lan at DOMAIN.LAN
>   5   18    HTTP/squidproxy.DOMAIN.lan at DOMAIN.LAN
>   6   18    HTTP/squidproxy.DOMAIN.lan at DOMAIN.LAN
>   7   18         host/squid.DOMAIN.lan at DOMAIN.LAN
>   8   18         host/squid.DOMAIN.lan at DOMAIN.LAN
>   9   18         host/squid.DOMAIN.lan at DOMAIN.LAN
>  10   18         HTTP/squid.DOMAIN.lan at DOMAIN.LAN
>  11   18         HTTP/squid.DOMAIN.lan at DOMAIN.LAN
>  12   18         HTTP/squid.DOMAIN.lan at DOMAIN.LAN
>
>
>Why squidproxy.DOMAIN.LAN????????? what can i do to solve this???
>
>Thanks to all!!
>
>
>
>--
>Sent from:
>http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html
>_______________________________________________
>squid-users mailing list
>squid-users at lists.squid-cache.org
>http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180205/29f43412/attachment.htm>

From flashdown at data-core.org  Mon Feb  5 15:39:10 2018
From: flashdown at data-core.org (Flashdown)
Date: Mon, 05 Feb 2018 16:39:10 +0100
Subject: [squid-users] Problem with Kerberos ticket keytab
In-Reply-To: <C7FE6E82-B003-4F3C-84A1-2FBDDA43F62B@data-core.org>
References: <1517842466776-0.post@n4.nabble.com>
 <C7FE6E82-B003-4F3C-84A1-2FBDDA43F62B@data-core.org>
Message-ID: <5D887622-5C38-4542-ABAC-FEC3C5BA6C36@data-core.org>

Just to call it correctly, what is wrong is the host principle after you have deleted the computer object and waited for the object to disappear on other DC's as well (if you have replication between dc's) and rejoined it, it should be as you want it to be. Hope this helps with your setup.

Am 5. Februar 2018 16:12:29 MEZ schrieb Flashdown <flashdown at data-core.org>:
>Delete the Computer Object in Active Directory to clear these spn's up.
>
>Am 5. Februar 2018 15:54:26 MEZ schrieb erdosain9
><erdosain9 at gmail.com>:
>>Hi to all.
>>
>>The squid was working fine, but i made a mistake and... delete the
>>proxy.keytab. I try to do it again, but make a mistake in the syntax
>>
>>wrong syntax (the real name is not squidproxy.domain.lan is
>>squid.domain.lan):
>>
>>msktutil -c -b "CN=COMPUTERS" -s HTTP/squidproxy.domain.lan -k
>>/etc/squid/PROXY.keytab --computer-name SQUIDPROXY-K --upn
>>HTTP/squidproxy.domain.lan --server adw-1.domain.lan --verbose
>>--enctypes 28
>>
>>now i put well the syntax, but the keytab is wrong... why??
>>
>>well syntax:
>>
>>msktutil -c -b "CN=COMPUTERS" -s HTTP/squid.domain.lan -h
>>squid.domain.lan
>>-k /etc/squid/PROXY.keytab --computer-name SQUIDPROXY-K --upn
>>HTTP/squid.domain.lan --server adw-1.domain.lan --verbose --enctypes
>28
>>
>>
>>[root at squid squid]# ktutil 
>>ktutil:  read_kt PROXY.keytab 
>>ktutil:  l
>>slot KVNO Principal
>>---- ----
>>---------------------------------------------------------------------
>>   1   18                 squidproxy-k$@DOMAIN.LAN
>>   2   18                 squidproxy-k$@DOMAIN.LAN
>>   3   18                 squidproxy-k$@DOMAIN.LAN
>>   4   18    HTTP/squidproxy.DOMAIN.lan at DOMAIN.LAN
>>   5   18    HTTP/squidproxy.DOMAIN.lan at DOMAIN.LAN
>>   6   18    HTTP/squidproxy.DOMAIN.lan at DOMAIN.LAN
>>   7   18         host/squid.DOMAIN.lan at DOMAIN.LAN
>>   8   18         host/squid.DOMAIN.lan at DOMAIN.LAN
>>   9   18         host/squid.DOMAIN.lan at DOMAIN.LAN
>>  10   18         HTTP/squid.DOMAIN.lan at DOMAIN.LAN
>>  11   18         HTTP/squid.DOMAIN.lan at DOMAIN.LAN
>>  12   18         HTTP/squid.DOMAIN.lan at DOMAIN.LAN
>>
>>
>>Why squidproxy.DOMAIN.LAN????????? what can i do to solve this???
>>
>>Thanks to all!!
>>
>>
>>
>>--
>>Sent from:
>>http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html
>>_______________________________________________
>>squid-users mailing list
>>squid-users at lists.squid-cache.org
>>http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180205/42fbb131/attachment.htm>

From flashdown at data-core.org  Mon Feb  5 15:55:17 2018
From: flashdown at data-core.org (Flashdown)
Date: Mon, 05 Feb 2018 16:55:17 +0100
Subject: [squid-users] Problem with Kerberos ticket keytab
In-Reply-To: <5D887622-5C38-4542-ABAC-FEC3C5BA6C36@data-core.org>
References: <1517842466776-0.post@n4.nabble.com>
 <C7FE6E82-B003-4F3C-84A1-2FBDDA43F62B@data-core.org>
 <5D887622-5C38-4542-ABAC-FEC3C5BA6C36@data-core.org>
Message-ID: <aabe1a9e18a7a48e9bb552f6f6325cfe@data-core.org>

I am answering to fast, but I am writing in my little break, so sorry 
for that :D forget my last mail regarding "to call it correctly" that 
was misleading and wrong. sure you are talking about the HTTP SPN which 
have the same KVNO. So if you want to get rid of it delete the computer 
object, as your are updating all the SPN's that the Computer Object 
holds. If you use the Attribut-Editor you may can modify the Attribut 
servicePrincipalName and delete the wrong one and recreate the keytab 
afterwards, without deleting the Computer Object at all.



Am 2018-02-05 16:39, schrieb Flashdown:
> Just to call it correctly, what is wrong is the host principle after
> you have deleted the computer object and waited for the object to
> disappear on other DC's as well (if you have replication between dc's)
> and rejoined it, it should be as you want it to be. Hope this helps
> with your setup.
> 
> Am 5. Februar 2018 16:12:29 MEZ schrieb Flashdown
> <flashdown at data-core.org>:
> 
>> Delete the Computer Object in Active Directory to clear these spn's
>> up.
>> 
>> Am 5. Februar 2018 15:54:26 MEZ schrieb erdosain9
>> <erdosain9 at gmail.com>:
>> 
>>> Hi to all.
>>> 
>>> The squid was working fine, but i made a mistake and... delete the
>>> proxy.keytab. I try to do it again, but make a mistake in the
>>> syntax
>>> 
>>> wrong syntax (the real name is not squidproxy.domain.lan is
>>> squid.domain.lan):
>>> 
>>> msktutil -c -b "CN=COMPUTERS" -s HTTP/squidproxy.domain.lan -k
>>> /etc/squid/PROXY.keytab --computer-name SQUIDPROXY-K --upn
>>> HTTP/squidproxy.domain.lan --server adw-1.domain.lan --verbose
>>> --enctypes 28
>>> 
>>> now i put well the syntax, but the keytab is wrong... why??
>>> 
>>> well syntax:
>>> 
>>> msktutil -c -b "CN=COMPUTERS" -s HTTP/squid.domain.lan -h
>>> squid.domain.lan
>>> -k /etc/squid/PROXY.keytab --computer-name SQUIDPROXY-K --upn
>>> HTTP/squid.domain.lan --server adw-1.domain.lan --verbose
>>> --enctypes 28
>>> 
>>> [root at squid squid]# ktutil
>>> ktutil:  read_kt PROXY.keytab
>>> ktutil:  l
>>> slot KVNO Principal
>>> ---- ----
>>> 
>>> -------------------------
>>> 
>>> 1   18                 squidproxy-k$@DOMAIN.LAN
>>> 2   18                 squidproxy-k$@DOMAIN.LAN
>>> 3   18                 squidproxy-k$@DOMAIN.LAN
>>> 4   18    HTTP/squidproxy.DOMAIN.lan at DOMAIN.LAN
>>> 5   18    HTTP/squidproxy.DOMAIN.lan at DOMAIN.LAN
>>> 6   18    HTTP/squidproxy.DOMAIN.lan at DOMAIN.LAN
>>> 7   18         host/squid.DOMAIN.lan at DOMAIN.LAN
>>> 8   18         host/squid.DOMAIN.lan at DOMAIN.LAN
>>> 9   18         host/squid.DOMAIN.lan at DOMAIN.LAN
>>> 10   18         HTTP/squid.DOMAIN.lan at DOMAIN.LAN
>>> 11   18         HTTP/squid.DOMAIN.lan at DOMAIN.LAN
>>> 12   18         HTTP/squid.DOMAIN.lan at DOMAIN.LAN
>>> 
>>> Why squidproxy.DOMAIN.LAN????????? what can i do to solve this???
>>> 
>>> Thanks to all!!
>>> 
>>> --
>>> Sent from:
>>> 
>> 
> http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html
>>> 
>>> -------------------------
>>> 
>>> squid-users mailing list
>>> squid-users at lists.squid-cache.org
>>> http://lists.squid-cache.org/listinfo/squid-users
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users


From flashdown at data-core.org  Mon Feb  5 15:59:09 2018
From: flashdown at data-core.org (Flashdown)
Date: Mon, 05 Feb 2018 16:59:09 +0100
Subject: [squid-users] Problem with Kerberos ticket keytab
In-Reply-To: <aabe1a9e18a7a48e9bb552f6f6325cfe@data-core.org>
References: <1517842466776-0.post@n4.nabble.com>
 <C7FE6E82-B003-4F3C-84A1-2FBDDA43F62B@data-core.org>
 <5D887622-5C38-4542-ABAC-FEC3C5BA6C36@data-core.org>
 <aabe1a9e18a7a48e9bb552f6f6325cfe@data-core.org>
Message-ID: <b11ed0105eb5c59c224406e518648d05@data-core.org>

You could also give this parameter of msktutil a try:

  flush                  Flushes all principals for the current host or 
service account
                          from the keytab, and deletes 
servicePrincipalName from AD.




Am 2018-02-05 16:55, schrieb Flashdown:
> I am answering to fast, but I am writing in my little break, so sorry
> for that :D forget my last mail regarding "to call it correctly" that
> was misleading and wrong. sure you are talking about the HTTP SPN
> which have the same KVNO. So if you want to get rid of it delete the
> computer object, as your are updating all the SPN's that the Computer
> Object holds. If you use the Attribut-Editor you may can modify the
> Attribut servicePrincipalName and delete the wrong one and recreate
> the keytab afterwards, without deleting the Computer Object at all.
> 
> 
> 
> Am 2018-02-05 16:39, schrieb Flashdown:
>> Just to call it correctly, what is wrong is the host principle after
>> you have deleted the computer object and waited for the object to
>> disappear on other DC's as well (if you have replication between dc's)
>> and rejoined it, it should be as you want it to be. Hope this helps
>> with your setup.
>> 
>> Am 5. Februar 2018 16:12:29 MEZ schrieb Flashdown
>> <flashdown at data-core.org>:
>> 
>>> Delete the Computer Object in Active Directory to clear these spn's
>>> up.
>>> 
>>> Am 5. Februar 2018 15:54:26 MEZ schrieb erdosain9
>>> <erdosain9 at gmail.com>:
>>> 
>>>> Hi to all.
>>>> 
>>>> The squid was working fine, but i made a mistake and... delete the
>>>> proxy.keytab. I try to do it again, but make a mistake in the
>>>> syntax
>>>> 
>>>> wrong syntax (the real name is not squidproxy.domain.lan is
>>>> squid.domain.lan):
>>>> 
>>>> msktutil -c -b "CN=COMPUTERS" -s HTTP/squidproxy.domain.lan -k
>>>> /etc/squid/PROXY.keytab --computer-name SQUIDPROXY-K --upn
>>>> HTTP/squidproxy.domain.lan --server adw-1.domain.lan --verbose
>>>> --enctypes 28
>>>> 
>>>> now i put well the syntax, but the keytab is wrong... why??
>>>> 
>>>> well syntax:
>>>> 
>>>> msktutil -c -b "CN=COMPUTERS" -s HTTP/squid.domain.lan -h
>>>> squid.domain.lan
>>>> -k /etc/squid/PROXY.keytab --computer-name SQUIDPROXY-K --upn
>>>> HTTP/squid.domain.lan --server adw-1.domain.lan --verbose
>>>> --enctypes 28
>>>> 
>>>> [root at squid squid]# ktutil
>>>> ktutil:  read_kt PROXY.keytab
>>>> ktutil:  l
>>>> slot KVNO Principal
>>>> ---- ----
>>>> 
>>>> -------------------------
>>>> 
>>>> 1   18                 squidproxy-k$@DOMAIN.LAN
>>>> 2   18                 squidproxy-k$@DOMAIN.LAN
>>>> 3   18                 squidproxy-k$@DOMAIN.LAN
>>>> 4   18    HTTP/squidproxy.DOMAIN.lan at DOMAIN.LAN
>>>> 5   18    HTTP/squidproxy.DOMAIN.lan at DOMAIN.LAN
>>>> 6   18    HTTP/squidproxy.DOMAIN.lan at DOMAIN.LAN
>>>> 7   18         host/squid.DOMAIN.lan at DOMAIN.LAN
>>>> 8   18         host/squid.DOMAIN.lan at DOMAIN.LAN
>>>> 9   18         host/squid.DOMAIN.lan at DOMAIN.LAN
>>>> 10   18         HTTP/squid.DOMAIN.lan at DOMAIN.LAN
>>>> 11   18         HTTP/squid.DOMAIN.lan at DOMAIN.LAN
>>>> 12   18         HTTP/squid.DOMAIN.lan at DOMAIN.LAN
>>>> 
>>>> Why squidproxy.DOMAIN.LAN????????? what can i do to solve this???
>>>> 
>>>> Thanks to all!!
>>>> 
>>>> --
>>>> Sent from:
>>>> 
>>> 
>> http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html
>>>> 
>>>> -------------------------
>>>> 
>>>> squid-users mailing list
>>>> squid-users at lists.squid-cache.org
>>>> http://lists.squid-cache.org/listinfo/squid-users
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users


From erdosain9 at gmail.com  Mon Feb  5 16:09:04 2018
From: erdosain9 at gmail.com (erdosain9)
Date: Mon, 5 Feb 2018 09:09:04 -0700 (MST)
Subject: [squid-users] Problem with Kerberos ticket keytab
In-Reply-To: <C7FE6E82-B003-4F3C-84A1-2FBDDA43F62B@data-core.org>
References: <1517842466776-0.post@n4.nabble.com>
 <C7FE6E82-B003-4F3C-84A1-2FBDDA43F62B@data-core.org>
Message-ID: <1517846944597-0.post@n4.nabble.com>

Ok. 
Thanks

Know the ticket is fine, and is working (people are going throug internet
and i see in access.log there user names).... but... im having this error in
the log.

2018/02/05 12:56:46 kid1| ERROR: Negotiate Authentication validating user.
Result: {result=BH, notes={message: gss_accept_sec_context() failed:
Unspecified GSS failure.  Minor code may provide more information. Cannot
decrypt ticket for HTTP/squid.domain.lan-DOMAIN.LAN using keytab key for
HTTP/squid.domain.lan-DOMAIN.LAN; }}
2018/02/05 12:57:55 kid1| ERROR: Negotiate Authentication validating user.
Result: {result=BH, notes={message: gss_accept_sec_context() failed:
Unspecified GSS failure.  Minor code may provide more information. Cannot
decrypt ticket for HTTP/squid.domain.lan-DOMAIN.LAN using keytab key for
HTTP/squid.domain.lan-DOMAIN.LAN; }}
(END)

I change @ for - 

Thanks.



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From flashdown at data-core.org  Mon Feb  5 16:43:58 2018
From: flashdown at data-core.org (Enrico Heine)
Date: Mon, 05 Feb 2018 17:43:58 +0100
Subject: [squid-users] Problem with Kerberos ticket keytab
In-Reply-To: <1517846944597-0.post@n4.nabble.com>
References: <1517842466776-0.post@n4.nabble.com>
 <C7FE6E82-B003-4F3C-84A1-2FBDDA43F62B@data-core.org>
 <1517846944597-0.post@n4.nabble.com>
Message-ID: <30FF6A6E-36AD-4C56-82B6-F94E68C74B0D@data-core.org>

This is maybe because the users have a old kerberos ticket and need to renew it. So simple solution for them is to log off and logon again to their windows PC or they can close the browsers and tools that need to authenticate against the proxy afterwards they should lock and directly unlock their station --> this will force windows to refresh their kerberos ticket. After all did it these messages will disappear, sometimes it's easier to tell the users to just restart their PC. 

Am 5. Februar 2018 17:09:04 MEZ schrieb erdosain9 <erdosain9 at gmail.com>:
>Ok. 
>Thanks
>
>Know the ticket is fine, and is working (people are going throug
>internet
>and i see in access.log there user names).... but... im having this
>error in
>the log.
>
>2018/02/05 12:56:46 kid1| ERROR: Negotiate Authentication validating
>user.
>Result: {result=BH, notes={message: gss_accept_sec_context() failed:
>Unspecified GSS failure.  Minor code may provide more information.
>Cannot
>decrypt ticket for HTTP/squid.domain.lan-DOMAIN.LAN using keytab key
>for
>HTTP/squid.domain.lan-DOMAIN.LAN; }}
>2018/02/05 12:57:55 kid1| ERROR: Negotiate Authentication validating
>user.
>Result: {result=BH, notes={message: gss_accept_sec_context() failed:
>Unspecified GSS failure.  Minor code may provide more information.
>Cannot
>decrypt ticket for HTTP/squid.domain.lan-DOMAIN.LAN using keytab key
>for
>HTTP/squid.domain.lan-DOMAIN.LAN; }}
>(END)
>
>I change @ for - 
>
>Thanks.
>
>
>
>--
>Sent from:
>http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html
>_______________________________________________
>squid-users mailing list
>squid-users at lists.squid-cache.org
>http://lists.squid-cache.org/listinfo/squid-users

-- 
Diese Nachricht wurde von meinem Android-Ger?t mit K-9 Mail gesendet.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180205/579aad76/attachment.htm>

From flashdown at data-core.org  Mon Feb  5 16:46:29 2018
From: flashdown at data-core.org (Enrico Heine)
Date: Mon, 05 Feb 2018 17:46:29 +0100
Subject: [squid-users] Problem with Kerberos ticket keytab
In-Reply-To: <30FF6A6E-36AD-4C56-82B6-F94E68C74B0D@data-core.org>
References: <1517842466776-0.post@n4.nabble.com>
 <C7FE6E82-B003-4F3C-84A1-2FBDDA43F62B@data-core.org>
 <1517846944597-0.post@n4.nabble.com>
 <30FF6A6E-36AD-4C56-82B6-F94E68C74B0D@data-core.org>
Message-ID: <3B36D7D5-C7B9-4BA9-B09D-230A67FE0596@data-core.org>

Only users that can't use the proxy need to do it.

Am 5. Februar 2018 17:43:58 MEZ schrieb Enrico Heine <flashdown at data-core.org>:
>This is maybe because the users have a old kerberos ticket and need to
>renew it. So simple solution for them is to log off and logon again to
>their windows PC or they can close the browsers and tools that need to
>authenticate against the proxy afterwards they should lock and directly
>unlock their station --> this will force windows to refresh their
>kerberos ticket. After all did it these messages will disappear,
>sometimes it's easier to tell the users to just restart their PC. 
>
>Am 5. Februar 2018 17:09:04 MEZ schrieb erdosain9
><erdosain9 at gmail.com>:
>>Ok. 
>>Thanks
>>
>>Know the ticket is fine, and is working (people are going throug
>>internet
>>and i see in access.log there user names).... but... im having this
>>error in
>>the log.
>>
>>2018/02/05 12:56:46 kid1| ERROR: Negotiate Authentication validating
>>user.
>>Result: {result=BH, notes={message: gss_accept_sec_context() failed:
>>Unspecified GSS failure.  Minor code may provide more information.
>>Cannot
>>decrypt ticket for HTTP/squid.domain.lan-DOMAIN.LAN using keytab key
>>for
>>HTTP/squid.domain.lan-DOMAIN.LAN; }}
>>2018/02/05 12:57:55 kid1| ERROR: Negotiate Authentication validating
>>user.
>>Result: {result=BH, notes={message: gss_accept_sec_context() failed:
>>Unspecified GSS failure.  Minor code may provide more information.
>>Cannot
>>decrypt ticket for HTTP/squid.domain.lan-DOMAIN.LAN using keytab key
>>for
>>HTTP/squid.domain.lan-DOMAIN.LAN; }}
>>(END)
>>
>>I change @ for - 
>>
>>Thanks.
>>
>>
>>
>>--
>>Sent from:
>>http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html
>>_______________________________________________
>>squid-users mailing list
>>squid-users at lists.squid-cache.org
>>http://lists.squid-cache.org/listinfo/squid-users
>
>-- 
>Diese Nachricht wurde von meinem Android-Ger?t mit K-9 Mail gesendet.

-- 
Diese Nachricht wurde von meinem Android-Ger?t mit K-9 Mail gesendet.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180205/61dbe021/attachment.htm>

From flashdown at data-core.org  Mon Feb  5 16:52:39 2018
From: flashdown at data-core.org (Flashdown)
Date: Mon, 05 Feb 2018 17:52:39 +0100
Subject: [squid-users] Problem with Kerberos ticket keytab
In-Reply-To: <3B36D7D5-C7B9-4BA9-B09D-230A67FE0596@data-core.org>
References: <1517842466776-0.post@n4.nabble.com>
 <C7FE6E82-B003-4F3C-84A1-2FBDDA43F62B@data-core.org>
 <1517846944597-0.post@n4.nabble.com>
 <30FF6A6E-36AD-4C56-82B6-F94E68C74B0D@data-core.org>
 <3B36D7D5-C7B9-4BA9-B09D-230A67FE0596@data-core.org>
Message-ID: <CF80D750-713A-4121-B956-E1D289F5A87E@data-core.org>

Also on a specific interval windows will automatically refresh kerberos tickets in the background but when depends on your domain settings and I am unsure about the default interval.

Am 5. Februar 2018 17:46:29 MEZ schrieb Enrico Heine <flashdown at data-core.org>:
>Only users that can't use the proxy need to do it.
>
>Am 5. Februar 2018 17:43:58 MEZ schrieb Enrico Heine
><flashdown at data-core.org>:
>>This is maybe because the users have a old kerberos ticket and need to
>>renew it. So simple solution for them is to log off and logon again to
>>their windows PC or they can close the browsers and tools that need to
>>authenticate against the proxy afterwards they should lock and
>directly
>>unlock their station --> this will force windows to refresh their
>>kerberos ticket. After all did it these messages will disappear,
>>sometimes it's easier to tell the users to just restart their PC. 
>>
>>Am 5. Februar 2018 17:09:04 MEZ schrieb erdosain9
>><erdosain9 at gmail.com>:
>>>Ok. 
>>>Thanks
>>>
>>>Know the ticket is fine, and is working (people are going throug
>>>internet
>>>and i see in access.log there user names).... but... im having this
>>>error in
>>>the log.
>>>
>>>2018/02/05 12:56:46 kid1| ERROR: Negotiate Authentication validating
>>>user.
>>>Result: {result=BH, notes={message: gss_accept_sec_context() failed:
>>>Unspecified GSS failure.  Minor code may provide more information.
>>>Cannot
>>>decrypt ticket for HTTP/squid.domain.lan-DOMAIN.LAN using keytab key
>>>for
>>>HTTP/squid.domain.lan-DOMAIN.LAN; }}
>>>2018/02/05 12:57:55 kid1| ERROR: Negotiate Authentication validating
>>>user.
>>>Result: {result=BH, notes={message: gss_accept_sec_context() failed:
>>>Unspecified GSS failure.  Minor code may provide more information.
>>>Cannot
>>>decrypt ticket for HTTP/squid.domain.lan-DOMAIN.LAN using keytab key
>>>for
>>>HTTP/squid.domain.lan-DOMAIN.LAN; }}
>>>(END)
>>>
>>>I change @ for - 
>>>
>>>Thanks.
>>>
>>>
>>>
>>>--
>>>Sent from:
>>>http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html
>>>_______________________________________________
>>>squid-users mailing list
>>>squid-users at lists.squid-cache.org
>>>http://lists.squid-cache.org/listinfo/squid-users
>>
>>-- 
>>Diese Nachricht wurde von meinem Android-Ger?t mit K-9 Mail gesendet.
>
>-- 
>Diese Nachricht wurde von meinem Android-Ger?t mit K-9 Mail gesendet.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180205/4928cb1c/attachment.htm>

From erdosain9 at gmail.com  Mon Feb  5 18:13:25 2018
From: erdosain9 at gmail.com (erdosain9)
Date: Mon, 5 Feb 2018 11:13:25 -0700 (MST)
Subject: [squid-users] Problem with Kerberos ticket keytab
In-Reply-To: <CF80D750-713A-4121-B956-E1D289F5A87E@data-core.org>
References: <1517842466776-0.post@n4.nabble.com>
 <C7FE6E82-B003-4F3C-84A1-2FBDDA43F62B@data-core.org>
 <1517846944597-0.post@n4.nabble.com>
 <30FF6A6E-36AD-4C56-82B6-F94E68C74B0D@data-core.org>
 <3B36D7D5-C7B9-4BA9-B09D-230A67FE0596@data-core.org>
 <CF80D750-713A-4121-B956-E1D289F5A87E@data-core.org>
Message-ID: <1517854405876-0.post@n4.nabble.com>

Thanks for your time! Know is working fine.

a little and stupid question.... where i can found the start script of
squid??? This is a Centos 7.

I want put this

KRB5RCACHETYPE=none
export KRB5RCACHETYPE

[root at squid etc]# cat /usr/lib/systemd/system/squid.service
## Copyright (C) 1996-2015 The Squid Software Foundation and contributors
##
## Squid software is distributed under GPLv2+ license and includes
## contributions from numerous individuals and organizations.
## Please see the COPYING and CONTRIBUTORS files for details.
##

[Unit]
Description=Squid Web Proxy Server
Documentation=man:squid(8)
After=network.target

[Service]
Type=forking
LimitNOFILE=16384
PIDFile=/var/run/squid.pid
ExecStartPre=/usr/bin/mkdir -p /var/run/squid
ExecStartPre=/usr/bin/chown squid.squid /var/run/squid
ExecStart=/usr/sbin/squid -sYC
ExecReload=/usr/sbin/squid -kreconf
ExecStop=/usr/sbin/squidshut.sh
TimeoutStopSec=36
KillMode=none

[Install]
WantedBy=multi-user.target


Thanks!!!



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From flashdown at data-core.org  Mon Feb  5 18:31:49 2018
From: flashdown at data-core.org (Enrico Heine)
Date: Mon, 05 Feb 2018 19:31:49 +0100
Subject: [squid-users] Problem with Kerberos ticket keytab
In-Reply-To: <1517854405876-0.post@n4.nabble.com>
References: <1517842466776-0.post@n4.nabble.com>
 <C7FE6E82-B003-4F3C-84A1-2FBDDA43F62B@data-core.org>
 <1517846944597-0.post@n4.nabble.com>
 <30FF6A6E-36AD-4C56-82B6-F94E68C74B0D@data-core.org>
 <3B36D7D5-C7B9-4BA9-B09D-230A67FE0596@data-core.org>
 <CF80D750-713A-4121-B956-E1D289F5A87E@data-core.org>
 <1517854405876-0.post@n4.nabble.com>
Message-ID: <474B9AAB-3207-4B36-8FFF-CB93A0B46E63@data-core.org>

You shouldn't modify these files. Put it into /etc/default/squid and I assume it should work out. For Debian this is the right way of doing it, for CentOS I am unsure but I strongly believe it is the same over there. 

Am 5. Februar 2018 19:13:25 MEZ schrieb erdosain9 <erdosain9 at gmail.com>:
>Thanks for your time! Know is working fine.
>
>a little and stupid question.... where i can found the start script of
>squid??? This is a Centos 7.
>
>I want put this
>
>KRB5RCACHETYPE=none
>export KRB5RCACHETYPE
>
>[root at squid etc]# cat /usr/lib/systemd/system/squid.service
>## Copyright (C) 1996-2015 The Squid Software Foundation and
>contributors
>##
>## Squid software is distributed under GPLv2+ license and includes
>## contributions from numerous individuals and organizations.
>## Please see the COPYING and CONTRIBUTORS files for details.
>##
>
>[Unit]
>Description=Squid Web Proxy Server
>Documentation=man:squid(8)
>After=network.target
>
>[Service]
>Type=forking
>LimitNOFILE=16384
>PIDFile=/var/run/squid.pid
>ExecStartPre=/usr/bin/mkdir -p /var/run/squid
>ExecStartPre=/usr/bin/chown squid.squid /var/run/squid
>ExecStart=/usr/sbin/squid -sYC
>ExecReload=/usr/sbin/squid -kreconf
>ExecStop=/usr/sbin/squidshut.sh
>TimeoutStopSec=36
>KillMode=none
>
>[Install]
>WantedBy=multi-user.target
>
>
>Thanks!!!
>
>
>
>--
>Sent from:
>http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html
>_______________________________________________
>squid-users mailing list
>squid-users at lists.squid-cache.org
>http://lists.squid-cache.org/listinfo/squid-users

-- 
Diese Nachricht wurde von meinem Android-Ger?t mit K-9 Mail gesendet.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180205/891a6db7/attachment.htm>

From kotaro-243 at brown.plala.or.jp  Tue Feb  6 11:31:41 2018
From: kotaro-243 at brown.plala.or.jp (Koji Fushimi)
Date: Tue, 6 Feb 2018 20:31:41 +0900
Subject: [squid-users] About Squid's FTP-Proxy mode support!
Message-ID: <652b88fb-d46c-f2d4-fd18-0bf94af53023@brown.plala.or.jp>

Hello, All

Please provide information on Squid's support for FTP-Proxy mode.

In my understanding, the default is passive mode.
  -/etc/squid/squid.conf  ftp_passive ON

So if I want to work in Active mode, it is necessary to change
to ftp_passive off.

Is this understanding correct?

By the way, Is it possible to work both Active mode and Passive
mode simultaneously?
  -In our IT system, it is connected to many FTP Server (A-FTP Sever,
   B-FTP Server via Squid(FTP Proxy) Server. For example, A-FTP Server
   works in Active mode and B-FTP Server works in Passive mode.

Best regards, Koji



From squid3 at treenet.co.nz  Tue Feb  6 12:08:56 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 7 Feb 2018 01:08:56 +1300
Subject: [squid-users] About Squid's FTP-Proxy mode support!
In-Reply-To: <652b88fb-d46c-f2d4-fd18-0bf94af53023@brown.plala.or.jp>
References: <652b88fb-d46c-f2d4-fd18-0bf94af53023@brown.plala.or.jp>
Message-ID: <f3eb24cd-4416-f24e-8245-e3a6ec71ca69@treenet.co.nz>

On 07/02/18 00:31, Koji Fushimi wrote:
> Hello, All
> 
> Please provide information on Squid's support for FTP-Proxy mode.
> 

Are you asking about the new "Native FTP" proxy feature?
 or Squid's older HTTP<->FTP gateway proxy feature?


> In my understanding, the default is passive mode.
> ?-/etc/squid/squid.conf? ftp_passive ON
> 

The ftp_passive directive controls HTTP<->FTP gateway interactions.


> So if I want to work in Active mode, it is necessary to change
> to ftp_passive off.
> 
> Is this understanding correct?

No, Squid FTP gateway feature auto-detects the server active/passive
capabilities. Passive works most often, but Squid can fall back to
active if passive fails. There are some issues though which make active
fail sometimes.


"Native FTP" proxying relays the FTP mode chosen by the client. AFAICS
in the code there is some support for Squid translating between active
and passive mode transfers on the fly. Whether that works I cannot say.


But, please be aware that Active FTP often does not work through a proxy
for the same reasons it does not work through a NAT. In fact NAT is why
Passive is the default for the gateway feature.



> 
> By the way, Is it possible to work both Active mode and Passive
> mode simultaneously?
> ?-In our IT system, it is connected to many FTP Server (A-FTP Sever,
> ? B-FTP Server via Squid(FTP Proxy) Server. For example, A-FTP Server
> ? works in Active mode and B-FTP Server works in Passive mode.
> 


It is technically possible in FTP since the difference is only in how
the DATA connections are established. However, Squid only supports one
DATA connection at a time per FTP client - so in reality there is no
"simultaneous" connections for this to actually happen on.


Whether your setup works is a question of whether the FTP client
negotiates a transfer mode that the server can perform *AND* can work
through a proxy/NAT. So the answer is "try it and find out".

Thanks for your interest in Squid.


PS. If you find Squid capabilities insufficient, we used to recommend
frox as the best option for native FTP proxying
(<http://frox.sourceforge.net/>).

Cheers
Amos


From robertocarna36 at gmail.com  Tue Feb  6 13:30:21 2018
From: robertocarna36 at gmail.com (Roberto Carna)
Date: Tue, 6 Feb 2018 10:30:21 -0300
Subject: [squid-users] Squid transparent with SSL interception - CA
	certificate problem
Message-ID: <CAG2Qp6u0dMyaZHhO58yKre6T6UAaXt5Q5-3=dKtkbqQnzq32uQ@mail.gmail.com>

People, I've setup a transparent Squid proxy for WiFi clients. I'm
using SSL interception so I had to generate a CA private certificate
(generated from pfSense certificate manager tab).

But when I add this CA private certificate to several Android an
Iphone devices, some of the Android devices don't work correctly:
Facebook an Instagram don't load the profiles and Mercadolibre doesn't
open the menu. In the other Android and Iphone devices, everything
works OK.

Can this problem be related to the CA certificate (maybe I have to use
a given digest algorithm and key lenght) or is this an Android
intrinsec problem depending of OS version???

Thanks a lot.

ROBERT


From yvoinov at gmail.com  Tue Feb  6 13:38:06 2018
From: yvoinov at gmail.com (Yuri)
Date: Tue, 6 Feb 2018 19:38:06 +0600
Subject: [squid-users] Squid transparent with SSL interception - CA
 certificate problem
In-Reply-To: <CAG2Qp6u0dMyaZHhO58yKre6T6UAaXt5Q5-3=dKtkbqQnzq32uQ@mail.gmail.com>
References: <CAG2Qp6u0dMyaZHhO58yKre6T6UAaXt5Q5-3=dKtkbqQnzq32uQ@mail.gmail.com>
Message-ID: <55e29186-89f3-6052-0518-3e19edc28b71@gmail.com>

Mobile devices, depending "OS", often uses CAs different. From system
store, from browser's store (I mean FF), and something apps will __never
use user's CA__.

This is (IMHO useless) security theathre in mobile devices manufacturers.


06.02.2018 19:30, Roberto Carna ?????:
> People, I've setup a transparent Squid proxy for WiFi clients. I'm
> using SSL interception so I had to generate a CA private certificate
> (generated from pfSense certificate manager tab).
>
> But when I add this CA private certificate to several Android an
> Iphone devices, some of the Android devices don't work correctly:
> Facebook an Instagram don't load the profiles and Mercadolibre doesn't
> open the menu. In the other Android and Iphone devices, everything
> works OK.
>
> Can this problem be related to the CA certificate (maybe I have to use
> a given digest algorithm and key lenght) or is this an Android
> intrinsec problem depending of OS version???
>
> Thanks a lot.
>
> ROBERT
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-- 
*****************************
* C++20 : Bug to the future *
*****************************


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180206/8e6af314/attachment.sig>

From rousskov at measurement-factory.com  Tue Feb  6 16:46:06 2018
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Tue, 6 Feb 2018 09:46:06 -0700
Subject: [squid-users] About Squid's FTP-Proxy mode support!
In-Reply-To: <652b88fb-d46c-f2d4-fd18-0bf94af53023@brown.plala.or.jp>
References: <652b88fb-d46c-f2d4-fd18-0bf94af53023@brown.plala.or.jp>
Message-ID: <a450a005-f099-b14d-3343-ff8c28a9274d@measurement-factory.com>

On 02/06/2018 04:31 AM, Koji Fushimi wrote:

> In my understanding, the default is passive mode.
> ?-/etc/squid/squid.conf? ftp_passive ON

Yes, passive mode is the default.

AFAIK, passive is also the only _working_ mode for Squid-origin
communication. FTP active mode is broken for Squid-origin connections
(and has been broken for many years IIRC).

Native FTP proxy (that Amos has mentioned in his response) supports both
passive and active FTP client-Squid connections. The ftp_passive
directive has no effect on those FTP client-Squid connections. Native
FTP proxy suffers from the same "active mode does not work" problem
mentioned above as far as Squid-origin connections are concerned.


HTH,

Alex.


From kotaro-243 at brown.plala.or.jp  Tue Feb  6 21:41:27 2018
From: kotaro-243 at brown.plala.or.jp (Koji Fushimi)
Date: Wed, 7 Feb 2018 06:41:27 +0900
Subject: [squid-users] About Squid's FTP-Proxy mode support!
In-Reply-To: <a450a005-f099-b14d-3343-ff8c28a9274d@measurement-factory.com>
References: <652b88fb-d46c-f2d4-fd18-0bf94af53023@brown.plala.or.jp>
 <a450a005-f099-b14d-3343-ff8c28a9274d@measurement-factory.com>
Message-ID: <e4f95fc9-a993-9a49-9b5f-557bcb50a48e@brown.plala.or.jp>

Alex,

Thanks for providing useful information.
I'd like to consider further.

Best regards,
Koji


On 2018/02/07 1:46, Alex Rousskov wrote:
> On 02/06/2018 04:31 AM, Koji Fushimi wrote:
>
>> In my understanding, the default is passive mode.
>>  ?-/etc/squid/squid.conf? ftp_passive ON
> Yes, passive mode is the default.
>
> AFAIK, passive is also the only _working_ mode for Squid-origin
> communication. FTP active mode is broken for Squid-origin connections
> (and has been broken for many years IIRC).
>
> Native FTP proxy (that Amos has mentioned in his response) supports both
> passive and active FTP client-Squid connections. The ftp_passive
> directive has no effect on those FTP client-Squid connections. Native
> FTP proxy suffers from the same "active mode does not work" problem
> mentioned above as far as Squid-origin connections are concerned.
>
>
> HTH,
>
> Alex.
>



From hoangminhung at gmail.com  Wed Feb  7 06:34:48 2018
From: hoangminhung at gmail.com (=?UTF-8?B?bWluaCBoxrBuZyDEkeG7lyBob8Ogbmc=?=)
Date: Wed, 7 Feb 2018 13:34:48 +0700
Subject: [squid-users] 3.5.20 run out of my memory.
Message-ID: <CAO0fBErmnH6ENVbN7NLQBZSJJ=DrXUH=OXZD8=W5LFx0u7K1dA@mail.gmail.com>

Dear all, i use squid 3.5.20 on ubuntu14 in TPROXY mode.
With basic config in squid.conf, but squid is run out of my server's memory.
Here is my configure option :

'--prefix=/usr' '--includedir=/usr/include' '--infodir=/usr/share/info'
'--sysconfdir=/etc' '--localstatedir=/var' '--libexecdir=/usr/lib/squid'
'--srcdir=.' '--datadir=/usr/share/squid' '--sysconfdir=/etc/squid'
'--mandir=/usr/share/man' '--enable-inline' '--enable-async-io=24'
'--enable-storeio=ufs,aufs,diskd,rock' '--enable-removal-policies=lru,heap'
'--enable-gnuregex' '--enable-delay-pools' '--enable-cache-digests'
'--enable-underscores' '--enable-icap-client'
'--enable-follow-x-forwarded-for' '--enable-eui' '--enable-esi'
'--enable-icmp' '--enable-zph-qos' '--enable-http-violations'
'--enable-ssl-crtd' '--enable-linux-netfilter' '--enable-ltdl-install'
'--enable-ltdl-convenience' '--enable-x-accelerator-vary'
'--disable-maintainer-mode' '--disable-dependency-tracking'
'--disable-silent-rules' '--disable-translation' '--disable-ipv6'
'--disable-ident-lookups' '--with-swapdir=/var/spool/squid'
'--with-logdir=/var/log/squid' '--with-pidfile=/var/run/squid.pid'
'--with-aufs-threads=24' '--with-filedescriptors=65536'
'--with-large-files' '--with-maxfd=65536' '--with-openssl'
'--with-default-user=proxy' '--with-included-ltdl'
--------------------------------------

And i apply this patch before compile for disabling host forgery checks :

+diff -ur squid-3.5.20-orig/src/client_side_request.cc
squid-3.5.20/src/client_side_request.cc
+--- squid-3.5.20-orig/src/client_side_request.cc    2016-07-01
13:37:50.000000000 +0200
++++ squid-3.5.20/src/client_side_request.cc    2017-03-10
16:48:08.920084072 +0100
+@@ -530,6 +530,10 @@
+             }
+             debugs(85, 3, HERE << "validate IP " << clientConn->local <<
" non-match from Host: IP " << ia->in_addrs[i]);
+         }
++    // disable fogery check. See
https://code.nethesis.it/Nethesis/dev/issues/5088
++        http->request->flags.hostVerified = true;
++        http->doCallouts();
++        return;
+     }
+     debugs(85, 3, HERE << "FAIL: validate IP " << clientConn->local << "
possible from Host:");
+     hostHeaderVerifyFailed("local IP", "any domain IP");

And here is my squid.conf ( i don't post my http_access for clearly view :()

###############################################################################
# Squid normally listens to port 3128
###############################################################################

https_port 3130 tproxy ssl-bump generate-host-certificates=on
dynamic_cert_mem_cache_size=4MB
cert=/etc/squid/ssl/e1f19c0494badc8dc14e8c4c56a8b97a.dyn
http_port 3129 tproxy
http_port 3128

###############################################################################
# squid ssl_bump option
###############################################################################
acl step1 at_step SslBump1
acl block ssl::server_name "/etc/squid/block_domain.txt"
ssl_bump peek step1
ssl_bump terminate block
ssl_bump splice all
sslproxy_options NO_SSLv2,NO_SSLv3,No_Compression
sslproxy_cipher
ALL:!SSLv2:!SSLv3:!ADH:!DSS:!MD5:!EXP:!DES:!PSK:!SRP:!RC4:!IDEA:!SEED:!aNULL:!eNULL
sslproxy_cert_error deny all
sslproxy_foreign_intermediate_certs /etc/squid/intermediate_ca.pem

sslcrtd_program /usr/lib/squid/ssl_crtd -s /var/lib/squid/ssl_db -M 4MB
sslcrtd_children 8 startup=1 idle=1

###############################################################################
## LOGFILE OPTIONS
###############################################################################

mime_table /etc/squid/mime.conf
pid_filename /var/run/squid.pid

include /etc/squid/logging.conf
###############################################################################
## OPTIONS FOR TROUBLESHOOTING
###############################################################################

coredump_dir /var/spool/squid
debug_options ALL,1
cache_effective_user squid
cache_effective_group squid
###############################################################################
## PERSISTENT CONNECTION HANDLING
###############################################################################

detect_broken_pconn off
client_persistent_connections off
server_persistent_connections on

###############################################################################
## ERROR PAGE OPTIONS
###############################################################################
error_directory /usr/share/squid/errors/en
error_log_languages off

###############################################################################
## DNS OPTIONS
###############################################################################
check_hostnames off
hosts_file /etc/hosts
connect_retries 2
ipcache_low 90
ipcache_size 5024       # Maximum number of DNS IP cache entries.
fqdncache_size 3024     # Maximum number of FQDN cache entries.
pipeline_prefetch 100

###############################################################################
##  MISCELLANEOUS
###############################################################################

max_filedescriptors 65536

------------------------------------------------------------------------

The problem is my squid spent alot of memory. I have about 200 user, and my
server is 4gb dram with 8gb swap dram but not enough !
             total       used       free     shared    buffers     cached
Mem:          3.8G       3.4G       503M       736K       181M       1.7G
-/+ buffers/cache:       1.5G       2.4G
Swap:         8.1G       9.3M       8.1G

There is any issue with my squid ?? How can i fix it ?

I have attach files for detail (squid.conf and
squid-3.5.20-ssl-forgery.patch)

-- 
Thanks & Best Regards,
--------------
?? Ho?ng Minh H?ng
Gmail : hoangminhung at gmail.com
S?T : 01234454115
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180207/e7029c9e/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: squid.conf
Type: application/octet-stream
Size: 2866 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180207/e7029c9e/attachment.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: squid-3.5.20-ssl-forgery.patch
Type: application/octet-stream
Size: 795 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180207/e7029c9e/attachment-0001.obj>

From m_zouhairy at skno.by  Wed Feb  7 08:09:14 2018
From: m_zouhairy at skno.by (Vacheslav)
Date: Wed, 7 Feb 2018 11:09:14 +0300
Subject: [squid-users] 3.5.20 run out of my memory.
In-Reply-To: <CAO0fBErmnH6ENVbN7NLQBZSJJ=DrXUH=OXZD8=W5LFx0u7K1dA@mail.gmail.com>
References: <CAO0fBErmnH6ENVbN7NLQBZSJJ=DrXUH=OXZD8=W5LFx0u7K1dA@mail.gmail.com>
Message-ID: <006001d39fea$f1851230$d48f3690$@skno.by>

I cron those for memory, try it.
0                             */1 *   *   *          root                                       /usr/sbin/sysctl -w vm.drop_caches=3

0                             */1 *   *   *          root                                       /bin/sync && /bin/echo 3 | /usr/bin/tee /proc/sys/vm/drop_cache

 

From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of minh hung d? hoang
Sent: Wednesday, February 7, 2018 9:35 AM
To: squid-users at lists.squid-cache.org
Subject: [squid-users] 3.5.20 run out of my memory.

 

Dear all, i use squid 3.5.20 on ubuntu14 in TPROXY mode.

With basic config in squid.conf, but squid is run out of my server's memory.

Here is my configure option :

'--prefix=/usr' '--includedir=/usr/include' '--infodir=/usr/share/info' '--sysconfdir=/etc' '--localstatedir=/var' '--libexecdir=/usr/lib/squid' '--srcdir=.' '--datadir=/usr/share/squid' '--sysconfdir=/etc/squid' '--mandir=/usr/share/man' '--enable-inline' '--enable-async-io=24' '--enable-storeio=ufs,aufs,diskd,rock' '--enable-removal-policies=lru,heap' '--enable-gnuregex' '--enable-delay-pools' '--enable-cache-digests' '--enable-underscores' '--enable-icap-client' '--enable-follow-x-forwarded-for' '--enable-eui' '--enable-esi' '--enable-icmp' '--enable-zph-qos' '--enable-http-violations' '--enable-ssl-crtd' '--enable-linux-netfilter' '--enable-ltdl-install' '--enable-ltdl-convenience' '--enable-x-accelerator-vary' '--disable-maintainer-mode' '--disable-dependency-tracking' '--disable-silent-rules' '--disable-translation' '--disable-ipv6' '--disable-ident-lookups' '--with-swapdir=/var/spool/squid' '--with-logdir=/var/log/squid' '--with-pidfile=/var/run/squid.pid' '--with-aufs-threads=24' '--with-filedescriptors=65536' '--with-large-files' '--with-maxfd=65536' '--with-openssl' '--with-default-user=proxy' '--with-included-ltdl'
--------------------------------------



And i apply this patch before compile for disabling host forgery checks :

+diff -ur squid-3.5.20-orig/src/client_side_request.cc squid-3.5.20/src/client_side_request.cc
+--- squid-3.5.20-orig/src/client_side_request.cc    2016-07-01 13:37:50.000000000 +0200
++++ squid-3.5.20/src/client_side_request.cc    2017-03-10 16:48:08.920084072 +0100
+@@ -530,6 +530,10 @@
+             }
+             debugs(85, 3, HERE << "validate IP " << clientConn->local << " non-match from Host: IP " << ia->in_addrs[i]);
+         }
++    // disable fogery check. See https://code.nethesis.it/Nethesis/dev/issues/5088
++        http->request->flags.hostVerified = true;
++        http->doCallouts();
++        return;
+     }
+     debugs(85, 3, HERE << "FAIL: validate IP " << clientConn->local << " possible from Host:");
+     hostHeaderVerifyFailed("local IP", "any domain IP");

 

And here is my squid.conf ( i don't post my http_access for clearly view :()

###############################################################################
# Squid normally listens to port 3128
###############################################################################

https_port 3130 tproxy ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=4MB cert=/etc/squid/ssl/e1f19c0494badc8dc14e8c4c56a8b97a.dyn
http_port 3129 tproxy
http_port 3128

###############################################################################
# squid ssl_bump option
###############################################################################
acl step1 at_step SslBump1
acl block ssl::server_name "/etc/squid/block_domain.txt"
ssl_bump peek step1
ssl_bump terminate block
ssl_bump splice all
sslproxy_options NO_SSLv2,NO_SSLv3,No_Compression
sslproxy_cipher  ALL:!SSLv2:!SSLv3:!ADH:!DSS:!MD5:!EXP:!DES:!PSK:!SRP:!RC4:!IDEA:!SEED:!aNULL:!eNULL
sslproxy_cert_error deny all
sslproxy_foreign_intermediate_certs /etc/squid/intermediate_ca.pem

sslcrtd_program /usr/lib/squid/ssl_crtd -s /var/lib/squid/ssl_db -M 4MB
sslcrtd_children 8 startup=1 idle=1

###############################################################################
## LOGFILE OPTIONS
###############################################################################

mime_table /etc/squid/mime.conf
pid_filename /var/run/squid.pid

include /etc/squid/logging.conf
###############################################################################
## OPTIONS FOR TROUBLESHOOTING
###############################################################################

coredump_dir /var/spool/squid
debug_options ALL,1
cache_effective_user squid
cache_effective_group squid
###############################################################################
## PERSISTENT CONNECTION HANDLING
###############################################################################
 
detect_broken_pconn off
client_persistent_connections off
server_persistent_connections on

###############################################################################
## ERROR PAGE OPTIONS
###############################################################################
error_directory /usr/share/squid/errors/en
error_log_languages off

###############################################################################
## DNS OPTIONS
###############################################################################
check_hostnames off
hosts_file /etc/hosts
connect_retries 2
ipcache_low 90
ipcache_size 5024       # Maximum number of DNS IP cache entries.
fqdncache_size 3024     # Maximum number of FQDN cache entries.
pipeline_prefetch 100

###############################################################################
##  MISCELLANEOUS
###############################################################################

max_filedescriptors 65536

------------------------------------------------------------------------

 

The problem is my squid spent alot of memory. I have about 200 user, and my server is 4gb dram with 8gb swap dram but not enough !
             total       used       free     shared    buffers     cached
Mem:          3.8G       3.4G       503M       736K       181M       1.7G
-/+ buffers/cache:       1.5G       2.4G
Swap:         8.1G       9.3M       8.1G

There is any issue with my squid ?? How can i fix it ?

I have attach files for detail (squid.conf and squid-3.5.20-ssl-forgery.patch)

-- 

Thanks & Best Regards,
--------------

?? Ho?ng Minh H?ng

Gmail : hoangminhung at gmail.com <mailto:hoangminhung at gmail.com> 

S?T : 01234454115

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180207/35f27b06/attachment.htm>

From flashdown at data-core.org  Wed Feb  7 09:22:36 2018
From: flashdown at data-core.org (Flashdown)
Date: Wed, 07 Feb 2018 10:22:36 +0100
Subject: [squid-users] 4.0.23 release in Debian
In-Reply-To: <53581439320f2fd3c562e8785acd4399@data-core.org>
References: <E447B375-ABA3-413A-B103-1E167AA39052@yahoo.com>
 <ead2f401-72db-5fdd-39e2-548fe7dc6bc9@treenet.co.nz>
 <161901d39d4c$ce282890$6a7879b0$@ngtech.co.il>
 <BE3F14D0-5B24-49B2-A843-B54053A08CD9@data-core.org>
 <548a23b1-f6d1-979d-f2a4-1e2766b07cd2@treenet.co.nz>
 <17c701d39e2d$73179a80$5946cf80$@ngtech.co.il>
 <53581439320f2fd3c562e8785acd4399@data-core.org>
Message-ID: <87fa4f05055d8cb19357c6019140b41b@data-core.org>

FYI:
There is already progress on Squid 4.0.23 over here: 
https://packages.debian.org/source/experimental/squid

BTW: Hope I may get a response this time from anybody over there, then I 
would package 3.5.27..

Am 2018-02-05 10:21, schrieb Flashdown:
> Well, I've forwarded my old mail just now after subcribing to this
> list which I did sent directly to luigi and manty because I was
> unaware of these mailing lists. Thank you Amos!
> 
> Am 2018-02-05 04:00, schrieb Eliezer Croitoru:
>> It seems they are not even trying to block spam...
>> 
>> Eliezer
>> 
>> ----
>> Eliezer Croitoru
>> Linux System Administrator
>> Mobile: +972-5-28704261
>> Email: eliezer at ngtech.co.il
>> 
>> 
>> 
>> -----Original Message-----
>> From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org]
>> On Behalf Of Amos Jeffries
>> Sent: Sunday, February 4, 2018 20:40
>> To: Enrico Heine <flashdown at data-core.org>; 
>> squid-users at lists.squid-cache.org
>> Subject: Re: [squid-users] 4.0.23 release in Debian
>> 
>> On 05/02/18 00:06, Enrico Heine wrote:
>>> Already asked the responsible guys, if I can support them by 
>>> packaging
>>> squid for debian since this is what I already do for my company and
>>> there is no reason for not sharing it or building it in my spare time 
>>> at
>>> home. Unfortunately I never got an answer so I thought ok, I can't 
>>> force
>>> them to allow me to contribute something back. I would also have been
>>> gratefull for just becoming an uploader to experimental only. Saad
>>> story, I guess they are to busy to even listening for people trying 
>>> to help.
>>> 
>> 
>> Who did you contact? The Debian 'squid' and 'squid3' packages are 
>> being
>> maintained by a team these days. I have not seen any messages from you
>> going to that mailing list:
>> <https://alioth.debian.org/mail/?group_id=100852>
>> 
>> 
>> Amos
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users


From belle at bazuin.nl  Wed Feb  7 10:25:03 2018
From: belle at bazuin.nl (=?windows-1252?Q?L.P.H._van_Belle?=)
Date: Wed, 7 Feb 2018 11:25:03 +0100
Subject: [squid-users] 4.0.23 release in Debian
In-Reply-To: <87fa4f05055d8cb19357c6019140b41b@data-core.org>
References: <53581439320f2fd3c562e8785acd4399@data-core.org>
Message-ID: <vmime.5a7ad3ff.2d42.84391f9c24726f@ms249-lin-003.rotterdam.bazuin.nl>

Hi, 

If you want a squid 3.5.27 for debian stretch. (amd64 only builded) 
Have a look here :  http://downloads.van-belle.nl/squid/
The tar.gz contains, build log, sources used and debs.

My changelog.
squid3 (3.5.27-0.1) stretch; urgency=medium

  * Non-maintainer upload.
  * Builded from squid-cache.org sources.
  * base 3.5.23 from buster.
  * No changes.

The exact version is : 
Squid Cache: Version 3.5.27-20171101-re69e56c

So nothing fancy, just the debian standards. If you want a bit newer. 
Go here: http://www.squid-cache.org/Versions/v3/3.5
And look if there is any intersting you want and add the patches or get a daily tar.gz.
And replace the source.tar.gz. 


Greetz, 

Louis

 

> -----Oorspronkelijk bericht-----
> Van: squid-users 
> [mailto:squid-users-bounces at lists.squid-cache.org] Namens Flashdown
> Verzonden: woensdag 7 februari 2018 10:23
> Aan: Eliezer Croitoru
> CC: squid-users at lists.squid-cache.org
> Onderwerp: Re: [squid-users] 4.0.23 release in Debian
> 
> FYI:
> There is already progress on Squid 4.0.23 over here: 
> https://packages.debian.org/source/experimental/squid
> 
> BTW: Hope I may get a response this time from anybody over 
> there, then I 
> would package 3.5.27..
> 
> Am 2018-02-05 10:21, schrieb Flashdown:
> > Well, I've forwarded my old mail just now after subcribing to this
> > list which I did sent directly to luigi and manty because I was
> > unaware of these mailing lists. Thank you Amos!
> > 
> > Am 2018-02-05 04:00, schrieb Eliezer Croitoru:
> >> It seems they are not even trying to block spam...
> >> 
> >> Eliezer
> >> 
> >> ----
> >> Eliezer Croitoru
> >> Linux System Administrator
> >> Mobile: +972-5-28704261
> >> Email: eliezer at ngtech.co.il
> >> 
> >> 
> >> 
> >> -----Original Message-----
> >> From: squid-users 
> [mailto:squid-users-bounces at lists.squid-cache.org]
> >> On Behalf Of Amos Jeffries
> >> Sent: Sunday, February 4, 2018 20:40
> >> To: Enrico Heine <flashdown at data-core.org>; 
> >> squid-users at lists.squid-cache.org
> >> Subject: Re: [squid-users] 4.0.23 release in Debian
> >> 
> >> On 05/02/18 00:06, Enrico Heine wrote:
> >>> Already asked the responsible guys, if I can support them by 
> >>> packaging
> >>> squid for debian since this is what I already do for my 
> company and
> >>> there is no reason for not sharing it or building it in 
> my spare time 
> >>> at
> >>> home. Unfortunately I never got an answer so I thought 
> ok, I can't 
> >>> force
> >>> them to allow me to contribute something back. I would 
> also have been
> >>> gratefull for just becoming an uploader to experimental only. Saad
> >>> story, I guess they are to busy to even listening for 
> people trying 
> >>> to help.
> >>> 
> >> 
> >> Who did you contact? The Debian 'squid' and 'squid3' packages are 
> >> being
> >> maintained by a team these days. I have not seen any 
> messages from you
> >> going to that mailing list:
> >> <https://alioth.debian.org/mail/?group_id=100852>
> >> 
> >> 
> >> Amos
> >> _______________________________________________
> >> squid-users mailing list
> >> squid-users at lists.squid-cache.org
> >> http://lists.squid-cache.org/listinfo/squid-users
> > _______________________________________________
> > squid-users mailing list
> > squid-users at lists.squid-cache.org
> > http://lists.squid-cache.org/listinfo/squid-users
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 



From danilovt at gmail.com  Wed Feb  7 11:12:47 2018
From: danilovt at gmail.com (Danilo V)
Date: Wed, 07 Feb 2018 11:12:47 +0000
Subject: [squid-users] Time acl not working
Message-ID: <CAHaQnLNqTj5DpS28Jm+HVV50MOT1v4G8Ukc=cF3Ox1RMvVRU8w@mail.gmail.com>

Hello all, time acl is not working for dynamic HTTPS pages such as social
networks.

I set it to release any content during lunch time. In this period
everything works, but when the interval expires, the already open network
media pages continue to receive updates and are not blocked as expected. On
the other hand HTTP pages and some static HTTPS do not occur this problem.

The issue was verified in both squid3 and squidguard 1.5 in explicit mode
and in sites such as Facebook, Twitter and Instagram.

The problem is very simple to simulate. The only workaround found is to
restart the squid.

Can someone help me?

Danilo Teixeira
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180207/5b037b32/attachment.htm>

From Antony.Stone at squid.open.source.it  Wed Feb  7 11:15:49 2018
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Wed, 7 Feb 2018 12:15:49 +0100
Subject: [squid-users] Time acl not working
In-Reply-To: <CAHaQnLNqTj5DpS28Jm+HVV50MOT1v4G8Ukc=cF3Ox1RMvVRU8w@mail.gmail.com>
References: <CAHaQnLNqTj5DpS28Jm+HVV50MOT1v4G8Ukc=cF3Ox1RMvVRU8w@mail.gmail.com>
Message-ID: <201802071215.49497.Antony.Stone@squid.open.source.it>

On Wednesday 07 February 2018 at 12:12:47, Danilo V wrote:

> Hello all, time acl is not working for dynamic HTTPS pages such as social
> networks.
> 
> I set it to release any content during lunch time. In this period
> everything works, but when the interval expires, the already open network
> media pages continue to receive updates and are not blocked as expected. On
> the other hand HTTP pages and some static HTTPS do not occur this problem.
> 
> The issue was verified in both squid3 and squidguard 1.5 in explicit mode
> and in sites such as Facebook, Twitter and Instagram.
> 
> The problem is very simple to simulate. The only workaround found is to
> restart the squid.
> 
> Can someone help me?

Show us how to reproduce the problem.


Antony.

-- 
Users don't know what they want until they see what they get.

                                                   Please reply to the list;
                                                         please *don't* CC me.


From tarotapprentice at yahoo.com  Wed Feb  7 11:45:26 2018
From: tarotapprentice at yahoo.com (TarotApprentice)
Date: Wed, 7 Feb 2018 22:45:26 +1100
Subject: [squid-users] 4.0.23 release in Debian
In-Reply-To: <vmime.5a7ad3ff.2d42.84391f9c24726f@ms249-lin-003.rotterdam.bazuin.nl>
References: <53581439320f2fd3c562e8785acd4399@data-core.org>
 <vmime.5a7ad3ff.2d42.84391f9c24726f@ms249-lin-003.rotterdam.bazuin.nl>
Message-ID: <DF42EAF7-53C9-4AC8-A45D-EB7BA1E0E6E1@yahoo.com>


I?ve already raised a Debian bug regarding startup script issues with it. Maybe that will receive some attention.

> On 7 Feb 2018, at 9:25 pm, L.P.H. van Belle <belle at bazuin.nl> wrote:
> 
> Hi, 
> 
> If you want a squid 3.5.27 for debian stretch. (amd64 only builded) 
> Have a look here :  http://downloads.van-belle.nl/squid/
> The tar.gz contains, build log, sources used and debs.
> 
> My changelog.
> squid3 (3.5.27-0.1) stretch; urgency=medium
> 
>  * Non-maintainer upload.
>  * Builded from squid-cache.org sources.
>  * base 3.5.23 from buster.
>  * No changes.
> 
> The exact version is : 
> Squid Cache: Version 3.5.27-20171101-re69e56c
> 
> So nothing fancy, just the debian standards. If you want a bit newer. 
> Go here: http://www.squid-cache.org/Versions/v3/3.5
> And look if there is any intersting you want and add the patches or get a daily tar.gz.
> And replace the source.tar.gz. 
> 
> 
> Greetz, 
> 
> Louis
> 
> 
> 
>> -----Oorspronkelijk bericht-----
>> Van: squid-users 
>> [mailto:squid-users-bounces at lists.squid-cache.org] Namens Flashdown
>> Verzonden: woensdag 7 februari 2018 10:23
>> Aan: Eliezer Croitoru
>> CC: squid-users at lists.squid-cache.org
>> Onderwerp: Re: [squid-users] 4.0.23 release in Debian
>> 
>> FYI:
>> There is already progress on Squid 4.0.23 over here: 
>> https://packages.debian.org/source/experimental/squid
>> 
>> BTW: Hope I may get a response this time from anybody over 
>> there, then I 
>> would package 3.5.27..
>> 
>> Am 2018-02-05 10:21, schrieb Flashdown:
>>> Well, I've forwarded my old mail just now after subcribing to this
>>> list which I did sent directly to luigi and manty because I was
>>> unaware of these mailing lists. Thank you Amos!
>>> 
>>> Am 2018-02-05 04:00, schrieb Eliezer Croitoru:
>>>> It seems they are not even trying to block spam...
>>>> 
>>>> Eliezer
>>>> 
>>>> ----
>>>> Eliezer Croitoru
>>>> Linux System Administrator
>>>> Mobile: +972-5-28704261
>>>> Email: eliezer at ngtech.co.il
>>>> 
>>>> 
>>>> 
>>>> -----Original Message-----
>>>> From: squid-users 
>> [mailto:squid-users-bounces at lists.squid-cache.org]
>>>> On Behalf Of Amos Jeffries
>>>> Sent: Sunday, February 4, 2018 20:40
>>>> To: Enrico Heine <flashdown at data-core.org>; 
>>>> squid-users at lists.squid-cache.org
>>>> Subject: Re: [squid-users] 4.0.23 release in Debian
>>>> 
>>>>> On 05/02/18 00:06, Enrico Heine wrote:
>>>>> Already asked the responsible guys, if I can support them by 
>>>>> packaging
>>>>> squid for debian since this is what I already do for my 
>> company and
>>>>> there is no reason for not sharing it or building it in 
>> my spare time 
>>>>> at
>>>>> home. Unfortunately I never got an answer so I thought 
>> ok, I can't 
>>>>> force
>>>>> them to allow me to contribute something back. I would 
>> also have been
>>>>> gratefull for just becoming an uploader to experimental only. Saad
>>>>> story, I guess they are to busy to even listening for 
>> people trying 
>>>>> to help.
>>>>> 
>>>> 
>>>> Who did you contact? The Debian 'squid' and 'squid3' packages are 
>>>> being
>>>> maintained by a team these days. I have not seen any 
>> messages from you
>>>> going to that mailing list:
>>>> <https://alioth.debian.org/mail/?group_id=100852>
>>>> 
>>>> 
>>>> Amos
>>>> _______________________________________________
>>>> squid-users mailing list
>>>> squid-users at lists.squid-cache.org
>>>> http://lists.squid-cache.org/listinfo/squid-users
>>> _______________________________________________
>>> squid-users mailing list
>>> squid-users at lists.squid-cache.org
>>> http://lists.squid-cache.org/listinfo/squid-users
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
>> 
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



From squid3 at treenet.co.nz  Wed Feb  7 12:23:07 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 8 Feb 2018 01:23:07 +1300
Subject: [squid-users] 3.5.20 run out of my memory.
In-Reply-To: <CAO0fBErmnH6ENVbN7NLQBZSJJ=DrXUH=OXZD8=W5LFx0u7K1dA@mail.gmail.com>
References: <CAO0fBErmnH6ENVbN7NLQBZSJJ=DrXUH=OXZD8=W5LFx0u7K1dA@mail.gmail.com>
Message-ID: <9ccf03f1-64ea-9004-fa6f-e2b42af61717@treenet.co.nz>


On 07/02/18 19:34, minh h?ng ?? ho?ng wrote:
> Dear all, i use squid 3.5.20 on ubuntu14 in TPROXY mode.
> With basic config in squid.conf, but squid is run out of my server's memory.
> Here is my configure option :
...
> 
> https_port 3130 tproxy ssl-bump generate-host-certificates=on
> dynamic_cert_mem_cache_size=4MB
> cert=/etc/squid/ssl/e1f19c0494badc8dc14e8c4c56a8b97a.dyn

Please add sslflags=NO_DEFAULT_CA to the above config line. That should
reduce the memory usage a lot.

If the problems remains please try:
 a) removing that patch. It makes your Squid vulnerable to the worst
security issues Squid has faced this century.
 (One of the MANY effects of that vulnerability is ability of remote
attackers to consume large amounts of your network resources without any
traceability or visibility.)

  b) upgrade to Squid-4. The version is still in beta due to a few
issues, but overall MUCH better for SSL-Bump than Squid-3.


Amos


From danilovt at gmail.com  Wed Feb  7 12:37:06 2018
From: danilovt at gmail.com (Danilo V)
Date: Wed, 07 Feb 2018 12:37:06 +0000
Subject: [squid-users] Time acl not working
In-Reply-To: <201802071215.49497.Antony.Stone@squid.open.source.it>
References: <CAHaQnLNqTj5DpS28Jm+HVV50MOT1v4G8Ukc=cF3Ox1RMvVRU8w@mail.gmail.com>
 <201802071215.49497.Antony.Stone@squid.open.source.it>
Message-ID: <CAHaQnLPTxSmD6exSLY5y0hxDUVOP4B2RKApvPS6DN9d1uqfQyw@mail.gmail.com>

- Squid.conf:


*http_port 3128*

*acl social dstdomain -i .facebook.com <http://facebook.com> .fbcdn.net
<http://fbcdn.net> .twitter.com <http://twitter.com>*
*acl LUNCH time 12:00-13:00*
*http_access allow social LUNCH*
*http_access deny social*

1. Adjust time in acl to your local test time.
2. Open facebook and twitter tabs in browser within allowed hours.
3. Once the interval expires try to scroll pages down or click internal
links.
4. It's still working here. :-(

Best,
Danilo

Em qua, 7 de fev de 2018 ?s 09:16, Antony Stone <
Antony.Stone at squid.open.source.it> escreveu:

> On Wednesday 07 February 2018 at 12:12:47, Danilo V wrote:
>
> > Hello all, time acl is not working for dynamic HTTPS pages such as social
> > networks.
> >
> > I set it to release any content during lunch time. In this period
> > everything works, but when the interval expires, the already open network
> > media pages continue to receive updates and are not blocked as expected.
> On
> > the other hand HTTP pages and some static HTTPS do not occur this
> problem.
> >
> > The issue was verified in both squid3 and squidguard 1.5 in explicit mode
> > and in sites such as Facebook, Twitter and Instagram.
> >
> > The problem is very simple to simulate. The only workaround found is to
> > restart the squid.
> >
> > Can someone help me?
>
> Show us how to reproduce the problem.
>
>
> Antony.
>
> --
> Users don't know what they want until they see what they get.
>
>                                                    Please reply to the
> list;
>                                                          please *don't* CC
> me.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180207/91b18811/attachment.htm>

From squid3 at treenet.co.nz  Wed Feb  7 13:00:08 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 8 Feb 2018 02:00:08 +1300
Subject: [squid-users] Time acl not working
In-Reply-To: <CAHaQnLPTxSmD6exSLY5y0hxDUVOP4B2RKApvPS6DN9d1uqfQyw@mail.gmail.com>
References: <CAHaQnLNqTj5DpS28Jm+HVV50MOT1v4G8Ukc=cF3Ox1RMvVRU8w@mail.gmail.com>
 <201802071215.49497.Antony.Stone@squid.open.source.it>
 <CAHaQnLPTxSmD6exSLY5y0hxDUVOP4B2RKApvPS6DN9d1uqfQyw@mail.gmail.com>
Message-ID: <5c084cfb-81ca-53ef-5aea-55ae5ed79821@treenet.co.nz>


On 08/02/18 01:37, Danilo V wrote:
> - Squid.conf:
> 
> /http_port 3128
> /
> /acl social dstdomain -i .facebook.com <http://facebook.com> .fbcdn.net
> <http://fbcdn.net> .twitter.com <http://twitter.com>
> /
> /acl LUNCH time 12:00-13:00/
> /http_access allow social LUNCH/
> /http_access deny social/
> 
> 1. Adjust time in acl to your local test time.
> 2. Open facebook and twitter tabs in browser within allowed hours.
> 3. Once the interval expires try to scroll pages down or click internal
> links.
> 4. It's still working here. :-(
> 

So what https_port and/or SSL-Bump settings do you use to actually
access the HTTPS requests?

Without either explicit TLS or SSL-Bump there is only an initial CONNECT
tunnel setup. The time ACLs are applied at that point and HTTP ends once
the tunnel starts. No ACLs or other checking is possible on the TCP
connection.


Amos


From danilovt at gmail.com  Wed Feb  7 13:50:02 2018
From: danilovt at gmail.com (Danilo V)
Date: Wed, 07 Feb 2018 13:50:02 +0000
Subject: [squid-users] Time acl not working
In-Reply-To: <5c084cfb-81ca-53ef-5aea-55ae5ed79821@treenet.co.nz>
References: <CAHaQnLNqTj5DpS28Jm+HVV50MOT1v4G8Ukc=cF3Ox1RMvVRU8w@mail.gmail.com>
 <201802071215.49497.Antony.Stone@squid.open.source.it>
 <CAHaQnLPTxSmD6exSLY5y0hxDUVOP4B2RKApvPS6DN9d1uqfQyw@mail.gmail.com>
 <5c084cfb-81ca-53ef-5aea-55ae5ed79821@treenet.co.nz>
Message-ID: <CAHaQnLMC3qL8MC=N2s_9W93t737r2qfDsiXfrcCXpOznMcwyRw@mail.gmail.com>

I'm not using SSL intercept configuration. Now i see is required, even for
explicit mode.
Thank you for explanation.

Danilo




Em qua, 7 de fev de 2018 ?s 11:00, Amos Jeffries <squid3 at treenet.co.nz>
escreveu:

>
> On 08/02/18 01:37, Danilo V wrote:
> > - Squid.conf:
> >
> > /http_port 3128
> > /
> > /acl social dstdomain -i .facebook.com <http://facebook.com> .fbcdn.net
> > <http://fbcdn.net> .twitter.com <http://twitter.com>
> > /
> > /acl LUNCH time 12:00-13:00/
> > /http_access allow social LUNCH/
> > /http_access deny social/
> >
> > 1. Adjust time in acl to your local test time.
> > 2. Open facebook and twitter tabs in browser within allowed hours.
> > 3. Once the interval expires try to scroll pages down or click internal
> > links.
> > 4. It's still working here. :-(
> >
>
> So what https_port and/or SSL-Bump settings do you use to actually
> access the HTTPS requests?
>
> Without either explicit TLS or SSL-Bump there is only an initial CONNECT
> tunnel setup. The time ACLs are applied at that point and HTTP ends once
> the tunnel starts. No ACLs or other checking is possible on the TCP
> connection.
>
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180207/e1850b43/attachment.htm>

From squid3 at treenet.co.nz  Wed Feb  7 14:22:02 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 8 Feb 2018 03:22:02 +1300
Subject: [squid-users] Time acl not working
In-Reply-To: <CAHaQnLMC3qL8MC=N2s_9W93t737r2qfDsiXfrcCXpOznMcwyRw@mail.gmail.com>
References: <CAHaQnLNqTj5DpS28Jm+HVV50MOT1v4G8Ukc=cF3Ox1RMvVRU8w@mail.gmail.com>
 <201802071215.49497.Antony.Stone@squid.open.source.it>
 <CAHaQnLPTxSmD6exSLY5y0hxDUVOP4B2RKApvPS6DN9d1uqfQyw@mail.gmail.com>
 <5c084cfb-81ca-53ef-5aea-55ae5ed79821@treenet.co.nz>
 <CAHaQnLMC3qL8MC=N2s_9W93t737r2qfDsiXfrcCXpOznMcwyRw@mail.gmail.com>
Message-ID: <a503016b-690b-48db-8140-9a9cae6c3da8@treenet.co.nz>

On 08/02/18 02:50, Danilo V wrote:
> I'm not using SSL intercept configuration. Now i see is required, even
> for explicit mode.

Only because you want *Squid* to be the process controlling HTTPS
things. If you did the controls at the network traffic level (eg
iptables, pf) instead then you would not have to worry about these type
of differences.

Amos


From danilovt at gmail.com  Wed Feb  7 16:13:17 2018
From: danilovt at gmail.com (Danilo V)
Date: Wed, 07 Feb 2018 16:13:17 +0000
Subject: [squid-users] Time acl not working
In-Reply-To: <a503016b-690b-48db-8140-9a9cae6c3da8@treenet.co.nz>
References: <CAHaQnLNqTj5DpS28Jm+HVV50MOT1v4G8Ukc=cF3Ox1RMvVRU8w@mail.gmail.com>
 <201802071215.49497.Antony.Stone@squid.open.source.it>
 <CAHaQnLPTxSmD6exSLY5y0hxDUVOP4B2RKApvPS6DN9d1uqfQyw@mail.gmail.com>
 <5c084cfb-81ca-53ef-5aea-55ae5ed79821@treenet.co.nz>
 <CAHaQnLMC3qL8MC=N2s_9W93t737r2qfDsiXfrcCXpOznMcwyRw@mail.gmail.com>
 <a503016b-690b-48db-8140-9a9cae6c3da8@treenet.co.nz>
Message-ID: <CAHaQnLMqe2hjyyv59kqHHZCr5naAC2r6hHnSBkqwpq6gWrqxgA@mail.gmail.com>

I'm thinking of adding a routine to cron to restart squid as soon as lunch
break ends.
Is there any other less invasive way to reset an ssl connection and force
another CONNECT to squid?

Em qua, 7 de fev de 2018 ?s 12:22, Amos Jeffries <squid3 at treenet.co.nz>
escreveu:

> On 08/02/18 02:50, Danilo V wrote:
> > I'm not using SSL intercept configuration. Now i see is required, even
> > for explicit mode.
>
> Only because you want *Squid* to be the process controlling HTTPS
> things. If you did the controls at the network traffic level (eg
> iptables, pf) instead then you would not have to worry about these type
> of differences.
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180207/87407c15/attachment.htm>

From soakley at expedia.com  Wed Feb  7 18:03:44 2018
From: soakley at expedia.com (steveno)
Date: Wed, 7 Feb 2018 11:03:44 -0700 (MST)
Subject: [squid-users] Default host_verify_strict behavior appears to have
 changed as of 3.5.25
Message-ID: <1518026624169-0.post@n4.nabble.com>

I was using squid 3.5.20 I encountered an issue running out of File
Descriptors on Centos7, the scebario was that sockets would be abandoned in
a "CLOSE_WAIT" state forever until the server ran out of FD's.
Searching I found the following BUG. 
https://bugs.squid-cache.org/show_bug.cgi?id=4508
This is listed as being a fix at 3.5.25, so I installed that version, once
installed the FD problem seemed to be resolved, but now there is another
issue "Default Value:	host_verify_strict off" seems to be lost, in my access
logs I get an number of entries:
2018-02-07 17:10:42      0 10.x.x.x TAG_NONE/409 3941 CONNECT
sqs.us-west-2.amazonaws.com:443 sqs.us-west-2.amazonaws.com HIER_NONE/-
text/html

Cache logs I get:
2018/02/07 17:57:45 kid1| SECURITY ALERT: on URL:
sqs.us-west-2.amazonaws.com:443

And the clients making those requests tend to see dropped connections with a
"SSL: UNKNOWN_PROTOCOL" error.

I tried setting the value "host_verify_strict off" but it did not appear to
have any effect.

It looks like this fix for the File Descriptors has broken something else.

Thanks.

Steven Oakley.



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From yvoinov at gmail.com  Wed Feb  7 18:05:33 2018
From: yvoinov at gmail.com (Yuri)
Date: Thu, 8 Feb 2018 00:05:33 +0600
Subject: [squid-users] Default host_verify_strict behavior appears to
 have changed as of 3.5.25
In-Reply-To: <1518026624169-0.post@n4.nabble.com>
References: <1518026624169-0.post@n4.nabble.com>
Message-ID: <cd464158-b003-fd9f-b748-24d71e05debf@gmail.com>

This irrelevant to host_verify_strict. This is effect of server side CDN
IP changes. Squid threats it as security alert.

08.02.2018 00:03, steveno ?????:
> I was using squid 3.5.20 I encountered an issue running out of File
> Descriptors on Centos7, the scebario was that sockets would be abandoned in
> a "CLOSE_WAIT" state forever until the server ran out of FD's.
> Searching I found the following BUG. 
> https://bugs.squid-cache.org/show_bug.cgi?id=4508
> This is listed as being a fix at 3.5.25, so I installed that version, once
> installed the FD problem seemed to be resolved, but now there is another
> issue "Default Value:	host_verify_strict off" seems to be lost, in my access
> logs I get an number of entries:
> 2018-02-07 17:10:42      0 10.x.x.x TAG_NONE/409 3941 CONNECT
> sqs.us-west-2.amazonaws.com:443 sqs.us-west-2.amazonaws.com HIER_NONE/-
> text/html
>
> Cache logs I get:
> 2018/02/07 17:57:45 kid1| SECURITY ALERT: on URL:
> sqs.us-west-2.amazonaws.com:443
>
> And the clients making those requests tend to see dropped connections with a
> "SSL: UNKNOWN_PROTOCOL" error.
>
> I tried setting the value "host_verify_strict off" but it did not appear to
> have any effect.
>
> It looks like this fix for the File Descriptors has broken something else.
>
> Thanks.
>
> Steven Oakley.
>
>
>
> --
> Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-- 
*****************************
* C++20 : Bug to the future *
*****************************


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180208/a6faa587/attachment.sig>

From soakley at expedia.com  Wed Feb  7 18:23:17 2018
From: soakley at expedia.com (steveno)
Date: Wed, 7 Feb 2018 11:23:17 -0700 (MST)
Subject: [squid-users] Default host_verify_strict behavior appears to
 have changed as of 3.5.25
In-Reply-To: <cd464158-b003-fd9f-b748-24d71e05debf@gmail.com>
References: <1518026624169-0.post@n4.nabble.com>
 <cd464158-b003-fd9f-b748-24d71e05debf@gmail.com>
Message-ID: <1518027797940-0.post@n4.nabble.com>

OK this may be irrelevant to the "host_verify_strict" setting, its just when
I looked at the messages like "2018/02/07 17:57:45 kid1| SECURITY ALERT: on
URL: sqs.us-west-2.amazonaws.com:443" in the cache.log it led me to believe
this was a feature of "RFC 2616 section 14.23" and that the default setting
of host_verify_strict off would log these errors and allow access to these
sites.

On 3.5.20 the access log appeared to have very few 409 status returns.

Since going to 3.5.25 and now 3.5.27 incase recent changes fixed the
behavior I was seeing there are many 409 status returned in the logs and
many more SSL issues talking to sites like AWS that use a number of IP
address's that might not be able to be verified.

It seems either I use 3.5.20 and restart squid when the FD's get close to
maximum or I have these SSL problems with client connections, what is needed
to try and investigate this further as it appears to have changed with the
bug fix 4508.

Thanks.

Steve.



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From tarotapprentice at yahoo.com  Wed Feb  7 19:44:41 2018
From: tarotapprentice at yahoo.com (TarotApprentice)
Date: Thu, 8 Feb 2018 06:44:41 +1100
Subject: [squid-users] 4.0.23 release in Debian
In-Reply-To: <vmime.5a7aeef9.2e2.4fa0f2cf4fa4f409@ms249-lin-003.rotterdam.bazuin.nl>
References: <vmime.5a7ad3ff.2d42.84391f9c24726f@ms249-lin-003.rotterdam.bazuin.nl>
 <vmime.5a7aeef9.2e2.4fa0f2cf4fa4f409@ms249-lin-003.rotterdam.bazuin.nl>
Message-ID: <0CAAA8A2-9EE3-4C21-99B3-93E28B863F85@yahoo.com>


889541. Amos asked me to raise one.

Also their .service file has an ExecPre line that does a squid -z command, meaning it always tries to create the cache_dir directories on every start action. I didn?t mention that on the bug.

MarkJ

> On 7 Feb 2018, at 11:20 pm, L.P.H. van Belle <belle at bazuin.nl> wrote:
> 
> Whats the bugnr? I'll have a look also. 
> 
> 
>> -----Oorspronkelijk bericht-----
>> Van: squid-users 
>> [mailto:squid-users-bounces at lists.squid-cache.org] Namens 
>> TarotApprentice
>> Verzonden: woensdag 7 februari 2018 12:45
>> Aan: squid-users at lists.squid-cache.org
>> Onderwerp: Re: [squid-users] 4.0.23 release in Debian
>> 
>> 
>> I?ve already raised a Debian bug regarding startup script 
>> issues with it. Maybe that will receive some attention.
>> 
>>> On 7 Feb 2018, at 9:25 pm, L.P.H. van Belle <belle at bazuin.nl> wrote:
>>> 
>>> Hi, 
>>> 
>>> If you want a squid 3.5.27 for debian stretch. (amd64 only builded) 
>>> Have a look here :  http://downloads.van-belle.nl/squid/
>>> The tar.gz contains, build log, sources used and debs.
>>> 
>>> My changelog.
>>> squid3 (3.5.27-0.1) stretch; urgency=medium
>>> 
>>> * Non-maintainer upload.
>>> * Builded from squid-cache.org sources.
>>> * base 3.5.23 from buster.
>>> * No changes.
>>> 
>>> The exact version is : 
>>> Squid Cache: Version 3.5.27-20171101-re69e56c
>>> 
>>> So nothing fancy, just the debian standards. If you want a 
>> bit newer. 
>>> Go here: http://www.squid-cache.org/Versions/v3/3.5
>>> And look if there is any intersting you want and add the 
>> patches or get a daily tar.gz.
>>> And replace the source.tar.gz. 
>>> 
>>> 
>>> Greetz, 
>>> 
>>> Louis
>>> 
>>> 
>>> 
>>>> -----Oorspronkelijk bericht-----
>>>> Van: squid-users 
>>>> [mailto:squid-users-bounces at lists.squid-cache.org] Namens Flashdown
>>>> Verzonden: woensdag 7 februari 2018 10:23
>>>> Aan: Eliezer Croitoru
>>>> CC: squid-users at lists.squid-cache.org
>>>> Onderwerp: Re: [squid-users] 4.0.23 release in Debian
>>>> 
>>>> FYI:
>>>> There is already progress on Squid 4.0.23 over here: 
>>>> https://packages.debian.org/source/experimental/squid
>>>> 
>>>> BTW: Hope I may get a response this time from anybody over 
>>>> there, then I 
>>>> would package 3.5.27..
>>>> 
>>>> Am 2018-02-05 10:21, schrieb Flashdown:
>>>>> Well, I've forwarded my old mail just now after subcribing to this
>>>>> list which I did sent directly to luigi and manty because I was
>>>>> unaware of these mailing lists. Thank you Amos!
>>>>> 
>>>>> Am 2018-02-05 04:00, schrieb Eliezer Croitoru:
>>>>>> It seems they are not even trying to block spam...
>>>>>> 
>>>>>> Eliezer
>>>>>> 
>>>>>> ----
>>>>>> Eliezer Croitoru
>>>>>> Linux System Administrator
>>>>>> Mobile: +972-5-28704261
>>>>>> Email: eliezer at ngtech.co.il
>>>>>> 
>>>>>> 
>>>>>> 
>>>>>> -----Original Message-----
>>>>>> From: squid-users 
>>>> [mailto:squid-users-bounces at lists.squid-cache.org]
>>>>>> On Behalf Of Amos Jeffries
>>>>>> Sent: Sunday, February 4, 2018 20:40
>>>>>> To: Enrico Heine <flashdown at data-core.org>; 
>>>>>> squid-users at lists.squid-cache.org
>>>>>> Subject: Re: [squid-users] 4.0.23 release in Debian
>>>>>> 
>>>>>>> On 05/02/18 00:06, Enrico Heine wrote:
>>>>>>> Already asked the responsible guys, if I can support them by 
>>>>>>> packaging
>>>>>>> squid for debian since this is what I already do for my 
>>>> company and
>>>>>>> there is no reason for not sharing it or building it in 
>>>> my spare time 
>>>>>>> at
>>>>>>> home. Unfortunately I never got an answer so I thought 
>>>> ok, I can't 
>>>>>>> force
>>>>>>> them to allow me to contribute something back. I would 
>>>> also have been
>>>>>>> gratefull for just becoming an uploader to experimental 
>> only. Saad
>>>>>>> story, I guess they are to busy to even listening for 
>>>> people trying 
>>>>>>> to help.
>>>>>>> 
>>>>>> 
>>>>>> Who did you contact? The Debian 'squid' and 'squid3' 
>> packages are 
>>>>>> being
>>>>>> maintained by a team these days. I have not seen any 
>>>> messages from you
>>>>>> going to that mailing list:
>>>>>> <https://alioth.debian.org/mail/?group_id=100852>
>>>>>> 
>>>>>> 
>>>>>> Amos
>>>>>> _______________________________________________
>>>>>> squid-users mailing list
>>>>>> squid-users at lists.squid-cache.org
>>>>>> http://lists.squid-cache.org/listinfo/squid-users
>>>>> _______________________________________________
>>>>> squid-users mailing list
>>>>> squid-users at lists.squid-cache.org
>>>>> http://lists.squid-cache.org/listinfo/squid-users
>>>> _______________________________________________
>>>> squid-users mailing list
>>>> squid-users at lists.squid-cache.org
>>>> http://lists.squid-cache.org/listinfo/squid-users
>>>> 
>>> 
>>> _______________________________________________
>>> squid-users mailing list
>>> squid-users at lists.squid-cache.org
>>> http://lists.squid-cache.org/listinfo/squid-users
>> 
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
>> 
> 



From setuid at gmail.com  Wed Feb  7 21:11:05 2018
From: setuid at gmail.com (setuid)
Date: Wed, 7 Feb 2018 16:11:05 -0500
Subject: [squid-users] Squid 3.x or 4.x acting as a transparent http proxy
	(NOT https)
Message-ID: <a6eea1d9-fec4-0e6e-9a33-bde8b9e9f8eb@gmail.com>

I'll start with the pointedly easy stuff: Squid > 2.6 (tested 3.4, 3.5,
4.0 on Ubuntu Xenial, Debian Jessie, FreeSBD 11.1 using iptables, pf,
ipf, ipfilter) does not work at all, when configured as a transparent
proxy. Full stop.

I went through hundreds of posts on dozens of forums, blogs and other
resources, tried dozens and dozens of configurations suggested by those
posts, tried all 3 firewall options on BSD, tried two versions of Ubuntu
and the various versions of Squid from the apt repos, as well as those
in BSD's ports.

All of them, 100%, fail in _exactly_ the same way, no matter what my
configuration was set to. That result, is that _every single http
request I make_ when Squid is configured as a transparent proxy, results
in the following response being logged:

======================
	07/Feb/2018:15:10:59 -0500.213      0 192.168.1.1 TAG_NONE/400 3583 GET
/ - HIER_NONE/- text/html ("-" "-")
======================

When I point a client directly at the proxy, using a browser, curl or
anything else, I see:

======================
	07/Feb/2018:15:12:56 -0500.875     82 192.168.1.1 TCP_MISS/302 333 HEAD
http://www.java.com/ - HIER_DIRECT/www.java.com - ("-" "curl/7.47.0")
======================

These were the same exact request against the same exact Squid instance.
If I use Squid 3.5 on Ubuntu or 3.5 and 4.0 on BSD, the logged entry is
_identical_ for every single http request I make, regardless of origin.

My Squid configuration is 100% default, identical to the generic config,
with the exception of the following lines:

======================
http_port 3128
http_port 3129 intercept
tcp_outgoing_address 192.168.1.25
debug_options ALL,9
======================

I've tried all of the obvious links, blogs and resources I could Google
up, and 100% of them fail to function as described. Most people I've
seen on the forums who attempt to get this working, throw their hands up
in defeat and end up configuring the proxy directly on every client that
needs it.

My current environment looks like this:

[ wireless router: 10.0.1.1 on LAN side, 192.168.1.1 on WAN side ]

That router has a firewall script on it that says:

======================
#!/bin/sh
PROXY_IP=192.168.2.25
PROXY_PORT=3128
LAN_IP=$(nvram get lan_ipaddr)
LAN_NET=$LAN_IP/$(nvram get lan_netmask)

iptables -t nat -A PREROUTING -i br0 -s $LAN_NET -d $LAN_NET -p tcp
--dport 80 -j ACCEPT
iptables -t nat -A PREROUTING -i br0 -s ! $PROXY_IP -p tcp --dport 80 -j
DNAT --to $PROXY_IP:$PROXY_PORT

iptables -t nat -I POSTROUTING -o br0 -s $LAN_NET -d $PROXY_IP -p tcp -j
SNAT --to $LAN_IP
iptables -I FORWARD -i br0 -o br0 -s $LAN_NET -d $PROXY_IP -p tcp
--dport $PROXY_PORT -j ACCEPT
======================

This takes every packet that hits the router on :80, and sends it to my
Squid server on .25, which mangles it and sends it back to 192.168.1.1
(router), and onward back to client who requested it.

When I was using 2.6 (without large_file support), I was using this same
exact configuration, but http_port was set to 'accel', and I didn't need
_any_ NAT/routing rules on the squid side at all. It all "Just Worked(tm)".

Now I need to jump through hoops to do pf incantations of rdr/direct-to
(but direct-to and direct-reply aren't supported on FreeBSD's pf, only
OpenBSD's pf supports that syntax), and iptables PREROUTING and
POSTROUTING mojo (also fails).

Here's a list of some of the resources I've tried, with 100% failure in
every case. There are dozens more that I've lost in my browser history now.

* https://wiki.squid-cache.org/ConfigExamples/Intercept/Ipfw
*
https://wiki.squid-cache.org/SquidFaq/InterceptionProxy#Interception_Caching_packet_redirection_for_OpenBSD_PF
* https://www.benzedrine.ch/transquid.html
*
https://www.unix-experience.fr/2013/create-a-powerfull-proxy-cache-with-squid-and-openbsd-2/
*
https://www.cyberciti.biz/tips/linux-setup-transparent-proxy-squid-howto.html
*
https://adilmehmoodbutt.wordpress.com/2014/02/19/how-to-install-squid3-transparent-proxy-server/
* https://veesp.com/en/blog/how-to-setup-squid-on-ubuntu
* https://ubuntuforums.org/showthread.php?t=2210987
*
http://ubuntuserverguide.com/2012/06/how-to-setup-squid3-as-transparent-proxy-on-ubuntu-server-12-04.html
*
http://roberts.bplaced.net/index.php/linux-guides/centos-6-guides/proxy-server/squid-transparent-proxy-http-https

I also tried asking in #squid on Freenode (dead channel), and #FreeBSD
(helpful folks there, but they too, failed to get this working).

So I'm at an impasse. Is this just 100% decoupled from the current
codebase, and doesn't work at all? Or is this really meant to be some
lengthy archaeology to find the right, working solution for getting this
configured in Linux or BSD?

It seems like with the hundreds of posts from people out there failing
to do this correctly, that there's a great opportunity here to a.) make
it work again like it did in v2.6, and b.) document the _precise steps_
required to make it function as a transparent http proxy [eg: install
foo, create file with these exact contents, execute this exact command,
test with this use case, if error message 'bar', do the following ].

Can anyone give me a hand here? I, like so many dozens of others, am
about to just give up and move past this, because it just does not work
anymore.

Help! :D

(Thanks in advance for making it this far in my plea)



From setuid at gmail.com  Wed Feb  7 21:27:30 2018
From: setuid at gmail.com (setuid)
Date: Wed, 7 Feb 2018 16:27:30 -0500
Subject: [squid-users] Squid 3.x or 4.x acting as a transparent http
 proxy (NOT https)
In-Reply-To: <a6eea1d9-fec4-0e6e-9a33-bde8b9e9f8eb@gmail.com>
References: <a6eea1d9-fec4-0e6e-9a33-bde8b9e9f8eb@gmail.com>
Message-ID: <bae5d69d-bd20-0561-c5d7-ad01d50b704d@gmail.com>

On 02/07/2018 04:11 PM, setuid wrote:
> That router has a firewall script on it that says:
> ======================
> #!/bin/sh
> PROXY_IP=192.168.2.25

Yes, this is a typo here in email but is correct in the router's
firewall script.

This should be either 192.168.2.20 or 192.168.1.25; both are Squid
caches inside my LAN on Ubuntu and BSD respectively.

Here's an example of my ipfw rules, for comparison:

======================
$cmd 00700 deny ip from any to any dst-port 3128 via em0
$cmd 00800 fwd 127.0.0.1,3128 tcp from 192.168.1.0/24 to any dst-port 80
via em0
$cmd 00810 fwd 127.0.0.1,3128 ip from any to any dst-port 21 src-ip
192.168.1.0/24
$cmd 00820 allow ip from any to any dst-port 3128 dst-ip 192.168.1.1
src-ip 192.168.1.0/24
======================



From yvoinov at gmail.com  Wed Feb  7 21:31:10 2018
From: yvoinov at gmail.com (Yuri)
Date: Thu, 8 Feb 2018 03:31:10 +0600
Subject: [squid-users] Squid 3.x or 4.x acting as a transparent http
 proxy (NOT https)
In-Reply-To: <a6eea1d9-fec4-0e6e-9a33-bde8b9e9f8eb@gmail.com>
References: <a6eea1d9-fec4-0e6e-9a33-bde8b9e9f8eb@gmail.com>
Message-ID: <bf4ba597-ec37-6f72-d9f7-df15b4855039@gmail.com>

One stupid idiotic question.

Did you build your squid with transparent NAT support?

This is mandatory prerequisite for transparent squid.

I'm not seen your configuration options for squid. Not squid.conf. Just
./configure options.


08.02.2018 03:11, setuid ?????:
> I'll start with the pointedly easy stuff: Squid > 2.6 (tested 3.4, 3.5,
> 4.0 on Ubuntu Xenial, Debian Jessie, FreeSBD 11.1 using iptables, pf,
> ipf, ipfilter) does not work at all, when configured as a transparent
> proxy. Full stop.
>
> I went through hundreds of posts on dozens of forums, blogs and other
> resources, tried dozens and dozens of configurations suggested by those
> posts, tried all 3 firewall options on BSD, tried two versions of Ubuntu
> and the various versions of Squid from the apt repos, as well as those
> in BSD's ports.
>
> All of them, 100%, fail in _exactly_ the same way, no matter what my
> configuration was set to. That result, is that _every single http
> request I make_ when Squid is configured as a transparent proxy, results
> in the following response being logged:
>
> ======================
> 	07/Feb/2018:15:10:59 -0500.213      0 192.168.1.1 TAG_NONE/400 3583 GET
> / - HIER_NONE/- text/html ("-" "-")
> ======================
>
> When I point a client directly at the proxy, using a browser, curl or
> anything else, I see:
>
> ======================
> 	07/Feb/2018:15:12:56 -0500.875     82 192.168.1.1 TCP_MISS/302 333 HEAD
> http://www.java.com/ - HIER_DIRECT/www.java.com - ("-" "curl/7.47.0")
> ======================
>
> These were the same exact request against the same exact Squid instance.
> If I use Squid 3.5 on Ubuntu or 3.5 and 4.0 on BSD, the logged entry is
> _identical_ for every single http request I make, regardless of origin.
>
> My Squid configuration is 100% default, identical to the generic config,
> with the exception of the following lines:
>
> ======================
> http_port 3128
> http_port 3129 intercept
> tcp_outgoing_address 192.168.1.25
> debug_options ALL,9
> ======================
>
> I've tried all of the obvious links, blogs and resources I could Google
> up, and 100% of them fail to function as described. Most people I've
> seen on the forums who attempt to get this working, throw their hands up
> in defeat and end up configuring the proxy directly on every client that
> needs it.
>
> My current environment looks like this:
>
> [ wireless router: 10.0.1.1 on LAN side, 192.168.1.1 on WAN side ]
>
> That router has a firewall script on it that says:
>
> ======================
> #!/bin/sh
> PROXY_IP=192.168.2.25
> PROXY_PORT=3128
> LAN_IP=$(nvram get lan_ipaddr)
> LAN_NET=$LAN_IP/$(nvram get lan_netmask)
>
> iptables -t nat -A PREROUTING -i br0 -s $LAN_NET -d $LAN_NET -p tcp
> --dport 80 -j ACCEPT
> iptables -t nat -A PREROUTING -i br0 -s ! $PROXY_IP -p tcp --dport 80 -j
> DNAT --to $PROXY_IP:$PROXY_PORT
>
> iptables -t nat -I POSTROUTING -o br0 -s $LAN_NET -d $PROXY_IP -p tcp -j
> SNAT --to $LAN_IP
> iptables -I FORWARD -i br0 -o br0 -s $LAN_NET -d $PROXY_IP -p tcp
> --dport $PROXY_PORT -j ACCEPT
> ======================
>
> This takes every packet that hits the router on :80, and sends it to my
> Squid server on .25, which mangles it and sends it back to 192.168.1.1
> (router), and onward back to client who requested it.
>
> When I was using 2.6 (without large_file support), I was using this same
> exact configuration, but http_port was set to 'accel', and I didn't need
> _any_ NAT/routing rules on the squid side at all. It all "Just Worked(tm)".
>
> Now I need to jump through hoops to do pf incantations of rdr/direct-to
> (but direct-to and direct-reply aren't supported on FreeBSD's pf, only
> OpenBSD's pf supports that syntax), and iptables PREROUTING and
> POSTROUTING mojo (also fails).
>
> Here's a list of some of the resources I've tried, with 100% failure in
> every case. There are dozens more that I've lost in my browser history now.
>
> * https://wiki.squid-cache.org/ConfigExamples/Intercept/Ipfw
> *
> https://wiki.squid-cache.org/SquidFaq/InterceptionProxy#Interception_Caching_packet_redirection_for_OpenBSD_PF
> * https://www.benzedrine.ch/transquid.html
> *
> https://www.unix-experience.fr/2013/create-a-powerfull-proxy-cache-with-squid-and-openbsd-2/
> *
> https://www.cyberciti.biz/tips/linux-setup-transparent-proxy-squid-howto.html
> *
> https://adilmehmoodbutt.wordpress.com/2014/02/19/how-to-install-squid3-transparent-proxy-server/
> * https://veesp.com/en/blog/how-to-setup-squid-on-ubuntu
> * https://ubuntuforums.org/showthread.php?t=2210987
> *
> http://ubuntuserverguide.com/2012/06/how-to-setup-squid3-as-transparent-proxy-on-ubuntu-server-12-04.html
> *
> http://roberts.bplaced.net/index.php/linux-guides/centos-6-guides/proxy-server/squid-transparent-proxy-http-https
>
> I also tried asking in #squid on Freenode (dead channel), and #FreeBSD
> (helpful folks there, but they too, failed to get this working).
>
> So I'm at an impasse. Is this just 100% decoupled from the current
> codebase, and doesn't work at all? Or is this really meant to be some
> lengthy archaeology to find the right, working solution for getting this
> configured in Linux or BSD?
>
> It seems like with the hundreds of posts from people out there failing
> to do this correctly, that there's a great opportunity here to a.) make
> it work again like it did in v2.6, and b.) document the _precise steps_
> required to make it function as a transparent http proxy [eg: install
> foo, create file with these exact contents, execute this exact command,
> test with this use case, if error message 'bar', do the following ].
>
> Can anyone give me a hand here? I, like so many dozens of others, am
> about to just give up and move past this, because it just does not work
> anymore.
>
> Help! :D
>
> (Thanks in advance for making it this far in my plea)
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-- 
*****************************
* C++20 : Bug to the future *
*****************************


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180208/2c3ce30d/attachment.sig>

From rafael.akchurin at diladele.com  Wed Feb  7 21:38:17 2018
From: rafael.akchurin at diladele.com (Rafael Akchurin)
Date: Wed, 7 Feb 2018 21:38:17 +0000
Subject: [squid-users] Squid 3.x or 4.x acting as a transparent http
	proxy	(NOT https)
In-Reply-To: <a6eea1d9-fec4-0e6e-9a33-bde8b9e9f8eb@gmail.com>
References: <a6eea1d9-fec4-0e6e-9a33-bde8b9e9f8eb@gmail.com>
Message-ID: <AM4PR0401MB2194D203581848E7EAF9F3ED8FFC0@AM4PR0401MB2194.eurprd04.prod.outlook.com>

Hello setuid,

If you do not mind looking at other tutorials - these are what we have in the test lab.

https://docs.diladele.com/tutorials/transparent_proxy_ubuntu/index.html
https://docs.diladele.com/tutorials/policy_based_routing_squid/index.html

First one for Squid running on the gateway and the second one for separate Squid that intercepts  traffic re-routed from the router using Policy-Based-Routing.
The tutorials are working, I test it with every release of our ICAP web filter.

Best regards,
Rafael Akchurin
Diladele B.V.



-----Original Message-----
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of setuid
Sent: Wednesday, February 7, 2018 10:11 PM
To: squid-users at lists.squid-cache.org
Subject: [squid-users] Squid 3.x or 4.x acting as a transparent http proxy (NOT https)

I'll start with the pointedly easy stuff: Squid > 2.6 (tested 3.4, 3.5,
4.0 on Ubuntu Xenial, Debian Jessie, FreeSBD 11.1 using iptables, pf, ipf, ipfilter) does not work at all, when configured as a transparent proxy. Full stop.

I went through hundreds of posts on dozens of forums, blogs and other resources, tried dozens and dozens of configurations suggested by those posts, tried all 3 firewall options on BSD, tried two versions of Ubuntu and the various versions of Squid from the apt repos, as well as those in BSD's ports.

All of them, 100%, fail in _exactly_ the same way, no matter what my configuration was set to. That result, is that _every single http request I make_ when Squid is configured as a transparent proxy, results in the following response being logged:

======================
	07/Feb/2018:15:10:59 -0500.213      0 192.168.1.1 TAG_NONE/400 3583 GET
/ - HIER_NONE/- text/html ("-" "-")
======================

When I point a client directly at the proxy, using a browser, curl or anything else, I see:

======================
	07/Feb/2018:15:12:56 -0500.875     82 192.168.1.1 TCP_MISS/302 333 HEAD
http://www.java.com/ - HIER_DIRECT/www.java.com - ("-" "curl/7.47.0") ======================

These were the same exact request against the same exact Squid instance.
If I use Squid 3.5 on Ubuntu or 3.5 and 4.0 on BSD, the logged entry is _identical_ for every single http request I make, regardless of origin.

My Squid configuration is 100% default, identical to the generic config, with the exception of the following lines:

======================
http_port 3128
http_port 3129 intercept
tcp_outgoing_address 192.168.1.25
debug_options ALL,9
======================

I've tried all of the obvious links, blogs and resources I could Google up, and 100% of them fail to function as described. Most people I've seen on the forums who attempt to get this working, throw their hands up in defeat and end up configuring the proxy directly on every client that needs it.

My current environment looks like this:

[ wireless router: 10.0.1.1 on LAN side, 192.168.1.1 on WAN side ]

That router has a firewall script on it that says:

======================
#!/bin/sh
PROXY_IP=192.168.2.25
PROXY_PORT=3128
LAN_IP=$(nvram get lan_ipaddr)
LAN_NET=$LAN_IP/$(nvram get lan_netmask)

iptables -t nat -A PREROUTING -i br0 -s $LAN_NET -d $LAN_NET -p tcp --dport 80 -j ACCEPT iptables -t nat -A PREROUTING -i br0 -s ! $PROXY_IP -p tcp --dport 80 -j DNAT --to $PROXY_IP:$PROXY_PORT

iptables -t nat -I POSTROUTING -o br0 -s $LAN_NET -d $PROXY_IP -p tcp -j SNAT --to $LAN_IP iptables -I FORWARD -i br0 -o br0 -s $LAN_NET -d $PROXY_IP -p tcp --dport $PROXY_PORT -j ACCEPT ======================

This takes every packet that hits the router on :80, and sends it to my Squid server on .25, which mangles it and sends it back to 192.168.1.1 (router), and onward back to client who requested it.

When I was using 2.6 (without large_file support), I was using this same exact configuration, but http_port was set to 'accel', and I didn't need _any_ NAT/routing rules on the squid side at all. It all "Just Worked(tm)".

Now I need to jump through hoops to do pf incantations of rdr/direct-to (but direct-to and direct-reply aren't supported on FreeBSD's pf, only OpenBSD's pf supports that syntax), and iptables PREROUTING and POSTROUTING mojo (also fails).

Here's a list of some of the resources I've tried, with 100% failure in every case. There are dozens more that I've lost in my browser history now.

* https://wiki.squid-cache.org/ConfigExamples/Intercept/Ipfw
*
https://wiki.squid-cache.org/SquidFaq/InterceptionProxy#Interception_Caching_packet_redirection_for_OpenBSD_PF
* https://www.benzedrine.ch/transquid.html
*
https://www.unix-experience.fr/2013/create-a-powerfull-proxy-cache-with-squid-and-openbsd-2/
*
https://www.cyberciti.biz/tips/linux-setup-transparent-proxy-squid-howto.html
*
https://adilmehmoodbutt.wordpress.com/2014/02/19/how-to-install-squid3-transparent-proxy-server/
* https://veesp.com/en/blog/how-to-setup-squid-on-ubuntu
* https://ubuntuforums.org/showthread.php?t=2210987
*
http://ubuntuserverguide.com/2012/06/how-to-setup-squid3-as-transparent-proxy-on-ubuntu-server-12-04.html
*
http://roberts.bplaced.net/index.php/linux-guides/centos-6-guides/proxy-server/squid-transparent-proxy-http-https

I also tried asking in #squid on Freenode (dead channel), and #FreeBSD (helpful folks there, but they too, failed to get this working).

So I'm at an impasse. Is this just 100% decoupled from the current codebase, and doesn't work at all? Or is this really meant to be some lengthy archaeology to find the right, working solution for getting this configured in Linux or BSD?

It seems like with the hundreds of posts from people out there failing to do this correctly, that there's a great opportunity here to a.) make it work again like it did in v2.6, and b.) document the _precise steps_ required to make it function as a transparent http proxy [eg: install foo, create file with these exact contents, execute this exact command, test with this use case, if error message 'bar', do the following ].

Can anyone give me a hand here? I, like so many dozens of others, am about to just give up and move past this, because it just does not work anymore.

Help! :D

(Thanks in advance for making it this far in my plea)

_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users

From setuid at gmail.com  Wed Feb  7 21:45:29 2018
From: setuid at gmail.com (setuid)
Date: Wed, 7 Feb 2018 16:45:29 -0500
Subject: [squid-users] Squid 3.x or 4.x acting as a transparent http
 proxy (NOT https)
In-Reply-To: <AM4PR0401MB2194D203581848E7EAF9F3ED8FFC0@AM4PR0401MB2194.eurprd04.prod.outlook.com>
References: <a6eea1d9-fec4-0e6e-9a33-bde8b9e9f8eb@gmail.com>
 <AM4PR0401MB2194D203581848E7EAF9F3ED8FFC0@AM4PR0401MB2194.eurprd04.prod.outlook.com>
Message-ID: <44c15046-3748-655c-d1c9-8581c538d1fe@gmail.com>

On 02/07/2018 04:38 PM, Rafael Akchurin wrote:
> If you do not mind looking at other tutorials - these are what we have
in the test lab.

> https://docs.diladele.com/tutorials/transparent_proxy_ubuntu/index.html
> https://docs.diladele.com/tutorials/policy_based_routing_squid/index.html

Thanks for the quick reply. Do you have a version of these that is
BSD-specific?

I'm ultimately going to run Squid exclusively on BSD, although was using
Linux as a means to validate that the functionality to do transparent
proxying was broken (confirmed in both OS').

I'll give these a go tonight on Ubuntu and see where I get.

I do see the Apache/Web Safety hooks as "interesting", but they should
be decoupled as they're not required to get this working (and are likely
prohibited in many-to-most enterprises who would deploy a proxy in this
fashion).




From rafael.akchurin at diladele.com  Wed Feb  7 21:59:12 2018
From: rafael.akchurin at diladele.com (Rafael Akchurin)
Date: Wed, 7 Feb 2018 21:59:12 +0000
Subject: [squid-users] Squid 3.x or 4.x acting as a transparent http
 proxy (NOT https)
In-Reply-To: <44c15046-3748-655c-d1c9-8581c538d1fe@gmail.com>
References: <a6eea1d9-fec4-0e6e-9a33-bde8b9e9f8eb@gmail.com>
 <AM4PR0401MB2194D203581848E7EAF9F3ED8FFC0@AM4PR0401MB2194.eurprd04.prod.outlook.com>
 <44c15046-3748-655c-d1c9-8581c538d1fe@gmail.com>
Message-ID: <AM4PR0401MB219472E4C417BFB6E78D59058FFC0@AM4PR0401MB2194.eurprd04.prod.outlook.com>

No unfortunately nothing like this is in our lab for FreeBSD - but default Squid package in pfSense runs transparently without issues I have heard (or with other issues than you have).

Best regards,
Rafael Akchurin
Diladele B.V.

-----Original Message-----
From: setuid [mailto:setuid at gmail.com] 
Sent: Wednesday, February 7, 2018 10:45 PM
To: Rafael Akchurin <rafael.akchurin at diladele.com>; squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Squid 3.x or 4.x acting as a transparent http proxy (NOT https)

On 02/07/2018 04:38 PM, Rafael Akchurin wrote:
> If you do not mind looking at other tutorials - these are what we have
in the test lab.

> https://docs.diladele.com/tutorials/transparent_proxy_ubuntu/index.htm
> l 
> https://docs.diladele.com/tutorials/policy_based_routing_squid/index.h
> tml

Thanks for the quick reply. Do you have a version of these that is BSD-specific?

I'm ultimately going to run Squid exclusively on BSD, although was using Linux as a means to validate that the functionality to do transparent proxying was broken (confirmed in both OS').

I'll give these a go tonight on Ubuntu and see where I get.

I do see the Apache/Web Safety hooks as "interesting", but they should be decoupled as they're not required to get this working (and are likely prohibited in many-to-most enterprises who would deploy a proxy in this fashion).



From setuid at gmail.com  Wed Feb  7 22:30:54 2018
From: setuid at gmail.com (setuid)
Date: Wed, 7 Feb 2018 17:30:54 -0500
Subject: [squid-users] Squid 3.x or 4.x acting as a transparent http
 proxy (NOT https)
In-Reply-To: <AM4PR0401MB2194D203581848E7EAF9F3ED8FFC0@AM4PR0401MB2194.eurprd04.prod.outlook.com>
References: <a6eea1d9-fec4-0e6e-9a33-bde8b9e9f8eb@gmail.com>
 <AM4PR0401MB2194D203581848E7EAF9F3ED8FFC0@AM4PR0401MB2194.eurprd04.prod.outlook.com>
Message-ID: <e6fcd409-d9c7-3282-d073-09ba4eec373a@gmail.com>

On 02/07/2018 04:38 PM, Rafael Akchurin wrote:
> If you do not mind looking at other tutorials - these are what we have in the test lab.

> https://docs.diladele.com/tutorials/transparent_proxy_ubuntu/index.html

I can confirm that the instructions in this tutorial results in the same
exact failure scenario as all previous attempts and tests (once I
removed the unnecessary Apache/Web Safety bits).

Firewall rules are:

-A INPUT -i eth0 -p tcp -m tcp --dport 3126 -c 0 0 -j ACCEPT
-A FORWARD -m conntrack --ctstate RELATED,ESTABLISHED -c 0 0 -j ACCEPT
-A FORWARD -i eth1 -o eth0 -c 0 0 -j ACCEPT

Squid config is generic, with the exception of:

http_port 3126 intercept

There is a single interface on the host, which resides on the LAN _and_
is Internet-facing (eth0).

The result is that I get the same as before:

==> /var/log/squid3/access.log <==
1518042565.613      0 192.168.1.1 TAG_NONE/400 3583 GET / - HIER_NONE/-
text/html

If I point the client (curl, browser, perl + LWP) at the proxy directly
on 3128, it works as expected.

I am firmly convinved that _transparent_ proxying with squid, is 100%
non-functional. The proxy works fine, but transparent proxying is
demonstrably broken in anything later than 3.x.



From rafael.akchurin at diladele.com  Wed Feb  7 22:37:29 2018
From: rafael.akchurin at diladele.com (Rafael Akchurin)
Date: Wed, 7 Feb 2018 22:37:29 +0000
Subject: [squid-users] Squid 3.x or 4.x acting as a transparent http
 proxy (NOT https)
In-Reply-To: <e6fcd409-d9c7-3282-d073-09ba4eec373a@gmail.com>
References: <a6eea1d9-fec4-0e6e-9a33-bde8b9e9f8eb@gmail.com>
 <AM4PR0401MB2194D203581848E7EAF9F3ED8FFC0@AM4PR0401MB2194.eurprd04.prod.outlook.com>,
 <e6fcd409-d9c7-3282-d073-09ba4eec373a@gmail.com>
Message-ID: <0E20AF5A-F64A-4FD8-B0A8-63C4927149DA@diladele.com>

Thats strange. 
How is your network configured? Your rules indicate you have 2 nics but you later say you have one..

Best regards,
Rafael Akchurin

> Op 7 feb. 2018 om 23:31 heeft setuid <setuid at gmail.com> het volgende geschreven:
> 
>> On 02/07/2018 04:38 PM, Rafael Akchurin wrote:
>> If you do not mind looking at other tutorials - these are what we have in the test lab.
> 
>> https://docs.diladele.com/tutorials/transparent_proxy_ubuntu/index.html
> 
> I can confirm that the instructions in this tutorial results in the same
> exact failure scenario as all previous attempts and tests (once I
> removed the unnecessary Apache/Web Safety bits).
> 
> Firewall rules are:
> 
> -A INPUT -i eth0 -p tcp -m tcp --dport 3126 -c 0 0 -j ACCEPT
> -A FORWARD -m conntrack --ctstate RELATED,ESTABLISHED -c 0 0 -j ACCEPT
> -A FORWARD -i eth1 -o eth0 -c 0 0 -j ACCEPT
> 
> Squid config is generic, with the exception of:
> 
> http_port 3126 intercept
> 
> There is a single interface on the host, which resides on the LAN _and_
> is Internet-facing (eth0).
> 
> The result is that I get the same as before:
> 
> ==> /var/log/squid3/access.log <==
> 1518042565.613      0 192.168.1.1 TAG_NONE/400 3583 GET / - HIER_NONE/-
> text/html
> 
> If I point the client (curl, browser, perl + LWP) at the proxy directly
> on 3128, it works as expected.
> 
> I am firmly convinved that _transparent_ proxying with squid, is 100%
> non-functional. The proxy works fine, but transparent proxying is
> demonstrably broken in anything later than 3.x.
> 


From setuid at gmail.com  Wed Feb  7 23:14:10 2018
From: setuid at gmail.com (setuid)
Date: Wed, 7 Feb 2018 18:14:10 -0500
Subject: [squid-users] Squid 3.x or 4.x acting as a transparent http
 proxy (NOT https)
In-Reply-To: <bf4ba597-ec37-6f72-d9f7-df15b4855039@gmail.com>
References: <a6eea1d9-fec4-0e6e-9a33-bde8b9e9f8eb@gmail.com>
 <bf4ba597-ec37-6f72-d9f7-df15b4855039@gmail.com>
Message-ID: <d8c50428-cf28-f7fe-5067-7c5e3b83a785@gmail.com>

On 2/7/18 4:31 PM, Yuri wrote:
> I'm not seen your configuration options for squid. Not squid.conf. Just
> ./configure options.

Here's what I'm building with (from 'make config' in ports tree)

'--bindir=/usr/local/sbin'
'--build=amd64-portbld-freebsd11.1'
'--datadir=/usr/local/etc/squid'
'--disable-arch-native'
'--disable-ecap'
'--disable-epoll'
'--disable-esi'
'--disable-ipf-transparent'
'--disable-ipv6'
'--disable-linux-netfilter'
'--disable-linux-tproxy'
'--disable-pf-transparent'
'--disable-silent-rules'
'--disable-snmp'
'--disable-ssl'
'--disable-ssl-crtd'
'--disable-stacktraces'
'--disable-translation'
'--enable-auth'
'--enable-auth-basic=DB
'--enable-auth-digest=file'
'--enable-auth-negotiate=none'
'--enable-auth-ntlm=fake
'--enable-build-info'
'--enable-cache-digests'
'--enable-delay-pools'
'--enable-disk-io=DiskThreads
'--enable-eui'
'--enable-external-acl-helpers=file_userip
'--enable-follow-x-forwarded-for'
'--enable-forw-via-db'
'--enable-htcp'
'--enable-http-violations'
'--enable-icap-client'
'--enable-icmp'
'--enable-ident-lookups'
'--enable-ipfw-transparent'
'--enable-kqueue'
'--enable-loadable-modules'
'--enable-log-daemon-helpers=file'
'--enable-removal-policies=lru
'--enable-security-cert-validators=fake'
'--enable-storeid-rewrite-helpers=file'
'--enable-storeio=aufs
'--enable-url-rewrite-helpers=fake'
'--enable-wccp'
'--enable-wccpv2'
'--enable-zph-qos'
'--infodir=/usr/local/info/'
'--libexecdir=/usr/local/libexec/squid'
'--localstatedir=/var'
'--mandir=/usr/local/man'
'--prefix=/usr/local'
'--sbindir=/usr/local/sbin'
'--sysconfdir=/usr/local/etc/squid'
'--with-default-user=squid'
'--with-large-files'
'--with-logdir=/var/log/squid'
'--with-pidfile=/var/run/squid/squid.pid'
'--with-swapdir=/var/squid/cache'
'--without-gnutls'
'--without-gss'
'--without-heimdal-krb5'
'--without-mit-krb5'
'--without-nat-devpf'
'--without-nettle'


From setuid at gmail.com  Wed Feb  7 23:25:09 2018
From: setuid at gmail.com (setuid)
Date: Wed, 7 Feb 2018 18:25:09 -0500
Subject: [squid-users] Squid 3.x or 4.x acting as a transparent http
 proxy (NOT https)
In-Reply-To: <0E20AF5A-F64A-4FD8-B0A8-63C4927149DA@diladele.com>
References: <a6eea1d9-fec4-0e6e-9a33-bde8b9e9f8eb@gmail.com>
 <AM4PR0401MB2194D203581848E7EAF9F3ED8FFC0@AM4PR0401MB2194.eurprd04.prod.outlook.com>
 <e6fcd409-d9c7-3282-d073-09ba4eec373a@gmail.com>
 <0E20AF5A-F64A-4FD8-B0A8-63C4927149DA@diladele.com>
Message-ID: <2cd585fa-f50f-979b-a450-6e83fb1cc1ca@gmail.com>

On 2/7/18 5:37 PM, Rafael Akchurin wrote:
> How is your network configured? Your rules indicate you have 2 nics but you later say you have one..

Originally, I started with 1 NIC (it's a VM), and added 2 more, because
I read that pf/ipfw can't rewrite ingress packets on the same interface
it used for egress, but I haven't tried creating a bridge and routes to
attempt to make that work yet.

The Ubuntu machine has 2 NICs; primary NIC is WAN facing (internet
routable IP bound to eth0) and the secondary NIC sits on the "backup"
network (LAN-side) on 192.168.2.x.

Let's break it down:

[WAN router]
  |-- LAN: 192.168.1.1 (wired LAN)
  `-- WWAN: 10.0.1.1 (wireless clients)

BSD VM: 192.168.1.25

Ubuntu VM:
  |-- INET: 32.215.x.x
  `-- LAN: 192.168.2.x

The WAN router is what sends traffic sent over it on :80, over to .1.25
(BSD) to cache.

Previously, I had it pointed to Squid 2.6 sitting on my NAS
(192.168.1.20) and that would work perfectly as a transparent proxy.

When I pointed the WAN router to .25 instead of .20, and upgraded the
version of Squid by using BSD's version from ports on .25, this process
all fell apart.

So... is having 3 NICs (1 NIC + 2 bridged together as bridge0) *now* a
requirement to get transparent proxying working with anything using
Squid 3.x or later?

Can this be done with a single NIC sitting on an Internet-facing LAN
segment?

If so, how?


From yvoinov at gmail.com  Wed Feb  7 23:36:10 2018
From: yvoinov at gmail.com (Yuri)
Date: Thu, 8 Feb 2018 05:36:10 +0600
Subject: [squid-users] Squid 3.x or 4.x acting as a transparent http
 proxy (NOT https)
In-Reply-To: <d8c50428-cf28-f7fe-5067-7c5e3b83a785@gmail.com>
References: <a6eea1d9-fec4-0e6e-9a33-bde8b9e9f8eb@gmail.com>
 <bf4ba597-ec37-6f72-d9f7-df15b4855039@gmail.com>
 <d8c50428-cf28-f7fe-5067-7c5e3b83a785@gmail.com>
Message-ID: <eb00e23f-bf91-3fea-6692-78b149f24899@gmail.com>

If you configured squid with

'--enable-ipfw-transparent'

you should use manual for ipfw configuration.

Did you used ipfw NAT configuration on same box with squid?

08.02.2018 05:14, setuid ?????:
> On 2/7/18 4:31 PM, Yuri wrote:
>> I'm not seen your configuration options for squid. Not squid.conf. Just
>> ./configure options.
> Here's what I'm building with (from 'make config' in ports tree)
>
> '--bindir=/usr/local/sbin'
> '--build=amd64-portbld-freebsd11.1'
> '--datadir=/usr/local/etc/squid'
> '--disable-arch-native'
> '--disable-ecap'
> '--disable-epoll'
> '--disable-esi'
> '--disable-ipf-transparent'
> '--disable-ipv6'
> '--disable-linux-netfilter'
> '--disable-linux-tproxy'
> '--disable-pf-transparent'
> '--disable-silent-rules'
> '--disable-snmp'
> '--disable-ssl'
> '--disable-ssl-crtd'
> '--disable-stacktraces'
> '--disable-translation'
> '--enable-auth'
> '--enable-auth-basic=DB
> '--enable-auth-digest=file'
> '--enable-auth-negotiate=none'
> '--enable-auth-ntlm=fake
> '--enable-build-info'
> '--enable-cache-digests'
> '--enable-delay-pools'
> '--enable-disk-io=DiskThreads
> '--enable-eui'
> '--enable-external-acl-helpers=file_userip
> '--enable-follow-x-forwarded-for'
> '--enable-forw-via-db'
> '--enable-htcp'
> '--enable-http-violations'
> '--enable-icap-client'
> '--enable-icmp'
> '--enable-ident-lookups'
> '--enable-ipfw-transparent'
> '--enable-kqueue'
> '--enable-loadable-modules'
> '--enable-log-daemon-helpers=file'
> '--enable-removal-policies=lru
> '--enable-security-cert-validators=fake'
> '--enable-storeid-rewrite-helpers=file'
> '--enable-storeio=aufs
> '--enable-url-rewrite-helpers=fake'
> '--enable-wccp'
> '--enable-wccpv2'
> '--enable-zph-qos'
> '--infodir=/usr/local/info/'
> '--libexecdir=/usr/local/libexec/squid'
> '--localstatedir=/var'
> '--mandir=/usr/local/man'
> '--prefix=/usr/local'
> '--sbindir=/usr/local/sbin'
> '--sysconfdir=/usr/local/etc/squid'
> '--with-default-user=squid'
> '--with-large-files'
> '--with-logdir=/var/log/squid'
> '--with-pidfile=/var/run/squid/squid.pid'
> '--with-swapdir=/var/squid/cache'
> '--without-gnutls'
> '--without-gss'
> '--without-heimdal-krb5'
> '--without-mit-krb5'
> '--without-nat-devpf'
> '--without-nettle'

-- 
*****************************
* C++20 : Bug to the future *
*****************************


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180208/cc787a16/attachment.sig>

From yvoinov at gmail.com  Wed Feb  7 23:41:09 2018
From: yvoinov at gmail.com (Yuri)
Date: Thu, 8 Feb 2018 05:41:09 +0600
Subject: [squid-users] Squid 3.x or 4.x acting as a transparent http
 proxy (NOT https)
In-Reply-To: <2cd585fa-f50f-979b-a450-6e83fb1cc1ca@gmail.com>
References: <a6eea1d9-fec4-0e6e-9a33-bde8b9e9f8eb@gmail.com>
 <AM4PR0401MB2194D203581848E7EAF9F3ED8FFC0@AM4PR0401MB2194.eurprd04.prod.outlook.com>
 <e6fcd409-d9c7-3282-d073-09ba4eec373a@gmail.com>
 <0E20AF5A-F64A-4FD8-B0A8-63C4927149DA@diladele.com>
 <2cd585fa-f50f-979b-a450-6e83fb1cc1ca@gmail.com>
Message-ID: <0464e0f8-e5d0-0d70-6471-a9960a41da78@gmail.com>

Squid is relatively difficult to run with transparent mode on virtual
platforms due to NAT limitations on virtual platforms (this is not
squid's issue, this is issue if virtual platforms).

I'm using squid only in transparent mode (only in transparent mode)
several years on Solaris (bare metal) without any issues in HTTP/HTTPS
interception. With IPFilter. With 1-2-6-8 interfaces with different LAN
topologies. Starting from Squid 2.7, then 3.4, 3.5, 4.x and now 5.x. All
without serious problems.

But on bare-metal.

08.02.2018 05:25, setuid ?????:
> On 2/7/18 5:37 PM, Rafael Akchurin wrote:
>> How is your network configured? Your rules indicate you have 2 nics but you later say you have one..
> Originally, I started with 1 NIC (it's a VM), and added 2 more, because
> I read that pf/ipfw can't rewrite ingress packets on the same interface
> it used for egress, but I haven't tried creating a bridge and routes to
> attempt to make that work yet.
>
> The Ubuntu machine has 2 NICs; primary NIC is WAN facing (internet
> routable IP bound to eth0) and the secondary NIC sits on the "backup"
> network (LAN-side) on 192.168.2.x.
>
> Let's break it down:
>
> [WAN router]
>   |-- LAN: 192.168.1.1 (wired LAN)
>   `-- WWAN: 10.0.1.1 (wireless clients)
>
> BSD VM: 192.168.1.25
>
> Ubuntu VM:
>   |-- INET: 32.215.x.x
>   `-- LAN: 192.168.2.x
>
> The WAN router is what sends traffic sent over it on :80, over to .1.25
> (BSD) to cache.
>
> Previously, I had it pointed to Squid 2.6 sitting on my NAS
> (192.168.1.20) and that would work perfectly as a transparent proxy.
>
> When I pointed the WAN router to .25 instead of .20, and upgraded the
> version of Squid by using BSD's version from ports on .25, this process
> all fell apart.
>
> So... is having 3 NICs (1 NIC + 2 bridged together as bridge0) *now* a
> requirement to get transparent proxying working with anything using
> Squid 3.x or later?
>
> Can this be done with a single NIC sitting on an Internet-facing LAN
> segment?
>
> If so, how?
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-- 
*****************************
* C++20 : Bug to the future *
*****************************


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180208/bd1a8c4d/attachment.sig>

From setuid at gmail.com  Wed Feb  7 23:44:08 2018
From: setuid at gmail.com (setuid)
Date: Wed, 7 Feb 2018 18:44:08 -0500
Subject: [squid-users] Squid 3.x or 4.x acting as a transparent http
 proxy (NOT https)
In-Reply-To: <eb00e23f-bf91-3fea-6692-78b149f24899@gmail.com>
References: <a6eea1d9-fec4-0e6e-9a33-bde8b9e9f8eb@gmail.com>
 <bf4ba597-ec37-6f72-d9f7-df15b4855039@gmail.com>
 <d8c50428-cf28-f7fe-5067-7c5e3b83a785@gmail.com>
 <eb00e23f-bf91-3fea-6692-78b149f24899@gmail.com>
Message-ID: <0f159f58-c35c-8e1c-99af-3ba14520b1f0@gmail.com>

On 2/7/18 6:36 PM, Yuri wrote:
> Did you used ipfw NAT configuration on same box with squid?

Yes, my ipfw configuration is:

$cmd 00700 deny ip from any to any dst-port 3128 via em0
$cmd 00800 fwd 3128 tcp from 192.168.1.25 to any dst-port 80 via em0
$cmd 00820 allow ip from any to any dst-port 3128 dst-ip 192.168.1.25
src-ip 192.168.1.1
$cmd add 60000 permit ip from any to any


From yvoinov at gmail.com  Thu Feb  8 00:13:32 2018
From: yvoinov at gmail.com (Yuri)
Date: Thu, 8 Feb 2018 06:13:32 +0600
Subject: [squid-users] Squid 3.x or 4.x acting as a transparent http
 proxy (NOT https)
In-Reply-To: <0f159f58-c35c-8e1c-99af-3ba14520b1f0@gmail.com>
References: <a6eea1d9-fec4-0e6e-9a33-bde8b9e9f8eb@gmail.com>
 <bf4ba597-ec37-6f72-d9f7-df15b4855039@gmail.com>
 <d8c50428-cf28-f7fe-5067-7c5e3b83a785@gmail.com>
 <eb00e23f-bf91-3fea-6692-78b149f24899@gmail.com>
 <0f159f58-c35c-8e1c-99af-3ba14520b1f0@gmail.com>
Message-ID: <9ea7556f-95d9-9f64-c843-2e8fceedbb7d@gmail.com>

Where ipfw runs? In virtual machine, or on hypervisor?


08.02.2018 05:44, setuid ?????:
> On 2/7/18 6:36 PM, Yuri wrote:
>> Did you used ipfw NAT configuration on same box with squid?
> Yes, my ipfw configuration is:
>
> $cmd 00700 deny ip from any to any dst-port 3128 via em0
> $cmd 00800 fwd 3128 tcp from 192.168.1.25 to any dst-port 80 via em0
> $cmd 00820 allow ip from any to any dst-port 3128 dst-ip 192.168.1.25
> src-ip 192.168.1.1
> $cmd add 60000 permit ip from any to any

-- 
*****************************
* C++20 : Bug to the future *
*****************************


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180208/6a9b56e3/attachment.sig>

From squid3 at treenet.co.nz  Thu Feb  8 03:56:56 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 8 Feb 2018 16:56:56 +1300
Subject: [squid-users] Squid 3.x or 4.x acting as a transparent http
 proxy (NOT https)
In-Reply-To: <0f159f58-c35c-8e1c-99af-3ba14520b1f0@gmail.com>
References: <a6eea1d9-fec4-0e6e-9a33-bde8b9e9f8eb@gmail.com>
 <bf4ba597-ec37-6f72-d9f7-df15b4855039@gmail.com>
 <d8c50428-cf28-f7fe-5067-7c5e3b83a785@gmail.com>
 <eb00e23f-bf91-3fea-6692-78b149f24899@gmail.com>
 <0f159f58-c35c-8e1c-99af-3ba14520b1f0@gmail.com>
Message-ID: <0ed78436-0ec7-5bfd-edf5-55591924e79e@treenet.co.nz>

On 08/02/18 12:44, setuid wrote:
> On 2/7/18 6:36 PM, Yuri wrote:
>> Did you used ipfw NAT configuration on same box with squid?
> 
> Yes, my ipfw configuration is:
> 
> $cmd 00700 deny ip from any to any dst-port 3128 via em0
> $cmd 00800 fwd 3128 tcp from 192.168.1.25 to any dst-port 80 via em0
> $cmd 00820 allow ip from any to any dst-port 3128 dst-ip 192.168.1.25
> src-ip 192.168.1.1
> $cmd add 60000 permit ip from any to any


Earlier you wrote:


> My Squid configuration is 100% default, identical to the generic config,
> with the exception of the following lines:
>
> ======================
> http_port 3128
> http_port 3129 intercept
> tcp_outgoing_address 192.168.1.25
> debug_options ALL,9
> ======================


Your IPFW rules are sending intercepted traffic to port 3128.

HTTP traffic comes in multiple flavours/types. Squid-3+ enforce the port
"mode" for matches the type of traffic arriving to maintain traffic
integrity in the face of security vulnerabilities relevant (or not) to
each traffic type.

This adds some natural limitations which were not previously visible in
Squid-2 which was broken, just not informing you of the problem(s).

These are:

* you MUST configure NAT on the same device / machine / VM that Squid is
running on. Squid requires access directly to the kernel NAT tables.

* you MUST only send traffic of a given type to the port with matching
"mode" flag.
 - explicit/forward proxy is implied when *no* more specific mode is
supplied,
 - NAT traffic requires "intercept" flag,
 - TPROXY traffic requires "tproxy" flag, and
 - interception of HTTPS traffic requires "ssl-bump" flag (which can be
combined with the others)



Also, were the build options displayed earlier the same ones you used
for testing *BSD and Linux systems?
 The Linux Netfilter and *BSD PF NAT systems will never work if you
disable them and permit *only* IPFW-transparent in the Squid build.



Amos


From squid3 at treenet.co.nz  Thu Feb  8 08:13:18 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 8 Feb 2018 21:13:18 +1300
Subject: [squid-users] Squid 3.x or 4.x acting as a transparent http
 proxy (NOT https)
In-Reply-To: <a6eea1d9-fec4-0e6e-9a33-bde8b9e9f8eb@gmail.com>
References: <a6eea1d9-fec4-0e6e-9a33-bde8b9e9f8eb@gmail.com>
Message-ID: <b8912b35-15e3-247e-81d6-2621d4a325e3@treenet.co.nz>


On 08/02/18 10:11, setuid wrote:
> I'll start with the pointedly easy stuff: Squid > 2.6 (tested 3.4, 3.5,
> 4.0 on Ubuntu Xenial, Debian Jessie, FreeSBD 11.1 using iptables, pf,
> ipf, ipfilter) does not work at all, when configured as a transparent
> proxy. Full stop.
> 
> I went through hundreds of posts on dozens of forums, blogs and other
> resources, tried dozens and dozens of configurations suggested by those
> posts, tried all 3 firewall options on BSD, tried two versions of Ubuntu
> and the various versions of Squid from the apt repos, as well as those
> in BSD's ports.
> 
> All of them, 100%, fail in _exactly_ the same way, no matter what my
> configuration was set to. That result, is that _every single http
> request I make_ when Squid is configured as a transparent proxy, results
> in the following response being logged:
> 
> ======================
> 	07/Feb/2018:15:10:59 -0500.213      0 192.168.1.1 TAG_NONE/400 3583 GET
> / - HIER_NONE/- text/html ("-" "-")
> ======================
> 
> When I point a client directly at the proxy, using a browser, curl or
> anything else, I see:
> 
> ======================
> 	07/Feb/2018:15:12:56 -0500.875     82 192.168.1.1 TCP_MISS/302 333 HEAD
> http://www.java.com/ - HIER_DIRECT/www.java.com - ("-" "curl/7.47.0")
> ======================
> 
> These were the same exact request against the same exact Squid instance.

Lets start with the obvious then. HEAD is Not the same as GET. These are
*different* requests. Therefore something major is wrong with your
understanding of the situation.


> If I use Squid 3.5 on Ubuntu or 3.5 and 4.0 on BSD, the logged entry is
> _identical_ for every single http request I make, regardless of origin.
> 
> My Squid configuration is 100% default, identical to the generic config,
> with the exception of the following lines:
> 
> ======================
> http_port 3128
> http_port 3129 intercept
> tcp_outgoing_address 192.168.1.25
> debug_options ALL,9
> ======================
> 
> I've tried all of the obvious links, blogs and resources I could Google
> up, and 100% of them fail to function as described. Most people I've
> seen on the forums who attempt to get this working, throw their hands up
> in defeat and end up configuring the proxy directly on every client that
> needs it.
> 
> My current environment looks like this:
> 
> [ wireless router: 10.0.1.1 on LAN side, 192.168.1.1 on WAN side ]
> 
> That router has a firewall script on it that says:
> 
> ======================
> #!/bin/sh
> PROXY_IP=192.168.2.25
> PROXY_PORT=3128
> LAN_IP=$(nvram get lan_ipaddr)
> LAN_NET=$LAN_IP/$(nvram get lan_netmask)
> 
> iptables -t nat -A PREROUTING -i br0 -s $LAN_NET -d $LAN_NET -p tcp
> --dport 80 -j ACCEPT
> iptables -t nat -A PREROUTING -i br0 -s ! $PROXY_IP -p tcp --dport 80 -j
> DNAT --to $PROXY_IP:$PROXY_PORT
> 
> iptables -t nat -I POSTROUTING -o br0 -s $LAN_NET -d $PROXY_IP -p tcp -j
> SNAT --to $LAN_IP
> iptables -I FORWARD -i br0 -o br0 -s $LAN_NET -d $PROXY_IP -p tcp
> --dport $PROXY_PORT -j ACCEPT
> ======================
> 
> This takes every packet that hits the router on :80, and sends it to my
> Squid server on .25, which mangles it and sends it back to 192.168.1.1
> (router), and onward back to client who requested it.
> 

No. This takes HTTP (port 80 syntax) and sends it to a remote proxy
expecting explicit-proxy syntax.


> When I was using 2.6 (without large_file support), I was using this same
> exact configuration, but http_port was set to 'accel', and I didn't need
> _any_ NAT/routing rules on the squid side at all. It all "Just Worked(tm)".


It also "Just Worked" for anyone attacking your network via
CVE-2009-0801 methods. And would provide them with an effective
invisibility cloak while doing so (original IP:ports destroyed by the NAT).
 Not exactly desirable behaviour.



> 
> Now I need to jump through hoops to do pf incantations of rdr/direct-to
> (but direct-to and direct-reply aren't supported on FreeBSD's pf, only
> OpenBSD's pf supports that syntax), and iptables PREROUTING and
> POSTROUTING mojo (also fails).
> 

You need simply *route* traffic properly in the way the Internet was
designed to work. Instead of abusing NAT.

When that is done properly the NAT happens *only* as the final step to
get the traffic into the Squid process by the machine/device/VM Squid is
running on.


> Here's a list of some of the resources I've tried, with 100% failure in
> every case. There are dozens more that I've lost in my browser history now.
> 
> * https://wiki.squid-cache.org/ConfigExamples/Intercept/Ipfw
> *
> https://wiki.squid-cache.org/SquidFaq/InterceptionProxy#Interception_Caching_packet_redirection_for_OpenBSD_PF

Hmm. I see that page is updated and missing quote a few things. Thanks
for bringing this to attention.

Amos


From fredbmail at free.fr  Thu Feb  8 17:33:16 2018
From: fredbmail at free.fr (FredB)
Date: Thu, 8 Feb 2018 18:33:16 +0100 (CET)
Subject: [squid-users] Certificate Authority with SSLBump
In-Reply-To: <1525440034.176269415.1518110624140.JavaMail.root@zimbra4-e1>
Message-ID: <2039837653.176305670.1518111196494.JavaMail.root@zimbra4-e1>

Hi All,

In practise how you maintain the CA files? I'm testing SSLBump with Debian Jessie the package ca-certificates provides many certificates but less than the latest Firefox Browser.
How do you manage to keep all that in check? When a CA is missing you add the pem in you system config or exclude the website from SSLBump?  

EG: From my test https://wiki.squid-cache.org seems unknown (71) Protocol error (TLS code: X509_V_ERR_UNABLE_TO_GET_ISSUER_CERT_LOCALLY)
SSL Certficate error: certificate issuer (CA) not known: /C=US/O=Let's Encrypt/CN=Let's Encrypt Authority X3

Thanks

Regards
Fred


From yvoinov at gmail.com  Thu Feb  8 17:36:05 2018
From: yvoinov at gmail.com (Yuri)
Date: Thu, 8 Feb 2018 23:36:05 +0600
Subject: [squid-users] Certificate Authority with SSLBump
In-Reply-To: <2039837653.176305670.1518111196494.JavaMail.root@zimbra4-e1>
References: <2039837653.176305670.1518111196494.JavaMail.root@zimbra4-e1>
Message-ID: <eb65d15e-e79c-2709-7fbc-2046b2fb526a@gmail.com>

1. Using mozilla CA bundle instead of system (if exists) for squid.

2. Update mozilla CA bundle by script by cron on regular basis.

3. Have own manually maintained custom add_certs.pem list which combines
with step 2 during updates.

Thats all, folks.


08.02.2018 23:33, FredB ?????:
> Hi All,
>
> In practise how you maintain the CA files? I'm testing SSLBump with Debian Jessie the package ca-certificates provides many certificates but less than the latest Firefox Browser.
> How do you manage to keep all that in check? When a CA is missing you add the pem in you system config or exclude the website from SSLBump?  
>
> EG: From my test https://wiki.squid-cache.org seems unknown (71) Protocol error (TLS code: X509_V_ERR_UNABLE_TO_GET_ISSUER_CERT_LOCALLY)
> SSL Certficate error: certificate issuer (CA) not known: /C=US/O=Let's Encrypt/CN=Let's Encrypt Authority X3
>
> Thanks
>
> Regards
> Fred
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-- 
*****************************
* C++20 : Bug to the future *
*****************************


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180208/ed77fb7b/attachment.sig>

From alfrenovsky at gmail.com  Thu Feb  8 19:26:55 2018
From: alfrenovsky at gmail.com (Alfredo Daniel Rezinovsky)
Date: Thu, 8 Feb 2018 16:26:55 -0300
Subject: [squid-users] Macros
Message-ID: <fd72e573-90ad-6606-3709-7946acb1b89e@gmail.com>

I know there is a macro ${service_name}

I like to know if there are other or there's a way to parse environment 
variables in squid.conf.

I didn't find this in the on line documentation



From yvoinov at gmail.com  Thu Feb  8 19:28:19 2018
From: yvoinov at gmail.com (Yuri)
Date: Fri, 9 Feb 2018 01:28:19 +0600
Subject: [squid-users] Macros
In-Reply-To: <fd72e573-90ad-6606-3709-7946acb1b89e@gmail.com>
References: <fd72e573-90ad-6606-3709-7946acb1b89e@gmail.com>
Message-ID: <c6ecdade-717b-c831-828d-cedc843e8505@gmail.com>

This is OpenSource :) There is no documentation :) (As they say - read
the code to get documentation ;))


09.02.2018 01:26, Alfredo Daniel Rezinovsky ?????:
> I know there is a macro ${service_name}
>
> I like to know if there are other or there's a way to parse
> environment variables in squid.conf.
>
> I didn't find this in the on line documentation
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-- 
*****************************
* C++20 : Bug to the future *
*****************************


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180209/dbacdf16/attachment.sig>

From alfrenovsky at gmail.com  Thu Feb  8 19:34:19 2018
From: alfrenovsky at gmail.com (Alfredo Daniel Rezinovsky)
Date: Thu, 8 Feb 2018 16:34:19 -0300
Subject: [squid-users] Macros
In-Reply-To: <c6ecdade-717b-c831-828d-cedc843e8505@gmail.com>
References: <fd72e573-90ad-6606-3709-7946acb1b89e@gmail.com>
 <c6ecdade-717b-c831-828d-cedc843e8505@gmail.com>
Message-ID: <c6ec7bf2-cf1e-b458-1850-e02e7f911573@gmail.com>

I tried searching in the code and still couldn't find it. But.... 
Challenge accepted.


On 08/02/18 16:28, Yuri wrote:
> This is OpenSource :) There is no documentation :) (As they say - read
> the code to get documentation ;))
>
>
> 09.02.2018 01:26, Alfredo Daniel Rezinovsky ?????:
>> I know there is a macro ${service_name}
>>
>> I like to know if there are other or there's a way to parse
>> environment variables in squid.conf.
>>
>> I didn't find this in the on line documentation
>>
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180208/14704183/attachment.htm>

From yvoinov at gmail.com  Thu Feb  8 19:36:05 2018
From: yvoinov at gmail.com (Yuri)
Date: Fri, 9 Feb 2018 01:36:05 +0600
Subject: [squid-users] Macros
In-Reply-To: <c6ec7bf2-cf1e-b458-1850-e02e7f911573@gmail.com>
References: <fd72e573-90ad-6606-3709-7946acb1b89e@gmail.com>
 <c6ecdade-717b-c831-828d-cedc843e8505@gmail.com>
 <c6ec7bf2-cf1e-b458-1850-e02e7f911573@gmail.com>
Message-ID: <707bbffc-75c7-7b6f-52ff-d3815797ca83@gmail.com>

Indeed :)

You can cover this by write good documentation and share it ;) This is
OpenSource ;) Nothing exists - except you will create by yourself ;)


09.02.2018 01:34, Alfredo Daniel Rezinovsky ?????:
>
> I tried searching in the code and still couldn't find it. But....
> Challenge accepted.
>
>
> On 08/02/18 16:28, Yuri wrote:
>> This is OpenSource :) There is no documentation :) (As they say - read
>> the code to get documentation ;))
>>
>>
>> 09.02.2018 01:26, Alfredo Daniel Rezinovsky ?????:
>>> I know there is a macro ${service_name}
>>>
>>> I like to know if there are other or there's a way to parse
>>> environment variables in squid.conf.
>>>
>>> I didn't find this in the on line documentation
>>>
>>> _______________________________________________
>>> squid-users mailing list
>>> squid-users at lists.squid-cache.org
>>> http://lists.squid-cache.org/listinfo/squid-users
>>
>>
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
>
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-- 
*****************************
* C++20 : Bug to the future *
*****************************

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180209/dcd24cf2/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180209/dcd24cf2/attachment.sig>

From rousskov at measurement-factory.com  Thu Feb  8 21:56:39 2018
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Thu, 08 Feb 2018 15:56:39 -0600
Subject: [squid-users] Macros
In-Reply-To: <fd72e573-90ad-6606-3709-7946acb1b89e@gmail.com>
References: <fd72e573-90ad-6606-3709-7946acb1b89e@gmail.com>
Message-ID: <161776ba5d8.277d.0fa0e86c8d2ee43f749db760f8bca319@measurement-factory.com>

On February 8, 2018 13:27:06 Alfredo Daniel Rezinovsky  wrote:

> I know there is a macro ${service_name}
>
> I like to know if there are other

See squid.conf.documented. Modern versions have a  section devoted to 
macros, before all the directives are described.


> or there's a way to parse environment
> variables in squid.conf.

No, IIRC. However, you can preprocess your configuration and/or generate 
include files.


HTH,

Alex.




From hoangminhung at gmail.com  Fri Feb  9 01:12:52 2018
From: hoangminhung at gmail.com (=?UTF-8?B?bWluaCBoxrBuZyDEkeG7lyBob8Ogbmc=?=)
Date: Fri, 9 Feb 2018 08:12:52 +0700
Subject: [squid-users] 3.5.20 run out of my memory.
In-Reply-To: <9ccf03f1-64ea-9004-fa6f-e2b42af61717@treenet.co.nz>
References: <CAO0fBErmnH6ENVbN7NLQBZSJJ=DrXUH=OXZD8=W5LFx0u7K1dA@mail.gmail.com>
 <9ccf03f1-64ea-9004-fa6f-e2b42af61717@treenet.co.nz>
Message-ID: <CAO0fBEptoLUDJdPFwtjLnNsbYLPvwbbr4si=+Be1e=WM+u1oUw@mail.gmail.com>

Thanks alot for your help,

> https_port 3130 tproxy ssl-bump generate-host-certificates=on
> > dynamic_cert_mem_cache_size=4MB
> > cert=/etc/squid/ssl/e1f19c0494badc8dc14e8c4c56a8b97a.dyn
>
> Please add sslflags=NO_DEFAULT_CA to the above config line. That should
> reduce the memory usage a lot.
>
>
I have tried this command, but my squid still used alot of my memory for
cache .

KiB Mem:   4037016 total,  3729152 used,   307864 free,   120508 buffers
KiB Swap:  8511484 total,        0 used,  8511484 free.  2213580 cached Mem

Squid only use about 1.2Gb dram to run, but use alot of memory for cached (
2213580 cached Mem )
What was cached by my squid with my squid.conf ? Can i reduce or set
life-time for this cache ?

-- 
Thanks & Best Regards,
--------------
?? Ho?ng Minh H?ng
Gmail : hoangminhung at gmail.com
S?T : 01234454115
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180209/04da1d34/attachment.htm>

From jascha.sticher at tds.fujitsu.com  Fri Feb  9 07:30:50 2018
From: jascha.sticher at tds.fujitsu.com (Sticher, Jascha)
Date: Fri, 9 Feb 2018 07:30:50 +0000
Subject: [squid-users] 3.5.20 run out of my memory.
In-Reply-To: <CAO0fBEptoLUDJdPFwtjLnNsbYLPvwbbr4si=+Be1e=WM+u1oUw@mail.gmail.com>
References: <CAO0fBErmnH6ENVbN7NLQBZSJJ=DrXUH=OXZD8=W5LFx0u7K1dA@mail.gmail.com>
 <9ccf03f1-64ea-9004-fa6f-e2b42af61717@treenet.co.nz>
 <CAO0fBEptoLUDJdPFwtjLnNsbYLPvwbbr4si=+Be1e=WM+u1oUw@mail.gmail.com>
Message-ID: <E286ADE35F919742812E3076A36122E701BFCA621C@tdsnsumbx2vp>

Hi,

> KiB Mem:   4037016 total,  3729152 used,   307864 free,   120508 buffers
> KiB Swap:  8511484 total,        0 used,  8511484 free.  2213580 cached Mem

this is normal behaviour in Linux - everything that's once read from disk is cached in RAM, as long as there is free memory.
If the RAM is needed in another way, the cache in memory will be reduced. See also: https://www.linuxatemyram.com/


Kind regards,

Jascha Sticher



From squid3 at treenet.co.nz  Fri Feb  9 07:34:45 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 9 Feb 2018 20:34:45 +1300
Subject: [squid-users] 3.5.20 run out of my memory.
In-Reply-To: <CAO0fBEptoLUDJdPFwtjLnNsbYLPvwbbr4si=+Be1e=WM+u1oUw@mail.gmail.com>
References: <CAO0fBErmnH6ENVbN7NLQBZSJJ=DrXUH=OXZD8=W5LFx0u7K1dA@mail.gmail.com>
 <9ccf03f1-64ea-9004-fa6f-e2b42af61717@treenet.co.nz>
 <CAO0fBEptoLUDJdPFwtjLnNsbYLPvwbbr4si=+Be1e=WM+u1oUw@mail.gmail.com>
Message-ID: <6f20e159-a65d-660f-48f3-8834ecb0fd21@treenet.co.nz>

On 09/02/18 14:12, minh h?ng ?? ho?ng wrote:
> Thanks alot for your help,
> 
>     > https_port 3130 tproxy ssl-bump generate-host-certificates=on
>     > dynamic_cert_mem_cache_size=4MB
>     > cert=/etc/squid/ssl/e1f19c0494badc8dc14e8c4c56a8b97a.dyn
> 
>     Please add sslflags=NO_DEFAULT_CA to the above config line. That should
>     reduce the memory usage a lot.
> 
> ?
> I have tried this command, but my squid still used alot of my memory for
> cache .
> 
> KiB Mem:?? 4037016 total,? 3729152 used,?? 307864 free,?? 120508 buffers
> KiB Swap:? 8511484 total,??????? 0 used,? 8511484 free.? 2213580 cached Mem
> 
> Squid only use about 1.2Gb dram to run, but use alot of memory for
> cached ( 2213580 cached Mem )
> What was cached by my squid with my squid.conf ? Can i reduce or set
> life-time for this cache ?
> 

"cached Mem" is not Squid memory. It is Operating System memory and
nothing to worry about so long as the used and free values are reasonable.

You have "0 used" in Swap, and lots of "free" in main memory. Those are
the most important things.

These pages may be of help understanding what all the numbers mean:

<https://www.networkworld.com/article/2722141/it-management/making-sense-of-memory-usage-on-linux.html>

<https://wiki.squid-cache.org/SquidFaq/SquidMemory>

Amos


From squid3 at treenet.co.nz  Fri Feb  9 07:36:56 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 9 Feb 2018 20:36:56 +1300
Subject: [squid-users] 3.5.20 run out of my memory.
In-Reply-To: <E286ADE35F919742812E3076A36122E701BFCA621C@tdsnsumbx2vp>
References: <CAO0fBErmnH6ENVbN7NLQBZSJJ=DrXUH=OXZD8=W5LFx0u7K1dA@mail.gmail.com>
 <9ccf03f1-64ea-9004-fa6f-e2b42af61717@treenet.co.nz>
 <CAO0fBEptoLUDJdPFwtjLnNsbYLPvwbbr4si=+Be1e=WM+u1oUw@mail.gmail.com>
 <E286ADE35F919742812E3076A36122E701BFCA621C@tdsnsumbx2vp>
Message-ID: <9110e716-d6ca-b011-f527-e4ee8096b6f7@treenet.co.nz>

On 09/02/18 20:30, Sticher, Jascha wrote:
> Hi,
> 
>> KiB Mem:   4037016 total,  3729152 used,   307864 free,   120508 buffers
>> KiB Swap:  8511484 total,        0 used,  8511484 free.  2213580 cached Mem
> 
> this is normal behaviour in Linux - everything that's once read from disk is cached in RAM, as long as there is free memory.
> If the RAM is needed in another way, the cache in memory will be reduced. See also: https://www.linuxatemyram.com/
> 
> 
> Kind regards,
> 
> Jascha Sticher
> 

Nice way to say it. Do you mind If I quote you for this in the Squid FAQ
pages?

Amos


From jascha.sticher at tds.fujitsu.com  Fri Feb  9 07:44:49 2018
From: jascha.sticher at tds.fujitsu.com (Sticher, Jascha)
Date: Fri, 9 Feb 2018 07:44:49 +0000
Subject: [squid-users] 3.5.20 run out of my memory.
In-Reply-To: <9110e716-d6ca-b011-f527-e4ee8096b6f7@treenet.co.nz>
References: <CAO0fBErmnH6ENVbN7NLQBZSJJ=DrXUH=OXZD8=W5LFx0u7K1dA@mail.gmail.com>
 <9ccf03f1-64ea-9004-fa6f-e2b42af61717@treenet.co.nz>
 <CAO0fBEptoLUDJdPFwtjLnNsbYLPvwbbr4si=+Be1e=WM+u1oUw@mail.gmail.com>
 <E286ADE35F919742812E3076A36122E701BFCA621C@tdsnsumbx2vp>
 <9110e716-d6ca-b011-f527-e4ee8096b6f7@treenet.co.nz>
Message-ID: <E286ADE35F919742812E3076A36122E701BFCA6240@tdsnsumbx2vp>

> Von: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] Im
> Auftrag von Amos Jeffries
> Gesendet: Freitag, 9. Februar 2018 08:37
>
> On 09/02/18 20:30, Sticher, Jascha wrote:
> > Hi,
> >
> >> KiB Mem:   4037016 total,  3729152 used,   307864 free,   120508 buffers
> >> KiB Swap:  8511484 total,        0 used,  8511484 free.  2213580 cached Mem
> >
> > this is normal behaviour in Linux - everything that's once read from disk is
> cached in RAM, as long as there is free memory.
> > If the RAM is needed in another way, the cache in memory will be reduced.
> See also: https://www.linuxatemyram.com/
> >
> >
> > Kind regards,
> >
> > Jascha Sticher
> >
> 
> Nice way to say it. Do you mind If I quote you for this in the Squid FAQ
> pages?
> 
> Amos

I don't mind - go ahead.

I'm glad to help!

Kind regards,

Jascha Sticher

From m_zouhairy at skno.by  Fri Feb  9 10:54:54 2018
From: m_zouhairy at skno.by (Vacheslav)
Date: Fri, 9 Feb 2018 13:54:54 +0300
Subject: [squid-users] Macros
In-Reply-To: <707bbffc-75c7-7b6f-52ff-d3815797ca83@gmail.com>
References: <fd72e573-90ad-6606-3709-7946acb1b89e@gmail.com>
 <c6ecdade-717b-c831-828d-cedc843e8505@gmail.com>
 <c6ec7bf2-cf1e-b458-1850-e02e7f911573@gmail.com>
 <707bbffc-75c7-7b6f-52ff-d3815797ca83@gmail.com>
Message-ID: <09f401d3a194$6b2a4380$417eca80$@skno.by>

Nothing exists means you don?t exist, there is no reason not throw yourself out of the window then.

 

From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Yuri
Sent: Thursday, February 8, 2018 10:36 PM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Macros

 

Indeed :)

You can cover this by write good documentation and share it ;) This is OpenSource ;) Nothing exists - except you will create by yourself ;)

 

09.02.2018 01:34, Alfredo Daniel Rezinovsky ?????:

I tried searching in the code and still couldn't find it. But.... Challenge accepted.

 

On 08/02/18 16:28, Yuri wrote:

This is OpenSource :) There is no documentation :) (As they say - read
the code to get documentation ;))
 
 
09.02.2018 01:26, Alfredo Daniel Rezinovsky ?????:

I know there is a macro ${service_name}
 
I like to know if there are other or there's a way to parse
environment variables in squid.conf.
 
I didn't find this in the on line documentation
 
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> 
http://lists.squid-cache.org/listinfo/squid-users






_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> 
http://lists.squid-cache.org/listinfo/squid-users







_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> 
http://lists.squid-cache.org/listinfo/squid-users





-- 
*****************************
* C++20 : Bug to the future *
*****************************
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180209/73bbde92/attachment.htm>

From scorpionxii at gmail.com  Fri Feb  9 17:54:24 2018
From: scorpionxii at gmail.com (Hery Martin)
Date: Fri, 9 Feb 2018 12:54:24 -0500
Subject: [squid-users] Facebook Messenger (Not Internet
	Connection->Connecting)
Message-ID: <CAJtELrhHCPCNWR7btcYBUzt49g7i9eDJOA2F9RXSss6VgMaYhQ@mail.gmail.com>

Hello guys!

I'm having this weird issue since 2 month ago. Don't know why when some
body try to use Facebook Menssager (https://www.messenger.com) after login,
you can see all your contacts and messages, but inmediately shown red bar
with "Not Internet Connection" text. Its important to say that only happens
using https://www.messenger.com, if you uses
https://www.facebook.com/messages/ all works as expected.

I hope that any of you can test it in your environments???

Anyway my squid version is 3.5.12, I manage an Enterprise Network, so just
to be sure, I had tested with a clean Squid installation on our
virtualization cluster, and the results was the same.

I also tested it without Squid, to know if was caused by my ISP provider,
but browsing locally in the server where Squid are virtualized but with no
proxy, thing works as expected.

Tracing the request in the browser console, I found that URLs
https://6-edge-chat.messenger.com/p?partition or any orther number (1-, 2-,
3-, 4-) at the beginning are trowing ERR_CONNECTION_CLOSED immediately and
looking into squid access log shown as TCP_TUNNEL/200 0 CONNECT
6-edge-chat.messenger.com:443 - HIER_DIRECT/157.240.14.15 - and nothing
more!

This is melting my brain. So please test it before to know if you have the
same problem

Cheers!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180209/2396419d/attachment.htm>

From yvoinov at gmail.com  Fri Feb  9 17:57:43 2018
From: yvoinov at gmail.com (Yuri)
Date: Fri, 9 Feb 2018 23:57:43 +0600
Subject: [squid-users] Facebook Messenger (Not Internet
 Connection->Connecting)
In-Reply-To: <CAJtELrhHCPCNWR7btcYBUzt49g7i9eDJOA2F9RXSss6VgMaYhQ@mail.gmail.com>
References: <CAJtELrhHCPCNWR7btcYBUzt49g7i9eDJOA2F9RXSss6VgMaYhQ@mail.gmail.com>
Message-ID: <0df0ec7b-858c-aceb-e8c8-f9b62876e209@gmail.com>

Works like charm on 3.5.27.


09.02.2018 23:54, Hery Martin ?????:
> Hello guys!
>
> I'm having this weird issue since 2 month ago. Don't know why when
> some body try to use Facebook Menssager (https://www.messenger.com)
> after login, you can see all your contacts and messages, but
> inmediately shown red bar with "Not Internet Connection" text. Its
> important to say that only happens using https://www.messenger.com, if
> you uses?https://www.facebook.com/messages/ all works as expected.
>
> I hope that any of you can test it in your environments????
>
> Anyway my squid version is 3.5.12, I manage an Enterprise Network, so
> just to be sure, I had tested with a clean Squid installation on our
> virtualization cluster, and the results was the same.
>
> I also tested it without Squid, to know if was caused by my ISP
> provider, but browsing locally in the server where Squid are
> virtualized but with no proxy, thing works as expected.
>
> Tracing the request in the browser console, I found that
> URLs?https://6-edge-chat.messenger.com/p?partition?or any orther
> number (1-, 2-, 3-, 4-) at the beginning are trowing
> ERR_CONNECTION_CLOSED immediately and looking into squid access log
> shown as TCP_TUNNEL/200 0 CONNECT 6-edge-chat.messenger.com:443
> <http://6-edge-chat.messenger.com:443> - HIER_DIRECT/157.240.14.15
> <http://157.240.14.15> - and nothing more!
>
> This is melting my brain. So please test it before to know if you have
> the same problem
>
> Cheers!
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-- 
*****************************
* C++20 : Bug to the future *
*****************************

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180209/7a7a78f0/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180209/7a7a78f0/attachment.sig>

From scorpionxii at gmail.com  Fri Feb  9 19:58:21 2018
From: scorpionxii at gmail.com (Hery Martin)
Date: Fri, 9 Feb 2018 14:58:21 -0500
Subject: [squid-users] Facebook Messenger (Not Internet
	Connection->Connecting)
In-Reply-To: <0df0ec7b-858c-aceb-e8c8-f9b62876e209@gmail.com>
References: <CAJtELrhHCPCNWR7btcYBUzt49g7i9eDJOA2F9RXSss6VgMaYhQ@mail.gmail.com>
 <0df0ec7b-858c-aceb-e8c8-f9b62876e209@gmail.com>
Message-ID: <CAJtELrhMLVPYJQC0eFFQ8mMSq8aM2o=J75+N0DFNmCC+UU4NFQ@mail.gmail.com>

Hello Yuri

Right now I compiled 3.5.27, and still have the same issue, so maybe its
something related with my environment??? But... what can be?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180209/d6054b62/attachment.htm>

From yvoinov at gmail.com  Fri Feb  9 20:00:58 2018
From: yvoinov at gmail.com (Yuri)
Date: Sat, 10 Feb 2018 02:00:58 +0600
Subject: [squid-users] Facebook Messenger (Not Internet
 Connection->Connecting)
In-Reply-To: <CAJtELrhMLVPYJQC0eFFQ8mMSq8aM2o=J75+N0DFNmCC+UU4NFQ@mail.gmail.com>
References: <CAJtELrhHCPCNWR7btcYBUzt49g7i9eDJOA2F9RXSss6VgMaYhQ@mail.gmail.com>
 <0df0ec7b-858c-aceb-e8c8-f9b62876e209@gmail.com>
 <CAJtELrhMLVPYJQC0eFFQ8mMSq8aM2o=J75+N0DFNmCC+UU4NFQ@mail.gmail.com>
Message-ID: <1b7bddc8-e322-f2b4-2fab-b972027d5fae@gmail.com>

Hard to say. Require to troubleshoot deeper. May be, configuration. May
be network. May be ISP.


10.02.2018 01:58, Hery Martin ?????:
> Hello Yuri
>
> Right now I compiled 3.5.27, and still have the same issue, so maybe
> its something related with my environment??? But... what can be?
>
>

-- 
*****************************
* C++20 : Bug to the future *
*****************************

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180210/ab2c6c7e/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180210/ab2c6c7e/attachment.sig>

From yvoinov at gmail.com  Fri Feb  9 23:55:11 2018
From: yvoinov at gmail.com (Yuri)
Date: Sat, 10 Feb 2018 05:55:11 +0600
Subject: [squid-users] Squid SSL db on ramdisk
Message-ID: <10333b00-1900-e13d-d3da-a0ed79b81ade@gmail.com>

Amos,

how do you think - if I'll put SSL db (usually places in
/var/lib/ssl_db) on ramdisk, does this give some gain for bump performance?

How reasonable to do that?

Also, I think, doing that,? I can reduce in memory cache size for
security_file_certgen helper.

How do you think?

-- 
*****************************
* C++20 : Bug to the future *
*****************************


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180210/ff0fdb9e/attachment.sig>

From xeron.oskom at gmail.com  Sat Feb 10 01:42:29 2018
From: xeron.oskom at gmail.com (Ivan Larionov)
Date: Fri, 9 Feb 2018 17:42:29 -0800
Subject: [squid-users] Cache reference age for heap LRU/LFUDA and rock/aufs
Message-ID: <CAHvB88wNUsngm_uN6qrrHS3vAD17nooJPNkXQxJP9YRKe_27cg@mail.gmail.com>

Hello!

Is it possible to get a metric similar to "LRU reference age" (or "LRU
expiration") when using heap LRU/LFUDA and aufs/rock?

What we need to do is to figure out the age of the oldest least accessed
object in the cache. Or the age of the last replaced object.

If my description is somehow unclear ? we need to answer the question "How
many days ago the oldest object which is not being accessed anymore has
been put in the cache."

With aufs/lru we had "LRU reference age" or something like this in mgr:info
report, but with currently used heap lru/lfuda and rock/aufs I don't see it
there. SNMP metric also shows:

> SQUID-MIB::cacheCurrentLRUExpiration.0 = Timeticks: (0) 0:00:00.00

If you're wondering why would we need to know that ? it's related to GDPR
and removing data of closed customer's accounts. We need to make sure that
we don't have any "not being accessed anymore" objects older than "data
retention period" days.


Thanks!

-- 
With best regards, Ivan Larionov.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180209/9d15c1ba/attachment.htm>

From rousskov at measurement-factory.com  Sat Feb 10 03:50:54 2018
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Fri, 9 Feb 2018 20:50:54 -0700
Subject: [squid-users] Cache reference age for heap LRU/LFUDA and
 rock/aufs
In-Reply-To: <CAHvB88wNUsngm_uN6qrrHS3vAD17nooJPNkXQxJP9YRKe_27cg@mail.gmail.com>
References: <CAHvB88wNUsngm_uN6qrrHS3vAD17nooJPNkXQxJP9YRKe_27cg@mail.gmail.com>
Message-ID: <630f50dd-1593-f01b-3a1d-d42ab104a376@measurement-factory.com>

On 02/09/2018 06:42 PM, Ivan Larionov wrote:
> Hello!
> 
> Is it possible to get a metric similar to "LRU reference age" (or "LRU
> expiration") when using heap LRU/LFUDA and aufs/rock?
> 
> What we need to do is to figure out the age of the oldest least accessed
> object in the cache. Or the age of the last replaced object.
> 
> If my description is somehow unclear ? we need to answer the question
> "How many days ago the oldest object which is not being accessed anymore
> has been put in the cache."
> 
> With aufs/lru we had "LRU reference age" or something like this in
> mgr:info report, but with currently used heap lru/lfuda and rock/aufs I
> don't see it there. SNMP metric also shows:
> 
>> SQUID-MIB::cacheCurrentLRUExpiration.0 = Timeticks: (0) 0:00:00.00

I cannot answer your question for aufs, but please note that rock
cache_dirs do not support/have/use a configurable replacement policy:
Each incoming object is assigned a slot based on its key hash. With
modern rock code, it is possible to remove that limitation IIRC, but
nobody have done that.


> If you're wondering why would we need to know that ? it's related to
> GDPR and removing data of closed customer's accounts. We need to make
> sure that we don't have any "not being accessed anymore" objects older
> than "data retention period" days.

If it is important to get this right, then I would not trust replacement
policy metadata with this: The corresponding code interfaces look
unreliable to me, and access counts/timestamps for a ufs-based cache_dir
are not updated across Squid restarts when the swap log is lost (at least).

I would instead configure Squid to prohibit serving hits that are too
old. That solution does not match your problem exactly, but it may be
good enough and should work a lot more reliably across all cache_dirs.
If there is no "age" ACL to use with the send_hit directive, then you
may need to add one.

    http://www.squid-cache.org/Doc/config/send_hit/

You may also be able to accomplish the same using refresh_pattern, but I
am a little worroed about various exceptional/special conditions
implemented on top of that directive. Others on this list may offer
better guidance in this area.


HTH,

Alex.


From squid3 at treenet.co.nz  Sat Feb 10 07:30:20 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 10 Feb 2018 20:30:20 +1300
Subject: [squid-users] Squid SSL db on ramdisk
In-Reply-To: <10333b00-1900-e13d-d3da-a0ed79b81ade@gmail.com>
References: <10333b00-1900-e13d-d3da-a0ed79b81ade@gmail.com>
Message-ID: <026663d1-1c20-f97b-3961-8d454bf64612@treenet.co.nz>

On 10/02/18 12:55, Yuri wrote:
> Amos,
> 
> how do you think - if I'll put SSL db (usually places in
> /var/lib/ssl_db) on ramdisk, does this give some gain for bump performance?
> 

I expect so, but do not use bumping myself so cannot say for certain.

> How reasonable to do that?
> 
> Also, I think, doing that,? I can reduce in memory cache size for
> security_file_certgen helper.
> 
> How do you think?

I don't think it will have any effect on that. The size of the DB
content does not related to *where* it is stored.


Amos


From yvoinov at gmail.com  Sat Feb 10 13:43:25 2018
From: yvoinov at gmail.com (Yuri)
Date: Sat, 10 Feb 2018 19:43:25 +0600
Subject: [squid-users] Squid SSL db on ramdisk
In-Reply-To: <026663d1-1c20-f97b-3961-8d454bf64612@treenet.co.nz>
References: <10333b00-1900-e13d-d3da-a0ed79b81ade@gmail.com>
 <026663d1-1c20-f97b-3961-8d454bf64612@treenet.co.nz>
Message-ID: <ff245589-9a93-7581-0e5f-861cb312d828@gmail.com>



10.02.2018 13:30, Amos Jeffries ?????:
> On 10/02/18 12:55, Yuri wrote:
>> Amos,
>>
>> how do you think - if I'll put SSL db (usually places in
>> /var/lib/ssl_db) on ramdisk, does this give some gain for bump performance?
>>
> I expect so, but do not use bumping myself so cannot say for certain.
Ok, will do tests.
>
>> How reasonable to do that?
>>
>> Also, I think, doing that,? I can reduce in memory cache size for
>> security_file_certgen helper.
>>
>> How do you think?
> I don't think it will have any effect on that. The size of the DB
> content does not related to *where* it is stored.
No-no. I mean, security_file_certgen uses memory cache to buffer slow
disk IO for certificates DB. If we're put cert DB onto ramdisk (in fact,
in RAM), so we're can easy reduce helper -M value. Correct?
>
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-- 
*****************************
* C++20 : Bug to the future *
*****************************


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180210/9ca4badb/attachment.sig>

From pengyu.ut at gmail.com  Sat Feb 10 15:04:39 2018
From: pengyu.ut at gmail.com (Peng Yu)
Date: Sat, 10 Feb 2018 09:04:39 -0600
Subject: [squid-users] How to hide client info?
Message-ID: <CABrM6wk_=kq89kTztXwb+bSTmGECGLbTA_RaNMp5zAa=6N9WDQ@mail.gmail.com>

Hi,

I use squid to set a proxy. But the following output shows my local ip
address besides the squid proxy ip. Is there a way to let httpbin.org
only be aware of the squid_proxy but not my local ip?

$ http_proxy=squid_proxy:3128 wget -qO- http://httpbin.org/get
{
  "args": {},
  "headers": {
    "Accept": "*/*",
    "Accept-Encoding": "identity",
    "Cache-Control": "max-age=259200",
    "Connection": "close",
    "Host": "httpbin.org",
    "User-Agent": "Wget/1.16.3 (darwin13.4.0)"
  },
  "origin": "<local_ip>, <ip_of_squid_proxy>",
  "url": "http://httpbin.org/get"
}


-- 
Regards,
Peng


From yvoinov at gmail.com  Sat Feb 10 15:23:55 2018
From: yvoinov at gmail.com (Yuri)
Date: Sat, 10 Feb 2018 21:23:55 +0600
Subject: [squid-users] How to hide client info?
In-Reply-To: <CABrM6wk_=kq89kTztXwb+bSTmGECGLbTA_RaNMp5zAa=6N9WDQ@mail.gmail.com>
References: <CABrM6wk_=kq89kTztXwb+bSTmGECGLbTA_RaNMp5zAa=6N9WDQ@mail.gmail.com>
Message-ID: <1bf9f395-d75b-b444-f670-a16c1677ffe7@gmail.com>

Opening squid.conf.documented:

#? TAG: forwarded_for??? on|off|transparent|truncate|delete
#??? If set to "on", Squid will append your client's IP address
#??? in the HTTP requests it forwards. By default it looks like:
#
#??? ??? X-Forwarded-For: 192.1.2.3
#
#??? If set to "off", it will appear as
#
#??? ??? X-Forwarded-For: unknown
#
#??? If set to "transparent", Squid will not alter the
#??? X-Forwarded-For header in any way.
#
#??? If set to "delete", Squid will delete the entire
#??? X-Forwarded-For header.
#
#??? If set to "truncate", Squid will remove all existing
#??? X-Forwarded-For entries, and place the client IP as the sole entry.
#Default:
# forwarded_for on


10.02.2018 21:04, Peng Yu ?????:
> Hi,
>
> I use squid to set a proxy. But the following output shows my local ip
> address besides the squid proxy ip. Is there a way to let httpbin.org
> only be aware of the squid_proxy but not my local ip?
>
> $ http_proxy=squid_proxy:3128 wget -qO- http://httpbin.org/get
> {
>   "args": {},
>   "headers": {
>     "Accept": "*/*",
>     "Accept-Encoding": "identity",
>     "Cache-Control": "max-age=259200",
>     "Connection": "close",
>     "Host": "httpbin.org",
>     "User-Agent": "Wget/1.16.3 (darwin13.4.0)"
>   },
>   "origin": "<local_ip>, <ip_of_squid_proxy>",
>   "url": "http://httpbin.org/get"
> }
>
>

-- 
*****************************
* C++20 : Bug to the future *
*****************************


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180210/3fc2d33f/attachment.sig>

From pengyu.ut at gmail.com  Sat Feb 10 15:49:02 2018
From: pengyu.ut at gmail.com (Peng Yu)
Date: Sat, 10 Feb 2018 09:49:02 -0600
Subject: [squid-users] How to hide client info?
In-Reply-To: <1bf9f395-d75b-b444-f670-a16c1677ffe7@gmail.com>
References: <CABrM6wk_=kq89kTztXwb+bSTmGECGLbTA_RaNMp5zAa=6N9WDQ@mail.gmail.com>
 <1bf9f395-d75b-b444-f670-a16c1677ffe7@gmail.com>
Message-ID: <CABrM6wnCERpqrkwf78rAojo8bNPVAexMvOU3LBo--ByFw+xQwA@mail.gmail.com>

If I don't use the proxy, I will have the following.

The proxied result has '"Cache-Control": "max-age=259200"'. To disable
it, should I use ignore-cc. Could you show me how to configure squid
to not send '"Cache-Control": "max-age=259200"'? Thanks.

$ wget -qO- http://httpbin.org/get
{
  "args": {},
  "headers": {
    "Accept": "*/*",
    "Accept-Encoding": "identity",
    "Connection": "close",
    "Host": "httpbin.org",
    "User-Agent": "Wget/1.16.3 (darwin13.4.0)"
  },
  "origin": "<local_ip>",
  "url": "http://httpbin.org/get"
}


On Sat, Feb 10, 2018 at 9:23 AM, Yuri <yvoinov at gmail.com> wrote:
> Opening squid.conf.documented:
>
> #  TAG: forwarded_for    on|off|transparent|truncate|delete
> #    If set to "on", Squid will append your client's IP address
> #    in the HTTP requests it forwards. By default it looks like:
> #
> #        X-Forwarded-For: 192.1.2.3
> #
> #    If set to "off", it will appear as
> #
> #        X-Forwarded-For: unknown
> #
> #    If set to "transparent", Squid will not alter the
> #    X-Forwarded-For header in any way.
> #
> #    If set to "delete", Squid will delete the entire
> #    X-Forwarded-For header.
> #
> #    If set to "truncate", Squid will remove all existing
> #    X-Forwarded-For entries, and place the client IP as the sole entry.
> #Default:
> # forwarded_for on
>
>
> 10.02.2018 21:04, Peng Yu ?????:
>> Hi,
>>
>> I use squid to set a proxy. But the following output shows my local ip
>> address besides the squid proxy ip. Is there a way to let httpbin.org
>> only be aware of the squid_proxy but not my local ip?
>>
>> $ http_proxy=squid_proxy:3128 wget -qO- http://httpbin.org/get
>> {
>>   "args": {},
>>   "headers": {
>>     "Accept": "*/*",
>>     "Accept-Encoding": "identity",
>>     "Cache-Control": "max-age=259200",
>>     "Connection": "close",
>>     "Host": "httpbin.org",
>>     "User-Agent": "Wget/1.16.3 (darwin13.4.0)"
>>   },
>>   "origin": "<local_ip>, <ip_of_squid_proxy>",
>>   "url": "http://httpbin.org/get"
>> }
>>
>>
>
> --
> *****************************
> * C++20 : Bug to the future *
> *****************************
>
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>



-- 
Regards,
Peng


From pengyu.ut at gmail.com  Sat Feb 10 16:18:42 2018
From: pengyu.ut at gmail.com (Peng Yu)
Date: Sat, 10 Feb 2018 10:18:42 -0600
Subject: [squid-users] Can reverse_proxy be set as a rotating proxy?
Message-ID: <CABrM6wn7CEW0zp4CGyA+SxjeBw+Nuh6uiS-Dw1ecke6d-n+s=w@mail.gmail.com>

Hi,

I am not sure what the policy of reverse proxy is in squid. Using the
notation in this figure, can squid on "proxy" be set to use "web
servers" one after another for each request (i.e., rotating)? Thanks.

https://upload.wikimedia.org/wikipedia/commons/6/67/Reverse_proxy_h2g2bob.svg

-- 
Regards,
Peng


From rousskov at measurement-factory.com  Sat Feb 10 16:18:59 2018
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Sat, 10 Feb 2018 09:18:59 -0700
Subject: [squid-users] Squid SSL db on ramdisk
In-Reply-To: <ff245589-9a93-7581-0e5f-861cb312d828@gmail.com>
References: <10333b00-1900-e13d-d3da-a0ed79b81ade@gmail.com>
 <026663d1-1c20-f97b-3961-8d454bf64612@treenet.co.nz>
 <ff245589-9a93-7581-0e5f-861cb312d828@gmail.com>
Message-ID: <7b61a00d-66ca-e504-e786-25ca750c0892@measurement-factory.com>

On 02/10/2018 06:43 AM, Yuri wrote:

> security_file_certgen uses memory cache to buffer slow
> disk IO for certificates DB.

It does not.


> If we're put cert DB onto ramdisk (in fact,
> in RAM), so we're can easy reduce helper -M value.

security_file_certgen -M is the helper database size, not the
buffer/cache size.

The buffer/cache you might be thinking about is inside Squid, not inside
the helper. See dynamic_cert_mem_cache_size. dynamic_cert_mem_cache_size
is not related to -M.


HTH,

Alex.


From yvoinov at gmail.com  Sat Feb 10 16:20:14 2018
From: yvoinov at gmail.com (Yuri)
Date: Sat, 10 Feb 2018 22:20:14 +0600
Subject: [squid-users] How to hide client info?
In-Reply-To: <CABrM6wnCERpqrkwf78rAojo8bNPVAexMvOU3LBo--ByFw+xQwA@mail.gmail.com>
References: <CABrM6wk_=kq89kTztXwb+bSTmGECGLbTA_RaNMp5zAa=6N9WDQ@mail.gmail.com>
 <1bf9f395-d75b-b444-f670-a16c1677ffe7@gmail.com>
 <CABrM6wnCERpqrkwf78rAojo8bNPVAexMvOU3LBo--ByFw+xQwA@mail.gmail.com>
Message-ID: <81f3233c-a1e2-1301-a6b0-e3a9d717dce1@gmail.com>

How Cache-Control related to hide client info?

10.02.2018 21:49, Peng Yu ?????:
> If I don't use the proxy, I will have the following.
>
> The proxied result has '"Cache-Control": "max-age=259200"'. To disable
> it, should I use ignore-cc. Could you show me how to configure squid
> to not send '"Cache-Control": "max-age=259200"'? Thanks.
>
> $ wget -qO- http://httpbin.org/get
> {
>   "args": {},
>   "headers": {
>     "Accept": "*/*",
>     "Accept-Encoding": "identity",
>     "Connection": "close",
>     "Host": "httpbin.org",
>     "User-Agent": "Wget/1.16.3 (darwin13.4.0)"
>   },
>   "origin": "<local_ip>",
>   "url": "http://httpbin.org/get"
> }
>
>
> On Sat, Feb 10, 2018 at 9:23 AM, Yuri <yvoinov at gmail.com> wrote:
>> Opening squid.conf.documented:
>>
>> #  TAG: forwarded_for    on|off|transparent|truncate|delete
>> #    If set to "on", Squid will append your client's IP address
>> #    in the HTTP requests it forwards. By default it looks like:
>> #
>> #        X-Forwarded-For: 192.1.2.3
>> #
>> #    If set to "off", it will appear as
>> #
>> #        X-Forwarded-For: unknown
>> #
>> #    If set to "transparent", Squid will not alter the
>> #    X-Forwarded-For header in any way.
>> #
>> #    If set to "delete", Squid will delete the entire
>> #    X-Forwarded-For header.
>> #
>> #    If set to "truncate", Squid will remove all existing
>> #    X-Forwarded-For entries, and place the client IP as the sole entry.
>> #Default:
>> # forwarded_for on
>>
>>
>> 10.02.2018 21:04, Peng Yu ?????:
>>> Hi,
>>>
>>> I use squid to set a proxy. But the following output shows my local ip
>>> address besides the squid proxy ip. Is there a way to let httpbin.org
>>> only be aware of the squid_proxy but not my local ip?
>>>
>>> $ http_proxy=squid_proxy:3128 wget -qO- http://httpbin.org/get
>>> {
>>>   "args": {},
>>>   "headers": {
>>>     "Accept": "*/*",
>>>     "Accept-Encoding": "identity",
>>>     "Cache-Control": "max-age=259200",
>>>     "Connection": "close",
>>>     "Host": "httpbin.org",
>>>     "User-Agent": "Wget/1.16.3 (darwin13.4.0)"
>>>   },
>>>   "origin": "<local_ip>, <ip_of_squid_proxy>",
>>>   "url": "http://httpbin.org/get"
>>> }
>>>
>>>
>> --
>> *****************************
>> * C++20 : Bug to the future *
>> *****************************
>>
>>
>>
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
>>
>
>

-- 
*****************************
* C++20 : Bug to the future *
*****************************


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180210/76a79fc3/attachment.sig>

From yvoinov at gmail.com  Sat Feb 10 16:23:51 2018
From: yvoinov at gmail.com (Yuri)
Date: Sat, 10 Feb 2018 22:23:51 +0600
Subject: [squid-users] Squid SSL db on ramdisk
In-Reply-To: <7b61a00d-66ca-e504-e786-25ca750c0892@measurement-factory.com>
References: <10333b00-1900-e13d-d3da-a0ed79b81ade@gmail.com>
 <026663d1-1c20-f97b-3961-8d454bf64612@treenet.co.nz>
 <ff245589-9a93-7581-0e5f-861cb312d828@gmail.com>
 <7b61a00d-66ca-e504-e786-25ca750c0892@measurement-factory.com>
Message-ID: <5454c886-caac-4c3f-f32b-8d4855ba866c@gmail.com>



10.02.2018 22:18, Alex Rousskov ?????:
> On 02/10/2018 06:43 AM, Yuri wrote:
>
>> security_file_certgen uses memory cache to buffer slow
>> disk IO for certificates DB.
> It does not.
Ahhhhhhaaaaaaa, I just misunderstanding options....
>
>
>> If we're put cert DB onto ramdisk (in fact,
>> in RAM), so we're can easy reduce helper -M value.
> security_file_certgen -M is the helper database size, not the
> buffer/cache size.
Ah. Got it. I.e., I can set -M in according FS size, using for store SSL
DB, correct?
>
> The buffer/cache you might be thinking about is inside Squid, not inside
> the helper. See dynamic_cert_mem_cache_size. dynamic_cert_mem_cache_size
> is not related to -M.
Tks, Alex. But wait,

dynamic_cert_mem_cache_size

is http(s)_port option?

>
>
> HTH,
>
> Alex.

-- 
*****************************
* C++20 : Bug to the future *
*****************************


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180210/93adb4ae/attachment.sig>

From rousskov at measurement-factory.com  Sat Feb 10 16:36:01 2018
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Sat, 10 Feb 2018 09:36:01 -0700
Subject: [squid-users] Squid SSL db on ramdisk
In-Reply-To: <5454c886-caac-4c3f-f32b-8d4855ba866c@gmail.com>
References: <10333b00-1900-e13d-d3da-a0ed79b81ade@gmail.com>
 <026663d1-1c20-f97b-3961-8d454bf64612@treenet.co.nz>
 <ff245589-9a93-7581-0e5f-861cb312d828@gmail.com>
 <7b61a00d-66ca-e504-e786-25ca750c0892@measurement-factory.com>
 <5454c886-caac-4c3f-f32b-8d4855ba866c@gmail.com>
Message-ID: <9669372b-0b1e-5a58-33bc-40f82832037a@measurement-factory.com>

On 02/10/2018 09:23 AM, Yuri wrote:

> I can set -M in according FS size, using for store SSL DB, correct?

Yes, -M limits the sum of sizes of all (serialized) certificates stored
in the helper database. The helper tries to account for the filesystem
block size, but I doubt its calculations are very precise.


> dynamic_cert_mem_cache_size is http(s)_port option?

Yes, it is. If the needed dynamically-generated certificate is found in
the dynamic certificate memory cache, then Squid does not ask the helper
to generate that certificate. This in-Squid RAM cache stores raw (not
serialized) certificates. As you know, Squid does not compute the size
of raw (not serialized) certificates correctly, resulting in bug #4005
issues: https://bugs.squid-cache.org/show_bug.cgi?id=4005

Alex.


From yvoinov at gmail.com  Sat Feb 10 16:39:30 2018
From: yvoinov at gmail.com (Yuri)
Date: Sat, 10 Feb 2018 22:39:30 +0600
Subject: [squid-users] Squid SSL db on ramdisk
In-Reply-To: <9669372b-0b1e-5a58-33bc-40f82832037a@measurement-factory.com>
References: <10333b00-1900-e13d-d3da-a0ed79b81ade@gmail.com>
 <026663d1-1c20-f97b-3961-8d454bf64612@treenet.co.nz>
 <ff245589-9a93-7581-0e5f-861cb312d828@gmail.com>
 <7b61a00d-66ca-e504-e786-25ca750c0892@measurement-factory.com>
 <5454c886-caac-4c3f-f32b-8d4855ba866c@gmail.com>
 <9669372b-0b1e-5a58-33bc-40f82832037a@measurement-factory.com>
Message-ID: <20ee9b8b-ab0a-0adb-2216-2f7ec5e181a1@gmail.com>



10.02.2018 22:36, Alex Rousskov ?????:
> On 02/10/2018 09:23 AM, Yuri wrote:
>
>> I can set -M in according FS size, using for store SSL DB, correct?
> Yes, -M limits the sum of sizes of all (serialized) certificates stored
> in the helper database. The helper tries to account for the filesystem
> block size, but I doubt its calculations are very precise.
Tks for clarifying :)
Got it. Will correct my configs :-)
>
>
>> dynamic_cert_mem_cache_size is http(s)_port option?
> Yes, it is. If the needed dynamically-generated certificate is found in
> the dynamic certificate memory cache, then Squid does not ask the helper
> to generate that certificate. This in-Squid RAM cache stores raw (not
> serialized) certificates. As you know, Squid does not compute the size
> of raw (not serialized) certificates correctly, resulting in bug #4005
> issues: https://bugs.squid-cache.org/show_bug.cgi?id=4005
Aha, and in this case helper speed is critical and using helper storage
on ramdisk will very useful....
>
> Alex.

-- 
*****************************
* C++20 : Bug to the future *
*****************************


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180210/876ae33f/attachment.sig>

From yvoinov at gmail.com  Sat Feb 10 17:03:50 2018
From: yvoinov at gmail.com (Yuri)
Date: Sat, 10 Feb 2018 23:03:50 +0600
Subject: [squid-users] Squid SSL db on ramdisk
In-Reply-To: <20ee9b8b-ab0a-0adb-2216-2f7ec5e181a1@gmail.com>
References: <10333b00-1900-e13d-d3da-a0ed79b81ade@gmail.com>
 <026663d1-1c20-f97b-3961-8d454bf64612@treenet.co.nz>
 <ff245589-9a93-7581-0e5f-861cb312d828@gmail.com>
 <7b61a00d-66ca-e504-e786-25ca750c0892@measurement-factory.com>
 <5454c886-caac-4c3f-f32b-8d4855ba866c@gmail.com>
 <9669372b-0b1e-5a58-33bc-40f82832037a@measurement-factory.com>
 <20ee9b8b-ab0a-0adb-2216-2f7ec5e181a1@gmail.com>
Message-ID: <45753355-1f53-d4d9-224c-f0de08878490@gmail.com>

One more question.

What is correct syntax for -M option? I'm just in doubt. Helper eats -M
5MB, but not -M 1024MB, however eats -M 1 GB.

root @ lemanruss /patch/tmp #
/usr/local/squid/libexec/security_file_certgen -s /ramdisk1/ssl_db -M 2GB
/usr/local/squid/libexec/security_file_certgen: Error when parsing -M
options value
root @ lemanruss /patch/tmp #
/usr/local/squid/libexec/security_file_certgen -s /ramdisk1/ssl_db -M 2 GB
^C
root @ lemanruss /patch/tmp #
/usr/local/squid/libexec/security_file_certgen -s /ramdisk1/ssl_db -M 2GB
/usr/local/squid/libexec/security_file_certgen: Error when parsing -M
options value
root @ lemanruss /patch/tmp #
/usr/local/squid/libexec/security_file_certgen -s /ramdisk1/ssl_db -M 5MB
^C
root @ lemanruss /patch/tmp #
/usr/local/squid/libexec/security_file_certgen -s /ramdisk1/ssl_db -M 5GB
/usr/local/squid/libexec/security_file_certgen: Error when parsing -M
options value
root @ lemanruss /patch/tmp #
/usr/local/squid/libexec/security_file_certgen -s /ramdisk1/ssl_db -M 5 MB
^C
root @ lemanruss /patch/tmp #
/usr/local/squid/libexec/security_file_certgen -s /ramdisk1/ssl_db -M 1024MB
/usr/local/squid/libexec/security_file_certgen: Error when parsing -M
options value
root @ lemanruss /patch/tmp #
/usr/local/squid/libexec/security_file_certgen -s /ramdisk1/ssl_db -M
1024 MB
^C

How to correctly specify -M with 2 Gb size?


10.02.2018 22:39, Yuri ?????:
>
> 10.02.2018 22:36, Alex Rousskov ?????:
>> On 02/10/2018 09:23 AM, Yuri wrote:
>>
>>> I can set -M in according FS size, using for store SSL DB, correct?
>> Yes, -M limits the sum of sizes of all (serialized) certificates stored
>> in the helper database. The helper tries to account for the filesystem
>> block size, but I doubt its calculations are very precise.
> Tks for clarifying :)
> Got it. Will correct my configs :-)
>>
>>> dynamic_cert_mem_cache_size is http(s)_port option?
>> Yes, it is. If the needed dynamically-generated certificate is found in
>> the dynamic certificate memory cache, then Squid does not ask the helper
>> to generate that certificate. This in-Squid RAM cache stores raw (not
>> serialized) certificates. As you know, Squid does not compute the size
>> of raw (not serialized) certificates correctly, resulting in bug #4005
>> issues: https://bugs.squid-cache.org/show_bug.cgi?id=4005
> Aha, and in this case helper speed is critical and using helper storage
> on ramdisk will very useful....
>> Alex.

-- 
*****************************
* C++20 : Bug to the future *
*****************************


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180210/6a29dc7a/attachment.sig>

From squid3 at treenet.co.nz  Sat Feb 10 17:23:13 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sun, 11 Feb 2018 06:23:13 +1300
Subject: [squid-users] Can reverse_proxy be set as a rotating proxy?
In-Reply-To: <CABrM6wn7CEW0zp4CGyA+SxjeBw+Nuh6uiS-Dw1ecke6d-n+s=w@mail.gmail.com>
References: <CABrM6wn7CEW0zp4CGyA+SxjeBw+Nuh6uiS-Dw1ecke6d-n+s=w@mail.gmail.com>
Message-ID: <dd5c21d7-3b6e-c094-31d2-efae4872e1e8@treenet.co.nz>

On 11/02/18 05:18, Peng Yu wrote:
> Hi,
> 
> I am not sure what the policy of reverse proxy is in squid. Using the
> notation in this figure, can squid on "proxy" be set to use "web
> servers" one after another for each request (i.e., rotating)? Thanks.
> 


see <https://wiki.squid-cache.org/Features/LoadBalance> for the set of
load balancing algorithms you can configure Squid to use when selecting
upstream peers. The round-robin algorithm is probably what you are wanting.


Amos


From pengyu.ut at gmail.com  Sat Feb 10 17:33:29 2018
From: pengyu.ut at gmail.com (Peng Yu)
Date: Sat, 10 Feb 2018 11:33:29 -0600
Subject: [squid-users] How to set up a reverse proxy using squid for a
	simplified scenario?
Message-ID: <CABrM6wk9eqP7HVKo+nTxg32hMpw7m1rtCVu92daK_Z-zwFvd9A@mail.gmail.com>

Hi,

I see the following blog about setting up a reverse proxy using squid.

http://derpturkey.com/squid-as-a-reverse-proxy/

But there seem to be more configurations than what I need.

For example, for the following line, I don't need to restrict the
access to a specific domain.
http_port 80 accel defaultsite=www.example.com

Instead, any access to the IP of the reverse proxy should be OK. In
this sense, should I just use the following?

http_port 80 accel

Also, let's say I have two web servers server1 and server2 to be
proxied. Since I don't use a domain, I am not sure how Step 3 should
be adjusted.

I also do not want any restrictions to my reverse proxy. But I am not
sure how Step 4 should be simplified.

Could anybody please let me know how to configure squid reverse proxy
in my simplified scenario?

--
Regards,
Peng


From squid3 at treenet.co.nz  Sat Feb 10 18:09:25 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sun, 11 Feb 2018 07:09:25 +1300
Subject: [squid-users] How to set up a reverse proxy using squid for a
 simplified scenario?
In-Reply-To: <CABrM6wk9eqP7HVKo+nTxg32hMpw7m1rtCVu92daK_Z-zwFvd9A@mail.gmail.com>
References: <CABrM6wk9eqP7HVKo+nTxg32hMpw7m1rtCVu92daK_Z-zwFvd9A@mail.gmail.com>
Message-ID: <2e1963ea-170d-be7f-46ad-c3e52c31d63c@treenet.co.nz>

On 11/02/18 06:33, Peng Yu wrote:
> Hi,
> 
> I see the following blog about setting up a reverse proxy using squid.
> 
> http://derpturkey.com/squid-as-a-reverse-proxy/
> 
> But there seem to be more configurations than what I need.
> 
> For example, for the following line, I don't need to restrict the
> access to a specific domain.
> http_port 80 accel defaultsite=www.example.com

The above does not *restrict*. It sets a default value for Squid to use
when the Host header is missing from HTTP requests.


> 
> Instead, any access to the IP of the reverse proxy should be OK. In
> this sense, should I just use the following?
> 
> http_port 80 accel

You can if you want to. But be aware that any clients which omit the
Host header in their requests will be rejected by the proxy with an
error page.


> 
> Also, let's say I have two web servers server1 and server2 to be
> proxied. Since I don't use a domain, I am not sure how Step 3 should
> be adjusted.

By using other types of ACLs in an arrangement which meets your desired
mapping.

Please read the FAQ about how ACLs work. That includes a list of
different ACLs.
<http://wiki.squid-cache.org/SquidFaq/SquidAcl>


So far as you have stated that would be "cache_peer ... allow all".

Which is a very bad idea...

Be aware that the domain based config is itself a security layer to
prevent attackers and certain type of DoS reaching through the proxy to
attack the peers directly with bogus traffic. Using other types of ACLs,
particularly ones leading to "no restriction" like you describe make
your proxy and the origins all at risk for denial of service attacks.


What is your reason for wanting "no restrictions"?
 it could be that you actually need something very different to what you
are asking about.


> 
> I also do not want any restrictions to my reverse proxy. But I am not
> sure how Step 4 should be simplified.
> 
> Could anybody please let me know how to configure squid reverse proxy
> in my simplified scenario?

That tutorial is describing the simplest scenario possible with a
multiple peers in a reverse-proxy.

Yours is actually the more complicated scenario since you apparently
need some unusual ACL configuration.


Amos


From rousskov at measurement-factory.com  Sat Feb 10 18:59:25 2018
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Sat, 10 Feb 2018 11:59:25 -0700
Subject: [squid-users] Squid SSL db on ramdisk
In-Reply-To: <45753355-1f53-d4d9-224c-f0de08878490@gmail.com>
References: <10333b00-1900-e13d-d3da-a0ed79b81ade@gmail.com>
 <026663d1-1c20-f97b-3961-8d454bf64612@treenet.co.nz>
 <ff245589-9a93-7581-0e5f-861cb312d828@gmail.com>
 <7b61a00d-66ca-e504-e786-25ca750c0892@measurement-factory.com>
 <5454c886-caac-4c3f-f32b-8d4855ba866c@gmail.com>
 <9669372b-0b1e-5a58-33bc-40f82832037a@measurement-factory.com>
 <20ee9b8b-ab0a-0adb-2216-2f7ec5e181a1@gmail.com>
 <45753355-1f53-d4d9-224c-f0de08878490@gmail.com>
Message-ID: <d1332917-dc86-c0c9-bed1-2efb6c14fa60@measurement-factory.com>

On 02/10/2018 10:03 AM, Yuri wrote:

> What is correct syntax for -M option?

The correct syntax is, roughly,

  -M <integer>[bytes|KB|MB|GB]

with "bytes" as the default unit.

However, you found a bug in the parsing code: The helper mishandles
values exceeding 2147483647 bytes (on most platforms) due to a signed
integer overflow in helper's parseBytesOptionValue().

Furthermore, I have not tested it, but I suspect there is at least one
bug in the mainline parseBytesOptionValue() code as well. Both functions
should be rewritten (even if the second one "works"), and the correct
format should be documented (including size limits).


> How to correctly specify -M with 2 Gb size?

You cannot specify that size until the above-mentioned bug is fixed.

Alex.


From yvoinov at gmail.com  Sat Feb 10 19:02:10 2018
From: yvoinov at gmail.com (Yuri)
Date: Sun, 11 Feb 2018 01:02:10 +0600
Subject: [squid-users] Squid SSL db on ramdisk
In-Reply-To: <d1332917-dc86-c0c9-bed1-2efb6c14fa60@measurement-factory.com>
References: <10333b00-1900-e13d-d3da-a0ed79b81ade@gmail.com>
 <026663d1-1c20-f97b-3961-8d454bf64612@treenet.co.nz>
 <ff245589-9a93-7581-0e5f-861cb312d828@gmail.com>
 <7b61a00d-66ca-e504-e786-25ca750c0892@measurement-factory.com>
 <5454c886-caac-4c3f-f32b-8d4855ba866c@gmail.com>
 <9669372b-0b1e-5a58-33bc-40f82832037a@measurement-factory.com>
 <20ee9b8b-ab0a-0adb-2216-2f7ec5e181a1@gmail.com>
 <45753355-1f53-d4d9-224c-f0de08878490@gmail.com>
 <d1332917-dc86-c0c9-bed1-2efb6c14fa60@measurement-factory.com>
Message-ID: <6acea459-a72a-97f8-cb91-45c85b60eee4@gmail.com>



11.02.2018 00:59, Alex Rousskov ?????:
> On 02/10/2018 10:03 AM, Yuri wrote:
>
>> What is correct syntax for -M option?
> The correct syntax is, roughly,
>
>   -M <integer>[bytes|KB|MB|GB]
Exactly with space between integer and units?
>
> with "bytes" as the default unit.
>
> However, you found a bug in the parsing code: The helper mishandles
> values exceeding 2147483647 bytes (on most platforms) due to a signed
> integer overflow in helper's parseBytesOptionValue().
>
> Furthermore, I have not tested it, but I suspect there is at least one
> bug in the mainline parseBytesOptionValue() code as well. Both functions
> should be rewritten (even if the second one "works"), and the correct
> format should be documented (including size limits).
>
>
>> How to correctly specify -M with 2 Gb size?
> You cannot specify that size until the above-mentioned bug is fixed.
>
> Alex.

-- 
*****************************
* C++20 : Bug to the future *
*****************************


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180211/4529ed70/attachment.sig>

From rousskov at measurement-factory.com  Sat Feb 10 19:04:37 2018
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Sat, 10 Feb 2018 12:04:37 -0700
Subject: [squid-users] Squid SSL db on ramdisk
In-Reply-To: <6acea459-a72a-97f8-cb91-45c85b60eee4@gmail.com>
References: <10333b00-1900-e13d-d3da-a0ed79b81ade@gmail.com>
 <026663d1-1c20-f97b-3961-8d454bf64612@treenet.co.nz>
 <ff245589-9a93-7581-0e5f-861cb312d828@gmail.com>
 <7b61a00d-66ca-e504-e786-25ca750c0892@measurement-factory.com>
 <5454c886-caac-4c3f-f32b-8d4855ba866c@gmail.com>
 <9669372b-0b1e-5a58-33bc-40f82832037a@measurement-factory.com>
 <20ee9b8b-ab0a-0adb-2216-2f7ec5e181a1@gmail.com>
 <45753355-1f53-d4d9-224c-f0de08878490@gmail.com>
 <d1332917-dc86-c0c9-bed1-2efb6c14fa60@measurement-factory.com>
 <6acea459-a72a-97f8-cb91-45c85b60eee4@gmail.com>
Message-ID: <74c6c431-8405-fef4-ce2d-8a460dedff53@measurement-factory.com>

On 02/10/2018 12:02 PM, Yuri wrote:
> 
> 
> 11.02.2018 00:59, Alex Rousskov ?????:
>> On 02/10/2018 10:03 AM, Yuri wrote:
>>
>>> What is correct syntax for -M option?
>> The correct syntax is, roughly,
>>
>>   -M <integer>[bytes|KB|MB|GB]

> Exactly with space between integer and units?

Without anything between integer and units. For example: 2GB

Alex.


From yvoinov at gmail.com  Sat Feb 10 19:08:05 2018
From: yvoinov at gmail.com (Yuri)
Date: Sun, 11 Feb 2018 01:08:05 +0600
Subject: [squid-users] Squid SSL db on ramdisk
In-Reply-To: <74c6c431-8405-fef4-ce2d-8a460dedff53@measurement-factory.com>
References: <10333b00-1900-e13d-d3da-a0ed79b81ade@gmail.com>
 <026663d1-1c20-f97b-3961-8d454bf64612@treenet.co.nz>
 <ff245589-9a93-7581-0e5f-861cb312d828@gmail.com>
 <7b61a00d-66ca-e504-e786-25ca750c0892@measurement-factory.com>
 <5454c886-caac-4c3f-f32b-8d4855ba866c@gmail.com>
 <9669372b-0b1e-5a58-33bc-40f82832037a@measurement-factory.com>
 <20ee9b8b-ab0a-0adb-2216-2f7ec5e181a1@gmail.com>
 <45753355-1f53-d4d9-224c-f0de08878490@gmail.com>
 <d1332917-dc86-c0c9-bed1-2efb6c14fa60@measurement-factory.com>
 <6acea459-a72a-97f8-cb91-45c85b60eee4@gmail.com>
 <74c6c431-8405-fef4-ce2d-8a460dedff53@measurement-factory.com>
Message-ID: <e10e15df-d348-f50a-9910-420d2018f75f@gmail.com>

int m; declaration inside static bool parseBytesOptionValue(size_t *
bptr, char const * value) ?

If I set it long, as by as int d, seems ok.


11.02.2018 01:04, Alex Rousskov ?????:
> On 02/10/2018 12:02 PM, Yuri wrote:
>>
>> 11.02.2018 00:59, Alex Rousskov ?????:
>>> On 02/10/2018 10:03 AM, Yuri wrote:
>>>
>>>> What is correct syntax for -M option?
>>> The correct syntax is, roughly,
>>>
>>>   -M <integer>[bytes|KB|MB|GB]
>> Exactly with space between integer and units?
> Without anything between integer and units. For example: 2GB
>
> Alex.

-- 
*****************************
* C++20 : Bug to the future *
*****************************


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180211/a8359b25/attachment.sig>

From yvoinov at gmail.com  Sat Feb 10 19:56:37 2018
From: yvoinov at gmail.com (Yuri)
Date: Sun, 11 Feb 2018 01:56:37 +0600
Subject: [squid-users] Squid SSL db on ramdisk
In-Reply-To: <e10e15df-d348-f50a-9910-420d2018f75f@gmail.com>
References: <10333b00-1900-e13d-d3da-a0ed79b81ade@gmail.com>
 <026663d1-1c20-f97b-3961-8d454bf64612@treenet.co.nz>
 <ff245589-9a93-7581-0e5f-861cb312d828@gmail.com>
 <7b61a00d-66ca-e504-e786-25ca750c0892@measurement-factory.com>
 <5454c886-caac-4c3f-f32b-8d4855ba866c@gmail.com>
 <9669372b-0b1e-5a58-33bc-40f82832037a@measurement-factory.com>
 <20ee9b8b-ab0a-0adb-2216-2f7ec5e181a1@gmail.com>
 <45753355-1f53-d4d9-224c-f0de08878490@gmail.com>
 <d1332917-dc86-c0c9-bed1-2efb6c14fa60@measurement-factory.com>
 <6acea459-a72a-97f8-cb91-45c85b60eee4@gmail.com>
 <74c6c431-8405-fef4-ce2d-8a460dedff53@measurement-factory.com>
 <e10e15df-d348-f50a-9910-420d2018f75f@gmail.com>
Message-ID: <6487c039-9ca2-09c5-a7f5-d86110883193@gmail.com>

Yes, confirmed.

When I've replaced int m; and int d; to long m; and long d; - works like
charm.


11.02.2018 01:08, Yuri ?????:
> int m; declaration inside static bool parseBytesOptionValue(size_t *
> bptr, char const * value) ?
>
> If I set it long, as by as int d, seems ok.
>
>
> 11.02.2018 01:04, Alex Rousskov ?????:
>> On 02/10/2018 12:02 PM, Yuri wrote:
>>> 11.02.2018 00:59, Alex Rousskov ?????:
>>>> On 02/10/2018 10:03 AM, Yuri wrote:
>>>>
>>>>> What is correct syntax for -M option?
>>>> The correct syntax is, roughly,
>>>>
>>>>   -M <integer>[bytes|KB|MB|GB]
>>> Exactly with space between integer and units?
>> Without anything between integer and units. For example: 2GB
>>
>> Alex.

-- 
*****************************
* C++20 : Bug to the future *
*****************************


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180211/d6dabbef/attachment.sig>

From pengyu.ut at gmail.com  Sat Feb 10 20:26:00 2018
From: pengyu.ut at gmail.com (Peng Yu)
Date: Sat, 10 Feb 2018 14:26:00 -0600
Subject: [squid-users] How to set up a reverse proxy using squid for a
 simplified scenario?
In-Reply-To: <2e1963ea-170d-be7f-46ad-c3e52c31d63c@treenet.co.nz>
References: <CABrM6wk9eqP7HVKo+nTxg32hMpw7m1rtCVu92daK_Z-zwFvd9A@mail.gmail.com>
 <2e1963ea-170d-be7f-46ad-c3e52c31d63c@treenet.co.nz>
Message-ID: <CABrM6wmRUCr+5qqQUcsdGdso_YpfQpSUS8agU_-AKkK00oqxPA@mail.gmail.com>

> What is your reason for wanting "no restrictions"?

The proxied servers are behind a firewall already, which protect them
from any unwanted access. Is this reason strong enough to have no
restrictions set?

-- 
Regards,
Peng


From yvoinov at gmail.com  Sat Feb 10 20:29:14 2018
From: yvoinov at gmail.com (Yuri)
Date: Sun, 11 Feb 2018 02:29:14 +0600
Subject: [squid-users] How to set up a reverse proxy using squid for a
 simplified scenario?
In-Reply-To: <CABrM6wmRUCr+5qqQUcsdGdso_YpfQpSUS8agU_-AKkK00oqxPA@mail.gmail.com>
References: <CABrM6wk9eqP7HVKo+nTxg32hMpw7m1rtCVu92daK_Z-zwFvd9A@mail.gmail.com>
 <2e1963ea-170d-be7f-46ad-c3e52c31d63c@treenet.co.nz>
 <CABrM6wmRUCr+5qqQUcsdGdso_YpfQpSUS8agU_-AKkK00oqxPA@mail.gmail.com>
Message-ID: <a832da47-58f4-0843-bc8a-40ac914406b8@gmail.com>

No. This reason is obviously not strong enough. As by as requirement
configure firewalls also on servers - whenever they placed. Security in
depth - did you hear this term?


11.02.2018 02:26, Peng Yu ?????:
>> What is your reason for wanting "no restrictions"?
> The proxied servers are behind a firewall already, which protect them
> from any unwanted access. Is this reason strong enough to have no
> restrictions set?
>

-- 
*****************************
* C++20 : Bug to the future *
*****************************


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180211/fd18b5bc/attachment.sig>

From yvoinov at gmail.com  Sat Feb 10 20:39:38 2018
From: yvoinov at gmail.com (Yuri)
Date: Sun, 11 Feb 2018 02:39:38 +0600
Subject: [squid-users] How to set up a reverse proxy using squid for a
 simplified scenario?
In-Reply-To: <a832da47-58f4-0843-bc8a-40ac914406b8@gmail.com>
References: <CABrM6wk9eqP7HVKo+nTxg32hMpw7m1rtCVu92daK_Z-zwFvd9A@mail.gmail.com>
 <2e1963ea-170d-be7f-46ad-c3e52c31d63c@treenet.co.nz>
 <CABrM6wmRUCr+5qqQUcsdGdso_YpfQpSUS8agU_-AKkK00oqxPA@mail.gmail.com>
 <a832da47-58f4-0843-bc8a-40ac914406b8@gmail.com>
Message-ID: <82bce96b-4849-6328-f2e0-047f321c08f3@gmail.com>

Ah. My bad. Correctly Defence in depth:

https://en.wikipedia.org/wiki/Defense_in_depth_(computing)


11.02.2018 02:29, Yuri ?????:
> No. This reason is obviously not strong enough. As by as requirement
> configure firewalls also on servers - whenever they placed. Security in
> depth - did you hear this term?
>
>
> 11.02.2018 02:26, Peng Yu ?????:
>>> What is your reason for wanting "no restrictions"?
>> The proxied servers are behind a firewall already, which protect them
>> from any unwanted access. Is this reason strong enough to have no
>> restrictions set?
>>

-- 
*****************************
* C++20 : Bug to the future *
*****************************


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180211/4bf6fcfd/attachment.sig>

From bestluxna1 at yahoo.com  Sun Feb 11 00:51:07 2018
From: bestluxna1 at yahoo.com (Michael D)
Date: Sun, 11 Feb 2018 00:51:07 +0000 (UTC)
Subject: [squid-users] custom logfile_daemon causing FATAL error
References: <2023989277.402418.1518310267874.ref@mail.yahoo.com>
Message-ID: <2023989277.402418.1518310267874@mail.yahoo.com>

Greetings all,?
I have been attempting to write my own logfile_daemon for experimental purposes, but any daemon I provide causes "FATAL: I don't handle this error well". I also see "logfileHandleWrite: daemon:/var/log/squid/access.log: error writing ((32) Broken pipe)" with no other errors in the cache.log. I have read all possible docs about writing a custom logfile_daemon, but I have had no luck. For testing purposes my daemon is just a bash script that creates a file and pipes random text to it. The creation of the file/writing text to the file works fine, but soon after squid just dies. I have no help from the cache.log or squid.out.
The only line I have added to my squid.conf is "logfile_daemon /etc/squid/hi.sh". This causes the fatal error. I have also tried explicitly setting my access_log directive as well "access_log daemon:/var/log/squid/access.log squid", but that still does not work. Thanks in advance.
-Mike
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180211/4d0095f8/attachment.htm>

From rousskov at measurement-factory.com  Sun Feb 11 02:26:44 2018
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Sat, 10 Feb 2018 19:26:44 -0700
Subject: [squid-users] custom logfile_daemon causing FATAL error
In-Reply-To: <2023989277.402418.1518310267874@mail.yahoo.com>
References: <2023989277.402418.1518310267874.ref@mail.yahoo.com>
 <2023989277.402418.1518310267874@mail.yahoo.com>
Message-ID: <ce43f1aa-d895-43eb-439b-ecb1d414e2d0@measurement-factory.com>

On 02/10/2018 05:51 PM, Michael D wrote:
> Greetings all,?
> 
> I have been attempting to write my own logfile_daemon for experimental
> purposes, but any daemon I provide causes "FATAL: I don't handle this
> error well". I also see "logfileHandleWrite:
> daemon:/var/log/squid/access.log: error writing ((32) Broken pipe)" with
> no other errors in the cache.log.

It sounds like your daemon quits without Squid permission. Logging
daemons should not do that because Squid considers such behavior a FATAL
error.


> I have read all possible docs about
> writing a custom logfile_daemon, but I have had no luck. For testing
> purposes my daemon is just a bash script that creates a file and pipes
> random text to it. The creation of the file/writing text to the file
> works fine, but soon after squid just dies. I have no help from the
> cache.log or squid.out.

Since you did not share your code, I have to ask: Does your shell script
actually read logging commands sent by Squid? Or does it simply quit
after writing some "random text" to some file? Squid expects the daemon
to run until the daemon reads EOF on stdin... The daemon does not have
to handle the commands it reads, but it has to keep reading them until EOF.

If you want to add debugging to your daemon, try writing write to stderr.

For the list of logging commands, please see
https://wiki.squid-cache.org/Features/LogModules#Daemon_Message_Protocol
a.k.a.
https://wiki.squid-cache.org/Features/AddonHelpers#Logging


HTH,

Alex.


> The only line I have added to my squid.conf is "logfile_daemon
> /etc/squid/hi.sh". This causes the fatal error. I have also tried
> explicitly setting my access_log directive as well "access_log
> daemon:/var/log/squid/access.log squid", but that still does not work.
> Thanks in advance.
> 
> -Mike
> 
> 
> 
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 



From squid3 at treenet.co.nz  Sun Feb 11 06:09:36 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sun, 11 Feb 2018 19:09:36 +1300
Subject: [squid-users] How to set up a reverse proxy using squid for a
 simplified scenario?
In-Reply-To: <82bce96b-4849-6328-f2e0-047f321c08f3@gmail.com>
References: <CABrM6wk9eqP7HVKo+nTxg32hMpw7m1rtCVu92daK_Z-zwFvd9A@mail.gmail.com>
 <2e1963ea-170d-be7f-46ad-c3e52c31d63c@treenet.co.nz>
 <CABrM6wmRUCr+5qqQUcsdGdso_YpfQpSUS8agU_-AKkK00oqxPA@mail.gmail.com>
 <a832da47-58f4-0843-bc8a-40ac914406b8@gmail.com>
 <82bce96b-4849-6328-f2e0-047f321c08f3@gmail.com>
Message-ID: <cf42bdcc-1617-a979-66aa-016f98098a00@treenet.co.nz>

On 11/02/18 09:39, Yuri wrote:
> Ah. My bad. Correctly Defence in depth:
> 
> https://en.wikipedia.org/wiki/Defense_in_depth_(computing)
> 
> 
> 11.02.2018 02:29, Yuri ?????:
>> No. This reason is obviously not strong enough. As by as requirement
>> configure firewalls also on servers - whenever they placed. Security in
>> depth - did you hear this term?
>>
>>
>> 11.02.2018 02:26, Peng Yu ?????:
>>>> What is your reason for wanting "no restrictions"?
>>> The proxied servers are behind a firewall already, which protect them
>>> from any unwanted access. Is this reason strong enough to have no
>>> restrictions set?
>>>
> 

Indeed as Yuri said. Firewall rules are not enough.

The proxy is making connections from *inside* the network. A firewall at
the network edge cannot prevent, nor even see these.

Amos


From m_zouhairy at skno.by  Mon Feb 12 08:15:41 2018
From: m_zouhairy at skno.by (Vacheslav)
Date: Mon, 12 Feb 2018 11:15:41 +0300
Subject: [squid-users] Squid SSL db on ramdisk
In-Reply-To: <6487c039-9ca2-09c5-a7f5-d86110883193@gmail.com>
References: <10333b00-1900-e13d-d3da-a0ed79b81ade@gmail.com>
 <026663d1-1c20-f97b-3961-8d454bf64612@treenet.co.nz>
 <ff245589-9a93-7581-0e5f-861cb312d828@gmail.com>
 <7b61a00d-66ca-e504-e786-25ca750c0892@measurement-factory.com>
 <5454c886-caac-4c3f-f32b-8d4855ba866c@gmail.com>
 <9669372b-0b1e-5a58-33bc-40f82832037a@measurement-factory.com>
 <20ee9b8b-ab0a-0adb-2216-2f7ec5e181a1@gmail.com>
 <45753355-1f53-d4d9-224c-f0de08878490@gmail.com>
 <d1332917-dc86-c0c9-bed1-2efb6c14fa60@measurement-factory.com>
 <6acea459-a72a-97f8-cb91-45c85b60eee4@gmail.com>
 <74c6c431-8405-fef4-ce2d-8a460dedff53@measurement-factory.com>
 <e10e15df-d348-f50a-9910-420d2018f75f@gmail.com>
 <6487c039-9ca2-09c5-a7f5-d86110883193@gmail.com>
Message-ID: <007f01d3a3d9$ac9c1fe0$05d45fa0$@skno.by>

Works like a charm is a stubborn phrase, never experienced that when being charmed one problem is gone and replaced with numerous others, like sick relatives?

-----Original Message-----
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Yuri
Sent: Saturday, February 10, 2018 10:57 PM
To: Alex Rousskov <rousskov at measurement-factory.com>; squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Squid SSL db on ramdisk

Yes, confirmed.

When I've replaced int m; and int d; to long m; and long d; - works like charm.


11.02.2018 01:08, Yuri ?????:
> int m; declaration inside static bool parseBytesOptionValue(size_t * 
> bptr, char const * value) ?
>
> If I set it long, as by as int d, seems ok.
>
>
> 11.02.2018 01:04, Alex Rousskov ?????:
>> On 02/10/2018 12:02 PM, Yuri wrote:
>>> 11.02.2018 00:59, Alex Rousskov ?????:
>>>> On 02/10/2018 10:03 AM, Yuri wrote:
>>>>
>>>>> What is correct syntax for -M option?
>>>> The correct syntax is, roughly,
>>>>
>>>>   -M <integer>[bytes|KB|MB|GB]
>>> Exactly with space between integer and units?
>> Without anything between integer and units. For example: 2GB
>>
>> Alex.

--
*****************************
* C++20 : Bug to the future *
*****************************






From pengyu.ut at gmail.com  Mon Feb 12 11:40:20 2018
From: pengyu.ut at gmail.com (Peng Yu)
Date: Mon, 12 Feb 2018 05:40:20 -0600
Subject: [squid-users] How to set up a reverse proxy using squid for a
 simplified scenario?
In-Reply-To: <2e1963ea-170d-be7f-46ad-c3e52c31d63c@treenet.co.nz>
References: <CABrM6wk9eqP7HVKo+nTxg32hMpw7m1rtCVu92daK_Z-zwFvd9A@mail.gmail.com>
 <2e1963ea-170d-be7f-46ad-c3e52c31d63c@treenet.co.nz>
Message-ID: <CABrM6wnCwETo_0_TDX_eUAtvbkRUwsngiweMu_6UFSAbb_iCaw@mail.gmail.com>

It is still not difficult to completely comprehend the squid document
to see how to modify the example at derpturkey.com for my following
scenario.

I have a bunch of forward proxy servers whose IPs are ip1 and ip2,
..., ip_n (using port 3128). The reverse proxy will use the
round-robin policy to forward each incoming request to one of these
forward proxies.

Do you mind giving me a minimal working configuration for my scenario?
Working means that the configure must be used directly without
modification (except domain names or IP addresses). Minimal means that
anything not relevant to my scenario should not be included in the
configuration.

BTW, to make sure make sure my understanding of forward proxy is
correct, could you confirm whether the proxies here are forward
proxies?

https://free-proxy-list.net/

On Sat, Feb 10, 2018 at 12:09 PM, Amos Jeffries <squid3 at treenet.co.nz> wrote:
> On 11/02/18 06:33, Peng Yu wrote:
>> Hi,
>>
>> I see the following blog about setting up a reverse proxy using squid.
>>
>> http://derpturkey.com/squid-as-a-reverse-proxy/
>>
>> But there seem to be more configurations than what I need.
>>
>> For example, for the following line, I don't need to restrict the
>> access to a specific domain.
>> http_port 80 accel defaultsite=www.example.com
>
> The above does not *restrict*. It sets a default value for Squid to use
> when the Host header is missing from HTTP requests.
>
>
>>
>> Instead, any access to the IP of the reverse proxy should be OK. In
>> this sense, should I just use the following?
>>
>> http_port 80 accel
>
> You can if you want to. But be aware that any clients which omit the
> Host header in their requests will be rejected by the proxy with an
> error page.
>
>
>>
>> Also, let's say I have two web servers server1 and server2 to be
>> proxied. Since I don't use a domain, I am not sure how Step 3 should
>> be adjusted.
>
> By using other types of ACLs in an arrangement which meets your desired
> mapping.
>
> Please read the FAQ about how ACLs work. That includes a list of
> different ACLs.
> <http://wiki.squid-cache.org/SquidFaq/SquidAcl>
>
>
> So far as you have stated that would be "cache_peer ... allow all".
>
> Which is a very bad idea...
>
> Be aware that the domain based config is itself a security layer to
> prevent attackers and certain type of DoS reaching through the proxy to
> attack the peers directly with bogus traffic. Using other types of ACLs,
> particularly ones leading to "no restriction" like you describe make
> your proxy and the origins all at risk for denial of service attacks.
>
>
> What is your reason for wanting "no restrictions"?
>  it could be that you actually need something very different to what you
> are asking about.
>
>
>>
>> I also do not want any restrictions to my reverse proxy. But I am not
>> sure how Step 4 should be simplified.
>>
>> Could anybody please let me know how to configure squid reverse proxy
>> in my simplified scenario?
>
> That tutorial is describing the simplest scenario possible with a
> multiple peers in a reverse-proxy.
>
> Yours is actually the more complicated scenario since you apparently
> need some unusual ACL configuration.
>
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



-- 
Regards,
Peng


From chiasa.men at web.de  Mon Feb 12 13:29:09 2018
From: chiasa.men at web.de (chiasa.men)
Date: Mon, 12 Feb 2018 14:29:09 +0100
Subject: [squid-users] Transition from squid3.5 to squid4;
	ciphers don't work anymore, ERROR: Unknown TLS option SINGLE_DH_USE
Message-ID: <2173350.boxqrhiZhZ@march>

Hi I tried squid4.

Squid Cache: Version 4.0.23 
This binary uses OpenSSL 1.1.1-dev  xx XXX xxxx

Before, I used:
Squid Cache: Version 3.5.27 
This binary uses OpenSSL 1.0.2g  1 Mar 2016

Some of the config directives changed:
E.g.
sslproxy_options SINGLE_DH_USE,SINGLE_ECDH_USE
->
tls_tls_outgoing_options options=SINGLE_DH_USE,SINGLE_ECDH_USE 

But that results in version 4 in the follwing errors (cache.log)
ERROR: Unknown TLS option SINGLE_DH_USE
ERROR: Unknown TLS option SINGLE_ECDH_USE

(same error with the same options in https_proxy)

Is that a problem related to the openssl version change?


In cache_peer I also have now to configure tls-cafile=/etc/ssl/certs/ca-
certificates.crt explicitly (I used some self signed certificates for testing - 
but in Squid3 I didn't need to configure that)
Otherwise I get: 
(71) Protocol error (TLS code: X509_V_ERR_SELF_SIGNED_CERT_IN_CHAIN)
In the reference it's stated that:
	tls-default-ca[=off]
			Whether to use the system Trusted CAs. Default is ON.
Shouldn't the tls-cafile option be unnecessary since it's trusted by default?



Furthermore I set Apache (the peer) to "SSLCipherSuite  ECDHE-ECDSA-AES256-
GCM-SHA384"
as well as cache_peer sslcipher=ECDHE-ECDSA-AES256-GCM-SHA384

ERROR: negotiating TLS on FD 20: error:141A90B5:SSL 
routines:ssl_cipher_list_to_bytes:no ciphers available (1/-1/0)

How can that be?






From yvoinov at gmail.com  Mon Feb 12 13:47:29 2018
From: yvoinov at gmail.com (Yuri)
Date: Mon, 12 Feb 2018 19:47:29 +0600
Subject: [squid-users] Squid SSL db on ramdisk
In-Reply-To: <007f01d3a3d9$ac9c1fe0$05d45fa0$@skno.by>
References: <10333b00-1900-e13d-d3da-a0ed79b81ade@gmail.com>
 <026663d1-1c20-f97b-3961-8d454bf64612@treenet.co.nz>
 <ff245589-9a93-7581-0e5f-861cb312d828@gmail.com>
 <7b61a00d-66ca-e504-e786-25ca750c0892@measurement-factory.com>
 <5454c886-caac-4c3f-f32b-8d4855ba866c@gmail.com>
 <9669372b-0b1e-5a58-33bc-40f82832037a@measurement-factory.com>
 <20ee9b8b-ab0a-0adb-2216-2f7ec5e181a1@gmail.com>
 <45753355-1f53-d4d9-224c-f0de08878490@gmail.com>
 <d1332917-dc86-c0c9-bed1-2efb6c14fa60@measurement-factory.com>
 <6acea459-a72a-97f8-cb91-45c85b60eee4@gmail.com>
 <74c6c431-8405-fef4-ce2d-8a460dedff53@measurement-factory.com>
 <e10e15df-d348-f50a-9910-420d2018f75f@gmail.com>
 <6487c039-9ca2-09c5-a7f5-d86110883193@gmail.com>
 <007f01d3a3d9$ac9c1fe0$05d45fa0$@skno.by>
Message-ID: <ad369ce2-e9fa-f31a-d199-53e56dc2f7f1@gmail.com>

If there is nothing to say on the topic - it's better to keep quiet.

I'm not talking with you. And when I need your opinion - I'll call you.


12.02.2018 14:15, Vacheslav ?????:
> Works like a charm is a stubborn phrase, never experienced that when being charmed one problem is gone and replaced with numerous others, like sick relatives?
>
> -----Original Message-----
> From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Yuri
> Sent: Saturday, February 10, 2018 10:57 PM
> To: Alex Rousskov <rousskov at measurement-factory.com>; squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] Squid SSL db on ramdisk
>
> Yes, confirmed.
>
> When I've replaced int m; and int d; to long m; and long d; - works like charm.
>
>
> 11.02.2018 01:08, Yuri ?????:
>> int m; declaration inside static bool parseBytesOptionValue(size_t * 
>> bptr, char const * value) ?
>>
>> If I set it long, as by as int d, seems ok.
>>
>>
>> 11.02.2018 01:04, Alex Rousskov ?????:
>>> On 02/10/2018 12:02 PM, Yuri wrote:
>>>> 11.02.2018 00:59, Alex Rousskov ?????:
>>>>> On 02/10/2018 10:03 AM, Yuri wrote:
>>>>>
>>>>>> What is correct syntax for -M option?
>>>>> The correct syntax is, roughly,
>>>>>
>>>>>   -M <integer>[bytes|KB|MB|GB]
>>>> Exactly with space between integer and units?
>>> Without anything between integer and units. For example: 2GB
>>>
>>> Alex.
> --
> *****************************
> * C++20 : Bug to the future *
> *****************************
>
>
>
>

-- 
*****************************
* C++20 : Bug to the future *
*****************************

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180212/42fa178a/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180212/42fa178a/attachment.sig>

From ahmed.zaeem at netstream.ps  Mon Feb 12 15:36:58 2018
From: ahmed.zaeem at netstream.ps (--Ahmad--)
Date: Mon, 12 Feb 2018 17:36:58 +0200
Subject: [squid-users] log external ip address in squid logs
Message-ID: <DCF8A4E5-C7DE-43C0-891A-92416E342F5F@netstream.ps>

Hello folks 

i had a look on 

http://www.squid-cache.org/Doc/config/logformat/


but i cant see the external ip address that used on squid 



say i have 10 ips with 10 ports

i would like to see the logs file with the external ip address that is matched with the acl ==> tcp_outgoing_address x.x.x.x yyy


i had a look on 

http://www.squid-cache.org/Doc/config/logformat/
and did find that option .


i have this FORMAT below :
logformat squid %tl %6tr %>a %>p %>la %>lp %Ss/%03Hs %<st %rm %ru %un %Sh/ %<A %<a

hope to help 

cheers 



From Antony.Stone at squid.open.source.it  Mon Feb 12 16:34:18 2018
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Mon, 12 Feb 2018 17:34:18 +0100
Subject: [squid-users] log external ip address in squid logs
In-Reply-To: <DCF8A4E5-C7DE-43C0-891A-92416E342F5F@netstream.ps>
References: <DCF8A4E5-C7DE-43C0-891A-92416E342F5F@netstream.ps>
Message-ID: <201802121734.18358.Antony.Stone@squid.open.source.it>

On Monday 12 February 2018 at 16:36:58, --Ahmad-- wrote:

> Hello folks
> 
> i had a look on
> http://www.squid-cache.org/Doc/config/logformat/
> but i cant see the external ip address that used on squid

> i had a look on
> http://www.squid-cache.org/Doc/config/logformat/
> and did find that option .

Hm, that's confusing.

> i have this FORMAT below :
> logformat squid %tl %6tr %>a %>p %>la %>lp %Ss/%03Hs %<st %rm %ru %un %Sh/
> %<A %<a

I think <la is what you're looking for (and possibly <lp as well).


Antony.

-- 
You can spend the whole of your life trying to be popular,
but at the end of the day the size of the crowd at your funeral
will be largely dictated by the weather.

 - Frank Skinner

                                                   Please reply to the list;
                                                         please *don't* CC me.


From xeron.oskom at gmail.com  Mon Feb 12 23:25:45 2018
From: xeron.oskom at gmail.com (Ivan Larionov)
Date: Mon, 12 Feb 2018 15:25:45 -0800
Subject: [squid-users] Cache reference age for heap LRU/LFUDA and
	rock/aufs
In-Reply-To: <630f50dd-1593-f01b-3a1d-d42ab104a376@measurement-factory.com>
References: <CAHvB88wNUsngm_uN6qrrHS3vAD17nooJPNkXQxJP9YRKe_27cg@mail.gmail.com>
 <630f50dd-1593-f01b-3a1d-d42ab104a376@measurement-factory.com>
Message-ID: <CAHvB88wLkyKqX1W6uD+K3wQ=_JvEa7MKi2OzeYATmeUz-fky+Q@mail.gmail.com>

On Fri, Feb 9, 2018 at 7:50 PM, Alex Rousskov <
rousskov at measurement-factory.com> wrote:

>
> I cannot answer your question for aufs, but please note that rock
> cache_dirs do not support/have/use a configurable replacement policy:
> Each incoming object is assigned a slot based on its key hash. With
> modern rock code, it is possible to remove that limitation IIRC, but
> nobody have done that.
>

Yeah I figured this out from the source code and I'm extremely surprised by
the fact that it was never mentioned in documentation. I think it will be a
huge blocker in our squid 4 + SMP + rock migration plan.

So what does rock do when storage is full then?


>
>
> > If you're wondering why would we need to know that ? it's related to
> > GDPR and removing data of closed customer's accounts. We need to make
> > sure that we don't have any "not being accessed anymore" objects older
> > than "data retention period" days.
>
> If it is important to get this right, then I would not trust replacement
> policy metadata with this: The corresponding code interfaces look
> unreliable to me, and access counts/timestamps for a ufs-based cache_dir
> are not updated across Squid restarts when the swap log is lost (at least).
>
>
It's actually fine, we never restart squid and if it restarted by any
unexpected reason (host reboot, crash or w/e) we just replace the host.


> I would instead configure Squid to prohibit serving hits that are too
> old. That solution does not match your problem exactly, but it may be
> good enough and should work a lot more reliably across all cache_dirs.
> If there is no "age" ACL to use with the send_hit directive, then you
> may need to add one.
>
>     http://www.squid-cache.org/Doc/config/send_hit/
>
> You may also be able to accomplish the same using refresh_pattern, but I
> am a little worroed about various exceptional/special conditions
> implemented on top of that directive. Others on this list may offer
> better guidance in this area.
>
>
I was thinking about similar solution but this is exactly why I wasn't able
to use it ? there seems to be no acl suitable for such task.

We can always just replace the host every month or something like this but
it'll mean starting with a cold cache every time which I wanted to avoid.

I found this debug option for heap which could probably help in
understanding of approximate cache age but it doesn't work with rock
because rock uses some "simple scan" policy.

> src/repl/heap/store_repl_heap.cc:        debugs(81, 3, "Heap age set to "
<< h->theHeap->age);


> HTH,
>
> Alex.
>



-- 
With best regards, Ivan Larionov.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180212/017ac570/attachment.htm>

From squid3 at treenet.co.nz  Tue Feb 13 14:20:05 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 14 Feb 2018 03:20:05 +1300
Subject: [squid-users] How to set up a reverse proxy using squid for a
 simplified scenario?
In-Reply-To: <CABrM6wnCwETo_0_TDX_eUAtvbkRUwsngiweMu_6UFSAbb_iCaw@mail.gmail.com>
References: <CABrM6wk9eqP7HVKo+nTxg32hMpw7m1rtCVu92daK_Z-zwFvd9A@mail.gmail.com>
 <2e1963ea-170d-be7f-46ad-c3e52c31d63c@treenet.co.nz>
 <CABrM6wnCwETo_0_TDX_eUAtvbkRUwsngiweMu_6UFSAbb_iCaw@mail.gmail.com>
Message-ID: <6a4c67ef-516a-ba97-ba02-f2028c4e92d9@treenet.co.nz>

On 13/02/18 00:40, Peng Yu wrote:
> It is still not difficult to completely comprehend the squid document
> to see how to modify the example at derpturkey.com for my following
> scenario.
> 
> I have a bunch of forward proxy servers whose IPs are ip1 and ip2,
> ..., ip_n (using port 3128). The reverse proxy will use the
> round-robin policy to forward each incoming request to one of these
> forward proxies.

Simply add "round-robin" option to the cache_peer lines in the
derpturkey example step #2. Otherwise do exactly as it says to do.



> 
> Do you mind giving me a minimal working configuration for my scenario?

You already have that in the derpturkey page.


> Working means that the configure must be used directly without
> modification (except domain names or IP addresses). Minimal means that
> anything not relevant to my scenario should not be included in the
> configuration.
> 
> BTW, to make sure make sure my understanding of forward proxy is
> correct, could you confirm whether the proxies here are forward
> proxies?

A forward-proxy is an HTTP proxy receiving absolute-form URLs
(<https://tools.ietf.org/html/rfc7230#section-5.3.2>) directly from clients.

A reverse-proxy is an HTTP proxy acting as surrogate for an origin
server and thus receiving origin-form URLs
(<https://tools.ietf.org/html/rfc7230#section-5.3.1>) from clients.


> 
> <elided>

A quick check of recent additions to that list shows a bunch of Apache
servers relaying traffic arbitrarily on port 80, and some Sophos AV
software running on personal computers, and some Cloud servers relayign
arbitrary traffic, and some misconfigured reverse-proxies, and some
forward-proxies, and some SOCKS proxies, and some TLS proxies, and some
broken student projects for writing proxies.

There is very much a mix of software types. It has all the appearance of
a malware bot net being sold for illegal uses. I hope you are not trying
to do such things.


Amos


From rousskov at measurement-factory.com  Tue Feb 13 15:45:18 2018
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Tue, 13 Feb 2018 08:45:18 -0700
Subject: [squid-users] Cache reference age for heap LRU/LFUDA and
 rock/aufs
In-Reply-To: <CAHvB88wLkyKqX1W6uD+K3wQ=_JvEa7MKi2OzeYATmeUz-fky+Q@mail.gmail.com>
References: <CAHvB88wNUsngm_uN6qrrHS3vAD17nooJPNkXQxJP9YRKe_27cg@mail.gmail.com>
 <630f50dd-1593-f01b-3a1d-d42ab104a376@measurement-factory.com>
 <CAHvB88wLkyKqX1W6uD+K3wQ=_JvEa7MKi2OzeYATmeUz-fky+Q@mail.gmail.com>
Message-ID: <3f657f87-1776-fa5e-ad39-bf251f8b63f6@measurement-factory.com>

On 02/12/2018 04:25 PM, Ivan Larionov wrote:
> On Fri, Feb 9, 2018 at 7:50 PM, Alex Rousskov wrote:
> 
>     please note that rock
>     cache_dirs do not support/have/use a configurable replacement policy:
>     Each incoming object is assigned a slot based on its key hash. With
>     modern rock code, it is possible to remove that limitation IIRC, but
>     nobody have done that.

> So what does rock do when storage is full then?

Becoming full is not a special condition for rock cache_dirs. In other
words, a rock cache_dir does not do anything special when it becomes (or
is) full.

Roughly speaking, when a rock cache_dir needs to store a new entry, it
computes its starting location by hashing the entry URL and starts
storing the entry at that location, overwriting any cached entry that
used the same starting location. Same for the shared memory cache. See
Ipc::StoreMap::openForWriting().

Rock is meant/optimized for large caches. The probability of overwriting
a valuable entry in a large cache is small -- most cached entries are
not valuable because they will never be requested again.

Needless to say, there are cases where such crude approach is harmful
(e.g., two popular entries competing for the same unlucky location and
overwriting each other). As I said, modern SMP caching code may have
enough bells and whistles to support such cases better, but the required
changes are still far from trivial, and nobody has contributed or
sponsored that improvement (yet?).


>     If it is important to get this right, then I would not trust replacement
>     policy metadata with this: The corresponding code interfaces look
>     unreliable to me, and access counts/timestamps for a ufs-based cache_dir
>     are not updated across Squid restarts when the swap log is lost (at
>     least).

> It's actually fine, we never restart squid and if it restarted by any
> unexpected reason (host reboot, crash or w/e) we just replace the host.

FWIW, please note that my "unreliable" remark applies to Squids that are
never restarted. YMMV.


>     If there is no "age" ACL to use with the send_hit directive, then you
>     may need to add one.
> 
> I was thinking about similar solution but this is exactly why I wasn't
> able to use it ? there seems to be no acl suitable for such task.

IMO, treating Squid feature set as a constant outside of your control
means ignoring 50% of Squid advantages (while suffering from 100% of its
drawbacks). One can add the missing pieces:

https://wiki.squid-cache.org/SquidFaq/AboutSquid#How_to_add_a_new_Squid_feature.2C_enhance.2C_of_fix_something.3F


HTH,

Alex.


From skupko.sk at gmail.com  Wed Feb 14 13:02:56 2018
From: skupko.sk at gmail.com (Peter Viskup)
Date: Wed, 14 Feb 2018 14:02:56 +0100
Subject: [squid-users] Squid4 with ssl-bump single_dh_use unknown
Message-ID: <CAPa6PsEFTxGBQ2pUidQcLe6B6GeW_WBueydW6v+wB_HX5UJg7A@mail.gmail.com>

Build of squid 4.0.23 on current Debian 9 report the single_dh_use as not known.
Older build of squid 3.5.21 on Debian 8 doesn't report it.
According the documentation [1] it should be known and supported.

[1] http://www.squid-cache.org/Doc/config/http_port/

Is it a bug?

Peter

$ /usr/sbin/squid -v
Squid Cache: Version 4.0.23
Service Name: squid
Squid built with SSLBump

This binary uses OpenSSL 1.1.0f  25 May 2017. For legal restrictions
on distribution see https://www.openssl.org/source/license.html

configure options:  '--build=x86_64-linux-gnu' '--prefix=/usr'
'--includedir=${prefix}/include' '--mandir=${prefix}/share/man'
'--infodir=${prefix}/share/info' '--sysconfdir=/etc'
'--localstatedir=/var' '--libexecdir=${prefix}/lib/squid' '--srcdir=.'
'--disable-maintainer-mode' '--disable-dependency-tracking'
'--disable-silent-rules' 'BUILDCXXFLAGS=-g -O2
-fdebug-prefix-map=/build/squid-4.0.23=. -fstack-protector-strong
-Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2
-Wl,-z,relro -Wl,-z,now -Wl,--as-needed' '--enable-build-info=Debian
linux' '--datadir=/usr/share/squid' '--sysconfdir=/etc/squid'
'--libexecdir=/usr/lib/squid' '--runstatedir=/var/run/squid'
'--mandir=/usr/share/man' '--enable-inline' '--disable-arch-native'
'--disable-loadable-modules' '--enable-storeio=aufs,rock'
'--enable-removal-policies=lru,heap' '--enable-delay-pools'
'--enable-cache-digests' '--enable-icap-client'
'--enable-follow-x-forwarded-for' '--enable-auth'
'--enable-external-acl-helpers=file_userip,session,SQL_session,time_quota,unix_group'
'--enable-security-cert-validators=fake'
'--enable-storeid-rewrite-helpers=file'
'--enable-url-rewrite-helpers=fake' '--enable-eui' '--disable-esi'
'--enable-icmp' '--enable-zph-qos' '--disable-ecap'
'--disable-translation' '--disable-ident-lookups'
'--with-swapdir=/var/spool/squid' '--with-logdir=/var/log/squid'
'--with-pidfile=/var/run/squid/squid.pid'
'--with-filedescriptors=65536' '--with-large-files'
'--with-default-user=proxy' '--enable-security-cert-generators=file'
'--enable-ssl-crtd' '--with-openssl' '--without-mit-krb5'
'--without-heimdal-krb5' '--disable-wccp' '--disable-wccpv2'
'--disable-ipv6' '--enable-build-info=Squid built with SSLBump'
'--enable-linux-netfilter' 'build_alias=x86_64-linux-gnu' 'CFLAGS=-g
-O2 -fdebug-prefix-map=/build/squid-4.0.23=. -fstack-protector-strong
-Wformat -Werror=format-security -Wall' 'LDFLAGS=-Wl,-z,relro
-Wl,-z,now -Wl,--as-needed' 'CPPFLAGS=-Wdate-time -D_FORTIFY_SOURCE=2'
'CXXFLAGS=-g -O2 -fdebug-prefix-map=/build/squid-4.0.23=.
-fstack-protector-strong -Wformat -Werror=format-security'

$ /usr/sbin/squid -k parse -d 9 -n test
2018/02/14 13:33:41| Startup: Initializing Authentication Schemes ...
2018/02/14 13:33:41| Startup: Initialized Authentication Scheme 'basic'
2018/02/14 13:33:41| Startup: Initialized Authentication Scheme 'digest'
2018/02/14 13:33:41| Startup: Initialized Authentication Scheme 'negotiate'
2018/02/14 13:33:41| Startup: Initialized Authentication Scheme 'ntlm'
2018/02/14 13:33:41| Startup: Initialized Authentication.
2018/02/14 13:33:41| WARNING: BCP 177 violation. IPv6 transport forced
OFF by build parameters.
2018/02/14 13:33:41| Processing Configuration File:
/etc/squid/squid.conf (depth 0)
2018/02/14 13:33:41| Processing: acl localnet src 10.0.0.0/8
 # RFC 1918 local private network (LAN)
2018/02/14 13:33:41| Processing: acl SSL_ports port 443 990
2018/02/14 13:33:41| Processing: acl Safe_ports port 80         # http
2018/02/14 13:33:41| Processing: acl Safe_ports port 21         # ftp
2018/02/14 13:33:41| Processing: acl Safe_ports port 443                # https
2018/02/14 13:33:41| Processing: acl Safe_ports port 70         # gopher
2018/02/14 13:33:41| Processing: acl Safe_ports port 210                # wais
2018/02/14 13:33:41| Processing: acl Safe_ports port 1025-65535 #
unregistered ports
2018/02/14 13:33:41| Processing: acl Safe_ports port 280
 # http-mgmt
2018/02/14 13:33:41| Processing: acl Safe_ports port 488
 # gss-http
2018/02/14 13:33:41| Processing: acl Safe_ports port 591
 # filemaker
2018/02/14 13:33:41| Processing: acl Safe_ports port 777
 # multiling http
2018/02/14 13:33:41| Processing: acl Safe_ports port 990                # ftps
2018/02/14 13:33:41| Processing: acl CONNECT method CONNECT
2018/02/14 13:33:41| Processing: acl purge method PURGE
2018/02/14 13:33:41| Processing: http_access deny !Safe_ports
2018/02/14 13:33:41| Processing: http_access deny CONNECT !SSL_ports
2018/02/14 13:33:41| Processing: http_access allow localhost manager
2018/02/14 13:33:41| Processing: http_access deny manager
2018/02/14 13:33:41| Processing: http_access allow localhost purge
2018/02/14 13:33:41| Processing: http_access deny purge
2018/02/14 13:33:41| Processing: http_access allow localhost
2018/02/14 13:33:41| Processing: http_access deny all
2018/02/14 13:33:41| Processing: include /etc/squid/conf.d/test-http_port.conf
2018/02/14 13:33:41| Processing Configuration File:
/etc/squid/conf.d/test-http_port.conf (depth 1)
2018/02/14 13:33:41| Processing: http_port 8080 ssl-bump name=test
options=NO_SSLv3 cert=/etc/squid/cert/serverproxyCA.pem
generate-host-certificates=on tls-default-ca=off
options=SINGLE_DH_USE:SINGLE_ECDH_USE
tls-dh=/etc/squid/cert/dhparam.pem
sslflags=NO_SESSION_REUSE:VERIFY_CRL
cipher=EDH+aRSA+AESGCM:EDH+aRSA+AES:DHE-RSA-AES256-SHA:EECDH+aRSA+AESGCM:EECDH+aRSA+AES:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:RSA+AESGCM:RSA+AES+SHA:DES-CBC3-SHA:DHE-RSA-AES128-SHA
2018/02/14 13:33:41| ERROR: Unknown TLS option SINGLE_DH_USE
2018/02/14 13:33:41| ERROR: Unknown TLS option SINGLE_ECDH_USE
.....


From skupko.sk at gmail.com  Wed Feb 14 13:31:40 2018
From: skupko.sk at gmail.com (Peter Viskup)
Date: Wed, 14 Feb 2018 14:31:40 +0100
Subject: [squid-users] Squid4 with ssl-bump single_dh_use unknown
In-Reply-To: <CAPa6PsEFTxGBQ2pUidQcLe6B6GeW_WBueydW6v+wB_HX5UJg7A@mail.gmail.com>
References: <CAPa6PsEFTxGBQ2pUidQcLe6B6GeW_WBueydW6v+wB_HX5UJg7A@mail.gmail.com>
Message-ID: <CAPa6PsHWWaqjdCQ66vRpKThosUwYBueU1XhB_E9m6k_4_T4a-w@mail.gmail.com>

Crypto part of the configure log:

checking for nettle_md5_init in -lnettle... yes
checking nettle/md5.h usability... yes
checking nettle/md5.h presence... yes
checking for nettle/md5.h... yes
checking nettle/base64.h usability... yes
checking nettle/base64.h presence... yes
checking for nettle/base64.h... yes
checking for Nettle 3.4 API compatibility... no
configure: Using Nettle cryptographic library: yes
checking for crypt in -lcrypt... yes
checking for MD5Init in -lmd5... no
checking for LIBGNUTLS... yes
checking gnutls/gnutls.h usability... yes
checking gnutls/gnutls.h presence... yes
checking for gnutls/gnutls.h... yes
checking gnutls/x509.h usability... yes
checking gnutls/x509.h presence... yes
checking for gnutls/x509.h... yes
configure: GnuTLS library support: auto  -lgnutls
checking openssl/bio.h usability... yes
checking openssl/bio.h presence... yes
checking for openssl/bio.h... yes
checking openssl/crypto.h usability... yes
checking openssl/crypto.h presence... yes
checking for openssl/crypto.h... yes
checking openssl/err.h usability... yes
checking openssl/err.h presence... yes
checking for openssl/err.h... yes
checking openssl/md5.h usability... yes
checking openssl/md5.h presence... yes
checking for openssl/md5.h... yes
checking openssl/opensslv.h usability... yes
checking openssl/opensslv.h presence... yes
checking for openssl/opensslv.h... yes
checking openssl/ssl.h usability... yes
checking openssl/ssl.h presence... yes
checking for openssl/ssl.h... yes
checking openssl/x509v3.h usability... yes
checking openssl/x509v3.h presence... yes
checking for openssl/x509v3.h... yes
checking openssl/engine.h usability... yes
checking openssl/engine.h presence... yes
checking for openssl/engine.h... yes
checking openssl/txt_db.h usability... yes
checking openssl/txt_db.h presence... yes
checking for openssl/txt_db.h... yes
checking for LIBOPENSSL... yes
checking for EVP_PKEY_get0_RSA in -lcrypto... yes
checking for BIO_meth_new in -lcrypto... yes
checking for BIO_get_init in -lcrypto... yes
checking for ASN1_STRING_get0_data in -lcrypto... yes
checking for X509_STORE_CTX_get0_cert in -lcrypto... yes
checking for X509_VERIFY_PARAM_get_depth in -lcrypto... yes
checking for X509_STORE_CTX_get0_untrusted in -lcrypto... yes
checking for X509_STORE_CTX_set0_untrusted in -lcrypto... yes
checking for X509_up_ref in -lcrypto... yes
checking for X509_CRL_up_ref in -lcrypto... yes
checking for DH_up_ref in -lcrypto... yes
checking for X509_get0_signature in -lcrypto... yes
checking for SSL_CIPHER_find in -lssl... yes
checking for SSL_CTX_set_tmp_rsa_callback in -lssl... no
checking for SSL_SESSION_get_id in -lssl... yes
checking for TLS_method in -lssl... yes
checking for TLS_client_method in -lssl... yes
checking for TLS_server_method in -lssl... yes
checking for SSL_CTX_get0_certificate in -lssl... yes
checking whether SSL_CTX_new and similar openSSL API functions require
'const SSL_METHOD *'"... yes
checking whether SSL_get_new_ex_index() dup callback accepts 'const
CRYPTO_EX_DATA *'"... yes
checking whether SSL_CTX_sess_set_get_cb() callback accepts a const ID
argument"... yes
checking "whether X509_get0_signature() accepts const parameters"... yes
checking whether the TXT_DB use OPENSSL_PSTRING data member... yes
checking whether the squid workaround for buggy versions of
sk_OPENSSL_PSTRING_value should used... no
checking whether the workaround for OpenSSL IMPLEMENT_LHASH_  macros
should used... yes
checking whether hello message can be overwritten in SSL struct... no
configure: OpenSSL library support: yes  -lssl -lcrypto


On Wed, Feb 14, 2018 at 2:02 PM, Peter Viskup <skupko.sk at gmail.com> wrote:
> Build of squid 4.0.23 on current Debian 9 report the single_dh_use as not known.
> Older build of squid 3.5.21 on Debian 8 doesn't report it.
> According the documentation [1] it should be known and supported.
>
> [1] http://www.squid-cache.org/Doc/config/http_port/
>
> Is it a bug?
>
> Peter
>
> $ /usr/sbin/squid -v
> Squid Cache: Version 4.0.23
> Service Name: squid
> Squid built with SSLBump
>
> This binary uses OpenSSL 1.1.0f  25 May 2017. For legal restrictions
> on distribution see https://www.openssl.org/source/license.html
>
> configure options:  '--build=x86_64-linux-gnu' '--prefix=/usr'
> '--includedir=${prefix}/include' '--mandir=${prefix}/share/man'
> '--infodir=${prefix}/share/info' '--sysconfdir=/etc'
> '--localstatedir=/var' '--libexecdir=${prefix}/lib/squid' '--srcdir=.'
> '--disable-maintainer-mode' '--disable-dependency-tracking'
> '--disable-silent-rules' 'BUILDCXXFLAGS=-g -O2
> -fdebug-prefix-map=/build/squid-4.0.23=. -fstack-protector-strong
> -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2
> -Wl,-z,relro -Wl,-z,now -Wl,--as-needed' '--enable-build-info=Debian
> linux' '--datadir=/usr/share/squid' '--sysconfdir=/etc/squid'
> '--libexecdir=/usr/lib/squid' '--runstatedir=/var/run/squid'
> '--mandir=/usr/share/man' '--enable-inline' '--disable-arch-native'
> '--disable-loadable-modules' '--enable-storeio=aufs,rock'
> '--enable-removal-policies=lru,heap' '--enable-delay-pools'
> '--enable-cache-digests' '--enable-icap-client'
> '--enable-follow-x-forwarded-for' '--enable-auth'
> '--enable-external-acl-helpers=file_userip,session,SQL_session,time_quota,unix_group'
> '--enable-security-cert-validators=fake'
> '--enable-storeid-rewrite-helpers=file'
> '--enable-url-rewrite-helpers=fake' '--enable-eui' '--disable-esi'
> '--enable-icmp' '--enable-zph-qos' '--disable-ecap'
> '--disable-translation' '--disable-ident-lookups'
> '--with-swapdir=/var/spool/squid' '--with-logdir=/var/log/squid'
> '--with-pidfile=/var/run/squid/squid.pid'
> '--with-filedescriptors=65536' '--with-large-files'
> '--with-default-user=proxy' '--enable-security-cert-generators=file'
> '--enable-ssl-crtd' '--with-openssl' '--without-mit-krb5'
> '--without-heimdal-krb5' '--disable-wccp' '--disable-wccpv2'
> '--disable-ipv6' '--enable-build-info=Squid built with SSLBump'
> '--enable-linux-netfilter' 'build_alias=x86_64-linux-gnu' 'CFLAGS=-g
> -O2 -fdebug-prefix-map=/build/squid-4.0.23=. -fstack-protector-strong
> -Wformat -Werror=format-security -Wall' 'LDFLAGS=-Wl,-z,relro
> -Wl,-z,now -Wl,--as-needed' 'CPPFLAGS=-Wdate-time -D_FORTIFY_SOURCE=2'
> 'CXXFLAGS=-g -O2 -fdebug-prefix-map=/build/squid-4.0.23=.
> -fstack-protector-strong -Wformat -Werror=format-security'
>
> $ /usr/sbin/squid -k parse -d 9 -n test
> 2018/02/14 13:33:41| Startup: Initializing Authentication Schemes ...
> 2018/02/14 13:33:41| Startup: Initialized Authentication Scheme 'basic'
> 2018/02/14 13:33:41| Startup: Initialized Authentication Scheme 'digest'
> 2018/02/14 13:33:41| Startup: Initialized Authentication Scheme 'negotiate'
> 2018/02/14 13:33:41| Startup: Initialized Authentication Scheme 'ntlm'
> 2018/02/14 13:33:41| Startup: Initialized Authentication.
> 2018/02/14 13:33:41| WARNING: BCP 177 violation. IPv6 transport forced
> OFF by build parameters.
> 2018/02/14 13:33:41| Processing Configuration File:
> /etc/squid/squid.conf (depth 0)
> 2018/02/14 13:33:41| Processing: acl localnet src 10.0.0.0/8
>  # RFC 1918 local private network (LAN)
> 2018/02/14 13:33:41| Processing: acl SSL_ports port 443 990
> 2018/02/14 13:33:41| Processing: acl Safe_ports port 80         # http
> 2018/02/14 13:33:41| Processing: acl Safe_ports port 21         # ftp
> 2018/02/14 13:33:41| Processing: acl Safe_ports port 443                # https
> 2018/02/14 13:33:41| Processing: acl Safe_ports port 70         # gopher
> 2018/02/14 13:33:41| Processing: acl Safe_ports port 210                # wais
> 2018/02/14 13:33:41| Processing: acl Safe_ports port 1025-65535 #
> unregistered ports
> 2018/02/14 13:33:41| Processing: acl Safe_ports port 280
>  # http-mgmt
> 2018/02/14 13:33:41| Processing: acl Safe_ports port 488
>  # gss-http
> 2018/02/14 13:33:41| Processing: acl Safe_ports port 591
>  # filemaker
> 2018/02/14 13:33:41| Processing: acl Safe_ports port 777
>  # multiling http
> 2018/02/14 13:33:41| Processing: acl Safe_ports port 990                # ftps
> 2018/02/14 13:33:41| Processing: acl CONNECT method CONNECT
> 2018/02/14 13:33:41| Processing: acl purge method PURGE
> 2018/02/14 13:33:41| Processing: http_access deny !Safe_ports
> 2018/02/14 13:33:41| Processing: http_access deny CONNECT !SSL_ports
> 2018/02/14 13:33:41| Processing: http_access allow localhost manager
> 2018/02/14 13:33:41| Processing: http_access deny manager
> 2018/02/14 13:33:41| Processing: http_access allow localhost purge
> 2018/02/14 13:33:41| Processing: http_access deny purge
> 2018/02/14 13:33:41| Processing: http_access allow localhost
> 2018/02/14 13:33:41| Processing: http_access deny all
> 2018/02/14 13:33:41| Processing: include /etc/squid/conf.d/test-http_port.conf
> 2018/02/14 13:33:41| Processing Configuration File:
> /etc/squid/conf.d/test-http_port.conf (depth 1)
> 2018/02/14 13:33:41| Processing: http_port 8080 ssl-bump name=test
> options=NO_SSLv3 cert=/etc/squid/cert/serverproxyCA.pem
> generate-host-certificates=on tls-default-ca=off
> options=SINGLE_DH_USE:SINGLE_ECDH_USE
> tls-dh=/etc/squid/cert/dhparam.pem
> sslflags=NO_SESSION_REUSE:VERIFY_CRL
> cipher=EDH+aRSA+AESGCM:EDH+aRSA+AES:DHE-RSA-AES256-SHA:EECDH+aRSA+AESGCM:EECDH+aRSA+AES:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:RSA+AESGCM:RSA+AES+SHA:DES-CBC3-SHA:DHE-RSA-AES128-SHA
> 2018/02/14 13:33:41| ERROR: Unknown TLS option SINGLE_DH_USE
> 2018/02/14 13:33:41| ERROR: Unknown TLS option SINGLE_ECDH_USE
> .....


From pengyu.ut at gmail.com  Thu Feb 15 04:00:56 2018
From: pengyu.ut at gmail.com (Peng Yu)
Date: Wed, 14 Feb 2018 22:00:56 -0600
Subject: [squid-users] How to combine two proxies into one?
Message-ID: <CABrM6wnx_WUu0QnrYv9MY59ZFQK6T9e1+mmeh_N_4-TacvAk6w@mail.gmail.com>

Hi,

Here are the conf files for two proxies. The first is a reverse proxy
(proxied on server1 and server2) and the second is a forward proxy. Is
there a way to combine the two into one (supporting both 3129 and
3128)? Thanks.

$ grep -v '^#' squid.conf|grep -v '^$'
acl localnet src 10.0.0.0/8    # RFC1918 possible internal network
acl localnet src 172.16.0.0/12    # RFC1918 possible internal network
acl localnet src 192.168.0.0/16    # RFC1918 possible internal network
acl localnet src fc00::/7       # RFC 4193 local private network range
acl localnet src fe80::/10      # RFC 4291 link-local (directly
plugged) machines
acl SSL_ports port 443
acl Safe_ports port 80        # http
acl Safe_ports port 21        # ftp
acl Safe_ports port 443        # https
acl Safe_ports port 70        # gopher
acl Safe_ports port 210        # wais
acl Safe_ports port 1025-65535    # unregistered ports
acl Safe_ports port 280        # http-mgmt
acl Safe_ports port 488        # gss-http
acl Safe_ports port 591        # filemaker
acl Safe_ports port 777        # multiling http
acl CONNECT method CONNECT
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow localhost manager
http_access deny manager
http_access allow localnet
http_access allow localhost
http_access deny all
http_port 3129
cache_peer server1 parent 3128 0 round-robin no-query
cache_peer server2 parent 3128 0 round-robin no-query
forwarded_for    delete
coredump_dir /usr/local/var/cache/squid
refresh_pattern ^ftp:        1440    20%    10080
refresh_pattern ^gopher:    1440    0%    1440
refresh_pattern -i (/cgi-bin/|\?) 0    0%    0
refresh_pattern .        0    20%    4320

$ grep -v '^#' squid.conf|grep -v '^$'
acl localnet src 172.16.0.0/12    # RFC1918 possible internal network
acl SSL_ports port 443
acl Safe_ports port 80        # http
acl Safe_ports port 21        # ftp
acl Safe_ports port 443        # https
acl Safe_ports port 70        # gopher
acl Safe_ports port 210        # wais
acl Safe_ports port 1025-65535    # unregistered ports
acl Safe_ports port 280        # http-mgmt
acl Safe_ports port 488        # gss-http
acl Safe_ports port 591        # filemaker
acl Safe_ports port 777        # multiling http
acl CONNECT method CONNECT
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow localhost manager
http_access deny manager
http_access allow localnet
http_access allow localhost
http_access allow all
http_port 3128
coredump_dir /var/spool/squid3
refresh_pattern ^ftp:        1440    20%    10080
refresh_pattern ^gopher:    1440    0%    1440
refresh_pattern -i (/cgi-bin/|\?) 0    0%    0
refresh_pattern (Release|Packages(.gz)*)$      0       20%     2880
refresh_pattern .        0    20%    4320
forwarded_for delete

-- 
Regards,
Peng


From squid3 at treenet.co.nz  Thu Feb 15 09:31:37 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 15 Feb 2018 22:31:37 +1300
Subject: [squid-users] How to combine two proxies into one?
In-Reply-To: <CABrM6wnx_WUu0QnrYv9MY59ZFQK6T9e1+mmeh_N_4-TacvAk6w@mail.gmail.com>
References: <CABrM6wnx_WUu0QnrYv9MY59ZFQK6T9e1+mmeh_N_4-TacvAk6w@mail.gmail.com>
Message-ID: <fd7d956e-bfb5-e9f3-d4b8-2d0f45de48f1@treenet.co.nz>

On 15/02/18 17:00, Peng Yu wrote:
> Hi,
> 
> Here are the conf files for two proxies. The first is a reverse proxy
> (proxied on server1 and server2) and the second is a forward proxy. Is
> there a way to combine the two into one (supporting both 3129 and
> 3128)? Thanks.

One Squid can accept traffic in multiple modes, just by adding the
appropriate *_port lines for each type/mode of traffic.

However, if you are talking about the same setup as your last threads
described the first proxy is *not* doing proper / normal reverse-proxy.
>From what I understand in those setups you are relying on the traffic
being warped into forward-proxy syntax by the frontend and leaving the
domain routing to the backend - which lacks the appropriate security
checks to handle reverse-proxy needs.


In regards to your posted config files. Skipping the lines which are not
actual default configuration you are left with these:

> 
> $ grep -v '^#' squid.conf|grep -v '^$'
> http_port 3129

This is not a reverse-proxy. That is declared by the "accel" mode flag
being set - which is not present here.


> cache_peer server1 parent 3128 0 round-robin no-query
> cache_peer server2 parent 3128 0 round-robin no-query
> coredump_dir /usr/local/var/cache/squid
> 

> $ grep -v '^#' squid.conf|grep -v '^$'
> http_port 3128

This is also not a reverse-proxy.

> coredump_dir /var/spool/squid3
> refresh_pattern (Release|Packages(.gz)*)$      0       20%     2880

To combine the above two configurations take the second one and add this
line:
  http_port 3129


BUT, since neither of them was actually a reverse-proxy the answer of
how to merge a reverse-proxy and a forward-proxy would be quite different.

Amos


From skupko.sk at gmail.com  Thu Feb 15 12:44:12 2018
From: skupko.sk at gmail.com (Peter Viskup)
Date: Thu, 15 Feb 2018 13:44:12 +0100
Subject: [squid-users] squid4 with sslbump not logged server side
	cert_subject and cert_issuer
Message-ID: <CAPa6PsGNWufiT8B9QHdEvpcoAeNojbDLz8BRhqCo3L-c7VfGvA@mail.gmail.com>

Running squid version 4.0.23 with logformat including

SSLBumpMode=%ssl::bump_mode SSLSNI="%ssl::>sni"
SSLClientProto="%ssl::>negotiated_version"
SSLServerProto="%ssl::<negotiated_version"
SSLBumpClientCipher="%ssl::>negotiated_cipher"
SSLBumpServerCipher="%ssl::<negotiated_cipher"
SSLBumpSubject="%ssl::<cert_subject"
SSLBumpIssuer="%ssl::<cert_issuer"

and ssl_bump configured simply with

ssl_bump bump all
http_access allow all

the messages still logged with dashes for Subject and Issuer values

SSLBumpMode=bump SSLSNI="www.google.sk" SSLClientProto="TLS/1.0" SSLServerProto
="TLS/1.2" SSLBumpClientCipher="ECDHE-RSA-AES256-SHA"
SSLBumpServerCipher="ECDHE-RSA-AES128-GCM-SHA256" SSLBumpSubject="-"
SSLBumpIssuer="-"

I am doing something wrong or did I overlooked something?

Peter


From squid3 at treenet.co.nz  Thu Feb 15 14:32:13 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 16 Feb 2018 03:32:13 +1300
Subject: [squid-users] squid4 with sslbump not logged server side
 cert_subject and cert_issuer
In-Reply-To: <CAPa6PsGNWufiT8B9QHdEvpcoAeNojbDLz8BRhqCo3L-c7VfGvA@mail.gmail.com>
References: <CAPa6PsGNWufiT8B9QHdEvpcoAeNojbDLz8BRhqCo3L-c7VfGvA@mail.gmail.com>
Message-ID: <420b820e-af8c-880f-95d5-b84dd135e851@treenet.co.nz>

On 16/02/18 01:44, Peter Viskup wrote:
> Running squid version 4.0.23 with logformat including
> 
> SSLBumpMode=%ssl::bump_mode SSLSNI="%ssl::>sni"
> SSLClientProto="%ssl::>negotiated_version"
> SSLServerProto="%ssl::<negotiated_version"
> SSLBumpClientCipher="%ssl::>negotiated_cipher"
> SSLBumpServerCipher="%ssl::<negotiated_cipher"
> SSLBumpSubject="%ssl::<cert_subject"
> SSLBumpIssuer="%ssl::<cert_issuer"
> 
> and ssl_bump configured simply with
> 
> ssl_bump bump all
> http_access allow all
> 
> the messages still logged with dashes for Subject and Issuer values
> 
> SSLBumpMode=bump SSLSNI="www.google.sk" SSLClientProto="TLS/1.0" SSLServerProto
> ="TLS/1.2" SSLBumpClientCipher="ECDHE-RSA-AES256-SHA"
> SSLBumpServerCipher="ECDHE-RSA-AES128-GCM-SHA256" SSLBumpSubject="-"
> SSLBumpIssuer="-"
> 
> I am doing something wrong or did I overlooked something?
> 

Was there actually a server involved?

You told Squid to "bump all" which, by itself, means bump immediately
after client Hello arrives. So there is no server cert to get details
from until after bumping finishes and the first HTTPS request is
processed - triggering server contact to pass it upstream (unless that
is a HIT).

Amos


From rousskov at measurement-factory.com  Thu Feb 15 18:41:37 2018
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Thu, 15 Feb 2018 11:41:37 -0700
Subject: [squid-users] squid4 with sslbump not logged server side
 cert_subject and cert_issuer
In-Reply-To: <420b820e-af8c-880f-95d5-b84dd135e851@treenet.co.nz>
References: <CAPa6PsGNWufiT8B9QHdEvpcoAeNojbDLz8BRhqCo3L-c7VfGvA@mail.gmail.com>
 <420b820e-af8c-880f-95d5-b84dd135e851@treenet.co.nz>
Message-ID: <cb2e63ab-75e1-2138-5867-6d71c43d71c5@measurement-factory.com>

On 02/15/2018 07:32 AM, Amos Jeffries wrote:
> On 16/02/18 01:44, Peter Viskup wrote:
>> Running squid version 4.0.23 with logformat including
>>
>> SSLBumpMode=%ssl::bump_mode SSLSNI="%ssl::>sni"
>> SSLClientProto="%ssl::>negotiated_version"
>> SSLServerProto="%ssl::<negotiated_version"
>> SSLBumpClientCipher="%ssl::>negotiated_cipher"
>> SSLBumpServerCipher="%ssl::<negotiated_cipher"
>> SSLBumpSubject="%ssl::<cert_subject"
>> SSLBumpIssuer="%ssl::<cert_issuer"
>>
>> and ssl_bump configured simply with
>>
>> ssl_bump bump all
>> http_access allow all
>>
>> the messages still logged with dashes for Subject and Issuer values
>>
>> SSLBumpMode=bump SSLSNI="www.google.sk" SSLClientProto="TLS/1.0" SSLServerProto
>> ="TLS/1.2" SSLBumpClientCipher="ECDHE-RSA-AES256-SHA"
>> SSLBumpServerCipher="ECDHE-RSA-AES128-GCM-SHA256" SSLBumpSubject="-"
>> SSLBumpIssuer="-"
>>
>> I am doing something wrong or did I overlooked something?


> You told Squid to "bump all" which, by itself, means bump immediately
> after client Hello arrives. 

In other words, you are doing a rough equivalent of the ancient
client-first bumping. To tell Squid to look at the client and server TLS
handshake messages (including the server certificate) before bumping the
connection, use something like this:

  ssl_bump stare all
  ssl_bump bump all


> So there is no server cert to get details
> from until after bumping finishes

The log message contains a server cipher (%ssl::<negotiated_cipher) so
Squid ought to know the certificate as well. The missing certificate in
this context sounds like a bug or a missing feature to me: Either the
server cipher should not be logged (if Squid did not see the origin
handshake yet) or both the cipher and the certificate details should be
logged. The only exception I could think of is a TLS negotiation error
where the server sends the cipher but not the certificate.

The above problem may not be important if, in fact, you did not actually
want to use client-first bumping (which usually does not work well),
_and_ staring at the server (i.e., stare all) logs the information you
want. However, that does not mean the problem is not there.


HTH,

Alex.
P.S. Your log entries will be malformed if certificate subject or issuer
contains a quote character.


From skupko.sk at gmail.com  Fri Feb 16 10:54:18 2018
From: skupko.sk at gmail.com (Peter Viskup)
Date: Fri, 16 Feb 2018 11:54:18 +0100
Subject: [squid-users] squid4 with sslbump not logged server side
 cert_subject and cert_issuer
In-Reply-To: <cb2e63ab-75e1-2138-5867-6d71c43d71c5@measurement-factory.com>
References: <CAPa6PsGNWufiT8B9QHdEvpcoAeNojbDLz8BRhqCo3L-c7VfGvA@mail.gmail.com>
 <420b820e-af8c-880f-95d5-b84dd135e851@treenet.co.nz>
 <cb2e63ab-75e1-2138-5867-6d71c43d71c5@measurement-factory.com>
Message-ID: <CAPa6PsGfq92PMWFWGEQ3czAMUSjWP=8N1kBCZ8-9WBTeQtxeag@mail.gmail.com>

On Thu, Feb 15, 2018 at 7:41 PM, Alex Rousskov
<rousskov at measurement-factory.com> wrote:
> On 02/15/2018 07:32 AM, Amos Jeffries wrote:
>> On 16/02/18 01:44, Peter Viskup wrote:
>>> Running squid version 4.0.23 with logformat including
>>>
>>> SSLBumpMode=%ssl::bump_mode SSLSNI="%ssl::>sni"
>>> SSLClientProto="%ssl::>negotiated_version"
>>> SSLServerProto="%ssl::<negotiated_version"
>>> SSLBumpClientCipher="%ssl::>negotiated_cipher"
>>> SSLBumpServerCipher="%ssl::<negotiated_cipher"
>>> SSLBumpSubject="%ssl::<cert_subject"
>>> SSLBumpIssuer="%ssl::<cert_issuer"
>>>
>>> and ssl_bump configured simply with
>>>
>>> ssl_bump bump all
>>> http_access allow all
>>>
>>> the messages still logged with dashes for Subject and Issuer values
>>>
>>> SSLBumpMode=bump SSLSNI="www.google.sk" SSLClientProto="TLS/1.0" SSLServerProto
>>> ="TLS/1.2" SSLBumpClientCipher="ECDHE-RSA-AES256-SHA"
>>> SSLBumpServerCipher="ECDHE-RSA-AES128-GCM-SHA256" SSLBumpSubject="-"
>>> SSLBumpIssuer="-"
>>>
>>> I am doing something wrong or did I overlooked something?
>> You told Squid to "bump all" which, by itself, means bump immediately
>> after client Hello arrives.
>
> In other words, you are doing a rough equivalent of the ancient
> client-first bumping. To tell Squid to look at the client and server TLS
> handshake messages (including the server certificate) before bumping the
> connection, use something like this:
>
>   ssl_bump stare all
>   ssl_bump bump all

Confirm with these two lines the cert information is logged as expected.
Will read the wiki once more.

> The log message contains a server cipher (%ssl::<negotiated_cipher) so
> Squid ought to know the certificate as well. The missing certificate in
> this context sounds like a bug or a missing feature to me: Either the
> server cipher should not be logged (if Squid did not see the origin
> handshake yet) or both the cipher and the certificate details should be
> logged. The only exception I could think of is a TLS negotiation error
> where the server sends the cipher but not the certificate.
>
> The above problem may not be important if, in fact, you did not actually
> want to use client-first bumping (which usually does not work well),
> _and_ staring at the server (i.e., stare all) logs the information you
> want. However, that does not mean the problem is not there.

I do not want to use client-first bump and thus the issue solved by stare&bump.
Thank you.


From jeroen.ruijter at borsboomhamm.nl  Fri Feb 16 13:02:12 2018
From: jeroen.ruijter at borsboomhamm.nl (Jeroen Ruijter)
Date: Fri, 16 Feb 2018 13:02:12 +0000
Subject: [squid-users] kerberos authentication with kerberos groups
Message-ID: <510FCECD6E595A4D83BF67FC07028E7507C8C90E@BHMB-01.bnh.local>

I'm trying to replace my basic ldap authentication by kerberos single sign on.
The user can succesfully login with single sign on, but I have restriction on groups and that is where it goes wrong.
I would like to use -r to trim the domain name, but when I do so it seems to work even less.
Someone any ideas what to try, I believe the system is loking wrong in active directory but adding -b OU=Users,DC=yyy,DC=local does not help me further

=======

auth_param negotiate program /usr/sbin/negotiate_wrapper_auth -d --ntlm /usr/bin/ntlm_auth --diagnostics --helper-protocol=squid-2.5-ntlmssp --domain=yyy --kerberos /usr/sbin/negotiate_kerberos_auth -d -s GSS_C_NO_NAME
auth_param negotiate children 20 startup=0 idle=1
auth_param negotiate keep_alive off

external_acl_type XXX_InternetAllowed ttl=3600 negative_ttl=3600 %LOGIN /usr/sbin/ext_kerberos_ldap_group_acl -b OU=Users,OU=BenH,DC=yyy,DC=local -g AD_XXX_InternetAllowed at yyy.LOCAL -d
external_acl_type RestrictedAdult ttl=3600 negative_ttl=3600 %LOGIN /usr/sbin/ext_kerberos_ldap_group_acl -b OU=Users,OU=BenH,DC=yyy,DC=local -g ADGroupRestrictedAdult at yyy.LOCAL -d

acl XXX_InternetAllowed external XXX_InternetAllowed
acl XXX_Adult external XXX_Adult

acl XXX_AdultX dstdomain .alternate.com<http://alternate.com/> .brood.nl<http://brood.nl/> .broodnodig.nl<http://broodnodig.nl/>

acl localnet src xxx.xxx.xxx.0/24
acl CONNECT method CONNECT

acl auth proxy_auth REQUIRED

http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow localhost manager
http_access deny manager
http_access deny auth !XXX_InternetAllowed
http_access deny XXX_Adult XXX_AdultX
http_access allow localnet
http_access allow localhost
http_access deny all

========

support_member.cc(63): pid=7612 :2018/02/16 11:50:07| kerberos_ldap_group: DEBUG: User domain loop: group at domain AD_XXX_InternetAllowed at YYY.LOCAL
support_member.cc(65): pid=7612 :2018/02/16 11:50:07| kerberos_ldap_group: DEBUG: Found group at domain AD_XXX_InternetAllowed at YYY.LOCAL
support_ldap.cc(898): pid=7612 :2018/02/16 11:50:07| kerberos_ldap_group: DEBUG: Setup Kerberos credential cache
support_krb5.cc(127): pid=7612 :2018/02/16 11:50:07| kerberos_ldap_group: DEBUG: Set credential cache to MEMORY:squid_ldap_7612
support_krb5.cc(138): pid=7612 :2018/02/16 11:50:07| kerberos_ldap_group: DEBUG: Get default keytab file name
support_krb5.cc(144): pid=7612 :2018/02/16 11:50:07| kerberos_ldap_group: DEBUG: Got default keytab file name /etc/krb5.keytab
support_krb5.cc(158): pid=7612 :2018/02/16 11:50:07| kerberos_ldap_group: DEBUG: Get principal name from keytab /etc/krb5.keytab
support_krb5.cc(169): pid=7612 :2018/02/16 11:50:07| kerberos_ldap_group: DEBUG: Keytab entry has realm name: YYY.LOCAL
support_krb5.cc(189): pid=7612 :2018/02/16 11:50:07| kerberos_ldap_group: DEBUG: Found principal  name: hosts/lnx01.yyy.local at YYY.LOCAL
support_krb5.cc(205): pid=7612 :2018/02/16 11:50:07| kerberos_ldap_group: DEBUG: Got principal name hosts/lnx01.yyy.local at YYY.LOCAL
support_krb5.cc(64): pid=7612 :2018/02/16 11:50:07| kerberos_ldap_group: ERROR: Error while initialising credentials from keytab : Client 'hosts/lnx01.yyy.local at YYY.LOCAL' not found in Kerberos database
support_krb5.cc(169): pid=7612 :2018/02/16 11:50:07| kerberos_ldap_group: DEBUG: Keytab entry has realm name: YYY.LOCAL
support_krb5.cc(189): pid=7612 :2018/02/16 11:50:07| kerberos_ldap_group: DEBUG: Found principal  name: HTTP/lnx01.yyy.local at YYY.LOCAL
support_krb5.cc(205): pid=7612 :2018/02/16 11:50:07| kerberos_ldap_group: DEBUG: Got principal name HTTP/lnx01.yyy.local at YYY.LOCAL
support_krb5.cc(269): pid=7612 :2018/02/16 11:50:07| kerberos_ldap_group: DEBUG: Stored credentials
support_ldap.cc(927): pid=7612 :2018/02/16 11:50:07| kerberos_ldap_group: DEBUG: Initialise ldap connection
support_ldap.cc(933): pid=7612 :2018/02/16 11:50:07| kerberos_ldap_group: DEBUG: Canonicalise ldap server name for domain YYY.LOCAL
support_resolv.cc(379): pid=7612 :2018/02/16 11:50:07| kerberos_ldap_group: DEBUG: Resolved SRV _ldap._tcp.YYY.LOCAL record to ad02.yyy.local
support_resolv.cc(379): pid=7612 :2018/02/16 11:50:07| kerberos_ldap_group: DEBUG: Resolved SRV _ldap._tcp.YYY.LOCAL record to ad01.yyy.local
support_resolv.cc(379): pid=7612 :2018/02/16 11:50:07| kerberos_ldap_group: DEBUG: Resolved SRV _ldap._tcp.YYY.LOCAL record to ad02.yyy.local
support_resolv.cc(379): pid=7612 :2018/02/16 11:50:07| kerberos_ldap_group: DEBUG: Resolved SRV _ldap._tcp.YYY.LOCAL record to ad01.yyy.local
support_resolv.cc(207): pid=7612 :2018/02/16 11:50:07| kerberos_ldap_group: DEBUG: Resolved address 1 of YYY.LOCAL to ad01.yyy.local
support_resolv.cc(207): pid=7612 :2018/02/16 11:50:07| kerberos_ldap_group: DEBUG: Resolved address 2 of YYY.LOCAL to ad01.yyy.local
support_resolv.cc(207): pid=7612 :2018/02/16 11:50:07| kerberos_ldap_group: DEBUG: Resolved address 3 of YYY.LOCAL to ad01.yyy.local
support_resolv.cc(207): pid=7612 :2018/02/16 11:50:07| kerberos_ldap_group: DEBUG: Resolved address 4 of YYY.LOCAL to ad02.yyy.local
support_resolv.cc(207): pid=7612 :2018/02/16 11:50:07| kerberos_ldap_group: DEBUG: Resolved address 5 of YYY.LOCAL to ad02.yyy.local
support_resolv.cc(207): pid=7612 :2018/02/16 11:50:07| kerberos_ldap_group: DEBUG: Resolved address 6 of YYY.LOCAL to ad02.yyy.local
support_resolv.cc(407): pid=7612 :2018/02/16 11:50:07| kerberos_ldap_group: DEBUG: Adding YYY.LOCAL to list
support_resolv.cc(443): pid=7612 :2018/02/16 11:50:07| kerberos_ldap_group: DEBUG: Sorted ldap server names for domain YYY.LOCAL:
support_resolv.cc(445): pid=7612 :2018/02/16 11:50:07| kerberos_ldap_group: DEBUG: Host: ad01.yyy.local Port: 389 Priority: 0 Weight: 100
support_resolv.cc(445): pid=7612 :2018/02/16 11:50:07| kerberos_ldap_group: DEBUG: Host: ad02.yyy.local Port: 389 Priority: 0 Weight: 100
support_resolv.cc(445): pid=7612 :2018/02/16 11:50:07| kerberos_ldap_group: DEBUG: Host: YYY.LOCAL Port: -1 Priority: -2 Weight: -2
support_ldap.cc(942): pid=7612 :2018/02/16 11:50:07| kerberos_ldap_group: DEBUG: Setting up connection to ldap server ad01.yyy.local:389
support_ldap.cc(953): pid=7612 :2018/02/16 11:50:07| kerberos_ldap_group: DEBUG: Bind to ldap server with SASL/GSSAPI
support_ldap.cc(967): pid=7612 :2018/02/16 11:50:07| kerberos_ldap_group: DEBUG: Successfully initialised connection to ldap server ad01.yyy.local:389
support_ldap.cc(333): pid=7612 :2018/02/16 11:50:07| kerberos_ldap_group: DEBUG: Search ldap server with bind path "" and filter: (objectclass=*)
support_ldap.cc(602): pid=7612 :2018/02/16 11:50:07| kerberos_ldap_group: DEBUG: Search ldap entries for attribute : schemaNamingContext
support_ldap.cc(645): pid=7612 :2018/02/16 11:50:07| kerberos_ldap_group: DEBUG: 1 ldap entry found with attribute : schemaNamingContext
support_ldap.cc(342): pid=7612 :2018/02/16 11:50:07| kerberos_ldap_group: DEBUG: Search ldap server with bind path CN=Schema,CN=Configuration,DC=bnh,DC=local and filter: (ldapdisplayname=samaccountname)
support_ldap.cc(345): pid=7612 :2018/02/16 11:50:07| kerberos_ldap_group: DEBUG: Found 0 ldap entries
support_ldap.cc(350): pid=7612 :2018/02/16 11:50:07| kerberos_ldap_group: DEBUG: Determined ldap server not as an Active Directory server
support_ldap.cc(1061): pid=7612 :2018/02/16 11:50:07| kerberos_ldap_group: ERROR: Error determining ldap server type: Operations error
support_member.cc(76): pid=7612 :2018/02/16 11:50:07| kerberos_ldap_group: INFO: User Administrator is not member of group at domain AD_XXX_InternetAllowed at YYY.LOCAL
support_member.cc(91): pid=7612 :2018/02/16 11:50:07| kerberos_ldap_group: DEBUG: Default domain loop: group at domain AD_XXX_InternetAllowed at YYY.LOCAL
support_member.cc(119): pid=7612 :2018/02/16 11:50:07| kerberos_ldap_group: DEBUG: Default group loop: group at domain AD_XXX_InternetAllowed at YYY.LOCAL
kerberos_ldap_group.cc(416): pid=7612 :2018/02/16 11:50:07| kerberos_ldap_group: DEBUG: ERR

regards Jeroen Ruijter

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180216/4b340f74/attachment.htm>

From erdosain9 at gmail.com  Fri Feb 16 13:03:20 2018
From: erdosain9 at gmail.com (erdosain9)
Date: Fri, 16 Feb 2018 06:03:20 -0700 (MST)
Subject: [squid-users] All 32/32 ssl_crtd processes are busy / All 35/35
 negotiateauthenticator processes are busy
Message-ID: <1518786200572-0.post@n4.nabble.com>

Hi.
Im having this warning in cache.log


2018/02/14 15:56:55 kid1| WARNING: All 32/32 ssl_crtd processes are busy.
2018/02/14 15:56:55 kid1| WARNING: 32 pending requests queued
2018/02/14 15:56:55 kid1| WARNING: Consider increasing the number of
ssl_crtd processes in your config file.

2018/02/14 16:07:06 kid1| WARNING: All 35/35 negotiateauthenticator
processes are busy.
2018/02/14 16:07:06 kid1| WARNING: 35 pending requests queued
2018/02/14 16:07:06 kid1| WARNING: Consider increasing the number of
negotiateauthenticator processes in your config file.

I know how to increase the negotiate authenticator... but, how can i
increase the ssl_crtd proceses???

Thanks to all.

This is my config

acl sin_autenticacion src "/etc/squid/listas/sin_autenticacion.lst"


###Kerberos Auth with ActiveDirectory###
auth_param negotiate program /lib64/squid/negotiate_kerberos_auth -s
HTTP/squid.mydomain.lan at MYDOMAIN.LAN
auth_param negotiate children 35 startup=0 idle=1
auth_param basic credentialsttl 2 hours
auth_param negotiate keep_alive on


external_acl_type i-restringidos %LOGIN
/usr/lib64/squid/ext_kerberos_ldap_group_acl -g i-restringidos at MYDOMAIN.LAN
external_acl_type i-full %LOGIN /usr/lib64/squid/ext_kerberos_ldap_group_acl
-g i-full at MYDOMAIN.LAN
external_acl_type i-limitado %LOGIN
/usr/lib64/squid/ext_kerberos_ldap_group_acl -g i-limitado at MYDOMAIN.LAN

acl i-restringidos external i-restringidos
acl i-full external i-full
acl i-limitado external i-limitado

acl ads dstdom_regex "/etc/squid/listas/ad_block.lst"
http_access deny ads

acl youtube url_regex -i \.flv$
acl youtube url_regex -i \.mp4$
acl youtube url_regex -i watch?
acl youtube url_regex -i youtube
acl facebook url_regex -i facebook
acl facebook url_regex -i fbcdn\.net\/v\/(.*\.mp4)\?
acl facebook url_regex -i fbcdn\.net\/v\/(.*\.jpg)\? 
acl facebook url_regex -i akamaihd\.net\/v\/(.*\.mp4)\?
acl facebook url_regex -i akamaihd\.net\/v\/(.*\.jpg)\?

acl restringidos dstdomain "/etc/squid/listas/restringidos.lst"
acl dominios_denegados dstdomain "/etc/squid/listas/dominios_denegados.lst"

acl SSL_ports port 443
acl SSL_ports port 4443
acl SSL_ports port 8443
acl SSL_ports port 8080
acl SSL_ports port 20000
acl SSL_ports port 10000
acl SSL_ports port 2083

acl Safe_ports port 631         # httpCUPS
acl Safe_ports port 85
acl Safe_ports port 80          # http
acl Safe_ports port 21          # ftp
acl Safe_ports port 25          #########
acl Safe_ports port 587         #########
acl Safe_ports port 143         #########
acl Safe_ports port 993         #########
acl Safe_ports port 995         #########
acl Safe_ports port 465         #########
acl Safe_ports port 443         # https
acl Safe_ports port 4443        # https
acl Safe_ports port 70          # gopher
acl Safe_ports port 210         # wais
acl Safe_ports port 8443        # httpsalt
acl Safe_ports port 1025-65535  # unregistered ports
acl Safe_ports port 280         # http-mgmt
acl Safe_ports port 488         # gss-http
acl Safe_ports port 591         # filemaker
acl Safe_ports port 777         # multiling http
acl Safe_ports port 8080        # edesur y otros
acl Safe_ports port 2199        # radio
acl CONNECT method CONNECT


# Deny requests to certain unsafe ports
http_access deny !Safe_ports

# Deny CONNECT to other than secure SSL ports
http_access deny CONNECT !SSL_ports

# Only allow cachemgr access from localhost
http_access allow localhost manager
http_access deny manager

# We strongly recommend the following be uncommented to protect innocent
# web applications running on the proxy server who think the only
# one who can access services on "localhost" is a local user
http_access deny to_localhost

http_access allow sin_autenticacion
http_access deny i-restringidos restringidos
http_access allow i-limitado !dominios_denegados
http_access allow i-full !dominios_denegados
http_access allow localhost

http_access deny all

http_port 127.0.0.1:3128
http_port 192.168.1.215:3128 ssl-bump generate-host-certificates=on
dynamic_cert_mem_cache_size=4MB cert=/etc/squid/ssl_cert/myca.pem
key=/etc/squid/ssl_cert/myca.pem

acl step1 at_step SslBump1

acl excludeSSL ssl::server_name_regex "/etc/squid/listas/excluidosSSL.lst"

ssl_bump peek step1
ssl_bump splice excludeSSL
ssl_bump bump all


cache_dir diskd /var/spool/squid 15000 16 256
cache_mem 500 MB

cache_swap_low 70
cache_swap_high 85

coredump_dir /var/spool/squid


refresh_pattern -i \.jpg$ 30 0% 30 ignore-no-cache ignore-no-store
ignore-private
refresh_pattern -i ^http:\/\/www\.google\.com\/$ 0 20% 360 override-expire
override-lastmod ignore-reload ignore-no-cache ignore-no-store
reload-into-ims ignore-must-revalidate

refresh_pattern ^ftp:           1440    20%     10080
refresh_pattern ^gopher:        1440    0%      1440
refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
refresh_pattern .               0       20%     4320

delay_pools 5

#Ancho de Youtube
delay_class 1 2
delay_parameters 1 1000000/1000000 20000/150000
delay_access 1 allow i-limitado youtube !facebook
delay_access 1 deny all

#Ancho de Facebook
delay_class 2 2
delay_parameters 2 1000000/1000000 50000/256000
delay_access 2 allow i-limitado facebook !youtube
delay_access 2 deny all

#Ancho de banda YOUTUBE FULL
delay_class 3 1
delay_parameters 3 1000000/1000000
delay_access 3 allow i-full youtube !facebook
delay_access 3 deny all

#Ancho de banda LIMITADO
delay_class 4 2
delay_parameters 4 4000000/4000000 200000/400000
delay_access 4 allow i-limitado !youtube !facebook
delay_access 4 deny all

#Ancho de banda FULL
delay_class 5 2
delay_parameters 5 4000000/4000000 500000/1000000
delay_access 5 allow i-full !youtube !facebook
delay_access 5 deny all

dns_nameservers 192.168.1.107 192.168.1.222

forward_max_tries 25

dns_v4_first on





--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From yvoinov at gmail.com  Fri Feb 16 13:05:26 2018
From: yvoinov at gmail.com (Yuri)
Date: Fri, 16 Feb 2018 19:05:26 +0600
Subject: [squid-users] All 32/32 ssl_crtd processes are busy / All 35/35
 negotiateauthenticator processes are busy
In-Reply-To: <1518786200572-0.post@n4.nabble.com>
References: <1518786200572-0.post@n4.nabble.com>
Message-ID: <e5f2592d-ce13-7a40-ecc6-67037881f3fd@gmail.com>

#? TAG: sslcrtd_children
#??? The maximum number of processes spawn to service ssl server.
#??? The maximum this may be safely set to is 32.
#???
#??? The startup= and idle= options allow some measure of skew in your
#??? tuning.
#???
#??? ??? startup=N
#???
#??? Sets the minimum number of processes to spawn when Squid
#??? starts or reconfigures. When set to zero the first request will
#??? cause spawning of the first child process to handle it.
#???
#??? Starting too few children temporary slows Squid under load while it
#??? tries to spawn enough additional processes to cope with traffic.
#???
#??? ??? idle=N
#???
#??? Sets a minimum of how many processes Squid is to try and keep available
#??? at all times. When traffic begins to rise above what the existing
#??? processes can handle this many more will be spawned up to the maximum
#??? configured. A minimum setting of 1 is required.
#
#??? ??? queue-size=N
#
#??? Sets the maximum number of queued requests.
#??? If the queued requests exceed queue size for more than 3 minutes
#??? squid aborts its operation.
#??? The default value is set to 2*numberofchildren.
#???
#??? You must have at least one ssl_crtd process.
#Default:
# sslcrtd_children 32 startup=5 idle=1

Feel free to read squid.conf.documented.


16.02.2018 19:03, erdosain9 ?????:
> Hi.
> Im having this warning in cache.log
>
>
> 2018/02/14 15:56:55 kid1| WARNING: All 32/32 ssl_crtd processes are busy.
> 2018/02/14 15:56:55 kid1| WARNING: 32 pending requests queued
> 2018/02/14 15:56:55 kid1| WARNING: Consider increasing the number of
> ssl_crtd processes in your config file.
>
> 2018/02/14 16:07:06 kid1| WARNING: All 35/35 negotiateauthenticator
> processes are busy.
> 2018/02/14 16:07:06 kid1| WARNING: 35 pending requests queued
> 2018/02/14 16:07:06 kid1| WARNING: Consider increasing the number of
> negotiateauthenticator processes in your config file.
>
> I know how to increase the negotiate authenticator... but, how can i
> increase the ssl_crtd proceses???
>
> Thanks to all.
>
> This is my config
>
> acl sin_autenticacion src "/etc/squid/listas/sin_autenticacion.lst"
>
>
> ###Kerberos Auth with ActiveDirectory###
> auth_param negotiate program /lib64/squid/negotiate_kerberos_auth -s
> HTTP/squid.mydomain.lan at MYDOMAIN.LAN
> auth_param negotiate children 35 startup=0 idle=1
> auth_param basic credentialsttl 2 hours
> auth_param negotiate keep_alive on
>
>
> external_acl_type i-restringidos %LOGIN
> /usr/lib64/squid/ext_kerberos_ldap_group_acl -g i-restringidos at MYDOMAIN.LAN
> external_acl_type i-full %LOGIN /usr/lib64/squid/ext_kerberos_ldap_group_acl
> -g i-full at MYDOMAIN.LAN
> external_acl_type i-limitado %LOGIN
> /usr/lib64/squid/ext_kerberos_ldap_group_acl -g i-limitado at MYDOMAIN.LAN
>
> acl i-restringidos external i-restringidos
> acl i-full external i-full
> acl i-limitado external i-limitado
>
> acl ads dstdom_regex "/etc/squid/listas/ad_block.lst"
> http_access deny ads
>
> acl youtube url_regex -i \.flv$
> acl youtube url_regex -i \.mp4$
> acl youtube url_regex -i watch?
> acl youtube url_regex -i youtube
> acl facebook url_regex -i facebook
> acl facebook url_regex -i fbcdn\.net\/v\/(.*\.mp4)\?
> acl facebook url_regex -i fbcdn\.net\/v\/(.*\.jpg)\? 
> acl facebook url_regex -i akamaihd\.net\/v\/(.*\.mp4)\?
> acl facebook url_regex -i akamaihd\.net\/v\/(.*\.jpg)\?
>
> acl restringidos dstdomain "/etc/squid/listas/restringidos.lst"
> acl dominios_denegados dstdomain "/etc/squid/listas/dominios_denegados.lst"
>
> acl SSL_ports port 443
> acl SSL_ports port 4443
> acl SSL_ports port 8443
> acl SSL_ports port 8080
> acl SSL_ports port 20000
> acl SSL_ports port 10000
> acl SSL_ports port 2083
>
> acl Safe_ports port 631         # httpCUPS
> acl Safe_ports port 85
> acl Safe_ports port 80          # http
> acl Safe_ports port 21          # ftp
> acl Safe_ports port 25          #########
> acl Safe_ports port 587         #########
> acl Safe_ports port 143         #########
> acl Safe_ports port 993         #########
> acl Safe_ports port 995         #########
> acl Safe_ports port 465         #########
> acl Safe_ports port 443         # https
> acl Safe_ports port 4443        # https
> acl Safe_ports port 70          # gopher
> acl Safe_ports port 210         # wais
> acl Safe_ports port 8443        # httpsalt
> acl Safe_ports port 1025-65535  # unregistered ports
> acl Safe_ports port 280         # http-mgmt
> acl Safe_ports port 488         # gss-http
> acl Safe_ports port 591         # filemaker
> acl Safe_ports port 777         # multiling http
> acl Safe_ports port 8080        # edesur y otros
> acl Safe_ports port 2199        # radio
> acl CONNECT method CONNECT
>
>
> # Deny requests to certain unsafe ports
> http_access deny !Safe_ports
>
> # Deny CONNECT to other than secure SSL ports
> http_access deny CONNECT !SSL_ports
>
> # Only allow cachemgr access from localhost
> http_access allow localhost manager
> http_access deny manager
>
> # We strongly recommend the following be uncommented to protect innocent
> # web applications running on the proxy server who think the only
> # one who can access services on "localhost" is a local user
> http_access deny to_localhost
>
> http_access allow sin_autenticacion
> http_access deny i-restringidos restringidos
> http_access allow i-limitado !dominios_denegados
> http_access allow i-full !dominios_denegados
> http_access allow localhost
>
> http_access deny all
>
> http_port 127.0.0.1:3128
> http_port 192.168.1.215:3128 ssl-bump generate-host-certificates=on
> dynamic_cert_mem_cache_size=4MB cert=/etc/squid/ssl_cert/myca.pem
> key=/etc/squid/ssl_cert/myca.pem
>
> acl step1 at_step SslBump1
>
> acl excludeSSL ssl::server_name_regex "/etc/squid/listas/excluidosSSL.lst"
>
> ssl_bump peek step1
> ssl_bump splice excludeSSL
> ssl_bump bump all
>
>
> cache_dir diskd /var/spool/squid 15000 16 256
> cache_mem 500 MB
>
> cache_swap_low 70
> cache_swap_high 85
>
> coredump_dir /var/spool/squid
>
>
> refresh_pattern -i \.jpg$ 30 0% 30 ignore-no-cache ignore-no-store
> ignore-private
> refresh_pattern -i ^http:\/\/www\.google\.com\/$ 0 20% 360 override-expire
> override-lastmod ignore-reload ignore-no-cache ignore-no-store
> reload-into-ims ignore-must-revalidate
>
> refresh_pattern ^ftp:           1440    20%     10080
> refresh_pattern ^gopher:        1440    0%      1440
> refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
> refresh_pattern .               0       20%     4320
>
> delay_pools 5
>
> #Ancho de Youtube
> delay_class 1 2
> delay_parameters 1 1000000/1000000 20000/150000
> delay_access 1 allow i-limitado youtube !facebook
> delay_access 1 deny all
>
> #Ancho de Facebook
> delay_class 2 2
> delay_parameters 2 1000000/1000000 50000/256000
> delay_access 2 allow i-limitado facebook !youtube
> delay_access 2 deny all
>
> #Ancho de banda YOUTUBE FULL
> delay_class 3 1
> delay_parameters 3 1000000/1000000
> delay_access 3 allow i-full youtube !facebook
> delay_access 3 deny all
>
> #Ancho de banda LIMITADO
> delay_class 4 2
> delay_parameters 4 4000000/4000000 200000/400000
> delay_access 4 allow i-limitado !youtube !facebook
> delay_access 4 deny all
>
> #Ancho de banda FULL
> delay_class 5 2
> delay_parameters 5 4000000/4000000 500000/1000000
> delay_access 5 allow i-full !youtube !facebook
> delay_access 5 deny all
>
> dns_nameservers 192.168.1.107 192.168.1.222
>
> forward_max_tries 25
>
> dns_v4_first on
>
>
>
>
>
> --
> Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-- 
*****************************
* C++20 : Bug to the future *
*****************************


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180216/9d607e04/attachment.sig>

From Kelly.McCarty at staff.fraserk12.org  Fri Feb 16 15:46:22 2018
From: Kelly.McCarty at staff.fraserk12.org (McCarty, Kelly)
Date: Fri, 16 Feb 2018 15:46:22 +0000
Subject: [squid-users] Creating New Log File
Message-ID: <MWHPR03MB29440DEDA62FB9A351C5C427B5CB0@MWHPR03MB2944.namprd03.prod.outlook.com>

We are running a squid on a linux box. Webmin version 1.610.

I want to create a new log file within our Squid to trace traffic going to a specific site or url and I am a novice when it comes to the squid. Are there any easy directions to create this type of log? An outside vendor created one a couple years ago, but he is no longer with that company. I know I can access the one he created which logs information going/coming from a specific website through others/var/log/squid3, but I don't see how he created it so I can do another, or if I can modify the one he created back then since I don't need it anymore.

Thanks,

Kelly McCarty
Network Engineer
Fraser Public Schools
(586) 439-7147 Office
kelly.mccarty at staff.fraserk12.org<mailto:kelly.mccarty at staff.fraserk12.org> Email
http://www.fraser.k12.mi.us<http://www.fraser.k12.mi.us/> Website

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180216/e24dda3f/attachment.htm>

From squid3 at treenet.co.nz  Fri Feb 16 16:00:35 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 17 Feb 2018 05:00:35 +1300
Subject: [squid-users] Creating New Log File
In-Reply-To: <MWHPR03MB29440DEDA62FB9A351C5C427B5CB0@MWHPR03MB2944.namprd03.prod.outlook.com>
References: <MWHPR03MB29440DEDA62FB9A351C5C427B5CB0@MWHPR03MB2944.namprd03.prod.outlook.com>
Message-ID: <be3e6897-7173-4b95-6621-315f58b32024@treenet.co.nz>

On 17/02/18 04:46, McCarty, Kelly wrote:
> We are running a squid on a linux box. Webmin version 1.610.
> 
> ?
> 
> I want to create a new log file within our Squid to trace traffic going
> to a specific site or url and I am a novice when it comes to the squid.
> Are there any easy directions to create this type of log? An outside
> vendor created one a couple years ago, but he is no longer with that
> company. I know I can access the one he created which logs information
> going/coming from a specific website through others/var/log/squid3, but
> I don?t see how he created it so I can do another, or if I can modify
> the one he created back then since I don?t need it anymore.
> 

<https://wiki.squid-cache.org/Features/LogFormat>


Amos


From squid3 at treenet.co.nz  Fri Feb 16 17:58:15 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 17 Feb 2018 06:58:15 +1300
Subject: [squid-users] kerberos authentication with kerberos groups
In-Reply-To: <510FCECD6E595A4D83BF67FC07028E7507C8C90E@BHMB-01.bnh.local>
References: <510FCECD6E595A4D83BF67FC07028E7507C8C90E@BHMB-01.bnh.local>
Message-ID: <beb50c8f-ad13-1a82-66aa-e9bb6db4b983@treenet.co.nz>

On 17/02/18 02:02, Jeroen Ruijter wrote:
> I'm trying to replace my basic ldap authentication by kerberos single
> sign on.
> 

NP: Despite what some claim, SSO is not unique to NTLM and Kerberos
authentication. It is a behaviour of the tools used. As such it can be
done with *any* authentication type if the tools used perform the
necessary behaviour.



> The user can succesfully login with single sign on, but I have
> restriction on groups and that is where it goes wrong.

What exactly does this "going wrong" look like?

Also, what version of Squid are you working with?
 (the "squid -v" output please)

> 
> I would like to use -r to trim the domain name, but when I do so it
> seems to work even less.
> 
> Someone any ideas what to try, I believe the system is loking wrong in
> active directory but adding -b?OU=Users,DC=yyy,DC=local does not help me
> further

You have some things looking for ".local" and others for ".LOCAL". I'm
not sure if case insensitivity exists in all those places they are being
used, so that is one potential cause of problems.


> =======
> 
> ?
> 
> auth_param negotiate program /usr/sbin/negotiate_wrapper_auth -d --ntlm
> /usr/bin/ntlm_auth --diagnostics --helper-protocol=squid-2.5-ntlmssp
> --domain=yyy --kerberos /usr/sbin/negotiate_kerberos_auth -d -s
> GSS_C_NO_NAME
> 
> auth_param negotiate children 20 startup=0 idle=1
> 
> auth_param negotiate keep_alive off
> 
> ?
> 
> external_acl_type XXX_InternetAllowed ttl=3600 negative_ttl=3600 %LOGIN
> /usr/sbin/ext_kerberos_ldap_group_acl -b
> OU=Users,OU=BenH,DC=yyy,DC=local -g AD_XXX_InternetAllowed at yyy.LOCAL -d
> 
> external_acl_type RestrictedAdult ttl=3600 negative_ttl=3600 %LOGIN
> /usr/sbin/ext_kerberos_ldap_group_acl -b
> OU=Users,OU=BenH,DC=yyy,DC=local -g ADGroupRestrictedAdult at yyy.LOCAL -d
> 
> ?
> 
> acl XXX_InternetAllowed external XXX_InternetAllowed
> 
> acl XXX_Adult external XXX_Adult
> 

...
> 
> http_access deny auth !XXX_InternetAllowed

The above says the users entire login is to be rejected if they are not
a member of the XXX_InternetAllowed group.

That should work but it is better to reject failed logins fully first,
then do the group checks separately.

Like this:

 http_access deny !auth
 http_access deny !XXX_InternetAllowed all

> 
> http_access deny XXX_Adult XXX_AdultX
> 

you could gain a fair bit of performance back by making that check the
dstdomain before the slow external lookup:

  http_access deny XXX_AdultX XXX_Adult all


> http_access allow localnet
> 
> http_access allow localhost
> 
> http_access deny all
> 
> ?
> 
> ========
> 


...
> 
> support_ldap.cc(342): pid=7612 :2018/02/16 11:50:07|
> kerberos_ldap_group: DEBUG: Search ldap server with bind path
> CN=Schema,CN=Configuration,DC=bnh,DC=local and filter:
> (ldapdisplayname=samaccountname)
> 
> support_ldap.cc(345): pid=7612 :2018/02/16 11:50:07|
> kerberos_ldap_group: DEBUG: Found 0 ldap entries
> 
> support_ldap.cc(350): pid=7612 :2018/02/16 11:50:07|
> kerberos_ldap_group: DEBUG: Determined ldap server not as an Active
> Directory server
> 
> support_ldap.cc(1061): pid=7612 :2018/02/16 11:50:07|
> kerberos_ldap_group: ERROR: Error determining ldap server type:
> Operations error
> 
> support_member.cc(76): pid=7612 :2018/02/16 11:50:07|
> kerberos_ldap_group: INFO: User Administrator is not member of
> group at domain AD_XXX_InternetAllowed at YYY.LOCAL
> 

Looks like it is working to me.

The helper tries several methods of locating a server, two fail but the
third seems to work and produces the above result.


Amos



From Kelly.McCarty at staff.fraserk12.org  Fri Feb 16 19:04:48 2018
From: Kelly.McCarty at staff.fraserk12.org (Kelly)
Date: Fri, 16 Feb 2018 12:04:48 -0700 (MST)
Subject: [squid-users] Creating New Log File
In-Reply-To: <be3e6897-7173-4b95-6621-315f58b32024@treenet.co.nz>
References: <MWHPR03MB29440DEDA62FB9A351C5C427B5CB0@MWHPR03MB2944.namprd03.prod.outlook.com>
 <be3e6897-7173-4b95-6621-315f58b32024@treenet.co.nz>
Message-ID: <1518807888281-0.post@n4.nabble.com>

Thanks for the reply Amos. Being a novice on the Squid, is there a Squid for
Dummies version of creating a new log to view only the traffic to a
particular website or url? I tried to navigate through the link you sent,
and it mostly went over my head. If not, I may reach out to our vendor who
may have someone else on staff that works with Squid Proxies as the former
person (who configured the Squid and later the log file that I am trying to
duplicate but for another url). Once again... my appreciation for your
assistance. 



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From ahmed.zaeem at netstream.ps  Fri Feb 16 21:50:47 2018
From: ahmed.zaeem at netstream.ps (--Ahmad--)
Date: Fri, 16 Feb 2018 23:50:47 +0200
Subject: [squid-users] log external ip address in squid logs
In-Reply-To: <201802121734.18358.Antony.Stone@squid.open.source.it>
References: <DCF8A4E5-C7DE-43C0-891A-92416E342F5F@netstream.ps>
 <201802121734.18358.Antony.Stone@squid.open.source.it>
Message-ID: <6E07F51D-AAFF-4721-A4DB-7DC251E8E352@netstream.ps>

oh man , not sure how didnt i see it .

you correct , thank you !
> On Feb 12, 2018, at 6:34 PM, Antony Stone <Antony.Stone at squid.open.source.it> wrote:
> 
> On Monday 12 February 2018 at 16:36:58, --Ahmad-- wrote:
> 
>> Hello folks
>> 
>> i had a look on
>> http://www.squid-cache.org/Doc/config/logformat/
>> but i cant see the external ip address that used on squid
> 
>> i had a look on
>> http://www.squid-cache.org/Doc/config/logformat/
>> and did find that option .
> 
> Hm, that's confusing.
> 
>> i have this FORMAT below :
>> logformat squid %tl %6tr %>a %>p %>la %>lp %Ss/%03Hs %<st %rm %ru %un %Sh/
>> %<A %<a
> 
> I think <la is what you're looking for (and possibly <lp as well).
> 
> 
> Antony.
> 
> -- 
> You can spend the whole of your life trying to be popular,
> but at the end of the day the size of the crowd at your funeral
> will be largely dictated by the weather.
> 
> - Frank Skinner
> 
>                                                   Please reply to the list;
>                                                         please *don't* CC me.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



From ahmed.zaeem at netstream.ps  Fri Feb 16 21:53:20 2018
From: ahmed.zaeem at netstream.ps (--Ahmad--)
Date: Fri, 16 Feb 2018 23:53:20 +0200
Subject: [squid-users] squid -k rec , seems has problem with ram leakage ?
Message-ID: <532D4976-2EE6-462D-8DDC-B6B3A45F004D@netstream.ps>

hey folks 

i have a Multi instances in squid and i run them and keep use(( -k rec))) option 

but it seems after some hours i see ram keep increasing .


i see ram better if i kill squid then run it  normally .


but


 ram keep sucked by squid if i use -k rec option 

I?m using squid Squid Cache: Version 3.5.22


any way to help me ?


cheers 



From pengyu.ut at gmail.com  Sat Feb 17 01:37:02 2018
From: pengyu.ut at gmail.com (Peng Yu)
Date: Fri, 16 Feb 2018 19:37:02 -0600
Subject: [squid-users] How to combine two proxies into one?
In-Reply-To: <fd7d956e-bfb5-e9f3-d4b8-2d0f45de48f1@treenet.co.nz>
References: <CABrM6wnx_WUu0QnrYv9MY59ZFQK6T9e1+mmeh_N_4-TacvAk6w@mail.gmail.com>
 <fd7d956e-bfb5-e9f3-d4b8-2d0f45de48f1@treenet.co.nz>
Message-ID: <CABrM6wkHOFFKoMuLw6cafA8SYf3YyAO2YEEmZ=PHB5p+sKJdeQ@mail.gmail.com>

On Thu, Feb 15, 2018 at 3:31 AM, Amos Jeffries <squid3 at treenet.co.nz> wrote:
> On 15/02/18 17:00, Peng Yu wrote:
>> Hi,
>>
>> Here are the conf files for two proxies. The first is a reverse proxy
>> (proxied on server1 and server2) and the second is a forward proxy. Is
>> there a way to combine the two into one (supporting both 3129 and
>> 3128)? Thanks.
>
> One Squid can accept traffic in multiple modes, just by adding the
> appropriate *_port lines for each type/mode of traffic.
>
> However, if you are talking about the same setup as your last threads
> described the first proxy is *not* doing proper / normal reverse-proxy.
> From what I understand in those setups you are relying on the traffic
> being warped into forward-proxy syntax by the frontend and leaving the
> domain routing to the backend - which lacks the appropriate security
> checks to handle reverse-proxy needs.
>
>
> In regards to your posted config files. Skipping the lines which are not
> actual default configuration you are left with these:
>
>>
>> $ grep -v '^#' squid.conf|grep -v '^$'
>> http_port 3129
>
> This is not a reverse-proxy. That is declared by the "accel" mode flag
> being set - which is not present here.
>
>
>> cache_peer server1 parent 3128 0 round-robin no-query
>> cache_peer server2 parent 3128 0 round-robin no-query
>> coredump_dir /usr/local/var/cache/squid
>>
>
>> $ grep -v '^#' squid.conf|grep -v '^$'
>> http_port 3128
>
> This is also not a reverse-proxy.
>
>> coredump_dir /var/spool/squid3
>> refresh_pattern (Release|Packages(.gz)*)$      0       20%     2880
>
> To combine the above two configurations take the second one and add this
> line:
>   http_port 3129
>
>
> BUT, since neither of them was actually a reverse-proxy the answer of
> how to merge a reverse-proxy and a forward-proxy would be quite different.

I finally figure a configure that works. localhost:3128 is forward to
both server1:3128 and server2:3128. localhost:3129 directly goes to
the external network. Let me know if there is anything wrong with it.

Also, this only works for http. For https, localhost:3128 still
directly goes to the external network. Do you know how to modify the
following configuration to configure for https?

acl localnet src 10.0.0.0/8    # RFC1918 possible internal network
acl localnet src 172.16.0.0/12    # RFC1918 possible internal network
acl localnet src 192.168.0.0/16    # RFC1918 possible internal network
acl localnet src fc00::/7       # RFC 4193 local private network range
acl localnet src fe80::/10      # RFC 4291 link-local (directly
plugged) machines
acl SSL_ports port 443
acl Safe_ports port 80        # http
acl Safe_ports port 21        # ftp
acl Safe_ports port 443        # https
acl Safe_ports port 70        # gopher
acl Safe_ports port 210        # wais
acl Safe_ports port 1025-65535    # unregistered ports
acl Safe_ports port 280        # http-mgmt
acl Safe_ports port 488        # gss-http
acl Safe_ports port 591        # filemaker
acl Safe_ports port 777        # multiling http
acl CONNECT method CONNECT
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow localhost manager
http_access deny manager
http_access allow localnet
http_access allow localhost
http_access deny all
http_port 3128
http_port 3129
acl port_3128_acl myportname 3128
cache_peer server1 parent 3128 0 round-robin no-query name=proxy3128
cache_peer_access proxy3128 allow port_3128_acl
cache_peer server2 parent 3128 0 round-robin no-query name=proxy1_3128
cache_peer_access proxy1_3128 allow port_3128_acl
cache_peer_access proxy3128 deny all
forwarded_for    delete
coredump_dir /usr/local/var/cache/squid
refresh_pattern ^ftp:        1440    20%    10080
refresh_pattern ^gopher:    1440    0%    1440
refresh_pattern -i (/cgi-bin/|\?) 0    0%    0
refresh_pattern .        0    20%    4320


-- 
Regards,
Peng


From pengyu.ut at gmail.com  Sat Feb 17 02:05:35 2018
From: pengyu.ut at gmail.com (Peng Yu)
Date: Fri, 16 Feb 2018 20:05:35 -0600
Subject: [squid-users] Can cache_peer be localhost?
Message-ID: <CABrM6w=qVJzrPCkYXoD5RP3mHxzNDZkvaEAubs2PHK-v_UjRdw@mail.gmail.com>

Hi, I have the following configuration. When I access port 3129 and it
is localhost's turn in the round-robin, then the access will fail. Is
there a way to make it work?

$ grep -v '^#' squid.conf|grep -v '^$'
acl localnet src 172.16.0.0/12    # RFC1918 possible internal network
acl SSL_ports port 443
acl Safe_ports port 80        # http
acl Safe_ports port 21        # ftp
acl Safe_ports port 443        # https
acl Safe_ports port 70        # gopher
acl Safe_ports port 210        # wais
acl Safe_ports port 1025-65535    # unregistered ports
acl Safe_ports port 280        # http-mgmt
acl Safe_ports port 488        # gss-http
acl Safe_ports port 591        # filemaker
acl Safe_ports port 777        # multiling http
acl CONNECT method CONNECT
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow localhost manager
http_access deny manager
http_access allow localnet
http_access allow localhost
http_access allow all
http_port 3128
http_port 3129
acl port_3129_acl myportname 3129
cache_peer server1 parent 3128 0 round-robin no-query name=server1_3128
cache_peer_access server1_3128 allow port_3129_acl
cache_peer localhost parent 3128 0 round-robin no-query name=localhost_3128
cache_peer_access localhost_3128 allow port_3129_acl
coredump_dir /var/spool/squid3
refresh_pattern ^ftp:        1440    20%    10080
refresh_pattern ^gopher:    1440    0%    1440
refresh_pattern -i (/cgi-bin/|\?) 0    0%    0
refresh_pattern (Release|Packages(.gz)*)$      0       20%     2880
refresh_pattern .        0    20%    4320
forwarded_for delete


-- 
Regards,
Peng


From squid3 at treenet.co.nz  Sat Feb 17 09:38:10 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 17 Feb 2018 22:38:10 +1300
Subject: [squid-users] squid -k rec ,
	seems has problem with ram leakage ?
In-Reply-To: <532D4976-2EE6-462D-8DDC-B6B3A45F004D@netstream.ps>
References: <532D4976-2EE6-462D-8DDC-B6B3A45F004D@netstream.ps>
Message-ID: <8db1e241-f781-933b-a538-e8425c61bf2f@treenet.co.nz>



On 17/02/18 10:53, --Ahmad-- wrote:
> hey folks 
> 
> i have a Multi instances in squid and i run them and keep use(( -k rec))) option 
> 

"rec" as in the first characters of the "-k reconfigure" option?

That will only update the running Squid with new config file settings.
Sometimes that can reduce memory, but if the issue is in anyway linked
to the OS report of "maximum _ever_ used" stats for each process, it
will not change a thing - usually make the number higher as Squid must
fork() twice as many helper processes for a reconfigure.


> but it seems after some hours i see ram keep increasing .
> 

numbers?

config file(s)?

> 
> i see ram better if i kill squid then run it  normally .
> 

Which resets everything related to memory and starts clean without any
of the OS and fork() related issues such as the one above.

> 
> but
> 
> 
>  ram keep sucked by squid if i use -k rec option 
> 
> I?m using squid Squid Cache: Version 3.5.22
> 

Does the same problem exist with 3.5.27 ?

PS. If you are using ssl-bump at all, make sure you have the Squid-3
workaround of "sslflags=NO_DEFAULT_CA" on every *_port line using
ssl-bump option to prevent openssl allocating vast amounts of useless
memory.

Amos


From squid3 at treenet.co.nz  Sat Feb 17 10:17:01 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 17 Feb 2018 23:17:01 +1300
Subject: [squid-users] Can cache_peer be localhost?
In-Reply-To: <CABrM6w=qVJzrPCkYXoD5RP3mHxzNDZkvaEAubs2PHK-v_UjRdw@mail.gmail.com>
References: <CABrM6w=qVJzrPCkYXoD5RP3mHxzNDZkvaEAubs2PHK-v_UjRdw@mail.gmail.com>
Message-ID: <8b12ba6f-211d-9d46-933f-96425b72f40c@treenet.co.nz>

On 17/02/18 15:05, Peng Yu wrote:
> Hi, I have the following configuration. When I access port 3129 and it
> is localhost's turn in the round-robin, then the access will fail. Is
> there a way to make it work?
> 
> $ grep -v '^#' squid.conf|grep -v '^$'
...
> http_port 3128

This port receives localhost:3128 traffic.

> http_port 3129
> acl port_3129_acl myportname 3129
> cache_peer server1 parent 3128 0 round-robin no-query name=server1_3128
> cache_peer_access server1_3128 allow port_3129_acl
> cache_peer localhost parent 3128 0 round-robin no-query name=localhost_3128
> cache_peer_access localhost_3128 allow port_3129_acl

Now you have an infinite forwarding loop.

 client -> Squid (3129) -> Squid (3128) -> Squid (3128) ... repeat forever.

 Of that second 50%:  50% will go to serer1 and 50% loops back, repeat
to infinity.
 So in total 50% + 25% + 12.5% + ... of traffic goes to server1.

Can you see why this type of config is harmful?


...
> forwarded_for delete

... and you are deleting the X-Forwarded-For header whose purpose is in
part to show you how these loops are happening.


To answer your question it is not possible to work the way you seem to
expect, and that can be proven mathematically

Since you have two peers and round-robin each time a loop happens 50% of
traffic goes to server1, 50% loops back into this Squid.

In other words:
 50% of traffic goes to server1 on ts first time through.
 50% of traffic loops back through localhost to this Squid.

 25% of traffic goes to server1 on its second loop.
 ...

 12.5% of traffic goes to server1 on its third loop.
 ...

 and so on until 99.99999...% of traffic is going to server1, with
increasingly small amounts of traffic taking looping just one more time.

Each loop consumes 2 TCP ports and ~256KB of RAM. So if anything were
done to permit the looping to happen at some point very early the
machine would completely run out of either TCP sockets or RAM.

Those are both shared resources possibly needed by other software on the
machine. If either is consumed completely by Squid looping the OS
encounters horrible problems, up to and including the kernel crashing.


Luckily you are leaving the Via header in place which Squid uses to
block looping traffic before it causes serious damage to the machine.


Amos


From squid3 at treenet.co.nz  Sat Feb 17 10:22:50 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 17 Feb 2018 23:22:50 +1300
Subject: [squid-users] How to combine two proxies into one?
In-Reply-To: <CABrM6wkHOFFKoMuLw6cafA8SYf3YyAO2YEEmZ=PHB5p+sKJdeQ@mail.gmail.com>
References: <CABrM6wnx_WUu0QnrYv9MY59ZFQK6T9e1+mmeh_N_4-TacvAk6w@mail.gmail.com>
 <fd7d956e-bfb5-e9f3-d4b8-2d0f45de48f1@treenet.co.nz>
 <CABrM6wkHOFFKoMuLw6cafA8SYf3YyAO2YEEmZ=PHB5p+sKJdeQ@mail.gmail.com>
Message-ID: <8199effa-19e7-640c-a24a-963966c54553@treenet.co.nz>

On 17/02/18 14:37, Peng Yu wrote:
> On Thu, Feb 15, 2018 at 3:31 AM, Amos Jeffries wrote:
>>
>> BUT, since neither of them was actually a reverse-proxy the answer of
>> how to merge a reverse-proxy and a forward-proxy would be quite different.
> 
> I finally figure a configure that works. localhost:3128 is forward to
> both server1:3128 and server2:3128. localhost:3129 directly goes to
> the external network. Let me know if there is anything wrong with it.
> 

see my response to your other thread where you asked why that config was
not actually working.

> Also, this only works for http. For https, localhost:3128 still
> directly goes to the external network. Do you know how to modify the
> following configuration to configure for https?
> 

For forward-proxy of HTTPS traffic (aka CONNECT messages) you need to
configure one of:

 nonheirarchical_direct off
or
  never_direct allow CONNECT

otherwise Squid performs the more efficient DIRECT routing for the tunnel.

Amos


From ahmed.zaeem at netstream.ps  Sat Feb 17 11:57:31 2018
From: ahmed.zaeem at netstream.ps (--Ahmad--)
Date: Sat, 17 Feb 2018 13:57:31 +0200
Subject: [squid-users] squid -k rec ,
	seems has problem with ram leakage ?
In-Reply-To: <8db1e241-f781-933b-a538-e8425c61bf2f@treenet.co.nz>
References: <532D4976-2EE6-462D-8DDC-B6B3A45F004D@netstream.ps>
 <8db1e241-f781-933b-a538-e8425c61bf2f@treenet.co.nz>
Message-ID: <DB1EBECE-16DA-4432-B8AA-D2C17401D16E@netstream.ps>

hi amos 

i didnt use the version 3.5.22

 but long time I?m using the 3.5.22 and its fine 

the new thing is I?m using like 100 squid instances .

and  hourly i have cron to change and update squid 

so i just make rec option instead of having session drop .

i don?t have exact mount of statistics to tell you 

but say i have 32 G ram 

if i run 100 squid instances it take about 16 G ram .

if i keep run the cron hourly by time say daily 12 times ( every 2 hours) 

and after 1 week i go to server to see free ram using :

free -m command

i see the free ram be like 5 G free , while I?m supposed to see the free as 16 G

if i kill all instances and run it again 
the free is 16 G


so as i said , by time , by doing many -k rec OPTINOS , there is something not ok either os or squid I?m not sure .

is there any tuning can i do in squid ?

or os ? I?m using centos 6 64 bits and may be option in sysctl to play with ?

here is my config file :
dns_nameservers 8.8.8.8
dns_v4_first off
########################################
http_port 203.164.132.2:${service_name}
include /root/X3/aclhalf${service_name}.conf
include /root/X3/tcphalf${service_name}.conf 
pid_filename /var/run/squid${service_name}.pid
cache_log /var/log/squid/${service_name}-cache.log
access_log  /var/log/squid/${service_name}-access.log
#################
visible_hostname xyz
# Lockdown Procedures
auth_param basic program /lib/squid/basic_ncsa_auth /etc/squid/squid_userX3
acl ncsa_users proxy_auth REQUIRED
http_access allow ncsa_users
#
# Recommended minimum configuration:
#

# Example rule allowing access from your local networks.
# Adapt to list your (internal) IP networks from where browsing
# should be allowed
# Add any of your own refresh_pattern entries above these.
#
###################################
#########################################
cache_effective_user squid
cache_effective_group squid
##############


> On Feb 17, 2018, at 11:38 AM, Amos Jeffries <squid3 at treenet.co.nz> wrote:
> 
>> 3.5.22

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180217/db96cdda/attachment.htm>

From squid3 at treenet.co.nz  Sat Feb 17 13:20:19 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sun, 18 Feb 2018 02:20:19 +1300
Subject: [squid-users] squid -k rec ,
	seems has problem with ram leakage ?
In-Reply-To: <DB1EBECE-16DA-4432-B8AA-D2C17401D16E@netstream.ps>
References: <532D4976-2EE6-462D-8DDC-B6B3A45F004D@netstream.ps>
 <8db1e241-f781-933b-a538-e8425c61bf2f@treenet.co.nz>
 <DB1EBECE-16DA-4432-B8AA-D2C17401D16E@netstream.ps>
Message-ID: <e40c23f9-777b-21bb-3182-7fd3e1f5d95f@treenet.co.nz>

On 18/02/18 00:57, --Ahmad-- wrote:
> hi amos?
> 
> i didnt use the version 3.5.22
> 
> ?but long time I?m using the 3.5.22 and its fine?
> 
> the new thing is I?m using like 100 squid instances .
> 
> and ?hourly i have cron to change and update squid?
> 
> so i just make rec option instead of having session drop .
> 
> i don?t have exact mount of statistics to tell you?
> 
> but say i have 32 G ram?
> 
> if i run 100 squid instances it take about 16 G ram .

So that is the amount before much traffic has happened.

When traffic goes through the proxy Squid gains data which uses more
memory for at least all the purposes listed at
<https://wiki.squid-cache.org/SquidFaq/SquidMemory>.


> 
> if i keep run the cron hourly by time say daily 12 times ( every 2 hours)?
> 
> and after 1 week i go to server to see free ram using :
> 
> free -m command
> 
> i see the free ram be like 5 G free , while I?m supposed to see the free
> as 16 G


+10GB for 100 instances means each is on average only using ~100 MB more
than you expected. This is also the net difference between when you
started the Squid and the peak traffic load within that whole week.

If you are not already graphing the memory usage I suggest you start
doing so and look at the graphs for patterns. They may show a different
story to what you (or I) are thinking is happening.


Also, Squid provides SNMP data for automated measurements if you want to
check the details rather than just the overall OS free measurement.

For example; comparing OID cacheMemUsage to cacheNumObjCount,
cacheClients and cacheCurrentFileDescrCnt shows roughly the relative
memory usage to each of the major dynamic memory consumers.


Amos


From chiasa.men at web.de  Sat Feb 17 13:28:04 2018
From: chiasa.men at web.de (chiasa.men)
Date: Sat, 17 Feb 2018 14:28:04 +0100
Subject: [squid-users] Transition from squid3.5 to squid4;
	ciphers don't work anymore, ERROR: Unknown TLS option SINGLE_DH_USE
In-Reply-To: <2173350.boxqrhiZhZ@march>
References: <2173350.boxqrhiZhZ@march>
Message-ID: <2326992.SPu3oH0Cmp@march>

Am Montag, 12. Februar 2018, 14:29:09 CET schrieb chiasa.men:
> Hi I tried squid4.
> 
> Squid Cache: Version 4.0.23
> This binary uses OpenSSL 1.1.1-dev  xx XXX xxxx
> 
> Before, I used:
> Squid Cache: Version 3.5.27
> This binary uses OpenSSL 1.0.2g  1 Mar 2016
> 
> Some of the config directives changed:
> E.g.
> sslproxy_options SINGLE_DH_USE,SINGLE_ECDH_USE
> ->
> tls_tls_outgoing_options options=SINGLE_DH_USE,SINGLE_ECDH_USE
> 
> But that results in version 4 in the follwing errors (cache.log)
> ERROR: Unknown TLS option SINGLE_DH_USE
> ERROR: Unknown TLS option SINGLE_ECDH_USE
> 
> (same error with the same options in https_proxy)
> 
> Is that a problem related to the openssl version change?
> 
> 
> In cache_peer I also have now to configure tls-cafile=/etc/ssl/certs/ca-
> certificates.crt explicitly (I used some self signed certificates for
> testing - but in Squid3 I didn't need to configure that)
> Otherwise I get:
> (71) Protocol error (TLS code: X509_V_ERR_SELF_SIGNED_CERT_IN_CHAIN)
> In the reference it's stated that:
> 	tls-default-ca[=off]
> 			Whether to use the system Trusted CAs. Default is ON.
> Shouldn't the tls-cafile option be unnecessary since it's trusted by
> default?
> 
> 
> 
> Furthermore I set Apache (the peer) to "SSLCipherSuite  ECDHE-ECDSA-AES256-
> GCM-SHA384"
> as well as cache_peer sslcipher=ECDHE-ECDSA-AES256-GCM-SHA384
> 
> ERROR: negotiating TLS on FD 20: error:141A90B5:SSL
> routines:ssl_cipher_list_to_bytes:no ciphers available (1/-1/0)
> 
> How can that be?
> 
> 
> 
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

Any idea?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180217/af21dbfd/attachment.htm>

From ahmed.zaeem at netstream.ps  Sat Feb 17 13:38:53 2018
From: ahmed.zaeem at netstream.ps (--Ahmad--)
Date: Sat, 17 Feb 2018 15:38:53 +0200
Subject: [squid-users] squid -k rec ,
	seems has problem with ram leakage ?
In-Reply-To: <e40c23f9-777b-21bb-3182-7fd3e1f5d95f@treenet.co.nz>
References: <532D4976-2EE6-462D-8DDC-B6B3A45F004D@netstream.ps>
 <8db1e241-f781-933b-a538-e8425c61bf2f@treenet.co.nz>
 <DB1EBECE-16DA-4432-B8AA-D2C17401D16E@netstream.ps>
 <e40c23f9-777b-21bb-3182-7fd3e1f5d95f@treenet.co.nz>
Message-ID: <898C07DF-7564-4670-ADD3-17743E9334BB@netstream.ps>

Hi Amos , 

so you mean that the extra Ram usage is from the instance when it loaded with traffic ?

will that stay even if i have cache men 0 and  and cache deny all  and disabling all HDD caching ?

is there anything can i do ?

or leave it s it is ?

cheers 

> On Feb 17, 2018, at 3:20 PM, Amos Jeffries <squid3 at treenet.co.nz> wrote:
> 
> On 18/02/18 00:57, --Ahmad-- wrote:
>> hi amos 
>> 
>> i didnt use the version 3.5.22
>> 
>>  but long time I?m using the 3.5.22 and its fine 
>> 
>> the new thing is I?m using like 100 squid instances .
>> 
>> and  hourly i have cron to change and update squid 
>> 
>> so i just make rec option instead of having session drop .
>> 
>> i don?t have exact mount of statistics to tell you 
>> 
>> but say i have 32 G ram 
>> 
>> if i run 100 squid instances it take about 16 G ram .
> 
> So that is the amount before much traffic has happened.
> 
> When traffic goes through the proxy Squid gains data which uses more
> memory for at least all the purposes listed at
> <https://wiki.squid-cache.org/SquidFaq/SquidMemory <https://wiki.squid-cache.org/SquidFaq/SquidMemory>>.
> 
> 
>> 
>> if i keep run the cron hourly by time say daily 12 times ( every 2 hours) 
>> 
>> and after 1 week i go to server to see free ram using :
>> 
>> free -m command
>> 
>> i see the free ram be like 5 G free , while I?m supposed to see the free
>> as 16 G
> 
> 
> +10GB for 100 instances means each is on average only using ~100 MB more
> than you expected. This is also the net difference between when you
> started the Squid and the peak traffic load within that whole week.
> 
> If you are not already graphing the memory usage I suggest you start
> doing so and look at the graphs for patterns. They may show a different
> story to what you (or I) are thinking is happening.
> 
> 
> Also, Squid provides SNMP data for automated measurements if you want to
> check the details rather than just the overall OS free measurement.
> 
> For example; comparing OID cacheMemUsage to cacheNumObjCount,
> cacheClients and cacheCurrentFileDescrCnt shows roughly the relative
> memory usage to each of the major dynamic memory consumers.
> 
> 
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org>
> http://lists.squid-cache.org/listinfo/squid-users <http://lists.squid-cache.org/listinfo/squid-users>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180217/44dc09af/attachment.htm>

From chiasa.men at web.de  Sat Feb 17 13:39:39 2018
From: chiasa.men at web.de (chiasa.men)
Date: Sat, 17 Feb 2018 14:39:39 +0100
Subject: [squid-users] Transition from squid3.5 to squid4;
	ciphers don't work anymore, ERROR: Unknown TLS option SINGLE_DH_USE
In-Reply-To: <2326992.SPu3oH0Cmp@march>
References: <2173350.boxqrhiZhZ@march> <2326992.SPu3oH0Cmp@march>
Message-ID: <3966728.112ragFB92@march>

Am Samstag, 17. Februar 2018, 14:28:04 CET schrieb chiasa.men:
> Am Montag, 12. Februar 2018, 14:29:09 CET schrieb chiasa.men:
> > Hi I tried squid4.
> > 
> > Squid Cache: Version 4.0.23
> > This binary uses OpenSSL 1.1.1-dev  xx XXX xxxx
> > 
> > Before, I used:
> > Squid Cache: Version 3.5.27
> > This binary uses OpenSSL 1.0.2g  1 Mar 2016
> > 
> > Some of the config directives changed:
> > E.g.
> > sslproxy_options SINGLE_DH_USE,SINGLE_ECDH_USE
> > ->
> > tls_tls_outgoing_options options=SINGLE_DH_USE,SINGLE_ECDH_USE
> > 
> > But that results in version 4 in the follwing errors (cache.log)
> > ERROR: Unknown TLS option SINGLE_DH_USE
> > ERROR: Unknown TLS option SINGLE_ECDH_USE
> > 
> > (same error with the same options in https_proxy)
> > 
> > Is that a problem related to the openssl version change?
> > 
> > 
> > In cache_peer I also have now to configure tls-cafile=/etc/ssl/certs/ca-
> > certificates.crt explicitly (I used some self signed certificates for
> > testing - but in Squid3 I didn't need to configure that)
> > Otherwise I get:
> > (71) Protocol error (TLS code: X509_V_ERR_SELF_SIGNED_CERT_IN_CHAIN)
> > 
> > In the reference it's stated that:
> > 	tls-default-ca[=off]
> > 	
> > 			Whether to use the system Trusted CAs. Default is ON.
> > 
> > Shouldn't the tls-cafile option be unnecessary since it's trusted by
> > default?
> > 
> > 
> > 
> > Furthermore I set Apache (the peer) to "SSLCipherSuite 
> > ECDHE-ECDSA-AES256-
> > GCM-SHA384"
> > as well as cache_peer sslcipher=ECDHE-ECDSA-AES256-GCM-SHA384
> > 
> > ERROR: negotiating TLS on FD 20: error:141A90B5:SSL
> > routines:ssl_cipher_list_to_bytes:no ciphers available (1/-1/0)
> > 
> > How can that be?
> > 
> > 
> > 
> > 
> > _______________________________________________
> > squid-users mailing list
> > squid-users at lists.squid-cache.org
> > http://lists.squid-cache.org/listinfo/squid-users
> 
> Any idea?

I could solve the "no ciphers available" by appending "TLS13-AES-256-GCM-
SHA384" to the ciphers.
But the log shows the use of "ECDHE-ECDSA-AES256-GCM-SHA384"
Why is that cipher relevant if its not used?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180217/301e25a3/attachment.htm>

From squid3 at treenet.co.nz  Sat Feb 17 14:01:05 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sun, 18 Feb 2018 03:01:05 +1300
Subject: [squid-users] Transition from squid3.5 to squid4;
 ciphers don't work anymore, ERROR: Unknown TLS option SINGLE_DH_USE
In-Reply-To: <2173350.boxqrhiZhZ@march>
References: <2173350.boxqrhiZhZ@march>
Message-ID: <aa2b0d2a-985c-56de-ee4d-a07e191caa90@treenet.co.nz>

On 13/02/18 02:29, chiasa.men wrote:
> Hi I tried squid4.
> 
> Squid Cache: Version 4.0.23 
> This binary uses OpenSSL 1.1.1-dev  xx XXX xxxx
> 
> Before, I used:
> Squid Cache: Version 3.5.27 
> This binary uses OpenSSL 1.0.2g  1 Mar 2016
> 
> Some of the config directives changed:
> E.g.
> sslproxy_options SINGLE_DH_USE,SINGLE_ECDH_USE
> ->
> tls_tls_outgoing_options options=SINGLE_DH_USE,SINGLE_ECDH_USE 
> 
> But that results in version 4 in the follwing errors (cache.log)
> ERROR: Unknown TLS option SINGLE_DH_USE
> ERROR: Unknown TLS option SINGLE_ECDH_USE
> 
> (same error with the same options in https_proxy)
> 
> Is that a problem related to the openssl version change?

Yes. Due to CVE-2016-0701 the SSL_OP_SINGLE_DH_USE option was deprecated
in OpenSSL 1.0.2f and that option enabled by default.
That means it *should* be available in all Squid using those libraries.

... but your 1.1.1-dev library appears to have had it removed entirely.

It is not listed as removed officially
(<https://wiki.openssl.org/index.php/List_of_SSL_OP_Flags#SSL_OP_SINGLE_DH_USE>)
so may be related to some build option used to create the library.


> 
> 
> In cache_peer I also have now to configure tls-cafile=/etc/ssl/certs/ca-
> certificates.crt explicitly (I used some self signed certificates for testing - 
> but in Squid3 I didn't need to configure that)
> Otherwise I get: 
> (71) Protocol error (TLS code: X509_V_ERR_SELF_SIGNED_CERT_IN_CHAIN)
> In the reference it's stated that:
> 	tls-default-ca[=off]
> 			Whether to use the system Trusted CAs. Default is ON.
> Shouldn't the tls-cafile option be unnecessary since it's trusted by default?
> 

Yes, unless the CA is not in the system default CAs for some reason.

Some well-known companies are not trusted because of bad behaviour
getting them kicked out of the globally trusted CA registry. It might
also be related to other things in your library build.

Hard to say what exactly is going wrong without looking into that
particular cert chain which is hitting the error.


> 
> 
> Furthermore I set Apache (the peer) to "SSLCipherSuite  ECDHE-ECDSA-AES256-
> GCM-SHA384"
> as well as cache_peer sslcipher=ECDHE-ECDSA-AES256-GCM-SHA384
> 
> ERROR: negotiating TLS on FD 20: error:141A90B5:SSL 
> routines:ssl_cipher_list_to_bytes:no ciphers available (1/-1/0)
> 
> How can that be?
> 

Not sure. Is the handshake actually trying to negotiate that cipher
correctly? or is one endpoint deciding it cannot support it?


Amos


From squid3 at treenet.co.nz  Sat Feb 17 14:10:52 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sun, 18 Feb 2018 03:10:52 +1300
Subject: [squid-users] Transition from squid3.5 to squid4;
 ciphers don't work anymore, ERROR: Unknown TLS option SINGLE_DH_USE
In-Reply-To: <3966728.112ragFB92@march>
References: <2173350.boxqrhiZhZ@march> <2326992.SPu3oH0Cmp@march>
 <3966728.112ragFB92@march>
Message-ID: <cbaf4530-80da-5b9a-9b32-2eafb0c976db@treenet.co.nz>


On 18/02/18 02:39, chiasa.men wrote:
> 
> I could solve the "no ciphers available" by appending
> "TLS13-AES-256-GCM-SHA384" to the ciphers.
> 
> But the log shows the use of "ECDHE-ECDSA-AES256-GCM-SHA384"
> 
> Why is that cipher relevant if its not used?
> 

The squid.conf cipher= are just strings passed to the OpenSSL library to
interpret.

It is probably that "TLS13-AES-256-GCM-SHA384" is what your new library
calls "ECDHE-ECDSA-AES256-GCM-SHA384".

Amos


From squid3 at treenet.co.nz  Sat Feb 17 14:24:44 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sun, 18 Feb 2018 03:24:44 +1300
Subject: [squid-users] squid -k rec ,
	seems has problem with ram leakage ?
In-Reply-To: <898C07DF-7564-4670-ADD3-17743E9334BB@netstream.ps>
References: <532D4976-2EE6-462D-8DDC-B6B3A45F004D@netstream.ps>
 <8db1e241-f781-933b-a538-e8425c61bf2f@treenet.co.nz>
 <DB1EBECE-16DA-4432-B8AA-D2C17401D16E@netstream.ps>
 <e40c23f9-777b-21bb-3182-7fd3e1f5d95f@treenet.co.nz>
 <898C07DF-7564-4670-ADD3-17743E9334BB@netstream.ps>
Message-ID: <0014bc6d-e2f8-9319-68d5-8bd7e7cc4c12@treenet.co.nz>

On 18/02/18 02:38, --Ahmad-- wrote:
> Hi Amos ,?
> 
> so you mean that the extra Ram usage is from the instance when it loaded
> with traffic ?

Probably. It is small enough in size to be from that. Detailed
inspection is necessary to know for sure.


> 
> will that stay even if i have cache men 0 and ?and?cache deny all?
> and?disabling all HDD caching ?

Yes. Memory of various amounts is required simply to process traffic.


> 
> is there anything can i do ?
> 
> or leave it s it is ?
> 

If you are worried you can look into the details I mentioned.

I would try to ensure that you staggered the instance reconfiguring so
that they at least did not all do it at the same time. There is extra
memory and pausing of traffic during reconfigure.


Amos


From squid3 at treenet.co.nz  Sat Feb 17 14:39:40 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sun, 18 Feb 2018 03:39:40 +1300
Subject: [squid-users] Transition from squid3.5 to squid4;
 ciphers don't work anymore, ERROR: Unknown TLS option SINGLE_DH_USE
In-Reply-To: <cbaf4530-80da-5b9a-9b32-2eafb0c976db@treenet.co.nz>
References: <2173350.boxqrhiZhZ@march> <2326992.SPu3oH0Cmp@march>
 <3966728.112ragFB92@march>
 <cbaf4530-80da-5b9a-9b32-2eafb0c976db@treenet.co.nz>
Message-ID: <2b6e7b1b-e181-43e6-2d91-31a1e363225b@treenet.co.nz>

On 18/02/18 03:10, Amos Jeffries wrote:
> 
> On 18/02/18 02:39, chiasa.men wrote:
>>
>> I could solve the "no ciphers available" by appending
>> "TLS13-AES-256-GCM-SHA384" to the ciphers.
>>
>> But the log shows the use of "ECDHE-ECDSA-AES256-GCM-SHA384"
>>
>> Why is that cipher relevant if its not used?
>>
> 
> The squid.conf cipher= are just strings passed to the OpenSSL library to
> interpret.
> 
> It is probably that "TLS13-AES-256-GCM-SHA384" is what your new library
> calls "ECDHE-ECDSA-AES256-GCM-SHA384".
> 

This seems to confirm the change:

<https://www.openssl.org/blog/blog/2017/05/04/tlsv1.3/>

"The new ciphersuites are defined differently and do not specify the
certificate type (e.g. RSA, DSA, ECDSA) or the key exchange mechanism
(e.g. DHE or ECHDE). This has implications for ciphersuite configuration."


Amos


From nninad at gmail.com  Sat Feb 17 15:44:55 2018
From: nninad at gmail.com (ninadmnaik)
Date: Sat, 17 Feb 2018 08:44:55 -0700 (MST)
Subject: [squid-users] Forward proxy: TLS connections to server
Message-ID: <1518882295560-0.post@n4.nabble.com>

Hello, 
We need to communicate with a xmpp server over TLS connections. Now, we know
that our app can open a TLS connection to Squid. But can Squid initiate a
TLS connection to the xmpp server? 

Our App ----(TLS socket connection)---> Squid ----(Can this be TLS
connection?)----> XMPP server

If it's possible, how to go about setting up squid for this? 

Would 'ssl-bump' feature be the way to go? 
http://www.squid-cache.org/Versions/v3/3.5/cfgman/https_port.html

Note that these are not 'https' requests. Just plain socket connections. 

Please point us in the right direction. 
Thanks. 



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From yvoinov at gmail.com  Sat Feb 17 16:14:20 2018
From: yvoinov at gmail.com (Yuri)
Date: Sat, 17 Feb 2018 22:14:20 +0600
Subject: [squid-users] Forward proxy: TLS connections to server
In-Reply-To: <1518882295560-0.post@n4.nabble.com>
References: <1518882295560-0.post@n4.nabble.com>
Message-ID: <ccc35d8f-36db-4395-c265-5b9493249beb@gmail.com>



17.02.2018 21:44, ninadmnaik ?????:
> Hello, 
> We need to communicate with a xmpp server over TLS connections. Now, we know
> that our app can open a TLS connection to Squid. But can Squid initiate a
> TLS connection to the xmpp server? 
Only if it goes over HTTP/HTTPS port. With some difficults and often
require special configuration.
>
> Our App ----(TLS socket connection)---> Squid ----(Can this be TLS
> connection?)----> XMPP server
>
> If it's possible, how to go about setting up squid for this? 
>
> Would 'ssl-bump' feature be the way to go? 
May be yes, may be no. Depends from previous. And not ssl-bump. Let's
say - peek-and-splice, and most probably splice rather than bump.
> http://www.squid-cache.org/Versions/v3/3.5/cfgman/https_port.html
>
> Note that these are not 'https' requests. Just plain socket connections. 
Squid is not sockets proxy. It's HTTP/HTTPS/FTP proxy only.
>
> Please point us in the right direction. 
Try to read https://wiki.squid-cache.org first.
> Thanks. 
>
>
>
> --
> Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-- 
*****************************
* C++20 : Bug to the future *
*****************************


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180217/e46ca8d9/attachment.sig>

From pengyu.ut at gmail.com  Sat Feb 17 16:45:03 2018
From: pengyu.ut at gmail.com (Peng Yu)
Date: Sat, 17 Feb 2018 10:45:03 -0600
Subject: [squid-users] Can cache_peer be localhost?
In-Reply-To: <8b12ba6f-211d-9d46-933f-96425b72f40c@treenet.co.nz>
References: <CABrM6w=qVJzrPCkYXoD5RP3mHxzNDZkvaEAubs2PHK-v_UjRdw@mail.gmail.com>
 <8b12ba6f-211d-9d46-933f-96425b72f40c@treenet.co.nz>
Message-ID: <CABrM6wmqOahPwPRMad-F=qAPvUYMwxXUvFBPrUq7NEDjN9bjow@mail.gmail.com>

>  client -> Squid (3129) -> Squid (3128) -> Squid (3128) ... repeat forever.

Is there a way to configure squid so that anything goes to 3128 will
directly go outside of the machine instead of going back to 3128
again, yet still let 3129 be forwarded to the local 3128 in the
round-robin fashion?

-- 
Regards,
Peng


From nninad at gmail.com  Sat Feb 17 16:58:53 2018
From: nninad at gmail.com (ninadmnaik)
Date: Sat, 17 Feb 2018 09:58:53 -0700 (MST)
Subject: [squid-users] Forward proxy: TLS connections to server
In-Reply-To: <ccc35d8f-36db-4395-c265-5b9493249beb@gmail.com>
References: <1518882295560-0.post@n4.nabble.com>
 <ccc35d8f-36db-4395-c265-5b9493249beb@gmail.com>
Message-ID: <1518886733201-0.post@n4.nabble.com>

Thanks for the quick reply Yuri. 

"Note that these are not 'https' requests. Just plain socket connections."
Maybe this wasn't statement wasn't entirely correct. We are using the
'connect' method to talk to squid proxy. And squid proxy is able to connect
to the remote xmpp server. It's just that the xmpp server supports TLS
connections only and thus further communication is not possible. 

>From the access logs:
*1518880487.658   1449 127.0.0.1 TCP_TUNNEL/200 46 CONNECT
fcm-xmpp.googleapis.com:5235 - HIER_DIRECT/2607:f8b0:4001:c0b::bc -
*

"Try to read https://wiki.squid-cache.org first."
Yeah, we've been doing that and will investigate further. 



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From uhlar at fantomas.sk  Sat Feb 17 17:22:09 2018
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Sat, 17 Feb 2018 18:22:09 +0100
Subject: [squid-users] Can cache_peer be localhost?
In-Reply-To: <CABrM6wmqOahPwPRMad-F=qAPvUYMwxXUvFBPrUq7NEDjN9bjow@mail.gmail.com>
References: <CABrM6w=qVJzrPCkYXoD5RP3mHxzNDZkvaEAubs2PHK-v_UjRdw@mail.gmail.com>
 <8b12ba6f-211d-9d46-933f-96425b72f40c@treenet.co.nz>
 <CABrM6wmqOahPwPRMad-F=qAPvUYMwxXUvFBPrUq7NEDjN9bjow@mail.gmail.com>
Message-ID: <20180217172209.GB9643@fantomas.sk>

>>  client -> Squid (3129) -> Squid (3128) -> Squid (3128) ... repeat forever.

On 17.02.18 10:45, Peng Yu wrote:
>Is there a way to configure squid so that anything goes to 3128 will
>directly go outside of the machine instead of going back to 3128
>again, yet still let 3129 be forwarded to the local 3128 in the
>round-robin fashion?

what is the point to send the request to itself?

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Due to unexpected conditions Windows 2000 will be released
in first quarter of year 1901


From yvoinov at gmail.com  Sat Feb 17 18:02:32 2018
From: yvoinov at gmail.com (Yuri)
Date: Sun, 18 Feb 2018 00:02:32 +0600
Subject: [squid-users] Forward proxy: TLS connections to server
In-Reply-To: <1518886733201-0.post@n4.nabble.com>
References: <1518882295560-0.post@n4.nabble.com>
 <ccc35d8f-36db-4395-c265-5b9493249beb@gmail.com>
 <1518886733201-0.post@n4.nabble.com>
Message-ID: <6e2530c3-a4f2-594e-9038-67e50698759e@gmail.com>

IM, which is uses HTTP-similar sessions bootstrap, requires special
investigation and custom configuration in case of goes via forwarding proxy.


17.02.2018 22:58, ninadmnaik ?????:
> Thanks for the quick reply Yuri. 
>
> "Note that these are not 'https' requests. Just plain socket connections."
> Maybe this wasn't statement wasn't entirely correct. We are using the
> 'connect' method to talk to squid proxy. And squid proxy is able to connect
> to the remote xmpp server. It's just that the xmpp server supports TLS
If' we're talking about CONNECT method session initiation, it is
requires (in general) to specify additional ports on Squid, which is
permitted to use CONNECT method.

For example, in your case, port 1449.

Generally speaking, squid's default not assumes IM as clients, as by as
squid itself is not proxy for all and any protocols. So, it is requires
additional configuration for passing IM via proxy.
> connections only and thus further communication is not possible. 
>
> From the access logs:
> *1518880487.658   1449 127.0.0.1 TCP_TUNNEL/200 46 CONNECT
> fcm-xmpp.googleapis.com:5235 - HIER_DIRECT/2607:f8b0:4001:c0b::bc -
> *
>
> "Try to read https://wiki.squid-cache.org first."
> Yeah, we've been doing that and will investigate further. 
Indeed :)
>
>
>
> --
> Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-- 
*****************************
* C++20 : Bug to the future *
*****************************


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180218/c1746b17/attachment.sig>

From yvoinov at gmail.com  Sat Feb 17 18:05:43 2018
From: yvoinov at gmail.com (Yuri)
Date: Sun, 18 Feb 2018 00:05:43 +0600
Subject: [squid-users] Can cache_peer be localhost?
In-Reply-To: <20180217172209.GB9643@fantomas.sk>
References: <CABrM6w=qVJzrPCkYXoD5RP3mHxzNDZkvaEAubs2PHK-v_UjRdw@mail.gmail.com>
 <8b12ba6f-211d-9d46-933f-96425b72f40c@treenet.co.nz>
 <CABrM6wmqOahPwPRMad-F=qAPvUYMwxXUvFBPrUq7NEDjN9bjow@mail.gmail.com>
 <20180217172209.GB9643@fantomas.sk>
Message-ID: <cef876b4-fc49-6d0f-aaaf-54e79de92665@gmail.com>

May be, assumed to forwarding to parent proxy(-es)?


17.02.2018 23:22, Matus UHLAR - fantomas ?????:
>>> ?client -> Squid (3129) -> Squid (3128) -> Squid (3128) ... repeat
>>> forever.
>
> On 17.02.18 10:45, Peng Yu wrote:
>> Is there a way to configure squid so that anything goes to 3128 will
>> directly go outside of the machine instead of going back to 3128
>> again, yet still let 3129 be forwarded to the local 3128 in the
>> round-robin fashion?
>
> what is the point to send the request to itself?
>

-- 
*****************************
* C++20 : Bug to the future *
*****************************


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180218/34d26cf0/attachment.sig>

From uhlar at fantomas.sk  Sat Feb 17 19:13:09 2018
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Sat, 17 Feb 2018 20:13:09 +0100
Subject: [squid-users] Can cache_peer be localhost?
In-Reply-To: <cef876b4-fc49-6d0f-aaaf-54e79de92665@gmail.com>
References: <CABrM6w=qVJzrPCkYXoD5RP3mHxzNDZkvaEAubs2PHK-v_UjRdw@mail.gmail.com>
 <8b12ba6f-211d-9d46-933f-96425b72f40c@treenet.co.nz>
 <CABrM6wmqOahPwPRMad-F=qAPvUYMwxXUvFBPrUq7NEDjN9bjow@mail.gmail.com>
 <20180217172209.GB9643@fantomas.sk>
 <cef876b4-fc49-6d0f-aaaf-54e79de92665@gmail.com>
Message-ID: <20180217191309.GA11974@fantomas.sk>

On 18.02.18 00:05, Yuri wrote:
>May be, assumed to forwarding to parent proxy(-es)?

according to original post, it's different port configured on the same squid
instance.

>17.02.2018 23:22, Matus UHLAR - fantomas ?????:
>>>> ?client -> Squid (3129) -> Squid (3128) -> Squid (3128) ... repeat
>>>> forever.
>>
>> On 17.02.18 10:45, Peng Yu wrote:
>>> Is there a way to configure squid so that anything goes to 3128 will
>>> directly go outside of the machine instead of going back to 3128
>>> again, yet still let 3129 be forwarded to the local 3128 in the
>>> round-robin fashion?
>>
>> what is the point to send the request to itself?

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
It's now safe to throw off your computer.


From yvoinov at gmail.com  Sat Feb 17 19:14:09 2018
From: yvoinov at gmail.com (Yuri)
Date: Sun, 18 Feb 2018 01:14:09 +0600
Subject: [squid-users] Can cache_peer be localhost?
In-Reply-To: <20180217191309.GA11974@fantomas.sk>
References: <CABrM6w=qVJzrPCkYXoD5RP3mHxzNDZkvaEAubs2PHK-v_UjRdw@mail.gmail.com>
 <8b12ba6f-211d-9d46-933f-96425b72f40c@treenet.co.nz>
 <CABrM6wmqOahPwPRMad-F=qAPvUYMwxXUvFBPrUq7NEDjN9bjow@mail.gmail.com>
 <20180217172209.GB9643@fantomas.sk>
 <cef876b4-fc49-6d0f-aaaf-54e79de92665@gmail.com>
 <20180217191309.GA11974@fantomas.sk>
Message-ID: <2ab82575-650f-d21d-0975-3f1b08252a13@gmail.com>



18.02.2018 01:13, Matus UHLAR - fantomas ?????:
> On 18.02.18 00:05, Yuri wrote:
>> May be, assumed to forwarding to parent proxy(-es)?
>
> according to original post, it's different port configured on the same
> squid
> instance.
Ewwwwwww..... it seems like looping.
>
>> 17.02.2018 23:22, Matus UHLAR - fantomas ?????:
>>>>> ?client -> Squid (3129) -> Squid (3128) -> Squid (3128) ... repeat
>>>>> forever.
>>>
>>> On 17.02.18 10:45, Peng Yu wrote:
>>>> Is there a way to configure squid so that anything goes to 3128 will
>>>> directly go outside of the machine instead of going back to 3128
>>>> again, yet still let 3129 be forwarded to the local 3128 in the
>>>> round-robin fashion?
>>>
>>> what is the point to send the request to itself?
>

-- 
*****************************
* C++20 : Bug to the future *
*****************************


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180218/1a7699c6/attachment.sig>

From pengyu.ut at gmail.com  Sun Feb 18 17:38:24 2018
From: pengyu.ut at gmail.com (Peng Yu)
Date: Sun, 18 Feb 2018 11:38:24 -0600
Subject: [squid-users] Where squid deamon is stored?
Message-ID: <CABrM6wnkJLwwP3rtNOqkczQVr0=VdbZgfyzG2NR6ve-BAJDWhA@mail.gmail.com>

I don't find squid3 in /etc/init.d. Does anybody know where the deamon
script is stored?

-- 
Regards,
Peng


From yvoinov at gmail.com  Sun Feb 18 17:42:51 2018
From: yvoinov at gmail.com (Yuri)
Date: Sun, 18 Feb 2018 23:42:51 +0600
Subject: [squid-users] Where squid deamon is stored?
In-Reply-To: <CABrM6wnkJLwwP3rtNOqkczQVr0=VdbZgfyzG2NR6ve-BAJDWhA@mail.gmail.com>
References: <CABrM6wnkJLwwP3rtNOqkczQVr0=VdbZgfyzG2NR6ve-BAJDWhA@mail.gmail.com>
Message-ID: <793a5827-d203-1443-011d-8f307eef7be2@gmail.com>

man find, no? :-)


18.02.2018 23:38, Peng Yu ?????:
> I don't find squid3 in /etc/init.d. Does anybody know where the deamon
> script is stored?
>

-- 
*****************************
* C++20 : Bug to the future *
*****************************


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180218/9410ae04/attachment.sig>

From leeb at ratnaling.org  Sun Feb 18 17:50:24 2018
From: leeb at ratnaling.org (Lee Brown)
Date: Sun, 18 Feb 2018 09:50:24 -0800
Subject: [squid-users] Where squid deamon is stored?
In-Reply-To: <793a5827-d203-1443-011d-8f307eef7be2@gmail.com>
References: <CABrM6wnkJLwwP3rtNOqkczQVr0=VdbZgfyzG2NR6ve-BAJDWhA@mail.gmail.com>
 <793a5827-d203-1443-011d-8f307eef7be2@gmail.com>
Message-ID: <CAFPNf5-H3QBg47uVnEhaV048XcPO3kenK=9BOrb_bhk-MFhaBg@mail.gmail.com>

On Sun, Feb 18, 2018 at 9:42 AM, Yuri <yvoinov at gmail.com> wrote:

> man find, no? :-)
>
>
> 18.02.2018 23:38, Peng Yu ?????:
> > I don't find squid3 in /etc/init.d. Does anybody know where the deamon
> > script is stored?
> >
>
> Depends on your OS.  Windows?  FreeBSD?  Linux?  Probably depends on the
linux distro and/or systemd.

For me it's at /usr/local/etc/rc.d (FreeBSD)

I bet you're running a systemd system.  Look at /etc/init.d/README in that
case.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180218/5ad994e5/attachment.htm>

From amajer at suse.de  Mon Feb 19 07:52:14 2018
From: amajer at suse.de (Adam Majer)
Date: Mon, 19 Feb 2018 08:52:14 +0100
Subject: [squid-users] Where squid deamon is stored?
In-Reply-To: <CABrM6wnkJLwwP3rtNOqkczQVr0=VdbZgfyzG2NR6ve-BAJDWhA@mail.gmail.com>
References: <CABrM6wnkJLwwP3rtNOqkczQVr0=VdbZgfyzG2NR6ve-BAJDWhA@mail.gmail.com>
Message-ID: <d4fae797-4c85-d86a-79f4-eea15bf48641@suse.de>

On 02/18/2018 06:38 PM, Peng Yu wrote:
> I don't find squid3 in /etc/init.d. Does anybody know where the deamon
> script is stored?
> 

Probably it's running using systemd these days, which means it's
somewhere under /lib/systemd or /usr/lib/systemd, and you are NOT
suppose to modify that stuff.

For enabled systemd stuff, it will even tell you where things are. For
example on openSUSE Tumbleweed,

# systemctl enable squid
Created symlink
/etc/systemd/system/multi-user.target.wants/squid.service ?
/usr/lib/systemd/system/squid.service.

So, how do you overwrite things in systemd? Well, make a directory in
/etc/systemd/system/squid.service.d and write your override settings
there. For example,

# systemctl status squid
? squid.service - Squid caching proxy
   Loaded: loaded (/usr/lib/systemd/system/squid.service; enabled;
vendor preset: disabled)
   Active: inactive (dead)


Then,

:/etc/systemd/system/squid.service.d # cat description.conf
[Unit]
Description=testing only

# systemctl daemon-reload
# systemctl status squid

? squid.service - testing only
   Loaded: loaded (/usr/lib/systemd/system/squid.service; enabled;
vendor preset: disabled)
  Drop-In: /etc/systemd/system/squid.service.d
           ??description.conf
   Active: inactive (dead)


Hopefully that helps you understand the basics on how to configure
systemd based systems when you need to override the default config files.

- Adam


From skupko.sk at gmail.com  Mon Feb 19 08:40:06 2018
From: skupko.sk at gmail.com (Peter Viskup)
Date: Mon, 19 Feb 2018 09:40:06 +0100
Subject: [squid-users] Squid4 with ssl-bump single_dh_use unknown
In-Reply-To: <CAPa6PsHWWaqjdCQ66vRpKThosUwYBueU1XhB_E9m6k_4_T4a-w@mail.gmail.com>
References: <CAPa6PsEFTxGBQ2pUidQcLe6B6GeW_WBueydW6v+wB_HX5UJg7A@mail.gmail.com>
 <CAPa6PsHWWaqjdCQ66vRpKThosUwYBueU1XhB_E9m6k_4_T4a-w@mail.gmail.com>
Message-ID: <CAPa6PsFU0tCg-jEwyNxuTt9ZBo=CbQ=MQ0WenLOuaj8K9cGF1Q@mail.gmail.com>

Amos answered in another post [1]
[1]
http://lists.squid-cache.org/pipermail/squid-users/2018-February/017640.html

More information:
https://wiki.openssl.org/index.php/List_of_SSL_OP_Flags#SSL_OP_SINGLE_DH_USE
As of 1.0.2f single-DH key use is always on, and this option does nothing,
and is retained for compatibility.


On Wed, Feb 14, 2018 at 2:31 PM, Peter Viskup <skupko.sk at gmail.com> wrote:

> Crypto part of the configure log:
>
> checking for nettle_md5_init in -lnettle... yes
> checking nettle/md5.h usability... yes
> checking nettle/md5.h presence... yes
> checking for nettle/md5.h... yes
> checking nettle/base64.h usability... yes
> checking nettle/base64.h presence... yes
> checking for nettle/base64.h... yes
> checking for Nettle 3.4 API compatibility... no
> configure: Using Nettle cryptographic library: yes
> checking for crypt in -lcrypt... yes
> checking for MD5Init in -lmd5... no
> checking for LIBGNUTLS... yes
> checking gnutls/gnutls.h usability... yes
> checking gnutls/gnutls.h presence... yes
> checking for gnutls/gnutls.h... yes
> checking gnutls/x509.h usability... yes
> checking gnutls/x509.h presence... yes
> checking for gnutls/x509.h... yes
> configure: GnuTLS library support: auto  -lgnutls
> checking openssl/bio.h usability... yes
> checking openssl/bio.h presence... yes
> checking for openssl/bio.h... yes
> checking openssl/crypto.h usability... yes
> checking openssl/crypto.h presence... yes
> checking for openssl/crypto.h... yes
> checking openssl/err.h usability... yes
> checking openssl/err.h presence... yes
> checking for openssl/err.h... yes
> checking openssl/md5.h usability... yes
> checking openssl/md5.h presence... yes
> checking for openssl/md5.h... yes
> checking openssl/opensslv.h usability... yes
> checking openssl/opensslv.h presence... yes
> checking for openssl/opensslv.h... yes
> checking openssl/ssl.h usability... yes
> checking openssl/ssl.h presence... yes
> checking for openssl/ssl.h... yes
> checking openssl/x509v3.h usability... yes
> checking openssl/x509v3.h presence... yes
> checking for openssl/x509v3.h... yes
> checking openssl/engine.h usability... yes
> checking openssl/engine.h presence... yes
> checking for openssl/engine.h... yes
> checking openssl/txt_db.h usability... yes
> checking openssl/txt_db.h presence... yes
> checking for openssl/txt_db.h... yes
> checking for LIBOPENSSL... yes
> checking for EVP_PKEY_get0_RSA in -lcrypto... yes
> checking for BIO_meth_new in -lcrypto... yes
> checking for BIO_get_init in -lcrypto... yes
> checking for ASN1_STRING_get0_data in -lcrypto... yes
> checking for X509_STORE_CTX_get0_cert in -lcrypto... yes
> checking for X509_VERIFY_PARAM_get_depth in -lcrypto... yes
> checking for X509_STORE_CTX_get0_untrusted in -lcrypto... yes
> checking for X509_STORE_CTX_set0_untrusted in -lcrypto... yes
> checking for X509_up_ref in -lcrypto... yes
> checking for X509_CRL_up_ref in -lcrypto... yes
> checking for DH_up_ref in -lcrypto... yes
> checking for X509_get0_signature in -lcrypto... yes
> checking for SSL_CIPHER_find in -lssl... yes
> checking for SSL_CTX_set_tmp_rsa_callback in -lssl... no
> checking for SSL_SESSION_get_id in -lssl... yes
> checking for TLS_method in -lssl... yes
> checking for TLS_client_method in -lssl... yes
> checking for TLS_server_method in -lssl... yes
> checking for SSL_CTX_get0_certificate in -lssl... yes
> checking whether SSL_CTX_new and similar openSSL API functions require
> 'const SSL_METHOD *'"... yes
> checking whether SSL_get_new_ex_index() dup callback accepts 'const
> CRYPTO_EX_DATA *'"... yes
> checking whether SSL_CTX_sess_set_get_cb() callback accepts a const ID
> argument"... yes
> checking "whether X509_get0_signature() accepts const parameters"... yes
> checking whether the TXT_DB use OPENSSL_PSTRING data member... yes
> checking whether the squid workaround for buggy versions of
> sk_OPENSSL_PSTRING_value should used... no
> checking whether the workaround for OpenSSL IMPLEMENT_LHASH_  macros
> should used... yes
> checking whether hello message can be overwritten in SSL struct... no
> configure: OpenSSL library support: yes  -lssl -lcrypto
>
>
> On Wed, Feb 14, 2018 at 2:02 PM, Peter Viskup <skupko.sk at gmail.com> wrote:
> > Build of squid 4.0.23 on current Debian 9 report the single_dh_use as
> not known.
> > Older build of squid 3.5.21 on Debian 8 doesn't report it.
> > According the documentation [1] it should be known and supported.
> >
> > [1] http://www.squid-cache.org/Doc/config/http_port/
> >
> > Is it a bug?
> >
> > Peter
> >
> > $ /usr/sbin/squid -v
> > Squid Cache: Version 4.0.23
> > Service Name: squid
> > Squid built with SSLBump
> >
> > This binary uses OpenSSL 1.1.0f  25 May 2017. For legal restrictions
> > on distribution see https://www.openssl.org/source/license.html
> >
> > configure options:  '--build=x86_64-linux-gnu' '--prefix=/usr'
> > '--includedir=${prefix}/include' '--mandir=${prefix}/share/man'
> > '--infodir=${prefix}/share/info' '--sysconfdir=/etc'
> > '--localstatedir=/var' '--libexecdir=${prefix}/lib/squid' '--srcdir=.'
> > '--disable-maintainer-mode' '--disable-dependency-tracking'
> > '--disable-silent-rules' 'BUILDCXXFLAGS=-g -O2
> > -fdebug-prefix-map=/build/squid-4.0.23=. -fstack-protector-strong
> > -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2
> > -Wl,-z,relro -Wl,-z,now -Wl,--as-needed' '--enable-build-info=Debian
> > linux' '--datadir=/usr/share/squid' '--sysconfdir=/etc/squid'
> > '--libexecdir=/usr/lib/squid' '--runstatedir=/var/run/squid'
> > '--mandir=/usr/share/man' '--enable-inline' '--disable-arch-native'
> > '--disable-loadable-modules' '--enable-storeio=aufs,rock'
> > '--enable-removal-policies=lru,heap' '--enable-delay-pools'
> > '--enable-cache-digests' '--enable-icap-client'
> > '--enable-follow-x-forwarded-for' '--enable-auth'
> > '--enable-external-acl-helpers=file_userip,session,
> SQL_session,time_quota,unix_group'
> > '--enable-security-cert-validators=fake'
> > '--enable-storeid-rewrite-helpers=file'
> > '--enable-url-rewrite-helpers=fake' '--enable-eui' '--disable-esi'
> > '--enable-icmp' '--enable-zph-qos' '--disable-ecap'
> > '--disable-translation' '--disable-ident-lookups'
> > '--with-swapdir=/var/spool/squid' '--with-logdir=/var/log/squid'
> > '--with-pidfile=/var/run/squid/squid.pid'
> > '--with-filedescriptors=65536' '--with-large-files'
> > '--with-default-user=proxy' '--enable-security-cert-generators=file'
> > '--enable-ssl-crtd' '--with-openssl' '--without-mit-krb5'
> > '--without-heimdal-krb5' '--disable-wccp' '--disable-wccpv2'
> > '--disable-ipv6' '--enable-build-info=Squid built with SSLBump'
> > '--enable-linux-netfilter' 'build_alias=x86_64-linux-gnu' 'CFLAGS=-g
> > -O2 -fdebug-prefix-map=/build/squid-4.0.23=. -fstack-protector-strong
> > -Wformat -Werror=format-security -Wall' 'LDFLAGS=-Wl,-z,relro
> > -Wl,-z,now -Wl,--as-needed' 'CPPFLAGS=-Wdate-time -D_FORTIFY_SOURCE=2'
> > 'CXXFLAGS=-g -O2 -fdebug-prefix-map=/build/squid-4.0.23=.
> > -fstack-protector-strong -Wformat -Werror=format-security'
> >
> > $ /usr/sbin/squid -k parse -d 9 -n test
> > 2018/02/14 13:33:41| Startup: Initializing Authentication Schemes ...
> > 2018/02/14 13:33:41| Startup: Initialized Authentication Scheme 'basic'
> > 2018/02/14 13:33:41| Startup: Initialized Authentication Scheme 'digest'
> > 2018/02/14 13:33:41| Startup: Initialized Authentication Scheme
> 'negotiate'
> > 2018/02/14 13:33:41| Startup: Initialized Authentication Scheme 'ntlm'
> > 2018/02/14 13:33:41| Startup: Initialized Authentication.
> > 2018/02/14 13:33:41| WARNING: BCP 177 violation. IPv6 transport forced
> > OFF by build parameters.
> > 2018/02/14 13:33:41| Processing Configuration File:
> > /etc/squid/squid.conf (depth 0)
> > 2018/02/14 13:33:41| Processing: acl localnet src 10.0.0.0/8
> >  # RFC 1918 local private network (LAN)
> > 2018/02/14 13:33:41| Processing: acl SSL_ports port 443 990
> > 2018/02/14 13:33:41| Processing: acl Safe_ports port 80         # http
> > 2018/02/14 13:33:41| Processing: acl Safe_ports port 21         # ftp
> > 2018/02/14 13:33:41| Processing: acl Safe_ports port 443
> # https
> > 2018/02/14 13:33:41| Processing: acl Safe_ports port 70         # gopher
> > 2018/02/14 13:33:41| Processing: acl Safe_ports port 210
> # wais
> > 2018/02/14 13:33:41| Processing: acl Safe_ports port 1025-65535 #
> > unregistered ports
> > 2018/02/14 13:33:41| Processing: acl Safe_ports port 280
> >  # http-mgmt
> > 2018/02/14 13:33:41| Processing: acl Safe_ports port 488
> >  # gss-http
> > 2018/02/14 13:33:41| Processing: acl Safe_ports port 591
> >  # filemaker
> > 2018/02/14 13:33:41| Processing: acl Safe_ports port 777
> >  # multiling http
> > 2018/02/14 13:33:41| Processing: acl Safe_ports port 990
> # ftps
> > 2018/02/14 13:33:41| Processing: acl CONNECT method CONNECT
> > 2018/02/14 13:33:41| Processing: acl purge method PURGE
> > 2018/02/14 13:33:41| Processing: http_access deny !Safe_ports
> > 2018/02/14 13:33:41| Processing: http_access deny CONNECT !SSL_ports
> > 2018/02/14 13:33:41| Processing: http_access allow localhost manager
> > 2018/02/14 13:33:41| Processing: http_access deny manager
> > 2018/02/14 13:33:41| Processing: http_access allow localhost purge
> > 2018/02/14 13:33:41| Processing: http_access deny purge
> > 2018/02/14 13:33:41| Processing: http_access allow localhost
> > 2018/02/14 13:33:41| Processing: http_access deny all
> > 2018/02/14 13:33:41| Processing: include /etc/squid/conf.d/test-http_
> port.conf
> > 2018/02/14 13:33:41| Processing Configuration File:
> > /etc/squid/conf.d/test-http_port.conf (depth 1)
> > 2018/02/14 13:33:41| Processing: http_port 8080 ssl-bump name=test
> > options=NO_SSLv3 cert=/etc/squid/cert/serverproxyCA.pem
> > generate-host-certificates=on tls-default-ca=off
> > options=SINGLE_DH_USE:SINGLE_ECDH_USE
> > tls-dh=/etc/squid/cert/dhparam.pem
> > sslflags=NO_SESSION_REUSE:VERIFY_CRL
> > cipher=EDH+aRSA+AESGCM:EDH+aRSA+AES:DHE-RSA-AES256-SHA:
> EECDH+aRSA+AESGCM:EECDH+aRSA+AES:ECDHE-RSA-AES256-SHA:
> ECDHE-RSA-AES128-SHA:RSA+AESGCM:RSA+AES+SHA:DES-CBC3-
> SHA:DHE-RSA-AES128-SHA
> > 2018/02/14 13:33:41| ERROR: Unknown TLS option SINGLE_DH_USE
> > 2018/02/14 13:33:41| ERROR: Unknown TLS option SINGLE_ECDH_USE
> > .....
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180219/e2e822e4/attachment.htm>

From jeroen.ruijter at borsboomhamm.nl  Mon Feb 19 09:30:14 2018
From: jeroen.ruijter at borsboomhamm.nl (Jeroen Ruijter)
Date: Mon, 19 Feb 2018 09:30:14 +0000
Subject: [squid-users] kerberos authentication with kerberos groups
In-Reply-To: <beb50c8f-ad13-1a82-66aa-e9bb6db4b983@treenet.co.nz>
References: <510FCECD6E595A4D83BF67FC07028E7507C8C90E@BHMB-01.bnh.local>
 <beb50c8f-ad13-1a82-66aa-e9bb6db4b983@treenet.co.nz>
Message-ID: <510FCECD6E595A4D83BF67FC07028E7507C96EFC@BHMB-01.bnh.local>

support_member.cc(91): pid=2166 :2018/02/19 08:23:59| kerberos_ldap_group: DEBUG: Default domain loop: group at domain ADGroupRaamregeling at BNH.LOCAL

support_member.cc(119): pid=2166 :2018/02/19 08:23:59| kerberos_ldap_group: DEBUG: Default group loop: group at domain ADGroupRaamregeling at BNH.LOCAL

support_member.cc(63): pid=2166 :2018/02/19 09:54:21| kerberos_ldap_group: DEBUG: User domain loop: group at domain ADGroupRaamregeling at BNH.LOCAL

support_member.cc(65): pid=2166 :2018/02/19 09:54:21| kerberos_ldap_group: DEBUG: Found group at domain ADGroupRaamregeling at BNH.LOCAL

support_member.cc(76): pid=2166 :2018/02/19 09:54:21| kerberos_ldap_group: INFO: User Jeroen.Ruijter is not member of group at domain ADGroupRaamregeling at BNH.LOCAL



So user authenticated for proxy the goup is found but the user is not a member, but I?m certainly a member





Squid info

bhlnx03:~ # squid -v

Squid Cache: Version 3.5.21

Service Name: squid

configure options:  '--host=x86_64-suse-linux-gnu' '--build=x86_64-suse-linux-gnu' '--program-prefix=' '--prefix=/usr' '--exec-prefix=/usr' '--bindir=/usr/bin' '--sbindir=/usr/sbin' '--sysconfdir=/etc' '--datadir=/usr/share' '--includedir=/usr/include' '--libdir=/usr/lib64' '--libexecdir=/usr/lib' '--localstatedir=/var' '--sharedstatedir=/usr/com' '--mandir=/usr/share/man' '--infodir=/usr/share/info' '--disable-dependency-tracking' '--disable-strict-error-checking' '--sysconfdir=/etc/squid' '--libexecdir=/usr/sbin' '--datadir=/usr/share/squid' '--sharedstatedir=/var/squid' '--with-logdir=/var/log/squid' '--with-pidfile=/run/squid.pid' '--with-dl' '--enable-disk-io' '--enable-storeio' '--enable-removal-policies=heap,lru' '--enable-icmp' '--enable-delay-pools' '--enable-esi' '--enable-icap-client' '--enable-useragent-log' '--enable-referer-log' '--enable-kill-parent-hack' '--enable-arp-acl' '--enable-ssl-crtd' '--with-openssl' '--enable-forw-via-db' '--enable-cache-digests' '--enable-linux-netfilter' '--with-large-files' '--enable-underscores' '--enable-auth' '--enable-auth-basic' '--enable-auth-ntlm' '--enable-auth-negotiate' '--enable-auth-digest' '--enable-external-acl-helpers=LDAP_group,eDirectory_userip,file_userip,kerberos_ldap_group,session,unix_group,wbinfo_group' '--enable-stacktraces' '--enable-x-accelerator-vary' '--with-default-user=squid' '--disable-ident-lookups' '--enable-follow-x-forwarded-for' '--disable-arch-native' 'build_alias=x86_64-suse-linux-gnu' 'host_alias=x86_64-suse-linux-gnu' 'CFLAGS=-fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -fPIE -fPIC -DOPENSSL_LOAD_CONF' 'LDFLAGS=-Wl,--as-needed -Wl,--no-undefined -Wl,-z,relro,-z,now -pie' 'CXXFLAGS=-fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -fPIE -fPIC -DOPENSSL_LOAD_CONF' 'PKG_CONFIG_PATH=:/usr/lib64/pkgconfig:/usr/share/pkgconfig'









-----Oorspronkelijk bericht-----
Van: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] Namens Amos Jeffries
Verzonden: vrijdag 16 februari 2018 18:58
Aan: squid-users at lists.squid-cache.org
Onderwerp: Re: [squid-users] kerberos authentication with kerberos groups



On 17/02/18 02:02, Jeroen Ruijter wrote:

> I'm trying to replace my basic ldap authentication by kerberos single

> sign on.

>



NP: Despite what some claim, SSO is not unique to NTLM and Kerberos authentication. It is a behaviour of the tools used. As such it can be done with *any* authentication type if the tools used perform the necessary behaviour.







> The user can succesfully login with single sign on, but I have

> restriction on groups and that is where it goes wrong.



What exactly does this "going wrong" look like?



Also, what version of Squid are you working with?

(the "squid -v" output please)



>

> I would like to use -r to trim the domain name, but when I do so it

> seems to work even less.

>

> Someone any ideas what to try, I believe the system is loking wrong in

> active directory but adding -b OU=Users,DC=yyy,DC=local does not help

> me further



You have some things looking for ".local" and others for ".LOCAL". I'm not sure if case insensitivity exists in all those places they are being used, so that is one potential cause of problems.





> =======

>

>

>

> auth_param negotiate program /usr/sbin/negotiate_wrapper_auth -d

> --ntlm /usr/bin/ntlm_auth --diagnostics

> --helper-protocol=squid-2.5-ntlmssp

> --domain=yyy --kerberos /usr/sbin/negotiate_kerberos_auth -d -s

> GSS_C_NO_NAME

>

> auth_param negotiate children 20 startup=0 idle=1

>

> auth_param negotiate keep_alive off

>

>

>

> external_acl_type XXX_InternetAllowed ttl=3600 negative_ttl=3600

> %LOGIN /usr/sbin/ext_kerberos_ldap_group_acl -b

> OU=Users,OU=BenH,DC=yyy,DC=local -g AD_XXX_InternetAllowed at yyy.LOCAL<mailto:AD_XXX_InternetAllowed at yyy.LOCAL>

> -d

>

> external_acl_type RestrictedAdult ttl=3600 negative_ttl=3600 %LOGIN

> /usr/sbin/ext_kerberos_ldap_group_acl -b

> OU=Users,OU=BenH,DC=yyy,DC=local -g ADGroupRestrictedAdult at yyy.LOCAL<mailto:ADGroupRestrictedAdult at yyy.LOCAL>

> -d

>

>

>

> acl XXX_InternetAllowed external XXX_InternetAllowed

>

> acl XXX_Adult external XXX_Adult

>



...

>

> http_access deny auth !XXX_InternetAllowed



The above says the users entire login is to be rejected if they are not a member of the XXX_InternetAllowed group.



That should work but it is better to reject failed logins fully first, then do the group checks separately.



Like this:



http_access deny !auth

http_access deny !XXX_InternetAllowed all



>

> http_access deny XXX_Adult XXX_AdultX

>



you could gain a fair bit of performance back by making that check the dstdomain before the slow external lookup:



  http_access deny XXX_AdultX XXX_Adult all





> http_access allow localnet

>

> http_access allow localhost

>

> http_access deny all

>

>

>

> ========

>





...

>

> support_ldap.cc(342): pid=7612 :2018/02/16 11:50:07|

> kerberos_ldap_group: DEBUG: Search ldap server with bind path

> CN=Schema,CN=Configuration,DC=bnh,DC=local and filter:

> (ldapdisplayname=samaccountname)

>

> support_ldap.cc(345): pid=7612 :2018/02/16 11:50:07|

> kerberos_ldap_group: DEBUG: Found 0 ldap entries

>

> support_ldap.cc(350): pid=7612 :2018/02/16 11:50:07|

> kerberos_ldap_group: DEBUG: Determined ldap server not as an Active

> Directory server

>

> support_ldap.cc(1061): pid=7612 :2018/02/16 11:50:07|

> kerberos_ldap_group: ERROR: Error determining ldap server type:

> Operations error

>

> support_member.cc(76): pid=7612 :2018/02/16 11:50:07|

> kerberos_ldap_group: INFO: User Administrator is not member of

> group at domain AD_XXX_InternetAllowed at YYY.LOCAL<mailto:AD_XXX_InternetAllowed at YYY.LOCAL>

>



Looks like it is working to me.



The helper tries several methods of locating a server, two fail but the third seems to work and produces the above result.





Amos



_______________________________________________

squid-users mailing list

squid-users at lists.squid-cache.org<mailto:squid-users at lists.squid-cache.org>

http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180219/0c151c64/attachment.htm>

From jeroen.ruijter at borsboomhamm.nl  Mon Feb 19 10:19:23 2018
From: jeroen.ruijter at borsboomhamm.nl (Jeroen Ruijter)
Date: Mon, 19 Feb 2018 10:19:23 +0000
Subject: [squid-users] kerberos authentication with kerberos groups
In-Reply-To: <beb50c8f-ad13-1a82-66aa-e9bb6db4b983@treenet.co.nz>
References: <510FCECD6E595A4D83BF67FC07028E7507C8C90E@BHMB-01.bnh.local>
 <beb50c8f-ad13-1a82-66aa-e9bb6db4b983@treenet.co.nz>
Message-ID: <510FCECD6E595A4D83BF67FC07028E7507C96FE2@BHMB-01.bnh.local>

Do you advise to use capitals or small characters for the domain name?


-----Oorspronkelijk bericht-----
Van: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] Namens Amos Jeffries
Verzonden: vrijdag 16 februari 2018 18:58
Aan: squid-users at lists.squid-cache.org
Onderwerp: Re: [squid-users] kerberos authentication with kerberos groups

On 17/02/18 02:02, Jeroen Ruijter wrote:
> I'm trying to replace my basic ldap authentication by kerberos single 
> sign on.
> 

NP: Despite what some claim, SSO is not unique to NTLM and Kerberos authentication. It is a behaviour of the tools used. As such it can be done with *any* authentication type if the tools used perform the necessary behaviour.



> The user can succesfully login with single sign on, but I have 
> restriction on groups and that is where it goes wrong.

What exactly does this "going wrong" look like?

Also, what version of Squid are you working with?
 (the "squid -v" output please)

> 
> I would like to use -r to trim the domain name, but when I do so it 
> seems to work even less.
> 
> Someone any ideas what to try, I believe the system is loking wrong in 
> active directory but adding -b?OU=Users,DC=yyy,DC=local does not help 
> me further

You have some things looking for ".local" and others for ".LOCAL". I'm not sure if case insensitivity exists in all those places they are being used, so that is one potential cause of problems.


> =======
> 
> ?
> 
> auth_param negotiate program /usr/sbin/negotiate_wrapper_auth -d 
> --ntlm /usr/bin/ntlm_auth --diagnostics 
> --helper-protocol=squid-2.5-ntlmssp
> --domain=yyy --kerberos /usr/sbin/negotiate_kerberos_auth -d -s 
> GSS_C_NO_NAME
> 
> auth_param negotiate children 20 startup=0 idle=1
> 
> auth_param negotiate keep_alive off
> 
> ?
> 
> external_acl_type XXX_InternetAllowed ttl=3600 negative_ttl=3600 
> %LOGIN /usr/sbin/ext_kerberos_ldap_group_acl -b 
> OU=Users,OU=BenH,DC=yyy,DC=local -g AD_XXX_InternetAllowed at yyy.LOCAL 
> -d
> 
> external_acl_type RestrictedAdult ttl=3600 negative_ttl=3600 %LOGIN 
> /usr/sbin/ext_kerberos_ldap_group_acl -b 
> OU=Users,OU=BenH,DC=yyy,DC=local -g ADGroupRestrictedAdult at yyy.LOCAL 
> -d
> 
> ?
> 
> acl XXX_InternetAllowed external XXX_InternetAllowed
> 
> acl XXX_Adult external XXX_Adult
> 

...
> 
> http_access deny auth !XXX_InternetAllowed

The above says the users entire login is to be rejected if they are not a member of the XXX_InternetAllowed group.

That should work but it is better to reject failed logins fully first, then do the group checks separately.

Like this:

 http_access deny !auth
 http_access deny !XXX_InternetAllowed all

> 
> http_access deny XXX_Adult XXX_AdultX
> 

you could gain a fair bit of performance back by making that check the dstdomain before the slow external lookup:

  http_access deny XXX_AdultX XXX_Adult all


> http_access allow localnet
> 
> http_access allow localhost
> 
> http_access deny all
> 
> ?
> 
> ========
> 


...
> 
> support_ldap.cc(342): pid=7612 :2018/02/16 11:50:07|
> kerberos_ldap_group: DEBUG: Search ldap server with bind path 
> CN=Schema,CN=Configuration,DC=bnh,DC=local and filter:
> (ldapdisplayname=samaccountname)
> 
> support_ldap.cc(345): pid=7612 :2018/02/16 11:50:07|
> kerberos_ldap_group: DEBUG: Found 0 ldap entries
> 
> support_ldap.cc(350): pid=7612 :2018/02/16 11:50:07|
> kerberos_ldap_group: DEBUG: Determined ldap server not as an Active 
> Directory server
> 
> support_ldap.cc(1061): pid=7612 :2018/02/16 11:50:07|
> kerberos_ldap_group: ERROR: Error determining ldap server type:
> Operations error
> 
> support_member.cc(76): pid=7612 :2018/02/16 11:50:07|
> kerberos_ldap_group: INFO: User Administrator is not member of 
> group at domain AD_XXX_InternetAllowed at YYY.LOCAL
> 

Looks like it is working to me.

The helper tries several methods of locating a server, two fail but the third seems to work and produces the above result.


Amos

_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users

From squid3 at treenet.co.nz  Mon Feb 19 20:35:37 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 20 Feb 2018 09:35:37 +1300
Subject: [squid-users] Where squid deamon is stored?
In-Reply-To: <d4fae797-4c85-d86a-79f4-eea15bf48641@suse.de>
References: <CABrM6wnkJLwwP3rtNOqkczQVr0=VdbZgfyzG2NR6ve-BAJDWhA@mail.gmail.com>
 <d4fae797-4c85-d86a-79f4-eea15bf48641@suse.de>
Message-ID: <78cf8c41-65e3-ca6c-5cdb-ea8f41c4a6a8@treenet.co.nz>

On 19/02/18 20:52, Adam Majer wrote:
> On 02/18/2018 06:38 PM, Peng Yu wrote:
>> I don't find squid3 in /etc/init.d. Does anybody know where the deamon
>> script is stored?
>>
> 
> Probably it's running using systemd these days, which means it's
> somewhere under /lib/systemd or /usr/lib/systemd, and you are NOT
> suppose to modify that stuff.

Nod. That is where OS matters.

Which OS has not been mentioned yet, though from the name "squid3"
implies Debian or a derivative.


Also, be aware that systemd is not compatible with Squid-3 and packages
should not be installing .service files for those versions of Squid.
Eliezer and some others worked out some .service script setup that kind
of works (almost) with some helper scripts to do the environment
integration parts. But really if you want systemd you should use Squid-4.

Amos


From amajer at suse.de  Tue Feb 20 07:36:21 2018
From: amajer at suse.de (Adam Majer)
Date: Tue, 20 Feb 2018 08:36:21 +0100
Subject: [squid-users] Where squid deamon is stored?
In-Reply-To: <78cf8c41-65e3-ca6c-5cdb-ea8f41c4a6a8@treenet.co.nz>
References: <CABrM6wnkJLwwP3rtNOqkczQVr0=VdbZgfyzG2NR6ve-BAJDWhA@mail.gmail.com>
 <d4fae797-4c85-d86a-79f4-eea15bf48641@suse.de>
 <78cf8c41-65e3-ca6c-5cdb-ea8f41c4a6a8@treenet.co.nz>
Message-ID: <07808db8-e9bd-ba10-4844-31369a283791@suse.de>

On 02/19/2018 09:35 PM, Amos Jeffries wrote:
> On 19/02/18 20:52, Adam Majer wrote:
>> On 02/18/2018 06:38 PM, Peng Yu wrote:
>>> I don't find squid3 in /etc/init.d. Does anybody know where the deamon
>>> script is stored?
>>>
>>
>> Probably it's running using systemd these days, which means it's
>> somewhere under /lib/systemd or /usr/lib/systemd, and you are NOT
>> suppose to modify that stuff.
> 
> Nod. That is where OS matters.
> 
> Which OS has not been mentioned yet, though from the name "squid3"
> implies Debian or a derivative.

There is also squid3 in SLES11-SP4 and that will exist for a little
while still. But that has SysV init.d scripts though.


> Also, be aware that systemd is not compatible with Squid-3 and packages
> should not be installing .service files for those versions of Squid.
> Eliezer and some others worked out some .service script setup that kind
> of works (almost) with some helper scripts to do the environment
> integration parts. But really if you want systemd you should use Squid-4.

In most cases there is no choice in the matter. For example, SLES12 (so
Leap 42 for openSUSE) is all systemd based and it's been around since
squid 3.3.x days. But the service file there is using squid to manage
squid so it's not that bad ;)

Like it's often in software, sometimes you reach for ideal but then when
you have to ship something you crease and cram to get it in the box ;)

- Adam


From erdosain9 at gmail.com  Tue Feb 20 13:35:25 2018
From: erdosain9 at gmail.com (erdosain9)
Date: Tue, 20 Feb 2018 06:35:25 -0700 (MST)
Subject: [squid-users] ldap_sasl_interactive_bind_s error: Can't contact
	LDAP server
Message-ID: <1519133725693-0.post@n4.nabble.com>

Hi. Im having this problem. Im running squid on a Centos 7 container (lxc on
proxmox).

This is cache.log

support_sasl.cc(276): pid=555 :2018/02/20 10:13:34| kerberos_ldap_group:
ERROR: ldap_sasl_interactive_bind_s error: Can't contact LDAP server
support_ldap.cc(957): pid=555 :2018/02/20 10:13:34| kerberos_ldap_group:
ERROR: Error while binding to ldap server with SASL/GSSAPI: Can't contact
LDAP server


Can somebody give me a hand???

I dont know what can be bad. This is the config:

 cat /etc/krb5.conf
[logging]
 default = FILE:/var/log/krb5libs.log
 kdc = FILE:/var/log/krb5kdc.log
 admin_server = FILE:/var/log/kadmind.log

[libdefaults]
    default_realm = MYDOMAIN.LAN
    dns_lookup_kdc = no
    dns_lookup_realm = no
    ticket_lifetime = 24h
    default_keytab_name = /etc/squid/PROXY.keytab

; for Windows 2003
;    default_tgs_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
;    default_tkt_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
;    permitted_enctypes = rc4-hmac des-cbc-crc des-cbc-md5

; for Windows 2008 with AES
    default_tgs_enctypes = aes256-cts-hmac-sha1-96 rc4-hmac des-cbc-crc
des-cbc-md5
    default_tkt_enctypes = aes256-cts-hmac-sha1-96 rc4-hmac des-cbc-crc
des-cbc-md5
    permitted_enctypes = aes256-cts-hmac-sha1-96 rc4-hmac des-cbc-crc
des-cbc-md5


[realms]
    MYDOMAIN.LAN = {
        kdc = adw-1.mydomain.lan
        kdc = w-data2.mydomain.lan
        admin_server = adw-1.mydomain.lan
        default_domain = mydomain.lan
    }

[domain_realm]
    .mydomain.lan = MYDOMAIN.LAN
    mydomain.lan = MYDOMAIN.LAN  


SQUID.CONF
###Kerberos Auth with ActiveDirectory###
auth_param negotiate program /lib64/squid/negotiate_kerberos_auth -s
HTTP/proxy.mydomain.lan at MYDOMAIN.LAN
auth_param negotiate children 50 startup=0 idle=1
auth_param basic credentialsttl 2 hours
auth_param negotiate keep_alive on

external_acl_type i-restringidos %LOGIN
/usr/lib64/squid/ext_kerberos_ldap_group_acl -g i-restringidos at MYDOMAIN.LAN
external_acl_type i-full %LOGIN /usr/lib64/squid/ext_kerberos_ldap_group_acl
-g i-full at MYDOMAIN.LAN
external_acl_type i-limitado %LOGIN
/usr/lib64/squid/ext_kerberos_ldap_group_acl -g i-limitado at MYDOMAIN.LAN



/ETC/HOSTS

[root at proxy ~]# cat /etc/hosts
127.0.0.1   localhost LXC_NAME
::1 localhost.localnet localhost
# --- END PVE ---
#
192.168.1.222 adw-1.mydomain.lan
192.168.1.107 w-data2.mydomain.lan
# --- BEGIN PVE ---
192.168.6.215 proxy.mydomain.lan proxy
# --- END PVE ---


/ETC/RESOLV.CONF
[root at proxy ~]# cat /etc/resolv.conf 
# --- BEGIN PVE ---
search mydomain.lan
nameserver 192.168.1.107
nameserver 192.168.1.222
# --- END PVE ---
domain mydomain.lan


Thanks



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From yvoinov at gmail.com  Tue Feb 20 13:39:53 2018
From: yvoinov at gmail.com (Yuri)
Date: Tue, 20 Feb 2018 19:39:53 +0600
Subject: [squid-users] ldap_sasl_interactive_bind_s error: Can't contact
 LDAP server
In-Reply-To: <1519133725693-0.post@n4.nabble.com>
References: <1519133725693-0.post@n4.nabble.com>
Message-ID: <960f0ade-b804-127e-cbbc-076db15363e3@gmail.com>

Check LDAP port availability on LDAP server. On firewall it should be open.

If your LDAP is WIndows server, AFAIK, it has closed firewall by
default. I.e. all incoming connections are blocked.


20.02.2018 19:35, erdosain9 ?????:
> Hi. Im having this problem. Im running squid on a Centos 7 container (lxc on
> proxmox).
>
> This is cache.log
>
> support_sasl.cc(276): pid=555 :2018/02/20 10:13:34| kerberos_ldap_group:
> ERROR: ldap_sasl_interactive_bind_s error: Can't contact LDAP server
> support_ldap.cc(957): pid=555 :2018/02/20 10:13:34| kerberos_ldap_group:
> ERROR: Error while binding to ldap server with SASL/GSSAPI: Can't contact
> LDAP server
>
>
> Can somebody give me a hand???
>
> I dont know what can be bad. This is the config:
>
>  cat /etc/krb5.conf
> [logging]
>  default = FILE:/var/log/krb5libs.log
>  kdc = FILE:/var/log/krb5kdc.log
>  admin_server = FILE:/var/log/kadmind.log
>
> [libdefaults]
>     default_realm = MYDOMAIN.LAN
>     dns_lookup_kdc = no
>     dns_lookup_realm = no
>     ticket_lifetime = 24h
>     default_keytab_name = /etc/squid/PROXY.keytab
>
> ; for Windows 2003
> ;    default_tgs_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
> ;    default_tkt_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
> ;    permitted_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
>
> ; for Windows 2008 with AES
>     default_tgs_enctypes = aes256-cts-hmac-sha1-96 rc4-hmac des-cbc-crc
> des-cbc-md5
>     default_tkt_enctypes = aes256-cts-hmac-sha1-96 rc4-hmac des-cbc-crc
> des-cbc-md5
>     permitted_enctypes = aes256-cts-hmac-sha1-96 rc4-hmac des-cbc-crc
> des-cbc-md5
>
>
> [realms]
>     MYDOMAIN.LAN = {
>         kdc = adw-1.mydomain.lan
>         kdc = w-data2.mydomain.lan
>         admin_server = adw-1.mydomain.lan
>         default_domain = mydomain.lan
>     }
>
> [domain_realm]
>     .mydomain.lan = MYDOMAIN.LAN
>     mydomain.lan = MYDOMAIN.LAN  
>
>
> SQUID.CONF
> ###Kerberos Auth with ActiveDirectory###
> auth_param negotiate program /lib64/squid/negotiate_kerberos_auth -s
> HTTP/proxy.mydomain.lan at MYDOMAIN.LAN
> auth_param negotiate children 50 startup=0 idle=1
> auth_param basic credentialsttl 2 hours
> auth_param negotiate keep_alive on
>
> external_acl_type i-restringidos %LOGIN
> /usr/lib64/squid/ext_kerberos_ldap_group_acl -g i-restringidos at MYDOMAIN.LAN
> external_acl_type i-full %LOGIN /usr/lib64/squid/ext_kerberos_ldap_group_acl
> -g i-full at MYDOMAIN.LAN
> external_acl_type i-limitado %LOGIN
> /usr/lib64/squid/ext_kerberos_ldap_group_acl -g i-limitado at MYDOMAIN.LAN
>
>
>
> /ETC/HOSTS
>
> [root at proxy ~]# cat /etc/hosts
> 127.0.0.1   localhost LXC_NAME
> ::1 localhost.localnet localhost
> # --- END PVE ---
> #
> 192.168.1.222 adw-1.mydomain.lan
> 192.168.1.107 w-data2.mydomain.lan
> # --- BEGIN PVE ---
> 192.168.6.215 proxy.mydomain.lan proxy
> # --- END PVE ---
>
>
> /ETC/RESOLV.CONF
> [root at proxy ~]# cat /etc/resolv.conf 
> # --- BEGIN PVE ---
> search mydomain.lan
> nameserver 192.168.1.107
> nameserver 192.168.1.222
> # --- END PVE ---
> domain mydomain.lan
>
>
> Thanks
>
>
>
> --
> Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-- 
*****************************
* C++20 : Bug to the future *
*****************************


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180220/d4b3cbfd/attachment.sig>

From skupko.sk at gmail.com  Tue Feb 20 13:53:27 2018
From: skupko.sk at gmail.com (Peter Viskup)
Date: Tue, 20 Feb 2018 14:53:27 +0100
Subject: [squid-users] Squid4 multi-instance configuration
Message-ID: <CAPa6PsFX_Watg3nGNZ47Ho82kt+QRd9N3B0i-4enj2Z0mgSL_w@mail.gmail.com>

Feel free to use this systemd (based on postgresql) and logrotate
configuration for multi-instance configuration according wiki [1].
Might be useful for others.

The instance is "enabled" by presence of
/etc/squid/${service_name}.instance file.

There could be includes like these in squid.conf

pid_filename /var/run/squid/${service_name}.pid # required
include /etc/squid/conf.d/${service_name}-http_port.conf # at least
http_port needs to differ
include /etc/squid/conf.d/${service_name}-cache_dir.conf # cache_dir
needs to differ either
include /etc/squid/conf.d/${service_name}-log.conf # log targets needs
to differ either

Example of http_port configuration
~# cat conf.d/test-http_port.conf
http_port 8080 name=${service_name} # see the use of ${service_name}
macro in included files

And services are managed via systemd
~# systemctl start squid at prod.service
~# systemctl status squid at prod.service

[1] https://wiki.squid-cache.org/MultipleInstances

Peter
-------------- next part --------------
A non-text attachment was scrubbed...
Name: squid.logrotate
Type: application/octet-stream
Size: 394 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180220/bc9f68e8/attachment.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: squid.service
Type: application/octet-stream
Size: 191 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180220/bc9f68e8/attachment-0001.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: squid at .service
Type: application/octet-stream
Size: 919 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180220/bc9f68e8/attachment-0002.obj>

From erdosain9 at gmail.com  Tue Feb 20 14:00:08 2018
From: erdosain9 at gmail.com (erdosain9)
Date: Tue, 20 Feb 2018 07:00:08 -0700 (MST)
Subject: [squid-users] ldap_sasl_interactive_bind_s error: Can't contact
	LDAP server
In-Reply-To: <960f0ade-b804-127e-cbbc-076db15363e3@gmail.com>
References: <1519133725693-0.post@n4.nabble.com>
 <960f0ade-b804-127e-cbbc-076db15363e3@gmail.com>
Message-ID: <1519135208604-0.post@n4.nabble.com>

Hi.
The port is open.

There is a way to have a little more log??'
Thanks



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From yvoinov at gmail.com  Tue Feb 20 14:57:55 2018
From: yvoinov at gmail.com (Yuri)
Date: Tue, 20 Feb 2018 20:57:55 +0600
Subject: [squid-users] ldap_sasl_interactive_bind_s error: Can't contact
 LDAP server
In-Reply-To: <1519135208604-0.post@n4.nabble.com>
References: <1519133725693-0.post@n4.nabble.com>
 <960f0ade-b804-127e-cbbc-076db15363e3@gmail.com>
 <1519135208604-0.post@n4.nabble.com>
Message-ID: <68702486-ed7d-c181-d0db-71eef5baf51a@gmail.com>

Of course, you, as sysadmin, should knows basics of troubleshooting,
isn't it?

If port is open, try to connect with it from proxy box via ldap client.
If it will successfully,
next step is turn on squid's debug and investigate detailed logs.

20.02.2018 20:00, erdosain9 ?????:
> Hi.
> The port is open.
>
> There is a way to have a little more log??'
> Thanks
>
>
>
> --
> Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-- 
*****************************
* C++20 : Bug to the future *
*****************************


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180220/ded469c0/attachment.sig>

From erdosain9 at gmail.com  Tue Feb 20 16:15:01 2018
From: erdosain9 at gmail.com (erdosain9)
Date: Tue, 20 Feb 2018 09:15:01 -0700 (MST)
Subject: [squid-users] ldap_sasl_interactive_bind_s error: Can't contact
	LDAP server
In-Reply-To: <68702486-ed7d-c181-d0db-71eef5baf51a@gmail.com>
References: <1519133725693-0.post@n4.nabble.com>
 <960f0ade-b804-127e-cbbc-076db15363e3@gmail.com>
 <1519135208604-0.post@n4.nabble.com>
 <68702486-ed7d-c181-d0db-71eef5baf51a@gmail.com>
Message-ID: <1519143301292-0.post@n4.nabble.com>

sorry, yuri, yes is working. 
i can connect via ldap and also turn on debug for investigate, and is no
error know...
but time to time, this error is happening... so... is strange.

In the other hand im getting this values with just one machine using the
squid :

Negotiate Authenticator Statistics:
program: /lib64/squid/negotiate_kerberos_auth
number active: 32 of 50 (0 shutting down)
requests sent: 66
replies received: 66
queue length: 0
avg service time: 208 msec

   ID #	     FD	    PID	 # Requests	  # Replies	 Flags	   Time	 Offset
Request
     21	     44	   2193	         24	         24	     	  0.022	      0	(none)
     22	     61	   2194	          5	          5	     	  0.322	      0	(none)
     23	     64	   2195	          5	          5	     	  0.387	      0	(none)
     24	     70	   2196	          3	          3	     	  0.397	      0	(none)
     25	    150	   2201	          2	          2	     	  0.323	      0	(none)
     26	    151	   2202	          1	          1	     	  0.158	      0	(none)
     27	    153	   2203	          1	          1	     	  0.192	      0	(none)
     28	    155	   2204	          1	          1	     	  0.152	      0	(none)
     29	    157	   2205	          1	          1	     	  0.380	      0	(none)
     30	    159	   2206	          1	          1	     	  0.394	      0	(none)
     31	    161	   2207	          1	          1	     	  0.465	      0	(none)
     32	    163	   2208	          1	          1	     	  0.439	      0	(none)
     33	    165	   2209	          1	          1	     	  0.437	      0	(none)
     34	    167	   2210	          1	          1	     	  0.591	      0	(none)
     35	    169	   2211	          1	          1	     	  0.226	      0	(none)
     36	    171	   2212	          1	          1	     	  0.564	      0	(none)
     37	    173	   2213	          1	          1	     	  0.221	      0	(none)
     38	    175	   2214	          1	          1	     	  0.115	      0	(none)
     39	    177	   2215	          1	          1	     	  0.161	      0	(none)
     40	    179	   2216	          1	          1	     	  0.335	      0	(none)
     41	    181	   2217	          1	          1	     	  0.382	      0	(none)
     42	    154	   2218	          1	          1	     	  0.547	      0	(none)
     43	    158	   2219	          1	          1	     	  0.605	      0	(none)
     44	    162	   2220	          1	          1	     	  0.493	      0	(none)
     45	    166	   2221	          1	          1	     	  0.465	      0	(none)
     46	    170	   2222	          1	          1	     	  0.586	      0	(none)
     47	    174	   2223	          1	          1	     	  0.270	      0	(none)
     48	    178	   2224	          1	          1	     	  0.249	      0	(none)
     49	    182	   2225	          1	          1	     	  0.504	      0	(none)
     50	    184	   2226	          1	          1	     	  0.479	      0	(none)
     51	    186	   2227	          1	          1	     	  0.284	      0	(none)
     52	    188	   2228	          1	          1	     	  0.560	      0	(none)

a little high dont you think?? avg service time: 208 msec
In the working squid some times the values go to 2500 msec..... (with 70
users)

Thanks




--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From jeroen.ruijter at borsboomhamm.nl  Tue Feb 20 16:32:26 2018
From: jeroen.ruijter at borsboomhamm.nl (Jeroen Ruijter)
Date: Tue, 20 Feb 2018 16:32:26 +0000
Subject: [squid-users] kerberos authentication with kerberos groups
In-Reply-To: <510FCECD6E595A4D83BF67FC07028E7507C96FE2@BHMB-01.bnh.local>
References: <510FCECD6E595A4D83BF67FC07028E7507C8C90E@BHMB-01.bnh.local>
 <beb50c8f-ad13-1a82-66aa-e9bb6db4b983@treenet.co.nz>
 <510FCECD6E595A4D83BF67FC07028E7507C96FE2@BHMB-01.bnh.local>
Message-ID: <510FCECD6E595A4D83BF67FC07028E7507C99B56@BHMB-01.bnh.local>

I believe this has to be the problem, but how do I solve it? Its almost at the end of the whole listing

support_ldap.cc(333): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: DEBUG: Search ldap server with bind path "" and filter: (objectclass=*)
support_ldap.cc(602): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: DEBUG: Search ldap entries for attribute : schemaNamingContext
support_ldap.cc(645): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: DEBUG: 1 ldap entry found with attribute : schemaNamingContext
support_ldap.cc(342): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: DEBUG: Search ldap server with bind path CN=Schema,CN=Configuration,DC=bnh,DC=local and filter: (ldapdisplayname=samaccountname)




kerberos_ldap_group.cc(283): pid=2951 :2018/02/20 17:02:21| kerberos_ldap_group: INFO: Starting version 1.3.1sq
support_group.cc(382): pid=2951 :2018/02/20 17:02:21| kerberos_ldap_group: INFO: Group list ADGroupRaamregeling@
support_group.cc(447): pid=2951 :2018/02/20 17:02:21| kerberos_ldap_group: INFO: Group ADGroupRaamregeling  Domain
support_netbios.cc(83): pid=2951 :2018/02/20 17:02:21| kerberos_ldap_group: DEBUG: Netbios list NULL
support_netbios.cc(87): pid=2951 :2018/02/20 17:02:21| kerberos_ldap_group: DEBUG: No netbios names defined.
support_lserver.cc(82): pid=2951 :2018/02/20 17:02:21| kerberos_ldap_group: DEBUG: ldap server list NULL
support_lserver.cc(86): pid=2951 :2018/02/20 17:02:21| kerberos_ldap_group: DEBUG: No ldap servers defined.
kerberos_ldap_group.cc(283): pid=2953 :2018/02/20 17:02:21| kerberos_ldap_group: INFO: Starting version 1.3.1sq
support_group.cc(382): pid=2953 :2018/02/20 17:02:21| kerberos_ldap_group: INFO: Group list ADGroupRaamregeling@
support_group.cc(447): pid=2953 :2018/02/20 17:02:21| kerberos_ldap_group: INFO: Group ADGroupRaamregeling  Domain
support_netbios.cc(83): pid=2953 :2018/02/20 17:02:21| kerberos_ldap_group: DEBUG: Netbios list NULL
support_netbios.cc(87): pid=2953 :2018/02/20 17:02:21| kerberos_ldap_group: DEBUG: No netbios names defined.
support_lserver.cc(82): pid=2953 :2018/02/20 17:02:21| kerberos_ldap_group: DEBUG: ldap server list NULL
support_lserver.cc(86): pid=2953 :2018/02/20 17:02:21| kerberos_ldap_group: DEBUG: No ldap servers defined.
kerberos_ldap_group.cc(283): pid=2952 :2018/02/20 17:02:21| kerberos_ldap_group: INFO: Starting version 1.3.1sq
support_group.cc(382): pid=2952 :2018/02/20 17:02:21| kerberos_ldap_group: INFO: Group list ADGroupRaamregeling@
support_group.cc(447): pid=2952 :2018/02/20 17:02:21| kerberos_ldap_group: INFO: Group ADGroupRaamregeling  Domain
support_netbios.cc(83): pid=2952 :2018/02/20 17:02:21| kerberos_ldap_group: DEBUG: Netbios list NULL
support_netbios.cc(87): pid=2952 :2018/02/20 17:02:21| kerberos_ldap_group: DEBUG: No netbios names defined.
support_lserver.cc(82): pid=2952 :2018/02/20 17:02:21| kerberos_ldap_group: DEBUG: ldap server list NULL
support_lserver.cc(86): pid=2952 :2018/02/20 17:02:21| kerberos_ldap_group: DEBUG: No ldap servers defined.
2018/02/20 17:02:21 kid1| helperOpenServers: Starting 5/5 'ext_kerberos_ldap_group_acl' processes
kerberos_ldap_group.cc(283): pid=2954 :2018/02/20 17:02:21| kerberos_ldap_group: INFO: Starting version 1.3.1sq
support_group.cc(382): pid=2954 :2018/02/20 17:02:21| kerberos_ldap_group: INFO: Group list ADGroupRaamregeling@
support_group.cc(447): pid=2954 :2018/02/20 17:02:21| kerberos_ldap_group: INFO: Group ADGroupRaamregeling  Domain
support_netbios.cc(83): pid=2954 :2018/02/20 17:02:21| kerberos_ldap_group: DEBUG: Netbios list NULL
support_netbios.cc(87): pid=2954 :2018/02/20 17:02:21| kerberos_ldap_group: DEBUG: No netbios names defined.
support_lserver.cc(82): pid=2954 :2018/02/20 17:02:21| kerberos_ldap_group: DEBUG: ldap server list NULL
support_lserver.cc(86): pid=2954 :2018/02/20 17:02:21| kerberos_ldap_group: DEBUG: No ldap servers defined.
kerberos_ldap_group.cc(283): pid=2955 :2018/02/20 17:02:21| kerberos_ldap_group: INFO: Starting version 1.3.1sq
support_group.cc(382): pid=2955 :2018/02/20 17:02:21| kerberos_ldap_group: INFO: Group list ADGroupRaamregeling@
support_group.cc(447): pid=2955 :2018/02/20 17:02:21| kerberos_ldap_group: INFO: Group ADGroupRaamregeling  Domain
support_netbios.cc(83): pid=2955 :2018/02/20 17:02:21| kerberos_ldap_group: DEBUG: Netbios list NULL
support_netbios.cc(87): pid=2955 :2018/02/20 17:02:21| kerberos_ldap_group: DEBUG: No netbios names defined.
support_lserver.cc(82): pid=2955 :2018/02/20 17:02:21| kerberos_ldap_group: DEBUG: ldap server list NULL
support_lserver.cc(86): pid=2955 :2018/02/20 17:02:21| kerberos_ldap_group: DEBUG: No ldap servers defined.
kerberos_ldap_group.cc(283): pid=2956 :2018/02/20 17:02:21| kerberos_ldap_group: INFO: Starting version 1.3.1sq
support_group.cc(382): pid=2956 :2018/02/20 17:02:21| kerberos_ldap_group: INFO: Group list ADGroupRestrictedAdult@
support_group.cc(447): pid=2956 :2018/02/20 17:02:21| kerberos_ldap_group: INFO: Group ADGroupRestrictedAdult  Domain
support_netbios.cc(83): pid=2956 :2018/02/20 17:02:21| kerberos_ldap_group: DEBUG: Netbios list NULL
support_netbios.cc(87): pid=2956 :2018/02/20 17:02:21| kerberos_ldap_group: DEBUG: No netbios names defined.
support_lserver.cc(82): pid=2956 :2018/02/20 17:02:21| kerberos_ldap_group: DEBUG: ldap server list NULL
support_lserver.cc(86): pid=2956 :2018/02/20 17:02:21| kerberos_ldap_group: DEBUG: No ldap servers defined.
kerberos_ldap_group.cc(283): pid=2957 :2018/02/20 17:02:21| kerberos_ldap_group: INFO: Starting version 1.3.1sq
support_group.cc(382): pid=2957 :2018/02/20 17:02:21| kerberos_ldap_group: INFO: Group list ADGroupRestrictedAdult@
support_group.cc(447): pid=2957 :2018/02/20 17:02:21| kerberos_ldap_group: INFO: Group ADGroupRestrictedAdult  Domain
support_netbios.cc(83): pid=2957 :2018/02/20 17:02:21| kerberos_ldap_group: DEBUG: Netbios list NULL
support_netbios.cc(87): pid=2957 :2018/02/20 17:02:21| kerberos_ldap_group: DEBUG: No netbios names defined.
support_lserver.cc(82): pid=2957 :2018/02/20 17:02:21| kerberos_ldap_group: DEBUG: ldap server list NULL
support_lserver.cc(86): pid=2957 :2018/02/20 17:02:21| kerberos_ldap_group: DEBUG: No ldap servers defined.
kerberos_ldap_group.cc(283): pid=2958 :2018/02/20 17:02:21| kerberos_ldap_group: INFO: Starting version 1.3.1sq
support_group.cc(382): pid=2958 :2018/02/20 17:02:21| kerberos_ldap_group: INFO: Group list ADGroupRestrictedAdult@
support_group.cc(447): pid=2958 :2018/02/20 17:02:21| kerberos_ldap_group: INFO: Group ADGroupRestrictedAdult  Domain
support_netbios.cc(83): pid=2958 :2018/02/20 17:02:21| kerberos_ldap_group: DEBUG: Netbios list NULL
support_netbios.cc(87): pid=2958 :2018/02/20 17:02:21| kerberos_ldap_group: DEBUG: No netbios names defined.
support_lserver.cc(82): pid=2958 :2018/02/20 17:02:21| kerberos_ldap_group: DEBUG: ldap server list NULL
support_lserver.cc(86): pid=2958 :2018/02/20 17:02:21| kerberos_ldap_group: DEBUG: No ldap servers defined.
kerberos_ldap_group.cc(283): pid=2959 :2018/02/20 17:02:21| kerberos_ldap_group: INFO: Starting version 1.3.1sq
support_group.cc(382): pid=2959 :2018/02/20 17:02:21| kerberos_ldap_group: INFO: Group list ADGroupRestrictedAdult@
support_group.cc(447): pid=2959 :2018/02/20 17:02:21| kerberos_ldap_group: INFO: Group ADGroupRestrictedAdult  Domain
support_netbios.cc(83): pid=2959 :2018/02/20 17:02:21| kerberos_ldap_group: DEBUG: Netbios list NULL
support_netbios.cc(87): pid=2959 :2018/02/20 17:02:21| kerberos_ldap_group: DEBUG: No netbios names defined.
support_lserver.cc(82): pid=2959 :2018/02/20 17:02:21| kerberos_ldap_group: DEBUG: ldap server list NULL
support_lserver.cc(86): pid=2959 :2018/02/20 17:02:21| kerberos_ldap_group: DEBUG: No ldap servers defined.
kerberos_ldap_group.cc(283): pid=2960 :2018/02/20 17:02:21| kerberos_ldap_group: INFO: Starting version 1.3.1sq
support_group.cc(382): pid=2960 :2018/02/20 17:02:21| kerberos_ldap_group: INFO: Group list ADGroupRestrictedAdult@
support_group.cc(447): pid=2960 :2018/02/20 17:02:21| kerberos_ldap_group: INFO: Group ADGroupRestrictedAdult  Domain
support_netbios.cc(83): pid=2960 :2018/02/20 17:02:21| kerberos_ldap_group: DEBUG: Netbios list NULL
support_netbios.cc(87): pid=2960 :2018/02/20 17:02:21| kerberos_ldap_group: DEBUG: No netbios names defined.
support_lserver.cc(82): pid=2960 :2018/02/20 17:02:21| kerberos_ldap_group: DEBUG: ldap server list NULL
support_lserver.cc(86): pid=2960 :2018/02/20 17:02:21| kerberos_ldap_group: DEBUG: No ldap servers defined.
kerberos_ldap_group.cc(381): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: INFO: Got User: Jeroen.Ruijter Domain: BNH.LOCAL
support_member.cc(63): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: DEBUG: User domain loop: group at domain ADGroupRaamregeling@
support_member.cc(91): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: DEBUG: Default domain loop: group at domain ADGroupRaamregeling@
support_member.cc(93): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: DEBUG: Found group at domain ADGroupRaamregeling@
support_ldap.cc(898): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: DEBUG: Setup Kerberos credential cache
support_krb5.cc(127): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: DEBUG: Set credential cache to MEMORY:squid_ldap_2951
support_krb5.cc(138): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: DEBUG: Get default keytab file name
support_krb5.cc(144): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: DEBUG: Got default keytab file name /etc/krb5.keytab
support_krb5.cc(158): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: DEBUG: Get principal name from keytab /etc/krb5.keytab
support_krb5.cc(169): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: DEBUG: Keytab entry has realm name: BNH.LOCAL
support_krb5.cc(189): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: DEBUG: Found principal  name: HTTP/bhlnx03.bnh.local at BNH.LOCAL
support_krb5.cc(205): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: DEBUG: Got principal name HTTP/bhlnx03.bnh.local at BNH.LOCAL
support_krb5.cc(269): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: DEBUG: Stored credentials
support_ldap.cc(927): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: DEBUG: Initialise ldap connection
support_ldap.cc(933): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: DEBUG: Canonicalise ldap server name for domain BNH.LOCAL
support_resolv.cc(379): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: DEBUG: Resolved SRV _ldap._tcp.BNH.LOCAL record to BHAD02.bnh.local
support_resolv.cc(379): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: DEBUG: Resolved SRV _ldap._tcp.BNH.LOCAL record to BHAD01.bnh.local
support_resolv.cc(379): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: DEBUG: Resolved SRV _ldap._tcp.BNH.LOCAL record to bhad02.bnh.local
support_resolv.cc(379): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: DEBUG: Resolved SRV _ldap._tcp.BNH.LOCAL record to bhad01.bnh.local
support_resolv.cc(207): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: DEBUG: Resolved address 1 of BNH.LOCAL to BHAD02.bnh.local
support_resolv.cc(207): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: DEBUG: Resolved address 2 of BNH.LOCAL to BHAD02.bnh.local
support_resolv.cc(207): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: DEBUG: Resolved address 3 of BNH.LOCAL to BHAD02.bnh.local
support_resolv.cc(207): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: DEBUG: Resolved address 4 of BNH.LOCAL to BHAD01.bnh.local
support_resolv.cc(207): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: DEBUG: Resolved address 5 of BNH.LOCAL to BHAD01.bnh.local
support_resolv.cc(207): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: DEBUG: Resolved address 6 of BNH.LOCAL to BHAD01.bnh.local
support_resolv.cc(407): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: DEBUG: Adding BNH.LOCAL to list
support_resolv.cc(443): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: DEBUG: Sorted ldap server names for domain BNH.LOCAL:
support_resolv.cc(445): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: DEBUG: Host: BHAD01.bnh.local Port: 389 Priority: 0 Weight: 100
support_resolv.cc(445): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: DEBUG: Host: BHAD02.bnh.local Port: 389 Priority: 0 Weight: 100
support_resolv.cc(445): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: DEBUG: Host: BNH.LOCAL Port: -1 Priority: -2 Weight: -2
support_ldap.cc(942): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: DEBUG: Setting up connection to ldap server BHAD01.bnh.local:389
support_ldap.cc(953): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: DEBUG: Bind to ldap server with SASL/GSSAPI
support_ldap.cc(967): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: DEBUG: Successfully initialised connection to ldap server BHAD01.bnh.local:389
support_ldap.cc(333): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: DEBUG: Search ldap server with bind path "" and filter: (objectclass=*)
support_ldap.cc(602): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: DEBUG: Search ldap entries for attribute : schemaNamingContext
support_ldap.cc(645): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: DEBUG: 1 ldap entry found with attribute : schemaNamingContext
support_ldap.cc(342): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: DEBUG: Search ldap server with bind path CN=Schema,CN=Configuration,DC=bnh,DC=local and filter: (ldapdisplayname=samaccountname)
support_ldap.cc(345): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: DEBUG: Found 0 ldap entries
support_ldap.cc(350): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: DEBUG: Determined ldap server not as an Active Directory server
support_ldap.cc(1061): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: ERROR: Error determining ldap server type: Operations error
support_member.cc(104): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: INFO: User Jeroen.Ruijter is not member of group at domain ADGroupRaamregeling@
support_member.cc(119): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: DEBUG: Default group loop: group at domain ADGroupRaamregeling@
kerberos_ldap_group.cc(416): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: DEBUG: ERR

-----Oorspronkelijk bericht-----
Van: Jeroen Ruijter 
Verzonden: maandag 19 februari 2018 11:19
Aan: 'Amos Jeffries'; squid-users at lists.squid-cache.org
Onderwerp: RE: [squid-users] kerberos authentication with kerberos groups

Do you advise to use capitals or small characters for the domain name?


-----Oorspronkelijk bericht-----
Van: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] Namens Amos Jeffries
Verzonden: vrijdag 16 februari 2018 18:58
Aan: squid-users at lists.squid-cache.org
Onderwerp: Re: [squid-users] kerberos authentication with kerberos groups

On 17/02/18 02:02, Jeroen Ruijter wrote:
> I'm trying to replace my basic ldap authentication by kerberos single 
> sign on.
> 

NP: Despite what some claim, SSO is not unique to NTLM and Kerberos authentication. It is a behaviour of the tools used. As such it can be done with *any* authentication type if the tools used perform the necessary behaviour.



> The user can succesfully login with single sign on, but I have 
> restriction on groups and that is where it goes wrong.

What exactly does this "going wrong" look like?

Also, what version of Squid are you working with?
 (the "squid -v" output please)

> 
> I would like to use -r to trim the domain name, but when I do so it 
> seems to work even less.
> 
> Someone any ideas what to try, I believe the system is loking wrong in 
> active directory but adding -b?OU=Users,DC=yyy,DC=local does not help 
> me further

You have some things looking for ".local" and others for ".LOCAL". I'm not sure if case insensitivity exists in all those places they are being used, so that is one potential cause of problems.


> =======
> 
> ?
> 
> auth_param negotiate program /usr/sbin/negotiate_wrapper_auth -d 
> --ntlm /usr/bin/ntlm_auth --diagnostics 
> --helper-protocol=squid-2.5-ntlmssp
> --domain=yyy --kerberos /usr/sbin/negotiate_kerberos_auth -d -s 
> GSS_C_NO_NAME
> 
> auth_param negotiate children 20 startup=0 idle=1
> 
> auth_param negotiate keep_alive off
> 
> ?
> 
> external_acl_type XXX_InternetAllowed ttl=3600 negative_ttl=3600 
> %LOGIN /usr/sbin/ext_kerberos_ldap_group_acl -b 
> OU=Users,OU=BenH,DC=yyy,DC=local -g AD_XXX_InternetAllowed at yyy.LOCAL 
> -d
> 
> external_acl_type RestrictedAdult ttl=3600 negative_ttl=3600 %LOGIN 
> /usr/sbin/ext_kerberos_ldap_group_acl -b 
> OU=Users,OU=BenH,DC=yyy,DC=local -g ADGroupRestrictedAdult at yyy.LOCAL 
> -d
> 
> ?
> 
> acl XXX_InternetAllowed external XXX_InternetAllowed
> 
> acl XXX_Adult external XXX_Adult
> 

...
> 
> http_access deny auth !XXX_InternetAllowed

The above says the users entire login is to be rejected if they are not a member of the XXX_InternetAllowed group.

That should work but it is better to reject failed logins fully first, then do the group checks separately.

Like this:

 http_access deny !auth
 http_access deny !XXX_InternetAllowed all

> 
> http_access deny XXX_Adult XXX_AdultX
> 

you could gain a fair bit of performance back by making that check the dstdomain before the slow external lookup:

  http_access deny XXX_AdultX XXX_Adult all


> http_access allow localnet
> 
> http_access allow localhost
> 
> http_access deny all
> 
> ?
> 
> ========
> 


...
> 
> support_ldap.cc(342): pid=7612 :2018/02/16 11:50:07|
> kerberos_ldap_group: DEBUG: Search ldap server with bind path 
> CN=Schema,CN=Configuration,DC=bnh,DC=local and filter:
> (ldapdisplayname=samaccountname)
> 
> support_ldap.cc(345): pid=7612 :2018/02/16 11:50:07|
> kerberos_ldap_group: DEBUG: Found 0 ldap entries
> 
> support_ldap.cc(350): pid=7612 :2018/02/16 11:50:07|
> kerberos_ldap_group: DEBUG: Determined ldap server not as an Active 
> Directory server
> 
> support_ldap.cc(1061): pid=7612 :2018/02/16 11:50:07|
> kerberos_ldap_group: ERROR: Error determining ldap server type:
> Operations error
> 
> support_member.cc(76): pid=7612 :2018/02/16 11:50:07|
> kerberos_ldap_group: INFO: User Administrator is not member of 
> group at domain AD_XXX_InternetAllowed at YYY.LOCAL
> 

Looks like it is working to me.

The helper tries several methods of locating a server, two fail but the third seems to work and produces the above result.


Amos

_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users

From yvoinov at gmail.com  Tue Feb 20 17:01:27 2018
From: yvoinov at gmail.com (Yuri)
Date: Tue, 20 Feb 2018 23:01:27 +0600
Subject: [squid-users] ldap_sasl_interactive_bind_s error: Can't contact
 LDAP server
In-Reply-To: <1519143301292-0.post@n4.nabble.com>
References: <1519133725693-0.post@n4.nabble.com>
 <960f0ade-b804-127e-cbbc-076db15363e3@gmail.com>
 <1519135208604-0.post@n4.nabble.com>
 <68702486-ed7d-c181-d0db-71eef5baf51a@gmail.com>
 <1519143301292-0.post@n4.nabble.com>
Message-ID: <41e44d5d-2132-8cdf-0d76-627dd9a20dca@gmail.com>



20.02.2018 22:15, erdosain9 ?????:
> sorry, yuri, yes is working. 
> i can connect via ldap and also turn on debug for investigate, and is no
> error know...
> but time to time, this error is happening... so... is strange.
No. Check your network first in this case (generally speaking better to
start troubleshooting from this).
L1/L2/L3 layer, I mean.
>
> In the other hand im getting this values with just one machine using the
> squid :
>
> Negotiate Authenticator Statistics:
> program: /lib64/squid/negotiate_kerberos_auth
> number active: 32 of 50 (0 shutting down)
> requests sent: 66
> replies received: 66
> queue length: 0
> avg service time: 208 msec
>
>    ID #	     FD	    PID	 # Requests	  # Replies	 Flags	   Time	 Offset
> Request
>      21	     44	   2193	         24	         24	     	  0.022	      0	(none)
>      22	     61	   2194	          5	          5	     	  0.322	      0	(none)
>      23	     64	   2195	          5	          5	     	  0.387	      0	(none)
>      24	     70	   2196	          3	          3	     	  0.397	      0	(none)
>      25	    150	   2201	          2	          2	     	  0.323	      0	(none)
>      26	    151	   2202	          1	          1	     	  0.158	      0	(none)
>      27	    153	   2203	          1	          1	     	  0.192	      0	(none)
>      28	    155	   2204	          1	          1	     	  0.152	      0	(none)
>      29	    157	   2205	          1	          1	     	  0.380	      0	(none)
>      30	    159	   2206	          1	          1	     	  0.394	      0	(none)
>      31	    161	   2207	          1	          1	     	  0.465	      0	(none)
>      32	    163	   2208	          1	          1	     	  0.439	      0	(none)
>      33	    165	   2209	          1	          1	     	  0.437	      0	(none)
>      34	    167	   2210	          1	          1	     	  0.591	      0	(none)
>      35	    169	   2211	          1	          1	     	  0.226	      0	(none)
>      36	    171	   2212	          1	          1	     	  0.564	      0	(none)
>      37	    173	   2213	          1	          1	     	  0.221	      0	(none)
>      38	    175	   2214	          1	          1	     	  0.115	      0	(none)
>      39	    177	   2215	          1	          1	     	  0.161	      0	(none)
>      40	    179	   2216	          1	          1	     	  0.335	      0	(none)
>      41	    181	   2217	          1	          1	     	  0.382	      0	(none)
>      42	    154	   2218	          1	          1	     	  0.547	      0	(none)
>      43	    158	   2219	          1	          1	     	  0.605	      0	(none)
>      44	    162	   2220	          1	          1	     	  0.493	      0	(none)
>      45	    166	   2221	          1	          1	     	  0.465	      0	(none)
>      46	    170	   2222	          1	          1	     	  0.586	      0	(none)
>      47	    174	   2223	          1	          1	     	  0.270	      0	(none)
>      48	    178	   2224	          1	          1	     	  0.249	      0	(none)
>      49	    182	   2225	          1	          1	     	  0.504	      0	(none)
>      50	    184	   2226	          1	          1	     	  0.479	      0	(none)
>      51	    186	   2227	          1	          1	     	  0.284	      0	(none)
>      52	    188	   2228	          1	          1	     	  0.560	      0	(none)
>
> a little high dont you think?? avg service time: 208 msec
> In the working squid some times the values go to 2500 msec..... (with 70
> users)
Usually squid's direct-action helpers (I mean - not client-server, like
ufdbguard) directly depends from LAN/WAN. This means, if your network
gives delay - this will mirrored in helper stats as increased service
time. As I've told - check your network.
>
> Thanks
>
>
>
>
> --
> Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-- 
*****************************
* C++20 : Bug to the future *
*****************************


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180220/3130b85b/attachment.sig>

From chip_pop at hotmail.com  Tue Feb 20 23:22:38 2018
From: chip_pop at hotmail.com (joseph)
Date: Tue, 20 Feb 2018 16:22:38 -0700 (MST)
Subject: [squid-users] squid-5  lost my cached dir
Message-ID: <1519168958719-0.post@n4.nabble.com>

using squid-5.0.0-20180218-r3b65960 release kill my cache dir some how
swap.state is empty  and the size of the cached dir has 30 geg
if i run for couple HR  and the swap.state grow like couple meg  then
restart squid 
it become empty swap.state  but the cached item in storage stay 
i removed patch by patch the  killer was
http://www.squid-cache.org/Versions/v5/changesets/squid-5-4310f8b00dd574542dcec4208112bb89ef403528.patch
so please fix it



-----
************************** 
***** Crash to the future  ****
**************************
--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From rousskov at measurement-factory.com  Tue Feb 20 23:28:22 2018
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Tue, 20 Feb 2018 16:28:22 -0700
Subject: [squid-users] squid-5 lost my cached dir
In-Reply-To: <1519168958719-0.post@n4.nabble.com>
References: <1519168958719-0.post@n4.nabble.com>
Message-ID: <5bf8b92a-531c-0a25-7d9d-a766abd62630@measurement-factory.com>

On 02/20/2018 04:22 PM, joseph wrote:
> using squid-5.0.0-20180218-r3b65960 release kill my cache dir some how
> swap.state is empty  and the size of the cached dir has 30 geg
> if i run for couple HR  and the swap.state grow like couple meg  then
> restart squid 
> it become empty swap.state  but the cached item in storage stay 
> i removed patch by patch the  killer was
> http://www.squid-cache.org/Versions/v5/changesets/squid-5-4310f8b00dd574542dcec4208112bb89ef403528.patch
> so please fix it

Since our tests for that change were successful, we may need to know
more about your environment to fix this problem. Please share your Squid
configuration (at least the SMP-, cache_mem-, and cache_dir-related
directives). You may want to file a bug report to track this fix better.


Thank you,

Alex.


From chip_pop at hotmail.com  Tue Feb 20 23:38:50 2018
From: chip_pop at hotmail.com (joseph)
Date: Tue, 20 Feb 2018 16:38:50 -0700 (MST)
Subject: [squid-users] squid-5 lost my cached dir
In-Reply-To: <5bf8b92a-531c-0a25-7d9d-a766abd62630@measurement-factory.com>
References: <1519168958719-0.post@n4.nabble.com>
 <5bf8b92a-531c-0a25-7d9d-a766abd62630@measurement-factory.com>
Message-ID: <1519169930855-0.post@n4.nabble.com>

alex tested on 2 environment        debian 9 and solariss
same shame  just keep for 30 minute running caching and do squid restart and
chek your swap.state  you will notice its empty almost on 2 environment
totally different ok
i removed that patch and all fine swap.state stay perfect and all fine
so i guess one of the 2 scenario  its detecting swap file on start never
exist or detecting wrong size that all



-----
************************** 
***** Crash to the future  ****
**************************
--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From chip_pop at hotmail.com  Tue Feb 20 23:41:54 2018
From: chip_pop at hotmail.com (joseph)
Date: Tue, 20 Feb 2018 16:41:54 -0700 (MST)
Subject: [squid-users] squid-5 lost my cached dir
In-Reply-To: <5bf8b92a-531c-0a25-7d9d-a766abd62630@measurement-factory.com>
References: <1519168958719-0.post@n4.nabble.com>
 <5bf8b92a-531c-0a25-7d9d-a766abd62630@measurement-factory.com>
Message-ID: <1519170114230-0.post@n4.nabble.com>

>>Since our tests for that change were successful
did you restart wile your test was success i guess not 



-----
************************** 
***** Crash to the future  ****
**************************
--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From yvoinov at gmail.com  Tue Feb 20 23:43:05 2018
From: yvoinov at gmail.com (Yuri)
Date: Wed, 21 Feb 2018 05:43:05 +0600
Subject: [squid-users] squid-5 lost my cached dir
In-Reply-To: <5bf8b92a-531c-0a25-7d9d-a766abd62630@measurement-factory.com>
References: <1519168958719-0.post@n4.nabble.com>
 <5bf8b92a-531c-0a25-7d9d-a766abd62630@measurement-factory.com>
Message-ID: <49218a95-a741-03f6-4bd1-4922c03db869@gmail.com>

We're never use SMP. Just regular SMP-unaware configuration.


21.02.2018 05:28, Alex Rousskov ?????:
> On 02/20/2018 04:22 PM, joseph wrote:
>> using squid-5.0.0-20180218-r3b65960 release kill my cache dir some how
>> swap.state is empty  and the size of the cached dir has 30 geg
>> if i run for couple HR  and the swap.state grow like couple meg  then
>> restart squid 
>> it become empty swap.state  but the cached item in storage stay 
>> i removed patch by patch the  killer was
>> http://www.squid-cache.org/Versions/v5/changesets/squid-5-4310f8b00dd574542dcec4208112bb89ef403528.patch
>> so please fix it
> Since our tests for that change were successful, we may need to know
> more about your environment to fix this problem. Please share your Squid
> configuration (at least the SMP-, cache_mem-, and cache_dir-related
> directives). You may want to file a bug report to track this fix better.
>
>
> Thank you,
>
> Alex.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-- 
*****************************
* C++20 : Bug to the future *
*****************************


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180221/604caf2f/attachment.sig>

From rousskov at measurement-factory.com  Tue Feb 20 23:48:41 2018
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Tue, 20 Feb 2018 16:48:41 -0700
Subject: [squid-users] squid-5 lost my cached dir
In-Reply-To: <1519169930855-0.post@n4.nabble.com>
References: <1519168958719-0.post@n4.nabble.com>
 <5bf8b92a-531c-0a25-7d9d-a766abd62630@measurement-factory.com>
 <1519169930855-0.post@n4.nabble.com>
Message-ID: <66389259-a3a0-7120-b234-ba56c0032742@measurement-factory.com>

On 02/20/2018 04:38 PM, joseph wrote:
> alex tested on 2 environment        debian 9 and solariss
> same shame  just keep for 30 minute running caching and do squid restart and
> chek your swap.state  you will notice its empty almost on 2 environment
> totally different ok
> i removed that patch and all fine swap.state stay perfect and all fine
> so i guess one of the 2 scenario  its detecting swap file on start never
> exist or detecting wrong size that all

Thank you for providing these additional snippets of information. We
will, of course, try to reproduce the problem with the info you have
already provided. If you would like to increase our chances of
reproducing this problem, please see my original response (quoted below).

Alex.


> On 02/20/2018 04:28 PM, Alex Rousskov wrote:

>> ... Please share your Squid
>> configuration (at least the SMP-, cache_mem-, and cache_dir-related
>> directives). You may want to file a bug report to track this fix better.


From yvoinov at gmail.com  Tue Feb 20 23:50:10 2018
From: yvoinov at gmail.com (Yuri)
Date: Wed, 21 Feb 2018 05:50:10 +0600
Subject: [squid-users] squid-5 lost my cached dir
In-Reply-To: <66389259-a3a0-7120-b234-ba56c0032742@measurement-factory.com>
References: <1519168958719-0.post@n4.nabble.com>
 <5bf8b92a-531c-0a25-7d9d-a766abd62630@measurement-factory.com>
 <1519169930855-0.post@n4.nabble.com>
 <66389259-a3a0-7120-b234-ba56c0032742@measurement-factory.com>
Message-ID: <c682f173-731f-571d-0ab5-d1b65d73900c@gmail.com>

# -------------------------------------
# Store parameters
# -------------------------------------
minimum_object_size 10 bytes
maximum_object_size 4 GB

cache_dir aufs /data/cache/d1 48000 64 512
cache_dir aufs /data/cache/d2 48000 64 512
cache_dir aufs /data/cache/d3 48000 64 512
cache_dir aufs /data/cache/d4 48000 64 512

# -------------------------------------
# Memory parameters
# -------------------------------------
cache_mem 512 MB

memory_pools off
#memory_pools_limit 1024 MB

maximum_object_size_in_memory 1 MB


21.02.2018 05:48, Alex Rousskov ?????:
> On 02/20/2018 04:38 PM, joseph wrote:
>> alex tested on 2 environment        debian 9 and solariss
>> same shame  just keep for 30 minute running caching and do squid restart and
>> chek your swap.state  you will notice its empty almost on 2 environment
>> totally different ok
>> i removed that patch and all fine swap.state stay perfect and all fine
>> so i guess one of the 2 scenario  its detecting swap file on start never
>> exist or detecting wrong size that all
> Thank you for providing these additional snippets of information. We
> will, of course, try to reproduce the problem with the info you have
> already provided. If you would like to increase our chances of
> reproducing this problem, please see my original response (quoted below).
>
> Alex.
>
>
>> On 02/20/2018 04:28 PM, Alex Rousskov wrote:
>>> ... Please share your Squid
>>> configuration (at least the SMP-, cache_mem-, and cache_dir-related
>>> directives). You may want to file a bug report to track this fix better.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-- 
*****************************
* C++20 : Bug to the future *
*****************************


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180221/7e803afe/attachment.sig>

From chip_pop at hotmail.com  Tue Feb 20 23:52:31 2018
From: chip_pop at hotmail.com (joseph)
Date: Tue, 20 Feb 2018 16:52:31 -0700 (MST)
Subject: [squid-users] squid-5 lost my cached dir
In-Reply-To: <66389259-a3a0-7120-b234-ba56c0032742@measurement-factory.com>
References: <1519168958719-0.post@n4.nabble.com>
 <5bf8b92a-531c-0a25-7d9d-a766abd62630@measurement-factory.com>
 <1519169930855-0.post@n4.nabble.com>
 <66389259-a3a0-7120-b234-ba56c0032742@measurement-factory.com>
Message-ID: <1519170751460-0.post@n4.nabble.com>

NO SMP just normal configuration
cache_mem 500 MB
memory_pools off


cache_dir aufs /mnt/cache-a 500000 128 512
cache_dir aufs /mnt/cache-b 500000 128 512




-----
************************** 
***** Crash to the future  ****
**************************
--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From yvoinov at gmail.com  Tue Feb 20 23:57:18 2018
From: yvoinov at gmail.com (Yuri)
Date: Wed, 21 Feb 2018 05:57:18 +0600
Subject: [squid-users] squid-5 lost my cached dir
In-Reply-To: <c682f173-731f-571d-0ab5-d1b65d73900c@gmail.com>
References: <1519168958719-0.post@n4.nabble.com>
 <5bf8b92a-531c-0a25-7d9d-a766abd62630@measurement-factory.com>
 <1519169930855-0.post@n4.nabble.com>
 <66389259-a3a0-7120-b234-ba56c0032742@measurement-factory.com>
 <c682f173-731f-571d-0ab5-d1b65d73900c@gmail.com>
Message-ID: <ea5d70c0-3e28-139d-5ff2-1acb5709d632@gmail.com>

It's immediately lost swap.state contents after any restart and starts
up with empty swap.state.

After removal of swap.state with stopped squid, it's correctly
re-indexing cache contents and then run normally.


21.02.2018 05:50, Yuri ?????:
> # -------------------------------------
> # Store parameters
> # -------------------------------------
> minimum_object_size 10 bytes
> maximum_object_size 4 GB
>
> cache_dir aufs /data/cache/d1 48000 64 512
> cache_dir aufs /data/cache/d2 48000 64 512
> cache_dir aufs /data/cache/d3 48000 64 512
> cache_dir aufs /data/cache/d4 48000 64 512
>
> # -------------------------------------
> # Memory parameters
> # -------------------------------------
> cache_mem 512 MB
>
> memory_pools off
> #memory_pools_limit 1024 MB
>
> maximum_object_size_in_memory 1 MB
>
>
> 21.02.2018 05:48, Alex Rousskov ?????:
>> On 02/20/2018 04:38 PM, joseph wrote:
>>> alex tested on 2 environment        debian 9 and solariss
>>> same shame  just keep for 30 minute running caching and do squid restart and
>>> chek your swap.state  you will notice its empty almost on 2 environment
>>> totally different ok
>>> i removed that patch and all fine swap.state stay perfect and all fine
>>> so i guess one of the 2 scenario  its detecting swap file on start never
>>> exist or detecting wrong size that all
>> Thank you for providing these additional snippets of information. We
>> will, of course, try to reproduce the problem with the info you have
>> already provided. If you would like to increase our chances of
>> reproducing this problem, please see my original response (quoted below).
>>
>> Alex.
>>
>>
>>> On 02/20/2018 04:28 PM, Alex Rousskov wrote:
>>>> ... Please share your Squid
>>>> configuration (at least the SMP-, cache_mem-, and cache_dir-related
>>>> directives). You may want to file a bug report to track this fix better.
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users

-- 
*****************************
* C++20 : Bug to the future *
*****************************


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180221/dd9155e7/attachment.sig>

From yvoinov at gmail.com  Wed Feb 21 00:01:09 2018
From: yvoinov at gmail.com (Yuri)
Date: Wed, 21 Feb 2018 06:01:09 +0600
Subject: [squid-users] squid-5 lost my cached dir
In-Reply-To: <ea5d70c0-3e28-139d-5ff2-1acb5709d632@gmail.com>
References: <1519168958719-0.post@n4.nabble.com>
 <5bf8b92a-531c-0a25-7d9d-a766abd62630@measurement-factory.com>
 <1519169930855-0.post@n4.nabble.com>
 <66389259-a3a0-7120-b234-ba56c0032742@measurement-factory.com>
 <c682f173-731f-571d-0ab5-d1b65d73900c@gmail.com>
 <ea5d70c0-3e28-139d-5ff2-1acb5709d632@gmail.com>
Message-ID: <a7eb7fbc-6777-537e-5686-c8c75c52ef5d@gmail.com>

Yes, after re-indexing, every next restart cleans up swap.state again
and again.


21.02.2018 05:57, Yuri ?????:
> It's immediately lost swap.state contents after any restart and starts
> up with empty swap.state.
>
> After removal of swap.state with stopped squid, it's correctly
> re-indexing cache contents and then run normally.
>
>
> 21.02.2018 05:50, Yuri ?????:
>> # -------------------------------------
>> # Store parameters
>> # -------------------------------------
>> minimum_object_size 10 bytes
>> maximum_object_size 4 GB
>>
>> cache_dir aufs /data/cache/d1 48000 64 512
>> cache_dir aufs /data/cache/d2 48000 64 512
>> cache_dir aufs /data/cache/d3 48000 64 512
>> cache_dir aufs /data/cache/d4 48000 64 512
>>
>> # -------------------------------------
>> # Memory parameters
>> # -------------------------------------
>> cache_mem 512 MB
>>
>> memory_pools off
>> #memory_pools_limit 1024 MB
>>
>> maximum_object_size_in_memory 1 MB
>>
>>
>> 21.02.2018 05:48, Alex Rousskov ?????:
>>> On 02/20/2018 04:38 PM, joseph wrote:
>>>> alex tested on 2 environment        debian 9 and solariss
>>>> same shame  just keep for 30 minute running caching and do squid restart and
>>>> chek your swap.state  you will notice its empty almost on 2 environment
>>>> totally different ok
>>>> i removed that patch and all fine swap.state stay perfect and all fine
>>>> so i guess one of the 2 scenario  its detecting swap file on start never
>>>> exist or detecting wrong size that all
>>> Thank you for providing these additional snippets of information. We
>>> will, of course, try to reproduce the problem with the info you have
>>> already provided. If you would like to increase our chances of
>>> reproducing this problem, please see my original response (quoted below).
>>>
>>> Alex.
>>>
>>>
>>>> On 02/20/2018 04:28 PM, Alex Rousskov wrote:
>>>>> ... Please share your Squid
>>>>> configuration (at least the SMP-, cache_mem-, and cache_dir-related
>>>>> directives). You may want to file a bug report to track this fix better.
>>> _______________________________________________
>>> squid-users mailing list
>>> squid-users at lists.squid-cache.org
>>> http://lists.squid-cache.org/listinfo/squid-users

-- 
*****************************
* C++20 : Bug to the future *
*****************************


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180221/faf6f132/attachment.sig>

From rousskov at measurement-factory.com  Wed Feb 21 00:04:17 2018
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Tue, 20 Feb 2018 17:04:17 -0700
Subject: [squid-users] squid-5 lost my cached dir
In-Reply-To: <ea5d70c0-3e28-139d-5ff2-1acb5709d632@gmail.com>
References: <1519168958719-0.post@n4.nabble.com>
 <5bf8b92a-531c-0a25-7d9d-a766abd62630@measurement-factory.com>
 <1519169930855-0.post@n4.nabble.com>
 <66389259-a3a0-7120-b234-ba56c0032742@measurement-factory.com>
 <c682f173-731f-571d-0ab5-d1b65d73900c@gmail.com>
 <ea5d70c0-3e28-139d-5ff2-1acb5709d632@gmail.com>
Message-ID: <20656790-3654-3506-7549-bca8e3541b2a@measurement-factory.com>

Thank you and joseph for providing these important details. If we can
reproduce the problem, then we will post a pull request with a fix once
it is is available. If we cannot, we will post more questions here
(unless there is a report in Squid Bugzilla by then). --Alex.

On 02/20/2018 04:57 PM, Yuri wrote:
> It's immediately lost swap.state contents after any restart and starts
> up with empty swap.state.
> 
> After removal of swap.state with stopped squid, it's correctly
> re-indexing cache contents and then run normally.
> 
> 
> 21.02.2018 05:50, Yuri ?????:
>> # -------------------------------------
>> # Store parameters
>> # -------------------------------------
>> minimum_object_size 10 bytes
>> maximum_object_size 4 GB
>>
>> cache_dir aufs /data/cache/d1 48000 64 512
>> cache_dir aufs /data/cache/d2 48000 64 512
>> cache_dir aufs /data/cache/d3 48000 64 512
>> cache_dir aufs /data/cache/d4 48000 64 512
>>
>> # -------------------------------------
>> # Memory parameters
>> # -------------------------------------
>> cache_mem 512 MB
>>
>> memory_pools off
>> #memory_pools_limit 1024 MB
>>
>> maximum_object_size_in_memory 1 MB
>>
>>
>> 21.02.2018 05:48, Alex Rousskov ?????:
>>> On 02/20/2018 04:38 PM, joseph wrote:
>>>> alex tested on 2 environment        debian 9 and solariss
>>>> same shame  just keep for 30 minute running caching and do squid restart and
>>>> chek your swap.state  you will notice its empty almost on 2 environment
>>>> totally different ok
>>>> i removed that patch and all fine swap.state stay perfect and all fine
>>>> so i guess one of the 2 scenario  its detecting swap file on start never
>>>> exist or detecting wrong size that all
>>> Thank you for providing these additional snippets of information. We
>>> will, of course, try to reproduce the problem with the info you have
>>> already provided. If you would like to increase our chances of
>>> reproducing this problem, please see my original response (quoted below).
>>>
>>> Alex.
>>>
>>>
>>>> On 02/20/2018 04:28 PM, Alex Rousskov wrote:
>>>>> ... Please share your Squid
>>>>> configuration (at least the SMP-, cache_mem-, and cache_dir-related
>>>>> directives). You may want to file a bug report to track this fix better.
>>> _______________________________________________
>>> squid-users mailing list
>>> squid-users at lists.squid-cache.org
>>> http://lists.squid-cache.org/listinfo/squid-users
> 
> 
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 



From nninad at gmail.com  Wed Feb 21 05:38:17 2018
From: nninad at gmail.com (ninadmnaik)
Date: Tue, 20 Feb 2018 22:38:17 -0700 (MST)
Subject: [squid-users] Forward proxy: TLS connections to server
In-Reply-To: <6e2530c3-a4f2-594e-9038-67e50698759e@gmail.com>
References: <1518882295560-0.post@n4.nabble.com>
 <ccc35d8f-36db-4395-c265-5b9493249beb@gmail.com>
 <1518886733201-0.post@n4.nabble.com>
 <6e2530c3-a4f2-594e-9038-67e50698759e@gmail.com>
Message-ID: <1519191497554-0.post@n4.nabble.com>

Does the "https_port intercept ssl-bump" work only in transparent proxy
scenarios, where the DNAT changes have been applied?
https://wiki.squid-cache.org/ConfigExamples/Intercept/LinuxDnat

Or is it possible to explicitly point to squid proxy in the client and still
use the "https_port intercept ssl_bump"?

Here's the setup we've so far:

Squid 3.5.27

Conf file:
acl localnet src 127.0.0.1/32
acl localnet src 10.0.0.0/8     # RFC1918 possible internal network
acl localnet src 172.16.0.0/12  # RFC1918 possible internal network
acl localnet src 192.168.0.0/16 # RFC1918 possible internal network
acl localnet src fc00::/7       # RFC 4193 local private network range
acl localnet src fe80::/10      # RFC 4291 link-local (directly plugged)
machines

acl SSL_ports port 5235         # xmpp over ssl
acl SSL_ports port 3130
acl SSL_ports port 443
acl Safe_ports port 80          # http
acl CONNECT method CONNECT

acl ssl-bump_port myportname 3130
always_direct allow ssl-bump_port        # always direct to origin server.
Do not get from cache.

http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports

http_access allow all

http_port 3128
https_port 3130 intercept ssl-bump generate-host-certificates=on
dynamic_cert_mem_cache_size=4MB cert=/pem.certificate/cert.pem
key=/pem.certificate/key.pem cafile=/etc/ssl/cert.pem
acl step1 at_step SslBump1
acl step2 at_step SslBump2
acl step3 at_step SslBump3
ssl_bump peek step1
ssl_bump bump step2

sslproxy_cert_error allow all
sslproxy_flags DONT_VERIFY_PEER
sslcrtd_program /usr/local/squid/libexec/ssl_crtd  -s
/usr/local/squid/ssl_db -M 4MB


And here's what the client is trying to do:

1. sslSocket.connect("localhost", 3130);

2. sslSocket.getOutputStream.write("CONNECT fcm-xmpp.googleapis.com:5235
HTTP/1.1 Host: CONNECT fcm-xmpp.googleapis.com:5235");

However, squid receives number 1 as a CONNECT. Same when I do: 'telnet
localhost 3130'. 
Should the first connect be received with method 'CONNECT'. 

Logs:
2018/02/20 23:14:28.050 kid1| 5,2| TcpAcceptor.cc(220) doAccept: New
connection on FD 29
2018/02/20 23:14:28.050 kid1| 5,2| TcpAcceptor.cc(295) acceptNext:
connection on local=[::]:3130 remote=[::] FD 29 flags=41
2018/02/20 23:14:28.050 kid1| 33,2| client_side.cc(3943)
httpsSslBumpAccessCheckDone: sslBump needed for local=127.0.0.1:3130
remote=127.0.0.1:50607 FD 16 flags=33 method 3
2018/02/20 23:14:28.050 kid1| 11,2| client_side.cc(2372) parseHttpRequest:
HTTP Client local=127.0.0.1:3130 remote=127.0.0.1:50607 FD 16 flags=33
2018/02/20 23:14:28.050 kid1| 11,2| client_side.cc(2373) parseHttpRequest:
HTTP Client REQUEST:
---------
CONNECT 127.0.0.1:3130 HTTP/1.1
Host: 127.0.0.1:3130


----------
2018/02/20 23:14:28.051 kid1| 85,2| client_side_request.cc(745)
clientAccessCheckDone: The request CONNECT 127.0.0.1:3130 is ALLOWED; last
ACL checked: all
2018/02/20 23:14:28.051 kid1| 85,2| client_side_request.cc(721)
clientAccessCheck2: No adapted_http_access configuration. default: ALLOW
2018/02/20 23:14:28.051 kid1| 85,2| client_side_request.cc(745)
clientAccessCheckDone: The request CONNECT 127.0.0.1:3130 is ALLOWED; last
ACL checked: all
2018/02/20 23:14:28.095 kid1| 83,2| client_side.cc(4316)
clientPeekAndSpliceSSL: SSL_accept failed.
2018/02/20 23:14:28.096 kid1| 83,2| client_side.cc(4316)
clientPeekAndSpliceSSL: SSL_accept failed.
2018/02/20 23:14:28.096 kid1| 83,2| client_side.cc(4316)
clientPeekAndSpliceSSL: SSL_accept failed.
2018/02/20 23:14:28.096 kid1| 83,2| client_side.cc(4316)
clientPeekAndSpliceSSL: SSL_accept failed.
2018/02/20 23:14:28.096 kid1| 83,2| client_side.cc(4316)
clientPeekAndSpliceSSL: SSL_accept failed.
2018/02/20 23:14:28.096 kid1| 83,2| client_side.cc(4316)
clientPeekAndSpliceSSL: SSL_accept failed.
2018/02/20 23:14:28.096 kid1| 83,2| client_side.cc(4316)
clientPeekAndSpliceSSL: SSL_accept failed.
2018/02/20 23:14:28.096 kid1| 83,2| client_side.cc(4316)
clientPeekAndSpliceSSL: SSL_accept failed.
2018/02/20 23:14:28.096 kid1| 83,2| client_side.cc(4316)
clientPeekAndSpliceSSL: SSL_accept failed.
2018/02/20 23:14:28.096 kid1| 83,2| client_side.cc(4316)
clientPeekAndSpliceSSL: SSL_accept failed.
2018/02/20 23:14:28.096 kid1| 83,2| client_side.cc(4316)
clientPeekAndSpliceSSL: SSL_accept failed.
2018/02/20 23:14:28.096 kid1| 83,2| client_side.cc(4316)
clientPeekAndSpliceSSL: SSL_accept failed.
2018/02/20 23:14:28.096 kid1| 83,2| client_side.cc(4316)
clientPeekAndSpliceSSL: SSL_accept failed.
2018/02/20 23:14:28.096 kid1| 83,2| client_side.cc(4316)
clientPeekAndSpliceSSL: SSL_accept failed.
2018/02/20 23:14:28.096 kid1| 83,2| client_side.cc(4316)
clientPeekAndSpliceSSL: SSL_accept failed.
2018/02/20 23:14:28.096 kid1| 83,2| client_side.cc(4316)
clientPeekAndSpliceSSL: SSL_accept failed.
2018/02/20 23:14:28.097 kid1| 83,2| client_side.cc(4316)
clientPeekAndSpliceSSL: SSL_accept failed.
2018/02/20 23:14:28.097 kid1| 83,2| client_side.cc(4316)
clientPeekAndSpliceSSL: SSL_accept failed.
2018/02/20 23:14:28.097 kid1| 83,2| client_side.cc(4316)
clientPeekAndSpliceSSL: SSL_accept failed.
2018/02/20 23:14:28.097 kid1| 83,2| client_side.cc(4316)
clientPeekAndSpliceSSL: SSL_accept failed.
2018/02/20 23:14:28.097 kid1| 83,2| client_side.cc(4316)
clientPeekAndSpliceSSL: SSL_accept failed.
2018/02/20 23:14:28.097 kid1| 83,2| client_side.cc(4316)
clientPeekAndSpliceSSL: SSL_accept failed.
2018/02/20 23:14:28.097 kid1| 17,2| FwdState.cc(133) FwdState: Forwarding
client request local=127.0.0.1:3130 remote=127.0.0.1:50607 FD 16 flags=33,
url=127.0.0.1:3130
2018/02/20 23:14:28.097 kid1| 44,2| peer_select.cc(280) peerSelectDnsPaths:
Found sources for '127.0.0.1:3130'
2018/02/20 23:14:28.098 kid1| 44,2| peer_select.cc(281) peerSelectDnsPaths:  
always_direct = ALLOWED
2018/02/20 23:14:28.098 kid1| 44,2| peer_select.cc(282) peerSelectDnsPaths:   
never_direct = DENIED
2018/02/20 23:14:28.098 kid1| 44,2| peer_select.cc(288) peerSelectDnsPaths:   
ORIGINAL_DST = local=0.0.0.0 remote=127.0.0.1:3130 flags=1
2018/02/20 23:14:28.098 kid1| 44,2| peer_select.cc(295) peerSelectDnsPaths:       
timedout = 0





--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From squid3 at treenet.co.nz  Wed Feb 21 10:30:11 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 21 Feb 2018 23:30:11 +1300
Subject: [squid-users] Forward proxy: TLS connections to server
In-Reply-To: <1519191497554-0.post@n4.nabble.com>
References: <1518882295560-0.post@n4.nabble.com>
 <ccc35d8f-36db-4395-c265-5b9493249beb@gmail.com>
 <1518886733201-0.post@n4.nabble.com>
 <6e2530c3-a4f2-594e-9038-67e50698759e@gmail.com>
 <1519191497554-0.post@n4.nabble.com>
Message-ID: <af186343-9d97-c2f5-9507-52d766a4e29d@treenet.co.nz>

On 21/02/18 18:38, ninadmnaik wrote:
> Does the "https_port intercept ssl-bump" work only in transparent proxy
> scenarios, where the DNAT changes have been applied?
> https://wiki.squid-cache.org/ConfigExamples/Intercept/LinuxDnat

The "intercept" mode flag alone is what means DNAT is taking place and
has to be deciphered by Squid;

 - the NAT may have other names but is still "Destination NAT".

 - the particular *_port line and ssl-bump are unrelated to the NAT.


> 
> Or is it possible to explicitly point to squid proxy in the client and still
> use the "https_port intercept ssl_bump"?

No. Explicit proxy is a completely traffic syntax (aka "mode").

Specifically the "explicit proxy" mode signaled by absence of a mode flag.

SSL-Bump makes no sense on an explicit-proxy https_port. Since ssl-bump
is an MITM hijack on the client traffic and by definition the TLS
(explicit) directed by the client itself to an explicit-proxy https_port
is intended explicitly for that proxy instead of any other server / origin.


> 
> Here's the setup we've so far:
> 
> Squid 3.5.27
> 
> Conf file:
> acl localnet src 127.0.0.1/32
> acl localnet src 10.0.0.0/8     # RFC1918 possible internal network
> acl localnet src 172.16.0.0/12  # RFC1918 possible internal network
> acl localnet src 192.168.0.0/16 # RFC1918 possible internal network
> acl localnet src fc00::/7       # RFC 4193 local private network range
> acl localnet src fe80::/10      # RFC 4291 link-local (directly plugged)
> machines
> 
> acl SSL_ports port 5235         # xmpp over ssl
> acl SSL_ports port 3130
> acl SSL_ports port 443
> acl Safe_ports port 80          # http
> acl CONNECT method CONNECT
> 
> acl ssl-bump_port myportname 3130
> always_direct allow ssl-bump_port        # always direct to origin server.
> Do not get from cache.
> 
> http_access deny !Safe_ports
> http_access deny CONNECT !SSL_ports
> 
> http_access allow all
> 
> http_port 3128

Proxy listening on port 3128 for explicit-proxy traffic.

> https_port 3130 intercept ssl-bump generate-host-certificates=on

Proxy listening on port 3130 for NAT intercepted port 443 (HTTPS) traffic.


> dynamic_cert_mem_cache_size=4MB cert=/pem.certificate/cert.pem
> key=/pem.certificate/key.pem cafile=/etc/ssl/cert.pem
> acl step1 at_step SslBump1
> acl step2 at_step SslBump2
> acl step3 at_step SslBump3
> ssl_bump peek step1
> ssl_bump bump step2
> 
> sslproxy_cert_error allow all
> sslproxy_flags DONT_VERIFY_PEER

Proxy admin disabling all security measures offered by TLS. Free pass to
anyone abusing the network through port 443, no logging performed when
attacks happen.


Please remove the above lines and fix the problems that show up via
means other than silencing the log records.


> sslcrtd_program /usr/local/squid/libexec/ssl_crtd  -s
> /usr/local/squid/ssl_db -M 4MB
> 
> 
> And here's what the client is trying to do:
> 
> 1. sslSocket.connect("localhost", 3130);

Immediate Fail. Only the NAT system may send traffic to that port.
You should have firewall rules enforcing that restriction.

Also, the traffic must have been going directly to an origin server
before the NAT system altered it. ie traffic uses bare TLS containing
HTTP origin-form syntax.


> 
> 2. sslSocket.getOutputStream.write("CONNECT fcm-xmpp.googleapis.com:5235
> HTTP/1.1 Host: CONNECT fcm-xmpp.googleapis.com:5235");


If it is doing things right that client is doing:

 0) opening a TCP connection to the proxy, and

 1) inside that TCP connection (0) negotiating TLS to the proxy, and

 2) over that (1) it is sending an HTTP message. The explicit-proxy
request to setup an blind tunnel to some server on port 5235 . And,

 3) over that (2) it is going to send TLS to an origin server, and

 4) over that (3) it is going to send HTTP messages (aka HTTPS).


So to receive the traffic Squid requires:

A) an "https_port ..." to receive the TCP at (0) and explicit TLS at
(1), and

B) the "ssl-bump" option to decrypt the traffic at (4).


That is all. The TCP at (0) is the same, and HTTP at (2) is already in
explicit-proxy syntax, so no "intercept" necessary. SSL-Bump sets up
Squid to handle the (4) messages properly whatever the outcome of the
bumping attempt.

There is a special case when the traffic is NAT intercepted on it sway
to a different explicit=-proxy. In that case the dst-IP is not the
origin servers and the other things "intercept" causes to happen are
wrong - so do not use "intercept", just ignore the NAT.


NOTE: HTTP traffic sent by a client intentionally to a proxy (eg the
CONNECT) is often described as "plain-text HTTP". But as you can see
that is an oversimplification - the existence of (1) above shows how
inaccurate that word "plain-text" can be.
 This is why the terms "explicit-proxy" or "forward-proxy" are used. The
traffic may take the form of plain-text on TCP, or encrypted on TLS, and
literally any other reliable transport protocol. Subject only to what
the proxy software is written to receive.



> 
> However, squid receives number 1 as a CONNECT. Same when I do: 'telnet
> localhost 3130'. 

Which is different layering to the above. Telnet only does the (0) and
(2) TCP and HTTP layering. No (1) encryption step at all.

 - The "http_port" (no 's') directive is for traffic layering where
(1)'s TLS does not exist.



Amos


From chip_pop at hotmail.com  Wed Feb 21 13:20:26 2018
From: chip_pop at hotmail.com (joseph)
Date: Wed, 21 Feb 2018 06:20:26 -0700 (MST)
Subject: [squid-users] squid-5 lost my cached dir
In-Reply-To: <20656790-3654-3506-7549-bca8e3541b2a@measurement-factory.com>
References: <1519168958719-0.post@n4.nabble.com>
 <5bf8b92a-531c-0a25-7d9d-a766abd62630@measurement-factory.com>
 <1519169930855-0.post@n4.nabble.com>
 <66389259-a3a0-7120-b234-ba56c0032742@measurement-factory.com>
 <c682f173-731f-571d-0ab5-d1b65d73900c@gmail.com>
 <ea5d70c0-3e28-139d-5ff2-1acb5709d632@gmail.com>
 <20656790-3654-3506-7549-bca8e3541b2a@measurement-factory.com>
Message-ID: <1519219226329-0.post@n4.nabble.com>

found where the bug   and i made it work but i dont know wat is the best

in UFSSwapDir.cc function Fs::Ufs::UFSSwapDir::openTmpSwapLog(int
*clean_flag, int *zero_flag)

was -->    *zero_flag = log_sb.st_size == 0 ? 1 : 0;
change to  *zero_flag = log_sb.st_size == 0 ? 0 : 1;
best to change int to bool  in futur

the change make it work in RebuildState.cc function
Fs::Ufs::RebuildState::RebuildState(RefCount<UFSSwapDir> aSwapDir) :

now this work correctly
    if (fp && !zeroLengthLog)
        LogParser = Fs::Ufs::UFSSwapLogParser::GetUFSSwapLogParser(fp);



-----
************************** 
***** Crash to the future  ****
**************************
--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From yavuz.maslak at netiletisim.net  Wed Feb 21 14:04:09 2018
From: yavuz.maslak at netiletisim.net (=?iso-8859-2?Q?Yavuz_Ma=BAlak?=)
Date: Wed, 21 Feb 2018 17:04:09 +0300
Subject: [squid-users] how can i provide outgoing ip address of a client
	public ip address for every client ?
Message-ID: <04e101d3ab1c$d8007920$88016b60$@netiletisim.net>

Hi

I have some clients that have their own public ip addresses.  They will use
a Proxy server. 
When a client reach to internet, I want squid to provide that client should
reach internet with  own ip address instead of squid 's ip address.

How can i do that ? 

  



From nninad at gmail.com  Wed Feb 21 16:14:59 2018
From: nninad at gmail.com (ninadmnaik)
Date: Wed, 21 Feb 2018 09:14:59 -0700 (MST)
Subject: [squid-users] Forward proxy: TLS connections to server
In-Reply-To: <af186343-9d97-c2f5-9507-52d766a4e29d@treenet.co.nz>
References: <1518882295560-0.post@n4.nabble.com>
 <ccc35d8f-36db-4395-c265-5b9493249beb@gmail.com>
 <1518886733201-0.post@n4.nabble.com>
 <6e2530c3-a4f2-594e-9038-67e50698759e@gmail.com>
 <1519191497554-0.post@n4.nabble.com>
 <af186343-9d97-c2f5-9507-52d766a4e29d@treenet.co.nz>
Message-ID: <1519229699263-0.post@n4.nabble.com>

Great. Thanks for such a thorough explanation Amos ! Cleared a lot of doubts. 



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From chip_pop at hotmail.com  Wed Feb 21 16:36:06 2018
From: chip_pop at hotmail.com (joseph)
Date: Wed, 21 Feb 2018 09:36:06 -0700 (MST)
Subject: [squid-users] squid-5 lost my cached dir
In-Reply-To: <1519219226329-0.post@n4.nabble.com>
References: <1519168958719-0.post@n4.nabble.com>
 <5bf8b92a-531c-0a25-7d9d-a766abd62630@measurement-factory.com>
 <1519169930855-0.post@n4.nabble.com>
 <66389259-a3a0-7120-b234-ba56c0032742@measurement-factory.com>
 <c682f173-731f-571d-0ab5-d1b65d73900c@gmail.com>
 <ea5d70c0-3e28-139d-5ff2-1acb5709d632@gmail.com>
 <20656790-3654-3506-7549-bca8e3541b2a@measurement-factory.com>
 <1519219226329-0.post@n4.nabble.com>
Message-ID: <1519230966530-0.post@n4.nabble.com>

sorry this fix the start rebuild if swap.state is empty
but there is more issue  wen you stop squid   it delete the swap.state and
re create new one empty




-----
************************** 
***** Crash to the future  ****
**************************
--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From squid3 at treenet.co.nz  Wed Feb 21 20:13:26 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 22 Feb 2018 09:13:26 +1300
Subject: [squid-users] how can i provide outgoing ip address of a client
 public ip address for every client ?
In-Reply-To: <04e101d3ab1c$d8007920$88016b60$@netiletisim.net>
References: <04e101d3ab1c$d8007920$88016b60$@netiletisim.net>
Message-ID: <41f30005-15d9-dc2a-3c05-8dc0b6ed5c35@treenet.co.nz>

On 22/02/18 03:04, Yavuz Ma?lak wrote:
> Hi
> 
> I have some clients that have their own public ip addresses.  They will use
> a Proxy server. 
> When a client reach to internet, I want squid to provide that client should
> reach internet with  own ip address instead of squid 's ip address.
> 
> How can i do that ? 
> 

Firstly, the client is not "reaching the Internet". The client is
reaching your Squid.

How is the client reaching your Squid?

How is the rest of the Internet to know that response traffic coming
from that client IP is actually to be delivered to your Squid?


Amos


From chip_pop at hotmail.com  Wed Feb 21 20:44:33 2018
From: chip_pop at hotmail.com (joseph)
Date: Wed, 21 Feb 2018 13:44:33 -0700 (MST)
Subject: [squid-users] squid-5 lost my cached dir
In-Reply-To: <20656790-3654-3506-7549-bca8e3541b2a@measurement-factory.com>
References: <1519168958719-0.post@n4.nabble.com>
 <5bf8b92a-531c-0a25-7d9d-a766abd62630@measurement-factory.com>
 <1519169930855-0.post@n4.nabble.com>
 <66389259-a3a0-7120-b234-ba56c0032742@measurement-factory.com>
 <c682f173-731f-571d-0ab5-d1b65d73900c@gmail.com>
 <ea5d70c0-3e28-139d-5ff2-1acb5709d632@gmail.com>
 <20656790-3654-3506-7549-bca8e3541b2a@measurement-factory.com>
Message-ID: <1519245873754-0.post@n4.nabble.com>

testing https://github.com/squid-cache/squid/pull/155
working fine :)
i will report if something else came up but so fare so good tks



-----
************************** 
***** Crash to the future  ****
**************************
--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From rousskov at measurement-factory.com  Wed Feb 21 22:35:36 2018
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Wed, 21 Feb 2018 15:35:36 -0700
Subject: [squid-users] squid-5 lost my cached dir
In-Reply-To: <20656790-3654-3506-7549-bca8e3541b2a@measurement-factory.com>
References: <1519168958719-0.post@n4.nabble.com>
 <5bf8b92a-531c-0a25-7d9d-a766abd62630@measurement-factory.com>
 <1519169930855-0.post@n4.nabble.com>
 <66389259-a3a0-7120-b234-ba56c0032742@measurement-factory.com>
 <c682f173-731f-571d-0ab5-d1b65d73900c@gmail.com>
 <ea5d70c0-3e28-139d-5ff2-1acb5709d632@gmail.com>
 <20656790-3654-3506-7549-bca8e3541b2a@measurement-factory.com>
Message-ID: <1b254a7c-187f-025a-df12-a5dab46e537d@measurement-factory.com>

On 02/20/2018 05:04 PM, Alex Rousskov wrote:
> Thank you and joseph for providing these important details. If we can
> reproduce the problem, then we will post a pull request with a fix once
> it is is available.

Done: https://github.com/squid-cache/squid/pull/155

Alex.


> On 02/20/2018 04:57 PM, Yuri wrote:
>> It's immediately lost swap.state contents after any restart and starts
>> up with empty swap.state.
>>
>> After removal of swap.state with stopped squid, it's correctly
>> re-indexing cache contents and then run normally.
>>
>>
>> 21.02.2018 05:50, Yuri ?????:
>>> # -------------------------------------
>>> # Store parameters
>>> # -------------------------------------
>>> minimum_object_size 10 bytes
>>> maximum_object_size 4 GB
>>>
>>> cache_dir aufs /data/cache/d1 48000 64 512
>>> cache_dir aufs /data/cache/d2 48000 64 512
>>> cache_dir aufs /data/cache/d3 48000 64 512
>>> cache_dir aufs /data/cache/d4 48000 64 512
>>>
>>> # -------------------------------------
>>> # Memory parameters
>>> # -------------------------------------
>>> cache_mem 512 MB
>>>
>>> memory_pools off
>>> #memory_pools_limit 1024 MB
>>>
>>> maximum_object_size_in_memory 1 MB
>>>
>>>
>>> 21.02.2018 05:48, Alex Rousskov ?????:
>>>> On 02/20/2018 04:38 PM, joseph wrote:
>>>>> alex tested on 2 environment        debian 9 and solariss
>>>>> same shame  just keep for 30 minute running caching and do squid restart and
>>>>> chek your swap.state  you will notice its empty almost on 2 environment
>>>>> totally different ok
>>>>> i removed that patch and all fine swap.state stay perfect and all fine
>>>>> so i guess one of the 2 scenario  its detecting swap file on start never
>>>>> exist or detecting wrong size that all
>>>> Thank you for providing these additional snippets of information. We
>>>> will, of course, try to reproduce the problem with the info you have
>>>> already provided. If you would like to increase our chances of
>>>> reproducing this problem, please see my original response (quoted below).
>>>>
>>>> Alex.
>>>>
>>>>
>>>>> On 02/20/2018 04:28 PM, Alex Rousskov wrote:
>>>>>> ... Please share your Squid
>>>>>> configuration (at least the SMP-, cache_mem-, and cache_dir-related
>>>>>> directives). You may want to file a bug report to track this fix better.
>>>> _______________________________________________
>>>> squid-users mailing list
>>>> squid-users at lists.squid-cache.org
>>>> http://lists.squid-cache.org/listinfo/squid-users
>>
>>
>>
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
>>
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 



From chip_pop at hotmail.com  Wed Feb 21 22:56:38 2018
From: chip_pop at hotmail.com (joseph)
Date: Wed, 21 Feb 2018 15:56:38 -0700 (MST)
Subject: [squid-users] squid-5 lost my cached dir
In-Reply-To: <1b254a7c-187f-025a-df12-a5dab46e537d@measurement-factory.com>
References: <1519168958719-0.post@n4.nabble.com>
 <5bf8b92a-531c-0a25-7d9d-a766abd62630@measurement-factory.com>
 <1519169930855-0.post@n4.nabble.com>
 <66389259-a3a0-7120-b234-ba56c0032742@measurement-factory.com>
 <c682f173-731f-571d-0ab5-d1b65d73900c@gmail.com>
 <ea5d70c0-3e28-139d-5ff2-1acb5709d632@gmail.com>
 <20656790-3654-3506-7549-bca8e3541b2a@measurement-factory.com>
 <1b254a7c-187f-025a-df12-a5dab46e537d@measurement-factory.com>
Message-ID: <1519253798980-0.post@n4.nabble.com>

thank you and thanks to eduard bagdasaryan 
no more memory overrun on his big patch 

hoop someone soon work on  real range caching  since the real world ar https
mostly now
so adding real range caching will save us  more bandwidth on http squid
server 



-----
************************** 
***** Crash to the future  ****
**************************
--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From squid3 at treenet.co.nz  Thu Feb 22 09:10:46 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 22 Feb 2018 22:10:46 +1300
Subject: [squid-users] squid-5 lost my cached dir
In-Reply-To: <1519253798980-0.post@n4.nabble.com>
References: <1519168958719-0.post@n4.nabble.com>
 <5bf8b92a-531c-0a25-7d9d-a766abd62630@measurement-factory.com>
 <1519169930855-0.post@n4.nabble.com>
 <66389259-a3a0-7120-b234-ba56c0032742@measurement-factory.com>
 <c682f173-731f-571d-0ab5-d1b65d73900c@gmail.com>
 <ea5d70c0-3e28-139d-5ff2-1acb5709d632@gmail.com>
 <20656790-3654-3506-7549-bca8e3541b2a@measurement-factory.com>
 <1b254a7c-187f-025a-df12-a5dab46e537d@measurement-factory.com>
 <1519253798980-0.post@n4.nabble.com>
Message-ID: <1678c055-112c-ead0-ac5a-f874a012a644@treenet.co.nz>

On 22/02/18 11:56, joseph wrote:
> thank you and thanks to eduard bagdasaryan 
> no more memory overrun on his big patch 
> 
> hoop someone soon work on  real range caching  since the real world ar https
> mostly now
> so adding real range caching will save us  more bandwidth on http squid
> server 

Huh?  HTTPS has nothing to do with the HTTP Range mechanism, and neither
does any of the caching work Eduard just finished.

Amos


From chip_pop at hotmail.com  Thu Feb 22 09:49:56 2018
From: chip_pop at hotmail.com (joseph)
Date: Thu, 22 Feb 2018 02:49:56 -0700 (MST)
Subject: [squid-users] squid-5 lost my cached dir
In-Reply-To: <1678c055-112c-ead0-ac5a-f874a012a644@treenet.co.nz>
References: <1519168958719-0.post@n4.nabble.com>
 <5bf8b92a-531c-0a25-7d9d-a766abd62630@measurement-factory.com>
 <1519169930855-0.post@n4.nabble.com>
 <66389259-a3a0-7120-b234-ba56c0032742@measurement-factory.com>
 <c682f173-731f-571d-0ab5-d1b65d73900c@gmail.com>
 <ea5d70c0-3e28-139d-5ff2-1acb5709d632@gmail.com>
 <20656790-3654-3506-7549-bca8e3541b2a@measurement-factory.com>
 <1b254a7c-187f-025a-df12-a5dab46e537d@measurement-factory.com>
 <1519253798980-0.post@n4.nabble.com>
 <1678c055-112c-ead0-ac5a-f874a012a644@treenet.co.nz>
Message-ID: <1519292996118-0.post@n4.nabble.com>

what i was trying to say is about partial range support bro lol and eduard
work is perfect 
like making squid cache partial of the files :)



-----
************************** 
***** Crash to the future  ****
**************************
--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From eliezer at ngtech.co.il  Thu Feb 22 17:36:31 2018
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Thu, 22 Feb 2018 19:36:31 +0200
Subject: [squid-users] Facebook Messenger (Not
	Internet	Connection->Connecting)
In-Reply-To: <CAJtELrhMLVPYJQC0eFFQ8mMSq8aM2o=J75+N0DFNmCC+UU4NFQ@mail.gmail.com>
References: <CAJtELrhHCPCNWR7btcYBUzt49g7i9eDJOA2F9RXSss6VgMaYhQ@mail.gmail.com>
 <0df0ec7b-858c-aceb-e8c8-f9b62876e209@gmail.com>
 <CAJtELrhMLVPYJQC0eFFQ8mMSq8aM2o=J75+N0DFNmCC+UU4NFQ@mail.gmail.com>
Message-ID: <031501d3ac03$ad8302c0$08890840$@ngtech.co.il>

Hey,

What OS are you running squid on-top?

Eliezer

----
http://ngtech.co.il/lmgtfy/
Linux System Administrator
Mobile: +972-5-28704261
Email: eliezer at ngtech.co.il


From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Hery Martin
Sent: Friday, February 9, 2018 21:58
To: Yuri <yvoinov at gmail.com>
Cc: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Facebook Messenger (Not Internet Connection->Connecting)

Hello Yuri

Right now I compiled 3.5.27, and still have the same issue, so maybe its something related with my environment??? But... what can be?





From eliezer at ngtech.co.il  Thu Feb 22 17:29:12 2018
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Thu, 22 Feb 2018 19:29:12 +0200
Subject: [squid-users] Squid 3.x or 4.x acting as a transparent http
	proxy (NOT https)
In-Reply-To: <b8912b35-15e3-247e-81d6-2621d4a325e3@treenet.co.nz>
References: <a6eea1d9-fec4-0e6e-9a33-bde8b9e9f8eb@gmail.com>
 <b8912b35-15e3-247e-81d6-2621d4a325e3@treenet.co.nz>
Message-ID: <!&!AAAAAAAAAAAuAAAAAAAAAGDVRrtF13VDjYYZR9MgvgYBAMO2jhD3dRHOtM0AqgC7tuYAAAAAAA4AABAAAAB5RnreFwTHRa1XbkDHjFE4AQAAAAA=@ngtech.co.il>

Is this issue still unresolved?
After reading the whole thread and getting back to the first post I really don't understand the issue.
OK so google search "foo" didn't helped to understand how to install and configure Squid-Cache right?
You got to the right place!

Now if you don't plan to run Squid-Cache on-top of a Linux system, on what OS specifically do you want to run Squid-Cache on-top?
Also what type of hypervisor are you using for your VM?(XEN, VMWARE, KVM, other)
If you want to use a BSD flavored OS you should stick with the OS recommended firewall.
For OpenBSD it's PF.
For FreeBSD it's either PF or IPFW but there is something regarding PF and IPFW and multiple CPU's on the past and I'm not sure what is the state of it currently.
The last time I tested(a year ago) PF was working fine on FreeBSD 10+11 but had some issue with virtio NIC's which Debian had a similar issue.
If you are using a BSD OS and not planning to set it up for above 1Gbit link then just use an Intel E1000 nic to make things just work as expected.

If there is a need for a test I have a lab ready to test the issue with:
Linux\Windows \BSD Client's
Linux\BSD Router with Squid on-top of it.

When I will receive more details I might be able to clear some doubt's.

Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: eliezer at ngtech.co.il



-----Original Message-----
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Amos Jeffries
Sent: Thursday, February 8, 2018 10:13
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Squid 3.x or 4.x acting as a transparent http proxy (NOT https)


On 08/02/18 10:11, setuid wrote:
> I'll start with the pointedly easy stuff: Squid > 2.6 (tested 3.4, 3.5,
> 4.0 on Ubuntu Xenial, Debian Jessie, FreeSBD 11.1 using iptables, pf,
> ipf, ipfilter) does not work at all, when configured as a transparent
> proxy. Full stop.
> 
> I went through hundreds of posts on dozens of forums, blogs and other
> resources, tried dozens and dozens of configurations suggested by those
> posts, tried all 3 firewall options on BSD, tried two versions of Ubuntu
> and the various versions of Squid from the apt repos, as well as those
> in BSD's ports.
> 
> All of them, 100%, fail in _exactly_ the same way, no matter what my
> configuration was set to. That result, is that _every single http
> request I make_ when Squid is configured as a transparent proxy, results
> in the following response being logged:
> 
> ======================
> 	07/Feb/2018:15:10:59 -0500.213      0 192.168.1.1 TAG_NONE/400 3583 GET
> / - HIER_NONE/- text/html ("-" "-")
> ======================
> 
> When I point a client directly at the proxy, using a browser, curl or
> anything else, I see:
> 
> ======================
> 	07/Feb/2018:15:12:56 -0500.875     82 192.168.1.1 TCP_MISS/302 333 HEAD
> http://www.java.com/ - HIER_DIRECT/www.java.com - ("-" "curl/7.47.0")
> ======================
> 
> These were the same exact request against the same exact Squid instance.

Lets start with the obvious then. HEAD is Not the same as GET. These are
*different* requests. Therefore something major is wrong with your
understanding of the situation.


> If I use Squid 3.5 on Ubuntu or 3.5 and 4.0 on BSD, the logged entry is
> _identical_ for every single http request I make, regardless of origin.
> 
> My Squid configuration is 100% default, identical to the generic config,
> with the exception of the following lines:
> 
> ======================
> http_port 3128
> http_port 3129 intercept
> tcp_outgoing_address 192.168.1.25
> debug_options ALL,9
> ======================
> 
> I've tried all of the obvious links, blogs and resources I could Google
> up, and 100% of them fail to function as described. Most people I've
> seen on the forums who attempt to get this working, throw their hands up
> in defeat and end up configuring the proxy directly on every client that
> needs it.
> 
> My current environment looks like this:
> 
> [ wireless router: 10.0.1.1 on LAN side, 192.168.1.1 on WAN side ]
> 
> That router has a firewall script on it that says:
> 
> ======================
> #!/bin/sh
> PROXY_IP=192.168.2.25
> PROXY_PORT=3128
> LAN_IP=$(nvram get lan_ipaddr)
> LAN_NET=$LAN_IP/$(nvram get lan_netmask)
> 
> iptables -t nat -A PREROUTING -i br0 -s $LAN_NET -d $LAN_NET -p tcp
> --dport 80 -j ACCEPT
> iptables -t nat -A PREROUTING -i br0 -s ! $PROXY_IP -p tcp --dport 80 -j
> DNAT --to $PROXY_IP:$PROXY_PORT
> 
> iptables -t nat -I POSTROUTING -o br0 -s $LAN_NET -d $PROXY_IP -p tcp -j
> SNAT --to $LAN_IP
> iptables -I FORWARD -i br0 -o br0 -s $LAN_NET -d $PROXY_IP -p tcp
> --dport $PROXY_PORT -j ACCEPT
> ======================
> 
> This takes every packet that hits the router on :80, and sends it to my
> Squid server on .25, which mangles it and sends it back to 192.168.1.1
> (router), and onward back to client who requested it.
> 

No. This takes HTTP (port 80 syntax) and sends it to a remote proxy
expecting explicit-proxy syntax.


> When I was using 2.6 (without large_file support), I was using this same
> exact configuration, but http_port was set to 'accel', and I didn't need
> _any_ NAT/routing rules on the squid side at all. It all "Just Worked(tm)".


It also "Just Worked" for anyone attacking your network via
CVE-2009-0801 methods. And would provide them with an effective
invisibility cloak while doing so (original IP:ports destroyed by the NAT).
 Not exactly desirable behaviour.



> 
> Now I need to jump through hoops to do pf incantations of rdr/direct-to
> (but direct-to and direct-reply aren't supported on FreeBSD's pf, only
> OpenBSD's pf supports that syntax), and iptables PREROUTING and
> POSTROUTING mojo (also fails).
> 

You need simply *route* traffic properly in the way the Internet was
designed to work. Instead of abusing NAT.

When that is done properly the NAT happens *only* as the final step to
get the traffic into the Squid process by the machine/device/VM Squid is
running on.


> Here's a list of some of the resources I've tried, with 100% failure in
> every case. There are dozens more that I've lost in my browser history now.
> 
> * https://wiki.squid-cache.org/ConfigExamples/Intercept/Ipfw
> *
> https://wiki.squid-cache.org/SquidFaq/InterceptionProxy#Interception_Caching_packet_redirection_for_OpenBSD_PF

Hmm. I see that page is updated and missing quote a few things. Thanks
for bringing this to attention.

Amos
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From eliezer at ngtech.co.il  Thu Feb 22 17:46:40 2018
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Thu, 22 Feb 2018 19:46:40 +0200
Subject: [squid-users] squid -k rec ,
	seems has problem with ram leakage ?
In-Reply-To: <DB1EBECE-16DA-4432-B8AA-D2C17401D16E@netstream.ps>
References: <532D4976-2EE6-462D-8DDC-B6B3A45F004D@netstream.ps>
 <8db1e241-f781-933b-a538-e8425c61bf2f@treenet.co.nz>
 <DB1EBECE-16DA-4432-B8AA-D2C17401D16E@netstream.ps>
Message-ID: <031701d3ac05$182861f0$487925d0$@ngtech.co.il>

Hey Ahmad,

I?m not sure I understand what 100 instances of squid means?
Are you talking about 100 workers?

Eliezer

----
http://ngtech.co.il/lmgtfy/
Linux System Administrator
Mobile: +972-5-28704261
Email: eliezer at ngtech.co.il


From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of --Ahmad--
Sent: Saturday, February 17, 2018 13:58
To: Amos Jeffries <squid3 at treenet.co.nz>
Cc: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] squid -k rec , seems has problem with ram leakage ?

hi amos 

i didnt use the version 3.5.22

 but long time I?m using the 3.5.22 and its fine 

the new thing is I?m using like 100 squid instances .

and  hourly i have cron to change and update squid 

so i just make rec option instead of having session drop .

i don?t have exact mount of statistics to tell you 

but say i have 32 G ram 

if i run 100 squid instances it take about 16 G ram .

if i keep run the cron hourly by time say daily 12 times ( every 2 hours) 

and after 1 week i go to server to see free ram using :

free -m command

i see the free ram be like 5 G free , while I?m supposed to see the free as 16 G

if i kill all instances and run it again 
the free is 16 G


so as i said , by time , by doing many -k rec OPTINOS , there is something not ok either os or squid I?m not sure .

is there any tuning can i do in squid ?

or os ? I?m using centos 6 64 bits and may be option in sysctl to play with ?

here is my config file :
dns_nameservers 8.8.8.8
dns_v4_first off
########################################
http_port 203.164.132.2:${service_name}
include /root/X3/aclhalf${service_name}.conf
include /root/X3/tcphalf${service_name}.conf 
pid_filename /var/run/squid${service_name}.pid
cache_log /var/log/squid/${service_name}-cache.log
access_log  /var/log/squid/${service_name}-access.log
#################
visible_hostname xyz
# Lockdown Procedures
auth_param basic program /lib/squid/basic_ncsa_auth /etc/squid/squid_userX3
acl ncsa_users proxy_auth REQUIRED
http_access allow ncsa_users
#
# Recommended minimum configuration:
#

# Example rule allowing access from your local networks.
# Adapt to list your (internal) IP networks from where browsing
# should be allowed
# Add any of your own refresh_pattern entries above these.
#
###################################
#########################################
cache_effective_user squid
cache_effective_group squid
##############


On Feb 17, 2018, at 11:38 AM, Amos Jeffries <mailto:squid3 at treenet.co.nz> wrote:

3.5.22




From setuid at gmail.com  Thu Feb 22 17:57:45 2018
From: setuid at gmail.com (setuid)
Date: Thu, 22 Feb 2018 12:57:45 -0500
Subject: [squid-users] Squid 3.x or 4.x acting as a transparent http
 proxy (NOT https)
In-Reply-To: <!&!AAAAAAAAAAAuAAAAAAAAAGDVRrtF13VDjYYZR9MgvgYBAMO2jhD3dRHOtM0AqgC7tuYAAAAAAA4AABAAAAB5RnreFwTHRa1XbkDHjFE4AQAAAAA=@ngtech.co.il>
References: <a6eea1d9-fec4-0e6e-9a33-bde8b9e9f8eb@gmail.com>
 <b8912b35-15e3-247e-81d6-2621d4a325e3@treenet.co.nz>
 <!&!AAAAAAAAAAAuAAAAAAAAAGDVRrtF13VDjYYZR9MgvgYBAMO2jhD3dRHOtM0AqgC7tuYAAAAAAA4AABAAAAB5RnreFwTHRa1XbkDHjFE4AQAAAAA=@ngtech.co.il>
Message-ID: <0e09e349-6769-6aae-0688-a48255ebe5e4@gmail.com>

On 02/22/2018 12:29 PM, Eliezer Croitoru wrote:
> Is this issue still unresolved?
> After reading the whole thread and getting back to the first post I
really don't understand the issue.

No, unresolved. At this point, I'm firmly convinced that Squid 3.x and
later _does not_ work as a fully transparent proxy on either FreeBSD nor
Linux, full stop.

Any version  of Squid earlier than 3.x, works flawlessly in this regard
with a similar configuration.



From patrick.chemla at performance-managers.com  Thu Feb 22 18:15:15 2018
From: patrick.chemla at performance-managers.com (Patrick Chemla)
Date: Thu, 22 Feb 2018 20:15:15 +0200
Subject: [squid-users] tcp_outgoing_address issue how to deny traffic to
	other IPs
Message-ID: <36ed4aae-473e-47f9-5203-f29b9d08dedb@performance-managers.com>

Hi,

I have googled for days and can't find the right settings to distribut 
outgoing requests over part on local IPs of my server.

This is my conf I built according to what I found on docs and forums:


Squid Cache: Version 4.0.17

------------

blablabla

blablabla

blablabla

------------

acl Percent001 random 1/5
acl Percent002 random 1/5
acl Percent003 random 1/5
acl Percent004 random 1/5
acl Percent005 random 1/5

server_persistent_connections off


tcp_outgoing_address XX.3X.YYY.10 Percent001
tcp_outgoing_address XX.X3.YYY.21 Percent002
tcp_outgoing_address XX.5X.YYY.31 Percent003
tcp_outgoing_address XX.X9.YYY.34 Percent004
tcp_outgoing_address XX.5X.YYY.38 Percent005

balance_on_multiple_ip on

forwarded_for delete
via off

My problem is that this server as

- a main IP MA.IN.IP.00 of course

- a locahost 127.0.0.1 of course

- some secondary IPs attached to the same interface as the main IP


The input traffic comes through one of the secondaries, and I need the 
output traffic to get out randomly through other secondaries IPs, not 
any squid traffic from the main IP.

When I look at the log, or using network tcpdump analyzer, I can see 
that there is squid outgoing traffic on this IP, and I can't find how to 
deny tcp_outgoing_address to be on the main IP.

I hope it's clear, and I need help after I searched for days many 
combinations.

Many thanks

Patrick



From eliezer at ngtech.co.il  Thu Feb 22 18:33:32 2018
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Thu, 22 Feb 2018 20:33:32 +0200
Subject: [squid-users] Squid 3.x or 4.x acting as a transparent http
	proxy (NOT https)
In-Reply-To: <0e09e349-6769-6aae-0688-a48255ebe5e4@gmail.com>
References: <a6eea1d9-fec4-0e6e-9a33-bde8b9e9f8eb@gmail.com>
 <b8912b35-15e3-247e-81d6-2621d4a325e3@treenet.co.nz>
 <!&!AAAAAAAAAAAuAAAAAAAAAGDVRrtF13VDjYYZR9MgvgYBAMO2jhD3dRHOtM0AqgC7tuYAAAAAAA4AABAAAAB5RnreFwTHRa1XbkDHjFE4AQAAAAA=@ngtech.co.il>
 <0e09e349-6769-6aae-0688-a48255ebe5e4@gmail.com>
Message-ID: <!&!AAAAAAAAAAAuAAAAAAAAAGDVRrtF13VDjYYZR9MgvgYBAMO2jhD3dRHOtM0AqgC7tuYAAAAAAA4AABAAAADr34UbXj2wQLvOeglxTWrpAQAAAAA=@ngtech.co.il>

What is "fully transparent proxy"? tproxy or intercept mode?
Can you give me more details on your setup? (It works here locally...)

Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: eliezer at ngtech.co.il



-----Original Message-----
From: setuid [mailto:setuid at gmail.com] 
Sent: Thursday, February 22, 2018 19:58
To: Eliezer Croitoru <eliezer at ngtech.co.il>; 'Amos Jeffries' <squid3 at treenet.co.nz>
Cc: 'setuid' <setuid at gmail.com>; squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Squid 3.x or 4.x acting as a transparent http proxy (NOT https)

On 02/22/2018 12:29 PM, Eliezer Croitoru wrote:
> Is this issue still unresolved?
> After reading the whole thread and getting back to the first post I
really don't understand the issue.

No, unresolved. At this point, I'm firmly convinced that Squid 3.x and
later _does not_ work as a fully transparent proxy on either FreeBSD nor
Linux, full stop.

Any version  of Squid earlier than 3.x, works flawlessly in this regard
with a similar configuration.




From JOfficer at istreamfs.com  Thu Feb 22 20:27:24 2018
From: JOfficer at istreamfs.com (Joey Officer)
Date: Thu, 22 Feb 2018 20:27:24 +0000
Subject: [squid-users] Kerberos authentcation failure
Message-ID: <EB7F56E3C9BD2744965B09892082CA5415FADA2D@ad2.istreamfs.local>

A new problem popped up in the last couple of days in an otherwise working environment.

Active Directory running on 2008r2
Windows 10 client
Squid 3.5.12

# squid -v
Squid Cache: Version 3.5.12
Service Name: squid
Ubuntu linux
configure options:  '--build=x86_64-linux-gnu' '--prefix=/usr' '--includedir=${prefix}/include' '--mandir=${prefix}/share/man' '--infodir=${prefix}/share/info' '--sysconfdir=/etc' '--localstatedir=/var' '--libexecdir=${prefix}/lib/squid3' '--srcdir=.' '--disable-maintainer-mode' '--disable-dependency-tracking' '--disable-silent-rules' 'BUILDCXXFLAGS=-g -O2 -fPIE -fstack-protector-strong -Wformat -Werror=format-security -Wl,-Bsymbolic-functions -fPIE -pie -Wl,-z,relro -Wl,-z,now' '--datadir=/usr/share/squid' '--sysconfdir=/etc/squid' '--libexecdir=/usr/lib/squid' '--mandir=/usr/share/man' '--enable-inline' '--disable-arch-native' '--enable-async-io=8' '--enable-storeio=ufs,aufs,diskd,rock' '--enable-removal-policies=lru,heap' '--enable-delay-pools' '--enable-cache-digests' '--enable-icap-client' '--enable-follow-x-forwarded-for' '--enable-auth-basic=DB,fake,getpwnam,LDAP,NCSA,NIS,PAM,POP3,RADIUS,SASL,SMB' '--enable-auth-digest=file,LDAP' '--enable-auth-negotiate=kerberos,wrapper' '--enable-auth-ntlm=fake,smb_lm' '--enable-external-acl-helpers=file_userip,kerberos_ldap_group,LDAP_group,session,SQL_session,unix_group,wbinfo_group' '--enable-url-rewrite-helpers=fake' '--enable-eui' '--enable-esi' '--enable-icmp' '--enable-zph-qos' '--enable-ecap' '--disable-translation' '--with-swapdir=/var/spool/squid' '--with-logdir=/var/log/squid' '--with-pidfile=/var/run/squid.pid' '--with-filedescriptors=65536' '--with-large-files' '--with-default-user=proxy' '--enable-build-info=Ubuntu linux' '--enable-linux-netfilter' 'build_alias=x86_64-linux-gnu' 'CFLAGS=-g -O2 -fPIE -fstack-protector-strong -Wformat -Werror=format-security -Wall' 'LDFLAGS=-Wl,-Bsymbolic-functions -fPIE -pie -Wl,-z,relro -Wl,-z,now' 'CPPFLAGS=-Wdate-time -D_FORTIFY_SOURCE=2' 'CXXFLAGS=-g -O2 -fPIE -fstack-protector-strong -Wformat -Werror=format-security'

I have a working krb5.conf and keytab file and running wbinfo (for example to test) works fine.

A given workstation, using IE, Firefox, Chrome (really anything) is not able to use Kerberos for authentication.  I believe a sample error reported in cache.log :

negotiate_kerberos_auth.cc(610): pid=3033 :2018/02/22 13:23:46| negotiate_kerberos_auth: DEBUG: Got 'YR  removed' from squid (length: 219).
negotiate_kerberos_auth.cc(663): pid=3033 :2018/02/22 13:23:46| negotiate_kerberos_auth: DEBUG: Decode 'removed' (decoded length: 161).
negotiate_kerberos_auth.cc(180): pid=3033 :2018/02/22 13:23:46| negotiate_kerberos_auth: ERROR: gss_accept_sec_context() failed: An unsupported mechanism was requested. Unknown error

It would be helpful if the error included the client IP, so I'm going on best guess.  I'm not sure what additional information to provide.  Any one with some thoughts on whats not working?

Joey

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180222/51e5e38e/attachment.htm>

From xeron.oskom at gmail.com  Thu Feb 22 21:52:12 2018
From: xeron.oskom at gmail.com (Ivan Larionov)
Date: Thu, 22 Feb 2018 13:52:12 -0800
Subject: [squid-users] tcp_outgoing_address issue how to deny traffic to
 other IPs
In-Reply-To: <36ed4aae-473e-47f9-5203-f29b9d08dedb@performance-managers.com>
References: <36ed4aae-473e-47f9-5203-f29b9d08dedb@performance-managers.com>
Message-ID: <CAHvB88z_LfPqWiFO7nOm+3icob5jfW7zxTTw2u97sXK8if3jZQ@mail.gmail.com>

Your balancing rules are incorrect. This is how we balance 30% per IP:

# 33% of traffic per local IP
acl third random 1/3
acl half random 1/2

tcp_outgoing_address X.X.X.2 third
tcp_outgoing_address X.X.X.3 half
tcp_outgoing_address X.X.X.4

Read https://wiki.squid-cache.org/Features/AclRandom.

Basically for 1/5 you need something like this:

acl fifth random 1/5
acl fourth random 1/4
acl third random 1/3
acl half random 1/2

tcp_outgoing_address XX.3X.YYY.10 fifth
tcp_outgoing_address XX.X3.YYY.21 fourth
tcp_outgoing_address XX.5X.YYY.31 third
tcp_outgoing_address XX.X9.YYY.34 half
tcp_outgoing_address XX.5X.YYY.38


On Thu, Feb 22, 2018 at 10:15 AM, Patrick Chemla <
patrick.chemla at performance-managers.com> wrote:

> Hi,
>
> I have googled for days and can't find the right settings to distribut
> outgoing requests over part on local IPs of my server.
>
> This is my conf I built according to what I found on docs and forums:
>
>
> Squid Cache: Version 4.0.17
>
> ------------
>
> blablabla
>
> blablabla
>
> blablabla
>
> ------------
>
> acl Percent001 random 1/5
> acl Percent002 random 1/5
> acl Percent003 random 1/5
> acl Percent004 random 1/5
> acl Percent005 random 1/5
>
> server_persistent_connections off
>
>
> tcp_outgoing_address XX.3X.YYY.10 Percent001
> tcp_outgoing_address XX.X3.YYY.21 Percent002
> tcp_outgoing_address XX.5X.YYY.31 Percent003
> tcp_outgoing_address XX.X9.YYY.34 Percent004
> tcp_outgoing_address XX.5X.YYY.38 Percent005
>
> balance_on_multiple_ip on
>
> forwarded_for delete
> via off
>
> My problem is that this server as
>
> - a main IP MA.IN.IP.00 of course
>
> - a locahost 127.0.0.1 of course
>
> - some secondary IPs attached to the same interface as the main IP
>
>
> The input traffic comes through one of the secondaries, and I need the
> output traffic to get out randomly through other secondaries IPs, not any
> squid traffic from the main IP.
>
> When I look at the log, or using network tcpdump analyzer, I can see that
> there is squid outgoing traffic on this IP, and I can't find how to deny
> tcp_outgoing_address to be on the main IP.
>
> I hope it's clear, and I need help after I searched for days many
> combinations.
>
> Many thanks
>
> Patrick
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>



-- 
With best regards, Ivan Larionov.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180222/a2e47716/attachment.htm>

From rousskov at measurement-factory.com  Thu Feb 22 22:05:32 2018
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Thu, 22 Feb 2018 15:05:32 -0700
Subject: [squid-users] tcp_outgoing_address issue how to deny traffic to
 other IPs
In-Reply-To: <36ed4aae-473e-47f9-5203-f29b9d08dedb@performance-managers.com>
References: <36ed4aae-473e-47f9-5203-f29b9d08dedb@performance-managers.com>
Message-ID: <a1d0c74a-bf39-157a-e6b4-9adeea6618f4@measurement-factory.com>

On 02/22/2018 11:15 AM, Patrick Chemla wrote:

> acl Percent001 random 1/5
> acl Percent002 random 1/5
> acl Percent003 random 1/5
> acl Percent004 random 1/5
> acl Percent005 random 1/5

It is trivial to google up wrong configurations. Think about it: Giving
the same "random 1/5" ACL five different names does not make sense,
regardless of what you are trying to do!

As I will show below, you need 4 different ACLs instead (plus "all"):

  acl OneFifth  random 1/5
  acl OneFourth random 1/4
  acl OneThird  random 1/3
  acl OneHalf   random 1/2

> tcp_outgoing_address XX.3X.YYY.10 Percent001
> tcp_outgoing_address XX.X3.YYY.21 Percent002
> tcp_outgoing_address XX.5X.YYY.31 Percent003
> tcp_outgoing_address XX.X9.YYY.34 Percent004
> tcp_outgoing_address XX.5X.YYY.38 Percent005

... and if none of the *random* ACLs match?

You need to make sure that one of the ACLs matches. That cannot be done
with random ACLs alone. You also need to get your probabilities right:


  tcp_outgoing_address XX.3X.YYY.10 OneFifth
  tcp_outgoing_address XX.X3.YYY.21 OneFourth
  tcp_outgoing_address XX.5X.YYY.31 OneThird
  tcp_outgoing_address XX.X9.YYY.34 OneHalf
  tcp_outgoing_address XX.5X.YYY.38 all

If the above looks strange, recall that the first matching
tcp_outgoing_address rule/line wins, and the rules are tested
individually and independently in the order they appear in squid.conf.
The rest is basic probability theory, but it may also think about it in
step-by-steps terms:

1. Given that there are five possible addresses, how much traffic should
the first out of those five address receive? Obviously 1/5.

2. Now, if the first rule did not match, then there are four addresses
left. Given that there are four possible addresses, how much traffic
should the first out of those four address receive? Obviously 1/4.

...


> When I look at the log, or using network tcpdump analyzer, I can see
> that there is squid outgoing traffic on this IP

Yes, AFAICT, your rules did not tell Squid to use a specific secondary
IP in 33% of cases: (1-1/5)^5 = 0.33


HTH,

Alex.


From rousskov at measurement-factory.com  Thu Feb 22 22:09:05 2018
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Thu, 22 Feb 2018 15:09:05 -0700
Subject: [squid-users] tcp_outgoing_address issue how to deny traffic to
 other IPs
In-Reply-To: <CAHvB88z_LfPqWiFO7nOm+3icob5jfW7zxTTw2u97sXK8if3jZQ@mail.gmail.com>
References: <36ed4aae-473e-47f9-5203-f29b9d08dedb@performance-managers.com>
 <CAHvB88z_LfPqWiFO7nOm+3icob5jfW7zxTTw2u97sXK8if3jZQ@mail.gmail.com>
Message-ID: <13b4d5d3-5a5b-666a-e5ce-8cf6be6bea30@measurement-factory.com>

On 02/22/2018 02:52 PM, Ivan Larionov wrote:
> Your balancing rules are incorrect. This is how we balance 30% per IP:

You won the race! Perhaps our similar emails will increase the page rank
of the correct answers to this FAQ. :-).

Alex.


From martin.faling at siemens.com  Thu Feb 22 22:20:46 2018
From: martin.faling at siemens.com (Faling, Martin)
Date: Thu, 22 Feb 2018 22:20:46 +0000
Subject: [squid-users] Using squid for http to https forward proxy
Message-ID: <D161376DE2AC594DB3A86B459EE1EDD801834D9F@DEFTHW99EI1MSX.ww902.siemens.net>

Hi all,

I am new to configuring Squid as a forward proxy.
Not sure if squid can fullfill my need.
My client ( in this case a Windows 2016 server) needs to connect to the forward proxy (squid) which is residing in a DMZ.
The forward proxy needs to establish a new session to an external webserver on behalf of my client (Windows 2016 server) using mutual authentication (both client and server need to authenticate using certificates).
So assume the client certificate needs to be installed on forward proxy.
I am not looking for redirection from http to https for my client. From client to proxy it needs to be plain http in order to inspect network traffic on the firewall(s).

Question 1 : is such a configuration possible using squid ?
Question 2 : if it is possible, which version of squid (to be installed on CentOS 7) do I need ? How would a configuration look like ?

please advise ASAP.

Kind regards,

Martin

Verzonden van mijn Android-telefoon via TouchDown (www.symantec.com)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180222/8ff97a1e/attachment.htm>

From squid3 at treenet.co.nz  Fri Feb 23 06:47:18 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 23 Feb 2018 19:47:18 +1300
Subject: [squid-users] Using squid for http to https forward proxy
In-Reply-To: <D161376DE2AC594DB3A86B459EE1EDD801834D9F@DEFTHW99EI1MSX.ww902.siemens.net>
References: <D161376DE2AC594DB3A86B459EE1EDD801834D9F@DEFTHW99EI1MSX.ww902.siemens.net>
Message-ID: <55d3a421-fbf5-41ba-2faf-b38380066bd9@treenet.co.nz>

On 23/02/18 11:20, Faling, Martin wrote:
> Hi all,?
> 
> I am new to configuring Squid as a forward proxy.?
> Not sure if squid can fullfill my need.?
> My client ( in this case a Windows 2016 server) needs to connect to the
> forward proxy (squid) which is residing in a DMZ.?
> The forward proxy needs to establish a new session to an external
> webserver on behalf of my client (Windows 2016 server) using mutual
> authentication (both client and server need to authenticate using
> certificates).
> So assume the client certificate needs to be installed on forward proxy. 

No. A regular forward-proxy has nothing to do with TLS between clients
and origin servers (aka "HTTPS"). It will simply open the TCP-level
CONNECT tunnels on request by the client.


> I am not looking for redirection from http to https for my client.

"redirect" between http:// and https:// is forbidden to proxies.

But, I suspect that your choice of the word "redirect" was the wrong
thing here. It does not match with the rest of your problem description.
Specifically the part where you say you are using a forward-proxy.


> From
> client to proxy it needs to be plain http in order to inspect network
> traffic on the firewall(s).>
> Question 1 : is such a configuration possible using squid ? 

Assuming that your initial statement about wanting a forward-proxy was
the correct part of your description. The answer would be yes, and that
you do not have to configure anything at all in Squid for it to work.

The client sends an HTTP CONNECT message to the proxy, which opens the
tunnel to the remote server. When the proxy reports success, the client
initiates the TLS to that server inside the tunnel.


> Question 2 : if it is possible, which version of squid (to be installed
> on CentOS 7) do I need ? How would a configuration look like ? 

If what I think you are asking about is correct any Squid can do it.
Without TLS/SSL support needing to be built into the proxy.


Amos


From jeroen.ruijter at borsboomhamm.nl  Fri Feb 23 13:57:50 2018
From: jeroen.ruijter at borsboomhamm.nl (Jeroen Ruijter)
Date: Fri, 23 Feb 2018 13:57:50 +0000
Subject: [squid-users] Determined ldap server not as an Active Directory
	server
Message-ID: <510FCECD6E595A4D83BF67FC07028E7507CA1B9D@BHMB-01.bnh.local>

This message Determined ldap server not as an Active Directory server makes me believe that there is something wrong with my Windows 2016 Active Directory LDAP server.
Should ik make changes to the groups also SPN or something or perhaps something in the configuration of my active directory?

support_ldap.cc(967): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: DEBUG: Successfully initialised connection to ldap server BHAD01.bnh.local:389
support_ldap.cc(333): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: DEBUG: Search ldap server with bind path "" and filter: (objectclass=*)
support_ldap.cc(602): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: DEBUG: Search ldap entries for attribute : schemaNamingContext
support_ldap.cc(645): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: DEBUG: 1 ldap entry found with attribute : schemaNamingContext
support_ldap.cc(342): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: DEBUG: Search ldap server with bind path CN=Schema,CN=Configuration,DC=bnh,DC=local and filter: (ldapdisplayname=samaccountname)
support_ldap.cc(345): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: DEBUG: Found 0 ldap entries
support_ldap.cc(350): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: DEBUG: Determined ldap server not as an Active Directory server
support_ldap.cc(1061): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: ERROR: Error determining ldap server type: Operations error



kerberos_ldap_group.cc(381): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: INFO: Got User: Jeroen.Ruijter Domain: BNH.LOCAL
support_member.cc(63): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: DEBUG: User domain loop: group at domain ADGroupRaamregeling at BNH.LOCAL
support_member.cc(65): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: DEBUG: Found group at domain ADGroupRaamregeling at BNH.LOCAL
support_ldap.cc(898): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: DEBUG: Setup Kerberos credential cache
support_krb5.cc(127): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: DEBUG: Set credential cache to MEMORY:squid_ldap_2914
support_krb5.cc(138): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: DEBUG: Get default keytab file name
support_krb5.cc(144): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: DEBUG: Got default keytab file name /etc/krb5.keytab
support_krb5.cc(158): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: DEBUG: Get principal name from keytab /etc/krb5.keytab
support_krb5.cc(169): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: DEBUG: Keytab entry has realm name: BNH.LOCAL
support_krb5.cc(189): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: DEBUG: Found principal  name: HTTP/bhlnx03.bnh.local at BNH.LOCAL
support_krb5.cc(205): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: DEBUG: Got principal name HTTP/bhlnx03.bnh.local at BNH.LOCAL
negotiate_kerberos_auth.cc(787): pid=2940 :2018/02/23 14:02:17| negotiate_kerberos_auth: DEBUG: AF oYGyMIGvoAMKAQChCwYJKoZIgvcSAQICooGaBIGXYIGUBgkqhkiG9xIBAgICAG+BhDCBgaADAgEFoQMCAQ+idTBzoAMCAReibARqzfTlfwIFXByskTKBKG2petVbpRjZ76UDFZJxkudaxxhLq6TfvWa104/ueE+xIkAJZju3qgYo8lNEFVDHgvuBzBcecMKdhH/rJpH1DeaBRGWTRAC0uleHKDD/MXhQUMT+e72dsrIPdhDVYw== Jeroen.Ruijter at BNH.LOCAL
support_krb5.cc(269): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: DEBUG: Stored credentials
support_ldap.cc(927): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: DEBUG: Initialise ldap connection
support_ldap.cc(933): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: DEBUG: Canonicalise ldap server name for domain BNH.LOCAL
support_resolv.cc(379): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: DEBUG: Resolved SRV _ldap._tcp.BNH.LOCAL record to BHAD02.bnh.local
support_resolv.cc(379): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: DEBUG: Resolved SRV _ldap._tcp.BNH.LOCAL record to BHAD01.bnh.local
support_resolv.cc(379): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: DEBUG: Resolved SRV _ldap._tcp.BNH.LOCAL record to bhad02.bnh.local
support_resolv.cc(379): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: DEBUG: Resolved SRV _ldap._tcp.BNH.LOCAL record to bhad01.bnh.local
support_resolv.cc(207): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: DEBUG: Resolved address 1 of BNH.LOCAL to BHAD02.bnh.local
support_resolv.cc(207): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: DEBUG: Resolved address 2 of BNH.LOCAL to BHAD02.bnh.local
support_resolv.cc(207): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: DEBUG: Resolved address 3 of BNH.LOCAL to BHAD02.bnh.local
support_resolv.cc(207): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: DEBUG: Resolved address 4 of BNH.LOCAL to BHAD01.bnh.local
support_resolv.cc(207): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: DEBUG: Resolved address 5 of BNH.LOCAL to BHAD01.bnh.local
support_resolv.cc(207): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: DEBUG: Resolved address 6 of BNH.LOCAL to BHAD01.bnh.local
support_resolv.cc(407): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: DEBUG: Adding BNH.LOCAL to list
support_resolv.cc(443): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: DEBUG: Sorted ldap server names for domain BNH.LOCAL:
support_resolv.cc(445): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: DEBUG: Host: BHAD01.bnh.local Port: 389 Priority: 0 Weight: 100
support_resolv.cc(445): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: DEBUG: Host: BHAD02.bnh.local Port: 389 Priority: 0 Weight: 100
support_resolv.cc(445): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: DEBUG: Host: BNH.LOCAL Port: -1 Priority: -2 Weight: -2
support_ldap.cc(942): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: DEBUG: Setting up connection to ldap server BHAD01.bnh.local:389
support_ldap.cc(953): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: DEBUG: Bind to ldap server with SASL/GSSAPI
support_ldap.cc(967): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: DEBUG: Successfully initialised connection to ldap server BHAD01.bnh.local:389
support_ldap.cc(333): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: DEBUG: Search ldap server with bind path "" and filter: (objectclass=*)
support_ldap.cc(602): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: DEBUG: Search ldap entries for attribute : schemaNamingContext
support_ldap.cc(645): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: DEBUG: 1 ldap entry found with attribute : schemaNamingContext
support_ldap.cc(342): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: DEBUG: Search ldap server with bind path CN=Schema,CN=Configuration,DC=bnh,DC=local and filter: (ldapdisplayname=samaccountname)
support_ldap.cc(345): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: DEBUG: Found 0 ldap entries
support_ldap.cc(350): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: DEBUG: Determined ldap server not as an Active Directory server
support_ldap.cc(1061): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: ERROR: Error determining ldap server type: Operations error
support_member.cc(76): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: INFO: User Jeroen.Ruijter is not member of group at domain ADGroupRaamregeling at BNH.LOCAL
support_member.cc(91): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: DEBUG: Default domain loop: group at domain ADGroupRaamregeling at BNH.LOCAL
support_member.cc(119): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: DEBUG: Default group loop: group at domain ADGroupRaamregeling at BNH.LOCAL
kerberos_ldap_group.cc(416): pid=2914 :2018/02/23 14:02:17| kerberos_ldap_group: DEBUG: ERR
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180223/2a24e448/attachment.htm>

From erdosain9 at gmail.com  Fri Feb 23 15:45:00 2018
From: erdosain9 at gmail.com (erdosain9)
Date: Fri, 23 Feb 2018 08:45:00 -0700 (MST)
Subject: [squid-users] Block some web to a group of ip and allow the rest.
Message-ID: <1519400700089-0.post@n4.nabble.com>

Hi to all.
Im trying to block some web to a ip group. 

[root at squid ips]# cat i-restringidos.lst 
192.168.1.42
192.168.1.43
192.168.1.44
192.168.1.45
192.168.1.99
192.168.1.50
192.168.1.128

This same ip group has access to all internet.
[root at squid ips]# cat prensa_isla.lst 
192.168.1.42
192.168.1.43
192.168.1.44
192.168.1.45
192.168.1.99
192.168.1.50
192.168.1.128

This is what i want to block
[root at squid listas]# cat restringidos.lst 
.whatsapp.com
.facebook.com
.instagram.com
.twitter.com


(so i have this 2 acl whit the same ip, one for deny, the other to allow.

So this is my config... and it's not working. Some help?? Thanks!

acl i-restringidos src "/etc/squid/ips/i-restringidos.lst"
acl logistica src "/etc/squid/ips/logistica.lst"
acl adminis  src "/etc/squid/ips/adminis.lst"
acl institucionales src "/etc/squid/ips/institucionales.lst"
acl patriysumi  src     "/etc/squid/ips/patriysumi.lst"
acl rrhh        src     "/etc/squid/ips/rrhh.lst"
acl proyecto    src     "/etc/squid/ips/proyecto.lst"
acl programas_y_activ    src     "/etc/squid/ips/programas_y_activ.lst"
acl auditoria   src     "/etc/squid/ips/auditoria.lst"
acl legales     src     "/etc/squid/ips/legales.lst"
acl proteccion  src     "/etc/squid/ips/proteccion.lst"
acl oe          src     "/etc/squid/ips/oe.lst"
acl prensa-isla src     "/etc/squid/ips/prensa_isla.lst"

#acl red6 src "/etc/squid/ips/red6.lst"
acl red6 src 192.168.6.0/24  #para la red 6
acl red2 src 192.168.2.0/24 #red 2

####Bloquea Publicidad ( http://pgl.yoyo.org/adservers/ )
acl ads dstdom_regex "/etc/squid/listas/ad_block.lst"
http_access deny ads
#deny_info TCP_RESET ads

####Streaming
acl youtube url_regex -i \.flv$
acl youtube url_regex -i \.mp4$
acl youtube url_regex -i watch?
acl youtube url_regex -i youtube
acl facebook url_regex -i facebook
acl facebook url_regex -i fbcdn\.net\/v\/(.*\.mp4)\?
acl facebook url_regex -i fbcdn\.net\/v\/(.*\.jpg)\? 
acl facebook url_regex -i akamaihd\.net\/v\/(.*\.mp4)\?
acl facebook url_regex -i akamaihd\.net\/v\/(.*\.jpg)\?

##Dominios denegados
acl dominios_denegados dstdomain "/etc/squid/listas/dominios_denegados.lst"

##bloqueo de pagina prueba
acl blockprueba dstdomain "/etc/squid/listas/blockprueba.lst"

##Extensiones bloqueadas
acl multimedia urlpath_regex "/etc/squid/listas/multimedia.lst"

##Extensiones peligrosas
acl peligrosos urlpath_regex "/etc/squid/listas/peligrosos.lst"

##Redes sociales
acl restringidos dstdomain ?/etc/squid/listas/restringidos.lst?


#Puertos
acl SSL_ports port 443
acl SSL_ports port 8443
acl SSL_ports port 8080
acl SSL_ports port 20000
#acl SSL_ports port 30666
#acl SSL_ports port 31666
acl SSL_ports port 10000
acl SSL_ports port 10040 # webmin sitio web
acl SSL_ports port 2083

acl Safe_ports port 631         # httpCUPS
acl Safe_ports port 85
acl Safe_ports port 80          # http
acl Safe_ports port 21          # ftp
acl Safe_ports port 443         # https
acl Safe_ports port 70          # gopher
acl Safe_ports port 210         # wais
acl Safe_ports port 8443        # httpsalt
acl Safe_ports port 1025-65535  # unregistered ports
acl Safe_ports port 280         # http-mgmt
acl Safe_ports port 488         # gss-http
acl Safe_ports port 591         # filemaker
acl Safe_ports port 777         # multiling http
acl Safe_ports port 8080        # edesur y otros

acl CONNECT method CONNECT



http_access allow localhost manager


http_access deny manager
http_access deny to_localhost

http_access deny i-restringidos restringidos
http_access allow prensa-isla
http_access allow red6
http_access allow red2
http_access allow logistica !dominios_denegados !multimedia !peligrosos
http_access allow adminis !dominios_denegados
http_access allow institucionales !dominios_denegados !peligrosos
!multimedia
http_access allow patriysumi !multimedia !peligrosos !dominios_denegados
http_access allow proyecto !dominios_denegados !peligrosos !multimedia
http_access allow rrhh !dominios_denegados !peligrosos !multimedia
http_access allow programas_y_activ !dominios_denegados !peligrosos
!multimedia
http_access allow auditoria !dominios_denegados !peligrosos !multimedia
http_access allow legales !dominios_denegados !peligrosos !multimedia
http_access allow proteccion !dominios_denegados !peligrosos !multimedia
http_access allow oe !dominios_denegados !peligrosos !multimedia
http_access deny all

http_port 127.0.0.1:3128
http_port 192.168.1.97:3128 ssl-bump generate-host-certificates=on
dynamic_cert_mem_cache_size=5MB cert=/etc/squid/ssl_cert/myca.pem
key=/etc/squid/ssl_cert/myca.pem


acl step1 at_step SslBump1

acl excludeSSL ssl::server_name_regex "/etc/squid/listas/excluidosSSL.lst"

ssl_bump peek step1
ssl_bump splice excludeSSL
ssl_bump bump all

cache_dir diskd /var/spool/squid 15000 16 256
cache_mem 256 MB


cache_swap_low 75
cache_swap_high 85

# Leave coredumps in the first cache dir
coredump_dir /var/spool/squid


#My refresh pattern
#obliga el cache de imagenes .jgp

refresh_pattern -i \.jpg$ 30 0% 30 ignore-no-cache ignore-no-store
ignore-private

#
# Add any of your own refresh_pattern entries above these.
#
refresh_pattern ^ftp:           1440    20%     10080
refresh_pattern ^gopher:        1440    0%      1440
refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
refresh_pattern .               0       20%     4320

via off
forwarded_for delete

request_header_access From deny all
request_header_access Server deny all
request_header_access WWW-Authenticate deny all
request_header_access Link deny all
request_header_access Cache-Control deny all
request_header_access Proxy-Connection deny all
request_header_access X-Cache deny all
request_header_access X-Cache-Lookup deny all
request_header_access Via deny all
request_header_access X-Forwarded-For deny all
request_header_access Pragma deny all
request_header_access Keep-Alive deny all

delay_pools 15
#Limitar Youtube 
delay_class 1 2
delay_parameters 1 2000000/2000000 100000/1000000
delay_access 1 allow adminis    youtube !facebook
delay_access 1 allow logistica  youtube !facebook
delay_access 1 allow institucionales youtube !facebook
delay_access 1 allow patriysumi youtube !facebook
delay_access 1 allow rrhh youtube !facebook
delay_access 1 allow proyecto youtube !facebook
delay_access 1 allow programas_y_activ youtube !facebook
delay_access 1 allow auditoria youtube !facebook
delay_access 1 allow legales youtube !facebook
delay_access 1 allow oe youtube !facebook
delay_access 1 allow proteccion youtube !facebook
delay_access 1 deny all


#Limitar Facebook
delay_class 2 2
delay_parameters 2 2000000/2000000 100000/1000000
delay_access 2 allow adminis    facebook !youtube
delay_access 2 allow logistica  facebook !youtube
delay_access 2 allow institucionales facebook !youtube
delay_access 2 allow patriysumi facebook !youtube
delay_access 2 allow rrhh facebook !youtube
delay_access 2 allow proyecto facebook !youtube
delay_access 2 allow programas_y_activ facebook !youtube
delay_access 2 allow auditoria facebook !youtube
delay_access 2 allow legales facebook !youtube
delay_access 2 allow oe facebook !youtube
delay_access 2 allow proteccion facebook !youtube
delay_access 2 deny all

#Limitar Video Streaming a 500k
delay_class 3 1
delay_parameters 3 3000000/3000000
delay_access 3 allow prensa-isla youtube !facebook
delay_access 3 deny all

#Ancho de Banda Administracion
delay_class 4 2
delay_parameters 4 1000000/1000000 350000/750000
delay_access 4 allow adminis    !youtube !facebook
delay_access 4 deny all

#Ancho de Banda Logistica
delay_class 5 2
delay_parameters 5 1000000/1000000 350000/750000
delay_access 5 allow logistica  !youtube !facebook
delay_access 5 deny all

#Ancho de Banda Institucionales
delay_class 6 2
delay_parameters 6 1000000/1000000 350000/750000
delay_access 6 allow institucionales !youtube !facebook
delay_access 6 deny all

#Ancho de Banda Patrimonio y Suministro
delay_class 7 2
delay_parameters 7 1000000/1000000 350000/750000
delay_access 7 allow patriysumi !youtube !facebook
delay_access 7 deny all

#Ancho de Banda RRHH
delay_class 8 2
delay_parameters 8 1000000/1000000 350000/750000
delay_access 8 allow rrhh !youtube !facebook
delay_access 8 deny all

#Ancho de Banda Proyecto
delay_class 9 2
delay_parameters 9 1000000/1000000 350000/750000
delay_access 9 allow proyecto !youtube !facebook
delay_access 9 deny all

#Ancho de Banda programas_y_activ
delay_class 10 2
delay_parameters 10 1000000/1000000 350000/750000
delay_access 10 allow programas_y_activ !youtube !facebook
delay_access 10 deny all

#Ancho de Banda Auditoria
delay_class 11 2
delay_parameters 11 1000000/1000000 350000/750000
delay_access 11 allow auditoria !youtube !facebook
delay_access 11 deny all

#Ancho de Banda Legales
delay_class 12 2
delay_parameters 12 1000000/1000000 350000/750000
delay_access 12 allow legales !youtube !facebook
delay_access 12 deny all

#Ancho de Banda Proteccion
delay_class 13 2
delay_parameters 13 1000000/1000000 350000/750000
delay_access 13 allow proteccion !youtube !facebook
delay_access 13 deny all

#Ancho de Banda prensa-isla
delay_class 14 2
delay_parameters 14 2000000/2000000 512000/2000000
delay_access 14 allow prensa-isla !youtube !facebook
delay_access 14 deny all

#Ancho de Banda OE
delay_class 15 2
delay_parameters 15 1000000/1000000 350000/750000
delay_access 15 allow oe !youtube !facebook
delay_access 15 deny all

                
dns_nameservers 192.168.1.222 192.168.1.107
visible_hostname squid.mydomain.lan

# try connecting to first 25 ips of a domain name
forward_max_tries 25

dns_v4_first on



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From erdosain9 at gmail.com  Fri Feb 23 17:29:13 2018
From: erdosain9 at gmail.com (erdosain9)
Date: Fri, 23 Feb 2018 10:29:13 -0700 (MST)
Subject: [squid-users] Kerberos negotiate slow avg service time
Message-ID: <1519406953962-0.post@n4.nabble.com>

Hi to all.
I dont know why i have this bad values. My network is woking fine. How i can
do to fix this. I think is a high value.

HTTP/1.1 200 OK
Server: squid/3.5.27
Mime-Version: 1.0
Date: Fri, 23 Feb 2018 17:16:25 GMT
Content-Type: text/plain;charset=utf-8
Expires: Fri, 23 Feb 2018 17:16:25 GMT
Last-Modified: Fri, 23 Feb 2018 17:16:25 GMT
X-Cache: MISS from proxy.mydomain.lan
X-Cache-Lookup: MISS from proxy.mydomain.lan:3128
Via: 1.1 proxy.mydomain.lan (squid/3.5.27)
Connection: close

Negotiate Authenticator Statistics:
program: /lib64/squid/negotiate_kerberos_auth
number active: 50 of 50 (0 shutting down)
requests sent: 4106
replies received: 4105
queue length: 0
avg service time: 82 msec

   ID #	     FD	    PID	 # Requests	  # Replies	 Flags	   Time	 Offset
Request
     21	     18	  57259	       1183	       1182	B R  	  0.293	      0	(none)
     22	     22	  57260	        652	        652	     	  0.164	      0	(none)
     23	     42	  57261	        440	        440	     	  0.163	      0	(none)
     24	     46	  57262	        307	        307	     	  0.962	      0	(none)
     25	     48	  57263	        223	        223	     	  0.642	      0	(none)
     26	     50	  57264	        180	        180	     	  0.642	      0	(none)
     27	     55	  57265	        138	        138	     	  1.048	      0	(none)
     28	     59	  57266	        115	        115	     	  1.158	      0	(none)
     29	     65	  57267	         90	         90	     	  1.193	      0	(none)
     30	     56	  57268	         77	         77	     	  1.193	      0	(none)
     31	     74	  57269	         69	         69	     	  1.193	      0	(none)
     32	     76	  57270	         64	         64	     	  1.039	      0	(none)
     33	     78	  57271	         56	         56	     	  1.015	      0	(none)
     34	     80	  57272	         54	         54	     	  0.993	      0	(none)
     35	     82	  57273	         46	         46	     	  0.956	      0	(none)
     36	     84	  57274	         39	         39	     	  0.763	      0	(none)
     37	     79	  57275	         37	         37	     	  0.763	      0	(none)
     38	     83	  57276	         31	         31	     	  0.690	      0	(none)
     39	     94	  57277	         28	         28	     	  0.635	      0	(none)
     40	     96	  57278	         26	         26	     	  0.624	      0	(none)
     41	     98	  57279	         25	         25	     	  0.577	      0	(none)
     42	    100	  57280	         23	         23	     	  0.504	      0	(none)
     43	    102	  57281	         20	         20	     	  1.262	      0	(none)
     44	     99	  57282	         20	         20	     	  1.259	      0	(none)
     45	    122	  57283	         17	         17	     	  1.252	      0	(none)
     46	    124	  57284	         16	         16	     	  0.836	      0	(none)
     47	    126	  57285	         14	         14	     	  0.796	      0	(none)
     48	    128	  57286	         14	         14	     	  0.543	      0	(none)
     49	    119	  57287	         13	         13	     	  0.520	      0	(none)
     50	    125	  57288	         11	         11	     	  0.942	      0	(none)
     52	    222	  57292	          8	          8	     	  0.900	      0	(none)
     53	    224	  57293	          7	          7	     	  0.921	      0	(none)
     54	    227	  57294	          6	          6	     	  0.740	      0	(none)
     55	    230	  57295	          5	          5	     	  1.912	      0	(none)
     56	    231	  57296	          4	          4	     	  1.979	      0	(none)
     57	    233	  57297	          5	          5	     	  1.857	      0	(none)
     58	    236	  57298	          5	          5	     	  1.665	      0	(none)
     59	    237	  57299	          5	          5	     	  1.652	      0	(none)
     60	    239	  57300	          4	          4	     	  1.659	      0	(none)
     61	    241	  57301	          5	          5	     	  1.614	      0	(none)
     62	    243	  57304	          5	          5	     	  1.499	      0	(none)
     63	    245	  57305	          5	          5	     	  1.308	      0	(none)
     71	    450	  57317	          3	          3	     	  0.855	      0	(none)
     72	    452	  57318	          2	          2	     	  0.515	      0	(none)
     73	    453	  57319	          1	          1	     	  3.052	      0	(none)
     74	    455	  57320	          2	          2	     	  0.703	      0	(none)
     75	    457	  57321	          2	          2	     	  0.572	      0	(none)
     76	    458	  57322	          1	          1	     	  2.999	      0	(none)
     77	    352	  57323	          1	          1	     	  2.964	      0	(none)
     78	    460	  57324	          2	          2	     	  0.426	      0	(none)

Flags key:

   B = BUSY
   C = CLOSING
   R = RESERVED
   S = SHUTDOWN PENDING
   P = PLACEHOLDER


###Kerberos Auth with ActiveDirectory###
auth_param negotiate program /lib64/squid/negotiate_kerberos_auth -s
HTTP/proxy.empddh.lan at EMPDDH.LAN
auth_param negotiate children 50 startup=0 idle=1
auth_param basic credentialsttl 2 hours
auth_param negotiate keep_alive on


HTTP/1.1 200 OK
Server: squid/3.5.27
Mime-Version: 1.0
Date: Fri, 23 Feb 2018 17:25:58 GMT
Content-Type: text/plain;charset=utf-8
Expires: Fri, 23 Feb 2018 17:25:58 GMT
Last-Modified: Fri, 23 Feb 2018 17:25:58 GMT
X-Cache: MISS from proxy.mydomain.lan
X-Cache-Lookup: MISS from proxy.mydomain.lan:3128
Via: 1.1 proxy.mydomain.lan (squid/3.5.27)
Connection: close

Squid Object Cache: Version 3.5.27
Build Info: 
Service Name: squid
Start Time:	Fri, 23 Feb 2018 17:03:13 GMT
Current Time:	Fri, 23 Feb 2018 17:25:58 GMT
Connection information for squid:
	Number of clients accessing cache:	55
	Number of HTTP requests received:	36896
	Number of ICP messages received:	0
	Number of ICP messages sent:	0
	Number of queued ICP replies:	0
	Number of HTCP messages received:	0
	Number of HTCP messages sent:	0
	Request failure ratio:	 0.00
	Average HTTP requests per minute since start:	1621.0
	Average ICP messages per minute since start:	0.0
	Select loop called: 812404 times, 1.681 ms avg
Cache information for squid:
	Hits as % of all requests:	5min: 6.8%, 60min: 5.5%
	Hits as % of bytes sent:	5min: 4.9%, 60min: 6.7%
	Memory hits as % of hit requests:	5min: 10.2%, 60min: 13.4%
	Disk hits as % of hit requests:	5min: 56.6%, 60min: 58.4%
	Storage Swap size:	1790456 KB
	Storage Swap capacity:	11.7% used, 88.3% free
	Storage Mem size:	217812 KB
	Storage Mem capacity:	42.5% used, 57.5% free
	Mean Object Size:	18.76 KB
	Requests given to unlinkd:	6
Median Service Times (seconds)  5 min    60 min:
	HTTP Requests (All):   0.13498  0.15048
	Cache Misses:          0.16775  0.17711
	Cache Hits:            0.00091  0.00091
	Near Hits:             0.12783  0.19742
	Not-Modified Replies:  0.00000  0.00000
	DNS Lookups:           0.00573  0.02033
	ICP Queries:           0.00000  0.00000
Resource usage for squid:
	UP Time:	1365.713 seconds
	CPU Time:	169.409 seconds
	CPU Usage:	12.40%
	CPU Usage, 5 minute avg:	10.84%
	CPU Usage, 60 minute avg:	12.42%
	Maximum Resident Size: 3199584 KB
	Page faults with physical i/o: 0
Memory accounted for:
	Total accounted:       285660 KB
	memPoolAlloc calls:   9250370
	memPoolFree calls:    9301413
File descriptor usage for squid:
	Maximum number of file descriptors:   16384
	Largest file desc currently in use:   1078
	Number of file desc currently in use:  694
	Files queued for open:                   0
	Available number of file descriptors: 15690
	Reserved number of file descriptors:   100
	Store Disk files open:                   0
Internal Data Structures:
	 95930 StoreEntries
	 12101 StoreEntries with MemObjects
	 11735 Hot Object Cache Items
	 95464 on-disk objects





--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From yvoinov at gmail.com  Fri Feb 23 19:48:30 2018
From: yvoinov at gmail.com (Yuri)
Date: Sat, 24 Feb 2018 01:48:30 +0600
Subject: [squid-users] Kerberos negotiate slow avg service time
In-Reply-To: <1519406953962-0.post@n4.nabble.com>
References: <1519406953962-0.post@n4.nabble.com>
Message-ID: <56ae71bc-25ae-a657-43b8-2a080a8278d1@gmail.com>

Users complains?


23.02.2018 23:29, erdosain9 ?????:
> Hi to all.
> I dont know why i have this bad values. My network is woking fine. How i can
> do to fix this. I think is a high value.
>
> HTTP/1.1 200 OK
> Server: squid/3.5.27
> Mime-Version: 1.0
> Date: Fri, 23 Feb 2018 17:16:25 GMT
> Content-Type: text/plain;charset=utf-8
> Expires: Fri, 23 Feb 2018 17:16:25 GMT
> Last-Modified: Fri, 23 Feb 2018 17:16:25 GMT
> X-Cache: MISS from proxy.mydomain.lan
> X-Cache-Lookup: MISS from proxy.mydomain.lan:3128
> Via: 1.1 proxy.mydomain.lan (squid/3.5.27)
> Connection: close
>
> Negotiate Authenticator Statistics:
> program: /lib64/squid/negotiate_kerberos_auth
> number active: 50 of 50 (0 shutting down)
> requests sent: 4106
> replies received: 4105
> queue length: 0
> avg service time: 82 msec
>
>    ID #	     FD	    PID	 # Requests	  # Replies	 Flags	   Time	 Offset
> Request
>      21	     18	  57259	       1183	       1182	B R  	  0.293	      0	(none)
>      22	     22	  57260	        652	        652	     	  0.164	      0	(none)
>      23	     42	  57261	        440	        440	     	  0.163	      0	(none)
>      24	     46	  57262	        307	        307	     	  0.962	      0	(none)
>      25	     48	  57263	        223	        223	     	  0.642	      0	(none)
>      26	     50	  57264	        180	        180	     	  0.642	      0	(none)
>      27	     55	  57265	        138	        138	     	  1.048	      0	(none)
>      28	     59	  57266	        115	        115	     	  1.158	      0	(none)
>      29	     65	  57267	         90	         90	     	  1.193	      0	(none)
>      30	     56	  57268	         77	         77	     	  1.193	      0	(none)
>      31	     74	  57269	         69	         69	     	  1.193	      0	(none)
>      32	     76	  57270	         64	         64	     	  1.039	      0	(none)
>      33	     78	  57271	         56	         56	     	  1.015	      0	(none)
>      34	     80	  57272	         54	         54	     	  0.993	      0	(none)
>      35	     82	  57273	         46	         46	     	  0.956	      0	(none)
>      36	     84	  57274	         39	         39	     	  0.763	      0	(none)
>      37	     79	  57275	         37	         37	     	  0.763	      0	(none)
>      38	     83	  57276	         31	         31	     	  0.690	      0	(none)
>      39	     94	  57277	         28	         28	     	  0.635	      0	(none)
>      40	     96	  57278	         26	         26	     	  0.624	      0	(none)
>      41	     98	  57279	         25	         25	     	  0.577	      0	(none)
>      42	    100	  57280	         23	         23	     	  0.504	      0	(none)
>      43	    102	  57281	         20	         20	     	  1.262	      0	(none)
>      44	     99	  57282	         20	         20	     	  1.259	      0	(none)
>      45	    122	  57283	         17	         17	     	  1.252	      0	(none)
>      46	    124	  57284	         16	         16	     	  0.836	      0	(none)
>      47	    126	  57285	         14	         14	     	  0.796	      0	(none)
>      48	    128	  57286	         14	         14	     	  0.543	      0	(none)
>      49	    119	  57287	         13	         13	     	  0.520	      0	(none)
>      50	    125	  57288	         11	         11	     	  0.942	      0	(none)
>      52	    222	  57292	          8	          8	     	  0.900	      0	(none)
>      53	    224	  57293	          7	          7	     	  0.921	      0	(none)
>      54	    227	  57294	          6	          6	     	  0.740	      0	(none)
>      55	    230	  57295	          5	          5	     	  1.912	      0	(none)
>      56	    231	  57296	          4	          4	     	  1.979	      0	(none)
>      57	    233	  57297	          5	          5	     	  1.857	      0	(none)
>      58	    236	  57298	          5	          5	     	  1.665	      0	(none)
>      59	    237	  57299	          5	          5	     	  1.652	      0	(none)
>      60	    239	  57300	          4	          4	     	  1.659	      0	(none)
>      61	    241	  57301	          5	          5	     	  1.614	      0	(none)
>      62	    243	  57304	          5	          5	     	  1.499	      0	(none)
>      63	    245	  57305	          5	          5	     	  1.308	      0	(none)
>      71	    450	  57317	          3	          3	     	  0.855	      0	(none)
>      72	    452	  57318	          2	          2	     	  0.515	      0	(none)
>      73	    453	  57319	          1	          1	     	  3.052	      0	(none)
>      74	    455	  57320	          2	          2	     	  0.703	      0	(none)
>      75	    457	  57321	          2	          2	     	  0.572	      0	(none)
>      76	    458	  57322	          1	          1	     	  2.999	      0	(none)
>      77	    352	  57323	          1	          1	     	  2.964	      0	(none)
>      78	    460	  57324	          2	          2	     	  0.426	      0	(none)
>
> Flags key:
>
>    B = BUSY
>    C = CLOSING
>    R = RESERVED
>    S = SHUTDOWN PENDING
>    P = PLACEHOLDER
>
>
> ###Kerberos Auth with ActiveDirectory###
> auth_param negotiate program /lib64/squid/negotiate_kerberos_auth -s
> HTTP/proxy.empddh.lan at EMPDDH.LAN
> auth_param negotiate children 50 startup=0 idle=1
> auth_param basic credentialsttl 2 hours
> auth_param negotiate keep_alive on
>
>
> HTTP/1.1 200 OK
> Server: squid/3.5.27
> Mime-Version: 1.0
> Date: Fri, 23 Feb 2018 17:25:58 GMT
> Content-Type: text/plain;charset=utf-8
> Expires: Fri, 23 Feb 2018 17:25:58 GMT
> Last-Modified: Fri, 23 Feb 2018 17:25:58 GMT
> X-Cache: MISS from proxy.mydomain.lan
> X-Cache-Lookup: MISS from proxy.mydomain.lan:3128
> Via: 1.1 proxy.mydomain.lan (squid/3.5.27)
> Connection: close
>
> Squid Object Cache: Version 3.5.27
> Build Info: 
> Service Name: squid
> Start Time:	Fri, 23 Feb 2018 17:03:13 GMT
> Current Time:	Fri, 23 Feb 2018 17:25:58 GMT
> Connection information for squid:
> 	Number of clients accessing cache:	55
> 	Number of HTTP requests received:	36896
> 	Number of ICP messages received:	0
> 	Number of ICP messages sent:	0
> 	Number of queued ICP replies:	0
> 	Number of HTCP messages received:	0
> 	Number of HTCP messages sent:	0
> 	Request failure ratio:	 0.00
> 	Average HTTP requests per minute since start:	1621.0
> 	Average ICP messages per minute since start:	0.0
> 	Select loop called: 812404 times, 1.681 ms avg
> Cache information for squid:
> 	Hits as % of all requests:	5min: 6.8%, 60min: 5.5%
> 	Hits as % of bytes sent:	5min: 4.9%, 60min: 6.7%
> 	Memory hits as % of hit requests:	5min: 10.2%, 60min: 13.4%
> 	Disk hits as % of hit requests:	5min: 56.6%, 60min: 58.4%
> 	Storage Swap size:	1790456 KB
> 	Storage Swap capacity:	11.7% used, 88.3% free
> 	Storage Mem size:	217812 KB
> 	Storage Mem capacity:	42.5% used, 57.5% free
> 	Mean Object Size:	18.76 KB
> 	Requests given to unlinkd:	6
> Median Service Times (seconds)  5 min    60 min:
> 	HTTP Requests (All):   0.13498  0.15048
> 	Cache Misses:          0.16775  0.17711
> 	Cache Hits:            0.00091  0.00091
> 	Near Hits:             0.12783  0.19742
> 	Not-Modified Replies:  0.00000  0.00000
> 	DNS Lookups:           0.00573  0.02033
> 	ICP Queries:           0.00000  0.00000
> Resource usage for squid:
> 	UP Time:	1365.713 seconds
> 	CPU Time:	169.409 seconds
> 	CPU Usage:	12.40%
> 	CPU Usage, 5 minute avg:	10.84%
> 	CPU Usage, 60 minute avg:	12.42%
> 	Maximum Resident Size: 3199584 KB
> 	Page faults with physical i/o: 0
> Memory accounted for:
> 	Total accounted:       285660 KB
> 	memPoolAlloc calls:   9250370
> 	memPoolFree calls:    9301413
> File descriptor usage for squid:
> 	Maximum number of file descriptors:   16384
> 	Largest file desc currently in use:   1078
> 	Number of file desc currently in use:  694
> 	Files queued for open:                   0
> 	Available number of file descriptors: 15690
> 	Reserved number of file descriptors:   100
> 	Store Disk files open:                   0
> Internal Data Structures:
> 	 95930 StoreEntries
> 	 12101 StoreEntries with MemObjects
> 	 11735 Hot Object Cache Items
> 	 95464 on-disk objects
>
>
>
>
>
> --
> Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-- 
*****************************
* C++20 : Bug to the future *
*****************************


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180224/d7400a83/attachment.sig>

From squid3 at treenet.co.nz  Sat Feb 24 10:01:07 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 24 Feb 2018 23:01:07 +1300
Subject: [squid-users] Block some web to a group of ip and allow the
	rest.
In-Reply-To: <1519400700089-0.post@n4.nabble.com>
References: <1519400700089-0.post@n4.nabble.com>
Message-ID: <07d8b464-5526-5852-f869-106137945882@treenet.co.nz>

On 24/02/18 04:45, erdosain9 wrote:
> Hi to all.
> Im trying to block some web to a ip group. 
> 
> [root at squid ips]# cat i-restringidos.lst 
> 192.168.1.42
> 192.168.1.43
> 192.168.1.44
> 192.168.1.45
> 192.168.1.99
> 192.168.1.50
> 192.168.1.128
> 
> This same ip group has access to all internet.
> [root at squid ips]# cat prensa_isla.lst 
> 192.168.1.42
> 192.168.1.43
> 192.168.1.44
> 192.168.1.45
> 192.168.1.99
> 192.168.1.50
> 192.168.1.128

If they are really the same, then it is better to use one ACL name
instead of two like that.

Using one will help you see more clearly what your config is actually
doing for those IPs, and also make it impossible to accidentally
configure something that can never happen.
 Like "i-restringidos !prensa_isla".


> 
> This is what i want to block
> [root at squid listas]# cat restringidos.lst 
> .whatsapp.com
> .facebook.com
> .instagram.com
> .twitter.com
> 
> 
> (so i have this 2 acl whit the same ip, one for deny, the other to allow.
> 
> So this is my config... and it's not working. Some help?? Thanks!
> 

That is a very complicated setup you have. Below are some
simplifications you can make to shorten it and make it easier to read
what is going on...

> 
> http_access allow localhost manager
> http_access deny manager
> http_access deny to_localhost
> 
> http_access deny i-restringidos restringidos

The above line does exactly what you are asking for.

The only problem that could happen is that the clients in i-restringidos
are not doing what you think they are.

Perhapse they are actually:

 a) not using your proxy to contact those sites,

and/or

 b) using a protocol that skips through the proxy.

   For example; Using SPDY, QUICK, WebSockets etc. instead of HTTP.

and/or,


 c) using a domain name (or raw IP address) not on your list.

   For example most of Facebook traffic usually comes from fbcdn.net,
"Facebook.com" is just the brand name and front page(s).


> http_access allow prensa-isla
> http_access allow red6
> http_access allow red2

All the below lines have !dominios_denegados. So you can add this here:

  http_access deny dominios_denegados

... then remove all the "!dominios_denegados".


> http_access allow logistica !multimedia !peligrosos
> http_access allow adminis

All the below lines have "!peligrosos". So you can do the same again:

  http_access deny peligrosos


And again with !multimedia; ...

  http_access deny multimedia

.. leaving the remainder looking like this:

 http_access allow institucionales
 http_access allow patriysumi
 http_access allow proyecto
 http_access allow rrhh
 http_access allow programas_y_activ
 http_access allow auditoria
 http_access allow legales
 http_access allow proteccion
 http_access allow oe
 http_access deny all


> 
> refresh_pattern -i \.jpg$ 30 0% 30 ignore-no-cache ignore-no-store
> ignore-private

The ignore-no-cache parameter no longer exists. Please remove.


> 
> request_header_access From deny all
> request_header_access Server deny all
> request_header_access WWW-Authenticate deny all
> request_header_access Link deny all
> request_header_access Cache-Control deny all
> request_header_access Proxy-Connection deny all
> request_header_access X-Cache deny all
> request_header_access X-Cache-Lookup deny all
> request_header_access Via deny all
> request_header_access X-Forwarded-For deny all
> request_header_access Pragma deny all
> request_header_access Keep-Alive deny all

The Server, X-Cache, X-Cache-Lookup headers are not request headers.
Those lines are pointless.

The Proxy-Connection header is obsolete and automatically stripped by
all current Squid. No need to do anything for it either.

The Keep-Alive header is hop-by-hop ad stripped by Squid without havign
anyeffect.

The Pragma header is mandatory for HTTP proxies to ignore except in the
rare case of "Pragma:no-cache". Current Squid are HTTP/1.1 so even that
is even more rarely mattering. ALmost all traffic will ignore this header.
 Also, these directives do not in any way affect how your Squid
interprets those headers. All it does is erase them from traffic going
to servers. Which in the case of Pragma is mandatory to pass on exactly
as received. Right now you are breaking all HTTP/1.0 caches across the
Internet between your proxy and the origin server.


> 
> delay_pools 15
> #Limitar Youtube 
> delay_class 1 2
> delay_parameters 1 2000000/2000000 100000/1000000

Two things about these delay rules:

 1) Youtube and Facebook are different companies and services. So
traffic going to YouTube cannot simlultaneously be going to Facebook.
That makes the Facebook part of the check pointless.


2) All of the below lines have "youtube !facebook". Like with
http_access simplification you can make these rules vastly simpler by
checking for the forbidden property and rejecting based on that before
any allow rules.

So, combining the two details mentioned above. You can make this your
first rule:

  delay_access 1 deny !youtube

... then remove the "youtube !facebook" part from all the below lines:

> delay_access 1 allow adminis    youtube !facebook
> delay_access 1 allow logistica  youtube !facebook
> delay_access 1 allow institucionales youtube !facebook
> delay_access 1 allow patriysumi youtube !facebook
> delay_access 1 allow rrhh youtube !facebook
> delay_access 1 allow proyecto youtube !facebook
> delay_access 1 allow programas_y_activ youtube !facebook
> delay_access 1 allow auditoria youtube !facebook
> delay_access 1 allow legales youtube !facebook
> delay_access 1 allow oe youtube !facebook
> delay_access 1 allow proteccion youtube !facebook
> delay_access 1 deny all

Then you get to decide, are there any clients allowed to use the proxy
which are not in those allow rules?

If the answer is yes, you can replace all of those allow lines with
"allow all" and remove the "deny all" line.


> 
> #Limitar Facebook
> delay_class 2 2
> delay_parameters 2 2000000/2000000 100000/1000000
> delay_access 2 allow adminis    facebook !youtube
> delay_access 2 allow logistica  facebook !youtube
> delay_access 2 allow institucionales facebook !youtube
> delay_access 2 allow patriysumi facebook !youtube
> delay_access 2 allow rrhh facebook !youtube
> delay_access 2 allow proyecto facebook !youtube
> delay_access 2 allow programas_y_activ facebook !youtube
> delay_access 2 allow auditoria facebook !youtube
> delay_access 2 allow legales facebook !youtube
> delay_access 2 allow oe facebook !youtube
> delay_access 2 allow proteccion facebook !youtube
> delay_access 2 deny all

Same as with pool #1, but this time make your first line:

  delay_access 2 deny facebook


HTH
Amos


From squid3 at treenet.co.nz  Sat Feb 24 10:18:48 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 24 Feb 2018 23:18:48 +1300
Subject: [squid-users] Kerberos negotiate slow avg service time
In-Reply-To: <1519406953962-0.post@n4.nabble.com>
References: <1519406953962-0.post@n4.nabble.com>
Message-ID: <bc2047b7-cd9a-37f0-7030-2fc607de19a3@treenet.co.nz>


On 24/02/18 06:29, erdosain9 wrote:
> Hi to all.
> I dont know why i have this bad values. My network is woking fine. How i can
> do to fix this. I think is a high value.
> 
> HTTP/1.1 200 OK
> Server: squid/3.5.27
> Mime-Version: 1.0
> Date: Fri, 23 Feb 2018 17:16:25 GMT
> Content-Type: text/plain;charset=utf-8
> Expires: Fri, 23 Feb 2018 17:16:25 GMT
> Last-Modified: Fri, 23 Feb 2018 17:16:25 GMT
> X-Cache: MISS from proxy.mydomain.lan
> X-Cache-Lookup: MISS from proxy.mydomain.lan:3128
> Via: 1.1 proxy.mydomain.lan (squid/3.5.27)
> Connection: close
> 
> Negotiate Authenticator Statistics:
> program: /lib64/squid/negotiate_kerberos_auth
> number active: 50 of 50 (0 shutting down)
> requests sent: 4106
> replies received: 4105
> queue length: 0
> avg service time: 82 msec

The above "avg service time" is not bad for a system as complicated as
Kerberos. Note that this is significantly less than the outstanding
requests listed below in the report. That is a sign that a very large
number of the lookups are performed very, very fast.

In other words; what you see in the report is _only_ the odd ones that
do go slow enough to show up there. With maybe, at most, a few of the
faster ones that happened by chance to be partially done at the instant
the report was generated.


Be aware that it is normal for a helper which has not been used much to
require time to refresh its internal state in order to process a
request. Avoiding that problem is why you see the clear pattern of
#Requests going to one helper, with a second getting most of the
remainder and so on. Squid intentionally biases lookups towards the most
recently used/updated helper. Also, the longer delay times visible being
for the later helpers down the list is another side effect of that problem.


As Yuri cryptically asked, did this come to your attention due to
customer complaints? or just while observing the reports?
 if it is not causing observable issues to the clients I would not worry.

If you want to tune the helpers better than default, you can maybe
further reduce that state refresh by configuring the helper with
explicit details about what backed server to be contacting. A lot of the
delays are caused by sequences of DNS lookups and parsing + processing
the machine KeyTab files. The debug (-d) option of the helper itself can
assist you with identifying which of its internal processes is going
slowest. Just try not to drown in the flood of data from those very,
very fast ones.


> 
>    ID #	     FD	    PID	 # Requests	  # Replies	 Flags	   Time	 Offset
> Request
>      21	     18	  57259	       1183	       1182	B R  	  0.293	      0	(none)
>      22	     22	  57260	        652	        652	     	  0.164	      0	(none)
...

> 
> 
> ###Kerberos Auth with ActiveDirectory###
> auth_param negotiate program /lib64/squid/negotiate_kerberos_auth -s
> HTTP/proxy.empddh.lan at EMPDDH.LAN
> auth_param negotiate children 50 startup=0 idle=1
> auth_param basic credentialsttl 2 hours
> auth_param negotiate keep_alive on
> 



From huaraz at moeller.plus.com  Sat Feb 24 11:19:51 2018
From: huaraz at moeller.plus.com (Markus Moeller)
Date: Sat, 24 Feb 2018 11:19:51 -0000
Subject: [squid-users] kerberos authentication with kerberos groups
In-Reply-To: <510FCECD6E595A4D83BF67FC07028E7507C99B56@BHMB-01.bnh.local>
References: <510FCECD6E595A4D83BF67FC07028E7507C8C90E@BHMB-01.bnh.local>
 <beb50c8f-ad13-1a82-66aa-e9bb6db4b983@treenet.co.nz>
 <510FCECD6E595A4D83BF67FC07028E7507C96FE2@BHMB-01.bnh.local>
 <510FCECD6E595A4D83BF67FC07028E7507C99B56@BHMB-01.bnh.local>
Message-ID: <p6rhkq$pbg$1@blaine.gmane.org>

Hi Jeroen,

  Do you use Active Directory as ldap server ?  My automated test says it is 
not. I use this check to determine the group attribute check.


support_ldap.cc(342): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: 
DEBUG: Search ldap server with bind path 
CN=Schema,CN=Configuration,DC=bnh,DC=local and filter: 
(ldapdisplayname=samaccountname)
support_ldap.cc(345): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: 
DEBUG: Found 0 ldap entries
support_ldap.cc(350): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: 
DEBUG: Determined ldap server not as an Active Directory server

Markus

"Jeroen Ruijter"  wrote in message 
news:510FCECD6E595A4D83BF67FC07028E7507C99B56 at BHMB-01.bnh.local...

I believe this has to be the problem, but how do I solve it? Its almost at 
the end of the whole listing

support_ldap.cc(333): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: 
DEBUG: Search ldap server with bind path "" and filter: (objectclass=*)
support_ldap.cc(602): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: 
DEBUG: Search ldap entries for attribute : schemaNamingContext
support_ldap.cc(645): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: 
DEBUG: 1 ldap entry found with attribute : schemaNamingContext
support_ldap.cc(342): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: 
DEBUG: Search ldap server with bind path 
CN=Schema,CN=Configuration,DC=bnh,DC=local and filter: 
(ldapdisplayname=samaccountname)




kerberos_ldap_group.cc(283): pid=2951 :2018/02/20 17:02:21| 
kerberos_ldap_group: INFO: Starting version 1.3.1sq
support_group.cc(382): pid=2951 :2018/02/20 17:02:21| kerberos_ldap_group: 
INFO: Group list ADGroupRaamregeling@
support_group.cc(447): pid=2951 :2018/02/20 17:02:21| kerberos_ldap_group: 
INFO: Group ADGroupRaamregeling  Domain
support_netbios.cc(83): pid=2951 :2018/02/20 17:02:21| kerberos_ldap_group: 
DEBUG: Netbios list NULL
support_netbios.cc(87): pid=2951 :2018/02/20 17:02:21| kerberos_ldap_group: 
DEBUG: No netbios names defined.
support_lserver.cc(82): pid=2951 :2018/02/20 17:02:21| kerberos_ldap_group: 
DEBUG: ldap server list NULL
support_lserver.cc(86): pid=2951 :2018/02/20 17:02:21| kerberos_ldap_group: 
DEBUG: No ldap servers defined.
kerberos_ldap_group.cc(283): pid=2953 :2018/02/20 17:02:21| 
kerberos_ldap_group: INFO: Starting version 1.3.1sq
support_group.cc(382): pid=2953 :2018/02/20 17:02:21| kerberos_ldap_group: 
INFO: Group list ADGroupRaamregeling@
support_group.cc(447): pid=2953 :2018/02/20 17:02:21| kerberos_ldap_group: 
INFO: Group ADGroupRaamregeling  Domain
support_netbios.cc(83): pid=2953 :2018/02/20 17:02:21| kerberos_ldap_group: 
DEBUG: Netbios list NULL
support_netbios.cc(87): pid=2953 :2018/02/20 17:02:21| kerberos_ldap_group: 
DEBUG: No netbios names defined.
support_lserver.cc(82): pid=2953 :2018/02/20 17:02:21| kerberos_ldap_group: 
DEBUG: ldap server list NULL
support_lserver.cc(86): pid=2953 :2018/02/20 17:02:21| kerberos_ldap_group: 
DEBUG: No ldap servers defined.
kerberos_ldap_group.cc(283): pid=2952 :2018/02/20 17:02:21| 
kerberos_ldap_group: INFO: Starting version 1.3.1sq
support_group.cc(382): pid=2952 :2018/02/20 17:02:21| kerberos_ldap_group: 
INFO: Group list ADGroupRaamregeling@
support_group.cc(447): pid=2952 :2018/02/20 17:02:21| kerberos_ldap_group: 
INFO: Group ADGroupRaamregeling  Domain
support_netbios.cc(83): pid=2952 :2018/02/20 17:02:21| kerberos_ldap_group: 
DEBUG: Netbios list NULL
support_netbios.cc(87): pid=2952 :2018/02/20 17:02:21| kerberos_ldap_group: 
DEBUG: No netbios names defined.
support_lserver.cc(82): pid=2952 :2018/02/20 17:02:21| kerberos_ldap_group: 
DEBUG: ldap server list NULL
support_lserver.cc(86): pid=2952 :2018/02/20 17:02:21| kerberos_ldap_group: 
DEBUG: No ldap servers defined.
2018/02/20 17:02:21 kid1| helperOpenServers: Starting 5/5 
'ext_kerberos_ldap_group_acl' processes
kerberos_ldap_group.cc(283): pid=2954 :2018/02/20 17:02:21| 
kerberos_ldap_group: INFO: Starting version 1.3.1sq
support_group.cc(382): pid=2954 :2018/02/20 17:02:21| kerberos_ldap_group: 
INFO: Group list ADGroupRaamregeling@
support_group.cc(447): pid=2954 :2018/02/20 17:02:21| kerberos_ldap_group: 
INFO: Group ADGroupRaamregeling  Domain
support_netbios.cc(83): pid=2954 :2018/02/20 17:02:21| kerberos_ldap_group: 
DEBUG: Netbios list NULL
support_netbios.cc(87): pid=2954 :2018/02/20 17:02:21| kerberos_ldap_group: 
DEBUG: No netbios names defined.
support_lserver.cc(82): pid=2954 :2018/02/20 17:02:21| kerberos_ldap_group: 
DEBUG: ldap server list NULL
support_lserver.cc(86): pid=2954 :2018/02/20 17:02:21| kerberos_ldap_group: 
DEBUG: No ldap servers defined.
kerberos_ldap_group.cc(283): pid=2955 :2018/02/20 17:02:21| 
kerberos_ldap_group: INFO: Starting version 1.3.1sq
support_group.cc(382): pid=2955 :2018/02/20 17:02:21| kerberos_ldap_group: 
INFO: Group list ADGroupRaamregeling@
support_group.cc(447): pid=2955 :2018/02/20 17:02:21| kerberos_ldap_group: 
INFO: Group ADGroupRaamregeling  Domain
support_netbios.cc(83): pid=2955 :2018/02/20 17:02:21| kerberos_ldap_group: 
DEBUG: Netbios list NULL
support_netbios.cc(87): pid=2955 :2018/02/20 17:02:21| kerberos_ldap_group: 
DEBUG: No netbios names defined.
support_lserver.cc(82): pid=2955 :2018/02/20 17:02:21| kerberos_ldap_group: 
DEBUG: ldap server list NULL
support_lserver.cc(86): pid=2955 :2018/02/20 17:02:21| kerberos_ldap_group: 
DEBUG: No ldap servers defined.
kerberos_ldap_group.cc(283): pid=2956 :2018/02/20 17:02:21| 
kerberos_ldap_group: INFO: Starting version 1.3.1sq
support_group.cc(382): pid=2956 :2018/02/20 17:02:21| kerberos_ldap_group: 
INFO: Group list ADGroupRestrictedAdult@
support_group.cc(447): pid=2956 :2018/02/20 17:02:21| kerberos_ldap_group: 
INFO: Group ADGroupRestrictedAdult  Domain
support_netbios.cc(83): pid=2956 :2018/02/20 17:02:21| kerberos_ldap_group: 
DEBUG: Netbios list NULL
support_netbios.cc(87): pid=2956 :2018/02/20 17:02:21| kerberos_ldap_group: 
DEBUG: No netbios names defined.
support_lserver.cc(82): pid=2956 :2018/02/20 17:02:21| kerberos_ldap_group: 
DEBUG: ldap server list NULL
support_lserver.cc(86): pid=2956 :2018/02/20 17:02:21| kerberos_ldap_group: 
DEBUG: No ldap servers defined.
kerberos_ldap_group.cc(283): pid=2957 :2018/02/20 17:02:21| 
kerberos_ldap_group: INFO: Starting version 1.3.1sq
support_group.cc(382): pid=2957 :2018/02/20 17:02:21| kerberos_ldap_group: 
INFO: Group list ADGroupRestrictedAdult@
support_group.cc(447): pid=2957 :2018/02/20 17:02:21| kerberos_ldap_group: 
INFO: Group ADGroupRestrictedAdult  Domain
support_netbios.cc(83): pid=2957 :2018/02/20 17:02:21| kerberos_ldap_group: 
DEBUG: Netbios list NULL
support_netbios.cc(87): pid=2957 :2018/02/20 17:02:21| kerberos_ldap_group: 
DEBUG: No netbios names defined.
support_lserver.cc(82): pid=2957 :2018/02/20 17:02:21| kerberos_ldap_group: 
DEBUG: ldap server list NULL
support_lserver.cc(86): pid=2957 :2018/02/20 17:02:21| kerberos_ldap_group: 
DEBUG: No ldap servers defined.
kerberos_ldap_group.cc(283): pid=2958 :2018/02/20 17:02:21| 
kerberos_ldap_group: INFO: Starting version 1.3.1sq
support_group.cc(382): pid=2958 :2018/02/20 17:02:21| kerberos_ldap_group: 
INFO: Group list ADGroupRestrictedAdult@
support_group.cc(447): pid=2958 :2018/02/20 17:02:21| kerberos_ldap_group: 
INFO: Group ADGroupRestrictedAdult  Domain
support_netbios.cc(83): pid=2958 :2018/02/20 17:02:21| kerberos_ldap_group: 
DEBUG: Netbios list NULL
support_netbios.cc(87): pid=2958 :2018/02/20 17:02:21| kerberos_ldap_group: 
DEBUG: No netbios names defined.
support_lserver.cc(82): pid=2958 :2018/02/20 17:02:21| kerberos_ldap_group: 
DEBUG: ldap server list NULL
support_lserver.cc(86): pid=2958 :2018/02/20 17:02:21| kerberos_ldap_group: 
DEBUG: No ldap servers defined.
kerberos_ldap_group.cc(283): pid=2959 :2018/02/20 17:02:21| 
kerberos_ldap_group: INFO: Starting version 1.3.1sq
support_group.cc(382): pid=2959 :2018/02/20 17:02:21| kerberos_ldap_group: 
INFO: Group list ADGroupRestrictedAdult@
support_group.cc(447): pid=2959 :2018/02/20 17:02:21| kerberos_ldap_group: 
INFO: Group ADGroupRestrictedAdult  Domain
support_netbios.cc(83): pid=2959 :2018/02/20 17:02:21| kerberos_ldap_group: 
DEBUG: Netbios list NULL
support_netbios.cc(87): pid=2959 :2018/02/20 17:02:21| kerberos_ldap_group: 
DEBUG: No netbios names defined.
support_lserver.cc(82): pid=2959 :2018/02/20 17:02:21| kerberos_ldap_group: 
DEBUG: ldap server list NULL
support_lserver.cc(86): pid=2959 :2018/02/20 17:02:21| kerberos_ldap_group: 
DEBUG: No ldap servers defined.
kerberos_ldap_group.cc(283): pid=2960 :2018/02/20 17:02:21| 
kerberos_ldap_group: INFO: Starting version 1.3.1sq
support_group.cc(382): pid=2960 :2018/02/20 17:02:21| kerberos_ldap_group: 
INFO: Group list ADGroupRestrictedAdult@
support_group.cc(447): pid=2960 :2018/02/20 17:02:21| kerberos_ldap_group: 
INFO: Group ADGroupRestrictedAdult  Domain
support_netbios.cc(83): pid=2960 :2018/02/20 17:02:21| kerberos_ldap_group: 
DEBUG: Netbios list NULL
support_netbios.cc(87): pid=2960 :2018/02/20 17:02:21| kerberos_ldap_group: 
DEBUG: No netbios names defined.
support_lserver.cc(82): pid=2960 :2018/02/20 17:02:21| kerberos_ldap_group: 
DEBUG: ldap server list NULL
support_lserver.cc(86): pid=2960 :2018/02/20 17:02:21| kerberos_ldap_group: 
DEBUG: No ldap servers defined.
kerberos_ldap_group.cc(381): pid=2951 :2018/02/20 17:02:27| 
kerberos_ldap_group: INFO: Got User: Jeroen.Ruijter Domain: BNH.LOCAL
support_member.cc(63): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: 
DEBUG: User domain loop: group at domain ADGroupRaamregeling@
support_member.cc(91): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: 
DEBUG: Default domain loop: group at domain ADGroupRaamregeling@
support_member.cc(93): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: 
DEBUG: Found group at domain ADGroupRaamregeling@
support_ldap.cc(898): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: 
DEBUG: Setup Kerberos credential cache
support_krb5.cc(127): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: 
DEBUG: Set credential cache to MEMORY:squid_ldap_2951
support_krb5.cc(138): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: 
DEBUG: Get default keytab file name
support_krb5.cc(144): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: 
DEBUG: Got default keytab file name /etc/krb5.keytab
support_krb5.cc(158): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: 
DEBUG: Get principal name from keytab /etc/krb5.keytab
support_krb5.cc(169): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: 
DEBUG: Keytab entry has realm name: BNH.LOCAL
support_krb5.cc(189): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: 
DEBUG: Found principal  name: HTTP/bhlnx03.bnh.local at BNH.LOCAL
support_krb5.cc(205): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: 
DEBUG: Got principal name HTTP/bhlnx03.bnh.local at BNH.LOCAL
support_krb5.cc(269): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: 
DEBUG: Stored credentials
support_ldap.cc(927): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: 
DEBUG: Initialise ldap connection
support_ldap.cc(933): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: 
DEBUG: Canonicalise ldap server name for domain BNH.LOCAL
support_resolv.cc(379): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: 
DEBUG: Resolved SRV _ldap._tcp.BNH.LOCAL record to BHAD02.bnh.local
support_resolv.cc(379): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: 
DEBUG: Resolved SRV _ldap._tcp.BNH.LOCAL record to BHAD01.bnh.local
support_resolv.cc(379): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: 
DEBUG: Resolved SRV _ldap._tcp.BNH.LOCAL record to bhad02.bnh.local
support_resolv.cc(379): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: 
DEBUG: Resolved SRV _ldap._tcp.BNH.LOCAL record to bhad01.bnh.local
support_resolv.cc(207): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: 
DEBUG: Resolved address 1 of BNH.LOCAL to BHAD02.bnh.local
support_resolv.cc(207): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: 
DEBUG: Resolved address 2 of BNH.LOCAL to BHAD02.bnh.local
support_resolv.cc(207): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: 
DEBUG: Resolved address 3 of BNH.LOCAL to BHAD02.bnh.local
support_resolv.cc(207): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: 
DEBUG: Resolved address 4 of BNH.LOCAL to BHAD01.bnh.local
support_resolv.cc(207): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: 
DEBUG: Resolved address 5 of BNH.LOCAL to BHAD01.bnh.local
support_resolv.cc(207): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: 
DEBUG: Resolved address 6 of BNH.LOCAL to BHAD01.bnh.local
support_resolv.cc(407): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: 
DEBUG: Adding BNH.LOCAL to list
support_resolv.cc(443): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: 
DEBUG: Sorted ldap server names for domain BNH.LOCAL:
support_resolv.cc(445): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: 
DEBUG: Host: BHAD01.bnh.local Port: 389 Priority: 0 Weight: 100
support_resolv.cc(445): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: 
DEBUG: Host: BHAD02.bnh.local Port: 389 Priority: 0 Weight: 100
support_resolv.cc(445): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: 
DEBUG: Host: BNH.LOCAL Port: -1 Priority: -2 Weight: -2
support_ldap.cc(942): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: 
DEBUG: Setting up connection to ldap server BHAD01.bnh.local:389
support_ldap.cc(953): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: 
DEBUG: Bind to ldap server with SASL/GSSAPI
support_ldap.cc(967): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: 
DEBUG: Successfully initialised connection to ldap server 
BHAD01.bnh.local:389
support_ldap.cc(333): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: 
DEBUG: Search ldap server with bind path "" and filter: (objectclass=*)
support_ldap.cc(602): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: 
DEBUG: Search ldap entries for attribute : schemaNamingContext
support_ldap.cc(645): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: 
DEBUG: 1 ldap entry found with attribute : schemaNamingContext
support_ldap.cc(342): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: 
DEBUG: Search ldap server with bind path 
CN=Schema,CN=Configuration,DC=bnh,DC=local and filter: 
(ldapdisplayname=samaccountname)
support_ldap.cc(345): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: 
DEBUG: Found 0 ldap entries
support_ldap.cc(350): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: 
DEBUG: Determined ldap server not as an Active Directory server
support_ldap.cc(1061): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: 
ERROR: Error determining ldap server type: Operations error
support_member.cc(104): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: 
INFO: User Jeroen.Ruijter is not member of group at domain ADGroupRaamregeling@
support_member.cc(119): pid=2951 :2018/02/20 17:02:27| kerberos_ldap_group: 
DEBUG: Default group loop: group at domain ADGroupRaamregeling@
kerberos_ldap_group.cc(416): pid=2951 :2018/02/20 17:02:27| 
kerberos_ldap_group: DEBUG: ERR

-----Oorspronkelijk bericht-----
Van: Jeroen Ruijter
Verzonden: maandag 19 februari 2018 11:19
Aan: 'Amos Jeffries'; squid-users at lists.squid-cache.org
Onderwerp: RE: [squid-users] kerberos authentication with kerberos groups

Do you advise to use capitals or small characters for the domain name?


-----Oorspronkelijk bericht-----
Van: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] Namens 
Amos Jeffries
Verzonden: vrijdag 16 februari 2018 18:58
Aan: squid-users at lists.squid-cache.org
Onderwerp: Re: [squid-users] kerberos authentication with kerberos groups

On 17/02/18 02:02, Jeroen Ruijter wrote:
> I'm trying to replace my basic ldap authentication by kerberos single
> sign on.
>

NP: Despite what some claim, SSO is not unique to NTLM and Kerberos 
authentication. It is a behaviour of the tools used. As such it can be done 
with *any* authentication type if the tools used perform the necessary 
behaviour.



> The user can succesfully login with single sign on, but I have
> restriction on groups and that is where it goes wrong.

What exactly does this "going wrong" look like?

Also, what version of Squid are you working with?
(the "squid -v" output please)

>
> I would like to use -r to trim the domain name, but when I do so it
> seems to work even less.
>
> Someone any ideas what to try, I believe the system is loking wrong in
> active directory but adding -b OU=Users,DC=yyy,DC=local does not help
> me further

You have some things looking for ".local" and others for ".LOCAL". I'm not 
sure if case insensitivity exists in all those places they are being used, 
so that is one potential cause of problems.


> =======
>
>
>
> auth_param negotiate program /usr/sbin/negotiate_wrapper_auth -d
> --ntlm /usr/bin/ntlm_auth --diagnostics
> --helper-protocol=squid-2.5-ntlmssp
> --domain=yyy --kerberos /usr/sbin/negotiate_kerberos_auth -d -s
> GSS_C_NO_NAME
>
> auth_param negotiate children 20 startup=0 idle=1
>
> auth_param negotiate keep_alive off
>
>
>
> external_acl_type XXX_InternetAllowed ttl=3600 negative_ttl=3600
> %LOGIN /usr/sbin/ext_kerberos_ldap_group_acl -b
> OU=Users,OU=BenH,DC=yyy,DC=local -g AD_XXX_InternetAllowed at yyy.LOCAL
> -d
>
> external_acl_type RestrictedAdult ttl=3600 negative_ttl=3600 %LOGIN
> /usr/sbin/ext_kerberos_ldap_group_acl -b
> OU=Users,OU=BenH,DC=yyy,DC=local -g ADGroupRestrictedAdult at yyy.LOCAL
> -d
>
>
>
> acl XXX_InternetAllowed external XXX_InternetAllowed
>
> acl XXX_Adult external XXX_Adult
>

...
>
> http_access deny auth !XXX_InternetAllowed

The above says the users entire login is to be rejected if they are not a 
member of the XXX_InternetAllowed group.

That should work but it is better to reject failed logins fully first, then 
do the group checks separately.

Like this:

http_access deny !auth
http_access deny !XXX_InternetAllowed all

>
> http_access deny XXX_Adult XXX_AdultX
>

you could gain a fair bit of performance back by making that check the 
dstdomain before the slow external lookup:

  http_access deny XXX_AdultX XXX_Adult all


> http_access allow localnet
>
> http_access allow localhost
>
> http_access deny all
>
>
>
> ========
>


...
>
> support_ldap.cc(342): pid=7612 :2018/02/16 11:50:07|
> kerberos_ldap_group: DEBUG: Search ldap server with bind path
> CN=Schema,CN=Configuration,DC=bnh,DC=local and filter:
> (ldapdisplayname=samaccountname)
>
> support_ldap.cc(345): pid=7612 :2018/02/16 11:50:07|
> kerberos_ldap_group: DEBUG: Found 0 ldap entries
>
> support_ldap.cc(350): pid=7612 :2018/02/16 11:50:07|
> kerberos_ldap_group: DEBUG: Determined ldap server not as an Active
> Directory server
>
> support_ldap.cc(1061): pid=7612 :2018/02/16 11:50:07|
> kerberos_ldap_group: ERROR: Error determining ldap server type:
> Operations error
>
> support_member.cc(76): pid=7612 :2018/02/16 11:50:07|
> kerberos_ldap_group: INFO: User Administrator is not member of
> group at domain AD_XXX_InternetAllowed at YYY.LOCAL
>

Looks like it is working to me.

The helper tries several methods of locating a server, two fail but the 
third seems to work and produces the above result.


Amos

_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users 




From mysticryuujin at gmail.com  Sat Feb 24 17:26:20 2018
From: mysticryuujin at gmail.com (Chase Wright)
Date: Sat, 24 Feb 2018 11:26:20 -0600
Subject: [squid-users] Squid 4 Development / Blog
Message-ID: <CABK82yKC0AYidfEh_fGWXxvFyMorbv2WfYUnd+5qNySjRuLUhw@mail.gmail.com>

It's been nearly 2 years since there was a blog post about Squid 4.x and
I've noticed that the daily auto-generated Squid 3.5 stable branch release
last updated on "08 Dec 2017"

I've also noticed that the last two CVEs were only fixed in the 4.x branch
(2018)

Is the squid team planning to move 4.x to stable soon?

Cheers!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180224/796c048b/attachment.htm>

From squid3 at treenet.co.nz  Sun Feb 25 01:45:34 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sun, 25 Feb 2018 14:45:34 +1300
Subject: [squid-users] Squid 4 Development / Blog
In-Reply-To: <CABK82yKC0AYidfEh_fGWXxvFyMorbv2WfYUnd+5qNySjRuLUhw@mail.gmail.com>
References: <CABK82yKC0AYidfEh_fGWXxvFyMorbv2WfYUnd+5qNySjRuLUhw@mail.gmail.com>
Message-ID: <4ca3d214-2bbb-e1f5-b622-0614de49b383@treenet.co.nz>

On 25/02/18 06:26, Chase Wright wrote:
> It's been nearly 2 years since there was a blog post about Squid 4.x and
> I've noticed that the daily auto-generated Squid 3.5 stable branch
> release last updated on "08 Dec 2017"
> 
> I've also noticed that the last two CVEs were only fixed in the 4.x
> branch (2018)
> 
> Is the squid team planning to move 4.x to stable soon?
> 

"Soon" yes. Those last few bugs proved to be extremely painful and slow
to get fixed.

As of today we have one major bug unfixed, and some testing needed for
checking the stability of the recent huge fixes. I'm just waiting on the
backports of some small regressions already found before the next v4
beta package.

I am *hoping* not to have to release any more 3.5 packages. But that of
course depends on what the timeline this final bug turns into.

Amos


From patrick.chemla at performance-managers.com  Mon Feb 26 13:55:44 2018
From: patrick.chemla at performance-managers.com (Patrick Chemla)
Date: Mon, 26 Feb 2018 15:55:44 +0200
Subject: [squid-users] tcp_outgoing_address issue how to deny traffic to
 other IPs
In-Reply-To: <13b4d5d3-5a5b-666a-e5ce-8cf6be6bea30@measurement-factory.com>
References: <36ed4aae-473e-47f9-5203-f29b9d08dedb@performance-managers.com>
 <CAHvB88z_LfPqWiFO7nOm+3icob5jfW7zxTTw2u97sXK8if3jZQ@mail.gmail.com>
 <13b4d5d3-5a5b-666a-e5ce-8cf6be6bea30@measurement-factory.com>
Message-ID: <965d6026-53b6-a228-271d-abdae4cf8d48@performance-managers.com>

Hi Alex, Ivan,

I finally found time to change/test the squid config to load balance on 
outgoing IPs, and thanks you very much it works very good. All traffic 
is not output according to the rules to the right IPs.

Other question I will open a new thread.

Many many thanks.

Patrick


Le 23/02/2018 ? 00:09, Alex Rousskov a ?crit?:
> On 02/22/2018 02:52 PM, Ivan Larionov wrote:
>> Your balancing rules are incorrect. This is how we balance 30% per IP:
> You won the race! Perhaps our similar emails will increase the page rank
> of the correct answers to this FAQ. :-).
>
> Alex.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



From patrick.chemla at performance-managers.com  Mon Feb 26 14:02:10 2018
From: patrick.chemla at performance-managers.com (Patrick Chemla)
Date: Mon, 26 Feb 2018 16:02:10 +0200
Subject: [squid-users] Redirect input http to https
Message-ID: <2e8446df-a898-07ed-d77b-24c1de3bf93a@performance-managers.com>

Hi all,

A lot a very goog people here could help in this:

I have a squid 3.5.20 in front of some backends to balance traffic 
according to where the website is.

I have set up certificates on squid for all sites, and backend are 
actually accepting traffic both http and https.

On some websites I have set up in Apache parameters a Redirect / 
https://www.domain.tld/ and of course, traffic coming in in http is 
redirected to https.

I searched for some acl/redirect in squid to force redirecting into 
squid and not to have Apache to send this 302 redirect.

Is there a way that Squid will send a 302 redirect to https to all 
requests coming in in http?

Many thanks

Patrick




From jmpatagonia at gmail.com  Mon Feb 26 18:57:40 2018
From: jmpatagonia at gmail.com (Juan Manuel P)
Date: Mon, 26 Feb 2018 15:57:40 -0300
Subject: [squid-users] help with the error TCP_MISS_ABORTED/000
Message-ID: <CADZCxsu1rsiwMO3KVST8JBFJvyYSvyfqZ76=PD3Tn5F_sotfKA@mail.gmail.com>

I am using Squid Cache: Version 3.5.12, but some pages give me the next
error:

1/Feb/2018:18:14:40 -0300 || - || 10.12.43.20 || TCP_MISS_ABORTED/000|| GET
|| http://www.rionegro.gov.ar/download/images/00033494.jpg || -

And load so slowly.

I investigate that the problem can origin in this param --> dns_v4_first on
, so I configured and restarting the server. But the error still append.

Can someone help me please ?

Regards.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180226/1cf8d104/attachment.htm>

From yvoinov at gmail.com  Mon Feb 26 19:11:01 2018
From: yvoinov at gmail.com (Yuri)
Date: Tue, 27 Feb 2018 01:11:01 +0600
Subject: [squid-users] help with the error TCP_MISS_ABORTED/000
In-Reply-To: <CADZCxsu1rsiwMO3KVST8JBFJvyYSvyfqZ76=PD3Tn5F_sotfKA@mail.gmail.com>
References: <CADZCxsu1rsiwMO3KVST8JBFJvyYSvyfqZ76=PD3Tn5F_sotfKA@mail.gmail.com>
Message-ID: <83bf0470-854c-4937-a931-89479d3f2657@gmail.com>

1519672183.376????? 3 192.168.201.10 TCP_MEM_HIT/200 99641 GET
http://www.rioneg
ro.gov.ar/download/images/00033494.jpg - HIER_NONE/- image/jpeg

Request size = 99,641

No problem on 3.5.27 and 5.0.0.

Try to upgrade proxy first.


27.02.2018 00:57, Juan Manuel P ?????:
> I am using Squid Cache: Version 3.5.12, but some pages give me the
> next error:
>
> 1/Feb/2018:18:14:40 -0300 || - || 10.12.43.20 ||
> TCP_MISS_ABORTED/000|| GET ||
> http://www.rionegro.gov.ar/download/images/00033494.jpg
> <http://www.rionegro.gov.ar/download/images/00033494.jpg> || -
>
> And load so slowly.
>
> I investigate that the problem can origin in this param -->
> dns_v4_first on , so I configured and restarting the server. But the
> error still append.
>
> Can someone help me please ?
>
> Regards.
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-- 
*****************************
* C++20 : Bug to the future *
*****************************

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180227/5ed28a7d/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180227/5ed28a7d/attachment.sig>

From squid3 at treenet.co.nz  Mon Feb 26 22:26:59 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 27 Feb 2018 11:26:59 +1300
Subject: [squid-users] Redirect input http to https
In-Reply-To: <2e8446df-a898-07ed-d77b-24c1de3bf93a@performance-managers.com>
References: <2e8446df-a898-07ed-d77b-24c1de3bf93a@performance-managers.com>
Message-ID: <dd1c7f45-46ef-86b1-4bd6-1b9ff7e13b8c@treenet.co.nz>

On 27/02/18 03:02, Patrick Chemla wrote:
> Hi all,
> 
> A lot a very goog people here could help in this:
> 
> I have a squid 3.5.20 in front of some backends to balance traffic
> according to where the website is.
> 
> I have set up certificates on squid for all sites, and backend are
> actually accepting traffic both http and https.
> 
> On some websites I have set up in Apache parameters a Redirect /
> https://www.domain.tld/ and of course, traffic coming in in http is
> redirected to https.
> 
> I searched for some acl/redirect in squid to force redirecting into
> squid and not to have Apache to send this 302 redirect.
> 
> Is there a way that Squid will send a 302 redirect to https to all
> requests coming in in http?


There is, same as HTTP redirect.

The best way is like:

 acl redirect_HTTP proto HTTP
 deny_info 302:https://%H%R redirect_HTTP
 http_access deny redirect_HTTP


Or with the old URL-rewrite helper interface with a helper that provides
both HTTTP redirect status code and new URL. This is very slightly more
flexible, but quite a lot slower.
 <http://www.squid-cache.org/Doc/config/url_rewrite_program/>

Amos


From erdosain9 at gmail.com  Tue Feb 27 18:43:48 2018
From: erdosain9 at gmail.com (erdosain9)
Date: Tue, 27 Feb 2018 11:43:48 -0700 (MST)
Subject: [squid-users] Kerberos negotiate slow avg service time
In-Reply-To: <bc2047b7-cd9a-37f0-7030-2fc607de19a3@treenet.co.nz>
References: <1519406953962-0.post@n4.nabble.com>
 <bc2047b7-cd9a-37f0-7030-2fc607de19a3@treenet.co.nz>
Message-ID: <1519757028287-0.post@n4.nabble.com>

Thank you Amos (sorry again Yuri).

And yes, the user are complains.

The problem is this (and sorry for be recurrent with this).

That value avg ms for some times goes up to 3000... and in that moment all
stop.

in the cache.log sometimes, im getting this.

support_sasl.cc(276): pid=3729 :2018/02/27 14:44:35| kerberos_ldap_group:
ERROR: ldap_sasl_interactive_bind_s error: Can't contact LDAP server
support_ldap.cc(957): pid=3729 :2018/02/27 14:44:35| kerberos_ldap_group:
ERROR: Error while binding to ldap server with SASL/GSSAPI: Can't contact
LDAP server
2018/02/27 14:44:49 kid1| Error negotiating SSL on FD 45:
error:00000000:lib(0):func(0):reason(0) (5/-1/104)
support_sasl.cc(276): pid=3719 :2018/02/27 14:46:56| kerberos_ldap_group:
ERROR: ldap_sasl_interactive_bind_s error: Can't contact LDAP server
support_ldap.cc(957): pid=3719 :2018/02/27 14:46:56| kerberos_ldap_group:
ERROR: Error while binding to ldap server with SASL/GSSAPI: Can't contact
LDAP server
support_sasl.cc(276): pid=3719 :2018/02/27 14:47:18| kerberos_ldap_group:
ERROR: ldap_sasl_interactive_bind_s error: Can't contact LDAP server
support_ldap.cc(957): pid=3719 :2018/02/27 14:47:18| kerberos_ldap_group:
ERROR: Error while binding to ldap server with SASL/GSSAPI: Can't contact
LDAP server
support_sasl.cc(276): pid=3729 :2018/02/27 14:47:28| kerberos_ldap_group:
ERROR: ldap_sasl_interactive_bind_s error: Can't contact LDAP server
support_ldap.cc(957): pid=3729 :2018/02/27 14:47:28| kerberos_ldap_group:
ERROR: Error while binding to ldap server with SASL/GSSAPI: Can't contact
LDAP server
support_sasl.cc(276): pid=3719 :2018/02/27 14:47:36| kerberos_ldap_group:
ERROR: ldap_sasl_interactive_bind_s error: Can't contact LDAP server
support_ldap.cc(957): pid=3719 :2018/02/27 14:47:36| kerberos_ldap_group:
ERROR: Error while binding to ldap server with SASL/GSSAPI: Can't contact
LDAP server


Is impossible that this problem happend from the squid side? Im thinking
that is a problem in the AD (windows server 2012). 

With more log (-d) i got a lot of this... (just a little). This is working
negotiate_kerberos_pac.cc(376): pid=3973 :2018/02/27 12:08:33|
negotiate_kerberos_auth: INFO: Got PAC data of lengh 584
negotiate_kerberos_pac.cc(180): pid=3973 :2018/02/27 12:08:33|
negotiate_kerberos_auth: INFO: Found 4 rids
negotiate_kerberos_pac.cc(188): pid=3973 :2018/02/27 12:08:33|
negotiate_kerberos_auth: Info: Got rid: 1168
negotiate_kerberos_pac.cc(188): pid=3973 :2018/02/27 12:08:33|
negotiate_kerberos_auth: Info: Got rid: 512
negotiate_kerberos_pac.cc(188): pid=3973 :2018/02/27 12:08:33|
negotiate_kerberos_auth: Info: Got rid: 513
negotiate_kerberos_pac.cc(188): pid=3973 :2018/02/27 12:08:33|
negotiate_kerberos_auth: Info: Got rid: 1132
negotiate_kerberos_pac.cc(256): pid=3973 :2018/02/27 12:08:33|
negotiate_kerberos_auth: INFO: Got DomainLogonId
S-1-5-21-3939648023-1419124151
-3306617744
negotiate_kerberos_pac.cc(278): pid=3973 :2018/02/27 12:08:33|
negotiate_kerberos_auth: INFO: Found 1 ExtraSIDs
negotiate_kerberos_pac.cc(327): pid=3973 :2018/02/27 12:08:33|
negotiate_kerberos_auth: INFO: Got ExtraSid S-1-18-1
negotiate_kerberos_pac.cc(456): pid=3973 :2018/02/27 12:08:33|
negotiate_kerberos_auth: INFO: Read 540 of 584 bytes 
negotiate_kerberos_auth.cc(778): pid=3973 :2018/02/27 12:08:33|
negotiate_kerberos_auth: DEBUG: Groups
group=AQUAAAAAAAUVAAAAF0LS6rcdllSQ+xbFk
AQAAA== group=AQUAAAAAAAUVAAAAF0LS6rcdllSQ+xbFAAIAAA==
group=AQUAAAAAAAUVAAAAF0LS6rcdllSQ+xbFAQIAAA==
group=AQUAAAAAAAUVAAAAF0LS6rcdllSQ+xbFbA
QAAA== group=AQEAAAAAABIBAAAA
negotiate_kerberos_auth.cc(783): pid=3973 :2018/02/27 12:08:33|
negotiate_kerberos_auth: DEBUG: AF
oYG2MIGzoAMKAQChCwYJKoZIgvcSAQICooGeBIGbYIG
YBgkqhkiG9xIBAgICAG+BiDCBhaADAgEFoQMCAQ+ieTB3oAMCARKicARub5MOjpO177M/gXJcAdluTnj+29wfwmcbZJVIFDyiXBKLScmwPhaPd2sH4IvcEiBhgddiTbURTRfM7OsWlql7+
uS2I4WWSke5bcRYRIaprvgl3wtCoX9PjSQEmYL0H8LIBL0sQh2fbYftAXyxMGs=
user at MYDOMAIN.LAN
negotiate_kerberos_auth.cc(610): pid=3973 :2018/02/27 12:08:37|
negotiate_kerberos_auth: DEBUG: Got 'YR
YIIHJQYGKwYBBQUCoIIHGTCCBxWgMDAuBgkqhk
iC9xIBAgIGCSqGSIb3EgECAgYKKwYBBAGCNwICHgYKKwYBBAGCNwICCqKCBt8EggbbYIIG1wYJKoZIhvcSAQICAQBuggbGMIIGwqADAgEFoQMCAQ6iBwMFACAAAACjggUDYYIE/zCCBPug
AwIBBaEMGwpFTVBEREguTEFOoiMwIaADAgECoRowGBsESFRUUBsQcHJveHkuZW1wZGRoLmxhbqOCBL8wggS7oAMCARKhAwIBA6KCBK0EggSpV5Ofs3WVdVBcsFv+Hm0rIqwv8Lnra2qZOa
8cldCaPT4j6lGbmhe4JphrdI8H+dJbZI42SC1WLj6ettPI1OB5JPc340A6q3X7f9Zjp1rplc/6/n2mNooCah+Epq83CeI2w1bjX24sIwv5Vj5fNv9l5tzRI2vm5hry828+jNNGEamR0Vi5
1wy1HpFRVm39xExs9HiIdVRuVLC2sgXPf3PLLlmE5pKPATPW074v045VnrYXFERgyFN45Le4oBqavwtQ4yxdnVt/3wHzx9B2jYckYp0EMbS4yHMH8trwNJwYWji7zTINkD1s81EMCl0t0R
bQBwt8rLbcYLurOpj95nicRZbfSAkNozbVo1i4sYApjqxZG1xPK1JdNYc927kCayiTSa6emuD2LbXaY47phntoGg77k8JvaSeqL/yNMhPS8/k5PuE1qSaQjSvatAiqUF8fWQRu9O8f4uhQ
LyseKPkBiO6Ll/NgQFXhAQOwxyvunbLZhVz568UsP1EMw8IRU8m6CRXoyHB9xFQVS+QI3PBYXzD3eFtYfofbXJjYm97VZrB+CmmU5K72Azm/bQzwybSbDhqLo9FyKAR2K9lFp0q3/Gt/Gf
+A7z2JR02Nl0spHVjsvJpLJ9G7QeJ/N2ByUs6oHC+95RTIZzpnTi8o+0eRBeG1QXR08OymGsiHPe7QAG90KFe0bGbmS3Q/nVy2kvcBnmnrDpmgkO6Q5pXQmg/25+nw20Cp0nTKSdmaXhcZ
JqiHh8loktMJxwtx1OlOcqy+Rrn2z+Ebp5WRiaBUZA2x95Bxx8QAc6PnPO0jHNyYZBuHO6UPzm71EkC5Af6CEHmXJoIp+/ipCgnMi/8LVRti3RDd/g3tHyk7AvOeGznqfJk0u1feL0oC/v
hx6uUxEG42YTuo7kYEwcYzENFNuqKEWCW8pLPLuw0P6CX76mpwbMSikV9qRcjB1bzDtS5YCkPXYjrCEYam1PcWYC/df8n+364LDDHHGCVWN4dLDaOqGy5xiek7mA6xdR7F0DH4BmzF89Hu
ZHhearwgpOH2gQci8YCwCrZUYbb7VepoXRG1WhiCLXpItF1uC96ERZreCh3FMv9WsOvuZ9W5LkzM6gHtTMRgNi9jQF5Y/OqN9zbAJq2/pFg5CCJA2UMjyrOv+rDq0c48d1ECTc+RYy2ISL
VtvTIQyXe4mxQ7Lmzrej5a3JhMxbICvmVj9tNLoe8JKcbUP0/gV3x8QpRGK7yx7+Zn0v6DCEIyD2cX1LMp0++n5j7rKNjcx9Kq6bkwH1T5qecmScmWf57nVgASGcWtC5fFKW4qpjtC2A74
Nu5lC+z90iGKOIlfXdyJHeQW/LufQDm8h4p731wFR22WD2ki0Z1eavTVibafZOKZIZuMNBfPSmKY9f0rmzCbv9Syxel/tU0Z87tyDid/m8qC2t9krg4Yr/5bAoVXMcDW31PwlSwInxom16
E1aSMarQ0oLo7rx0TSrC1QZj0/DsMWsacy2L1qhylYRU+poQsJaGJhTgZqqIHfoklR0MKN6i0hWJe1PXhvH/QZr4Ftif483pxd8Koq9UYM1aHjw/KSdo2Y1q/KZ2gdH0gIDoVYQNOkggGk
MIIBoKADAgESooIBlwSCAZPiK9yyDUJajCbaipq/vKOjP2JAo4TWDL66hZ2p37D0Y7eLah8oxghut6psDK9rmoUnpgZjZ8uRLDa73+6tlEOpdTyAafyftG5egQXvDzCzluLEnjg4NpQ+Y0
NgrpOYSkUpOijbLrl4jdsAmg9TEDI3qpfSC4Vm22xcs/XUFIwoXGRBRsCriirSNPOqGaayDuP0wJsyq3ldMPYCHmN3K+gsOmuWeJqg5xmjOlCLWarJXg7ZKy9cbgfmFDZNNuq0ihXP7CvT
sH2LSAsr8XLFNbEfR8UQkfGVwnvDsl68FQzSzR4bVkKE5sFJOsloM51R2i2y60TA8q7O4GYmUEXBJEkLWElRc9X4EMq9XCN49+VRxZEFXYP/62gGXfr3kC9sbFm2r4KkozuEEqt5ngjXjHH5+5RklbSDwKhoqnMRmOn8mdPc6ZTqCMahmxbJEJNOvbhQQaI17H46MVt8uBxMbMGXor0i95SOKtnJGlbUkxP6/GDJu/KmzwdJQC7Oa8C7avx/QHKj2LYyVkFkB3kUE5CSJsR0'
from squid (length: 2447).


But, in some moments i get again the :
kerberos_ldap_group: ERROR: Error while binding to ldap server with
SASL/GSSAPI: Can't contact LDAP server

This is probably a Windows server, i repeat, but i ask for if someone know
what can i do. (and maybe ensure that is not a squid problem)

(Again sorry with continue with this).



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From squid3 at treenet.co.nz  Wed Feb 28 00:50:29 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 28 Feb 2018 13:50:29 +1300
Subject: [squid-users] Kerberos negotiate slow avg service time
In-Reply-To: <1519757028287-0.post@n4.nabble.com>
References: <1519406953962-0.post@n4.nabble.com>
 <bc2047b7-cd9a-37f0-7030-2fc607de19a3@treenet.co.nz>
 <1519757028287-0.post@n4.nabble.com>
Message-ID: <66709730-cd43-50b6-4860-93db7e937c82@treenet.co.nz>

On 28/02/18 07:43, erdosain9 wrote:
> Thank you Amos (sorry again Yuri).
> 
> And yes, the user are complains.
> 
> The problem is this (and sorry for be recurrent with this).
> 
> That value avg ms for some times goes up to 3000... and in that moment all
> stop.
> 
> in the cache.log sometimes, im getting this.
> 
> support_sasl.cc(276): pid=3729 :2018/02/27 14:44:35| kerberos_ldap_group:
> ERROR: ldap_sasl_interactive_bind_s error: Can't contact LDAP server
> support_ldap.cc(957): pid=3729 :2018/02/27 14:44:35| kerberos_ldap_group:
> ERROR: Error while binding to ldap server with SASL/GSSAPI: Can't contact
> LDAP server
> 2018/02/27 14:44:49 kid1| Error negotiating SSL on FD 45:
> error:00000000:lib(0):func(0):reason(0) (5/-1/104)
> support_sasl.cc(276): pid=3719 :2018/02/27 14:46:56| kerberos_ldap_group:
> ERROR: ldap_sasl_interactive_bind_s error: Can't contact LDAP server
> support_ldap.cc(957): pid=3719 :2018/02/27 14:46:56| kerberos_ldap_group:
> ERROR: Error while binding to ldap server with SASL/GSSAPI: Can't contact
> LDAP server
> support_sasl.cc(276): pid=3719 :2018/02/27 14:47:18| kerberos_ldap_group:
> ERROR: ldap_sasl_interactive_bind_s error: Can't contact LDAP server
> support_ldap.cc(957): pid=3719 :2018/02/27 14:47:18| kerberos_ldap_group:
> ERROR: Error while binding to ldap server with SASL/GSSAPI: Can't contact
> LDAP server
> support_sasl.cc(276): pid=3729 :2018/02/27 14:47:28| kerberos_ldap_group:
> ERROR: ldap_sasl_interactive_bind_s error: Can't contact LDAP server
> support_ldap.cc(957): pid=3729 :2018/02/27 14:47:28| kerberos_ldap_group:
> ERROR: Error while binding to ldap server with SASL/GSSAPI: Can't contact
> LDAP server
> support_sasl.cc(276): pid=3719 :2018/02/27 14:47:36| kerberos_ldap_group:
> ERROR: ldap_sasl_interactive_bind_s error: Can't contact LDAP server
> support_ldap.cc(957): pid=3719 :2018/02/27 14:47:36| kerberos_ldap_group:
> ERROR: Error while binding to ldap server with SASL/GSSAPI: Can't contact
> LDAP server
> 
> 
> Is impossible that this problem happend from the squid side? Im thinking
> that is a problem in the AD (windows server 2012).

The Squid helper is using a SASL library on your system to contact the
LDAP server. Those error messages are sadly all the info which Squid or
its helper have about the failure.

A quick search for the message though, brings up this document about
LDAP listing quite a few reasons that message may appear (ie places to
check):
 <http://www.openldap.org/faq/data/cache/1432.html>

Note: I have no knowledge of its accuracy, it just seems like a useful
list of things for you to check up on.

>From the sounds of it the problem is usually a lot more harsh and fatal
than what yo are seeing. It is kind of odd that it only affects an
occasional request - as shown by your cachemgr report earlier *most*
requests go straight through nice and quickly.


This may be quite different, but: I saw similar weird "sometimes"
failures with an IMAP service last year. It turned out that fail2ban was
set with a slightly too-low threshold and was banning a particular
client on flakey Dial-Up internet connection when it was raining in
their neighbourhood. Their TCP connection losses caused a ban which we
were seeing only as failure to re-login some minutes later once the
clients mail program wanted to re-check new mail.



> 
> With more log (-d) i got a lot of this... (just a little). This is working
> negotiate_kerberos_pac.cc(376): pid=3973 :2018/02/27 12:08:33|
> negotiate_kerberos_auth: INFO: Got PAC data of lengh 584
> negotiate_kerberos_pac.cc(180): pid=3973 :2018/02/27 12:08:33|
> negotiate_kerberos_auth: INFO: Found 4 rids
> negotiate_kerberos_pac.cc(188): pid=3973 :2018/02/27 12:08:33|
> negotiate_kerberos_auth: Info: Got rid: 1168
> negotiate_kerberos_pac.cc(188): pid=3973 :2018/02/27 12:08:33|
> negotiate_kerberos_auth: Info: Got rid: 512
> negotiate_kerberos_pac.cc(188): pid=3973 :2018/02/27 12:08:33|
> negotiate_kerberos_auth: Info: Got rid: 513
> negotiate_kerberos_pac.cc(188): pid=3973 :2018/02/27 12:08:33|
> negotiate_kerberos_auth: Info: Got rid: 1132
> negotiate_kerberos_pac.cc(256): pid=3973 :2018/02/27 12:08:33|
> negotiate_kerberos_auth: INFO: Got DomainLogonId
> S-1-5-21-3939648023-1419124151
> -3306617744
> negotiate_kerberos_pac.cc(278): pid=3973 :2018/02/27 12:08:33|
> negotiate_kerberos_auth: INFO: Found 1 ExtraSIDs
> negotiate_kerberos_pac.cc(327): pid=3973 :2018/02/27 12:08:33|
> negotiate_kerberos_auth: INFO: Got ExtraSid S-1-18-1
> negotiate_kerberos_pac.cc(456): pid=3973 :2018/02/27 12:08:33|
> negotiate_kerberos_auth: INFO: Read 540 of 584 bytes 
> negotiate_kerberos_auth.cc(778): pid=3973 :2018/02/27 12:08:33|
> negotiate_kerberos_auth: DEBUG: Groups
> group=AQUAAAAAAAUVAAAAF0LS6rcdllSQ+xbFk
> AQAAA== group=AQUAAAAAAAUVAAAAF0LS6rcdllSQ+xbFAAIAAA==
> group=AQUAAAAAAAUVAAAAF0LS6rcdllSQ+xbFAQIAAA==
> group=AQUAAAAAAAUVAAAAF0LS6rcdllSQ+xbFbA
> QAAA== group=AQEAAAAAABIBAAAA
> negotiate_kerberos_auth.cc(783): pid=3973 :2018/02/27 12:08:33|
> negotiate_kerberos_auth: DEBUG: AF ...
> user at MYDOMAIN.LAN
> negotiate_kerberos_auth.cc(610): pid=3973 :2018/02/27 12:08:37|
> negotiate_kerberos_auth: DEBUG: Got 'YR...
> from squid (length: 2447).

This is mostly the data flow between Squid and the helper. That one
appears to be successful (found the groups=* lists).

There may be something about user credentials that breaks the LDAP
lookup, but AFAICT the failure is happening at the connect/bind stage
before any of the user info is sent to LDAP (I may be wrong there, my
knowledge of LDAP is low).


> 
> But, in some moments i get again the :
> kerberos_ldap_group: ERROR: Error while binding to ldap server with
> SASL/GSSAPI: Can't contact LDAP server
> 
> This is probably a Windows server, i repeat, but i ask for if someone know
> what can i do. (and maybe ensure that is not a squid problem)
> 
> (Again sorry with continue with this).

Don't be sorry, help is part of what this list is for.
I just hope that someone with better LDAP know-how can assist you better
or the above clues give you an idea.


Amos


From squid-user at tlinx.org  Wed Feb 28 02:12:16 2018
From: squid-user at tlinx.org (L A Walsh)
Date: Tue, 27 Feb 2018 18:12:16 -0800
Subject: [squid-users] help with the error TCP_MISS_ABORTED/000
In-Reply-To: <CADZCxsu1rsiwMO3KVST8JBFJvyYSvyfqZ76=PD3Tn5F_sotfKA@mail.gmail.com>
References: <CADZCxsu1rsiwMO3KVST8JBFJvyYSvyfqZ76=PD3Tn5F_sotfKA@mail.gmail.com>
Message-ID: <5A961000.8060902@tlinx.org>

Juan Manuel P wrote:
> I am using Squid Cache: Version 3.5.12, but some pages give me the 
> next error:
>
> 1/Feb/2018:18:14:40 -0300 || - || 10.12.43.20 || 
> TCP_MISS_ABORTED/000|| GET || 
> http://www.rionegro.gov.ar/download/images/00033494.jpg 
> <http://www.rionegro.gov.ar/download/images/00033494.jpg> || -
----
    I don't know what causes it, but I see it frequently and have for a few
years.  Currently am running 3.15.3.  Was told it might be due to some
cache corruption -- but having removed it several times over the past
few years, I sorta doubt that.  Also, I'm attempting https interception, now
but wasn't when I first encountered this message...

    Out of last 5000 requests in my squid log, I see 101 of the miss_aborted
statuses.  I just wrote a note on stackexchange, then went to look for
something on amazon (this is output from a squid log compression tool
that was mostly for listing site, request time and size:  A few lines
from no more than 15 minutes ago (usually shows time between requests, but
periodically, there's a full timestamp)...

    Part of my shortening process removes the TCP_ before error messages,
thus my error is just "MISS_ABORTED".

Since this is a grep of that shortened log, the time increments since
last message are not referring to line immediately above in the grep:


[0227_172940.00]  379ms; 0    (0/0) MISS_ABORTED/000 <Athenae [GET 
https://qa.sockets.stackexchange.com/ - 198.252.206.25 -]
  +0.38   372ms; 0    (0/0) MISS_ABORTED/000 <Athenae [GET  
https://qa.sockets.stackexchange.com/ - 198.252.206.25 -]
  +0.01     1ms; 0    (0/0) MISS_ABORTED/000 <Athenae [GET 
https://images-na.ssl-images-amazon.com/images/I/61x0MG3xpeL._AC_UL160_SR160,160_.jpg 
- 54.230.117.34 -]
  +0.00     0ms; 0    (-/-) MISS_ABORTED/000 <Athenae [GET 
https://images-na.ssl-images-amazon.com/images/I/813zL5eetaL._AC_UL160_SR160,160_.jpg 
- 54.230.117.34 -]
  +0.00     0ms; 0    (-/-) MISS_ABORTED/000 <Athenae [GET 
https://images-na.ssl-images-amazon.com/images/I/61Uo2hXZlpL._AC_UL160_SR160,160_.jpg 
- 54.230.117.34 -]
  +0.00     0ms; 0    (-/-) MISS_ABORTED/000 <Athenae [GET 
https://images-na.ssl-images-amazon.com/images/I/71XggjYZ7qL._AC_UL160_SR160,160_.jpg 
- 54.230.117.34 -]
  +0.00     1ms; 0    (-/0) MISS_ABORTED/000 <Athenae [GET 
https://images-na.ssl-images-amazon.com/images/I/71LT8PAs-OL._AC_UL160_SR160,160_.jpg 
- 54.230.117.34 -]
  +0.00     1ms; 0    (-/0) MISS_ABORTED/000 <Athenae [GET 
https://images-na.ssl-images-amazon.com/images/I/51X+70QICxL._AC_UL160_SR160,160_.jpg 
- 54.230.117.34 -]
[0227_173215.00]   16ms; 0    (0/0) MISS_ABORTED/000 <Athenae [GET 
https://www.amazon.com/gp/uedata?ul&v=0.200071.0&id=TXSV6J9MMKFJ764232PB&ctb=1&m=1&sc=TXSV6J9MMKFJ764232PB&pc=3758697&tc=-286&hob=1&hoe=3&ul=3758697&t=1519781535329&csmtags=mouseHit&pty=Detail&spty=Glance&pti=B079GH97R9&tid=TXSV6J9MMKFJ764232PB&aftb=1 
- 23.192.244.68 -]
====================================


Of note -- a bunch were in trying to fetch a sockets address on 
stackexchange, , while most of the amazon lines seem to be referring to 
jpgs.  Anyway, I too would be interested if you find the answer.

Just thought I'd mention that your seeing the message isn't unique.

Found someone else who asked the same question back in May 2015...




From squid3 at treenet.co.nz  Wed Feb 28 04:00:29 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 28 Feb 2018 17:00:29 +1300
Subject: [squid-users] help with the error TCP_MISS_ABORTED/000
In-Reply-To: <5A961000.8060902@tlinx.org>
References: <CADZCxsu1rsiwMO3KVST8JBFJvyYSvyfqZ76=PD3Tn5F_sotfKA@mail.gmail.com>
 <5A961000.8060902@tlinx.org>
Message-ID: <e4446d00-7905-94c7-f7a8-0ca7b97400d3@treenet.co.nz>

On 28/02/18 15:12, L A Walsh wrote:
> Juan Manuel P wrote:
>> I am using Squid Cache: Version 3.5.12, but some pages give me the
>> next error:
>>
>> 1/Feb/2018:18:14:40 -0300 || - || 10.12.43.20 ||
>> TCP_MISS_ABORTED/000|| GET ||
>> http://www.rionegro.gov.ar/download/images/00033494.jpg
>> <http://www.rionegro.gov.ar/download/images/00033494.jpg> || -
> ----
> ?? I don't know what causes it, but I see it frequently and have for a few
> years.? Currently am running 3.15.3.? Was told it might be due to some

Er, which version exactly?

> cache corruption -- but having removed it several times over the past
> few years, I sorta doubt that.? Also, I'm attempting https interception,
> now
> but wasn't when I first encountered this message...

It can come from many reasons. One has to look at all the clues about
where the message came from, which (if any) server was involved, how
long it took, etc.

I could write a book on the things and ways it *might* happen. But
whether any of that is relevant or just hand-wavey ideas is anyones
guess at present.


>From what I know about it currently; corruption HTTP cache entries might
be a side-effect, but very unlikely to be a cause of this.

Other types of caches used by Squid may be involved, eg the DNS cache
pointing Squid to a server IP that is not responding. But I don't recall
any instances of that data being corrupted, and the duration of the
transaction is far too short to have been some kind of timeout on the
server side of things (immediate TCP reject from invalid server IPs
shows up completely differently.)


* ABORTED almost always means the client[1] disconnected from the TCP
connection. That can happen for any number of reasons at the TCP, IP and
Ethernet layers which Squid is not party to.

... emphasis on "almost". In the case of CONNECT messages and NTLM
Pinned connections the server can also trigger disconnect for both
endpoints.


* HTTPS introduces several additional possible causes. Primarily that
CONNECT message server abort just mentioned. But also if SSL-Bump is
being done, any TLS errors that result in "terminate" action will also
show up as aborts at the TCP and HTTP(S) layers. Squid logging of those
cases has been a bit buggy and there may be issues still yet to be found
there.
 That does not explain the pre-HTTPS occurances. But also due to the
vague nature of the abort reason those earlier aborts may be completely
different in cause from your current ones.


The "/000" status means no HTTP reply was received from a server. Abort
can also happen any time *after* a server response is received, but
those should be logged with their status codes not 000.
 - That may be because no server was even contacted. ie the client
disconnected immediately, or during the wait for server DNS records to
arrive, or for any other reason the client has.


SSL-Bump clouds the issue a lot because it will naturally time some
amount of time to do any of its checks and any server contact for server
cert details etc. Again the client can disconnect for any number of
reasons during all that, with the same ABORTED/000 end result.


So. Maybe bug, maybe not. "insufficient data".


> 
> ?? Out of last 5000 requests in my squid log, I see 101 of the miss_aborted
> statuses.? I just wrote a note on stackexchange, then went to look for
> something on amazon (this is output from a squid log compression tool
> that was mostly for listing site, request time and size:? A few lines
> from no more than 15 minutes ago (usually shows time between requests, but
> periodically, there's a full timestamp)...
> 
> ?? Part of my shortening process removes the TCP_ before error messages,
> thus my error is just "MISS_ABORTED".
> 
> Since this is a grep of that shortened log, the time increments since
> last message are not referring to line immediately above in the grep:
> 
> 
> [0227_172940.00]? 379ms; 0??? (0/0) MISS_ABORTED/000 <Athenae [GET
> https://qa.sockets.stackexchange.com/ - 198.252.206.25 -]
> ?+0.38?? 372ms; 0??? (0/0) MISS_ABORTED/000 <Athenae [GET?
> https://qa.sockets.stackexchange.com/ - 198.252.206.25 -]
> ?+0.01???? 1ms; 0??? (0/0) MISS_ABORTED/000 <Athenae [GET
> https://images-na.ssl-images-amazon.com/images/I/61x0MG3xpeL._AC_UL160_SR160,160_.jpg
> - 54.230.117.34 -]
> ?+0.00???? 0ms; 0??? (-/-) MISS_ABORTED/000 <Athenae [GET
> https://images-na.ssl-images-amazon.com/images/I/813zL5eetaL._AC_UL160_SR160,160_.jpg
> - 54.230.117.34 -]
> ?+0.00???? 0ms; 0??? (-/-) MISS_ABORTED/000 <Athenae [GET
> https://images-na.ssl-images-amazon.com/images/I/61Uo2hXZlpL._AC_UL160_SR160,160_.jpg
> - 54.230.117.34 -]
> ?+0.00???? 0ms; 0??? (-/-) MISS_ABORTED/000 <Athenae [GET
> https://images-na.ssl-images-amazon.com/images/I/71XggjYZ7qL._AC_UL160_SR160,160_.jpg
> - 54.230.117.34 -]
> ?+0.00???? 1ms; 0??? (-/0) MISS_ABORTED/000 <Athenae [GET
> https://images-na.ssl-images-amazon.com/images/I/71LT8PAs-OL._AC_UL160_SR160,160_.jpg
> - 54.230.117.34 -]
> ?+0.00???? 1ms; 0??? (-/0) MISS_ABORTED/000 <Athenae [GET
> https://images-na.ssl-images-amazon.com/images/I/51X+70QICxL._AC_UL160_SR160,160_.jpg
> - 54.230.117.34 -]
> [0227_173215.00]?? 16ms; 0??? (0/0) MISS_ABORTED/000 <Athenae [GET
> https://www.amazon.com/gp/uedata?ul&v=0.200071.0&id=TXSV6J9MMKFJ764232PB&ctb=1&m=1&sc=TXSV6J9MMKFJ764232PB&pc=3758697&tc=-286&hob=1&hoe=3&ul=3758697&t=1519781535329&csmtags=mouseHit&pty=Detail&spty=Glance&pti=B079GH97R9&tid=TXSV6J9MMKFJ764232PB&aftb=1
> - 23.192.244.68 -]
> ====================================
> 
> 
> Of note -- a bunch were in trying to fetch a sockets address on
> stackexchange, , while most of the amazon lines seem to be referring to
> jpgs.? Anyway, I too would be interested if you find the answer.

If anyone seeing these is up for some detective work I'm interested in
whether there is any kind of pattern for the real timing between those
lines, and between a failure and previous/next successful transaction to
the same server.
 Bonus points for getting the info with port numbers to see if there is
a pattern hidden in the client connection state.


While its nice to know the frequency is decreasing (IIRC first reporters
had unpleasantly large amounts, now to this ~2% of yours) that does not
really tell much of use for resolving it (or 'them' if multiple issues).


> 
> Just thought I'd mention that your seeing the message isn't unique.
> 
> Found someone else who asked the same question back in May 2015...
> 

Nod. It has been cropping up since the ABORTED log tag was first added,
and "000" status since long before that.

Amos


From squid3 at treenet.co.nz  Wed Feb 28 04:17:07 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 28 Feb 2018 17:17:07 +1300
Subject: [squid-users] squid -k rec ,
	seems has problem with ram leakage ?
In-Reply-To: <031701d3ac05$182861f0$487925d0$@ngtech.co.il>
References: <532D4976-2EE6-462D-8DDC-B6B3A45F004D@netstream.ps>
 <8db1e241-f781-933b-a538-e8425c61bf2f@treenet.co.nz>
 <DB1EBECE-16DA-4432-B8AA-D2C17401D16E@netstream.ps>
 <031701d3ac05$182861f0$487925d0$@ngtech.co.il>
Message-ID: <f01728ad-8c2b-06db-e7da-a28e5f6ba2c1@treenet.co.nz>

On 23/02/18 06:46, Eliezer Croitoru wrote:
> Hey Ahmad,
> 
> I?m not sure I understand what 100 instances of squid means?


IIRC, he is using the Squid "-n" feature.

You may know it as "multi-tenant". Running multiple of the "Squid
instance" as defined at
<https://wiki.squid-cache.org/Features/SmpScale#Terminology> within the
same OS environment.


( "${service_name}" usage in this thread squid.conf is the big clue
here. But I am basing my IIRC on older threads across the last year when
he was asking for help on how to set it up. )


Amos


From eliezer at ngtech.co.il  Wed Feb 28 05:55:59 2018
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Wed, 28 Feb 2018 07:55:59 +0200
Subject: [squid-users] squid -k rec ,
	seems has problem with ram leakage ?
In-Reply-To: <f01728ad-8c2b-06db-e7da-a28e5f6ba2c1@treenet.co.nz>
References: <532D4976-2EE6-462D-8DDC-B6B3A45F004D@netstream.ps>
 <8db1e241-f781-933b-a538-e8425c61bf2f@treenet.co.nz>
 <DB1EBECE-16DA-4432-B8AA-D2C17401D16E@netstream.ps>
 <031701d3ac05$182861f0$487925d0$@ngtech.co.il>
 <f01728ad-8c2b-06db-e7da-a28e5f6ba2c1@treenet.co.nz>
Message-ID: <0f5801d3b058$cef9bbc0$6ced3340$@ngtech.co.il>

Thanks Amos,

It might not be my place to say a word but 100 instances on a single machine can only be good for specific cases which he might have under his hands.

I believe that in such cases on the long term he might need a better solution but it's not my place to lectures anyone.

Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: eliezer at ngtech.co.il



-----Original Message-----
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Amos Jeffries
Sent: Wednesday, February 28, 2018 06:17
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] squid -k rec , seems has problem with ram leakage ?

On 23/02/18 06:46, Eliezer Croitoru wrote:
> Hey Ahmad,
> 
> I?m not sure I understand what 100 instances of squid means?


IIRC, he is using the Squid "-n" feature.

You may know it as "multi-tenant". Running multiple of the "Squid
instance" as defined at
<https://wiki.squid-cache.org/Features/SmpScale#Terminology> within the
same OS environment.


( "${service_name}" usage in this thread squid.conf is the big clue
here. But I am basing my IIRC on older threads across the last year when
he was asking for help on how to set it up. )


Amos
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From wehategrey at gmail.com  Wed Feb 28 08:30:54 2018
From: wehategrey at gmail.com (Grey)
Date: Wed, 28 Feb 2018 01:30:54 -0700 (MST)
Subject: [squid-users] Proxy hierarchy and FTP access
Message-ID: <1519806654069-0.post@n4.nabble.com>

Hi guys,
I'm setting up a new infrastructure for my web proxy and I'm having a
problem with FTP access to the internet; I'm running Squid 3.5 on Debian 9
machines by the way.

I used to have a single Squid machine talking freely to the internet from
inside the LAN, with clients connecting on port 3128 for HTTP request and 21
for FTP using FileZilla with "FTP proxy" options enabled.
The relevant part of my Squid configuration is the following, and everything
worked like a charm:

ftp_port 21
acl FTP proto FTP
acl siti_ftp dstdomain "/etc/squid/ftp_sites"
http_access allow FTP ftp_sites

Then for security purposes I've set up a second Squid machine, in our DMZ,
to act as a cache parent for the LAN machine, but now FTP only works through
a browser; I've tried enabling the ftp_port directive on the parent machine,
disabling it in the LAN one and a bunch of other stuff but nothing seems to
be working.
For reference, the parent grants access to the chil proxy thanks to this
setting:

acl child_proxy src 10.9.10.X/32
http_access allow child_proxy

At this point, I'd like to know if what I'm trying to do is possible at all,
beacuse I'm starting to think there's something major I've totally
overlooked.
Thanks a lot to anyone willing to help :)



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From jascha.sticher at tds.fujitsu.com  Wed Feb 28 10:06:51 2018
From: jascha.sticher at tds.fujitsu.com (Sticher, Jascha)
Date: Wed, 28 Feb 2018 10:06:51 +0000
Subject: [squid-users] Proxy hierarchy and FTP access
In-Reply-To: <1519806654069-0.post@n4.nabble.com>
References: <1519806654069-0.post@n4.nabble.com>
Message-ID: <E286ADE35F919742812E3076A36122E701BFCA7637@tdsnsumbx2vp>

Hi,

> I'm setting up a new infrastructure for my web proxy and I'm having a
> problem with FTP access to the internet; I'm running Squid 3.5 on Debian 9
> machines by the way.
>
> I used to have a single Squid machine talking freely to the internet from
> inside the LAN, with clients connecting on port 3128 for HTTP request and 21
> for FTP using FileZilla with "FTP proxy" options enabled.
> The relevant part of my Squid configuration is the following, and everything
> worked like a charm:
>
> ftp_port 21
> acl FTP proto FTP
> acl siti_ftp dstdomain "/etc/squid/ftp_sites"
> http_access allow FTP ftp_sites
>
> Then for security purposes I've set up a second Squid machine, in our DMZ,
> to act as a cache parent for the LAN machine, but now FTP only works
> through
> a browser; I've tried enabling the ftp_port directive on the parent machine,
> disabling it in the LAN one and a bunch of other stuff but nothing seems to
> be working.

This is exactly my setup right there and I came with the same question to this mailing list.

Sadly, the is no support for an explicit FTP-forwarding proxy at the moment and no development to implement this as far as I know.

> For reference, the parent grants access to the chil proxy thanks to this
> setting:
> acl child_proxy src 10.9.10.X/32
> http_access allow child_proxy

This is for HTTP-Pakets only. When using FTP via the browser you are actually using ftp over http, which uses the 3128 port on your client-side proxy.

When using a FTP client with a FTP proxy you are connecting via native FTP, which does not use the cache_peer settings (as those only support HTTP messages) I'm guessing
you use to access the parent proxy.

See http://squid-web-proxy-cache.1019090.n4.nabble.com/FTP-proxy-chain-with-native-ftp-td4684366.html for the suggested workarounds from my thread.


Kind regards,

Jascha


>
Erleben Sie Industrie 4.0 konkret ? auf der HANNOVER MESSE.
Vom 23. bis 27. April 2018.
www.fujitsu.com/de/microsite/hmi/register/index.html?utm_source=Email&utm_medium=Signature%20EMail&utm_campaign=HANNOVER%20MESSE%20DE&utm_term=&utm_content=Ticket-anfordern

-----Urspr?ngliche Nachricht-----
> Von: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] Im
> Auftrag von Grey
> Gesendet: Mittwoch, 28. Februar 2018 09:31
> An: squid-users at lists.squid-cache.org
> Betreff: [squid-users] Proxy hierarchy and FTP access
>
> Hi guys,
>
>
> At this point, I'd like to know if what I'm trying to do is possible at all,
> beacuse I'm starting to think there's something major I've totally
> overlooked.
> Thanks a lot to anyone willing to help :)
>
>
>
> --
> Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-
> Users-f1019091.html
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

From squid3 at treenet.co.nz  Wed Feb 28 10:10:48 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 28 Feb 2018 23:10:48 +1300
Subject: [squid-users] Proxy hierarchy and FTP access
In-Reply-To: <1519806654069-0.post@n4.nabble.com>
References: <1519806654069-0.post@n4.nabble.com>
Message-ID: <0311f3df-3ce2-e7b7-3aad-7574171c089e@treenet.co.nz>

On 28/02/18 21:30, Grey wrote:
> 
> At this point, I'd like to know if what I'm trying to do is possible at all,
> beacuse I'm starting to think there's something major I've totally
> overlooked.


The most obvious thing is that the port 3128 is an *HTTP* port, so when
the Browser is using that port it is using HTTP protocol to

 a) request that Squid perform all the FTP things and deliver the result
as an HTTP response, or

 b) create tunnels through the proxy to the relevant FTP IP:port of the
origin servers.


By comparison the ftp_port receives FTP protocol natively. Squid is
mapping that FTP protocol messages into HTTP and handling the mapped
requests.

IIRC these mapping requests are only handling internally by the same
Squid that created them. The outgoing is mapped back to FTP for the
server contact. I used to think those requests could go to a cache_peer,
but Alex indicated recently that they do not.

It is technically possible to be done with a few additions to Squid. But
those additions are not present in any current version.

Amos


From wehategrey at gmail.com  Wed Feb 28 10:58:45 2018
From: wehategrey at gmail.com (Grey)
Date: Wed, 28 Feb 2018 03:58:45 -0700 (MST)
Subject: [squid-users] Proxy hierarchy and FTP access
In-Reply-To: <1519806654069-0.post@n4.nabble.com>
References: <1519806654069-0.post@n4.nabble.com>
Message-ID: <1519815525147-0.post@n4.nabble.com>

Thanks for the replies guys!
I'm sorry Jascha but the suggestions you got in your thead went kind of over
my head, can I ask you if and how you "do allow the front-end Squid to
re-FTP the traffic to the appropriate server then intercept it independently
into the backend with its own ftp_port accepting the "native FTP" coming out
of the frontend"?
If that's a "technically possible only" suggestion, I guess my only
alternative is to let my FileZilla client connect directly to my DMZ Squid
machine and do the ACL stuff there, right?



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From squid3 at treenet.co.nz  Wed Feb 28 12:28:57 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 1 Mar 2018 01:28:57 +1300
Subject: [squid-users] Proxy hierarchy and FTP access
In-Reply-To: <1519815525147-0.post@n4.nabble.com>
References: <1519806654069-0.post@n4.nabble.com>
 <1519815525147-0.post@n4.nabble.com>
Message-ID: <04acaae4-e510-94e1-8ff1-9d24d3a39bf5@treenet.co.nz>

On 28/02/18 23:58, Grey wrote:
> Thanks for the replies guys!
> I'm sorry Jascha but the suggestions you got in your thead went kind of over
> my head, can I ask you if and how you "do allow the front-end Squid to
> re-FTP the traffic to the appropriate server then intercept it independently
> into the backend with its own ftp_port accepting the "native FTP" coming out
> of the frontend"?

With the ftp_port feature the client essentially thinks it is talking to
an FTP server.

The point of the idea was to have your frontend Squid thinking its
talking to the origin, when actually its connections are being sent to
the backend Squid.

Much like most NAT systems do for FTP already.


> If that's a "technically possible only" suggestion, I guess my only
> alternative is to let my FileZilla client connect directly to my DMZ Squid
> machine and do the ACL stuff there, right?

The suggestion was "technically possibly only" at the time simply
because it was an idea I had. Nobody has actually tried do it and
reported the results AFAIK.

Amos


From jascha.sticher at tds.fujitsu.com  Wed Feb 28 12:32:32 2018
From: jascha.sticher at tds.fujitsu.com (Sticher, Jascha)
Date: Wed, 28 Feb 2018 12:32:32 +0000
Subject: [squid-users] Proxy hierarchy and FTP access
In-Reply-To: <1519815525147-0.post@n4.nabble.com>
References: <1519806654069-0.post@n4.nabble.com>
 <1519815525147-0.post@n4.nabble.com>
Message-ID: <E286ADE35F919742812E3076A36122E701BFCA766A@tdsnsumbx2vp>

Hi,

> I'm sorry Jascha but the suggestions you got in your thead went kind of over
> my head, can I ask you if and how you "do allow the front-end Squid to
> re-FTP the traffic to the appropriate server then intercept it independently
> into the backend with its own ftp_port accepting the "native FTP" coming out
> of the frontend"?

Please see https://wiki.squid-cache.org/SquidFaq/InterceptionProxy for an overview of the interception proxy concept.

Basically, you need to route the FTP-Traffic from your client-side proxy to the DMZ-proxy. I'm not sure on how well this will work with FTP, because of its dual-connection nature.
According to the squid FAQ it is not supported, but there are several FTP-helpers which could make this work. I haven't tried that solution either,
because we can't change our design that way without breaking production traffic. Googling

> If that's a "technically possible only" suggestion, I guess my only
> alternative is to let my FileZilla client connect directly to my DMZ Squid
> machine and do the ACL stuff there, right?

We are currently using the "frox" FTP proxy on our client-side proxy server. This software does support an FTP-Upstream proxy, but has not been maintained for a few years now.
It is not available in the official Debian repositories (since Wheezy, IIRC). If you don't want to use this, you need to allow your users to the DMZ proxy.

On the other hand, FileZilla does support an HTTP proxy (you need to allow CONNECT for the FTP target ports though).


Kind regards,

Jascha


Erleben Sie Industrie 4.0 konkret ? auf der HANNOVER MESSE.
Vom 23. bis 27. April 2018.
www.fujitsu.com/de/microsite/hmi/register/index.html?utm_source=Email&utm_medium=Signature%20EMail&utm_campaign=HANNOVER%20MESSE%20DE&utm_term=&utm_content=Ticket-anfordern


From jmpatagonia at gmail.com  Wed Feb 28 13:07:26 2018
From: jmpatagonia at gmail.com (Juan Manuel P)
Date: Wed, 28 Feb 2018 10:07:26 -0300
Subject: [squid-users] help with the error TCP_MISS_ABORTED/000
In-Reply-To: <e4446d00-7905-94c7-f7a8-0ca7b97400d3@treenet.co.nz>
References: <CADZCxsu1rsiwMO3KVST8JBFJvyYSvyfqZ76=PD3Tn5F_sotfKA@mail.gmail.com>
 <5A961000.8060902@tlinx.org>
 <e4446d00-7905-94c7-f7a8-0ca7b97400d3@treenet.co.nz>
Message-ID: <CADZCxsvhi1=oSqoz1HhTa4Kh3NLtG_MqztXbo=HaiFMnbEdooA@mail.gmail.com>

Amos, tell me what more you need to analyze the incident.

Every time that I access to this  http://www.rionegro.gov.ar
<http://www.rionegro.gov.ar/download/images/00033494.jpg> I have the error
TCP_MISS_ABORTED/000, but also if  access to ssl version
https://www.rionegro.gov.ar
the error NOT occur.
<http://www.rionegro.gov.ar/download/images/00033494.jpg>

regards.


<http://www.rionegro.gov.ar/download/images/00033494.jpg>

2018-02-28 1:00 GMT-03:00 Amos Jeffries <squid3 at treenet.co.nz>:

> On 28/02/18 15:12, L A Walsh wrote:
> > Juan Manuel P wrote:
> >> I am using Squid Cache: Version 3.5.12, but some pages give me the
> >> next error:
> >>
> >> 1/Feb/2018:18:14:40 -0300 || - || 10.12.43.20 ||
> >> TCP_MISS_ABORTED/000|| GET ||
> >> http://www.rionegro.gov.ar/download/images/00033494.jpg
> >> <http://www.rionegro.gov.ar/download/images/00033494.jpg> || -
> > ----
> >    I don't know what causes it, but I see it frequently and have for a
> few
> > years.  Currently am running 3.15.3.  Was told it might be due to some
>
> Er, which version exactly?
>
> > cache corruption -- but having removed it several times over the past
> > few years, I sorta doubt that.  Also, I'm attempting https interception,
> > now
> > but wasn't when I first encountered this message...
>
> It can come from many reasons. One has to look at all the clues about
> where the message came from, which (if any) server was involved, how
> long it took, etc.
>
> I could write a book on the things and ways it *might* happen. But
> whether any of that is relevant or just hand-wavey ideas is anyones
> guess at present.
>
>
> From what I know about it currently; corruption HTTP cache entries might
> be a side-effect, but very unlikely to be a cause of this.
>
> Other types of caches used by Squid may be involved, eg the DNS cache
> pointing Squid to a server IP that is not responding. But I don't recall
> any instances of that data being corrupted, and the duration of the
> transaction is far too short to have been some kind of timeout on the
> server side of things (immediate TCP reject from invalid server IPs
> shows up completely differently.)
>
>
> * ABORTED almost always means the client[1] disconnected from the TCP
> connection. That can happen for any number of reasons at the TCP, IP and
> Ethernet layers which Squid is not party to.
>
> ... emphasis on "almost". In the case of CONNECT messages and NTLM
> Pinned connections the server can also trigger disconnect for both
> endpoints.
>
>
> * HTTPS introduces several additional possible causes. Primarily that
> CONNECT message server abort just mentioned. But also if SSL-Bump is
> being done, any TLS errors that result in "terminate" action will also
> show up as aborts at the TCP and HTTP(S) layers. Squid logging of those
> cases has been a bit buggy and there may be issues still yet to be found
> there.
>  That does not explain the pre-HTTPS occurances. But also due to the
> vague nature of the abort reason those earlier aborts may be completely
> different in cause from your current ones.
>
>
> The "/000" status means no HTTP reply was received from a server. Abort
> can also happen any time *after* a server response is received, but
> those should be logged with their status codes not 000.
>  - That may be because no server was even contacted. ie the client
> disconnected immediately, or during the wait for server DNS records to
> arrive, or for any other reason the client has.
>
>
> SSL-Bump clouds the issue a lot because it will naturally time some
> amount of time to do any of its checks and any server contact for server
> cert details etc. Again the client can disconnect for any number of
> reasons during all that, with the same ABORTED/000 end result.
>
>
> So. Maybe bug, maybe not. "insufficient data".
>
>
> >
> >    Out of last 5000 requests in my squid log, I see 101 of the
> miss_aborted
> > statuses.  I just wrote a note on stackexchange, then went to look for
> > something on amazon (this is output from a squid log compression tool
> > that was mostly for listing site, request time and size:  A few lines
> > from no more than 15 minutes ago (usually shows time between requests,
> but
> > periodically, there's a full timestamp)...
> >
> >    Part of my shortening process removes the TCP_ before error messages,
> > thus my error is just "MISS_ABORTED".
> >
> > Since this is a grep of that shortened log, the time increments since
> > last message are not referring to line immediately above in the grep:
> >
> >
> > [0227_172940.00]  379ms; 0    (0/0) MISS_ABORTED/000 <Athenae [GET
> > https://qa.sockets.stackexchange.com/ - 198.252.206.25 -]
> >  +0.38   372ms; 0    (0/0) MISS_ABORTED/000 <Athenae [GET
> > https://qa.sockets.stackexchange.com/ - 198.252.206.25 -]
> >  +0.01     1ms; 0    (0/0) MISS_ABORTED/000 <Athenae [GET
> > https://images-na.ssl-images-amazon.com/images/I/
> 61x0MG3xpeL._AC_UL160_SR160,160_.jpg
> > - 54.230.117.34 -]
> >  +0.00     0ms; 0    (-/-) MISS_ABORTED/000 <Athenae [GET
> > https://images-na.ssl-images-amazon.com/images/I/
> 813zL5eetaL._AC_UL160_SR160,160_.jpg
> > - 54.230.117.34 -]
> >  +0.00     0ms; 0    (-/-) MISS_ABORTED/000 <Athenae [GET
> > https://images-na.ssl-images-amazon.com/images/I/
> 61Uo2hXZlpL._AC_UL160_SR160,160_.jpg
> > - 54.230.117.34 -]
> >  +0.00     0ms; 0    (-/-) MISS_ABORTED/000 <Athenae [GET
> > https://images-na.ssl-images-amazon.com/images/I/
> 71XggjYZ7qL._AC_UL160_SR160,160_.jpg
> > - 54.230.117.34 -]
> >  +0.00     1ms; 0    (-/0) MISS_ABORTED/000 <Athenae [GET
> > https://images-na.ssl-images-amazon.com/images/I/71LT8PAs-
> OL._AC_UL160_SR160,160_.jpg
> > - 54.230.117.34 -]
> >  +0.00     1ms; 0    (-/0) MISS_ABORTED/000 <Athenae [GET
> > https://images-na.ssl-images-amazon.com/images/I/51X+
> 70QICxL._AC_UL160_SR160,160_.jpg
> > - 54.230.117.34 -]
> > [0227_173215.00]   16ms; 0    (0/0) MISS_ABORTED/000 <Athenae [GET
> > https://www.amazon.com/gp/uedata?ul&v=0.200071.0&id=
> TXSV6J9MMKFJ764232PB&ctb=1&m=1&sc=TXSV6J9MMKFJ764232PB&pc=
> 3758697&tc=-286&hob=1&hoe=3&ul=3758697&t=1519781535329&
> csmtags=mouseHit&pty=Detail&spty=Glance&pti=B079GH97R9&
> tid=TXSV6J9MMKFJ764232PB&aftb=1
> > - 23.192.244.68 -]
> > ====================================
> >
> >
> > Of note -- a bunch were in trying to fetch a sockets address on
> > stackexchange, , while most of the amazon lines seem to be referring to
> > jpgs.  Anyway, I too would be interested if you find the answer.
>
> If anyone seeing these is up for some detective work I'm interested in
> whether there is any kind of pattern for the real timing between those
> lines, and between a failure and previous/next successful transaction to
> the same server.
>  Bonus points for getting the info with port numbers to see if there is
> a pattern hidden in the client connection state.
>
>
> While its nice to know the frequency is decreasing (IIRC first reporters
> had unpleasantly large amounts, now to this ~2% of yours) that does not
> really tell much of use for resolving it (or 'them' if multiple issues).
>
>
> >
> > Just thought I'd mention that your seeing the message isn't unique.
> >
> > Found someone else who asked the same question back in May 2015...
> >
>
> Nod. It has been cropping up since the ABORTED log tag was first added,
> and "000" status since long before that.
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180228/8a2eeb04/attachment.htm>

From jmpatagonia at gmail.com  Wed Feb 28 20:36:35 2018
From: jmpatagonia at gmail.com (Juan Manuel P)
Date: Wed, 28 Feb 2018 17:36:35 -0300
Subject: [squid-users] TCP_MISS_ABORTED/000|
Message-ID: <CADZCxsum3Kjq8OLdCfETtTW+Krfhtp9qpjGcCZtKEGYhfE5d1g@mail.gmail.com>

Hello I send more data about the problem.

The problem occur for example on this page (see below). But not occur on
the ssl/https version of the same page.

28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 || TCP_MISS_ABORTED/000||
GET || http://rionegro.gov.ar/media/components/youtubetv/ytv.css || -
28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 || TCP_MISS_ABORTED/000||
GET || http://rionegro.gov.ar/media/components/youtubetv/principal.css || -
28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 || TCP_MISS_ABORTED/000||
GET || http://rionegro.gov.ar/media/components/youtubetv/ytv.js || -
28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 || TCP_MISS_ABORTED/000||
GET || http://rionegro.gov.ar/media/images/disenio/ini_nav.png || -
28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 || TCP_MISS_ABORTED/000||
GET || http://rionegro.gov.ar/download/images/00033645.jpg || -
28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 || TCP_MISS_ABORTED/000||
GET || http://rionegro.gov.ar/download/images/00033644.jpg || -
28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 || TCP_MEM_HIT_ABORTED/200||
GET || http://rionegro.gov.ar/download/banner/00002923.jpg || image/jpeg
28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 || TCP_MISS_ABORTED/000||
GET || http://rionegro.gov.ar/media/images/lema.png || -
28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 || TCP_MISS_ABORTED/000||
GET || http://rionegro.gov.ar/media/images/logomarcarn.png || -
28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 || TCP_MISS_ABORTED/000||
GET || http://rionegro.gov.ar/download/images/00033636.jpg || -


And when the problem occur the page is waiting and slowly until upload
complete.

Later the page upload whitout problem.


I see that the TCP_MISS_ABORTED appear only on some extension file, css,
js, png, jpg. When are waiting for page upload complete this elements or
componentes are not charged but the rest of the page yes. Some time later
all the page is upload.

Regards.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180228/c96a2440/attachment.htm>

From yvoinov at gmail.com  Wed Feb 28 20:46:19 2018
From: yvoinov at gmail.com (Yuri)
Date: Thu, 1 Mar 2018 02:46:19 +0600
Subject: [squid-users] TCP_MISS_ABORTED/000|
In-Reply-To: <CADZCxsum3Kjq8OLdCfETtTW+Krfhtp9qpjGcCZtKEGYhfE5d1g@mail.gmail.com>
References: <CADZCxsum3Kjq8OLdCfETtTW+Krfhtp9qpjGcCZtKEGYhfE5d1g@mail.gmail.com>
Message-ID: <1cd01c76-5dc4-b743-c741-c0c06f58bf25@gmail.com>

Let's look on your server:

?# wget -S http://rionegro.gov.ar/download/images/00033636.jpg
--2018-03-01 02:37:38--? http://rionegro.gov.ar/download/images/00033636.jpg
Connecting to 127.0.0.1:3128... connected.
Proxy request sent, awaiting response...
? HTTP/1.1 200 OK
? Date: Wed, 28 Feb 2018 19:38:03 GMT
? Server: Apache
? Last-Modified: Wed, 28 Feb 2018 16:07:15 GMT
? Accept-Ranges: bytes
? Content-Length: 135872
? Content-Type: image/jpeg
? Age: 979
? X-Cache: HIT from rn-speed-unifix
? X-Cache: MISS from khorne
? X-Cache-Lookup: MISS from khorne:3128
? Connection: keep-alive
Length: 135872 (133K) [image/jpeg]
Saving to: '00033636.jpg'

00033636.jpg??????? 100%[===================>] 132.69K? 2.79KB/s??? in
58s????

2018-03-01 02:38:39 (2.29 KB/s) - '00033636.jpg' saved [135872/135872]

All seems ok. A bit slow downloading - but ok.

May be, this is your regional connectivity issues? For example,
slooooooooooow links, slooooooooooooow DNS, dropped packets, etc.?


01.03.2018 02:36, Juan Manuel P ?????:
>
> Hello I send more data about the problem.
>
> The problem occur for example on this page (see below). But not occur
> on the ssl/https version of the same page.
>
> 28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 ||
> TCP_MISS_ABORTED/000|| GET ||
> http://rionegro.gov.ar/media/components/youtubetv/ytv.css || -
> 28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 ||
> TCP_MISS_ABORTED/000|| GET ||
> http://rionegro.gov.ar/media/components/youtubetv/principal.css || -
> 28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 ||
> TCP_MISS_ABORTED/000|| GET ||
> http://rionegro.gov.ar/media/components/youtubetv/ytv.js || -
> 28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 ||
> TCP_MISS_ABORTED/000|| GET ||
> http://rionegro.gov.ar/media/images/disenio/ini_nav.png || -
> 28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 ||
> TCP_MISS_ABORTED/000|| GET ||
> http://rionegro.gov.ar/download/images/00033645.jpg || -
> 28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 ||
> TCP_MISS_ABORTED/000|| GET ||
> http://rionegro.gov.ar/download/images/00033644.jpg || -
> 28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 ||
> TCP_MEM_HIT_ABORTED/200|| GET ||
> http://rionegro.gov.ar/download/banner/00002923.jpg || image/jpeg
> 28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 ||
> TCP_MISS_ABORTED/000|| GET ||
> http://rionegro.gov.ar/media/images/lema.png || -
> 28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 ||
> TCP_MISS_ABORTED/000|| GET ||
> http://rionegro.gov.ar/media/images/logomarcarn.png || -
> 28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 ||
> TCP_MISS_ABORTED/000|| GET ||
> http://rionegro.gov.ar/download/images/00033636.jpg || -
>
>
> And when the problem occur the page is waiting and slowly until upload
> complete.
>
> Later the page upload whitout problem.
>
>
> I see that the TCP_MISS_ABORTED appear only on some extension file,
> css, js, png, jpg. When are waiting for page upload complete this
> elements or componentes are not charged but the rest of the page yes.
> Some time later all the page is upload.
>
> Regards.
>
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-- 
*****************************
* C++20 : Bug to the future *
*****************************

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180301/a26f771a/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180301/a26f771a/attachment.sig>

From jmpatagonia at gmail.com  Wed Feb 28 20:55:05 2018
From: jmpatagonia at gmail.com (Juan Manuel P)
Date: Wed, 28 Feb 2018 17:55:05 -0300
Subject: [squid-users] TCP_MISS_ABORTED/000|
In-Reply-To: <1cd01c76-5dc4-b743-c741-c0c06f58bf25@gmail.com>
References: <CADZCxsum3Kjq8OLdCfETtTW+Krfhtp9qpjGcCZtKEGYhfE5d1g@mail.gmail.com>
 <1cd01c76-5dc4-b743-c741-c0c06f58bf25@gmail.com>
Message-ID: <CADZCxsssUjxNuckCJ5j4bZsgd8zSrYchWKrpOkpkgxkOQ9os0g@mail.gmail.com>

Hello Yuri today on access.log a get a lot off TCP_MISS_ABORTED/000 on many
diferentes sites:

28/Feb/2018:13:50:00 -0300 || - || 10.15.43.31 || TCP_MISS_ABORTED/000||
GET ||
http://loprincipal.com.ar/wp-content/plugins/wp-facebook-live-video/inc/style.css?
|| -
28/Feb/2018:13:50:00 -0300 || - || 10.15.43.31 || TCP_MISS_ABORTED/000||
GET ||
http://loprincipal.com.ar/wp-content/plugins/wp-facebook-live-video/inc/script.js?
|| -
28/Feb/2018:13:53:37 -0300 || - || 10.15.43.31 || TCP_MISS_ABORTED/000||
POST || http://m.addthis.com/live/red_lojson/100eng.json? || -
28/Feb/2018:13:54:09 -0300 || - || 10.15.43.31 || TCP_MISS_ABORTED/000||
POST || http://m.addthis.com/live/red_lojson/100eng.json? || -
28/Feb/2018:14:04:19 -0300 || - || 10.14.43.147 || TCP_MISS_ABORTED/000||
POST || http://m.addthis.com/live/red_lojson/100eng.json? || -
28/Feb/2018:14:04:19 -0300 || - || 10.14.43.147 || TCP_MISS_ABORTED/000||
POST || http://m.addthis.com/live/red_lojson/100eng.json? || -
28/Feb/2018:14:07:56 -0300 || - || 10.14.43.88 || TCP_MISS_ABORTED/000||
GET ||
http://ocsp2.globalsign.com/gsextendvalsha2g2/ME0wSzBJMEcwRTAJBgUrDgMCGgUABBRYCCQuHbjl0T2z%2Bv2quSEm8NK1fgQU2kB3Q2Uc%2BP6n4%2FRkgj5NQxMiMQICDGPo4Vlu6pcIoIq7tA%3D%3D
|| -
28/Feb/2018:14:08:11 -0300 || - || 10.14.43.88 || TCP_MISS_ABORTED/000||
GET || http://crl.globalsign.com/gs/gsextendvalsha2g2.crl || -
28/Feb/2018:14:11:56 -0300 || - || 10.15.43.30 || TCP_MISS_ABORTED/000||
GET || http://ipv6.msftncsi.com/ncsi.txt || -
28/Feb/2018:14:30:13 -0300 || - || 10.14.43.101 || TCP_MISS_ABORTED/000||
GET || http://www.bancopatagonia.com/comunes/imas/facebook.jpg || -
28/Feb/2018:14:30:13 -0300 || - || 10.14.43.101 || TCP_MISS_ABORTED/000||
GET || http://www.bancopatagonia.com/comunes/imas/youtube.jpg || -
28/Feb/2018:14:30:13 -0300 || - || 10.14.43.101 || TCP_MISS_ABORTED/000||
GET || http://www.bancopatagonia.com/personas/imas/dest_espectaculos.jpg ||
-
28/Feb/2018:14:30:13 -0300 || - || 10.14.43.101 || TCP_MISS_ABORTED/000||
GET || http://www.bancopatagonia.com/comunes/imas/img_youtube.gif || -
28/Feb/2018:14:30:13 -0300 || - || 10.14.43.101 || TCP_MISS_ABORTED/000||
GET || http://www.bancopatagonia.com/comunes/imas/facebook-pie.jpg || -
28/Feb/2018:15:13:48 -0300 || - || 10.14.43.162 || TCP_MISS_ABORTED/000||
POST || http://ocsp.usertrust.com/ || -
28/Feb/2018:15:34:18 -0300 || - || 10.14.43.77 || TCP_MISS_ABORTED/000||
GET ||
http://search.it.online.fr/covers/wp-content/Milo_Manara,_in_Giuseppe_Bergman,_2005_(Manet).jpg
|| -
28/Feb/2018:15:51:21 -0300 || - || 10.14.43.162 || TCP_MISS_ABORTED/000||
GET || http://csi.gstatic.com/csi? || -
28/Feb/2018:15:51:22 -0300 || - || 10.14.43.162 || TCP_MISS_ABORTED/404||
GET ||
http://www.snehashish.com/wp-content/themes/computers/images/slide-left.png
|| text/html
28/Feb/2018:15:52:42 -0300 || - || 10.14.43.159 || TCP_MISS_ABORTED/000||
GET || http://www.bancopatagonia.com.ar/personas/imas/dest_espectaculos.jpg
|| -
28/Feb/2018:15:52:42 -0300 || - || 10.14.43.159 || TCP_MISS_ABORTED/000||
GET || http://www.bancopatagonia.com.ar/comunes/imas/facebook.jpg || -
28/Feb/2018:15:52:42 -0300 || - || 10.14.43.159 || TCP_MISS_ABORTED/000||
GET || http://www.bancopatagonia.com.ar/comunes/imas/img_youtube.gif || -
28/Feb/2018:15:52:42 -0300 || - || 10.14.43.159 || TCP_MISS_ABORTED/000||
GET || http://www.bancopatagonia.com.ar/comunes/imas/facebook-pie.jpg || -
28/Feb/2018:15:52:42 -0300 || - || 10.14.43.159 || TCP_MISS_ABORTED/000||
GET || http://www.bancopatagonia.com.ar/comunes/imas/youtube.jpg || -
28/Feb/2018:16:18:53 -0300 || - || 192.168.43.57 || TCP_MISS_ABORTED/000||
GET ||
http://loprincipal.com.ar/wp-content/plugins/wp-facebook-live-video/inc/script.js?
|| -
28/Feb/2018:16:18:53 -0300 || - || 192.168.43.57 || TCP_MISS_ABORTED/000||
GET ||
http://loprincipal.com.ar/wp-content/plugins/wp-facebook-live-video/inc/style.css?
|| -

I thinking the problem is not in squid, maybe DNS or something similar.

regards.


2018-02-28 17:46 GMT-03:00 Yuri <yvoinov at gmail.com>:

> Let's look on your server:
>
>  # wget -S http://rionegro.gov.ar/download/images/00033636.jpg
> --2018-03-01 02:37:38--  http://rionegro.gov.ar/
> download/images/00033636.jpg
> Connecting to 127.0.0.1:3128... connected.
> Proxy request sent, awaiting response...
>   HTTP/1.1 200 OK
>   Date: Wed, 28 Feb 2018 19:38:03 GMT
>   Server: Apache
>   Last-Modified: Wed, 28 Feb 2018 16:07:15 GMT
>   Accept-Ranges: bytes
>   Content-Length: 135872
>   Content-Type: image/jpeg
>   Age: 979
>   X-Cache: HIT from rn-speed-unifix
>   X-Cache: MISS from khorne
>   X-Cache-Lookup: MISS from khorne:3128
>   Connection: keep-alive
> Length: 135872 (133K) [image/jpeg]
> Saving to: '00033636.jpg'
>
> 00033636.jpg        100%[===================>] 132.69K  2.79KB/s    in
> 58s
>
> 2018-03-01 02:38:39 (2.29 KB/s) - '00033636.jpg' saved [135872/135872]
>
> All seems ok. A bit slow downloading - but ok.
>
> May be, this is your regional connectivity issues? For example,
> slooooooooooow links, slooooooooooooow DNS, dropped packets, etc.?
>
> 01.03.2018 02:36, Juan Manuel P ?????:
>
>
> Hello I send more data about the problem.
>
> The problem occur for example on this page (see below). But not occur on
> the ssl/https version of the same page.
>
> 28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 || TCP_MISS_ABORTED/000||
> GET || http://rionegro.gov.ar/media/components/youtubetv/ytv.css || -
> 28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 || TCP_MISS_ABORTED/000||
> GET || http://rionegro.gov.ar/media/components/youtubetv/principal.css ||
> -
> 28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 || TCP_MISS_ABORTED/000||
> GET || http://rionegro.gov.ar/media/components/youtubetv/ytv.js || -
> 28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 || TCP_MISS_ABORTED/000||
> GET || http://rionegro.gov.ar/media/images/disenio/ini_nav.png || -
> 28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 || TCP_MISS_ABORTED/000||
> GET || http://rionegro.gov.ar/download/images/00033645.jpg || -
> 28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 || TCP_MISS_ABORTED/000||
> GET || http://rionegro.gov.ar/download/images/00033644.jpg || -
> 28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 ||
> TCP_MEM_HIT_ABORTED/200|| GET || http://rionegro.gov.ar/
> download/banner/00002923.jpg || image/jpeg
> 28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 || TCP_MISS_ABORTED/000||
> GET || http://rionegro.gov.ar/media/images/lema.png || -
> 28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 || TCP_MISS_ABORTED/000||
> GET || http://rionegro.gov.ar/media/images/logomarcarn.png || -
> 28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 || TCP_MISS_ABORTED/000||
> GET || http://rionegro.gov.ar/download/images/00033636.jpg || -
>
>
> And when the problem occur the page is waiting and slowly until upload
> complete.
>
> Later the page upload whitout problem.
>
>
> I see that the TCP_MISS_ABORTED appear only on some extension file, css,
> js, png, jpg. When are waiting for page upload complete this elements or
> componentes are not charged but the rest of the page yes. Some time later
> all the page is upload.
>
> Regards.
>
>
>
> _______________________________________________
> squid-users mailing listsquid-users at lists.squid-cache.orghttp://lists.squid-cache.org/listinfo/squid-users
>
>
> --
> *****************************
> * C++20 : Bug to the future *
> *****************************
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180228/dd3f4099/attachment.htm>

From yvoinov at gmail.com  Wed Feb 28 20:56:10 2018
From: yvoinov at gmail.com (Yuri)
Date: Thu, 1 Mar 2018 02:56:10 +0600
Subject: [squid-users] TCP_MISS_ABORTED/000|
In-Reply-To: <CADZCxsssUjxNuckCJ5j4bZsgd8zSrYchWKrpOkpkgxkOQ9os0g@mail.gmail.com>
References: <CADZCxsum3Kjq8OLdCfETtTW+Krfhtp9qpjGcCZtKEGYhfE5d1g@mail.gmail.com>
 <1cd01c76-5dc4-b743-c741-c0c06f58bf25@gmail.com>
 <CADZCxsssUjxNuckCJ5j4bZsgd8zSrYchWKrpOkpkgxkOQ9os0g@mail.gmail.com>
Message-ID: <08f44e3e-dc16-1bfe-50ae-0df34d2c0716@gmail.com>

Seems so. May be, ever ISP. Misconfigured MPLS can lead this errors.


01.03.2018 02:55, Juan Manuel P ?????:
> Hello Yuri today on access.log a get a lot off TCP_MISS_ABORTED/000 on
> many diferentes sites:
>
> 28/Feb/2018:13:50:00 -0300 || - || 10.15.43.31 ||
> TCP_MISS_ABORTED/000|| GET ||
> http://loprincipal.com.ar/wp-content/plugins/wp-facebook-live-video/inc/style.css?
> || -
> 28/Feb/2018:13:50:00 -0300 || - || 10.15.43.31 ||
> TCP_MISS_ABORTED/000|| GET ||
> http://loprincipal.com.ar/wp-content/plugins/wp-facebook-live-video/inc/script.js?
> || -
> 28/Feb/2018:13:53:37 -0300 || - || 10.15.43.31 ||
> TCP_MISS_ABORTED/000|| POST ||
> http://m.addthis.com/live/red_lojson/100eng.json? || -
> 28/Feb/2018:13:54:09 -0300 || - || 10.15.43.31 ||
> TCP_MISS_ABORTED/000|| POST ||
> http://m.addthis.com/live/red_lojson/100eng.json? || -
> 28/Feb/2018:14:04:19 -0300 || - || 10.14.43.147 ||
> TCP_MISS_ABORTED/000|| POST ||
> http://m.addthis.com/live/red_lojson/100eng.json? || -
> 28/Feb/2018:14:04:19 -0300 || - || 10.14.43.147 ||
> TCP_MISS_ABORTED/000|| POST ||
> http://m.addthis.com/live/red_lojson/100eng.json? || -
> 28/Feb/2018:14:07:56 -0300 || - || 10.14.43.88 ||
> TCP_MISS_ABORTED/000|| GET ||
> http://ocsp2.globalsign.com/gsextendvalsha2g2/ME0wSzBJMEcwRTAJBgUrDgMCGgUABBRYCCQuHbjl0T2z%2Bv2quSEm8NK1fgQU2kB3Q2Uc%2BP6n4%2FRkgj5NQxMiMQICDGPo4Vlu6pcIoIq7tA%3D%3D
> || -
> 28/Feb/2018:14:08:11 -0300 || - || 10.14.43.88 ||
> TCP_MISS_ABORTED/000|| GET ||
> http://crl.globalsign.com/gs/gsextendvalsha2g2.crl || -
> 28/Feb/2018:14:11:56 -0300 || - || 10.15.43.30 ||
> TCP_MISS_ABORTED/000|| GET || http://ipv6.msftncsi.com/ncsi.txt || -
> 28/Feb/2018:14:30:13 -0300 || - || 10.14.43.101 ||
> TCP_MISS_ABORTED/000|| GET ||
> http://www.bancopatagonia.com/comunes/imas/facebook.jpg || -
> 28/Feb/2018:14:30:13 -0300 || - || 10.14.43.101 ||
> TCP_MISS_ABORTED/000|| GET ||
> http://www.bancopatagonia.com/comunes/imas/youtube.jpg || -
> 28/Feb/2018:14:30:13 -0300 || - || 10.14.43.101 ||
> TCP_MISS_ABORTED/000|| GET ||
> http://www.bancopatagonia.com/personas/imas/dest_espectaculos.jpg || -
> 28/Feb/2018:14:30:13 -0300 || - || 10.14.43.101 ||
> TCP_MISS_ABORTED/000|| GET ||
> http://www.bancopatagonia.com/comunes/imas/img_youtube.gif || -
> 28/Feb/2018:14:30:13 -0300 || - || 10.14.43.101 ||
> TCP_MISS_ABORTED/000|| GET ||
> http://www.bancopatagonia.com/comunes/imas/facebook-pie.jpg || -
> 28/Feb/2018:15:13:48 -0300 || - || 10.14.43.162 ||
> TCP_MISS_ABORTED/000|| POST || http://ocsp.usertrust.com/ || -
> 28/Feb/2018:15:34:18 -0300 || - || 10.14.43.77 ||
> TCP_MISS_ABORTED/000|| GET ||
> http://search.it.online.fr/covers/wp-content/Milo_Manara,_in_Giuseppe_Bergman,_2005_(Manet).jpg
> <http://search.it.online.fr/covers/wp-content/Milo_Manara,_in_Giuseppe_Bergman,_2005_%28Manet%29.jpg>
> || -
> 28/Feb/2018:15:51:21 -0300 || - || 10.14.43.162 ||
> TCP_MISS_ABORTED/000|| GET || http://csi.gstatic.com/csi? || -
> 28/Feb/2018:15:51:22 -0300 || - || 10.14.43.162 ||
> TCP_MISS_ABORTED/404|| GET ||
> http://www.snehashish.com/wp-content/themes/computers/images/slide-left.png
> || text/html
> 28/Feb/2018:15:52:42 -0300 || - || 10.14.43.159 ||
> TCP_MISS_ABORTED/000|| GET ||
> http://www.bancopatagonia.com.ar/personas/imas/dest_espectaculos.jpg || -
> 28/Feb/2018:15:52:42 -0300 || - || 10.14.43.159 ||
> TCP_MISS_ABORTED/000|| GET ||
> http://www.bancopatagonia.com.ar/comunes/imas/facebook.jpg || -
> 28/Feb/2018:15:52:42 -0300 || - || 10.14.43.159 ||
> TCP_MISS_ABORTED/000|| GET ||
> http://www.bancopatagonia.com.ar/comunes/imas/img_youtube.gif || -
> 28/Feb/2018:15:52:42 -0300 || - || 10.14.43.159 ||
> TCP_MISS_ABORTED/000|| GET ||
> http://www.bancopatagonia.com.ar/comunes/imas/facebook-pie.jpg || -
> 28/Feb/2018:15:52:42 -0300 || - || 10.14.43.159 ||
> TCP_MISS_ABORTED/000|| GET ||
> http://www.bancopatagonia.com.ar/comunes/imas/youtube.jpg || -
> 28/Feb/2018:16:18:53 -0300 || - || 192.168.43.57 ||
> TCP_MISS_ABORTED/000|| GET ||
> http://loprincipal.com.ar/wp-content/plugins/wp-facebook-live-video/inc/script.js?
> || -
> 28/Feb/2018:16:18:53 -0300 || - || 192.168.43.57 ||
> TCP_MISS_ABORTED/000|| GET ||
> http://loprincipal.com.ar/wp-content/plugins/wp-facebook-live-video/inc/style.css?
> || -
>
> I thinking the problem is not in squid, maybe DNS or something?similar.
>
> regards.
>
>
> 2018-02-28 17:46 GMT-03:00 Yuri <yvoinov at gmail.com
> <mailto:yvoinov at gmail.com>>:
>
>     Let's look on your server:
>
>     ?# wget -S http://rionegro.gov.ar/download/images/00033636.jpg
>     <http://rionegro.gov.ar/download/images/00033636.jpg>
>     --2018-03-01 02:37:38--?
>     http://rionegro.gov.ar/download/images/00033636.jpg
>     <http://rionegro.gov.ar/download/images/00033636.jpg>
>     Connecting to 127.0.0.1:3128... connected.
>     Proxy request sent, awaiting response...
>     ? HTTP/1.1 200 OK
>     ? Date: Wed, 28 Feb 2018 19:38:03 GMT
>     ? Server: Apache
>     ? Last-Modified: Wed, 28 Feb 2018 16:07:15 GMT
>     ? Accept-Ranges: bytes
>     ? Content-Length: 135872
>     ? Content-Type: image/jpeg
>     ? Age: 979
>     ? X-Cache: HIT from rn-speed-unifix
>     ? X-Cache: MISS from khorne
>     ? X-Cache-Lookup: MISS from khorne:3128
>     ? Connection: keep-alive
>     Length: 135872 (133K) [image/jpeg]
>     Saving to: '00033636.jpg'
>
>     00033636.jpg??????? 100%[===================>] 132.69K?
>     2.79KB/s??? in 58s????
>
>     2018-03-01 02:38:39 (2.29 KB/s) - '00033636.jpg' saved [135872/135872]
>
>     All seems ok. A bit slow downloading - but ok.
>
>     May be, this is your regional connectivity issues? For example,
>     slooooooooooow links, slooooooooooooow DNS, dropped packets, etc.?
>
>
>     01.03.2018 02:36, Juan Manuel P ?????:
>>
>>     Hello I send more data about the problem.
>>
>>     The problem occur for example on this page (see below). But not
>>     occur on the ssl/https version of the same page.
>>
>>     28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 ||
>>     TCP_MISS_ABORTED/000|| GET ||
>>     http://rionegro.gov.ar/media/components/youtubetv/ytv.css
>>     <http://rionegro.gov.ar/media/components/youtubetv/ytv.css> || -
>>     28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 ||
>>     TCP_MISS_ABORTED/000|| GET ||
>>     http://rionegro.gov.ar/media/components/youtubetv/principal.css
>>     <http://rionegro.gov.ar/media/components/youtubetv/principal.css>
>>     || -
>>     28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 ||
>>     TCP_MISS_ABORTED/000|| GET ||
>>     http://rionegro.gov.ar/media/components/youtubetv/ytv.js
>>     <http://rionegro.gov.ar/media/components/youtubetv/ytv.js> || -
>>     28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 ||
>>     TCP_MISS_ABORTED/000|| GET ||
>>     http://rionegro.gov.ar/media/images/disenio/ini_nav.png
>>     <http://rionegro.gov.ar/media/images/disenio/ini_nav.png> || -
>>     28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 ||
>>     TCP_MISS_ABORTED/000|| GET ||
>>     http://rionegro.gov.ar/download/images/00033645.jpg
>>     <http://rionegro.gov.ar/download/images/00033645.jpg> || -
>>     28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 ||
>>     TCP_MISS_ABORTED/000|| GET ||
>>     http://rionegro.gov.ar/download/images/00033644.jpg
>>     <http://rionegro.gov.ar/download/images/00033644.jpg> || -
>>     28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 ||
>>     TCP_MEM_HIT_ABORTED/200|| GET ||
>>     http://rionegro.gov.ar/download/banner/00002923.jpg
>>     <http://rionegro.gov.ar/download/banner/00002923.jpg> || image/jpeg
>>     28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 ||
>>     TCP_MISS_ABORTED/000|| GET ||
>>     http://rionegro.gov.ar/media/images/lema.png
>>     <http://rionegro.gov.ar/media/images/lema.png> || -
>>     28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 ||
>>     TCP_MISS_ABORTED/000|| GET ||
>>     http://rionegro.gov.ar/media/images/logomarcarn.png
>>     <http://rionegro.gov.ar/media/images/logomarcarn.png> || -
>>     28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 ||
>>     TCP_MISS_ABORTED/000|| GET ||
>>     http://rionegro.gov.ar/download/images/00033636.jpg
>>     <http://rionegro.gov.ar/download/images/00033636.jpg> || -
>>
>>
>>     And when the problem occur the page is waiting and slowly until
>>     upload complete.
>>
>>     Later the page upload whitout problem.
>>
>>
>>     I see that the TCP_MISS_ABORTED appear only on some extension
>>     file, css, js, png, jpg. When are waiting for page upload
>>     complete this elements or componentes are not charged but the
>>     rest of the page yes. Some time later all the page is upload.
>>
>>     Regards.
>>
>>
>>
>>     _______________________________________________
>>     squid-users mailing list
>>     squid-users at lists.squid-cache.org
>>     <mailto:squid-users at lists.squid-cache.org>
>>     http://lists.squid-cache.org/listinfo/squid-users
>>     <http://lists.squid-cache.org/listinfo/squid-users>
>
>     -- 
>     *****************************
>     * C++20 : Bug to the future *
>     *****************************
>
>
>     _______________________________________________
>     squid-users mailing list
>     squid-users at lists.squid-cache.org
>     <mailto:squid-users at lists.squid-cache.org>
>     http://lists.squid-cache.org/listinfo/squid-users
>     <http://lists.squid-cache.org/listinfo/squid-users>
>
>
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-- 
*****************************
* C++20 : Bug to the future *
*****************************

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180301/485ccc2a/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180301/485ccc2a/attachment.sig>

From jmpatagonia at gmail.com  Wed Feb 28 20:59:00 2018
From: jmpatagonia at gmail.com (Juan Manuel P)
Date: Wed, 28 Feb 2018 17:59:00 -0300
Subject: [squid-users] TCP_MISS_ABORTED/000|
In-Reply-To: <08f44e3e-dc16-1bfe-50ae-0df34d2c0716@gmail.com>
References: <CADZCxsum3Kjq8OLdCfETtTW+Krfhtp9qpjGcCZtKEGYhfE5d1g@mail.gmail.com>
 <1cd01c76-5dc4-b743-c741-c0c06f58bf25@gmail.com>
 <CADZCxsssUjxNuckCJ5j4bZsgd8zSrYchWKrpOkpkgxkOQ9os0g@mail.gmail.com>
 <08f44e3e-dc16-1bfe-50ae-0df34d2c0716@gmail.com>
Message-ID: <CADZCxstn8yHe5XyBq+J-Ob929y0AcFSGqTacX-yuAdPgwOBmqA@mail.gmail.com>

We are migrating from a old proxy server kerio-win-route on windows to a
squid proxy server.
The old proxy server no have problems.

regards.



2018-02-28 17:56 GMT-03:00 Yuri <yvoinov at gmail.com>:

> Seems so. May be, ever ISP. Misconfigured MPLS can lead this errors.
>
> 01.03.2018 02:55, Juan Manuel P ?????:
>
> Hello Yuri today on access.log a get a lot off TCP_MISS_ABORTED/000 on
> many diferentes sites:
>
> 28/Feb/2018:13:50:00 -0300 || - || 10.15.43.31 || TCP_MISS_ABORTED/000||
> GET || http://loprincipal.com.ar/wp-content/plugins/wp-facebook-
> live-video/inc/style.css? || -
> 28/Feb/2018:13:50:00 -0300 || - || 10.15.43.31 || TCP_MISS_ABORTED/000||
> GET || http://loprincipal.com.ar/wp-content/plugins/wp-facebook-
> live-video/inc/script.js? || -
> 28/Feb/2018:13:53:37 -0300 || - || 10.15.43.31 || TCP_MISS_ABORTED/000||
> POST || http://m.addthis.com/live/red_lojson/100eng.json? || -
> 28/Feb/2018:13:54:09 -0300 || - || 10.15.43.31 || TCP_MISS_ABORTED/000||
> POST || http://m.addthis.com/live/red_lojson/100eng.json? || -
> 28/Feb/2018:14:04:19 -0300 || - || 10.14.43.147 || TCP_MISS_ABORTED/000||
> POST || http://m.addthis.com/live/red_lojson/100eng.json? || -
> 28/Feb/2018:14:04:19 -0300 || - || 10.14.43.147 || TCP_MISS_ABORTED/000||
> POST || http://m.addthis.com/live/red_lojson/100eng.json? || -
> 28/Feb/2018:14:07:56 -0300 || - || 10.14.43.88 || TCP_MISS_ABORTED/000||
> GET || http://ocsp2.globalsign.com/gsextendvalsha2g2/
> ME0wSzBJMEcwRTAJBgUrDgMCGgUABBRYCCQuHbjl0T2z%2Bv2quSEm8NK1fgQU2kB3Q2Uc%
> 2BP6n4%2FRkgj5NQxMiMQICDGPo4Vlu6pcIoIq7tA%3D%3D || -
> 28/Feb/2018:14:08:11 -0300 || - || 10.14.43.88 || TCP_MISS_ABORTED/000||
> GET || http://crl.globalsign.com/gs/gsextendvalsha2g2.crl || -
> 28/Feb/2018:14:11:56 -0300 || - || 10.15.43.30 || TCP_MISS_ABORTED/000||
> GET || http://ipv6.msftncsi.com/ncsi.txt || -
> 28/Feb/2018:14:30:13 -0300 || - || 10.14.43.101 || TCP_MISS_ABORTED/000||
> GET || http://www.bancopatagonia.com/comunes/imas/facebook.jpg || -
> 28/Feb/2018:14:30:13 -0300 || - || 10.14.43.101 || TCP_MISS_ABORTED/000||
> GET || http://www.bancopatagonia.com/comunes/imas/youtube.jpg || -
> 28/Feb/2018:14:30:13 -0300 || - || 10.14.43.101 || TCP_MISS_ABORTED/000||
> GET || http://www.bancopatagonia.com/personas/imas/dest_espectaculos.jpg
> || -
> 28/Feb/2018:14:30:13 -0300 || - || 10.14.43.101 || TCP_MISS_ABORTED/000||
> GET || http://www.bancopatagonia.com/comunes/imas/img_youtube.gif || -
> 28/Feb/2018:14:30:13 -0300 || - || 10.14.43.101 || TCP_MISS_ABORTED/000||
> GET || http://www.bancopatagonia.com/comunes/imas/facebook-pie.jpg || -
> 28/Feb/2018:15:13:48 -0300 || - || 10.14.43.162 || TCP_MISS_ABORTED/000||
> POST || http://ocsp.usertrust.com/ || -
> 28/Feb/2018:15:34:18 -0300 || - || 10.14.43.77 || TCP_MISS_ABORTED/000||
> GET || http://search.it.online.fr/covers/wp-content/Milo_Manara,
> _in_Giuseppe_Bergman,_2005_(Manet).jpg || -
> 28/Feb/2018:15:51:21 -0300 || - || 10.14.43.162 || TCP_MISS_ABORTED/000||
> GET || http://csi.gstatic.com/csi? || -
> 28/Feb/2018:15:51:22 -0300 || - || 10.14.43.162 || TCP_MISS_ABORTED/404||
> GET || http://www.snehashish.com/wp-content/themes/computers/
> images/slide-left.png || text/html
> 28/Feb/2018:15:52:42 -0300 || - || 10.14.43.159 || TCP_MISS_ABORTED/000||
> GET || http://www.bancopatagonia.com.ar/personas/imas/dest_
> espectaculos.jpg || -
> 28/Feb/2018:15:52:42 -0300 || - || 10.14.43.159 || TCP_MISS_ABORTED/000||
> GET || http://www.bancopatagonia.com.ar/comunes/imas/facebook.jpg || -
> 28/Feb/2018:15:52:42 -0300 || - || 10.14.43.159 || TCP_MISS_ABORTED/000||
> GET || http://www.bancopatagonia.com.ar/comunes/imas/img_youtube.gif || -
> 28/Feb/2018:15:52:42 -0300 || - || 10.14.43.159 || TCP_MISS_ABORTED/000||
> GET || http://www.bancopatagonia.com.ar/comunes/imas/facebook-pie.jpg || -
> 28/Feb/2018:15:52:42 -0300 || - || 10.14.43.159 || TCP_MISS_ABORTED/000||
> GET || http://www.bancopatagonia.com.ar/comunes/imas/youtube.jpg || -
> 28/Feb/2018:16:18:53 -0300 || - || 192.168.43.57 || TCP_MISS_ABORTED/000||
> GET || http://loprincipal.com.ar/wp-content/plugins/wp-facebook-
> live-video/inc/script.js? || -
> 28/Feb/2018:16:18:53 -0300 || - || 192.168.43.57 || TCP_MISS_ABORTED/000||
> GET || http://loprincipal.com.ar/wp-content/plugins/wp-facebook-
> live-video/inc/style.css? || -
>
> I thinking the problem is not in squid, maybe DNS or something similar.
>
> regards.
>
>
> 2018-02-28 17:46 GMT-03:00 Yuri <yvoinov at gmail.com>:
>
>> Let's look on your server:
>>
>>  # wget -S http://rionegro.gov.ar/download/images/00033636.jpg
>> --2018-03-01 02:37:38--  http://rionegro.gov.ar/downloa
>> d/images/00033636.jpg
>> Connecting to 127.0.0.1:3128... connected.
>> Proxy request sent, awaiting response...
>>   HTTP/1.1 200 OK
>>   Date: Wed, 28 Feb 2018 19:38:03 GMT
>>   Server: Apache
>>   Last-Modified: Wed, 28 Feb 2018 16:07:15 GMT
>>   Accept-Ranges: bytes
>>   Content-Length: 135872
>>   Content-Type: image/jpeg
>>   Age: 979
>>   X-Cache: HIT from rn-speed-unifix
>>   X-Cache: MISS from khorne
>>   X-Cache-Lookup: MISS from khorne:3128
>>   Connection: keep-alive
>> Length: 135872 (133K) [image/jpeg]
>> Saving to: '00033636.jpg'
>>
>> 00033636.jpg        100%[===================>] 132.69K  2.79KB/s    in
>> 58s
>>
>> 2018-03-01 02:38:39 (2.29 KB/s) - '00033636.jpg' saved [135872/135872]
>>
>> All seems ok. A bit slow downloading - but ok.
>>
>> May be, this is your regional connectivity issues? For example,
>> slooooooooooow links, slooooooooooooow DNS, dropped packets, etc.?
>>
>> 01.03.2018 02:36, Juan Manuel P ?????:
>>
>>
>> Hello I send more data about the problem.
>>
>> The problem occur for example on this page (see below). But not occur on
>> the ssl/https version of the same page.
>>
>> 28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 || TCP_MISS_ABORTED/000||
>> GET || http://rionegro.gov.ar/media/components/youtubetv/ytv.css || -
>> 28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 || TCP_MISS_ABORTED/000||
>> GET || http://rionegro.gov.ar/media/components/youtubetv/principal.css
>> || -
>> 28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 || TCP_MISS_ABORTED/000||
>> GET || http://rionegro.gov.ar/media/components/youtubetv/ytv.js || -
>> 28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 || TCP_MISS_ABORTED/000||
>> GET || http://rionegro.gov.ar/media/images/disenio/ini_nav.png || -
>> 28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 || TCP_MISS_ABORTED/000||
>> GET || http://rionegro.gov.ar/download/images/00033645.jpg || -
>> 28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 || TCP_MISS_ABORTED/000||
>> GET || http://rionegro.gov.ar/download/images/00033644.jpg || -
>> 28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 ||
>> TCP_MEM_HIT_ABORTED/200|| GET || http://rionegro.gov.ar/downloa
>> d/banner/00002923.jpg || image/jpeg
>> 28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 || TCP_MISS_ABORTED/000||
>> GET || http://rionegro.gov.ar/media/images/lema.png || -
>> 28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 || TCP_MISS_ABORTED/000||
>> GET || http://rionegro.gov.ar/media/images/logomarcarn.png || -
>> 28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 || TCP_MISS_ABORTED/000||
>> GET || http://rionegro.gov.ar/download/images/00033636.jpg || -
>>
>>
>> And when the problem occur the page is waiting and slowly until upload
>> complete.
>>
>> Later the page upload whitout problem.
>>
>>
>> I see that the TCP_MISS_ABORTED appear only on some extension file, css,
>> js, png, jpg. When are waiting for page upload complete this elements or
>> componentes are not charged but the rest of the page yes. Some time later
>> all the page is upload.
>>
>> Regards.
>>
>>
>>
>> _______________________________________________
>> squid-users mailing listsquid-users at lists.squid-cache.orghttp://lists.squid-cache.org/listinfo/squid-users
>>
>>
>> --
>> *****************************
>> * C++20 : Bug to the future *
>> *****************************
>>
>>
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
>>
>>
>
>
> _______________________________________________
> squid-users mailing listsquid-users at lists.squid-cache.orghttp://lists.squid-cache.org/listinfo/squid-users
>
>
> --
> *****************************
> * C++20 : Bug to the future *
> *****************************
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180228/a5f2c1a5/attachment.htm>

From yvoinov at gmail.com  Wed Feb 28 21:01:37 2018
From: yvoinov at gmail.com (Yuri)
Date: Thu, 1 Mar 2018 03:01:37 +0600
Subject: [squid-users] TCP_MISS_ABORTED/000|
In-Reply-To: <CADZCxstn8yHe5XyBq+J-Ob929y0AcFSGqTacX-yuAdPgwOBmqA@mail.gmail.com>
References: <CADZCxsum3Kjq8OLdCfETtTW+Krfhtp9qpjGcCZtKEGYhfE5d1g@mail.gmail.com>
 <1cd01c76-5dc4-b743-c741-c0c06f58bf25@gmail.com>
 <CADZCxsssUjxNuckCJ5j4bZsgd8zSrYchWKrpOkpkgxkOQ9os0g@mail.gmail.com>
 <08f44e3e-dc16-1bfe-50ae-0df34d2c0716@gmail.com>
 <CADZCxstn8yHe5XyBq+J-Ob929y0AcFSGqTacX-yuAdPgwOBmqA@mail.gmail.com>
Message-ID: <38c28f9a-80ed-5689-8e8f-7a1ccac1e2b9@gmail.com>

Windows often spit on RFC due to do not disturb users. Squid is not.

Anyway, as you can see, from my side, with well-configured
infrastructure and well-configured squid, is also no problem.

So, may be, somebody's hands like legs.... ;-)


01.03.2018 02:59, Juan Manuel P ?????:
> We are migrating from a old proxy server kerio-win-route on windows to
> a squid proxy server.
> The old proxy server no have problems.
>
> regards.
>
>
>
> 2018-02-28 17:56 GMT-03:00 Yuri <yvoinov at gmail.com
> <mailto:yvoinov at gmail.com>>:
>
>     Seems so. May be, ever ISP. Misconfigured MPLS can lead this errors.
>
>
>     01.03.2018 02:55, Juan Manuel P ?????:
>>     Hello Yuri today on access.log a get a lot off
>>     TCP_MISS_ABORTED/000 on many diferentes sites:
>>
>>     28/Feb/2018:13:50:00 -0300 || - || 10.15.43.31 ||
>>     TCP_MISS_ABORTED/000|| GET ||
>>     http://loprincipal.com.ar/wp-content/plugins/wp-facebook-live-video/inc/style.css
>>     <http://loprincipal.com.ar/wp-content/plugins/wp-facebook-live-video/inc/style.css>?
>>     || -
>>     28/Feb/2018:13:50:00 -0300 || - || 10.15.43.31 ||
>>     TCP_MISS_ABORTED/000|| GET ||
>>     http://loprincipal.com.ar/wp-content/plugins/wp-facebook-live-video/inc/script.js
>>     <http://loprincipal.com.ar/wp-content/plugins/wp-facebook-live-video/inc/script.js>?
>>     || -
>>     28/Feb/2018:13:53:37 -0300 || - || 10.15.43.31 ||
>>     TCP_MISS_ABORTED/000|| POST ||
>>     http://m.addthis.com/live/red_lojson/100eng.json
>>     <http://m.addthis.com/live/red_lojson/100eng.json>? || -
>>     28/Feb/2018:13:54:09 -0300 || - || 10.15.43.31 ||
>>     TCP_MISS_ABORTED/000|| POST ||
>>     http://m.addthis.com/live/red_lojson/100eng.json
>>     <http://m.addthis.com/live/red_lojson/100eng.json>? || -
>>     28/Feb/2018:14:04:19 -0300 || - || 10.14.43.147 ||
>>     TCP_MISS_ABORTED/000|| POST ||
>>     http://m.addthis.com/live/red_lojson/100eng.json
>>     <http://m.addthis.com/live/red_lojson/100eng.json>? || -
>>     28/Feb/2018:14:04:19 -0300 || - || 10.14.43.147 ||
>>     TCP_MISS_ABORTED/000|| POST ||
>>     http://m.addthis.com/live/red_lojson/100eng.json
>>     <http://m.addthis.com/live/red_lojson/100eng.json>? || -
>>     28/Feb/2018:14:07:56 -0300 || - || 10.14.43.88 ||
>>     TCP_MISS_ABORTED/000|| GET ||
>>     http://ocsp2.globalsign.com/gsextendvalsha2g2/ME0wSzBJMEcwRTAJBgUrDgMCGgUABBRYCCQuHbjl0T2z%2Bv2quSEm8NK1fgQU2kB3Q2Uc%2BP6n4%2FRkgj5NQxMiMQICDGPo4Vlu6pcIoIq7tA%3D%3D
>>     <http://ocsp2.globalsign.com/gsextendvalsha2g2/ME0wSzBJMEcwRTAJBgUrDgMCGgUABBRYCCQuHbjl0T2z%2Bv2quSEm8NK1fgQU2kB3Q2Uc%2BP6n4%2FRkgj5NQxMiMQICDGPo4Vlu6pcIoIq7tA%3D%3D>
>>     || -
>>     28/Feb/2018:14:08:11 -0300 || - || 10.14.43.88 ||
>>     TCP_MISS_ABORTED/000|| GET ||
>>     http://crl.globalsign.com/gs/gsextendvalsha2g2.crl
>>     <http://crl.globalsign.com/gs/gsextendvalsha2g2.crl> || -
>>     28/Feb/2018:14:11:56 -0300 || - || 10.15.43.30 ||
>>     TCP_MISS_ABORTED/000|| GET || http://ipv6.msftncsi.com/ncsi.txt
>>     <http://ipv6.msftncsi.com/ncsi.txt> || -
>>     28/Feb/2018:14:30:13 -0300 || - || 10.14.43.101 ||
>>     TCP_MISS_ABORTED/000|| GET ||
>>     http://www.bancopatagonia.com/comunes/imas/facebook.jpg
>>     <http://www.bancopatagonia.com/comunes/imas/facebook.jpg> || -
>>     28/Feb/2018:14:30:13 -0300 || - || 10.14.43.101 ||
>>     TCP_MISS_ABORTED/000|| GET ||
>>     http://www.bancopatagonia.com/comunes/imas/youtube.jpg
>>     <http://www.bancopatagonia.com/comunes/imas/youtube.jpg> || -
>>     28/Feb/2018:14:30:13 -0300 || - || 10.14.43.101 ||
>>     TCP_MISS_ABORTED/000|| GET ||
>>     http://www.bancopatagonia.com/personas/imas/dest_espectaculos.jpg
>>     <http://www.bancopatagonia.com/personas/imas/dest_espectaculos.jpg>
>>     || -
>>     28/Feb/2018:14:30:13 -0300 || - || 10.14.43.101 ||
>>     TCP_MISS_ABORTED/000|| GET ||
>>     http://www.bancopatagonia.com/comunes/imas/img_youtube.gif
>>     <http://www.bancopatagonia.com/comunes/imas/img_youtube.gif> || -
>>     28/Feb/2018:14:30:13 -0300 || - || 10.14.43.101 ||
>>     TCP_MISS_ABORTED/000|| GET ||
>>     http://www.bancopatagonia.com/comunes/imas/facebook-pie.jpg
>>     <http://www.bancopatagonia.com/comunes/imas/facebook-pie.jpg> || -
>>     28/Feb/2018:15:13:48 -0300 || - || 10.14.43.162 ||
>>     TCP_MISS_ABORTED/000|| POST || http://ocsp.usertrust.com/ || -
>>     28/Feb/2018:15:34:18 -0300 || - || 10.14.43.77 ||
>>     TCP_MISS_ABORTED/000|| GET ||
>>     http://search.it.online.fr/covers/wp-content/Milo_Manara,_in_Giuseppe_Bergman,_2005_(Manet).jpg
>>     <http://search.it.online.fr/covers/wp-content/Milo_Manara,_in_Giuseppe_Bergman,_2005_%28Manet%29.jpg>
>>     || -
>>     28/Feb/2018:15:51:21 -0300 || - || 10.14.43.162 ||
>>     TCP_MISS_ABORTED/000|| GET || http://csi.gstatic.com/csi? || -
>>     28/Feb/2018:15:51:22 -0300 || - || 10.14.43.162 ||
>>     TCP_MISS_ABORTED/404|| GET ||
>>     http://www.snehashish.com/wp-content/themes/computers/images/slide-left.png
>>     <http://www.snehashish.com/wp-content/themes/computers/images/slide-left.png>
>>     || text/html
>>     28/Feb/2018:15:52:42 -0300 || - || 10.14.43.159 ||
>>     TCP_MISS_ABORTED/000|| GET ||
>>     http://www.bancopatagonia.com.ar/personas/imas/dest_espectaculos.jpg
>>     <http://www.bancopatagonia.com.ar/personas/imas/dest_espectaculos.jpg>
>>     || -
>>     28/Feb/2018:15:52:42 -0300 || - || 10.14.43.159 ||
>>     TCP_MISS_ABORTED/000|| GET ||
>>     http://www.bancopatagonia.com.ar/comunes/imas/facebook.jpg
>>     <http://www.bancopatagonia.com.ar/comunes/imas/facebook.jpg> || -
>>     28/Feb/2018:15:52:42 -0300 || - || 10.14.43.159 ||
>>     TCP_MISS_ABORTED/000|| GET ||
>>     http://www.bancopatagonia.com.ar/comunes/imas/img_youtube.gif
>>     <http://www.bancopatagonia.com.ar/comunes/imas/img_youtube.gif> || -
>>     28/Feb/2018:15:52:42 -0300 || - || 10.14.43.159 ||
>>     TCP_MISS_ABORTED/000|| GET ||
>>     http://www.bancopatagonia.com.ar/comunes/imas/facebook-pie.jpg
>>     <http://www.bancopatagonia.com.ar/comunes/imas/facebook-pie.jpg> || -
>>     28/Feb/2018:15:52:42 -0300 || - || 10.14.43.159 ||
>>     TCP_MISS_ABORTED/000|| GET ||
>>     http://www.bancopatagonia.com.ar/comunes/imas/youtube.jpg
>>     <http://www.bancopatagonia.com.ar/comunes/imas/youtube.jpg> || -
>>     28/Feb/2018:16:18:53 -0300 || - || 192.168.43.57 ||
>>     TCP_MISS_ABORTED/000|| GET ||
>>     http://loprincipal.com.ar/wp-content/plugins/wp-facebook-live-video/inc/script.js
>>     <http://loprincipal.com.ar/wp-content/plugins/wp-facebook-live-video/inc/script.js>?
>>     || -
>>     28/Feb/2018:16:18:53 -0300 || - || 192.168.43.57 ||
>>     TCP_MISS_ABORTED/000|| GET ||
>>     http://loprincipal.com.ar/wp-content/plugins/wp-facebook-live-video/inc/style.css
>>     <http://loprincipal.com.ar/wp-content/plugins/wp-facebook-live-video/inc/style.css>?
>>     || -
>>
>>     I thinking the problem is not in squid, maybe DNS or
>>     something?similar.
>>
>>     regards.
>>
>>
>>     2018-02-28 17:46 GMT-03:00 Yuri <yvoinov at gmail.com
>>     <mailto:yvoinov at gmail.com>>:
>>
>>         Let's look on your server:
>>
>>         ?# wget -S
>>         http://rionegro.gov.ar/download/images/00033636.jpg
>>         <http://rionegro.gov.ar/download/images/00033636.jpg>
>>         --2018-03-01 02:37:38--?
>>         http://rionegro.gov.ar/download/images/00033636.jpg
>>         <http://rionegro.gov.ar/download/images/00033636.jpg>
>>         Connecting to 127.0.0.1:3128... connected.
>>         Proxy request sent, awaiting response...
>>         ? HTTP/1.1 200 OK
>>         ? Date: Wed, 28 Feb 2018 19:38:03 GMT
>>         ? Server: Apache
>>         ? Last-Modified: Wed, 28 Feb 2018 16:07:15 GMT
>>         ? Accept-Ranges: bytes
>>         ? Content-Length: 135872
>>         ? Content-Type: image/jpeg
>>         ? Age: 979
>>         ? X-Cache: HIT from rn-speed-unifix
>>         ? X-Cache: MISS from khorne
>>         ? X-Cache-Lookup: MISS from khorne:3128
>>         ? Connection: keep-alive
>>         Length: 135872 (133K) [image/jpeg]
>>         Saving to: '00033636.jpg'
>>
>>         00033636.jpg??????? 100%[===================>] 132.69K?
>>         2.79KB/s??? in 58s????
>>
>>         2018-03-01 02:38:39 (2.29 KB/s) - '00033636.jpg' saved
>>         [135872/135872]
>>
>>         All seems ok. A bit slow downloading - but ok.
>>
>>         May be, this is your regional connectivity issues? For
>>         example, slooooooooooow links, slooooooooooooow DNS, dropped
>>         packets, etc.?
>>
>>
>>         01.03.2018 02:36, Juan Manuel P ?????:
>>>
>>>         Hello I send more data about the problem.
>>>
>>>         The problem occur for example on this page (see below). But
>>>         not occur on the ssl/https version of the same page.
>>>
>>>         28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 ||
>>>         TCP_MISS_ABORTED/000|| GET ||
>>>         http://rionegro.gov.ar/media/components/youtubetv/ytv.css
>>>         <http://rionegro.gov.ar/media/components/youtubetv/ytv.css> || -
>>>         28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 ||
>>>         TCP_MISS_ABORTED/000|| GET ||
>>>         http://rionegro.gov.ar/media/components/youtubetv/principal.css
>>>         <http://rionegro.gov.ar/media/components/youtubetv/principal.css>
>>>         || -
>>>         28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 ||
>>>         TCP_MISS_ABORTED/000|| GET ||
>>>         http://rionegro.gov.ar/media/components/youtubetv/ytv.js
>>>         <http://rionegro.gov.ar/media/components/youtubetv/ytv.js> || -
>>>         28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 ||
>>>         TCP_MISS_ABORTED/000|| GET ||
>>>         http://rionegro.gov.ar/media/images/disenio/ini_nav.png
>>>         <http://rionegro.gov.ar/media/images/disenio/ini_nav.png> || -
>>>         28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 ||
>>>         TCP_MISS_ABORTED/000|| GET ||
>>>         http://rionegro.gov.ar/download/images/00033645.jpg
>>>         <http://rionegro.gov.ar/download/images/00033645.jpg> || -
>>>         28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 ||
>>>         TCP_MISS_ABORTED/000|| GET ||
>>>         http://rionegro.gov.ar/download/images/00033644.jpg
>>>         <http://rionegro.gov.ar/download/images/00033644.jpg> || -
>>>         28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 ||
>>>         TCP_MEM_HIT_ABORTED/200|| GET ||
>>>         http://rionegro.gov.ar/download/banner/00002923.jpg
>>>         <http://rionegro.gov.ar/download/banner/00002923.jpg> ||
>>>         image/jpeg
>>>         28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 ||
>>>         TCP_MISS_ABORTED/000|| GET ||
>>>         http://rionegro.gov.ar/media/images/lema.png
>>>         <http://rionegro.gov.ar/media/images/lema.png> || -
>>>         28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 ||
>>>         TCP_MISS_ABORTED/000|| GET ||
>>>         http://rionegro.gov.ar/media/images/logomarcarn.png
>>>         <http://rionegro.gov.ar/media/images/logomarcarn.png> || -
>>>         28/Feb/2018:17:19:00 -0300 || - || 10.12.43.20 ||
>>>         TCP_MISS_ABORTED/000|| GET ||
>>>         http://rionegro.gov.ar/download/images/00033636.jpg
>>>         <http://rionegro.gov.ar/download/images/00033636.jpg> || -
>>>
>>>
>>>         And when the problem occur the page is waiting and slowly
>>>         until upload complete.
>>>
>>>         Later the page upload whitout problem.
>>>
>>>
>>>         I see that the TCP_MISS_ABORTED appear only on some
>>>         extension file, css, js, png, jpg. When are waiting for page
>>>         upload complete this elements or componentes are not charged
>>>         but the rest of the page yes. Some time later all the page
>>>         is upload.
>>>
>>>         Regards.
>>>
>>>
>>>
>>>         _______________________________________________
>>>         squid-users mailing list
>>>         squid-users at lists.squid-cache.org
>>>         <mailto:squid-users at lists.squid-cache.org>
>>>         http://lists.squid-cache.org/listinfo/squid-users
>>>         <http://lists.squid-cache.org/listinfo/squid-users>
>>
>>         -- 
>>         *****************************
>>         * C++20 : Bug to the future *
>>         *****************************
>>
>>
>>         _______________________________________________
>>         squid-users mailing list
>>         squid-users at lists.squid-cache.org
>>         <mailto:squid-users at lists.squid-cache.org>
>>         http://lists.squid-cache.org/listinfo/squid-users
>>         <http://lists.squid-cache.org/listinfo/squid-users>
>>
>>
>>
>>
>>     _______________________________________________
>>     squid-users mailing list
>>     squid-users at lists.squid-cache.org
>>     <mailto:squid-users at lists.squid-cache.org>
>>     http://lists.squid-cache.org/listinfo/squid-users
>>     <http://lists.squid-cache.org/listinfo/squid-users>
>
>     -- 
>     *****************************
>     * C++20 : Bug to the future *
>     *****************************
>
>
>     _______________________________________________
>     squid-users mailing list
>     squid-users at lists.squid-cache.org
>     <mailto:squid-users at lists.squid-cache.org>
>     http://lists.squid-cache.org/listinfo/squid-users
>     <http://lists.squid-cache.org/listinfo/squid-users>
>
>
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-- 
*****************************
* C++20 : Bug to the future *
*****************************

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180301/0f0eb597/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20180301/0f0eb597/attachment.sig>

