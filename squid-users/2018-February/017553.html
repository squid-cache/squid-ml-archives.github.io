<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 3.x or 4.x acting as a transparent http proxy (NOT https)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.x%20or%204.x%20acting%20as%20a%20transparent%20http%0A%20proxy%20%28NOT%20https%29&In-Reply-To=%3C0464e0f8-e5d0-0d70-6471-a9960a41da78%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017551.html">
   <LINK REL="Next"  HREF="017557.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 3.x or 4.x acting as a transparent http proxy (NOT https)</H1>
    <B>Yuri</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.x%20or%204.x%20acting%20as%20a%20transparent%20http%0A%20proxy%20%28NOT%20https%29&In-Reply-To=%3C0464e0f8-e5d0-0d70-6471-a9960a41da78%40gmail.com%3E"
       TITLE="[squid-users] Squid 3.x or 4.x acting as a transparent http proxy (NOT https)">yvoinov at gmail.com
       </A><BR>
    <I>Wed Feb  7 23:41:09 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="017551.html">[squid-users] Squid 3.x or 4.x acting as a transparent http proxy (NOT https)
</A></li>
        <LI>Next message (by thread): <A HREF="017557.html">[squid-users] Squid 3.x or 4.x acting as a transparent http proxy (NOT https)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17553">[ date ]</a>
              <a href="thread.html#17553">[ thread ]</a>
              <a href="subject.html#17553">[ subject ]</a>
              <a href="author.html#17553">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Squid is relatively difficult to run with transparent mode on virtual
platforms due to NAT limitations on virtual platforms (this is not
squid's issue, this is issue if virtual platforms).

I'm using squid only in transparent mode (only in transparent mode)
several years on Solaris (bare metal) without any issues in HTTP/HTTPS
interception. With IPFilter. With 1-2-6-8 interfaces with different LAN
topologies. Starting from Squid 2.7, then 3.4, 3.5, 4.x and now 5.x. All
without serious problems.

But on bare-metal.

08.02.2018 05:25, setuid &#1087;&#1080;&#1096;&#1077;&#1090;:
&gt;<i> On 2/7/18 5:37 PM, Rafael Akchurin wrote:
</I>&gt;&gt;<i> How is your network configured? Your rules indicate you have 2 nics but you later say you have one..
</I>&gt;<i> Originally, I started with 1 NIC (it's a VM), and added 2 more, because
</I>&gt;<i> I read that pf/ipfw can't rewrite ingress packets on the same interface
</I>&gt;<i> it used for egress, but I haven't tried creating a bridge and routes to
</I>&gt;<i> attempt to make that work yet.
</I>&gt;<i>
</I>&gt;<i> The Ubuntu machine has 2 NICs; primary NIC is WAN facing (internet
</I>&gt;<i> routable IP bound to eth0) and the secondary NIC sits on the &quot;backup&quot;
</I>&gt;<i> network (LAN-side) on 192.168.2.x.
</I>&gt;<i>
</I>&gt;<i> Let's break it down:
</I>&gt;<i>
</I>&gt;<i> [WAN router]
</I>&gt;<i>   |-- LAN: 192.168.1.1 (wired LAN)
</I>&gt;<i>   `-- WWAN: 10.0.1.1 (wireless clients)
</I>&gt;<i>
</I>&gt;<i> BSD VM: 192.168.1.25
</I>&gt;<i>
</I>&gt;<i> Ubuntu VM:
</I>&gt;<i>   |-- INET: 32.215.x.x
</I>&gt;<i>   `-- LAN: 192.168.2.x
</I>&gt;<i>
</I>&gt;<i> The WAN router is what sends traffic sent over it on :80, over to .1.25
</I>&gt;<i> (BSD) to cache.
</I>&gt;<i>
</I>&gt;<i> Previously, I had it pointed to Squid 2.6 sitting on my NAS
</I>&gt;<i> (192.168.1.20) and that would work perfectly as a transparent proxy.
</I>&gt;<i>
</I>&gt;<i> When I pointed the WAN router to .25 instead of .20, and upgraded the
</I>&gt;<i> version of Squid by using BSD's version from ports on .25, this process
</I>&gt;<i> all fell apart.
</I>&gt;<i>
</I>&gt;<i> So... is having 3 NICs (1 NIC + 2 bridged together as bridge0) *now* a
</I>&gt;<i> requirement to get transparent proxying working with anything using
</I>&gt;<i> Squid 3.x or later?
</I>&gt;<i>
</I>&gt;<i> Can this be done with a single NIC sitting on an Internet-facing LAN
</I>&gt;<i> segment?
</I>&gt;<i>
</I>&gt;<i> If so, how?
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>
-- 
*****************************
* C++20 : Bug to the future *
*****************************


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20180208/bd1a8c4d/attachment.sig">http://lists.squid-cache.org/pipermail/squid-users/attachments/20180208/bd1a8c4d/attachment.sig</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="017551.html">[squid-users] Squid 3.x or 4.x acting as a transparent http proxy (NOT https)
</A></li>
	<LI>Next message (by thread): <A HREF="017557.html">[squid-users] Squid 3.x or 4.x acting as a transparent http proxy (NOT https)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17553">[ date ]</a>
              <a href="thread.html#17553">[ thread ]</a>
              <a href="subject.html#17553">[ subject ]</a>
              <a href="author.html#17553">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
