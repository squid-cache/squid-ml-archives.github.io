<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] custom logfile_daemon causing FATAL error
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20custom%20logfile_daemon%20causing%20FATAL%20error&In-Reply-To=%3Cce43f1aa-d895-43eb-439b-ecb1d414e2d0%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017601.html">
   <LINK REL="Next"  HREF="017606.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] custom logfile_daemon causing FATAL error</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20custom%20logfile_daemon%20causing%20FATAL%20error&In-Reply-To=%3Cce43f1aa-d895-43eb-439b-ecb1d414e2d0%40measurement-factory.com%3E"
       TITLE="[squid-users] custom logfile_daemon causing FATAL error">rousskov at measurement-factory.com
       </A><BR>
    <I>Sun Feb 11 02:26:44 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="017601.html">[squid-users] custom logfile_daemon causing FATAL error
</A></li>
        <LI>Next message (by thread): <A HREF="017606.html">[squid-users] Transition from squid3.5 to squid4;	ciphers don't work anymore, ERROR: Unknown TLS option SINGLE_DH_USE
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17602">[ date ]</a>
              <a href="thread.html#17602">[ thread ]</a>
              <a href="subject.html#17602">[ subject ]</a>
              <a href="author.html#17602">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 02/10/2018 05:51 PM, Michael D wrote:
&gt;<i> Greetings all,&#160;
</I>&gt;<i> 
</I>&gt;<i> I have been attempting to write my own logfile_daemon for experimental
</I>&gt;<i> purposes, but any daemon I provide causes &quot;FATAL: I don't handle this
</I>&gt;<i> error well&quot;. I also see &quot;logfileHandleWrite:
</I>&gt;<i> daemon:/var/log/squid/access.log: error writing ((32) Broken pipe)&quot; with
</I>&gt;<i> no other errors in the cache.log.
</I>
It sounds like your daemon quits without Squid permission. Logging
daemons should not do that because Squid considers such behavior a FATAL
error.


&gt;<i> I have read all possible docs about
</I>&gt;<i> writing a custom logfile_daemon, but I have had no luck. For testing
</I>&gt;<i> purposes my daemon is just a bash script that creates a file and pipes
</I>&gt;<i> random text to it. The creation of the file/writing text to the file
</I>&gt;<i> works fine, but soon after squid just dies. I have no help from the
</I>&gt;<i> cache.log or squid.out.
</I>
Since you did not share your code, I have to ask: Does your shell script
actually read logging commands sent by Squid? Or does it simply quit
after writing some &quot;random text&quot; to some file? Squid expects the daemon
to run until the daemon reads EOF on stdin... The daemon does not have
to handle the commands it reads, but it has to keep reading them until EOF.

If you want to add debugging to your daemon, try writing write to stderr.

For the list of logging commands, please see
<A HREF="https://wiki.squid-cache.org/Features/LogModules#Daemon_Message_Protocol">https://wiki.squid-cache.org/Features/LogModules#Daemon_Message_Protocol</A>
a.k.a.
<A HREF="https://wiki.squid-cache.org/Features/AddonHelpers#Logging">https://wiki.squid-cache.org/Features/AddonHelpers#Logging</A>


HTH,

Alex.


&gt;<i> The only line I have added to my squid.conf is &quot;logfile_daemon
</I>&gt;<i> /etc/squid/hi.sh&quot;. This causes the fatal error. I have also tried
</I>&gt;<i> explicitly setting my access_log directive as well &quot;access_log
</I>&gt;<i> daemon:/var/log/squid/access.log squid&quot;, but that still does not work.
</I>&gt;<i> Thanks in advance.
</I>&gt;<i> 
</I>&gt;<i> -Mike
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="017601.html">[squid-users] custom logfile_daemon causing FATAL error
</A></li>
	<LI>Next message (by thread): <A HREF="017606.html">[squid-users] Transition from squid3.5 to squid4;	ciphers don't work anymore, ERROR: Unknown TLS option SINGLE_DH_USE
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17602">[ date ]</a>
              <a href="thread.html#17602">[ thread ]</a>
              <a href="subject.html#17602">[ subject ]</a>
              <a href="author.html#17602">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
