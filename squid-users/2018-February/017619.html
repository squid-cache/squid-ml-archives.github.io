<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid4 with sslbump not logged server side cert_subject and cert_issuer
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid4%20with%20sslbump%20not%20logged%20server%20side%0A%20cert_subject%20and%20cert_issuer&In-Reply-To=%3Ccb2e63ab-75e1-2138-5867-6d71c43d71c5%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017618.html">
   <LINK REL="Next"  HREF="017620.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid4 with sslbump not logged server side cert_subject and cert_issuer</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid4%20with%20sslbump%20not%20logged%20server%20side%0A%20cert_subject%20and%20cert_issuer&In-Reply-To=%3Ccb2e63ab-75e1-2138-5867-6d71c43d71c5%40measurement-factory.com%3E"
       TITLE="[squid-users] squid4 with sslbump not logged server side cert_subject and cert_issuer">rousskov at measurement-factory.com
       </A><BR>
    <I>Thu Feb 15 18:41:37 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="017618.html">[squid-users] squid4 with sslbump not logged server side cert_subject and cert_issuer
</A></li>
        <LI>Next message (by thread): <A HREF="017620.html">[squid-users] squid4 with sslbump not logged server side cert_subject and cert_issuer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17619">[ date ]</a>
              <a href="thread.html#17619">[ thread ]</a>
              <a href="subject.html#17619">[ subject ]</a>
              <a href="author.html#17619">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 02/15/2018 07:32 AM, Amos Jeffries wrote:
&gt;<i> On 16/02/18 01:44, Peter Viskup wrote:
</I>&gt;&gt;<i> Running squid version 4.0.23 with logformat including
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> SSLBumpMode=%ssl::bump_mode SSLSNI=&quot;%ssl::&gt;sni&quot;
</I>&gt;&gt;<i> SSLClientProto=&quot;%ssl::&gt;negotiated_version&quot;
</I>&gt;&gt;<i> SSLServerProto=&quot;%ssl::&lt;negotiated_version&quot;
</I>&gt;&gt;<i> SSLBumpClientCipher=&quot;%ssl::&gt;negotiated_cipher&quot;
</I>&gt;&gt;<i> SSLBumpServerCipher=&quot;%ssl::&lt;negotiated_cipher&quot;
</I>&gt;&gt;<i> SSLBumpSubject=&quot;%ssl::&lt;cert_subject&quot;
</I>&gt;&gt;<i> SSLBumpIssuer=&quot;%ssl::&lt;cert_issuer&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> and ssl_bump configured simply with
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ssl_bump bump all
</I>&gt;&gt;<i> http_access allow all
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> the messages still logged with dashes for Subject and Issuer values
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> SSLBumpMode=bump SSLSNI=&quot;www.google.sk&quot; SSLClientProto=&quot;TLS/1.0&quot; SSLServerProto
</I>&gt;&gt;<i> =&quot;TLS/1.2&quot; SSLBumpClientCipher=&quot;ECDHE-RSA-AES256-SHA&quot;
</I>&gt;&gt;<i> SSLBumpServerCipher=&quot;ECDHE-RSA-AES128-GCM-SHA256&quot; SSLBumpSubject=&quot;-&quot;
</I>&gt;&gt;<i> SSLBumpIssuer=&quot;-&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I am doing something wrong or did I overlooked something?
</I>

&gt;<i> You told Squid to &quot;bump all&quot; which, by itself, means bump immediately
</I>&gt;<i> after client Hello arrives. 
</I>
In other words, you are doing a rough equivalent of the ancient
client-first bumping. To tell Squid to look at the client and server TLS
handshake messages (including the server certificate) before bumping the
connection, use something like this:

  ssl_bump stare all
  ssl_bump bump all


&gt;<i> So there is no server cert to get details
</I>&gt;<i> from until after bumping finishes
</I>
The log message contains a server cipher (%ssl::&lt;negotiated_cipher) so
Squid ought to know the certificate as well. The missing certificate in
this context sounds like a bug or a missing feature to me: Either the
server cipher should not be logged (if Squid did not see the origin
handshake yet) or both the cipher and the certificate details should be
logged. The only exception I could think of is a TLS negotiation error
where the server sends the cipher but not the certificate.

The above problem may not be important if, in fact, you did not actually
want to use client-first bumping (which usually does not work well),
_and_ staring at the server (i.e., stare all) logs the information you
want. However, that does not mean the problem is not there.


HTH,

Alex.
P.S. Your log entries will be malformed if certificate subject or issuer
contains a quote character.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="017618.html">[squid-users] squid4 with sslbump not logged server side cert_subject and cert_issuer
</A></li>
	<LI>Next message (by thread): <A HREF="017620.html">[squid-users] squid4 with sslbump not logged server side cert_subject and cert_issuer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17619">[ date ]</a>
              <a href="thread.html#17619">[ thread ]</a>
              <a href="subject.html#17619">[ subject ]</a>
              <a href="author.html#17619">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
