<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] tcp_outgoing_address issue how to deny traffic to other IPs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20tcp_outgoing_address%20issue%20how%20to%20deny%20traffic%20to%0A%20other%20IPs&In-Reply-To=%3CCAHvB88z_LfPqWiFO7nOm%2B3icob5jfW7zxTTw2u97sXK8if3jZQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017697.html">
   <LINK REL="Next"  HREF="017702.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] tcp_outgoing_address issue how to deny traffic to other IPs</H1>
    <B>Ivan Larionov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20tcp_outgoing_address%20issue%20how%20to%20deny%20traffic%20to%0A%20other%20IPs&In-Reply-To=%3CCAHvB88z_LfPqWiFO7nOm%2B3icob5jfW7zxTTw2u97sXK8if3jZQ%40mail.gmail.com%3E"
       TITLE="[squid-users] tcp_outgoing_address issue how to deny traffic to other IPs">xeron.oskom at gmail.com
       </A><BR>
    <I>Thu Feb 22 21:52:12 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="017697.html">[squid-users] tcp_outgoing_address issue how to deny traffic to	other IPs
</A></li>
        <LI>Next message (by thread): <A HREF="017702.html">[squid-users] tcp_outgoing_address issue how to deny traffic to other IPs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17700">[ date ]</a>
              <a href="thread.html#17700">[ thread ]</a>
              <a href="subject.html#17700">[ subject ]</a>
              <a href="author.html#17700">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Your balancing rules are incorrect. This is how we balance 30% per IP:

# 33% of traffic per local IP
acl third random 1/3
acl half random 1/2

tcp_outgoing_address X.X.X.2 third
tcp_outgoing_address X.X.X.3 half
tcp_outgoing_address X.X.X.4

Read <A HREF="https://wiki.squid-cache.org/Features/AclRandom.">https://wiki.squid-cache.org/Features/AclRandom.</A>

Basically for 1/5 you need something like this:

acl fifth random 1/5
acl fourth random 1/4
acl third random 1/3
acl half random 1/2

tcp_outgoing_address XX.3X.YYY.10 fifth
tcp_outgoing_address XX.X3.YYY.21 fourth
tcp_outgoing_address XX.5X.YYY.31 third
tcp_outgoing_address XX.X9.YYY.34 half
tcp_outgoing_address XX.5X.YYY.38


On Thu, Feb 22, 2018 at 10:15 AM, Patrick Chemla &lt;
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">patrick.chemla at performance-managers.com</A>&gt; wrote:

&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> I have googled for days and can't find the right settings to distribut
</I>&gt;<i> outgoing requests over part on local IPs of my server.
</I>&gt;<i>
</I>&gt;<i> This is my conf I built according to what I found on docs and forums:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Squid Cache: Version 4.0.17
</I>&gt;<i>
</I>&gt;<i> ------------
</I>&gt;<i>
</I>&gt;<i> blablabla
</I>&gt;<i>
</I>&gt;<i> blablabla
</I>&gt;<i>
</I>&gt;<i> blablabla
</I>&gt;<i>
</I>&gt;<i> ------------
</I>&gt;<i>
</I>&gt;<i> acl Percent001 random 1/5
</I>&gt;<i> acl Percent002 random 1/5
</I>&gt;<i> acl Percent003 random 1/5
</I>&gt;<i> acl Percent004 random 1/5
</I>&gt;<i> acl Percent005 random 1/5
</I>&gt;<i>
</I>&gt;<i> server_persistent_connections off
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> tcp_outgoing_address XX.3X.YYY.10 Percent001
</I>&gt;<i> tcp_outgoing_address XX.X3.YYY.21 Percent002
</I>&gt;<i> tcp_outgoing_address XX.5X.YYY.31 Percent003
</I>&gt;<i> tcp_outgoing_address XX.X9.YYY.34 Percent004
</I>&gt;<i> tcp_outgoing_address XX.5X.YYY.38 Percent005
</I>&gt;<i>
</I>&gt;<i> balance_on_multiple_ip on
</I>&gt;<i>
</I>&gt;<i> forwarded_for delete
</I>&gt;<i> via off
</I>&gt;<i>
</I>&gt;<i> My problem is that this server as
</I>&gt;<i>
</I>&gt;<i> - a main IP MA.IN.IP.00 of course
</I>&gt;<i>
</I>&gt;<i> - a locahost 127.0.0.1 of course
</I>&gt;<i>
</I>&gt;<i> - some secondary IPs attached to the same interface as the main IP
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> The input traffic comes through one of the secondaries, and I need the
</I>&gt;<i> output traffic to get out randomly through other secondaries IPs, not any
</I>&gt;<i> squid traffic from the main IP.
</I>&gt;<i>
</I>&gt;<i> When I look at the log, or using network tcpdump analyzer, I can see that
</I>&gt;<i> there is squid outgoing traffic on this IP, and I can't find how to deny
</I>&gt;<i> tcp_outgoing_address to be on the main IP.
</I>&gt;<i>
</I>&gt;<i> I hope it's clear, and I need help after I searched for days many
</I>&gt;<i> combinations.
</I>&gt;<i>
</I>&gt;<i> Many thanks
</I>&gt;<i>
</I>&gt;<i> Patrick
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>


-- 
With best regards, Ivan Larionov.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20180222/a2e47716/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20180222/a2e47716/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="017697.html">[squid-users] tcp_outgoing_address issue how to deny traffic to	other IPs
</A></li>
	<LI>Next message (by thread): <A HREF="017702.html">[squid-users] tcp_outgoing_address issue how to deny traffic to other IPs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17700">[ date ]</a>
              <a href="thread.html#17700">[ thread ]</a>
              <a href="subject.html#17700">[ subject ]</a>
              <a href="author.html#17700">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
