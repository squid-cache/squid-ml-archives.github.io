<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Help with UA filtering in https connections
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Help%20with%20UA%20filtering%20in%20https%20connections&In-Reply-To=%3C75beb196-f0c2-6e2c-1eee-17e92769a3e5%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017287.html">
   <LINK REL="Next"  HREF="017297.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Help with UA filtering in https connections</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Help%20with%20UA%20filtering%20in%20https%20connections&In-Reply-To=%3C75beb196-f0c2-6e2c-1eee-17e92769a3e5%40measurement-factory.com%3E"
       TITLE="[squid-users] Help with UA filtering in https connections">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Jan  2 16:06:43 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="017287.html">[squid-users] Help with UA filtering in https connections
</A></li>
        <LI>Next message (by thread): <A HREF="017297.html">[squid-users] Help with UA filtering in https connections
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17288">[ date ]</a>
              <a href="thread.html#17288">[ thread ]</a>
              <a href="subject.html#17288">[ subject ]</a>
              <a href="author.html#17288">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 01/02/2018 07:08 AM, Matus UHLAR - fantomas wrote:
&gt;<i> On 02.01.18 06:04, squidnoob wrote:
</I>&gt;&gt;<i> http_access allow CONNECT safe_ports
</I>&gt;&gt;<i> http_access deny CONNECT
</I>

&gt;&gt;<i> I understand adding this line that you suggested as it's not already
</I>&gt;&gt;<i> there.
</I>&gt;&gt;<i> http_access deny !safe_ports
</I>
Yes, this or similar line (and possibly other lines) is needed, provided
it matches your proxying environment. My sketch only dealt with your
original/specific problem, not general proxying protections...


&gt;&gt;<i> However, i don't understand why i would need to add this (http_access
</I>&gt;&gt;<i> deny CONNECT !SSL_Ports ) given the two lines above in the existing config.
</I>
You do not need to add it AFAICT.


&gt;<i> the two lines above unconditionally allow CONNECT anywhere, 
</I>
This is incorrect. The lines deny CONNECT to unsafe ports. What Amos
correctly pointed out is that *non-CONNECT* transactions may go to
unsafe ports as well, and it is considered best practice to block such
traffic by default.

Please note that denying CONNECTs to unsafe ports at step1 may not work
well because the generated by Squid certificate will be rejected by the
browser in many cases. You may decide to simply terminate such CONNECT
transactions instead:

  # terminate malicious tunnels and bump everything else
  ssl_bump terminate !safe_ports
  ssl_bump stare all
  ssl_bump bump all


Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="017287.html">[squid-users] Help with UA filtering in https connections
</A></li>
	<LI>Next message (by thread): <A HREF="017297.html">[squid-users] Help with UA filtering in https connections
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17288">[ date ]</a>
              <a href="thread.html#17288">[ thread ]</a>
              <a href="subject.html#17288">[ subject ]</a>
              <a href="author.html#17288">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
