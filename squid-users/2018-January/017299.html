<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] access blocking using DNS -&gt; &quot;NO Address records in response to '....'
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20access%20blocking%20using%20DNS%20-%3E%20%22NO%20Address%20records%0A%20in%20response%20to%20%27....%27&In-Reply-To=%3C8ca72a0a-fc37-bbbb-33a6-3c912d875cac%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017298.html">
   <LINK REL="Next"  HREF="017301.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] access blocking using DNS -&gt; &quot;NO Address records in response to '....'</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20access%20blocking%20using%20DNS%20-%3E%20%22NO%20Address%20records%0A%20in%20response%20to%20%27....%27&In-Reply-To=%3C8ca72a0a-fc37-bbbb-33a6-3c912d875cac%40treenet.co.nz%3E"
       TITLE="[squid-users] access blocking using DNS -&gt; &quot;NO Address records in response to '....'">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Jan  3 13:49:39 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="017298.html">[squid-users] access blocking using DNS -&gt; &quot;NO Address records in response to '....'
</A></li>
        <LI>Next message (by thread): <A HREF="017301.html">[squid-users] Squid crash: assertion failed: store_swapout.cc:289: &quot;mem-&gt;swapout.sio == self&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17299">[ date ]</a>
              <a href="thread.html#17299">[ thread ]</a>
              <a href="subject.html#17299">[ subject ]</a>
              <a href="author.html#17299">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 04/01/18 02:01, Paul Neuwirth wrote:
&gt;<i> On Thu, 4 Jan 2018 01:24:57 +1300
</I>&gt;<i> Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> On 03/01/18 20:34, Paul Neuwirth wrote:
</I>&gt;&gt;&gt;<i> On Wed, 3 Jan 2018 08:30:36 +0100
</I>&gt;&gt;&gt;<i> Paul Neuwirth wrote:
</I>&gt;&gt;&gt;<i>    
</I>&gt;&gt;&gt;&gt;<i> Hello list,
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> named is configured to block (resulting in NXDOMAIN) some domains.
</I>&gt;&gt;&gt;&gt;<i> Using squid I have following problem:
</I>&gt;&gt;&gt;&gt;<i> Browser requests such a blocked URL  and named is not delivering an
</I>&gt;&gt;&gt;&gt;<i> error, request never times out...
</I>&gt;&gt;&gt;&gt;<i> How can I make squid deliver an error in this case.
</I>&gt;&gt;&gt;&gt;<i>   
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ...
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Sorry, just a minute after sending I found out, named is not
</I>&gt;&gt;&gt;<i> delivering NXDOMAIN, but nothing
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Nod. That is the cause of the &quot;NO address records&quot; log entry.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The client appears to be disconnecting from Squid after ~10 seconds.
</I>&gt;&gt;<i> You can probably get the Squid &quot;unable to resolve&quot; error page to show
</I>&gt;&gt;<i> up by reducing dns_timeout to a value of 5-10 seconds
</I>&gt;&gt;<i> (&lt;<A HREF="http://www.squid-cache.org/Doc/config/dns_timeout/">http://www.squid-cache.org/Doc/config/dns_timeout/</A>&gt;).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Amos
</I>&gt;<i> 
</I>&gt;<i> thank you. But default is 60 seconds.. but the request never times out..
</I>
You missed the point. The access.log snippet presented said the 
connection got aborted after 10.140 seconds with 0 bytes delivered to 
the client - long before any Squid DNS lookups timeout.

Which implies strongly that the client is the one aborting the 
transaction. So to get that error page you wanted from Squid in that 
environment setup you would need to shorten dns_timeout to something 
that will make it produce an error page before the client disconnects.

OR, as you found anyway, changing the DNS systems behaviour to a faster 
response also changes the overall outcome ...

&gt;<i> 
</I>&gt;<i> but never mind.. I found a better solution, reconfigured bind using
</I>&gt;<i> response policy zones to send NXDOMAIN.. this feature didn't exist at
</I>&gt;<i> that time I did the previous config.
</I>
Nod, that is a bit better if you do it only for intentionally blocked 
domains. Otherwise it will now present lies about domains not existing 
when the truth is their no-IP state, which might muck up your future 
debugging of domain issues. So YMMV.

&gt;<i> 
</I>&gt;<i> have a nice year
</I>&gt;<i> 
</I>
Cheers, and same to you.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="017298.html">[squid-users] access blocking using DNS -&gt; &quot;NO Address records in response to '....'
</A></li>
	<LI>Next message (by thread): <A HREF="017301.html">[squid-users] Squid crash: assertion failed: store_swapout.cc:289: &quot;mem-&gt;swapout.sio == self&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17299">[ date ]</a>
              <a href="thread.html#17299">[ thread ]</a>
              <a href="subject.html#17299">[ subject ]</a>
              <a href="author.html#17299">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
