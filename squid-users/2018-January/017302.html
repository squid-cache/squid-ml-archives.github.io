<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Help with UA filtering in https connections
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Help%20with%20UA%20filtering%20in%20https%20connections&In-Reply-To=%3Ceb325a12-3f27-adfe-6c3d-65aa48982092%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017300.html">
   <LINK REL="Next"  HREF="017303.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Help with UA filtering in https connections</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Help%20with%20UA%20filtering%20in%20https%20connections&In-Reply-To=%3Ceb325a12-3f27-adfe-6c3d-65aa48982092%40measurement-factory.com%3E"
       TITLE="[squid-users] Help with UA filtering in https connections">rousskov at measurement-factory.com
       </A><BR>
    <I>Wed Jan  3 15:55:40 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="017300.html">[squid-users] Help with UA filtering in https connections
</A></li>
        <LI>Next message (by thread): <A HREF="017303.html">[squid-users] Help with UA filtering in https connections
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17302">[ date ]</a>
              <a href="thread.html#17302">[ thread ]</a>
              <a href="subject.html#17302">[ subject ]</a>
              <a href="author.html#17302">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 01/03/2018 05:52 AM, Matus UHLAR - fantomas wrote:
&gt;<i> On 02.01.18 09:06, Alex Rousskov wrote:
</I>&gt;&gt;<i> On 01/02/2018 07:08 AM, Matus UHLAR - fantomas wrote:
</I>&gt;&gt;&gt;<i> On 02.01.18 06:04, squidnoob wrote:
</I>&gt;&gt;&gt;&gt;<i> http_access allow CONNECT safe_ports
</I>&gt;&gt;&gt;&gt;<i> http_access deny CONNECT
</I>
&gt;&gt;&gt;<i> the two lines above unconditionally allow CONNECT anywhere,
</I>
&gt;&gt;<i> This is incorrect. The lines deny CONNECT to unsafe ports.
</I>
&gt;<i> Those lines unconditionally allow CONNECT requests to safe ports ANYWHERE,
</I>
Yes, or, to be more precise, they (together with ssl_bump rules) allow
fetching of any server certificate from a reasonable(*) port. They do
not allow HTTP requests to arbitrary safe ports. Only Squid-generated
TLS handshakes.


&gt;<i> which is apparently not what was wanted/expected.
</I>
Why not?


&gt;<i> that in this case you can[not] deny the connect request later,
</I>
Denying CONNECTs at step1 does not really work well in a general case
because, during SslBump step1, Squid does not have enough information to
generate the right certificate for the access denial error page.

In a general case, the admin has to pick between two evils:

* Allow TLS handshakes with arbitrary servers on TLS ports (my sketch)

* or tell Squid to respond with error pages that the user cannot see
  (without bypassing browser security warnings).

Which evil is lesser is up to the admin to decide. Needless to say,
there are environments where both strategies should be used, depending
on the transaction parameters.


(*) We should allow CONNECTs to SSL_ports, not Safe_ports. I hope my
sketch did not use those ACLs.

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="017300.html">[squid-users] Help with UA filtering in https connections
</A></li>
	<LI>Next message (by thread): <A HREF="017303.html">[squid-users] Help with UA filtering in https connections
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17302">[ date ]</a>
              <a href="thread.html#17302">[ thread ]</a>
              <a href="subject.html#17302">[ subject ]</a>
              <a href="author.html#17302">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
