<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] TCP out of memory
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TCP%20out%20of%20memory&In-Reply-To=%3Cdb3dd9ad-c49d-f649-99c8-f199b7844054%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017321.html">
   <LINK REL="Next"  HREF="017324.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] TCP out of memory</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TCP%20out%20of%20memory&In-Reply-To=%3Cdb3dd9ad-c49d-f649-99c8-f199b7844054%40treenet.co.nz%3E"
       TITLE="[squid-users] TCP out of memory">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon Jan  8 12:50:23 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="017321.html">[squid-users] TCP out of memory
</A></li>
        <LI>Next message (by thread): <A HREF="017324.html">[squid-users] TCP out of memory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17322">[ date ]</a>
              <a href="thread.html#17322">[ thread ]</a>
              <a href="subject.html#17322">[ subject ]</a>
              <a href="author.html#17322">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 08/01/18 11:13, Vieri wrote:
&gt;<i> 
</I>&gt;<i> ________________________________
</I>&gt;<i> From: Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;
</I>&gt;<i> 
</I>&gt;&gt;&gt;<i> The open sockets to 127.0.0.1:1344 keep increasing steadily even on high network usage, but they do not decrease when there's
</I>&gt;&gt;&gt;<i> little or no traffic.&gt;&gt; So, day after day the overall number keeps growing until I have to restart squid once or twice a week.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> In other words, this value keeps growing:
</I>&gt;&gt;&gt;<i> Largest file desc currently in use:   xxxx
</I>&gt;&gt;&gt;<i> This other value can decrease at times, but in the long run it keeps growing too:
</I>&gt;&gt;&gt;<i> Number of file desc currently in use: xxxx
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i> Ah. What does the cachemgr &quot;filedescriptors&quot; report show when there are
</I>&gt;&gt;<i> a lot starting to accumulate?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> And, are you able to get a cache.log trace with &quot;debug_options 93,6&quot; ?
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Here's my cache.log:
</I>&gt;<i> 
</I>&gt;<i> <A HREF="https://drive.google.com/file/d/1I8R5sCsIGhYa69QmGrOoHVITuom4uW0k/view?usp=sharing">https://drive.google.com/file/d/1I8R5sCsIGhYa69QmGrOoHVITuom4uW0k/view?usp=sharing</A>
</I>&gt;<i> 
</I>&gt;<i> squidclient's filedescriptors:
</I>&gt;<i> 
</I>&gt;<i> <A HREF="https://drive.google.com/file/d/1o6zn-o0atqeqFGSMRhPA9r1AAFJpnpBZ/view?usp=sharing">https://drive.google.com/file/d/1o6zn-o0atqeqFGSMRhPA9r1AAFJpnpBZ/view?usp=sharing</A>
</I>&gt;<i> 
</I>&gt;<i> The info page:
</I>&gt;<i> 
</I>&gt;<i> <A HREF="https://drive.google.com/file/d/11iWqjgdt2KK1yWPMsr5o-IyWGyKS7joc/view?usp=sharing">https://drive.google.com/file/d/11iWqjgdt2KK1yWPMsr5o-IyWGyKS7joc/view?usp=sharing</A>
</I>&gt;<i> 
</I>&gt;<i> The open fds are at around 7k, but they can easily reach 12k or 13k. That's when I start running into trouble.
</I>&gt;<i> 
</I>
Thank you.

I have only taken a brief look, but so far it looks like the problematic 
sockets are not participating in any ICAP activity. That implies they 
are possibly TCP connections which never complete their opening 
sequence, or at least the result of connection attempts does not make it 
back to the ICAP code somehow.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="017321.html">[squid-users] TCP out of memory
</A></li>
	<LI>Next message (by thread): <A HREF="017324.html">[squid-users] TCP out of memory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17322">[ date ]</a>
              <a href="thread.html#17322">[ thread ]</a>
              <a href="subject.html#17322">[ subject ]</a>
              <a href="author.html#17322">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
