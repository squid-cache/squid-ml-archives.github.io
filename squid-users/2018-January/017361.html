<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] persistent connections not being utilized with Chrome
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20persistent%20connections%20not%20being%20utilized%20with%0A%20Chrome&In-Reply-To=%3C9ca490f3-e813-3c36-0a0f-2ad8d86ce8d3%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017360.html">
   <LINK REL="Next"  HREF="017367.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] persistent connections not being utilized with Chrome</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20persistent%20connections%20not%20being%20utilized%20with%0A%20Chrome&In-Reply-To=%3C9ca490f3-e813-3c36-0a0f-2ad8d86ce8d3%40measurement-factory.com%3E"
       TITLE="[squid-users] persistent connections not being utilized with Chrome">rousskov at measurement-factory.com
       </A><BR>
    <I>Sat Jan 13 04:34:29 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="017360.html">[squid-users] persistent connections not being utilized with	Chrome
</A></li>
        <LI>Next message (by thread): <A HREF="017367.html">[squid-users] persistent connections not being utilized with	Chrome
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17361">[ date ]</a>
              <a href="thread.html#17361">[ thread ]</a>
              <a href="subject.html#17361">[ subject ]</a>
              <a href="author.html#17361">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 01/12/2018 08:23 PM, Brian J. Murrell wrote:

&gt;<i> I mean, will not actually result in a persistent connection -- a socket
</I>&gt;<i> that is reused for multiple HTTP transactions. 
</I>
It is best to think of HTTP persistency as applying to an HTTP
connection rather than a TCP connection/socket. Without a proxy, your
definition works well. With a proxy, there are several different use
cases. The one you seem to be interested in is encrypted HTTP connection
through an explicit proxy. In that case, there are two HTTP connections
in play:

  1. An HTTP connection from the client to the origin server.
  2. An HTTP connection from the client to the proxy.

Both HTTP connections use the same TCP client connection/socket (there
is also another TCP server connection socket that HTTP connection #1
also uses).

The first HTTP connection can carry lots of transactions. It can easily
be and often is &quot;persistent&quot;.

The second HTTP connection typically carries just one HTTP transaction
(a CONNECT request followed by a 200 OK response establishing a TCP
tunnel through the proxy), but that is OK -- it does not hurt
performance because the useful transactions utilize HTTP connection #1
(which lives inside the tunnel established by the HTTP connection #2).


&gt;<i> I suppose for CONNECT
</I>&gt;<i> it would mean either multiple CONNECTs within a single socket or one
</I>&gt;<i> CONNECT with multiple &quot;GET/POST&quot; type transactions within it.
</I>
Authentication and other corner cases aside, there can be at most one
CONNECT request per HTTP connection, but you do not care (much) about
_that_ HTTP connection. The other HTTP connection (the one inside the
CONNECT tunnel) can carry lots of requests, and those transactions
actually deliver &quot;pages&quot; to your browser.


&gt;<i> So, for the purposes of the WWW's current move towards all-https
</I>&gt;<i> websites, persistent connections (perhaps only with proxy servers?) are
</I>&gt;<i> becoming useless?
</I>
No, the optimization is still there as far as client-origin traffic is
concerned.


&gt;<i> The problem I am trying to solve here is that opening Chrome with, say,
</I>&gt;<i> a few hundred tabs open, seems to take about an hour for it to finally
</I>&gt;<i> fetch all of the pages while most sit spinning on &quot;waiting for an
</I>&gt;<i> available socket&quot; or &quot;proxy tunnel&quot;, etc., for a long time, which is
</I>&gt;<i> probably due to Chrome's limit on the number of concurrent sockets it
</I>&gt;<i> will open to a single destination, including proxy servers.  
</I>
Yes, probably something like that is happening.


&gt;<i> I was hoping persistent connections would reduce the socket
</I>&gt;<i> setup/teardown overhead of all of that.
</I>
Perhaps they do? How many requests does Chrome send inside a CONNECT
tunnel through Squid, on average? If you bump CONNECT tunnels using
SslBump, then you can use Squid to measure persistency. If you do not
bump, then you should still be able to use Chrome developer tools to
measure persistency.

Origin server response delays rather than TCP handshakes may be your
primary bottleneck because Chrome probably does not pipeline and,
without pipelining, there can be at most one concurrent request per HTTP
connection. To improve throughput in your environment (without raising
the number of TCP connections that Chrome is allowed to open), you would
need to wait for HTTP/2 support. In HTTP/2, a single HTTP connection can
carry lots of concurrent transactions.


HTH,

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="017360.html">[squid-users] persistent connections not being utilized with	Chrome
</A></li>
	<LI>Next message (by thread): <A HREF="017367.html">[squid-users] persistent connections not being utilized with	Chrome
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17361">[ date ]</a>
              <a href="thread.html#17361">[ thread ]</a>
              <a href="subject.html#17361">[ subject ]</a>
              <a href="author.html#17361">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
