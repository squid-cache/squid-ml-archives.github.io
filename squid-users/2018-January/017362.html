<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid and SSL Bump
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20and%20SSL%20Bump&In-Reply-To=%3Cc65e12d9-ea2b-a369-fd76-1440975da1fe%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017355.html">
   <LINK REL="Next"  HREF="017351.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid and SSL Bump</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20and%20SSL%20Bump&In-Reply-To=%3Cc65e12d9-ea2b-a369-fd76-1440975da1fe%40treenet.co.nz%3E"
       TITLE="[squid-users] Squid and SSL Bump">squid3 at treenet.co.nz
       </A><BR>
    <I>Sat Jan 13 18:28:00 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="017355.html">[squid-users] Squid and SSL Bump
</A></li>
        <LI>Next message (by thread): <A HREF="017351.html">[squid-users] Squid and SSL Bump
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17362">[ date ]</a>
              <a href="thread.html#17362">[ thread ]</a>
              <a href="subject.html#17362">[ subject ]</a>
              <a href="author.html#17362">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 13/01/18 02:00, Yoinier Hernandez Nieves wrote:
&gt;<i> 
</I>&gt;<i> The user ynieves is member of ad groups &#8220;internet&#8221;, &#8220;socialNetwork&#8221;, &#8220;youtube&#8221; and &#8220;moderadoresSocNet&quot;
</I>&gt;<i> 
</I>
So most of your http_access lines end with group checks. That could be a 
problem later. Right now its not clear which would be rejecting with 
that auth message, and the status being 403 indicates a hard failure 
rather than re-auth.


I suggest doing the usual thing of placing a single &quot;http_access deny 
!users&quot; line first, then appending &quot; all&quot; to the lines that normally end 
with a group check.

Like:

   http_access deny !users

   http_access allow cubaDomains cubaPC all
   http_access allow cubaDomains national all
   http_access allow cubaDomains internet all
   http_access deny SQUISHED1 all

   http_access allow socialDomains moderadoresSocNet all
   http_access allow socialTime socialDomains socialNetwork all
   http_access allow socialTime youtubeDomains youtuber all


For the delay pools there is no need to re-authenticate at all. Use the 
&quot;note&quot; ACL type to check that a username exists. Like so:

   acl loggedIn note user .

   delay_access 2 allow loggedIn workTime \
     !extDownloads !extDocuments !delaysFree


Also, the pool using only &quot;-1/-1&quot; as its paremeters should be removed. 
Squid links multiple pools to a transaction, so it is not doing what you 
think it does. To make certain transactions unlimited simply deny them 
being added to the other pools. That will also make your existing rules 
much simpler:

   denya_access 2 deny delaysFree
   delay_access 2 allow loggedIn workTime !extDownloads !extDocuments !
   delay_access 2 deny all


Also, your media and mediapr checks are slow regex tests. They should be 
placed after the default security checks.


If the problem remains after all the above changes are made you will 
need to track down what is generating the error page using cache.log 
trace with &quot;debug_options ALL,5&quot;.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="017355.html">[squid-users] Squid and SSL Bump
</A></li>
	<LI>Next message (by thread): <A HREF="017351.html">[squid-users] Squid and SSL Bump
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17362">[ date ]</a>
              <a href="thread.html#17362">[ thread ]</a>
              <a href="subject.html#17362">[ subject ]</a>
              <a href="author.html#17362">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
