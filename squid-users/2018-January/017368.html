<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] persistent connections not being utilized	with	Chrome
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20persistent%20connections%20not%20being%20utilized%0A%09with%09Chrome&In-Reply-To=%3CAM4PR0401MB219422D71D0B702D672220698FEB0%40AM4PR0401MB2194.eurprd04.prod.outlook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017367.html">
   <LINK REL="Next"  HREF="017370.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] persistent connections not being utilized	with	Chrome</H1>
    <B>Rafael Akchurin</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20persistent%20connections%20not%20being%20utilized%0A%09with%09Chrome&In-Reply-To=%3CAM4PR0401MB219422D71D0B702D672220698FEB0%40AM4PR0401MB2194.eurprd04.prod.outlook.com%3E"
       TITLE="[squid-users] persistent connections not being utilized	with	Chrome">rafael.akchurin at diladele.com
       </A><BR>
    <I>Mon Jan 15 16:06:34 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="017367.html">[squid-users] persistent connections not being utilized with	Chrome
</A></li>
        <LI>Next message (by thread): <A HREF="017370.html">[squid-users] persistent connections not being utilized	with	Chrome
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17368">[ date ]</a>
              <a href="thread.html#17368">[ thread ]</a>
              <a href="subject.html#17368">[ subject ]</a>
              <a href="author.html#17368">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Brian,

Sorry not to flame it all out further - but I see the same annoying &quot;waiting for proxy tunnel&quot; in Chrome through SSL bumping AD integrated explicit Squid.
*but* the same 200 of tabs loads just fine from FF and the same Squid on the same machine at the same time - so might be a Chrome issue/architecture?

Best regards,
Rafael Akchurin
Diladele B.V.


-----Original Message-----
From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of Brian J. Murrell
Sent: Monday, January 15, 2018 4:41 PM
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] persistent connections not being utilized with Chrome

On Fri, 2018-01-12 at 21:34 -0700, Alex Rousskov wrote:
&gt;<i> In that case, there are two HTTP
</I>&gt;<i> connections
</I>&gt;<i> in play:
</I>&gt;<i> 
</I>&gt;<i>   1. An HTTP connection from the client to the origin server.
</I>
By this do you mean to say there is a connection from the client, through the proxy server to the origin server?

&gt;<i>   2. An HTTP connection from the client to the proxy.
</I>&gt;<i> 
</I>&gt;<i> Both HTTP connections use the same TCP client connection/socket
</I>
Understood.  So I do believe you are ACKing my question above.

&gt;<i> No, the optimization is still there as far as client-origin traffic is 
</I>&gt;<i> concerned.
</I>
Except that it is all bottle-necked through the same open-TCP-socket limitations that Chrome has to a single destination.  I think what I want to see is those limited number of TCP-sockets better utilized. 
But maybe that cannot happen without pipelining.

&gt;<i> Yes, probably something like that is happening.
</I>
So how do I ameliorate it?

&gt;<i> Perhaps they do? How many requests does Chrome send inside a CONNECT 
</I>&gt;<i> tunnel through Squid, on average?
</I>
My short investigation using packet sniffing seems to indicate just one.

&gt;<i> If you bump CONNECT tunnels using
</I>&gt;<i> SslBump, then you can use Squid to measure persistency. If you do not 
</I>&gt;<i> bump, then you should still be able to use Chrome developer tools to 
</I>&gt;<i> measure persistency.
</I>
Any clues about how do to do that?

&gt;<i> Origin server response delays rather than TCP handshakes may be your 
</I>&gt;<i> primary bottleneck because Chrome probably does not pipeline and, 
</I>&gt;<i> without pipelining, there can be at most one concurrent request per 
</I>&gt;<i> HTTP connection.
</I>
I think Chrome disabled pipelining a while back:

<A HREF="https://stackoverflow.com/questions/30477476/why-is-pipelining-disabled-in-modern-browsers">https://stackoverflow.com/questions/30477476/why-is-pipelining-disabled-in-modern-browsers</A>

&gt;<i> To improve throughput in your environment (without raising the number 
</I>&gt;<i> of TCP connections that Chrome is allowed to open), you would need to 
</I>&gt;<i> wait for HTTP/2 support. In HTTP/2, a single HTTP connection can carry 
</I>&gt;<i> lots of concurrent transactions.
</I>
So are people without proxies suffering this same issue?  I don't think they are because their few hundred tabs will all be much more distributed to various servers and domains across the Internet allowing their Chrome to open many (many!) more parallel TCP connections and wait for them all to respond in parallel.

It's the concentration of all of those potential TCP connections through a single host -- the proxy server -- that is greatly reducing the parallelism of fetching lots of objects at the same time and dragging it's wall-clock time out.

Perhaps there is no solution until HTTP/2.

I just find it surprising that every IT person that utilizes a proxy has to tell their users, &quot;yeah, that's just how it is here in this network, very slow to start up your browser&quot;.  :-(

Cheers,
b.
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="017367.html">[squid-users] persistent connections not being utilized with	Chrome
</A></li>
	<LI>Next message (by thread): <A HREF="017370.html">[squid-users] persistent connections not being utilized	with	Chrome
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17368">[ date ]</a>
              <a href="thread.html#17368">[ thread ]</a>
              <a href="subject.html#17368">[ subject ]</a>
              <a href="author.html#17368">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
