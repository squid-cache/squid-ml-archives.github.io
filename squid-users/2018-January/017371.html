<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] persistent connections not being utilized with Chrome
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20persistent%20connections%20not%20being%20utilized%20with%0A%20Chrome&In-Reply-To=%3C74eba86c-ef4c-9bf8-f65b-e8098c9ee8c0%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017370.html">
   <LINK REL="Next"  HREF="017373.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] persistent connections not being utilized with Chrome</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20persistent%20connections%20not%20being%20utilized%20with%0A%20Chrome&In-Reply-To=%3C74eba86c-ef4c-9bf8-f65b-e8098c9ee8c0%40measurement-factory.com%3E"
       TITLE="[squid-users] persistent connections not being utilized with Chrome">rousskov at measurement-factory.com
       </A><BR>
    <I>Mon Jan 15 17:56:45 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="017370.html">[squid-users] persistent connections not being utilized	with	Chrome
</A></li>
        <LI>Next message (by thread): <A HREF="017373.html">[squid-users] persistent connections not being utilized with	Chrome
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17371">[ date ]</a>
              <a href="thread.html#17371">[ thread ]</a>
              <a href="subject.html#17371">[ subject ]</a>
              <a href="author.html#17371">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 01/15/2018 08:40 AM, Brian J. Murrell wrote:
&gt;<i> On Fri, 2018-01-12 at 21:34 -0700, Alex Rousskov wrote:
</I>&gt;&gt;<i> In that case, there are two HTTP connections in play:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   1. An HTTP connection from the client to the origin server.
</I>

&gt;<i> By this do you mean to say there is a connection from the client,
</I>&gt;<i> through the proxy server to the origin server?
</I>
No, I do not mean to say that. From HTTP point of view, that first HTTP
connection is from client to the origin server. The fact that a proxy
forwards those raw bytes is irrelevant in this context: You are not
saying &quot;a connection from the client, through the WiFi router, through
the cat5e cable, through the Ethernet switch, through the proxy, through
the fiber optic cable, through ..., to the origin server, do you?
(Rhetorical).

If your Squid bumps the CONNECT tunnel, then Squid may interfere with
what happens on that connection, and, hence, Squid presence becomes
important. Otherwise, it is all between a browser and an origin server.
My classification is based on the classic/standard layout when Squid
does not perform a MitM attack. It is easier to understand persistency
on that level and then add exceptions for SslBump, etc. as/if needed.


&gt;&gt;<i>   2. An HTTP connection from the client to the proxy.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Both HTTP connections use the same TCP client connection/socket 
</I>

&gt;&gt;<i> No, the optimization is still there as far as client-origin traffic
</I>&gt;&gt;<i> is concerned.
</I>
&gt;<i> Except that it is all bottle-necked through the same open-TCP-socket
</I>&gt;<i> limitations that Chrome has to a single destination.  
</I>
Yes, but understanding where the bottleneck(s) are is obviously
important. There are currently two very different suspects discussed on
this thread:

* A limit on the number of TCP connections a browser can open.

* A limit on the number of raw HTTP transactions a browser can perform
for each TCP connection opened.

The HTTP persistency affects the latter but not the former. You asked
about persistency, and I tried to explain how it works in your context
so that you can distinguish between the two suspects above. It is
possible that there are two bottlenecks (i.e., removing only one of them
is not going to significantly improve your situation).


&gt;&gt;<i> Yes, probably something like that is happening.
</I>&gt;<i> 
</I>&gt;<i> So how do I ameliorate it?
</I>
1. Configure your browser to open more TCP connections. If the current
limit is specific to using a forward proxy, consider complaining to
browser developers and using a transparent proxy.

2. If your Squid uses SslBump, investigate whether bumped HTTP
connections between the client and the origin server are needlessly
closed by Squid.

3. Check whether Chrome supports HTTP/2 proxies and, if it does,
facilitate HTTP/2 development in Squid.


&gt;&gt;<i> Perhaps they do? How many requests does Chrome send inside a CONNECT
</I>&gt;&gt;<i> tunnel through Squid, on average?
</I>
&gt;<i> My short investigation using packet sniffing seems to indicate just
</I>&gt;<i> one.
</I>
Just to double check: You only saw a single HTTP GET (or similar)
request inside most CONNECT tunnels? If yes, did the response indicate
the desire to keep the connection open? If yes, which TCP connection was
closed first and by which side? Client-Squid or Squid-origin?


&gt;&gt;<i> If you bump CONNECT tunnels using
</I>&gt;&gt;<i> SslBump, then you can use Squid to measure persistency. If you do not
</I>&gt;&gt;<i> bump, then you should still be able to use Chrome developer tools to
</I>&gt;&gt;<i> measure persistency.
</I>
&gt;<i> Any clues about how do to do that?
</I>
I cannot detail the steps right now but others on this list might be
able to guide you. To improve your chances, you may want to specify
which of the two scenarios apply to you (and what you have tried already).


&gt;<i> I just find it surprising that every IT person that utilizes a proxy
</I>&gt;<i> has to tell their users, &quot;yeah, that's just how it is here in this
</I>&gt;<i> network, very slow to start up your browser&quot;.  :-(
</I>
I speculate that most users do not have a few hundred browser tabs.

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="017370.html">[squid-users] persistent connections not being utilized	with	Chrome
</A></li>
	<LI>Next message (by thread): <A HREF="017373.html">[squid-users] persistent connections not being utilized with	Chrome
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17371">[ date ]</a>
              <a href="thread.html#17371">[ thread ]</a>
              <a href="subject.html#17371">[ subject ]</a>
              <a href="author.html#17371">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
