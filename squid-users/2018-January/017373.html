<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] persistent connections not being utilized with	Chrome
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20persistent%20connections%20not%20being%20utilized%20with%0A%09Chrome&In-Reply-To=%3C1516041175.24075.61.camel%40interlinx.bc.ca%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017371.html">
   <LINK REL="Next"  HREF="017375.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] persistent connections not being utilized with	Chrome</H1>
    <B>Brian J. Murrell</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20persistent%20connections%20not%20being%20utilized%20with%0A%09Chrome&In-Reply-To=%3C1516041175.24075.61.camel%40interlinx.bc.ca%3E"
       TITLE="[squid-users] persistent connections not being utilized with	Chrome">brian at interlinx.bc.ca
       </A><BR>
    <I>Mon Jan 15 18:32:55 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="017371.html">[squid-users] persistent connections not being utilized with Chrome
</A></li>
        <LI>Next message (by thread): <A HREF="017375.html">[squid-users] persistent connections not being utilized with Chrome
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17373">[ date ]</a>
              <a href="thread.html#17373">[ thread ]</a>
              <a href="subject.html#17373">[ subject ]</a>
              <a href="author.html#17373">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, 2018-01-15 at 10:56 -0700, Alex Rousskov wrote:
&gt;<i> On 01/15/2018 08:40 AM, Brian J. Murrell wrote:
</I>&gt;<i> &gt; On Fri, 2018-01-12 at 21:34 -0700, Alex Rousskov wrote:
</I>&gt;<i> &gt; &gt; In that case, there are two HTTP connections in play:
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt;   1. An HTTP connection from the client to the origin 
</I>&gt;<i> &gt; &gt; server.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> &gt; By this do you mean to say there is a connection from the client,
</I>&gt;<i> &gt; through the proxy server to the origin server?
</I>&gt;<i> 
</I>&gt;<i> No, I do not mean to say that. From HTTP point of view, that first
</I>&gt;<i> HTTP
</I>&gt;<i> connection is from client to the origin server.
</I>
Well, to my reading, to omit the clarification that the connection is
through the proxy server means that the connection is directly from the
client to origin server, bypassing the proxy server.

&gt;<i> The fact that a proxy
</I>&gt;<i> forwards those raw bytes is irrelevant in this context: You are not
</I>&gt;<i> saying &quot;a connection from the client, through the WiFi router,
</I>&gt;<i> through
</I>&gt;<i> the cat5e cable, through the Ethernet switch, through the proxy,
</I>&gt;<i> through
</I>&gt;<i> the fiber optic cable, through ..., to the origin server, do you?
</I>
No.  Of course I don't name every component which is common to most/all
cases.  But a proxy server is not always in the path so it is worth
spelling out if you do actually mean a connection through the proxy. 
Because as I said above, for most people, there is no proxy involved
and so &quot;client to the origin server&quot; could very well mean a single
socket directly between the two.

It is also important to specify because it implies multiple TCP
connection between the client and the origin server and not just one
and it also implies a single, common IP address to which the browser
connects to get to the origin server, not the origin server's IP
address.  These are all very important factors in this situation.

&gt;<i> If your Squid bumps the CONNECT tunnel,
</I>
It does not.

&gt;<i> then Squid may interfere with
</I>&gt;<i> what happens on that connection, and, hence, Squid presence becomes
</I>&gt;<i> important. Otherwise, it is all between a browser and an origin
</I>&gt;<i> server.
</I>
Except that it's not.  At the TCP socket level it's between the browser
and the proxy server and this is an important factor.

&gt;<i> Yes, but understanding where the bottleneck(s) are is obviously
</I>&gt;<i> important. There are currently two very different suspects discussed
</I>&gt;<i> on
</I>&gt;<i> this thread:
</I>&gt;<i> 
</I>&gt;<i> * A limit on the number of TCP connections a browser can open.
</I>
Chrome has a fixed (unconfigurable) limit on the number of connections
it will open to a server and I don't believe it provides for any
distinction whether that server is an origin server or a proxy server. 
If I am wrong about this latter aspect, then much of this goes out the
window.

This limitation is what is important here.  Because in a non-proxied
world, the browser can hit this maximum many many times over, once for
each origin server.  But in a proxied world, it can only hit this
maximum once, for the proxy server.  For 10 tabs, open to 10 different
websites, this can mean that without a proxy, it can open 60
connections, vastly parallelizing the fetching of those pages.  But
when a proxy is involved it is limited to opening 6 connections and
trying to fetch all of those pages through those 6 instead of the 60 it
can use without a proxy.

&gt;<i> 1. Configure your browser to open more TCP connections.
</I>
I don't believe that is possible with Chrome.

&gt;<i> If the
</I>&gt;<i> current
</I>&gt;<i> limit is specific to using a forward proxy, consider complaining to
</I>&gt;<i> browser developers and using a transparent proxy.
</I>
Not a viable solution.  Yes, I could complain, but my users don't
really care that I have complained.  They are still stuck with massive
browser startup times.

&gt;<i> Just to double check: You only saw a single HTTP GET (or similar)
</I>&gt;<i> request inside most CONNECT tunnels?
</I>
I cannot look inside CONNECT tunnels.  I don't MitM my users' SSL
connections.  But I did see only one CONNECT per TCP connection to the
proxy server from the Chrome browser.

&gt;<i> If yes, did the response indicate
</I>&gt;<i> the desire to keep the connection open?
</I>
Yes.

&gt;<i> If yes, which TCP connection was
</I>&gt;<i> closed first and by which side? Client-Squid or Squid-origin?
</I>
Squid closed the connection to origin first.

&gt;<i> I speculate that most users do not have a few hundred browser tabs.
</I>
Perhaps that is the case.

b.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 488 bytes
Desc: This is a digitally signed message part
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20180115/718cc488/attachment.sig">http://lists.squid-cache.org/pipermail/squid-users/attachments/20180115/718cc488/attachment.sig</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="017371.html">[squid-users] persistent connections not being utilized with Chrome
</A></li>
	<LI>Next message (by thread): <A HREF="017375.html">[squid-users] persistent connections not being utilized with Chrome
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17373">[ date ]</a>
              <a href="thread.html#17373">[ thread ]</a>
              <a href="subject.html#17373">[ subject ]</a>
              <a href="author.html#17373">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
