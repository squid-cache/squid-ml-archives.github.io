<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Logging PROXY Protocol header
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Logging%20PROXY%20Protocol%20header&In-Reply-To=%3C81c71c0f-7827-c1c6-f975-69ca77fbdba8%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017369.html">
   <LINK REL="Next"  HREF="017391.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Logging PROXY Protocol header</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Logging%20PROXY%20Protocol%20header&In-Reply-To=%3C81c71c0f-7827-c1c6-f975-69ca77fbdba8%40treenet.co.nz%3E"
       TITLE="[squid-users] Logging PROXY Protocol header">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon Jan 15 18:48:08 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="017369.html">[squid-users] Logging PROXY Protocol header
</A></li>
        <LI>Next message (by thread): <A HREF="017391.html">[squid-users] SQUID with two authentications methods
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17374">[ date ]</a>
              <a href="thread.html#17374">[ thread ]</a>
              <a href="subject.html#17374">[ subject ]</a>
              <a href="author.html#17374">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 16/01/18 05:26, Bruce R wrote:
&gt;<i> Is it possible to configure Squid to log the details of the PROXY 
</I>&gt;<i> protocol when using it? We're running Squid 3.5.20 in AWS behind a TCP 
</I>&gt;<i> load balancer, which supports forwarding the PROXY protocol header. I'd 
</I>&gt;<i> like to be able to include the client IP as provided in the PROXY 
</I>&gt;<i> protocol header, but I'd be happy to log the entire header as well if 
</I>&gt;<i> necessary. I've spent some time searching for information on this but 
</I>&gt;<i> haven't had any luck so far.
</I>
When the PROXY protocol is received the details it supplies replace the 
TCP connection supplied values. That means everything in Squid dealing 
with client-IP or port displays or uses the PROXY values.

In squid.conf add the option &quot;require-proxy-header&quot; on the http_port you 
are receiving traffic from the LB. It is then important that you prevent 
traffic arriving from anywhere else than trusted sources. It is left to 
you to configure your firewall appropriately.


If you really want to see PROXY happening it is recorded in cache.log 
with &quot;debug_options 33,5&quot;

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="017369.html">[squid-users] Logging PROXY Protocol header
</A></li>
	<LI>Next message (by thread): <A HREF="017391.html">[squid-users] SQUID with two authentications methods
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17374">[ date ]</a>
              <a href="thread.html#17374">[ thread ]</a>
              <a href="subject.html#17374">[ subject ]</a>
              <a href="author.html#17374">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
