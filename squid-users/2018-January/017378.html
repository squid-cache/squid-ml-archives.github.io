<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] persistent connections not being utilized with Chrome
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20persistent%20connections%20not%20being%20utilized%20with%0A%20Chrome&In-Reply-To=%3C68585dfd-dcb9-81e4-1298-29f3254279e6%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017375.html">
   <LINK REL="Next"  HREF="017379.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] persistent connections not being utilized with Chrome</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20persistent%20connections%20not%20being%20utilized%20with%0A%20Chrome&In-Reply-To=%3C68585dfd-dcb9-81e4-1298-29f3254279e6%40measurement-factory.com%3E"
       TITLE="[squid-users] persistent connections not being utilized with Chrome">rousskov at measurement-factory.com
       </A><BR>
    <I>Mon Jan 15 19:26:40 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="017375.html">[squid-users] persistent connections not being utilized with Chrome
</A></li>
        <LI>Next message (by thread): <A HREF="017379.html">[squid-users] persistent connections not being utilized with	Chrome
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17378">[ date ]</a>
              <a href="thread.html#17378">[ thread ]</a>
              <a href="subject.html#17378">[ subject ]</a>
              <a href="author.html#17378">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 01/15/2018 11:32 AM, Brian J. Murrell wrote:
&gt;<i> On Mon, 2018-01-15 at 10:56 -0700, Alex Rousskov wrote:
</I>&gt;&gt;<i> On 01/15/2018 08:40 AM, Brian J. Murrell wrote:
</I>&gt;&gt;&gt;<i> On Fri, 2018-01-12 at 21:34 -0700, Alex Rousskov wrote:
</I>&gt;&gt;&gt;&gt;<i> In that case, there are two HTTP connections in play:
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>   1. An HTTP connection from the client to the origin 
</I>&gt;&gt;&gt;&gt;<i> server.
</I>
&gt;&gt;&gt;<i> By this do you mean to say there is a connection from the client,
</I>&gt;&gt;&gt;<i> through the proxy server to the origin server?
</I>
&gt;&gt;<i> No, I do not mean to say that. From HTTP point of view, that first
</I>&gt;&gt;<i> HTTP connection is from client to the origin server.
</I>
&gt;<i> Well, to my reading, to omit the clarification that the connection is
</I>&gt;<i> through the proxy server means that the connection is directly from the
</I>&gt;<i> client to origin server, bypassing the proxy server.
</I>
The HTTP connection bypasses the proxy server indeed (via a TCP tunnel).
The TCP connectionS do not bypass, but my list was about HTTP, not TCP.


&gt;<i> ...  These are all very important factors in this situation.
</I>
Indeed they are! They are irrelevant for HTTP persistency point of view
though, and that is the (part of your) question I was trying to answer.
If we keep mixing TCP and HTTP together, it would be difficult to
understand what is happening and what should be happening.


&gt;&gt;<i> If your Squid bumps the CONNECT tunnel,
</I>
&gt;<i> It does not.
</I>
Great, it simplifies things a lot.


&gt;&gt;<i> If the
</I>&gt;&gt;<i> current
</I>&gt;&gt;<i> limit is specific to using a forward proxy, consider complaining to
</I>&gt;&gt;<i> browser developers and using a transparent proxy.
</I>
&gt;<i> Not a viable solution.  Yes, I could complain, but my users don't
</I>&gt;<i> really care that I have complained.  They are still stuck with massive
</I>&gt;<i> browser startup times.
</I>
What about the transparent proxy part? Besides solving a specific
problem, it might also motivate the Chrome crew (that must hate
transparent proxies as much most of us do) to fix the alleged problem of
equating next TCP hop address with the origin server address for the
purpose of counting outgoing connections.


&gt;&gt;<i> Just to double check: You only saw a single HTTP GET (or similar)
</I>&gt;&gt;<i> request inside most CONNECT tunnels?
</I>
&gt;<i> I cannot look inside CONNECT tunnels. 
</I>
You can -- built-in browser &quot;developer tools&quot; should tell you what TCP
connection the browser is using for every HTTP request.


&gt;<i> I did see only one CONNECT per TCP connection to the
</I>&gt;<i> proxy server from the Chrome browser.
</I>
There can be at most one (successful) CONNECT per TCP connection. If N
browser tabs go to N different secure origin servers, then Chrome would
have to open N different TCP connections to the proxy. However, if
Chrome has to contact the same origin server many times, then Chrome can
and should reuse the same CONNECT tunnel where HTTP persistency rules
allow for HTTP connection reuse.


&gt;&gt;<i> If yes, which TCP connection was
</I>&gt;&gt;<i> closed first and by which side? Client-Squid or Squid-origin?
</I>
&gt;<i> Squid closed the connection to origin first.
</I>
Outside the SslBump world, and perhaps with some (long) I/O timeouts
aside, if Squid closed a CONNECT tunnel _first_, then there is a Squid
bug: Under normal circumstances, Squid should only close a successfully
established CONNECT tunnel if the client or origin server close their
end first.


HTH,

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="017375.html">[squid-users] persistent connections not being utilized with Chrome
</A></li>
	<LI>Next message (by thread): <A HREF="017379.html">[squid-users] persistent connections not being utilized with	Chrome
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17378">[ date ]</a>
              <a href="thread.html#17378">[ thread ]</a>
              <a href="subject.html#17378">[ subject ]</a>
              <a href="author.html#17378">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
