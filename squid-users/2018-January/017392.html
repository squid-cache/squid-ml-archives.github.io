<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] SQUID with two authentications methods
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SQUID%20with%20two%20authentications%20methods&In-Reply-To=%3C6b1579ce-963c-26a5-6732-a6ab5a35dcbb%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017391.html">
   <LINK REL="Next"  HREF="017396.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] SQUID with two authentications methods</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SQUID%20with%20two%20authentications%20methods&In-Reply-To=%3C6b1579ce-963c-26a5-6732-a6ab5a35dcbb%40treenet.co.nz%3E"
       TITLE="[squid-users] SQUID with two authentications methods">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Jan 16 18:10:28 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="017391.html">[squid-users] SQUID with two authentications methods
</A></li>
        <LI>Next message (by thread): <A HREF="017396.html">[squid-users] Question with ACL and UrlRewrite ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17392">[ date ]</a>
              <a href="thread.html#17392">[ thread ]</a>
              <a href="subject.html#17392">[ subject ]</a>
              <a href="author.html#17392">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 17/01/18 06:23, Colle Christophe wrote:
&gt;<i> Hello,
</I>&gt;<i> 
</I>&gt;<i> I want to configure SQUID with two authentications methods:
</I>&gt;<i> 
</I>&gt;<i> - Kerberos (to do SSO with posts in an ActiveDirectory domain)
</I>&gt;<i> - Basic (Open LDAP directory)
</I>&gt;<i> 
</I>&gt;<i> The LDAP directory contains all the &quot;official&quot; accounts of people, the 
</I>&gt;<i> AD directory contains some accounts (same identifiers as on LDAP) and 
</I>&gt;<i> generic accounts.
</I>&gt;<i> 
</I>&gt;<i> Everything works fine, but I would like to add an extra check: The 
</I>&gt;<i> Kerberos account must also exist in the LDAP directory in order to not 
</I>&gt;<i> allow use of generic accounts.
</I>&gt;<i> 
</I>&gt;<i> I managed to do that with Squid but I get this behavior:
</I>&gt;<i> 
</I>&gt;<i> - Account present in AD + LDAP: OK
</I>&gt;<i> - Account present in AD but not in LDAP: KO
</I>&gt;<i> 
</I>&gt;<i> *Is it possible to force LDAP authentication if &quot;check_ldap&#160;&quot; fail ?*
</I>
&lt;<A HREF="https://wiki.squid-cache.org/Features/Authentication#Can_I_use_different_authentication_mechanisms_together.3F">https://wiki.squid-cache.org/Features/Authentication#Can_I_use_different_authentication_mechanisms_together.3F</A>&gt;

Please note:
  &quot;Squid can not force the clients to choose one over the other.&quot;


You would be better to change your design and use an authentication 
helper of your own that performs these complex relationship checks 
instead of trying to warp Squid ACLs into doing things they are not 
supposed to do.

You already have custom ACL helper. Convert that to one which handles 
the auth credentials through the auth_param interface and does both the 
login check and the LDAP check before declaring Kerberos credentials as 
acceptable to Squid.


Also from the order of your squid.conf it is pretty confusing to do the 
login (deny !authenticated) *after* all your check_ldap that rely on 
credentials being valid.


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="017391.html">[squid-users] SQUID with two authentications methods
</A></li>
	<LI>Next message (by thread): <A HREF="017396.html">[squid-users] Question with ACL and UrlRewrite ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17392">[ date ]</a>
              <a href="thread.html#17392">[ thread ]</a>
              <a href="subject.html#17392">[ subject ]</a>
              <a href="author.html#17392">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
