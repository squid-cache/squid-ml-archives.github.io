<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid 4.1 default queue-size should consider concurrency
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%204.1%20default%20queue-size%20should%20consider%0A%20concurrency&In-Reply-To=%3C0eba6da6-d5ef-537e-c768-2bd8b9e9337d%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018598.html">
   <LINK REL="Next"  HREF="018599.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid 4.1 default queue-size should consider concurrency</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%204.1%20default%20queue-size%20should%20consider%0A%20concurrency&In-Reply-To=%3C0eba6da6-d5ef-537e-c768-2bd8b9e9337d%40measurement-factory.com%3E"
       TITLE="[squid-users] squid 4.1 default queue-size should consider concurrency">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Jul  3 15:54:25 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="018598.html">[squid-users] squid 4.1 default queue-size should consider concurrency
</A></li>
        <LI>Next message (by thread): <A HREF="018599.html">[squid-users] squid 4.1 default queue-size should consider concurrency
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18593">[ date ]</a>
              <a href="thread.html#18593">[ thread ]</a>
              <a href="subject.html#18593">[ subject ]</a>
              <a href="author.html#18593">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 07/03/2018 08:19 AM, Marcus Kool wrote:
&gt;<i> The original intention of this default value is have a queue that is
</I>&gt;<i> twice the size of the messages being processed, 
</I>
AFAICT, the &quot;original intention&quot; was different. The original intention
was to preserve old/unpatched Squid behavior to the extent possible and
to treat all helper categories in a more uniform way. Helper category
inconsistencies in the old Squid and what was changed/preserved are well
documented at

  <A HREF="https://github.com/squid-cache/squid/commit/6825b10">https://github.com/squid-cache/squid/commit/6825b10</A>


&gt;<i> for helpers with
</I>&gt;<i> concurrency=NCONC and num_children=NCHILD it makes a lot of sense to set
</I>&gt;<i> the default queue length to 2*NCONC*NCHILD.
</I>
Using 2*NCONC*NCHILD by default would change what every Squid does after
an upgrade. Many admins do not like such changes and, like Amos said, we
try to avoid such surprises (with all other factors being equal).


&gt;<i> I do not understand that &quot;compatibility&quot; with doing the wrong
</I>&gt;<i> calculation is a good thing.
</I>
Avoiding surprises during upgrades is a good thing.


If you think Squid should use a different default for all or some helper
categories, please post a proposal that documents pros and cons and
justifies the change. The URL above can be used as your guide to helper
categories.


Thank you,

Alex.


&gt;<i> On 03/07/18 05:16, Amos Jeffries wrote:
</I>&gt;&gt;<i> On 03/07/18 20:00, Amish wrote:
</I>&gt;&gt;&gt;<i> Hello,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> In squid 4.1 new option &quot;queue-size&quot; was introduced.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> In most (or all) cases default &quot;queue-size&quot; is set to children-max*2.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> But I believe it should be higher of (children-max*2) OR (concurrency*2)
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Or it can be some better formula but the point I am trying to make is
</I>&gt;&gt;&gt;<i> that, &quot;concurrency&quot; should be taken in to account for calculating
</I>&gt;&gt;&gt;<i> default value of &quot;queue-size&quot;.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Please consider.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> FYI; When we add a directive or option to control some behaviour that
</I>&gt;&gt;<i> already happens the default is usually set to the value all existing
</I>&gt;&gt;<i> Squid are using so nobody gets an unexpected surprise with upgrade.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> That can change later once more people have experimented to find what a
</I>&gt;&gt;<i> better value actually is.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Cheers
</I>&gt;&gt;<i> Amos
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="018598.html">[squid-users] squid 4.1 default queue-size should consider concurrency
</A></li>
	<LI>Next message (by thread): <A HREF="018599.html">[squid-users] squid 4.1 default queue-size should consider concurrency
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18593">[ date ]</a>
              <a href="thread.html#18593">[ thread ]</a>
              <a href="subject.html#18593">[ subject ]</a>
              <a href="author.html#18593">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
