<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Behavior of Squid with SSL Bump and server persistent connections
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Behavior%20of%20Squid%20with%20SSL%20Bump%20and%20server%0A%20persistent%20connections&In-Reply-To=%3CCABfsTT4L29DD1KSHcpaQHPqCCYc83XUF5gVJF-RH6AW2FaZdxA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018576.html">
   <LINK REL="Next"  HREF="018601.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Behavior of Squid with SSL Bump and server persistent connections</H1>
    <B>Vishali Somaskanthan</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Behavior%20of%20Squid%20with%20SSL%20Bump%20and%20server%0A%20persistent%20connections&In-Reply-To=%3CCABfsTT4L29DD1KSHcpaQHPqCCYc83XUF5gVJF-RH6AW2FaZdxA%40mail.gmail.com%3E"
       TITLE="[squid-users] Behavior of Squid with SSL Bump and server persistent connections">vishali.somaskanthan at viptela.com
       </A><BR>
    <I>Tue Jul  3 18:02:54 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="018576.html">[squid-users] Behavior of Squid with SSL Bump and server persistent connections
</A></li>
        <LI>Next message (by thread): <A HREF="018601.html">[squid-users] Behavior of Squid with SSL Bump and server persistent connections
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18600">[ date ]</a>
              <a href="thread.html#18600">[ thread ]</a>
              <a href="subject.html#18600">[ subject ]</a>
              <a href="author.html#18600">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>*Thanks for the quick reply. I want to explain my question further.*

*Consider C1 and S1 connections were created for a HTTPs connection using
ssl-bump. C1 has been served and closed from the client side.*

*Now, the client initiates another HTTPS connection, C2. Since, persistent
connection is enabled, expectation is to see that S1 gets re-used.*

*Behaviour seen now is that S2 gets created and a handshake ensues between
squid and server. After ~30seconds, S1 is re-used to serve the*

*request C2. Persistence seems to work since S1 is re-used. However, why
was S2 initiated and why was S1 re-used after ~30seconds?*


*PFA: pcap file and the squid.conf*

On Mon, Jul 2, 2018 at 4:57 PM, Alex Rousskov &lt;
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt; wrote:

&gt;<i> On 07/02/2018 05:34 PM, Vishali Somaskanthan wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; I am trying out SSL Bump for my connections from Squid to server and
</I>&gt;<i> &gt; trying to put along server persistent connections as well. I would like
</I>&gt;<i> &gt; to know how squid behaves with both of these turned on??
</I>&gt;<i>
</I>&gt;<i> In modern Squids, all(*) bumped SSL client HTTP requests (from client
</I>&gt;<i> connection C) should use the corresponding bumped connection to the
</I>&gt;<i> server (S). After the first HTTP request, if more requests arrive on
</I>&gt;<i> connection C, and they are all regular/basic requests, then they can all
</I>&gt;<i> go through connection S. Once HTTP rules, timeouts, or other factors
</I>&gt;<i> prohibit connection S or connection C reuse, Squid should close both
</I>&gt;<i> connections.
</I>&gt;<i>
</I>&gt;<i> Please note that I do not know whether Squid correctly forces all(*)
</I>&gt;<i> HTTP requests on connection C to connection S, but it should. If it does
</I>&gt;<i> not, file a bug report. Same for closing connection C when connection S
</I>&gt;<i> becomes unusable.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; I see info in the squid wiki page that SSL Bump creates fake CONNECT
</I>&gt;<i> &gt; requests and Peeking at Step1 creates another CONNECT request.
</I>&gt;<i>
</I>&gt;<i> Peeking or staring may indeed produce internal fake CONNECT requests,
</I>&gt;<i> but they are unrelated to your question. They are used internally to
</I>&gt;<i> handle the client TLS connection and for giving adaptation services a
</I>&gt;<i> say in the matter. Persistency is an HTTP term that is applied to what
</I>&gt;<i> happens _after_ the TLS connections is bumped.
</I>&gt;<i>
</I>&gt;<i> (Also, peeking is a part of the SslBump feature -- they are not two
</I>&gt;<i> different actions or stages as &quot;and&quot; in your summary implies).
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> HTH,
</I>&gt;<i>
</I>&gt;<i> Alex.
</I>&gt;<i> P.S. (*) &quot;all&quot; should be interpreted as &quot;all that need a server
</I>&gt;<i> connection&quot; here -- pure cache hits, adaptation-satisfied requests, and
</I>&gt;<i> probably some erroneous requests (e.g., those blocked by http_access
</I>&gt;<i> rules?) do not use the server connection.
</I>&gt;<i>
</I>


-- 
Regards,
Vishali Somaskanthan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20180703/c38ea9af/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20180703/c38ea9af/attachment.htm</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: bump-persistent-connections.pcap
Type: application/octet-stream
Size: 37710 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20180703/c38ea9af/attachment.obj">http://lists.squid-cache.org/pipermail/squid-users/attachments/20180703/c38ea9af/attachment.obj</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: squid.conf
Type: application/octet-stream
Size: 2129 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20180703/c38ea9af/attachment-0001.obj">http://lists.squid-cache.org/pipermail/squid-users/attachments/20180703/c38ea9af/attachment-0001.obj</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="018576.html">[squid-users] Behavior of Squid with SSL Bump and server persistent connections
</A></li>
	<LI>Next message (by thread): <A HREF="018601.html">[squid-users] Behavior of Squid with SSL Bump and server persistent connections
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18600">[ date ]</a>
              <a href="thread.html#18600">[ thread ]</a>
              <a href="subject.html#18600">[ subject ]</a>
              <a href="author.html#18600">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
