<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Exchange OWA 2016 behind squid
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Exchange%20OWA%202016%20behind%20squid&In-Reply-To=%3C81ef48d7-1045-b0c5-4700-bef38c215068%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018649.html">
   <LINK REL="Next"  HREF="018646.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Exchange OWA 2016 behind squid</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Exchange%20OWA%202016%20behind%20squid&In-Reply-To=%3C81ef48d7-1045-b0c5-4700-bef38c215068%40treenet.co.nz%3E"
       TITLE="[squid-users] Exchange OWA 2016 behind squid">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Jul 11 14:04:32 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="018649.html">[squid-users] Exchange OWA 2016 behind squid
</A></li>
        <LI>Next message (by thread): <A HREF="018646.html">[squid-users] squid 4.1 works great ;)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18650">[ date ]</a>
              <a href="thread.html#18650">[ thread ]</a>
              <a href="subject.html#18650">[ subject ]</a>
              <a href="author.html#18650">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 11/07/18 23:50, Mike Surcouf wrote:
&gt;<i> I am sure Amos wont mind me saying but nginx is the right tool for that scenario.
</I>
I don't mind the saying, but I disagree. The HTTP behaviour bugs I keep
hearing about NGinX having tend to make other non-Squid proxies /
servers be better when Squid itself is not top of the list.

The only situation I recommend NGinX is when the admin in question
already has a strong preference for using it. eg, being more trouble to
learn something different to solve the problem at hand.



That aside, the trouble with OWA is that it is email / SMTP software
which grew limited HTTP capabilities, and is proprietary so nobody in
our FOSS world actually knows what is intending to do with its messages
and connections.

Since HTTP and SMTP share message syntax but require very different
behaviour decrypting the TLS is a bit risky and may break rather badly
if the wrong connection happens to terminate at an HTTP proxy. Bugs and
limitations in the OWA HTTP(S) code make for a rather tricky situation
unless you can see exactly what is going on down to the TCP/IP level
when troubleshooting.



&gt;<i> -----Original Message-----
</I>&gt;<i> From: Pedro Guedes
</I>&gt;<i> 
</I>&gt;<i> Hi
</I>&gt;<i> 
</I>&gt;<i> I have been reading some material on this and
</I>&gt;<i> trying to reverse proxying squid on a diferent ssl port
</I>&gt;<i> like 2020 an then connect to port 443 on the exchange.
</I>&gt;<i> 
</I>&gt;<i> Al the examples follow the configs on the 443 port, same
</I>&gt;<i> on squid and exchange.
</I>&gt;<i> 
</I>&gt;<i> Looks like is no possible to putsquid  listening on a diferent
</I>&gt;<i> port than 443 and then connecting to port 443 on
</I>&gt;<i> exchange.
</I>&gt;<i> 
</I>&gt;<i> Is this true?
</I>
No. Squid can easily do that. Just setup the http(s)_port [OWA
client-&gt;Squid] and cache_peer [Squid-&gt;Exchange/OWA server] directives
however you want. Whether it &quot;works&quot; in context of what OWA is doing is
the questionable part, and not related to Squid.

The problem is what the OWA server can do, what the client software can
do - and what they tell each other in their messages. All of which has
to cope perfectly with the custom port you told Squid to use. Otherwise
you just see &quot;broken&quot;.

 * Absolutely avoid URL-rewrite. This will only break things. Use proper
HTTP redirect if you really have to, and avoid changing anything at the
proxy if you can.

 * Avoid TPROXY and NAT intercept of the traffic. It can be coped with,
but adds MANY problems that are best to avoid here.

 * Be careful of the TLS settings on the proxy. OWA has some odd and
quite Microsoft specific things that is requires, and prefers.


As you found OWA itself does not permit port changes (easily?). I'm not
sure if it has improved in recent years with the &quot;365&quot; software
conversions, used to be not possible at all.

HTH
Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="018649.html">[squid-users] Exchange OWA 2016 behind squid
</A></li>
	<LI>Next message (by thread): <A HREF="018646.html">[squid-users] squid 4.1 works great ;)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18650">[ date ]</a>
              <a href="thread.html#18650">[ thread ]</a>
              <a href="subject.html#18650">[ subject ]</a>
              <a href="author.html#18650">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
