<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid 3.5.27 does not respect cache_dir-size but uses 100% of partition and fails
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%203.5.27%20does%20not%20respect%20cache_dir-size%20but%0A%20uses%20100%25%20of%20partition%20and%20fails&In-Reply-To=%3Cc210bc1d-210e-e10a-2b50-2513fe5658f0%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018659.html">
   <LINK REL="Next"  HREF="018667.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid 3.5.27 does not respect cache_dir-size but uses 100% of partition and fails</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%203.5.27%20does%20not%20respect%20cache_dir-size%20but%0A%20uses%20100%25%20of%20partition%20and%20fails&In-Reply-To=%3Cc210bc1d-210e-e10a-2b50-2513fe5658f0%40measurement-factory.com%3E"
       TITLE="[squid-users] squid 3.5.27 does not respect cache_dir-size but uses 100% of partition and fails">rousskov at measurement-factory.com
       </A><BR>
    <I>Thu Jul 12 16:16:48 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="018659.html">[squid-users] squid 3.5.27 does not respect cache_dir-size but uses 100% of partition and fails
</A></li>
        <LI>Next message (by thread): <A HREF="018667.html">[squid-users] squid 3.5.27 does not respect cache_dir-size but uses 100% of partition and fails
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18661">[ date ]</a>
              <a href="thread.html#18661">[ thread ]</a>
              <a href="subject.html#18661">[ subject ]</a>
              <a href="author.html#18661">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 07/12/2018 05:53 AM, pete dawgg wrote:


&gt;<i> I have set workers 8 just recently; but the disk full error had
</I>&gt;<i> definitely been occuring before.
</I>
AUFS cache_dirs are not compatible with SMP Squid. Removing workers was
the right thing to do even if that incompatibility was not causing disk
overflows.


&gt;<i> FATAL: Ipc::Mem::Segment::open failed to shm_open(/squid-cf__metadata.shm): (2) No such file or directory
</I>
&gt;<i> This error seems to occur when the disk is really full and squid is restarted.
</I>
Ah, then it could be a side effect of poor PID management (and
associated shared resource locking) in Squid v3. You can probably ignore
this error until you fix the restarts. FWIW, Squid v4 addressed those
shortcomings.


&gt;<i> When there is no traffic squid seems to cleaning up well enough: over
</I>&gt;<i> night (no traffic) disk usage went down to 30GB (now it's at 50GB
</I>&gt;<i> again)
</I>
This may be a sign that your Squid cannot keep up with the load. IIRC,
AUFS uses lazy garbage collection so it is possible for the stream of
new objects to outpace the stream of object deletion events, resulting
in a gradually increasing cache size. Using even more aggressive
cache_swap_high might help, but there is no good configuration solution
to this UFS problem AFAIK.


&gt;<i> There was another error i just fixed:
</I>&gt;&gt;<i> FATAL: Failed to open swap log /mnt/cache/squid/swap.state.new
</I>&gt;<i> Not a permissions or diskspace problem, caused by workers 8.
</I>&gt;<i> I have deactivated workers 8 and this error went away.
</I>
Yes, that error is one of the signs that AUFS cache_dirs are not SMP-aware.

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="018659.html">[squid-users] squid 3.5.27 does not respect cache_dir-size but uses 100% of partition and fails
</A></li>
	<LI>Next message (by thread): <A HREF="018667.html">[squid-users] squid 3.5.27 does not respect cache_dir-size but uses 100% of partition and fails
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18661">[ date ]</a>
              <a href="thread.html#18661">[ thread ]</a>
              <a href="subject.html#18661">[ subject ]</a>
              <a href="author.html#18661">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
