<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid 3.5.27 does not respect cache_dir-size but uses 100% of partition and fails
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%203.5.27%20does%20not%20respect%20cache_dir-size%20but%0A%20uses%20100%25%20of%20partition%20and%20fails&In-Reply-To=%3Cffef4577-956d-509f-aeb3-89d8fbeb31dc%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018661.html">
   <LINK REL="Next"  HREF="018678.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid 3.5.27 does not respect cache_dir-size but uses 100% of partition and fails</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%203.5.27%20does%20not%20respect%20cache_dir-size%20but%0A%20uses%20100%25%20of%20partition%20and%20fails&In-Reply-To=%3Cffef4577-956d-509f-aeb3-89d8fbeb31dc%40treenet.co.nz%3E"
       TITLE="[squid-users] squid 3.5.27 does not respect cache_dir-size but uses 100% of partition and fails">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Jul 12 22:32:51 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="018661.html">[squid-users] squid 3.5.27 does not respect cache_dir-size but uses 100% of partition and fails
</A></li>
        <LI>Next message (by thread): <A HREF="018678.html">[squid-users] squid 3.5.27 does not respect cache_dir-size but	uses 100% of partition and fails
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18667">[ date ]</a>
              <a href="thread.html#18667">[ thread ]</a>
              <a href="subject.html#18667">[ subject ]</a>
              <a href="author.html#18667">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 13/07/18 04:16, Alex Rousskov wrote:
&gt;<i> On 07/12/2018 05:53 AM, pete dawgg wrote:
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> When there is no traffic squid seems to cleaning up well enough: over
</I>&gt;&gt;<i> night (no traffic) disk usage went down to 30GB (now it's at 50GB
</I>&gt;&gt;<i> again)
</I>&gt;<i> 
</I>&gt;<i> This may be a sign that your Squid cannot keep up with the load. IIRC,
</I>&gt;<i> AUFS uses lazy garbage collection so it is possible for the stream of
</I>&gt;<i> new objects to outpace the stream of object deletion events, resulting
</I>&gt;<i> in a gradually increasing cache size. Using even more aggressive
</I>&gt;<i> cache_swap_high might help, but there is no good configuration solution
</I>&gt;<i> to this UFS problem AFAIK.
</I>&gt;<i> 
</I>
FYI, to be more aggressive place the two limits closer together.

I made the removal rate grow in steps of the difference between the
marks. A low of 60 and high of 70 means there are 4 steps of 10 between
60% and 100% full cache - so Squid will be removing 4*200 objects/sec
when the cache is 99.999% full. But a low of 90 and high 91 will remove
10*200 objects/sec at the same full point.

Low numbers like 60, 70 etc are only needed now if you have to push the
removal rate past 2K objects/sec - eg low 60 high 61 will be removing
40*200 = 8K objects/sec.


If you know your peak traffic rate in req/sec you should be able to tune
the purge rate to match that peak traffic rate. The speed traffic
reaches that peak should inform what the gap is between the watermarks.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="018661.html">[squid-users] squid 3.5.27 does not respect cache_dir-size but uses 100% of partition and fails
</A></li>
	<LI>Next message (by thread): <A HREF="018678.html">[squid-users] squid 3.5.27 does not respect cache_dir-size but	uses 100% of partition and fails
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18667">[ date ]</a>
              <a href="thread.html#18667">[ thread ]</a>
              <a href="subject.html#18667">[ subject ]</a>
              <a href="author.html#18667">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
