<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid 3.5.27 does not respect cache_dir-size but	uses 100% of partition and fails
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%203.5.27%20does%20not%20respect%20cache_dir-size%20but%0A%09uses%20100%25%20of%20partition%20and%20fails&In-Reply-To=%3C047d01d41a48%241b650600%24522f1200%24%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018679.html">
   <LINK REL="Next"  HREF="018642.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid 3.5.27 does not respect cache_dir-size but	uses 100% of partition and fails</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%203.5.27%20does%20not%20respect%20cache_dir-size%20but%0A%09uses%20100%25%20of%20partition%20and%20fails&In-Reply-To=%3C047d01d41a48%241b650600%24522f1200%24%40ngtech.co.il%3E"
       TITLE="[squid-users] squid 3.5.27 does not respect cache_dir-size but	uses 100% of partition and fails">eliezer at ngtech.co.il
       </A><BR>
    <I>Fri Jul 13 01:23:29 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="018679.html">[squid-users] squid 3.5.27 does not respect cache_dir-size but uses 100% of partition and fails
</A></li>
        <LI>Next message (by thread): <A HREF="018642.html">[squid-users] Exchange OWA 2016 behind squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18682">[ date ]</a>
              <a href="thread.html#18682">[ thread ]</a>
              <a href="subject.html#18682">[ subject ]</a>
              <a href="author.html#18682">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Gear!

I am testing it with 4.1 since UFS and AUFS are great but... doesn't support SMP.

Eliezer

* another thread on the way to the list.

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>



-----Original Message-----
From: Alex Rousskov [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>] 
Sent: Friday, July 13, 2018 3:24 AM
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Cc: Eliezer Croitoru &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&gt;
Subject: Re: [squid-users] squid 3.5.27 does not respect cache_dir-size but uses 100% of partition and fails

On 07/12/2018 06:20 PM, Eliezer Croitoru wrote:

&gt;<i> From the docs:
</I>&gt;<i> <A HREF="http://www.squid-cache.org/Versions/v4/cfgman/cache_swap_low.html">http://www.squid-cache.org/Versions/v4/cfgman/cache_swap_low.html</A>
</I>&gt;<i> 
</I>&gt;<i> I see that this is only for UFS/AUFS/diskd and not rock cache_dir.
</I>&gt;<i> What about rock cache_dir?
</I>
Rock cache_dirs cannot overflow by design. Rock reserves a configured
amount of disk space and uses nothing but that amount of disk space. Due
to optimistic allocation by file systems, you can still run out of disk
space if something else consumes space on the same partition, but the
rock database itself cannot overflow.

Alex.


&gt;<i> -----Original Message-----
</I>&gt;<i> From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of Amos Jeffries
</I>&gt;<i> Sent: Friday, July 13, 2018 1:33 AM
</I>&gt;<i> To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> Subject: Re: [squid-users] squid 3.5.27 does not respect cache_dir-size but uses 100% of partition and fails
</I>&gt;<i> 
</I>&gt;<i> On 13/07/18 04:16, Alex Rousskov wrote:
</I>&gt;&gt;<i> On 07/12/2018 05:53 AM, pete dawgg wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> When there is no traffic squid seems to cleaning up well enough: over
</I>&gt;&gt;&gt;<i> night (no traffic) disk usage went down to 30GB (now it's at 50GB
</I>&gt;&gt;&gt;<i> again)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This may be a sign that your Squid cannot keep up with the load. IIRC,
</I>&gt;&gt;<i> AUFS uses lazy garbage collection so it is possible for the stream of
</I>&gt;&gt;<i> new objects to outpace the stream of object deletion events, resulting
</I>&gt;&gt;<i> in a gradually increasing cache size. Using even more aggressive
</I>&gt;&gt;<i> cache_swap_high might help, but there is no good configuration solution
</I>&gt;&gt;<i> to this UFS problem AFAIK.
</I>&gt;&gt;<i>
</I>&gt;<i> 
</I>&gt;<i> FYI, to be more aggressive place the two limits closer together.
</I>&gt;<i> 
</I>&gt;<i> I made the removal rate grow in steps of the difference between the
</I>&gt;<i> marks. A low of 60 and high of 70 means there are 4 steps of 10 between
</I>&gt;<i> 60% and 100% full cache - so Squid will be removing 4*200 objects/sec
</I>&gt;<i> when the cache is 99.999% full. But a low of 90 and high 91 will remove
</I>&gt;<i> 10*200 objects/sec at the same full point.
</I>&gt;<i> 
</I>&gt;<i> Low numbers like 60, 70 etc are only needed now if you have to push the
</I>&gt;<i> removal rate past 2K objects/sec - eg low 60 high 61 will be removing
</I>&gt;<i> 40*200 = 8K objects/sec.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> If you know your peak traffic rate in req/sec you should be able to tune
</I>&gt;<i> the purge rate to match that peak traffic rate. The speed traffic
</I>&gt;<i> reaches that peak should inform what the gap is between the watermarks.
</I>&gt;<i> 
</I>&gt;<i> Amos
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> 
</I>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="018679.html">[squid-users] squid 3.5.27 does not respect cache_dir-size but uses 100% of partition and fails
</A></li>
	<LI>Next message (by thread): <A HREF="018642.html">[squid-users] Exchange OWA 2016 behind squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18682">[ date ]</a>
              <a href="thread.html#18682">[ thread ]</a>
              <a href="subject.html#18682">[ subject ]</a>
              <a href="author.html#18682">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
