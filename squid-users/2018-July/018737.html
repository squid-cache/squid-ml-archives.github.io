<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] server persistent connections and cache
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20server%20persistent%20connections%20and%20cache&In-Reply-To=%3CCABfsTT6_JLH01qmk%2BaaBCtJaqZ0t3Xry%3DUmePGwPvFn_6fRTCg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018746.html">
   <LINK REL="Next"  HREF="018738.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] server persistent connections and cache</H1>
    <B>Vishali Somaskanthan</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20server%20persistent%20connections%20and%20cache&In-Reply-To=%3CCABfsTT6_JLH01qmk%2BaaBCtJaqZ0t3Xry%3DUmePGwPvFn_6fRTCg%40mail.gmail.com%3E"
       TITLE="[squid-users] server persistent connections and cache">vishali.somaskanthan at viptela.com
       </A><BR>
    <I>Wed Jul 18 21:03:52 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="018746.html">[squid-users] store_id_extras and http Request Headers
</A></li>
        <LI>Next message (by thread): <A HREF="018738.html">[squid-users] server persistent connections and cache
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18737">[ date ]</a>
              <a href="thread.html#18737">[ thread ]</a>
              <a href="subject.html#18737">[ subject ]</a>
              <a href="author.html#18737">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Dear Squid users,
          There is a connection C1 from the client to squid and that is
bumped at squid which forms a TCP connection with origin server S1. Having
server persistent connection turned on, for subsequent requests, I see that
the same TCP connection is used between the squid and the server and all
was fine.

I had a problem after sending too many requests to the same server where my
persistence stopped working suddenly. The connection was getting closed
from the squid side sending a FIN packet to the origin server. When
debugging on this, I found my access logs had states
TCP_REFRESH_UNMODIFIED, instead of TCP_MISS which I was seeing earlier when
all was fine.

I found that the results were from cache. I included the  cache deny
all  option
and found that the access logs had TCP_MISS since it wasn't using
cached results and my persistence is fine again.

I have three questions in this scenario:
1. What is the relationship between the caching and the persistence
connection established?
2. When will squid use cached results and when will it not if the cache
deny all directive weren't specified.
3. However, this didn't work fully. Even with *cache deny all* directive,
persistence wasn't working when I peeked at the sslBump step 1 and then
Bumped.
Persistence worked only when I directly did sslbump allow all (without
peeking at first step).


Comments are appreciated on the scenario.



-- 
Thanks,
Vishali Somaskanthan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20180718/36b2ea79/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20180718/36b2ea79/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="018746.html">[squid-users] store_id_extras and http Request Headers
</A></li>
	<LI>Next message (by thread): <A HREF="018738.html">[squid-users] server persistent connections and cache
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18737">[ date ]</a>
              <a href="thread.html#18737">[ thread ]</a>
              <a href="subject.html#18737">[ subject ]</a>
              <a href="author.html#18737">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
