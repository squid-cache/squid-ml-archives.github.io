<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] question about squid and https connection .
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20question%20about%20squid%20and%20https%20connection%20.&In-Reply-To=%3C04fd01d42008%24b4693d10%241d3bb730%24%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018748.html">
   <LINK REL="Next"  HREF="018753.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] question about squid and https connection .</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20question%20about%20squid%20and%20https%20connection%20.&In-Reply-To=%3C04fd01d42008%24b4693d10%241d3bb730%24%40ngtech.co.il%3E"
       TITLE="[squid-users] question about squid and https connection .">eliezer at ngtech.co.il
       </A><BR>
    <I>Fri Jul 20 09:04:45 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="018748.html">[squid-users] question about squid and https connection .
</A></li>
        <LI>Next message (by thread): <A HREF="018753.html">[squid-users] question about squid and https connection .
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18752">[ date ]</a>
              <a href="thread.html#18752">[ thread ]</a>
              <a href="subject.html#18752">[ subject ]</a>
              <a href="author.html#18752">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I think we can use MD5/SHA1/SHA256 or even CRC32 to show the &quot;freshness&quot; of the certificate.
Also this way the ssl_db folder will be free of the burden of tight 600 or 700 permissions.

Did I got it right?

Thanks,
Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>



-----Original Message-----
From: Alex Rousskov [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>] 
Sent: Thursday, July 19, 2018 11:29 PM
To: Eliezer Croitoru &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&gt;; 'Squid Users' &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
Subject: Re: [squid-users] question about squid and https connection .

On 07/19/2018 12:08 PM, Eliezer Croitoru wrote:

&gt;<i> So the ROOT CA key which squid is using is being used for all the fake certificates, why do we need so many copies of it?
</I>
FWIW, I cannot think of any reason to store the CA certificate key in
the database of generated certificates. That key is only used to sign a
freshly generated certificate, and the certificate generator never
regenerates certificates, so I do not see the need to reuse that CA key.

Alex.


&gt;<i> -----Original Message-----
</I>&gt;<i> From: Alex Rousskov [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>]
</I>&gt;<i> Sent: Wednesday, July 18, 2018 11:45 PM
</I>&gt;<i> To: Eliezer Croitoru &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&gt;; 'Squid Users' &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i> Subject: Re: [squid-users] question about squid and https connection .
</I>&gt;<i> 
</I>&gt;<i> On 07/18/2018 02:23 PM, Eliezer Croitoru wrote:
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> Every certificate have the same properties of the original one except 
</I>&gt;&gt;<i> the &quot;RSA key&quot; part which it's certifiying.
</I>&gt;<i> 
</I>&gt;<i> Assuming you are talking about the generated certificates for the same real certificate X, then yes, they will all have the same (mimicked) fields. Whether they will be signed by the same CA depends on Squid configuration. In my answers, I assumed that all those Squids are configured with the same CA (including the same private key).
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> So what I'm saying is that you cannot say that every certificate which 
</I>&gt;&gt;<i> will be created with the same CA will be the same for two different 
</I>&gt;&gt;<i> 2048 bits RSA keys.
</I>&gt;<i> 
</I>&gt;<i> ... unless the keys are also the same, which was my and, AFAICT, OP assumption.
</I>&gt;<i> 
</I>&gt;<i> Also, unless you are doing something nasty, it probably does not make sense to configure a bumping Squid with a public CA certificate that is identical to some other public CA certificate but has a different private key. In other words, if you are using 200 Squids with a single public CA certificate, then all those Squids should use the same private key.
</I>&gt;<i> 
</I>&gt;<i> Alex.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> -----Original Message-----
</I>&gt;&gt;<i> From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] 
</I>&gt;&gt;<i> On Behalf Of Alex Rousskov
</I>&gt;&gt;<i> Sent: Friday, July 13, 2018 2:01 AM
</I>&gt;&gt;<i> To: 'Squid Users' &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;&gt;<i> Subject: Re: [squid-users] question about squid and https connection .
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On 07/12/2018 02:35 PM, Eliezer Croitoru wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Every RSA key and certificate pair regardless to the origin server 
</I>&gt;&gt;&gt;<i> and the SSL-BUMP enabled proxy can be different.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I cannot find a reasonable interpretation of the above that would 
</I>&gt;&gt;<i> contradict what I have said. Yes, each unique certificate has its own 
</I>&gt;&gt;<i> private key, but that is not what Ahmad was asking about AFAICT.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Will it be more accurate to say that just as long as these 200 squid 
</I>&gt;&gt;&gt;<i> instances(different squid.conf and couple other local variables) use 
</I>&gt;&gt;&gt;<i> the same exact ssl_db cache directory  then it's probable that they 
</I>&gt;&gt;&gt;<i> will use the same certificate.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> That statement is incorrect. Squids configured with different CA 
</I>&gt;&gt;<i> certificates will generate different fake certificates for the same 
</I>&gt;&gt;<i> real certificate.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I assume that Ahmad was asking about a situation where 200 Squid 
</I>&gt;&gt;<i> instances had the same configuration (including CA certificates).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Please note that the certificate generator helper gets the signing 
</I>&gt;&gt;<i> (CA) certificate as a parameter with each generation request (because 
</I>&gt;&gt;<i> different Squid ports may use different CA certificates). Also, Squid 
</I>&gt;&gt;<i> probably does not officially support sharing the certificate directory 
</I>&gt;&gt;<i> across Squid instances (even if it works).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Or these 200 squid instances are in SMP mode with 200 workers... If 
</I>&gt;&gt;&gt;<i> these 200 instances do not share memory and certificate cache then 
</I>&gt;&gt;&gt;<i> there is a possibility that the same site from two different sources 
</I>&gt;&gt;&gt;<i> will serve different certificates(due to the different RSA key which 
</I>&gt;&gt;&gt;<i> is different).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 200 SMP workers or 200 identically-configured Squid instances will 
</I>&gt;&gt;<i> generate the same fake certificates for the same real certificate.
</I>&gt;&gt;<i> &quot;Stable certificates&quot; is an important requirement for many distributed 
</I>&gt;&gt;<i> Squid deployments.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Alex.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> -----Original Message-----
</I>&gt;&gt;&gt;<i> From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] 
</I>&gt;&gt;&gt;<i> On Behalf Of Alex Rousskov
</I>&gt;&gt;&gt;<i> Sent: Thursday, July 12, 2018 11:27 PM
</I>&gt;&gt;&gt;<i> To: --Ahmad-- &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">ahmed.zaeem at netstream.ps</A>&gt;; Squid Users 
</I>&gt;&gt;&gt;<i> &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;&gt;&gt;<i> Subject: Re: [squid-users] question about squid and https connection .
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> On 07/12/2018 01:17 PM, --Ahmad-- wrote:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> if i have pc# 1 and that pc open facebook .
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> then i have other pc # 2 and that other pc open facebook .
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> now  as we know facebook is https .
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> so is the key/ cert that used on pc # 1 is same as cert in pc # 2 to decrypt the fb encrypted traffic ?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Certificates themselves are not used (directly) to decrypt traffic 
</I>&gt;&gt;&gt;<i> AFAIK, but yes, both PCs will see the same server certificate 
</I>&gt;&gt;&gt;<i> (ignoring CDNs and other complications).
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> now in the presence of squid .
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> if i used tcp connect method  , will it be different than above ?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> If you are not bumping the connection, then both PCs will see the 
</I>&gt;&gt;&gt;<i> same real Facebook certificate as if those PCs did not use a proxy.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> If you are bumping the connection, then both PCs will see the same 
</I>&gt;&gt;&gt;<i> fake certificate generated by Squid.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> say i used 200 proxies in same squid machine and i used to access FB from the same pc same browser .
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> will facebook see my cert/key i used to decrypt its traffic ?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> If you are asking whether Facebook will know anything about the fake 
</I>&gt;&gt;&gt;<i> certificate generated by Squid for clients, then the answer is &quot;no, 
</I>&gt;&gt;&gt;<i> unless Facebook runs some special client code to deliver (Squid) 
</I>&gt;&gt;&gt;<i> certificate back to Facebook&quot;.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> In general, the origin server assumes that the client is talking to 
</I>&gt;&gt;&gt;<i> it directly. Clients may pin or otherwise restrict certificates that 
</I>&gt;&gt;&gt;<i> they trust, but after the connection is successfully established, the 
</I>&gt;&gt;&gt;<i> server may assume that it is talking to the client directly. A 
</I>&gt;&gt;&gt;<i> paranoid server may deliver special code to double check that 
</I>&gt;&gt;&gt;<i> assumption, but there are other, more standard methods to prevent 
</I>&gt;&gt;&gt;<i> bumping such as certificate pinning and certificate transparency cervices.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> is the key/cert of FB to decrypt the https content is same on all browsers on all computers ?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> If you are asking whether the generated certificates are going to be 
</I>&gt;&gt;&gt;<i> the same for all clients, then the answer is &quot;yes, provided all those 
</I>&gt;&gt;&gt;<i> 200 Squids use the same configuration (including the CA certificate) 
</I>&gt;&gt;&gt;<i> and receive the same real certificate from Facebook&quot;. Squid's 
</I>&gt;&gt;&gt;<i> certificate generation algorithm generates the same certificate given 
</I>&gt;&gt;&gt;<i> the same configuration and the same origin server certificate.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> HTH,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Alex.
</I>&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;&gt;<i>
</I>&gt;<i> 
</I>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="018748.html">[squid-users] question about squid and https connection .
</A></li>
	<LI>Next message (by thread): <A HREF="018753.html">[squid-users] question about squid and https connection .
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18752">[ date ]</a>
              <a href="thread.html#18752">[ thread ]</a>
              <a href="subject.html#18752">[ subject ]</a>
              <a href="author.html#18752">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
