<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] HSTS and HPKP
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20HSTS%20and%20HPKP&In-Reply-To=%3C62a83bb7-40a5-f61c-0e57-f184cc81333e%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018783.html">
   <LINK REL="Next"  HREF="018788.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] HSTS and HPKP</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20HSTS%20and%20HPKP&In-Reply-To=%3C62a83bb7-40a5-f61c-0e57-f184cc81333e%40treenet.co.nz%3E"
       TITLE="[squid-users] HSTS and HPKP">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Jul 27 04:34:54 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="018783.html">[squid-users] HSTS and HPKP
</A></li>
        <LI>Next message (by thread): <A HREF="018788.html">[squid-users] splunk 3.5.27-Sec Advisories
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18785">[ date ]</a>
              <a href="thread.html#18785">[ thread ]</a>
              <a href="subject.html#18785">[ subject ]</a>
              <a href="author.html#18785">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 27/07/18 16:10, Gordon Hsiao wrote:
&gt;<i> I'm running squid4.1 interception peek+splice mode.
</I>&gt;<i> 
</I>&gt;<i> Some sites with HSTS(max-age=0) will not work whenever squid is on, HSTS
</I>&gt;<i> max-age=0 is supposed to turn off HSTS, but chrome/firefox will keep
</I>&gt;<i> redirecting https&lt;--&gt;http until it failed(too many redirects). Once
</I>&gt;<i> Squid is removed all is good.
</I>&gt;<i> 
</I>&gt;<i> I also searched various lists and squid's website, it's still unclear to
</I>&gt;<i> me, for intercept proxy, can Squid deal with HSTS reliably these days?
</I>&gt;<i> 
</I>
Handle yes. Reliably no.

Squid should be erasing the HSTS header completely whenever it can. The
problem is that HSTS can be delivered in several ways that Squid is not
in control of (spliced' traffic, non-HTTP protocols, and non-proxied
connections). You have to reliably seal off those other protocols and
connection types for the MITM proxy to have even a basic chance at success.

FWIW: any HSTS TTL value that gets through to the server breaks things.
Even though max-age=0 can be used to clear some of those other HSTS
avenues, it still breaks things just by turning on the HSTS handling at
the server.


&gt;<i> A similar questions is HPKP, or the pinning certificate, can Squid 4.1
</I>&gt;<i> handle that?
</I>
No.

While HSTS was a train wreck from day-0, HPKP is technically closer to
how TLS was supposed to be used in the first place.

AFAIK, the only thing you can do in the presence of client application
using HPKP is splice. Server using it does not matter if the client is
not checking.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="018783.html">[squid-users] HSTS and HPKP
</A></li>
	<LI>Next message (by thread): <A HREF="018788.html">[squid-users] splunk 3.5.27-Sec Advisories
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18785">[ date ]</a>
              <a href="thread.html#18785">[ thread ]</a>
              <a href="subject.html#18785">[ subject ]</a>
              <a href="author.html#18785">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
