<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] block visit 80/443 browsing via IP(no domain name)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20block%20visit%2080/443%20browsing%20via%20IP%28no%20domain%20name%29&In-Reply-To=%3Ca975d266-07b2-f85e-6f0c-75fae693e179%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018793.html">
   <LINK REL="Next"  HREF="018794.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] block visit 80/443 browsing via IP(no domain name)</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20block%20visit%2080/443%20browsing%20via%20IP%28no%20domain%20name%29&In-Reply-To=%3Ca975d266-07b2-f85e-6f0c-75fae693e179%40treenet.co.nz%3E"
       TITLE="[squid-users] block visit 80/443 browsing via IP(no domain name)">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon Jul 30 05:20:18 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="018793.html">[squid-users] block visit 80/443 browsing via IP(no domain name)
</A></li>
        <LI>Next message (by thread): <A HREF="018794.html">[squid-users] block visit 80/443 browsing via IP(no domain name)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18798">[ date ]</a>
              <a href="thread.html#18798">[ thread ]</a>
              <a href="subject.html#18798">[ subject ]</a>
              <a href="author.html#18798">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 30/07/18 04:59, Walter H. wrote:
&gt;<i> skype was blocking every raw-ip:443 instead of just its own IPs, a bit
</I>&gt;<i> too restricted, though it can have a list of its own IPs and dst might
</I>&gt;<i> just work.
</I>
That was the point. Skype is P2P software. Certain versions use raw-IP
to connect to arbitrary IPs. There are no &quot;its IPs&quot; to restrict the
match to. And the more recent versions owned by MS use the Azure cloud -
so any IP in Azure is valid raw-IP for Skype to connect to.


&gt;<i> 
</I>&gt;<i> I'm trying to see if some chat can be blocked as they uses raw-IP
</I>&gt;<i> without DNS at all(similar to what skype did)
</I>&gt;<i> 
</I>&gt;<i> yes I know ssl-bump uses IP from TCP-SYN to do fake-CONNECT (intercept
</I>&gt;<i> mode), that is still different from a raw-IP with 443/ssl, the latter
</I>&gt;<i> will warn because rarely any ssl certificate will have CN in IP format.
</I>
That does not make sense. There is a very good reason why we keep
dstdomain ans ssl:server_name as separate ACL types.

That reason is that both can exist simultaneously with different values.
The CN value is never part of <A HREF="https://">https://</A> URLs.

I think you may be confusing the TLS SNI with X.509 certificate CN
Subject names.
 The former is used in <A HREF="http://">http://</A> URLs reported by Squid, and the latter is
not.

&gt;<i> 
</I>&gt;<i> there might be some vpn over 443 port that uses raw-IP that I hope to
</I>&gt;<i> block, if any.
</I>
Use ssl::server_name_regex with the raw-IP pattern to match raw-IP in
certificate CN fields.

Please be aware that CN contains *multiple* values which may be (often
is) any combination of domain name, raw-IP, arbitrary text strings and
regex patterns. So take extreme care with your regex matching into it.

Your lack of certainty about what VPNs are actually doing indicates that
you probably do not know what you are dealing with here. Please base
your rules and config around what is *actually* happening on your
network. Half-way rules based on guesses are not sufficient protection
by any means if you intend paranoid levels of protection, and harmful if
you intend for opening useful holes in advance of a need existing.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="018793.html">[squid-users] block visit 80/443 browsing via IP(no domain name)
</A></li>
	<LI>Next message (by thread): <A HREF="018794.html">[squid-users] block visit 80/443 browsing via IP(no domain name)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18798">[ date ]</a>
              <a href="thread.html#18798">[ thread ]</a>
              <a href="subject.html#18798">[ subject ]</a>
              <a href="author.html#18798">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
