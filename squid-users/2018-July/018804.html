<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Wpad problem (DNS)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Wpad%20problem%20%28DNS%29&In-Reply-To=%3C5B600069.4090309%40tlinx.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018781.html">
   <LINK REL="Next"  HREF="018783.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Wpad problem (DNS)</H1>
    <B>L A Walsh</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Wpad%20problem%20%28DNS%29&In-Reply-To=%3C5B600069.4090309%40tlinx.org%3E"
       TITLE="[squid-users] Wpad problem (DNS)">squid-user at tlinx.org
       </A><BR>
    <I>Tue Jul 31 06:23:37 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="018781.html">[squid-users] Wpad problem (DNS)
</A></li>
        <LI>Next message (by thread): <A HREF="018783.html">[squid-users] HSTS and HPKP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18804">[ date ]</a>
              <a href="thread.html#18804">[ thread ]</a>
              <a href="subject.html#18804">[ subject ]</a>
              <a href="author.html#18804">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>erdosain9 wrote:
&gt;<i>  tail -f /var/log/squid/access.log | grep 192.168.6.22
</I>&gt;<i> 1532616150.629     77 192.168.6.22 TCP_REFRESH_UNMODIFIED/200 316 GET
</I>&gt;<i> <A HREF="http://www.msftncsi.com/ncsi.txt">http://www.msftncsi.com/ncsi.txt</A> - HIER_DIRECT/200.81.17.41 text/plain
</I>&gt;<i>   
</I>---
    You may have some different setup, but this is what works
for me and seems to work for IE, FF, Opera et al.

For wpad, the browsers should look up wpad locally, 1st --
with no domain, then FQDN like wpad.xxx.example.com, then
wpad.example.com.  I also have my internal hosts setup to
lookup hosts on nmb -- so it also serves the hostname.

    It shouldn't have to go through the proxy to get the wpad
file -- sorta defeats the purpose.

At a windows prompt, I can do nslookup:
&gt;<i>  nslookup wpad
</I>Server:  ishtar.sc.tlinx.org
Address:  192.168.33.1

Name:    Ishtar.sc.tlinx.org
Address:  192.168.33.1
Aliases:  wpad.sc.tlinx.org

---
or from linux:
&gt;<i>  dig wpad
</I>
; &lt;&lt;&gt;&gt; DiG 9.9.5-rpz2+rl.14038.05-P1 &lt;&lt;&gt;&gt; wpad
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 34174
;; flags: qr aa rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 2, ADDITIONAL: 2

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
;; QUESTION SECTION:
;wpad.sc.tlinx.org.   IN  A

;; ANSWER SECTION:
wpad.sc.tlinx.org.  28000 IN  CNAME Ishtar.sc.tlinx.org.
Ishtar.sc.tlinx.org.  28000 IN  A 192.168.33.1
...more stuff deleted...



--- then trying to get wpad.dat:
&gt;<i>  wget --no-proxy <A HREF="http://wpad/wpad.dat">http://wpad/wpad.dat</A>
</I>--2018-07-30 23:09:51--  <A HREF="http://wpad/wpad.dat">http://wpad/wpad.dat</A>
Resolving wpad (wpad)... 192.168.33.1
Connecting to wpad (wpad)|192.168.33.1|:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 1480 (1.4K) [application/octet-stream]
Saving to: &#8216;wpad.dat&#8217;
2018-07-30 23:09:51 (190 MB/s) - &#8216;wpad.dat&#8217; saved [1480/1480]

and my wpad.dat looks sorta like (BTW -- my socks stuff has never worked 
right, but haven't bothered to track it down, so might wanna ignore it!).
also on my net, web-proxy, socks, etc...all point to same machine.



function FindProxyForURL(url, host) {
    // Some functions available:
    //    isPlainHostName(host)
    //    dnsDomainIs(host,&quot;.domainname.org&quot;)
    //    localHostOrDomainIs(host, &quot;myhost.mydom.org&quot;)  (exact matching)
    //    isResolvable(host) - brwsr may 'longpause' if host !resolvable
    //    isInNet(host, 192.168.3.0, mask)
    //    dnsResolve(host) - returns IP from hostname
    //    shExpMatch(url, &quot;*vpn.domain.com*&quot;)
    //    weekdayRange(&quot;MON, &quot;FRI&quot;)
    //    dateRange(&quot;JAN&quot;, &quot;MAR&quot;)
    //    timeRange(8, 18)
    //    myIpAddress() - my own numeric IP

    // References:
    // see <A HREF="http://en.wikipedia.org/wiki/Proxy_auto-config">http://en.wikipedia.org/wiki/Proxy_auto-config</A>
    // or <A HREF="http://www.findproxyforurl.com">http://www.findproxyforurl.com</A>

    var direct = &quot;DIRECT&quot;;
    var sc_http_proxy = &quot;PROXY web-proxy.sc.example.org:8118&quot;;
    var sc_socks_proxy = &quot;SOCKS socks.sc.example.org:1080&quot;;
    var sc_http_w_socks_backup = sc_http_proxy + sc_socks_proxy;
    var news_proto_re = /^s?<A HREF="news://.*$/;">news://.*$/;</A>
    var news_port_re = /^[^:]+://[^:/]+:(?:119|563)/.*$/;

    if (isInNet(host, &quot;192.168.0.0&quot;, &quot;255.255.255.0&quot;) ||
            isInNet(host, &quot;192.168.1.0&quot;, &quot;255.255.255.0&quot;) ||
            isInNet(host, &quot;192.168.100.0&quot;, &quot;255.255.255.0&quot;) ) {
            return sc_http_proxy;
    }
    if (isInNet(myIpAddress(), &quot;192.168.33.0&quot;, &quot;255.255.255.0&quot;) {
        if (isPlainHostName(host) || dnsDomainIs(host, &quot;.sc.example.org&quot;)
                || dnsDomainIs(host, &quot;.example.org&quot;)) {
            return direct;
        } else {
            // 119/563 for news
            if (news_proto_re.exec(url) ||
                news_port_re.exec(url)  ) {
                return sc_socks_proxy;
            }
            return sc_http_proxy;
        }
    }
    return direct;
}

// vim: ts=2 sw=2 syntax=javascript


================

Hope the above helps...it was pretty simple...




</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="018781.html">[squid-users] Wpad problem (DNS)
</A></li>
	<LI>Next message (by thread): <A HREF="018783.html">[squid-users] HSTS and HPKP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18804">[ date ]</a>
              <a href="thread.html#18804">[ thread ]</a>
              <a href="subject.html#18804">[ subject ]</a>
              <a href="author.html#18804">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
