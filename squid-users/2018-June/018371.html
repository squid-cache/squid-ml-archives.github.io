<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Display eCAP meta-information on Squid error-page
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Display%20eCAP%20meta-information%20on%20Squid%20error-page&In-Reply-To=%3C47e787d7-280c-356a-9e88-e6d9d6f6724d%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018374.html">
   <LINK REL="Next"  HREF="018373.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Display eCAP meta-information on Squid error-page</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Display%20eCAP%20meta-information%20on%20Squid%20error-page&In-Reply-To=%3C47e787d7-280c-356a-9e88-e6d9d6f6724d%40measurement-factory.com%3E"
       TITLE="[squid-users] Display eCAP meta-information on Squid error-page">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Jun  5 15:19:51 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="018374.html">[squid-users] Display eCAP meta-information on Squid error-page
</A></li>
        <LI>Next message (by thread): <A HREF="018373.html">[squid-users] Display eCAP meta-information on Squid error-page
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18371">[ date ]</a>
              <a href="thread.html#18371">[ thread ]</a>
              <a href="subject.html#18371">[ subject ]</a>
              <a href="author.html#18371">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 06/05/2018 03:27 AM, chgerber wrote:
&gt;<i> &quot;It is best to use %note logformat %code for logging annotations. 
</I>&gt;<i> The %adapt::&lt;last_h code is meant for adaptation services debugging (and 
</I>&gt;<i> to work around the current ICAP code lack of support for annotations).&quot; 
</I>
&gt;<i> How exactly can I use %note to log the same information to access.log? For
</I>&gt;<i> example assume I use &quot;%{my-ecap-header}adapt::&lt;last_h&quot; how can I log the
</I>&gt;<i> same using %note as you suggested? 
</I>

  logformat myLog ... adapter-decision=%{my-ecap-header}note ...
  access_log ... myLog ...


Newer Squids may also support a more natural %note{my-ecap-header}
syntax. Use that if you can.


&gt;<i> Can I apply ACL's to annotations served by eCAP adapters.
</I>
Yes, of course. The note ACL does not know where the annotation came
from. Just make sure that you are using the directives that are checked
after Squid receives transaction annotations from your eCAP adapter.

For example, using http_access will not work in most cases because
(SslBump exceptions aside) that directive is only checked before Squid
talks to eCAP adapter(s). However, there is adapted_http_access that is
checked after request adaptations.


&gt;<i> Say when
</I>&gt;<i> %{my-ecap-header}adapt::&lt;last_h or the same solution with %note respectively
</I>&gt;<i> (see first part of post) returns &quot;bad&quot; I want squid to deny the access and
</I>&gt;<i> grant access when it returns &quot;good&quot;?
</I>
This sketch is a possible starting point:

  acl badRequest note my-ecap-header bad
  adapted_http_access deny badRequest
  adapted_http_access allow all

The exact correct configuration would depend on the specifics of your
use case. For example, the above allows unrated requests, but you may
want to block (some of) them.


HTH,

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="018374.html">[squid-users] Display eCAP meta-information on Squid error-page
</A></li>
	<LI>Next message (by thread): <A HREF="018373.html">[squid-users] Display eCAP meta-information on Squid error-page
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18371">[ date ]</a>
              <a href="thread.html#18371">[ thread ]</a>
              <a href="subject.html#18371">[ subject ]</a>
              <a href="author.html#18371">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
