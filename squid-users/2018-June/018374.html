<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Display eCAP meta-information on Squid error-page
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Display%20eCAP%20meta-information%20on%20Squid%20error-page&In-Reply-To=%3Cb88b3aca-8184-2a2e-6bab-a7898c996d01%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018372.html">
   <LINK REL="Next"  HREF="018371.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Display eCAP meta-information on Squid error-page</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Display%20eCAP%20meta-information%20on%20Squid%20error-page&In-Reply-To=%3Cb88b3aca-8184-2a2e-6bab-a7898c996d01%40measurement-factory.com%3E"
       TITLE="[squid-users] Display eCAP meta-information on Squid error-page">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Jun  5 15:59:38 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="018372.html">[squid-users] Display eCAP meta-information on Squid error-page
</A></li>
        <LI>Next message (by thread): <A HREF="018371.html">[squid-users] Display eCAP meta-information on Squid error-page
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18374">[ date ]</a>
              <a href="thread.html#18374">[ thread ]</a>
              <a href="subject.html#18374">[ subject ]</a>
              <a href="author.html#18374">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 06/05/2018 04:51 AM, Amos Jeffries wrote:

&gt;<i> The adaptor API purpose is to alter HTTP messages as they travel through
</I>&gt;<i> the proxy, not to be a substitute for access control logic already
</I>&gt;<i> available in the proxy.
</I>
This statement is incorrect for legitimate use cases where the required
access control logic is not supported by Squid internally. A typical
alternation-free example is content analysis (which Squid ACLs cannot
perform).


&gt;<i> So what your adaptor SHOULD be doing is simply
</I>&gt;<i> producing the 403 Forbidden message itself.
</I>
Sometimes, that is the best solution indeed, but it may also be a bad
solution in some cases because it can be slower and because it
duplicates (or discards) a lot of advanced functionality already
implemented in Squid. The rule of thumb here is &quot;If Squid can generate
the right blocking message, use Squid (instead of the adapter) to
generate the right blocking message&quot;.


&gt;<i> By using a header as described you are forcing Squid to:
</I>&gt;<i>   receive adapted message from eCAP
</I>&gt;<i>   re-parse that altered message,
</I>&gt;<i>   erase that altered message,
</I>&gt;<i>   generate a new denial (403) message, and
</I>&gt;<i>   deliver to client.
</I>
Adapter implementors are not &quot;forced&quot; to use the above sequence of
steps: The first three steps do not have to happen (they are optional).
An optimized adapter implementation that lets Squid generate the
blocking message is limited to the last two steps from your list:

   generate a new denial (403) message, and
   deliver to client.


&gt;<i> There is an &quot;external ACL&quot; interface provided for complex authorization
</I>&gt;<i> logics to be offloaded to a helper process with more capabilities than
</I>&gt;<i> the proxy. That should be used instead of eCAP/ICAP adaptors.
</I>
An adapter may be a better solution than the external ACL in some cases.
The actual decision logic here is roughly as follows:

* If built-in ACLs alone are sufficient, then
  use just the built-in ACLs. They are usually simpler and faster.

* If an external ACL is sufficient and performance is not an issue, then
  use an external ACL. It is a lot simpler to implement than an adapter.

* If the decision logic involves message body analysis, then
  use an eCAP adapter or an ICAP service. Others do not get content.

* Otherwise, carefully evaluate external ACLs vs eCAP adapter choice
  given your use case specifics. eCAP can be faster than an external
  ACL or vice versa.


HTH,

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="018372.html">[squid-users] Display eCAP meta-information on Squid error-page
</A></li>
	<LI>Next message (by thread): <A HREF="018371.html">[squid-users] Display eCAP meta-information on Squid error-page
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18374">[ date ]</a>
              <a href="thread.html#18374">[ thread ]</a>
              <a href="subject.html#18374">[ subject ]</a>
              <a href="author.html#18374">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
