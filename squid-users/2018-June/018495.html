<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Speed &#8203;&#8203;limit from file size
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%0A%20%3D%3Futf-8%3Fb%3FU3BlZWQg4oCL4oCLbGltaXQgZnJvbSBmaWxlIHNp%3F%3D%20%3D%3Futf-8%3Fq%3Fze%3F%3D&In-Reply-To=%3Cddad83d9-e314-2878-62ec-06df058c037c%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018493.html">
   <LINK REL="Next"  HREF="018498.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Speed &#8203;&#8203;limit from file size</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%0A%20%3D%3Futf-8%3Fb%3FU3BlZWQg4oCL4oCLbGltaXQgZnJvbSBmaWxlIHNp%3F%3D%20%3D%3Futf-8%3Fq%3Fze%3F%3D&In-Reply-To=%3Cddad83d9-e314-2878-62ec-06df058c037c%40measurement-factory.com%3E"
       TITLE="[squid-users] Speed &#8203;&#8203;limit from file size">rousskov at measurement-factory.com
       </A><BR>
    <I>Thu Jun 21 05:18:50 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="018493.html">[squid-users] Speed &#8203;&#8203;limit from file size
</A></li>
        <LI>Next message (by thread): <A HREF="018498.html">[squid-users] Speed &#8203;&#8203;limit from file size
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18495">[ date ]</a>
              <a href="thread.html#18495">[ thread ]</a>
              <a href="subject.html#18495">[ subject ]</a>
              <a href="author.html#18495">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 06/20/2018 01:44 PM, Michael Pro wrote:
&gt;<i> Is it possible to limit the speed of receiving the file to the client
</I>&gt;<i> depending on the file size?
</I>
&gt;<i> Let's say,
</I>&gt;<i> file =&lt;1MB client download with 400Kbit/s
</I>&gt;<i> file 1MB...5MB client donload with 4Mbit/s
</I>&gt;<i> file &gt;5MB - no speed limit
</I>

For HTTP responses with a Content-Length header, you can create poor
man's equivalent of a missing response_body_size ACL. For example:

  acl smallerThanTenBytes rep_header Content-Length ^[0-9]$

With an ACL like that, you can direct responses to the right pool. IIRC,
pool assignment may happen multiple times during the lifetime of a
transaction so you need to be careful to deal with assignments that are
done before there is a response. Delay pools are not my area of
expertise but others on the list can help you with the details.


For HTTP responses without a Content-Length header, you can use an
adaptation service (ICAP or eCAP) to tag transactions that start to
exceed 1MB and 5MB boundaries. A &quot;note&quot; ACL can check for that tag, but
I do not think Squid delay pools re-check pool ACLs after the response
body bytes start to flow. If I am right, then you would not be able to
(re)route response body bytes to the right delay pool for responses
without a Content-Length header.

You could use an adaptation service itself to slow responses without
Content-Length down (partially duplicating Squid's delay pools
capabilities), but the precision of such an approach may be too low due
to Squid internal buffering. YMMV.


For HTTP CONNECT tunnels (i.e., HTTPS traffic) even the adaptation
tricks would not work because adaptation services do not get CONNECT
tunnel bytes (yet?). You would have to bump the tunnel to get access to
the HTTP responses inside (and bumping opens another huge Pandora box).


HTH,

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="018493.html">[squid-users] Speed &#8203;&#8203;limit from file size
</A></li>
	<LI>Next message (by thread): <A HREF="018498.html">[squid-users] Speed &#8203;&#8203;limit from file size
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18495">[ date ]</a>
              <a href="thread.html#18495">[ thread ]</a>
              <a href="subject.html#18495">[ subject ]</a>
              <a href="author.html#18495">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
