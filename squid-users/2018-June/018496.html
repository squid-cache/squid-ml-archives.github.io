<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users]  Speed &#8203;&#8203;limit from file size
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%3D%3Futf-8%3Fb%3FIFNwZWVkIOKAi%2BKAi2xpbWl0IGZyb20gZmlsZSBz%3F%3D%0A%20%3D%3Futf-8%3Fq%3Fize%3F%3D&In-Reply-To=%3Cba3982fc-0b50-3b81-1011-81ee5a1200ed%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018523.html">
   <LINK REL="Next"  HREF="018509.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users]  Speed &#8203;&#8203;limit from file size</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%3D%3Futf-8%3Fb%3FIFNwZWVkIOKAi%2BKAi2xpbWl0IGZyb20gZmlsZSBz%3F%3D%0A%20%3D%3Futf-8%3Fq%3Fize%3F%3D&In-Reply-To=%3Cba3982fc-0b50-3b81-1011-81ee5a1200ed%40treenet.co.nz%3E"
       TITLE="[squid-users]  Speed &#8203;&#8203;limit from file size">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Jun 21 05:44:36 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="018523.html">[squid-users] Speed &#8203;&#8203;limit from file size
</A></li>
        <LI>Next message (by thread): <A HREF="018509.html">[squid-users] max_user_ip not work
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18496">[ date ]</a>
              <a href="thread.html#18496">[ thread ]</a>
              <a href="subject.html#18496">[ subject ]</a>
              <a href="author.html#18496">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 21/06/18 21:44,  Michael Pro wrote:
&gt;<i> Is it possible to limit the speed of receiving the file to the client
</I>&gt;<i> depending on the file size?
</I>
NP: HTTP has no concept of &quot;file&quot;. There are only messages. A message
may contain 0 or more *pieces* of those things we humans call &quot;files&quot;.


&gt;<i> Let's say,
</I>&gt;<i> file =&lt;1MB client download with 400Kbit/s
</I>&gt;<i> file 1MB...5MB client donload with 4Mbit/s
</I>&gt;<i> file &gt;5MB - no speed limit
</I>&gt;<i> 
</I>&gt;<i> I try fore some settings
</I>&gt;<i> delay_pools 1
</I>&gt;<i> delay_class 1 2
</I>&gt;<i> delay_access 1 allow storeid_app_2
</I>&gt;<i> delay_access 1 allow storeid_app_6
</I>&gt;<i> delay_access 1 deny all
</I>&gt;<i> delay_parameters 1 -1/-1 50000/1000000
</I>&gt;<i> delay_parameters 1 -1/-1 500000/5000000
</I>&gt;<i> delay_parameters 1 -1/-1 -1/-1
</I>
NP: each repetition of delay_parameters *replaces* previous settings for
that pool #1. The above spend lots of CPU calculating bandwidth for the
related requests, but does nothing.


&gt;<i> ...
</I>&gt;<i> but it does't work
</I>&gt;<i> 
</I>&gt;<i> Can some method take place to solve this problem?
</I>

To receive the message at full speed into Squid, then dole it out slowly
to clients use the client_delay_* directives. The ones above only affect
read's from servers.
 &lt;<A HREF="http://www.squid-cache.org/Doc/config/client_delay_parameters/">http://www.squid-cache.org/Doc/config/client_delay_parameters/</A>&gt;

Secondly, you need a different pool for each speed limit. The *_access
controls determine which transactions get which pool(s) speed limit
applied to them.


That said, there is almost no way to know how big an object is going to
be until it has finished arriving. What gets transmitted can be
compressed, split into ranges, chunked as a stream rather than a single
object or any combination of the above.

The best that can be done is checking Content-Length from the reply
message headers - *IF* the reply message even has one. Relevance and use
of that header is declining as dynamic content grows in popularity.


I recommend looking into OS level QoS controls and applying more general
bandwidth shaping instead. That way it does not matter what a client is
doing, if they are doing a lot of it they wont impact others on the
network quite as badly as uncontrolled traffic flow.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="018523.html">[squid-users] Speed &#8203;&#8203;limit from file size
</A></li>
	<LI>Next message (by thread): <A HREF="018509.html">[squid-users] max_user_ip not work
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18496">[ date ]</a>
              <a href="thread.html#18496">[ thread ]</a>
              <a href="subject.html#18496">[ subject ]</a>
              <a href="author.html#18496">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
