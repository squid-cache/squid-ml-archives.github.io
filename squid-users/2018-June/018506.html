<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Display eCAP meta-information on Squid error-page
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Display%20eCAP%20meta-information%20on%20Squid%20error-page&In-Reply-To=%3C1529658863486-0.post%40n4.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018375.html">
   <LINK REL="Next"  HREF="018508.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Display eCAP meta-information on Squid error-page</H1>
    <B>chgerber</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Display%20eCAP%20meta-information%20on%20Squid%20error-page&In-Reply-To=%3C1529658863486-0.post%40n4.nabble.com%3E"
       TITLE="[squid-users] Display eCAP meta-information on Squid error-page">christof.gerber1 at gmail.com
       </A><BR>
    <I>Fri Jun 22 09:14:23 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="018375.html">[squid-users] Display eCAP meta-information on Squid error-page
</A></li>
        <LI>Next message (by thread): <A HREF="018508.html">[squid-users] Display eCAP meta-information on Squid error-page
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18506">[ date ]</a>
              <a href="thread.html#18506">[ thread ]</a>
              <a href="subject.html#18506">[ subject ]</a>
              <a href="author.html#18506">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;&gt;<i> If it does not work, then most likely there is a bug in your adapter, in 
</I>&gt;&gt;<i> your Squid configuration, or in Squid. 
</I>
By now I see no other way than this being a misunderstanding between us or a
bug in Squid 3.5.

##########
Squid 3.5 XactionRep.cc line 492:

// Store received meta headers for adapt::&lt;last_h logformat code use.
Adaptation::History::Pointer ah = request-&gt;adaptLogHistory();
    if (ah != NULL) {
        HttpHeader meta(hoReply);
        OptionsExtractor extractor(meta);
        theMaster-&gt;visitEachOption(extractor);
        ah-&gt;recordMeta(&amp;meta);
    }
###########

This is where Squid demands the ecap meta headers. This succeeds as I follow
fromt the fact that I can log them with the adapt::&lt;last_h logformat. The
comment also indicates the usage of these ecap meta headers with
adapt::&lt;last_h logformat. But with %{my-ecap-header}note it does not work.
Even when I add %note which should log all notes according to the logformat
configuration docs the result is the same (&quot;-&quot;). I tested this in both
Respmode and Reqmode.  Why are you so sure that %note should work with ecap
meta headers?

Is it due to the changelog of Squid-3.4:
&quot;New format code %note to log a transaction annotation linked to the
transaction by ICAP, eCAP, a helper, or the note squid.conf directive.&quot;

To elaborate again why this is important to me: I want to apply ACL's on
information provided by the eCAP adapter. As ACL's can be applied to notes
and because you mentioned that eCAP can provide ecap meta headers as notes I
found this as the way to go. As a starting point I first wanted to verify
that ecap meta headers really can be provided to Squid in the form of notes
so I tried to log them with %{my-ecap-header}note and %note which failed.

squid.conf logformats tried:
logformat test %{my-ecap-header}note                     // resulting
output: &quot;-&quot;
logformat test %note                                                //
resulting output: &quot;-&quot;
logformat test %{my-ecap-header}adapt::&lt;last_h     //  resulting output:
&quot;value-of-my-ecap-header&quot;
         



--
Sent from: <A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html">http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html</A>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="018375.html">[squid-users] Display eCAP meta-information on Squid error-page
</A></li>
	<LI>Next message (by thread): <A HREF="018508.html">[squid-users] Display eCAP meta-information on Squid error-page
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18506">[ date ]</a>
              <a href="thread.html#18506">[ thread ]</a>
              <a href="subject.html#18506">[ subject ]</a>
              <a href="author.html#18506">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
