<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] max_user_ip not work
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20max_user_ip%20not%20work&In-Reply-To=%3Cd6bf890b-5859-3288-2726-c533b2b146d8%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018509.html">
   <LINK REL="Next"  HREF="018510.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] max_user_ip not work</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20max_user_ip%20not%20work&In-Reply-To=%3Cd6bf890b-5859-3288-2726-c533b2b146d8%40treenet.co.nz%3E"
       TITLE="[squid-users] max_user_ip not work">squid3 at treenet.co.nz
       </A><BR>
    <I>Sun Jun 24 05:39:40 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="018509.html">[squid-users] max_user_ip not work
</A></li>
        <LI>Next message (by thread): <A HREF="018510.html">[squid-users] TUNNEL logging
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18512">[ date ]</a>
              <a href="thread.html#18512">[ thread ]</a>
              <a href="subject.html#18512">[ subject ]</a>
              <a href="author.html#18512">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 23/06/18 08:48, Masih Nazari wrote:
&gt;<i> hello&#160;
</I>&gt;<i> why max_user_ip not work ?
</I>&gt;<i> when i change my ip for test still able to access squid
</I>&gt;<i> squid : 3.5.20
</I>&gt;<i> os : centos 7&#160; 64 bit
</I>&gt;<i> squid installed by yum&#160;
</I>&gt;<i> i use radius server and its work fine
</I>&gt;<i> this is my config 
</I>

Could be several reasons;
 how are you sending test requests?
 are they <A HREF="http://">http://</A> or <A HREF="https://">https://</A> URLs?
 and what tool(s) are you using to fetch them?


&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> cache deny all
</I>&gt;<i> acl LocalOpenvpnPort port 80# openvpn
</I>&gt;<i> acl LocalOpenvpn dst 127.0.0.1# openvpn
</I>&gt;<i> http_access allow LocalOpenvpn LocalOpenvpnPort # openvpn
</I>
You should know this, but stating it for completeness anyway:

Any traffic allowed by the above lines does not get authenticated at
all. So it cannot have this ACL applied. If your tests URLs resolve to
127.0.0.1:80 then they will always &quot;fail&quot; tests about user related
things due to this &quot;allow&quot;.


&gt;<i> auth_param basic program /usr/lib64/squid/basic_radius_auth -f
</I>&gt;<i> /etc/squid/radius_config
</I>&gt;<i> auth_param basic children 5
</I>&gt;<i> auth_param basic realm Web-Proxy
</I>&gt;<i> auth_param basic credentialsttl 5 minute
</I>&gt;<i> auth_param basic casesensitive off
</I>&gt;<i> authenticate_cache_garbage_interval 5 minute
</I>&gt;<i> authenticate_ttl 5 minute
</I>&gt;<i> authenticate_ip_ttl 1 minute
</I>
&gt;<i>From the documentation for this directive:
</I>&quot;
 Use a small value (e.g., 60 seconds)
 if your users might change addresses
 quickly, as is the case with dialup.
&quot;

The above line configures Squid to *ignore* (and discard/replace) IP
address info about a user login if it was added more than 1 minute earlier.

If you want IP to be fixed for long periods, *definitely* set that to a
longer time. I suggest much longer than the discard timer on the
credentials themselves (currently 5min).

(I don't recall right now if it updates/restarts that TTL timer on IP
info for every request related to it. You test result suggests that it
probably does not).



&gt;<i> acl radius_auth proxy_auth REQUIRED
</I>&gt;<i> acl maxuser max_user_ip -s 1&gt; deny_info ERR_MAX_IP maxuser
</I>&gt;<i> http_access deny maxuser
</I>&gt;<i> http_access allow radius_auth
</I>&gt;<i> http_access deny all
</I>&gt;<i> http_port 7080
</I>&gt;<i> debug_options &quot;ALL,9&quot;
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> this is my squid info :
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Squid Cache: Version 3.5.20
</I>&gt;<i> Service Name: squid
</I>...
&gt;<i> '--enable-ssl-crtd' '--with-openssl'
</I>Not related to your question, but important:

This is using OpenSSL support with an outdated Squid version (more than
1 year). The TLS environment and code in Squid is *very* volatile, and
the code in versions older than 3.5.24 has known security
vulnerabilities. Please upgrade. The current 3.5 release is 3.5.27.

(You may also want to check your OpenSSL library version is up to date
first.)

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="018509.html">[squid-users] max_user_ip not work
</A></li>
	<LI>Next message (by thread): <A HREF="018510.html">[squid-users] TUNNEL logging
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18512">[ date ]</a>
              <a href="thread.html#18512">[ thread ]</a>
              <a href="subject.html#18512">[ subject ]</a>
              <a href="author.html#18512">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
