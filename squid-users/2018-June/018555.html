<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Windows 10 Feature Updates not coming through
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Windows%2010%20Feature%20Updates%20not%20coming%20through&In-Reply-To=%3C14df8c87-3ed7-1160-bd32-52b51d58caf4%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018546.html">
   <LINK REL="Next"  HREF="018547.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Windows 10 Feature Updates not coming through</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Windows%2010%20Feature%20Updates%20not%20coming%20through&In-Reply-To=%3C14df8c87-3ed7-1160-bd32-52b51d58caf4%40treenet.co.nz%3E"
       TITLE="[squid-users] Windows 10 Feature Updates not coming through">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Jun 27 19:31:59 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="018546.html">[squid-users] Windows 10 Feature Updates not coming through
</A></li>
        <LI>Next message (by thread): <A HREF="018547.html">[squid-users] sslproxy_foreign_intermediate_certs -- where to	locate a bundle
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18555">[ date ]</a>
              <a href="thread.html#18555">[ thread ]</a>
              <a href="subject.html#18555">[ subject ]</a>
              <a href="author.html#18555">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 28/06/18 02:57, Paul Hackmann wrote:
&gt;<i> Hello.&#160; I can't figure out why, but I can get regular windows 10 updates
</I>&gt;<i> through the proxy without problem, but the larger feature updates (1803)
</I>&gt;<i> always fail to download.
</I>
Have you refreshed your knowledge of what the relevant config settings
are and what they do?
&lt;<A HREF="https://wiki.squid-cache.org/SquidFaq/WindowsUpdate">https://wiki.squid-cache.org/SquidFaq/WindowsUpdate</A>&gt;

NP: the FAQ is heavy on what they do and values are indications only -
so that as these things change you can know what to tweak.



&gt;<i>&#160; I can do the windows 10 update assistant
</I>&gt;<i> manually, and that seems to work ok.&#160; I'm not sure what I am missing.&#160;
</I>&gt;<i> Do I have a problem with my configuration?&#160; I am trying to do the
</I>&gt;<i> download through port 4120.
</I>&gt;<i> 
</I>&gt;<i> http_port 3120
</I>&gt;<i> http_port 4120 #intercept
</I>&gt;<i> 
</I>&gt;<i> cache_dir ufs /var/spool/squid 10000 16 256
</I>...

&gt;<i> 
</I>&gt;<i> acl CONNECT method CONNECT
</I>&gt;<i> acl wuCONNECT dstdomain <A HREF="http://www.update.microsoft.com">http://www.update.microsoft.com</A>
</I>
This should be a FQDN or domain wildcard, not a URL. Remove the
'<A HREF="http://">http://</A>' portion.

IIRC, this wuCONNECT stuff is for CONNECT messages where the reverse-DNS
is needing to match the exact call-home sever WU uses/used. With this
broken it cannot do raw-IP fetches it sometimes needs.
 The &quot;allow windowsupdate localnet&quot; will be allowing CONNECT things this
does not match for most fetches.




&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> range_offset_limit 10000 MB windowsupdate
</I>
So very, very large files (ie up to 9GB) will download the *entire*
object just to fetch and deliver the final, say 1MB (or worse 32KB) of
data to the client.

This limit should be much smaller IMO. Each range segment that the WU
downloader breaks the update into causes a new full copy to be fetched.
Wasting hundreds of multiples of 100-200 MB might be (relatively)
acceptable. But many _thousands_ of multiples of 10 GB, not so much.



Other than that I'm not seeing anything particularly notable about your
config. It may be related to how the D/L is being done. For example, if
it uses the Win10 P2P functionality then its unlikely to be going over
HTTP as the proxy requires.

Any way you can find out if there is a new domain being used for these
Win10 features?
 The list in the FAQ page was last updated for Win8.0 IIRC, so there may
be something needing adding there.


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="018546.html">[squid-users] Windows 10 Feature Updates not coming through
</A></li>
	<LI>Next message (by thread): <A HREF="018547.html">[squid-users] sslproxy_foreign_intermediate_certs -- where to	locate a bundle
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18555">[ date ]</a>
              <a href="thread.html#18555">[ thread ]</a>
              <a href="subject.html#18555">[ subject ]</a>
              <a href="author.html#18555">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
