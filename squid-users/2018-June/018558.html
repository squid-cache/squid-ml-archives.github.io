<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Setting up a Whitelist
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Setting%20up%20a%20Whitelist&In-Reply-To=%3C99b0099f-55ff-f152-e7c1-22245e6e35b4%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018557.html">
   <LINK REL="Next"  HREF="018568.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Setting up a Whitelist</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Setting%20up%20a%20Whitelist&In-Reply-To=%3C99b0099f-55ff-f152-e7c1-22245e6e35b4%40treenet.co.nz%3E"
       TITLE="[squid-users] Setting up a Whitelist">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Jun 27 20:59:07 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="018557.html">[squid-users] Setting up a Whitelist
</A></li>
        <LI>Next message (by thread): <A HREF="018568.html">[squid-users] Setting up a Whitelist
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18558">[ date ]</a>
              <a href="thread.html#18558">[ thread ]</a>
              <a href="subject.html#18558">[ subject ]</a>
              <a href="author.html#18558">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 28/06/18 08:21, Donald Muller wrote:
&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> &#160;
</I>&gt;<i> 
</I>&gt;<i> Don&#8217;t know if what I want to do is even possible but here is the
</I>&gt;<i> situation. I have Squid set up on my QNAP NAS. It is running fine. I am
</I>&gt;<i> using it with the blacklist and sites get blocked as they should.
</I>&gt;<i> However there a number of sites that I do not want blacklisted so I
</I>&gt;<i> thought I&#8217;d set up a whitelist for them. What I did was to add an
</I>&gt;<i> include statement to the squid.conf file. The included file has the
</I>&gt;<i> directives for the whitelist.
</I>&gt;<i> 
</I>&gt;<i> &#160;
</I>&gt;<i> 
</I>&gt;<i> Here are my config files.
</I>&gt;<i> 
</I>&gt;<i> &#160;
</I>&gt;<i> 
</I>&gt;<i> &#160;
</I>&gt;<i> 
</I>&gt;<i> Squid.conf
</I>&gt;<i> 
</I>&gt;<i> &#160;
</I>&gt;<i> 
</I>&gt;<i> # The user name and group name Squid will operate as
</I>&gt;<i> 
</I>&gt;<i> cache_effective_user httpdusr
</I>&gt;<i> 
</I>
The above username requires read access to the included file *and* any
other files which it instructs Squid to load.

That access may be granted though group access to the file. IF the above
member is part of a permitted group. Be careful, Do Not assign Squid
into root group nor any equivalent on the machine.


...
&gt;<i> &#160;
</I>&gt;<i> 
</I>&gt;<i> acl allnet src all&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # All Net
</I>&gt;<i> 
</I>
Why?
 you are not doing anything like deny_info which might need &quot;allnet&quot;

Using the built-in &quot;all&quot; ACL would be simpler.

&gt;<i> 
</I>&gt;<i> include /usr/local/squid/etc/acl.conf
</I>&gt;<i> 
</I>&gt;<i> include
</I>&gt;<i> /share/CACHEDEV1_DATA/UserData/Configs/Proxy/whitelist.conf&#160;&#160;&#160;&#160;&#160;&#160;
</I>&gt;<i> &#223;-------- I added this line
</I>&gt;<i> 
</I>
The only thing to be aware of is order dependence. Squid loads and
operates as if the contents of these files were copy-and-pasted exactly
at the line where the include directive is.

That means any directives like http_access which contain order-specific
behaviours retain those behaviours between files in the specific order
of the include lines.

So, if acl.conf contains &quot;http_access deny blacklist&quot; and whitelist.conf
contains &quot;http_access allow whitelist&quot; then:
 a) blacklist is *still* denying requests before whitelist is even tested.
 b) whitelist.conf is (only) adding a bypass of all the
default/recommended squid.conf security lines

I'm pointing out (b) because you should really only place custom rules
(especially http_access related ones) at the point in squid.conf labeled
&quot;INSERT YOUR OWN RULE(S) HERE&quot;.

You have not stated whether you are trying to whitelist against entries
in the blakclist, or against the proxies default security rules to
prevent unsafe behaviour (ie spam email using the proxy as a relay,
non-HTTPS tuynnels).
 If you want the former; then the includes need to be done the other way
around (whitelist.conf include first, then acl.conf).
 If you want the latter; then you have it now.


...

&gt;<i> 
</I>&gt;<i> include /usr/local/squid/etc/acl_http.conf
</I>&gt;<i> 
</I>&gt;<i> #http_access allow allnet ncsa_users
</I>&gt;<i> 
</I>&gt;<i> #http_access allow allnet group_administrators
</I>&gt;<i> 
</I>&gt;<i> #http_access allow allnet nas_user
</I>
NP: Placing &quot;all&quot; on a line with other ACL checks is a hack to prevent
authentication process being initiated by lines if the credentials are
known but not allowed certain access. It only works if the &quot;all&quot; is
placed at the RHS end of lines.
 So &quot;allnet&quot; is pointless on the above.


&gt;<i> 
</I>&gt;<i> http_access allow allnet
</I>&gt;<i> 
</I>&gt;<i> #http_access deny allnet
</I>&gt;<i> 
</I>&gt;<i> # And finally deny all other access to this proxy
</I>&gt;<i> 
</I>
But &quot;allnet&quot; was defined as &quot;all&quot;. Which overrides this safety net
config line and makes your proxy an open-proxy by default.
 That would be clearer if you had used &quot;all&quot; instead of custom &quot;allnet&quot;.



&gt;<i> #
</I>&gt;<i> 
</I>&gt;<i> mime_table /usr/local/squid/etc/mime.conf
</I>&gt;<i> 
</I>&gt;<i> pid_filename /usr/local/squid/var/run/squid.pid
</I>&gt;<i> 
</I>&gt;<i> diskd_program /usr/local/squid/libexec/diskd
</I>&gt;<i> 
</I>&gt;<i> unlinkd_program /usr/local/squid/libexec/unlinkd
</I>&gt;<i> 
</I>&gt;<i> icon_directory /usr/local/squid/share/icons
</I>&gt;<i> 
</I>&gt;<i> err_page_stylesheet /usr/local/squid/etc/errorpage.css
</I>
None of the above lines should be necessary. If you are custom building
Squid it should be built with ./configure options setting defaults
appropriate for the OS its going to run on.
You only need these squid.conf directives if you have one or a few files
in really weird placement unusual for the OS.

Same for any directive which is setting default values. You can simplify
the config a huge amount by removing them entirely these days.
(Squid-2.x needed them, Squid-3.x does not).


&gt;<i> whitelist.conf
</I>&gt;<i> 
</I>&gt;<i> &#160;
</I>&gt;<i> 
</I>&gt;<i> acl whitelist dstdomain
</I>&gt;<i> &quot;/share/CACHEDEV1_DATA/UserData/Configs/Proxy/whitelist.txt&quot;
</I>&gt;<i> 
</I>&gt;<i> http_access allow whitelist
</I>&gt;<i> 
</I>

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="018557.html">[squid-users] Setting up a Whitelist
</A></li>
	<LI>Next message (by thread): <A HREF="018568.html">[squid-users] Setting up a Whitelist
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18558">[ date ]</a>
              <a href="thread.html#18558">[ thread ]</a>
              <a href="subject.html#18558">[ subject ]</a>
              <a href="author.html#18558">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
