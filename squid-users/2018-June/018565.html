<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] dns_packet_max
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20dns_packet_max&In-Reply-To=%3Cf3bee8d3-c480-5a10-320d-e0c28404f560%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018562.html">
   <LINK REL="Next"  HREF="018566.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] dns_packet_max</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20dns_packet_max&In-Reply-To=%3Cf3bee8d3-c480-5a10-320d-e0c28404f560%40treenet.co.nz%3E"
       TITLE="[squid-users] dns_packet_max">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Jun 27 22:33:12 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="018562.html">[squid-users] dns_packet_max
</A></li>
        <LI>Next message (by thread): <A HREF="018566.html">[squid-users] http_port vs https_port (Alex Rousskov)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18565">[ date ]</a>
              <a href="thread.html#18565">[ thread ]</a>
              <a href="subject.html#18565">[ subject ]</a>
              <a href="author.html#18565">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 28/06/18 10:00, Gordon Hsiao wrote:
&gt;<i> Still reading all the options, noticed dns_packet_max is off by default.
</I>&gt;<i> My squid uses dnsmasq, that has EDNS on by default and it &quot;defaults to
</I>&gt;<i> 4096, which is the RFC5625-recommended size&quot;
</I>&gt;<i> 
</I>&gt;<i> In this case what will happen then? dnsmasq may receive EDNS up to 4K,
</I>&gt;<i> which squid by default only takes
</I>&gt;<i> 512Byte.&#160;&#160;<A HREF="http://www.squid-cache.org/Versions/v3/3.5/cfgman/dns_packet_max.html&#160;">http://www.squid-cache.org/Versions/v3/3.5/cfgman/dns_packet_max.html&#160;</A>
</I>&gt;<i> warns some older resolver does not like EDNS, but dnsmasq has this
</I>&gt;<i> feature on by default...
</I>
That being about the external dnsmasq&lt;-&gt;Internet behaviour should not
affect Squid. Though I'm surprised they did not hit the same problems we
did (see below).

The connection between Squid and the dnsmasq should always use the
traditional DNS fallback of TCP/53 if UDP/53 packets are not large
enough for a full response. That remains true even if an EDNS message
from Squid makes larger than 512 byte UDP packets be possible.


&gt;<i> 
</I>&gt;<i> Thinking about setting up &quot;dns_packet_max 4096&quot; and see what happens...
</I>&gt;<i> 
</I>
It worked fine for me when I added EDNS support to Squid. But others
reported that EDNS usage could crash their home routers. Since one of
the Squid use-cases is being an appliance used in residential situations
to limit upstream bandwidth we could not enable it by default.


Note paragraph #3 of that directives documentation about JumboGram
support at the network level. I suspect it was bugs in that TCP/IP
feature which was crashing peoples routers when 1500+ byte replies were
attempted.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="018562.html">[squid-users] dns_packet_max
</A></li>
	<LI>Next message (by thread): <A HREF="018566.html">[squid-users] http_port vs https_port (Alex Rousskov)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18565">[ date ]</a>
              <a href="thread.html#18565">[ thread ]</a>
              <a href="subject.html#18565">[ subject ]</a>
              <a href="author.html#18565">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
