<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] PHP: failed to open stream: Cannot connect to HTTPS server through proxy
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20PHP%3A%20failed%20to%20open%20stream%3A%20Cannot%20connect%20to%0A%20HTTPS%20server%20through%20proxy&In-Reply-To=%3Cf57f2d13-6c62-66bd-bbf5-ea447b05a9aa%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017758.html">
   <LINK REL="Next"  HREF="017760.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] PHP: failed to open stream: Cannot connect to HTTPS server through proxy</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20PHP%3A%20failed%20to%20open%20stream%3A%20Cannot%20connect%20to%0A%20HTTPS%20server%20through%20proxy&In-Reply-To=%3Cf57f2d13-6c62-66bd-bbf5-ea447b05a9aa%40treenet.co.nz%3E"
       TITLE="[squid-users] PHP: failed to open stream: Cannot connect to HTTPS server through proxy">squid3 at treenet.co.nz
       </A><BR>
    <I>Sun Mar 11 06:50:37 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="017758.html">[squid-users] PHP: failed to open stream: Cannot connect to HTTPS	server through proxy
</A></li>
        <LI>Next message (by thread): <A HREF="017760.html">[squid-users] Introduction &amp; Squid ports
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17759">[ date ]</a>
              <a href="thread.html#17759">[ thread ]</a>
              <a href="subject.html#17759">[ subject ]</a>
              <a href="author.html#17759">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 11/03/18 02:32, chiasa.men wrote:
&gt;<i> I tried to install a joomla-Plugin from behind squid. It didn't work. I could 
</I>&gt;<i> reproduce the error using the following php-script:
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> &lt;?php
</I>&gt;&gt;<i> $url=&quot;<A HREF="https://downloads.joomla.org/extensions/install-from-web/1-1-1/">https://downloads.joomla.org/extensions/install-from-web/1-1-1/</A>
</I>&gt;<i> plg_webinstaller_3.7v1.1.1.zip&quot;;
</I>&gt;&gt;<i> $ctx = stream_context_create(['http' =&gt; ['proxy' =&gt; &quot;<A HREF="tcp://$proxy:$port">tcp://$proxy:$port</A>&quot;],
</I>&gt;&gt;<i> 'ssl' =&gt; ['capture_session_meta' =&gt; TRUE]]);
</I>&gt;&gt;<i> $html = file_get_contents($url , FALSE, $ctx);
</I>&gt;&gt;<i> $meta = stream_context_get_options($ctx)['ssl']['session_meta']; 
</I>&gt;&gt;<i> var_dump($meta);
</I>&gt;&gt;<i> ?&gt;
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Results in:
</I>&gt;<i> 
</I>&gt;&gt;<i> PHP Warning:  file_get_contents(): Peer certificate CN=`*.s3-us-
</I>&gt;<i> west-2.amazonaws.com' did not match expected CN=`downloads.joomla.org' in /
</I>&gt;<i> tmp/test.php on line 5
</I>
Please read that error message.
 downloads.joomla.org is not a part of *.s3-us-west-2.amazonaws.com

This &quot;CN=&quot; is a TLS certificate error and has nothing to do with the proxy.

Why the proxy is being asked to connect to s3-us-west-2.amazonaws.com is
not clear, but the proxy is only doing exactly what is asked of it. Any
issues like this which occur with the data inside the CONNECT tunnel are
purely a problem between client and server.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="017758.html">[squid-users] PHP: failed to open stream: Cannot connect to HTTPS	server through proxy
</A></li>
	<LI>Next message (by thread): <A HREF="017760.html">[squid-users] Introduction &amp; Squid ports
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17759">[ date ]</a>
              <a href="thread.html#17759">[ thread ]</a>
              <a href="subject.html#17759">[ subject ]</a>
              <a href="author.html#17759">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
