<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Introduction &amp; Squid ports
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Introduction%20%26%20Squid%20ports&In-Reply-To=%3Cb09786da-d877-42bc-0b73-aa8544968b63%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017760.html">
   <LINK REL="Next"  HREF="017765.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Introduction &amp; Squid ports</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Introduction%20%26%20Squid%20ports&In-Reply-To=%3Cb09786da-d877-42bc-0b73-aa8544968b63%40treenet.co.nz%3E"
       TITLE="[squid-users] Introduction &amp; Squid ports">squid3 at treenet.co.nz
       </A><BR>
    <I>Sun Mar 11 09:17:26 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="017760.html">[squid-users] Introduction &amp; Squid ports
</A></li>
        <LI>Next message (by thread): <A HREF="017765.html">[squid-users] Introduction &amp; Squid ports
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17764">[ date ]</a>
              <a href="thread.html#17764">[ thread ]</a>
              <a href="subject.html#17764">[ subject ]</a>
              <a href="author.html#17764">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 11/03/18 20:51, Nicolas Kovacs wrote:
&gt;<i> 
</I>&gt;<i> This configuration works perfectly and gives me no errors or whatsoever,
</I>&gt;<i> though I don't quite understand why I need all these ports. When I used
</I>&gt;<i> only HTTP, I had this configuration
</I>&gt;<i> 
</I>&gt;<i> http_port 3128 transparent
</I>
Which receives port-80 syntax traffic.

&gt;<i> 
</I>&gt;<i> So I wonder why it wasn't possible to have something like this:
</I>&gt;<i> 
</I>&gt;<i> http_port 3128 transparent
</I>
Which (still) receives port-80 syntax traffic.

&gt;<i> https_port 3129 transparent ssl-bump
</I>&gt;<i> 
</I>
Which receives port-443 syntax traffic.

&gt;<i> I'm not sure about how the &quot;intercept&quot; mode works. As far as I
</I>&gt;<i> understand, connections to port 80 get redirected to port 3128 by the
</I>&gt;<i> firewall, but what then? Does &quot;http_port 3128 intercept&quot; mean that Squid
</I>&gt;<i> redirects these again and sends them to its internal port 3130?
</I>
The &quot;intercept&quot; mode flag tells Squid it is receiving traffic from a NAT
system. So the IP addresses need special handling, and so does the HTTP
message syntax.

&gt;<i> 
</I>&gt;<i> Similarly, connections to port 443 get redirected to port 3129 by the
</I>&gt;<i> firewall, so far so good. But I don't understand how to read &quot;https_port
</I>&gt;<i> 3129 intercept&quot;. Again, does this mean that Squid redirects these to its
</I>&gt;<i> internal port 3130, along with HTTP connections?
</I>
&quot;https_port&quot; -&gt; receiving HTTP wrapped in TLS (aka HTTPS),
&quot;3129&quot;       -&gt; listening on port 3129,
&quot;intercept&quot;  -&gt; for traffic delivered from a NAT system.

NP: &quot;transparent&quot; is deprecated since it does _not_ mean *transparency*.


&gt;<i> 
</I>&gt;<i> In short, my configuration works, but I'd like to get a better grasp on
</I>&gt;<i> *how* it works.
</I>
The how is a bit complex and less important than the &quot;what&quot;. The best
place to start IMO is RFC 7230 section 5.3, which describes the
differences in HTTP messages (ie the syntax) which are delivered to
origin servers (port 80) or to proxies (port 3128).
 &lt;<A HREF="https://tools.ietf.org/html/rfc7230#section-5.3">https://tools.ietf.org/html/rfc7230#section-5.3</A>&gt;


In your config you changed your 3128 to receiving port-80 (origin-form)
syntax with &quot;intercept&quot;. So port 3130 was necessary to takeover
receiving of the normal proxy traffic.

The TLS wrappers on HTTPS need special handling to decrypt so that needs
another port setup to do that decryption first and HTTP message handling
after. &quot;https_port&quot; directive sets up a port for that.

NP: the &quot;ssl-bump&quot; flag does not mean simply receiving HTTPS traffic, it
means specifically decrypting HTTPS traffic destined *to another server*
- ie MITM at the TLS level. Which can be done for port-443 traffic OR
for CONNECT messages in the proxy (port-3128) syntax traffic. Thus it is
applicable on both https_port and http_port traffic respectively.


HTH
Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="017760.html">[squid-users] Introduction &amp; Squid ports
</A></li>
	<LI>Next message (by thread): <A HREF="017765.html">[squid-users] Introduction &amp; Squid ports
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17764">[ date ]</a>
              <a href="thread.html#17764">[ thread ]</a>
              <a href="subject.html#17764">[ subject ]</a>
              <a href="author.html#17764">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
