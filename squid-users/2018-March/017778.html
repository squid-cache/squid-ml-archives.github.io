<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Allow some domains to bypass Squid
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Allow%20some%20domains%20to%20bypass%20Squid&In-Reply-To=%3C01b901d3b9c7%2429bc19a0%247d344ce0%24%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017766.html">
   <LINK REL="Next"  HREF="017780.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Allow some domains to bypass Squid</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Allow%20some%20domains%20to%20bypass%20Squid&In-Reply-To=%3C01b901d3b9c7%2429bc19a0%247d344ce0%24%40ngtech.co.il%3E"
       TITLE="[squid-users] Allow some domains to bypass Squid">eliezer at ngtech.co.il
       </A><BR>
    <I>Mon Mar 12 05:58:37 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="017766.html">[squid-users] Allow some domains to bypass Squid
</A></li>
        <LI>Next message (by thread): <A HREF="017780.html">[squid-users] Distribute root certificate to clients
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17778">[ date ]</a>
              <a href="thread.html#17778">[ thread ]</a>
              <a href="subject.html#17778">[ subject ]</a>
              <a href="author.html#17778">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey Nicolas,

If you are running a squid which doesn't have a mandatory rule of &quot;Block first and then allow&quot; or what in the security industry will be named &quot;up-tight&quot; then Yuri solution is the right path.
But... as a rule of thumb, if you don't need to pass the traffic into the proxy software don&#8217;t and allow or block whatever you can on the OS firewall level.
I wrote couple example bypass scripts:
<A HREF="https://gist.github.com/elico/e0faadf0cc63942c5aaade808a87deef">https://gist.github.com/elico/e0faadf0cc63942c5aaade808a87deef</A>
<A HREF="https://gist.github.com/elico/a54c2c8f8e1a2407b42210896b960f4b">https://gist.github.com/elico/a54c2c8f8e1a2407b42210896b960f4b</A>

For a non router\proxy linux system:
<A HREF="https://gist.github.com/elico/f21dae7a34e1736f56a1995977852460">https://gist.github.com/elico/f21dae7a34e1736f56a1995977852460</A>

The above examples are good for pre-known domains similar to the script you wrote in your blog but it gives some form of dynamics to the firewall rules.
I believe that the best formula is to combine both squid splice with ipset and domains resolution and the bypass rules.
Using  squid you will be able to splice domains automatically and with a daily log analysis of squid access.log files you might be able to find new domains that you can add into your firewall level bypassed domains.

Let me know if it sounds good and it worth a wiki article.
Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>


-----Original Message-----
From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of Nicolas Kovacs
Sent: Sunday, March 11, 2018 10:07
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: [squid-users] Allow some domains to bypass Squid

Hi,

I have Squid setup as a transparent HTTP+HTTPS proxy in my local
network, using SSL-Bump.

The configuration works quite nicely, according to
/var/log/squid/cache.log and /var/log/squid/access.log.

This being said, I am having trouble with a handful of domains like
Github, or my OwnCloud installation. I have an OwnCloud server installed
at <A HREF="https://cloud.microlinux.fr,">https://cloud.microlinux.fr,</A> and everytime I fire up a client, I have
to confirm the use of an untrusted certificate. And on my workstation, I
can't connect to my Github repository anymore. Here's the error I get.

  # git pull
  fatal: unable to access '<A HREF="https://github.com/kikinovak/centos-">https://github.com/kikinovak/centos-</A>
  7-desktop-kde/': Peer's certificate issuer has been marked as not
  trusted by the user.

So I thought the best thing to do is to create an exception for this
handful of domains with issues.

Can I configure some domains to simply bypass the proxy in my current
(transparent) setup? Ideally, the configuration should be able to read a
simple text file containing said domains, something like
/etc/squid/bypass-these-domains.txt. And then these bypass the proxy and
get treated regularly, as if there was no proxy?

Cheers,

Niki
-- 
Microlinux - Solutions informatiques durables
7, place de l'&#233;glise - 30730 Montpezat
Site : <A HREF="https://www.microlinux.fr">https://www.microlinux.fr</A>
Blog : <A HREF="https://blog.microlinux.fr">https://blog.microlinux.fr</A>
Mail : <A HREF="https://lists.squid-cache.org/listinfo/squid-users">info at microlinux.fr</A>
T&#233;l. : 04 66 63 10 32
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="017766.html">[squid-users] Allow some domains to bypass Squid
</A></li>
	<LI>Next message (by thread): <A HREF="017780.html">[squid-users] Distribute root certificate to clients
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17778">[ date ]</a>
              <a href="thread.html#17778">[ thread ]</a>
              <a href="subject.html#17778">[ subject ]</a>
              <a href="author.html#17778">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
