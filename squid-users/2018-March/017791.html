<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Exception with squid 3.5.25 in ICAP options path
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Exception%20with%20squid%203.5.25%20in%20ICAP%20options%20path&In-Reply-To=%3CCABCok%3DLdd18_8ScakfFuK3p9P1JW%3DUAbP_8wt3xf3yx7TtT6_A%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017796.html">
   <LINK REL="Next"  HREF="017792.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Exception with squid 3.5.25 in ICAP options path</H1>
    <B>Arunabha Saha</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Exception%20with%20squid%203.5.25%20in%20ICAP%20options%20path&In-Reply-To=%3CCABCok%3DLdd18_8ScakfFuK3p9P1JW%3DUAbP_8wt3xf3yx7TtT6_A%40mail.gmail.com%3E"
       TITLE="[squid-users] Exception with squid 3.5.25 in ICAP options path">arunabha.saha at gmail.com
       </A><BR>
    <I>Tue Mar 13 00:06:52 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="017796.html">[squid-users] TCP_MISS_ABORTED/000|
</A></li>
        <LI>Next message (by thread): <A HREF="017792.html">[squid-users] Exception with squid 3.5.25 in ICAP options path
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17791">[ date ]</a>
              <a href="thread.html#17791">[ thread ]</a>
              <a href="subject.html#17791">[ subject ]</a>
              <a href="author.html#17791">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Seeing a exception followed by termination fairly regularly with
Squid--&gt;Icap with this stacktrace on 3.5.25.

The problem typically happens when icap has not been started yet and squid
is processing some requests and is configured for ICAP adaptation service.

It seems like the ICAP Options request goes unanswered (as it would since
ICAP is not UP) and we try to shut down the ICAP service but there's some
dangling state with respect to the options  requests that were sent.

Appreciate it if someone can comment on whether this is known and fixed
before i dig a little deeper.



#0  0x00007ff944120428 in __GI_raise (sig=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">sig at entry</A>=6) at
../sysdeps/unix/sysv/linux/raise.c:54
#1  0x00007ff94412202a in __GI_abort () at abort.c:89
#2  0x00007ff944a670d5 in __gnu_cxx::__verbose_terminate_handler() () from
/usr/lib/x86_64-linux-gnu/libstdc++.so.6
#3  0x00007ff944a64cc6 in ?? () from
/usr/lib/x86_64-linux-gnu/libstdc++.so.6
#4  0x00007ff944a63bc9 in ?? () from
/usr/lib/x86_64-linux-gnu/libstdc++.so.6
#5  0x00007ff944a645b8 in __gxx_personality_v0 () from
/usr/lib/x86_64-linux-gnu/libstdc++.so.6
#6  0x00007ff9444c4f03 in ?? () from /lib/x86_64-linux-gnu/libgcc_s.so.1
#7  0x00007ff9444c5410 in _Unwind_RaiseException () from
/lib/x86_64-linux-gnu/libgcc_s.so.1
#8  0x00007ff944a64f47 in __cxa_throw () from
/usr/lib/x86_64-linux-gnu/libstdc++.so.6
#9  0x00000000006f3486 in Throw (message=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">message at entry</A>=0x8ae66e
&quot;!theOptionsFetcher&quot;, fileName=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">fileName at entry</A>=0x8ae647 &quot;ServiceRep.cc&quot;,
lineNo=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">lineNo at entry</A>=50,
    id=149798962) at TextException.cc:93
#10 0x00000000008071f9 in Adaptation::Icap::ServiceRep::~ServiceRep
(this=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">this at entry</A>=0x1298b58, __in_chrg=&lt;optimized out&gt;,
__vtt_parm=&lt;optimized out&gt;)
    at ServiceRep.cc:50
#11 0x00000000008073c9 in Adaptation::Icap::ServiceRep::~ServiceRep
(this=0x1298b58, __in_chrg=&lt;optimized out&gt;, __vtt_parm=&lt;optimized out&gt;) at
ServiceRep.cc:52
#12 0x000000000081d6c3 in RefCount&lt;Adaptation::Service&gt;::dereference
(newP=0x0, this=0x133ef88) at ../../../src/base/RefCount.h:79
#13 RefCount&lt;Adaptation::Service&gt;::~RefCount (this=0x133ef88,
__in_chrg=&lt;optimized out&gt;) at ../../../src/base/RefCount.h:35
#14 Adaptation::Icap::Launcher::~Launcher (this=0x133ef68,
__vtt_parm=0xb5e208 &lt;VTT for Adaptation::Icap::OptXactLauncher+8&gt;,
__in_chrg=&lt;optimized out&gt;)
    at Launcher.cc:32
#15 0x0000000000830137 in
Adaptation::Icap::OptXactLauncher::~OptXactLauncher (this=0x133ef68,
__in_chrg=&lt;optimized out&gt;, __vtt_parm=&lt;optimized out&gt;)
    at ../../../src/adaptation/icap/OptXact.h:55
#16 Adaptation::Icap::OptXactLauncher::~OptXactLauncher (this=0x133ef68,
__in_chrg=&lt;optimized out&gt;, __vtt_parm=&lt;optimized out&gt;)
    at ../../../src/adaptation/icap/OptXact.h:55
#17 0x00000000006f0666 in AsyncJob::callEnd (this=0x133efa8) at
AsyncJob.cc:144
#18 0x00000000007f4732 in JobDialer&lt;Adaptation::Initiator&gt;::dial
(this=0x153f2f0, call=...) at ../../src/base/AsyncJobCalls.h:181
#19 0x00000000006ee331 in AsyncCall::make (this=0x153f2c0) at
AsyncCall.cc:40
#20 0x00000000006f26e5 in AsyncCallQueue::fireNext (this=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">this at entry</A>=0xdc2c60)
at AsyncCallQueue.cc:56
#21 0x00000000006f2b09 in AsyncCallQueue::fire (this=0xdc2c60) at
AsyncCallQueue.cc:42
#22 0x000000000057def9 in EventLoop::dispatchCalls (this=0x7fffca605010) at
EventLoop.cc:143
#23 EventLoop::runOnce (this=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">this at entry</A>=0x7fffca605010) at EventLoop.cc:120
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20180312/a6b91685/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20180312/a6b91685/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="017796.html">[squid-users] TCP_MISS_ABORTED/000|
</A></li>
	<LI>Next message (by thread): <A HREF="017792.html">[squid-users] Exception with squid 3.5.25 in ICAP options path
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17791">[ date ]</a>
              <a href="thread.html#17791">[ thread ]</a>
              <a href="subject.html#17791">[ subject ]</a>
              <a href="author.html#17791">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
