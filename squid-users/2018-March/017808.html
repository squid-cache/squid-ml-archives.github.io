<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] SSL intercept in explicit mode
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL%20intercept%20in%20explicit%20mode&In-Reply-To=%3CCANAZdzUsamD-_P2gB9oQEbjR%3DY0XEK0mnKUdYgjXtRGAxnPQUQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017807.html">
   <LINK REL="Next"  HREF="017809.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] SSL intercept in explicit mode</H1>
    <B>Aaron Turner</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL%20intercept%20in%20explicit%20mode&In-Reply-To=%3CCANAZdzUsamD-_P2gB9oQEbjR%3DY0XEK0mnKUdYgjXtRGAxnPQUQ%40mail.gmail.com%3E"
       TITLE="[squid-users] SSL intercept in explicit mode">synfinatic at gmail.com
       </A><BR>
    <I>Tue Mar 13 17:00:31 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="017807.html">[squid-users] SSL intercept in explicit mode
</A></li>
        <LI>Next message (by thread): <A HREF="017809.html">[squid-users] SSL intercept in explicit mode
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17808">[ date ]</a>
              <a href="thread.html#17808">[ thread ]</a>
              <a href="subject.html#17808">[ subject ]</a>
              <a href="author.html#17808">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&quot;Usually misconfiguration leads to memory overhead.&quot;

This may be true, but if you look in the list archives a few months
ago I basically chased my tail in circles and nobody could tell me
what I was doing wrong and so many of the docs are so old that they're
worse then useless, they seem to suggest the wrong thing.

It was literally leaking GB's worth of RAM.  I even disabled all
caching and process sizes were growing into the GB's.  Turn off
ssl-bump and the leak went away.

This is what I was using:

http_port 10.0.0.1:3128 ssl-bump generate-host-certificates=on
dynamic_cert_mem_cache_size=400MB cert=/etc/squid/ssl_cert/myCA.pem
sslflags=NO_DEFAULT_CA
http_port localhost:3128
ssl_bump bump all

sslcrtd_program /usr/lib64/squid/ssl_crtd -s /var/lib/squid/ssl_db -M 4MB
sslcrtd_children 32 startup=2 idle=2
sslproxy_session_cache_size 100 MB
sslproxy_cert_error allow all
sslproxy_flags DONT_VERIFY_PEER

This was on a machine (EC2 VM) with 14GB of RAM.

--
Aaron Turner
<A HREF="https://synfin.net/">https://synfin.net/</A>         Twitter: @synfinatic
My father once told me that respect for the truth comes close to being
the basis for all morality.  &quot;Something cannot emerge from nothing,&quot;
he said.  This is profound thinking if you understand how unstable
&quot;the truth&quot; can be.  -- Frank Herbert, Dune


On Tue, Mar 13, 2018 at 9:47 AM, Yuri &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">yvoinov at gmail.com</A>&gt; wrote:
&gt;<i> I've used it on all versions starting from 3.4.
</I>&gt;<i>
</I>&gt;<i> Now I'm using Squid 5.0.0.
</I>&gt;<i>
</I>&gt;<i> I'm afraid, my config is completely useless, because of it contains tons
</I>&gt;<i> of optimizations/tweaks/tricks and designed for customized Squid 5.0.0,
</I>&gt;<i> with different memory allocator for custom infrastructure.
</I>&gt;<i>
</I>&gt;<i> You can't just take my config, implement it and hope it will give same
</I>&gt;<i> results for you.
</I>&gt;<i>
</I>&gt;<i> At least, it uses non-system CA bundle, platform-specific configuration
</I>&gt;<i> parameters combinations, etc.
</I>&gt;<i>
</I>&gt;<i> I can say, than SSL Bump is not directly related to memory leaks. Squid
</I>&gt;<i> itself almost not contains memory leaks now. Usually misconfiguration
</I>&gt;<i> leads to memory overhead.
</I>&gt;<i>
</I>&gt;<i> As a recommendation, I can give some advices.
</I>&gt;<i>
</I>&gt;<i> 1. Use server with enough RAM. 4 Gb usually enough just for default
</I>&gt;<i> squid configuration. Usually whole system RAM usage should never be
</I>&gt;<i> bigger than 1/2 of overall physical RAM. (I.e. at least 1/3 of RAM
</I>&gt;<i> should always be free during normal running. This prevents OS allocator
</I>&gt;<i> pressure to your proxy and, also, increasing performance of proxy). In
</I>&gt;<i> case of medium proxy server 16 Gb of RAM seems big enough, but never try
</I>&gt;<i> to fill it up completely.
</I>&gt;<i>
</I>&gt;<i> 2. Don't set giant cache_mem. Remember how you platform allocates whole
</I>&gt;<i> RAM - kernel, anon pages, fs caches, etc. - and use reasonable squid's
</I>&gt;<i> memory-related settings.
</I>&gt;<i>
</I>&gt;<i> 3. Use sslflags=NO_DEFAULT_CA with your SSL Bump ports.
</I>&gt;<i>
</I>&gt;<i> 4. Never remember - SSL Bump increases your cache memory pressure due to
</I>&gt;<i> increasing caching. So, you still require to have enough memory in your
</I>&gt;<i> system.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> 13.03.2018 22:25, Aaron Turner &#1087;&#1080;&#1096;&#1077;&#1090;:
</I>&gt;&gt;<i> What version are you using Yuri?  Can you share your config?
</I>&gt;&gt;<i> Everytime I use ssl bump, I have massive memory leaks.  It's been
</I>&gt;&gt;<i> effectively unusable for me.
</I>&gt;&gt;<i> --
</I>&gt;&gt;<i> Aaron Turner
</I>&gt;&gt;<i> <A HREF="https://synfin.net/">https://synfin.net/</A>         Twitter: @synfinatic
</I>&gt;&gt;<i> My father once told me that respect for the truth comes close to being
</I>&gt;&gt;<i> the basis for all morality.  &quot;Something cannot emerge from nothing,&quot;
</I>&gt;&gt;<i> he said.  This is profound thinking if you understand how unstable
</I>&gt;&gt;<i> &quot;the truth&quot; can be.  -- Frank Herbert, Dune
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Tue, Mar 13, 2018 at 9:10 AM, Yuri &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">yvoinov at gmail.com</A>&gt; wrote:
</I>&gt;&gt;&gt;<i> Moreover,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> SSL Bump combines with interception/explicit proxy in one setup.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> And works perfectly.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> 13.03.2018 21:14, Marcus Kool &#1087;&#1080;&#1096;&#1077;&#1090;:
</I>&gt;&gt;&gt;&gt;<i> &quot;SSL bump&quot; is the name of a complex Squid feature.
</I>&gt;&gt;&gt;&gt;<i> With ssl_bump ACLs one can decide which domains can be 'spliced' (go
</I>&gt;&gt;&gt;&gt;<i> through the proxy untouched) or can be 'bumped' (decrypted).
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Interception is not a requirement for SSL bump.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Marcus
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> On 13/03/18 11:44, Danilo V wrote:
</I>&gt;&gt;&gt;&gt;&gt;<i> I mean SSL bump in explicit mode.
</I>&gt;&gt;&gt;&gt;&gt;<i> So intercept is a essencial requirement for running SSL bump?
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> Em ter, 13 de mar de 2018 &#224;s 11:10, Matus UHLAR - fantomas
</I>&gt;&gt;&gt;&gt;&gt;<i> &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">uhlar at fantomas.sk</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">uhlar at fantomas.sk</A>&gt;&gt; escreveu:
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i>     On 13.03.18 13:44, Danilo V wrote:
</I>&gt;&gt;&gt;&gt;&gt;<i>      &gt;Is it possible/feasible to configure squid in explicit mode
</I>&gt;&gt;&gt;&gt;&gt;<i> with ssl
</I>&gt;&gt;&gt;&gt;&gt;<i>      &gt;intercept?
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i>     explicit is not intercept, intercept is not explicit.
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i>     explicit is where browser is configured (manually or
</I>&gt;&gt;&gt;&gt;&gt;<i> automatically via WPAD)
</I>&gt;&gt;&gt;&gt;&gt;<i>     to use the proxy.
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i>     intercept is where network device forcifully redirects http/https
</I>&gt;&gt;&gt;&gt;&gt;<i> connections
</I>&gt;&gt;&gt;&gt;&gt;<i>     to the proxy.
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i>     maybe you mean SSL bump in explicit mode?
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i>      &gt;Due to architecture of my network it is not possible to implement
</I>&gt;&gt;&gt;&gt;&gt;<i>      &gt;transparent proxy.
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i>     excuse me?
</I>&gt;&gt;&gt;&gt;&gt;<i>     by &quot;transparent&quot; people mean what we usually call &quot;intercept&quot;.
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i>      &gt;What would be the behavior of applications that dont support
</I>&gt;&gt;&gt;&gt;&gt;<i> proxy - i.e.
</I>&gt;&gt;&gt;&gt;&gt;<i>      &gt;dont forward requests to proxy?
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i>     they mest be intercepted.
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i>     --
</I>&gt;&gt;&gt;&gt;&gt;<i>     Matus UHLAR - fantomas, <A HREF="https://lists.squid-cache.org/listinfo/squid-users">uhlar at fantomas.sk</A>
</I>&gt;&gt;&gt;&gt;&gt;<i> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">uhlar at fantomas.sk</A>&gt; ; <A HREF="http://www.fantomas.sk/">http://www.fantomas.sk/</A>
</I>&gt;&gt;&gt;&gt;&gt;<i>     Warning: I wish NOT to receive e-mail advertising to this address.
</I>&gt;&gt;&gt;&gt;&gt;<i>     Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
</I>&gt;&gt;&gt;&gt;&gt;<i>     Micro$oft random number generator: 0, 0, 0, 4.33e+67, 0, 0, 0...
</I>&gt;&gt;&gt;&gt;&gt;<i>     _______________________________________________
</I>&gt;&gt;&gt;&gt;&gt;<i>     squid-users mailing list
</I>&gt;&gt;&gt;&gt;&gt;<i>     <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;&gt;&gt;&gt;<i> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;&gt;&gt;&gt;&gt;<i>     <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;&gt;&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;&gt;&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;&gt;&gt;<i> --
</I>&gt;&gt;&gt;<i> &quot;C++ seems like a language suitable for firing other people's legs.&quot;
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> *****************************
</I>&gt;&gt;&gt;<i> * C++20 : Bug to the future *
</I>&gt;&gt;&gt;<i> *****************************
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> &quot;C++ seems like a language suitable for firing other people's legs.&quot;
</I>&gt;<i>
</I>&gt;<i> *****************************
</I>&gt;<i> * C++20 : Bug to the future *
</I>&gt;<i> *****************************
</I>&gt;<i>
</I>&gt;<i>
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="017807.html">[squid-users] SSL intercept in explicit mode
</A></li>
	<LI>Next message (by thread): <A HREF="017809.html">[squid-users] SSL intercept in explicit mode
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17808">[ date ]</a>
              <a href="thread.html#17808">[ thread ]</a>
              <a href="subject.html#17808">[ subject ]</a>
              <a href="author.html#17808">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
