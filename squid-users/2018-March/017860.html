<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Reverse proxy is not responding
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Reverse%20proxy%20is%20not%20responding&In-Reply-To=%3Cfe6922c8-471f-fb27-8221-7e0de7c31183%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017859.html">
   <LINK REL="Next"  HREF="017861.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Reverse proxy is not responding</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Reverse%20proxy%20is%20not%20responding&In-Reply-To=%3Cfe6922c8-471f-fb27-8221-7e0de7c31183%40treenet.co.nz%3E"
       TITLE="[squid-users] Reverse proxy is not responding">squid3 at treenet.co.nz
       </A><BR>
    <I>Sun Mar 18 18:57:18 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="017859.html">[squid-users] Reverse proxy is not responding
</A></li>
        <LI>Next message (by thread): <A HREF="017861.html">[squid-users] Reverse proxy is not responding
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17860">[ date ]</a>
              <a href="thread.html#17860">[ thread ]</a>
              <a href="subject.html#17860">[ subject ]</a>
              <a href="author.html#17860">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 19/03/18 03:22, Kiru Pananthan wrote:
&gt;<i> Hi Amos
</I>&gt;<i> 
</I>&gt;<i> Thanks for your reply,
</I>&gt;<i> 
</I>&gt;<i> I have restarted the squid service using the command&#160;#
</I>&gt;<i> /etc/init.d/squid3 restart and also reboot the Linux server too. but
</I>&gt;<i> still, the problem exists.
</I>&gt;<i> *
</I>&gt;<i> *
</I>&gt;<i> I have removed the empty and # command line in the document for your
</I>&gt;<i> review. can you please check now and provide me with some&#160;guidance&#160;
</I>&gt;<i> 
</I>
Thanks. That one is easier to read.


The domains dvr1.* dvr2.* and dashboard.* are accepted into the proxy
(by the our_sites ACL) but have nowhere to go - no cache_peer with an
allow for them. I guess those are the domains which you are seeing
failures for?


Some further cleanups you can do:

It is now clear that &quot;cache_peer access server_6 deny all&quot; is referring
to a non-existent cache_peer. Not an issue, but you can remove that line
to simplify things further.


The https_port line is missing accel mode flag.
 - Also, 'vhost' option is deprecated in current Squid Virtual hosting
is on by default now.

Also, since these are reverse-proxy the *_port lines should really be
listening on the same ports the peers are using (eg port 80, 443 and
8443) to avoid weird issues with Host header relayed to peers with
unexpected port 3128 or 8443 values (as sent by the clients).
 I also notice that traffic arriving in the HTTPS port has a default
domain of bookings.* assigned but the only peer which is expecting
traffic on/from port 8443 is the one for library.* domain. It may be
worthwhile removing the defaultsite= option entirely.



You still have the muddled peer lines making that config hard to read.
By that I mean your &quot;acl sites_server_*&quot; definitions are grouped amidst
cache_peer* lines for a peer which that ACL has nothing to do with.
Re-ordering those would be useful for future maintenance.

Also, the issue with server_5 and server_7 being identical is still
there. It is even more clear now that they are truly duplicates in all
respects, from cache_peer line to the server_sites_* ACLs. One of them
should be removed.


Your custom http_access line should be placed at the spot which
currently says &quot;http_access allow localhost&quot;.


In fact, what I recommend is to move the &quot;http_access deny all&quot; line
down below the cache_peer config block. Then you can use the
sites_server_N ACLs to do an &quot;http_access allow sites_server_*&quot; instead
of duplicating domain names in that our_sites ACL.
 This way you can be sure only the traffic which has a cache_peer to go
to is allowed into the proxy at all and the reverse: all traffic which
has a peer to go to is allowed. That may be helpful to avoid this
situation repeating in future.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="017859.html">[squid-users] Reverse proxy is not responding
</A></li>
	<LI>Next message (by thread): <A HREF="017861.html">[squid-users] Reverse proxy is not responding
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17860">[ date ]</a>
              <a href="thread.html#17860">[ thread ]</a>
              <a href="subject.html#17860">[ subject ]</a>
              <a href="author.html#17860">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
