<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] multiple log_file_daemon settings in squid.conf
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20multiple%20log_file_daemon%20settings%20in%20squid.conf&In-Reply-To=%3C21c6a1e8-948b-d1ba-4c86-78186eb69466%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017871.html">
   <LINK REL="Next"  HREF="017870.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] multiple log_file_daemon settings in squid.conf</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20multiple%20log_file_daemon%20settings%20in%20squid.conf&In-Reply-To=%3C21c6a1e8-948b-d1ba-4c86-78186eb69466%40measurement-factory.com%3E"
       TITLE="[squid-users] multiple log_file_daemon settings in squid.conf">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Mar 20 16:48:05 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="017871.html">[squid-users] multiple log_file_daemon settings in squid.conf
</A></li>
        <LI>Next message (by thread): <A HREF="017870.html">[squid-users] tcp_outgoing_address and HTTPS
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17881">[ date ]</a>
              <a href="thread.html#17881">[ thread ]</a>
              <a href="subject.html#17881">[ subject ]</a>
              <a href="author.html#17881">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 03/20/2018 04:38 AM, Rafael Akchurin wrote:

&gt;<i> Is there any unique transaction ID in the Squid&#8217;s inner workings that I
</I>&gt;<i> can see in the ICAP server, by passing it as additional X-* ICAP header?
</I>
Unfortunately, no. %sn comes close to that but due to implementation
bugs and backward compatibility reasons, it is not usable in adaptation
context. You can construct a fairly unique ID using SMP macros, time,
and TCP connection details, but it is not going to be reliable. Master
transaction ID is a missing Squid feature.

The first ICAP REQMOD service that sees the transaction can set this ID,
but ICAP services do not support returning annotations to Squid. Another
missing Squid feature. You might be able to work around this limitation
by using %adapt::&lt;last_h discussed below.


&gt;<i> I can use ICAP header to pass the
</I>&gt;<i> ICAP specific transaction ID back to Squid **and** I can get that ID
</I>&gt;<i> written to Squid&#8217;s access log as
</I>&gt;<i> &quot;X-WebSafety-IID=%{X-WebSafety-IID}adapt::&lt;last_h&quot;. Is it a valid approach?
</I>
I am not sure what your definition of &quot;valid&quot; in this context is, but
this approach probably can be used as a workaround.

Instead of matching Squid access log records and ICAP log records, you
can also tell Squid to log all of the ICAP details into Squid access
log, using the same %adapt::&lt;last_h workaround. No unique IDs or ID
matching is necessary in that case. Whether to put Squid access log
records into a database (instead or in addition to the file) is up to
you, of course.


&gt;<i> Question 3:
</I>&gt;<i> 
</I>&gt;<i> If q1 or q2 is answered positively, I still need to somehow get the data
</I>&gt;<i> from squid&#8217;s access log the ICAP record database. Currently the idea is
</I>&gt;<i> to have the custom logfile_daemon setting that would fork original
</I>&gt;<i> log_file_daemon to have log entries written to access_log **and** parse
</I>&gt;<i> out the ICAP ID **and** update the corresponding ICAP record in the
</I>&gt;<i> database with transferred bytes information. But this seems complex and
</I>&gt;<i> fragile.
</I>
Squid supports multiple access loggers so, yes, you can also add a
non-&quot;daemon&quot; logger that will do the above. Please see Amos response for
details.


HTH,

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="017871.html">[squid-users] multiple log_file_daemon settings in squid.conf
</A></li>
	<LI>Next message (by thread): <A HREF="017870.html">[squid-users] tcp_outgoing_address and HTTPS
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17881">[ date ]</a>
              <a href="thread.html#17881">[ thread ]</a>
              <a href="subject.html#17881">[ subject ]</a>
              <a href="author.html#17881">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
