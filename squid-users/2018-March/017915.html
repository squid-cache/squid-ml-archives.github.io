<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid for windows Very slow downloads of large files through squid with normal uploads
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20for%20windows%20Very%20slow%20downloads%20of%20large%0A%20files%20through%20squid%20with%20normal%20uploads&In-Reply-To=%3C634894e6-b954-3fed-bde0-58b84a88eb73%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017914.html">
   <LINK REL="Next"  HREF="017916.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid for windows Very slow downloads of large files through squid with normal uploads</H1>
    <B>Yuri</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20for%20windows%20Very%20slow%20downloads%20of%20large%0A%20files%20through%20squid%20with%20normal%20uploads&In-Reply-To=%3C634894e6-b954-3fed-bde0-58b84a88eb73%40gmail.com%3E"
       TITLE="[squid-users] Squid for windows Very slow downloads of large files through squid with normal uploads">yvoinov at gmail.com
       </A><BR>
    <I>Thu Mar 22 23:27:13 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="017914.html">[squid-users] Squid for windows Very slow downloads of large files through squid with normal uploads
</A></li>
        <LI>Next message (by thread): <A HREF="017916.html">[squid-users] Squid for windows Very slow downloads of large files through squid with normal uploads
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17915">[ date ]</a>
              <a href="thread.html#17915">[ thread ]</a>
              <a href="subject.html#17915">[ subject ]</a>
              <a href="author.html#17915">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Your task is simple - you need a simple control of access to the
Internet, for servers, without any caching. Squid here is excessive,
moreover, in your configuration it gives an excessive overhead.

You not requires advanced requests processing, SSL bumping, content
adaptation, AV real-time checking, advanced caching, content compression
- am I right yet?

So, firewall is enough.


23.03.2018 05:11, Yuri &#1087;&#1080;&#1096;&#1077;&#1090;:
&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> 23.03.2018 05:08, Keith Hartley &#1087;&#1080;&#1096;&#1077;&#1090;:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I don&#8217;t need it to cache anything &#8211; the goal of it is not performance
</I>&gt;&gt;<i> optimization, it is to provide restricted access to the internet. I
</I>&gt;&gt;<i> have 1200 Mbps of network i/o available to the squid servers and can
</I>&gt;&gt;<i> confirm I am able to reliably achieve at least 800 Mbps when I
</I>&gt;&gt;<i> download something directly on the squid server. Additionally, it
</I>&gt;&gt;<i> would be extremely rare that the same file ever would get downloaded
</I>&gt;&gt;<i> more than once, if it ever actually happens.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> By policy none of the servers may have direct internet access. This
</I>&gt;&gt;<i> is to protect the data contained in the environment. Only one 4 bit
</I>&gt;&gt;<i> subnet has internet access, where the squids are located, and 8 of
</I>&gt;&gt;<i> the 45 servers need restricted internet access.
</I>&gt;&gt;<i>
</I>&gt;<i> Now your protects nothing. You don't have any advanced ACLs in your
</I>&gt;<i> config.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This config is complete at least in a base configuration. If I have
</I>&gt;&gt;<i> time in the project I am going to add URI restrictions. The 8 servers
</I>&gt;&gt;<i> will only need to get to about 30-40 static URIs in total and want to
</I>&gt;&gt;<i> block the others, but first I need to get the throughput up.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I have 800 Mbps minimum available bandwidth to the squid servers that
</I>&gt;&gt;<i> I can confirm is available in download tests from the squids. I have
</I>&gt;&gt;<i> 1200 Mbps (these are Azure virtual machines) of bandwidth available
</I>&gt;&gt;<i> in both directions between the servers that use the squids and the
</I>&gt;&gt;<i> squids.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> However on large files I am only getting 115 Kbps sustained download
</I>&gt;&gt;<i> speeds.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Now if squid needs to be able to buffer the downloads to cache in
</I>&gt;&gt;<i> order to perform well &#8211; I could enable caching if that is the case,
</I>&gt;&gt;<i> but would prefer to not cache anything. I very seriously doubt that I
</I>&gt;&gt;<i> will ever download the same file two times in this environment as the
</I>&gt;&gt;<i> only thing being downloaded is software updates that are centrally
</I>&gt;&gt;<i> distributed from WSUS, and antivirus definitions that are released
</I>&gt;&gt;<i> about 6-10 times per day. Most of the traffic is also https, with
</I>&gt;&gt;<i> very little http.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Is it the case that I may see better performance if I configure it to
</I>&gt;&gt;<i> cache the files first before sending it to clients?
</I>&gt;&gt;<i>
</I>&gt;<i> Nothing above can not be solved by trivial border firewall.
</I>&gt;<i>
</I>&gt;<i> Just imagine - now you have useless server which not buffers network IO.
</I>&gt;<i>
</I>&gt;<i> Ideally just drop it. And setup border firewall. This solves all of
</I>&gt;<i> your problems.
</I>&gt;<i>
</I>&gt;<i> Squid's (especially Windows Squid) is not appropriate tool here.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> *&#160;*
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> *Keith Hartley*
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> /Network Engineer II/
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">khartley at geocent.com</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">khartley at geocent.com</A>&gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> www.geocent.com &lt;<A HREF="http://www.geocent.com">http://www.geocent.com</A>&gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> *From:*squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>]
</I>&gt;&gt;<i> *On Behalf Of *Yuri
</I>&gt;&gt;<i> *Sent:* Thursday, March 22, 2018 5:39 PM
</I>&gt;&gt;<i> *To:* <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i> *Subject:* Re: [squid-users] Squid for windows Very slow downloads of
</I>&gt;&gt;<i> large files through squid with normal uploads
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 22.03.2018 23:10, Keith Hartley &#1087;&#1080;&#1096;&#1077;&#1090;:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     I am using squid 3.5 for windows as a transparent proxy to
</I>&gt;&gt;<i>     provide internet access to 7 servers in a secure environment that
</I>&gt;&gt;<i>     otherwise does not have internet access. I have two squids
</I>&gt;&gt;<i>     running behind a load balancer, each one is running server 2016
</I>&gt;&gt;<i>     core with 2 Xeon processors that is either haswell generation
</I>&gt;&gt;<i>     with 1:1 physical processor to virtual processor mapping or a
</I>&gt;&gt;<i>     hyper-threading Broadwell generation processor that is 1:1
</I>&gt;&gt;<i>     logical processor to virtual processor mapping, depending on how
</I>&gt;&gt;<i>     they are provisioned when they get started.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     Doing a bandwidth test directly in the VM I am able to get
</I>&gt;&gt;<i>     internet throughput of 800-1200 Mbps.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     Doing a file copy to and from the VM I am able to get 1200 Mbps
</I>&gt;&gt;<i>     lan throughput.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     In proxied uploads I have observed speeds as high as 120 Mbps,
</I>&gt;&gt;<i>     which is more than enough for what I need and the bottleneck is
</I>&gt;&gt;<i>     likely in the backup software rather than squid. Uploads
</I>&gt;&gt;<i>     performance I am not worried about where they are at now &#8211; even
</I>&gt;&gt;<i>     if I only got 20-30 Mbps it would be adequate for what I need it for.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     Downloads however are very slow. Small files do not seem to be
</I>&gt;&gt;<i>     impacted. Using the test a thinkbroadband.com/download, files up
</I>&gt;&gt;<i>     to 20 Mb will download at a reasonable 20-30 Mbps, but when I get
</I>&gt;&gt;<i>     to 50, it slows down to about 17 Mbps, and when I download AD
</I>&gt;&gt;<i>     Connect from Microsoft, which is about 80 Mb, I can see it start
</I>&gt;&gt;<i>     at about 30 Mbps, but eventually goes down to about 115 kbps and
</I>&gt;&gt;<i>     levels off. When I put an IP on the server I am using for testing
</I>&gt;&gt;<i>     that proxies through squid, I am able to download the file at
</I>&gt;&gt;<i>     several hundred mbps. &#160;When I download the same file on the squid
</I>&gt;&gt;<i>     server &#8211; I can&#8217;t tell exactly what throughput I was getting, but
</I>&gt;&gt;<i>     the 80 Mb file downloaded within 5 seconds.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     In both squid servers, other than when the servers were booting,
</I>&gt;&gt;<i>     processor activity has not exceeded 9% in the last 7 days but
</I>&gt;&gt;<i>     usually sits below 2%. Memory usage has not exceeded 2 Gb,
</I>&gt;&gt;<i>     leaving 2 Gb free.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     I am using OpenDNS for a DNS source, and have tried changing DNS
</I>&gt;&gt;<i>     to level3 but it made no performance difference.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     I think that this may be squid trying to cache something, but had
</I>&gt;&gt;<i>     tried to turn all caching off.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     My cache.log doesn&#8217;t really have anything interesting in it that
</I>&gt;&gt;<i>     I can see. It&#8217;s the same ~30 or so log entries each time the
</I>&gt;&gt;<i>     service starts, and that is about it. Here it is:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     2018/03/22 09:47:27 kid1| Set Current Directory to /var/cache/squid
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     2018/03/22 09:47:27 kid1| Starting Squid Cache version 3.5.27 for
</I>&gt;&gt;<i>     x86_64-unknown-cygwin...
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     2018/03/22 09:47:27 kid1| Service Name: squid
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     2018/03/22 09:47:27 kid1| Process ID 1164
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     2018/03/22 09:47:27 kid1| Process Roles: worker
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     2018/03/22 09:47:27 kid1| With 3200 file descriptors available
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     2018/03/22 09:47:27 kid1| Initializing IP Cache...
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     2018/03/22 09:47:27 kid1| parseEtcHosts: /etc/hosts: (2) No such
</I>&gt;&gt;<i>     file or directory
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     2018/03/22 09:47:27 kid1| DNS Socket created at [::], FD 5
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     2018/03/22 09:47:27 kid1| DNS Socket created at 0.0.0.0, FD 6
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     2018/03/22 09:47:27 kid1| Adding nameserver 208.67.222.222 from
</I>&gt;&gt;<i>     squid.conf
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     2018/03/22 09:47:27 kid1| Adding nameserver 208.67.220.220 from
</I>&gt;&gt;<i>     squid.conf
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     2018/03/22 09:47:27 kid1| Logfile: opening log
</I>&gt;&gt;<i>     daemon:/var/log/squid/access.log
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     2018/03/22 09:47:27 kid1| Logfile Daemon: opening log
</I>&gt;&gt;<i>     /var/log/squid/access.log
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     2018/03/22 09:47:27 kid1| WARNING: no_suid: setuid(0): (22)
</I>&gt;&gt;<i>     Invalid argument
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     2018/03/22 09:47:27 kid1| Store logging disabled
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     2018/03/22 09:47:27 kid1| Swap maxSize 0 + 262144 KB, estimated
</I>&gt;&gt;<i>     20164 objects
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     2018/03/22 09:47:27 kid1| Target number of buckets: 1008
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     2018/03/22 09:47:27 kid1| Using 8192 Store buckets
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     2018/03/22 09:47:27 kid1| Max Mem&#160; size: 262144 KB
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     2018/03/22 09:47:27 kid1| Max Swap size: 0 KB
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     2018/03/22 09:47:27 kid1| Using Least Load store dir selection
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     2018/03/22 09:47:27 kid1| Set Current Directory to /var/cache/squid
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     2018/03/22 09:47:27 kid1| Finished loading MIME types and icons.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     2018/03/22 09:47:27 kid1| HTCP Disabled.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     2018/03/22 09:47:27 kid1| Squid plugin modules loaded: 0
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     2018/03/22 09:47:27 kid1| Adaptation support is off.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     2018/03/22 09:47:27 kid1| Accepting HTTP Socket connections at
</I>&gt;&gt;<i>     local=[::]:3128 remote=[::] FD 10 flags=9
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     2018/03/22 09:47:28 kid1| storeLateRelease: released 0 objects
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     And this is my squid.conf:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     #
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     # Recommended minimum configuration:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     #
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     # Example rule allowing access from your local networks.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     # Adapt to list your (internal) IP networks from where browsing
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     # should be allowed
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     #acl localnet src 10.0.0.0/8&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # RFC1918 possible
</I>&gt;&gt;<i>     internal network
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     #acl localnet src 172.16.0.0/12&#160;&#160;&#160; # RFC1918 possible internal
</I>&gt;&gt;<i>     network
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     #acl localnet src 192.168.0.0/16&#160; # RFC1918 possible internal network
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     acl localnet src fc00::/7&#160;&#160;&#160;&#160;&#160;&#160; # RFC 4193 local private network
</I>&gt;&gt;<i>     range
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     acl localnet src fe80::/10&#160;&#160;&#160;&#160;&#160; # RFC 4291 link-local (directly
</I>&gt;&gt;<i>     plugged) machines
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     acl WSUS src 192.168.225.4/32
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     acl BACKUP src 192.168.225.11/32
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     acl ADFS src 192.168.224.7/32
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     acl ADFS src 192.168.228.8/32
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     acl DEVWEB src 192.168.226.6/32
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     acl UATWEB src 192.168.226.13/32
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     acl PRDWEB src 192.168.226.8/32
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     acl PRDWEB src 192.168.226.9/32
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     acl SSL_ports port 443
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     acl Safe_ports port 80&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # http
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     #acl Safe_ports port 21&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # ftp
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     acl Safe_ports port 443&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # https
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     #acl Safe_ports port 70&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # gopher
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     #acl Safe_ports port 210&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # wais
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     #acl Safe_ports port 1025-65535&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # unregistered ports
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     #acl Safe_ports port 280&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # http-mgmt
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     #acl Safe_ports port 488&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # gss-http
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     #acl Safe_ports port 591&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # filemaker
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     #acl Safe_ports port 777&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; #
</I>&gt;&gt;<i>     multiling http
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     acl CONNECT method CONNECT
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     #
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     # Recommended minimum Access Permission configuration:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     #
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     # Only allow cachemgr access from localhost
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     #http_access allow localhost manager
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     #http_access deny manager
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     # Deny requests to certain unsafe ports
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     http_access deny !Safe_ports
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     # Deny CONNECT to other than secure SSL ports
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     http_access deny CONNECT !SSL_ports
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     # We strongly recommend the following be uncommented to protect
</I>&gt;&gt;<i>     innocent
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     # web applications running on the proxy server who think the only
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     # one who can access services on &quot;localhost&quot; is a local user
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     #http_access deny to_localhost
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     #
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     # INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     #
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     # Example rule allowing access from your local networks.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     # Adapt localnet in the ACL section to list your (internal) IP
</I>&gt;&gt;<i>     networks
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     # from where browsing should be allowed
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     http_access allow localnet
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     http_access allow localhost
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     http_access allow WSUS
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     http_access allow ADFS
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     http_access allow BACKUP
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     http_access allow DEVWEB
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     http_access allow UATWEB
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     http_access allow PRDWEB
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     # And finally deny all other access to this proxy
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     http_access deny all
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     # Squid normally listens to port 3128
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     http_port 3128
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     # Uncomment the line below to enable disk caching - path format
</I>&gt;&gt;<i>     is /cygdrive/&lt;full path to cache folder&gt;, i.e.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     #cache_dir aufs /cygdrive/d/squid/cache 3000 16 256
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     cache deny all
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     # Leave coredumps in the first cache dir
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     coredump_dir /var/cache/squid
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     # Add any of your own refresh_pattern entries above these.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     refresh_pattern ^ftp:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 1440&#160;&#160;&#160;&#160;&#160;&#160; 20%&#160;&#160;&#160;&#160;&#160;&#160;&#160; 10080
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     refresh_pattern ^gopher:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 1440&#160;&#160;&#160;&#160;&#160;&#160; 0%&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 1440
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     refresh_pattern -i (/cgi-bin/|\?) 0&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 0%&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 0
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     refresh_pattern .&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 0&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
</I>&gt;&gt;<i>     20%&#160;&#160;&#160;&#160;&#160;&#160;&#160; 4320
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     dns_nameservers 208.67.222.222 208.67.220.220
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     max_filedescriptors 3200
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     Does anyone see anything I am missing here?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Yes. In your almost default configuration (it is complete
</I>&gt;&gt;<i> squid.conf?) obvious thing is:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> a) You do not use on-disk cache.
</I>&gt;&gt;<i> b) You use memory cache by default - i.e. 256 Mb.
</I>&gt;&gt;<i> c) You cache nothing due to deny all cache. So, it makes useless
</I>&gt;&gt;<i> cache_mem default.
</I>&gt;&gt;<i> d) Your configuration technically useless. I see neither proxying
</I>&gt;&gt;<i> parameters, nor caching. Your squid now only additional hop for
</I>&gt;&gt;<i> files. No more.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> So, squid nothing to do here. It simple should retransmit GET (GET?)
</I>&gt;&gt;<i> request to server, and, without any caching/storing, retransmit it to
</I>&gt;&gt;<i> user.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Still correct?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This put us directly to raw network IO. Without any buffering (which
</I>&gt;&gt;<i> can be - but don't - your squid).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On your place, I can start playing around with cache_mem parameter;
</I>&gt;&gt;<i> of course, only after removing cache deny all.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> And after some experiments, may be, will make decision about drop out
</I>&gt;&gt;<i> useless Squid's box.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Seriously, what role of squid's here? Just setup border firewall to
</I>&gt;&gt;<i> your servers to access it to Internet. It will be enough.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     My access.log doesn&#8217;t really have anything interesting in it
</I>&gt;&gt;<i>     either, it just looks like it is working normally. I can attach
</I>&gt;&gt;<i>     that too if anyone wants to look at it after I redact some of the
</I>&gt;&gt;<i>     hosts.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     *Keith Hartley*
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     /Network Engineer II/
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     /MCSE: Productivity, MCSA: Server 2008, 2012, Office 365 / |
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     /Certified Meraki Network Associate, Security+/
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     *Geocent, LLC*
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     *o:*504-405-3578
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     *a:*2219 Lakeshore drive Ste 300, New Orleans, LA 70122
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     *w:*www.geocent.com
</I>&gt;&gt;<i>     &lt;<A HREF="http://www.geocent.com/">http://www.geocent.com/</A>&gt;|*e:*<A HREF="https://lists.squid-cache.org/listinfo/squid-users">khartley at geocent.com</A>
</I>&gt;&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">khartley at geocent.com</A>&gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &#160; &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &#160;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     */_Confidentiality Notice:_/*
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     This email communication may contain confidential information,
</I>&gt;&gt;<i>     may be legally privileged, and is intended only for the use of
</I>&gt;&gt;<i>     the intended recipients(s) identified. Any unauthorized review,
</I>&gt;&gt;<i>     use, distribution, downloading, or copying of this communication
</I>&gt;&gt;<i>     is strictly prohibited. If you are not the intended recipient and
</I>&gt;&gt;<i>     have received this message in error, immediately notify the
</I>&gt;&gt;<i>     sender by reply email, delete the communication, and destroy all
</I>&gt;&gt;<i>     copies. Thank you.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     _______________________________________________
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     squid-users mailing list
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> -- 
</I>&gt;&gt;<i> &quot;C++ seems like a language suitable for firing other people's legs.&quot;
</I>&gt;&gt;<i> &#160;
</I>&gt;&gt;<i> *****************************
</I>&gt;&gt;<i> * C++20 : Bug to the future *
</I>&gt;&gt;<i> *****************************
</I>&gt;<i>
</I>&gt;<i> -- 
</I>&gt;<i> &quot;C++ seems like a language suitable for firing other people's legs.&quot;
</I>&gt;<i>
</I>&gt;<i> *****************************
</I>&gt;<i> * C++20 : Bug to the future *
</I>&gt;<i> *****************************
</I>
-- 
&quot;C++ seems like a language suitable for firing other people's legs.&quot;

*****************************
* C++20 : Bug to the future *
*****************************

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20180323/54136421/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20180323/54136421/attachment.htm</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20180323/54136421/attachment.sig">http://lists.squid-cache.org/pipermail/squid-users/attachments/20180323/54136421/attachment.sig</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="017914.html">[squid-users] Squid for windows Very slow downloads of large files through squid with normal uploads
</A></li>
	<LI>Next message (by thread): <A HREF="017916.html">[squid-users] Squid for windows Very slow downloads of large files through squid with normal uploads
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17915">[ date ]</a>
              <a href="thread.html#17915">[ thread ]</a>
              <a href="subject.html#17915">[ subject ]</a>
              <a href="author.html#17915">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
