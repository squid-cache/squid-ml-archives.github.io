<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Question about shutdown_lifetime behavior.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Question%20about%20shutdown_lifetime%20behavior.&In-Reply-To=%3C2AF4E0DB5D20734E8939C5EF204ACBAC01AEC3F474%40ITHMail2.ith.local%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018178.html">
   <LINK REL="Next"  HREF="018186.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Question about shutdown_lifetime behavior.</H1>
    <B>Cody Herzog</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Question%20about%20shutdown_lifetime%20behavior.&In-Reply-To=%3C2AF4E0DB5D20734E8939C5EF204ACBAC01AEC3F474%40ITHMail2.ith.local%3E"
       TITLE="[squid-users] Question about shutdown_lifetime behavior.">CHerzog at IntouchHealth.com
       </A><BR>
    <I>Tue May  1 17:17:54 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="018178.html">[squid-users] Question about shutdown_lifetime behavior.
</A></li>
        <LI>Next message (by thread): <A HREF="018186.html">[squid-users] Question about shutdown_lifetime behavior.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18183">[ date ]</a>
              <a href="thread.html#18183">[ thread ]</a>
              <a href="subject.html#18183">[ subject ]</a>
              <a href="author.html#18183">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks very much for the quick response, Amos.

For my use case, I would like Squid to exit when all client connections have been closed or when the timeout occurs, whichever comes first.

My instances of Squid may be handling several persistent WebSocket connections, and I don't want to disrupt those. I will occasionally need to perform maintenance, so I want a safe way to stop Squid without disrupting user activity.

I am using a fairly simple Squid configuration, with no caching, so I suspect that I can simply monitor the number of active Squid TCP connections using 'netstat', and then execute the second shutdown command when I detect that all those connections are closed.

I've been using the following command to count the number of active Squid TCP connections of port 443, which is the only port I use:

netstat -nat | grep &quot;.*:443.*:&quot; | grep ESTABLISHED | wc -l

That seems to give me what I want.

Is it possible that bad things could happen by stopping Squid when I see that all the TCP connections have closed?

Thanks.

-Cody
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20180501/c0b86f39/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20180501/c0b86f39/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="018178.html">[squid-users] Question about shutdown_lifetime behavior.
</A></li>
	<LI>Next message (by thread): <A HREF="018186.html">[squid-users] Question about shutdown_lifetime behavior.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18183">[ date ]</a>
              <a href="thread.html#18183">[ thread ]</a>
              <a href="subject.html#18183">[ subject ]</a>
              <a href="author.html#18183">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
