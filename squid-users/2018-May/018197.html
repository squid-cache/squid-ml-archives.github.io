<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid logging to UDP logs multiple lines at the same time
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20logging%20to%20UDP%20logs%20multiple%20lines%20at%20the%0A%20same%20time&In-Reply-To=%3C1d84dfe0-a066-24d8-d968-9588cda23a9a%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018196.html">
   <LINK REL="Next"  HREF="018201.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid logging to UDP logs multiple lines at the same time</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20logging%20to%20UDP%20logs%20multiple%20lines%20at%20the%0A%20same%20time&In-Reply-To=%3C1d84dfe0-a066-24d8-d968-9588cda23a9a%40treenet.co.nz%3E"
       TITLE="[squid-users] Squid logging to UDP logs multiple lines at the same time">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri May  4 09:45:50 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="018196.html">[squid-users] Squid logging to UDP logs multiple lines at the same	time
</A></li>
        <LI>Next message (by thread): <A HREF="018201.html">[squid-users] Squid logging to UDP logs multiple lines at the same time
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18197">[ date ]</a>
              <a href="thread.html#18197">[ thread ]</a>
              <a href="subject.html#18197">[ subject ]</a>
              <a href="author.html#18197">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 04/05/18 20:44, Matt Pson wrote:
&gt;<i> Hello,
</I>&gt;<i> I have set up several Squid servers running 3.5.27 on Ubuntu 16.04 LTS (behind keepalived and haproxy to create a ha/load balanced setup) and having are some problems with logging. In order to have a single logfile I decided to send the log directly using UDP to a separate server running rsyslogd. 
</I>&gt;<i> 
</I>&gt;<i> Each Squid is configured with:
</I>&gt;<i> 
</I>&gt;<i> access_log     <A HREF="udp://squid-logserver.domain.com:10514">udp://squid-logserver.domain.com:10514</A>
</I>&gt;<i> 
</I>&gt;<i> The rsyslogd server is configured with:
</I>&gt;<i> 
</I>&gt;<i> Module (load=&quot;imudp&quot;)
</I>&gt;<i> # rsyslog Input Modules
</I>&gt;<i> input(type=&quot;imudp&quot; port=&quot;10514&quot; ruleset=&quot;Squid&quot;)
</I>&gt;<i> # Squid RulesSet
</I>&gt;<i> # make all squid input from the frontends end up here
</I>&gt;<i> ruleset(name=&quot;Squid&quot;) {
</I>&gt;<i>         action(type=&quot;omfile&quot;
</I>&gt;<i>                 file=&quot;/var/log/squid/access.log&quot;)
</I>&gt;<i>         }
</I>&gt;<i> 
</I>&gt;<i> This works quite well and logs are sent to the server which receives them and puts them in the log file as expected. But the logs are not sent line by line but instead multiple lines at the same time (the size is approx. a UDP packet of lines, ~1300 bytes) which makes the log file quite messed up.
</I>
1400 bytes or your network UDP MSS - whichever is smaller. Squid tries
to fit liens in there until one does not fit then sends off the batch.

It's a bug if the buffered_logs directive and access_log buffer-size=
option do not work to control what Squid is *sending*, but UDP can also
be aggregated by the network stacks I/O buffers of both sender and
receiver machines - so make sure you check for that.

&lt;<A HREF="http://www.squid-cache.org/Doc/config/buffered_logs/">http://www.squid-cache.org/Doc/config/buffered_logs/</A>&gt;
&quot;
Note that even when buffered_logs are off, Squid may have to buffer
records if it cannot write/send them immediately due to pending I/Os
(e.g., the I/O writing the previous log record) or connectivity loss.
&quot;

&gt;<i> 
</I>&gt;<i> What am I missing here? 
</I>&gt;<i> I want my log to be readable ;)
</I>
FWIW; The UDP module is intended for a logger which is capable of
handling the log as a raw data stream. syslog systems are not very good
at that.

You will probably find sending these to the Squid machines syslog and
having that relay them out to the remote server in the syslog format
works better than sending a raw UDP stream.

Or maybe using the TCP module and avoiding the complexity of syslog
entirely.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="018196.html">[squid-users] Squid logging to UDP logs multiple lines at the same	time
</A></li>
	<LI>Next message (by thread): <A HREF="018201.html">[squid-users] Squid logging to UDP logs multiple lines at the same time
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18197">[ date ]</a>
              <a href="thread.html#18197">[ thread ]</a>
              <a href="subject.html#18197">[ subject ]</a>
              <a href="author.html#18197">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
