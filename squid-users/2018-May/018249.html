<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Collecting squid logs to DB
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Collecting%20squid%20logs%20to%20DB&In-Reply-To=%3C0ce201d3ea95%24942f4970%24bc8ddc50%24%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018248.html">
   <LINK REL="Next"  HREF="018250.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Collecting squid logs to DB</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Collecting%20squid%20logs%20to%20DB&In-Reply-To=%3C0ce201d3ea95%24942f4970%24bc8ddc50%24%40ngtech.co.il%3E"
       TITLE="[squid-users] Collecting squid logs to DB">eliezer at ngtech.co.il
       </A><BR>
    <I>Sun May 13 08:37:07 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="018248.html">[squid-users] Collecting squid logs to DB
</A></li>
        <LI>Next message (by thread): <A HREF="018250.html">[squid-users] Collecting squid logs to DB
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18249">[ date ]</a>
              <a href="thread.html#18249">[ thread ]</a>
              <a href="subject.html#18249">[ subject ]</a>
              <a href="author.html#18249">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>To lose the stress on the DB you can use a custom format as Amos suggested but..

I think that when you will define and write what you want to log exactly you will get what you need and want.

 

The general squid access log is pretty lose and I believe that with these days hardware the difference will only be seen on systems with thousands or millions of clients requests.

If this is a small place it&#8217;s not required.

 

All The Bests,

Eliezer

 

----

 &lt;<A HREF="http://ngtech.co.il/lmgtfy/">http://ngtech.co.il/lmgtfy/</A>&gt; Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>



 

From: Alex K &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rightkicktech at gmail.com</A>&gt; 
Sent: Sunday, May 13, 2018 01:56
To: Eliezer Croitoru &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&gt;
Cc: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] Collecting squid logs to DB

 

+++ Including list +++

Hi Eliezer, 

I have used the following lines to instruct squid to log at mariadb: 

logfile_daemon /usr/lib/squid/log_db_daemon
access_log daemon:/127.0.0.1/squid_log/access_log/squid/squid &lt;<A HREF="http://127.0.0.1/squid_log/access_log/squid/squid">http://127.0.0.1/squid_log/access_log/squid/squid</A>&gt;  squid

Through testing it seems that sometimes squid is not logging anything. I don't know why. After a restart it seems to unblock and write to DB. 

The access_log table is currently InnoDB and I am wondering if MyISAM will behave better. 

 

I would prefer if I could have real time access log. My scenario is that when a user disconnects from squid, an aggregated report of the sites that the user browsed will be available under some web portal where the user has access. Usually there will be up to 20 users connected concurrently so I have to check if this approach is scalable. If this approach is not stable then I might go with log parsing (perhaps logstash or some custom parser) which will parse and generate an aggregated report once per hour or day. 

Is there a way I format the log and pipe to DB only some interesting fields in order to lessen the stress to DB?

 

 

On Sun, May 13, 2018 at 1:25 AM, Eliezer Croitoru &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&gt; &gt; wrote:

Hey Alex,

 

How did you used to log into the DB? What configuration lines have you used?

Also what log format have you used?

Is it important to have realtime data in the DB or a periodic parsing is also an option?

 

Eliezer

 

----

Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&gt; 



 

From: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A> &lt;<A HREF="http://squid-cache.org">http://squid-cache.org</A>&gt; &gt; On Behalf Of Alex K
Sent: Saturday, May 5, 2018 01:20
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt; 
Subject: [squid-users] Collecting squid logs to DB

 

Hi all, 

I had a previous setup on Debian 7 with squid and I was using mysar to collect squid logs and store them to DB and provide some browsing report at the end of the day. 

Now at Debian 9, trying to upgrade the whole setup, I see that mysar does not compile. 

Checking around I found mysar-ng but this has compilation issues on Debian 9 also. 

Do you suggest any tool that does this job? Does squid support logging to DB natively? (I am using mysql/mariadb)

Some other tool I stumbled on is <A HREF="https://github.com/paranormal/blooper.">https://github.com/paranormal/blooper.</A> 

 

Thanx a bunch,

Alex

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20180513/e3d9f192/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20180513/e3d9f192/attachment.htm</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 11307 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20180513/e3d9f192/attachment.png">http://lists.squid-cache.org/pipermail/squid-users/attachments/20180513/e3d9f192/attachment.png</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="018248.html">[squid-users] Collecting squid logs to DB
</A></li>
	<LI>Next message (by thread): <A HREF="018250.html">[squid-users] Collecting squid logs to DB
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18249">[ date ]</a>
              <a href="thread.html#18249">[ thread ]</a>
              <a href="subject.html#18249">[ subject ]</a>
              <a href="author.html#18249">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
