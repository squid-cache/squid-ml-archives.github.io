<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] SOLVED - SECURITY ALERT: Host header forgery	detected
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SOLVED%20-%20SECURITY%20ALERT%3A%20Host%20header%20forgery%0A%09detected&In-Reply-To=%3C0c2d01d3ed62%240a6f98a0%241f4ec9e0%24%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018277.html">
   <LINK REL="Next"  HREF="018265.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] SOLVED - SECURITY ALERT: Host header forgery	detected</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SOLVED%20-%20SECURITY%20ALERT%3A%20Host%20header%20forgery%0A%09detected&In-Reply-To=%3C0c2d01d3ed62%240a6f98a0%241f4ec9e0%24%40ngtech.co.il%3E"
       TITLE="[squid-users] SOLVED - SECURITY ALERT: Host header forgery	detected">eliezer at ngtech.co.il
       </A><BR>
    <I>Wed May 16 22:05:45 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="018277.html">[squid-users] SOLVED - SECURITY ALERT: Host header forgery detected
</A></li>
        <LI>Next message (by thread): <A HREF="018265.html">[squid-users] TCP_TUNNEL_ABORTED/200 with spliced windows updates
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18284">[ date ]</a>
              <a href="thread.html#18284">[ thread ]</a>
              <a href="subject.html#18284">[ subject ]</a>
              <a href="author.html#18284">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Amos,

And this issue is kind of big\mega corp services or CDN services.
Now I am really not sure I understand what this security host forgery is about.
There are couple cases:
- Simple forward proxy with ssl-bump which no header forgery should ever happen when the client requests for a specific domain and no IP
- Intercept proxy  with ssl-bump enabled that has no SNI host
- Intercept proxy with ssl-bump enabled that has SNI and squid passes the clients SNI host

Which one of the above is this specific case?
And if there are other cases it's good to list them and I will try to wiki these details.

Thanks,
Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>



-----Original Message-----
From: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; On Behalf Of Amos Jeffries
Sent: Tuesday, May 15, 2018 21:28
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] SOLVED - SECURITY ALERT: Host header forgery detected

On 16/05/18 02:02, Eliezer Croitoru wrote:
&gt;<i> Hey Martin,
</I>&gt;<i> 
</I>&gt;<i> Technically there should be a way to inform Squid-Cache about multiple addresses for the same destination.
</I>&gt;<i> If Squid doesn't know that it's a real IP of the domains a partial solution is to use the same DNS service but it can also be something else.
</I>&gt;<i> For example there should be a way\option for squid to decide if this address of the client or server is secured.
</I>&gt;<i> 
</I>&gt;<i> Amos what do you think?
</I>&gt;<i> Can a Host header forgery detection override acl be added? Should it be added?
</I>&gt;<i> I believe that  if there are some properties to the remote certificate we can flag the service as &quot;Secure&quot;
</I>&gt;<i> IE if the OS runs a &quot;openssl s_client -host www.ubuntnu.com -connect 91.189.89.118:443
</I>&gt;<i>  And the certificate is fine then... it's there is no place for any SECURITY ALERT.
</I>
A malicious actor would simply forward the TLS handshake to the real
server they are spoofing. Same way Squid does for SSL-Bump.

The counter argument of not sending SNI to that suspicious server will
have failures with these exact same mega-corp services. Think
foo.example.com hosted on Google hosting where the generic server cert
is &quot;foo.1e1.net&quot; not &quot;foo.example.com&quot;, nor even google.com&quot;.


The &quot;problem&quot; that needs to be resolved is simply that the genuine
servers do not have a reliable match between their IP and client
presented domain name(s).

Amos
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="018277.html">[squid-users] SOLVED - SECURITY ALERT: Host header forgery detected
</A></li>
	<LI>Next message (by thread): <A HREF="018265.html">[squid-users] TCP_TUNNEL_ABORTED/200 with spliced windows updates
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18284">[ date ]</a>
              <a href="thread.html#18284">[ thread ]</a>
              <a href="subject.html#18284">[ subject ]</a>
              <a href="author.html#18284">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
