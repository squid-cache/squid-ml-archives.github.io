<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] NetfilterInterception: NF &gt;	getsockopt(SO_ORIGINAL_DST) errors
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20NetfilterInterception%3A%20NF%20%3E%0A%09getsockopt%28SO_ORIGINAL_DST%29%20errors&In-Reply-To=%3CCAMuNeAsV%2BxS7QNRr%2B9tHHHktv4g3bOh816NfS8XB7-KQy_6n%3Dg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018322.html">
   <LINK REL="Next"  HREF="018320.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] NetfilterInterception: NF &gt;	getsockopt(SO_ORIGINAL_DST) errors</H1>
    <B>kAja Ziegler</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20NetfilterInterception%3A%20NF%20%3E%0A%09getsockopt%28SO_ORIGINAL_DST%29%20errors&In-Reply-To=%3CCAMuNeAsV%2BxS7QNRr%2B9tHHHktv4g3bOh816NfS8XB7-KQy_6n%3Dg%40mail.gmail.com%3E"
       TITLE="[squid-users] NetfilterInterception: NF &gt;	getsockopt(SO_ORIGINAL_DST) errors">ziegleka at gmail.com
       </A><BR>
    <I>Tue May 22 10:06:07 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="018322.html">[squid-users] Cert download from AIA information succeeds yet Squid reports ERR_UNABLE_TO_GET_ISSUER_CERT_LOCALLY
</A></li>
        <LI>Next message (by thread): <A HREF="018320.html">[squid-users] NetfilterInterception: NF &gt; getsockopt(SO_ORIGINAL_DST) errors
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18319">[ date ]</a>
              <a href="thread.html#18319">[ thread ]</a>
              <a href="subject.html#18319">[ subject ]</a>
              <a href="author.html#18319">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

  this question/problem is extracted from the other email &quot;The right way
how to increase max_filedescriptors on Linux&quot;.

*- my environment:*

CentOS 6.9
Squid 3.1.23 / 3.4.14
IPv4 and IPv6 addresses on interfaces

*- error and warning messages from cache.log:*

IpIntercept.cc(137) NetfilterInterception:  NF getsockopt(SO_ORIGINAL_DST)
failed on FD NN: (2) No such file or directory

NN ... many error log entries with different FD value

On Mon, May 21, 2018 at 3:29 PM, Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; wrote:

&gt;<i> These should not be related to FD numbers running out. As you can see FD
</I>&gt;<i> 68 was already allocated to this TCP connection and the socket accept()'ed.
</I>&gt;<i>
</I>&gt;<i> NAT errors are usually caused by explicit-proxy traffic arriving at a
</I>&gt;<i> NAT interception port. Such traffic is prohibited.
</I>&gt;<i> or by NAT table overflowing under extreme traffic loads. Either way
</I>&gt;<i> current Squid versions will terminate that connection immediately since
</I>&gt;<i> it cannot identify where the packets were supposed to be going.
</I>&gt;<i>
</I>
This is strange because I don't use any NAT iptables/netfilter rules on
this server:

[<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at ...</A>]# iptables -n -L -v -t nat
Chain PREROUTING (policy ACCEPT 26964 packets, 1870K bytes)
 pkts bytes target     prot opt in     out     source
destination

Chain POSTROUTING (policy ACCEPT 11013 packets, 817K bytes)
 pkts bytes target     prot opt in     out     source
destination

Chain OUTPUT (policy ACCEPT 11015 packets, 817K bytes)
 pkts bytes target     prot opt in     out     source
destination-


Only one weird thing I found in my Squid configuration - I had defined only
one http_port (http_port 3128 intercept) and this port was used to access
proxy via explicit definitions in systems or applications - without any
REDIRECT or marking in iptables/netfilter rules


I thank for every response that makes the error messages more clear.
-- 
Karel Ziegler
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20180522/0613eb59/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20180522/0613eb59/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="018322.html">[squid-users] Cert download from AIA information succeeds yet Squid reports ERR_UNABLE_TO_GET_ISSUER_CERT_LOCALLY
</A></li>
	<LI>Next message (by thread): <A HREF="018320.html">[squid-users] NetfilterInterception: NF &gt; getsockopt(SO_ORIGINAL_DST) errors
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18319">[ date ]</a>
              <a href="thread.html#18319">[ thread ]</a>
              <a href="subject.html#18319">[ subject ]</a>
              <a href="author.html#18319">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
