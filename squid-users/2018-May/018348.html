<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] TCP FIN,ACK after ServerHelloDone with pcmag.com
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TCP%20FIN%2CACK%20after%20ServerHelloDone%20with%20pcmag.com&In-Reply-To=%3C369bf77140714c4eac973ca3a827c8ba%40mbxtoa3.winmail.deshaw.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018289.html">
   <LINK REL="Next"  HREF="018351.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] TCP FIN,ACK after ServerHelloDone with pcmag.com</H1>
    <B>Ahmad, Sarfaraz</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TCP%20FIN%2CACK%20after%20ServerHelloDone%20with%20pcmag.com&In-Reply-To=%3C369bf77140714c4eac973ca3a827c8ba%40mbxtoa3.winmail.deshaw.com%3E"
       TITLE="[squid-users] TCP FIN,ACK after ServerHelloDone with pcmag.com">Sarfaraz.Ahmad at deshaw.com
       </A><BR>
    <I>Mon May 28 12:17:05 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="018289.html">[squid-users] TCP FIN,ACK after ServerHelloDone with pcmag.com
</A></li>
        <LI>Next message (by thread): <A HREF="018351.html">[squid-users] TCP FIN,ACK after ServerHelloDone with pcmag.com
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18348">[ date ]</a>
              <a href="thread.html#18348">[ thread ]</a>
              <a href="subject.html#18348">[ subject ]</a>
              <a href="author.html#18348">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I was wrong. It is not the remote server but Squid itself which is sending a FIN,ACK after ServerHelloDone.
At 8 seconds, ServerKeyExchange, ServerHelloDone is received by Squid. The cipher suite looks like (ECDHE+RSA+SHA512 ,wireshark shows rsa_pkcs_sha512.)
After about 60 more seconds (there is no activity on the wire during this period), Squid sends a FIN/ACK to the remote server effectively closing the connection.
What debug_options should I be using for more relevant logging in cache.log ? 26,9 11,9 and 5,9 are not helping much. 

I am adding few loglines anyways. 

2018/05/28 07:20:13.603 kid1| 5,4| AsyncCall.cc(26) AsyncCall: The AsyncCall clientLifetimeTimeout constructed, this=0x1c5e5f0 [call136782]
2018/05/28 07:20:13.603 kid1| 5,3| comm.cc(559) commSetConnTimeout: local=&lt;Squid_IP&gt;:3128 remote=&lt;Client_IP&gt;:64774 FD 13 flags=1 timeout 86400
2018/05/28 07:20:13.603 kid1| 11,5| HttpRequest.cc(460) detailError: current error details: 12/-2
2018/05/28 07:20:13.603 kid1| 11,2| Stream.cc(266) sendStartOfMessage: HTTP Client local=&lt;Squid_IP&gt;:3128 remote=&lt;Client_IP&gt;:64774 FD 13 flags=1
2018/05/28 07:20:13.603 kid1| 11,2| Stream.cc(267) sendStartOfMessage: HTTP Client REPLY:
---------
HTTP/1.1 503 Service Unavailable

Post splicing the webpage opens just fine. That website (www.pcmag.com) has over 750 DNS names added to SAN field. The RFC does not set an upper bound on the number of DNS names you can have in there.

Regards,
Sarfaraz 

-----Original Message-----
From: Ahmad, Sarfaraz 
Sent: Thursday, May 17, 2018 4:18 PM
To: '<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>' &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
Cc: 'Marcus Kool' &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">marcus.kool at urlfilterdb.com</A>&gt;
Subject: RE: [squid-users] TCP FIN,ACK after ServerHelloDone with pcmag.com

Guys,

Any thoughts ?

Regards,
Sarfaraz

-----Original Message-----
From: Ahmad, Sarfaraz
Sent: Wednesday, May 16, 2018 10:36 AM
To: 'Marcus Kool' &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">marcus.kool at urlfilterdb.com</A>&gt;; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: RE: [squid-users] TCP FIN,ACK after ServerHelloDone with pcmag.com

I see a message similar to Marcus' in cache.log.

2018/05/16 00:20:10 kid1| ERROR: negotiating TLS on FD 77: error:14090086:SSL routines:ssl3_get_server_certificate:certificate verify failed (1/-1/0)

And I am running squid-4.0.24.

Sarfaraz

-----Original Message-----
From: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; On Behalf Of Marcus Kool
Sent: Wednesday, May 16, 2018 1:41 AM
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] TCP FIN,ACK after ServerHelloDone with pcmag.com

The proxies that I used for the test have Squid 4.0.22 and Squid 4.0.23.

Marcus


On 15/05/18 15:40, Amos Jeffries wrote:
&gt;<i> On 16/05/18 01:32, Marcus Kool wrote:
</I>&gt;&gt;<i> pcmag.com also does not load here, although my config parameters are 
</I>&gt;&gt;<i> slightly different.
</I>&gt;&gt;<i> The certificate is indeed huge...
</I>&gt;&gt;<i> Do you have
</I>&gt;&gt;<i>  &#160;&#160; ERROR: negotiating TLS on FD NNN: error:14090086:SSL 
</I>&gt;&gt;<i> routines:ssl3_get_server_certificate:certificate verify failed
</I>&gt;&gt;<i> (1/-1/0) or other errors in cache.log ?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Marcus
</I>&gt;&gt;<i>
</I>&gt;<i> 
</I>&gt;<i> Are these Squid-4.0.24 ? There is a regression[1] in the cafile= 
</I>&gt;<i> parameter handling in the latest release.
</I>&gt;<i>   &lt;<A HREF="https://bugs.squid-cache.org/show_bug.cgi?id=4831">https://bugs.squid-cache.org/show_bug.cgi?id=4831</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> Amos
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> 
</I>_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="018289.html">[squid-users] TCP FIN,ACK after ServerHelloDone with pcmag.com
</A></li>
	<LI>Next message (by thread): <A HREF="018351.html">[squid-users] TCP FIN,ACK after ServerHelloDone with pcmag.com
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18348">[ date ]</a>
              <a href="thread.html#18348">[ thread ]</a>
              <a href="subject.html#18348">[ subject ]</a>
              <a href="author.html#18348">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
