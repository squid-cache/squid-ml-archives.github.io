<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 4.3: SSL Bump fails to send client certificate
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%204.3%3A%20SSL%20Bump%20fails%20to%20send%20client%0A%20certificate&In-Reply-To=%3Cec8ef08c-030f-42ff-c15e-c34706d01a8a%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019611.html">
   <LINK REL="Next"  HREF="019613.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 4.3: SSL Bump fails to send client certificate</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%204.3%3A%20SSL%20Bump%20fails%20to%20send%20client%0A%20certificate&In-Reply-To=%3Cec8ef08c-030f-42ff-c15e-c34706d01a8a%40treenet.co.nz%3E"
       TITLE="[squid-users] Squid 4.3: SSL Bump fails to send client certificate">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Nov  1 08:49:40 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019611.html">[squid-users] Squid 4.3: SSL Bump fails to send client	certificate
</A></li>
        <LI>Next message (by thread): <A HREF="019613.html">[squid-users] Squid 4.3: SSL Bump fails to send client certificate
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19612">[ date ]</a>
              <a href="thread.html#19612">[ thread ]</a>
              <a href="subject.html#19612">[ subject ]</a>
              <a href="author.html#19612">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 1/11/18 5:55 PM, Sid wrote:
&gt;<i> Thank you Alex.
</I>&gt;<i> 
</I>&gt;&gt;<i> Sounds good. Does the generated fake certificate contain the right origin
</I>&gt;<i> server name? 
</I>&gt;<i> Sid: Yes, It does contain correct IP Address in Server name sent by client.
</I>&gt;<i>  
</I>
Alex asked about *name*. IP address is not part of the considerations
because using a raw-IP is not valid for SNI. Even though having one in
the cert &quot;name&quot; is valid it is not supposed to happen either.

Also by &quot;right&quot; he means that Squid is passing on either the *same* name
value from the client SNI (bumping at step 2) or from the real server
provided certificate (bumping at step 3).


&gt;<i> 
</I>&gt;&gt;<i> Why do you expect the client to send a client certificate to Squid? In most
</I>&gt;<i> deployments, TLS servers do not request client certificates and, hence, TLS
</I>&gt;<i> clients do not send client certificates. IIRC, you did not configure your
</I>&gt;<i> Squid to request a client certificate from the client? 
</I>&gt;<i> 
</I>&gt;&gt;<i> Or is there a terminology problem where &quot;client certificate sent to 
</I>&gt;<i> Squid&quot; means something other than &quot;an x509 certificate requested by a 
</I>&gt;<i> TLS server and sent to that server by a TLS client during TLS 
</I>&gt;<i> handshake&quot;? Please note that Squid is a TLS server in this context. 
</I>&gt;<i> 
</I>&gt;<i> Sid: Actually in my case Server is looking for a certificate to be sent by
</I>&gt;<i> client; it isn't a Web Server but SBC looking for a certificate sent by
</I>&gt;<i> a client to grant further voice &amp; video call. How to configure Squid to get
</I>&gt;<i> this certificate from client for mutual authentication?
</I>

Configure clientca= on the http(s)_port directive.
see &lt;<A HREF="http://www.squid-cache.org/Doc/config/http_port/">http://www.squid-cache.org/Doc/config/http_port/</A>&gt;

IIRC that should work when SSL-Bump functionality re-purposes the
cafile= option which was supposed to be the CA for client certificates.


&gt;<i> 
</I>&gt;&gt;<i> Perhaps the alert may not be related to certificate validation. If you want
</I>&gt;<i> to verify whether UCAppsCA.pem is enough to trust the origin server, you can
</I>&gt;<i> use &quot;curl&quot; or &quot;openssl s_client&quot; tools for a test. They should fail to
</I>&gt;<i> validate the server when not configured to use UCAppsCA.pem and they should
</I>&gt;<i> succeed otherwise. 
</I>&gt;<i> 
</I>&gt;<i> Sid: I have tried following which shows &quot;Verify return code: 0 (ok)&quot;:
</I>&gt;<i> openssl s_client -connect &lt;Server FQDN&gt;:443 -CAfile
</I>&gt;<i> /usr/local/squid/etc/UCAppsCA.pem
</I>&gt;<i> 
</I>


Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019611.html">[squid-users] Squid 4.3: SSL Bump fails to send client	certificate
</A></li>
	<LI>Next message (by thread): <A HREF="019613.html">[squid-users] Squid 4.3: SSL Bump fails to send client certificate
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19612">[ date ]</a>
              <a href="thread.html#19612">[ thread ]</a>
              <a href="subject.html#19612">[ subject ]</a>
              <a href="author.html#19612">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
