<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] URL Regex ACLs Don't Evaluate After Bumping
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20URL%20Regex%20ACLs%20Don%27t%20Evaluate%20After%20Bumping&In-Reply-To=%3C8e76c3ea-135d-6ad9-f4e3-9404dc4193a9%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019615.html">
   <LINK REL="Next"  HREF="019621.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] URL Regex ACLs Don't Evaluate After Bumping</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20URL%20Regex%20ACLs%20Don%27t%20Evaluate%20After%20Bumping&In-Reply-To=%3C8e76c3ea-135d-6ad9-f4e3-9404dc4193a9%40measurement-factory.com%3E"
       TITLE="[squid-users] URL Regex ACLs Don't Evaluate After Bumping">rousskov at measurement-factory.com
       </A><BR>
    <I>Thu Nov  1 23:21:24 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019615.html">[squid-users] URL Regex ACLs Don't Evaluate After Bumping
</A></li>
        <LI>Next message (by thread): <A HREF="019621.html">[squid-users] [EXTERNAL]Re: URL Regex ACLs Don't Evaluate After Bumping
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19617">[ date ]</a>
              <a href="thread.html#19617">[ thread ]</a>
              <a href="subject.html#19617">[ subject ]</a>
              <a href="author.html#19617">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 11/1/18 2:46 PM, Shane Poage wrote:

&gt;<i> I have my proxy configured to bump all traffic so that the
</I>&gt;<i> urlpath_regex ACL can be applied, but it appears to not have any
</I>&gt;<i> effect post-bump.
</I>
Your proxy will deny any first post-bump request and close the tunnel
because you deny all CONNECT requests that initiate tunnels. CONNECT
requests do not have a URL path so they will never match your
&quot;http_access allow&quot; rule.

When a CONNECT request is denied by a bumping Squid, that Squid bumps
the tunnel and then denies the very first bumped request on that tunnel,
whatever that request is. This delayed error return is done to deliver
the &quot;access denied&quot; error page to the client -- browsers ignore CONNECT
error responses.


&gt;<i> http_port 3128 ssl-bump \
</I>&gt;<i>   cert=/etc/squid/ssl_certs/artifactory_mitm_ca.pem \
</I>&gt;<i>   generate-host-certificates=on \
</I>&gt;<i>   dynamic_cert_mem_cache_size=4MB
</I>
&gt;<i> ssl_bump bump all
</I>
&gt;<i> acl artifactory_repo_filter urlpath_regex ^/artifactory
</I>&gt;<i> http_access allow artifactory_repo_filter
</I>&gt;<i> 
</I>&gt;<i> # And finally deny all other access to this proxy
</I>&gt;<i> http_access deny all
</I>
Insert an http_access rule to allow all safe CONNECT requests before you
deny everything else. IIRC, squid.conf.default has an example of how to
do that.

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019615.html">[squid-users] URL Regex ACLs Don't Evaluate After Bumping
</A></li>
	<LI>Next message (by thread): <A HREF="019621.html">[squid-users] [EXTERNAL]Re: URL Regex ACLs Don't Evaluate After Bumping
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19617">[ date ]</a>
              <a href="thread.html#19617">[ thread ]</a>
              <a href="subject.html#19617">[ subject ]</a>
              <a href="author.html#19617">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
