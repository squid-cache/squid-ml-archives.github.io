<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] [EXTERNAL]Re: URL Regex ACLs Don't Evaluate After Bumping
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%5BEXTERNAL%5DRe%3A%20URL%20Regex%20ACLs%20Don%27t%20Evaluate%20After%0A%20Bumping&In-Reply-To=%3C42FD2170-919A-4895-93DB-C48B7D7EC3BC%40entrustdatacard.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019617.html">
   <LINK REL="Next"  HREF="019624.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] [EXTERNAL]Re: URL Regex ACLs Don't Evaluate After Bumping</H1>
    <B>Shane Poage</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%5BEXTERNAL%5DRe%3A%20URL%20Regex%20ACLs%20Don%27t%20Evaluate%20After%0A%20Bumping&In-Reply-To=%3C42FD2170-919A-4895-93DB-C48B7D7EC3BC%40entrustdatacard.com%3E"
       TITLE="[squid-users] [EXTERNAL]Re: URL Regex ACLs Don't Evaluate After Bumping">Shane.Poage at entrustdatacard.com
       </A><BR>
    <I>Fri Nov  2 15:54:47 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019617.html">[squid-users] URL Regex ACLs Don't Evaluate After Bumping
</A></li>
        <LI>Next message (by thread): <A HREF="019624.html">[squid-users] [EXTERNAL]Re: URL Regex ACLs Don't Evaluate After Bumping
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19621">[ date ]</a>
              <a href="thread.html#19621">[ thread ]</a>
              <a href="subject.html#19621">[ subject ]</a>
              <a href="author.html#19621">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>If I understand you correctly, my original squid.conf had an ACL directive corresponding to the functionality in question:

	acl CONNECT method CONNECT

Regardless, I added that back to my config and re-tested both with it inline and stand-alone. My results as follows:

http_access allow CONNECT artifactory_repo_filter
	This resulted in no traffic being passed, just like without the
	CONNECT ACL present. I assume this is what you were telling
	me to do because it's what made the most sense based off
	of your description of the problem, but it did not have the
	desired effect.

http_access allow CONNECT
http_access allow artifactory_repo_filter
	This resulted in all SSL traffic being permitted and passed through
	the proxy. This makes sense to me because the allow CONNECT
	would whitelist all CONNECT traffic, which is what all SSL traffic is
	by my understanding. I didn't think this is what you meant, but I
	tried it anyway to be sure.

Have I misunderstood you somehow, or is it not behaving as expected?

&#65279;On 11/1/18, 6:21 PM, &quot;squid-users on behalf of Alex Rousskov&quot; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A> on behalf of <A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt; wrote:
    On 11/1/18 2:46 PM, Shane Poage wrote:
    
    &gt; I have my proxy configured to bump all traffic so that the
    &gt; urlpath_regex ACL can be applied, but it appears to not have any
    &gt; effect post-bump.
    
    Your proxy will deny any first post-bump request and close the tunnel
    because you deny all CONNECT requests that initiate tunnels. CONNECT
    requests do not have a URL path so they will never match your
    &quot;http_access allow&quot; rule.
    
    When a CONNECT request is denied by a bumping Squid, that Squid bumps
    the tunnel and then denies the very first bumped request on that tunnel,
    whatever that request is. This delayed error return is done to deliver
    the &quot;access denied&quot; error page to the client -- browsers ignore CONNECT
    error responses.
    
    
    &gt; http_port 3128 ssl-bump \
    &gt;   cert=/etc/squid/ssl_certs/artifactory_mitm_ca.pem \
    &gt;   generate-host-certificates=on \
    &gt;   dynamic_cert_mem_cache_size=4MB
    
    &gt; ssl_bump bump all
    
    &gt; acl artifactory_repo_filter urlpath_regex ^/artifactory
    &gt; http_access allow artifactory_repo_filter
    &gt; 
    &gt; # And finally deny all other access to this proxy
    &gt; http_access deny all
    
    Insert an http_access rule to allow all safe CONNECT requests before you
    deny everything else. IIRC, squid.conf.default has an example of how to
    do that.
    
    Alex.
    _______________________________________________
    squid-users mailing list
    <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
    <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
    

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019617.html">[squid-users] URL Regex ACLs Don't Evaluate After Bumping
</A></li>
	<LI>Next message (by thread): <A HREF="019624.html">[squid-users] [EXTERNAL]Re: URL Regex ACLs Don't Evaluate After Bumping
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19621">[ date ]</a>
              <a href="thread.html#19621">[ thread ]</a>
              <a href="subject.html#19621">[ subject ]</a>
              <a href="author.html#19621">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
