<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Ipv6 error
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Ipv6%20error&In-Reply-To=%3C1541624048065-0.post%40n4.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019642.html">
   <LINK REL="Next"  HREF="019643.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Ipv6 error</H1>
    <B>Schroeffu</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Ipv6%20error&In-Reply-To=%3C1541624048065-0.post%40n4.nabble.com%3E"
       TITLE="[squid-users] Ipv6 error">info at schroeffu.ch
       </A><BR>
    <I>Wed Nov  7 20:54:08 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019642.html">[squid-users] Squid crashes with	&quot;!Comm::MonitorsRead(serverConnection-&gt;fd)&quot;
</A></li>
        <LI>Next message (by thread): <A HREF="019643.html">[squid-users] Ipv6 error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19641">[ date ]</a>
              <a href="thread.html#19641">[ thread ]</a>
              <a href="subject.html#19641">[ subject ]</a>
              <a href="author.html#19641">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I have had today experienced today exactly the same issue with Squid 4.4 for
this URL: <A HREF="https://bugs.squid-cache.org/index.cgi">https://bugs.squid-cache.org/index.cgi</A>
(but not <A HREF="https://wiki.squid-cache.org/*,">https://wiki.squid-cache.org/*,</A> that one works)

Error Message from Squid:

/The following error was encountered while trying to retrieve the URL:
<A HREF="https://bugs.squid-cache.org/*">https://bugs.squid-cache.org/*</A>
Connection to 2001:4801:7827:102:ad34:6f78:b6dc:fbed failed.
The system returned: (101) Network is unreachable/

It is not only IPv6 related issue. It happens to me when denying any request
via proxy without authentification like this:

/acl Authenticated_Users proxy_auth REQUIRED
http_access deny !Authenticated_Users all/

You will see in the access log Squid is trying to hit
<A HREF="http://cert.int-x3.letsencrypt.org/">http://cert.int-x3.letsencrypt.org/</A> directly with 407 (not authenticated), i
am so confused, why is it doing that and why is it not authenticating?

1541623232.530      0 - *TCP_DENIED/407 3619 GET
<A HREF="http://cert.int-x3.letsencrypt.org/*">http://cert.int-x3.letsencrypt.org/*</A> - HIER_NONE/- text/html;charset=utf-8
1541623232.530    245 172.16.5.15 NONE/200 0 CONNECT
bugs.squid-cache.org:443 xxxx
HIER_DIRECT/2001:4801:7827:102:ad34:6f78:b6dc:fbed -
1541623232.546      0 172.16.5.15 NONE/503 4940 GET
<A HREF="https://bugs.squid-cache.org/favicon.ico">https://bugs.squid-cache.org/favicon.ico</A> xxxx HIER_NONE/- text/html

So i added another acl on top in squid.conf  to whitelist  *.letsencrypt.org
without authentification and bam, the website
<A HREF="https://bugs.squid-cache.org/index.cgi">https://bugs.squid-cache.org/index.cgi</A> is opening now:

/acl white_regexp url_regex -i
&quot;/etc/squid/domains_whitelist_regex_without_authentification.acl&quot;
http_access allow white_regexp/

Content: 
\.letsencrypt\.org

I think somebody should track this, it is so weird! Why it happens on
<A HREF="https://bugs.squid-cache.org/index.cgi">https://bugs.squid-cache.org/index.cgi</A> and how is that letsencrypt related?
I have no problems with any other letsencrypt secured domains and also not
on any site providing ipv4/ipv6 at the same time (Google/Facebook). But yes,
also my Proxy can *not*speech ipv6, if that is something related with
letsencrypt?
more specs:
- ssl bump active
- icapcan active
- ntlm and basic auth active
- dns_v4_first on/off doen't matter/doesnt change anything.



--
Sent from: <A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html">http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html</A>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019642.html">[squid-users] Squid crashes with	&quot;!Comm::MonitorsRead(serverConnection-&gt;fd)&quot;
</A></li>
	<LI>Next message (by thread): <A HREF="019643.html">[squid-users] Ipv6 error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19641">[ date ]</a>
              <a href="thread.html#19641">[ thread ]</a>
              <a href="subject.html#19641">[ subject ]</a>
              <a href="author.html#19641">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
