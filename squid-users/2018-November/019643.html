<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Ipv6 error
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Ipv6%20error&In-Reply-To=%3C7eb9a2e8-e278-2708-d90b-cc0ad98748aa%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019641.html">
   <LINK REL="Next"  HREF="019646.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Ipv6 error</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Ipv6%20error&In-Reply-To=%3C7eb9a2e8-e278-2708-d90b-cc0ad98748aa%40measurement-factory.com%3E"
       TITLE="[squid-users] Ipv6 error">rousskov at measurement-factory.com
       </A><BR>
    <I>Wed Nov  7 22:57:56 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019641.html">[squid-users] Ipv6 error
</A></li>
        <LI>Next message (by thread): <A HREF="019646.html">[squid-users] Ipv6 error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19643">[ date ]</a>
              <a href="thread.html#19643">[ thread ]</a>
              <a href="subject.html#19643">[ subject ]</a>
              <a href="author.html#19643">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 11/7/18 1:54 PM, Schroeffu wrote:
&gt;<i> I have had today experienced today exactly the same issue with Squid 4.4 for
</I>&gt;<i> this URL: <A HREF="https://bugs.squid-cache.org/index.cgi">https://bugs.squid-cache.org/index.cgi</A>
</I>
&gt;<i> Error Message from Squid:
</I>&gt;<i> 
</I>&gt;<i> /The following error was encountered while trying to retrieve the URL:
</I>&gt;<i> <A HREF="https://bugs.squid-cache.org/*">https://bugs.squid-cache.org/*</A>
</I>&gt;<i> Connection to 2001:4801:7827:102:ad34:6f78:b6dc:fbed failed.
</I>&gt;<i> The system returned: (101) Network is unreachable/
</I>&gt;<i> 
</I>&gt;<i> It is not only IPv6 related issue. It happens to me when denying any request
</I>&gt;<i> via proxy without authentification like this:
</I>&gt;<i> 
</I>&gt;<i> acl Authenticated_Users proxy_auth REQUIRED
</I>&gt;<i> http_access deny !Authenticated_Users all
</I>

For most modern Squids, this http_access policy is, IMO, incorrect
because it blocks internally-generated requests, such as requests for
missing intermediate certificates. Please adjust your configuration to
allow those requests (if you want them to be allowed).

[rant]It could be argued that Squid should automatically allow
internally-generated requests, but I do not think that would be a good
approach, despite the inconveniences/problems caused by the current
&quot;apply standard http_access rules&quot; approach.[/rant]

N.B. There is no need to say &quot;all&quot; after another ACL in a rule. It is
like adding &quot;and true&quot; to some boolean statement -- it adds no value and
creates noise/overheads.


&gt;<i> You will see in the access log Squid is trying to hit
</I>&gt;<i> <A HREF="http://cert.int-x3.letsencrypt.org/">http://cert.int-x3.letsencrypt.org/</A> directly with 407 (not authenticated), i
</I>&gt;<i> am so confused, why is it doing that and why is it not authenticating?
</I>
I suspect Squid is requesting a missing intermediate certificate for
some letsencrypt-issued origin certificate. This is &quot;normal&quot; -- some
https sites do not send all of the intermediate x509 certificates, and
modern Squids request them automatically instead of failing certificate
validation.

Squid does not &quot;trying to hit letsencrypt.org with 407&quot;. HTTP 407 is a
response status code, not a part of the request. That error response is
probably generated by Squid (not letsencrypt.org); its existence and its
status code are determined/caused by your own http_access settings -- it
is your Squid that is denying the internal request, not letsencrypt.org.

HTH,

Alex.


&gt;<i> 1541623232.530      0 - *TCP_DENIED/407 3619 GET
</I>&gt;<i> <A HREF="http://cert.int-x3.letsencrypt.org/*">http://cert.int-x3.letsencrypt.org/*</A> - HIER_NONE/- text/html;charset=utf-8
</I>&gt;<i> 1541623232.530    245 172.16.5.15 NONE/200 0 CONNECT
</I>&gt;<i> bugs.squid-cache.org:443 xxxx
</I>&gt;<i> HIER_DIRECT/2001:4801:7827:102:ad34:6f78:b6dc:fbed -
</I>&gt;<i> 1541623232.546      0 172.16.5.15 NONE/503 4940 GET
</I>&gt;<i> <A HREF="https://bugs.squid-cache.org/favicon.ico">https://bugs.squid-cache.org/favicon.ico</A> xxxx HIER_NONE/- text/html
</I>
&gt;<i> Why it happens on
</I>&gt;<i> <A HREF="https://bugs.squid-cache.org/index.cgi">https://bugs.squid-cache.org/index.cgi</A> and how is that letsencrypt related?
</I>&gt;<i> I have no problems with any other letsencrypt secured domains and also not
</I>&gt;<i> on any site providing ipv4/ipv6 at the same time (Google/Facebook). But yes,
</I>&gt;<i> also my Proxy can *not*speech ipv6, if that is something related with
</I>&gt;<i> letsencrypt?
</I>&gt;<i> more specs:
</I>&gt;<i> - ssl bump active
</I>&gt;<i> - icapcan active
</I>&gt;<i> - ntlm and basic auth active
</I>&gt;<i> - dns_v4_first on/off doen't matter/doesnt change anything.
</I>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019641.html">[squid-users] Ipv6 error
</A></li>
	<LI>Next message (by thread): <A HREF="019646.html">[squid-users] Ipv6 error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19643">[ date ]</a>
              <a href="thread.html#19643">[ thread ]</a>
              <a href="subject.html#19643">[ subject ]</a>
              <a href="author.html#19643">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
