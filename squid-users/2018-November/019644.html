<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] 3.5.27 to 4.4: a worker is dead
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%203.5.27%20to%204.4%3A%20a%20worker%20is%20dead&In-Reply-To=%3Cec26a481-104f-5315-3dbe-ec4063beb12b%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019638.html">
   <LINK REL="Next"  HREF="019645.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] 3.5.27 to 4.4: a worker is dead</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%203.5.27%20to%204.4%3A%20a%20worker%20is%20dead&In-Reply-To=%3Cec26a481-104f-5315-3dbe-ec4063beb12b%40treenet.co.nz%3E"
       TITLE="[squid-users] 3.5.27 to 4.4: a worker is dead">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Nov  8 03:32:03 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019638.html">[squid-users] 3.5.27 to 4.4: a worker is dead
</A></li>
        <LI>Next message (by thread): <A HREF="019645.html">[squid-users] 3.5.27 to 4.4: a worker is dead
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19644">[ date ]</a>
              <a href="thread.html#19644">[ thread ]</a>
              <a href="subject.html#19644">[ subject ]</a>
              <a href="author.html#19644">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 8/11/18 12:24 AM, Heiler Bemerguy wrote:
&gt;<i> After some hours the worker 4 died unexpectely and didn't come back. I
</I>&gt;<i> have cleaned the rock cache store before upgrading just to be safe..
</I>&gt;<i> COLD start........
</I>&gt;<i> 
</I>&gt;<i> proxy&#160;&#160;&#160; 15478&#160; 0.6&#160; 1.8 9518972 1207212 ?&#160;&#160;&#160;&#160; S&#160;&#160;&#160; Nov06&#160;&#160; 6:17
</I>&gt;<i> (squid-5) --kid squid-5 -s
</I>&gt;<i> proxy&#160;&#160;&#160; 15480&#160; 0.4&#160; 1.4 9391808 954248 ?&#160;&#160;&#160;&#160;&#160; S&#160;&#160;&#160; Nov06&#160;&#160; 3:56
</I>&gt;<i> (squid-3) --kid squid-3 -s
</I>&gt;<i> proxy&#160;&#160;&#160; 15481&#160; 1.1&#160; 2.5 9734420 1679360 ?&#160;&#160;&#160;&#160; S&#160;&#160;&#160; Nov06&#160; 10:45
</I>&gt;<i> (squid-2) --kid squid-2 -s
</I>&gt;<i> proxy&#160;&#160;&#160; 26933&#160; 0.0&#160; 0.0 6501296 26768 ?&#160;&#160;&#160;&#160;&#160;&#160; S&#160;&#160;&#160; 00:25&#160;&#160; 0:01
</I>&gt;<i> (squid-coord-9) --kid squid-coord-9 -s
</I>&gt;<i> proxy&#160;&#160;&#160; 26936&#160; 0.0&#160; 0.6 7424208 401788 ?&#160;&#160;&#160;&#160;&#160; S&#160;&#160;&#160; 00:25&#160;&#160; 0:07
</I>&gt;<i> (squid-disk-6) --kid squid-disk-6 -s
</I>&gt;<i> proxy&#160;&#160;&#160; 27011&#160; 0.0&#160; 0.2 7424208 185580 ?&#160;&#160;&#160;&#160;&#160; S&#160;&#160;&#160; 00:28&#160;&#160; 0:03
</I>&gt;<i> (squid-disk-7) --kid squid-disk-7 -s
</I>&gt;<i> proxy&#160;&#160;&#160; 27227&#160; 0.0&#160; 0.0 7424208 54980 ?&#160;&#160;&#160;&#160;&#160;&#160; S&#160;&#160;&#160; 00:37&#160;&#160; 0:01
</I>&gt;<i> (squid-disk-8) --kid squid-disk-8 -s
</I>&gt;<i> 
</I>&gt;<i> AMD64 12-core, 64gb ram
</I>&gt;<i> 
</I>&gt;<i> cache_mem 5200 MB
</I>&gt;<i> maximum_object_size_in_memory 2 MB
</I>&gt;<i> maximum_object_size 4 GB
</I>&gt;<i> workers 5
</I>&gt;<i> cache_dir rock /cache2 131000 min-size=1 max-size=196608
</I>&gt;<i> cache_dir rock /cache3 131000 min-size=196609 max-size=624288
</I>&gt;<i> cache_dir rock /cache4 131000 min-size=624289 max-swap-rate=500
</I>&gt;<i> swap-timeout=500
</I>&gt;<i> 
</I>
The worker &quot;kid4&quot; died with an exception doing something with shared-memory.





&gt;<i> 2018/11/07 07:06:19 kid4| clientProcessHit: URL mismatch,
</I>&gt;<i> '[unknown_URI]' !=
</I>&gt;<i> '<A HREF="http://ocsp.godaddy.com//MEQwQjBAMD4wPDAJBgUrDgMCGgUABBTkIInKBAzXkF0Qh0pel3lfHJ9GPAQU0sSw0pHUTBFxs2HLPaH%2B3ahq1OMCAxvnFQ%3D%3D">http://ocsp.godaddy.com//MEQwQjBAMD4wPDAJBgUrDgMCGgUABBTkIInKBAzXkF0Qh0pel3lfHJ9GPAQU0sSw0pHUTBFxs2HLPaH%2B3ahq1OMCAxvnFQ%3D%3D</A>'
</I>&gt;<i> 
</I>
Your rock cache apparently contains at least several objects with the
exact string &quot;[unknown URI]&quot; as their URL / store-ID key. These are
attempting to be delivered to the client when it requested that OSCP URL.

Squid has detected the problem and will fetch a new object from the
network instead of the cache. It also begins the process of purging that
corrupt object from the cache.

... but then ...


&gt;<i> 2018/11/07 07:07:11 kid4| WARNING: communication with /cache2/rock may
</I>&gt;<i> be too slow or disrupted for about 7.00s; rescued 1 out of 1 I/Os
</I>
Activity the worker is asking the Disker to do is taking a long time,
some actions have started to timeout. If they were fetching objects
those client transactions will be treated as MISS.
 I'm not sure what happens if those were deletions.


&gt;<i> 2018/11/07 07:07:11 kid4| clientProcessHit: URL mismatch,
</I>&gt;<i> '[unknown_URI]' != '<A HREF="http://www.orm.com.br/templates/noticiaDev.php">http://www.orm.com.br/templates/noticiaDev.php</A>'
</I>&gt;<i> 2018/11/07 07:13:26 kid4| clientProcessHit: URL mismatch,
</I>&gt;<i> '[unknown_URI]' !=
</I>&gt;<i> '<A HREF="http://storage.googleapis.com/update-delta/hfnkpimlhhgieaddgfemjhofmfblmnib/4803/4802/b767e40b59c48c2ec52977502ac10e35b84c00600197162f42dd941b5095cafd.crxd">http://storage.googleapis.com/update-delta/hfnkpimlhhgieaddgfemjhofmfblmnib/4803/4802/b767e40b59c48c2ec52977502ac10e35b84c00600197162f42dd941b5095cafd.crxd</A>'
</I>&gt;<i> 
</I>&gt;<i> 2018/11/07 07:17:03 kid4| FATAL: Dying from an exception handling
</I>&gt;<i> failure; exception: check failed: false
</I>&gt;<i> &#160;&#160;&#160; exception location: mem/PageStack.cc(106) push
</I>&gt;<i> 
</I>
The SMP shared-memory space has been asked to allocate more memory than
it has total capacity.

...
&gt;<i> 2018/11/07 07:17:03 kid4| Starting Squid Cache version 4.4 for
</I>&gt;<i> x86_64-pc-linux-gnu...
</I>...
&gt;<i> 2018/11/07 07:17:03 kid4| WARNING: disk-cache maximum object size is too
</I>&gt;<i> large for mem-cache: 4194304.00 KB &gt; 2048.00 KB
</I>
The above might have something to do with the shared-memory problem.

It is part of rock design that the cache contents have to be able to be
stored in memory.

...
&gt;<i> 2018/11/07 07:17:09 kid4| storeDirWriteCleanLogs: Operation aborted.
</I>&gt;<i> 2018/11/07 07:17:09 kid4| FATAL: kid4 registration timed out
</I>

The auto-recovery process keeps dying trying to re-start it because of
the very long time it takes to startup when the proxy is already under
traffic load and memory pressure. These type of delays are usually due
to Squid being configured with very large rock caches.




So, to solve this try reducing the cache size. rock was designed for
caches in the MB ranges with many small objects. So start small then
push it up until problems start to appear again.


Keep in mind that rock was designed and optimized for caches of several
hundred *MB* with millions of small 0-32KB sized objects. For large
objects the UFS caches are optimal.

Squid caching is intended for the two types to work together for best
performance at all object size ranges.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019638.html">[squid-users] 3.5.27 to 4.4: a worker is dead
</A></li>
	<LI>Next message (by thread): <A HREF="019645.html">[squid-users] 3.5.27 to 4.4: a worker is dead
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19644">[ date ]</a>
              <a href="thread.html#19644">[ thread ]</a>
              <a href="subject.html#19644">[ subject ]</a>
              <a href="author.html#19644">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
