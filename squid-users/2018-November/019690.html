<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] limit number of simultaneous connections to a site
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20limit%20number%20of%20simultaneous%20connections%20to%20a%20site&In-Reply-To=%3C0f03ba09-bee7-2fe8-6c6f-7aa6f4e68cf3%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019689.html">
   <LINK REL="Next"  HREF="019691.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] limit number of simultaneous connections to a site</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20limit%20number%20of%20simultaneous%20connections%20to%20a%20site&In-Reply-To=%3C0f03ba09-bee7-2fe8-6c6f-7aa6f4e68cf3%40treenet.co.nz%3E"
       TITLE="[squid-users] limit number of simultaneous connections to a site">squid3 at treenet.co.nz
       </A><BR>
    <I>Sun Nov 18 05:24:36 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019689.html">[squid-users] limit number of simultaneous connections to a site
</A></li>
        <LI>Next message (by thread): <A HREF="019691.html">[squid-users] Proxy Protocol V2 - Reserved type ranges unsupported
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19690">[ date ]</a>
              <a href="thread.html#19690">[ thread ]</a>
              <a href="subject.html#19690">[ subject ]</a>
              <a href="author.html#19690">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 18/11/18 12:58 AM, mzgmedia wrote:
&gt;<i> Hello
</I>&gt;<i> 
</I>&gt;<i> we want to restrict the access to a site to a certain number of simultanious
</I>&gt;<i> connections
</I>&gt;<i> 
</I>&gt;<i> we have this config
</I>&gt;<i> 
</I>&gt;<i> acl badSite dstdom_regex ^(www\.)?SITE\.[\.a-z]{2,5}
</I>&gt;<i> acl badSiteCon maxconn 33
</I>&gt;<i> http_access deny badSite badSiteCon 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> but I don't know if this works 
</I>&gt;<i> or 
</I>&gt;<i> it will restrict anybody which has at least 33 connections in total to
</I>&gt;<i> different sites and now tries to access the bad site
</I>&gt;<i> 
</I>
The latter. The problem with what you are asking for is that HTTP is a
multiplexed and stateless protocol. Your restriction requires a
statefulness which does not exist.

* Request messages from a client on their connection(s) to Squid may be
for any domain.

 Squid cannot determine what connections will be used for in future.
Only what the current request message is doing, and things like this
client already having N connections total.


* Connections from Squid to a server can (and do) multiplex many
requests from multiple clients for the same domain.

 Use cache_peer to tell Squid that it needs to have certain behaviour on
connections to a particular server. The max-conn=N option of cache_peer
prevents Squid opening more than N connections to that peer. Those N
connections are still shared by all clients requesting from the
domain(s) served by that peer.


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019689.html">[squid-users] limit number of simultaneous connections to a site
</A></li>
	<LI>Next message (by thread): <A HREF="019691.html">[squid-users] Proxy Protocol V2 - Reserved type ranges unsupported
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19690">[ date ]</a>
              <a href="thread.html#19690">[ thread ]</a>
              <a href="subject.html#19690">[ subject ]</a>
              <a href="author.html#19690">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
