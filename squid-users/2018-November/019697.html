<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] How to configure IPv6
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20How%20to%20configure%20IPv6&In-Reply-To=%3Cf7f92d2c-8cd8-144f-f763-02ea0369d274%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019696.html">
   <LINK REL="Next"  HREF="019698.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] How to configure IPv6</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20How%20to%20configure%20IPv6&In-Reply-To=%3Cf7f92d2c-8cd8-144f-f763-02ea0369d274%40treenet.co.nz%3E"
       TITLE="[squid-users] How to configure IPv6">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Nov 20 00:20:35 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019696.html">[squid-users] How to configure IPv6
</A></li>
        <LI>Next message (by thread): <A HREF="019698.html">[squid-users] How to configure IPv6
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19697">[ date ]</a>
              <a href="thread.html#19697">[ thread ]</a>
              <a href="subject.html#19697">[ subject ]</a>
              <a href="author.html#19697">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 20/11/18 9:37 am, igmaniac wrote:
&gt;<i> Hi, 
</I>&gt;<i> 
</I>&gt;<i> I am trying to create a simple proxy that will receive traffic and forward
</I>&gt;<i> it to the server IPv6 address. 
</I>
Squid defaults to using IPv6 all connections unless there is something
actively preventing IPv6 from working.

If your network supports IPv6 traffic and the server you are connecting
to has an IPv6 address you do not have to do anything. Just configure
whatever ACLs and access rules you would have about whether a client is
allowed to use your proxy.


&gt;<i> I can actually connect to proxy but when I check my IP on a browser it says
</I>&gt;<i> the IPv4 address of the server. 
</I>
What check are you doing exactly? and what exactly is it producing?

The problem is most likely that you are looking at the wrong info or the
test is broken in some other way.

Please be aware that in normal HTTP operations the Browser&lt;-&gt;Squid
connection is fully independent of any Squid&lt;-&gt;server connections.
Websites which tell you &quot;your IP&quot; (aka whatismyip.com) are often not
telling you Squid's IP they are seeking to tell you the Browser's IP.


&gt;<i> So far my configuration is like this but I don't know if it's correct: 
</I>&gt;<i> 
</I>&gt;<i> hierarchy_stoplist cgi-bin ? 
</I>
The above directive was removed in Squid-3.5.


&gt;<i> acl QUERY urlpath_regex cgi-bin \? \.css 
</I>&gt;<i> no_cache deny QUERY 
</I>
You can remove the above lines completely. It is a workaround from
Squid-1.x for HTTP/1.0 lack of certain caching features. Squid-3.2 and
later support HTTP/1.1 caching and you already have the relevant
refresh_pattern to handle dynamic content better than the &quot;QUERY&quot;
workaround ever could.


&gt;<i> acl NOT_TO_CACHE dstdomain &quot;/etc/squid/list/not-to-cache.conf&quot; 
</I>&gt;<i> no_cache deny NOT_TO_CACHE
</I>
Remove that &quot;no_&quot; prefix. The directive has been called just &quot;cache &quot;
since Squid-2 era.


Or, if you have Squid-3.5 or later consider using the store_miss
directive instead of &quot;cache&quot;.


&gt;<i> acl SSL_ports port 443 
</I>&gt;<i> acl Safe_ports port 80	
</I>&gt;<i> acl Safe_ports port 21	
</I>&gt;<i> acl Safe_ports port 443	
</I>&gt;<i> acl Safe_ports port 70	
</I>&gt;<i> acl Safe_ports port 210	
</I>&gt;<i> acl Safe_ports port 1025-65535	
</I>&gt;<i> acl Safe_ports port 280	
</I>&gt;<i> acl Safe_ports port 488	
</I>&gt;<i> acl Safe_ports port 591	
</I>&gt;<i> acl Safe_ports port 777	
</I>&gt;<i> acl CONNECT method CONNECT 
</I>&gt;<i> http_access deny !Safe_ports 
</I>&gt;<i> http_access deny CONNECT !SSL_ports 
</I>&gt;<i> http_access allow localhost manager 
</I>&gt;<i> http_access deny manager 
</I>&gt;<i> http_access allow localhost 
</I>&gt;<i> http_access allow all
</I>
Do not do that. &quot;allow all&quot; makes your proxy an &quot;Open Proxy&quot; which is a
very bad idea.

Especially when testing since it artificially makes things that are
quite abnormal &quot;work&quot;. As evidenced by your very mangled http_access
rules later on (which are ignored since everything was already allowed
by this).


&gt;<i> http_port 3128 
</I>&gt;<i> acl user1 myportname 3128 
</I>
The &quot;user1&quot; ACL is never used. You can remove the above line.


&gt;<i> acl to_ipv6 dst ipv6 
</I>&gt;<i> http_access deny to_ipv6 !all
</I>
The &quot;allow all&quot; above already allowed *everything* through your Squid.
So this line is never even evaluated and its use as a trick to get Squid
to perform DNS far earlier than normal is not happening.

&gt;<i>From the context of your question and intended behaviour I suspect that
</I>you were not actually wanting to do the behaviour this config trick is
designed to cause. Specifically to force Squid to perform DNS lookups
far earlier than it would normally do them - for a very minor
performance enhancement when DNS server are expected to be very slow.

That behaviour will not help with your stated intentions. So I suggest
removing this http_access line as well.


&gt;<i> tcp_outgoing_address xxx::xxx to_ipv6
</I>
In current Squids where it works properly this directive selects the IP
based first on which IP type the server has. You can only set IPv6
address on connections to IPv6 servers, and only set IPv4 address on
connections to IPv4 servers. Squid-3.4+ will ignore lines attempting to
set the wrong IP type.

In other words the &quot;to_ipv6&quot; is implicit in how this directive currently
does things and no longer needed. If you have to use the above line to
set a custom IPv6 for outgoing traffic you should use the &quot;all&quot; ACL here
instead.
 Or better yet, remove that line entirely. The OS networking stack will
assign an appropriate IP address for the connection.



... if you do all those changes you should notice you are pretty much
back to Squid's default config file.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019696.html">[squid-users] How to configure IPv6
</A></li>
	<LI>Next message (by thread): <A HREF="019698.html">[squid-users] How to configure IPv6
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19697">[ date ]</a>
              <a href="thread.html#19697">[ thread ]</a>
              <a href="subject.html#19697">[ subject ]</a>
              <a href="author.html#19697">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
