<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Chrome 69
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Chrome%2069&In-Reply-To=%3C1538423622420-0.post%40n4.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019338.html">
   <LINK REL="Next"  HREF="019330.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Chrome 69</H1>
    <B>neok</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Chrome%2069&In-Reply-To=%3C1538423622420-0.post%40n4.nabble.com%3E"
       TITLE="[squid-users] Chrome 69">service.mv at gmail.com
       </A><BR>
    <I>Mon Oct  1 19:53:42 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019338.html">[squid-users] negotiate_kerberos_auth: ERROR
</A></li>
        <LI>Next message (by thread): <A HREF="019330.html">[squid-users] Chrome 69
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19329">[ date ]</a>
              <a href="thread.html#19329">[ thread ]</a>
              <a href="subject.html#19329">[ subject ]</a>
              <a href="author.html#19329">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello everyone!
I'm a bit lost with the behavior of Google Chrome 69.0 for Win 64 and my
squid rules 3.5.20.
Until a few days ago when browsing denied sites Chrome threw the error
&quot;ERR_TUNNEL_CONNECTION_FAILED&quot; which was fine for me.
Firefox 62 threw the error &quot;The proxy server is refusing connections&quot; which
was also fine for me.
Now Chrome shows me the login window every time I visit a denied site.
I suspect Chrome has been updated and changed its behavior. I'm currently
studying that possibility.
I'm also rethinking whether the way I'm denying sites is the right one.
I leave my settings so that someone with more experience can give me some
feedback.
I am very grateful for any indication.
Best regards,
Gabriel.


squid.conf 
### Negotiate/NTLM and Negotiate/Kerberos authentication
auth_param negotiate program /usr/sbin/negotiate_wrapper --ntlm
/usr/bin/ntlm_auth --helper-protocol=squid-2.5-ntlmssp --kerberos
/usr/lib64/squid/negotiate_kerberos_auth -r -i -s GSS_C_NO_NAME 
auth_param negotiate children 200
auth_param negotiate keep_alive on

### standard allowed ports
acl SSL_ports port 443 
acl Safe_ports port 80 # http 
acl Safe_ports port 21 # ftp 
acl Safe_ports port 443 # https 
acl Safe_ports port 70 # gopher 
acl Safe_ports port 210 # wais 
acl Safe_ports port 1025-65535 # unregistered ports 
acl Safe_ports port 280 # http-mgmt 
acl Safe_ports port 488 # gss-http 
acl Safe_ports port 591 # filemaker 
acl Safe_ports port 777 # multiling http 
acl CONNECT method CONNECT

### destination domains to be blocked in a HTTP access control policy
acl LS_adult dstdomain -i &quot;/etc/squid/DBL/adult.txt&quot;
acl LS_anonvpn dstdomain -i &quot;/etc/squid/DBL/anonvpn.txt&quot;
acl LS_hacking dstdomain -i &quot;/etc/squid/DBL/hacking.txt&quot;
acl LS_malicius dstdomain -i &quot;/etc/squid/DBL/malicius.txt&quot;
acl LS_remotecontrol dstdomain -i &quot;/etc/squid/DBL/remotecontrol.txt&quot;
acl LS_warez dstdomain -i &quot;/etc/squid/DBL/warez.txt&quot;
acl LS_youtube dstdomain -i &quot;/etc/squid/DBL/youtube.txt&quot;

### acl for proxy authentication (kerberos or ntlm)
acl auth proxy_auth REQUIRED

### LDAP group membership sources ###
external_acl_type AD_WEB_ACCESS %LOGIN /usr/lib64/squid/ext_ldap_group_acl
-P -R -b &quot;OU=NETGOL,DC=netgol,DC=local&quot; -D ldap -W
&quot;/etc/squid/ldap_pass.txt&quot; -f
&quot;(&amp;(sAMAccountname=%u)(memberof=cn=%g,OU=INTERNET,OU=PERMISOS,OU=NETGOL,DC=netgol,DC=local))&quot;
-h s-dc1.netgol.local
acl WEB_ACCESS_1 external AD_WEB_ACCESS WEB_ACCESS_1
acl WEB_ACCESS_2 external AD_WEB_ACCESS WEB_ACCESS_2
acl WEB_ACCESS_3 external AD_WEB_ACCESS WEB_ACCESS_3
acl WEB_ACCESS_YT_ONLY external AD_WEB_ACCESS WEB_ACCESS_YT_ONLY

### HTTP access control policies
http_access deny !Safe_ports 
http_access deny CONNECT !SSL_ports 
http_access allow localhost manager 
http_access deny manager
http_access deny !auth
http_access allow localhost
http_access deny LS_malicius			# malicius sites denied for all

http_access allow WEB_ACCESS_1			# WEB_ACCESS_1 member users can browse
without restrictions

http_access deny WEB_ACCESS_2 LS_remotecontrol	# WEB_ACCESS_2 member users
can't browse Remote Control sites
http_access deny WEB_ACCESS_2 LS_warez		# WEB_ACCESS_2 member users can't
browse Warez sites
http_access allow WEB_ACCESS_2			# WEB_ACCESS_2 member users can browse the
rest of the sites not bloqued

http_access deny WEB_ACCESS_3 LS_adult		# WEB_ACCESS_3 member users can't
browse Adult sites
http_access deny WEB_ACCESS_3 LS_anonvpn	# WEB_ACCESS_3 member users can't
browse Anonymous VPN sites
http_access deny WEB_ACCESS_3 LS_hacking	# WEB_ACCESS_3 member users can't
browse Hacking sites
http_access deny WEB_ACCESS_3 LS_remotecontrol	# WEB_ACCESS_3 member users
can't browse Remote Control sites
http_access deny WEB_ACCESS_3 LS_warez		# WEB_ACCESS_3 member users can't
browse Warez sites
http_access allow WEB_ACCESS_3			# WEB_ACCESS_3 member users can browse the
rest of the sites not bloqued

http_access allow WEB_ACCESS_YT_ONLY LS_youtube # WEB_ACCESS_YT_ONLY member
users can browse YouTube
http_access deny WEB_ACCESS_YT_ONLY             # WEB_ACCESS_YT_ONLY member
users can't browse the rest of sites

http_access deny all

### PERSONALIZATION ###
http_port 8080 
coredump_dir /var/spool/squid 
refresh_pattern ^ftp: 1440 20% 10080 
refresh_pattern ^gopher: 1440 0% 1440 
refresh_pattern -i (/cgi-bin/|\?) 0 0% 0 
refresh_pattern .  0 20% 4320 
quick_abort_min 0 KB 
quick_abort_max 0 KB 
read_timeout 5 minutes 
request_timeout 3 minutes 
shutdown_lifetime 15 seconds 
ipcache_size 2048 
fqdncache_size 4096 
forwarded_for off 
httpd_suppress_version_string on 


Mi lab scenario:
- A VM CentOS 7 Core over VirtualBox 5.2, 1 NIC. 
- My VM is attached to my domain W2012R2 (following this post 
<A HREF="https://www.rootusers.com/how-to-join-centos-linux-to-an-active-directory-domain/">https://www.rootusers.com/how-to-join-centos-linux-to-an-active-directory-domain/</A>) 
to achieve kerberos authentication transparent to the user. SElinux 
disabled. Owner permissions to user squid in all folders/files involved. 
- squid 3.5.20



--
Sent from: <A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html">http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html</A>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019338.html">[squid-users] negotiate_kerberos_auth: ERROR
</A></li>
	<LI>Next message (by thread): <A HREF="019330.html">[squid-users] Chrome 69
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19329">[ date ]</a>
              <a href="thread.html#19329">[ thread ]</a>
              <a href="subject.html#19329">[ subject ]</a>
              <a href="author.html#19329">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
