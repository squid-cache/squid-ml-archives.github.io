<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Uncomplete Negotiate negotiation with Kerberos
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Uncomplete%20Negotiate%20negotiation%20with%20Kerberos&In-Reply-To=%3CDEE553E0920CFA41BAF85A4B9C6FC3498F27D1103B%40EXCHANGESRV1.olfeo-lab.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019348.html">
   <LINK REL="Next"  HREF="019359.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Uncomplete Negotiate negotiation with Kerberos</H1>
    <B>Emmanuel Coirier</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Uncomplete%20Negotiate%20negotiation%20with%20Kerberos&In-Reply-To=%3CDEE553E0920CFA41BAF85A4B9C6FC3498F27D1103B%40EXCHANGESRV1.olfeo-lab.net%3E"
       TITLE="[squid-users] Uncomplete Negotiate negotiation with Kerberos">ecoirier at olfeo.com
       </A><BR>
    <I>Wed Oct  3 14:18:51 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019348.html">[squid-users] Uncomplete Negotiate negotiation with Kerberos
</A></li>
        <LI>Next message (by thread): <A HREF="019359.html">[squid-users] Uncomplete Negotiate negotiation with Kerberos
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19354">[ date ]</a>
              <a href="thread.html#19354">[ thread ]</a>
              <a href="subject.html#19354">[ subject ]</a>
              <a href="author.html#19354">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Amos !

First thank you for your patience and your answers.

I agree on the Negotiate/Kerberos workflow, and its security implication. But I have some
last extra questioning about Kerberos.

It seems that we disagree on how Kerberos is supposed to work. See lower :

&gt;<i> &gt; [Client sends a Kerberos Service Ticket to Squid]
</I>&gt;<i> The client sends such ticket to the proxy, the proxy sends it to the DC.
</I>
What do you consider as a DC ?

For me and until now, DC meant &quot;Domain Controller&quot;, or &quot;Distribution Center&quot;
(shorthand for KDC, Kerberos' Key Distribution Center): the trusted third party
process that can be either MIT/Heimdal Kerberos or MS Active Directory.
Am I right ?

&gt;<i> The DC tells the proxy (&quot;OK allow&quot; or &quot;no deny&quot;). 
</I>
I didn't observed any communication between the negotiate_kerberos_auth helper
and the DC. The only form of communication is reading requests on the standard input
(from squid), reading files like a keytab (the service key) and the krb5.cfg
Kerberos Realm configuration file, and writing responses on the standard output (to Squid).
No connect() system call, no socket, no IPC to some DC. (And users where correctly
authenticated, of course)

And it should be fine since the Kerberos protocol doesn't define any communication
between a service and a DC.

Yesterday I tried a Debian Firefox with a Heimdal Kerberos server. This morning,
I've tried to use a Firefox on Windows 10, with an account provided from a
MS Windows Terminal Server 2008 running an Active Directory.

In either case Firefox was configured to pass trough a Squid instance.

This Squid instance was configured like this in the two scenarii :

	auth_param negotiate program /usr/lib/squid/negotiate_kerberos_auth -s GSS_C_NO_NAME
	auth_param negotiate children 1
	auth_param negotiate keep_alive on
	
	acl foobar proxy_auth REQUIRED
	http_access allow foobar

The keytab was configured via the KRB5_KTNAME environment variable like this :

	(in the /etc/default/squid file)
	export KRB5_KTNAME=FILE:/etc/squid/HTTP.keytab

This keytab was generated using the Samba &quot;net ads keytab&quot; command for Active Directory,
and with &quot;kadmin ext&quot; for Heimdal.

&gt;<i> If that were the case there would be no need for auth_param helpers to be 
</I>&gt;<i> configured. Squid passes tokens to the helper which handles all contact and 
</I>&gt;<i> validation with the DC.
</I>
My point is that the Kerberos helper doesn't need any contact with the DC. All it
has to know is the service key stored in the keytab file. So each new TCP connection
does not create a contact to the DC. It is what I have observed, but perhaps I'm
missing something.

So I need to be sure of this detail because we need to reduce the authentication
load of some Active Directories (which previously used NTLM), and Kerberos seems
to be the solution. By telling me that the helper contacts the DC on each TCP
connection with Kerberos, you puzzles me...


-- 
Emmanuel Coirier
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019348.html">[squid-users] Uncomplete Negotiate negotiation with Kerberos
</A></li>
	<LI>Next message (by thread): <A HREF="019359.html">[squid-users] Uncomplete Negotiate negotiation with Kerberos
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19354">[ date ]</a>
              <a href="thread.html#19354">[ thread ]</a>
              <a href="subject.html#19354">[ subject ]</a>
              <a href="author.html#19354">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
