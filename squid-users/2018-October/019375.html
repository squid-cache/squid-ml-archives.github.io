<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] socket failure: (24) Too many open files
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20socket%20failure%3A%20%2824%29%20Too%20many%20open%20files&In-Reply-To=%3C201810052306.05160.Antony.Stone%40squid.open.source.it%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019374.html">
   <LINK REL="Next"  HREF="019391.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] socket failure: (24) Too many open files</H1>
    <B>Antony Stone</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20socket%20failure%3A%20%2824%29%20Too%20many%20open%20files&In-Reply-To=%3C201810052306.05160.Antony.Stone%40squid.open.source.it%3E"
       TITLE="[squid-users] socket failure: (24) Too many open files">Antony.Stone at squid.open.source.it
       </A><BR>
    <I>Fri Oct  5 21:06:04 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019374.html">[squid-users] socket failure: (24) Too many open files
</A></li>
        <LI>Next message (by thread): <A HREF="019391.html">[squid-users] socket failure: (24) Too many open files
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19375">[ date ]</a>
              <a href="thread.html#19375">[ thread ]</a>
              <a href="subject.html#19375">[ subject ]</a>
              <a href="author.html#19375">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Friday 05 October 2018 at 22:08:16, Cherukuri, Naresh wrote:

&gt;<i> For just squid process open files count.
</I>&gt;<i> 
</I>&gt;<i> [<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at squidprod</A> ~]# lsof -c squid | wc -l
</I>&gt;<i> 4385
</I>
Squid is not the only thing running on this machine...

&gt;<i> [<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at squidprod</A> ~]# lsof | wc -l
</I>&gt;<i> 10875
</I>
But you seem to have sufficient file descriptors configured *in Squid* (but maybe 
not in the O/S):

&gt;<i> [<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at squidprod</A> ~]# cat /etc/squid/squid.conf | grep &quot;max_filedescriptors&quot;
</I>&gt;<i> max_filedescriptors 8192
</I>
So, Squid can have 8192 FDs.

&gt;<i> ulimit -a value
</I>&gt;<i> [<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at squidprod</A> ~]# ulimit -a
</I>&gt;<i> open files                      (-n) 8192
</I>
...and the system will provide 8192 FDs for every process combined...

&gt;<i> [<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at squidprod</A> ~]# lsof | wc -l
</I>&gt;<i> 10875
</I>
I reckon that may well be your problem - you have a system-wide limit of 8192 
file descriptors, and yet you are trying to use 10875 open files (this will 
include local pipes, sockets, etc, so it's understandable that it's higher, 
but it indicates you're going over the limit).

&gt;<i> Thanks,
</I>&gt;<i> Naresh
</I>
And, as I asked previously:

What do &quot;cat /proc/sys/fs/file-max&quot; and &quot;cat /proc/sys/fs/file-nr&quot; tell you?

How many users do you have, what sort of number of connections per 
second/minute/hour (whatever is convenient for you to express) do you have 
going through this machine?


Antony.

-- 
A good conversation is like a miniskirt;
short enought to retain interest,
but long enough to cover the subject.

 - Celeste Headlee


                                                   Please reply to the list;
                                                         please *don't* CC me.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019374.html">[squid-users] socket failure: (24) Too many open files
</A></li>
	<LI>Next message (by thread): <A HREF="019391.html">[squid-users] socket failure: (24) Too many open files
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19375">[ date ]</a>
              <a href="thread.html#19375">[ thread ]</a>
              <a href="subject.html#19375">[ subject ]</a>
              <a href="author.html#19375">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
