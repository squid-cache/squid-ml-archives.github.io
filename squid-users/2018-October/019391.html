<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] socket failure: (24) Too many open files
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20socket%20failure%3A%20%2824%29%20Too%20many%20open%20files&In-Reply-To=%3C89638057A560FB458C01C197F81C7F5DA6FC6B44%40PACERS.amscan.corp%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019375.html">
   <LINK REL="Next"  HREF="019396.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] socket failure: (24) Too many open files</H1>
    <B>Cherukuri, Naresh</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20socket%20failure%3A%20%2824%29%20Too%20many%20open%20files&In-Reply-To=%3C89638057A560FB458C01C197F81C7F5DA6FC6B44%40PACERS.amscan.corp%3E"
       TITLE="[squid-users] socket failure: (24) Too many open files">ncherukuri at partycity.com
       </A><BR>
    <I>Mon Oct  8 13:14:20 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019375.html">[squid-users] socket failure: (24) Too many open files
</A></li>
        <LI>Next message (by thread): <A HREF="019396.html">[squid-users] socket failure: (24) Too many open files
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19391">[ date ]</a>
              <a href="thread.html#19391">[ thread ]</a>
              <a href="subject.html#19391">[ subject ]</a>
              <a href="author.html#19391">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Yes, I have also splunk running on this machine.


&gt;<i>What do &quot;cat /proc/sys/fs/file-max&quot; and &quot;cat /proc/sys/fs/file-nr&quot; tell you?
</I>
[<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at squidprod</A> ~]# cat /proc/sys/fs/file-nr
4736    0       3256314
[<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at squidprod</A> ~]# cat /proc/sys/fs/file-max
3256314

&gt;<i>How many users do you have, what sort of number of connections per 
</I>second/minute/hour (whatever is convenient for you to express) do you have 
going through this machine?

I am not sure, but I would say more than 3000 connections per minute.

Thanks,
Naresh

-----Original Message-----
From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of Antony Stone
Sent: Friday, October 5, 2018 5:06 PM
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] socket failure: (24) Too many open files

On Friday 05 October 2018 at 22:08:16, Cherukuri, Naresh wrote:

&gt;<i> For just squid process open files count.
</I>&gt;<i> 
</I>&gt;<i> [<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at squidprod</A> ~]# lsof -c squid | wc -l
</I>&gt;<i> 4385
</I>
Squid is not the only thing running on this machine...

&gt;<i> [<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at squidprod</A> ~]# lsof | wc -l
</I>&gt;<i> 10875
</I>
But you seem to have sufficient file descriptors configured *in Squid* (but maybe 
not in the O/S):

&gt;<i> [<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at squidprod</A> ~]# cat /etc/squid/squid.conf | grep &quot;max_filedescriptors&quot;
</I>&gt;<i> max_filedescriptors 8192
</I>
So, Squid can have 8192 FDs.

&gt;<i> ulimit -a value
</I>&gt;<i> [<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at squidprod</A> ~]# ulimit -a
</I>&gt;<i> open files                      (-n) 8192
</I>
...and the system will provide 8192 FDs for every process combined...

&gt;<i> [<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at squidprod</A> ~]# lsof | wc -l
</I>&gt;<i> 10875
</I>
I reckon that may well be your problem - you have a system-wide limit of 8192 
file descriptors, and yet you are trying to use 10875 open files (this will 
include local pipes, sockets, etc, so it's understandable that it's higher, 
but it indicates you're going over the limit).

&gt;<i> Thanks,
</I>&gt;<i> Naresh
</I>
And, as I asked previously:

What do &quot;cat /proc/sys/fs/file-max&quot; and &quot;cat /proc/sys/fs/file-nr&quot; tell you?

How many users do you have, what sort of number of connections per 
second/minute/hour (whatever is convenient for you to express) do you have 
going through this machine?


Antony.

-- 
A good conversation is like a miniskirt;
short enought to retain interest,
but long enough to cover the subject.

 - Celeste Headlee


                                                   Please reply to the list;
                                                         please *don't* CC me.
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019375.html">[squid-users] socket failure: (24) Too many open files
</A></li>
	<LI>Next message (by thread): <A HREF="019396.html">[squid-users] socket failure: (24) Too many open files
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19391">[ date ]</a>
              <a href="thread.html#19391">[ thread ]</a>
              <a href="subject.html#19391">[ subject ]</a>
              <a href="author.html#19391">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
