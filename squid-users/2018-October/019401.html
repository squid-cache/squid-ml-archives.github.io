<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Proxy client certificate authentication rewritten to username/password authentication
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Proxy%20client%20certificate%20authentication%20rewritten%0A%20to%20username/password%20authentication&In-Reply-To=%3C5c8fbae7-e4a2-7003-ab96-4229df43d1ee%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019400.html">
   <LINK REL="Next"  HREF="019402.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Proxy client certificate authentication rewritten to username/password authentication</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Proxy%20client%20certificate%20authentication%20rewritten%0A%20to%20username/password%20authentication&In-Reply-To=%3C5c8fbae7-e4a2-7003-ab96-4229df43d1ee%40measurement-factory.com%3E"
       TITLE="[squid-users] Proxy client certificate authentication rewritten to username/password authentication">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Oct  9 20:25:53 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019400.html">[squid-users] Proxy client certificate authentication rewritten to username/password authentication
</A></li>
        <LI>Next message (by thread): <A HREF="019402.html">[squid-users] Proxy client certificate authentication rewritten to username/password authentication
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19401">[ date ]</a>
              <a href="thread.html#19401">[ thread ]</a>
              <a href="subject.html#19401">[ subject ]</a>
              <a href="author.html#19401">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 10/09/2018 01:39 PM, Arnt Richard R&#248;rvik wrote:

&gt;<i> Can the Squid web proxy be used to request and verify the machine
</I>&gt;<i> certificate of workstations trying to initiate a session towards a given
</I>&gt;<i> web server (outside Squid), 
</I>
Yes if by &quot;machine certificate&quot; you mean an X509 certificate that TLS
servers can request from TLS clients. Squid supports TLS client
certificate request/validation.

Please note that if Squid requests that certificate, then the TLS
connection has to be between the client and Squid, not between the
client and the origin server. It is impossible for Squid to request a
client certificate on a TLS connection that Squid does not participate
in (beyond shoveling TCP payload bytes).

If the origin server itself requests a TLS client certificate, then, in
theory, Squid can inspect the certificate returned by the client.
However, I doubt such requested-by-origin TLS client certificate
inspection works out of the box, and it usually would not make sense in
common deployments (because Squid would not have access to the
validating CA used to sign the client certificate), but it is
technically possible to extract that client certificate from a
client-origin connection IIRC -- it is not encrypted -- and validate it
against known-to-Squid CAs.


&gt;<i> and, rewrite this session initiation on the
</I>&gt;<i> way out (towards the the given web server), 
</I>
If you want Squid to request the certificate, then the TLS connection
has to be between the client and Squid. If needed, Squid will open a TLS
connection to the origin server. The two TLS connections are unrelated
from TLS point of view.


&gt;<i> adding a username and password in the URL.
</I>
Yes, if client sends plain text requests to Squid, or if Squid bumps
encrypted client requests. However:

* TLS client certificate validation is currently not fully compatible
with TLS client connection bumping (i.e. SslBump) IIRC.

* When dealing with secure origin servers, popular browsers will not
send plain text requests to Squid (i.e. &quot;GET <A HREF="https://example.com">https://example.com</A>&quot;).
Instead, they will want to establish dumb CONNECT tunnels through Squid.
Those tunnels do not expose HTTP request URLs (unless Squid bumps them).

* IIRC, X509 certificates do not contain user names and passwords, at
least not in HTTP authentication sense. Where should Squid get the user
name and password to add to the URL?

* Rewriting URLs requires using a url_rewrite_program helper or an
ICAP/eCAP service.


In summary, various pieces of what you want are supported, but it is
unclear what combination of those pieces would be applicable to your
exact use case. Most likely, the combination you want is not and cannot
be supported.

If you detail whether your TLS clients know about Squid existence (i.e.
connect to/through Squid), whether your clients are regular browsers (or
custom software you control), and whether your origin servers request
client certificates, then it may be possible to determine whether what
you want is or can be supported. To detail your setup, consider
describing what happens at TCP, TLS, and HTTP layers between a typical
client, Squid, and origin server in your environment.


HTH,

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019400.html">[squid-users] Proxy client certificate authentication rewritten to username/password authentication
</A></li>
	<LI>Next message (by thread): <A HREF="019402.html">[squid-users] Proxy client certificate authentication rewritten to username/password authentication
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19401">[ date ]</a>
              <a href="thread.html#19401">[ thread ]</a>
              <a href="subject.html#19401">[ subject ]</a>
              <a href="author.html#19401">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
