<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Unable to open youtube.com
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Unable%20to%20open%20youtube.com&In-Reply-To=%3CCAKK%2BL1dW75W1oMoNCmA3nmhAaBRvCMqBObhHBbgV0sqQ407edA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019461.html">
   <LINK REL="Next"  HREF="019472.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Unable to open youtube.com</H1>
    <B>Timur Lagutenko</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Unable%20to%20open%20youtube.com&In-Reply-To=%3CCAKK%2BL1dW75W1oMoNCmA3nmhAaBRvCMqBObhHBbgV0sqQ407edA%40mail.gmail.com%3E"
       TITLE="[squid-users] Unable to open youtube.com">timur.lagutenko at gmail.com
       </A><BR>
    <I>Wed Oct 17 05:37:53 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019461.html">[squid-users] Unable to open youtube.com
</A></li>
        <LI>Next message (by thread): <A HREF="019472.html">[squid-users] Unable to open youtube.com
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19463">[ date ]</a>
              <a href="thread.html#19463">[ thread ]</a>
              <a href="subject.html#19463">[ subject ]</a>
              <a href="author.html#19463">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I will try fresh installation of FreeBSD 11.2-RELEASE
And see how it works.
Maybe something was corrupted during upgrade.

Just FYI please look on my pf.conf and squid.conf:


*# cat /etc/pf.conf*
outif=re0                       #outer interface
inif=re1                        #iner interface
outip=&quot;(&quot; $outif &quot;)&quot;            #outer ip
inip=&quot;(&quot; $inif &quot;)&quot;              #iner ip
innw=$inif:network              #iner network
inbc=$inif:broadcast            #iner broadcast
bc=&quot;255.255.255.255&quot;            #anycast

set skip on lo0
set block-policy drop
scrub in all

nat on $outif from $innw to any -&gt; $outip
rdr on $inif proto {tcp,udp} from $innw to any port 123 -&gt; $inip port 123

block log all

pass from $innw to $innw

# this is my machine client ip
# i have allowed full access form my PC
pass from 192.168.0.104 to any

# this 2 lines passes any traffic from gateway itself
pass from $outip to any
pass from $inip to any

# i don't know why but option &quot;set skip on lo0&quot; doesn't work
# so i additionally pass the whole traffic thru loopback interface
pass on lo0 from any to any


###########################################################################


*# cat /usr/local/etc/squid/squid.conf*
visible_hostname &quot;Squid on freebsd&quot;
acl localnet src 192.168.0.0/20 # RFC1918 possible internal network
shutdown_lifetime 5 seconds
access_log daemon:/var/log/squid/access.log squid

acl SSL_ports port 1-65535
acl Safe_ports port 1-65535
acl CONNECT method CONNECT

http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports

http_access allow localnet manager
http_access deny manager

http_access deny to_localhost

#
# INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
#


acl baddom dstdomain ardownload.adobe.com agsupdate.adobe.com \
.microsoft.com .windowsupdates.com .oneclient.sfx.ms \
.windows.com .windowsupdate.com

acl bdx dstdom_regex -n -i porn

http_access deny bdx
http_access deny baddom

http_access allow localnet
http_access allow localhost

http_access deny all

http_port 192.168.0.254:3128
# in future i have plans for 3129 port
# for now it simple listening additional port
http_port 192.168.0.254:3129

cache_dir ufs /var/squid/cache 10240 8 16
maximum_object_size 4096 MB
coredump_dir /var/squid/cache

quick_abort_min -1 KB

refresh_pattern ^ftp:           1440    20%     10080
refresh_pattern ^gopher:        1440    0%      1440
refresh_pattern -i (/cgi-bin/) 0        0%      0
refresh_pattern .               0       20%     4320






&#1089;&#1088;, 17 &#1086;&#1082;&#1090;. 2018 &#1075;. &#1074; 10:06, Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;:

&gt;<i> On 17/10/18 5:17 PM, Timur Lagutenko wrote:
</I>&gt;<i> &gt; i'm sure that the issue is not related to firewall rules.
</I>&gt;<i> &gt; because if I pass traffic from client IP (using NAT, browser is not
</I>&gt;<i> &gt; configured to use proxy) it works.
</I>&gt;<i>
</I>&gt;<i> Ah, you said earlier that you did not have SSL-Bump features enabled.
</I>&gt;<i>
</I>&gt;<i> How are you intercepting the port 443 HTTPS traffic with NAT and
</I>&gt;<i> converting it to port 80 or 3128 syntax HTTP for Squid to handle?
</I>&gt;<i>
</I>&gt;<i> Squid cannot MITM the &quot;raw&quot; port 443 TLS without SSL-Bump being configured.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Also since it is a Google service it may not be using TCP port 443 at
</I>&gt;<i> all. It may actually be performing their QUIC protocol instead of HTTPS.
</I>&gt;<i> That has to be blocked entirely to be sure the proxy is actually
</I>&gt;<i> receiving all the relevant traffic.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; I think it is related to some SSL/TLS lib in the system.
</I>&gt;<i> &gt; Because today i've tried CLI browser - links.
</I>&gt;<i> &gt; Launching it directly from gateway (which has direct access to web), i
</I>&gt;<i> &gt; was able to browse any site in text mode.
</I>&gt;<i> &gt; Except youtube.
</I>&gt;<i> &gt; So i guess it is related to some missing ssl lib.
</I>&gt;<i> &gt; Could you please suggest how can i find all required libs for my squid?
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> If Squid starts without crashing the libs it has been compiled to use
</I>&gt;<i> are present on your machine.
</I>&gt;<i>
</I>&gt;<i> If you built it yourself on the same machine, it only uses library
</I>&gt;<i> features that machine had at time of the build - so maybe a rebuild is
</I>&gt;<i> needed to get access to newer library features.
</I>&gt;<i>
</I>&gt;<i> When it comes to TLS though the library itself is doing the config parse
</I>&gt;<i> and setup for crypto things. So Squid does not particularly need to even
</I>&gt;<i> be configured to use features the library enables by default. Which
</I>&gt;<i> usually includes the current industry-standard ciphers etc.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> If Squid accepts your config file and does not produce an ERROR or FATAL
</I>&gt;<i> message when you run &quot;squid -k parse&quot; all the libs required to run your
</I>&gt;<i> config have been compiled in and loaded.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; # squid -v
</I>&gt;<i> &gt; Squid Cache: Version 3.5.28
</I>&gt;<i> &gt; Service Name: squid
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; This binary uses OpenSSL 1.0.2p  14 Aug 2018. For legal restrictions on
</I>&gt;<i> &gt; distribution see <A HREF="https://www.openssl.org/source/license.html">https://www.openssl.org/source/license.html</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Your problem may be TLS/1.3 related. OpenSSL 1.0.* only supports a max
</I>&gt;<i> of TLS/1.2. Squid-3.5 also only supports OpenSSL 1.0.* library.
</I>&gt;<i>
</I>&gt;<i> AFAIK, Google are one of the organizations heavily pushing TLS changes
</I>&gt;<i> and bias their services towards forcing the latest crypto whenever they
</I>&gt;<i> can. It is strange that others have not reported issues en-mass, so this
</I>&gt;<i> is somewhat unlikely.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Other admin mentioning similar behaviour with YouTube have turned out to
</I>&gt;<i> be TLS restrictions that pretty much prohibit the weaker crypto Google
</I>&gt;<i> services still allow and only let the very advanced ones (not supported
</I>&gt;<i> by their Squid) work.
</I>&gt;<i>
</I>&gt;<i> But also those restrictions were done via SSL-Bump configs. Since you
</I>&gt;<i> don't use SSL-Bump it is unlikely to be the same - which leaves us only
</I>&gt;<i> with the network/firewall level issues as known things to look at.
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20181017/dfb9c0f7/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20181017/dfb9c0f7/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019461.html">[squid-users] Unable to open youtube.com
</A></li>
	<LI>Next message (by thread): <A HREF="019472.html">[squid-users] Unable to open youtube.com
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19463">[ date ]</a>
              <a href="thread.html#19463">[ thread ]</a>
              <a href="subject.html#19463">[ subject ]</a>
              <a href="author.html#19463">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
