<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] deny_info and CONNECT for https request gives SSL error
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20deny_info%20and%20CONNECT%20for%20https%20request%20gives%20SSL%0A%20error&In-Reply-To=%3C53bee696-425e-71ad-e28b-d7fa5f42d121%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019470.html">
   <LINK REL="Next"  HREF="019468.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] deny_info and CONNECT for https request gives SSL error</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20deny_info%20and%20CONNECT%20for%20https%20request%20gives%20SSL%0A%20error&In-Reply-To=%3C53bee696-425e-71ad-e28b-d7fa5f42d121%40measurement-factory.com%3E"
       TITLE="[squid-users] deny_info and CONNECT for https request gives SSL error">rousskov at measurement-factory.com
       </A><BR>
    <I>Wed Oct 17 14:58:34 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019470.html">[squid-users] deny_info and CONNECT for https request gives SSL error
</A></li>
        <LI>Next message (by thread): <A HREF="019468.html">[squid-users] deny_info and CONNECT for https request gives SSL error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19467">[ date ]</a>
              <a href="thread.html#19467">[ thread ]</a>
              <a href="subject.html#19467">[ subject ]</a>
              <a href="author.html#19467">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 10/16/2018 08:15 PM, Amish wrote:

&gt;<i> http_port 8080 ssl-bump ...
</I>&gt;<i> http_access deny ...
</I>&gt;<i> ssl_bump splice all
</I>
&gt;<i> In this case one would expect that squid would not bump the connection
</I>&gt;<i> and return with 307 instead of 200.
</I>
FWIW, I do not think &quot;one would expect&quot; can be the driving argument for
designing SslBump error handling:

* Most humans do not &quot;expect&quot; errors at all -- it is natural for humans
to _ignore_ errors when forming initial expectations. This is why error
handling is so difficult and/or error-prone in virtually all areas of
human endeavor.

* Most likely, it is impossible to make SslBump work correctly _and_
match the first-glance expectations of the majority of admins. One has
to either study the feature documentation (to understand how the feature
works) or use working snippets certified by someone they trust (and can
get support from). If Squid documentation is lacking, there are ways to
fix that, of course.

For example, explicit configuration of error handling via ssl_bump rules
have been attempted in the past and rejected because it makes writing
correct rules very difficult and makes the rules themselves unreadable.


&gt;<i> But since it already sent 200 Connection Established - there is no
</I>&gt;<i> returning back.
</I>
As I had tried to explain earlier, the steps are not done in the order
you continue to imply. First, Squid discovers the error and only then it
purposefully replies with &quot;200 Connection Established&quot; (to be able to
deliver the error message later, when the first bumped request comes).

The described (and implemented) behavior is what many of the admins
requesting and sponsoring SslBump improvements wanted based on their
deployment experience. Your needs may be different, of course, and the
Squid Project can often satisfy conflicting needs. However, please come
to this discussion not from the &quot;I propose to fix this obvious Squid
bug&quot; point of view, but from the &quot;I propose to satisfy a new use case
while still addressing other reasonable admin needs&quot; point of view.


&gt;<i> My proposal for would be to add &quot;-n&quot; (nobump) option to deny_info.
</I>
Whether forwarding errors should lead to bumped connections should not
be determined by deny_info because deny_info does not apply to many
errors. We need a mechanism that can be applied to all errors.

And again, please keep in mind that Squid decides to bump the connection
when it decides to block CONNECT. That happens _before_ Squid looks at
deny_info. Deny_info is an HTTP error adaptation mechanism. It is
orthogonal to whether the error is delivered securely to the user or
dumped on the ground by the browser.

&gt;<i> Also browsers not respecting code other than 200 or 407 is actually a
</I>&gt;<i> browser bug. Hopefully corrected in future someday.
</I>
Very true, but based on my interpretation of browser makers' feedback on
the HTTP WG mailing list, I doubt that will happen in the foreseeable
future: Adding a proxy &quot;security context&quot; (in addition to the existing
&quot;insecure&quot; and &quot;origin&quot; contexts) is not a priority for them, especially
since it is only required to accommodate the needs of hated proxies.


HTH,

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019470.html">[squid-users] deny_info and CONNECT for https request gives SSL error
</A></li>
	<LI>Next message (by thread): <A HREF="019468.html">[squid-users] deny_info and CONNECT for https request gives SSL error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19467">[ date ]</a>
              <a href="thread.html#19467">[ thread ]</a>
              <a href="subject.html#19467">[ subject ]</a>
              <a href="author.html#19467">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
