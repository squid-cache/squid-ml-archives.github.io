<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Unable to open youtube.com
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Unable%20to%20open%20youtube.com&In-Reply-To=%3CCAKK%2BL1dpNBSrLkTaxZQO_NK-Ccs53Nho%3D7V98Zxt77zAd9bVLQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019463.html">
   <LINK REL="Next"  HREF="019473.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Unable to open youtube.com</H1>
    <B>Timur Lagutenko</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Unable%20to%20open%20youtube.com&In-Reply-To=%3CCAKK%2BL1dpNBSrLkTaxZQO_NK-Ccs53Nho%3D7V98Zxt77zAd9bVLQ%40mail.gmail.com%3E"
       TITLE="[squid-users] Unable to open youtube.com">timur.lagutenko at gmail.com
       </A><BR>
    <I>Thu Oct 18 13:03:04 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019463.html">[squid-users] Unable to open youtube.com
</A></li>
        <LI>Next message (by thread): <A HREF="019473.html">[squid-users] Unable to open youtube.com
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19472">[ date ]</a>
              <a href="thread.html#19472">[ thread ]</a>
              <a href="subject.html#19472">[ subject ]</a>
              <a href="author.html#19472">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Dear friends,

I have good news!
i upgraded my openssl package from openssl-1.0.2 up to openssl111 (FreeBSD
11.2)
this action has resolved the issues with youtube.com and some other sites.
now everything works perfect.

thank you very much for your attention!
best regards!


&#1089;&#1088;, 17 &#1086;&#1082;&#1090;. 2018 &#1075;. &#1074; 10:37, Timur Lagutenko &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">timur.lagutenko at gmail.com</A>&gt;:

&gt;<i> I will try fresh installation of FreeBSD 11.2-RELEASE
</I>&gt;<i> And see how it works.
</I>&gt;<i> Maybe something was corrupted during upgrade.
</I>&gt;<i>
</I>&gt;<i> Just FYI please look on my pf.conf and squid.conf:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *# cat /etc/pf.conf*
</I>&gt;<i> outif=re0                       #outer interface
</I>&gt;<i> inif=re1                        #iner interface
</I>&gt;<i> outip=&quot;(&quot; $outif &quot;)&quot;            #outer ip
</I>&gt;<i> inip=&quot;(&quot; $inif &quot;)&quot;              #iner ip
</I>&gt;<i> innw=$inif:network              #iner network
</I>&gt;<i> inbc=$inif:broadcast            #iner broadcast
</I>&gt;<i> bc=&quot;255.255.255.255&quot;            #anycast
</I>&gt;<i>
</I>&gt;<i> set skip on lo0
</I>&gt;<i> set block-policy drop
</I>&gt;<i> scrub in all
</I>&gt;<i>
</I>&gt;<i> nat on $outif from $innw to any -&gt; $outip
</I>&gt;<i> rdr on $inif proto {tcp,udp} from $innw to any port 123 -&gt; $inip port 123
</I>&gt;<i>
</I>&gt;<i> block log all
</I>&gt;<i>
</I>&gt;<i> pass from $innw to $innw
</I>&gt;<i>
</I>&gt;<i> # this is my machine client ip
</I>&gt;<i> # i have allowed full access form my PC
</I>&gt;<i> pass from 192.168.0.104 to any
</I>&gt;<i>
</I>&gt;<i> # this 2 lines passes any traffic from gateway itself
</I>&gt;<i> pass from $outip to any
</I>&gt;<i> pass from $inip to any
</I>&gt;<i>
</I>&gt;<i> # i don't know why but option &quot;set skip on lo0&quot; doesn't work
</I>&gt;<i> # so i additionally pass the whole traffic thru loopback interface
</I>&gt;<i> pass on lo0 from any to any
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ###########################################################################
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *# cat /usr/local/etc/squid/squid.conf*
</I>&gt;<i> visible_hostname &quot;Squid on freebsd&quot;
</I>&gt;<i> acl localnet src 192.168.0.0/20 # RFC1918 possible internal network
</I>&gt;<i> shutdown_lifetime 5 seconds
</I>&gt;<i> access_log daemon:/var/log/squid/access.log squid
</I>&gt;<i>
</I>&gt;<i> acl SSL_ports port 1-65535
</I>&gt;<i> acl Safe_ports port 1-65535
</I>&gt;<i> acl CONNECT method CONNECT
</I>&gt;<i>
</I>&gt;<i> http_access deny !Safe_ports
</I>&gt;<i> http_access deny CONNECT !SSL_ports
</I>&gt;<i>
</I>&gt;<i> http_access allow localnet manager
</I>&gt;<i> http_access deny manager
</I>&gt;<i>
</I>&gt;<i> http_access deny to_localhost
</I>&gt;<i>
</I>&gt;<i> #
</I>&gt;<i> # INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
</I>&gt;<i> #
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> acl baddom dstdomain ardownload.adobe.com agsupdate.adobe.com \
</I>&gt;<i> .microsoft.com .windowsupdates.com .oneclient.sfx.ms \
</I>&gt;<i> .windows.com .windowsupdate.com
</I>&gt;<i>
</I>&gt;<i> acl bdx dstdom_regex -n -i porn
</I>&gt;<i>
</I>&gt;<i> http_access deny bdx
</I>&gt;<i> http_access deny baddom
</I>&gt;<i>
</I>&gt;<i> http_access allow localnet
</I>&gt;<i> http_access allow localhost
</I>&gt;<i>
</I>&gt;<i> http_access deny all
</I>&gt;<i>
</I>&gt;<i> http_port 192.168.0.254:3128
</I>&gt;<i> # in future i have plans for 3129 port
</I>&gt;<i> # for now it simple listening additional port
</I>&gt;<i> http_port 192.168.0.254:3129
</I>&gt;<i>
</I>&gt;<i> cache_dir ufs /var/squid/cache 10240 8 16
</I>&gt;<i> maximum_object_size 4096 MB
</I>&gt;<i> coredump_dir /var/squid/cache
</I>&gt;<i>
</I>&gt;<i> quick_abort_min -1 KB
</I>&gt;<i>
</I>&gt;<i> refresh_pattern ^ftp:           1440    20%     10080
</I>&gt;<i> refresh_pattern ^gopher:        1440    0%      1440
</I>&gt;<i> refresh_pattern -i (/cgi-bin/) 0        0%      0
</I>&gt;<i> refresh_pattern .               0       20%     4320
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &#1089;&#1088;, 17 &#1086;&#1082;&#1090;. 2018 &#1075;. &#1074; 10:06, Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;:
</I>&gt;<i>
</I>&gt;&gt;<i> On 17/10/18 5:17 PM, Timur Lagutenko wrote:
</I>&gt;&gt;<i> &gt; i'm sure that the issue is not related to firewall rules.
</I>&gt;&gt;<i> &gt; because if I pass traffic from client IP (using NAT, browser is not
</I>&gt;&gt;<i> &gt; configured to use proxy) it works.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Ah, you said earlier that you did not have SSL-Bump features enabled.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> How are you intercepting the port 443 HTTPS traffic with NAT and
</I>&gt;&gt;<i> converting it to port 80 or 3128 syntax HTTP for Squid to handle?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Squid cannot MITM the &quot;raw&quot; port 443 TLS without SSL-Bump being
</I>&gt;&gt;<i> configured.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Also since it is a Google service it may not be using TCP port 443 at
</I>&gt;&gt;<i> all. It may actually be performing their QUIC protocol instead of HTTPS.
</I>&gt;&gt;<i> That has to be blocked entirely to be sure the proxy is actually
</I>&gt;&gt;<i> receiving all the relevant traffic.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt; I think it is related to some SSL/TLS lib in the system.
</I>&gt;&gt;<i> &gt; Because today i've tried CLI browser - links.
</I>&gt;&gt;<i> &gt; Launching it directly from gateway (which has direct access to web), i
</I>&gt;&gt;<i> &gt; was able to browse any site in text mode.
</I>&gt;&gt;<i> &gt; Except youtube.
</I>&gt;&gt;<i> &gt; So i guess it is related to some missing ssl lib.
</I>&gt;&gt;<i> &gt; Could you please suggest how can i find all required libs for my squid?
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> If Squid starts without crashing the libs it has been compiled to use
</I>&gt;&gt;<i> are present on your machine.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> If you built it yourself on the same machine, it only uses library
</I>&gt;&gt;<i> features that machine had at time of the build - so maybe a rebuild is
</I>&gt;&gt;<i> needed to get access to newer library features.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> When it comes to TLS though the library itself is doing the config parse
</I>&gt;&gt;<i> and setup for crypto things. So Squid does not particularly need to even
</I>&gt;&gt;<i> be configured to use features the library enables by default. Which
</I>&gt;&gt;<i> usually includes the current industry-standard ciphers etc.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> If Squid accepts your config file and does not produce an ERROR or FATAL
</I>&gt;&gt;<i> message when you run &quot;squid -k parse&quot; all the libs required to run your
</I>&gt;&gt;<i> config have been compiled in and loaded.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt; # squid -v
</I>&gt;&gt;<i> &gt; Squid Cache: Version 3.5.28
</I>&gt;&gt;<i> &gt; Service Name: squid
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; This binary uses OpenSSL 1.0.2p  14 Aug 2018. For legal restrictions on
</I>&gt;&gt;<i> &gt; distribution see <A HREF="https://www.openssl.org/source/license.html">https://www.openssl.org/source/license.html</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Your problem may be TLS/1.3 related. OpenSSL 1.0.* only supports a max
</I>&gt;&gt;<i> of TLS/1.2. Squid-3.5 also only supports OpenSSL 1.0.* library.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> AFAIK, Google are one of the organizations heavily pushing TLS changes
</I>&gt;&gt;<i> and bias their services towards forcing the latest crypto whenever they
</I>&gt;&gt;<i> can. It is strange that others have not reported issues en-mass, so this
</I>&gt;&gt;<i> is somewhat unlikely.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Other admin mentioning similar behaviour with YouTube have turned out to
</I>&gt;&gt;<i> be TLS restrictions that pretty much prohibit the weaker crypto Google
</I>&gt;&gt;<i> services still allow and only let the very advanced ones (not supported
</I>&gt;&gt;<i> by their Squid) work.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> But also those restrictions were done via SSL-Bump configs. Since you
</I>&gt;&gt;<i> don't use SSL-Bump it is unlikely to be the same - which leaves us only
</I>&gt;&gt;<i> with the network/firewall level issues as known things to look at.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Amos
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20181018/6620f512/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20181018/6620f512/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019463.html">[squid-users] Unable to open youtube.com
</A></li>
	<LI>Next message (by thread): <A HREF="019473.html">[squid-users] Unable to open youtube.com
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19472">[ date ]</a>
              <a href="thread.html#19472">[ thread ]</a>
              <a href="subject.html#19472">[ subject ]</a>
              <a href="author.html#19472">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
