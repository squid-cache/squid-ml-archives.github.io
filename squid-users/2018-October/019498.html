<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] https_port Listen on different IP
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20https_port%20Listen%20on%20different%20IP&In-Reply-To=%3C005e01d4687b%24815a1e60%24840e5b20%24%40greenet.net.cn%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019493.html">
   <LINK REL="Next"  HREF="019503.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] https_port Listen on different IP</H1>
    <B>houheming</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20https_port%20Listen%20on%20different%20IP&In-Reply-To=%3C005e01d4687b%24815a1e60%24840e5b20%24%40greenet.net.cn%3E"
       TITLE="[squid-users] https_port Listen on different IP">houhm at greenet.net.cn
       </A><BR>
    <I>Sat Oct 20 13:47:54 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019493.html">[squid-users] https_port Listen on different IP
</A></li>
        <LI>Next message (by thread): <A HREF="019503.html">[squid-users] https_port Listen on different IP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19498">[ date ]</a>
              <a href="thread.html#19498">[ thread ]</a>
              <a href="subject.html#19498">[ subject ]</a>
              <a href="author.html#19498">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Alex &amp; Amos,

Thanks for your replies, sorry for my poor English, I will add more information.

 

#1

1. Configure Squid to automatically generate origin server certificates

(signed by a configured CA X) and send them to browsers/clients that go

to those origin servers.

 

This is my situation.

 

#2

If I configure squid like the following:

https_port 443 ...

https_port 180.97.33.107:443 ...

https_port 180.97.33.108:443 ...

 

when I reconfigure squid, no errors come out, but when I check the tcp port listening using &quot;netstat -tln&quot;, the line2 and line3 with specific IP do not work:



 

#3

If I configure squid like:

https_port 180.97.33.107:443 ...

https_port 180.97.33.108:443

https_port 443

 

when I use &#8220;squid &#8211;k reconfigure&#8221; to reconfigure squid, no error message. But when I check the tcp ports listening:



 

 

#4

I also tried to specific a different port for IP 0.0.0.0, like this:

https_port 180.97.33.107:443 ...

https_port 180.97.33.108:443

https_port 4433   #here specify a different port from above

 

and it works.



 

https_port 0.0.0.0:443

https_port 1.1.1.1:443

I was just curious that the above two types of rules cannot exist together, whichever you put the first in squid.conf, it will overwrite the second one.

 

Using a different port for wildcard, it is a good solution in this case, it is just that ,if I could use the same tcp port for IP-0.0.0.0, it will be easier for my situation.

In my case, the destination server IP and root CA are dynamically send to me by anther configure server, so I choose to use default https port 443 to receive all https traffic.

If I have to use different ports for IP-0.0.0.0, I think I have to write one iptables rule for one https server IP, in normal case this is ok, in my case I have to do it dynamically, in another way of saying, whenever I receive a configure rule, I have to write an iptables rule for it. Anyway, that is my problem, thank you guys!

 

 

Heming Hou

-----&#37038;&#20214;&#21407;&#20214;-----
&#21457;&#20214;&#20154;: Amos Jeffries [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>] 
&#21457;&#36865;&#26102;&#38388;: 2018&#24180;10&#26376;20&#26085; 12:10
&#25910;&#20214;&#20154;: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
&#20027;&#39064;: Re: [squid-users] https_port Listen on different IP

 

On 20/10/18 6:04 AM, Alex Rousskov wrote:

&gt;<i> On 10/19/2018 01:10 AM, houheming wrote:
</I>
&gt;&gt;<i> https_port 443 ...
</I>
&gt;&gt;<i> https_port 180.97.33.107:443 ...
</I>
&gt;&gt;<i> https_port 180.97.33.108:443 ...
</I>
&gt;<i> 
</I>
&gt;<i> I am not sure, but perhaps the first https_port line (the one without an
</I>
&gt;<i> explicit IP address) should come _last_ so that Squid can listen on the
</I>
&gt;<i> addresses that remain after 180.97.33.107 and 180.97.33.108 are taken by
</I>
&gt;<i> the other two ports?
</I>
 

I think that is what was meant by &quot;If I switch line1 with line2 and

line3 ..., then only line2 and line3 will get its chance to work, line1

will not work. &quot;

 

The problem is that TCP does not permit any IP:port combination to have

two simultaneous listening sockets with different parameters. These

configuration lines differ in both address and protocol they are receiving.

 

 

houheming:

you have to use different ports to receive the traffic into Squid.

 

Since you are using TPROXY there is no requirement for the proxy

listening port to be 443. Squid can listen on any port you want.

 

This problem should disappear if you set the wildcard port to another

number and update the TPROXY rule which is sending traffic to it.

 

Amos

_______________________________________________

squid-users mailing list

<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>

<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20181020/0fa185b5/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20181020/0fa185b5/attachment.htm</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 6363 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20181020/0fa185b5/attachment.png">http://lists.squid-cache.org/pipermail/squid-users/attachments/20181020/0fa185b5/attachment.png</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 7094 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20181020/0fa185b5/attachment-0001.png">http://lists.squid-cache.org/pipermail/squid-users/attachments/20181020/0fa185b5/attachment-0001.png</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.png
Type: image/png
Size: 7702 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20181020/0fa185b5/attachment-0002.png">http://lists.squid-cache.org/pipermail/squid-users/attachments/20181020/0fa185b5/attachment-0002.png</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019493.html">[squid-users] https_port Listen on different IP
</A></li>
	<LI>Next message (by thread): <A HREF="019503.html">[squid-users] https_port Listen on different IP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19498">[ date ]</a>
              <a href="thread.html#19498">[ thread ]</a>
              <a href="subject.html#19498">[ subject ]</a>
              <a href="author.html#19498">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
