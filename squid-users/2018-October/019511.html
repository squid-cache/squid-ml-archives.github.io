<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid transparent proxy forward loop
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20transparent%20proxy%20forward%20loop&In-Reply-To=%3CCAN8OBP6Lhmsr7FgDTn_Z4%2BbO%3DdyhceG4dXiebZjLi_sY-Ot4CQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019516.html">
   <LINK REL="Next"  HREF="019512.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid transparent proxy forward loop</H1>
    <B>Juan Carvajal B.</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20transparent%20proxy%20forward%20loop&In-Reply-To=%3CCAN8OBP6Lhmsr7FgDTn_Z4%2BbO%3DdyhceG4dXiebZjLi_sY-Ot4CQ%40mail.gmail.com%3E"
       TITLE="[squid-users] squid transparent proxy forward loop">juan at mediaarchitecture.org
       </A><BR>
    <I>Mon Oct 22 12:26:19 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019516.html">[squid-users] Redirect certain sites to different gateway
</A></li>
        <LI>Next message (by thread): <A HREF="019512.html">[squid-users] squid transparent proxy forward loop
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19511">[ date ]</a>
              <a href="thread.html#19511">[ thread ]</a>
              <a href="subject.html#19511">[ subject ]</a>
              <a href="author.html#19511">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Dear list,

I hope you can give me some hints for my current task.

I would like to achieve the following:

1. A user comes with the own device, for example phone or table.
2. The user connects to our own WLAN network
4. The user enters the addres of our website
3. The user can only access our website, which is hosted in a sever *not
connected* to the internet.

We have the following set up

Tablets / phones &lt;---&gt; WLAN router &lt;---&gt; server

please note that there is *no* connection to internet. The server is
connected to the &quot;internet&quot; port of the router.

The server runs ubuntu &amp; apache.

I've been trying to achieve this with squid but I get a **warning of a
forwarding loop**. I do not know what I'm doing wrong.

I'm following this:
<A HREF="https://wiki.squid-cache.org/ConfigExamples/Intercept/LinuxRedirect">https://wiki.squid-cache.org/ConfigExamples/Intercept/LinuxRedirect</A>
<A HREF="https://wiki.squid-cache.org/SquidFaq/ReverseProxy">https://wiki.squid-cache.org/SquidFaq/ReverseProxy</A>

Here are my conf files:

****squid.conf****

    http_port 3128 intercept
    http_port 192.168.0.188:80 accel defaultsite=our.domain.org
    http_port 192.168.0.188:443 accel defaultsite=our.domain.org
    cache_peer 127.0.0.1 parent 80 0 no-query originserver name=myAccel
    acl our_sites dstdomain our.domain.org
    http_access allow our_sites
    cache_peer_access myAccel allow our_sites
    cache_peer_access myAccel deny all
    visible_hostname squid.proxy
    acl SSL_ports port 443
    acl CONNECT method CONNECT
    http_access deny !Safe_ports
    http_access deny CONNECT !SSL_ports
    http_access allow localhost manager
    http_access deny manager
    http_access allow localhost
    http_access allow all
    coredump_dir /var/spool/squid
    refresh_pattern ^ftp:        1440    20%    10080
    refresh_pattern ^gopher:    1440    0%    1440
    refresh_pattern -i (/cgi-bin/|\?) 0    0%    0
    refresh_pattern (Release|Packages(.gz)*)$      0       20%     2880
    refresh_pattern .        0    20%    4320


****apache ports.conf****

    #With Squid
    Listen 127.0.0.1:80

    #Without Squid
    #Listen 80

    &lt;IfModule ssl_module&gt;
        Listen 443
    &lt;/IfModule&gt;

    &lt;IfModule mod_gnutls.c&gt;
        Listen 443
    &lt;/IfModule&gt;


****IPTABLES****

    # your proxy IP
    SQUIDIP=192.168.0.188
    # your proxy listening port
    SQUIDPORT=3128
    iptables -t nat -A PREROUTING -s $SQUIDIP -p tcp --dport 80 -j ACCEPT
    iptables -t nat -A PREROUTING -p tcp --dport 80 -j REDIRECT --to-port
$SQUIDPORT

apache: 2.4.18
squid: 3.5.12
ubuntu: 16.04

Thank you for your help!

*Juan Carlos Carvajal*

*Join our mailing list
&lt;<A HREF="http://lists.mediaarchitecture.org/?p=subscribe&amp;id=1">http://lists.mediaarchitecture.org/?p=subscribe&amp;id=1</A>&gt; (Max 1-mail / month)*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20181022/d5b24fd9/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20181022/d5b24fd9/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019516.html">[squid-users] Redirect certain sites to different gateway
</A></li>
	<LI>Next message (by thread): <A HREF="019512.html">[squid-users] squid transparent proxy forward loop
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19511">[ date ]</a>
              <a href="thread.html#19511">[ thread ]</a>
              <a href="subject.html#19511">[ subject ]</a>
              <a href="author.html#19511">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
