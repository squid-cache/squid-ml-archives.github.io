<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Redirect certain sites to different gateway
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Redirect%20certain%20sites%20to%20different%20gateway&In-Reply-To=%3CSN6PR07MB46227F4258B0B059AD309564B6F40%40SN6PR07MB4622.namprd07.prod.outlook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019510.html">
   <LINK REL="Next"  HREF="019511.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Redirect certain sites to different gateway</H1>
    <B>Donald Muller</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Redirect%20certain%20sites%20to%20different%20gateway&In-Reply-To=%3CSN6PR07MB46227F4258B0B059AD309564B6F40%40SN6PR07MB4622.namprd07.prod.outlook.com%3E"
       TITLE="[squid-users] Redirect certain sites to different gateway">donmuller22 at outlook.com
       </A><BR>
    <I>Mon Oct 22 19:52:27 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019510.html">[squid-users] Redirect certain sites to different gateway
</A></li>
        <LI>Next message (by thread): <A HREF="019511.html">[squid-users] squid transparent proxy forward loop
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19516">[ date ]</a>
              <a href="thread.html#19516">[ thread ]</a>
              <a href="subject.html#19516">[ subject ]</a>
              <a href="author.html#19516">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

&gt;<i> -----Original Message-----
</I>&gt;<i> From: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; On Behalf
</I>&gt;<i> Of Amos Jeffries
</I>&gt;<i> Sent: Monday, October 22, 2018 2:10 AM
</I>&gt;<i> To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> Subject: Re: [squid-users] Redirect certain sites to different gateway
</I>&gt;<i> 
</I>&gt;<i> On 22/10/18 12:54 PM, Donald Muller wrote:
</I>&gt;<i> &gt; I have had squid running well for a while now on my NAS. The browser on
</I>&gt;<i> &gt; my PC was set up to use squid. A few weeks ago I started running a VPN
</I>&gt;<i> &gt; client on the same NAS. Everything still ran well. The other day I
</I>&gt;<i> &gt; change the VPN configuration so that all traffic on the NAS gets routed
</I>&gt;<i> &gt; through the VPN (VPN became the default gateway). Everything still ran
</I>&gt;<i> &gt; fine except for a few web sites. When I tried to reach my bank, let&#8217;s
</I>&gt;<i> &gt; say it is www.mybank.com,
</I>&gt;<i> 
</I>&gt;<i> You bank with &quot;United Bank &amp; Trust&quot;?
</I>&gt;<i> 
</I>&gt;<i> When making up fake domain names please use the reserved names in the
</I>&gt;<i> &quot;example&quot; namespace:  example.com, example.net, example.whatever
</I>&gt;<i> 
</I>&gt;<i> &quot;mybank&quot; is a registered domain name  - it may or may not be a real
</I>&gt;<i> bank. Either way no need to connect it with your problems.
</I>&gt;<i> 
</I>
Noted!

&gt;<i> 
</I>&gt;<i> &gt; from my PC I received a &#8220;This site can&#8217;t be
</I>&gt;<i> &gt; reached&#8221; error. I&#8217;m assuming that the bank site won&#8217;t allow connections
</I>&gt;<i> &gt; from a VPN server.
</I>&gt;<i> &gt;
</I>&gt;<i> 
</I>&gt;<i> Assuming leads to problems and &quot;solutions&quot; that don't work. Test your
</I>&gt;<i> assumption
</I>&gt;<i>  - check your proxy cache.log for messages about traffic to that website
</I>&gt;<i>  - check your access.log for response status on traffic to that website
</I>&gt;<i>  - setup a test machine that makes requests via different gateways and
</I>&gt;<i> see what happens differently at the TCP (and if relevant TLS) layers.
</I>&gt;<i> 
</I>&gt;<i> 
</I>
If I do not use the VPN as the default gateway I can reach the site with no issues. Once I enable the VPN to be the default gateway the site stops working.

&gt;<i> &gt;
</I>&gt;<i> &gt; Not sure if it is doable but is it possible via squid to redirect a
</I>&gt;<i> &gt; request to a different gateway based on the URL (www.mybank.com
</I>&gt;<i> &gt; &lt;<A HREF="http://www.mybank.com">http://www.mybank.com</A>&gt;)? If possible how to accomplish this?
</I>&gt;<i> &gt;
</I>&gt;<i> 
</I>&gt;<i> What you are calling &quot;redirect&quot; is not possible for Squid to do itself.
</I>&gt;<i> The OS routing system is responsible for selecting which routing gateway
</I>&gt;<i> traffic goes through.
</I>&gt;<i> 
</I>
Setting up a static route is probably the preferred method but was hoping to be able to do it via a URL instead of figuring out all the IP addresses the site uses. I will attempt the static route method.

&gt;<i> What Squid can do is mark traffic selectively with a TOS
</I>&gt;<i> (tp_uotgoing_tos) or nefilter/iptables MARK (tcp_outgoing_mark) the OS
</I>&gt;<i> uses to decide on a NIC gateway for. The dstdomain ACL can be used to
</I>&gt;<i> label traffic by domain.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> But until you actually confirm your assumption was true, it may not
</I>&gt;<i> actually do anything useful.
</I>&gt;<i> 
</I>&gt;<i> Amos
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I></PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019510.html">[squid-users] Redirect certain sites to different gateway
</A></li>
	<LI>Next message (by thread): <A HREF="019511.html">[squid-users] squid transparent proxy forward loop
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19516">[ date ]</a>
              <a href="thread.html#19516">[ thread ]</a>
              <a href="subject.html#19516">[ subject ]</a>
              <a href="author.html#19516">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
