<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] ERROR The requested URL could not be retrieved
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ERROR%20The%20requested%20URL%20could%20not%20be%20retrieved&In-Reply-To=%3C2e71134a-69f7-fc7b-ad27-6c9b1cd0c7b8%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019582.html">
   <LINK REL="Next"  HREF="019593.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] ERROR The requested URL could not be retrieved</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ERROR%20The%20requested%20URL%20could%20not%20be%20retrieved&In-Reply-To=%3C2e71134a-69f7-fc7b-ad27-6c9b1cd0c7b8%40treenet.co.nz%3E"
       TITLE="[squid-users] ERROR The requested URL could not be retrieved">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon Oct 29 21:21:33 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019582.html">[squid-users] ERROR The requested URL could not be retrieved
</A></li>
        <LI>Next message (by thread): <A HREF="019593.html">[squid-users] ERROR The requested URL could not be retrieved
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19586">[ date ]</a>
              <a href="thread.html#19586">[ thread ]</a>
              <a href="subject.html#19586">[ subject ]</a>
              <a href="author.html#19586">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 30/10/18 4:23 AM, Stephen Borrill wrote:
&gt;<i> On 29/10/2018 15:20, Uchenna Nebedum wrote:
</I>&gt;&gt;<i> Good Day All,
</I>&gt;&gt;<i> I have setup squid 3.5 with mikrotik, and ssl bumping is enabled. after
</I>&gt;&gt;<i> accepting the certificate on the browser prompt, Squid throws an error
</I>&gt;&gt;<i> on the browser, &quot;*unable to forward this request at this time.*&quot; it
</I>&gt;&gt;<i> throws this error for http sites as well. please what could be causing
</I>&gt;&gt;<i> this error.
</I>&gt;<i> 
</I>&gt;<i> never_direct allow all
</I>&gt;<i> 
</I>&gt;<i> How is your proxy meant to forward on requests? You have no cache peers,
</I>&gt;<i> but have told it never to go direct (i.e. always use a cache peer).
</I>&gt;<i> 
</I>&gt;&gt;<i> *Please find attached my squid.conf*
</I>
There are some other issues I can already see which will be coming up
when you resolve the above problem:


&gt;&gt;<i> visible_hostname localhost
</I>
Any other proxy calling itself &quot;localhost&quot; will cause forwarding loops.
Either let Squid locate the proxy machines hostname automatically, or
configure a FQDN for the above. The name used should resolve to the
proxy IP when clients look it up in DNS.


&gt;&gt;<i> acl step1 at_step SslBump1
</I>&gt;&gt;<i> acl step2 at_step SslBump2
</I>&gt;&gt;<i> acl step3 at_step SslBump3
</I>&gt;&gt;<i> ssl_bump peek step1 all
</I>&gt;&gt;<i> ssl_bump stare step2 all
</I>&gt;&gt;<i> ssl_bump bump step3 all
</I>
The lines above contain other non-splice actions required to always
happen at every step of the SSL-Bumping process.

So these splice lines will never happen:

&gt;&gt;<i> ssl_bump splice localhost
</I>&gt;&gt;<i> ssl_bump splice all
</I>

&gt;&gt;<i> via off
</I>
Removal of via is only a bandaid to make those forwarding loops created
by visible_hostname not be visible anymore. They can still happen and
annoy other admin elsewhere on the networks your traffic goes to.


&gt;&gt;<i> forwarded_for on
</I>&gt;&gt;<i> request_header_access From deny all
</I>&gt;&gt;<i> request_header_access Cache-Control deny all
</I>&gt;&gt;<i> request_header_access Keep-Alive deny all
</I>&gt;&gt;<i> request_header_access Other deny all
</I>
Er, the above *only* affect requests sent to upstream servers.

Removing Cache-Control in particular is definitely going to lead to
major problems for your clients.

&quot;Other&quot; is also tricky. It removes all HTTP headers which Squid has not
explicitly bee coded to understand.

So removing headers with &quot;Other&quot; like this a) breaks any modern HTTP
features your Squid does not explicitly support, and b) lets through
many headers you probably don't want to just because Squid does &quot;know&quot; them.

Keep-Alive is unnecessary since Squid already removes that problematic
header on sight.


&gt;&gt;<i> reply_header_access Set-Cookie deny all
</I>&gt;&gt;<i> reply_header_access Set-Cookie2 deny all
</I>&gt;&gt;<i> reply_header_access Other deny all
</I>
&gt;&gt;<i> adaptation_access greasyspoon allow all
</I>&gt;&gt;<i> dns_timeout 30 seconds
</I>&gt;&gt;<i> dns_v4_first on
</I>&gt;&gt;<i> #ecap_enable off
</I>&gt;&gt;<i> icap_enable on
</I>&gt;&gt;<i> icap_preview_enable off
</I>&gt;&gt;<i> icap_preview_size 2048
</I>&gt;&gt;<i> icap_persistent_connections on
</I>&gt;&gt;<i> adaptation_send_client_ip on
</I>&gt;&gt;<i> adaptation_send_username on
</I>&gt;&gt;<i> icap_service greasyspoon respmod_precache <A HREF="icap://127.0.0.1:1344/response">icap://127.0.0.1:1344/response</A>
</I>&gt;&gt;<i> bypass=0
</I>&gt;&gt;<i> refresh_pattern ^ftp:&#160;&#160;&#160; &#160;&#160;&#160; 1440&#160;&#160;&#160; 20%&#160;&#160;&#160; 10080
</I>&gt;&gt;<i> refresh_pattern ^gopher:&#160;&#160;&#160; 1440&#160;&#160;&#160; 0%&#160;&#160;&#160; 1440
</I>&gt;&gt;<i> refresh_pattern -i (/cgi-bin/|\?) 0&#160;&#160;&#160; 0%&#160;&#160;&#160; 0
</I>&gt;&gt;<i> refresh_pattern .&#160;&#160;&#160; &#160;&#160;&#160; 0&#160;&#160;&#160; 20%&#160;&#160;&#160; 4320
</I>&gt;&gt;<i> shutdown_lifetime 10 seconds/
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>
&gt;&gt;<i>
</I>&gt;&gt;<i> please i'll provide any other information required. please i really need
</I>&gt;&gt;<i> help. I noticed my last two questions weren't answered, i really need
</I>&gt;&gt;<i> help. I've noticed google and facebook are reachable.
</I>&gt;&gt;<i>
</I>
Meaning traffic to those does not go through the proxy or any of the
ports you are intercepting. Probably via QUIC or similar non-HTTP(S)
protocol.

If you are trying to do those weird header changes for privacy or
anonymity their traffic working is a very bad sign.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019582.html">[squid-users] ERROR The requested URL could not be retrieved
</A></li>
	<LI>Next message (by thread): <A HREF="019593.html">[squid-users] ERROR The requested URL could not be retrieved
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19586">[ date ]</a>
              <a href="thread.html#19586">[ thread ]</a>
              <a href="subject.html#19586">[ subject ]</a>
              <a href="author.html#19586">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
