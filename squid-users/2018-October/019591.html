<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 3.5.25 does not recognise ICAP 408 status code
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.5.25%20does%20not%20recognise%20ICAP%20408%20status%20code&In-Reply-To=%3CCABCok%3D%2ByJTJs-bmgZe7iCwOALAmMeYvDB4X7D84rRGPgfE%2BsEw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019608.html">
   <LINK REL="Next"  HREF="019595.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 3.5.25 does not recognise ICAP 408 status code</H1>
    <B>Arunabha Saha</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.5.25%20does%20not%20recognise%20ICAP%20408%20status%20code&In-Reply-To=%3CCABCok%3D%2ByJTJs-bmgZe7iCwOALAmMeYvDB4X7D84rRGPgfE%2BsEw%40mail.gmail.com%3E"
       TITLE="[squid-users] Squid 3.5.25 does not recognise ICAP 408 status code">arunabha.saha at gmail.com
       </A><BR>
    <I>Wed Oct 31 00:45:35 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019608.html">[squid-users] Squid 4.3: SSL Bump fails to send client certificate
</A></li>
        <LI>Next message (by thread): <A HREF="019595.html">[squid-users] Squid 3.5.25 does not recognise ICAP 408 status code
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19591">[ date ]</a>
              <a href="thread.html#19591">[ thread ]</a>
              <a href="subject.html#19591">[ subject ]</a>
              <a href="author.html#19591">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Squid 3.5.25 does not seem to recognise the 408 request timeout error code
from ICAP.
The more troublesome issue for me is the exception it generates and then
declares ICAP down after a certain number of such exceptions.

I don't want to disable the failure limit entirely given that we can often
have genuine failures that squid needs to detect.

What i'd like to see is squid should not throw an exception in this case.
 The timeout is somewhat aggressive but works with an earlier version of
ICAP (0.1.x).  The one i'm testing is 0.5.3.

Any suggestions?  I tried looking at squid 3.5.26 through 3.5.28 but i
don't see any support for 408 timeout there (maybe i missed it?).

Debug Logs:

2018/10/29 20:20:25.656| 93,5| ModXact.cc(654) parseMore:
ICAP/1.0 408 Request timeout^M
Server: C-ICAP/0.5.3^M
Connection: close^M
ISTag: CI0001-XXXXXXXXX^M
^M

2018/10/29 20:20:25.656| 93,5| ModXact.cc(749) parseHeaders: parse ICAP
headers
2018/10/29 20:20:25.656| 93,5| ModXact.cc(1079) parseHead: have 98 head
bytes to parse; state: 0
2018/10/29 20:20:25.656| 93,5| ModXact.cc(1094) parseHead: parse success,
consume 98 bytes, return true
2018/10/29 20:20:25.656| 93,5| ModXact.cc(785) parseIcapHead: found
connection close
2018/10/29 20:20:25.656| 93,5| ModXact.cc(815) parseIcapHead: ICAP status
408
2018/10/29 20:20:25.656| 93,3| ../../../src/base/AsyncJobCalls.h(177) dial:
Adaptation::Icap::Xaction::noteCommRead threw exception: Unsupported ICAP
status code
2018/10/29 20:20:25.656| 11,5| HttpRequest.cc(472) detailError: current
error details: 35/396407234
2018/10/29 20:20:25.656| 93,4| Xaction.cc(514) setOutcome: ICAP_ERR_OTHER
2018/10/29 20:20:25.656| 93,4| ServiceRep.cc(80) noteFailure:  failure 4
out of 10 allowed in 0sec [up,fail4]
...
2018/10/29 20:21:06.981| 93,5| ModXact.cc(815) parseIcapHead: ICAP status
408
2018/10/29 20:21:06.981| 93,3| ../../../src/base/AsyncJobCalls.h(177) dial:
Adaptation::Icap::Xaction::noteCommRead threw exception: Unsupported ICAP
status code
2018/10/29 20:21:06.981| 11,5| HttpRequest.cc(472) detailError: current
error details: 35/396407234
2018/10/29 20:21:06.981| 93,4| Xaction.cc(514) setOutcome: ICAP_ERR_OTHER
2018/10/29 20:21:06.981| 93,4| ServiceRep.cc(80) noteFailure:  failure 11
out of 10 allowed in 0sec [up,fail11]
2018/10/29 20:21:06.981| suspending ICAP service for too many failures



-- 
regards,
Arun
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20181030/7bb79fd6/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20181030/7bb79fd6/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019608.html">[squid-users] Squid 4.3: SSL Bump fails to send client certificate
</A></li>
	<LI>Next message (by thread): <A HREF="019595.html">[squid-users] Squid 3.5.25 does not recognise ICAP 408 status code
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19591">[ date ]</a>
              <a href="thread.html#19591">[ thread ]</a>
              <a href="subject.html#19591">[ subject ]</a>
              <a href="author.html#19591">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
