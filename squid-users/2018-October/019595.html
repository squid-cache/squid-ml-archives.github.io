<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 3.5.25 does not recognise ICAP 408 status code
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.5.25%20does%20not%20recognise%20ICAP%20408%20status%0A%20code&In-Reply-To=%3Cf89571cf-a28e-64a3-472d-16d16ecfc80d%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019591.html">
   <LINK REL="Next"  HREF="019603.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 3.5.25 does not recognise ICAP 408 status code</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.5.25%20does%20not%20recognise%20ICAP%20408%20status%0A%20code&In-Reply-To=%3Cf89571cf-a28e-64a3-472d-16d16ecfc80d%40measurement-factory.com%3E"
       TITLE="[squid-users] Squid 3.5.25 does not recognise ICAP 408 status code">rousskov at measurement-factory.com
       </A><BR>
    <I>Wed Oct 31 02:27:57 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019591.html">[squid-users] Squid 3.5.25 does not recognise ICAP 408 status code
</A></li>
        <LI>Next message (by thread): <A HREF="019603.html">[squid-users] Squid 3.5.25 does not recognise ICAP 408 status	code
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19595">[ date ]</a>
              <a href="thread.html#19595">[ thread ]</a>
              <a href="subject.html#19595">[ subject ]</a>
              <a href="author.html#19595">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 10/30/18 6:45 PM, Arunabha Saha wrote:

&gt;<i> Squid 3.5.25 does not seem to recognise the 408 request timeout error
</I>&gt;<i> code from ICAP.
</I>
Squid effectively recognizes ICAP 408 response as an ICAP transaction
error response and blames the ICAP service for that error. That
(minimal) support can be improved, of course. See options #1 and #3 below.

As with any timeout, it is impossible to say in general which side of
the connection is at fault. This case has at least three sides: It could
be the HTTP agent, Squid, and/or the ICAP service. Did one of them stall
the transaction? Or was the ICAP service just too impatient? See option
#4 below.

Needless to say, treating all ICAP service timeouts as if nothing bad
happened would break some existing Squid deployments (while possibly
fixing yours). A proper general solution (option #3 below) would most
likely require making Squid behavior configurable.


&gt;<i> The more troublesome issue for me is the exception it generates and then
</I>&gt;<i> declares ICAP down after a certain number of such exceptions.&#160; &#160;&#160;
</I>&gt;<i> 
</I>&gt;<i> I don't want to disable the failure limit entirely given that we can
</I>&gt;<i> often have genuine failures that squid needs to detect.&#160; &#160;
</I>&gt;<i> 
</I>&gt;<i> What i'd like to see is squid should not throw an exception in this
</I>&gt;<i> case.
</I>
The &quot;exception&quot; is a minor low-level/technical detail. What you really
want to see is Squid blaming itself (rather than the ICAP service) for
the problem. Squid indeed lacks that kind of functionality, but it can
be added if really needed. See options #1 and #3 below.


&gt;<i> The timeout is somewhat aggressive but works with an earlier
</I>&gt;<i> version of ICAP (0.1.x).&#160; The one i'm testing is 0.5.3.
</I>
Please note that ICAP is a protocol, not a product/software name. It
probably does not matter what ICAP service you are using though.


&gt;<i> Any suggestions?
</I>
I can suggest a few options, in no particular order:

1. Modify your Squid to treat 408 differently.
2. Modify your ICAP service to stop sending ICAP 408 responses to Squid.
3. Add proper ICAP timeout support feature to Squid.
4. Investigate why your ICAP service times out. If you are lucky, you
   may be able to fix or work around the problem by adjusting Squid
   and/or your ICAP service configuration.

For option #1, Adaptation::Icap::ModXact::parseIcapHead() may be a good
starting point.

For options #1 and #3, see also
<A HREF="https://wiki.squid-cache.org/SquidFaq/AboutSquid#How_to_add_a_new_Squid_feature.2C_enhance.2C_of_fix_something.3F">https://wiki.squid-cache.org/SquidFaq/AboutSquid#How_to_add_a_new_Squid_feature.2C_enhance.2C_of_fix_something.3F</A>

In most cases, option #4 is the best first step but YMMV.


HTH,

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019591.html">[squid-users] Squid 3.5.25 does not recognise ICAP 408 status code
</A></li>
	<LI>Next message (by thread): <A HREF="019603.html">[squid-users] Squid 3.5.25 does not recognise ICAP 408 status	code
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19595">[ date ]</a>
              <a href="thread.html#19595">[ thread ]</a>
              <a href="subject.html#19595">[ subject ]</a>
              <a href="author.html#19595">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
