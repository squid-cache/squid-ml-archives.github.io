<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 4.3: SSL Bump fails to send client	certificate
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%204.3%3A%20SSL%20Bump%20fails%20to%20send%20client%0A%09certificate&In-Reply-To=%3C1540961958277-0.post%40n4.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019590.html">
   <LINK REL="Next"  HREF="019608.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 4.3: SSL Bump fails to send client	certificate</H1>
    <B>Sid</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%204.3%3A%20SSL%20Bump%20fails%20to%20send%20client%0A%09certificate&In-Reply-To=%3C1540961958277-0.post%40n4.nabble.com%3E"
       TITLE="[squid-users] Squid 4.3: SSL Bump fails to send client	certificate">SIDDH05 at gmail.com
       </A><BR>
    <I>Wed Oct 31 04:59:18 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019590.html">[squid-users] Squid 4.3: SSL Bump fails to send client certificate
</A></li>
        <LI>Next message (by thread): <A HREF="019608.html">[squid-users] Squid 4.3: SSL Bump fails to send client certificate
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19596">[ date ]</a>
              <a href="thread.html#19596">[ thread ]</a>
              <a href="subject.html#19596">[ subject ]</a>
              <a href="author.html#19596">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thank you Alex for the reply.
 
Alex: 1. Servers never send SNI. Clients usually send SNI. Squid should
forward SNI it received from the client to the server, provided the client
actually sent SNI. Did your client send SNI? 

Sid: I can see in Client Hello IP Address being sent by Client; so there is
no SNI from client itself.

Alex: 2. Bugs notwithstanding, the implied order of events is not what
actually happens: Squid, as configured, does _not_ forward anything from the
server certificate to the client. Squid, as configured, generates a
certificate based on client-supplied information (not server-supplied
information). After sending that generated certificate to the client, Squid
establishes a TLS connection with the server. 

Sid: Thank you for explanation.

Alex: For an accurate picture, in addition to Squid-server and server-Squid
traffic, look at what Squid has received from the client and what Squid sent
to the client, all in actual order.

Sid: I took wireshark on Squid server (centOS 7); I took 2 wiresharks
between Client &amp; Squid and then between Squid &amp; Server. I can see client
being sent fake cert generated by Squid &amp; client responds with &quot;Client key
Exchange&quot;, &quot;Change cipher spec&quot;, &quot;Encrypted Handshake Message&quot;. But I can't
see actual client certificate sent to Squid. Is there a way to decypt in
Wireshark. In Wireshark between Squid &amp; Server I can see Squid responding
with &quot;61 Alert (Level: Fatal, Description: Internal Error)&quot;.

Alex: Is your Squid configured to trust those internal CAs? If not, Squid
would not be able to validate the server certificate. 

Sid: I have added those chained certificates as following in squid.conf
tls_outgoing_options cafile=/usr/local/squid/etc/UCAppsCA.pem
sslproxy_foreign_intermediate_certs /usr/local/squid/etc/UCAppsCA.pem




--
Sent from: <A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html">http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html</A>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019590.html">[squid-users] Squid 4.3: SSL Bump fails to send client certificate
</A></li>
	<LI>Next message (by thread): <A HREF="019608.html">[squid-users] Squid 4.3: SSL Bump fails to send client certificate
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19596">[ date ]</a>
              <a href="thread.html#19596">[ thread ]</a>
              <a href="subject.html#19596">[ subject ]</a>
              <a href="author.html#19596">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
