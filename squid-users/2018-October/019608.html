<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 4.3: SSL Bump fails to send client certificate
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%204.3%3A%20SSL%20Bump%20fails%20to%20send%20client%0A%20certificate&In-Reply-To=%3C407e2dc2-0473-46ed-469f-e2d8da2d0326%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019596.html">
   <LINK REL="Next"  HREF="019591.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 4.3: SSL Bump fails to send client certificate</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%204.3%3A%20SSL%20Bump%20fails%20to%20send%20client%0A%20certificate&In-Reply-To=%3C407e2dc2-0473-46ed-469f-e2d8da2d0326%40measurement-factory.com%3E"
       TITLE="[squid-users] Squid 4.3: SSL Bump fails to send client certificate">rousskov at measurement-factory.com
       </A><BR>
    <I>Wed Oct 31 21:38:44 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019596.html">[squid-users] Squid 4.3: SSL Bump fails to send client	certificate
</A></li>
        <LI>Next message (by thread): <A HREF="019591.html">[squid-users] Squid 3.5.25 does not recognise ICAP 408 status code
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19608">[ date ]</a>
              <a href="thread.html#19608">[ thread ]</a>
              <a href="subject.html#19608">[ subject ]</a>
              <a href="author.html#19608">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 10/30/18 10:59 PM, Sid wrote:

&gt;<i> Sid: I took wireshark on Squid server (centOS 7); I took 2 wiresharks
</I>&gt;<i> between Client &amp; Squid and then between Squid &amp; Server. I can see client
</I>&gt;<i> being sent fake cert generated by Squid &amp; client responds with &quot;Client key
</I>&gt;<i> Exchange&quot;, &quot;Change cipher spec&quot;, &quot;Encrypted Handshake Message&quot;. 
</I>
Sounds good. Does the generated fake certificate contain the right
origin server name?


&gt;<i> But I can't see actual client certificate sent to Squid.
</I>
Why do you expect the client to send a client certificate to Squid? In
most deployments, TLS servers do not request client certificates and,
hence, TLS clients do not send client certificates. IIRC, you did not
configure your Squid to request a client certificate from the client?

Or is there a terminology problem where &quot;client certificate sent to
Squid&quot; means something other than &quot;an x509 certificate requested by a
TLS server and sent to that server by a TLS client during TLS
handshake&quot;? Please note that Squid is a TLS server in this context.


&gt;<i> Is there a way to decypt in Wireshark. 
</I>
Yes, there are several ways, including giving Wireshark your Squid's
private certificate key. Sorry, I do not have detailed instructions.
Please note that the encrypted part probably does not matter -- in most
cases prior to TLS v1.3, it is the plain text Hellos that are important
when it comes to bumping the connection.


&gt;<i> In Wireshark between Squid &amp; Server I can see Squid responding
</I>&gt;<i> with &quot;61 Alert (Level: Fatal, Description: Internal Error)&quot;.
</I>
&gt;<i> Alex: Is your Squid configured to trust those internal CAs? If not, Squid
</I>&gt;<i> would not be able to validate the server certificate. 
</I>
&gt;<i> Sid: I have added those chained certificates as following in squid.conf
</I>&gt;<i> tls_outgoing_options cafile=/usr/local/squid/etc/UCAppsCA.pem
</I>&gt;<i> sslproxy_foreign_intermediate_certs /usr/local/squid/etc/UCAppsCA.pem
</I>
Perhaps the alert may not be related to certificate validation. If you
want to verify whether UCAppsCA.pem is enough to trust the origin
server, you can use &quot;curl&quot; or &quot;openssl s_client&quot; tools for a test. They
should fail to validate the server when not configured to use
UCAppsCA.pem and they should succeed otherwise.


HTH,

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019596.html">[squid-users] Squid 4.3: SSL Bump fails to send client	certificate
</A></li>
	<LI>Next message (by thread): <A HREF="019591.html">[squid-users] Squid 3.5.25 does not recognise ICAP 408 status code
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19608">[ date ]</a>
              <a href="thread.html#19608">[ thread ]</a>
              <a href="subject.html#19608">[ subject ]</a>
              <a href="author.html#19608">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
