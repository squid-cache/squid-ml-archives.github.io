<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid intermittently not sending host header to peer
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20intermittently%20not%20sending%20host%20header%20to%0A%20peer&In-Reply-To=%3Cf5eeeefd-6ab5-ce62-ded1-dd327ebfafb6%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019102.html">
   <LINK REL="Next"  HREF="019108.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid intermittently not sending host header to peer</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20intermittently%20not%20sending%20host%20header%20to%0A%20peer&In-Reply-To=%3Cf5eeeefd-6ab5-ce62-ded1-dd327ebfafb6%40treenet.co.nz%3E"
       TITLE="[squid-users] Squid intermittently not sending host header to peer">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon Sep  3 13:22:01 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019102.html">[squid-users] Squid intermittently not sending host header to peer
</A></li>
        <LI>Next message (by thread): <A HREF="019108.html">[squid-users] Squid intermittently not sending host header to	peer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19106">[ date ]</a>
              <a href="thread.html#19106">[ thread ]</a>
              <a href="subject.html#19106">[ subject ]</a>
              <a href="author.html#19106">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 3/09/18 9:32 PM, Michael Thomas wrote:
&gt;<i> I'm trying to figure out this weird intermittent issue.
</I>&gt;<i> 
</I>&gt;<i> I have two squid servers running, non-caching, non-transparent.
</I>&gt;<i> 
</I>&gt;<i> Client -&gt; Squid1 -&gt; Squid2 -&gt; Internet
</I>&gt;<i> 
</I>&gt;<i> All HTTPS requests work as expected, but randomly, about 50% of the
</I>&gt;<i> time, HTTP requests fail.
</I>&gt;<i> 
</I>&gt;<i> The reason for the failure is that the first squid server (Squid1) is
</I>&gt;<i> not correctly forwarding the request to the second. It is stripping away
</I>&gt;<i> the hostname, and obviously the second squid server has no clue what to
</I>&gt;<i> do with it then!
</I>
Can you please provide:

* details of your Squid version(s), the output of &quot;squid -v&quot; contains that.

* a copy of the HTTP message actually received by Squid2.

* a copy of the same HTTP message as it is leaving Squid1.

&quot;debug_options 11,2&quot; can provide that in your cache.log.


Also, is there any sign of CONNECT messages requesting tunnels to Squid2
being received at Squid1 ?


Your logs contain signs of authentication being performed, and you
mention HTTPS being handled by these proxies. Yet the config showed no
signs of either having been configured. Can you please provide the
actual config where you are seeing this behaviour and generating the
logs from.
 A minimal is fine, but it does need to be generating the logs, etc for
the info to correlate correctly.


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019102.html">[squid-users] Squid intermittently not sending host header to peer
</A></li>
	<LI>Next message (by thread): <A HREF="019108.html">[squid-users] Squid intermittently not sending host header to	peer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19106">[ date ]</a>
              <a href="thread.html#19106">[ thread ]</a>
              <a href="subject.html#19106">[ subject ]</a>
              <a href="author.html#19106">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
