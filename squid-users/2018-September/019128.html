<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] a decent way to speed up Facebook?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20a%20decent%20way%20to%20speed%20up%20Facebook%3F&In-Reply-To=%3Ce0c9324b-2c3a-f6f5-5e1c-ea98edddc75a%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019124.html">
   <LINK REL="Next"  HREF="019126.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] a decent way to speed up Facebook?</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20a%20decent%20way%20to%20speed%20up%20Facebook%3F&In-Reply-To=%3Ce0c9324b-2c3a-f6f5-5e1c-ea98edddc75a%40treenet.co.nz%3E"
       TITLE="[squid-users] a decent way to speed up Facebook?">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Sep  5 04:45:05 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019124.html">[squid-users] a decent way to speed up Facebook?
</A></li>
        <LI>Next message (by thread): <A HREF="019126.html">[squid-users] SSL reverse proxy cert error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19128">[ date ]</a>
              <a href="thread.html#19128">[ thread ]</a>
              <a href="subject.html#19128">[ subject ]</a>
              <a href="author.html#19128">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 5/09/18 4:44 AM, turgut kalfao&#287;lu wrote:
&gt;<i> Hello there. I have a transparent squid at my home to speed up the
</I>&gt;<i> browsing by caching stuff.&#160; And it works well for HTTP.
</I>&gt;<i> 
</I>&gt;<i> For HTTPS, I was only able to get it to &quot;peek&quot; and I'd like to able to
</I>&gt;<i> bump the connections.
</I>&gt;<i> 
</I>&gt;<i> I installed the server certificate on the client, but still, the browser
</I>&gt;<i> (firefox) keeps complaining:
</I>&gt;<i> 
</I>&gt;<i> Your connection is not secure
</I>&gt;<i> The owner of www.facebook.com has configured their website improperly.
</I>&gt;<i> To protect your information from being stolen, Firefox has not connected
</I>&gt;<i> to this website.
</I>&gt;<i> This site uses HTTP Strict Transport Security (HSTS) to specify that
</I>&gt;<i> Firefox may only connect to it securely. As a result, it is not possible
</I>&gt;<i> to add an exception for this certificate.
</I>
Squid removes HSTS from any network traffic it handles (except splice'd
traffic). So clearing the browser info and ensuring that the other
non-HTTP protocols Browser like to use these days (eg QUIC, SPDY,
WebSockets, HTTP/2) are not happening should resolve this issue.

If you do not (or cannot) clear the browser info the HSTS should only
last until the TTL it last mentioned in traffic expires - but that can
be a very long timeout.


&gt;<i> 
</I>&gt;<i> Here is what I have:
</I>&gt;<i> #
</I>&gt;<i> # serverIsBank is a list of domains that are banks essentially. They
</I>&gt;<i> seem more picky.
</I>&gt;<i> #
</I>&gt;<i> ssl_bump splice serverIsBank
</I>&gt;<i> ssl_bump peek all
</I>&gt;<i> # ssl_bump bump all&#160;&#160;&#160; # this does not work, it gives the error above..
</I>
Try:

 # splice as soon as detected
 ssl_bump splice serverIsBank

 # step 1 - peek to get TLS SNI
 acl step1 at_step SslBump1
 ssl_bump peek step1

 # step 2 - stare to get server cert details for bump
 ssl_bump stare all

 # step 3 - terminate if splice failed, bump everything else
 ssl_bump terminate serverIsBank
 ssl_bump bump all


&gt;<i> 
</I>&gt;<i> https_port 3129 intercept ssl-bump \
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160; generate-host-certificates=on dynamic_cert_mem_cache_size=4MB \
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160; cert=/etc/squid/ssl_cert/tk2ca.pem
</I>&gt;<i> key=/etc/squid/ssl_cert/tk2ca.pem \
</I>
When cert= and key= are in the same file you do not need to specify key=.


&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160; sslflags=NO_SESSION_REUSE
</I>&gt;<i> tls_outgoing_options cafile=/etc/pki/tls/certs/ca-bundle.crt
</I>
That ca-bundle.crt is the global trusted CA right?

If yes, you do not need to manually configure it. The system default CA
/ global Trusted CA are used by default on MITM outgoing connections.


&gt;<i> sslproxy_cert_adapt setCommonName ssl::certDomainMismatch
</I>&gt;<i> sslproxy_cert_error allow all
</I>
Remove the above line. It prevents you being told about important problems.

Instead investigate errors that come up, and either fix or ignore on an
individual basis. Some errors are simple and easily avoided, others
depend on your policy about whether the client should be allowed to do
the operation.


HTH
Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019124.html">[squid-users] a decent way to speed up Facebook?
</A></li>
	<LI>Next message (by thread): <A HREF="019126.html">[squid-users] SSL reverse proxy cert error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19128">[ date ]</a>
              <a href="thread.html#19128">[ thread ]</a>
              <a href="subject.html#19128">[ subject ]</a>
              <a href="author.html#19128">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
