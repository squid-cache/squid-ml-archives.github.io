<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] About SSL peek-n-splice/bump configurations
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20About%20SSL%20peek-n-splice/bump%20configurations&In-Reply-To=%3C001601d4464c%24d1b38910%24751a9b30%24%40yahoo.com.ar%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019143.html">
   <LINK REL="Next"  HREF="019151.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] About SSL peek-n-splice/bump configurations</H1>
    <B>Julian Perconti</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20About%20SSL%20peek-n-splice/bump%20configurations&In-Reply-To=%3C001601d4464c%24d1b38910%24751a9b30%24%40yahoo.com.ar%3E"
       TITLE="[squid-users] About SSL peek-n-splice/bump configurations">vh1988 at yahoo.com.ar
       </A><BR>
    <I>Fri Sep  7 01:48:02 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019143.html">[squid-users] Squid 3.5.28 for Microsoft Windows 64-bit is available
</A></li>
        <LI>Next message (by thread): <A HREF="019151.html">[squid-users] About SSL peek-n-splice/bump configurations
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19150">[ date ]</a>
              <a href="thread.html#19150">[ thread ]</a>
              <a href="subject.html#19150">[ subject ]</a>
              <a href="author.html#19150">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> De: Alex Rousskov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt;
</I>&gt;<i> Enviado el: lunes, 13 de agosto de 2018 02:01
</I>&gt;<i> Para: Julian Perconti &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">vh1988 at yahoo.com.ar</A>&gt;; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-</A>
</I>&gt;<i> cache.org
</I>&gt;<i> Asunto: Re: [squid-users] About SSL peek-n-splice/bump configurations
</I>&gt;<i> 
</I>&gt;<i> On 08/12/2018 06:57 PM, Julian Perconti wrote:
</I>&gt;<i> &gt;&gt; De: Alex Rousskov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt;
</I>&gt;<i> &gt;&gt; Enviado el: domingo, 12 de agosto de 2018 20:50
</I>&gt;<i> &gt;&gt; Para: Julian Perconti &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">vh1988 at yahoo.com.ar</A>&gt;;
</I>&gt;<i> &gt;&gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> &gt;&gt; Asunto: Re: [squid-users] About SSL peek-n-splice/bump configurations
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; On 08/12/2018 04:09 PM, Julian Perconti wrote:
</I>&gt;<i> &gt;&gt;&gt; I would like to know which of these two cfg's are &quot;better&quot; or &quot;more
</I>&gt;<i> secure&quot;
</I>&gt;<i> &gt;&gt;&gt; when a site/domain is spliced, bumped, etc.
</I>&gt;<i> 
</I>&gt;<i> &gt;&gt; It is impossible to answer that question without knowing how _you_
</I>&gt;<i> &gt;&gt; define &quot;better&quot; or &quot;more secure&quot;.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> &gt; I tried to meant, &quot;security&quot; from the client-side accessing to a
</I>&gt;<i> &gt; non-bumped or spliced site, i.g.: bank website... client-side
</I>&gt;<i> &gt; &quot;privacy&quot; or an a -real- man-in-the-middle attack due to squid in the
</I>&gt;<i> &gt; middle.
</I>&gt;<i> 
</I>&gt;<i> A splicing Squid does not perform a man-in-the-middle attack on TLS or HTTP
</I>&gt;<i> traffic. It essentially acts as a TCP/IP-level proxy and can log TLS handshake
</I>&gt;<i> details. In some environments, doing all that improves &quot;privacy&quot; and
</I>&gt;<i> &quot;security&quot;. In others, it makes things worse (for some definition of &quot;privacy&quot;
</I>&gt;<i> and &quot;security&quot;).
</I>&gt;<i> 
</I>&gt;<i> A bumping Squid performs a man-in-the-middle attack on TLS traffic.
</I>&gt;<i> After a successful attack, it essentially acts as an HTTP-level proxy and can log
</I>&gt;<i> or even alter TLS and HTTP traffic. In some environments, doing all that
</I>&gt;<i> improves &quot;privacy&quot; and &quot;security&quot; (for some definition of &quot;privacy&quot; and
</I>&gt;<i> &quot;security&quot;). In others, it makes things worse.
</I>&gt;<i> 
</I>&gt;<i> You would have to ask a much more specific question to get a more specific
</I>&gt;<i> (but still correct) answer.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> &gt; Is well-known that there is no system /network/o.s. 100% secure but, I
</I>&gt;<i> &gt; dont know why, I always thought or stil think that with a https
</I>&gt;<i> &gt; proxy/filtering, the security or &quot;the things&quot; tooggles more risky if
</I>&gt;<i> &gt; this one did not exist. Even squid 100% correctly configured and
</I>&gt;<i> &gt; server well secured.
</I>&gt;<i> 
</I>&gt;<i> There are examples where deploying a splicing or even bumping Squid
</I>&gt;<i> improves security of the humans and/or machines that are trusting Squid to
</I>&gt;<i> examine and/or police their traffic. There are counter-examples as well. And
</I>&gt;<i> I am sure that many installations can be viewed as both, depending on who
</I>&gt;<i> gets to define &quot;privacy&quot;, &quot;security&quot;, and the &quot;right balance&quot; between the
</I>&gt;<i> two.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> &gt; What does squid when I dont specify the step?
</I>&gt;<i> 
</I>&gt;<i> Bugs notwithstanding, Squid should either
</I>&gt;<i> 
</I>&gt;<i> * bump if you were staring during the previous (explicitly configured) step or
</I>&gt;<i> 
</I>&gt;<i> * splice otherwise (including cases when no previous step was explicitly
</I>&gt;<i> configured or existed).
</I>&gt;<i> 
</I>&gt;<i> I would not rely on this (correct) behavior without testing (at least) your
</I>&gt;<i> Squid version (at least). I know that early SslBump implementations had bugs
</I>&gt;<i> in that area.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> &gt; For example:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; What does squid do with..:
</I>&gt;<i> &gt; ssl_bump splice step3 noBumpSites
</I>&gt;<i> 
</I>&gt;<i> Assuming there are no other rules, Squid should splice at step1 (see the
</I>&gt;<i> &quot;splice otherwise&quot; rule above).
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> &gt; ...And what it do instead with this?:
</I>&gt;<i> &gt; ssl_bump splice noBumpSites
</I>&gt;<i> 
</I>&gt;<i> Assuming there are no other rules, Squid should splice at step1. It will do that
</I>&gt;<i> when noBumpSites matches (naturally) and if noBumpSites does not match
</I>&gt;<i> (per the &quot;splice otherwise&quot; rule above).
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> &gt; So, Would You prefer option 2?
</I>&gt;<i> 
</I>&gt;<i> Sorry, I cannot answer this question -- too many unknown variables. It is like
</I>&gt;<i> asking a doctor whether she prefers to treat the patient with drug A or drug
</I>&gt;<i> B when the doctor does not know what the patient is suffering from and
</I>&gt;<i> what the patient's treatment preferences/goals are.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> &gt;&gt;&gt; with Option 1 I don't see the domain in &quot;TUNNEL&quot; line, just the IP
</I>&gt;<i> &gt;&gt;&gt; addr.)
</I>&gt;<i> 
</I>&gt;<i> &gt;&gt; I doubt that is how it is supposed to work. When splicing, Option 1
</I>&gt;<i> &gt;&gt; should have the same or more information so it should log the domain
</I>&gt;<i> &gt;&gt; name if Option 2 has the domain name. If you are comparing log lines
</I>&gt;<i> &gt;&gt; for identical transactions, then this could be a Squid bug.
</I>&gt;<i> 
</I>&gt;<i> &gt; I dont know, I just tell what happen in the access.log when I
</I>&gt;<i> &gt; switching between these ssl_bump configs.
</I>&gt;<i> 
</I>&gt;<i> Yes, and I am just describing what should be happening (IMO). If what is
</I>&gt;<i> actually happening bothers you, and it does not match what should be
</I>&gt;<i> happening, and nobody comes up with a better explanation, then consider
</I>&gt;<i> filing a bug report and working with developers to address the problem.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> HTH,
</I>&gt;<i> 
</I>&gt;<i> Alex.
</I>
Hi all,

I have a new strange situation:

With this peek-n-splice configuration:

ssl_bump peek step1 all
ssl_bump peek step2 noBumpSites
ssl_bump splice step3 noBumpSites
ssl_bump bump

I got this error on spliced sites (a bank site):

The system return in the browser this error: (chrome 69):

(104) Connection reset by peer (TLS code: SQUID_ERR_SSL_HANDSHAKE)
Handshake with SSL server failed: [No Error]

This proxy and the remote host failed to negotiate a mutually acceptable security settings for handling your request. It is possible that the remote host does not support secure connections, or the proxy is not satisfied with the host security credentials.

cache.log:
2018/09/06 22:40:36 kid1| ERROR: negotiating TLS on FD 44: error:00000000:lib(0):func(0):reason(0) (5/-1/104)

But if i change the ssl bump(s) directive to:

ssl_bump peek step1
ssl_bump splice noBumpSites
ssl_bump bump all

I can Access to spliced site and no any kind of errors in access.log

Any idea?

Thanks in advance



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019143.html">[squid-users] Squid 3.5.28 for Microsoft Windows 64-bit is available
</A></li>
	<LI>Next message (by thread): <A HREF="019151.html">[squid-users] About SSL peek-n-splice/bump configurations
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19150">[ date ]</a>
              <a href="thread.html#19150">[ thread ]</a>
              <a href="subject.html#19150">[ subject ]</a>
              <a href="author.html#19150">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
