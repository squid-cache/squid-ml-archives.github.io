<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 4.2 : caching is not working
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%204.2%20%3A%20caching%20is%20not%20working&In-Reply-To=%3Cce991c90-bb50-a3ca-9113-038a5e8a133a%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019164.html">
   <LINK REL="Next"  HREF="019167.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 4.2 : caching is not working</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%204.2%20%3A%20caching%20is%20not%20working&In-Reply-To=%3Cce991c90-bb50-a3ca-9113-038a5e8a133a%40treenet.co.nz%3E"
       TITLE="[squid-users] Squid 4.2 : caching is not working">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Sep  7 17:30:54 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019164.html">[squid-users] Squid 4.2 : caching is not working
</A></li>
        <LI>Next message (by thread): <A HREF="019167.html">[squid-users] Squid 4.2 : caching is not working
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19165">[ date ]</a>
              <a href="thread.html#19165">[ thread ]</a>
              <a href="subject.html#19165">[ subject ]</a>
              <a href="author.html#19165">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 8/09/18 4:46 AM, Hariharan Sethuraman wrote:
&gt;<i> Hi team,
</I>&gt;<i> 
</I>&gt;<i> I have created directories using squid -z and then triggered squid -f
</I>&gt;<i> /etc/squid/squid.conf -NYCd 1. Find (1) debug info below. And below (2)
</I>&gt;<i> are the cache directory and squid-config.&#160;
</I>&gt;<i> 
</I>&gt;<i> (1) - debug info:
</I>&gt;<i> squidclient -h localhost cache_<A HREF="object://localhost/">object://localhost/</A> mgr:objects &gt;&gt;&gt; this
</I>
You do not need to pass squidclient the cache_object: URLs, nor
localhost as server. Just:

 squidclient mgr:objects

Also, what *exactly* did that report tell you?
 &quot;cache&quot; is more than just the disk storage area.


&gt;<i> was showing the entry when the download was going on and disappeared
</I>&gt;<i> after the download complete(~290MB) on the browser.
</I>

What I am thinking reading that is that probably Squid used the cache
storage area as a temporary location for the bytes of a very large
object, but then removed it once the response was completely delivered
since it was not cacheable.

Details matter. The &quot;~&quot; means &quot;approximately&quot; and your config says
*exactly* 300 MByte is the upper limit.

 So an object which is &quot;approximately 290&quot; may in truth be *over* 300
and thus not permitted to cache.


NP: you can use the tool at redbot.org to check URL cacheability. It
will also tell you about any caching related HTTP compliance issues with
that resource.
 Or you can set &quot;debug_options 11,2&quot; in your squid.conf and check the
exact HTTP messages your proxy is dealing with.


 When I checked the
&gt;<i> du of cache directory, it is intact with 200KB
</I>
...
&gt;<i> ..
</I>&gt;<i> cache allow all
</I>&gt;<i> strip_query_terms off
</I>

Above are defaults. No need to configure since Squid-3.

&gt;<i> ..
</I>&gt;<i> cache_dir ufs /var/spool/squid/cache 2000 16 256
</I>&gt;<i> maximum_object_size 300 MB
</I>&gt;<i> ..
</I>&gt;<i> range_offset_limit -1
</I>&gt;<i> ..
</I>&gt;<i> url_rewrite_access allow all
</I>&gt;<i> url_rewrite_program&#160; /usr/bin/python /usr/share/proxypass.py
</I>
Not relevant, except that when testing the URL like with redbot.org you
need to use the URL this helper produces instead of what was passed into
Squid by the client.


&gt;<i> 
</I>&gt;<i> http_access deny all
</I>&gt;<i> ...
</I>&gt;<i> always_direct deny all
</I>&gt;<i> 
</I>&gt;<i> (a) Please let me know what am missing to enable cache.
</I>
Cache is enabled and Squid caches as much as it can by default - within
the limits prescribed by HTTP specification and your config settings.

So the only thing to do is ensure that you do not actively *prevent*
caching from happening somehow.


&gt;<i> (b) Also &quot;squidclient -h localhost cache_<A HREF="object://localhost/">object://localhost/</A>
</I>&gt;<i> mgr:objects&quot; hope this command will show the entry even after caching.
</I>&gt;<i> 
</I>
It (well, &quot;squidclient mgr:objects&quot;) should show all objects currently
known to the proxy. That will mostly be cached objects (both disk and
in-memory), but also included temporary in-transit objects.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019164.html">[squid-users] Squid 4.2 : caching is not working
</A></li>
	<LI>Next message (by thread): <A HREF="019167.html">[squid-users] Squid 4.2 : caching is not working
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19165">[ date ]</a>
              <a href="thread.html#19165">[ thread ]</a>
              <a href="subject.html#19165">[ subject ]</a>
              <a href="author.html#19165">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
