<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Using SSL bump and reverse proxy for DNS sinkhole
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Using%20SSL%20bump%20and%20reverse%20proxy%20for%20DNS%20sinkhole&In-Reply-To=%3C201809081041.55087.Antony.Stone%40squid.open.source.it%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019169.html">
   <LINK REL="Next"  HREF="019171.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Using SSL bump and reverse proxy for DNS sinkhole</H1>
    <B>Antony Stone</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Using%20SSL%20bump%20and%20reverse%20proxy%20for%20DNS%20sinkhole&In-Reply-To=%3C201809081041.55087.Antony.Stone%40squid.open.source.it%3E"
       TITLE="[squid-users] Using SSL bump and reverse proxy for DNS sinkhole">Antony.Stone at squid.open.source.it
       </A><BR>
    <I>Sat Sep  8 08:41:54 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019169.html">[squid-users] Using SSL bump and reverse proxy for DNS sinkhole
</A></li>
        <LI>Next message (by thread): <A HREF="019171.html">[squid-users] Using SSL bump and reverse proxy for DNS sinkhole
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19170">[ date ]</a>
              <a href="thread.html#19170">[ thread ]</a>
              <a href="subject.html#19170">[ subject ]</a>
              <a href="author.html#19170">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Saturday 08 September 2018 at 10:25:44, thompsonm wrote:

&gt;<i> Hello, I have a question about squid SSL bump and reverse proxy. Basically
</I>&gt;<i> for a final project I want to create a DNS sinkhole, where the client tries
</I>&gt;<i> to query a domain that has a bad reputation or is known for drive-by
</I>&gt;<i> downloads etc, and the DNS server returns false information, such as an
</I>&gt;<i> internal IP. Then the client is redirected to this internal IP, where a web
</I>&gt;<i> server is listening, and makes the HTTP request as normal.
</I>
Okat, that makes sense (technically, at least) so far...

&gt;<i> All the HTTP requests along with host, URL, client IP etc, are then logged.
</I>
Yep, the web server (which I presume is run by you) will do that for you.

&gt;<i> It's easy to make this work with HTTP. However, I want it to work also with
</I>&gt;<i> HTTPS.
</I>
What's the difference?  A web server can serve HTTPS as easily as it can serve 
HTTP.

&gt;<i> So basically set up a MITM
</I>
In The Middle of what?

Client is one end, but what's at the &quot;other end&quot; of some connection you're in 
the &quot;middle&quot; of?

Surely the other end is your own web server - I mean, you're trying to prevent 
people from connecting to (certain) real sites by giving the clients fake DNS 
replies, yes?  So, they never end up on the real site, and there's no 
connection for you to intercept.

&gt;<i> SSL proxy, where the proxy generates its own certificate for the suspicious
</I>&gt;<i> website the client is trying to connect to, and then HTTP requests are
</I>&gt;<i> forwarded to a web server listening on the same host.
</I>
This is over-complicated.  You just need one of:

1. a web server which will generate an SSL certificate on the fly and then serve 
HTT{S content back to the client using that certificate

or

2. a pile of SSL certificates which you generate using your own CA at the same 
time you put the fake entries into DNS.  After all, you know what domains 
you're putting into your &quot;DNS sinkhole&quot;, so just generate an SSL certificate 
for each one as you do it, load them onto your web server, and there you go.

Basically, if you don't need to use Squid in intercept mode for the HTTP 
solution, you don't need to use SSL Bump for the HTTPS solution.

&gt;<i> I'm not sure how to do this. Is there any way to do this with squid SSL
</I>&gt;<i> bump and reverse proxy?
</I>
Not that I can see, no, because there is no connection to be in the middle of 
that you want to intercept.  You want the client to be at one end, and your 
own server at the other end, whether it's HTTP or HTTPS - in neither case do 
you want clients to connect to the real servers.

Or, have I misunderstood something about your objective?


Antony.

-- 
&lt;flopsie&gt; yes, but this is #lbw, we don't do normal

                                                   Please reply to the list;
                                                         please *don't* CC me.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019169.html">[squid-users] Using SSL bump and reverse proxy for DNS sinkhole
</A></li>
	<LI>Next message (by thread): <A HREF="019171.html">[squid-users] Using SSL bump and reverse proxy for DNS sinkhole
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19170">[ date ]</a>
              <a href="thread.html#19170">[ thread ]</a>
              <a href="subject.html#19170">[ subject ]</a>
              <a href="author.html#19170">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
