<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] [NOC] Using Nfqueue or DAQ in squid
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%5BNOC%5D%20Using%20Nfqueue%20or%20DAQ%20in%20squid&In-Reply-To=%3C26802375-8374-9304-82e0-3e76b1585055%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019194.html">
   <LINK REL="Next"  HREF="019196.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] [NOC] Using Nfqueue or DAQ in squid</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%5BNOC%5D%20Using%20Nfqueue%20or%20DAQ%20in%20squid&In-Reply-To=%3C26802375-8374-9304-82e0-3e76b1585055%40treenet.co.nz%3E"
       TITLE="[squid-users] [NOC] Using Nfqueue or DAQ in squid">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Sep 11 18:55:09 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019194.html">[squid-users] [NOC] Using Nfqueue or DAQ in squid
</A></li>
        <LI>Next message (by thread): <A HREF="019196.html">[squid-users] [NOC] Using Nfqueue or DAQ in squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19195">[ date ]</a>
              <a href="thread.html#19195">[ thread ]</a>
              <a href="subject.html#19195">[ subject ]</a>
              <a href="author.html#19195">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 12/09/18 4:50 AM, morteza1131 wrote:
&gt;<i> i explaned what i want before in my first mail, but to be clear :
</I>&gt;<i> in my linux iptables firewall i want to do iptables rules and controles
</I>&gt;<i> in foward chain and after that do http filtering with squid, because of
</I>&gt;<i> that i need to change netfilter packet flow and send packets to
</I>&gt;<i> squid(app layer, user space) after forward chain, and then get them back
</I>&gt;<i> to kernel space to continue their's way in forward chain and then go out.
</I>&gt;<i> something like this:
</I>&gt;<i> mangle:prerouting &gt; nat:prerouting&gt;filter:forward &gt; sauid &gt;
</I>&gt;<i> mangle:postrouting &gt;nat:postrouting
</I>&gt;<i> 
</I>&gt;<i> i thought that nfqueue can help me, maybe there are other ways that i
</I>&gt;<i> don't know!!
</I>&gt;<i> 
</I>&gt;<i> what do you think!?
</I>&gt;<i> 
</I>

I think you are very much misunderstanding how netfilter/iptables is
designed.

Basically INPUT, FORWARD, OUTPUT - every packet goes through one of
them, and no packet ever goes through two.

Which chain applies is determined by where the packet is coming from,
and where it is going to - at the hardware / link layer. Though
PREROUTING rules can affect that decision.

Packets going through FORWARD are going pretty much directly from input
NIC to output NIC.


Depending on what your rules are intended to do they *should* be spread
across those tables. Your desire to put everything only in FORWARD is
leaving the INPUT and OUTPUT packets completely free.


If you want to continue to only filter packets in FORWARD instead of
packets actually entering and leaving the machine. Then you will have to
redesign netfilter itself and possibly the hardware circuitry it uses
for FORWARD handling.

As you wrote above: &quot;i need to change netfilter packet flow&quot;.

Squid has nothing to do with any of that level of packet handling. Once
a packet reaches any application layer software like Squid it ceases to
exist. Squid doesn't even get the packet header, just the payload -
streamed in with all the other packet payloads for that TCP connection.
So there is no re-processing of any packet, its gone completely.


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019194.html">[squid-users] [NOC] Using Nfqueue or DAQ in squid
</A></li>
	<LI>Next message (by thread): <A HREF="019196.html">[squid-users] [NOC] Using Nfqueue or DAQ in squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19195">[ date ]</a>
              <a href="thread.html#19195">[ thread ]</a>
              <a href="subject.html#19195">[ subject ]</a>
              <a href="author.html#19195">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
