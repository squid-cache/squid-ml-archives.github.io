<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Long delays with TLS
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Long%20delays%20with%20TLS&In-Reply-To=%3Cbd95a86f-84ee-bf4f-308a-4e5405d13ffb%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019209.html">
   <LINK REL="Next"  HREF="019212.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Long delays with TLS</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Long%20delays%20with%20TLS&In-Reply-To=%3Cbd95a86f-84ee-bf4f-308a-4e5405d13ffb%40measurement-factory.com%3E"
       TITLE="[squid-users] Long delays with TLS">rousskov at measurement-factory.com
       </A><BR>
    <I>Thu Sep 13 19:46:04 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019209.html">[squid-users] Long delays with TLS
</A></li>
        <LI>Next message (by thread): <A HREF="019212.html">[squid-users] SQUID does not insert server ip and port in logs for CONNECT method when the connection fails (error 503)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19210">[ date ]</a>
              <a href="thread.html#19210">[ thread ]</a>
              <a href="subject.html#19210">[ subject ]</a>
              <a href="author.html#19210">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 09/13/2018 01:00 PM, James Moe wrote:
&gt;<i> Hello,
</I>&gt;<i>   squid 4.0.23
</I>&gt;<i>   linux 4.12.14-lp150.12.7-default x86_64
</I>&gt;<i> 
</I>&gt;<i>   We have been seeing frequent, but not consistent, delays when proxying
</I>&gt;<i> TLS requests while browsing. By disabling the proxy, those delays
</I>&gt;<i> stopped occurring.
</I>
FYI: Your Squid is not configured to treat TLS specially. In that
configuration, your Squid does not know anything about TLS -- TLS
traffic is just opaque bytes to your Squid, hidden inside HTTP CONNECT
tunnels.


&gt;<i>   I can see no obvious hint in either the access or cache logs.
</I>
&gt;<i>   Where should I look to find what is causing the delay?
</I>
I would start by upgrading to the latest Squid v4 and then check for DNS
delays. DNS is used by both regular HTTP traffic and CONNECT tunnels
(carrying TLS bytes) so it may not fit your problem description
perfectly, but DNS delays are easier to check for than other suspects.
You can log DNS-related response times (%dt) and/or capture DNS traffic
to and from your Squid.


HTH,

Alex.


&gt;<i> ----[ conf ]----
</I>&gt;<i> acl manager_admin src 192.168.69.115
</I>&gt;<i> #
</I>&gt;<i> # acl localnet src fc00::/7
</I>&gt;<i> # acl localnet src fe80::/10
</I>&gt;<i> #
</I>&gt;<i> acl SSL_ports port 443
</I>&gt;<i> acl SSL_ports port 631
</I>&gt;<i> #
</I>&gt;<i> # Jumpline cPanel ports
</I>&gt;<i> acl SSL_ports port 2083
</I>&gt;<i> acl SSL_ports port 2096
</I>&gt;<i> #
</I>&gt;<i> # sma-nas-02, cgatePro, webadmin
</I>&gt;<i> acl SSL_ports port 5000
</I>&gt;<i> acl SSL_ports port 5001
</I>&gt;<i> acl SSL_ports port 9010
</I>&gt;<i> acl SSL_ports port 9100
</I>&gt;<i> acl SSL_ports port 10000
</I>&gt;<i> #
</I>&gt;<i> acl Safe_ports port 80
</I>&gt;<i> acl Safe_ports port 21
</I>&gt;<i> acl Safe_ports port 443
</I>&gt;<i> acl Safe_ports port 563
</I>&gt;<i> acl Safe_ports port 631
</I>&gt;<i> acl Safe_ports port 70
</I>&gt;<i> acl Safe_ports port 210
</I>&gt;<i> acl Safe_ports port 1025-65535
</I>&gt;<i> acl Safe_ports port 280
</I>&gt;<i> acl Safe_ports port 488
</I>&gt;<i> acl Safe_ports port 591
</I>&gt;<i> acl Safe_ports port 777
</I>&gt;<i> acl Safe_ports port 9100
</I>&gt;<i> #
</I>&gt;<i> acl CONNECT method CONNECT
</I>&gt;<i> acl localnet src 192.168.69.0/24
</I>&gt;<i> 
</I>&gt;<i> access_log /var/log/squid/access.log
</I>&gt;<i> #
</I>&gt;<i> http_access deny !Safe_ports
</I>&gt;<i> http_access deny CONNECT !SSL_ports
</I>&gt;<i> http_access allow manager_admin
</I>&gt;<i> http_access allow manager localhost
</I>&gt;<i> http_access deny manager
</I>&gt;<i> http_access allow localnet
</I>&gt;<i> http_access deny all
</I>&gt;<i> 
</I>&gt;<i> # Squid normally listens to port 3128
</I>&gt;<i> http_port 3128
</I>&gt;<i> 
</I>&gt;<i> cache_dir ufs /data01/var/cache/squid 51200 16 256
</I>&gt;<i> maximum_object_size 99999 KB
</I>&gt;<i> cache_mem 256 MB
</I>&gt;<i> coredump_dir /var/cache/squid
</I>&gt;<i> 
</I>&gt;<i> refresh_pattern ^ftp: 1440 20 10080
</I>&gt;<i> refresh_pattern ^gopher: 1440 0 1440
</I>&gt;<i> refresh_pattern -i  (/cgi-bin/|\?) 0 0 0
</I>&gt;<i> refresh_pattern . 0 20 4320
</I>&gt;<i> 
</I>&gt;<i> cache_log /var/log/squid/cache.log
</I>&gt;<i> cache_mgr <A HREF="https://lists.squid-cache.org/listinfo/squid-users">jimoe at sohnen-moe.com</A>
</I>&gt;<i> cache_replacement_policy lru
</I>&gt;<i> cache_store_log /var/log/squid/store.log
</I>&gt;<i> cache_swap_high 95
</I>&gt;<i> cache_swap_low 90
</I>&gt;<i> client_lifetime 1 days
</I>&gt;<i> connect_timeout 2 minutes
</I>&gt;<i> error_directory /usr/share/squid/errors/en
</I>&gt;<i> ftp_passive on
</I>&gt;<i> memory_replacement_policy lru
</I>&gt;<i> minimum_object_size 0 KB
</I>&gt;<i> ----[ end ]----
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019209.html">[squid-users] Long delays with TLS
</A></li>
	<LI>Next message (by thread): <A HREF="019212.html">[squid-users] SQUID does not insert server ip and port in logs for CONNECT method when the connection fails (error 503)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19210">[ date ]</a>
              <a href="thread.html#19210">[ thread ]</a>
              <a href="subject.html#19210">[ subject ]</a>
              <a href="author.html#19210">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
