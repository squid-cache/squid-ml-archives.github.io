<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] About SSL peek-n-splice/bump configurations
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20About%20SSL%20peek-n-splice/bump%20configurations&In-Reply-To=%3C008e01d44bbf%24ccb41e20%24661c5a60%24%40yahoo.com.ar%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019205.html">
   <LINK REL="Next"  HREF="019213.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] About SSL peek-n-splice/bump configurations</H1>
    <B>Julian Perconti</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20About%20SSL%20peek-n-splice/bump%20configurations&In-Reply-To=%3C008e01d44bbf%24ccb41e20%24661c5a60%24%40yahoo.com.ar%3E"
       TITLE="[squid-users] About SSL peek-n-splice/bump configurations">vh1988 at yahoo.com.ar
       </A><BR>
    <I>Fri Sep 14 00:13:40 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019205.html">[squid-users] About SSL peek-n-splice/bump configurations
</A></li>
        <LI>Next message (by thread): <A HREF="019213.html">[squid-users] About SSL peek-n-splice/bump configurations
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19211">[ date ]</a>
              <a href="thread.html#19211">[ thread ]</a>
              <a href="subject.html#19211">[ subject ]</a>
              <a href="author.html#19211">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> &gt; Example:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;   ssl_bump splice noBumpSites # this will be totally ignored by Squid if a
</I>&gt;<i> stare rule precedes this.
</I>&gt;<i> 
</I>&gt;<i> No, this is incorrect. There are many cases were a previous stare rule will not
</I>&gt;<i> have the effect you state it will. For example:
</I>&gt;<i> 
</I>&gt;<i>   # Squid may splice at step2 despite the preceding stare rule
</I>&gt;<i>   # because staring at step1 does not preclude splicing.
</I>&gt;<i> 
</I>&gt;<i>   ssl_bump stare step1
</I>&gt;<i>   ssl_bump splice noBumpSites
</I>
Well yes, I think You are right; but my example (or what I wanted to mean) was: -Maybe You have post that to give an example about how that rule could probably, not match, I don't know-

   ssl_bump stare noBumpSites  (at this line your example said: ssl_bump stare step1)
   ssl_bump splice noBumpSites

...And here appears a &quot;key-question&quot;:

   ssl_bump stare noBumpSites # This is the first line of SslBumps ruleset.

So, when squid reaches this first rule and line (there is no explicit step)  ...does Squid make a &quot;bucle of steps&quot; only along the first line and go to next line only when the rule stop being applicable/matchable?
If the answer of my question is: &quot;Yes&quot; then the second line has not any effect because, I guess that squid will do a bump in more-or-less this way:

   ssl_bump stare  noBumpSites

... is the same as:

   ssl_bump stare  step1 noBumpSites
   ssl_bump stare  step2 noBumpSites # Here is where he second line stops making sense
   ssl_bump bump  step3 noBumpSites # Finally bump due to the previous step

Thus:

   ssl_bump splice noBumpSites # will never matchs.

Going a bit to the past, Amos explained the following when I asked:

&gt;&gt;<i> ...So that means that squid processes the SslBump directives:
</I>&gt;&gt;<i> 1: maybe more than one time in a single request...?
</I>&gt;&gt;<i> 
</I>&gt;<i>Yes. Up to 3 times. A peek or splice action causes another check later.
</I>
Well, Amos never mentioned a &quot;stare&quot; action here, so I dont know I a &quot;stare&quot; applies to this too. 
And even worse, maybe I did not understand him correctly.

&gt;<i>   # Squid will splice at step1 despite the preceding stare rule
</I>&gt;<i>   # because the preceding stare rule never matches
</I>&gt;<i>   ssl_bump stare !all
</I>&gt;<i>   ssl_bump splice all
</I>
And this example is more obvious than the first one. It is like that previous line would not exists.

(...)

&gt;<i> &gt; Does not the splice at step1 and step2 action avoid this? I mean if
</I>&gt;<i> &gt; squid act as a -TCP forward proxy only- for noBumpSites. &quot;Don't touch
</I>&gt;<i> &gt; TLS bytes&quot;
</I>&gt;<i> 
</I>&gt;<i> I am not sure what you mean by &quot;this&quot; exactly, but splicing (at any
</I>&gt;<i> step) does not guarantee the lack of errors. 
</I>
Ok, but is Squid the culprit of those error? He is being a passive observer of that TLS traffic.
Here, I am talking about the idea of (explicitly) splice at step1 and then at step2 of a white list of sites.

Question based on words below:

&gt;&gt;&gt;<i>* If successful, ssl_bump peek and splice actions do not alter TLS
</I>&gt;&gt;&gt;<i>bytes. Peeking and/or splicing Squid can be viewed as a TCP proxy as far
</I>&gt;&gt;&gt;<i>as TLS bytes forwarding is concerned. The client and the origin server
</I>&gt;&gt;&gt;<i>will see the same TLS bytes they would have seen if Squid was not there.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>* In this scope, various errors are usually equivalent to applying the
</I>&gt;&gt;&gt;<i>&quot;bump&quot; action.
</I>
&gt;<i>The earlier you tell Squid to
</I>&gt;<i> splice the connections, the fewer checks Squid will do, decreasing the
</I>&gt;<i> probability of an error.
</I>
That is the idea with the noBumpSites ACL, the least amount of errors possible.

Lets say: &quot;Let's remove as much responsibility as possible to Squid about what happens with really/special sensitive sites, If something goes wrong&quot;
Talking with Squid/In other words: &quot;Squid, do a *full* bump to msn.com and youtube.com too; but please *never do not nothing neither touch nothing*  with bankaust.com.au 
(Some like that)

&gt;<i> Errors lead to bumping the client connection (to
</I>&gt;<i> deliver the error message).
</I>
What do You mean about those errors?

Thank You


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019205.html">[squid-users] About SSL peek-n-splice/bump configurations
</A></li>
	<LI>Next message (by thread): <A HREF="019213.html">[squid-users] About SSL peek-n-splice/bump configurations
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19211">[ date ]</a>
              <a href="thread.html#19211">[ thread ]</a>
              <a href="subject.html#19211">[ subject ]</a>
              <a href="author.html#19211">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
