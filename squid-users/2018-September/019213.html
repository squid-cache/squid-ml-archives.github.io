<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] About SSL peek-n-splice/bump configurations
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20About%20SSL%20peek-n-splice/bump%20configurations&In-Reply-To=%3C2b2e8b70-7f45-039c-462f-ba78b2fc1563%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019211.html">
   <LINK REL="Next"  HREF="019237.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] About SSL peek-n-splice/bump configurations</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20About%20SSL%20peek-n-splice/bump%20configurations&In-Reply-To=%3C2b2e8b70-7f45-039c-462f-ba78b2fc1563%40measurement-factory.com%3E"
       TITLE="[squid-users] About SSL peek-n-splice/bump configurations">rousskov at measurement-factory.com
       </A><BR>
    <I>Fri Sep 14 15:17:34 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019211.html">[squid-users] About SSL peek-n-splice/bump configurations
</A></li>
        <LI>Next message (by thread): <A HREF="019237.html">[squid-users] About SSL peek-n-splice/bump configurations
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19213">[ date ]</a>
              <a href="thread.html#19213">[ thread ]</a>
              <a href="subject.html#19213">[ subject ]</a>
              <a href="author.html#19213">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 09/13/2018 06:13 PM, Julian Perconti wrote:

&gt;<i>    ssl_bump stare noBumpSites # This is the first line of SslBumps ruleset.
</I>
&gt;<i> So, when squid reaches this first rule and line (there is no explicit
</I>&gt;<i> step)  ...does Squid make a &quot;bucle of steps&quot; only along the first
</I>&gt;<i> line and go to next line only when the rule stop being
</I>&gt;<i> applicable/matchable?
</I>
I hesitate answering that question with a simple &quot;yes&quot; or &quot;no&quot; because
any such answer is likely to mislead folks reading this email.

The overall logic is like this:

  for each step
  do
      for each rule
      do
          if the rule action is possible and the rule ACLs match,
              then perform the rule action and either go to the next
              step or, after applying the final action, exit
      done
      apply the default action and exit
  done


The overall logic is _not_ like this:

  for each rule
  do
      for each step
      ...
  done

So, &quot;yes&quot;, Squid only executes the first rule action _when_ the first
rule action is applicable and its ACLs match at every step, but, &quot;no&quot;,
Squid does not make a bunch of steps with only the first rule in mind.


&gt;&gt;&gt;<i> Does not the splice at step1 and step2 action avoid this? I mean if
</I>&gt;&gt;&gt;<i> squid act as a -TCP forward proxy only- for noBumpSites. &quot;Don't touch
</I>&gt;&gt;&gt;<i> TLS bytes&quot;
</I>
&gt;&gt;<i> I am not sure what you mean by &quot;this&quot; exactly, but splicing (at any
</I>&gt;&gt;<i> step) does not guarantee the lack of errors. 
</I>
&gt;<i> Ok, but is Squid the culprit of those error?
</I>
Usually not. Common errors include network connectivity errors, client
Host validation errors, server certificate validation errors, and being
fed a non-TLS protocol. However, it could be Squid itself. Bugs do happen.


&gt;<i> He is being a passive observer of that TLS traffic.
</I>
Squid also validates what it observes/forwards. And there is also TCP/IP
traffic before (and around) TLS traffic.


&gt;<i> Here, I am talking about the idea of (explicitly) splice at step1 and then at step2 of a white list of sites.
</I>
If you splice at step1, then the number of validations that Squid does
would be smaller (possibly zero, not sure) than if you splice at step2.
Same for the step2/step3 difference. TCP/IP-level errors may be present
at every step.


&gt;<i> Lets say: &quot;Let's remove as much responsibility as possible to Squid
</I>&gt;<i> about what happens with really/special sensitive sites, If something
</I>&gt;<i> goes wrong&quot;
</I>
Your overall intent was clear many emails ago, and it is a common
desire/need. The devil is in the details:

* A key detail here is determining whether the intended site _is_
&quot;really/special sensitive&quot;. For example, the intercepted client is
connecting to b::a:d IPv6 address while claiming in the TLS Hello that
it is trying to get to sensitive.example.com. Should Squid trust the
intended destination IP address or the TLS SNI? Or should we wait for
the server to identify itself with a valid SSL certificate? Etc.

* The other key detail is what should happen when that sensitive site
refuses to communicate with Squid or otherwise misbehaves. Should Squid,
for example, simply close the browser connection, making it more likely
that the user (or their admin) blames the proxy? Or should Squid bump
the browser connection to explain what has happened, creating all the
headaches associated with bumping.

Your Squid configuration should reflect all these key decisions.

If Squid does not have enough configuration options or code to do
exactly what you want, then you (or others) can always add more
code/options. If your use case is common/general enough, then quality
implementations of those additional features should be officially accepted.


Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019211.html">[squid-users] About SSL peek-n-splice/bump configurations
</A></li>
	<LI>Next message (by thread): <A HREF="019237.html">[squid-users] About SSL peek-n-splice/bump configurations
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19213">[ date ]</a>
              <a href="thread.html#19213">[ thread ]</a>
              <a href="subject.html#19213">[ subject ]</a>
              <a href="author.html#19213">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
