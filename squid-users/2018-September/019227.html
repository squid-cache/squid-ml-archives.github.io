<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] change packet flow to have transparent squid proxy
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20change%20packet%20flow%20to%20have%20transparent%20squid%20proxy&In-Reply-To=%3C2127671216.5705186.1536988999350%40mail.yahoo.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019247.html">
   <LINK REL="Next"  HREF="019228.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] change packet flow to have transparent squid proxy</H1>
    <B>morteza omidian</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20change%20packet%20flow%20to%20have%20transparent%20squid%20proxy&In-Reply-To=%3C2127671216.5705186.1536988999350%40mail.yahoo.com%3E"
       TITLE="[squid-users] change packet flow to have transparent squid proxy">morteza1131 at gmail.com
       </A><BR>
    <I>Sat Sep 15 05:23:19 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019247.html">[squid-users] Problem with kerb/ntlm authentication
</A></li>
        <LI>Next message (by thread): <A HREF="019228.html">[squid-users] change packet flow to have transparent squid proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19227">[ date ]</a>
              <a href="thread.html#19227">[ thread ]</a>
              <a href="subject.html#19227">[ subject ]</a>
              <a href="author.html#19227">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi
I am in a dire need about using squid in my Linux iptables firewall as a transparent proxy.
In my linux iptables firewall i want to do iptables rules and controls in forward chain and after that do http filtering with squid, because of that i need to change netfilter packet flow and send packets to squid(app layer, user space) after forward chain, and then get them back to kernel space to continue their's way in forward chain and then go out, something like other firewals and utm(like Pfsense or opensense and ....) does.In my situation, i want squid to place after my forwards iptables rules,by default squid is listen on input port of machine but its not what i want and redirect packets to the input chain does not work for me.
I think NFqueue is a good solution for my problem but i don't know that is possible to change squid source code to get packets from nfqueue? or does nfqueue can keep the packet state and handle TCP connection?
I want to change My packet flow like this: client-request &gt;&gt;&gt; prerouting &gt; Nat &gt; forward &gt; squid-cache &gt; post-routing &gt;&gt;&gt;&gt; HTTP(s)-server
The important part is that forward rules must check before packets forwards to squid. i don't want packets destinate to input chain of firewall.I thought maybe its possible to use DAQ ,like the way snort use or nfqueue in iptables. I need some help about that, please help me if its possible or there are any other ways to solve it.

Thanks a lot
Morteza Omidian
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20180915/af3b4b6d/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20180915/af3b4b6d/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019247.html">[squid-users] Problem with kerb/ntlm authentication
</A></li>
	<LI>Next message (by thread): <A HREF="019228.html">[squid-users] change packet flow to have transparent squid proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19227">[ date ]</a>
              <a href="thread.html#19227">[ thread ]</a>
              <a href="subject.html#19227">[ subject ]</a>
              <a href="author.html#19227">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
