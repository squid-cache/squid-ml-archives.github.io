<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] change packet flow to have transparent squid proxy
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20change%20packet%20flow%20to%20have%20transparent%20squid%20proxy&In-Reply-To=%3C454dfcf6ede8584b2275a832cac212dc%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019227.html">
   <LINK REL="Next"  HREF="019229.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] change packet flow to have transparent squid proxy</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20change%20packet%20flow%20to%20have%20transparent%20squid%20proxy&In-Reply-To=%3C454dfcf6ede8584b2275a832cac212dc%40ngtech.co.il%3E"
       TITLE="[squid-users] change packet flow to have transparent squid proxy">eliezer at ngtech.co.il
       </A><BR>
    <I>Sat Sep 15 18:44:33 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019227.html">[squid-users] change packet flow to have transparent squid proxy
</A></li>
        <LI>Next message (by thread): <A HREF="019229.html">[squid-users] TCP_MISS/500
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19228">[ date ]</a>
              <a href="thread.html#19228">[ thread ]</a>
              <a href="subject.html#19228">[ subject ]</a>
              <a href="author.html#19228">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey,

What exactly are you trying to do?
HTTP proxies have their own ACL rules like in a firewall.
If you need to block specific traffic then you should enforce the ACL 
inside the proxy and not rely on the FW.
Adding an external acl helper that will do the same thing as iptables is 
only a matter of minutes of coding.
If you have one example I believe I can try to write some helper that 
will do what you need.

All The Bests,
Eliezer

On 2018-09-15 08:23, morteza omidian wrote:
&gt;<i> Hi
</I>&gt;<i> I am in a dire need about using squid in my Linux iptables firewall as
</I>&gt;<i> a transparent proxy.
</I>&gt;<i> In my linux iptables firewall i want to do iptables rules and controls
</I>&gt;<i> in forward chain and after that do http filtering with squid, because
</I>&gt;<i> of that i need to change netfilter packet flow and send packets to
</I>&gt;<i> squid(app layer, user space) after forward chain, and then get them
</I>&gt;<i> back to kernel space to continue their's way in forward chain and then
</I>&gt;<i> go out, SOMETHING LIKE OTHER FIREWALS AND UTM(like Pfsense or
</I>&gt;<i> opensense and ....) does.
</I>&gt;<i> In my situation, i want squid to place AFTER my FORWARDS iptables
</I>&gt;<i> rules,by default squid is listen on input port of machine but its not
</I>&gt;<i> what i want and redirect packets to the input chain does not work for
</I>&gt;<i> me.
</I>&gt;<i> I think NFQUEUE is a good solution for my problem but i don't know
</I>&gt;<i> that is possible to change squid source code to get packets from
</I>&gt;<i> nfqueue? or does nfqueue can keep the packet state and handle TCP
</I>&gt;<i> connection?
</I>&gt;<i> I want to change My packet flow like this: client-request &gt;&gt;&gt;
</I>&gt;<i> prerouting &gt; Nat &gt; forward &gt; squid-cache &gt; post-routing &gt;&gt;&gt;&gt;
</I>&gt;<i> HTTP(s)-server
</I>&gt;<i> The IMPORTANT part is that forward rules must check before packets
</I>&gt;<i> forwards to squid. i don't want packets destinate to input chain of
</I>&gt;<i> firewall. I thought maybe its possible to use DAQ ,like the way snort
</I>&gt;<i> use or nfqueue in iptables. I need some help about that, please help
</I>&gt;<i> me if its possible or THERE ARE ANY OTHER WAYS TO SOLVE IT.
</I>&gt;<i> 
</I>&gt;<i> Thanks a lot
</I>&gt;<i> Morteza Omidian
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>
-- 
----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019227.html">[squid-users] change packet flow to have transparent squid proxy
</A></li>
	<LI>Next message (by thread): <A HREF="019229.html">[squid-users] TCP_MISS/500
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19228">[ date ]</a>
              <a href="thread.html#19228">[ thread ]</a>
              <a href="subject.html#19228">[ subject ]</a>
              <a href="author.html#19228">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
