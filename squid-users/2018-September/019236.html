<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Help: squid restarts and squidGuard die
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Help%3A%20squid%20restarts%20and%20squidGuard%20die&In-Reply-To=%3CCA%2Bd%3D%3DoEt8J-ie2Fm1SYrHSBKD6Y7TRF-v3iGiMXC7WQ36WV1vw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019244.html">
   <LINK REL="Next"  HREF="019238.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Help: squid restarts and squidGuard die</H1>
    <B>Service MV</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Help%3A%20squid%20restarts%20and%20squidGuard%20die&In-Reply-To=%3CCA%2Bd%3D%3DoEt8J-ie2Fm1SYrHSBKD6Y7TRF-v3iGiMXC7WQ36WV1vw%40mail.gmail.com%3E"
       TITLE="[squid-users] Help: squid restarts and squidGuard die">service.mv at gmail.com
       </A><BR>
    <I>Mon Sep 17 15:37:51 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019244.html">[squid-users] Delay pool not limiting each connection
</A></li>
        <LI>Next message (by thread): <A HREF="019238.html">[squid-users] Help: squid restarts and squidGuard die
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19236">[ date ]</a>
              <a href="thread.html#19236">[ thread ]</a>
              <a href="subject.html#19236">[ subject ]</a>
              <a href="author.html#19236">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Dear Ones, I draw on your experience in seeking help to determine whether
or not it is possible to achieve the configuration I am looking for, due to
a strange error I am having.

Before commenting on the bug I describe my testing environment:
- A VM CentOS 7 Core over VirtualBox 5.2, 1 NIC.
- My VM is attached to my domain W2012R2 (following this post
<A HREF="https://www.rootusers.com/how-to-join-centos-linux-to-an-active-directory-domain/">https://www.rootusers.com/how-to-join-centos-linux-to-an-active-directory-domain/</A>)
to achieve kerberos authentication transparent to the user. SElinux
disabled. Owner permissions to user squid in all folders/files involved.
- squid 3.5.20 installed and working great with kerberos, NTLM and basic
authentication. All authentication mechanisms tested and working great.
- SquidGuard: 1.4 Berkeley DB 5.3.21 installed and working great with
blacklists and acl default.

My problem starts when I try to use source acl using ldapusersearch in
squidGuard...

systemctl status squid:
(squid-1)[12627]: The redirector helpers are crashing too rapidly, need
help!

*squidGuard.conf*

dbhome /etc/squid/db
logdir /var/log/squidGuard
ldapbinddn
CN=ldap,OU=SERVICIOS,OU=SISTEMAS,OU=CANAL,OU=MYCOMPANY,DC=mydomain,DC=local
ldapbindpass myULTRAsecretPASS
ldapprotover 3


src WEB_BASIC {
ldapusersearch
<A HREF="ldap://dc-1.mydomain.local:3268/dc=mydomain,dc=local?sAMAccountName?sub?(&amp;(sAMAccountName=%s">ldap://dc-1.mydomain.local:3268/dc=mydomain,dc=local?sAMAccountName?sub?(&amp;(sAMAccountName=%s</A>)(memberOf=cn=WEB_BASIC%2cou=INTERNET%2cou=PERMISOS%2cou=MYCOMPANY%2cdc=mydomain%2cdc=local))
log block.log
}

dest BL_adv {
        domainlist adv/domains
        urllist adv/urls
        log block.log
}

dest BL_aggressive {
        domainlist aggressive/domains
        urllist aggressive/urls
        log block.log
}
#
dest BL_alcohol {
domainlist alcohol/domains
urllist alcohol/urls
log block.log
}
#
dest BL_anonvpn {
domainlist anonvpn/domains
urllist anonvpn/urls
log block.log
}
#
dest BL_chat {
domainlist chat/domains
urllist chat/urls
log block.log
}
#
dest BL_costtraps {
domainlist costtraps/domains
urllist costtraps/urls
log block.log
}
#
dest BL_downloads {
domainlist downloads/domains
urllist downloads/urls
log block.log
}
#
dest BL_drugs {
domainlist drugs/domains
urllist drugs/urls
log block.log
}
#
dest BL_dynamic {
domainlist dynamic/domains
log block.log
}
#
dest BL_fortunetelling {
domainlist fortunetelling/domains
urllist fortunetelling/urls
log block.log
}
#
dest BL_gamble {
domainlist gamble/domains
urllist gamble/urls
log block.log
}
#
dest BL_government {
domainlist government/domains
urllist government/urls
log block.log
}
#
dest BL_hacking {
domainlist hacking/domains
urllist hacking/urls
log block.log
}
#
dest BL_hobby_games-misc {
domainlist hobby/games-misc/domains
urllist hobby/games-misc/urls
log block.log
}
#
dest BL_hobby_games-online {
domainlist hobby/games-online/domains
urllist hobby/games-online/urls
log block.log
}
#
dest BL_movies {
domainlist movies/domains
urllist movies/urls
log block.log
}
#
dest BL_music {
domainlist music/domains
urllist music/urls
log block.log
}
#
dest BL_porn {
domainlist porn/domains
urllist porn/urls
log block.log
}
#
dest BL_radiotv {
domainlist radiotv/domains
urllist radiotv/urls
log block.log
}
#
dest BL_redirector {
domainlist redirector/domains
urllist redirector/urls
log block.log
}
#
dest BL_remotecontrol {
domainlist remotecontrol/domains
urllist remotecontrol/urls
log block.log
}
#
dest BL_ringtones {
domainlist ringtones/domains
urllist ringtones/urls
log block.log
}
#
dest BL_socialnet {
domainlist socialnet/domains
urllist socialnet/urls
log block.log
}
#
dest BL_spyware {
domainlist spyware/domains
urllist spyware/urls
log block.log
}
#
dest BL_tracker {
domainlist tracker/domains
urllist tracker/urls
log block.log
}
#
dest BL_updatesites {
domainlist updatesites/domains
urllist updatesites/urls
log block.log
}
#
dest BL_violence {
domainlist violence/domains
urllist violence/urls
log block.log
}
#
dest BL_warez {
domainlist warez/domains
urllist warez/urls
log block.log
}
#
dest BL_weapons {
domainlist weapons/domains
urllist weapons/urls
log block.log
}
#
dest BL_webphone {
domainlist webphone/domains
urllist webphone/urls
log block.log
}
#
dest BL_webradio {
domainlist webradio/domains
urllist webradio/urls
log block.log
}
#
dest BL_WEBTV {
domainlist webtv/domains
urllist webtv/urls
log block.log
}


dest whitelist {
domainlist whitelist/domains
log block.log
}

dest blacklist {
domainlist blacklist/domains
log block.log
}


acl {

WEB_BASIC {
pass whitelist !BL_porn !blacklist all
redirect
<A HREF="http://s-server1.mydomain.local/cgi-bin/squidGuard.cgi?clientaddr=%a&amp;clientname=%n&amp;clientuser=%i&amp;clientgroup=%s&amp;targetgroup=%t&amp;url=%u">http://s-server1.mydomain.local/cgi-bin/squidGuard.cgi?clientaddr=%a&amp;clientname=%n&amp;clientuser=%i&amp;clientgroup=%s&amp;targetgroup=%t&amp;url=%u</A>
log block.log
}

default {
pass !blacklist all
redirect
<A HREF="http://s-server1.mydomain.local/cgi-bin/squidGuard.cgi?clientaddr=%a&amp;clientname=%n&amp;clientuser=%i&amp;clientgroup=%s&amp;targetgroup=%t&amp;url=%u">http://s-server1.mydomain.local/cgi-bin/squidGuard.cgi?clientaddr=%a&amp;clientname=%n&amp;clientuser=%i&amp;clientgroup=%s&amp;targetgroup=%t&amp;url=%u</A>
log block.log
}

}


*squidGuard.log*

2018-09-17 11:13:39 [12663] New setting: dbhome: /etc/squid/db
2018-09-17 11:13:39 [12663] New setting: logdir: /var/log/squidGuard
2018-09-17 11:13:39 [12663] New setting: ldapbinddn:
CN=ldap,OU=SERVICIOS,OU=SISTEMAS,OU=CANAL,OU=MYCOMPANY,DC=mydomain,DC=local
2018-09-17 11:13:39 [12663] New setting: ldapbindpass: myULTRAsecretPASS
2018-09-17 11:13:39 [12663] New setting: ldapprotover: 3
2018-09-17 11:13:39 [12663] init domainlist /etc/squid/db/adv/domains
2018-09-17 11:13:39 [12663] loading dbfile /etc/squid/db/adv/domains.db
2018-09-17 11:13:39 [12663] init urllist /etc/squid/db/adv/urls
2018-09-17 11:13:39 [12663] loading dbfile /etc/squid/db/adv/urls.db
2018-09-17 11:13:39 [12663] init domainlist /etc/squid/db/aggressive/domains
2018-09-17 11:13:39 [12663] loading dbfile
/etc/squid/db/aggressive/domains.db
2018-09-17 11:13:39 [12663] init urllist /etc/squid/db/aggressive/urls
2018-09-17 11:13:39 [12663] loading dbfile /etc/squid/db/aggressive/urls.db
2018-09-17 11:13:39 [12663] init domainlist /etc/squid/db/alcohol/domains
2018-09-17 11:13:39 [12663] loading dbfile /etc/squid/db/alcohol/domains.db
2018-09-17 11:13:39 [12663] init urllist /etc/squid/db/alcohol/urls
2018-09-17 11:13:39 [12663] loading dbfile /etc/squid/db/alcohol/urls.db
2018-09-17 11:13:39 [12663] init domainlist /etc/squid/db/anonvpn/domains
2018-09-17 11:13:39 [12663] loading dbfile /etc/squid/db/anonvpn/domains.db
2018-09-17 11:13:39 [12663] init urllist /etc/squid/db/anonvpn/urls
2018-09-17 11:13:39 [12663] loading dbfile /etc/squid/db/anonvpn/urls.db
2018-09-17 11:13:39 [12663] init domainlist /etc/squid/db/chat/domains
2018-09-17 11:13:39 [12663] loading dbfile /etc/squid/db/chat/domains.db
2018-09-17 11:13:39 [12663] init urllist /etc/squid/db/chat/urls
2018-09-17 11:13:39 [12663] loading dbfile /etc/squid/db/chat/urls.db
2018-09-17 11:13:39 [12663] init domainlist /etc/squid/db/costtraps/domains
2018-09-17 11:13:39 [12663] loading dbfile
/etc/squid/db/costtraps/domains.db
2018-09-17 11:13:39 [12663] init urllist /etc/squid/db/costtraps/urls
2018-09-17 11:13:39 [12663] loading dbfile /etc/squid/db/costtraps/urls.db
2018-09-17 11:13:39 [12663] init domainlist /etc/squid/db/downloads/domains
2018-09-17 11:13:39 [12663] loading dbfile
/etc/squid/db/downloads/domains.db
2018-09-17 11:13:39 [12663] init urllist /etc/squid/db/downloads/urls
2018-09-17 11:13:39 [12663] loading dbfile /etc/squid/db/downloads/urls.db
2018-09-17 11:13:39 [12663] init domainlist /etc/squid/db/drugs/domains
2018-09-17 11:13:39 [12663] loading dbfile /etc/squid/db/drugs/domains.db
2018-09-17 11:13:39 [12663] init urllist /etc/squid/db/drugs/urls
2018-09-17 11:13:39 [12663] loading dbfile /etc/squid/db/drugs/urls.db
2018-09-17 11:13:39 [12663] init domainlist /etc/squid/db/dynamic/domains
2018-09-17 11:13:39 [12663] loading dbfile /etc/squid/db/dynamic/domains.db
2018-09-17 11:13:39 [12663] init domainlist
/etc/squid/db/fortunetelling/domains
2018-09-17 11:13:39 [12663] loading dbfile
/etc/squid/db/fortunetelling/domains.db
2018-09-17 11:13:39 [12663] init urllist /etc/squid/db/fortunetelling/urls
2018-09-17 11:13:39 [12663] loading dbfile
/etc/squid/db/fortunetelling/urls.db
2018-09-17 11:13:39 [12663] init domainlist /etc/squid/db/gamble/domains
2018-09-17 11:13:39 [12663] loading dbfile /etc/squid/db/gamble/domains.db
2018-09-17 11:13:39 [12663] init urllist /etc/squid/db/gamble/urls
2018-09-17 11:13:39 [12663] loading dbfile /etc/squid/db/gamble/urls.db
2018-09-17 11:13:39 [12663] init domainlist /etc/squid/db/government/domains
2018-09-17 11:13:39 [12663] loading dbfile
/etc/squid/db/government/domains.db
2018-09-17 11:13:39 [12663] init urllist /etc/squid/db/government/urls
2018-09-17 11:13:39 [12663] loading dbfile /etc/squid/db/government/urls.db
2018-09-17 11:13:39 [12663] init domainlist /etc/squid/db/hacking/domains
2018-09-17 11:13:39 [12663] loading dbfile /etc/squid/db/hacking/domains.db
2018-09-17 11:13:39 [12663] init urllist /etc/squid/db/hacking/urls
2018-09-17 11:13:39 [12663] loading dbfile /etc/squid/db/hacking/urls.db
2018-09-17 11:13:39 [12663] init domainlist
/etc/squid/db/hobby/games-misc/domains
2018-09-17 11:13:39 [12663] loading dbfile
/etc/squid/db/hobby/games-misc/domains.db
2018-09-17 11:13:39 [12663] init urllist /etc/squid/db/hobby/games-misc/urls
2018-09-17 11:13:39 [12663] loading dbfile
/etc/squid/db/hobby/games-misc/urls.db
2018-09-17 11:13:39 [12663] init domainlist
/etc/squid/db/hobby/games-online/domains
2018-09-17 11:13:39 [12663] loading dbfile
/etc/squid/db/hobby/games-online/domains.db
2018-09-17 11:13:39 [12663] init urllist
/etc/squid/db/hobby/games-online/urls
2018-09-17 11:13:39 [12663] loading dbfile
/etc/squid/db/hobby/games-online/urls.db
2018-09-17 11:13:39 [12663] init domainlist /etc/squid/db/movies/domains
2018-09-17 11:13:39 [12663] loading dbfile /etc/squid/db/movies/domains.db
2018-09-17 11:13:39 [12663] init urllist /etc/squid/db/movies/urls
2018-09-17 11:13:39 [12663] loading dbfile /etc/squid/db/movies/urls.db
2018-09-17 11:13:39 [12663] init domainlist /etc/squid/db/music/domains
2018-09-17 11:13:39 [12663] loading dbfile /etc/squid/db/music/domains.db
2018-09-17 11:13:39 [12663] init urllist /etc/squid/db/music/urls
2018-09-17 11:13:39 [12663] loading dbfile /etc/squid/db/music/urls.db
2018-09-17 11:13:39 [12663] init domainlist /etc/squid/db/porn/domains
2018-09-17 11:13:39 [12663] loading dbfile /etc/squid/db/porn/domains.db
2018-09-17 11:13:39 [12663] init urllist /etc/squid/db/porn/urls
2018-09-17 11:13:39 [12663] loading dbfile /etc/squid/db/porn/urls.db
2018-09-17 11:13:39 [12663] init domainlist /etc/squid/db/radiotv/domains
2018-09-17 11:13:39 [12663] loading dbfile /etc/squid/db/radiotv/domains.db
2018-09-17 11:13:39 [12663] init urllist /etc/squid/db/radiotv/urls
2018-09-17 11:13:39 [12663] loading dbfile /etc/squid/db/radiotv/urls.db
2018-09-17 11:13:39 [12663] init domainlist /etc/squid/db/redirector/domains
2018-09-17 11:13:39 [12663] loading dbfile
/etc/squid/db/redirector/domains.db
2018-09-17 11:13:39 [12663] init urllist /etc/squid/db/redirector/urls
2018-09-17 11:13:39 [12663] loading dbfile /etc/squid/db/redirector/urls.db
2018-09-17 11:13:39 [12663] init domainlist
/etc/squid/db/remotecontrol/domains
2018-09-17 11:13:39 [12663] loading dbfile
/etc/squid/db/remotecontrol/domains.db
2018-09-17 11:13:39 [12663] init urllist /etc/squid/db/remotecontrol/urls
2018-09-17 11:13:39 [12663] loading dbfile
/etc/squid/db/remotecontrol/urls.db
2018-09-17 11:13:39 [12663] init domainlist /etc/squid/db/ringtones/domains
2018-09-17 11:13:39 [12663] loading dbfile
/etc/squid/db/ringtones/domains.db
2018-09-17 11:13:39 [12663] init urllist /etc/squid/db/ringtones/urls
2018-09-17 11:13:39 [12663] loading dbfile /etc/squid/db/ringtones/urls.db
2018-09-17 11:13:39 [12663] init domainlist /etc/squid/db/socialnet/domains
2018-09-17 11:13:39 [12663] loading dbfile
/etc/squid/db/socialnet/domains.db
2018-09-17 11:13:39 [12663] init urllist /etc/squid/db/socialnet/urls
2018-09-17 11:13:39 [12663] loading dbfile /etc/squid/db/socialnet/urls.db
2018-09-17 11:13:39 [12663] init domainlist /etc/squid/db/spyware/domains
2018-09-17 11:13:39 [12663] loading dbfile /etc/squid/db/spyware/domains.db
2018-09-17 11:13:39 [12663] init urllist /etc/squid/db/spyware/urls
2018-09-17 11:13:39 [12663] loading dbfile /etc/squid/db/spyware/urls.db
2018-09-17 11:13:39 [12663] init domainlist /etc/squid/db/tracker/domains
2018-09-17 11:13:39 [12663] loading dbfile /etc/squid/db/tracker/domains.db
2018-09-17 11:13:39 [12663] init urllist /etc/squid/db/tracker/urls
2018-09-17 11:13:39 [12663] loading dbfile /etc/squid/db/tracker/urls.db
2018-09-17 11:13:39 [12663] init domainlist
/etc/squid/db/updatesites/domains
2018-09-17 11:13:39 [12663] loading dbfile
/etc/squid/db/updatesites/domains.db
2018-09-17 11:13:39 [12663] init urllist /etc/squid/db/updatesites/urls
2018-09-17 11:13:39 [12663] loading dbfile /etc/squid/db/updatesites/urls.db
2018-09-17 11:13:39 [12663] init domainlist /etc/squid/db/violence/domains
2018-09-17 11:13:39 [12663] loading dbfile /etc/squid/db/violence/domains.db
2018-09-17 11:13:39 [12663] init urllist /etc/squid/db/violence/urls
2018-09-17 11:13:39 [12663] loading dbfile /etc/squid/db/violence/urls.db
2018-09-17 11:13:39 [12663] init domainlist /etc/squid/db/warez/domains
2018-09-17 11:13:39 [12663] loading dbfile /etc/squid/db/warez/domains.db
2018-09-17 11:13:39 [12663] init urllist /etc/squid/db/warez/urls
2018-09-17 11:13:39 [12663] loading dbfile /etc/squid/db/warez/urls.db
2018-09-17 11:13:39 [12663] init domainlist /etc/squid/db/weapons/domains
2018-09-17 11:13:39 [12663] loading dbfile /etc/squid/db/weapons/domains.db
2018-09-17 11:13:39 [12663] init urllist /etc/squid/db/weapons/urls
2018-09-17 11:13:39 [12663] loading dbfile /etc/squid/db/weapons/urls.db
2018-09-17 11:13:39 [12663] init domainlist /etc/squid/db/webphone/domains
2018-09-17 11:13:39 [12663] loading dbfile /etc/squid/db/webphone/domains.db
2018-09-17 11:13:39 [12663] init urllist /etc/squid/db/webphone/urls
2018-09-17 11:13:39 [12663] loading dbfile /etc/squid/db/webphone/urls.db
2018-09-17 11:13:39 [12663] init domainlist /etc/squid/db/webradio/domains
2018-09-17 11:13:39 [12663] loading dbfile /etc/squid/db/webradio/domains.db
2018-09-17 11:13:39 [12663] init urllist /etc/squid/db/webradio/urls
2018-09-17 11:13:39 [12663] loading dbfile /etc/squid/db/webradio/urls.db
2018-09-17 11:13:39 [12663] init domainlist /etc/squid/db/webtv/domains
2018-09-17 11:13:39 [12663] loading dbfile /etc/squid/db/webtv/domains.db
2018-09-17 11:13:39 [12663] init urllist /etc/squid/db/webtv/urls
2018-09-17 11:13:39 [12663] loading dbfile /etc/squid/db/webtv/urls.db
2018-09-17 11:13:39 [12663] init domainlist /etc/squid/db/whitelist/domains
2018-09-17 11:13:39 [12663] loading dbfile
/etc/squid/db/whitelist/domains.db
2018-09-17 11:13:39 [12663] init domainlist /etc/squid/db/blacklist/domains
2018-09-17 11:13:39 [12663] loading dbfile
/etc/squid/db/blacklist/domains.db
2018-09-17 11:13:39 [12663] logfile not allowed in acl other than default
2018-09-17 11:13:39 [12663] squidGuard 1.4 started (1537193619.900)
2018-09-17 11:13:39 [12663] squidGuard ready for requests (1537193619.903)

*squid.conf*

acl localnet src 10.10.8.0/22   # LAN net
acl dmz src 192.168.20.0/27     # DMZ net

### negotiate kerberos &amp; ntlm authentication
auth_param negotiate program /usr/sbin/negotiate_wrapper --ntlm
/usr/bin/ntlm_auth --helper-protocol=squid-2.5-ntlmssp --kerberos
/usr/lib64/squid/negotiate_kerberos_auth -r -i -s GSS_C_NO_NAME
auth_param negotiate children 10
auth_param negotiate keep_alive on

### basic authentication for not kerberos or ntlm authenticated users
auth_param basic program /usr/lib64/squid/basic_ldap_auth -R -b
&quot;dc=mydomain,dc=local&quot; -D &quot;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">ldap at mydomain.local</A>&quot; -w &quot; myULTRAsecretPASS  &quot;
-f sAMAccountName=%s -h dc-1.mydomain.local
auth_param basic children 10
auth_param basic realm Identifiquese
auth_param basic credentialsttl 4 hours

### standard allowed ports
acl SSL_ports port 443
acl Safe_ports port 80 # http
acl Safe_ports port 21 # ftp
acl Safe_ports port 443 # https
acl Safe_ports port 70 # gopher
acl Safe_ports port 210 # wais
acl Safe_ports port 1025-65535 # unregistered ports
acl Safe_ports port 280 # http-mgmt
acl Safe_ports port 488 # gss-http
acl Safe_ports port 591 # filemaker
acl Safe_ports port 777 # multiling http
acl CONNECT method CONNECT

### acl for proxy authentication (kerberos or ntlm) and ldap authorizations
acl auth proxy_auth REQUIRED

# Define protocols used for redirects
acl HTTP proto HTTP
acl HTTPS proto HTTPS

### enforce authentication
http_access allow auth
http_access deny !auth

### standard access rules
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow localhost manager
http_access deny manager
http_access allow localnet
http_access allow dmz
http_access allow localhost
http_access deny all

### OPCIONES VARIAS ###
http_port 8080
coredump_dir /var/spool/squid
refresh_pattern ^ftp: 1440 20% 10080
refresh_pattern ^gopher: 1440 0% 1440
refresh_pattern -i (/cgi-bin/|\?) 0 0% 0
refresh_pattern .  0 20% 4320
quick_abort_min 0 KB
quick_abort_max 0 KB
read_timeout 5 minutes
request_timeout 3 minutes
half_closed_clients off
shutdown_lifetime 15 seconds
log_icp_queries off
dns_v4_first on
ipcache_size 2048
ipcache_low 90
fqdncache_size 4096
forwarded_for off
cache_mgr <A HREF="https://lists.squid-cache.org/listinfo/squid-users">sistemas at mydomain.com</A>
visible_hostname eren
httpd_suppress_version_string on
uri_whitespace strip


## squidGuard ##
url_rewrite_program /usr/bin/squidGuard -c /etc/squid/squidGuard.conf
url_rewrite_children 10 startup=5 idle=1 concurrency=0
url_rewrite_bypass off


*cache.log*

Squid Cache (Version 3.5.20): Terminated abnormally.
CPU Usage: 0.070 seconds = 0.055 user + 0.015 sys
Maximum Resident Size: 68768 KB
Page faults with physical i/o: 0
2018/09/17 11:13:36 kid1| Starting Squid Cache version 3.5.20 for
x86_64-redhat-linux-gnu...
2018/09/17 11:13:36 kid1| Service Name: squid
2018/09/17 11:13:36 kid1| Starting new negotiateauthenticator helpers...
2018/09/17 11:13:36 kid1| Starting new negotiateauthenticator helpers...
2018/09/17 11:13:36| negotiate_kerberos_auth: INFO: User my.name
authenticated
2018/09/17 11:13:36 kid1| WARNING: redirector #Hlpr1 exited
FATAL: The redirector helpers are crashing too rapidly, need help!

Squid Cache (Version 3.5.20): Terminated abnormally.
CPU Usage: 0.086 seconds = 0.057 user + 0.029 sys
Maximum Resident Size: 68752 KB
Page faults with physical i/o: 0
2018/09/17 11:13:36| negotiate_kerberos_auth: INFO: User my.name
authenticated
2018/09/17 11:13:39 kid1| Starting Squid Cache version 3.5.20 for
x86_64-redhat-linux-gnu...
2018/09/17 11:13:39 kid1| Service Name: squid

*access.log*

1537193586.999      0 10.10.11.154 TCP_DENIED/407 4137 CONNECT
www.google.com.ar:443 - HIER_NONE/- text/html
1537193587.242      0 10.10.11.154 TCP_DENIED/407 4185 CONNECT
clientservices.googleapis.com:443 - HIER_NONE/- text/html
1537193587.269      0 10.10.11.154 TCP_DENIED/407 4145 CONNECT
accounts.google.com:443 - HIER_NONE/- text/html
1537193587.269      0 10.10.11.154 TCP_DENIED/407 4137 CONNECT
www.google.com.ar:443 - HIER_NONE/- text/html
1537193613.322      0 10.10.11.154 TCP_DENIED/407 4185 CONNECT
clientservices.googleapis.com:443 - HIER_NONE/- text/html
1537193616.653      1 10.10.11.154 TCP_DENIED/407 4125 CONNECT
www.clarin.com:443 - HIER_NONE/- text/html
1537193616.732      0 10.10.11.154 TCP_DENIED/407 4145 CONNECT
accounts.google.com:443 - HIER_NONE/- text/html
1537193616.749      1 10.10.11.154 TCP_DENIED/407 4137 CONNECT
www.google.com.ar:443 - HIER_NONE/- text/html

*messages*

Sep 17 11:13:07 proxy kernel: squidGuard[12552]: segfault at
ffffffffd7706bb0 ip 00007fdbf2052e70 sp 00007fffd1b73c70 error 5 in
libldap-2.4.so.2.10.7[7fdbf2027000+52000]
Sep 17 11:13:07 proxy kernel: squidGuard[12553]: segfault at
ffffffffa3d27bb0 ip 00007fd79b787e70 sp 00007ffe47e9b880 error 5 in
libldap-2.4.so.2.10.7[7fd79b75c000+52000]
Sep 17 11:13:07 proxy (squid-1): The redirector helpers are crashing too
rapidly, need help!
Sep 17 11:13:07 proxy squid[12549]: Squid Parent: (squid-1) process 12551
exited with status 1
Sep 17 11:13:10 proxy squid[12549]: Squid Parent: (squid-1) process 12627
started
Sep 17 11:13:33 proxy kernel: squidGuard[12628]: segfault at 1fbd2bb0 ip
00007f452b305e70 sp 00007ffda8c714b0 error 4 in
libldap-2.4.so.2.10.7[7f452b2da000+52000]
Sep 17 11:13:33 proxy (squid-1): The redirector helpers are crashing too
rapidly, need help!
Sep 17 11:13:33 proxy squid[12549]: Squid Parent: (squid-1) process 12627
exited with status 1
Sep 17 11:13:36 proxy squid[12549]: Squid Parent: (squid-1) process 12643
started
Sep 17 11:13:36 proxy kernel: squidGuard[12644]: segfault at 540fdbb0 ip
00007fab84f2de70 sp 00007ffc1aa8d2a0 error 4 in
libldap-2.4.so.2.10.7[7fab84f02000+52000]
Sep 17 11:13:36 proxy (squid-1): The redirector helpers are crashing too
rapidly, need help!
Sep 17 11:13:36 proxy squid[12549]: Squid Parent: (squid-1) process 12643
exited with status 1
Sep 17 11:13:39 proxy squid[12549]: Squid Parent: (squid-1) process 12658
started


If I disable src and acl WEB_BASIC I have no problem. The default acl does
its thing without problems.
But when I enable src and acl WEB_BASIC squidGuard explodes and squid
restarts so I get to notice.
I see an error in a libldap library... Will it be a library error? Or am I
misconfiguring my squid ?

Just in case I've checked more than ten times the URLs of LDAP queries (,
%2c, etc etc)

Thank you very much for any help you can give me.
Best regards

Gabriel
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20180917/0ebaf05c/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20180917/0ebaf05c/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019244.html">[squid-users] Delay pool not limiting each connection
</A></li>
	<LI>Next message (by thread): <A HREF="019238.html">[squid-users] Help: squid restarts and squidGuard die
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19236">[ date ]</a>
              <a href="thread.html#19236">[ thread ]</a>
              <a href="subject.html#19236">[ subject ]</a>
              <a href="author.html#19236">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
