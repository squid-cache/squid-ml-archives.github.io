<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] About SSL peek-n-splice/bump configurations
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20About%20SSL%20peek-n-splice/bump%20configurations&In-Reply-To=%3C8c393e26-822f-ddea-50d4-9f80ebc9087f%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019250.html">
   <LINK REL="Next"  HREF="019257.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] About SSL peek-n-splice/bump configurations</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20About%20SSL%20peek-n-splice/bump%20configurations&In-Reply-To=%3C8c393e26-822f-ddea-50d4-9f80ebc9087f%40measurement-factory.com%3E"
       TITLE="[squid-users] About SSL peek-n-splice/bump configurations">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Sep 18 16:36:10 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019250.html">[squid-users] About SSL peek-n-splice/bump configurations
</A></li>
        <LI>Next message (by thread): <A HREF="019257.html">[squid-users] About SSL peek-n-splice/bump configurations
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19251">[ date ]</a>
              <a href="thread.html#19251">[ thread ]</a>
              <a href="subject.html#19251">[ subject ]</a>
              <a href="author.html#19251">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 09/18/2018 09:11 AM, Julian Perconti wrote:
&gt;&gt;&gt;<i> the thing that really does not makes sense is splice at step1 and then splice
</I>&gt;&gt;&gt;<i> at step2
</I>
&gt;&gt;<i> It is not possible to splice twice. Splicing is one of the final actions. No other
</I>&gt;&gt;<i> action follows a final action (by definition).
</I>
&gt;<i> So, if a rule &quot;x&quot; match a splice action at inner loop when the outer
</I>&gt;<i> loop starts, then take the final action for the rule &quot;x&quot; and if no
</I>&gt;<i> there is no more rules at step1 exit and proceed to evaluate the
</I>&gt;<i> rules for the step2.
</I>
I think it is possible to interpret your summary as a correct statement,
but the reality is much simpler: After a splice rule is applied, SslBump
is over. No more rules are checked. No more loops are iterated. Squid
simply &quot;exits&quot; the SslBump feature (and becomes a TCP tunnel).


&gt;&gt;&gt;<i>    ssl_bump peek noBumpSites
</I>&gt;&gt;&gt;<i>    ssl_bump stare
</I>

&gt;&gt;<i> At step1 and at step2, if noBumpSites matches, then Squid will peek.
</I>
&gt;<i> Therefore default splice...
</I>
If noBumpSites matches at step2, then, yes, Squid will splice at step3
by default. Otherwise, no; Squid will bump at step3 by default.


&gt;&gt;<i> At step1 and at step2, if noBumpSites does not match, then Squid will stare.
</I>
&gt;<i> ...and default bump.
</I>
If noBumpSites does not match at step2, then, yes, Squid will bump at
step3 by default. Otherwise, no; Squid will splice at step3 by default.


&gt;<i>   ssl_bump splice noBumpSites # This line reachs a splice rule at step1
</I>&gt;<i>   ssl_bump stare
</I>
&gt;<i> Squid is telling to the client: &quot;I will not touch any TLS byte. [...]
</I>&gt;<i> I will do as many checks as possible then You will be connected...&quot;
</I>
The configuration above does not match your summary because the
configuration has a &quot;stare&quot; action that may run at (step1 and) step2
(and, hence, a possibility of the bump action at step3). Staring at
step2 and bumping (at any step) modify TLS bytes, of course.

Perhaps your summary only applies to the cases where noBumpSites matches
(either at step1 or at step2), but the summary did not make that clear.
There is a big difference between explaining Squid actions for a
particular transaction and summarizing what a particular configuration
means (for all transactions). Unless noted otherwise, I am focusing on
the latter.

AFAICT, the primary difference between

  ssl_bump peek noBumpSites
  ssl_bump stare

and

  ssl_bump splice noBumpSites
  ssl_bump stare

is that the former requires a noBumpSites match at step2 for the
connections to be spliced. The latter does not require that; it is even
content with splicing based on step1 (i.e. TCP/IP) info, before knowing
step2 (i.e. the TLS client) details. You can see those differences when,
for example, noBumpSites does not match at step1.

The other differences include whether the TLS client- and
server-provided information is checked and logged in all cases or just
in some cases.

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019250.html">[squid-users] About SSL peek-n-splice/bump configurations
</A></li>
	<LI>Next message (by thread): <A HREF="019257.html">[squid-users] About SSL peek-n-splice/bump configurations
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19251">[ date ]</a>
              <a href="thread.html#19251">[ thread ]</a>
              <a href="subject.html#19251">[ subject ]</a>
              <a href="author.html#19251">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
