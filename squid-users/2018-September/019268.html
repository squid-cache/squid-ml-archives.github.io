<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Help: squid restarts and squidGuard die
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Help%3A%20squid%20restarts%20and%20squidGuard%20die&In-Reply-To=%3Cf926b42a-42eb-9497-8064-b1d87b82e7fb%40urlfilterdb.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019266.html">
   <LINK REL="Next"  HREF="019272.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Help: squid restarts and squidGuard die</H1>
    <B>Marcus Kool</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Help%3A%20squid%20restarts%20and%20squidGuard%20die&In-Reply-To=%3Cf926b42a-42eb-9497-8064-b1d87b82e7fb%40urlfilterdb.com%3E"
       TITLE="[squid-users] Help: squid restarts and squidGuard die">marcus.kool at urlfilterdb.com
       </A><BR>
    <I>Thu Sep 20 15:46:56 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019266.html">[squid-users] Help: squid restarts and squidGuard die
</A></li>
        <LI>Next message (by thread): <A HREF="019272.html">[squid-users] Help: squid restarts and squidGuard die
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19268">[ date ]</a>
              <a href="thread.html#19268">[ thread ]</a>
              <a href="subject.html#19268">[ subject ]</a>
              <a href="author.html#19268">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

On 20/09/18 08:46, Amos Jeffries wrote:
&gt;<i> On 19/09/18 11:49 PM, Marcus Kool wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On 18/09/18 23:03, Amos Jeffries wrote:
</I>&gt;&gt;&gt;<i> On 19/09/18 1:54 AM, neok wrote:
</I>&gt;&gt;&gt;&gt;<i> Thank you very much Amos for putting me in the right direction.
</I>&gt;&gt;&gt;&gt;<i> I successfully carried out the modifications you indicated to me.
</I>&gt;&gt;&gt;&gt;<i> Regarding ufdbGuard, if I understood correctly, what you recommend is
</I>&gt;&gt;&gt;&gt;<i> to use
</I>&gt;&gt;&gt;&gt;<i> the ufdbConvertDB tool to convert my blacklists in plain text to the
</I>&gt;&gt;&gt;&gt;<i> ufdbGuard database format? And then use that/those databases in
</I>&gt;&gt;&gt;&gt;<i> normal squid
</I>&gt;&gt;&gt;&gt;<i> ACL's?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> No, ufdbguard is a fork of SquidGuard that can be used as a drop-in
</I>&gt;&gt;&gt;<i> replacement which works better while you improve your config.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> You should work towards less complexity. Squid / squid.conf is where
</I>&gt;&gt;&gt;<i> HTTP access control takes place. The helper is about re-writing the URL
</I>&gt;&gt;&gt;<i> (only) - which is a complex and destructive process.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ufdbGuard is a simple tool that has the same syntax in its configuration
</I>&gt;&gt;<i> file as squidGuard has.
</I>&gt;&gt;<i> It is far from complex, has a great Reference Manual, exmaple config
</I>&gt;&gt;<i> file and a responsive support desk.
</I>&gt;&gt;<i> Amos, I have never seen you calling a URL writer being a complex and
</I>&gt;&gt;<i> destructive process.&#160; What do you mean?
</I>&gt;<i> 
</I>&gt;<i> Re-writing requires Squid to:
</I>&gt;<i>   * fork external helpers, and
</I>&gt;<i>   * maintain queues of lookups to those helpers, and
</I>&gt;<i>   * maintain cache of helper responses, and
</I>&gt;<i>   * maintain a whole extra copy of HTTP-request state, and
</I>&gt;<i>   * copy some (not all) of that state info between the two &quot;client&quot; requests.
</I>&gt;<i> 
</I>&gt;<i>   ... lots of complexity, memory, CPU time, traffic latency, etc.
</I>
Squid itself is complex and for any feature of Squid one can make a list like above to say that it is complex.
The fact that one can make such a list does not mean much to me.
One can make the same or a similar list for external acl helpers and even native acls.

&gt;<i> Also when used for access control (re-write to an &quot;error&quot; URL) the
</I>&gt;<i> re-write helper needs extra complexity in itself to act as the altered
</I>&gt;<i> origin server for error pages, or have some fourth-party web server.
</I>
Squid cannot do everything that a URL writer, and specifically ufdbGuard, can.
For example, Squid must restart and break all open connections when a tiny detail of the configuration changes.  With ufdbGuard this does not happen.
ufdbGuard supports dynamic lists of users, domains and source ip addresses which are updated every X minutes without any service interruption.
When other parameters change, ufdbGuard resets itself with zero service interruption for Squid and its users.
ufdbGuard can decide to probe a site to make a decision, and hence detect Skype, Teamviewer and other types of sites that an admin might want to block.  Squid cannot.
ufdbGuard can decide to do a lookup of a reverse IP lookup to make a decision.  Squid cannot.
ufdbGuard supports complex time restrictions for access. Squid support simple time restrictions.
ufdbGuard supports flat file domain/url lists and a commercial URL database.  Squid does not.
And the list goes on.

So when you state on the mailing list that users should unconditionally stop using a URL writer in favor of using Squid acls, you may be causing troubles for admins who do not know the implications of 
your advice.


&gt;&gt;<i> URL rewriters have been used for decades for HTTP access control but you
</I>&gt;&gt;<i> state &quot;squid.conf is where HTTP access control takes place&quot;.
</I>&gt;<i> 
</I>&gt;<i> Once upon a time, back at the dawn of the WWW (before the 1990s) Squid
</I>&gt;<i> lacked external_acl_type and modular ACLs.
</I>&gt;<i> 
</I>&gt;<i> That persisted for the first decade or so of Squid's life, with only the
</I>&gt;<i> re-write API for admin to use for complicated permissions.
</I>&gt;<i> 
</I>&gt;<i> Then one day about 2 decades or so ago, external ACL was added and the
</I>&gt;<i> ACLs were also made much easier to implement and plug in new checks.
</I>&gt;<i> Today we have hundreds of native ACLs and even a selection of custom ACL
</I>&gt;<i> helpers. Making the need for these abuses of the poor re-writers.
</I>&gt;<i> 
</I>&gt;<i> Old habits and online tutorials however are hard to get rid of.
</I>
If you want to get rid of habits that in your view are old/obsolete, then why not start a discussion?
And in the event that at the end of the discussion, the decision is made that a particular interface should be removed, why not phase it out ?

&gt;&gt;<i> Are you saying that you want it is the _only_ place for HTTP access
</I>&gt;&gt;<i> control?
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> I'm saying the purpose of the url_rewrite_* API in Squid is to tell
</I>&gt;<i> Squid whether the URL (only) needs some mangling in order for the
</I>&gt;<i> server/origin to understand it.
</I>&gt;<i>   It can re-write transparently with all the problems that causes to
</I>&gt;<i> security scopes and URL sync between the endpoints. Or redirect the
</I>&gt;<i> client to the &quot;correct&quot; URL.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> The Squid http_access and similar *access controls* are the place for
</I>&gt;<i> access control - hint is in the naming. With external ACL type for
</I>&gt;<i> anything Squid does not support natively or well. As Flashdown mentioned
</I>&gt;<i> even calls to SquidGuard etc. can be wrapped and used as external ACLs.
</I>
Wrapping and externals ACLs adds the same complexity, memory, CPU time, traffic latency, etc that you use as an argument against a URL writer.
Is it only because of the name, 'external acl helper' vs 'url rewriter helper', that you dislike the url rewriter?

Marcus

&gt;<i> 
</I>&gt;<i> Amos
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019266.html">[squid-users] Help: squid restarts and squidGuard die
</A></li>
	<LI>Next message (by thread): <A HREF="019272.html">[squid-users] Help: squid restarts and squidGuard die
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19268">[ date ]</a>
              <a href="thread.html#19268">[ thread ]</a>
              <a href="subject.html#19268">[ subject ]</a>
              <a href="author.html#19268">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
