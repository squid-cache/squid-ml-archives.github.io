<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] About SSL peek-n-splice/bump configurations
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20About%20SSL%20peek-n-splice/bump%20configurations&In-Reply-To=%3C80b536df-407d-76b4-bc35-2fdc1524b064%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019289.html">
   <LINK REL="Next"  HREF="019302.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] About SSL peek-n-splice/bump configurations</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20About%20SSL%20peek-n-splice/bump%20configurations&In-Reply-To=%3C80b536df-407d-76b4-bc35-2fdc1524b064%40measurement-factory.com%3E"
       TITLE="[squid-users] About SSL peek-n-splice/bump configurations">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Sep 25 21:40:31 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019289.html">[squid-users] About SSL peek-n-splice/bump configurations
</A></li>
        <LI>Next message (by thread): <A HREF="019302.html">[squid-users] About SSL peek-n-splice/bump configurations
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19301">[ date ]</a>
              <a href="thread.html#19301">[ thread ]</a>
              <a href="subject.html#19301">[ subject ]</a>
              <a href="author.html#19301">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 09/22/2018 10:40 AM, Julian Perconti wrote:
&gt;&gt;&gt;<i> # Second rule:
</I>&gt;&gt;&gt;<i> ssl_bump splice noBumpSites
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I think that this rule should implicity match only at step2.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I do not know what &quot;implicitly match&quot; means here, but yes, the splice rule
</I>&gt;&gt;<i> may only match at step2 in this configuration:
</I>
&gt;<i> When I say &quot;implicit&quot; I want to mean that there is no any step specified in the rule.
</I>
Understood. Please avoid that word usage. In this context, implicit
means &quot;without being configured&quot; or &quot;by default&quot;. One could say that
&quot;default rules implicitly match&quot;, or that &quot;a rule without any ACLs
matches implicitly&quot;, but one cannot say that &quot;rule X containing ACL Y
implicitly matched&quot;.


&gt;&gt;<i> * It cannot match at step3 because for a splice rule to match at step3 a peek
</I>&gt;&gt;<i> rule has to match at step2, and there is no peek rule that can match at step2
</I>&gt;&gt;<i> in your configuration.
</I>
&gt;<i> Althought there is no any peek rule at step2, in the second rule a
</I>&gt;<i> final action is applied to noBumpSites (if match)
</I>
Final actions at step2 do not matter when we are talking about what
happens at step3. If a final action is applied at step2, there is no
step3 as far as an ssl_bump configuration is concerned.


&gt;<i> In fact, in case that (for any reason) the 2nd rule can not match,
</I>&gt;<i> there is a explicit stare rule at step2.
</I>
Yes, and it will be applied, and it is not a peek rule, so this applied
staring action will prevent splicing at step3.


&gt;<i> So, I think that its almost impossible that splice at step3 happens
</I>&gt;<i> in this configuration for the noBumpSites.
</I>
It is impossible for any transaction to be spliced at step3 with this
configuration. Whether the transaction matches or does not match
noBumpSites at any given step is irrelevant for this statement.


&gt;<i> In the worst of the cases, if at rule #2 no match, then noBumpSites
</I>&gt;<i> will be bumped, due to stare at step2.
</I>
Correct. There is nothing &quot;worse&quot; about this case though.


&gt;&gt;&gt;<i> In that case is clear &quot;splice is a final action&quot; then no more future checks.
</I>
&gt;&gt;<i> The notion of a &quot;final&quot; action does not depend on rule ACLs.
</I>
&gt;<i> Here is where I your explanation breaks my head. Here is the most
</I>&gt;<i> important confusion of all of my own other
</I>&gt;<i> confusions/misunderstanding.
</I>
Final actions are &quot;bump&quot;, &quot;terminate&quot;, and &quot;splice&quot;. As you can easily
see, this statement does not depend on ACLs.

An action is either final or not, by that action nature/definition. ACLs
are one of the precondition for applying an action, but ACLs do not
affect action &quot;finality&quot;.


&gt;<i> In the config I posted, there is a splice action in the middle, and
</I>&gt;<i> only the &quot;noBumpSites&quot; are spliced
</I>
Yes.


&gt;<i> And even with the splice action as second rule, the 3rd rule is
</I>&gt;<i> processed (Squid is still processing rules after splice noBumpSites
</I>&gt;<i> ACL).
</I>
An action presence in the rules does not, on its own, stop Squid from
processing lower rules. *Applying* a final action does.


&gt;<i> It is checked
</I>
Yes, it is checked at stepN when the previous rules do not match at (or
are not applicable to) that step.


&gt;<i>    ssl_bump splice noBumpSites = ssl_bump splice noBumpSites all.
</I>
Yes. Adding &quot;and true&quot; to any logical condition does not change that
condition. However, I fear that the above correct equivalence does not
mean what you think it means. It means there is no point in adding
&quot;all&quot;. It does not mean that adding &quot;all&quot; changes the meaning of that
ssl_bump rule or of what you are saying.


&gt;&gt;<i> After Squid applies the &quot;splice&quot; action (in whatever context, for whatever reason),
</I>&gt;&gt;<i> SslBump processing for that transaction is over. Same for &quot;bump&quot; and
</I>&gt;&gt;<i> &quot;terminate&quot; actions.
</I>
&gt;<i> What do You exactly mean with &quot;for that transaction&quot;? Maybe that rule?
</I>
No, I do not mean &quot;that rule&quot;. In this context, &quot;transaction&quot; is,
roughly speaking, an &quot;HTTP CONNECT request&quot; or &quot;TLS connection&quot;. An
applied final action stops all ssl_bump processing for the corresponding
transaction/request/connection, and not just one ssl_bump rule
processing. That difference is why those actions are called &quot;final&quot;.

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019289.html">[squid-users] About SSL peek-n-splice/bump configurations
</A></li>
	<LI>Next message (by thread): <A HREF="019302.html">[squid-users] About SSL peek-n-splice/bump configurations
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19301">[ date ]</a>
              <a href="thread.html#19301">[ thread ]</a>
              <a href="subject.html#19301">[ subject ]</a>
              <a href="author.html#19301">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
