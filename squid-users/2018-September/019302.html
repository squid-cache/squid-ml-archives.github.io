<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] About SSL peek-n-splice/bump configurations
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20About%20SSL%20peek-n-splice/bump%20configurations&In-Reply-To=%3C004701d455c0%240970dba0%241c5292e0%24%40yahoo.com.ar%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019301.html">
   <LINK REL="Next"  HREF="019303.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] About SSL peek-n-splice/bump configurations</H1>
    <B>Julian Perconti</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20About%20SSL%20peek-n-splice/bump%20configurations&In-Reply-To=%3C004701d455c0%240970dba0%241c5292e0%24%40yahoo.com.ar%3E"
       TITLE="[squid-users] About SSL peek-n-splice/bump configurations">vh1988 at yahoo.com.ar
       </A><BR>
    <I>Wed Sep 26 17:40:33 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019301.html">[squid-users] About SSL peek-n-splice/bump configurations
</A></li>
        <LI>Next message (by thread): <A HREF="019303.html">[squid-users] About SSL peek-n-splice/bump configurations
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19302">[ date ]</a>
              <a href="thread.html#19302">[ thread ]</a>
              <a href="subject.html#19302">[ subject ]</a>
              <a href="author.html#19302">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> &gt; When I say &quot;implicit&quot; I want to mean that there is no any step specified in
</I>&gt;<i> the rule.
</I>&gt;<i> 
</I>&gt;<i> Understood. Please avoid that word usage. In this context, implicit means
</I>&gt;<i> &quot;without being configured&quot; or &quot;by default&quot;. One could say that &quot;default rules
</I>&gt;<i> implicitly match&quot;, or that &quot;a rule without any ACLs matches implicitly&quot;, but
</I>&gt;<i> one cannot say that &quot;rule X containing ACL Y implicitly matched&quot;.
</I>
OK and sorry for that.

&gt;<i> &gt; Althought there is no any peek rule at step2, in the second rule a
</I>&gt;<i> &gt; final action is applied to noBumpSites (if match)
</I>&gt;<i> 
</I>&gt;<i> Final actions at step2 do not matter when we are talking about what happens
</I>&gt;<i> at step3. If a final action is applied at step2, there is no
</I>&gt;<i> step3 as far as an ssl_bump configuration is concerned.
</I>
Yes, when a final action is applied at step2, ssl_bump rules are over when the previous step (if it's a final action) has matched.

&gt;<i> It is impossible for any transaction to be spliced at step3 with this
</I>&gt;<i> configuration. Whether the transaction matches or does not match
</I>&gt;<i> noBumpSites at any given step is irrelevant for this statement.
</I>
OK: In this configuration it is impossible any kind of splice at step3; but not for step2. 
In fact, noBumpSites are being spliced (at least I can see the TCP_TUNNEL in logs).

&gt;<i> Correct. There is nothing &quot;worse&quot; about this case though.
</I>
With the  term &quot;worst&quot; I wanted to mean that my intention is splice sites into the ACL (noBumpSites) , not bump.

&gt;<i> &gt; Here is where I your explanation breaks my head. Here is the most
</I>&gt;<i> &gt; important confusion of all of my own other
</I>&gt;<i> &gt; confusions/misunderstanding.
</I>&gt;<i> 
</I>&gt;<i> Final actions are &quot;bump&quot;, &quot;terminate&quot;, and &quot;splice&quot;. As you can easily see, this
</I>&gt;<i> statement does not depend on ACLs.
</I>&gt;<i> 
</I>&gt;<i> An action is either final or not, by that action nature/definition. ACLs are one
</I>&gt;<i> of the precondition for applying an action, but ACLs do not affect action
</I>&gt;<i> &quot;finality&quot;.
</I>
Well, Yes.
Strictly speaking final actions (and maybe any action) do not depend on the acl, let's say it is a natural function/behavior of Squid beyond any acl.
However, when a final action is present in a rule and that rule contains an ACL, the final action will apply to that ACL. At least that is the behaviour I see.
If not, Squid would not being splice'ing &quot;noBumpSites&quot; which is an ACL; as he is doing right now.
I say good?

&gt;<i> &gt; And even with the splice action as second rule, the 3rd rule is
</I>&gt;<i> &gt; processed (Squid is still processing rules after splice noBumpSites
</I>&gt;<i> &gt; ACL).
</I>&gt;<i> 
</I>&gt;<i> An action presence in the rules does not, on its own, stop Squid from
</I>&gt;<i> processing lower rules. *Applying* a final action does.
</I>
So, why squid process the last rule which stare at step 2? He already applied the splice to the ACL sites.

&gt;<i> &gt;&gt; After Squid applies the &quot;splice&quot; action (in whatever context, for
</I>&gt;<i> &gt;&gt; whatever reason), SslBump processing for that transaction is over.
</I>&gt;<i> &gt;&gt; Same for &quot;bump&quot; and &quot;terminate&quot; actions.
</I>&gt;<i> 
</I>&gt;<i> &gt; What do You exactly mean with &quot;for that transaction&quot;? Maybe that rule?
</I>&gt;<i> 
</I>&gt;<i> No, I do not mean &quot;that rule&quot;. In this context, &quot;transaction&quot; is, roughly
</I>&gt;<i> speaking, an &quot;HTTP CONNECT request&quot; or &quot;TLS connection&quot;. An applied final
</I>&gt;<i> action stops all ssl_bump processing for the corresponding
</I>&gt;<i> transaction/request/connection, and not just one ssl_bump rule processing.
</I>&gt;<i> That difference is why those actions are called &quot;final&quot;.
</I>
OK, thank You for that clarification of misinterpreted terms.

So going back to current config:

  ssl_bump peek step1
  ssl_bump splice noBumpSites # I think that here the splice action is applied at step2. Even if there is no step specified. And due to previous rule.
  ssl_bump stare step2

Due to I think that: the splice action happens at step2 (more checks?), and not at step 1 (less checks); This is the config the one of best fit to my necessities.

Quick reminder of the idea/need:
In the most possible &quot;secure&quot; way: bump to all except banks and other sensitive sites; and less possible interference to that sensitive sites.

Just a comment: Squid is working fine,but still the cache.log shows these kind or errors (quite annoying): 

kid1| Error negotiating SSL connection on FD 26: error:00000001:lib(0):func(0):reason(1) (1/-1)
kid1| ERROR: negotiating TLS on FD 31: error:00000000:lib(0):func(0):reason(0) (5/-1/104)

Always or almost always are only those two types of error [reason(1) (1/-1) - (0) (5/-1/104)]

But that is another story. Apart nobody reports problems about the browsing.

&gt;<i> Alex.
</I>
Thank You, again.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019301.html">[squid-users] About SSL peek-n-splice/bump configurations
</A></li>
	<LI>Next message (by thread): <A HREF="019303.html">[squid-users] About SSL peek-n-splice/bump configurations
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19302">[ date ]</a>
              <a href="thread.html#19302">[ thread ]</a>
              <a href="subject.html#19302">[ subject ]</a>
              <a href="author.html#19302">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
