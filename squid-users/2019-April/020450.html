<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 4 ssl_bump issue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%204%20ssl_bump%20issue&In-Reply-To=%3CCAPaB35nYChb5XFCpqDwu9ujnQt_ff1uY-JOmEOEuYj7%3DJb6mkQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020449.html">
   <LINK REL="Next"  HREF="020451.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 4 ssl_bump issue</H1>
    <B>Davide Belloni</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%204%20ssl_bump%20issue&In-Reply-To=%3CCAPaB35nYChb5XFCpqDwu9ujnQt_ff1uY-JOmEOEuYj7%3DJb6mkQ%40mail.gmail.com%3E"
       TITLE="[squid-users] Squid 4 ssl_bump issue">davide.belloni at gmail.com
       </A><BR>
    <I>Fri Apr  5 06:54:08 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020449.html">[squid-users] Squid 4 ssl_bump issue
</A></li>
        <LI>Next message (by thread): <A HREF="020451.html">[squid-users] Squid 4 ssl_bump issue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20450">[ date ]</a>
              <a href="thread.html#20450">[ thread ]</a>
              <a href="subject.html#20450">[ subject ]</a>
              <a href="author.html#20450">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,
the setup is exactly what you suggested but still the ERROR shows up.
Here the startup sequence about context creation:

2019/04/05 06:29:48.050| Initializing <A HREF="https://">https://</A> proxy context
2019/04/05 06:29:48.050| 24,8| SBuf.cc(38) SBuf: SBuf950 created from id
SBuf110
2019/04/05 06:29:48.050| 24,8| Tokenizer.cc(174) skip: skipping char '1'
2019/04/05 06:29:48.050| 24,5| Tokenizer.cc(25) consume: consuming 1 bytes
2019/04/05 06:29:48.050| 24,8| SBuf.cc(497) consume: SBuf950 consume 1
2019/04/05 06:29:48.050| 24,8| SBuf.cc(38) SBuf: SBuf951 created from id
SBuf950
2019/04/05 06:29:48.050| 24,8| SBuf.cc(70) ~SBuf: SBuf951 destructed
2019/04/05 06:29:48.050| 24,8| Tokenizer.cc(174) skip: skipping char '.'
2019/04/05 06:29:48.050| 24,5| Tokenizer.cc(25) consume: consuming 1 bytes
2019/04/05 06:29:48.050| 24,8| SBuf.cc(497) consume: SBuf950 consume 1
2019/04/05 06:29:48.050| 24,8| SBuf.cc(38) SBuf: SBuf952 created from id
SBuf950
2019/04/05 06:29:48.050| 24,8| SBuf.cc(70) ~SBuf: SBuf952 destructed
2019/04/05 06:29:48.050| 24,8| SBuf.cc(38) SBuf: SBuf953 created from id
SBuf950
2019/04/05 06:29:48.050| 24,5| Tokenizer.cc(25) consume: consuming 1 bytes
2019/04/05 06:29:48.050| 24,8| SBuf.cc(497) consume: SBuf950 consume 1
2019/04/05 06:29:48.050| 24,8| SBuf.cc(38) SBuf: SBuf954 created from id
SBuf950
2019/04/05 06:29:48.050| 24,8| SBuf.cc(70) ~SBuf: SBuf954 destructed
2019/04/05 06:29:48.050| 24,8| SBuf.cc(70) ~SBuf: SBuf953 destructed
2019/04/05 06:29:48.050| 24,8| SBuf.cc(70) ~SBuf: SBuf950 destructed
2019/04/05 06:29:48.051| 83,9| support.cc(586) InitClientContext: Setting
certificate verification callback.
2019/04/05 06:29:48.051| 83,8| PeerOptions.cc(647) updateContextCa: Setting
CA certificate locations.
2019/04/05 06:29:48.051| 83,8| PeerOptions.cc(630) loadSystemTrustedCa:
Setting default system Trusted CA. ctx=0x55dcadedcd20
2019/04/05 06:29:48.052| 24,8| SBuf.cc(30) SBuf: SBuf955 created
2019/04/05 06:29:48.052| 24,7| SBuf.cc(85) assign: assigning SBuf955 from
SBuf118
2019/04/05 06:29:48.052| 24,8| SBuf.cc(38) SBuf: SBuf956 created from id
SBuf955
2019/04/05 06:29:48.053| 24,8| SBuf.cc(70) ~SBuf: SBuf956 destructed
2019/04/05 06:29:48.053| 24,8| SBuf.cc(70) ~SBuf: SBuf955 destructed
2019/04/05 06:29:48.053| Initializing http_port 0.0.0.0:3128 TLS contexts
2019/04/05 06:29:48.053| Using certificate in /etc/squid/squidCA.pem
2019/04/05 06:29:48.053| 24,7| SBuf.cc(160) rawSpace: reserving 1 for
SBuf217
2019/04/05 06:29:48.053| 24,7| SBuf.cc(167) rawSpace: SBuf217 not growing
2019/04/05 06:29:48.053| 24,7| SBuf.cc(160) rawSpace: reserving 1 for
SBuf217
2019/04/05 06:29:48.053| 24,8| SBuf.cc(886) cow: SBuf217 new size:23
2019/04/05 06:29:48.053| 24,8| SBuf.cc(857) reAlloc: SBuf217 new size: 23
2019/04/05 06:29:48.054| 24,9| MemBlob.cc(56) MemBlob: constructed,
this=0x55dcadedd7c0 id=blob1225 reserveSize=23
2019/04/05 06:29:48.054| 24,8| MemBlob.cc(101) memAlloc: blob1225 memAlloc:
requested=23, received=40
2019/04/05 06:29:48.054| 24,7| SBuf.cc(865) reAlloc: SBuf217 new store
capacity: 40
2019/04/05 06:29:48.054| 83,3| KeyData.cc(105) loadX509ChainFromFile: Using
certificate chain in /etc/squid/squidCA.pem
2019/04/05 06:29:48.054| 83,3| KeyData.cc(123) loadX509ChainFromFile:
Adding issuer CA: /CN=nobody
2019/04/05 06:29:48.054| Using key in /etc/squid/squidCA.pem
2019/04/05 06:29:48.054| 24,7| SBuf.cc(160) rawSpace: reserving 1 for
SBuf218
2019/04/05 06:29:48.054| 24,8| SBuf.cc(886) cow: SBuf218 new size:23
2019/04/05 06:29:48.054| 24,8| SBuf.cc(857) reAlloc: SBuf218 new size: 23
2019/04/05 06:29:48.054| 24,9| MemBlob.cc(56) MemBlob: constructed,
this=0x55dcadef07f0 id=blob1226 reserveSize=23
2019/04/05 06:29:48.054| 24,8| MemBlob.cc(101) memAlloc: blob1226 memAlloc:
requested=23, received=40
2019/04/05 06:29:48.054| 24,9| MemBlob.cc(82) ~MemBlob: destructed,
this=0x55dcaddf6c30 id=blob554 capacity=40 size=23
2019/04/05 06:29:48.054| 24,7| SBuf.cc(865) reAlloc: SBuf218 new store
capacity: 40
2019/04/05 06:29:48.054| 83,8| PeerOptions.cc(647) updateContextCa: Setting
CA certificate locations.
2019/04/05 06:29:48.054| 83,9| ServerOptions.cc(444) updateContextClientCa:
Not requiring any client certificates
2019/04/05 06:29:48.054| 24,8| SBuf.cc(30) SBuf: SBuf957 created
2019/04/05 06:29:48.054| 24,7| SBuf.cc(85) assign: assigning SBuf957 from
SBuf118
2019/04/05 06:29:48.054| 24,8| SBuf.cc(38) SBuf: SBuf958 created from id
SBuf957
2019/04/05 06:29:48.054| 24,8| SBuf.cc(70) ~SBuf: SBuf958 destructed
2019/04/05 06:29:48.054| 24,8| SBuf.cc(70) ~SBuf: SBuf957 destructed

If you want I can attach all the cache log with startup and one request
with error
Thanks


On Fri, 5 Apr 2019 at 06:23, Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; wrote:

&gt;<i> On 5/04/19 12:37 am, Davide Belloni wrote:
</I>&gt;<i> &gt; Hi,
</I>&gt;<i> &gt; this is the certificate that I'm using at the moment:
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> AFAICS the pieces Squid-4 needs for your config and checks for are all
</I>&gt;<i> there.
</I>&gt;<i>
</I>&gt;<i> Are the pieces correctly ordered in the .pem file? key first, then CA cert.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On Thu, 4 Apr 2019 at 12:57, Davide Belloni wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     Hi, thanks very much for all the advices!
</I>&gt;<i> &gt;     About the action to generate the certificate I've followed the squid
</I>&gt;<i> &gt;     wiki, that doesn't modify (if I remember correctly) openssl conf to
</I>&gt;<i> &gt;     create it .
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     Do you have some link to a good howto about that?
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Ah, we have several how-to's in the wiki. The SSL-Bump documentation has
</I>&gt;<i> an example. The ConfigExamples section has one for self-signed root CA
</I>&gt;<i> like yours, one for intermediate CA signing cert, and one for a wildcard
</I>&gt;<i> domain cert.
</I>&gt;<i>
</I>&gt;<i> The one most relevant to what you have is:
</I>&gt;<i> &lt;
</I>&gt;<i> <A HREF="https://wiki.squid-cache.org/ConfigExamples/Intercept/SslBumpExplicit#Features.2FDynamicSslCert.Create_Self-Signed_Root_CA_Certificate">https://wiki.squid-cache.org/ConfigExamples/Intercept/SslBumpExplicit#Features.2FDynamicSslCert.Create_Self-Signed_Root_CA_Certificate</A>
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> If this already matches what you are doing, and the PEM file content is
</I>&gt;<i> correct, and that context creation ERROR still shows up. Then your next
</I>&gt;<i> step would be to start Squid with the -X command line option and see if
</I>&gt;<i> anything more specific about it shows up.
</I>&gt;<i>  (This will produce a huge amount of debug info, but you only need the
</I>&gt;<i> startup sequence where the ERROR shows up. It should not be necessary to
</I>&gt;<i> send traffic until the context is working.)
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i>
</I>

-- 

Davide Belloni
<A HREF="http://about.me/davidebelloni">http://about.me/davidebelloni</A>
<A HREF="http://www.linkedin.com/in/davidebelloni">http://www.linkedin.com/in/davidebelloni</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20190405/b6fcbf8f/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20190405/b6fcbf8f/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020449.html">[squid-users] Squid 4 ssl_bump issue
</A></li>
	<LI>Next message (by thread): <A HREF="020451.html">[squid-users] Squid 4 ssl_bump issue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20450">[ date ]</a>
              <a href="thread.html#20450">[ thread ]</a>
              <a href="subject.html#20450">[ subject ]</a>
              <a href="author.html#20450">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
