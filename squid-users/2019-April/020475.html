<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] youtube restriction.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20youtube%20restriction.&In-Reply-To=%3C5477a8d4-dbd8-df8f-1beb-f1d2c0202bf0%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020464.html">
   <LINK REL="Next"  HREF="020456.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] youtube restriction.</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20youtube%20restriction.&In-Reply-To=%3C5477a8d4-dbd8-df8f-1beb-f1d2c0202bf0%40treenet.co.nz%3E"
       TITLE="[squid-users] youtube restriction.">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Apr 10 05:44:20 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020464.html">[squid-users] youtube restriction.
</A></li>
        <LI>Next message (by thread): <A HREF="020456.html">[squid-users] Squid bind each outgoing ip to a user?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20475">[ date ]</a>
              <a href="thread.html#20475">[ thread ]</a>
              <a href="subject.html#20475">[ subject ]</a>
              <a href="author.html#20475">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 8/04/19 9:34 pm, Antony Stone wrote:
&gt;<i> Hi.
</I>&gt;<i> 
</I>&gt;<i> I'm replying in the original thread, to keep this conversation together in the 
</I>&gt;<i> archives etc.
</I>&gt;<i> 
</I>&gt;<i> On Monday 08 April 2019 at 11:15:00, Wegner Micha&#235;l wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> Hi Antony,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The video is Ok, if i not used squid v3.5.
</I>&gt;<i> 
</I>&gt;<i> So, it's not Youtube blocking that particualr video in your country etc.
</I>&gt;<i> 
</I>&gt;&gt;<i> If on the squid.conf file I disabled rediretion on squidgaurd the problem
</I>&gt;&gt;<i> is the same.
</I>&gt;<i> 
</I>&gt;<i> Okay, we can disregard SquidGuard as being the problem, then.
</I>&gt;<i> 
</I>&gt;&gt;<i> If squid is actived, somme videos are blocked, (the videos in
</I>&gt;&gt;<i> restricted mode)
</I>&gt;<i> 
</I>&gt;<i> That tells us it's your Squid configuration which is causing the problem.
</I>&gt;<i> 
</I>&gt;&gt;<i> With a old version of squid (2.6) there are no problems
</I>&gt;<i> 
</I>&gt;<i> There are a *lot* of differences between Squid 2.6 and 3.5, especially for 
</I>&gt;<i> HTTPS.  You *have* made suitable adjustments to the configuration file, I hope?
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Antony.
</I>&gt;<i> 
</I>
&gt;<i> -----Message d'origine-----
</I>&gt;<i> De : Wegner Micha&#235;l
</I>&gt;<i> Envoy&#233; : lundi 8 avril 2019 11:15
</I>&gt;<i> 
</I>&gt;<i> Hi Antony,
</I>&gt;<i> 
</I>&gt;<i> The video is Ok, if i not used squid v3.5.
</I>&gt;<i> If on the squid.conf file I disabled rediretion on squidgaurd the problem is the same.
</I>&gt;<i> If squid is actived, somme videos are blocked, (the videos in restricted mode) With a old version of squid (2.6) there are no problems
</I>&gt;<i> 
</I>&gt;<i> Regards,
</I>&gt;<i> 
</I>&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> I install a new serveur squid version 4.6 without squiguard and access allow all.
</I>&gt;<i> I set the ssl and i import certificate on the client but without success.
</I>&gt;<i> 
</I>&gt;<i> My squid.conf is : 
</I>&gt;<i> 
</I>...
&gt;<i> #
</I>&gt;<i> # Deny requests to certain unsafe ports
</I>&gt;<i> http_access deny !Safe_ports
</I>&gt;<i> 
</I>&gt;<i> # Deny CONNECT to other than secure SSL ports
</I>&gt;<i> http_access deny CONNECT !SSL_ports
</I>&gt;<i> 
</I>&gt;<i> # Only allow cachemgr access from localhost
</I>&gt;<i> http_access allow localhost manager
</I>&gt;<i> http_access deny manager
</I>&gt;<i> 
</I>&gt;<i> #
</I>&gt;<i> # INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
</I>&gt;<i> #
</I>&gt;<i> include /etc/squid/conf.d/*
</I>
Do you have any config files in that directory? if so please post their
content too.

&gt;<i> 
</I>&gt;<i> #http_access allow localnet
</I>&gt;<i> http_access allow localhost
</I>&gt;<i> 
</I>&gt;<i> # And finally deny all other access to this proxy
</I>&gt;<i> #http_access deny all
</I>&gt;<i> http_access allow all
</I>&gt;<i> 
</I>
Allowing anyone to send traffic through your proxy without limitation is
*not* a good idea. Now that you confirmed it makes no difference, please
remove again to avoid it adding complications.

If an error was showing up before to make you think this was a
possibility, we will need to see that message please.


&gt;<i> 
</I>&gt;<i> http_port 3128 ssl-bump cert=/opt/squid/etc/ssl_cert/myCA.pem generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
</I>&gt;<i> sslcrtd_program /usr/lib/squid/security_file_certgen -s /opt/squid/log/squid/ssl_db -M 4MB
</I>&gt;<i> coredump_dir /opt/squid/var/cache/squid
</I>&gt;<i> cache_dir ufs /opt/squid/var/cache/squid 1000 16 256 # 1GB as Cache
</I>&gt;<i> 
</I>
So you have &quot;ssl-bump&quot; and related settings on the port. This means that
Squid will attempt to decrypt the TLS/SSL traffic arriving in that ports
CONNECT requests.

However, there is no sign of any ssl_bump access controls. Which means
your Squid will *not* do the decryption. This config should act exactly
as if you had not specified ssl-bump at all. The TLS/SSL inside a
CONNECT tunnel is between the client and origin server directly -
exactly as if the proxy was not there.



PS. One thing to be aware of though is that YouTube being a Google
property is pushing use of newer protocols like HTTP/2, HTTP/3 and QUIC.
You may find that the traffic is not going over TCP at all or being
detected as an unsupported protocol.
 That latter would produce error responses - Squid-4 has
&lt;<A HREF="http://www.squid-cache.org/Doc/config/on_unsupported_protocol/">http://www.squid-cache.org/Doc/config/on_unsupported_protocol/</A>&gt; to work
around that.


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020464.html">[squid-users] youtube restriction.
</A></li>
	<LI>Next message (by thread): <A HREF="020456.html">[squid-users] Squid bind each outgoing ip to a user?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20475">[ date ]</a>
              <a href="thread.html#20475">[ thread ]</a>
              <a href="subject.html#20475">[ subject ]</a>
              <a href="author.html#20475">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
