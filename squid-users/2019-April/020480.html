<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] negotiate_wrapper_auth double free or corruption
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20negotiate_wrapper_auth%20double%20free%20or%20corruption&In-Reply-To=%3C1554911685648-0.post%40n4.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020481.html">
   <LINK REL="Next"  HREF="020483.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] negotiate_wrapper_auth double free or corruption</H1>
    <B>spokke</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20negotiate_wrapper_auth%20double%20free%20or%20corruption&In-Reply-To=%3C1554911685648-0.post%40n4.nabble.com%3E"
       TITLE="[squid-users] negotiate_wrapper_auth double free or corruption">spokke at virtualbrain.info
       </A><BR>
    <I>Wed Apr 10 15:54:45 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020481.html">[squid-users] Can't get Squid configured properly
</A></li>
        <LI>Next message (by thread): <A HREF="020483.html">[squid-users] negotiate_wrapper_auth double free or corruption
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20480">[ date ]</a>
              <a href="thread.html#20480">[ thread ]</a>
              <a href="subject.html#20480">[ subject ]</a>
              <a href="author.html#20480">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Ciao, 

we have a working squid 4  + AD SSO, system is a centos 7 virtual server,
squid it's installed from unofficial (but supported) repository
<A HREF="http://www1.ngtech.co.il...">http://www1.ngtech.co.il...</A>

This are the lines of the auth wrapper configuration

auth_param negotiate program /usr/lib64/squid/negotiate_wrapper_auth --ntlm
/usr/bin/ntlm_auth -d --diagnostics --helper-protocol=squid-2.5-ntlmssp
--domain=XXXXXXXXXX --kerberos /usr/lib64/squid/negotiate_kerberos_auth  -d
-k /etc/squid/PROXY.keytab -s GSS_C_NO_NAME
auth_param negotiate children 80 startup=40 idle=10
auth_param negotiate keep_alive off

all seems to work fine except of sometime on the cache log appear a really
ugly crash message:
** Error in `(negotiate_wrapper_auth)': double free or corruption (!prev):
0x00000000021c8980 ***
======= Backtrace: =========
/lib64/libc.so.6(+0x81489)[0x7fec93d8e489]
(negotiate_wrapper_auth)[0x401bb1]
(negotiate_wrapper_auth)[0x4016a6]
/lib64/libc.so.6(__libc_start_main+0xf5)[0x7fec93d2f3d5]
(negotiate_wrapper_auth)[0x40170b]
======= Memory map: ========
00400000-00404000 r-xp 00000000 fd:00 688457                            
/usr/lib64/squid/negotiate_wrapper_a
uth
00603000-00604000 r--p 00003000 fd:00 688457                            
/usr/lib64/squid/negotiate_wrapper_a
uth
00604000-00605000 rw-p 00004000 fd:00 688457                            
/usr/lib64/squid/negotiate_wrapper_a
uth
021c8000-021e9000 rw-p 00000000 00:00 0                                 
[heap]
7fec8c000000-7fec8c021000 rw-p 00000000 00:00 0 
7fec8c021000-7fec90000000 ---p 00000000 00:00 0 
7fec934df000-7fec934f6000 r-xp 00000000 fd:00 8151                      
/usr/lib64/libpthread-2.17.so
7fec934f6000-7fec936f5000 ---p 00017000 fd:00 8151                      
/usr/lib64/libpthread-2.17.so
7fec936f5000-7fec936f6000 r--p 00016000 fd:00 8151                      
/usr/lib64/libpthread-2.17.so
7fec936f6000-7fec936f7000 rw-p 00017000 fd:00 8151                      
/usr/lib64/libpthread-2.17.so
7fec936f7000-7fec936fb000 rw-p 00000000 00:00 0 
7fec936fb000-7fec936ff000 r-xp 00000000 fd:00 48464                     
/usr/lib64/libmnl.so.0.1.0
7fec936ff000-7fec938ff000 ---p 00004000 fd:00 48464                     
/usr/lib64/libmnl.so.0.1.0
7fec938ff000-7fec93900000 r--p 00004000 fd:00 48464                     
/usr/lib64/libmnl.so.0.1.0
7fec93900000-7fec93901000 rw-p 00005000 fd:00 48464                     
/usr/lib64/libmnl.so.0.1.0
7fec93901000-7fec93907000 r-xp 00000000 fd:00 48682                     
/usr/lib64/libnfnetlink.so.0.2.0
7fec93907000-7fec93b06000 ---p 00006000 fd:00 48682                     
/usr/lib64/libnfnetlink.so.0.2.0
7fec93b06000-7fec93b07000 r--p 00005000 fd:00 48682                     
/usr/lib64/libnfnetlink.so.0.2.0
7fec93b07000-7fec93b08000 rw-p 00006000 fd:00 48682                     
/usr/lib64/libnfnetlink.so.0.2.0
7fec93b08000-7fec93b0c000 r-xp 00000000 fd:00 17626                     
/usr/lib64/libattr.so.1.1.0
7fec93b0c000-7fec93d0b000 ---p 00004000 fd:00 17626                     
/usr/lib64/libattr.so.1.1.0
7fec93d0b000-7fec93d0c000 r--p 00003000 fd:00 17626                     
/usr/lib64/libattr.so.1.1.0
7fec93d0c000-7fec93d0d000 rw-p 00004000 fd:00 17626                     
/usr/lib64/libattr.so.1.1.0
7fec93d0d000-7fec93ecf000 r-xp 00000000 fd:00 8144                      
/usr/lib64/libc-2.17.so
7fec93ecf000-7fec940cf000 ---p 001c2000 fd:00 8144                      
/usr/lib64/libc-2.17.so
7fec940cf000-7fec940d3000 r--p 001c2000 fd:00 8144                      
/usr/lib64/libc-2.17.so
7fec940d3000-7fec940d5000 rw-p 001c6000 fd:00 8144                      
/usr/lib64/libc-2.17.so
7fec940d5000-7fec940da000 rw-p 00000000 00:00 0 
7fec940da000-7fec940ef000 r-xp 00000000 fd:00 635666                    
/usr/lib64/libgcc_s-4.8.5-20150702.s
o.1
7fec940ef000-7fec942ee000 ---p 00015000 fd:00 635666                    
/usr/lib64/libgcc_s-4.8.5-20150702.s
o.1
7fec942ee000-7fec942ef000 r--p 00014000 fd:00 635666                    
/usr/lib64/libgcc_s-4.8.5-20150702.s
o.1
7fec942ef000-7fec942f0000 rw-p 00015000 fd:00 635666                    
/usr/lib64/libgcc_s-4.8.5-20150702.s
o.1
7fec942f0000-7fec943f1000 r-xp 00000000 fd:00 743856                    
/usr/lib64/libm-2.17.so
7fec943f1000-7fec945f0000 ---p 00101000 fd:00 743856                    
/usr/lib64/libm-2.17.so
7fec945f0000-7fec945f1000 r--p 00100000 fd:00 743856                    
/usr/lib64/libm-2.17.so
7fec945f1000-7fec945f2000 rw-p 00101000 fd:00 743856                    
/usr/lib64/libm-2.17.so
7fec945f2000-7fec946db000 r-xp 00000000 fd:00 191114                    
/usr/lib64/libstdc++.so.6.0.19
7fec946db000-7fec948da000 ---p 000e9000 fd:00 191114                    
/usr/lib64/libstdc++.so.6.0.19
7fec948da000-7fec948e2000 r--p 000e8000 fd:00 191114                    
/usr/lib64/libstdc++.so.6.0.19
7fec948e2000-7fec948e4000 rw-p 000f0000 fd:00 191114                    
/usr/lib64/libstdc++.so.6.0.19
7fec948e4000-7fec948f9000 rw-p 00000000 00:00 0 
7fec948f9000-7fec94900000 r-xp 00000000 fd:00 8158                      
/usr/lib64/librt-2.17.so
7fec94900000-7fec94aff000 ---p 00007000 fd:00 8158                      
/usr/lib64/librt-2.17.so
7fec94aff000-7fec94b00000 r--p 00006000 fd:00 8158                      
/usr/lib64/librt-2.17.so
7fec94b00000-7fec94b01000 rw-p 00007000 fd:00 8158                      
/usr/lib64/librt-2.17.so
7fec94b01000-7fec94b1d000 r-xp 00000000 fd:00 49012                     
/usr/lib64/libnetfilter_conntrack.so
.3.6.0
7fec94b1d000-7fec94d1c000 ---p 0001c000 fd:00 49012                     
/usr/lib64/libnetfilter_conntrack.so
.3.6.0
7fec94d1c000-7fec94d1e000 r--p 0001b000 fd:00 49012                     
/usr/lib64/libnetfilter_conntrack.so
.3.6.0
7fec94d1e000-7fec94d1f000 rw-p 0001d000 fd:00 49012                     
/usr/lib64/libnetfilter_conntrack.so
.3.6.0
7fec94d1f000-7fec94d23000 r-xp 00000000 fd:00 17631                     
/usr/lib64/libcap.so.2.22
7fec94d23000-7fec94f22000 ---p 00004000 fd:00 17631                     
/usr/lib64/libcap.so.2.22
7fec94f22000-7fec94f23000 r--p 00003000 fd:00 17631                     
/usr/lib64/libcap.so.2.22
7fec94f23000-7fec94f24000 rw-p 00004000 fd:00 17631                     
/usr/lib64/libcap.so.2.22
7fec94f24000-7fec94f3a000 r-xp 00000000 fd:00 8155                      
/usr/lib64/libresolv-2.17.so
7fec94f3a000-7fec95139000 ---p 00016000 fd:00 8155                      
/usr/lib64/libresolv-2.17.so
7fec95139000-7fec9513a000 r--p 00015000 fd:00 8155                      
/usr/lib64/libresolv-2.17.so
7fec9513a000-7fec9513b000 rw-p 00016000 fd:00 8155                      
/usr/lib64/libresolv-2.17.so
7fec9513b000-7fec9513d000 rw-p 00000000 00:00 0 
7fec9513d000-7fec95153000 r-xp 00000000 fd:00 743858                    
/usr/lib64/libnsl-2.17.so
7fec95153000-7fec95353000 ---p 00016000 fd:00 743858                    
/usr/lib64/libnsl-2.17.so
7fec95353000-7fec95354000 r--p 00016000 fd:00 743858                    
/usr/lib64/libnsl-2.17.so
7fec95354000-7fec95355000 rw-p 00017000 fd:00 743858                    
/usr/lib64/libnsl-2.17.so
7fec95355000-7fec95357000 rw-p 00000000 00:00 0 
7fec95357000-7fec95359000 r-xp 00000000 fd:00 743854                    
/usr/lib64/libdl-2.17.so
7fec95359000-7fec95559000 ---p 00002000 fd:00 743854                    
/usr/lib64/libdl-2.17.so
7fec95559000-7fec9555a000 r--p 00002000 fd:00 743854                    
/usr/lib64/libdl-2.17.so
7fec9555a000-7fec9555b000 rw-p 00003000 fd:00 743854                    
/usr/lib64/libdl-2.17.so
7fec9555b000-7fec9557d000 r-xp 00000000 fd:00 7853                      
/usr/lib64/ld-2.17.so
7fec9576a000-7fec95773000 rw-p 00000000 00:00 0 
7fec9577a000-7fec9577c000 rw-p 00000000 00:00 0 
7fec9577c000-7fec9577d000 r--p 00021000 fd:00 7853                      
/usr/lib64/ld-2.17.so
7fec9577d000-7fec9577e000 rw-p 00022000 fd:00 7853                      
/usr/lib64/ld-2.17.so
7fec9577e000-7fec9577f000 rw-p 00000000 00:00 0 
7ffe2e6d9000-7ffe2e70e000 rw-p 00000000 00:00 0                         
[stack]
7ffe2e7b5000-7ffe2e7b7000 r-xp 00000000 00:00 0                         
[vdso]
ffffffffff600000-ffffffffff601000 r-xp 00000000 00:00 0                 
[vsyscall]
2019/04/10 08:36:08 kid1| WARNING: negotiateauthenticator #Hlpr488 exited
2019/04/10 08:36:08 kid1| Too few negotiateauthenticator processes are
running (need 10/60)
2019/04/10 08:36:08 kid1| Starting new helpers
2019/04/10 08:36:08 kid1| helperOpenServers: Starting 10/60
'negotiate_wrapper_auth' processes
2019/04/10 08:36:09 kid1| ERROR: Negotiate Authentication Helper '0/0'
crashed!.
2019/04/10 08:36:09 kid1| ERROR: Negotiate Authentication validating user.
Result: {result=Unknown}
*** Error in `(negotiate_wrapper_auth)': double free or corruption (!prev):
0x0000000002421980 ***
*** Error in `(negotiate_wrapper_auth)': double free or corruption (!prev):
0x00000000013a8980 ***
.....

seems that the wrapper crash but i dont undestand why...i've tried to reduce
or increase the number of childrens/startup/idle processes but the errors
always appear....someone can help me to undestand this issue??

thanks

Ale



--
Sent from: <A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html">http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html</A>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020481.html">[squid-users] Can't get Squid configured properly
</A></li>
	<LI>Next message (by thread): <A HREF="020483.html">[squid-users] negotiate_wrapper_auth double free or corruption
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20480">[ date ]</a>
              <a href="thread.html#20480">[ thread ]</a>
              <a href="subject.html#20480">[ subject ]</a>
              <a href="author.html#20480">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
