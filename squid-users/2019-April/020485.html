<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] domain in whitelist being denied
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20domain%20in%20whitelist%20being%20denied&In-Reply-To=%3C009f3ddc-1301-9ad2-c4d2-088369d13bb6%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020486.html">
   <LINK REL="Next"  HREF="020479.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] domain in whitelist being denied</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20domain%20in%20whitelist%20being%20denied&In-Reply-To=%3C009f3ddc-1301-9ad2-c4d2-088369d13bb6%40treenet.co.nz%3E"
       TITLE="[squid-users] domain in whitelist being denied">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Apr 11 03:59:28 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020486.html">[squid-users] domain in whitelist being denied
</A></li>
        <LI>Next message (by thread): <A HREF="020479.html">[squid-users] Can't get Squid configured properly
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20485">[ date ]</a>
              <a href="thread.html#20485">[ thread ]</a>
              <a href="subject.html#20485">[ subject ]</a>
              <a href="author.html#20485">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 11/04/19 2:37 am, Erick Perez - Quadrian Enterprises wrote:
&gt;<i> Hi,
</I>&gt;<i> I have added a new domain in my whitelist in squid (no caching, just
</I>&gt;<i> block/deny) and the domain is being blocked. suggestions?
</I>
The domain is not being blocked. Either the client or the tunnel is.



&gt;<i> I have included the relevant bits in the config.
</I>
The relevant config is not what you think it is.

&gt;<i> Nothing has changed
</I>&gt;<i> except for adding the new domain.
</I>
To me it looks like you added the whitelist ACLs and the access control
checking them.


&gt;<i> 
</I>&gt;<i> url: <A HREF="https://www.sqlsoftware.nom.co:8441">https://www.sqlsoftware.nom.co:8441</A>
</I>&gt;<i> 
</I>&gt;<i> #/etc/squid/alloweddomains
</I>&gt;<i> .sqlsoftware.nom.co
</I>&gt;<i> 
</I>&gt;<i> #access.log
</I>&gt;<i> #
</I>&gt;<i> 1554650994.238      0 10.231.0.53 TCP_DENIED/403 3742 CONNECT
</I>&gt;<i> www.sqlsoftware.nom.co:8441 - NONE/- text/html
</I>&gt;<i> 1554650994.254      0 10.231.0.53 TCP_DENIED/403 3742 CONNECT
</I>&gt;<i> www.sqlsoftware.nom.co:8441 - NONE/- text/html
</I>&gt;<i> #
</I>&gt;<i> 
</I>&gt;<i> #squid.conf
</I>&gt;<i> #
</I>&gt;<i> acl mylan src 10.230.0.0/16
</I>
The client 10.231.0.53 is not within that CIDR range.

You need to test from a client within the LAN range or extend the
&quot;mylan&quot; to *actually* list your LAN.


&gt;<i> acl allowedsites dstdomain &quot;/etc/squid/alloweddomains&quot;
</I>&gt;<i> acl Safe_ports port 8441 # sqlsoftware.nom.co
</I>
If you use the default Safe_ports ACL definition this port was already
included there. No need for this line unless you have reduced the
provided Safe_ports ACL.


&gt;<i> acl CONNECT method CONNECT
</I>&gt;<i> # Deny requests to certain unsafe ports
</I>&gt;<i> http_access deny !Safe_ports
</I>&gt;<i> # Deny CONNECT to other than secure SSL ports
</I>&gt;<i> http_access deny CONNECT !SSL_ports
</I>
Port 8441 is not port 443 (HTTPS). Assuming that you don't have any
previous http_access rules doing weird things this is where the denial
comes from right now.

You need check that the traffic to this port is actually safe for
bypassing the proxy controls completely (that is what happens with CONNECT).

If that is what you actually want, add this port to the SSL_Ports list.


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020486.html">[squid-users] domain in whitelist being denied
</A></li>
	<LI>Next message (by thread): <A HREF="020479.html">[squid-users] Can't get Squid configured properly
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20485">[ date ]</a>
              <a href="thread.html#20485">[ thread ]</a>
              <a href="subject.html#20485">[ subject ]</a>
              <a href="author.html#20485">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
