<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Logging ICAP headers in access log
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Logging%20ICAP%20headers%20in%20access%20log&In-Reply-To=%3C1ad0e2c9-e167-4440-85ae-9e63cca981ed%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020491.html">
   <LINK REL="Next"  HREF="020500.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Logging ICAP headers in access log</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Logging%20ICAP%20headers%20in%20access%20log&In-Reply-To=%3C1ad0e2c9-e167-4440-85ae-9e63cca981ed%40treenet.co.nz%3E"
       TITLE="[squid-users] Logging ICAP headers in access log">squid3 at treenet.co.nz
       </A><BR>
    <I>Sat Apr 13 05:56:16 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020491.html">[squid-users] Logging ICAP headers in access log
</A></li>
        <LI>Next message (by thread): <A HREF="020500.html">[squid-users] Logging ICAP headers in access log
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20492">[ date ]</a>
              <a href="thread.html#20492">[ thread ]</a>
              <a href="subject.html#20492">[ subject ]</a>
              <a href="author.html#20492">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 13/04/19 9:21 am, johnr wrote:
&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> I am attempting to log ICAP headers in the access log. Specifically, I
</I>&gt;<i> modify my logformat directive to include something like
</I>&gt;<i> {x-icap-info}icap::&gt;h for a header x-icap-info that is available in the icap
</I>&gt;<i> request headers. 
</I>&gt;<i> 
</I>&gt;<i> From the logformat documentation
</I>&gt;<i> (<A HREF="http://www.squid-cache.org/Doc/config/logformat/">http://www.squid-cache.org/Doc/config/logformat/</A>) it says that log codes
</I>&gt;<i> mentioned in icap_log (<A HREF="http://www.squid-cache.org/Doc/config/icap_log/">http://www.squid-cache.org/Doc/config/icap_log/</A>) are
</I>&gt;<i> available if icap is enabled. I am able to successfully log icap:tt in the
</I>&gt;<i> access log, but logging the headers has not been working. 
</I>&gt;<i> 
</I>&gt;<i> Am I mistaken in thinking this is possible or is it perhaps just a case of
</I>&gt;<i> not using the correct syntax?
</I>
Is ICAP REQMOD or ICAP RESPMOD or both being used?

Are multiple ICAP services being used?

Are ICAP access controls being used?
 if so what config?

What *are* you seeing logged?

What exactly is the header name you are trying to log?

Have you tried it with case-sensitive naming?

Have you tried just %icap::&gt;h to show the full set of ICAP headers the
transaction has when logging to access.log?

Please be aware that the ICAP codes are only expected to produce output
*if* the HTTP transaction was passed to an ICAP server. Some requests do
not get that far and should be producing a '-' instead.


Does cache.log contain any mention of problems?
  particularly on startup or reconfigure.

Does &quot;squid -k parse&quot; mention any WARNING or ERROR about your config?
 If so please fix those to ensure no bad config is interferring.

And finally, what version and build of Squid are you using?
 (output of &quot;squid -v&quot; please)


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020491.html">[squid-users] Logging ICAP headers in access log
</A></li>
	<LI>Next message (by thread): <A HREF="020500.html">[squid-users] Logging ICAP headers in access log
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20492">[ date ]</a>
              <a href="thread.html#20492">[ thread ]</a>
              <a href="subject.html#20492">[ subject ]</a>
              <a href="author.html#20492">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
