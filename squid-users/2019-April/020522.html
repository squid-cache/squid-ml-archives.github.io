<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid-users Digest, Vol 56, Issue 12
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid-users%20Digest%2C%20Vol%2056%2C%20Issue%2012&In-Reply-To=%3Ca018e0cd-8dc7-02b2-d474-82a202472bfa%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020519.html">
   <LINK REL="Next"  HREF="020468.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid-users Digest, Vol 56, Issue 12</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid-users%20Digest%2C%20Vol%2056%2C%20Issue%2012&In-Reply-To=%3Ca018e0cd-8dc7-02b2-d474-82a202472bfa%40treenet.co.nz%3E"
       TITLE="[squid-users] squid-users Digest, Vol 56, Issue 12">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Apr 19 03:59:23 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020519.html">[squid-users] squid-users Digest, Vol 56, Issue 12
</A></li>
        <LI>Next message (by thread): <A HREF="020468.html">[squid-users] Current downloads on	http://www.squid-cache.org/Versions/v5/
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20522">[ date ]</a>
              <a href="thread.html#20522">[ thread ]</a>
              <a href="subject.html#20522">[ subject ]</a>
              <a href="author.html#20522">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> -----Message d'origine-----
</I>...
&gt;<i>
</I>&gt;<i> When replying, please edit your Subject line so it is more specific
</I>than &quot;Re: Contents of squid-users digest...&quot;

When you are trying to message the list about issues please change your
subscription settings to deliver you the individual posts so you can
reply to threads instead of digests.


On 19/04/19 1:34 am, Wegner Micha&#235;l wrote:
&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> The SSL is OK I always can't play some YouTube video.
</I>&gt;<i> Squid in version 4.6
</I>&gt;<i> In access.log : TCP_TUNNEL/200 2083 CONNECT www.youtube.com:443 - HIER_DIRECT/216.58.206.238
</I>&gt;<i> I think the problem comes from heading.
</I>&gt;<i> 
</I>
What are you calling &quot;heading&quot;?


The (incomplete) access.log entry you show has;

 * an unknown client requesting a tunnel to www.youtube.com.

 * Squid is opening a tunnel to the server 216.58.206.238.

 * Squid is informing the client that it was 200/success. The tunnel can
be used.

 * 2083 bytes are sent to the client. Some of those were for the 200
response.

 * the tunnel is closed without any errors having occured.


This line means multiple different things depending on which port your
proxy received it on (if received) or whether Squid generated the
CONNECT pieces for SSL-Bump internal use.


&gt;<i> My squid.conf for test is :
</I>&gt;<i> visible_hostname squid
</I>&gt;<i> 
</I>&gt;<i> acl localnet src 10.0.0.0/8
</I>&gt;<i> 
</I>&gt;<i> acl SSL_ports port 443
</I>&gt;<i> 
</I>&gt;<i> acl Safe_ports port 80          # http
</I>&gt;<i> acl Safe_ports port 21          # ftp
</I>&gt;<i> acl Safe_ports port 443         # https
</I>&gt;<i> acl Safe_ports port 70          # gopher
</I>&gt;<i> acl Safe_ports port 210         # wais
</I>&gt;<i> acl Safe_ports port 1025-65535  # unregistered ports
</I>&gt;<i> acl Safe_ports port 280         # http-mgmt
</I>&gt;<i> acl Safe_ports port 488         # gss-http
</I>&gt;<i> acl Safe_ports port 591         # filemaker
</I>&gt;<i> acl Safe_ports port 777         # multiling http
</I>&gt;<i> 
</I>&gt;<i> acl CONNECT method CONNECT
</I>&gt;<i> 
</I>&gt;<i> http_access deny !Safe_ports
</I>&gt;<i> http_access deny CONNECT !SSL_ports
</I>&gt;<i> http_access allow localnet
</I>&gt;<i> http_access allow localhost
</I>&gt;<i> http_access deny all
</I>&gt;<i> 
</I>&gt;<i> http_port 3128
</I>
Traffic arriving on above port never has SSL-Bump applied to it. Tunnels
are always directly client&lt;-&gt;origin with no Squid interaction to the
HTTPS portion.


&gt;<i> https_port 3129 intercept ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=4MB cert=/opt/squid/etc/ssl_cert/myCA.pem
</I>&gt;<i> 
</I>&gt;<i> ssl_bump splice localhost
</I>
Traffic NAT intercepted from localhost is always spliced. The TLS and
wrapped HTTPS are always directly client&lt;-&gt;origin with no Squid interaction.

&gt;<i> acl 9 at_step SslBump1
</I>&gt;<i> acl 10 at_step SslBump2
</I>&gt;<i> acl 11 at_step SslBump3
</I>&gt;<i> ssl_bump peek 9 all
</I>&gt;<i> ssl_bump bump 10 all
</I>
All traffic which is from non-localhost is always bumped at step-2 by
SSL-Bump.

Step-2 has zero details about the actual origin server TLS capabilities
or properties. Bumping at this step is what we call &quot;client-first&quot;. It
has *many* problems and should be avoided unless absolutely necessary.


YouTube is a Google domain. Google are particularly strict about their
TLS usage and security. They do a lot of things to absolutely prohibit
things like client-first being possible at all.

Bump not being possible at all is the normal state for Google domains.
It is more surprising that you are reporting &quot;works fine&quot; for parts of
YT than the failure.

More details will be needed to see what is going on. Please start by
providing the whole of that access.log line and the other log entries
from your test transaction. If bumping is happening at all there *will*
be multiple log entries.


&gt;<i> ssl_bump bump 11 all
</I>&gt;<i> 
</I>
Above should never happen because everything was already spliced at
step-1 or bumped at step-2.


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020519.html">[squid-users] squid-users Digest, Vol 56, Issue 12
</A></li>
	<LI>Next message (by thread): <A HREF="020468.html">[squid-users] Current downloads on	http://www.squid-cache.org/Versions/v5/
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20522">[ date ]</a>
              <a href="thread.html#20522">[ thread ]</a>
              <a href="subject.html#20522">[ subject ]</a>
              <a href="author.html#20522">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
