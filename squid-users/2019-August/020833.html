<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Reverse Proxy Detected
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Reverse%20Proxy%20Detected&In-Reply-To=%3Cd576bb56-784a-bf70-379b-1f1afd028408%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020832.html">
   <LINK REL="Next"  HREF="020834.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Reverse Proxy Detected</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Reverse%20Proxy%20Detected&In-Reply-To=%3Cd576bb56-784a-bf70-379b-1f1afd028408%40treenet.co.nz%3E"
       TITLE="[squid-users] Reverse Proxy Detected">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Aug  1 09:07:06 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020832.html">[squid-users] Blocking CONNECT
</A></li>
        <LI>Next message (by thread): <A HREF="020834.html">[squid-users] logformat for squid5 ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20833">[ date ]</a>
              <a href="thread.html#20833">[ thread ]</a>
              <a href="subject.html#20833">[ subject ]</a>
              <a href="author.html#20833">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 1/08/19 9:41 am, creditu wrote:
&gt;<i> We have been using several squid servers in accelerator mode for a 
</I>&gt;<i> number of years mainly for load balancing to send public requests to 
</I>&gt;<i> backend servers.  The requests to the squids typically come via a 
</I>&gt;<i> well known commercial  caching service.   The squids don't do any 
</I>&gt;<i> caching, they just forward requests to the backend.
</I>&gt;<i> 
</I>&gt;<i> Recently the vulnerability scanner that we use changed a plugin from 
</I>&gt;<i> Info level to Moderate for reverse proxy detection. We need to
</I>&gt;<i> mitigate this so the vulnerability scanner doesn't flag for the
</I>&gt;<i> reverse proxy detection.
</I>&gt;<i> 
</I>
So the first question is why they did that change. It may be that the
particular Squid version you have is known to have issues they are
warning about.


&gt;<i> On a non-production server I added the following.  This seems to 
</I>&gt;<i> mitigate the vulnerability in the eyes of the scanner.  (I may be 
</I>&gt;<i> able to get away with not including the X-Cache-Lookup  line and 
</I>&gt;<i> still fix the issue.)
</I>&gt;<i> 
</I>&gt;<i> via off reply_header_access X-Cache deny all reply_header_access 
</I>&gt;<i> X-Cache-Lookup deny all
</I>&gt;<i> 
</I>&gt;<i> This removes the headers for both the outgoing traffic to the 
</I>&gt;<i> Internet and the backend traffic to the webservers.  I have not seen 
</I>&gt;<i> any operational impact of doing this, but wanted get some feedback
</I>&gt;<i> on if there is a better way to fix this issue and if I am missing
</I>&gt;<i> any possible implications.
</I>&gt;<i> 
</I>
The above are fine.

The &quot;via off&quot; does technically violate a &quot;proxy MUST add&quot; requirement
from RFCs 2616 and 7230. But the HTTPbis WG has been looking into
reducing that to a SHOULD for the next HTTP spec update and the results
looked good. Proxies are already allowed by those RFCs to aggregate
several Via entries together - which is essentially the same as not
adding a new one.


FWIW; All X-* headers are deprecated officially by HTTP and those
X-Cache* ones were only intended to be debug info by their creators back
in 1990's. Though some admin or software apparently place unwarranted
dependency on them for other uses.



&gt;<i> Also, does the following have the same effect as &quot;via off&quot;? 
</I>&gt;<i> reply_header_access Via deny all
</I>&gt;<i> 
</I>
No. &quot;via off&quot; will stop Squid adding itself to the Via header. Any
existing header should remain so that other systems outside yours can
still use the feature. This works in both request and reply traffic.

The access denial approach erases other agents Via headers. Rendering
any use of that feature broken for that other software.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020832.html">[squid-users] Blocking CONNECT
</A></li>
	<LI>Next message (by thread): <A HREF="020834.html">[squid-users] logformat for squid5 ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20833">[ date ]</a>
              <a href="thread.html#20833">[ thread ]</a>
              <a href="subject.html#20833">[ subject ]</a>
              <a href="author.html#20833">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
