<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Problems with squid 3.1 to 3.3 upgrade
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Problems%20with%20squid%203.1%20to%203.3%20upgrade&In-Reply-To=%3CCAGZ9WNo-U1CfbWJuPzE0XxkZavmYDUKj7n%2BTRgrbK9qbNOhGRA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020894.html">
   <LINK REL="Next"  HREF="020861.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Problems with squid 3.1 to 3.3 upgrade</H1>
    <B>Tom Karches</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Problems%20with%20squid%203.1%20to%203.3%20upgrade&In-Reply-To=%3CCAGZ9WNo-U1CfbWJuPzE0XxkZavmYDUKj7n%2BTRgrbK9qbNOhGRA%40mail.gmail.com%3E"
       TITLE="[squid-users] Problems with squid 3.1 to 3.3 upgrade">twk at ncsu.edu
       </A><BR>
    <I>Thu Aug  8 19:29:36 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020894.html">[squid-users] acl src question
</A></li>
        <LI>Next message (by thread): <A HREF="020861.html">[squid-users] Problems with squid 3.1 to 3.3 upgrade
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20860">[ date ]</a>
              <a href="thread.html#20860">[ thread ]</a>
              <a href="subject.html#20860">[ subject ]</a>
              <a href="author.html#20860">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I am in the process of upgrading our Squid proxy server from 3.1 (on RHEL6)
to 3.3 (on RHEL7). It is configured as a explicit (not transparent) proxy
that listens on port 3128. Clients are explicitly configured to use the
proxy.

On the 3.3 system with the same squid.conf as the 3.1 system (I have made
changes to fix warnings), the system is able to proxy internal (*.ncsu.edu)
http traffic and https traffic. Anything https outside the ncsu.edu domain
fails.

The system (which does not use caching) was configured to log https
transactions as such :

1565183014.309    230 127.0.0.1 TCP_MISS/200 62539 CONNECT
entrepreneurship.ncsu.edu:443 - DIRECT/152.1.227.116 -

which requires SSL Bumping (I believe), though there is no reference in the
current configs to the use of SSL bumping .

I used curl to test the new proxy. When I attempt to proxy an external
https connection, this is the result :

$ curl --proxy <A HREF="http://127.0.0.1:3128">http://127.0.0.1:3128</A> <A HREF="https://www.google.com">https://www.google.com</A>
curl: (56) Received HTTP code 503 from proxy after CONNECT

Proxying internal (ncsu.edu) connections this way is working correctly for
http and https

When I change my squid.conf from :

http_port 3128

to

http_port 3128 ssl-bump \
   cert=/etc/pki/ca-trust/extracted/pem/tls-ca-bundle.pem \
   generate-host-certificates=on dynamic_cert_mem_cache_size=4MB

I now get the following error

squid[5796]: FATAL: No valid signing SSL certificate configured for
&gt;<i> HTTP_port [::]:3128
</I>

The certs on the new server are newer, but otherwise appear to be correct.

Are there changes in the SSL bump config between 3.1 and 3.3 that would
cause this kind of failure? Where should I be looking for the problem?

No previous experience with squid until this project. I've been doing much
RTM (including the O'Reilly Squid book) searching online and debugging
these past few days. Suggestions appreciated.

Thanks,
Tom

-- 
Thomas Karches
NCSU OIT CSI - Systems Specialist
M.E Student - STEM Education
Hillsborough 319 / 919.515.5508
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20190808/874d8603/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20190808/874d8603/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020894.html">[squid-users] acl src question
</A></li>
	<LI>Next message (by thread): <A HREF="020861.html">[squid-users] Problems with squid 3.1 to 3.3 upgrade
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20860">[ date ]</a>
              <a href="thread.html#20860">[ thread ]</a>
              <a href="subject.html#20860">[ subject ]</a>
              <a href="author.html#20860">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
