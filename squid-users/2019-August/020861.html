<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Problems with squid 3.1 to 3.3 upgrade
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Problems%20with%20squid%203.1%20to%203.3%20upgrade&In-Reply-To=%3Caccc24de-c28f-1313-f9e3-dce1f1a26254%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020860.html">
   <LINK REL="Next"  HREF="020864.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Problems with squid 3.1 to 3.3 upgrade</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Problems%20with%20squid%203.1%20to%203.3%20upgrade&In-Reply-To=%3Caccc24de-c28f-1313-f9e3-dce1f1a26254%40measurement-factory.com%3E"
       TITLE="[squid-users] Problems with squid 3.1 to 3.3 upgrade">rousskov at measurement-factory.com
       </A><BR>
    <I>Thu Aug  8 22:05:18 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020860.html">[squid-users] Problems with squid 3.1 to 3.3 upgrade
</A></li>
        <LI>Next message (by thread): <A HREF="020864.html">[squid-users] Problems with squid 3.1 to 3.3 upgrade
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20861">[ date ]</a>
              <a href="thread.html#20861">[ thread ]</a>
              <a href="subject.html#20861">[ subject ]</a>
              <a href="author.html#20861">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 8/8/19 3:29 PM, Tom Karches wrote:

&gt;<i> I am in the process of upgrading our Squid proxy server from 3.1 (on
</I>&gt;<i> RHEL6) to 3.3 (on RHEL7).
</I>
It could have been worse! For example, you could ask a question about
upgrading Squid from v1.0 to v2.0... I will try to help, but I do not
remember much about v3.3 specifics.


&gt;<i> The system was configured to log https transactions as such:
</I>
&gt;<i> 1565183014.309 &#160; &#160;230 127.0.0.1 TCP_MISS/200 62539 CONNECT
</I>&gt;<i> entrepreneurship.ncsu.edu:443 - DIRECT/152.1.227.116 -
</I>
&gt;<i> which requires SSL Bumping
</I>
No, simply logging HTTP CONNECT requests does not require bumping SSL.


&gt;<i> I used curl to test the new proxy. When I attempt to proxy an external
</I>&gt;<i> https connection, this is the result :
</I>
&gt;<i> $ curl --proxy <A HREF="http://127.0.0.1:3128">http://127.0.0.1:3128</A> <A HREF="https://www.google.com">https://www.google.com</A>
</I>&gt;<i> curl: (56) Received HTTP code 503 from proxy after CONNECT
</I>
Your Squid told curl that something went wrong. If you look at the
actual response, you may know what went wrong. The same information may
be available in Squid access.log, but the error response may have more
details than a log record. Please share that info here if it does not
point you to a solution.


&gt;<i> http_port 3128 ssl-bump \
</I>&gt;<i> &#160; &#160;cert=/etc/pki/ca-trust/extracted/pem/tls-ca-bundle.pem \
</I>&gt;<i> &#160; &#160;generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
</I>
&gt;<i> I now get the following error
</I>
&gt;<i>     squid[5796]: FATAL: No valid signing SSL certificate configured for
</I>&gt;<i>     HTTP_port [::]:3128
</I>

Avoid opening the SslBump Pandora box until you have to. If all you need
is CONNECT logging, then you should be able to accomplish what you want
without SslBump pains.


&gt;<i> Where should I be looking for the problem?
</I>
In Squid response to curl. You can use curl tracing options or Wireshark
to see it. Squid access.log may have some clues as well.


Go Tuffy!

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020860.html">[squid-users] Problems with squid 3.1 to 3.3 upgrade
</A></li>
	<LI>Next message (by thread): <A HREF="020864.html">[squid-users] Problems with squid 3.1 to 3.3 upgrade
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20861">[ date ]</a>
              <a href="thread.html#20861">[ thread ]</a>
              <a href="subject.html#20861">[ subject ]</a>
              <a href="author.html#20861">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
