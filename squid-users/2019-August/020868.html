<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Problems with squid 3.1 to 3.3 upgrade
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Problems%20with%20squid%203.1%20to%203.3%20upgrade&In-Reply-To=%3CCAGZ9WNqarg5adAoG%3DzTYOLn6QWeCBQK2y9jJ7HbtLC9v06fQug%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020867.html">
   <LINK REL="Next"  HREF="020869.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Problems with squid 3.1 to 3.3 upgrade</H1>
    <B>Tom Karches</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Problems%20with%20squid%203.1%20to%203.3%20upgrade&In-Reply-To=%3CCAGZ9WNqarg5adAoG%3DzTYOLn6QWeCBQK2y9jJ7HbtLC9v06fQug%40mail.gmail.com%3E"
       TITLE="[squid-users] Problems with squid 3.1 to 3.3 upgrade">twk at ncsu.edu
       </A><BR>
    <I>Fri Aug  9 20:32:59 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020867.html">[squid-users] Problems with squid 3.1 to 3.3 upgrade
</A></li>
        <LI>Next message (by thread): <A HREF="020869.html">[squid-users] Problems with squid 3.1 to 3.3 upgrade
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20868">[ date ]</a>
              <a href="thread.html#20868">[ thread ]</a>
              <a href="subject.html#20868">[ subject ]</a>
              <a href="author.html#20868">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Fri, Aug 9, 2019 at 2:37 PM Alex Rousskov &lt;
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt; wrote:

&gt;<i> On 8/9/19 1:37 PM, Tom Karches wrote:
</I>&gt;<i> &gt; On Fri, Aug 9, 2019 at 11:38 AM Alex Rousskov wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; Ok, here is the info from the real trace. First time with #dns_v4_first
</I>&gt;<i> &gt; on  commented out, 2nd time &quot;dns_v4_ first on&quot; is active. Difference is
</I>&gt;<i> &gt; with no &quot;dns_v4_first on&quot; directive, I get a RR_CONNECT_FAIL 111. When
</I>&gt;<i> &gt; active, I get a RR_CONNECT_FAIL 101.
</I>&gt;<i>
</I>&gt;<i> BTW, it may be easier for you to read --trace--ascii output.
</I>&gt;<i>
</I>
I didn't see anything additional using the ascii option, though it is
easier to read


&gt;<i>
</I>&gt;<i> Both are ERR_CONNECT_FAIL errors (&quot;connection reset by peer&quot; and
</I>&gt;<i> &quot;connection refused&quot;). Your Squid cannot connect to where it needs to
</I>&gt;<i> connect in order to establish a TCP tunnel. It could be a Squid
</I>&gt;<i> misconfiguration, a routing problem, insufficient capabilities, and many
</I>&gt;<i> other things.
</I>&gt;<i>
</I>&gt;<i> I suggest checking cache.log for WARNINGs and ERRORs. After arriving at
</I>&gt;<i> a clean cache.log, I would use a packet capture (or similar) to see
</I>&gt;<i> where Squid is trying to connect (and which local address it is
</I>&gt;<i> connecting from). That information may be enough to figure out why Squid
</I>&gt;<i> cannot connect successfully.
</I>&gt;<i>
</I>&gt;<i>
</I>This is what I am seeing from cache.log when I attempt the proxy :



2019/08/09 16:19:08.127 kid1| 33,2| client_side.cc(817) swanSong: local=
127.0.0.1:3128 remote=127.0.0.1:33428 flags=1
2019/08/09 16:19:10.051 kid1| 33,2| client_side.cc(817) swanSong: local=
152.7.114.135:3128 remote=10.50.54.21:43198 flags=1

Right now my debug is set to ALL,1 33,2. Is there a better set of options
to provide me more visibility of what might be wrong?

Here is our config file, in case that helps. If it's something obvious I'm
not seeing. We have some whitelists, but I am running with those turned off
until this is working so I won't include them here. Thanks for the help.

Tom

# squid config file - 2019-08-09
# Timeouts
connect_timeout 2 minutes  # For CDWG Vendor
debug_options ALL,1 33,2

dns_v4_first on

acl SSL_ports port 443
acl SSL_ports port 1443     # b2b-test.apple.com:1443
acl SSL_ports port 3079     # bci.stapleslink.com special port
acl SSL_ports port 4443     # pascal.apple.com:4443
acl SSL_ports port 993      # IMAP from Stat application to Gmail
acl SSL_ports port 22       # Allow SSH and SFTP to proxy/connect
acl SSL_ports port 8443     # redhat cap port


acl Safe_ports port 80          # http
acl Safe_ports port 21          # ftp
acl Safe_ports port 443         # https
acl Safe_ports port 70          # gopher
acl Safe_ports port 210         # wais
acl Safe_ports port 1025-65535  # unregistered ports
acl Safe_ports port 280         # http-mgmt
acl Safe_ports port 488         # gss-http
acl Safe_ports port 591         # filemaker
acl Safe_ports port 777         # multiling http
acl Safe_ports port 5228        # google services
acl Safe_ports port 1935        # cam steamer port
acl Safe_ports port 8443        # redhat cap port
acl CONNECT method CONNECT

#
# Recommended minimum Access Permission configuration:
#
# Only allow cachemgr access from localhost
http_access allow manager localhost
http_access deny manager

# Deny requests to certain unsafe ports
http_access deny !Safe_ports

# Deny CONNECT to other than secure SSL ports
http_access deny CONNECT !SSL_ports

# We strongly recommend the following be uncommented to protect innocent
# web applications running on the proxy server who think the only
# one who can access services on &quot;localhost&quot; is a local user
#http_access deny to_localhost

#
# INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
#

# Example rule allowing access from your local networks.
# Adapt localnet in the ACL section to list your (internal) IP networks
# from where browsing should be allowed
http_access allow localnet
http_access allow localhost

# And finally deny all other access to this proxy
http_access deny all

icp_access deny all

# Squid normally listens to port 3128
http_port 3128

# Uncomment and adjust the following to add a disk cache directory.
#cache_dir ufs /var/spool/squid 2048 16 256

# Default configuration value for cache_mem
#cache_mem 256 MB
cache deny all

# Leave coredumps in the first cache dir
coredump_dir /var/spool/squid

# Add any of your own refresh_pattern entries above these.
refresh_pattern ^ftp:           1440    20%     10080
refresh_pattern ^gopher:        1440    0%      1440
refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
refresh_pattern .               0       20%     4320

max_filedescriptors 65000

-- 
Thomas Karches
NCSU OIT CSI - Systems Specialist
M.E Student - Technology Education
Hillsborough 319 / 919.515.5508
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20190809/7398ea29/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20190809/7398ea29/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020867.html">[squid-users] Problems with squid 3.1 to 3.3 upgrade
</A></li>
	<LI>Next message (by thread): <A HREF="020869.html">[squid-users] Problems with squid 3.1 to 3.3 upgrade
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20868">[ date ]</a>
              <a href="thread.html#20868">[ thread ]</a>
              <a href="subject.html#20868">[ subject ]</a>
              <a href="author.html#20868">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
