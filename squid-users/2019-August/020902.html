<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Getting lot of client lifetime timeout and subsequently running out of file descriptors
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Getting%20lot%20of%20client%20lifetime%20timeout%20and%0A%20subsequently%20running%20out%20of%20file%20descriptors&In-Reply-To=%3Cb455b2d8ffc4f3e8cfdda59c5022320e%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020900.html">
   <LINK REL="Next"  HREF="020903.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Getting lot of client lifetime timeout and subsequently running out of file descriptors</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Getting%20lot%20of%20client%20lifetime%20timeout%20and%0A%20subsequently%20running%20out%20of%20file%20descriptors&In-Reply-To=%3Cb455b2d8ffc4f3e8cfdda59c5022320e%40treenet.co.nz%3E"
       TITLE="[squid-users] Getting lot of client lifetime timeout and subsequently running out of file descriptors">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon Aug 19 01:57:39 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020900.html">[squid-users] Getting lot of client lifetime timeout and subsequently running out of file descriptors
</A></li>
        <LI>Next message (by thread): <A HREF="020903.html">[squid-users] squid for live streaming
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20902">[ date ]</a>
              <a href="thread.html#20902">[ thread ]</a>
              <a href="subject.html#20902">[ subject ]</a>
              <a href="author.html#20902">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2019-08-19 07:14, Chirayu Patel wrote:
&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> I am running squid version 4.6 and have set the file descriptors limit
</I>&gt;<i> to 5000
</I>&gt;<i> 
</I>&gt;<i> I get an average of 1 lakh hits daily and in a day or 2 , I start
</I>&gt;<i> getting these messages :
</I>&gt;<i> 
</I>&gt;<i> Sun Aug 18 15:00:29 2019 daemon.notice squid[4906]: WARNING: Closing
</I>&gt;<i> client connection due to lifetime timeout
</I>...
&gt;<i> 
</I>&gt;<i> 1. Should i decrease the client_lifetime ? Or should i increase the
</I>&gt;<i> File Descriptor limit ? or adjust the timeouts
</I>&gt;<i> 
</I>
I would be looking into why these clients are having such long 
connection times that they hit the 1 day lifetime limit.

If they do not actually need connections open for that whole time, then 
lowering the client_lifetime is safe enough. You will still get these 
log entries, no avoiding that since the clients are holding onto 
connections.

You may be able to raise the FD limits as well. On a limited devices I 
would pair that with lowering the read_ahead_gap to 8 KB.


&gt;<i> 2. Also, there is a steady increase of memory on the device.. Squid is
</I>&gt;<i> currently installed on an Access Point which is  a resource
</I>&gt;<i> constrained device.. Is there any way to control it..
</I>&gt;<i> 
</I>
Steadily increasing number of very log-lived client connections is 
likely th esource of that, each will be using up to 256KB of I/O 
buffers. Preventing too many connections in parallel is the best thing 
for that, so you are on the right track trying to remove/reduce these 
ones hitting the lifetime.


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020900.html">[squid-users] Getting lot of client lifetime timeout and subsequently running out of file descriptors
</A></li>
	<LI>Next message (by thread): <A HREF="020903.html">[squid-users] squid for live streaming
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20902">[ date ]</a>
              <a href="thread.html#20902">[ thread ]</a>
              <a href="subject.html#20902">[ subject ]</a>
              <a href="author.html#20902">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
