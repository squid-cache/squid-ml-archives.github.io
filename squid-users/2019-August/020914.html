<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] TCP_MISS_ABORTED/503 - -Squid-Error: ERR_DNS_FAIL	0
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TCP_MISS_ABORTED/503%20-%20-Squid-Error%3A%20ERR_DNS_FAIL%0A%090&In-Reply-To=%3C43edef18-288e-0bb4-cd9a-f8e55714892d%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020913.html">
   <LINK REL="Next"  HREF="020915.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] TCP_MISS_ABORTED/503 - -Squid-Error: ERR_DNS_FAIL	0</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TCP_MISS_ABORTED/503%20-%20-Squid-Error%3A%20ERR_DNS_FAIL%0A%090&In-Reply-To=%3C43edef18-288e-0bb4-cd9a-f8e55714892d%40treenet.co.nz%3E"
       TITLE="[squid-users] TCP_MISS_ABORTED/503 - -Squid-Error: ERR_DNS_FAIL	0">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Aug 21 11:41:40 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020913.html">[squid-users] TCP_MISS_ABORTED/503 - -Squid-Error: ERR_DNS_FAIL	0
</A></li>
        <LI>Next message (by thread): <A HREF="020915.html">[squid-users] TCP_MISS_ABORTED/503 - -Squid-Error: ERR_DNS_FAIL	0
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20914">[ date ]</a>
              <a href="thread.html#20914">[ thread ]</a>
              <a href="subject.html#20914">[ subject ]</a>
              <a href="author.html#20914">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 21/08/19 3:51 pm, L A Walsh wrote:
&gt;<i> Pulled this out of my log.  Downloading lots of files through squid has
</I>&gt;<i> the download aborting after about 3k files.  This is the first I've seen
</I>&gt;<i> that there's also an associated ERR_DNS_FAIL -- is that a message from
</I>&gt;<i> squid's internal resolver?
</I>
Indirectly. It will be the result of DNS failure on the domain in that
particular transactions URL.

You mentioned the ABORTED was repeatable. If this DNS_FAIL was not
always present, what was?


&gt;<i> 
</I>&gt;<i> 1566304848.234      1 192.168.3.1 TCP_MISS_ABORTED/503 4185 GET
</I>&gt;<i> <A HREF="http://download.">http://download.</A>
</I>&gt;<i> opensuse.org/tumbleweed/repo/src-oss/src/gdouros-aegean-fonts-9.78-1.6.src.rpm
</I>&gt;<i> - HIER_NONE/- text/html [Referer:
</I>&gt;<i> <A HREF="http://download.opensuse.org/tumbleweed/repo/src-oss/src/\r\nUser-Agent:">http://download.opensuse.org/tumbleweed/repo/src-oss/src/\r\nUser-Agent:</A>
</I>&gt;<i> openSuSE_Client\r\nAccept: */*\r\nAccept-Encoding:
</I>&gt;<i> identity\r\nConnection: Keep-Alive\r\nProxy-Connection:
</I>&gt;<i> Keep-Alive\r\nHost: download.opensuse.org\r\n] [HTTP/1.1 503 Service
</I>&gt;<i> Unavailable\r\nServer: squid/4.0.25\r\nMime-Version: 1.0\r\nDate: Tue,
</I>
Please upgrade your Squid. That is a beta release. Squid-4 has been in
stable/production releases for over a year now.


&gt;<i> 20 Aug 2019 12:40:48 GMT\r\nContent-Type:
</I>&gt;<i> text/html;charset=utf-8\r\nContent-Length: 4163\r\nX-Squid-Error:
</I>&gt;<i> ERR_DNS_FAIL 0\r\nContent-Language: en\r\n\r]
</I>&gt;<i> 
</I>&gt;<i> One thing -- all the files were being downloaded in 1 copy of wget, so
</I>&gt;<i> it was
</I>&gt;<i> a long connection.
</I>
This makes me suspect the timing may be important. Check if these 3k
transactions all terminated the same amount of time after their TCP
connection was opened by the client.
 If they are or very close to similar timing before the end. Look for
somewhere that may be timing out (could be Squid, or the TCP stack or
any routers along the way.


&gt;<i> 
</I>&gt;<i> If I don't go through the proxy, it does download, but its hard to see
</I>&gt;<i> why DNS
</I>&gt;<i> would ahve a problem only 4 hosts are accessed in the download:
</I>&gt;<i> 
</I>
The hostname needs to be looked up on every request (HTTP being
stateless). The Squid internal resolver does cache names for the DNS
provided TTL, when that expires they may need to be re-resolved and hit
a failure then.


&gt;<i> 
</I>&gt;<i>    1027 <A HREF="http://download.opensuse.org">http://download.opensuse.org</A>
</I>&gt;<i>       2 <A HREF="http://ftp1.nluug.nl">http://ftp1.nluug.nl</A>
</I>&gt;<i>    2030 <A HREF="http://mirror.sfo12.us.leaseweb.net">http://mirror.sfo12.us.leaseweb.net</A>
</I>&gt;<i>      14 <A HREF="http://mirrors.acm.wpi.edu">http://mirrors.acm.wpi.edu</A>
</I>&gt;<i> 
</I>&gt;<i> 3073...
</I>&gt;<i> 
</I>&gt;<i>     Looks like it's exactly 3k lookups and death on 3k+1
</I>&gt;<i> 
</I>&gt;<i> ring any bells?
</I>
There is nothing in Squid that is tied to a particular number of
transactions. An infinite number of HTTP/1.x requests may be processed
on a TCP connection.

It is more likely to be timing or bandwidth related. Some network level
thing. The error message &quot;page content&quot; Squid produces on that last
request each time would be useful info.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020913.html">[squid-users] TCP_MISS_ABORTED/503 - -Squid-Error: ERR_DNS_FAIL	0
</A></li>
	<LI>Next message (by thread): <A HREF="020915.html">[squid-users] TCP_MISS_ABORTED/503 - -Squid-Error: ERR_DNS_FAIL	0
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20914">[ date ]</a>
              <a href="thread.html#20914">[ thread ]</a>
              <a href="subject.html#20914">[ subject ]</a>
              <a href="author.html#20914">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
