<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] TCP_MISS_ABORTED/503 - -Squid-Error: ERR_DNS_FAIL	0
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TCP_MISS_ABORTED/503%20-%20-Squid-Error%3A%20ERR_DNS_FAIL%0A%090&In-Reply-To=%3C5D5D8D11.8030708%40tlinx.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020914.html">
   <LINK REL="Next"  HREF="020916.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] TCP_MISS_ABORTED/503 - -Squid-Error: ERR_DNS_FAIL	0</H1>
    <B>L A Walsh</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TCP_MISS_ABORTED/503%20-%20-Squid-Error%3A%20ERR_DNS_FAIL%0A%090&In-Reply-To=%3C5D5D8D11.8030708%40tlinx.org%3E"
       TITLE="[squid-users] TCP_MISS_ABORTED/503 - -Squid-Error: ERR_DNS_FAIL	0">squid-user at tlinx.org
       </A><BR>
    <I>Wed Aug 21 18:27:29 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020914.html">[squid-users] TCP_MISS_ABORTED/503 - -Squid-Error: ERR_DNS_FAIL	0
</A></li>
        <LI>Next message (by thread): <A HREF="020916.html">[squid-users] SQUID proxy to access web application from another	subnet
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20915">[ date ]</a>
              <a href="thread.html#20915">[ thread ]</a>
              <a href="subject.html#20915">[ subject ]</a>
              <a href="author.html#20915">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2019/08/21 04:41, Amos Jeffries wrote:
&gt;<i> On 21/08/19 3:51 pm, L A Walsh wrote:
</I>&gt;<i>   
</I>&gt;&gt;<i> Pulled this out of my log.  Downloading lots of files through squid has
</I>&gt;&gt;<i> the download aborting after about 3k files.  This is the first I've seen
</I>&gt;&gt;<i> that there's also an associated ERR_DNS_FAIL -- is that a message from
</I>&gt;&gt;<i> squid's internal resolver?
</I>&gt;&gt;<i>     
</I>&gt;<i>
</I>&gt;<i> Indirectly. It will be the result of DNS failure on the domain in that
</I>&gt;<i> particular transactions URL.
</I>&gt;<i>
</I>&gt;<i> You mentioned the ABORTED was repeatable. If this DNS_FAIL was not
</I>&gt;<i> always present, what was?
</I>&gt;<i>   
</I>----
    Well not several months ago, but in the past 1-2 seems like it.


&gt;<i>
</I>&gt;<i>   
</I>&gt;&gt;<i> 1566304848.234      1 192.168.3.1 TCP_MISS_ABORTED/503 4185 GET
</I>&gt;&gt;<i> <A HREF="http://download.">http://download.</A>
</I>&gt;&gt;<i> opensuse.org/tumbleweed/repo/src-oss/src/gdouros-aegean-fonts-9.78-1.6.src.rpm
</I>&gt;&gt;<i> - HIER_NONE/- text/html [Referer:
</I>&gt;&gt;<i> <A HREF="http://download.opensuse.org/tumbleweed/repo/src-oss/src/\r\nUser-Agent:">http://download.opensuse.org/tumbleweed/repo/src-oss/src/\r\nUser-Agent:</A>
</I>&gt;&gt;<i> openSuSE_Client\r\nAccept: */*\r\nAccept-Encoding:
</I>&gt;&gt;<i> identity\r\nConnection: Keep-Alive\r\nProxy-Connection:
</I>&gt;&gt;<i> Keep-Alive\r\nHost: download.opensuse.org\r\n] [HTTP/1.1 503 Service
</I>&gt;&gt;<i> Unavailable\r\nServer: squid/4.0.25\r\nMime-Version: 1.0\r\nDate: Tue,
</I>&gt;&gt;<i>     
</I>&gt;<i>
</I>&gt;<i> Please upgrade your Squid. That is a beta release. Squid-4 has been in
</I>&gt;<i> stable/production releases for over a year now.
</I>&gt;<i>   
</I>----
    Yeah, just put together 4.8 and need to install, somehow I'm finding
it hard to believe it is in squid, it's just the piece that is bearing
the &quot;bad news&quot;...but probably pointing at something else.



&gt;<i>
</I>&gt;<i>   
</I>&gt;&gt;<i> 20 Aug 2019 12:40:48 GMT\r\nContent-Type:
</I>&gt;&gt;<i> text/html;charset=utf-8\r\nContent-Length: 4163\r\nX-Squid-Error:
</I>&gt;&gt;<i> ERR_DNS_FAIL 0\r\nContent-Language: en\r\n\r]
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> One thing -- all the files were being downloaded in 1 copy of wget, so
</I>&gt;&gt;<i> it was
</I>&gt;&gt;<i> a long connection.
</I>&gt;&gt;<i>     
</I>&gt;<i>
</I>&gt;<i> This makes me suspect the timing may be important. Check if these 3k
</I>&gt;<i> transactions all terminated the same amount of time after their TCP
</I>&gt;<i> connection was opened by the client.
</I>&gt;<i>  If they are or very close to similar timing before the end. Look for
</I>&gt;<i> somewhere that may be timing out (could be Squid, or the TCP stack or
</I>&gt;<i> any routers along the way.
</I>&gt;<i>   
</I>----
    Don't see anything in the named logs either, but it maybe that it is
not recording these types of events, and my nssswitch for hosts does a
roll-over:

hosts:  files  dns wins

---
but wins isn't recording very much detail. 


&gt;<i>
</I>&gt;<i>   
</I>&gt;&gt;<i> If I don't go through the proxy, it does download, but its hard to see
</I>&gt;&gt;<i> why DNS
</I>&gt;&gt;<i> would ahve a problem only 4 hosts are accessed in the download:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     
</I>&gt;<i>
</I>&gt;<i> The hostname needs to be looked up on every request (HTTP being
</I>&gt;<i> stateless). The Squid internal resolver does cache names for the DNS
</I>&gt;<i> provided TTL, when that expires they may need to be re-resolved and hit
</I>&gt;<i> a failure then.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>   
</I>&gt;&gt;<i>    1027 <A HREF="http://download.opensuse.org">http://download.opensuse.org</A>
</I>&gt;&gt;<i>       2 <A HREF="http://ftp1.nluug.nl">http://ftp1.nluug.nl</A>
</I>&gt;&gt;<i>    2030 <A HREF="http://mirror.sfo12.us.leaseweb.net">http://mirror.sfo12.us.leaseweb.net</A>
</I>&gt;&gt;<i>      14 <A HREF="http://mirrors.acm.wpi.edu">http://mirrors.acm.wpi.edu</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 3073...
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     Looks like it's exactly 3k lookups and death on 3k+1
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ring any bells?
</I>&gt;&gt;<i>     
</I>&gt;<i>
</I>&gt;<i> There is nothing in Squid that is tied to a particular number of
</I>&gt;<i> transactions. An infinite number of HTTP/1.x requests may be processed
</I>&gt;<i> on a TCP connection.
</I>&gt;<i>
</I>&gt;<i> It is more likely to be timing or bandwidth related. Some network level
</I>&gt;<i> thing. The error message &quot;page content&quot; Squid produces on that last
</I>&gt;<i> request each time would be useful info.
</I>&gt;<i>   
</I>
---
    Everything was being fetched through wget, so no error page,
exactly, but here is the border in the log of last working to 1st non
working:
--2019-08-20 05:40:31-- 
<A HREF="http://download.opensuse.org/tumbleweed/repo/oss/x86_64/cmus-plugins-all-2.8.0~20190219.ge27e813-1.5.x86_64.rpm">http://download.opensuse.org/tumbleweed/repo/oss/x86_64/cmus-plugins-all-2.8.0~20190219.ge27e813-1.5.x86_64.rpm</A>
Reusing existing connection to ishtar.sc.tlinx.org:8080.
Proxy request sent, awaiting response... 302 Found
Location:
<A HREF="http://mirror.sfo12.us.leaseweb.net/opensuse/tumbleweed/repo/oss/x86_64/cmus-plugins-all-2.8.0~20190219.ge27e813-1.5.x86_64.rpm">http://mirror.sfo12.us.leaseweb.net/opensuse/tumbleweed/repo/oss/x86_64/cmus-plugins-all-2.8.0~20190219.ge27e813-1.5.x86_64.rpm</A>
[following]
--2019-08-20 05:40:34-- 
<A HREF="http://mirror.sfo12.us.leaseweb.net/opensuse/tumbleweed/repo/oss/x86_64/cmus-plugins-all-2.8.0~20190219.ge27e813-1.5.x86_64.rpm">http://mirror.sfo12.us.leaseweb.net/opensuse/tumbleweed/repo/oss/x86_64/cmus-plugins-all-2.8.0~20190219.ge27e813-1.5.x86_64.rpm</A>
Reusing existing connection to ishtar.sc.tlinx.org:8080.
Proxy request sent, awaiting response... 304 Not Modified
File
&#8216;tumbleweed/repo/oss/x86_64/cmus-plugins-all-2.8.0~20190219.ge27e813-1.5.x86_64.rpm&#8217;
not modified on server. Omitting download.

--2019-08-20 05:40:35-- 
<A HREF="http://download.opensuse.org/tumbleweed/repo/oss/x86_64/cni-0.7.1-1.1.x86_64.rpm">http://download.opensuse.org/tumbleweed/repo/oss/x86_64/cni-0.7.1-1.1.x86_64.rpm</A>
Reusing existing connection to ishtar.sc.tlinx.org:8080.
Proxy request sent, awaiting response... 503 Service Unavailable
2019-08-20 05:40:45 ERROR 503: Service Unavailable.
------------------------------------------------------

So 3072 requests where I got that my connection to the proxy was being
&quot;reused&quot;
and most  of the requests were not modified from a previous run, saw a few
that actually downloaded, but they were in the minority.

Then a 503 -- and answer fills the rest of the log.  It's an alphabetical
download only into the 'c's. 


Well Need to try new squid binary and see if it does anything different.

If I find anything out, will post back.
Thanks all for responses.






</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020914.html">[squid-users] TCP_MISS_ABORTED/503 - -Squid-Error: ERR_DNS_FAIL	0
</A></li>
	<LI>Next message (by thread): <A HREF="020916.html">[squid-users] SQUID proxy to access web application from another	subnet
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20915">[ date ]</a>
              <a href="thread.html#20915">[ thread ]</a>
              <a href="subject.html#20915">[ subject ]</a>
              <a href="author.html#20915">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
