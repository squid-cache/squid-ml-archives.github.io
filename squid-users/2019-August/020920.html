<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] FW: AD user Login + Squid Proxy + Automatic Authentication
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20FW%3A%20AD%20user%20Login%20%2B%20Squid%20Proxy%20%2B%20Automatic%0A%20Authentication&In-Reply-To=%3Cvmime.5d5f960c.4cae.331bd254678d88cc%40ms249-lin-003.rotterdam.bazuin.nl%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020919.html">
   <LINK REL="Next"  HREF="020921.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] FW: AD user Login + Squid Proxy + Automatic Authentication</H1>
    <B>L.P.H. van Belle</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20FW%3A%20AD%20user%20Login%20%2B%20Squid%20Proxy%20%2B%20Automatic%0A%20Authentication&In-Reply-To=%3Cvmime.5d5f960c.4cae.331bd254678d88cc%40ms249-lin-003.rotterdam.bazuin.nl%3E"
       TITLE="[squid-users] FW: AD user Login + Squid Proxy + Automatic Authentication">belle at bazuin.nl
       </A><BR>
    <I>Fri Aug 23 07:30:20 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020919.html">[squid-users] AD user Login + Squid Proxy + Automatic	Authentication
</A></li>
        <LI>Next message (by thread): <A HREF="020921.html">[squid-users] Help with IP forwarder on squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20920">[ date ]</a>
              <a href="thread.html#20920">[ thread ]</a>
              <a href="subject.html#20920">[ subject ]</a>
              <a href="author.html#20920">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&#160;




The most simple way to add SSO. 
&#160;
Install winbind krb5-user, then&#160;your smb.conf,&#160; update this config : 
[global]
&#160;&#160;&#160; # Auth-Only setup with winbind. ( no Shares )
&#160;&#160;&#160;&#160;log level = 1
&#160;&#160;&#160; workgroup = NTDOM
&#160;&#160;&#160; security = ADS
&#160;&#160;&#160; realm = YOUR-REALM
&#160;&#160;&#160; netbios name = HOSTNAME
&#160;
&#160;&#160;&#160; preferred master = no
&#160;&#160;&#160; domain master = no
&#160;&#160;&#160; host msdfs = no
&#160;&#160;&#160; dns proxy = yes
&#160;
&#160;&#160;&#160; interfaces = eth0 lo
&#160;&#160;&#160; bind interfaces only = yes
&#160;
&#160;&#160;&#160; #Add and Update TLS Key
&#160;# Add the root cert and clients certs here, add the rootCA with GPO to the pc's. 
&#160;&#160;&#160; tls enabled = yes
&#160;&#160;&#160; tls keyfile = /etc/ssl/private/HOSTNAME.key.pem
&#160;&#160;&#160; tls certfile = /etc/ssl/certs/HOSTNAME.cert.pem
&#160;&#160;&#160; tls cafile = /etc/ssl/certs/ROOT-ca.crt
&#160;
&#160;&#160;&#160; ## map id's outside to domain to tdb files.
&#160;&#160;&#160; idmap config *: backend = tdb
&#160;&#160;&#160; idmap config *: range = 2000-9999
&#160;
&#160;&#160;&#160; ## map ids from the domain and (*) the range may not overlap !
&#160;&#160;&#160; idmap config NTDOM : backend = rid
&#160;&#160;&#160; idmap config NTDOM : schema_mode = rfc2307
&#160;&#160;&#160; idmap config NTDOM : range = 10000-3999999
&#160;
&#160;# Samba 4.6+ ( get primary group from AD ) ( Samba AD-Backend )
&#160;&#160;&#160; #idmap config NTDOM : unix_nss_info = yes
&#160;# Samba 4.6+ ( get primary group from unix primary group )
&#160;&#160;&#160; #idmap config NTDOM : unix_primary_group = yes
###########
&#160;
&#160;&#160;&#160; kerberos method = secrets and keytab
&#160;&#160;&#160; dedicated keytab file = /etc/krb5.keytab
&#160;
&#160;&#160;&#160; # renew the kerberos ticket
&#160;&#160;&#160; winbind refresh tickets = yes
&#160;
&#160;&#160;&#160; # We strip the domain (NTDOM\username) to username
&#160;&#160;&#160; winbind use default domain = yes
&#160;
&#160;&#160;&#160; # enable offline logins
&#160;&#160;&#160; winbind offline logon = yes
&#160;
&#160;&#160;&#160; # check depth of nested groups, ! slows down you samba, if to much groups depth
&#160;&#160;&#160; # Not needed on the VPN server.
&#160;&#160;&#160; #winbind expand groups = 2
&#160;
&#160;&#160;&#160; # user Administrator workaround, without it you are unable to set privileges
&#160;&#160;&#160; username map = /etc/samba/samba_usermapping
&#160;
&#160;&#160;&#160; # disable usershares creating
&#160;&#160;&#160; usershare path =
&#160;
&#160;&#160;&#160; # Disable printing completely
&#160;&#160;&#160; load printers = no
&#160;&#160;&#160; printing = bsd
&#160;&#160;&#160; printcap name = /dev/null
&#160;&#160;&#160; disable spoolss = yes
&#160;
&#160;&#160;&#160; # For ACL support on member servers with shares, OBLIGATES
&#160;&#160;&#160; vfs objects = acl_xattr
&#160;&#160;&#160; map acl inherit = Yes
&#160;&#160;&#160; store dos attributes = Yes
&#160;
######## SHARE DEFINITIONS ################

&#160;
# Next TODO.&#160; Join the AD-DC domain. 
kinit Administrator
net ads join 
&#160;
# setup keytab for squid. 
&#160;
export KRB5_KTNAME=FILE:/etc/squid/HTTP-$(hostname -s).keytab
net ads keytab ADD HTTP/$(hostname -f)
# check keytab file.
klist -ke /etc/squid/HTTP-$(hostname -s).keytab
unset KRB5_KTNAME
&#160;
# set rights.
chgrp proxy /etc/squid/HTTP-$(hostname -s).keytab
chmod g+r /etc/squid/HTTP-$(hostname -s).keytab
&#160;
and use this for auth in squid. 
### negotiate kerberos and ntlm authentication
auth_param negotiate program /usr/lib/squid/negotiate_wrapper_auth \
&#160;&#160;&#160; --kerberos /usr/lib/squid/negotiate_kerberos_auth -k /etc/squid/HTTP-hostname.keytab \
&#160;&#160;&#160;&#160;&#160; -s HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">hostname.fqdn at REALM</A> \
&#160;&#160;&#160; --ntlm /usr/bin/ntlm_auth --helper-protocol=gss-spnego --domain=NTDOM
auth_param negotiate children 30 startup=5 idle=5
auth_param negotiate children 10
auth_param negotiate keep_alive on

If you serve multiple Kerberos realms add a HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">fqdn at REALM</A> service principal per realm to
&#160;&#160;&#160;&#160;&#160;&#160; the HTTP.keytab file and use the -s GSS_C_NO_NAME option with negotiate_kerberos_auth. &#160;
Greetz, 
&#160;
Louis
&#160;
&#160;


Van: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] Namens Randi Indrawan
Verzonden: vrijdag 23 augustus 2019 3:28
Aan: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Onderwerp: [squid-users] AD user Login + Squid Proxy + Automatic Authentication




So I have setup a squid proxy on a CentOS 7 Server and now the authentication system uses ldap and it works, I can set which groups get access through a proxy

The problem is ... can we setup the proxy read the domain id that is being logged, so the proxy no longer asks for a username and password. All the tutorials I've seen are pop-up messages asking for the username and password. I would like this to happen automatically so when the user logs in they automatically authenticate

Best Regards

Randi Indrawan

DISCLAIMER : The information contained in this communication (including any attachments) is privileged and confidential, and may be legally exempt from disclosure under applicable law. It is intended only for the specific purpose of being used by the individual or entity to whom it is addressed. If you are not the addressee indicated in this message (or are responsible for delivery of the message to such person), you must not disclose, disseminate, distribute, deliver, copy, circulate, rely on or use any of the information contained in this transmission. We apologize if you have received this communication in error; kindly inform the sender accordingly. Please also ensure that this original message and any record of it is permanently deleted from your computer system. We do not give or endorse any opinions, conclusions and other information in this message that do not relate to our official business. 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20190823/e0c1047b/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20190823/e0c1047b/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020919.html">[squid-users] AD user Login + Squid Proxy + Automatic	Authentication
</A></li>
	<LI>Next message (by thread): <A HREF="020921.html">[squid-users] Help with IP forwarder on squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20920">[ date ]</a>
              <a href="thread.html#20920">[ thread ]</a>
              <a href="subject.html#20920">[ subject ]</a>
              <a href="author.html#20920">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
