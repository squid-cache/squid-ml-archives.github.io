<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] reverse proxy and HTTP redirects
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20reverse%20proxy%20and%20HTTP%20redirects&In-Reply-To=%3C864f0d16-3d9a-6f97-f53d-c622da5f8058%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021386.html">
   <LINK REL="Next"  HREF="021399.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] reverse proxy and HTTP redirects</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20reverse%20proxy%20and%20HTTP%20redirects&In-Reply-To=%3C864f0d16-3d9a-6f97-f53d-c622da5f8058%40treenet.co.nz%3E"
       TITLE="[squid-users] reverse proxy and HTTP redirects">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Dec  3 05:32:57 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="021386.html">[squid-users] reverse proxy and HTTP redirects
</A></li>
        <LI>Next message (by thread): <A HREF="021399.html">[squid-users] reverse proxy and HTTP redirects
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21397">[ date ]</a>
              <a href="thread.html#21397">[ thread ]</a>
              <a href="subject.html#21397">[ subject ]</a>
              <a href="author.html#21397">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 3/12/19 3:46 am, Vieri Di Paola wrote:
&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> I configured a reverse proxy with something like this:
</I>&gt;<i> 
</I>&gt;<i> https_port 10.215.145.81:50443 accel cert=/etc/ssl/whatever.cer
</I>&gt;<i> key=/etc/ssl/whatever_key_nopassphrase.pem
</I>&gt;<i> options=NO_SSLv2,NO_SSLv3,SINGLE_DH_USE,CIPHER_SERVER_PREFERENCE,No_Compression
</I>&gt;<i> cipher=ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA25
</I>&gt;<i> 6:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4
</I>&gt;<i> tls-dh=/etc/ssl/whatever/dh2048.pem defaultsite=whatever.org
</I>

NP: you have not configured any Elliptic Curve to be used, so all those
EC ciphers will not be usable. Also you configured some DES based
ciphers and then disable DES.


&gt;<i> 
</I>&gt;<i> cache_peer 10.215.248.40 parent 8080 0 no-query originserver
</I>&gt;<i> login=PASS front-end-https=on name=httpsServer
</I>&gt;<i> 
</I>&gt;<i> [etc]
</I>&gt;<i> 
</I>&gt;<i> I can load the web portal just fine from a web client connecting to
</I>&gt;<i> 10.215.145.81:50443. However, the web server then sends an HTTP
</I>&gt;<i> redirection to an HTTP URL which is something like
</I>&gt;<i> <A HREF="http://10.215.248.40:8080/whatever">http://10.215.248.40:8080/whatever</A> (in other words, the page is hosted
</I>&gt;<i> on the same server). That breaks the browsing experience (connection
</I>&gt;<i> reset).
</I>&gt;<i> 
</I>&gt;<i> If I can't modify the server code at 10.215.248.40, is there a
</I>&gt;<i> workaround for this?
</I>
You do not need to modify code anywhere.

The problem is that the client is talking to port 50443 and the service
is expecting port 8080 in URLs.

The best solution is to have the server and Squid using the same port
number. Preferably 443 for HTTPS services.

Alternatively you might be able to use the vport= option on https_port
to set the URL port to 8080. However, this affects *all* inbound traffic
at that port and any embedded URLs the service sends the client will
remain broken (contain port 8080).


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="021386.html">[squid-users] reverse proxy and HTTP redirects
</A></li>
	<LI>Next message (by thread): <A HREF="021399.html">[squid-users] reverse proxy and HTTP redirects
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21397">[ date ]</a>
              <a href="thread.html#21397">[ thread ]</a>
              <a href="subject.html#21397">[ subject ]</a>
              <a href="author.html#21397">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
