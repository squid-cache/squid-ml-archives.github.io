<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] unable to open http socket
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20unable%20to%20open%20http%20socket&In-Reply-To=%3CLvFq5MR--3-1%40tutanota.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021410.html">
   <LINK REL="Next"  HREF="021419.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] unable to open http socket</H1>
    <B>yannick.rousseau at tutanota.com</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20unable%20to%20open%20http%20socket&In-Reply-To=%3CLvFq5MR--3-1%40tutanota.com%3E"
       TITLE="[squid-users] unable to open http socket">yannick.rousseau at tutanota.com
       </A><BR>
    <I>Wed Dec  4 12:17:54 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="021410.html">[squid-users] squid whitelist office365 and gmail emails
</A></li>
        <LI>Next message (by thread): <A HREF="021419.html">[squid-users] unable to open http socket
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21411">[ date ]</a>
              <a href="thread.html#21411">[ thread ]</a>
              <a href="subject.html#21411">[ subject ]</a>
              <a href="author.html#21411">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi everybody,

I'm using debianedu (stretch) with squid 3.5.&#160;
I would like to configure my squid through a parent proxy (172.16.103.254:3128).
I give you my issues at the beginning of this post, and my squid config at the end.
-&gt; When I start squid on my debian stretch, and check if everything is ok, I've got the message &quot;Unable to open HTTP Socket&quot;:

# service squid status
&#9679; squid.service - LSB: Squid HTTP Proxy version 3.x
&#160;&#160; Loaded: loaded (/etc/init.d/squid; generated; vendor preset: enabled)
&#160;&#160; Active: active (running) since Tue 2019-12-03 12:41:48 AST; 2s ago
&#160;&#160;&#160;&#160; Docs: man:systemd-sysv-generator(8)
&#160; Process: 10838 ExecStop=/etc/init.d/squid stop (code=exited, status=0/SUCCESS)
&#160; Process: 10852 ExecStart=/etc/init.d/squid start (code=exited, status=0/SUCCESS)
Main PID: 10893
&#160;&#160;&#160; Tasks: 6 (limit: 4915)
&#160;&#160; CGroup: /system.slice/squid.service &lt;<A HREF="http://system.slice/squid.service">http://system.slice/squid.service</A>&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#9500;&#9472;&#160; 818 /usr/sbin/squid -YC -f /etc/squid/squid-debian-edu.conf
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#9500;&#9472; 2164 (squid-1) -YC -f /etc/squid/squid-debian-edu.conf
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#9500;&#9472; 2165 (logfile-daemon) /var/log/squid/access.log
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#9500;&#9472; 2166 (unlinkd)
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#9500;&#9472; 2167 (pinger)
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#9492;&#9472;10891 /usr/sbin/squid -YC -f /etc/squid/squid-debian-edu.conf

d&#233;c. 03 12:41:47 tjener.intern systemd[1]: Starting LSB: Squid HTTP Proxy version 3.x...
d&#233;c. 03 12:41:47 tjener.intern squid[10891]: Squid Parent: will start 1 kids
d&#233;c. 03 12:41:47 tjener.intern squid[10852]: Starting Squid HTTP Proxy: squid.
d&#233;c. 03 12:41:47 tjener.intern squid[10891]: Squid Parent: (squid-1) process 10893 started
d&#233;c. 03 12:41:47 tjener.intern systemd[1]: squid.service: PID file /var/run/squid.pid not readable (yet?) after start: No such file or directory
d&#233;c. 03 12:41:48 tjener.intern systemd[1]: squid.service: Supervising process 10893 which is not our child. We'll most likely not notice when it exits.
d&#233;c. 03 12:41:48 tjener.intern (squid-1)[10893]: Unable to open HTTP Socket
d&#233;c. 03 12:41:48 tjener.intern systemd[1]: Started LSB: Squid HTTP Proxy version 3.x.
d&#233;c. 03 12:41:48 tjener.intern squid[10891]: Squid Parent: (squid-1) process 10893 exited with status 1



-&gt; When I look the cache log, I've got a &quot;commBind: Cannot bind socket FD 17 to [::]:3128: (98) Address already in use&quot;:

2019/12/03 12:39:56 kid1| Closing Pinger socket on FD 19
2019/12/03 12:39:56| pinger: Initialising ICMP pinger ...
2019/12/03 12:39:56| pinger: ICMP socket opened.
2019/12/03 12:39:56| pinger: ICMPv6 socket opened
2019/12/03 12:39:56| Pinger exiting.
2019/12/03 12:41:47 kid1| Set Current Directory to /var/spool/squid
2019/12/03 12:41:47 kid1| Starting Squid Cache version 3.5.23 for x86_64-pc-linux-gnu...
2019/12/03 12:41:47 kid1| Service Name: squid
2019/12/03 12:41:47 kid1| Process ID 10893
2019/12/03 12:41:47 kid1| Process Roles: worker
2019/12/03 12:41:47 kid1| With 65535 file descriptors available
2019/12/03 12:41:47 kid1| Initializing IP Cache...
2019/12/03 12:41:47 kid1| DNS Socket created at [::], FD 6
2019/12/03 12:41:47 kid1| DNS Socket created at 0.0.0.0, FD 8
2019/12/03 12:41:47 kid1| Adding nameserver 127.0.0.1 from /etc/resolv.conf
2019/12/03 12:41:47 kid1| Adding domain intern from /etc/resolv.conf
2019/12/03 12:41:47 kid1| Logfile: opening log daemon:/var/log/squid/access.log
2019/12/03 12:41:47 kid1| Logfile Daemon: opening log /var/log/squid/access.log
2019/12/03 12:41:48 kid1| Unlinkd pipe opened on FD 14
2019/12/03 12:41:48 kid1| Local cache digest enabled; rebuild/rewrite every 3600/3600 sec
2019/12/03 12:41:48 kid1| Store logging disabled
2019/12/03 12:41:48 kid1| Swap maxSize 11758592 + 262144 KB, estimated 924672 objects
2019/12/03 12:41:48 kid1| Target number of buckets: 46233
2019/12/03 12:41:48 kid1| Using 65536 Store buckets
2019/12/03 12:41:48 kid1| Max Mem&#160; size: 262144 KB
2019/12/03 12:41:48 kid1| Max Swap size: 11758592 KB
2019/12/03 12:41:48 kid1| Rebuilding storage in /var/spool/squid (dirty log)
2019/12/03 12:41:48 kid1| Using Least Load store dir selection
2019/12/03 12:41:48 kid1| Set Current Directory to /var/spool/squid
2019/12/03 12:41:48 kid1| Finished loading MIME types and icons.
2019/12/03 12:41:48 kid1| commBind: Cannot bind socket FD 17 to [::]:3128: (98) Address already in use
2019/12/03 12:41:48 kid1| HTCP Disabled.
2019/12/03 12:41:48 kid1| Pinger socket opened on FD 19
2019/12/03 12:41:48 kid1| Configuring Parent 172.16.103.254/3128/0
2019/12/03 12:41:48 kid1| Squid plugin modules loaded: 0
2019/12/03 12:41:48 kid1| Adaptation support is off.
2019/12/03 12:41:48 kid1| Closing HTTP port [::]:3128
FATAL: Unable to open HTTP Socket
Squid Cache (Version 3.5.23): Terminated abnormally.



-&gt; But when I check this with netstat, there's just squid using this port:

# netstat -anop |grep 3128
tcp6&#160;&#160;&#160;&#160;&#160;&#160; 0&#160;&#160;&#160;&#160;&#160; 0 :::3128&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; :::*&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; LISTEN&#160;&#160;&#160;&#160;&#160; 2164/(squid-1)&#160;&#160;&#160;&#160;&#160;&#160; off (0.00/0/0)

So what's wrong ?



-&gt; As I said, here is my squid config , I've added these two lines at the end :
cache_peer 172.16.103.254 parent 3128 0 proxy-only no-query
never_direct allow all

#cat squid-debian-edu.confacl CONNECT method CONNECT

# Grant access to the local networks
acl localnet src 10.0.0.0/8&#160;&#160;&#160;&#160; # RFC1918 possible internal network
acl localnet src 172.16.0.0/12&#160; # RFC1918 possible internal network
acl localnet src 192.168.0.0/16 # RFC1918 possible internal network
acl localnet src fc00::/7&#160;&#160;&#160;&#160;&#160;&#160; # RFC 4193 local private network range
acl localnet src fe80::/10&#160;&#160;&#160;&#160;&#160; # RFC 4291 link-local (directly plugged) machines

http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow localhost manager
http_access deny manager
http_access allow localnet
http_access allow localhost
http_access deny all
htcp_access allow localnet
htcp_access deny all

http_port 3128

coredump_dir /var/spool/squid3



refresh_pattern ^ftp:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 1440&#160;&#160;&#160; 20%&#160;&#160;&#160;&#160; 10080
refresh_pattern ^gopher:&#160;&#160;&#160;&#160;&#160;&#160;&#160; 1440&#160;&#160;&#160; 0%&#160;&#160;&#160;&#160;&#160; 1440
refresh_pattern -i (/cgi-bin/|\?) 0&#160;&#160;&#160;&#160; 0%&#160;&#160;&#160;&#160;&#160; 0

# See bug #591839
refresh_pattern (Release|Packages(.gz)*)$&#160;&#160;&#160;&#160;&#160; 0&#160;&#160;&#160;&#160;&#160;&#160; 20%&#160;&#160;&#160;&#160;&#160; 2880

refresh_pattern .&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 0&#160;&#160;&#160;&#160;&#160;&#160; 20%&#160;&#160;&#160;&#160; 4320

# Cache larger files to cache more debian packages
maximum_object_size 153600 KB

#&#160; - Appends .intern to hostnames without any dots in them.
append_domain .intern

# Adjust cache size to fit size of /var/spool/squid, the capasity is
# dynamically updated using
# /usr/share/debian-edu-config/tools/squid-update-cachedir
cache_peer 172.16.103.254 parent 3128 0 proxy-only no-query
never_direct allow all
cache_dir ufs /var/spool/squid3 11432 16 256


Thanks for your help.


-- 
 Envoi s&#233;curis&#233; avec Tutanota. Obtenez votre propre adresse email chiffr&#233;e : 
 <A HREF="https://tutanota.com">https://tutanota.com</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20191204/38343c05/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20191204/38343c05/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="021410.html">[squid-users] squid whitelist office365 and gmail emails
</A></li>
	<LI>Next message (by thread): <A HREF="021419.html">[squid-users] unable to open http socket
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21411">[ date ]</a>
              <a href="thread.html#21411">[ thread ]</a>
              <a href="subject.html#21411">[ subject ]</a>
              <a href="author.html#21411">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
