<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] icap result caching in squid
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20icap%20result%20caching%20in%20squid&In-Reply-To=%3Ce7b2e42e-ea9e-4955-aae7-7237b19e0b3a%40www.fastmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021417.html">
   <LINK REL="Next"  HREF="021406.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] icap result caching in squid</H1>
    <B>Darren Breeze</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20icap%20result%20caching%20in%20squid&In-Reply-To=%3Ce7b2e42e-ea9e-4955-aae7-7237b19e0b3a%40www.fastmail.com%3E"
       TITLE="[squid-users] icap result caching in squid">darren at ksn-systems.com
       </A><BR>
    <I>Thu Dec  5 18:17:57 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="021417.html">[squid-users] icap result caching in squid
</A></li>
        <LI>Next message (by thread): <A HREF="021406.html">[squid-users] http://www1.ngtech.co.il/ - Down?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21432">[ date ]</a>
              <a href="thread.html#21432">[ thread ]</a>
              <a href="subject.html#21432">[ subject ]</a>
              <a href="author.html#21432">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Amos

I have done some digging into your suggestion, and it looks like a better way to go for what I need to do.

&gt;<i> Also, are you aware that current Squid versions can generate redirects
</I>&gt;<i> (custom headers included) based on output from an external_acl_type helper?
</I>&gt;<i>  A helper to lookup your permissions system plus a few extra squid.conf
</I>&gt;<i> settings would be a lot simpler in terms of traffic processing and
</I>&gt;<i> bandwidth consumption than sending everything through an external ICAP
</I>&gt;<i> service.
</I>
Are you able to point me in the direction of some sample config fragments that show how this can be done please.

I am guessing that I would need to return some custom keyword / value pairs from the external_acl and set other acls based on the values.

What I am aiming at is to selectively bump or redirect (or both) based on the client status and the site being requested.

Thanks again.

Darren B.



On Wed, Dec 4, 2019, at 6:26 PM, Amos Jeffries wrote:
&gt;<i> On 4/12/19 6:05 am, Darren Breeze wrote:
</I>&gt;<i> &gt; Hi Amos
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; The Icap service is doing redirects based on client permissions (that may change). What I am doing is just setting the Expires value in the RESP_MOD response when I return a 307 redirect so I can control how long the caches (both Squid and the browser) hang on to it.
</I>&gt;<i> &gt; 
</I>&gt;<i> 
</I>&gt;<i> In that case you should be using Cache-Control:max-age=NN instead where
</I>&gt;<i> the NN being your desired TTL in seconds. This is a *lot* simpler and
</I>&gt;<i> faster to deliver than calculating the timestamps needed for valid
</I>&gt;<i> Expires header.
</I>&gt;<i> 
</I>&gt;<i> Also, are you aware that current Squid versions can generate redirects
</I>&gt;<i> (custom headers included) based on output from an external_acl_type helper?
</I>&gt;<i>  A helper to lookup your permissions system plus a few extra squid.conf
</I>&gt;<i> settings would be a lot simpler in terms of traffic processing and
</I>&gt;<i> bandwidth consumption than sending everything through an external ICAP
</I>&gt;<i> service.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Amos
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>This email and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are addressed. If you have received this email in error please notify the system manager. This message contains confidential information and is intended only for the individual named. If you are not the named addressee you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately by e-mail if you have received this e-mail by mistake and delete this e-mail from your system. If you are not the intended recipient you are notified that disclosing, copying, distributing or taking any action in reliance on the contents of this information is strictly prohibited.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="021417.html">[squid-users] icap result caching in squid
</A></li>
	<LI>Next message (by thread): <A HREF="021406.html">[squid-users] http://www1.ngtech.co.il/ - Down?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21432">[ date ]</a>
              <a href="thread.html#21432">[ thread ]</a>
              <a href="subject.html#21432">[ subject ]</a>
              <a href="author.html#21432">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
