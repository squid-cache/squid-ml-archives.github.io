<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Https inception gives 503 error
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Https%20inception%20gives%20503%20error&In-Reply-To=%3C1575790518545-0.post%40n4.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021497.html">
   <LINK REL="Next"  HREF="021438.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Https inception gives 503 error</H1>
    <B>mandev</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Https%20inception%20gives%20503%20error&In-Reply-To=%3C1575790518545-0.post%40n4.nabble.com%3E"
       TITLE="[squid-users] Https inception gives 503 error">selimakpinar at protonmail.com
       </A><BR>
    <I>Sun Dec  8 07:35:18 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="021497.html">[squid-users] Squid Proxy SSL Bump can not retrieve SSL session back to the client?
</A></li>
        <LI>Next message (by thread): <A HREF="021438.html">[squid-users] Https inspection gives 503 error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21437">[ date ]</a>
              <a href="thread.html#21437">[ thread ]</a>
              <a href="subject.html#21437">[ subject ]</a>
              <a href="author.html#21437">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I am using pfsense with squid and squidguard for web filtering without
client side certificate installation. I did manage to block pages and mostly
error free internet traffic. But for the last thing i cannot work it. I want
to redirect users to a block page and i did this with http but cannot do
this with https. When a blocked page visited it gives
&quot;SSL_ERROR_RX_RECORD_TOO_LONG&quot; error. Debug it a lot for this issue and my
founding are below and config files are attached (its pfsense so not much
mostly automatic files);

When i access a http page this is how squid redirects:

2019/12/08 06:32:02.735 kid1| 5,3| comm.cc(553) commSetConnTimeout:
local=34.249.120.252:80 remote=192.168.10.10:35178 FD 18 flags=33 timeout
86400
2019/12/08 06:32:02.735 kid1| 23,3| url.cc(371) urlParse: urlParse: Split
URL '<A HREF="http://hurriyet.com.tr/">http://hurriyet.com.tr/</A>' into proto='http', host='hurriyet.com.tr',
port='80', path='/'
2019/12/08 06:32:02.735 kid1| 14,3| Address.cc(389) lookupHostIP: Given
Non-IP 'hurriyet.com.tr': hostname nor servname provided, or not known
2019/12/08 06:32:02.735 kid1| 33,3| client_side.cc(891)
clientSetKeepaliveFlag: http_ver = HTTP/1.1

When i access a https page this happends:

2019/12/08 06:28:14.431 kid1| 23,3| url.cc(371) urlParse: urlParse: Split
URL
'<A HREF="http://192.168.10.1:80/sgerror.php?url=403%20&amp;a=192.168.10.10&amp;n=192.168.10.10&amp;i=&amp;s=default&amp;t=blacklist&amp;u=selimakpinar.com:443">http://192.168.10.1:80/sgerror.php?url=403%20&amp;a=192.168.10.10&amp;n=192.168.10.10&amp;i=&amp;s=default&amp;t=blacklist&amp;u=selimakpinar.com:443</A>'
into proto='', host='http', port='443', path=''
2019/12/08 06:28:14.431 kid1| 14,3| Address.cc(389) lookupHostIP: Given
Non-IP 'http': hostname nor servname provided, or not known
2019/12/08 06:28:14.431 kid1| 61,2| client_side_request.cc(1286)
clientRedirectDone: URL-rewriter diverts URL from selimakpinar.com:443 to
http:443
2019/12/08 06:28:14.431 kid1| 83,3| client_side_request.cc(1743) doCallouts:
Doing calloutContext-&gt;clientAccessCheck2()

access.log;

1575790083.949      7 192.168.10.10 TAG_NONE/200 0 CONNECT 104.18.58.42:443
- HIER_NONE/- -
1575790084.047     99 192.168.10.10 TAG_NONE/503 0 CONNECT
selimakpinar.com:443 - HIER_NONE/- -


squid.conf
&lt;<A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/file/t377846/squid.conf">http://squid-web-proxy-cache.1019090.n4.nabble.com/file/t377846/squid.conf</A>&gt;  
squidGuard.conf
&lt;<A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/file/t377846/squidGuard.conf">http://squid-web-proxy-cache.1019090.n4.nabble.com/file/t377846/squidGuard.conf</A>&gt;  





--
Sent from: <A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html">http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html</A>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="021497.html">[squid-users] Squid Proxy SSL Bump can not retrieve SSL session back to the client?
</A></li>
	<LI>Next message (by thread): <A HREF="021438.html">[squid-users] Https inspection gives 503 error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21437">[ date ]</a>
              <a href="thread.html#21437">[ thread ]</a>
              <a href="subject.html#21437">[ subject ]</a>
              <a href="author.html#21437">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
