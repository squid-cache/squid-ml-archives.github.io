<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid Proxy SSL Bump can not retrieve SSL session back to the client?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20Proxy%20SSL%20Bump%20can%20not%20retrieve%20SSL%20session%0A%20back%20to%20the%20client%3F&In-Reply-To=%3C9b0a12c8-e979-a6f9-c604-f2116a22228d%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021436.html">
   <LINK REL="Next"  HREF="021444.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid Proxy SSL Bump can not retrieve SSL session back to the client?</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20Proxy%20SSL%20Bump%20can%20not%20retrieve%20SSL%20session%0A%20back%20to%20the%20client%3F&In-Reply-To=%3C9b0a12c8-e979-a6f9-c604-f2116a22228d%40treenet.co.nz%3E"
       TITLE="[squid-users] Squid Proxy SSL Bump can not retrieve SSL session back to the client?">squid3 at treenet.co.nz
       </A><BR>
    <I>Sun Dec  8 13:49:40 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="021436.html">[squid-users] Squid Proxy SSL Bump can not retrieve SSL session	back to the client?
</A></li>
        <LI>Next message (by thread): <A HREF="021444.html">[squid-users] Squid Proxy SSL Bump can not retrieve SSL session back to the client?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21443">[ date ]</a>
              <a href="thread.html#21443">[ thread ]</a>
              <a href="subject.html#21443">[ subject ]</a>
              <a href="author.html#21443">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 8/12/19 7:53 pm, George Sheng wrote:
&gt;<i> 
</I>&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> I&#8217;m new to this group. I just setup a squid ver 4.5 on my ubuntu
</I>
When using SSL-Bump one does need to use the latest release. Which is
4.9 now.

Since this is a custom build (4.5 has never been a release in Ubuntu)
you may find Squid-5 has even less issues for SSL-Bump.



...
&gt;<i> 2019/12/07 20:48:59.761 kid1| 83,5| Session.cc &lt;<A HREF="http://Session.cc">http://Session.cc</A>&gt;(347)
</I>&gt;<i> get_session_cb: Request to search for SSL_SESSION of
</I>&gt;<i> len:&#160;321019023443:419801955
</I>&gt;<i> 2019/12/07 20:48:59.761 kid1| 54,5| MemMap.cc &lt;<A HREF="http://MemMap.cc">http://MemMap.cc</A>&gt;(156)
</I>&gt;<i> openForReading: trying to open slot for
</I>&gt;<i> key&#160;5310BD3C63AB0519C4F984A35A8DC1AE for reading in map [tls_session_cache]
</I>&gt;<i> 2019/12/07 20:48:59.761 kid1| 54,5| MemMap.cc &lt;<A HREF="http://MemMap.cc">http://MemMap.cc</A>&gt;(177)
</I>&gt;<i> openForReadingAt: trying to open slot at 18 for reading in
</I>&gt;<i> map&#160;[tls_session_cache]
</I>&gt;<i> 2019/12/07 20:48:59.761 kid1| 54,5| MemMap.cc &lt;<A HREF="http://MemMap.cc">http://MemMap.cc</A>&gt;(169)
</I>&gt;<i> openForReading: failed to open slot for
</I>&gt;<i> key&#160;5310BD3C63AB0519C4F984A35A8DC1AE for reading in map [tls_session_cache]
</I>&gt;<i> 2019/12/07 20:48:59.761 kid1| 83,5| Session.cc &lt;<A HREF="http://Session.cc">http://Session.cc</A>&gt;(362)
</I>&gt;<i> get_session_cb: Failed to retrieve SSL_SESSION from cache
</I>&gt;<i> ***
</I>
This is talking about Squid's internal cache of TLS sessions that
clients have negotiated previously with this Squid. It means the client
is attempting to use/resume a TLS session ID that does not exist. There
is nothing anyone can do about that.


&gt;<i> 
</I>&gt;<i> Here is my squid.conf:
</I>&gt;<i> 
</I>...
&gt;<i> https_port 3130 intercept ssl-bump
</I>&gt;<i> cert=/usr/local/squid/etc/ssl_cert/myCA.pem
</I>&gt;<i> generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
</I>&gt;<i> key=/usr/local/
</I>&gt;<i> squid/etc/ssl_cert/myCA.pem
</I>&gt;<i> 
</I>
FYI: with cert= and key= pointing at the same file you do not need the
key= option.


&gt;<i> ##
</I>&gt;<i> 
</I>&gt;<i> I&#8217;m wondering if this problem is a bug, my proxy config issue, or the
</I>&gt;<i> client does not send the correct TLS parameters.
</I>&gt;<i> thanks for your help in advance.
</I>&gt;<i> 
</I>
The problem is most likely the client.

If the session ID actually was negotiated previously with this Squid
there may be shared-memory issues on your machine. Even with only one
worker this cache uses SMP functionality

If you only just started this Squid, the session may have been
negotiated with the origin or previous Squid instance. In that case it
is normal to get at least a few of these until they timeout and/or get
renegotiated.


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="021436.html">[squid-users] Squid Proxy SSL Bump can not retrieve SSL session	back to the client?
</A></li>
	<LI>Next message (by thread): <A HREF="021444.html">[squid-users] Squid Proxy SSL Bump can not retrieve SSL session back to the client?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21443">[ date ]</a>
              <a href="thread.html#21443">[ thread ]</a>
              <a href="subject.html#21443">[ subject ]</a>
              <a href="author.html#21443">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
