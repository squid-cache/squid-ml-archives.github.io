<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] A patch for intercepted/WCCP HTTPS and 409 errors
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20A%20patch%20for%20intercepted/WCCP%20HTTPS%20and%20409%20errors&In-Reply-To=%3Cec88975b-f054-6cf0-66fd-3e70786055bc%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021479.html">
   <LINK REL="Next"  HREF="021485.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] A patch for intercepted/WCCP HTTPS and 409 errors</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20A%20patch%20for%20intercepted/WCCP%20HTTPS%20and%20409%20errors&In-Reply-To=%3Cec88975b-f054-6cf0-66fd-3e70786055bc%40treenet.co.nz%3E"
       TITLE="[squid-users] A patch for intercepted/WCCP HTTPS and 409 errors">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Dec 11 12:34:59 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="021479.html">[squid-users] A patch for intercepted/WCCP HTTPS and 409 errors
</A></li>
        <LI>Next message (by thread): <A HREF="021485.html">[squid-users] A patch for intercepted/WCCP HTTPS and 409 errors
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21484">[ date ]</a>
              <a href="thread.html#21484">[ thread ]</a>
              <a href="subject.html#21484">[ subject ]</a>
              <a href="author.html#21484">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 11/12/19 8:51 pm, Scott wrote:
&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> I understand that squid does some security checking that the SNI of an 
</I>&gt;<i> intercepted/WCCP HTTPS requests matches the reverse DNS of the IP of the 
</I>&gt;<i> connection.  Or something like that.
</I>
Not being able to say precisely what Squid is actually doing shows that
you are lacking understanding of the processes taking place.

The security check you are posting about has many secondary consequences
and side effects to be taken into account. Quite a few people have taken
a stab at solving these rejections and what we have in Squid right now
is the best that can be done without significant redesign work (which is
underway - just very slowly, help welcome).

This is why we have the squid-dev mailing list for code change
discussion. If you want to actually help solving false-positives in this
security check please post there and we who have been working on this
issue for 10+ years now can discuss what we know about the situation,
the &quot;gotcha&quot; side effects we have to avoid and ideas for improvement.


&gt;<i> 
</I>&gt;<i> However with the prevalence of CDNs and badly configured DNSs and geographic 
</I>&gt;<i> DNSs, this breaks lots of connections (eg, I can't watch the NHL).
</I>&gt;<i> 
</I>&gt;<i> I run Squid on a trusted network and use it primarily for caching and 
</I>&gt;<i> logging, and so I while I need to run WCCP for some non-proxy capable 
</I>&gt;<i> devices, I don't need that security check.
</I>
Without that check you cannot call your network a &quot;secure network&quot;
anymore. The absence of the check opens a nest of security holes for
attackers to walk right in past all those other protections.


&gt;<i> 
</I>&gt;<i> It stops all of those 409 errors occurring.
</I>&gt;<i> 
</I>&gt;<i> Because of that I've created some patches that add a new option
</I>&gt;<i> &quot;host_verify_strict_intercepted&quot; which is off by default.  They are
</I>&gt;<i> for Squid 4.9.  As this is disabling a security feature of Squid do
</I>&gt;<i> not apply this patch unless you are prepared for any and all consequences.
</I>&gt;<i> 
</I>
Please do not spread this around. People who want to really insist on
allowing virus/malware to spread unchecked around their networks can
make smaller patches.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="021479.html">[squid-users] A patch for intercepted/WCCP HTTPS and 409 errors
</A></li>
	<LI>Next message (by thread): <A HREF="021485.html">[squid-users] A patch for intercepted/WCCP HTTPS and 409 errors
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21484">[ date ]</a>
              <a href="thread.html#21484">[ thread ]</a>
              <a href="subject.html#21484">[ subject ]</a>
              <a href="author.html#21484">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
