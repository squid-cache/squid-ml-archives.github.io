<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Sibling peer cache not working, ver 3.5.27
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Sibling%20peer%20cache%20not%20working%2C%20ver%203.5.27&In-Reply-To=%3C7806aa57-3c09-d09d-0374-fab101140a18%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021477.html">
   <LINK REL="Next"  HREF="021492.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Sibling peer cache not working, ver 3.5.27</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Sibling%20peer%20cache%20not%20working%2C%20ver%203.5.27&In-Reply-To=%3C7806aa57-3c09-d09d-0374-fab101140a18%40treenet.co.nz%3E"
       TITLE="[squid-users] Sibling peer cache not working, ver 3.5.27">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Dec 11 12:59:03 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="021477.html">[squid-users] Sibling peer cache not working, ver 3.5.27
</A></li>
        <LI>Next message (by thread): <A HREF="021492.html">[squid-users] Sibling peer cache not working, ver 3.5.27
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21486">[ date ]</a>
              <a href="thread.html#21486">[ thread ]</a>
              <a href="subject.html#21486">[ subject ]</a>
              <a href="author.html#21486">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 11/12/19 5:47 pm, leonyuuu wrote:
&gt;<i> For cache digest requests between two interception squid proxies, it will
</I>&gt;<i> actually display &quot;forward loop detection&quot; in the cache.log and the last Via
</I>&gt;<i> host for that query(cache-digest-db) is itself. So is it also the root cause
</I>&gt;<i> why the cache-miss forwarding between two proxies is not working?
</I>
You have set the &quot;intercept&quot; option on your proxies port 3128 line.

You have used port 3128 as the port the two proxies are communicating
with each other. This requires an explicit/forward proxy port.


I suggest leave port 3128 for the normal proxying traffic and move the
intercept and NAT rules to a randomly selected other port number. This
other port *must not* be able to receive traffic directly, only the
machines NAT system and Squid may use it.


&gt;<i> Since the
</I>&gt;<i> proxy1 actually never knows the cache digest content of proxy0. 
</I>&gt;<i> 
</I>&gt;<i> Another question, why the interception squid proxy will append itself onto
</I>&gt;<i> the Via field of request?
</I>
To allow detection and debug analysis of exactly the mistake you have
made. That is the purpose of Via.


&gt;<i> It actually forward the request by iptables
</I>&gt;<i> PREROUTING phase, which is before the packet is accepted by the squid
</I>&gt;<i> program. 
</I>&gt;<i> 
</I>
That idea is wrong. The digest exchange is between two proxies, which
know about each other - you configured the details of how they
communicate in cache_peer config lines.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="021477.html">[squid-users] Sibling peer cache not working, ver 3.5.27
</A></li>
	<LI>Next message (by thread): <A HREF="021492.html">[squid-users] Sibling peer cache not working, ver 3.5.27
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21486">[ date ]</a>
              <a href="thread.html#21486">[ thread ]</a>
              <a href="subject.html#21486">[ subject ]</a>
              <a href="author.html#21486">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
