<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Fwd: Squid 4.8 with OpenSSL 1.1.1d
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Fwd%3A%20Squid%204.8%20with%20OpenSSL%201.1.1d&In-Reply-To=%3CCADSgaCQtQAetQCukyQfR5c6Bq8B22_k76Ff3Y8OONsqm1juiPg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021531.html">
   <LINK REL="Next"  HREF="021533.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Fwd: Squid 4.8 with OpenSSL 1.1.1d</H1>
    <B>Yaroslav Pushko</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Fwd%3A%20Squid%204.8%20with%20OpenSSL%201.1.1d&In-Reply-To=%3CCADSgaCQtQAetQCukyQfR5c6Bq8B22_k76Ff3Y8OONsqm1juiPg%40mail.gmail.com%3E"
       TITLE="[squid-users] Fwd: Squid 4.8 with OpenSSL 1.1.1d">yaroslav.pushko at globallogic.com
       </A><BR>
    <I>Tue Dec 17 14:00:58 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="021531.html">[squid-users] squidguard stopped and restart randomly
</A></li>
        <LI>Next message (by thread): <A HREF="021533.html">[squid-users] Fwd: Squid 4.8 with OpenSSL 1.1.1d
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21532">[ date ]</a>
              <a href="thread.html#21532">[ thread ]</a>
              <a href="subject.html#21532">[ subject ]</a>
              <a href="author.html#21532">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi All

We use Squid 4.8 with OpenSSL 1.1.1d in a transparent mode for peek and
splice interception.

With this version, we lost the possibility to connect to any HTTPS site.

There are a few issues:

   - support TLSv1.2 sites (already discussed in thread
   <A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/Problem-with-ssl-choose-client-version-inappropriate-fallback-on-some-sites-when-using-TLS1-2-td4688258.html">http://squid-web-proxy-cache.1019090.n4.nabble.com/Problem-with-ssl-choose-client-version-inappropriate-fallback-on-some-sites-when-using-TLS1-2-td4688258.html</A>
    )
   - support TLSv1.3 sites.


Support TLSv1.2.

OpenSSL 1.1.1d adds support of TLSv1.3. These changes added some kind of
guard if we perform a handshake with a lower version of the TLS protocol
than we support. In this scenario, we receive downgrade fallback error.
Handshake version TLSv1.2 vs. max support TLSv1.3.

In such case, we have the next error:

ERROR: negotiating TLS on FD 19: error:1425F175:SSL
&gt;<i> routines:ssl_choose_client_version:inappropriate fallback (1/-1/0)
</I>

OpenSSL already provided a fix for it. You can configure SSL session to use
option SSL_MODE_SEND_FALLBACK_SCSV and setting SSL max proto version for
current SSL session, but squid not yet supported these features.

You can find a patch in the attachments, will be grateful for the review.


The issue with TLS 1.3 support, we are still investigating, any advice will
be pleasant.

Best regards,
Yaroslav Pushko.
-- 
Best Regards,
Yaroslav Pushko | Senior *Software Engineer*
GlobalLogic
P +380971842774  M +380634232226 S dithard
www.globallogic.com
<A HREF="http://www.globallogic.com/email_disclaimer.txt">http://www.globallogic.com/email_disclaimer.txt</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20191217/7ce31211/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20191217/7ce31211/attachment.htm</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: squid-4.8-added_max_support_tlsversion.patch
Type: application/x-patch
Size: 3722 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20191217/7ce31211/attachment.bin">http://lists.squid-cache.org/pipermail/squid-users/attachments/20191217/7ce31211/attachment.bin</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="021531.html">[squid-users] squidguard stopped and restart randomly
</A></li>
	<LI>Next message (by thread): <A HREF="021533.html">[squid-users] Fwd: Squid 4.8 with OpenSSL 1.1.1d
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21532">[ date ]</a>
              <a href="thread.html#21532">[ thread ]</a>
              <a href="subject.html#21532">[ subject ]</a>
              <a href="author.html#21532">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
