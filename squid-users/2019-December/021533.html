<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Fwd: Squid 4.8 with OpenSSL 1.1.1d
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Fwd%3A%20Squid%204.8%20with%20OpenSSL%201.1.1d&In-Reply-To=%3Cfc72bea5-0f98-864b-57f2-ae4d8cc9ae92%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021532.html">
   <LINK REL="Next"  HREF="021534.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Fwd: Squid 4.8 with OpenSSL 1.1.1d</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Fwd%3A%20Squid%204.8%20with%20OpenSSL%201.1.1d&In-Reply-To=%3Cfc72bea5-0f98-864b-57f2-ae4d8cc9ae92%40measurement-factory.com%3E"
       TITLE="[squid-users] Fwd: Squid 4.8 with OpenSSL 1.1.1d">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Dec 17 14:39:04 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="021532.html">[squid-users] Fwd: Squid 4.8 with OpenSSL 1.1.1d
</A></li>
        <LI>Next message (by thread): <A HREF="021534.html">[squid-users] Block and allow connections by CA
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21533">[ date ]</a>
              <a href="thread.html#21533">[ thread ]</a>
              <a href="subject.html#21533">[ subject ]</a>
              <a href="author.html#21533">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 12/17/19 9:00 AM, Yaroslav Pushko wrote:
&gt;<i> Hi All
</I>&gt;<i> 
</I>&gt;<i> We use&#160;Squid 4.8 with OpenSSL 1.1.1d in a transparent mode for peek and
</I>&gt;<i> splice interception.
</I>&gt;<i> 
</I>&gt;<i> With this version, we lost the&#160;possibility&#160;to connect to any HTTPS site.
</I>&gt;<i> 
</I>&gt;<i> There are a few issues:&#160;
</I>&gt;<i> 
</I>&gt;<i>   * support TLSv1.2 sites (already discussed in
</I>&gt;<i>     thread&#160;<A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/Problem-with-ssl-choose-client-version-inappropriate-fallback-on-some-sites-when-using-TLS1-2-td4688258.html&#160;">http://squid-web-proxy-cache.1019090.n4.nabble.com/Problem-with-ssl-choose-client-version-inappropriate-fallback-on-some-sites-when-using-TLS1-2-td4688258.html&#160;</A>)
</I>&gt;<i>   * support TLSv1.3 sites.
</I>
Please see
<A HREF="http://lists.squid-cache.org/pipermail/squid-users/2019-December/021435.html">http://lists.squid-cache.org/pipermail/squid-users/2019-December/021435.html</A>
for several alternative fixes. AFAICT, those fixes are more flexible
and, after polishing, appropriate for the official inclusion because
they make fewer assumptions about the values sent via the supported
versions extension.

It is possible that your SSL_MODE_SEND_FALLBACK_SCSV change needs to be
integrated with the other fixes. Thank you for sharing that idea!

Alex.


&gt;<i> Support TLSv1.2.
</I>&gt;<i> 
</I>&gt;<i>     OpenSSL 1.1.1d adds support of TLSv1.3. These changes added some
</I>&gt;<i>     kind of guard if we perform a handshake with a lower version of the
</I>&gt;<i>     TLS protocol than we support. In this scenario, we receive downgrade
</I>&gt;<i>     fallback&#160;error.
</I>&gt;<i>     Handshake version TLSv1.2 vs. max support TLSv1.3.
</I>&gt;<i> 
</I>&gt;<i>     In such case, we have the next error:
</I>&gt;<i> 
</I>&gt;<i>         ERROR: negotiating TLS on FD 19: error:1425F175:SSL
</I>&gt;<i>         routines:ssl_choose_client_version:inappropriate fallback (1/-1/0)
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     OpenSSL already&#160;provided&#160;a fix for it. You can configure SSL session
</I>&gt;<i>     to use option&#160;SSL_MODE_SEND_FALLBACK_SCSV and setting SSL max proto
</I>&gt;<i>     version for current SSL session, but squid not yet supported these
</I>&gt;<i>     features.
</I>&gt;<i> 
</I>&gt;<i>     You can find a patch in the attachments, will be grateful for the
</I>&gt;<i>     review.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> The issue with TLS 1.3 support, we are still investigating, any advice
</I>&gt;<i> will be pleasant.
</I>&gt;<i> 
</I>&gt;<i> Best regards,
</I>&gt;<i> Yaroslav Pushko.
</I>&gt;<i> --&#160;
</I>&gt;<i> Best Regards,
</I>&gt;<i> Yaroslav Pushko | Senior&#160;*Software Engineer*
</I>&gt;<i> GlobalLogic
</I>&gt;<i> P +380971842774 &#160;M +380634232226 S&#160;dithard
</I>&gt;<i> www.globallogic.com &lt;<A HREF="http://www.globallogic.com/">http://www.globallogic.com/</A>&gt;
</I>&gt;<i> <A HREF="http://www.globallogic.com/email_disclaimer.txt">http://www.globallogic.com/email_disclaimer.txt</A>
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="021532.html">[squid-users] Fwd: Squid 4.8 with OpenSSL 1.1.1d
</A></li>
	<LI>Next message (by thread): <A HREF="021534.html">[squid-users] Block and allow connections by CA
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21533">[ date ]</a>
              <a href="thread.html#21533">[ thread ]</a>
              <a href="subject.html#21533">[ subject ]</a>
              <a href="author.html#21533">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
