<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Is there a way on client to show proxy's certificate?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Is%20there%20a%20way%20on%20client%20to%20show%20proxy%27s%0A%20certificate%3F&In-Reply-To=%3C20191222125649.GC5913%40fantomas.sk%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021559.html">
   <LINK REL="Next"  HREF="021563.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Is there a way on client to show proxy's certificate?</H1>
    <B>Matus UHLAR - fantomas</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Is%20there%20a%20way%20on%20client%20to%20show%20proxy%27s%0A%20certificate%3F&In-Reply-To=%3C20191222125649.GC5913%40fantomas.sk%3E"
       TITLE="[squid-users] Is there a way on client to show proxy's certificate?">uhlar at fantomas.sk
       </A><BR>
    <I>Sun Dec 22 12:56:49 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="021559.html">[squid-users] Is there a way on client to show proxy's	certificate?
</A></li>
        <LI>Next message (by thread): <A HREF="021563.html">[squid-users] Is there a way on client to show proxy's	certificate?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21562">[ date ]</a>
              <a href="thread.html#21562">[ thread ]</a>
              <a href="subject.html#21562">[ subject ]</a>
              <a href="author.html#21562">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;&gt;<i> how is port 3129 defined in squid.conf?
</I>
On 21.12.19 13:34, GeorgeShen wrote:
&gt;<i>ssl_bump peek step1
</I>&gt;<i>ssl_bump stare step2
</I>&gt;<i>ssl_bump bump all
</I>&gt;<i>http_port 3128
</I>&gt;<i>http_port 3129 ssl-bump cert=/usr/local/squid/etc/ssl_cert/myCA.pem
</I>&gt;<i>generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
</I>&gt;<i>options=SINGLE_DH_USE:SINGLE_ECDH_USE
</I>&gt;<i>tls-dh=prime256v1:/usr/local/squid/etc/dhparams.pem
</I>
this is http port, speaking http.  This is not a https port, so you can't
speak https to it.  The difference between 3128 and 3129 is, when you issue
CONNECT request to 3129, squid tries to communicate using SSL as if it was
the destination server (or, whatever you configure in ssl_bump options).

if you want to talk to squid on port 443, you must configure https_port.

&gt;<i>BTW, the https/TLS bump through this server works. when using the openssl
</I>&gt;<i>s_client, get this result,
</I>&gt;<i>(it says &quot;no peer certificate available&quot;):
</I>
this looks to me more like failure of setting up SSL protocol.
I really wonder something SSL related works  at all.

you should check with:

openssl s_client -proxy 192.168.1.35:3129 -connect &lt;host:port&gt; -showcerts

on both squid ports to see the difference.


&gt;<i>$ openssl s_client -connect 192.168.1.35:3129 -showcerts
</I>&gt;<i>CONNECTED(00000003)
</I>&gt;<i>4659451500:error:1400410B:SSL routines:CONNECT_CR_SRVR_HELLO:wrong version
</I>&gt;<i>number:/BuildRoot/Library/Caches/com.apple.xbs/Sources/libressl/libressl-22.260.1/libressl-2.6/ssl/ssl_pkt.c:386:
</I>&gt;<i>---
</I>&gt;<i>no peer certificate available
</I>&gt;<i>---
</I>&gt;<i>No client certificate CA names sent
</I>&gt;<i>---
</I>&gt;<i>SSL handshake has read 5 bytes and written 0 bytes
</I>&gt;<i>---
</I>&gt;<i>New, (NONE), Cipher is (NONE)
</I>&gt;<i>Secure Renegotiation IS NOT supported
</I>&gt;<i>Compression: NONE
</I>&gt;<i>Expansion: NONE
</I>&gt;<i>No ALPN negotiated
</I>&gt;<i>SSL-Session:
</I>&gt;<i>    Protocol  : TLSv1.2
</I>&gt;<i>    Cipher    : 0000
</I>&gt;<i>    Session-ID:
</I>&gt;<i>    Session-ID-ctx:
</I>&gt;<i>    Master-Key:
</I>&gt;<i>    Start Time: 1576955529
</I>&gt;<i>    Timeout   : 7200 (sec)
</I>&gt;<i>    Verify return code: 0 (ok)
</I>&gt;<i>---
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>and if I run this openssl s_client on the proxy itself (should use the same
</I>&gt;<i>version of openssl):
</I>&gt;<i>
</I>&gt;<i>$ openssl s_client -connect 127.0.0.1:3129 -showcerts
</I>&gt;<i>CONNECTED(00000003)
</I>&gt;<i>140248349009560:error:140770FC:SSL routines:SSL23_GET_SERVER_HELLO:unknown
</I>&gt;<i>protocol:s23_clnt.c:827:
</I>&gt;<i>---
</I>&gt;<i>no peer certificate available
</I>&gt;<i>---
</I>&gt;<i>No client certificate CA names sent
</I>&gt;<i>---
</I>&gt;<i>SSL handshake has read 7 bytes and written 311 bytes
</I>&gt;<i>---
</I>&gt;<i>New, (NONE), Cipher is (NONE)
</I>&gt;<i>Secure Renegotiation IS NOT supported
</I>&gt;<i>Compression: NONE
</I>&gt;<i>Expansion: NONE
</I>&gt;<i>No ALPN negotiated
</I>&gt;<i>SSL-Session:
</I>&gt;<i>    Protocol  : TLSv1.2
</I>&gt;<i>    Cipher    : 0000
</I>&gt;<i>    Session-ID:
</I>&gt;<i>    Session-ID-ctx:
</I>&gt;<i>    Master-Key:
</I>&gt;<i>    Key-Arg   : None
</I>&gt;<i>    PSK identity: None
</I>&gt;<i>    PSK identity hint: None
</I>&gt;<i>    SRP username: None
</I>&gt;<i>    Start Time: 1576956256
</I>&gt;<i>    Timeout   : 300 (sec)
</I>&gt;<i>    Verify return code: 0 (ok)
</I>&gt;<i>---
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>--
</I>&gt;<i>Sent from: <A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html">http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html</A>
</I>&gt;<i>_______________________________________________
</I>&gt;<i>squid-users mailing list
</I>&gt;<i><A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i><A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>
-- 
Matus UHLAR - fantomas, <A HREF="https://lists.squid-cache.org/listinfo/squid-users">uhlar at fantomas.sk</A> ; <A HREF="http://www.fantomas.sk/">http://www.fantomas.sk/</A>
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
(R)etry, (A)bort, (C)ancer
 

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="021559.html">[squid-users] Is there a way on client to show proxy's	certificate?
</A></li>
	<LI>Next message (by thread): <A HREF="021563.html">[squid-users] Is there a way on client to show proxy's	certificate?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21562">[ date ]</a>
              <a href="thread.html#21562">[ thread ]</a>
              <a href="subject.html#21562">[ subject ]</a>
              <a href="author.html#21562">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
