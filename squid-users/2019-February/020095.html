<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] strange thing in the squid logs ...
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20strange%20thing%20in%20the%20squid%20logs%20...&In-Reply-To=%3Ce1745b79-f104-6574-1fae-fbea40ff787c%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020093.html">
   <LINK REL="Next"  HREF="020096.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] strange thing in the squid logs ...</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20strange%20thing%20in%20the%20squid%20logs%20...&In-Reply-To=%3Ce1745b79-f104-6574-1fae-fbea40ff787c%40treenet.co.nz%3E"
       TITLE="[squid-users] strange thing in the squid logs ...">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Feb  6 03:14:48 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020093.html">[squid-users] strange thing in the squid logs ...
</A></li>
        <LI>Next message (by thread): <A HREF="020096.html">[squid-users] Squid 5 binaries for: Debian, Ubuntu, CentOS, Oracle,	AWS 1+2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20095">[ date ]</a>
              <a href="thread.html#20095">[ thread ]</a>
              <a href="subject.html#20095">[ subject ]</a>
              <a href="author.html#20095">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 6/02/19 9:27 am, Walter H. wrote:
&gt;<i> Hello,
</I>&gt;<i> 
</I>&gt;<i> in iptables I have this:
</I>&gt;<i> 
</I>&gt;<i> *nat
</I>&gt;<i> ...
</I>&gt;<i> -A PREROUTING -i br0 -p tcp -s 192.168.1.100 --dport 80 -j DNAT
</I>&gt;<i> --to-destination 192.168.1.1:3129
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 192.168.1.100 is my PC and 192.168.1.1 is my NAT-Router, that has squid,
</I>&gt;<i> ... running
</I>&gt;<i> 
</I>&gt;<i> here the log
</I>&gt;<i> 
</I>&gt;<i> 192.168.1.100 - - [05/Feb/2019:20:57:09 +0100] &quot;CONNECT 77.74.177.233:80
</I>&gt;<i> HTTP/1.1&quot; 403 1516 &quot;-&quot; &quot;-&quot; TCP_DENIED:HIER_NONE
</I>&gt;<i> 192.168.1.100 - - [05/Feb/2019:20:58:41 +0100] &quot;CONNECT
</I>&gt;<i> 130.117.190.168:80 HTTP/1.1&quot; 403 1520 &quot;-&quot; &quot;-&quot; TCP_DENIED:HIER_NONE
</I>&gt;<i> 192.168.1.100 - - [05/Feb/2019:21:06:12 +0100] &quot;CONNECT
</I>&gt;<i> 207.123.56.252:80 HTTP/1.1&quot; 403 1518 &quot;-&quot; &quot;-&quot; TCP_DENIED:HIER_NONE
</I>&gt;<i> this are only examples in real there are many of these with exakt these
</I>&gt;<i> IP addresses
</I>&gt;<i> 
</I>&gt;<i> what is causing such strange?
</I>&gt;<i> 
</I>
Unknown.


&gt;<i> 
</I>&gt;<i> here the squid.conf
</I>&gt;<i> 
</I>...
&gt;<i> 
</I>&gt;<i> http_access deny CONNECT !SSL_ports&#160;&#160;&#160; # i guess this rule is causing
</I>&gt;<i> DENIED in the log, but why port 80 there???
</I>&gt;<i> 
</I>
Yes. This is the rule blocking those transactions.

The answer to your question though is known only to the client software
requesting those tunnels be opened.

Could be some form of attack against those servers or abusive use of
port 80 for non-HTTP. At very least it is trying to bypass the proxy for
some type of port 80 traffic.

If it worries you, then investigation of the traffic may prove fruitful.
Then you can decide what to do based on better information that your log
contains.


[ following is just some comments about polish to your squid.conf ]

&gt;<i> 
</I>&gt;<i> http_reply_access allow all
</I>
Does the default action, but in a slow way. You can simplify your config
and speed up Squid a little by removing the above line.


&gt;<i> 
</I>&gt;<i> always_direct allow all
</I>
Does the default action, but in a slow way. You can simplify your config
and speed up Squid a little by removing the above line.


&gt;<i> 
</I>&gt;<i> acl crl-mime rep_mime_type application/x-pkcs7-crl
</I>&gt;<i> no_cache deny crl-mime
</I>&gt;<i> 
</I>
&quot;no_cache&quot; does not exist since Squid-1.x. It is called just &quot;cache&quot; so
at very least please remove that &quot;no_&quot; part.

Also, the &quot;cache&quot; directive is tested for HTTP *requests*. There is no
HTTP *reply* mime type in request messages.

Either;

a) use req_mime_type (note the 'q'), or

b) remove both the above lines as pointless config, or

c) replace the &quot;no_cache&quot; name with &quot;store_miss&quot; in latest Squid-3.5+
proxies.


FWIW: it is not clear why you forbid CRL objects from being cached. They
are public information and caching works as well as with any other HTTP
objects.


&gt;<i> 
</I>&gt;<i> logformat combined %&gt;A %[ui %[un [%tl] &quot;%rm %ru HTTP/%rv&quot; %&gt;Hs %&lt;st
</I>&gt;<i> &quot;%{Referer}&gt;h&quot; &quot;%{User-Agent}&gt;h&quot; %Ss:%Sh
</I>&gt;<i> access_log /var/log/squid/access.log combined
</I>&gt;<i> 
</I>
FYI: The Apache &quot;common&quot; format is designed for use by web servers.
Which are quite different software from proxies. In particular they
typically do not have upstream origin-server connection and multiplexing
to deal with - which is a core part of being a proxy. So you are missing
out on several useful details the &quot;squid&quot; native log format provides.


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020093.html">[squid-users] strange thing in the squid logs ...
</A></li>
	<LI>Next message (by thread): <A HREF="020096.html">[squid-users] Squid 5 binaries for: Debian, Ubuntu, CentOS, Oracle,	AWS 1+2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20095">[ date ]</a>
              <a href="thread.html#20095">[ thread ]</a>
              <a href="subject.html#20095">[ subject ]</a>
              <a href="author.html#20095">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
