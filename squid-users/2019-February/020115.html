<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Bad HTTP header error on non-standard HTTP response code
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Bad%20HTTP%20header%20error%20on%20non-standard%20HTTP%0A%20response%20code&In-Reply-To=%3C44fd8f82-3490-f15c-8093-2650c3ca2cf5%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020110.html">
   <LINK REL="Next"  HREF="020139.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Bad HTTP header error on non-standard HTTP response code</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Bad%20HTTP%20header%20error%20on%20non-standard%20HTTP%0A%20response%20code&In-Reply-To=%3C44fd8f82-3490-f15c-8093-2650c3ca2cf5%40treenet.co.nz%3E"
       TITLE="[squid-users] Bad HTTP header error on non-standard HTTP response code">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Feb  6 20:15:52 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020110.html">[squid-users] Bad HTTP header error on non-standard HTTP response	code
</A></li>
        <LI>Next message (by thread): <A HREF="020139.html">[squid-users] Bad HTTP header error on non-standard HTTP response code
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20115">[ date ]</a>
              <a href="thread.html#20115">[ thread ]</a>
              <a href="subject.html#20115">[ subject ]</a>
              <a href="author.html#20115">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 7/02/19 6:39 am, Ivan Larionov wrote:
&gt;<i> Hello.
</I>&gt;<i> 
</I>&gt;<i> We've recently noticed a difference in behavior between squid v3 and v4.
</I>&gt;<i> 
</I>&gt;<i> On HTTP response with non-standard 4-digits HTTP code, for example
</I>&gt;<i> something like this:
</I>&gt;<i> 
</I>&gt;<i> HTTP/1.1 5009 Update Error
</I>&gt;<i> Connection: Closed
</I>&gt;<i> 
</I>&gt;<i> {&quot;code&quot;:500911,&quot;message&quot;:&quot;update record error&quot;}
</I>

Well, according to the HTTP specification this is an HTTP/0.9 message
pretending to be an HTTP/1 message:

 HTTP/0.9 := [optional text] CRLF

 HTTP/1.x := &quot;HTTP/1.&quot; DIGIT SP 3*DIGIT SP [optional text] CRLF


Due to complaints Squid-4 dropped implicit support for HTTP/0.9
responses to HTTP/1 requests. The client is now required to make an
HTTP/0.9 style request for 0.9 syntax to be expected.


&gt;<i> 
</I>&gt;<i> squid 3 just passes this response to the client, but squid 4 returns 502
</I>&gt;<i> with ERR_INVALID_RESP&#160;template and writes into cache.log:
</I>&gt;<i> 
</I>&gt;<i> WARNING: HTTP: Invalid Response: Bad header encountered from &#8230; AKA &#8230;
</I>&gt;<i> 
</I>&gt;<i> While I understand that 4-digits response code is not standard I'd like
</I>&gt;<i> to know:
</I>&gt;<i> 
</I>&gt;<i> Is it expected behavior and is there an option to change squid 4
</I>&gt;<i> behavior to match squid 3?
</I>
This is intentional behaviour. According to the specification the
recipient (Squid) MUST treat it as a malformed 500 response. It was a
bug in Squid-3 to pass the status unchanged.


PS. If you have any contact with people in charge of the server
producing these responses please contact them an encourage proper HTTP
syntax be used. The requirements are not particularly difficult and RFC
7230 series of documents are a lot clearer to understand than the old ones.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020110.html">[squid-users] Bad HTTP header error on non-standard HTTP response	code
</A></li>
	<LI>Next message (by thread): <A HREF="020139.html">[squid-users] Bad HTTP header error on non-standard HTTP response code
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20115">[ date ]</a>
              <a href="thread.html#20115">[ thread ]</a>
              <a href="subject.html#20115">[ subject ]</a>
              <a href="author.html#20115">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
