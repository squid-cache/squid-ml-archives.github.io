<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] redirecting one url to another
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20redirecting%20one%20url%20to%20another&In-Reply-To=%3C68b7798d-7c6d-edc6-09bd-6d256b07d775%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020125.html">
   <LINK REL="Next"  HREF="020127.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] redirecting one url to another</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20redirecting%20one%20url%20to%20another&In-Reply-To=%3C68b7798d-7c6d-edc6-09bd-6d256b07d775%40treenet.co.nz%3E"
       TITLE="[squid-users] redirecting one url to another">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Feb  8 02:08:37 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020125.html">[squid-users] redirecting one url to another
</A></li>
        <LI>Next message (by thread): <A HREF="020127.html">[squid-users] High response times with Squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20126">[ date ]</a>
              <a href="thread.html#20126">[ thread ]</a>
              <a href="subject.html#20126">[ subject ]</a>
              <a href="author.html#20126">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 8/02/19 4:55 am, Walid A. Shaari wrote:
&gt;<i> On Thu, 7 Feb 2019 at 15:24, Amos Jeffries wrote:
</I>&gt;<i> 
</I>&gt;<i>     On 8/02/19 12:28 am, Walid A. Shaari wrote:
</I>&gt;<i>     &gt; Greetings,
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; due to architectural&#160;or workflow issue, I would like to utilize
</I>&gt;<i>     squid to
</I>&gt;<i>     &gt; redirect one url to another.
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; e.g.&#160; bing.com to google.com 
</I>&gt;<i>     &gt; however, keep the parameters, is that doable?
</I>&gt;<i>     &gt;
</I>&gt;<i> 
</I>&gt;<i>     There are two problems;
</I>&gt;<i> 
</I>&gt;<i>     First is that those services no longer use HTTP. So you will need to
</I>&gt;<i>     decrypt the HTTPS to get any access to the URLs.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> thats doable correct via bump and splice?
</I>
SSL-Bump is the feature for decrypting, yes.

&gt;<i> 
</I>&gt;<i> &#160;Second is that they are different services by different organizations.
</I>&gt;<i> 
</I>&gt;<i>     So the parameters have different meanings. Retaining them can cause more
</I>&gt;<i>     problems than it solves.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> in my case actually it is the same, it is an issue DNS whitlisting at
</I>&gt;<i> work. as when a cname resolution happens it happens at the proxy end not
</I>&gt;<i> the host end, does that make any sense?
</I>
Not really. Are you saying that when your users request DNS entries for
bing.com your DNS server hands them the IPs for google.com ?



&gt;<i> so for example
</I>&gt;<i> 
</I>&gt;<i> dc.services.visualstudio.com &lt;<A HREF="http://dc.services.visualstudio.com">http://dc.services.visualstudio.com</A>&gt;
</I>&gt;<i> requsted is actually a CNAME for dc.applicationinsights.microsoft.com
</I>&gt;<i> &lt;<A HREF="http://dc.applicationinsights.microsoft.com">http://dc.applicationinsights.microsoft.com</A>&gt;
</I>
CNAME is irrelevant unless your DNS resolver is broken. In that case the
only way to get things to work is to fix the resolver, or use a
different one.


&gt;<i> 
</I>&gt;<i> I always thought DNS resolution happens first, then that is passed to
</I>&gt;<i> the proxy server,
</I>
Not always. Only for intercepted and reverse-proxy traffic - the client
thinks it is talking directly to an origin server so it has to do its
own DNS lookups to find that origin.

With Forward/explicit proxy the client only has to lookup the proxy IP
and send requests there. The proxy performs origin server lookups and
selection on behalf of the client.


&gt;<i> in my case from tcpdump, I belive the http payload
</I>&gt;<i> host is the one that gets resolved by the proxy,
</I>
Proxy always resolves the DNS records. Different HTTP traffic modes use
it for different things. Access controls may also need DNS resolution
for things.

[ Assuming here that by &quot;payload host&quot; you mean Origin Server. All HTTP
agents produce payloads. ]


&gt;<i> and if the proxy has a
</I>&gt;<i> web gateway in front of it, this is where the whitelisting/black listing
</I>&gt;<i> happens before any name resoultion/alias are resolved. am I right?
</I>
No. A web gateway is just another proxy. Access control can and does
happen at each hop. What each proxy does is up to their admins config
choices and traffic types.


&gt;<i> I
</I>&gt;<i> apperciate any good resources on how and where name resolution happens
</I>&gt;<i> when proxises, load balancers and web gateways&#160; are involved 
</I>
Each agent which needs DNS resolution for anything does its own resolution.

What DNS is used for depends on what each agent does. It is very tricky
to give certainties about specific actions when only describing the
general role types.

Many of your questions may be resolve by reading section 2.1 to 2.3 of
the HTTP/1.1 specification
(&lt;<A HREF="https://tools.ietf.org/html/rfc7230#section-2.1">https://tools.ietf.org/html/rfc7230#section-2.1</A>&gt;).

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020125.html">[squid-users] redirecting one url to another
</A></li>
	<LI>Next message (by thread): <A HREF="020127.html">[squid-users] High response times with Squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20126">[ date ]</a>
              <a href="thread.html#20126">[ thread ]</a>
              <a href="subject.html#20126">[ subject ]</a>
              <a href="author.html#20126">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
