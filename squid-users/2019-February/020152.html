<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Filering HTTPS URLs - A complete configuration
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Filering%20HTTPS%20URLs%20-%20A%20complete%20configuration&In-Reply-To=%3Ced3096f0-fff0-2f8b-ddc5-e89cdbf92749%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020144.html">
   <LINK REL="Next"  HREF="020093.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Filering HTTPS URLs - A complete configuration</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Filering%20HTTPS%20URLs%20-%20A%20complete%20configuration&In-Reply-To=%3Ced3096f0-fff0-2f8b-ddc5-e89cdbf92749%40measurement-factory.com%3E"
       TITLE="[squid-users] Filering HTTPS URLs - A complete configuration">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Feb 12 21:48:51 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020144.html">[squid-users] Filering HTTPS URLs - A complete configuration
</A></li>
        <LI>Next message (by thread): <A HREF="020093.html">[squid-users] strange thing in the squid logs ...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20152">[ date ]</a>
              <a href="thread.html#20152">[ thread ]</a>
              <a href="subject.html#20152">[ subject ]</a>
              <a href="author.html#20152">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2/11/19 3:55 AM, Paul Doignon wrote:

&gt;&gt;<i> The closest you are going to get to the above is with:
</I>&gt;&gt;<i> * bump everything[1], and
</I>&gt;&gt;<i> * use http_access to check the <A HREF="https://">https://</A> URLs for your policy
</I>&gt;&gt;<i> * use &quot;deny_info TCP_RESET&quot; [2] on the blocked requests.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> [1] some things literally cannot be bumped. So a decision needs to be
</I>&gt;&gt;<i> made about what to do then.
</I>
&gt;<i> I guess adding this second line will terminate those un-bumpable requests?
</I>
No, that second ssl_bump line has no effect -- it will never be reached.

You are probably misinterpreting what was meant by &quot;literally cannot be
bumped&quot;. What was meant by that phrase was that bumping certain
connections always results in client and/or server errors, regardless of
how you configure Squid. In those cases, Squid will still perform the
bump action if you tell it to bump, but that action will not lead to a
functioning tunnel through Squid.

In general, Squid itself cannot predict which connections can be
successfully bumped. You have to tell it (using ACLs, like the
whitelisted ACL in the example below).


&gt;<i> ssl_bump bump all
</I>&gt;<i> ssl_bump terminate all
</I>
The first line emulates client-first bumping. That is not what you want.

To bump all connections, you could use something like this:

  ssl_bump stare all
  ssl_bump bump all

To bump all connections except whitelisted ones, you probably want
something like this:

  ssl_bump splice whitelisted
  ssl_bump stare all
  ssl_bump bump all

... where whitelisted is your ACL implementing your white listing policy
(i.e. matching TLS connections that should be spliced). It may use
ssl::server_name and probably other ACLs.

More details at <A HREF="https://wiki.squid-cache.org/Features/SslPeekAndSplice">https://wiki.squid-cache.org/Features/SslPeekAndSplice</A>

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020144.html">[squid-users] Filering HTTPS URLs - A complete configuration
</A></li>
	<LI>Next message (by thread): <A HREF="020093.html">[squid-users] strange thing in the squid logs ...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20152">[ date ]</a>
              <a href="thread.html#20152">[ thread ]</a>
              <a href="subject.html#20152">[ subject ]</a>
              <a href="author.html#20152">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
