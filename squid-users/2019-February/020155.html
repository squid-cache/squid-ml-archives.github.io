<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Compiling with OpenSSL 1.1+
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Compiling%20with%20OpenSSL%201.1%2B&In-Reply-To=%3C58df29ad-1ffd-a161-0e0b-747293e5617a%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020154.html">
   <LINK REL="Next"  HREF="020161.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Compiling with OpenSSL 1.1+</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Compiling%20with%20OpenSSL%201.1%2B&In-Reply-To=%3C58df29ad-1ffd-a161-0e0b-747293e5617a%40treenet.co.nz%3E"
       TITLE="[squid-users] Compiling with OpenSSL 1.1+">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Feb 13 11:27:25 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020154.html">[squid-users] Compiling with OpenSSL 1.1+
</A></li>
        <LI>Next message (by thread): <A HREF="020161.html">[squid-users] Compiling with OpenSSL 1.1+
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20155">[ date ]</a>
              <a href="thread.html#20155">[ thread ]</a>
              <a href="subject.html#20155">[ subject ]</a>
              <a href="author.html#20155">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 13/02/19 10:26 pm, Santschi Yann wrote:
&gt;<i> Hello everybody,
</I>&gt;<i> 
</I>&gt;<i> I'm trying to compile Squid 4.4 with OpenSSL 1.1.1a and I'm getting
</I>&gt;<i> compilation errors like this one :
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> In file included from ../../src/security/Context.h:15:0,
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; from ../../src/security/forward.h:13,
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; from ../../src/SquidConfig.h:21,
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; from old_api.cc:24:
</I>&gt;<i> ../../compat/openssl.h:121:2: error: #error missing both OpenSSL API
</I>&gt;<i> features EVP_PKEY_up_ref (v1.1) and CRYPTO_LOCK_EVP_PKEY (v1.0)
</I>&gt;<i> &#160;#error missing both OpenSSL API features EVP_PKEY_up_ref (v1.1) and
</I>&gt;<i> CRYPTO_LOCK_EVP_PKEY (v1.0)
</I>&gt;<i> 
</I>
Squid is not able to find your OpenSSL libcrypto installation. Neither
1.0 nor 1.1 version headers are available to the compiler.

The config.log file generated during the ./configure build stage should
contain hints about why that is. It should really have existed with an
error when detecting the library files, but may not have if you have
some other version of libssl or libcrypto or derivatives such as
libressl installed on the build machine in the usual (FHS) location for
such things.


You have this:

&gt;<i> --with-openssl=/usr/local/ssl-1.1.1a/
</I>
So please check that the libssl and libcrypto library and header
includes have been successfully *installed* at that location. Simply
expanding the library source code to there is not installation - this is
a common mistake, it has to actually be built and installed at the path
you are telling the Squid compile system to use.



&gt;<i> If I compile with the deprecated OpenSSL 1.0.2 branch it works but I
</I>&gt;<i> don't want to use this branch. My goal is to offload SSL-Bump with
</I>&gt;<i> hardware that needs OpenSSL 1.1.1.
</I>&gt;<i> 
</I>&gt;<i> I'm looking for a solution for a couple of days and I found absolutely
</I>&gt;<i> nothing that helps in Squid documentation, source code and Google.
</I>&gt;<i> 
</I>&gt;<i> According to the &quot;CompilingSquid&quot; FAQ it should be feasible with
</I>&gt;<i> Squid-4. Page <A HREF="https://wiki.squid-cache.org/SquidFaq/CompilingSquid">https://wiki.squid-cache.org/SquidFaq/CompilingSquid</A> says
</I>&gt;<i> following&#160;:
</I>&gt;<i> 
</I>&gt;<i> However, please note that Squid-3.5
</I>&gt;<i> &lt;<A HREF="https://wiki.squid-cache.org/Squid-3.5">https://wiki.squid-cache.org/Squid-3.5</A>&gt; is not compatible with OpenSSL
</I>&gt;<i> v1.1+. As of Debian Squeeze, or Ubuntu Zesty the *libssl1.0-dev* package
</I>&gt;<i> must be used instead. This is resolved in the Squid-4
</I>&gt;<i> &lt;<A HREF="https://wiki.squid-cache.org/Squid-4">https://wiki.squid-cache.org/Squid-4</A>&gt; packages.
</I>&gt;<i> 
</I>
Since you are quoting the Debian and Ubuntu statements, are we to assume
that you are using one of those OS?
 If so, why not use the Debian Buster or Ubuntu Cosmic libssl-dev
package which is currently already at v1.1.1 ?


&gt;<i> 
</I>&gt;<i> The configure script is run with following parameters :
</I>&gt;<i> 
</I>&gt;<i> ./configure LDFLAGS=-ldl --prefix=/usr --includedir=/usr/include
</I>&gt;<i> --datadir=/usr/share --bindir=/usr/sbin --libexecdir=/usr/lib/squid
</I>&gt;<i> -localstatedir=/var --sysconfdir=/etc/squid --with-default-user=squid
</I>&gt;<i> --with-openssl=/usr/local/ssl-1.1.1a/ --enable-ssl --enable-ssl-crtd
</I>&gt;<i> --enable-linux-netfilter --enable-snmp --enable-useragent-log
</I>&gt;<i> --enable-referer-log --enable-cachemgr --enable-truncate
</I>&gt;<i> --enable-underscores --enable-stacktrace --enable-async-io=160
</I>&gt;<i> --enable-poll --enable-icmp --enable-ipfw-transparent
</I>&gt;<i> --enable-forw-via-db --enable-cache-digests --with-included-ltdl
</I>&gt;<i> --enable-ltdl-convenience
</I>
If you can spare some time please also run &quot;./configure --help&quot; and
remove the options from the above set which do not exist. At least the
--enable-ssl and log ones are non-existing.


HTH
Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020154.html">[squid-users] Compiling with OpenSSL 1.1+
</A></li>
	<LI>Next message (by thread): <A HREF="020161.html">[squid-users] Compiling with OpenSSL 1.1+
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20155">[ date ]</a>
              <a href="thread.html#20155">[ thread ]</a>
              <a href="subject.html#20155">[ subject ]</a>
              <a href="author.html#20155">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
