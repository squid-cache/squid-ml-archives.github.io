<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] ssl-bump does not redirect to block page
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ssl-bump%20does%20not%20redirect%20to%20block%20page&In-Reply-To=%3C227618796.196669.1550059833071%40mail.yahoo.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020163.html">
   <LINK REL="Next"  HREF="020158.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] ssl-bump does not redirect to block page</H1>
    <B>leomessi983 at yahoo.com</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ssl-bump%20does%20not%20redirect%20to%20block%20page&In-Reply-To=%3C227618796.196669.1550059833071%40mail.yahoo.com%3E"
       TITLE="[squid-users] ssl-bump does not redirect to block page">leomessi983 at yahoo.com
       </A><BR>
    <I>Wed Feb 13 12:10:33 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020163.html">[squid-users] ssl-bump does not redirect to block page
</A></li>
        <LI>Next message (by thread): <A HREF="020158.html">[squid-users] ssl-bump does not redirect to block page
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20156">[ date ]</a>
              <a href="thread.html#20156">[ thread ]</a>
              <a href="subject.html#20156">[ subject ]</a>
              <a href="author.html#20156">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE> I use this configuration to solve my problem.Whit this configuration at first step I use bump action for sites that i want to block and show ACCESS_DENIED page then splice all other requests!!My problem in this config is when my clients want to see block pages they first see SSL warning in their browser then after click on exception they will see ACCESS_DENIED page!!
..........acl blk ssl::server_name &quot;/var/blkfiles/url.txt&quot;
http_access  deny blkacl step1 at_step SslBump1ssl_bump peek step1ssl_bump bump blkssl_bump splice all

    On Wednesday, February 13, 2019, 9:55:06 AM GMT+3:30, <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-request at lists.squid-cache.org</A> &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-request at lists.squid-cache.org</A>&gt; wrote:  
 
 Send squid-users mailing list submissions to
&#160;&#160;&#160; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>

To subscribe or unsubscribe via the World Wide Web, visit
&#160;&#160;&#160; <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
or, via email, send a message with subject or body 'help' to
&#160;&#160;&#160; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-request at lists.squid-cache.org</A>

You can reach the person managing the list at
&#160;&#160;&#160; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-owner at lists.squid-cache.org</A>

When replying, please edit your Subject line so it is more specific
than &quot;Re: Contents of squid-users digest...&quot;


Today's Topics:

&#160; 1. ssl-bump does not redirect to block page (<A HREF="https://lists.squid-cache.org/listinfo/squid-users">leomessi983 at yahoo.com</A>)
&#160; 2. Re: ssl-bump does not redirect to block page (Alex Rousskov)
&#160; 3. Pass ip to server (erdosain9)
&#160; 4. Re: Pass ip to server (Joey Officer)
&#160; 5. Re: Filering HTTPS URLs - A complete configuration (Alex Rousskov)
&#160; 6. Re: ssl-bump does not redirect to block page
&#160; &#160; &#160; (<A HREF="https://lists.squid-cache.org/listinfo/squid-users">leomessi983 at yahoo.com</A>)


----------------------------------------------------------------------

Message: 1
Date: Tue, 12 Feb 2019 14:21:34 +0000 (UTC)
From: &quot;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">leomessi983 at yahoo.com</A>&quot; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">leomessi983 at yahoo.com</A>&gt;
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: [squid-users] ssl-bump does not redirect to block page
Message-ID: &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">1479917107.2282419.1549981294109 at mail.yahoo.com</A>&gt;
Content-Type: text/plain; charset=&quot;utf-8&quot;

Hi againDo i have to use CA and Certificate configuration if i want to block only&#160; HTTPS requests with splice action?!


https_port 3130 tproxy ssl-bump \
&#160; cert=/etc/squid/ssl_cert/myCA.pem \
&#160; generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
&#160; sslcrtd_program /usr/lib64/squid/security_file_certgen -s /var/lib/ssl_db -M 4MB
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20190212/8311d242/attachment-0001.html">http://lists.squid-cache.org/pipermail/squid-users/attachments/20190212/8311d242/attachment-0001.html</A>&gt;

------------------------------

Message: 2
Date: Tue, 12 Feb 2019 08:04:08 -0700
From: Alex Rousskov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt;
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] ssl-bump does not redirect to block page
Message-ID:
&#160;&#160;&#160; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">024a80a6-6b15-e9d8-06f9-b9645fbb3058 at measurement-factory.com</A>&gt;
Content-Type: text/plain; charset=utf-8

On 2/12/19 7:21 AM, <A HREF="https://lists.squid-cache.org/listinfo/squid-users">leomessi983 at yahoo.com</A> wrote:

&gt;<i> Do i have to use CA and Certificate configuration if i want to block
</I>&gt;<i> only HTTPS requests with splice action?!
</I>
IIRC, you currently need a CA certificate if you want to use SslBump,
regardless of the SslBump actions in use. In some ways, this is a
limitation of the current SslBump implementation rather than a natural
requirement, but the CA certificate is needed when Squid reports an
error to the client because Squid has to bump the client connection to
report errors.

If you do not care what happens when handling errors, then you probably
do not need to configure dynamic certificate generation. I have not
tested that, but I assume that, when reporting errors in that case,
Squid will silently revert to using the old code that generates
self-signed certificates (and the client will not trust them).


Please note that it is not clear what you mean by &quot;to block with splice
action&quot; -- splice does not block anything. If you are blocking requests
using http_access rules, then Squid is probably using an (implicit) bump
action to report blocking to the client, as discussed above. Blocking is
an example of errors that may happen even when you do not explicitly
bump any requests.

Alex.


&gt;<i> https_port 3130 tproxy ssl-bump \
</I>&gt;<i> &#160; cert=/etc/squid/ssl_cert/myCA.pem \
</I>&gt;<i> &#160; generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
</I>&gt;<i>&#160; sslcrtd_program /usr/lib64/squid/security_file_certgen -s /var/lib/ssl_db -M 4MB
</I>


------------------------------

Message: 3
Date: Tue, 12 Feb 2019 09:14:45 -0600 (CST)
From: erdosain9 &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">erdosain9 at gmail.com</A>&gt;
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: [squid-users] Pass ip to server
Message-ID: &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">1549984485300-0.post at n4.nabble.com</A>&gt;
Content-Type: text/plain; charset=us-ascii

Hi.
I want to know if is possible that, for some site (sales.mydomain.com) the
proxy server send the &quot;real ip&quot;.

Because i want to see in the logs of sales.mydomain.com the real ip of the
machine that are going (and not the proxy ip).

I know that i can see this in the log of squid... but, i want to know if it
is possible see this in the other server.

Thanks to all.



--
Sent from: <A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html">http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html</A>


------------------------------

Message: 4
Date: Tue, 12 Feb 2019 16:49:58 +0000
From: Joey Officer &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">JOfficer at istreamfs.com</A>&gt;
To: erdosain9 &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">erdosain9 at gmail.com</A>&gt;,
&#160;&#160;&#160; &quot;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&quot;
&#160;&#160;&#160; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
Subject: Re: [squid-users] Pass ip to server
Message-ID:
&#160;&#160;&#160; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">DM5PR19MB1579C05FD36C83FF2D018DF8CD650 at DM5PR19MB1579.namprd19.prod.outlook.com</A>&gt;
&#160;&#160;&#160; 
Content-Type: text/plain; charset=&quot;utf-8&quot;

I believe the option you are referring to is the 'forwarded_for' http header.

Reference this: <A HREF="http://www.squid-cache.org/Doc/config/forwarded_for/">http://www.squid-cache.org/Doc/config/forwarded_for/</A>

Hope that helps you.

-----Original Message-----
From: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; On Behalf Of erdosain9
Sent: Tuesday, February 12, 2019 9:15 AM
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: [squid-users] Pass ip to server

Hi.
I want to know if is possible that, for some site (sales.mydomain.com) the proxy server send the &quot;real ip&quot;.

Because i want to see in the logs of sales.mydomain.com the real ip of the machine that are going (and not the proxy ip).

I know that i can see this in the log of squid... but, i want to know if it is possible see this in the other server.

Thanks to all.



--
Sent from: <A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html">http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html</A>
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>

------------------------------

Message: 5
Date: Tue, 12 Feb 2019 14:48:51 -0700
From: Alex Rousskov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt;
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] Filering HTTPS URLs - A complete
&#160;&#160;&#160; configuration
Message-ID:
&#160;&#160;&#160; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">ed3096f0-fff0-2f8b-ddc5-e89cdbf92749 at measurement-factory.com</A>&gt;
Content-Type: text/plain; charset=utf-8

On 2/11/19 3:55 AM, Paul Doignon wrote:

&gt;&gt;<i> The closest you are going to get to the above is with:
</I>&gt;&gt;<i> * bump everything[1], and
</I>&gt;&gt;<i> * use http_access to check the <A HREF="https://">https://</A> URLs for your policy
</I>&gt;&gt;<i> * use &quot;deny_info TCP_RESET&quot; [2] on the blocked requests.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> [1] some things literally cannot be bumped. So a decision needs to be
</I>&gt;&gt;<i> made about what to do then.
</I>
&gt;<i> I guess adding this second line will terminate those un-bumpable requests?
</I>
No, that second ssl_bump line has no effect -- it will never be reached.

You are probably misinterpreting what was meant by &quot;literally cannot be
bumped&quot;. What was meant by that phrase was that bumping certain
connections always results in client and/or server errors, regardless of
how you configure Squid. In those cases, Squid will still perform the
bump action if you tell it to bump, but that action will not lead to a
functioning tunnel through Squid.

In general, Squid itself cannot predict which connections can be
successfully bumped. You have to tell it (using ACLs, like the
whitelisted ACL in the example below).


&gt;<i> ssl_bump bump all
</I>&gt;<i> ssl_bump terminate all
</I>
The first line emulates client-first bumping. That is not what you want.

To bump all connections, you could use something like this:

&#160; ssl_bump stare all
&#160; ssl_bump bump all

To bump all connections except whitelisted ones, you probably want
something like this:

&#160; ssl_bump splice whitelisted
&#160; ssl_bump stare all
&#160; ssl_bump bump all

... where whitelisted is your ACL implementing your white listing policy
(i.e. matching TLS connections that should be spliced). It may use
ssl::server_name and probably other ACLs.

More details at <A HREF="https://wiki.squid-cache.org/Features/SslPeekAndSplice">https://wiki.squid-cache.org/Features/SslPeekAndSplice</A>

Alex.


------------------------------

Message: 6
Date: Wed, 13 Feb 2019 06:22:43 +0000 (UTC)
From: &quot;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">leomessi983 at yahoo.com</A>&quot; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">leomessi983 at yahoo.com</A>&gt;
To: &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
Subject: Re: [squid-users] ssl-bump does not redirect to block page
Message-ID: &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">974828205.84661.1550038963335 at mail.yahoo.com</A>&gt;
Content-Type: text/plain; charset=&quot;utf-8&quot;

&gt;&gt;<i> aka the 'bump' action.
</I>
&gt;<i> This part is misleading: Modern Squids _automatically_ bump connections
</I>&gt;<i> to report [access denied] errors -- no explicit bump action is required
</I>&gt;<i> (or even desirable). I do not know whether&gt; * that bumping does not happen for leo (e.g., due to Squid bugs), or
</I>
&gt;<i> * it does happen, but the browser refuses to show the error page anyway
</I>&gt;<i> .(because of certificate pinning and/or because Squid did not have enough
</I>&gt;<i> information to properly bump the client connection using just step1
</I>&gt;<i> knowledge).
</I>
&gt;<i> A packet capture or an ALL,2 cache.log may distinguish those two cases.
</I>
&gt;<i> Alex.
</I>
Hi Alex
Actually i don't understand if it could be done or not!!
Amos said it is impossible you said no!!
can you show me the correct configuration for blocking HTTPS requests with showing access denied page to clients?!
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20190213/d8a98891/attachment.html">http://lists.squid-cache.org/pipermail/squid-users/attachments/20190213/d8a98891/attachment.html</A>&gt;

------------------------------

Subject: Digest Footer

_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>


------------------------------

End of squid-users Digest, Vol 54, Issue 24
*******************************************
  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20190213/625df369/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20190213/625df369/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020163.html">[squid-users] ssl-bump does not redirect to block page
</A></li>
	<LI>Next message (by thread): <A HREF="020158.html">[squid-users] ssl-bump does not redirect to block page
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20156">[ date ]</a>
              <a href="thread.html#20156">[ thread ]</a>
              <a href="subject.html#20156">[ subject ]</a>
              <a href="author.html#20156">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
