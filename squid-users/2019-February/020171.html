<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] High response times with Squid
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20High%20response%20times%20with%20Squid&In-Reply-To=%3Ce4e1a6ddef0941edbd89094a5eed5829%40deshaw.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020169.html">
   <LINK REL="Next"  HREF="020174.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] High response times with Squid</H1>
    <B>Ahmad, Sarfaraz</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20High%20response%20times%20with%20Squid&In-Reply-To=%3Ce4e1a6ddef0941edbd89094a5eed5829%40deshaw.com%3E"
       TITLE="[squid-users] High response times with Squid">Sarfaraz.Ahmad at deshaw.com
       </A><BR>
    <I>Fri Feb 15 07:08:07 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020169.html">[squid-users] High response times with Squid
</A></li>
        <LI>Next message (by thread): <A HREF="020174.html">[squid-users] High response times with Squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20171">[ date ]</a>
              <a href="thread.html#20171">[ thread ]</a>
              <a href="subject.html#20171">[ subject ]</a>
              <a href="author.html#20171">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks for all the pointers :) I figured it out. Seamless.com's PTR lookups are slow and end up in SERVFAIL. 
And that was causing the delay here. I purged that ACL and it's all good.


-----Original Message-----
From: Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; 
Sent: Friday, February 15, 2019 9:24 AM
To: Ahmad, Sarfaraz &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">Sarfaraz.Ahmad at deshaw.com</A>&gt;; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] High response times with Squid

On 14/02/19 11:38 pm, Ahmad, Sarfaraz wrote:
&gt;<i> Hi again,
</I>&gt;<i> I made some progress on this.
</I>&gt;<i> To reiterate, I am peeking at the SNI and then bump all connections to 
</I>&gt;<i> the origin server in context of this problem. ( the origin server is 
</I>&gt;<i> seamless.com )
</I>&gt;<i> 
</I>&gt;<i> Here are the new findings ,
</I>&gt;<i> 1) The 20sec lag is noticed even when I splice the connection.
</I>&gt;<i> 2) It 99% has to do with the following slow ACL acl.
</I>&gt;<i> 
</I>&gt;<i> acl deny_explicit_dstdomain dstdomain &quot;/etc/squid/acls/deny_explicit_dstdomain&quot;
</I>&gt;<i> 
</I>&gt;<i> I see PTR lookups failing when Squid tries to validate my ACLs. When I disable that ACL, the 20second lag is gone. So I am pretty confident that subsequent PTR lookups are causing the delay here.
</I>&gt;<i> I don't see a configuration directive with which I can configure how many times Squid retries the lookup.
</I>&gt;<i> I see one that sets the timeout though (dns_timeout  defaults 30 seconds).
</I>&gt;<i> 
</I>&gt;<i> Could you guys give me some pointers on what could be happening here ?
</I>
Only repeat back to you what you have described to us ... DNS PTR lookups are slow.

Your squid.conf is needed to know where those lookups are happening and see if any can be avoided.

Amos
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020169.html">[squid-users] High response times with Squid
</A></li>
	<LI>Next message (by thread): <A HREF="020174.html">[squid-users] High response times with Squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20171">[ date ]</a>
              <a href="thread.html#20171">[ thread ]</a>
              <a href="subject.html#20171">[ subject ]</a>
              <a href="author.html#20171">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
