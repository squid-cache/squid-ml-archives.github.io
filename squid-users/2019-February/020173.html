<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Questions around https transparent chained proxy
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Questions%20around%20https%20transparent%20chained%20proxy&In-Reply-To=%3Ce46088d2-160a-7a59-8522-8d0cba96d233%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020172.html">
   <LINK REL="Next"  HREF="020175.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Questions around https transparent chained proxy</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Questions%20around%20https%20transparent%20chained%20proxy&In-Reply-To=%3Ce46088d2-160a-7a59-8522-8d0cba96d233%40treenet.co.nz%3E"
       TITLE="[squid-users] Questions around https transparent chained proxy">squid3 at treenet.co.nz
       </A><BR>
    <I>Sat Feb 16 14:02:03 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020172.html">[squid-users] Questions around https transparent chained proxy
</A></li>
        <LI>Next message (by thread): <A HREF="020175.html">[squid-users] Questions around https transparent chained proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20173">[ date ]</a>
              <a href="thread.html#20173">[ thread ]</a>
              <a href="subject.html#20173">[ subject ]</a>
              <a href="author.html#20173">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 16/02/19 9:18 pm, Walid A. Shaari wrote:
&gt;<i> Greetings,
</I>&gt;<i> 
</I>&gt;<i> The end goal is enforcing an appliance(s) tls traffic to go through
</I>&gt;<i> the corporate proxy, as I understand it (splice, not interested in
</I>&gt;<i> decrypting)
</I>&gt;<i> 
</I>&gt;<i> http traffic works fine. however not clear 100% regarding https traffic.
</I>&gt;<i> 
</I>&gt;<i> 1) does the order of the below directives (ssl_bump, never_direct, and
</I>&gt;<i> cacher_peer,..etc) matter where it is in the squid.conf file, or is it
</I>&gt;<i> just the ACLs and ssl_bump that are order strict in squid.conf?
</I>
The order of these directives does not matter. They are for different
&quot;hook&quot; / decision points in the transaction.

Lines with the same directive name are order dependent. They are
inspected in the exact order configured.


&gt;<i> 
</I>&gt;<i> ------ partial squid.conf  # is that order ok----
</I>&gt;<i> ssl_bump peek all     # or should I just peek at step1
</I>&gt;<i> ssl_bump splice  all
</I>&gt;<i> #ssl_bump bump all   # not necessary in that case, traffic should have
</I>&gt;<i> been already spliced
</I>&gt;<i> never_direct allow all
</I>&gt;<i> 
</I>&gt;<i> cache_peer  upstream-proxy parent 8118 0 no-query no-digest
</I>&gt;<i> ---------------------------
</I>&gt;<i> 
</I>&gt;<i> 2) What does the only-proxy option really means for cache-peer?
</I>
Responses received from that peer can only be proxied, not cached.


&gt;<i> 3) if the parent proxy is not using SSL/tls, however, the clients are
</I>&gt;<i> using tls/SSL, is that an issue?
</I>
Maybe. Traffic which arrive encrypted must leave encrypted.

If you apply &quot;bump&quot; action to a TLS connection, the resulting <A HREF="https://">https://</A>
URL requests received on that connection cannot go to an insecure peer.

If you are only splicing, then the CONNECT _can_ go to these peers.
Since the traffic is still in its original encrypted form.


&gt;<i> 4) in an https transparent chained proxy scenario, is there a way I
</I>&gt;<i> can get rid of exporting the squid proxy certificates to the clients?
</I>
You can choose not to do it.

If you are splicing, Squid should take no part in the crypto. Therefore
no X.509 cert generated by Squid will be delivered and the client has no
need of the custom CA to verify a non-existent cert.

If bumping ever occurs (eg to deliver an error message about TLS
failure). Then TLS clients will display warnings and popups about
inability to trust the server.

It is up to you whether that error handling case is important enough to
care.


&gt;<i> as the clients are part of an appliance that I do not have control
</I>&gt;<i> over and not all traffic is actually originating from browsers?
</I>
Being a Browser is irrelevant. All TLS clients have this behaviour. Not
to do so is a violation of TLS security requirements (aka. insecure).


&gt;<i> 5)  Is squid 3.5 out of the Linux distro good enough, or should I
</I>&gt;<i> upgrade to latest 4.x for a guaranteed splice functionality?
</I>

TLS environment is quite volatile, and Squid is constantly being updated
to cope with that and fix issues found in the implementation. Some major
changes cannot be backported without risking instability in 'stable'
series. Most small changes are not backported as a matter of policy.

An older version may be 'good enough' but for sure the latest release
will have less annoyances.


&gt;<i> the
</I>&gt;<i> unofficial binary package for RHEL available is 3.5.27, while centos
</I>&gt;<i> package is 4.5-1. shouldn't both be the same?
</I>

Eliezer does a fair bit of extra testing on his packages and they may
not all get updated at once. (I'm fairly sure he is open to funding if
you wish to sponsor any particular work.)


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020172.html">[squid-users] Questions around https transparent chained proxy
</A></li>
	<LI>Next message (by thread): <A HREF="020175.html">[squid-users] Questions around https transparent chained proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20173">[ date ]</a>
              <a href="thread.html#20173">[ thread ]</a>
              <a href="subject.html#20173">[ subject ]</a>
              <a href="author.html#20173">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
