<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid proxies won't pop up authentication or even attempt
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20proxies%20won%27t%20pop%20up%20authentication%20or%20even%0A%20attempt&In-Reply-To=%3C4c2db527-69fd-0176-524a-510776bfc5b1%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020202.html">
   <LINK REL="Next"  HREF="020208.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid proxies won't pop up authentication or even attempt</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20proxies%20won%27t%20pop%20up%20authentication%20or%20even%0A%20attempt&In-Reply-To=%3C4c2db527-69fd-0176-524a-510776bfc5b1%40treenet.co.nz%3E"
       TITLE="[squid-users] Squid proxies won't pop up authentication or even attempt">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Feb 22 10:04:16 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020202.html">[squid-users] Squid proxies won't pop up authentication or even attempt
</A></li>
        <LI>Next message (by thread): <A HREF="020208.html">[squid-users] Squid 4.x: cache_peer PROXY_PROTOCOL support with	squid parents
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20205">[ date ]</a>
              <a href="thread.html#20205">[ thread ]</a>
              <a href="subject.html#20205">[ subject ]</a>
              <a href="author.html#20205">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 22/02/19 7:25 pm, amlgp wrote:
&gt;<i> Hi all, I've been trying to troubleshoot this for the last 2 days and it's
</I>&gt;<i> starting to drive me nuts.
</I>&gt;<i> 
</I>&gt;<i> I am running on a Centos 6 server trying to start up some proxies with
</I>&gt;<i> Squid.
</I>&gt;<i> 
</I>&gt;<i> When I manually try to enter my proxy using Firefox, no window pops up for
</I>&gt;<i> authentication and I just time out.
</I>
Please be aware that lack of popups does not mean lack of
authentication. If the Browser is already aware of the credentials it is
expected to use from some earlier interaction it *should* be using them
seamlessly without popups.

&gt;<i>From your description above your actual problem is whatever causes the
</I>timeout. That may not be related to authentication, and given your
config below they are not related here either.


Timeouts without a clearly visible error message are more usually
related to the TCP/UDP level connectivity. DNS resolving taking
extremely long times, TCP connections getting lost in routing, NAT
misconfiguration, firewalls dropping packets, Path-MTU problems, and
other things like those.


&gt;<i> I have read that this might be due to a
</I>&gt;<i> http access or acl error but I can't see anything wrong.
</I>
You have an order issue with the auth config. More details inline below.
The timeout is a different problem.


&gt;<i> 
</I>&gt;<i> Steps I have taken so far:
</I>&gt;<i> 
</I>&gt;<i> -Set up network interfaces with Centos(all my IP's ping correctly from
</I>&gt;<i> inside the server and outside the server)
</I>
By &quot;from outside the server&quot; do you mean from some other test machine or
from the client machine where your Firefox is running?


&gt;<i> -Set up squid.conf with acl and userpass authentication
</I>&gt;<i> &gt; Squid version: squid-3.1.23-24.el6.x86_64
</I>&gt;<i> 
</I>
Since this is a new installation please start by trying an up to date
Squid version. This month we are up to v4.6.

You can find newer packages for CentOS in Eliezers repository referenced
from &lt;<A HREF="https://wiki.squid-cache.org/KnowledgeBase/CentOS">https://wiki.squid-cache.org/KnowledgeBase/CentOS</A>&gt;.


&gt;<i> Access logs are empty, error logs are currently empty in
</I>&gt;<i> /var/log/squid/squid.out after I fixed the visible_hostname error. Squid
</I>&gt;<i> starts/restarts/stops without errors.
</I>&gt;<i> 
</I>
[ Nabble omitted the config details for some reason. I have re-pasted
the non-default config settings in here. ]

...
&gt;<i> 
</I>&gt;<i> #
</I>&gt;<i> # INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
</I>&gt;<i> #
</I>&gt;<i> 
</I>&gt;<i> # Example rule allowing access from your local networks.
</I>&gt;<i> # Adapt localnet in the ACL section to list your (internal) IP networks
</I>&gt;<i> # Example rule allowing access from your local networks.
</I>&gt;<i> # Adapt localnet in the ACL section to list your (internal) IP networks
</I>&gt;<i> # from where browsing should be allowed
</I>&gt;<i> http_access allow localnet
</I>&gt;<i> http_access allow localhost
</I>&gt;<i> 
</I>&gt;<i> # And finally deny all other access to this proxy
</I>&gt;<i> http_access deny all
</I>&gt;<i> 
</I>
Here is the start of your *auth* problem. Any http_access lines after
here are irrelevant.

The above rules should be letting clients through just fine without
authentication. So the auth behaviour is most likely a secondary issue
not related to the timeout.


&gt;<i> # Squid normally listens to port 3128
</I>&gt;<i> http_port 3128
</I>&gt;<i> 
</I>...
&gt;<i> 
</I>&gt;<i> acl my_ip_198_abc_123_x myip 198.abc.123.x
</I>&gt;<i> tcp_outgoing_address 198.abc.123.x my_ip_198_abc_123_x
</I>
Any particular reason for this?

* Squid will default to letting the OS select outgoing IP based on the
rout the connection needs to travel.

* In such old Squid this will break when contacting IPv6 servers. Newer
Squid resolve that by ignoring impossible config requirements.


I suspect these lines are probably why the timeout behaviour is
happening, or that the real problem is something else that led you to
adding these as a workaround.


&gt;<i> 
</I>&gt;<i> auth_param basic program /usr/lib64/squid/ncsa_auth /etc/squid/passwords
</I>&gt;<i> auth_param basic children 5
</I>&gt;<i> auth_param basic realm proxy
</I>
&gt;<i> acl ncsa_users proxy_auth REQUIRED
</I>&gt;<i> http_access allow ncsa_users
</I>
 ... these rules of yours should be up in the area just below that line
which clearly says &quot;INSERT YOUR OWN RULE(S) HERE&quot;.


Also, &quot;allow&quot; action does not require credentials. It only uses
credentials when they are presented and lets other rules do the denial.
Similarly the &quot;REQUIRED&quot; keyword in the ACL only required that the login
presented is correct It does not fetch credentials from the user.
So, unless those other followup denial rules also use credentials the
authentication may never happen.

It is best to do like so:

 http_access deny !ncsa_users
 http_access allow localnet


Also, the fact of the users being in NCSA is only relevant to the helper
and already clear from the name of the helper being used. If you ever
move to a different auth system, different helper (eg PAM), or even
multiple ways to login. That ACL name will become confusing and maybe
incorrect. I recommend 'login' or 'auth' as less confusing names that
help make future changes smaller.


&gt;<i> 
</I>&gt;<i> visible_hostname localhost
</I>&gt;<i>
</I>&gt;<i> 
</I>&gt;<i> I have tried using the actual hostname that shows up when using the
</I>&gt;<i> &quot;hostname&quot; command and there are no changes, so I just replaced it with
</I>&gt;<i> localhost instead.
</I>
I'm not sure exactly what you mean by &quot;the visible_hostname error&quot;.
There are a few. Usually this displays messages when the hostname is not
able to resolve in DNS.

If Squid is unable to locate the host name, using the one presented by
the 'hostname' command is right. In full for FQDN, or as a subdomain of
your network domain if not.

Keeping in mind that the hostname should be an FQDN that machines in
your network can resolve with that networks DNS (or mDNS in the case of
'.local' TLD names). Newer Squid deal with these things far better and
will default to localhost without you having to do anything.


HTH
Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020202.html">[squid-users] Squid proxies won't pop up authentication or even attempt
</A></li>
	<LI>Next message (by thread): <A HREF="020208.html">[squid-users] Squid 4.x: cache_peer PROXY_PROTOCOL support with	squid parents
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20205">[ date ]</a>
              <a href="thread.html#20205">[ thread ]</a>
              <a href="subject.html#20205">[ subject ]</a>
              <a href="author.html#20205">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
