<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Websockets over HTTPS not working in squid 4
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Websockets%20over%20HTTPS%20not%20working%20in%20squid%204&In-Reply-To=%3C04e201d4cba1%24af3d2460%240db76d20%24%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020209.html">
   <LINK REL="Next"  HREF="020195.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Websockets over HTTPS not working in squid 4</H1>
    <B>eliezer at ngtech.co.il</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Websockets%20over%20HTTPS%20not%20working%20in%20squid%204&In-Reply-To=%3C04e201d4cba1%24af3d2460%240db76d20%24%40ngtech.co.il%3E"
       TITLE="[squid-users] Websockets over HTTPS not working in squid 4">eliezer at ngtech.co.il
       </A><BR>
    <I>Sat Feb 23 18:00:38 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020209.html">[squid-users] Websockets over HTTPS not working in squid 4
</A></li>
        <LI>Next message (by thread): <A HREF="020195.html">[squid-users] squid-5.0.0-20190221-re008097c6
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20217">[ date ]</a>
              <a href="thread.html#20217">[ thread ]</a>
              <a href="subject.html#20217">[ subject ]</a>
              <a href="author.html#20217">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I can think of a way to try and &quot;amend&quot; on an error in the next websocket
connection automatically.
I believe that using an ICAP service or eCAP module that is connected to an
external acl helper you can see if specific requests for specific domains
are trying to use websockets.
Technically the basic request and response can identify such sites with the
upgrade headers.
So if something can see this and decide that a the requested domain will be
spliced next time the clients connect to it, it's possible to do so.
It's risky if you have a secured environment unless you have a set of top
level domains such as &quot;.whatsapp.com&quot;.
I believe that we can open a list of services that must have websockets
enabled and/or being spliced and not intercepted.
 
I can start with vcenter web management services that must support
websockets.
*	Slack
*	Whatsapp
*	Others
 
If you are willing to share a set of domains that will be added to the wiki
as a &quot;websocket&quot; required for this service or set of domains wiki
I might be able to pull it off and write this ICAP service.
 
Eliezer
 
----
 &lt;<A HREF="http://ngtech.co.il/main-en/">http://ngtech.co.il/main-en/</A>&gt; Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email:  &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>

 
From: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; On Behalf Of
Felipe Arturo Polanco
Sent: Friday, February 22, 2019 00:20
To: Alex Rousskov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt;
Cc: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] Websockets over HTTPS not working in squid 4
 
I see.
 
Are you aware of any unofficial patch or something to tunnel websockets over
HTTPS in squid?
 
 
 
On Thu, Feb 21, 2019 at 5:33 PM Alex Rousskov
&lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt;
&gt;<i> wrote:
</I>On 2/21/19 2:11 PM, Felipe Arturo Polanco wrote:

&gt;<i> I have been trying to make websockets work over HTTPS but so far I
</I>&gt;<i> haven't been able to.
</I>

Official Squid cannot reliably detect and proxy native WebSocket
traffic. Until that support is available, if WebSocket traffic reaches
your intercepting Squid, then splicing suspected WebSocket connections
based on TCP/TLS-level information is your only option. And, yes, that
introduces lots of maintenance headaches, policy violations, and is not
reliable.

A bit more information about the topic is available on this 2018 thread:
<A HREF="http://lists.squid-cache.org/pipermail/squid-users/2018-July/018581.html">http://lists.squid-cache.org/pipermail/squid-users/2018-July/018581.html</A>

Alex.


&gt;<i> I'm trying the following websites that use websockets and none of them
</I>work:
&gt;<i> speedtest.net &lt;<A HREF="http://speedtest.net">http://speedtest.net</A>&gt;  &lt;<A HREF="http://speedtest.net">http://speedtest.net</A>&gt;
</I>&gt;<i> web.whatsapp.com &lt;<A HREF="http://web.whatsapp.com">http://web.whatsapp.com</A>&gt;  &lt;<A HREF="http://web.whatsapp.com">http://web.whatsapp.com</A>&gt;
</I>&gt;<i> <A HREF="https://slack.com/help/test">https://slack.com/help/test</A>
</I>&gt;<i> 
</I>&gt;<i> If I explicitly splice those domain names in squid.conf they work fine.
</I>&gt;<i> 
</I>&gt;<i> I'm not interested in bumping the websockets, I just want HTTPS
</I>&gt;<i> interception to work as well as websockets.
</I>_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;

<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20190223/ec531792/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20190223/ec531792/attachment.htm</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 11295 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20190223/ec531792/attachment.png">http://lists.squid-cache.org/pipermail/squid-users/attachments/20190223/ec531792/attachment.png</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020209.html">[squid-users] Websockets over HTTPS not working in squid 4
</A></li>
	<LI>Next message (by thread): <A HREF="020195.html">[squid-users] squid-5.0.0-20190221-re008097c6
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20217">[ date ]</a>
              <a href="thread.html#20217">[ thread ]</a>
              <a href="subject.html#20217">[ subject ]</a>
              <a href="author.html#20217">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
