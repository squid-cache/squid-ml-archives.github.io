<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid for Windows Repeatedly Crashing
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20for%20Windows%20Repeatedly%20Crashing&In-Reply-To=%3C04fc01d4cba3%24ce63ecf0%246b2bc6d0%24%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020207.html">
   <LINK REL="Next"  HREF="020230.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid for Windows Repeatedly Crashing</H1>
    <B>eliezer at ngtech.co.il</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20for%20Windows%20Repeatedly%20Crashing&In-Reply-To=%3C04fc01d4cba3%24ce63ecf0%246b2bc6d0%24%40ngtech.co.il%3E"
       TITLE="[squid-users] Squid for Windows Repeatedly Crashing">eliezer at ngtech.co.il
       </A><BR>
    <I>Sat Feb 23 18:15:50 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020207.html">[squid-users] Squid for Windows Repeatedly Crashing
</A></li>
        <LI>Next message (by thread): <A HREF="020230.html">[squid-users] Squid for Windows Repeatedly Crashing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20218">[ date ]</a>
              <a href="thread.html#20218">[ thread ]</a>
              <a href="subject.html#20218">[ subject ]</a>
              <a href="author.html#20218">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The next tool might help you to understand the status of the open
connections.
If the socket is being closed( I think Windows Server 2016 is a very good
OS...).
<A HREF="https://www.nirsoft.net/utils/cports.html">https://www.nirsoft.net/utils/cports.html</A>

There is a possibility that some OS TCP limit is being reached and there for
the socket closure.
If you are using F5 you can easily find out the load at the crash point.
I assume that if a normal Squid instance can take a load of 900k requests
per second in somewhat constant rate for more then a minute then the issue
might be else where then squid.
I am not sure but pretty sure that if you do not have anyone that is
knowledgeable enough about windows sockets, sessions and FW limitations you
will either:
- learn it your self
- find an expert
- use an OS that is more then 20% supported by any of the Squid-Cache team
members and other developers around the globe.

Just to say a good word about Windows Server 2016, I compared it to a
Windows 10 under load and it seems to take a lot more load.
Also it not just takes the load but balance it well (on an open source
windows designed software).

Also if you have a specific use case maybe a specific proxy can be
customized for it.
Let me know if you wish to shed more details on the configuration so I can
take my time and understand if there is a solution else then Squid.

Eliezeer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>


-----Original Message-----
From: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; On Behalf Of
Van Order, Drew (US - Hermitage)
Sent: Friday, February 22, 2019 15:32
To: Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] Squid for Windows Repeatedly Crashing

The test box I set up outside the F5 finally started exhibiting these
errors, once I pointed roughly 60 machines to it. It took a few hours.
Sounds like this narrows it down to either the OS itself (seems unlikely,
other apps would crash), or the litany of agents our security folks have
mandated. It may indeed be necessary to move to Linux.

Thank you very much for your time!

-----Original Message-----
From: Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;
Sent: Thursday, February 21, 2019 11:31 PM
To: Van Order, Drew (US - Hermitage) &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">dvanorder at deloitte.com</A>&gt;;
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: [EXT] Re: [squid-users] Squid for Windows Repeatedly Crashing

On 22/02/19 4:21 am, Van Order, Drew (US - Hermitage) wrote:
&gt;<i> Thank you for replying, and that's an excellent point.
</I>&gt;<i>
</I>&gt;<i> Short answer--definitely not in a container, these are garden variety
</I>VMWare instances. I've already flagged the OS power settings to maximum
performance, so nothing should be going to sleep. I'll doublecheck, though.
&gt;<i>
</I>&gt;<i> So, if I understand correctly, this error could also be indicative of an
</I>issue in between the agent and Squid. Agents first go through a firewall,
then the F5 before reaching Squid.

No that is not what I meant.

The port Squid has already opened and used syscall listen(2) on is what is
being closed (or its address corrupted) outside of Squid. That should only
ever be closed by Squid itself. Thus the error.

It is being closed repeatedly. Thus the abort/shutdown. This is not a crash,
it is intentional shutdown by Squid due to these fatal
(non-recoverable) errors.


&gt;<i>
</I>&gt;<i> [Stopped, reason:Listener socket closed job1]: (14) Bad address
</I>&gt;<i>
</I>&gt;<i> Any thoughts on this error, which tends to be more common than the other?
</I>&gt;<i>
</I>&gt;<i> 2019/02/20 09:42:33 kid1| comm_poll: poll failure: (14) Bad address
</I>&gt;<i> 2019/02/20 09:42:33 kid1| Select loop Error. Retry 2
</I>&gt;<i>
</I>
Notice how the error from the OS &quot;(14) Bad Address&quot; is the same. This is
just another display of the same problem. Maybe the poll() layer reporting
the exact same error as Squid tries to recover. Maybe for other non-listener
ports also being corrupted somehow.

If non-listener ports are having that same error it would be a sign the
machine memory is being corrupted rather than other software touching the
listener ports specifically.


( The details you have provided so far have no hints about where the problem
may be coming from, and I am not having any ideas about possibilities
either. I just hope the above explanation of meaning can help you think of
things to look at for more hints on this very weird issue. )

Amos
This message (including any attachments) contains confidential information
intended for a specific individual and purpose, and is protected by law. If
you are not the intended recipient, you should delete this message and any
disclosure, copying, or distribution of this message, or the taking of any
action based on it, by you is strictly prohibited.

v.E.1
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020207.html">[squid-users] Squid for Windows Repeatedly Crashing
</A></li>
	<LI>Next message (by thread): <A HREF="020230.html">[squid-users] Squid for Windows Repeatedly Crashing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20218">[ date ]</a>
              <a href="thread.html#20218">[ thread ]</a>
              <a href="subject.html#20218">[ subject ]</a>
              <a href="author.html#20218">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
