<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid for Windows Repeatedly Crashing
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20for%20Windows%20Repeatedly%20Crashing&In-Reply-To=%3CCO1PR85MB018181C58746E986C0103708C8790%40CO1PR85MB0181.NAMPRD85.PROD.OUTLOOK.COM%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020231.html">
   <LINK REL="Next"  HREF="020233.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid for Windows Repeatedly Crashing</H1>
    <B>Van Order, Drew (US - Hermitage)</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20for%20Windows%20Repeatedly%20Crashing&In-Reply-To=%3CCO1PR85MB018181C58746E986C0103708C8790%40CO1PR85MB0181.NAMPRD85.PROD.OUTLOOK.COM%3E"
       TITLE="[squid-users] Squid for Windows Repeatedly Crashing">dvanorder at deloitte.com
       </A><BR>
    <I>Sun Feb 24 14:26:46 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020231.html">[squid-users] Squid for Windows Repeatedly Crashing
</A></li>
        <LI>Next message (by thread): <A HREF="020233.html">[squid-users] Squid for Windows Repeatedly Crashing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20232">[ date ]</a>
              <a href="thread.html#20232">[ thread ]</a>
              <a href="subject.html#20232">[ subject ]</a>
              <a href="author.html#20232">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Wondered that too, and experimented with the squid.conf setting to see when warning messages appear, which was 1,000. Default cygwin setting of 3,200 is plenty.

Thanks for the idea, though!



Sent via the Samsung Galaxy S8+, an AT&amp;T 5G Evolution smartphone


-------- Original message --------
From: Rafael Akchurin &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rafael.akchurin at diladele.com</A>&gt;
Date: 2/24/19 8:47 AM (GMT-05:00)
To: &quot;Van Order, Drew (US - Hermitage)&quot; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">dvanorder at deloitte.com</A>&gt;, <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>, 'Amos Jeffries' &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;, <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: [EXT] RE: [squid-users] Squid for Windows Repeatedly Crashing

As far as I know the internal FD limit for Windows build is around 3K - might be being existed and thus unexpected behavior raising its ugly head..

-----Original Message-----
From: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; On Behalf Of Van Order, Drew (US - Hermitage)
Sent: Sunday, 24 February 2019 14:40
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>; 'Amos Jeffries' &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] Squid for Windows Repeatedly Crashing

This is helpful, and I especially appreciate the time given it is the weekend.

The Squids are confusing me, as everything is well behaved at the moment. One server was erroring off and on for a few hours earlier today, but stopped after a reboot.

It does appear that redirecting roughly 125 servers to no longer use the proxy has helped. Unfortunately, our F5 guy can't tell me how many IP addresses remain coming into this F5 VIP, which would give me the number of servers, and an idea how loaded this thing is. I have good reason to believe it is under 1,000. He has shown us graphs indicating the VIP isn't stressed, but I will keep working on him, b/c I can't imagine not being able to report how many distinct IP addresses hit the VIP.

I don't have a Visio, but

Server running the Microsoft Monitoring Agent sends data over tcp/443--&gt;Internal facing firewall(s)--&gt;F5 VIP--&gt;one of 4 Squids--&gt;internet

Each of the 4 VMWare Squids has 4 proc and 8 GB memory, 10 GB NIC.

We're a large enterprise with multiple data centers and many subnets, so there are quite a few firewalls, and most of the time a server must go through more than one firewall. Can't help but wonder if firewall exhaustion could cause the symptoms.

Revision: I typed the above last night. This morning, the server that had been erroring is at it again, but stopped. Others are fine. Interesting problem.

-----Original Message-----
From: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A> &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&gt;
Sent: Saturday, February 23, 2019 12:16 PM
To: Van Order, Drew (US - Hermitage) &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">dvanorder at deloitte.com</A>&gt;; 'Amos Jeffries' &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: [EXT] RE: [squid-users] Squid for Windows Repeatedly Crashing

The next tool might help you to understand the status of the open connections.
If the socket is being closed( I think Windows Server 2016 is a very good OS...).
<A HREF="https://secure-web.cisco.com/1gLLf4HP_bwYOteW6x8gJ8EGyBrYzTMzMIi7P6q7aGi136WObNRd7uZQkrv-CKTO7ipHpLgOvHaGbzxLT7RpG6AGtkeTHUn2O8-CIAgcBOCUzn6KyZoPhqsAcpIXokXWcjlWHdUVUwlZVT0WKEhuOuAGvw2washhJEOg1Gcbsf99cy7ofqJfuTc-fS23KxfiE8W-2GLLNuF_J8q5uGJdvUMhm6HN-4CO3c_i8wxOlHrxgX3GjSLbLo8odnA6YctD5A01sjW3dpC4oiioIkGY7gDY-hjSSNYr_xoZzsixScColG-JRDlR3uktjsFF5JCkU1EROfoOfUHsDdeJ0IV2Cpk6yzbSPNNno7jV5BmZSsmR_jRgW7WJa4eVhKUvicMfy8RBespjtbfk17lUf9JamqmxPBtP2eHsiIb4_wk9iJfRr_S-aA1Ve7rPDmCXm9bZ9HRmXphi8o5AeYMWbK9DTrnmPDmFamis922AT6F4KUuBvS3PKqeCkT3EUuGmlwHXxCiJGwYBKXQmOehcFbqgfFQ/https%3A%2F%2Fwww.nirsoft.net%2Futils%2Fcports.html">https://secure-web.cisco.com/1gLLf4HP_bwYOteW6x8gJ8EGyBrYzTMzMIi7P6q7aGi136WObNRd7uZQkrv-CKTO7ipHpLgOvHaGbzxLT7RpG6AGtkeTHUn2O8-CIAgcBOCUzn6KyZoPhqsAcpIXokXWcjlWHdUVUwlZVT0WKEhuOuAGvw2washhJEOg1Gcbsf99cy7ofqJfuTc-fS23KxfiE8W-2GLLNuF_J8q5uGJdvUMhm6HN-4CO3c_i8wxOlHrxgX3GjSLbLo8odnA6YctD5A01sjW3dpC4oiioIkGY7gDY-hjSSNYr_xoZzsixScColG-JRDlR3uktjsFF5JCkU1EROfoOfUHsDdeJ0IV2Cpk6yzbSPNNno7jV5BmZSsmR_jRgW7WJa4eVhKUvicMfy8RBespjtbfk17lUf9JamqmxPBtP2eHsiIb4_wk9iJfRr_S-aA1Ve7rPDmCXm9bZ9HRmXphi8o5AeYMWbK9DTrnmPDmFamis922AT6F4KUuBvS3PKqeCkT3EUuGmlwHXxCiJGwYBKXQmOehcFbqgfFQ/https%3A%2F%2Fwww.nirsoft.net%2Futils%2Fcports.html</A>

There is a possibility that some OS TCP limit is being reached and there for the socket closure.
If you are using F5 you can easily find out the load at the crash point.
I assume that if a normal Squid instance can take a load of 900k requests per second in somewhat constant rate for more than a minute then the issue might be else where then squid.
I am not sure but pretty sure that if you do not have anyone that is knowledgeable enough about windows sockets, sessions and FW limitations you will either:
- learn it your self
- find an expert
- use an OS that is more then 20% supported by any of the Squid-Cache team members and other developers around the globe.

Just to say a good word about Windows Server 2016, I compared it to a Windows 10 under load and it seems to take a lot more load.
Also it not just takes the load but balance it well (on an open source windows designed software).

Also if you have a specific use case maybe a specific proxy can be customized for it.
Let me know if you wish to shed more details on the configuration so I can take my time and understand if there is a solution else then Squid.

Eliezeer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>


-----Original Message-----
From: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; On Behalf Of Van Order, Drew (US - Hermitage)
Sent: Friday, February 22, 2019 15:32
To: Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] Squid for Windows Repeatedly Crashing

The test box I set up outside the F5 finally started exhibiting these errors, once I pointed roughly 60 machines to it. It took a few hours.
Sounds like this narrows it down to either the OS itself (seems unlikely, other apps would crash), or the litany of agents our security folks have mandated. It may indeed be necessary to move to Linux.

Thank you very much for your time!

-----Original Message-----
From: Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;
Sent: Thursday, February 21, 2019 11:31 PM
To: Van Order, Drew (US - Hermitage) &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">dvanorder at deloitte.com</A>&gt;; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: [EXT] Re: [squid-users] Squid for Windows Repeatedly Crashing

On 22/02/19 4:21 am, Van Order, Drew (US - Hermitage) wrote:
&gt;<i> Thank you for replying, and that's an excellent point.
</I>&gt;<i>
</I>&gt;<i> Short answer--definitely not in a container, these are garden variety
</I>VMWare instances. I've already flagged the OS power settings to maximum performance, so nothing should be going to sleep. I'll doublecheck, though.
&gt;<i>
</I>&gt;<i> So, if I understand correctly, this error could also be indicative of
</I>&gt;<i> an
</I>issue in between the agent and Squid. Agents first go through a firewall, then the F5 before reaching Squid.

No that is not what I meant.

The port Squid has already opened and used syscall listen(2) on is what is being closed (or its address corrupted) outside of Squid. That should only ever be closed by Squid itself. Thus the error.

It is being closed repeatedly. Thus the abort/shutdown. This is not a crash, it is intentional shutdown by Squid due to these fatal
(non-recoverable) errors.


&gt;<i>
</I>&gt;<i> [Stopped, reason:Listener socket closed job1]: (14) Bad address
</I>&gt;<i>
</I>&gt;<i> Any thoughts on this error, which tends to be more common than the other?
</I>&gt;<i>
</I>&gt;<i> 2019/02/20 09:42:33 kid1| comm_poll: poll failure: (14) Bad address
</I>&gt;<i> 2019/02/20 09:42:33 kid1| Select loop Error. Retry 2
</I>&gt;<i>
</I>
Notice how the error from the OS &quot;(14) Bad Address&quot; is the same. This is just another display of the same problem. Maybe the poll() layer reporting the exact same error as Squid tries to recover. Maybe for other non-listener ports also being corrupted somehow.

If non-listener ports are having that same error it would be a sign the machine memory is being corrupted rather than other software touching the listener ports specifically.


( The details you have provided so far have no hints about where the problem may be coming from, and I am not having any ideas about possibilities either. I just hope the above explanation of meaning can help you think of things to look at for more hints on this very weird issue. )

Amos
This message (including any attachments) contains confidential information intended for a specific individual and purpose, and is protected by law. If you are not the intended recipient, you should delete this message and any disclosure, copying, or distribution of this message, or the taking of any action based on it, by you is strictly prohibited.

v.E.1
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://secure-web.cisco.com/1rTtG7rZtQ6ZYF-exa33X6jslvqhns0Pi1uNpYErXcG6etibmd2SGhMCHECLwNvCY_z6WNGI9PaBD1nPWRtPe1XdcdZhuC10Oc9dQlldi3fS1vGPfi61VTB_e97sfZ2nE_5La5ibKly97QaMVeX4ib_qbPmqDOLDxWojYptvrbanhvTw0LMDyj92Yemr6GmVWk24CafYzhUBtvf-e8KVWHfPeNVfB537hUMROtnb3P2Ai1mcKSoamHQIIRn3kSkUD0Hg7sY7b-9LxTw617U5_JrdvsS5Qv8KJvkOYV-8jTAumLo3yhoc8WuMnYFRMDvbkwDV2T1LnqyfjyCzukxeiXxfgRMIDIrj2OBfNj33Xiw-rbU-thwedxYHIPJ0lIxU49DL4kAwlhAH173i_vZBUxMyqjVSvMIHutBPmEYNSDsnG0CVDRrYiF2BA3-7ZDPpQNjCUGUVP7K1NyA41OMZSeaRP8mtbuqrTwKT_BpNzx6IUc4_gFtkJZ_FgqpC2_uFPmtzLnSxnCM4Lz1om84BJVQ/http%3A%2F%2Flists.squid-cache.org%2Flistinfo%2Fsquid-users">http://secure-web.cisco.com/1rTtG7rZtQ6ZYF-exa33X6jslvqhns0Pi1uNpYErXcG6etibmd2SGhMCHECLwNvCY_z6WNGI9PaBD1nPWRtPe1XdcdZhuC10Oc9dQlldi3fS1vGPfi61VTB_e97sfZ2nE_5La5ibKly97QaMVeX4ib_qbPmqDOLDxWojYptvrbanhvTw0LMDyj92Yemr6GmVWk24CafYzhUBtvf-e8KVWHfPeNVfB537hUMROtnb3P2Ai1mcKSoamHQIIRn3kSkUD0Hg7sY7b-9LxTw617U5_JrdvsS5Qv8KJvkOYV-8jTAumLo3yhoc8WuMnYFRMDvbkwDV2T1LnqyfjyCzukxeiXxfgRMIDIrj2OBfNj33Xiw-rbU-thwedxYHIPJ0lIxU49DL4kAwlhAH173i_vZBUxMyqjVSvMIHutBPmEYNSDsnG0CVDRrYiF2BA3-7ZDPpQNjCUGUVP7K1NyA41OMZSeaRP8mtbuqrTwKT_BpNzx6IUc4_gFtkJZ_FgqpC2_uFPmtzLnSxnCM4Lz1om84BJVQ/http%3A%2F%2Flists.squid-cache.org%2Flistinfo%2Fsquid-users</A>


_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://secure-web.cisco.com/1Yp4oglvIuy6hUzZHykSqWJjhd1cnIyyY0c7NsY9il8SBh1aBObbh_voDSVz49Ag2jTcEVONo0o9fd7Y8EVx43GsvawkPmbymyJuELcntchcXJAQsP8QjkmG-6ndujF1n5TRZ0urNPeK-5x7WvPunADCWhPkv8tO743dAtOXjOXKAp-CBLw4Nxm9kLEPh-qOneGlR9qxMsGeRuBkGAyvXaeS4bYnY0f5VnuQN9wQ9gEux487TkTtlwE-Wu8pyryP8wkw-5ke0_jMZSXOszXYLNwhcXzVJyuTLKrtkNOdcE0Yp_S6V9C7c88f6NnRp_1FRmdpj_GURVtwUIP4Aa6E-udgS18am0j9VYBUdNvz8EdhJJQq08crZrH_OK8j6AciiRZp40QHAiW_-Moxu2NySShBoDQPQjLHNDTPssnv_pDtw0sKluNi6GXvSiIkGAq2fX6fAkyJAkW60K4aCa_2qQ9xp_ICLegvAjfKbT6fRl23NfrON7w2Bv0_2bhvAtwBL/http%3A%2F%2Flists.squid-cache.org%2Flistinfo%2Fsquid-users">http://secure-web.cisco.com/1Yp4oglvIuy6hUzZHykSqWJjhd1cnIyyY0c7NsY9il8SBh1aBObbh_voDSVz49Ag2jTcEVONo0o9fd7Y8EVx43GsvawkPmbymyJuELcntchcXJAQsP8QjkmG-6ndujF1n5TRZ0urNPeK-5x7WvPunADCWhPkv8tO743dAtOXjOXKAp-CBLw4Nxm9kLEPh-qOneGlR9qxMsGeRuBkGAyvXaeS4bYnY0f5VnuQN9wQ9gEux487TkTtlwE-Wu8pyryP8wkw-5ke0_jMZSXOszXYLNwhcXzVJyuTLKrtkNOdcE0Yp_S6V9C7c88f6NnRp_1FRmdpj_GURVtwUIP4Aa6E-udgS18am0j9VYBUdNvz8EdhJJQq08crZrH_OK8j6AciiRZp40QHAiW_-Moxu2NySShBoDQPQjLHNDTPssnv_pDtw0sKluNi6GXvSiIkGAq2fX6fAkyJAkW60K4aCa_2qQ9xp_ICLegvAjfKbT6fRl23NfrON7w2Bv0_2bhvAtwBL/http%3A%2F%2Flists.squid-cache.org%2Flistinfo%2Fsquid-users</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20190224/b6b34c28/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20190224/b6b34c28/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020231.html">[squid-users] Squid for Windows Repeatedly Crashing
</A></li>
	<LI>Next message (by thread): <A HREF="020233.html">[squid-users] Squid for Windows Repeatedly Crashing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20232">[ date ]</a>
              <a href="thread.html#20232">[ thread ]</a>
              <a href="subject.html#20232">[ subject ]</a>
              <a href="author.html#20232">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
