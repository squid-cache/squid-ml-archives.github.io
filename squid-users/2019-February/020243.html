<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Disable tls1.3 support , can't get SNI / cert details when it's used
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Disable%20tls1.3%20support%20%2C%0A%20can%27t%20get%20SNI%20/%20cert%20details%20when%20it%27s%20used&In-Reply-To=%3C0c53626c-b76d-616d-b4b3-ab0d76cb3651%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020240.html">
   <LINK REL="Next"  HREF="020268.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Disable tls1.3 support , can't get SNI / cert details when it's used</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Disable%20tls1.3%20support%20%2C%0A%20can%27t%20get%20SNI%20/%20cert%20details%20when%20it%27s%20used&In-Reply-To=%3C0c53626c-b76d-616d-b4b3-ab0d76cb3651%40measurement-factory.com%3E"
       TITLE="[squid-users] Disable tls1.3 support , can't get SNI / cert details when it's used">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Feb 26 19:10:31 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020240.html">[squid-users] Disable tls1.3 support ,	can't get SNI / cert details when it's used
</A></li>
        <LI>Next message (by thread): <A HREF="020268.html">[squid-users] Disable tls1.3 support , can't get SNI / cert details when it's used
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20243">[ date ]</a>
              <a href="thread.html#20243">[ thread ]</a>
              <a href="subject.html#20243">[ subject ]</a>
              <a href="author.html#20243">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2/26/19 4:55 AM, Stilyan Georgiev wrote:

&gt;<i> Squid 4.5 with openssl support here.
</I>&gt;<i> SSL bumping can't obtain SNI / cert domain to perform filtering when
</I>&gt;<i> tls1.3 is used.
</I>&gt;<i> I want to disable support for tls1.3 in config but don't find way to do
</I>&gt;<i> so. There's the outdated sslproxy_options config directive which doesn't
</I>&gt;<i> appear to be supported in 4.5
</I>&gt;<i> 
</I>&gt;<i> The goal is - allow everything , besides tls1.3
</I>
Good question!

TLS v1.3 clients that use &quot;Middlebox Compatibility Mode&quot;, including
OpenSSL s_client and popular browsers, pretend to be TLS v1.2 clients
that attempt to restore a non-existent TLS session. Squid probably does
not have ACLs that can detect those lies. However, if you think you can
detect them, you can pass TLS Hello to your external ACL via the
%&gt;handshake logformat code.

If you are asking whether Squid can downgrade TLS v1.3 to TLS v1.2, then
I suspect the answer is &quot;yes, but only if you bump the client connection
first&quot;: A peeking Squid cannot negotiate a different TLS version with
the client. If TLS downgrade is what you want, you can probably use an
OpenSSL version that does not support TLS v1.3. There may also be an
OpenSSL v1.1.1 configuration option to turn TLS v1.3 support off, but I
have not research that.

Finally, there may be a bug in earlier versions of Squid that breaks
peeking at TLS v1.3 servers during step2. Staring works. We have not
tested Squid v4.5 though. Please note that peeking at TLS v1.3 servers
is largely pointless because useful information in TLS v1.3 Server Hello
is encrypted.


HTH,

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020240.html">[squid-users] Disable tls1.3 support ,	can't get SNI / cert details when it's used
</A></li>
	<LI>Next message (by thread): <A HREF="020268.html">[squid-users] Disable tls1.3 support , can't get SNI / cert details when it's used
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20243">[ date ]</a>
              <a href="thread.html#20243">[ thread ]</a>
              <a href="subject.html#20243">[ subject ]</a>
              <a href="author.html#20243">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
