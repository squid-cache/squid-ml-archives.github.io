<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid with custom openssl path is using the openssl installed in default path
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20with%20custom%20openssl%20path%20is%20using%20the%0A%20openssl%20installed%20in%20default%20path&In-Reply-To=%3C2beca6de-8627-a61b-c504-afca88d98316%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020250.html">
   <LINK REL="Next"  HREF="020251.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid with custom openssl path is using the openssl installed in default path</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20with%20custom%20openssl%20path%20is%20using%20the%0A%20openssl%20installed%20in%20default%20path&In-Reply-To=%3C2beca6de-8627-a61b-c504-afca88d98316%40treenet.co.nz%3E"
       TITLE="[squid-users] Squid with custom openssl path is using the openssl installed in default path">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Feb 27 13:44:56 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020250.html">[squid-users] Squid with custom openssl path is using the openssl installed in default path
</A></li>
        <LI>Next message (by thread): <A HREF="020251.html">[squid-users] Squid with custom openssl path is using the openssl installed in default path
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20254">[ date ]</a>
              <a href="thread.html#20254">[ thread ]</a>
              <a href="subject.html#20254">[ subject ]</a>
              <a href="author.html#20254">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 27/02/19 11:39 pm, Stilyan Georgiev wrote:
&gt;<i> Modified Makefile, replacing LIBOPENSSL_CFLAGS = -I/usr/local/include
</I>&gt;<i> with LIBOPENSSL_CFLAGS = -I/usr/local/include/openssl
</I>&gt;<i> 
</I>
Please do not touch the Makefile.

To set build environment variables such as those you simply pass them as
arguments to ./configure.

Like so:

 ./configure LIBOPENSSL_CFLAGS=&quot;-I/usr/local/include/openssl&quot;


Though the best solution is to fix the issue with your OpenSSL build my
earlier response mentions.



&gt;<i> Afterwards I got squid reporting it uses my custom-path openssl:
</I>&gt;<i> 
</I>&gt;<i> -- 
</I>&gt;<i> Squid Cache: Version 4.5-20190208-r568e66b7c
</I>&gt;<i> Service Name: squid
</I>&gt;<i> 
</I>&gt;<i> This binary uses OpenSSL 1.1.1b&#160; 26 Feb 2019. For legal restrictions on
</I>&gt;<i> distribution see <A HREF="https://www.openssl.org/source/license.html">https://www.openssl.org/source/license.html</A>
</I>&gt;<i> 
</I>&gt;<i> configure options:&#160; '--prefix=/usr/local/squid' '--with-openssl=/usr/local'
</I>&gt;<i> -- 
</I>&gt;<i> 
</I>&gt;<i> And even though I built the openssl without tls 1.3 support, I'm still
</I>&gt;<i> being able to use it when browsing through the proxy.
</I>&gt;<i> 
</I>&gt;<i> Also tried tls_outgoing_options options=NO_TLSv1_3 in config .. then in
</I>&gt;<i> cache.log I got -- 2019/02/27 10:32:10 kid1| ERROR: Unknown TLS option
</I>&gt;<i> NO_TLSv1_3
</I>
That squid.conf directive controls connections *leaving * Squid towards
origin servers.

Also, your build of OpenSSL explicitly disabled TLS/1.3 functionality.
That included disabling the ability of external programs like Squid to
control whether or not TLS/1.3 is used.


&gt;<i> 
</I>&gt;<i> Which makes me thing even though squid reports it uses openssl 1.1.1 ,
</I>&gt;<i> it lies to me and still uses the ubuntu version :)
</I>&gt;<i> 
</I>
No lie. That version number is not something built into Squid. It is a
string produced by the specific libssl library loaded at runtime.
So unless the library is lying about its own version that is actually
the library being loaded and used.


Keep in mind that there are multiple TCP connections, and thus multiple
agents involved. Any of the agents may be using either of the libraries
you have installed on your system.

Whatever agent you are connecting to Squid with is using one library,
Squid using the one claimed by 'squid -v', and the remote server is
using whatever exists out there.


Depending on exactly what setup you are using and how you are testing it
there are also between 1 and 3 &quot;TLS connections&quot; going on with TLS
version negotiated separately for each. You may only get one of those
reported by some test approaches.

If you want some assistance figuring out if our tests are accurate
and/or how to better see what is going on please provide details of whet
your production setup is intended to be, any differences in your test
setup, and how you are testing (what commands exactly). As much details
as you can provide would be helpful to anyone following up (exact crypto
key/cert values do not matter, though cert _type_ may).


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020250.html">[squid-users] Squid with custom openssl path is using the openssl installed in default path
</A></li>
	<LI>Next message (by thread): <A HREF="020251.html">[squid-users] Squid with custom openssl path is using the openssl installed in default path
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20254">[ date ]</a>
              <a href="thread.html#20254">[ thread ]</a>
              <a href="subject.html#20254">[ subject ]</a>
              <a href="author.html#20254">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
