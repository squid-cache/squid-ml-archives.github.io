<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] compiling squid 4
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20compiling%20squid%204&In-Reply-To=%3C6b3ee0ff-fa7d-87e2-9c46-8fbfe063f463%40dvm.esines.cu%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020274.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] compiling squid 4</H1>
    <B>Alex Guti&#233;rrez Mart&#237;nez</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20compiling%20squid%204&In-Reply-To=%3C6b3ee0ff-fa7d-87e2-9c46-8fbfe063f463%40dvm.esines.cu%3E"
       TITLE="[squid-users] compiling squid 4">alex at dvm.esines.cu
       </A><BR>
    <I>Thu Feb 28 21:03:00 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020274.html">[squid-users] problem compiling squid 4 on ubuntu 18.04
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20287">[ date ]</a>
              <a href="thread.html#20287">[ thread ]</a>
              <a href="subject.html#20287">[ subject ]</a>
              <a href="author.html#20287">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello again community, I still have problems compiling squid 4. This is 
what i did this time

Soporte b&#225;sico necesario:

# apt install arj bzip2 xz-utils cabextract cpio file lzma lhasa lzop 
rpm2cpio gzip nomarch pax lzop rar unrar unzip zoo unace razor pyzor 
tnef ripole zip p7zip-full mc multitail ccze libcppunit-dev libsasl2-dev 
libxml2-dev libkrb5-dev libdb-dev libnetfilter-conntrack-dev 
libexpat1-dev libcap2-dev libldap2-dev libpam0g-dev libgnutls28-dev 
libssl-dev libdbi-perl libecap3 libecap3-dev libntlm0-dev libkf5kiontlm5 
samba-dev ldap-utils

Instalar binarios necesarios para compilar Squid4, the system retunr a 
error whe in start the service:

sudo apt install logrotate acl attr autoconf bison nettle-dev 
build-essential libacl1-dev libaio-dev libattr1-dev libblkid-dev 
libbsd-dev libcap2-dev libcppunit-dev libldap2-dev pkg-config 
libxml2-dev libdb-dev libgnutls28-dev openssl devscripts fakeroot 
libdbi-perl libssl1.0-dev libcppunit-dev libecap3-dev libkrb5-dev 
comerr-dev libnetfilter-conntrack-dev libpam0g-dev libsasl2-dev

 &#160;sudo groupadd -g 13 proxy
 &#160;sudo mkdir -p /var/spool/squid
 &#160;sudo mkdir -p /var/log/squid
 &#160;sudo useradd --system -g proxy -u 13 -d /var/spool/squid -M -s 
/usr/sbin/nologin proxy
 &#160;sudo chown proxy:proxy /var/spool/squid
 &#160;sudo chown proxy:proxy /var/log/squid

cd /opt
wget -c <A HREF="http://www.squid-cache.org/Versions/v4/squid-4.6.tar.xz">http://www.squid-cache.org/Versions/v4/squid-4.6.tar.xz</A>
 &#160;tar xfv squid-4.6.tar.xz

Configuramos las opciones b&#225;sicas que podamos necesitar:

./configure --srcdir=. --prefix=/usr --localstatedir=/var/lib/squid 
--libexecdir=/usr/lib/squid --datadir=/usr/share/squid 
--sysconfdir=/etc/squid --with-default-user=proxy 
--with-logdir=/var/log/squid --with-open-ssl=/etc/ssl/openssl.cnf 
--with-openssl --enable-ssl --enable-ssl-crtd --build=x86_64-linux-gnu 
--with-pidfile=/var/run/squid.pid --enable-removal-policies=lru,heap 
--enable-delay-pools --enable-cache-digests --enable-icap-client 
--enable-ecap --enable-follow-x-forwarded-for --with-large-files 
--with-filedescriptors=65536 
--enable-auth-basic=DB,fake,getpwnam,LDAP,NCSA,NIS,PAM,POP3,RADIUS,SASL,SMB 
--enable-auth-digest=file,LDAP --enable-auth-negotiate=kerberos,wrapper 
--enable-auth-ntlm=fake --enable-linux-netfilter 
--with-swapdir=/var/spool/squid --enable-useragent-log --enable-htpc 
--infodir=/usr/share/info --mandir=/usr/share/man 
--includedir=/usr/include --disable-maintainer-mode 
--disable-dependency-tracking --disable-silent-rules --enable-inline 
--enable-async-io --enable-storeio=ufs,aufs,diskd,rock --enable-eui 
--enable-esi --enable-icmp --enable-zph-qos 
--enable-external-acl-helpers=file_userip,kerberos_ldap_group,time_quota,LDAP_group,session,SQL_session,unix_group,wbinfo_group 
--enable-url-rewrite-helpers=fake --enable-translation --enable-epoll 
--enable-snmp --enable-wccpv2 --with-aio --with-pthreads

Compiling with&#160; 4 cores:

make -j 4

Installing:

sudo&#160; make install

create initi script:

sudo nano /etc/init.d/squid

initi content:

######################################################################################################
######################################################################################################
######################################################################################################
# squid4&#160;&#160;&#160;&#160; Startup script for the SQUID HTTP proxy-cache.
#
# Version:&#160;&#160; @(#)squid4 init script&#160; 1.0&#160; 20-Feb-2019 <A HREF="https://lists.squid-cache.org/listinfo/squid-users">leslie84 at nauta.cu</A>
########################################################################

### BEGIN INIT INFO
# Provides:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; squid
# Required-Start:&#160;&#160;&#160; $network $remote_fs $syslog
# Required-Stop:&#160;&#160;&#160;&#160; $network $remote_fs $syslog
# Should-Start:&#160;&#160;&#160;&#160;&#160; $named
# Should-Stop:&#160;&#160;&#160;&#160;&#160;&#160; $named
# Default-Start:&#160;&#160;&#160;&#160; 2 3 4 5
# Default-Stop:&#160;&#160;&#160;&#160;&#160; 0 1 6
# Short-Description: Squid HTTP Proxy version 4.x
### END INIT INFO

NAME=squid
DESC=&quot;Squid HTTP Proxy 4.x&quot;
DAEMON=/usr/sbin/squid
PIDFILE=/var/run/$NAME.pid
CONFIG=/etc/squid/squid.conf
SQUID_ARGS=&quot;-YC -f $CONFIG&quot;

[ ! -f /etc/default/squid ] || . /etc/default/squid

. /lib/lsb/init-functions

PATH=/bin:/usr/bin:/sbin:/usr/sbin

[ -x $DAEMON ] || exit 0

ulimit -n 65535

find_cache_dir () {
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; w=&quot;&#160;&#160;&#160;&#160; &quot; # space tab
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; res=`sed -ne '
s/^'$1'['&quot;$w&quot;']\+[^'&quot;$w&quot;']\+['&quot;$w&quot;']\+\([^'&quot;$w&quot;']\+\).*$/\1/p;
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; t end;
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; d;
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; :end q' &lt; $CONFIG`
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; [ -n &quot;$res&quot; ] || res=$2
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; echo &quot;$res&quot;
}

find_cache_type () {
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; w=&quot;&#160;&#160;&#160;&#160; &quot; # space tab
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; res=`sed -ne '
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; s/^'$1'['&quot;$w&quot;']\+\([^'&quot;$w&quot;']\+\).*$/\1/p;
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; t end;
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; d;
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; :end q' &lt; $CONFIG`
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; [ -n &quot;$res&quot; ] || res=$2
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; echo &quot;$res&quot;
}

start () {
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; cache_dir=`find_cache_dir cache_dir`
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; cache_type=`find_cache_type cache_dir`

 &#160;&#160;&#160;&#160;&#160;&#160;&#160; #
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; # Create spool dirs if they don't exist.
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; #
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; if [ &quot;$cache_type&quot; = &quot;coss&quot; -a -d &quot;$cache_dir&quot; -a ! -f 
&quot;$cache_dir/stripe&quot; ] || [ &quot;$cache_type&quot; != &quot;coss&quot; -a -d &quot;$cache_dir&quot; -a 
! -d &quot;$cache_dir/00&quot; ]
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; then
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; log_warning_msg &quot;Creating $DESC cache structure&quot;
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; $DAEMON -z -f $CONFIG
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; fi

 &#160;&#160;&#160;&#160;&#160;&#160;&#160; umask 027
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; ulimit -n 65535
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; cd $cache_dir
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; start-stop-daemon --quiet --start \
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; --pidfile $PIDFILE \
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; --exec $DAEMON -- $SQUID_ARGS &lt; /dev/null
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; return $?
}

stop () {
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; PID=`cat $PIDFILE 2&gt;/dev/null`
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; start-stop-daemon --stop --quiet --pidfile $PIDFILE --exec $DAEMON
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; #
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; #&#160;&#160;&#160;&#160;&#160;&#160; Now we have to wait until squid has _really_ stopped.
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; #
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; sleep 2
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; if test -n &quot;$PID&quot; &amp;&amp; kill -0 $PID 2&gt;/dev/null
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; then
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; log_action_begin_msg &quot; Waiting&quot;
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; cnt=0
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; while kill -0 $PID 2&gt;/dev/null
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; do
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; cnt=`expr $cnt + 1`
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; if [ $cnt -gt 24 ]
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; then
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; log_action_end_msg 1
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; return 1
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; fi
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; sleep 5
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; log_action_cont_msg &quot;&quot;
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; done
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; log_action_end_msg 0
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; return 0
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; else
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; return 0
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; fi
}

case &quot;$1&quot; in
 &#160;&#160;&#160; start)
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; log_daemon_msg &quot;Starting $DESC&quot; &quot;$NAME&quot;
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; if start ; then
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; log_end_msg $?
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; else
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; log_end_msg $?
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; fi
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; ;;
 &#160;&#160;&#160; stop)
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; log_daemon_msg &quot;Stopping $DESC&quot; &quot;$NAME&quot;
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; if stop ; then
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; log_end_msg $?
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; else
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; log_end_msg $?
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; fi
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; ;;
 &#160;&#160;&#160; reload|force-reload)
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; log_action_msg &quot;Reloading $DESC configuration files&quot;
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; start-stop-daemon --stop --signal 1 \
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; --pidfile $PIDFILE --quiet --exec $DAEMON
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; log_action_end_msg 0
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; ;;
 &#160;&#160;&#160; restart)
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; log_daemon_msg &quot;Restarting $DESC&quot; &quot;$NAME&quot;
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; stop
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; if start ; then
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; log_end_msg $?
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; else
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; log_end_msg $?
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; fi
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; ;;
 &#160;&#160;&#160; status)
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; status_of_proc -p $PIDFILE $DAEMON $NAME &amp;&amp; exit 0 || exit 3
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; ;;
 &#160;&#160;&#160; *)
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; echo &quot;Usage: /etc/init.d/$NAME 
{start|stop|reload|force-reload|restart|status}&quot;
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; exit 3
 &#160;&#160;&#160;&#160;&#160;&#160;&#160; ;;
esac

exit 0
######################################################################################################
######################################################################################################
######################################################################################################

set permissions:

cambiar permisos al archivo
 &#160;&#160;&#160;&#160; sudo chmod +x /etc/init.d/squid

activar servicio de squid
 &#160;&#160;&#160;&#160; sudo update-rc.d squid defaults



After all this when i start the service this is the response from the system


 &#160;systemctl status squid.service
&#226; squid.service
 &#160;&#160; Loaded: loaded (/etc/init.d/squid; generated)
 &#160;&#160; Active: failed (Result: exit-code) since Thu 2019-02-28 15:52:15 
CST; 5s ago
 &#160;&#160;&#160;&#160; Docs: man:systemd-sysv-generator(8)
 &#160; Process: 18732 ExecStart=/etc/init.d/squid start (code=exited, 
status=203/EXEC)

feb 28 15:52:15 sq4 systemd[1]: Starting squid.service...
feb 28 15:52:15 sq4 systemd[18732]: squid.service: Failed to execute 
command: Exec format error
feb 28 15:52:15 sq4 systemd[18732]: squid.service: Failed at step EXEC 
spawning /etc/init.d/squid: Exec format error
feb 28 15:52:15 sq4 systemd[1]: squid.service: Control process exited, 
code=exited status=203
feb 28 15:52:15 sq4 systemd[1]: squid.service: Failed with result 
'exit-code'.
feb 28 15:52:15 sq4 systemd[1]: Failed to start squid.service.


Im using Ubuntu 18.04.2, thanks in advance.


PD: Thanks for your answer&#160; Rafael Akchurin but unforntunately the 
article that you suggest won&#180;t work for me.

-- 
Saludos Cordiales

Lic. Alex Guti&#233;rrez Mart&#237;nez

Tel. +53 7 2710327




</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020274.html">[squid-users] problem compiling squid 4 on ubuntu 18.04
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20287">[ date ]</a>
              <a href="thread.html#20287">[ thread ]</a>
              <a href="subject.html#20287">[ subject ]</a>
              <a href="author.html#20287">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
