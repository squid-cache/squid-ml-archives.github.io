<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Caching mirrored origin server
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Caching%20mirrored%20origin%20server&In-Reply-To=%3Cacf0ba4e5bed59057a4f56b3b29ed7ee%40jfcarter.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019893.html">
   <LINK REL="Next"  HREF="019888.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Caching mirrored origin server</H1>
    <B>jimc</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Caching%20mirrored%20origin%20server&In-Reply-To=%3Cacf0ba4e5bed59057a4f56b3b29ed7ee%40jfcarter.net%3E"
       TITLE="[squid-users] Caching mirrored origin server">jimc at jfcarter.net
       </A><BR>
    <I>Wed Jan  2 22:01:53 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019893.html">[squid-users] Squid 4.4 security_file_certgen helpers crashing
</A></li>
        <LI>Next message (by thread): <A HREF="019888.html">[squid-users] Caching mirrored origin server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19880">[ date ]</a>
              <a href="thread.html#19880">[ thread ]</a>
              <a href="subject.html#19880">[ subject ]</a>
              <a href="author.html#19880">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm using squid-4.4-2.1.x86_64 from OpenSuSE Tumbleweed.  My goal is
that when doing periodic software updates. each host in my department
will contact my proxy to obtain the new metadata and packages (SuSE has
a syntax for this); the proxy will download each file only once.  This
sounds like pretty standard Squid operation, but there's a gross botfly
in the ointment: the origin servers return 302 Found, each time
redirecting to a different mirror, and with &quot;normal&quot; configuration this
result is passed back to the client which makes a new connection (via
the proxy) to that mirror, but the retrieved file will likely never be
accessed again from that mirror.

Is there anyone who really knows what Squid can do and who has an idea
how to get Squid to follow the redirects on a cache miss, and to respond
to the original URL with the cached copy, whichever mirror it came from?

<A HREF="https://ma.ttwagner.com/lazy-distro-mirrors-with-squid/">https://ma.ttwagner.com/lazy-distro-mirrors-with-squid/</A> by Matt Wagner
(2014-04-03) has some suggestions along this line.  He fixates on one
mirror per origin server, and uses the virtual host feature to
effectively do an internal redirect to that mirror.  I also tried that
solution for a while, but mirrors come and go, and curating the mirror
selection turned out to be a reliability problem, so I gave it up.

Software package RPMs are often large, and in my application it's
important to raise the maximum_object_size; the largest item I've seen
is 158Mb and I've set the limit to 300Mb.  And of course enough disc
cache space has to be allowed to hold the expected set of RPMs to be
used, e.g. when installing the OS on several new machines.  My
cache_dir has 5000 Mb.

-- 
James F. Carter   Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">jimc at jfcarter.net</A>
Web: <A HREF="http://www.math.ucla.edu/~jimc">http://www.math.ucla.edu/~jimc</A> (q.v. for PGP key)

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 488 bytes
Desc: OpenPGP digital signature
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20190102/dbbc4e01/attachment.sig">http://lists.squid-cache.org/pipermail/squid-users/attachments/20190102/dbbc4e01/attachment.sig</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019893.html">[squid-users] Squid 4.4 security_file_certgen helpers crashing
</A></li>
	<LI>Next message (by thread): <A HREF="019888.html">[squid-users] Caching mirrored origin server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19880">[ date ]</a>
              <a href="thread.html#19880">[ thread ]</a>
              <a href="subject.html#19880">[ subject ]</a>
              <a href="author.html#19880">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
