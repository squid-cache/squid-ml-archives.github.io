<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Caching mirrored origin server
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Caching%20mirrored%20origin%20server&In-Reply-To=%3Cf9d0e25f-f6a2-4e16-a0e6-91d68e3620b6%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019880.html">
   <LINK REL="Next"  HREF="019894.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Caching mirrored origin server</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Caching%20mirrored%20origin%20server&In-Reply-To=%3Cf9d0e25f-f6a2-4e16-a0e6-91d68e3620b6%40measurement-factory.com%3E"
       TITLE="[squid-users] Caching mirrored origin server">rousskov at measurement-factory.com
       </A><BR>
    <I>Thu Jan  3 16:34:34 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019880.html">[squid-users] Caching mirrored origin server
</A></li>
        <LI>Next message (by thread): <A HREF="019894.html">[squid-users] Caching mirrored origin server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19888">[ date ]</a>
              <a href="thread.html#19888">[ thread ]</a>
              <a href="subject.html#19888">[ subject ]</a>
              <a href="author.html#19888">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 1/2/19 3:01 PM, jimc wrote:
&gt;<i> I'm using squid-4.4-2.1.x86_64 from OpenSuSE Tumbleweed.&#160; My goal is
</I>&gt;<i> that when doing periodic software updates. each host in my department
</I>&gt;<i> will contact my proxy to obtain the new metadata and packages (SuSE has
</I>&gt;<i> a syntax for this); the proxy will download each file only once.&#160; This
</I>&gt;<i> sounds like pretty standard Squid operation, but there's a gross botfly
</I>&gt;<i> in the ointment: the origin servers return 302 Found, each time
</I>&gt;<i> redirecting to a different mirror, and with &quot;normal&quot; configuration this
</I>&gt;<i> result is passed back to the client which makes a new connection (via
</I>&gt;<i> the proxy) to that mirror, but the retrieved file will likely never be
</I>&gt;<i> accessed again from that mirror.
</I>
The default solution for mapping many URLs to a single cache hit is the
store_id helper. That solution is only applicable to URLs that produce
the same content regardless of the URL from the set.

  * <A HREF="https://wiki.squid-cache.org/Features/StoreID">https://wiki.squid-cache.org/Features/StoreID</A>
  * <A HREF="http://www.squid-cache.org/Doc/config/store_id_program/">http://www.squid-cache.org/Doc/config/store_id_program/</A>


&gt;<i> mirrors come and go, and curating the mirror
</I>&gt;<i> selection turned out to be a reliability problem, so I gave it up.
</I>
If there is a common pattern to all mirrors for a given URL, then
store_id can help. You would still be responsible for curating the URL
mapping/patterns, of course, but it may be (more) manageable.

There is no built-in &quot;follow redirect but cache under the original URL&quot;
feature in Squid, probably because such a feature would result in
serving wrong responses in many typical cases. With store_id, the
decision to map URLs and the headaches/risks of doing so are all on your
side.

With some Squid development work, the missing feature can be implemented
on top of the existing adaptation interfaces and the core store_id
functionality, but nobody has done that so far IIRC.


HTH,

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019880.html">[squid-users] Caching mirrored origin server
</A></li>
	<LI>Next message (by thread): <A HREF="019894.html">[squid-users] Caching mirrored origin server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19888">[ date ]</a>
              <a href="thread.html#19888">[ thread ]</a>
              <a href="subject.html#19888">[ subject ]</a>
              <a href="author.html#19888">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
