<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 4.5 and intermediate CA
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%204.5%20and%20intermediate%20CA&In-Reply-To=%3C009a01d4acf2%2421e20270%2465a60750%24%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019935.html">
   <LINK REL="Next"  HREF="019938.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 4.5 and intermediate CA</H1>
    <B>eliezer at ngtech.co.il</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%204.5%20and%20intermediate%20CA&In-Reply-To=%3C009a01d4acf2%2421e20270%2465a60750%24%40ngtech.co.il%3E"
       TITLE="[squid-users] Squid 4.5 and intermediate CA">eliezer at ngtech.co.il
       </A><BR>
    <I>Tue Jan 15 16:48:24 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019935.html">[squid-users] Squid 4.5 and intermediate CA
</A></li>
        <LI>Next message (by thread): <A HREF="019938.html">[squid-users] Squid 4.5 and intermediate CA
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19936">[ date ]</a>
              <a href="thread.html#19936">[ thread ]</a>
              <a href="subject.html#19936">[ subject ]</a>
              <a href="author.html#19936">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>There should be a new acl names &#8220;certificate-fetching&#8221;
So I assume you can use something like:
 
acl certfetch transaction_initiator certificate-fetching
http_access allow certfetch
 
Eliezer
 
----
 &lt;<A HREF="http://ngtech.co.il/main-en/">http://ngtech.co.il/main-en/</A>&gt; Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email:  &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>

 
From: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; On Behalf Of FredB
Sent: Tuesday, January 15, 2019 17:59
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: [squid-users] Squid 4.5 and intermediate CA
 
Hi all,
I'm testing squid 4.5 and facing two issues with intermediate CA download 
At first there is no source IP and I don't know how to allow this kind of requests with an identification acl 
172.23.0.9 - user2 [15/Jan/2019:16:34:51 +0100] &quot;CONNECT bugs.squid-cache.org:443 HTTP/1.1&quot; 407 4442 447 TCP_DENIED:HIER_NONE &quot;Mozilla/5.0 (Windows NT 6.1; WOW64; rv:64.0) Gecko/20100101 Firefox/64.0&quot; -
- - - [15/Jan/2019:16:34:51 +0100] &quot;GET <A HREF="http://cert.int-x3.letsencrypt.org/">http://cert.int-x3.letsencrypt.org/</A> HTTP/1.1&quot; 407 3536 0 TCP_DENIED:HIER_NONE &quot;-&quot; -
172.23.0.9 - user2 [15/Jan/2019:16:34:51 +0100] &quot;CONNECT bugs.squid-cache.org:443 HTTP/1.1&quot; 200 0 447 NONE:HIER_DIRECT &quot;Mozilla/5.0 (Windows NT 6.1; WOW64; rv:64.0) Gecko/20100101 Firefox/64.0&quot; bump 
As you can see the request to letsencrypt is denied because a basic authentication is needed, how I can do a global ACL allow requests from squid ? I tested 127.0.0.1,local addresses but without any success 
So for testing purpose I removed my identification rules
Now Squid can get the certificate
- - - [15/Jan/2019:16:33:43 +0100] &quot;GET <A HREF="http://cert.int-x3.letsencrypt.org/">http://cert.int-x3.letsencrypt.org/</A> HTTP/1.1&quot; 200 9737 0 NONE:HIER_NONE &quot;-&quot; -
172.23.0.9 - - [15/Jan/2019:16:33:43 +0100] &quot;CONNECT bugs.squid-cache.org:443 HTTP/1.1&quot; 200 0 447 NONE:HIER_DIRECT &quot;Mozilla/5.0 (Windows NT 6.1; WOW64; rv:64.0) Gecko/20100101 Firefox/64.0&quot; bump
172.23.0.9 - - [15/Jan/2019:16:33:43 +0100] &quot;GET <A HREF="https://bugs.squid-cache.org/">https://bugs.squid-cache.org/</A> HTTP/1.1&quot; 503 353 349 NONE:HIER_NONE &quot;Mozilla/5.0 (Windows NT 6.1; WOW64; rv:64.0) Gecko/20100101 Firefox/64.0&quot; -
Cache.log
ssl3_get_server_certificate:certificate verify failed (1/-1/0)
I'm missing something?
Thanks
FredB
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20190115/335a0728/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20190115/335a0728/attachment.htm</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 11295 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20190115/335a0728/attachment.png">http://lists.squid-cache.org/pipermail/squid-users/attachments/20190115/335a0728/attachment.png</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019935.html">[squid-users] Squid 4.5 and intermediate CA
</A></li>
	<LI>Next message (by thread): <A HREF="019938.html">[squid-users] Squid 4.5 and intermediate CA
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19936">[ date ]</a>
              <a href="thread.html#19936">[ thread ]</a>
              <a href="subject.html#19936">[ subject ]</a>
              <a href="author.html#19936">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
