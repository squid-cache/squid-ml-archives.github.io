<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid does not send request to parent proxy
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20does%20not%20send%20request%20to%20parent%20proxy&In-Reply-To=%3C44619dfe-478b-900c-832e-41b7c38b8f3f%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019970.html">
   <LINK REL="Next"  HREF="019973.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid does not send request to parent proxy</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20does%20not%20send%20request%20to%20parent%20proxy&In-Reply-To=%3C44619dfe-478b-900c-832e-41b7c38b8f3f%40treenet.co.nz%3E"
       TITLE="[squid-users] Squid does not send request to parent proxy">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Jan 18 09:07:36 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019970.html">[squid-users] R:  Squid does not send request to parent proxy
</A></li>
        <LI>Next message (by thread): <A HREF="019973.html">[squid-users] R:  Squid does not send request to parent proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19972">[ date ]</a>
              <a href="thread.html#19972">[ thread ]</a>
              <a href="subject.html#19972">[ subject ]</a>
              <a href="author.html#19972">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 18/01/19 4:28 am, Troiano Alessio wrote:
&gt;<i> Hello all,
</I>&gt;<i> I'm not able to configure squid for using a parent proxy only for some domain. All the rest should be fetched directly. I tried this configuration:
</I>&gt;<i> cache_peer 172.31.3.70 parent 8080 0 no-query default name=HUBATLDB
</I>&gt;<i> acl domainAT dstdomain voeazul.com.br
</I>&gt;<i> cache_peer_access HUBATLDB allow domainAT
</I>&gt;<i> never_direct allow domainAT
</I>
That is the correct design.  It does not work for you because you put
the wrong domain name in the domainAT ACL.


Look at the log carefully. See how the domain the client is asking for
is actually &quot;www.voeazul.com.br&quot;. Even a single character difference
makes it an entirely different domain name - the &quot;www.&quot; bit matters.


If you want domainAT to do exact-match then you need to add the www.*
sub-domain to the list. Like this:
 acl domainAT dstdomain voeazul.com.br www.voeazul.com.br


Or, you can use a wildcard (start with a '.') to match that domain and
all its sub-domains. Like this:

  acl domainAT dstdomain .voeazul.com.br



&gt;<i> 
</I>&gt;<i> But the site www.voeazul.com.br is fetched direct. This is the access log:
</I>&gt;<i> %SQUID-4: 172.31.0.82 59719 [17/Jan/2019:22:55:36 +0800] &quot;CONNECT www.voeazul.com.br:443 HTTP/1.1&quot; www.voeazul.com.br - - &quot;-&quot; 200 - 816 &quot;-&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:64.0) Gecko/20100101 Firefox/64.0&quot; TCP_TUNNEL:HIER_DIRECT 23.77.9.57 443 53176
</I>&gt;<i> 
</I>&gt;<i> Can you help me?
</I>&gt;<i> 
</I>
What Squid version are you using?

I see config options which are only valid for Squid-3.1 your setup. If
you are using an old Squid please try an upgrade, or start planning to
do one. There are many security vulnerabilities which affect those very
old Squid-3 and some cannot be fixed there, so even versions with LTS
security support are vulnerable.


Cheers
Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019970.html">[squid-users] R:  Squid does not send request to parent proxy
</A></li>
	<LI>Next message (by thread): <A HREF="019973.html">[squid-users] R:  Squid does not send request to parent proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19972">[ date ]</a>
              <a href="thread.html#19972">[ thread ]</a>
              <a href="subject.html#19972">[ subject ]</a>
              <a href="author.html#19972">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
