<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] ICAP and 403 Encapsulated answers (SSL denied domains)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ICAP%20and%20403%20Encapsulated%20answers%20%28SSL%20denied%20domains%29&In-Reply-To=%3C0d99f322-62a8-9b7a-86cc-d0894b9a5537%40free.fr%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019987.html">
   <LINK REL="Next"  HREF="019992.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] ICAP and 403 Encapsulated answers (SSL denied domains)</H1>
    <B>FredB</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ICAP%20and%20403%20Encapsulated%20answers%20%28SSL%20denied%20domains%29&In-Reply-To=%3C0d99f322-62a8-9b7a-86cc-d0894b9a5537%40free.fr%3E"
       TITLE="[squid-users] ICAP and 403 Encapsulated answers (SSL denied domains)">numsys at free.fr
       </A><BR>
    <I>Mon Jan 21 10:35:55 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019987.html">[squid-users] What's the best way to ban Let's encrypt based certificates? or whitelist a very narrow list of Root and Intermediates CA?
</A></li>
        <LI>Next message (by thread): <A HREF="019992.html">[squid-users] ICAP and 403 Encapsulated answers (SSL denied domains)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19989">[ date ]</a>
              <a href="thread.html#19989">[ thread ]</a>
              <a href="subject.html#19989">[ subject ]</a>
              <a href="author.html#19989">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello all,

I'm playing with Squid4 and e2guardian as ICAP server.

I'm seeing something I misunderstand, when a SSL website is blocked 
e2guardian returns a encapsulated &quot;HTTP/1.1 403 Forbidden&quot; header this 
part seems good to me with an encrypted website a denied or redirection 
page can't be added

But unfortunately Squid adds a &quot;Connection: keep-alive&quot; header and if I 
just reload the page I'm waiting a timeout a long moment, (and there is 
no ICAP request between squid and e2) it's like the previous connection 
still opened.

So the first request is well denied, but the second is without answer

I tried to add &quot;Connection: close&quot; in encapsulated header from 
e2guardian without more success, but anyway &quot;Connection: close&quot; value is 
removed by squid

I'm doing something wrong ? This wastes connections and from user point 
of view the proxy is (very) slow, for example with ADS filtering some 
websites freezes

FI the request is well denied in squid and E2 logs

Maybe this is a bug, but I don't known if the issue is from Squid or E2 
? What is the correct response from an ICAP server with a denied SSL 
website request ?

Thank you

Fred




</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019987.html">[squid-users] What's the best way to ban Let's encrypt based certificates? or whitelist a very narrow list of Root and Intermediates CA?
</A></li>
	<LI>Next message (by thread): <A HREF="019992.html">[squid-users] ICAP and 403 Encapsulated answers (SSL denied domains)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19989">[ date ]</a>
              <a href="thread.html#19989">[ thread ]</a>
              <a href="subject.html#19989">[ subject ]</a>
              <a href="author.html#19989">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
