<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] ICAP and 403 Encapsulated answers (SSL denied domains)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ICAP%20and%20403%20Encapsulated%20answers%20%28SSL%20denied%0A%20domains%29&In-Reply-To=%3C8cfb73a6-6cbb-4907-f304-a43487ae3856%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019989.html">
   <LINK REL="Next"  HREF="019998.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] ICAP and 403 Encapsulated answers (SSL denied domains)</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ICAP%20and%20403%20Encapsulated%20answers%20%28SSL%20denied%0A%20domains%29&In-Reply-To=%3C8cfb73a6-6cbb-4907-f304-a43487ae3856%40measurement-factory.com%3E"
       TITLE="[squid-users] ICAP and 403 Encapsulated answers (SSL denied domains)">rousskov at measurement-factory.com
       </A><BR>
    <I>Mon Jan 21 17:28:10 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019989.html">[squid-users] ICAP and 403 Encapsulated answers (SSL denied domains)
</A></li>
        <LI>Next message (by thread): <A HREF="019998.html">[squid-users] ICAP and 403 Encapsulated answers (SSL denied domains)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19992">[ date ]</a>
              <a href="thread.html#19992">[ thread ]</a>
              <a href="subject.html#19992">[ subject ]</a>
              <a href="author.html#19992">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 1/21/19 3:35 AM, FredB wrote:

&gt;<i> I'm playing with Squid4 and e2guardian as ICAP server.
</I>&gt;<i> 
</I>&gt;<i> I'm seeing something I misunderstand, when a SSL website is blocked
</I>&gt;<i> e2guardian returns a encapsulated &quot;HTTP/1.1 403 Forbidden&quot; header this
</I>&gt;<i> part seems good to me with an encrypted website a denied or redirection
</I>&gt;<i> page can't be added
</I>
&gt;<i> But unfortunately Squid adds a &quot;Connection: keep-alive&quot; header
</I>
It is not clear _why_ you consider that header &quot;unfortunate&quot; and the
connection &quot;wasted&quot;. That header may or may not be wrong, and the
connection may or may not be reusable, depending on many factors (that
you have not shared).


&gt;<i> and if I
</I>&gt;<i> just reload the page I'm waiting a timeout a long moment, (and there is
</I>&gt;<i> no ICAP request between squid and e2) it's like the previous connection
</I>&gt;<i> still opened.
</I>&gt;<i> 
</I>&gt;<i> So the first request is well denied, but the second is without answer
</I>
Can the browser reuse the connection after receiving the HTTP 403
(Forbidden) response? Does it? If you provide a sample of client-Squid
request and response headers (including CONNECT messages, if any), and
specify whether they were all sharing the same TCP connection, then we
may be able to assign the blame for the &quot;timeout&quot;.

If (some of) the messages are encrypted, providing ALL,2 cache.log may
work. Otherwise, a packet capture (in pcap format) is probably the
easiest sharing method.


&gt;<i> I tried to add &quot;Connection: close&quot; in encapsulated header from
</I>&gt;<i> e2guardian without more success, but anyway &quot;Connection: close&quot; value is
</I>&gt;<i> removed by squid
</I>
Yes, by ICAP design, an ICAP service does not have direct control over
HTTP connections maintained by the host application (e.g., Squid).

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019989.html">[squid-users] ICAP and 403 Encapsulated answers (SSL denied domains)
</A></li>
	<LI>Next message (by thread): <A HREF="019998.html">[squid-users] ICAP and 403 Encapsulated answers (SSL denied domains)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19992">[ date ]</a>
              <a href="thread.html#19992">[ thread ]</a>
              <a href="subject.html#19992">[ subject ]</a>
              <a href="author.html#19992">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
