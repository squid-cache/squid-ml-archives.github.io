<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] External acl on delay_access directive
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20External%20acl%20on%20delay_access%20directive&In-Reply-To=%3C84b87722-5c0b-75c7-b516-923e1e83865e%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019990.html">
   <LINK REL="Next"  HREF="019965.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] External acl on delay_access directive</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20External%20acl%20on%20delay_access%20directive&In-Reply-To=%3C84b87722-5c0b-75c7-b516-923e1e83865e%40measurement-factory.com%3E"
       TITLE="[squid-users] External acl on delay_access directive">rousskov at measurement-factory.com
       </A><BR>
    <I>Mon Jan 21 17:46:42 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019990.html">[squid-users] External acl on delay_access directive
</A></li>
        <LI>Next message (by thread): <A HREF="019965.html">[squid-users] Digicert replacing couple root CA,	why it wasn't mentioned here?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19993">[ date ]</a>
              <a href="thread.html#19993">[ thread ]</a>
              <a href="subject.html#19993">[ subject ]</a>
              <a href="author.html#19993">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 1/21/19 5:22 AM, Luca Savarino wrote:

&gt;<i> Attached is a patch which seems to fix the issue.
</I>
Glad you have a fix that works for you, but this mailing list is not the
right place for patch reviews. If you want to submit your changes to the
Squid project, I suggest creating a GitHub pull request. The procedure
is outlined at <A HREF="https://wiki.squid-cache.org/MergeProcedure">https://wiki.squid-cache.org/MergeProcedure</A>


&gt;<i> Does it seem correct to you ?
</I>
The patch is buggy: Setting AccessLogEntry::reply field like that may
lead to memory leaks and/or crashes. Ideally, the reply field should be
set when the reply becomes known. I do not know whether that is already
done (elsewhere in the code). If it is done, than the reply setting line
in the patch can be removed. You can answer that question for your
particular use case by checking (e.g., in a debugger or by adding a
debugs() message) whether http-&gt;al-&gt;reply is nil before the assignment.


HTH,

Alex.


&gt;<i> On 1/17/19 5:39 PM, Alex Rousskov wrote:
</I>&gt;&gt;<i> On 1/17/19 9:13 AM, Luca Savarino wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> WARNING: ip_list ACL is used in context without an ALE
</I>&gt;&gt;&gt;<i> state. Assuming mismatch.
</I>&gt;&gt;&gt;<i> delay_access 1 allow ip_list
</I>&gt;&gt;<i> Looks like a Squid bug to me -- Squid should supply ALE (a blob
</I>&gt;&gt;<i> containing various transaction details) to the delay_access code but
</I>&gt;&gt;<i> evidently does not.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> If you are a developer or can hire a developer to fix this bug, a good
</I>&gt;&gt;<i> starting point could be the missing ACLFilledChecklist::al
</I>&gt;&gt;<i> initialization in DelayId::DelayClient().
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> HTH,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Alex.
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019990.html">[squid-users] External acl on delay_access directive
</A></li>
	<LI>Next message (by thread): <A HREF="019965.html">[squid-users] Digicert replacing couple root CA,	why it wasn't mentioned here?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19993">[ date ]</a>
              <a href="thread.html#19993">[ thread ]</a>
              <a href="subject.html#19993">[ subject ]</a>
              <a href="author.html#19993">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
