<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] ICAP and 403 Encapsulated answers (SSL denied domains)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ICAP%20and%20403%20Encapsulated%20answers%20%28SSL%20denied%0A%20domains%29&In-Reply-To=%3C6b798ccd-8653-4106-30a7-d576e4166156%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019998.html">
   <LINK REL="Next"  HREF="020012.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] ICAP and 403 Encapsulated answers (SSL denied domains)</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ICAP%20and%20403%20Encapsulated%20answers%20%28SSL%20denied%0A%20domains%29&In-Reply-To=%3C6b798ccd-8653-4106-30a7-d576e4166156%40measurement-factory.com%3E"
       TITLE="[squid-users] ICAP and 403 Encapsulated answers (SSL denied domains)">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Jan 22 17:33:29 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="019998.html">[squid-users] ICAP and 403 Encapsulated answers (SSL denied domains)
</A></li>
        <LI>Next message (by thread): <A HREF="020012.html">[squid-users] ICAP and 403 Encapsulated answers (SSL denied domains)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20004">[ date ]</a>
              <a href="thread.html#20004">[ thread ]</a>
              <a href="subject.html#20004">[ subject ]</a>
              <a href="author.html#20004">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 1/22/19 1:22 AM, FredB wrote:

&gt;<i> Here a short tcpdump trace
</I>&gt;<i> <A HREF="https://nas.traceroot.fr:8081/owncloud/index.php/s/egrcXnU3lxiU0mi">https://nas.traceroot.fr:8081/owncloud/index.php/s/egrcXnU3lxiU0mi</A>
</I>&gt;<i> 
</I>&gt;<i> &#160; 1 - I'm surfing to the website <A HREF="https://www.toto.fr">https://www.toto.fr</A>
</I>
Yes (tcp.stream eq 30).


&gt;<i> &#160; 2 - I receive a 403 (blank page)
</I>
&gt;<i> HTTP/1.1 403 Forbidden
</I>&gt;<i> Server: e2guardian
</I>&gt;<i> Date: Mon, 21 Jan 2019 10:06:54 GMT
</I>&gt;<i> X-Cache: MISS from proxyorion_test
</I>&gt;<i> X-Cache-Lookup: NONE from proxyorion_test:3128
</I>&gt;<i> Transfer-Encoding: chunked
</I>&gt;<i> Via: 1.1 proxyorion_test (squid/4.5)
</I>&gt;<i> Connection: keep-alive
</I>&gt;<i> 
</I>&gt;<i> 0
</I>
Agreed. Frame 99 contains a well-formed HTTP 403 response with an empty
body. IIRC, popular browsers refuse to display 403 responses to CONNECT
requests. There is also nothing to display in your specific case because
the 403 response body is empty, but that is irrelevant.


&gt;<i> 3 - I refresh the page, and I wait a long time before timeout
</I>
The trace you posted does not seem to show this part AFAICT. Perhaps
your &quot;refresh&quot; was not forceful enough for the browser to open a new
connection. I do not know whether that part is important.


&gt;<i> A real issue is filtering ADS
</I>
Please note that it is your responsibility to reproduce the
real/relevant problem. Your current test case may be sufficient -- I do
not know -- but if it is _not_ sufficient, we may not be able to tell
that it is insufficient or irrelevant, and will chase ghosts.


In summary, the trace you posted does not seem to indicate a Squid
problem. That does not mean there is no problem. It only means this use
case does not seem to expose that problem from Squid point of view.

If you believe that the browser is waiting for Squid to send something
after those HTTP 403 response bytes, then it sounds like there is a
browser bug -- Squid sent a full/complete response AFAICT. You may be
able to learn more about browser needs by debugging the browser.


As a workaround, you can try disabling client-to-Squid persistent
connections (client_persistent_connections off) or changing your ICAP
service to produce a response with a non-empty 403 body.


HTH,

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="019998.html">[squid-users] ICAP and 403 Encapsulated answers (SSL denied domains)
</A></li>
	<LI>Next message (by thread): <A HREF="020012.html">[squid-users] ICAP and 403 Encapsulated answers (SSL denied domains)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20004">[ date ]</a>
              <a href="thread.html#20004">[ thread ]</a>
              <a href="subject.html#20004">[ subject ]</a>
              <a href="author.html#20004">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
