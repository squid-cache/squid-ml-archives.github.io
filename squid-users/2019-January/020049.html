<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Big HTTP-POST file uploads not working
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Big%20HTTP-POST%20file%20uploads%20not%20working&In-Reply-To=%3C318ba4ba-7fef-5de3-555f-69375f553151%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020048.html">
   <LINK REL="Next"  HREF="020050.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Big HTTP-POST file uploads not working</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Big%20HTTP-POST%20file%20uploads%20not%20working&In-Reply-To=%3C318ba4ba-7fef-5de3-555f-69375f553151%40treenet.co.nz%3E"
       TITLE="[squid-users] Big HTTP-POST file uploads not working">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Jan 29 04:01:12 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020048.html">[squid-users] Big HTTP-POST file uploads not working
</A></li>
        <LI>Next message (by thread): <A HREF="020050.html">[squid-users] Big HTTP-POST file uploads not working
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20049">[ date ]</a>
              <a href="thread.html#20049">[ thread ]</a>
              <a href="subject.html#20049">[ subject ]</a>
              <a href="author.html#20049">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 29/01/19 8:50 am, Matthias Weigel wrote:
&gt;<i> Hi Alex,
</I>&gt;<i> 
</I>&gt;<i> this problem just got a lot weirder:
</I>&gt;<i> - Upload works fine with debug_options ALL,7 ALL,8 or ALL,9.
</I>&gt;<i> - Upload fails with debug_options ALL,6 and lower.
</I>&gt;<i> 
</I>&gt;<i> I created a debug_options ALL,6 cache.log.
</I>&gt;<i> <A HREF="http://94.16.117.186/squid/cache.log.3b.gz">http://94.16.117.186/squid/cache.log.3b.gz</A>
</I>&gt;<i> 
</I>&gt;<i> During this test, the following happened at the client:
</I>&gt;<i> 
</I>&gt;<i> Stall at 20:10:38
</I>&gt;<i> Recover at 20:12:47
</I>&gt;<i> Stall at 20:14:11
</I>&gt;<i> Failure at 20:16:17
</I>&gt;<i> 
</I>&gt;<i> Any ideas?
</I>&gt;<i> 
</I>
The FD 18 client-&gt;Squid I/O stops happening at 20:10:35.923 with input
buffer full and more data apparently waiting to arrive.

But the FD 20 Squid-&gt;server I/O halted earlier at 20:10:35.437 with a
4KB packet being sent and still waiting for the signal to proceed
sending more.

At 20:12:47.068 a signal is received finally, but it indicates the
server connection has gone away with no reason given. Squid generates a
502 error response and delivers that to the client.

The client opens a new connection, does all its TLS handshakes again and
re-sends the same very large POST request. Which encounters the same
sequence of server stops responding, client buffer fills and &quot;stall&quot;
until the server FD is closed. Then again the 502 from Squid but the
client does not resume this time.


So whatever is going on it looks to me like it is the origin server
being a problem. Though you may need to look at the actual TCP packet
flow to confirm. I expect you will find that a packet from Squid to the
server does not get ACK'd, or a network timeout occurs (NAT or TCP
lifetimes are common), ...

 Or maybe the server is itself dealing with a similar backlog from
unresponsive internal agent/component leaving its input buffer to
overflow just like Squids one from the client does.


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020048.html">[squid-users] Big HTTP-POST file uploads not working
</A></li>
	<LI>Next message (by thread): <A HREF="020050.html">[squid-users] Big HTTP-POST file uploads not working
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20049">[ date ]</a>
              <a href="thread.html#20049">[ thread ]</a>
              <a href="subject.html#20049">[ subject ]</a>
              <a href="author.html#20049">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
