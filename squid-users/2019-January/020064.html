<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Using a static wildcard certificate with ssl-bump in explicit forward proxy mode
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Using%20a%20static%20wildcard%20certificate%20with%20ssl-bump%0A%20in%20explicit%20forward%20proxy%20mode&In-Reply-To=%3CCAEPopkVVsRtcCNnHgGvSYTTbOX6%3DAxQsNpie4pMR6xoc-q8feg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020040.html">
   <LINK REL="Next"  HREF="020067.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Using a static wildcard certificate with ssl-bump in explicit forward proxy mode</H1>
    <B>Bill Bernsen</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Using%20a%20static%20wildcard%20certificate%20with%20ssl-bump%0A%20in%20explicit%20forward%20proxy%20mode&In-Reply-To=%3CCAEPopkVVsRtcCNnHgGvSYTTbOX6%3DAxQsNpie4pMR6xoc-q8feg%40mail.gmail.com%3E"
       TITLE="[squid-users] Using a static wildcard certificate with ssl-bump in explicit forward proxy mode">bernsen at gmail.com
       </A><BR>
    <I>Wed Jan 30 18:47:10 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020040.html">[squid-users] Using a static wildcard certificate with ssl-bump in explicit forward proxy mode
</A></li>
        <LI>Next message (by thread): <A HREF="020067.html">[squid-users] Using a static wildcard certificate with ssl-bump in explicit forward proxy mode
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20064">[ date ]</a>
              <a href="thread.html#20064">[ thread ]</a>
              <a href="subject.html#20064">[ subject ]</a>
              <a href="author.html#20064">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Amos, thank you for the quick response. My original question could use an
example to clarify.

client ------&gt; example.com (HTTPS squid proxy) ------&gt; instance.example.com
(HTTPS server)

The HTTPS squid proxy on example.com has a trusted wildcard certificate for
*.example.com
The HTTPS server on instance.example.com has an untrusted certificate for
instance.example.com

So without MITM, the client issues a CONNECT to squid running on example.com
which does its TLS, authenticates, connects to upstream then goes into
tunneling mode. The client does the TLS handshake with instance.example.com,
receives its untrusted certificate, and isn't happy.

I'm looking for a MITM mode that, instead of requiring a CA that can
dynamically create trusted certs on the fly, will return a wildcard
certificate for all requests (or even better, for any requests matching
hosts in its subdomain). Is that something that exists?

I hacked up my own version of ssl_crtd to serve a static cert and ran into
another wrinkle. Is there a version of squid that supports ssl-bump with
https_port?

On Fri, Jan 25, 2019 at 9:42 PM Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; wrote:

&gt;<i> On 26/01/19 5:51 am, Bill Bernsen wrote:
</I>&gt;<i> &gt; Hi,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I have squid running as an explicit forward proxy on the
</I>&gt;<i> &gt; host example.com &lt;<A HREF="http://example.com/">http://example.com/</A>&gt; controlling access to all hosts
</I>&gt;<i> &gt; in *.example.com &lt;<A HREF="http://example.com/">http://example.com/</A>&gt;. All the hosts in *.example.com
</I>&gt;<i> &gt; &lt;<A HREF="http://example.com/">http://example.com/</A>&gt; have self-signed certificates that I want to
</I>&gt;<i> &gt; appear as trusted to user browsers. I don't have the option of obtaining
</I>&gt;<i> &gt; a trusted CA. I do, however, have a trusted wildcard certificate for
</I>&gt;<i> &gt; *.example.com &lt;<A HREF="http://example.com/">http://example.com/</A>&gt; available. Is there a way that I can
</I>&gt;<i> &gt; tell squid to present this static wildcard certificate to clients in
</I>&gt;<i> &gt; lieu of all upstream server certificates?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> As a forward proxy clients are *not* connecting to any of the
</I>&gt;<i> *.example.com domains. They are connecting to your proxy hostname - and
</I>&gt;<i> telling it to take care of the origin connections. So all clients need
</I>&gt;<i> is trust for the CA which signed the proxy's certificate.
</I>&gt;<i>
</I>&gt;<i> The proxy is the only agent in the path which needs to trust the
</I>&gt;<i> wildcard *.example.com certificate.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20190130/634b9ad1/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20190130/634b9ad1/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020040.html">[squid-users] Using a static wildcard certificate with ssl-bump in explicit forward proxy mode
</A></li>
	<LI>Next message (by thread): <A HREF="020067.html">[squid-users] Using a static wildcard certificate with ssl-bump in explicit forward proxy mode
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20064">[ date ]</a>
              <a href="thread.html#20064">[ thread ]</a>
              <a href="subject.html#20064">[ subject ]</a>
              <a href="author.html#20064">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
