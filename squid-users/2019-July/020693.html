<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid-users Digest, Vol 58, Issue 31
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid-users%20Digest%2C%20Vol%2058%2C%20Issue%2031&In-Reply-To=%3CCAApifbbQLD-__WdqO1Qd4HjL9gD7ZjP75O__Gmmyv_xCxM6dkQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   
   <LINK REL="Next"  HREF="020694.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid-users Digest, Vol 58, Issue 31</H1>
    <B>Mike Golf</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid-users%20Digest%2C%20Vol%2058%2C%20Issue%2031&In-Reply-To=%3CCAApifbbQLD-__WdqO1Qd4HjL9gD7ZjP75O__Gmmyv_xCxM6dkQ%40mail.gmail.com%3E"
       TITLE="[squid-users] squid-users Digest, Vol 58, Issue 31">mjguiao at gmail.com
       </A><BR>
    <I>Mon Jul  1 02:04:07 UTC 2019</I>
    <P><UL>
        
        <LI>Next message (by thread): <A HREF="020694.html">[squid-users] squid-users Digest, Vol 58, Issue 31
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20693">[ date ]</a>
              <a href="thread.html#20693">[ thread ]</a>
              <a href="subject.html#20693">[ subject ]</a>
              <a href="author.html#20693">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm looking for help modifying the stock squid config file, within the
GUI I can bypass the proxy completely (HTTP + HTTPS) for certain LAN
IP's; however this will also stop them from accessing the cached HTTP
data. I don't want this rather I want the IP addresses in the range of
192.168.1.2 - 192.168.1.200 to be excluded from HTTPS caching but
still being able to access/cache with the HTTP proxy. I don't know how
to modify the standard configuration files to allow this, PFSense will
bypass(HTTP + HTTPS) any IP I add to &quot;Bypass Proxy for These Source
IPs&quot;.

I specified these IP's as DHCP just for a bit of context since my
personal devices 192.168.1.200-192.168.1.254 are statically assigned
devices which I was going to deploy the CA's on, I wanted to avoid
having to deploy CA's to every single device which makes up my DHCP
range. It won't be fun having to install CA's on someones device every
time a guest asks me for my WiFi password. Regarding SSL I made a
mistake on this I just offhandedly generalized all HTTPS stuff as
&quot;SSL&quot; since I'm just used to people saying TLS/SSL when they refer to
HTTPS.

I'm running the HTTP proxy in transparent mode and I've included the
current configuration I'm using for reference, could you walk me
through how I would go about modifying the configuration file. I'm not
to familiar with squid terminology so could you please explain it to
me like I'm 5 (ELI5). I don't know how to structure the directives and
ACL's to allow this since the GUI menu uses a a &quot;blanket&quot;
configuration for whatever you input, I need help with specifying the
custom options.



# This file is automatically generated by pfSense
# Do not edit manually !

http_port 192.168.1.1:3128
http_port 127.0.0.1:3128 intercept
icp_port 0
digest_generation off
dns_v4_first off
pid_filename /var/run/squid/squid.pid
cache_effective_user squid
cache_effective_group proxy
error_default_language en
icon_directory /usr/local/etc/squid/icons
visible_hostname localhost
cache_mgr <A HREF="https://lists.squid-cache.org/listinfo/squid-users">admin at localhost</A>
access_log /var/squid/logs/access.log
cache_log /var/squid/logs/cache.log
cache_store_log none
netdb_filename /var/squid/logs/netdb.state
pinger_enable on
pinger_program /usr/local/libexec/squid/pinger

logfile_rotate 1
debug_options rotate=1
shutdown_lifetime 3 seconds
# Allow local network(s) on interface(s)
acl localnet src  192.168.1.0/24
forwarded_for delete
via off
httpd_suppress_version_string on
uri_whitespace strip


cache_mem 2048 MB
maximum_object_size_in_memory 20480 KB
memory_replacement_policy heap GDSF
cache_replacement_policy heap LFUDA
minimum_object_size 0 KB
maximum_object_size 256 MB
cache_dir aufs /var/squid/cache 36864 16 256
offline_mode off
cache_swap_low 90
cache_swap_high 95
cache allow all
# Add any of your own refresh_pattern entries above these.
refresh_pattern ^ftp:    1440  20%  10080
refresh_pattern ^gopher:  1440  0%  1440
refresh_pattern -i (/cgi-bin/|\?) 0  0%  0
refresh_pattern .    0  20%  4320


#Remote proxies


# Setup some default acls
# ACLs all, manager, localhost, and to_localhost are predefined.
acl allsrc src all
acl safeports port 21 70 80 210 280 443 488 563 591 631 777 901  3128
3129 1025-65535
acl sslports port 443 563

acl purge method PURGE
acl connect method CONNECT

# Define protocols used for redirects
acl HTTP proto HTTP
acl HTTPS proto HTTPS
http_access allow manager localhost

http_access deny manager
http_access allow purge localhost
http_access deny purge
http_access deny !safeports
http_access deny CONNECT !sslports

# Always allow localhost connections
http_access allow localhost

request_body_max_size 0 KB
delay_pools 1
delay_class 1 2
delay_parameters 1 -1/-1 -1/-1
delay_initial_bucket_level 100
delay_access 1 allow allsrc

# Reverse Proxy settings


# Custom options before auth


# Setup allowed ACLs
# Allow local network(s) on interface(s)
http_access allow localnet
# Default block all to be sure
http_access deny allsrc


&gt;<i> Send squid-users mailing list submissions to
</I>&gt;<i>  <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i>
</I>&gt;<i> To subscribe or unsubscribe via the World Wide Web, visit
</I>&gt;<i>  <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> or, via email, send a message with subject or body 'help' to
</I>&gt;<i>  <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-request at lists.squid-cache.org</A>
</I>&gt;<i>
</I>&gt;<i> You can reach the person managing the list at
</I>&gt;<i>  <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-owner at lists.squid-cache.org</A>
</I>&gt;<i>
</I>&gt;<i> When replying, please edit your Subject line so it is more specific
</I>&gt;<i> than &quot;Re: Contents of squid-users digest...&quot;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Today's Topics:
</I>&gt;<i>
</I>&gt;<i>  1. Re: Bypassing SSL Man In the Middle Filtering For Certain LAN
</I>&gt;<i>  IP's (Amos Jeffries)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ----------------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i> Message: 1
</I>&gt;<i> Date: Sun, 30 Jun 2019 18:36:19 +1200
</I>&gt;<i> From: Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;
</I>&gt;<i> To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> Subject: Re: [squid-users] Bypassing SSL Man In the Middle Filtering
</I>&gt;<i>  For Certain LAN IP's
</I>&gt;<i> Message-ID: &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">6e721121-1569-4b6c-21f0-6429d763c5ae at treenet.co.nz</A>&gt;
</I>&gt;<i> Content-Type: text/plain; charset=utf-8
</I>&gt;<i>
</I>&gt;<i> On 30/06/19 2:32 pm, Mike Golf wrote:
</I>&gt;<i> &gt; Hi All,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I've setup a squid proxy server on my PFSense router, is there any way
</I>&gt;<i> &gt; of bypassing HTTPS/SSL filtering for certain LAN IP's.
</I>&gt;<i>
</I>&gt;<i> HTTPS is not normally filtered at all. So for that to be happening
</I>&gt;<i> something must be forcing it - all you have to do is *not* force the
</I>&gt;<i> filtering or MITM to happen.
</I>&gt;<i>
</I>&gt;<i> * remove any rules in your NAT or routes directing port 443 to the proxy.
</I>&gt;<i>
</I>&gt;<i> * remove any https_port in the proxy for receiving that intercepted traffic
</I>&gt;<i>
</I>&gt;<i> * remove any SSL-Bump config for handling intercepted port 443 traffic
</I>&gt;<i> or decrypting CONNECT tunnels.
</I>&gt;<i>
</I>&gt;<i> With that all done you will at most be left with clients using the proxy
</I>&gt;<i> in forward-proxy capacity to open CONNECT tunnels.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; I have IP
</I>&gt;<i> &gt; addresses 192.168.1.0-192.168.1.200 allocated through DHCP and I want
</I>&gt;<i> &gt; these devices to bypass SSL interception but not the standard HTTP proxy.
</I>&gt;<i>
</I>&gt;<i> Consider how are those clients using the proxy in the first place? Their
</I>&gt;<i> method of IP assignment has nothing to do with it.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Since most modern sites use HTTPS by default HTTP caching isn't that
</I>&gt;<i> &gt; effective anymore,
</I>&gt;<i>
</I>&gt;<i> That is a deceptive statement, more false than most think. But
</I>&gt;<i> irrelevant since what you are wanting will prevent HTTPS caching entirely.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; however I want my personal devices to use the SSL
</I>&gt;<i> &gt; proxy
</I>&gt;<i>
</I>&gt;<i> Note that SSL protocols both v2 and v3 are obsolete.
</I>&gt;<i>
</I>&gt;<i> Are you asking for:
</I>&gt;<i>  a) a TLS explicit proxy, or
</I>&gt;<i>  b) a TLS interception proxy, or
</I>&gt;<i>  c) a forward-proxy for relaying HTTPS ?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt;so I can get the fastest possible browsing experience without
</I>&gt;<i> &gt; having to install certificate authorities on my guests devices which use
</I>&gt;<i> &gt; the DHCP range.
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> A proxy is not going to do anything in regards to speed for those clients.
</I>&gt;<i>
</I>&gt;<i> The only way which you can improve speed with a proxy is by caching of
</I>&gt;<i> HTTPS content - by avoiding all the re-encrypt delays on every request
</I>&gt;<i> that can be made a HIT. But that requires those cert installations you
</I>&gt;<i> are trying to avoid.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ------------------------------
</I>&gt;<i>
</I>&gt;<i> Subject: Digest Footer
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ------------------------------
</I>&gt;<i>
</I>&gt;<i> End of squid-users Digest, Vol 58, Issue 31
</I>&gt;<i> *******************************************
</I>&gt;<i>
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message (by thread): <A HREF="020694.html">[squid-users] squid-users Digest, Vol 58, Issue 31
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20693">[ date ]</a>
              <a href="thread.html#20693">[ thread ]</a>
              <a href="subject.html#20693">[ subject ]</a>
              <a href="author.html#20693">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
