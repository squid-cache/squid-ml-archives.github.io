<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid-users Digest, Vol 59, Issue 10
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid-users%20Digest%2C%20Vol%2059%2C%20Issue%2010&In-Reply-To=%3CCABCok%3D%2BLboOP_fPFxqHU15MTVOb_9HONj%2Ba77e6BtAEKQkzEpQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020713.html">
   <LINK REL="Next"  HREF="020715.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid-users Digest, Vol 59, Issue 10</H1>
    <B>Arunabha Saha</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid-users%20Digest%2C%20Vol%2059%2C%20Issue%2010&In-Reply-To=%3CCABCok%3D%2BLboOP_fPFxqHU15MTVOb_9HONj%2Ba77e6BtAEKQkzEpQ%40mail.gmail.com%3E"
       TITLE="[squid-users] squid-users Digest, Vol 59, Issue 10">arunabha.saha at gmail.com
       </A><BR>
    <I>Wed Jul 10 23:44:32 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020713.html">[squid-users] Non-standard proxy setup
</A></li>
        <LI>Next message (by thread): <A HREF="020715.html">[squid-users] Non-standard proxy setup
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20714">[ date ]</a>
              <a href="thread.html#20714">[ thread ]</a>
              <a href="subject.html#20714">[ subject ]</a>
              <a href="author.html#20714">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i>The client will attempt to open a TLS/TCP connection to the origin
</I>&gt;<i>server. Your router (or some such) will redirect client TLS/TCP bytes to
</I>&gt;<i>your Squid's https_port. If configured correctly, Squid will accept that
</I>&gt;<i>TCP connection and wrap/forward it into/inside an HTTP CONNECT tunnel
</I>&gt;<i>through the corporate proxy.
</I>
   I'm trying to accomplish something similiar but i don't see squid
wrap the connection to parent proxy in a HTTP CONNECT tunnel.
   User -----&gt;Squid(Transparent Proxy)---------&gt;Parent Proxy------&gt;Internet.
   I need to see a CONNECT tunnel between Squid(Transparent Proxy)
and Parent Proxy but I don't.   Based on another thread, Is this
something that works only starting squid 4.X.   My version is squid
3.5.25.


On Wed, Jul 10, 2019 at 5:02 AM
&lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-request at lists.squid-cache.org</A>&gt; wrote:
&gt;<i>
</I>&gt;<i> Send squid-users mailing list submissions to
</I>&gt;<i>         <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i>
</I>&gt;<i> To subscribe or unsubscribe via the World Wide Web, visit
</I>&gt;<i>         <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> or, via email, send a message with subject or body 'help' to
</I>&gt;<i>         <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-request at lists.squid-cache.org</A>
</I>&gt;<i>
</I>&gt;<i> You can reach the person managing the list at
</I>&gt;<i>         <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-owner at lists.squid-cache.org</A>
</I>&gt;<i>
</I>&gt;<i> When replying, please edit your Subject line so it is more specific
</I>&gt;<i> than &quot;Re: Contents of squid-users digest...&quot;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Today's Topics:
</I>&gt;<i>
</I>&gt;<i>    1. Non-standard proxy setup (Tardif, Christian)
</I>&gt;<i>    2. Re: Non-standard proxy setup (Alex Rousskov)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ----------------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i> Message: 1
</I>&gt;<i> Date: Tue, 9 Jul 2019 13:10:21 +0000
</I>&gt;<i> From: &quot;Tardif, Christian&quot; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">christian.tardif at bell.ca</A>&gt;
</I>&gt;<i> To: &quot;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&quot;
</I>&gt;<i>         &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i> Subject: [squid-users] Non-standard proxy setup
</I>&gt;<i> Message-ID:
</I>&gt;<i>         &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">adf806f395d24d45a575a0ee772759d3 at DG2MBX03-WYN.bell.corp.bce.ca</A>&gt;
</I>&gt;<i> Content-Type: text/plain; charset=&quot;utf-8&quot;
</I>&gt;<i>
</I>&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> I'm trying to figure out how to make the following setup work:
</I>&gt;<i>
</I>&gt;<i> I have a node on which there's an application which isn't proxy aware so basically, the only remaining option would be to use a transparent proxy. But my corporate proxy isn't a transparent proxy. So I have to build this in two layers. My solution would be to:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> 1)     Have a squid proxy on the node's router host configured as a transparent proxy for both HTTP and HTTPS
</I>&gt;<i>
</I>&gt;<i> 2)     Have this squid proxy configured to talk to the parent host, which would be my corporate proxy
</I>&gt;<i>
</I>&gt;<i> 3)     Have this squid proxy able to decide if a particular flow should go to the corporate proxy or connect &quot;directly&quot; with the destination host
</I>&gt;<i>
</I>&gt;<i> I've been successful at tasks #2 and #3 (well, in fact, I did it with tinyproxy but stopped because of task #1
</I>&gt;<i>
</I>&gt;<i> I've partly succedded at task #1. In fact, it worked for HTTP. I haven't figured out how to do it for HTTPS. My questions are:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> 1)     I do not understand how the client would be able to perform a CONNECT to reach squid in HTTPS. So I'm assuming that there's some other magic.
</I>&gt;<i>
</I>&gt;<i> 2)     The second thing I don't understand is the certificates management. Let's say my node tries to reach <A HREF="https://www.google.com">https://www.google.com</A> but does not know anything about the proxy. I assume that the client will get the certificate from squid in some way, but would probably expect to receive a certificate from Google. How would that work?
</I>&gt;<i>
</I>&gt;<i> Can someone help me?   I'm running out of options...
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i>
</I>&gt;<i> Christian Tardif
</I>&gt;<i> -------------- next part --------------
</I>&gt;<i> An HTML attachment was scrubbed...
</I>&gt;<i> URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20190709/fe8a972b/attachment-0001.html">http://lists.squid-cache.org/pipermail/squid-users/attachments/20190709/fe8a972b/attachment-0001.html</A>&gt;
</I>&gt;<i>
</I>&gt;<i> ------------------------------
</I>&gt;<i>
</I>&gt;<i> Message: 2
</I>&gt;<i> Date: Tue, 9 Jul 2019 09:54:25 -0400
</I>&gt;<i> From: Alex Rousskov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt;
</I>&gt;<i> To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> Subject: Re: [squid-users] Non-standard proxy setup
</I>&gt;<i> Message-ID:
</I>&gt;<i>         &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">bf4b6e33-5075-ef84-dea9-c42ef68ac46f at measurement-factory.com</A>&gt;
</I>&gt;<i> Content-Type: text/plain; charset=windows-1252
</I>&gt;<i>
</I>&gt;<i> On 7/9/19 9:10 AM, Tardif, Christian wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; I have a node on which there&#8217;s an application which isn&#8217;t proxy aware so
</I>&gt;<i> &gt; basically, the only remaining option would be to use a transparent
</I>&gt;<i> &gt; proxy. But my corporate proxy isn&#8217;t a transparent proxy. So I have to
</I>&gt;<i> &gt; build this in two layers. My solution would be to:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 1)     Have a squid proxy on the node&#8217;s router host configured as a
</I>&gt;<i> &gt; transparent proxy for both HTTP and HTTPS
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 2)     Have this squid proxy configured to talk to the parent host,
</I>&gt;<i> &gt; which would be my corporate proxy
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 3)     Have this squid proxy able to decide if a particular flow should
</I>&gt;<i> &gt; go to the corporate proxy or connect &#8220;directly&#8221; with the destination host
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I&#8217;ve been successful at tasks #2 and #3 (well, in fact, I did it with
</I>&gt;<i> &gt; tinyproxy but stopped because of task #1
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I&#8217;ve partly succedded at task #1. In fact, it worked for HTTP. I haven&#8217;t
</I>&gt;<i> &gt; figured out how to do it for HTTPS. My questions are:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 1)     I do not understand how the client would be able to perform a
</I>&gt;<i> &gt; CONNECT to reach squid in HTTPS. So I&#8217;m assuming that there&#8217;s some other
</I>&gt;<i> &gt; magic.
</I>&gt;<i>
</I>&gt;<i> The client will attempt to open a TLS/TCP connection to the origin
</I>&gt;<i> server. Your router (or some such) will redirect client TLS/TCP bytes to
</I>&gt;<i> your Squid's https_port. If configured correctly, Squid will accept that
</I>&gt;<i> TCP connection and wrap/forward it into/inside an HTTP CONNECT tunnel
</I>&gt;<i> through the corporate proxy.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; 2)     The second thing I don&#8217;t understand is the certificates
</I>&gt;<i> &gt; management. Let&#8217;s say my node tries to reach <A HREF="https://www.google.com">https://www.google.com</A> but
</I>&gt;<i> &gt; does not know anything about the proxy. I assume that the client will
</I>&gt;<i> &gt; get the certificate from squid in some way, but would probably expect to
</I>&gt;<i> &gt; receive a certificate from Google. How would that work?
</I>&gt;<i>
</I>&gt;<i> * If you do not want your Squid to look inside the connection to
</I>&gt;<i> google.com, then your Squid will work at TCP level. Same for the
</I>&gt;<i> corporate proxy. Both proxies will forward Google certificate to the
</I>&gt;<i> unsuspecting client and everything will work fine most[XXX] of the time.
</I>&gt;<i>
</I>&gt;<i> * Otherwise, you will need to use SslBump functionality and impersonate
</I>&gt;<i> the origin server, including faking its certificate. If you add your
</I>&gt;<i> proxy CA certificate to the client, this bumping will work for some
</I>&gt;<i> sites and will break others.
</I>&gt;<i>
</I>&gt;<i> [XXX] The only HTTPS-related problem you may have in a tunneling-only
</I>&gt;<i> Squid is with TCP-level error reporting to the client (e.g., when Squid
</I>&gt;<i> cannot connect to the corporate proxy). By default, Squid may want to
</I>&gt;<i> bump the client connection (to report those errors to the client),
</I>&gt;<i> causing bumping problems mentioned in the second bullet above. For Squid
</I>&gt;<i> configurations that are not supposed to bump traffic at all, this
</I>&gt;<i> implicit bumping on errors is a bug/misfeature.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> HTH,
</I>&gt;<i>
</I>&gt;<i> Alex.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ------------------------------
</I>&gt;<i>
</I>&gt;<i> Subject: Digest Footer
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ------------------------------
</I>&gt;<i>
</I>&gt;<i> End of squid-users Digest, Vol 59, Issue 10
</I>&gt;<i> *******************************************
</I>


-- 
regards,
Arun

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020713.html">[squid-users] Non-standard proxy setup
</A></li>
	<LI>Next message (by thread): <A HREF="020715.html">[squid-users] Non-standard proxy setup
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20714">[ date ]</a>
              <a href="thread.html#20714">[ thread ]</a>
              <a href="subject.html#20714">[ subject ]</a>
              <a href="author.html#20714">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
