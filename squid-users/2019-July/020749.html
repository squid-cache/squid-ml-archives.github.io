<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Debian Buster, Squid 4.6-1 amd64, &quot;Too few negotiateauthenticator processes are running&quot;
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Debian%20Buster%2C%20Squid%204.6-1%20amd64%2C%0A%20%22Too%20few%20negotiateauthenticator%20processes%20are%20running%22&In-Reply-To=%3CAM0PR04MB4753A1CA5F7C8F5FF9E6C85B8FCE0%40AM0PR04MB4753.eurprd04.prod.outlook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020752.html">
   <LINK REL="Next"  HREF="020745.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Debian Buster, Squid 4.6-1 amd64, &quot;Too few negotiateauthenticator processes are running&quot;</H1>
    <B>Rafael Akchurin</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Debian%20Buster%2C%20Squid%204.6-1%20amd64%2C%0A%20%22Too%20few%20negotiateauthenticator%20processes%20are%20running%22&In-Reply-To=%3CAM0PR04MB4753A1CA5F7C8F5FF9E6C85B8FCE0%40AM0PR04MB4753.eurprd04.prod.outlook.com%3E"
       TITLE="[squid-users] Debian Buster, Squid 4.6-1 amd64, &quot;Too few negotiateauthenticator processes are running&quot;">rafael.akchurin at diladele.com
       </A><BR>
    <I>Tue Jul 16 05:53:00 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020752.html">[squid-users] Debian Buster, Squid 4.6-1 amd64, &quot;Too few negotiateauthenticator processes are running&quot;
</A></li>
        <LI>Next message (by thread): <A HREF="020745.html">[squid-users] Does request_header_replace support calling into	another file
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20749">[ date ]</a>
              <a href="thread.html#20749">[ thread ]</a>
              <a href="subject.html#20749">[ subject ]</a>
              <a href="author.html#20749">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello James,

Here is to confirm that after applying this patch, rebuilding Squid 4.6 and deploying it into production of about 700 proxy connected clients using mostly Kerberos authentication followed by NTLM and Basic LDAP the mentioned issue with negotiate wrapper went away. No more pop us from client browsers.

Best regards,
Rafael Akchurin
Diladele B.V.

--
Need easy to manage DNS filter? See our new project at <A HREF="https://dnssafety.io/">https://dnssafety.io/</A>

From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of James Zuelow
Sent: Monday, July 15, 2019 9:11 PM
To: '<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>'
Subject: [squid-users] Debian Buster, Squid 4.6-1 amd64, &quot;Too few negotiateauthenticator processes are running&quot;

We have a pair of Squid proxies, running as a failover pair with ucarp.

Both of these proxies are domain joined with Samba, and we've been using Kerberos authentication for several years.

After Debian Buster was released, we upgraded the failover unit and did some basic testing.  Everything seemed to go correctly.  Unfortunately when we tested, we didn't put the failover under a serious load - we merely made sure each component was working the way we expected it to.

We waited a week, and then updated the primary.

As soon as the primary was updated and assumed a real load, users started seeing proxy authentication prompts and the proxy started operating very slowly - to the point where sessions would time out.  We quickly rolled to the failover, but the problem remained.

Since this was a major version upgrade, everything on the server had changed so I had lots of places to look for errors.  I did in fact find that my file descriptor settings in limits.conf had reverted back to the default of 1024, but even after fixing this the proxy was slow.

I see in the logs many occurrences of &quot;Too few negotiateauthenticator processes are running&quot; - the negotiate authenticators look like they're crashing every 15-45 seconds when the proxy is busy (between 80-100 requests per second at my site).

Doing a quick Google, I found this:  <A HREF="https://github.com/diladele/websafety-issues/issues/1141">https://github.com/diladele/websafety-issues/issues/1141</A>
Which refers to this:  <A HREF="https://bugs.squid-cache.org/show_bug.cgi?id=4936">https://bugs.squid-cache.org/show_bug.cgi?id=4936</A>

The fix referred to in bug 4936 appears to be about a month old.

<A HREF="https://tracker.debian.org/pkg/squid">https://tracker.debian.org/pkg/squid</A> implies that the version of squid in Buster is older than that, last merged into testing (now stable) in February.

Before I file a Debian bug report, how could I go about confirming the presence of bug 4936 in the current Debian stable version of Squid?  Are the dates good enough?

Thank you!

James
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20190716/faec0fbd/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20190716/faec0fbd/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020752.html">[squid-users] Debian Buster, Squid 4.6-1 amd64, &quot;Too few negotiateauthenticator processes are running&quot;
</A></li>
	<LI>Next message (by thread): <A HREF="020745.html">[squid-users] Does request_header_replace support calling into	another file
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20749">[ date ]</a>
              <a href="thread.html#20749">[ thread ]</a>
              <a href="subject.html#20749">[ subject ]</a>
              <a href="author.html#20749">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
