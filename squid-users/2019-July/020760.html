<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Possible to user reply_header_add directive with acl random access list ?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Possible%20to%20user%20reply_header_add%20directive%20with%0A%20acl%20random%20access%20list%20%3F&In-Reply-To=%3C69E6FFF8-CDA3-4BA3-9759-5B0E7FDE2CDE%40netstream.ps%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020759.html">
   <LINK REL="Next"  HREF="020761.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Possible to user reply_header_add directive with acl random access list ?</H1>
    <B>--Ahmad--</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Possible%20to%20user%20reply_header_add%20directive%20with%0A%20acl%20random%20access%20list%20%3F&In-Reply-To=%3C69E6FFF8-CDA3-4BA3-9759-5B0E7FDE2CDE%40netstream.ps%3E"
       TITLE="[squid-users] Possible to user reply_header_add directive with acl random access list ?">ahmed.zaeem at netstream.ps
       </A><BR>
    <I>Wed Jul 17 11:55:13 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020759.html">[squid-users] Possible to user reply_header_add directive with acl random access list ?
</A></li>
        <LI>Next message (by thread): <A HREF="020761.html">[squid-users] Possible to user reply_header_add directive with acl random access list ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20760">[ date ]</a>
              <a href="thread.html#20760">[ thread ]</a>
              <a href="subject.html#20760">[ subject ]</a>
              <a href="author.html#20760">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Amos , Thank you for you info .

indeed i read about reply header ACL That :

##############################################
One or more Squid ACLs may be specified to restrict header
	injection to matching responses. As always in squid.conf, all
	ACLs in the ACL list must be satisfied for the insertion to
	happen. The reply_header_add option supports fast ACLs only.

	See also: request_header_add.
#################################################

im not sure what do i need to let the output single value and not multiple values .

about your Question :
&gt;<i> 1- why mutiple replies do we recieve not single reply ?
</I>
What do you mean by &quot;multiple replies&quot; ?
&#8212;&#8212;&#8212;&#8212;&gt; i mean i would like the result to be as below :

* Rebuilt URL to: ifconfig.io/
*   Trying 12.13.100.250...
* TCP_NODELAY set
* Connected to 12.13.100.250 (12.13.100.250) port 2000 (#0)
* Proxy auth using Basic with user 'hi'
&gt;<i> GET <A HREF="http://ifconfig.io/">http://ifconfig.io/</A> HTTP/1.1
</I>&gt;<i> Host: ifconfig.io
</I>&gt;<i> Proxy-Authorization: Basic YmVuOmJlbg==
</I>&gt;<i> User-Agent: curl/7.54.0
</I>&gt;<i> Accept: */*
</I>&gt;<i> Proxy-Connection: Keep-Alive
</I>&gt;<i> 
</I>&lt; HTTP/1.1 200 OK
&lt; Date: Wed, 17 Jul 2019 09:34:57 GMT
&lt; Content-Type: text/plain; charset=utf-8
&lt; Content-Length: 40
&lt; Connection: keep-alive
&lt; start: A
&lt; 
12.13.100.1
* Connection #0 to host 12.13.100.250 left intact



* Rebuilt URL to: ifconfig.io/
*   Trying 12.13.100.250...
* TCP_NODELAY set
* Connected to 12.13.100.250 (12.13.100.250) port 2000 (#0)
* Proxy auth using Basic with user 'hi'
&gt;<i> GET <A HREF="http://ifconfig.io/">http://ifconfig.io/</A> HTTP/1.1
</I>&gt;<i> Host: ifconfig.io
</I>&gt;<i> Proxy-Authorization: Basic YmVuOmJlbg==
</I>&gt;<i> User-Agent: curl/7.54.0
</I>&gt;<i> Accept: */*
</I>&gt;<i> Proxy-Connection: Keep-Alive
</I>&gt;<i> 
</I>&lt; HTTP/1.1 200 OK
&lt; Date: Wed, 17 Jul 2019 09:34:57 GMT
&lt; Content-Type: text/plain; charset=utf-8
&lt; Content-Length: 40
&lt; Connection: keep-alive
&lt; start: B
&lt; 
12.13.100.2
* Connection #0 to host 12.13.100.250 left intact




* Rebuilt URL to: ifconfig.io/
*   Trying 12.13.100.250...
* TCP_NODELAY set
* Connected to 12.13.100.250 (12.13.100.250) port 2000 (#0)
* Proxy auth using Basic with user 'hi'
&gt;<i> GET <A HREF="http://ifconfig.io/">http://ifconfig.io/</A> HTTP/1.1
</I>&gt;<i> Host: ifconfig.io
</I>&gt;<i> Proxy-Authorization: Basic YmVuOmJlbg==
</I>&gt;<i> User-Agent: curl/7.54.0
</I>&gt;<i> Accept: */*
</I>&gt;<i> Proxy-Connection: Keep-Alive
</I>&gt;<i> 
</I>&lt; HTTP/1.1 200 OK
&lt; Date: Wed, 17 Jul 2019 09:34:57 GMT
&lt; Content-Type: text/plain; charset=utf-8
&lt; Content-Length: 40
&lt; Connection: keep-alive
&lt; start: C
&lt; 
12.13.100.3
* Connection #0 to host 12.13.100.250 left intact


* Rebuilt URL to: ifconfig.io/
*   Trying 12.13.100.250...
* TCP_NODELAY set
* Connected to 12.13.100.250 (12.13.100.250) port 2000 (#0)
* Proxy auth using Basic with user 'hi'
&gt;<i> GET <A HREF="http://ifconfig.io/">http://ifconfig.io/</A> HTTP/1.1
</I>&gt;<i> Host: ifconfig.io
</I>&gt;<i> Proxy-Authorization: Basic YmVuOmJlbg==
</I>&gt;<i> User-Agent: curl/7.54.0
</I>&gt;<i> Accept: */*
</I>&gt;<i> Proxy-Connection: Keep-Alive
</I>&gt;<i> 
</I>&lt; HTTP/1.1 200 OK
&lt; Date: Wed, 17 Jul 2019 09:34:57 GMT
&lt; Content-Type: text/plain; charset=utf-8
&lt; Content-Length: 40
&lt; Connection: keep-alive
&lt; start: D
&lt; 
12.13.100.4
* Connection #0 to host 12.13.100.250 left intact



###############################################


Check the 4 tests above &#8230; those i want the result to be .
if i have external ip 12.13.100.4 , the Header should  be single and = &lt; start: D
if i go external 12.13.100.3 ,the Header should  be single and = &lt; start: C
if i go external 12.13.100.2 ,the Header should  be single and = &lt; start: B
if i go external 12.13.100.1 ,the Header should  be single and = &lt; start: B


SO basically i want 1 answer matching the acl :

acl half10000 random 1/10
acl half10001 random 1/9
acl half10002 random 1/8
acl half10003 random 1/7
acl half10004 random 1/6
acl half10005 random 1/5
acl half10006 random 1/4
acl half10007 random 1/3
acl half10008 random 1/2
acl half10009 random 1/1



as  you see above the ACLS above should be matching single values not multiple values .

and when i get multiple headers replies it doesnt satisfying my needs .


what do you think amos ?


Thanks agian 


&gt;<i> On 17 Jul 2019, at 14:42, Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> On 17/07/19 9:41 pm, --Ahmad-- wrote:
</I>&gt;&gt;<i> Hi Alex, 
</I>&gt;&gt;<i> acl half10000 random 1/10
</I>&gt;&gt;<i> acl half10001 random 1/9
</I>&gt;&gt;<i> acl half10002 random 1/8
</I>&gt;&gt;<i> acl half10003 random 1/7
</I>&gt;&gt;<i> acl half10004 random 1/6
</I>&gt;&gt;<i> acl half10005 random 1/5
</I>&gt;&gt;<i> acl half10006 random 1/4
</I>&gt;&gt;<i> acl half10007 random 1/3
</I>&gt;&gt;<i> acl half10008 random 1/2
</I>&gt;&gt;<i> acl half10009 random 1/1
</I>&gt;&gt;<i> ########################################
</I>&gt;&gt;<i> reply_header_add start &quot;A&quot; half10000
</I>&gt;&gt;<i> reply_header_add start &quot;B&quot; half10001
</I>&gt;&gt;<i> reply_header_add start &quot;C&quot; half10002
</I>&gt;&gt;<i> reply_header_add start &quot;D&quot; half10003
</I>&gt;&gt;<i> reply_header_add start &quot;E&quot; half10004
</I>&gt;&gt;<i> reply_header_add start &quot;F&quot; half10005
</I>&gt;&gt;<i> reply_header_add start &quot;G&quot; half10006
</I>&gt;&gt;<i> reply_header_add start &quot;H&quot; half10007
</I>&gt;&gt;<i> reply_header_add start &quot;I&quot; half10008
</I>&gt;&gt;<i> reply_header_add start &quot;J&quot; half10009
</I>&gt;&gt;<i> ##############################
</I>&gt;&gt;<i> tcp_outgoing_address 12.13.100.1 half10000
</I>&gt;&gt;<i> tcp_outgoing_address 12.13.100.2 half10001
</I>&gt;&gt;<i> tcp_outgoing_address 12.13.100.3 half10002
</I>&gt;&gt;<i> tcp_outgoing_address 12.13.100.4 half10003
</I>&gt;&gt;<i> tcp_outgoing_address 12.13.100.5 half10004
</I>&gt;&gt;<i> tcp_outgoing_address 12.13.100.6 half10005
</I>&gt;&gt;<i> tcp_outgoing_address 12.13.100.7 half10006
</I>&gt;&gt;<i> tcp_outgoing_address 12.13.100.8 half10007
</I>&gt;&gt;<i> tcp_outgoing_address 12.13.100.9 half10008
</I>&gt;&gt;<i> tcp_outgoing_address 12.13.100.10 half10009
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> curl -x 12.13.100.250:2000    -U hi:hi  ifconfig.io  -v
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> * Rebuilt URL to: ifconfig.io/
</I>&gt;&gt;<i> *   Trying 12.13.100.250...
</I>&gt;&gt;<i> * TCP_NODELAY set
</I>&gt;&gt;<i> * Connected to 12.13.100.250 (12.13.100.250) port 2000 (#0)
</I>&gt;&gt;<i> * Proxy auth using Basic with user 'hi'
</I>&gt;&gt;&gt;<i> GET <A HREF="http://ifconfig.io/">http://ifconfig.io/</A> HTTP/1.1
</I>&gt;&gt;&gt;<i> Host: ifconfig.io
</I>&gt;&gt;&gt;<i> Proxy-Authorization: Basic YmVuOmJlbg==
</I>&gt;&gt;&gt;<i> User-Agent: curl/7.54.0
</I>&gt;&gt;&gt;<i> Accept: */*
</I>&gt;&gt;&gt;<i> Proxy-Connection: Keep-Alive
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;<i> &lt; HTTP/1.1 200 OK
</I>&gt;&gt;<i> &lt; Date: Wed, 17 Jul 2019 09:34:57 GMT
</I>&gt;&gt;<i> &lt; Content-Type: text/plain; charset=utf-8
</I>&gt;&gt;<i> &lt; Content-Length: 40
</I>&gt;&gt;<i> &lt; Connection: keep-alive
</I>&gt;&gt;<i> &lt; start: G
</I>&gt;&gt;<i> &lt; start: F
</I>&gt;&gt;<i> &lt; start: E
</I>&gt;&gt;<i> &lt; start: E
</I>&gt;&gt;<i> &lt; 
</I>&gt;&gt;<i> 12.13.100.2 
</I>&gt;&gt;<i> * Connection #0 to host 12.13.100.250 left intact
</I>&gt;&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> That reply does look strange. &quot;E&quot; should only occur once, and &quot;J&quot; is
</I>&gt;<i> missing.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> another Hit :
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> curl -x 12.13.100.250:2000    -U hi:hi  ifconfig.io  -v
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> * Rebuilt URL to: ifconfig.io/
</I>&gt;&gt;<i> *   Trying 12.13.100.250...
</I>&gt;&gt;<i> * TCP_NODELAY set
</I>&gt;&gt;<i> * Connected to 12.13.100.250 (12.13.100.250) port 2000 (#0)
</I>&gt;&gt;<i> * Proxy auth using Basic with user 'hi'
</I>&gt;&gt;&gt;<i> GET <A HREF="http://ifconfig.io/">http://ifconfig.io/</A> HTTP/1.1
</I>&gt;&gt;&gt;<i> Host: ifconfig.io
</I>&gt;&gt;&gt;<i> Proxy-Authorization: Basic YmVuOmJlbg==
</I>&gt;&gt;&gt;<i> User-Agent: curl/7.54.0
</I>&gt;&gt;&gt;<i> Accept: */*
</I>&gt;&gt;&gt;<i> Proxy-Connection: Keep-Alive
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;<i> &lt; HTTP/1.1 200 OK
</I>&gt;&gt;<i> &lt; Date: Wed, 17 Jul 2019 09:34:57 GMT
</I>&gt;&gt;<i> &lt; Content-Type: text/plain; charset=utf-8
</I>&gt;&gt;<i> &lt; Content-Length: 40
</I>&gt;&gt;<i> &lt; Connection: keep-alive
</I>&gt;&gt;<i> &lt; start: F
</I>&gt;&gt;<i> &lt; start: A
</I>&gt;&gt;<i> &lt; start: J
</I>&gt;&gt;<i> &lt; start: I
</I>&gt;&gt;<i> &lt; 
</I>&gt;&gt;<i> 12.13.100.6
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> so as you see above , i have multiple replied headers not single one .
</I>&gt;&gt;<i> and the replied header even are wrong .
</I>&gt;&gt;<i> so wrong multiple results i do recieve .
</I>&gt;&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> reply_header_add does not stop with the first matching line like
</I>&gt;<i> http_access. Each is checked to see if that value is to be added.
</I>&gt;<i> 
</I>&gt;<i> So naturally each letter has a random chance of being added.
</I>&gt;<i> 
</I>&gt;<i> In other words;
</I>&gt;<i> You have configured Squid to add the header &quot;start&quot; between 0 and 10
</I>&gt;<i> times, with a selection of letters.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> The tcp_outgoing_address check for which IP address to use is
</I>&gt;<i> independent of what headers are added. That directive *does* stop on
</I>&gt;<i> first matching line.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> my questions is :
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 1- why mutiple replies do we recieve not single reply ?
</I>&gt;<i> 
</I>&gt;<i> What do you mean by &quot;multiple replies&quot; ?
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> 2- why the recieved replies are wrong , i expect single reply based on my random acls we setup . ?
</I>&gt;&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Every time a &quot;random&quot; type ACL is tested a new random number is selected
</I>&gt;<i> and checked against the match:non-match ratio you configure.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> do we need other stuff with random acl to have it work with header directive ?
</I>&gt;&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> The ACL works as designed. You appear to have missed the fact that each
</I>&gt;<i> check/test of the ACL uses a different randomly selected number.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Amos
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A> &lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>&gt;
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20190717/c9c5952c/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20190717/c9c5952c/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020759.html">[squid-users] Possible to user reply_header_add directive with acl random access list ?
</A></li>
	<LI>Next message (by thread): <A HREF="020761.html">[squid-users] Possible to user reply_header_add directive with acl random access list ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20760">[ date ]</a>
              <a href="thread.html#20760">[ thread ]</a>
              <a href="subject.html#20760">[ subject ]</a>
              <a href="author.html#20760">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
