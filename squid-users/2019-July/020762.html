<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] SOLVED - SECURITY ALERT: Host header forgery	detected
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SOLVED%20-%20SECURITY%20ALERT%3A%20Host%20header%20forgery%0A%09detected&In-Reply-To=%3Cef9b8067-8793-316e-1d61-f674df11e737%40borrill.org.uk%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020786.html">
   <LINK REL="Next"  HREF="020764.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] SOLVED - SECURITY ALERT: Host header forgery	detected</H1>
    <B>Stephen Borrill</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SOLVED%20-%20SECURITY%20ALERT%3A%20Host%20header%20forgery%0A%09detected&In-Reply-To=%3Cef9b8067-8793-316e-1d61-f674df11e737%40borrill.org.uk%3E"
       TITLE="[squid-users] SOLVED - SECURITY ALERT: Host header forgery	detected">squid at borrill.org.uk
       </A><BR>
    <I>Wed Jul 17 14:20:51 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020786.html">[squid-users] Possible to user reply_header_add directive with acl random access list ?
</A></li>
        <LI>Next message (by thread): <A HREF="020764.html">[squid-users] SOLVED - SECURITY ALERT: Host header forgery detected
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20762">[ date ]</a>
              <a href="thread.html#20762">[ thread ]</a>
              <a href="subject.html#20762">[ subject ]</a>
              <a href="author.html#20762">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>(old thread revived)

A common problem is with sites that have very short TTLs.

For instance login.live.com sometimes has a TTL of 60 seconds. The squid
server is using BIND as a recursive DNS resolver and clients are using
the same BIND instance too. All clients (iOS, Windows, Android)
sometimes use an old IP address and so you hit the Host header forgery
detected problem.

I can't see how to mitigate this problem.

On 16/05/18 12:05, Eliezer Croitoru wrote:
&gt;<i> Amos, 
</I>&gt;<i> 
</I>&gt;<i> And this issue is kind of big\mega corp services or CDN services. 
</I>&gt;<i> Now I am really not sure I understand what this security host forgery is about. 
</I>&gt;<i> There are couple cases: 
</I>&gt;<i> - Simple forward proxy with ssl-bump which no header forgery should ever happen when the client requests for a specific domain and no IP 
</I>&gt;<i> - Intercept proxy  with ssl-bump enabled that has no SNI host 
</I>&gt;<i> - Intercept proxy with ssl-bump enabled that has SNI and squid passes the clients SNI host 
</I>&gt;<i> 
</I>&gt;<i> Which one of the above is this specific case? 
</I>&gt;<i> And if there are other cases it's good to list them and I will try to wiki these details. 
</I>&gt;<i> 
</I>&gt;<i> Thanks, 
</I>&gt;<i> Eliezer 
</I>&gt;<i> 
</I>&gt;<i> ---- 
</I>&gt;<i> Eliezer Croitoru 
</I>&gt;<i> Linux System Administrator 
</I>&gt;<i> Mobile: +972-5-28704261 
</I>&gt;<i> Email: [hidden email] 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> -----Original Message----- 
</I>&gt;<i> From: squid-users &lt;[hidden email]&gt; On Behalf Of Amos Jeffries 
</I>&gt;<i> Sent: Tuesday, May 15, 2018 21:28 
</I>&gt;<i> To: [hidden email] 
</I>&gt;<i> Subject: Re: [squid-users] SOLVED - SECURITY ALERT: Host header forgery detected 
</I>&gt;<i> 
</I>&gt;<i> On 16/05/18 02:02, Eliezer Croitoru wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> Hey Martin, 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Technically there should be a way to inform Squid-Cache about multiple addresses for the same destination. 
</I>&gt;&gt;<i> If Squid doesn't know that it's a real IP of the domains a partial solution is to use the same DNS service but it can also be something else. 
</I>&gt;&gt;<i> For example there should be a way\option for squid to decide if this address of the client or server is secured. 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Amos what do you think? 
</I>&gt;&gt;<i> Can a Host header forgery detection override acl be added? Should it be added? 
</I>&gt;&gt;<i> I believe that  if there are some properties to the remote certificate we can flag the service as &quot;Secure&quot; 
</I>&gt;&gt;<i> IE if the OS runs a &quot;openssl s_client -host www.ubuntnu.com -connect 91.189.89.118:443 
</I>&gt;&gt;<i>  And the certificate is fine then... it's there is no place for any SECURITY ALERT.
</I>&gt;<i> 
</I>&gt;<i> A malicious actor would simply forward the TLS handshake to the real 
</I>&gt;<i> server they are spoofing. Same way Squid does for SSL-Bump. 
</I>&gt;<i> 
</I>&gt;<i> The counter argument of not sending SNI to that suspicious server will 
</I>&gt;<i> have failures with these exact same mega-corp services. Think 
</I>&gt;<i> foo.example.com hosted on Google hosting where the generic server cert 
</I>&gt;<i> is &quot;foo.1e1.net&quot; not &quot;foo.example.com&quot;, nor even google.com&quot;. 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> The &quot;problem&quot; that needs to be resolved is simply that the genuine 
</I>&gt;<i> servers do not have a reliable match between their IP and client 
</I>&gt;<i> presented domain name(s). 
</I>&gt;<i> 
</I>&gt;<i> Amos 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020786.html">[squid-users] Possible to user reply_header_add directive with acl random access list ?
</A></li>
	<LI>Next message (by thread): <A HREF="020764.html">[squid-users] SOLVED - SECURITY ALERT: Host header forgery detected
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20762">[ date ]</a>
              <a href="thread.html#20762">[ thread ]</a>
              <a href="subject.html#20762">[ subject ]</a>
              <a href="author.html#20762">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
