<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] SOLVED - SECURITY ALERT: Host header forgery detected
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SOLVED%20-%20SECURITY%20ALERT%3A%20Host%20header%20forgery%0A%20detected&In-Reply-To=%3C526a3ab6-460d-a6e3-dd0e-9f5ac57336bd%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020762.html">
   <LINK REL="Next"  HREF="020767.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] SOLVED - SECURITY ALERT: Host header forgery detected</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SOLVED%20-%20SECURITY%20ALERT%3A%20Host%20header%20forgery%0A%20detected&In-Reply-To=%3C526a3ab6-460d-a6e3-dd0e-9f5ac57336bd%40measurement-factory.com%3E"
       TITLE="[squid-users] SOLVED - SECURITY ALERT: Host header forgery detected">rousskov at measurement-factory.com
       </A><BR>
    <I>Wed Jul 17 15:27:26 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020762.html">[squid-users] SOLVED - SECURITY ALERT: Host header forgery	detected
</A></li>
        <LI>Next message (by thread): <A HREF="020767.html">[squid-users] network problems with squid ssl-bump
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20764">[ date ]</a>
              <a href="thread.html#20764">[ thread ]</a>
              <a href="subject.html#20764">[ subject ]</a>
              <a href="author.html#20764">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 7/17/19 10:20 AM, Stephen Borrill wrote:

&gt;<i> A common problem is with sites that have very short TTLs.
</I>&gt;<i> 
</I>&gt;<i> For instance login.live.com sometimes has a TTL of 60 seconds. The squid
</I>&gt;<i> server is using BIND as a recursive DNS resolver and clients are using
</I>&gt;<i> the same BIND instance too. All clients (iOS, Windows, Android)
</I>&gt;<i> sometimes use an old IP address and so you hit the Host header forgery
</I>&gt;<i> detected problem.
</I>&gt;<i> 
</I>&gt;<i> I can't see how to mitigate this problem.
</I>
This problem can be mitigated by focusing not on stopping malicious
actors but on minimizing their negative effects. The following two steps
could help AFAICT:

1. When a host header forgery is suspected, allow the transaction
through but under a quarantine regime -- the transaction cannot write to
any cache and cannot read any non-public info. Squid could still warn
about its suspicions, and the admin can be given control over the
frequency of these warnings. Perhaps these warnings can be made
more/less prominent depending on the lack/presence of the confirmation
in #2 below.

2. If (and only if) Squid can validate the server as matching the
client-specified domain name (via the server certificate validation),
the quarantine regime in #1 can be lifted. This is similar to the
validation a client would have to do, of course. However, the client has
more info so sometimes Squid validation will work, and sometimes it will
fail.


Squid already implements portions of #1. No #2 aspects are supported IIRC.


Or we can just change Squid to give the admin control over the frequency
of these warnings but always muddle through with forwarding the
transaction despite known grave risks. We all know that, given a chance,
the vast majority of admins will simply disable warnings.

Alex.


&gt;&gt;<i> -----Original Message----- 
</I>&gt;&gt;<i> From: squid-users &lt;[hidden email]&gt; On Behalf Of Amos Jeffries 
</I>&gt;&gt;<i> Sent: Tuesday, May 15, 2018 21:28 
</I>&gt;&gt;<i> To: [hidden email] 
</I>&gt;&gt;<i> Subject: Re: [squid-users] SOLVED - SECURITY ALERT: Host header forgery detected 
</I>
&gt;&gt;<i> The &quot;problem&quot; that needs to be resolved is simply that the genuine 
</I>&gt;&gt;<i> servers do not have a reliable match between their IP and client 
</I>&gt;&gt;<i> presented domain name(s). 
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Amos 
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020762.html">[squid-users] SOLVED - SECURITY ALERT: Host header forgery	detected
</A></li>
	<LI>Next message (by thread): <A HREF="020767.html">[squid-users] network problems with squid ssl-bump
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20764">[ date ]</a>
              <a href="thread.html#20764">[ thread ]</a>
              <a href="subject.html#20764">[ subject ]</a>
              <a href="author.html#20764">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
