<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid time out
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20time%20out&In-Reply-To=%3C9b813ff3-23b3-c35a-8b40-403ee67053a5%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020768.html">
   <LINK REL="Next"  HREF="020778.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid time out</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20time%20out&In-Reply-To=%3C9b813ff3-23b3-c35a-8b40-403ee67053a5%40treenet.co.nz%3E"
       TITLE="[squid-users] squid time out">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Jul 18 14:59:13 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020768.html">[squid-users] squid time out
</A></li>
        <LI>Next message (by thread): <A HREF="020778.html">[squid-users] squid time out
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20769">[ date ]</a>
              <a href="thread.html#20769">[ thread ]</a>
              <a href="subject.html#20769">[ subject ]</a>
              <a href="author.html#20769">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 19/07/19 1:57 am, ANDRINANTENAINA Avo wrote:
&gt;<i> 
</I>&gt;<i> I have a huge range in terms of network, but awkwardly, the
</I>&gt;<i> authentication/ACL and everything works well in one given subnet but not
</I>&gt;<i> on the others. The users in the other subnets are not able to surf the
</I>&gt;<i> internet, and this without any specific logs from the proxy side ( the
</I>&gt;<i> most significant part of the config could be seen below). Any request
</I>&gt;<i> from these users just times out. &#160;____
</I>&gt;<i> 
</I>...

&gt;<i> __&#160;__
</I>&gt;<i> 
</I>&gt;<i> I can&#8217;t really understand the issue, from the affected networks:____
</I>&gt;<i> 
</I>&gt;<i> __-&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; __The user is able to ping the proxy and access its port
</I>&gt;<i> 8080 (through telnet / netcat) ____
</I>&gt;<i> 
</I>&gt;<i> __-&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; __The request is able to reach the proxy but the in the
</I>&gt;<i> access_log the /&#8220;user&#8221; /is missing ____
</I>&gt;<i> 
</I>&gt;<i> /1563455060.396&#160;&#160;&#160;&#160;&#160; 1 192.168.230.195 TCP_DENIED/407 4714 GET
</I>&gt;<i> <A HREF="http://api.bing.com/qsml.aspx?">http://api.bing.com/qsml.aspx?</A> - HIER_NONE/- text/html____/
</I>&gt;<i> 
</I>&gt;<i> __-&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; __TCP_DENIED/407, requesting the user to go through the
</I>&gt;<i> authentication phase is presented by the proxy to the user&#8217;s browser but
</I>&gt;<i> nothing happens. I thought that if the timer set to Kerberos, NTLM
</I>&gt;<i> expires, a pop up should appear but nothing (from wireshark)____
</I>&gt;<i> 
</I>
Er. Not sure what you mean by a timer.

The log entry is a reasonable first-request from any client. No sane
client will broadcast user credentials until it knows the receiving
agent needs them - and in what form they are needed.
 That is why your log entry has no username, and the purpose of the 407
status.

Once that 407 is delivered to the Browser that HTTP transaction is over.
If nothing happens afterwards that is a Browser or network layer
problem, nothing to do with Squid. (There are exceptions, but I see no
sign of those being relevant in your config).

Browser popup is what happens if the Browser is _unable_ to find
appropriate user credentials to send the proxy or web server needing
login. If it is able to find any Kerberors, NTLM or Basic auth
credentials to use (in that order of priority) - it will start a new
HTTP transaction using those. Which will be logged as a separate HTTP
transaction.
 But, if those credentials are not able to validate there may not be any
resulting username to log. Your wireshark trace shows no
Proxy-Authorization header in the request, so of course there will be no
username on that transactions log entry.


Setting the timeouts on credentials usability between the DC and the
Browsers will only cause credential tokens to become invalid before they
arrive at the proxy. That can lead to loops of transactions with 407 and
no username logged, especially with NTLM credentials.

Setting any of the auth related TTL or timeouts in squid.conf to short
values will only cause extra work for the auth validation process.
Slowing everything down. It has no effect on whether credentials are
valid, nor what the Browser does.

Despite the PR and marketing MS have done about single-sign-on being a
NTLM thing, it is actually a regular part of all HTTP authentication.
Seeing the popup is a *bad* sign, something is going wrong with the
Browsers auth setup if it has to be bothering the user for details.
 On Windows particularly the Browser should have access to the users
machine login or Kerberos keytab and so use one of those to access the
proxy without bothering or even being noticed by the user at all.

&gt;<i> 
</I>&gt;<i> -&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; On cache.log there is nothing that could mean something, just
</I>&gt;<i> a bunch of ARP error. Tried to debug the section 29 for authentication &#8230;
</I>&gt;<i> but nothing. Checked the IE internet options, just in case the windows
</I>&gt;<i> authentication profile is no ticked &#8230; but it is there.
</I>&gt;<i> 
</I>
ARP errors may be nothing, or it could be a sign that your routing needs
something fixed.
 A routing problem might be affecting background connectivity for NTLM
and Kerberos processes the Browser has to do to allocate auth tokens
with DC.
 It might also effect the proxy verifying those tokens, but that would
have a different more obvious error logged.


If the above does not help your troubleshooting, please consider posting
your whole squid.conf.  (Without the #comment lines, and obfuscate
anything like cachemgr_passwd which should not be made public - but in a
way which ensures we can still tell eg that two IPs are different numbers).

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020768.html">[squid-users] squid time out
</A></li>
	<LI>Next message (by thread): <A HREF="020778.html">[squid-users] squid time out
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20769">[ date ]</a>
              <a href="thread.html#20769">[ thread ]</a>
              <a href="subject.html#20769">[ subject ]</a>
              <a href="author.html#20769">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
