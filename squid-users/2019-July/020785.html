<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Possible to user reply_header_add directive with acl random access list ?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Possible%20to%20user%20reply_header_add%20directive%20with%0A%20acl%20random%20access%20list%20%3F&In-Reply-To=%3C09b4dbd7-817d-3762-5e1c-0f2709a9059a%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020783.html">
   <LINK REL="Next"  HREF="020786.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Possible to user reply_header_add directive with acl random access list ?</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Possible%20to%20user%20reply_header_add%20directive%20with%0A%20acl%20random%20access%20list%20%3F&In-Reply-To=%3C09b4dbd7-817d-3762-5e1c-0f2709a9059a%40measurement-factory.com%3E"
       TITLE="[squid-users] Possible to user reply_header_add directive with acl random access list ?">rousskov at measurement-factory.com
       </A><BR>
    <I>Fri Jul 19 20:03:28 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020783.html">[squid-users] Possible to user reply_header_add directive with acl random access list ?
</A></li>
        <LI>Next message (by thread): <A HREF="020786.html">[squid-users] Possible to user reply_header_add directive with acl random access list ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20785">[ date ]</a>
              <a href="thread.html#20785">[ thread ]</a>
              <a href="subject.html#20785">[ subject ]</a>
              <a href="author.html#20785">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 7/19/19 2:54 PM, --Ahmad-- wrote:

&gt;<i> say i have 10 ips 
</I>&gt;<i> i want random external over them .
</I>
&gt;<i> if external was ip1 , then &#8220;start header&#8221; should be A
</I>&gt;<i> if external was ip2 , then &#8220;start header&#8221; should be b
</I>&gt;<i> if external was ip3 , then &#8220;start header&#8221; should be c
</I>&gt;<i> if external was ip4 , then &#8220;start header&#8221; should be d
</I>
I can suggest two options. The first one is a little simpler, but it
uses actual IP addresses (e.g., &quot;1.1.1.1&quot;) instead of IP address
labels/pseudonyms (e.g. &quot;A&quot;) for Start header values:

  # select one of ten IPs using a uniform random distribution
  tcp_outgoing_address 12.13.200.10 p1in10
  tcp_outgoing_address 12.13.200.11 p1in9
  ...
  tcp_outgoing_address 12.13.200.19 all

  # tell the client what IP our to-server connection originated from
  reply_header_add Start &quot;%&lt;la&quot;


If you do not really want to send the actual IP values in Start headers,
and are not worried that Squid may not actually use the selected
outgoing IP address for some reason, then you can use annotations to
mark specific tcp_outgoing_address decisions:

  acl markDecisionA annotate_client decision=A
  acl markDecisionB annotate_client decision=B
  ...
  acl markDecisionJ annotate_client decision=J

  # select one of ten IPs using a uniform random distribution
  # and remember our decision as a transaction annotation
  tcp_outgoing_address 12.13.200.10 p1in10 markDecisionA
  tcp_outgoing_address 12.13.200.11 p1in9 markDecisionB
  ...
  tcp_outgoing_address 12.13.200.19 markDecisionJ

  # relay our tcp_outgoing_address decision to the client
  reply_header_add Start &quot;%note{decision}&quot;


HTH,

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020783.html">[squid-users] Possible to user reply_header_add directive with acl random access list ?
</A></li>
	<LI>Next message (by thread): <A HREF="020786.html">[squid-users] Possible to user reply_header_add directive with acl random access list ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20785">[ date ]</a>
              <a href="thread.html#20785">[ thread ]</a>
              <a href="subject.html#20785">[ subject ]</a>
              <a href="author.html#20785">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
