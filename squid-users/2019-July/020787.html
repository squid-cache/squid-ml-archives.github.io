<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] caching apt package lists/Raspbian
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20caching%20apt%20package%20lists/Raspbian&In-Reply-To=%3C1454313392.2447317.1563599951391%40mail.yahoo.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020784.html">
   <LINK REL="Next"  HREF="020789.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] caching apt package lists/Raspbian</H1>
    <B>TarotApprentice</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20caching%20apt%20package%20lists/Raspbian&In-Reply-To=%3C1454313392.2447317.1563599951391%40mail.yahoo.com%3E"
       TITLE="[squid-users] caching apt package lists/Raspbian">tarotapprentice at yahoo.com
       </A><BR>
    <I>Sat Jul 20 05:19:11 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020784.html">[squid-users] Ubuntu 18 LTS repository for Squid 4.8 (rebuilt with sslbump support from sources in Debian unstable)
</A></li>
        <LI>Next message (by thread): <A HREF="020789.html">[squid-users] caching apt package lists/Raspbian
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20787">[ date ]</a>
              <a href="thread.html#20787">[ thread ]</a>
              <a href="subject.html#20787">[ subject ]</a>
              <a href="author.html#20787">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Recently upgraded to Raspbian Buster and squid 4.6. Since then I am unable to cache the Packages.xz that apt uses. The various other Pis using this proxy all end up downloading the 30MB Packages.xz every time. Does anyone have any suggestions on how to get it to cache?

Cheers
MarkJ


squid -v
Squid Cache: Version 4.6
Service Name: squid
Raspbian linux


access.log

1563597855.786&#160;&#160;&#160; 605 192.168.1.73 TCP_REFRESH_UNMODIFIED/200 15306 GET <A HREF="http://raspbian.raspberrypi.org/raspbian/dists/buster/InRelease">http://raspbian.raspberrypi.org/raspbian/dists/buster/InRelease</A> - HIER_DIRECT/93.93.128.193 -

1563597855.811&#160;&#160;&#160; 620 192.168.1.73 TCP_REFRESH_UNMODIFIED/200 25429 GET <A HREF="http://archive.raspberrypi.org/debian/dists/buster/InRelease">http://archive.raspberrypi.org/debian/dists/buster/InRelease</A> - HIER_DIRECT/93.93.128.133 -

1563597857.486&#160;&#160;&#160; 620 192.168.1.73 TCP_REFRESH_UNMODIFIED/200 205801 GET <A HREF="http://archive.raspberrypi.org/debian/dists/buster/main/binary-armhf/Packages.gz">http://archive.raspberrypi.org/debian/dists/buster/main/binary-armhf/Packages.gz</A> - HIER_DIRECT/93.93.128.133 application/x-gzip

1563597936.436&#160; 80026 192.168.1.73 TCP_MISS_ABORTED/200 2641974 GET <A HREF="http://raspbian.raspberrypi.org/raspbian/dists/buster/main/binary-armhf/Packages.xz">http://raspbian.raspberrypi.org/raspbian/dists/buster/main/binary-armhf/Packages.xz</A> - HIER_DIRECT/93.93.128.193 application/x-xz


config file

acl localnet src 192.168.1.0/24 # internal network
acl localnet src fc00::/7&#160;&#160;&#160;&#160;&#160;&#160; # RFC 4193 local private network range
acl localnet src fe80::/10&#160;&#160;&#160;&#160;&#160; # RFC 4291 link-local (directly plugged) machines
acl l500-020b src 192.168.1.20
acl SSL_ports port 443
acl Safe_ports port 80&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # http
acl Safe_ports port 21&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # ftp
acl Safe_ports port 443&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # https
acl Safe_ports port 70&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # gopher
acl Safe_ports port 210&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # wais
acl Safe_ports port 1025-65535&#160; # unregistered ports
acl Safe_ports port 280&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # http-mgmt
acl Safe_ports port 488&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # gss-http
acl Safe_ports port 591&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # filemaker
acl Safe_ports port 777&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # multiling http
acl CONNECT method CONNECT
acl ads dstdomain .ad1.pamedia.com.au
acl ads dstdomain .ad3.pamedia.com.au
acl ads dstdomain .adevents.com.au
acl ads dstdomain .adinfinity.com.au
acl ads dstdomain .ads.excitehome.net.au
acl ads dstdomain .ads.fairfax.com.au
acl ads dstdomain .ads.godaddy.com
acl ads dstdomain .ads.google.com
acl ads dstdomain .ads.ninemsn.com.au
acl ads dstdomain .ads.optusnet.com.au
acl ads dstdomain .ads.property.com.au
acl ads dstdomain .ads.youtube.com
acl ads dstdomain .adserver.news.com.au
acl ads dstdomain .au.adserver.yahoo.com
acl ads dstdomain .doubleclick.net
acl ads dstdomain .googleadservices.com
acl ads dstdomain .zoomdirect.com.au
acl malware dstdomain am10.ru
acl malware dstdomain deepspacer.com
acl malware dstdomain trafficconverter.biz
acl malware dstdomain .eu.interia.pl
acl malware dstdomain .expo9.exponential.com
acl malware dstdomain .flashtalking.com
acl malware dstdomain .funad.co.kr
acl malware dstdomain .luckytime.co.kr
acl malware dstdomain .trafficholder.com
acl malware2 dst 96.43.128.194
acl hiddenwasp dst 103.206.122.245
acl hiddenwasp dst 103.206.123.13
acl hiddenwasp2 dstdomain <A HREF="http://103.206.123.13">http://103.206.123.13</A>
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access deny ads
http_access deny malware
http_access deny malware2
http_access deny hiddenwasp
http_access deny hiddenwasp2
http_access allow l500-020b manager
http_access deny manager
http_access allow localnet
http_access allow localhost
http_access deny all
http_port 3128
cache_mem 448 MB
maximum_object_size 320 MB
memory_replacement_policy lru
cache_replacement_policy heap LFUDA
cache_dir aufs /var/spool/squid 18432 32 256
quick_abort_min -1 KB
client_request_buffer_max_size 128 KB
coredump_dir /var/spool/squid
access_log /var/log/squid/access.log squid
cache_log /var/log/squid/cache.log
logfile_rotate 7
netdb_filename none
refresh_pattern (\.deb|\.udeb)$ 1440&#160;&#160;&#160; 80%&#160;&#160;&#160;&#160; 10080
refresh_pattern ^ftp:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 1440&#160;&#160;&#160; 20%&#160;&#160;&#160;&#160; 10080
refresh_pattern ^gopher:&#160;&#160;&#160;&#160;&#160;&#160;&#160; 1440&#160;&#160;&#160; 0%&#160;&#160;&#160;&#160;&#160; 1440
refresh_pattern -i (/cgi-bin/|\?) 0&#160;&#160;&#160;&#160; 0%&#160;&#160;&#160;&#160;&#160; 0
refresh_pattern .&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 0&#160;&#160;&#160;&#160;&#160;&#160; 20%&#160;&#160;&#160;&#160; 4320
host_verify_strict on
max_filedescriptors 1200
dns_v4_first on
pinger_enable off
shutdown_lifetime 5 seconds

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020784.html">[squid-users] Ubuntu 18 LTS repository for Squid 4.8 (rebuilt with sslbump support from sources in Debian unstable)
</A></li>
	<LI>Next message (by thread): <A HREF="020789.html">[squid-users] caching apt package lists/Raspbian
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20787">[ date ]</a>
              <a href="thread.html#20787">[ thread ]</a>
              <a href="subject.html#20787">[ subject ]</a>
              <a href="author.html#20787">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
