<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Unable to limit bandwidth (squid 4.7.2 )
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Unable%20to%20limit%20bandwidth%20%28squid%204.7.2%20%29&In-Reply-To=%3Cf5eeb87c-5455-2e2f-7f9e-94f827727f97%40urlfilterdb.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020825.html">
   <LINK REL="Next"  HREF="020818.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Unable to limit bandwidth (squid 4.7.2 )</H1>
    <B>Marcus Kool</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Unable%20to%20limit%20bandwidth%20%28squid%204.7.2%20%29&In-Reply-To=%3Cf5eeb87c-5455-2e2f-7f9e-94f827727f97%40urlfilterdb.com%3E"
       TITLE="[squid-users] Unable to limit bandwidth (squid 4.7.2 )">marcus.kool at urlfilterdb.com
       </A><BR>
    <I>Wed Jul 31 10:19:29 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020825.html">[squid-users] Unable to limit bandwidth (squid 4.7.2 )
</A></li>
        <LI>Next message (by thread): <A HREF="020818.html">[squid-users] dns_v4_first off for squid Squid Cache: Version 5.0.0-20190715-rd3527ec67
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20826">[ date ]</a>
              <a href="thread.html#20826">[ thread ]</a>
              <a href="subject.html#20826">[ subject ]</a>
              <a href="author.html#20826">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Linux you can use iptables to do qos and make sure that a single connection does not consume all bandwidth.

Marcus


On 30/07/2019 10:22, Service MV wrote:
&gt;<i> Just to explain clearly, my goal is that no user of my LAN can download more than 15 megabits/s, because some downloads consume me 100 magabits/s leaving the rest of the users offline.
</I>&gt;<i> Since squid calculates in bytes, it would be: 1966080 bytes the limit that I want to establish for any user of my LAN
</I>&gt;<i> Thank you very much for your help.
</I>&gt;<i>
</I>&gt;<i> El mar., 30 de jul. de 2019 a la(s) 09:57, Service MV (<A HREF="https://lists.squid-cache.org/listinfo/squid-users">service.mv at gmail.com</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">service.mv at gmail.com</A>&gt;) escribi&#243;:
</I>&gt;<i>
</I>&gt;<i>     Thanks for patience.
</I>&gt;<i>
</I>&gt;<i>     I modify the line:
</I>&gt;<i>     #&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; All net setting Individual client setting
</I>&gt;<i>     # &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; first 15MB of file download full speed, then continue at 10MB/s&#160; &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; first 10MB of file download full speed, then continue at 7MB/s
</I>&gt;<i>     delay_parameters 1&#160;&#160;&#160;&#160;&#160; 1310720/1966080 917504/1310720
</I>&gt;<i>
</I>&gt;<i>     In this way I can make the Delay Pool work.
</I>&gt;<i>     But I'm still not sure if I'm using my symmetrical 100Mb/s bandwidth correctly.
</I>&gt;<i>
</I>&gt;<i>     Any comments on that?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>     El lun., 29 de jul. de 2019 a la(s) 16:58, Service MV (<A HREF="https://lists.squid-cache.org/listinfo/squid-users">service.mv at gmail.com</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">service.mv at gmail.com</A>&gt;) escribi&#243;:
</I>&gt;<i>
</I>&gt;<i>         Hello everyone!
</I>&gt;<i>         I have a 100/100 Mbit/s internet link and I am trying unsuccessfully to limit downloads to a maximum of 15Mb/s of any IP on my network. Some downloads consume the entire link.
</I>&gt;<i>         I copy my settings to help me see where I'm going wrong. Thank you very much!
</I>&gt;<i>         Gabriel
</I>&gt;<i>
</I>&gt;<i>         PS.: squid -v '--enable-delay-pools'
</I>&gt;<i>
</I>&gt;<i>         #
</I>&gt;<i>         # Recommended minimum configuration:
</I>&gt;<i>         #
</I>&gt;<i>
</I>&gt;<i>         # Example rule allowing access from your local networks.
</I>&gt;<i>         # Adapt to list your (internal) IP networks from where browsing
</I>&gt;<i>         # should be allowed
</I>&gt;<i>         #acl localnet src 0.0.0.1-0.255.255.255 # RFC 1122 &quot;this&quot; network (LAN)
</I>&gt;<i>         acl localnet src 10.10.8.0/22 &lt;<A HREF="http://10.10.8.0/22">http://10.10.8.0/22</A>&gt; # (My LAN)
</I>&gt;<i>         #acl largefiledown src 10.10.8.0/22 &lt;<A HREF="http://10.10.8.0/22">http://10.10.8.0/22</A>&gt; # Limitar bajada y subida a 10Mbps
</I>&gt;<i>         #acl localnet src 10.0.0.0/8 &lt;<A HREF="http://10.0.0.0/8">http://10.0.0.0/8</A>&gt; # RFC 1918 local private network (LAN)
</I>&gt;<i>         #acl localnet src 100.64.0.0/10 &lt;<A HREF="http://100.64.0.0/10">http://100.64.0.0/10</A>&gt; # RFC 6598 shared address space (CGN)
</I>&gt;<i>         #acl localnet src 169.254.0.0/16 &lt;<A HREF="http://169.254.0.0/16">http://169.254.0.0/16</A>&gt; # RFC 3927 link-local (directly plugged) machines
</I>&gt;<i>         #acl localnet src 172.16.0.0/12 &lt;<A HREF="http://172.16.0.0/12">http://172.16.0.0/12</A>&gt; # RFC 1918 local private network (LAN)
</I>&gt;<i>         #acl localnet src 192.168.0.0/16 &lt;<A HREF="http://192.168.0.0/16">http://192.168.0.0/16</A>&gt; # RFC 1918 local private network (LAN)
</I>&gt;<i>         #acl localnet src fc00::/7 &#160; &#160; &#160; # RFC 4193 local private network range
</I>&gt;<i>         #acl localnet src fe80::/10 &#160; &#160; &#160; # RFC 4291 link-local (directly plugged) machines
</I>&gt;<i>
</I>&gt;<i>         acl SSL_ports port 443
</I>&gt;<i>         acl Safe_ports port 80 # http
</I>&gt;<i>         acl Safe_ports port 21 # ftp
</I>&gt;<i>         acl Safe_ports port 443 # https
</I>&gt;<i>         acl Safe_ports port 70 # gopher
</I>&gt;<i>         acl Safe_ports port 210 # wais
</I>&gt;<i>         acl Safe_ports port 1025-65535 # unregistered ports
</I>&gt;<i>         acl Safe_ports port 280 # http-mgmt
</I>&gt;<i>         acl Safe_ports port 488 # gss-http
</I>&gt;<i>         acl Safe_ports port 591 # filemaker
</I>&gt;<i>         acl Safe_ports port 777 # multiling http
</I>&gt;<i>         acl CONNECT method CONNECT
</I>&gt;<i>
</I>&gt;<i>         acl LS_whitedomains dstdomain &quot;/etc/squid/acl/whitedomains.txt&quot;
</I>&gt;<i>         acl LS_blackdomains dstdomain &quot;/etc/squid/acl/blackdomains.txt&quot;
</I>&gt;<i>         acl LS_malicius dstdomain &quot;/etc/squid/acl/malicius.txt&quot;
</I>&gt;<i>         acl LS_ads-tracking dstdomain &quot;/etc/squid/acl/ads-tracking.txt&quot;
</I>&gt;<i>
</I>&gt;<i>         #
</I>&gt;<i>         # Recommended minimum Access Permission configuration:
</I>&gt;<i>         #
</I>&gt;<i>         # Deny requests to certain unsafe ports
</I>&gt;<i>         http_access deny !Safe_ports
</I>&gt;<i>
</I>&gt;<i>         # Deny CONNECT to other than secure SSL ports
</I>&gt;<i>         http_access deny CONNECT !SSL_ports
</I>&gt;<i>
</I>&gt;<i>         # Only allow cachemgr access from localhost
</I>&gt;<i>         http_access allow localhost manager
</I>&gt;<i>         http_access deny manager
</I>&gt;<i>
</I>&gt;<i>         # We strongly recommend the following be uncommented to protect innocent
</I>&gt;<i>         # web applications running on the proxy server who think the only
</I>&gt;<i>         # one who can access services on &quot;localhost&quot; is a local user
</I>&gt;<i>         #http_access deny to_localhost
</I>&gt;<i>
</I>&gt;<i>         #
</I>&gt;<i>         # INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
</I>&gt;<i>         #
</I>&gt;<i>
</I>&gt;<i>         delay_pools 1
</I>&gt;<i>         delay_class 1 2
</I>&gt;<i>         delay_parameters 1 103809024/103809024 15728640/15728640 # (98/98 megabytes in bytes and 15/15 megabytes in bytes)
</I>&gt;<i>         delay_access 1 allow localnet
</I>&gt;<i>
</I>&gt;<i>         http_access deny LS_blackdomains
</I>&gt;<i>         http_access allow LS_whitedomains
</I>&gt;<i>         http_access deny LS_malicius
</I>&gt;<i>         http_access deny LS_ads-tracking
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>         # Example rule allowing access from your local networks.
</I>&gt;<i>         # Adapt localnet in the ACL section to list your (internal) IP networks
</I>&gt;<i>         # from where browsing should be allowed
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>         http_access allow localnet
</I>&gt;<i>         http_access allow localhost
</I>&gt;<i>
</I>&gt;<i>         # And finally deny all other access to this proxy
</I>&gt;<i>         http_access deny all
</I>&gt;<i>
</I>&gt;<i>         # Squid normally listens to port 3128
</I>&gt;<i>         http_port 3128
</I>&gt;<i>
</I>&gt;<i>         # Uncomment and adjust the following to add a disk cache directory.
</I>&gt;<i>         #cache_dir ufs /var/spool/squid 100 16 256
</I>&gt;<i>
</I>&gt;<i>         # Leave coredumps in the first cache dir
</I>&gt;<i>         coredump_dir /var/spool/squid
</I>&gt;<i>
</I>&gt;<i>         #
</I>&gt;<i>         # Add any of your own refresh_pattern entries above these.
</I>&gt;<i>         #
</I>&gt;<i>         refresh_pattern ^ftp: 1440 20% 10080
</I>&gt;<i>         refresh_pattern ^gopher: 1440 0% 1440
</I>&gt;<i>         refresh_pattern -i (/cgi-bin/|\?) 0 0% 0
</I>&gt;<i>         refresh_pattern . 0 20% 4320
</I>&gt;<i>
</I>&gt;<i>         # Other settings
</I>&gt;<i>         quick_abort_min 0 KB
</I>&gt;<i>         quick_abort_max 0 KB
</I>&gt;<i>         read_timeout 5 minutes
</I>&gt;<i>         request_timeout 3 minutes
</I>&gt;<i>         shutdown_lifetime 0 seconds
</I>&gt;<i>         ipcache_size 2048
</I>&gt;<i>         fqdncache_size 4096
</I>&gt;<i>         forwarded_for off
</I>&gt;<i>         visible_hostname s-px02
</I>&gt;<i>         httpd_suppress_version_string on
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20190731/48263dcf/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20190731/48263dcf/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020825.html">[squid-users] Unable to limit bandwidth (squid 4.7.2 )
</A></li>
	<LI>Next message (by thread): <A HREF="020818.html">[squid-users] dns_v4_first off for squid Squid Cache: Version 5.0.0-20190715-rd3527ec67
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20826">[ date ]</a>
              <a href="thread.html#20826">[ thread ]</a>
              <a href="subject.html#20826">[ subject ]</a>
              <a href="author.html#20826">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
