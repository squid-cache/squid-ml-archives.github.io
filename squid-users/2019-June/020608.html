<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] parameter forward_max_retries
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20parameter%20forward_max_retries&In-Reply-To=%3Ccd7f887f-0f76-b567-2075-ed8ed60c1951%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020607.html">
   <LINK REL="Next"  HREF="020612.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] parameter forward_max_retries</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20parameter%20forward_max_retries&In-Reply-To=%3Ccd7f887f-0f76-b567-2075-ed8ed60c1951%40treenet.co.nz%3E"
       TITLE="[squid-users] parameter forward_max_retries">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon Jun  3 11:05:15 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020607.html">[squid-users] parameter forward_max_retries
</A></li>
        <LI>Next message (by thread): <A HREF="020612.html">[squid-users] parameter forward_max_retries
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20608">[ date ]</a>
              <a href="thread.html#20608">[ thread ]</a>
              <a href="subject.html#20608">[ subject ]</a>
              <a href="author.html#20608">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 3/06/19 9:20 pm, Niu, Steven (NSB - CN/Qingdao) wrote:
&gt;<i> Hello,  
</I>&gt;<i> 
</I>&gt;<i> I'm sorry for any bother to you. But we are evaluating our solutions and need author's confirmation about the parameter forward_max_retries. 
</I>

Then you had best contact the author. This is a mailing list for *users*
of Squid to discuss and learn about the software from each other, and
from those developers like myself who participate here.

AFAIK neither the developer who designed the feature, nor the developer
who re-designed it to operate differently participate in this mailing list.


&gt;<i> Could you give me a yes or no if you have clear answer? I appreciate you response very much! Thank you!
</I>&gt;<i> 
</I>&gt;<i> If the configuration parameter of forward_max_retries is 3, for the following cases, is the assumption true or false? 
</I>&gt;<i> Case 1:  FQDN has 4 IPs from DNS result: ip1, ip2, ip3, ip4. 
</I>&gt;<i> 	If ip1, ip2, ip3 are failed, Squid would not try ip4 since forward_max_retries is 3. 
</I>&gt;<i> Case 2:  FQDN has 2 IPs from DNS result: ip1, ip2. 
</I>&gt;<i> 	If ip1, ip2 are failed, Squid would give final response since no more IP can try. 
</I>&gt;<i> 
</I>
The answer depends on which version of Squid you are using, what those
IPs are, what type of HTTP message is being attempted, and how long the
process is taking.


In regards to Squid version:

* The initial design used (n_tries &gt; forward_max_tries). Squid up to
v4.0 use this.

* The redesigned code uses (n_tries &gt;= forward_max_tries). Squid v4 and
later use this.

=&gt; Both versions prevent destinations being contacted when their
expression produces the &quot;true&quot; boolean result.


In regards to IPs:

* Squid which are built with IPv6 disabled completely ignore IPv6
results from DNS. They are not considered in the retries list.

* If the failure occurs at the TCP connect(2) level, then Squid-3.1 and
older do not count these as tries and will attempt all IPs
forward_max_tries times. Squid-3.2 and later will count them as tries.


Please also be aware that many popular websites have dozens of IPs in
their DNS responses. Setting forward_max_tries less than 20 can result
in these very popular websites not being contactable.


In regards to HTTP message type:

* HTTP standards specify some request methods as non-idempotent.
Retrying these requests is forbidden.

* HTTP standards define some response status codes as final and fatal.
These cannot ever be retried by an intermediary.

* HTTP transactions which involve certain stateful application layer
features which break HTTP requirements about statelessness cannot be
retried.
 ==&gt; These features impact retry behaviour of the TCP connection itself.
So the non-retry outcome can be inherited from some past HTTP
transaction(s) activity.

* Any HTTP request with a payload that has begun delivery cannot be retried.

* Any HTTP response which began but did not completely arrive cannot be
retried.


In regards to timing:

* timeouts for TCP connect action, TCP lifetimes, HTTP forwarding, and
I/O actions can terminate any given tries early and cause later ones to
not happen.

* TCP error handling is subject to ICMP (both v4 and v6) being enabled
and working on your network and on *every* network between your proxy
and the origin serves (both outbound and inbound routes).
 -&gt; without ICMP the TCP errors result in 'hung' connections which
usually hit timeout errors before the forwarding re-tries succeed.


Overall;

  Squid always give a final response when that final response is known.
Where that response comes from is far more complicated than your stated
cases consider.


Have you tried testing for yourself the particular sites you are worried
about?

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020607.html">[squid-users] parameter forward_max_retries
</A></li>
	<LI>Next message (by thread): <A HREF="020612.html">[squid-users] parameter forward_max_retries
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20608">[ date ]</a>
              <a href="thread.html#20608">[ thread ]</a>
              <a href="subject.html#20608">[ subject ]</a>
              <a href="author.html#20608">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
