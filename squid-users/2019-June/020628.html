<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Questions about connection pooling to origins when using squid as a HTTPS forward egress proxy
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Questions%20about%20connection%20pooling%20to%20origins%0A%20when%20using%20squid%20as%20a%20HTTPS%20forward%20egress%20proxy&In-Reply-To=%3C4ec949f2-2794-5f9a-40ee-d7d182b73316%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020626.html">
   <LINK REL="Next"  HREF="020629.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Questions about connection pooling to origins when using squid as a HTTPS forward egress proxy</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Questions%20about%20connection%20pooling%20to%20origins%0A%20when%20using%20squid%20as%20a%20HTTPS%20forward%20egress%20proxy&In-Reply-To=%3C4ec949f2-2794-5f9a-40ee-d7d182b73316%40measurement-factory.com%3E"
       TITLE="[squid-users] Questions about connection pooling to origins when using squid as a HTTPS forward egress proxy">rousskov at measurement-factory.com
       </A><BR>
    <I>Fri Jun  7 16:04:02 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020626.html">[squid-users] Questions about connection pooling to origins when using squid as a HTTPS forward egress proxy
</A></li>
        <LI>Next message (by thread): <A HREF="020629.html">[squid-users] Questions about connection pooling to origins when using squid as a HTTPS forward egress proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20628">[ date ]</a>
              <a href="thread.html#20628">[ thread ]</a>
              <a href="subject.html#20628">[ subject ]</a>
              <a href="author.html#20628">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 6/7/19 5:24 AM, Srikanth Raju wrote:
&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     &gt;&#160; &#160;* The biggest reason we care about TLS termination with bump is
</I>&gt;<i>     &gt;&#160; &#160; &#160;because we think it might give us performance benefits along some
</I>&gt;<i>     &gt;&#160; &#160; &#160;critical code paths *due to connection pooling to some slow
</I>&gt;<i>     &gt;&#160; &#160; &#160;upstreams within squid.*
</I>&gt;<i>     &gt;&#160; &#160;* Does squid automatically do this or does it need some extra
</I>&gt;<i>     config.
</I>&gt;<i>     &gt;&#160; &#160; &#160;I was looking at 'server_connections' config var.
</I>&gt;<i> 
</I>&gt;<i>     HTTPS connections cannot be pooled due to protocol ties at the transport
</I>&gt;<i>     level between clients and servers. Once details of the TLS handshake are
</I>&gt;<i>     delivered they are pinned together.
</I>&gt;<i> 
</I>&gt;<i> Well, what I meant was, that if we use &quot;bump&quot; directive, it is
</I>&gt;<i> effectively terminating the&#160; TLS connection from client at squid.
</I>
If you bump at step 1 (a.k.a. client-first bumping), then yes, TLS
connections to server can be pooled. I do not know whether Squid
supports that today, but there is no fundamental reason why it cannot.
Unfortunately, in most cases, you cannot successfully bump at step 1.

If you bump at step 2+, then the resulting client-Squid and Squid-server
connection pairs are based on the client handshake. Yes, Squid
establishes its own TLS connection to the origin server, but it does so
while mimicking TLS client properties. Reusing that server connection
for another client would be risky -- the second client can request some
TLS security features that the first client did not care about, and
Squid would have to essentially ignore the second client requirements
when talking to the origin server using a reused to-server connection
established on behalf of the first TLS client. It would be possible to
add an option that enables such risky reuse AFAICT, but that reuse
should not be done by default.


&gt;<i> And
</I>&gt;<i> then squid initiates a separate TLS connection to the server. with it's
</I>&gt;<i> own shared secret. Those connections to the servers/backends can be
</I>&gt;<i> pooled. This means there's a decryption/reencryption step in between. Is
</I>&gt;<i> not that what happens with squid?
</I>
Yes, it is, but pooling is disabled (i.e. the to-server connection is
&quot;pinned&quot; to the from-client connection) due to security concerns
discussed above.

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020626.html">[squid-users] Questions about connection pooling to origins when using squid as a HTTPS forward egress proxy
</A></li>
	<LI>Next message (by thread): <A HREF="020629.html">[squid-users] Questions about connection pooling to origins when using squid as a HTTPS forward egress proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20628">[ date ]</a>
              <a href="thread.html#20628">[ thread ]</a>
              <a href="subject.html#20628">[ subject ]</a>
              <a href="author.html#20628">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
