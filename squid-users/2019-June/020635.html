<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Empty ACL technical risks
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Empty%20ACL%20technical%20risks&In-Reply-To=%3C6201441560515265%40myt2-dc4bba9bb23c.qloud-c.yandex.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020634.html">
   <LINK REL="Next"  HREF="020636.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Empty ACL technical risks</H1>
    <B>Nikita Seregin</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Empty%20ACL%20technical%20risks&In-Reply-To=%3C6201441560515265%40myt2-dc4bba9bb23c.qloud-c.yandex.net%3E"
       TITLE="[squid-users] Empty ACL technical risks">nick.srg at yandex.ru
       </A><BR>
    <I>Fri Jun 14 12:27:45 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020634.html">[squid-users] Empty ACL technical risks
</A></li>
        <LI>Next message (by thread): <A HREF="020636.html">[squid-users] Useragent request/reply headers with squid .
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20635">[ date ]</a>
              <a href="thread.html#20635">[ thread ]</a>
              <a href="subject.html#20635">[ subject ]</a>
              <a href="author.html#20635">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi again.

Thank you for the answer.

So, as i understood, the empty acl files isn't the best option.


And may i include config files, which sometimes can become empty?


For example:

I put into /etc/squid/squid.conf next string:

       include /etc/squid/certificates.conf

And in the /etc/squid/certificates.conf i put:
       acl TRUSTED_FINGERPRINTS server_cert_fingerprint 7A:29:27:9A:DF:C4:4E:18:4D:94:E1:BB:2A:D9:09:3A:70:B1:AB:16
       acl TRUSTED_FINGERPRINTS server_cert_fingerprint 70:B1:AB:16:7A:29:27:9A:DF:C4:4E:18:4D:94:E1:BB:2A:D9:09:3A
       sslproxy_cert_sign signTrusted TRUSTED_FINGERPRINTS

Will it be OK, if i will just clear the /etc/squid/certificates.conf file in case if i don't have any fingerprints to put in, and keep the include /etc/squid/certificates.conf directive in squid.conf untouched? So in fact it will include the empty file.
Are there any technical risks?


12.06.2019, 08:58, &quot;Amos Jeffries&quot; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;:
&gt;<i> On 11/06/19 11:36 pm, &#1053;&#1080;&#1082;&#1080;&#1090;&#1072; &#1057;&#1077;&#1088;&#1105;&#1075;&#1080;&#1085; wrote:
</I>&gt;&gt;<i> &#160;Hi All,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &#160;If there is an empty acl in squid.conf, squid gives us warning message during restart/reconfigure.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &#160;We wonder if these warnings are just notifications for administrator, or there are some really technical risks.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &#160;Like here for example: <A HREF="https://bugs.launchpad.net/ubuntu/+source/squid-deb-proxy/+bug/1659567">https://bugs.launchpad.net/ubuntu/+source/squid-deb-proxy/+bug/1659567</A>
</I>&gt;&gt;<i> &#160;Amos Jeffries wrote: &quot;The check is a generic validity check used for all ACLs. Whether it is 'harmless' depends on future events at the time of checking. So just silencing or ignoring would leave a lot of nasty misconfigurations quietly accepted&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &#160;Could these &quot;nasty misconfigurations&quot; be made only by administrator, or is it about squid possible wrong behavior?
</I>&gt;<i>
</I>&gt;<i> The Ubuntu bug report you referenced is a good example why. The file
</I>&gt;<i> which is initially empty is explicitly being added to by non-admin
</I>&gt;<i> entities. Who then have an automated action to trigger reconfigure of
</I>&gt;<i> the running proxy.
</I>&gt;<i>
</I>&gt;<i> The risk there is that those entities are not necessarily knowing what
</I>&gt;<i> valid ACL data is. Nor in a position to fix the resulting DoS if they
</I>&gt;<i> get it wrong and make Squid exit on the reconfigure.
</I>&gt;<i> &#160;That breaking reconfigure may be a long time after the config change
</I>&gt;<i> was made.
</I>&gt;<i>
</I>&gt;&gt;<i> &#160;Are there any strong technical reasons to avoid using of empty ACLs in production environment?
</I>&gt;<i>
</I>&gt;<i> The main reason is that risk of DoS-ing the proxy and everyone using it
</I>&gt;<i> for an indeterminate amount of time until the admin can be summoned and
</I>&gt;<i> track down why the proxy is not running.
</I>&gt;<i>
</I>&gt;<i> Another reason is every transaction handled by Squid has to spend CPU
</I>&gt;<i> cycles setting up access checklists, fetching the data to be tested,
</I>&gt;<i> then calling the processing code - even if the ACL is empty and thus
</I>&gt;<i> immediately returns its DUNNO result.
</I>&gt;<i>
</I>&gt;<i> Which brings us to DUNNO being the third match state. So things like:
</I>&gt;<i>
</I>&gt;<i> &#160;acl foo src &quot;/some/empty.file&quot;
</I>&gt;<i> &#160;http_access allow foo
</I>&gt;<i> &#160;http_access allow !foo
</I>&gt;<i>
</I>&gt;<i> ... results in the surprise *access denied*.
</I>&gt;<i>
</I>&gt;&gt;<i> &#160;And are there any news about explicit flag to indicate whether an ACL is allowed to be empty or not?
</I>&gt;<i>
</I>&gt;<i> Nobody has submitted anything towards one.
</I>&gt;<i>
</I>&gt;<i> As you noted at the start it is a *warning* message. Squid should
</I>&gt;<i> continue to run &quot;fine&quot;. Provided your definition of &quot;fine&quot; accounts for
</I>&gt;<i> the above technical issues and odd behaviour.
</I>&gt;<i>
</I>&gt;<i> Cheers,
</I>&gt;<i> Amos
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020634.html">[squid-users] Empty ACL technical risks
</A></li>
	<LI>Next message (by thread): <A HREF="020636.html">[squid-users] Useragent request/reply headers with squid .
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20635">[ date ]</a>
              <a href="thread.html#20635">[ thread ]</a>
              <a href="subject.html#20635">[ subject ]</a>
              <a href="author.html#20635">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
