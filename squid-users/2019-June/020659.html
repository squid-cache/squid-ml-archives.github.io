<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Log resolved IP somehow?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Log%20resolved%20IP%20somehow%3F&In-Reply-To=%3C26d4338c-bf70-f9c6-6214-c19c6f94e297%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020654.html">
   <LINK REL="Next"  HREF="020656.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Log resolved IP somehow?</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Log%20resolved%20IP%20somehow%3F&In-Reply-To=%3C26d4338c-bf70-f9c6-6214-c19c6f94e297%40measurement-factory.com%3E"
       TITLE="[squid-users] Log resolved IP somehow?">rousskov at measurement-factory.com
       </A><BR>
    <I>Thu Jun 20 21:07:36 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020654.html">[squid-users] [ext] Re:  Log resolved IP somehow?
</A></li>
        <LI>Next message (by thread): <A HREF="020656.html">[squid-users] Squid4 forward proxy to upgrade from ws to wss
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20659">[ date ]</a>
              <a href="thread.html#20659">[ thread ]</a>
              <a href="subject.html#20659">[ subject ]</a>
              <a href="author.html#20659">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 6/18/19 7:37 AM, Ralf Hildebrandt wrote:

&gt;<i> Mon Jun 17 07:28:47 2019     36 10.39.68.232 TCP_DENIED/302 390 CONNECT trx.adscale.de:443 - HIER_NONE/- text/html accessRule=ensiloip -
</I>
&gt;<i> Now I tried find out why  trx.adscale.de is being denied. I'm using squid-5 with annotate_transaction:
</I>
&gt;<i> acl markensiloip annotate_transaction accessRule=ensiloip
</I>&gt;<i> acl ensiloip dst &quot;/etc/squid5/manual-ensilo-ipblocklist.acl&quot;
</I>&gt;<i> http_access deny ensiloip markensiloip
</I>

&gt;<i> So I *DO* know that /etc/squid5/manual-ensilo-ipblocklist.acl must be
</I>&gt;<i> the reason for the refusal
</I>
&gt;<i> How can I log the IP &quot;trx.adscale.de&quot; resolved to when the rejection happened?
</I>
You can annotate each rule in /etc/squid5/manual-ensilo-ipblocklist.acl
in addition to annotating their cumulative result. This is not a direct
answer to your question, but the trick works well for some ACL lists.

Alternatively, one could enhance Squid to optionally record (and later
log) which resolved address was used by &quot;dst&quot; and similar DNS-related
ACLs. This will require some non-trivial work, including getting the
configuration design right, but I think that &quot;label the address used by
this ACL as address Foo&quot; and &quot;log previously labeled address Foo&quot; could
be generally useful features.


HTH,

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020654.html">[squid-users] [ext] Re:  Log resolved IP somehow?
</A></li>
	<LI>Next message (by thread): <A HREF="020656.html">[squid-users] Squid4 forward proxy to upgrade from ws to wss
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20659">[ date ]</a>
              <a href="thread.html#20659">[ thread ]</a>
              <a href="subject.html#20659">[ subject ]</a>
              <a href="author.html#20659">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
