<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Help with transparent whitelisting proxy on Squid 4.4
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Help%20with%20transparent%20whitelisting%20proxy%20on%20Squid%0A%204.4&In-Reply-To=%3C13662bfa-c96d-3419-37f4-f030107ca3c3%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020672.html">
   <LINK REL="Next"  HREF="020676.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Help with transparent whitelisting proxy on Squid 4.4</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Help%20with%20transparent%20whitelisting%20proxy%20on%20Squid%0A%204.4&In-Reply-To=%3C13662bfa-c96d-3419-37f4-f030107ca3c3%40treenet.co.nz%3E"
       TITLE="[squid-users] Help with transparent whitelisting proxy on Squid 4.4">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Jun 26 11:28:36 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020672.html">[squid-users] Help with transparent whitelisting proxy on Squid	4.4
</A></li>
        <LI>Next message (by thread): <A HREF="020676.html">[squid-users] Help with transparent whitelisting proxy on Squid	4.4
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20673">[ date ]</a>
              <a href="thread.html#20673">[ thread ]</a>
              <a href="subject.html#20673">[ subject ]</a>
              <a href="author.html#20673">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 26/06/19 2:45 pm, Jared Fox wrote:&gt;
&gt;<i> == Bad news / Major Blocker ==
</I>&gt;<i> https connections to cloud tracing is still being blocked, these are
</I>&gt;<i> TLS 1.2 and uses SNI as seen via tcpdump.
</I>&gt;<i>
</I>Okay, now that you have the v4 capabilities:

* Please add %ssl::bump_mode to your log so we can see easily which
SSL-Bump step each transaction is representing. The
&quot;cloudtrace.googleapis.com&quot; ones all say 200 (success) so it is not
clear whether that is a successful peek, or successful terminate action.


Please be aware that in your config the ssl::server_name ACL is *not*
matching the SNI in your config.
- Your ssl_bump rules say &quot;peek all&quot; - so peek happens on the two Hello
messages. When the serverHello has been peek'd the real server name is
available from the servers own certificate.

 So that server cert name is what the ssl_server_name matches against
when checking the &quot;splice domainIsWhitelisted&quot; rule.

 The dozens of servers at cloudtrace.googleapis.com call themselves
&quot;edgecert.googleapis.com&quot; and have a long list of sub-domains for
googleapis.com.

 ==&gt; I suggest changing domainIsWhitelisted to match just the
&quot;.googleapis.com&quot; part of the domain.


Alternatively you can add the new &quot;--client-requested&quot; flag to the ACL,
which will force it to use the SNI even after more reliable info is
available. Like so:
  acl domainIsWhitelisted ssl::server_name \
     --client-requested cloudtrace.googleapis.com


If those do not work, then someone will need to dig down into the
cache.log debug trace of what the ssl_bump ACLs are matching against.


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020672.html">[squid-users] Help with transparent whitelisting proxy on Squid	4.4
</A></li>
	<LI>Next message (by thread): <A HREF="020676.html">[squid-users] Help with transparent whitelisting proxy on Squid	4.4
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20673">[ date ]</a>
              <a href="thread.html#20673">[ thread ]</a>
              <a href="subject.html#20673">[ subject ]</a>
              <a href="author.html#20673">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
