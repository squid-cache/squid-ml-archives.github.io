<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] SQUID_ERR_SSL_HANDSHAKE
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SQUID_ERR_SSL_HANDSHAKE&In-Reply-To=%3C2607d2aa-b73a-71fd-629f-9d42e71dd76d%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020682.html">
   <LINK REL="Next"  HREF="020684.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] SQUID_ERR_SSL_HANDSHAKE</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SQUID_ERR_SSL_HANDSHAKE&In-Reply-To=%3C2607d2aa-b73a-71fd-629f-9d42e71dd76d%40treenet.co.nz%3E"
       TITLE="[squid-users] SQUID_ERR_SSL_HANDSHAKE">squid3 at treenet.co.nz
       </A><BR>
    <I>Sat Jun 29 08:17:11 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020682.html">[squid-users] SQUID_ERR_SSL_HANDSHAKE
</A></li>
        <LI>Next message (by thread): <A HREF="020684.html">[squid-users] SQUID_ERR_SSL_HANDSHAKE
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20683">[ date ]</a>
              <a href="thread.html#20683">[ thread ]</a>
              <a href="subject.html#20683">[ subject ]</a>
              <a href="author.html#20683">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 29/06/19 3:03 am, Walter H. wrote:
&gt;<i>
</I>&gt;<i> sslproxy_cipher
</I>&gt;<i> EECDH+ECDSA+AESGCM:EECDH+aRSA+AESGCM:EECDH+ECDSA:EECDH:EDH+AESGCM:EDH:ECDH+AESGCM:ECDH+AES:ECDH:AES:HIGH:MEDIUM:!SSLv2:+SSLv3:!3DES:!RC4:!MD5:!IDEA:!SEED:!aNULL:!eNULL:!LOW:!EXP:!DSS:!PSK:!RSA:!SRP
</I>&gt;<i> sslproxy_options NO_SSLv2 NO_SSLv3 TLSv1 TLSv1_1 TLSv1_2
</I>&gt;<i> 
</I>
I do not see the tls-dh setting necessary for the elliptic curves to
work in your displayed config. So that would make the above cipher
directive essentially disable everything except SSLv3 with MEDIUM/HIGH
level non-RSA ciphers.

The value of sslproxy_options directive is colon (:) or comma (,)
delimited. When multiple values like the above are configured only the
first in the list is used. Which forces only TLS/1.2

It is not clear what OpenSSL will do when those conflicting options are
handed to it. But it looks like it is down-grading to SSLv3 as L.P.H.
said then breaking when something else arrives back.



I would start by removing the sslproxy_cipher directive entirely and
fixing sslproxy_options to be:

 sslproxy_options NO_SSLv2:NO_SSLv3

then re-adding the cipher *restrictions* (the ones with '!' prefix)
gradually to see what you actually need and where the problem starts.
You should not need the additions as secure ciphers are always enabled
by default.

If you can watch the TLS negotiations with wireshark as you experiment
it can help understand which options actually do anything. There are
overlaps like &quot;!LOW&quot; should be including the removals that &quot;!RC4&quot; does
and such overlaps.


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020682.html">[squid-users] SQUID_ERR_SSL_HANDSHAKE
</A></li>
	<LI>Next message (by thread): <A HREF="020684.html">[squid-users] SQUID_ERR_SSL_HANDSHAKE
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20683">[ date ]</a>
              <a href="thread.html#20683">[ thread ]</a>
              <a href="subject.html#20683">[ subject ]</a>
              <a href="author.html#20683">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
