<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] SslBump Not working for transparent proxy
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SslBump%20Not%20working%20for%20transparent%20proxy&In-Reply-To=%3CCAEjE5erqL-x%3DNFhJBG_LyeZRDsbHO9Uxa4ufhTRfZrS__g%3DwiQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020336.html">
   <LINK REL="Next"  HREF="020293.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] SslBump Not working for transparent proxy</H1>
    <B>Joseph Jones</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SslBump%20Not%20working%20for%20transparent%20proxy&In-Reply-To=%3CCAEjE5erqL-x%3DNFhJBG_LyeZRDsbHO9Uxa4ufhTRfZrS__g%3DwiQ%40mail.gmail.com%3E"
       TITLE="[squid-users] SslBump Not working for transparent proxy">the.tuxster at gmail.com
       </A><BR>
    <I>Fri Mar  1 13:33:03 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020336.html">[squid-users] Squid and url modifying
</A></li>
        <LI>Next message (by thread): <A HREF="020293.html">[squid-users] Sslbump Not working for transparent proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20285">[ date ]</a>
              <a href="thread.html#20285">[ thread ]</a>
              <a href="subject.html#20285">[ subject ]</a>
              <a href="author.html#20285">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I've been trying to get SslBump work for whitelist purposes and so far have
been failing.

It's my understanding in order for SslBump to do whitelist it will need to
do a splice at step2 or step3.

Looking at my logs I see step1 matching but I never see step2. I believe
it's because of what I found in the docs.

&gt;<i> Rules with actions that are impossible at the current step are ignored.
</I>
What I believe I'm failing to understand is the the order SslBump steps are
happening and when I can actually use the whitelist acl to compare to the
SNI provided.

watching the logs I see the http_access request happens in the order they
appear in the file. but SslBump step1 seems to happen before any
http_access.

Since I never see step2 happen in my logs I'm not sure where it happens.
ultimately the request is rejected because of my final deny all at line 57.

I've also observed that using a non-transparent proxy. SSL and non SSL
request get evaluated at line 48 which is where I allow from my whitelist
and localnet. This seems to make sense. So he only thing I need to
understand I believe is the SSLbump steps. the order things happen in

is the final deny I have wrong? Or is my ssl_bump simply wrong?

you'll notice in my config I've commented a bunch of http_access out. I was
hoping if I made the file simpler it would be easier to troubleshoot. I
intend to put them back when I figure out my problem.

cache.log: <A HREF="https://pastebin.com/uZVn6f4Q">https://pastebin.com/uZVn6f4Q</A>
squid.conf: <A HREF="https://pastebin.com/D49H5rYS">https://pastebin.com/D49H5rYS</A>
squid -k parse: <A HREF="https://pastebin.com/F0U2SvUm">https://pastebin.com/F0U2SvUm</A>

-- 
Joseph M Jones
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20190301/3889a9cd/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20190301/3889a9cd/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020336.html">[squid-users] Squid and url modifying
</A></li>
	<LI>Next message (by thread): <A HREF="020293.html">[squid-users] Sslbump Not working for transparent proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20285">[ date ]</a>
              <a href="thread.html#20285">[ thread ]</a>
              <a href="subject.html#20285">[ subject ]</a>
              <a href="author.html#20285">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
