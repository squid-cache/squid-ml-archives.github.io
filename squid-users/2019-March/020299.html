<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid and url modifying
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20and%20url%20modifying&In-Reply-To=%3C5df95510-b780-f922-84e5-e4f4cdd5a18d%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020284.html">
   <LINK REL="Next"  HREF="020300.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid and url modifying</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20and%20url%20modifying&In-Reply-To=%3C5df95510-b780-f922-84e5-e4f4cdd5a18d%40treenet.co.nz%3E"
       TITLE="[squid-users] Squid and url modifying">squid3 at treenet.co.nz
       </A><BR>
    <I>Sat Mar  2 05:28:48 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020284.html">[squid-users] Squid and url modifying
</A></li>
        <LI>Next message (by thread): <A HREF="020300.html">[squid-users] Squid and url modifying
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20299">[ date ]</a>
              <a href="thread.html#20299">[ thread ]</a>
              <a href="subject.html#20299">[ subject ]</a>
              <a href="author.html#20299">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2/03/19 1:59 am, Egoitz Aurrekoetxea wrote:
&gt;<i> Good afternoon,
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Is it possible for Squid to do something like :
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> - Receive request : <A HREF="https://oooeeee.eeee.ttt.thesquidserver.org/u?ii=99&amp;j=88">https://oooeeee.eeee.ttt.thesquidserver.org/u?ii=99&amp;j=88</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> and
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> to really perform a request as : <A HREF="https://oooeeee.eeee.ttt/u?ii=99&amp;j=88">https://oooeeee.eeee.ttt/u?ii=99&amp;j=88</A>
</I>&gt;<i> &lt;<A HREF="https://oooeeee.eeee.ttt.thesquidserver.org/u?ii=99&amp;j=88">https://oooeeee.eeee.ttt.thesquidserver.org/u?ii=99&amp;j=88</A>&gt;
</I>&gt;<i> 
</I>
Possible? Yes.

Good Idea? No.

This is a typical URL-rewrite. Except that in order to perform the
SSL-Bump to see that URL in the first place Squid has probably had to
contact the server and now has TLS bound to that particular server. So
you better hope the server oooeeee.eeee.ttt.thesquidserver.org knows how
to answer requests for the <A HREF="https://oooeeee.eeee.ttt/*">https://oooeeee.eeee.ttt/*</A> URLs.

Avoiding that problem is only possible with bumping at step2 (aka.
client-first bumping). Which opens your proxy to a large number of
possible attacks and nasty side effects from incompatible TLS features
being negotiated on client and server connections.
 YMMV on whether that is even usable for your situation.


&gt;<i> 
</I>&gt;<i> I mean not to redirect users with url redirection. Just act as a proxy
</I>&gt;<i> but having Squid the proper acknoledge internally for being able to make
</I>&gt;<i> the proper request to the destination?. Is it possible without
</I>&gt;<i> redirecting url, to return for instance a 403 error to the source web
</I>&gt;<i> browser in order to not be able to access to the site if some kind of
</I>&gt;<i> circumstances are given?
</I>
Of course.

The issue people tend to have is that Browsers do not show proxy error
messages in a lot of circumstances. They still show *an* error though.
So if your goal is just to block, yes that much is relatively easy.


&gt;<i> 
</I>&gt;<i> If all conditions for allowing to see the content are OK, return the web
</I>&gt;<i> browser a 301 redirect answer with the
</I>&gt;<i> <A HREF="https://oooeeee.eeee.ttt/u?ii=99&amp;j=88">https://oooeeee.eeee.ttt/u?ii=99&amp;j=88</A>
</I>&gt;<i> &lt;<A HREF="https://oooeeee.eeee.ttt.thesquidserver.org/u?ii=99&amp;j=88">https://oooeeee.eeee.ttt.thesquidserver.org/u?ii=99&amp;j=88</A>&gt; URL. Else,
</I>&gt;<i> just return a 403 or redirect you to a Forbidden page... I think this
</I>&gt;<i> could be implemented with URL redirectors...but... the fact is... which
</I>&gt;<i> kind of conditions or env situations can you use for validating the
</I>&gt;<i> content inside the url redirector?.
</I>
302 is better since this is not a permanent state. Your policy may
change any time.

Anyhow, 30x redirection is the *best* way to do it.

The helper is contacted by Squid after the TLS has been decrypted and
the HTTP(S) messages area arriving. Before that point there is no URL to
rewrite or redirect.

Helpers can do anything they like. Squid can pass them details of the
client TCP connection, the TLS state, or the HTTP request the client has
delivered. And some other details (eg rDNS, IDENT, ASN or such) that
Squid can lookup. Anything else the helper can lookup by itself can also
be used.

That extreme flexibility is the point of the helper. If you just need a
somewhat static mapping deny_info can perform redirection faster.


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020284.html">[squid-users] Squid and url modifying
</A></li>
	<LI>Next message (by thread): <A HREF="020300.html">[squid-users] Squid and url modifying
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20299">[ date ]</a>
              <a href="thread.html#20299">[ thread ]</a>
              <a href="subject.html#20299">[ subject ]</a>
              <a href="author.html#20299">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
