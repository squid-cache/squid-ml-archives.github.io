<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid and url modifying
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20and%20url%20modifying&In-Reply-To=%3C093a8eef-d155-5638-815b-f74bf727795e%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020313.html">
   <LINK REL="Next"  HREF="020322.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid and url modifying</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20and%20url%20modifying&In-Reply-To=%3C093a8eef-d155-5638-815b-f74bf727795e%40measurement-factory.com%3E"
       TITLE="[squid-users] Squid and url modifying">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Mar  5 07:13:36 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020313.html">[squid-users] Squid and url modifying
</A></li>
        <LI>Next message (by thread): <A HREF="020322.html">[squid-users] Squid and url modifying
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20321">[ date ]</a>
              <a href="thread.html#20321">[ thread ]</a>
              <a href="subject.html#20321">[ subject ]</a>
              <a href="author.html#20321">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 3/4/19 11:20 AM, Egoitz Aurrekoetxea wrote:

&gt;<i> Clients, will ask :
</I>&gt;<i> 
</I>&gt;<i> <A HREF="https://oooeeee.eeee.ttt.thesquidserver.org/">https://oooeeee.eeee.ttt.thesquidserver.org/</A>
</I>
&gt;<i> So the answer [to the second question] I assume should be yes.
</I>
If I am interpreting your answers correctly, then your setup looks like
a reverse proxy to me. In that case, you do not need SslBump and
interception. You do need an web server certificate for the
oooeeee.eeee.ttt.thesquidserver.org domain, issued by a well-trusted CA.
Do you already have that?


&gt;<i> I have DNAT rules, for being able to
</I>&gt;<i> redirect tcp/80 and tcp/443 to squid's port silently.
</I>
Please note that your current Squid configuration is not a reverse proxy
configuration. It is an interception configuration. It also lacks
https_port for handling port 443 traffic. There are probably some
documents on Squid wiki (and/or elsewhere) explaining how to configure
Squid to become a reverse proxy. Follow them.


&gt;<i> I wanted to setup a proxy machine which I wanted to be able to receive
</I>&gt;<i> url like :
</I>&gt;<i> 
</I>&gt;<i> - www.iou.net.theproxy.com/hj.php?ui=9
</I>&gt;<i> 
</I>&gt;<i> If this site returns clean content (scanned by Icap server) the url
</I>&gt;<i> redirector should return :
</I>&gt;<i> 
</I>&gt;<i> - www.iou.net/hj.php?ui=9 &lt;<A HREF="http://www.iou.net/hj.php?ui=9">http://www.iou.net/hj.php?ui=9</A>&gt; (the real
</I>&gt;<i> url) as URL.
</I>
OK.


&gt;<i> - Is it possible with Squid to achieve my goal?. With Squid, a
</I>&gt;<i> redirector, and a Icap daemon which performs virus scanning...
</I>
A redirector seems out of scope here -- it works on requests while you
want to rewrite (scanned by ICAP) responses.

It is probably possible to use deny_info to respond with a redirect
message. To trigger a deny_info action, you would have to configure your
Squid to block virus-free responses, which is rather strange!


&gt;<i> - For plain http the config and the URL seem to be working BUT the virus
</I>&gt;<i> are not being scanned. Could the config be adjusted for that?.
</I>

I would start by removing the redirector, &quot;intercept&quot;, SslBump, and
disabling ICAP. Configure your Squid as a reverse proxy without any
virus scanning. Then add ICAP. Get the virus scanning working without
any URL manipulation. Once that is done, you can adjust Squid to block
virus-free responses (via http_reply_access) and trigger a deny_info
response containing an HTTP redirect.


Please note that once the browser gets a redirect to another site, that
browser is not going to revisit your reverse proxy for any content
related to that other site -- all requests for that other site will go
from the browser to that other site. Your proxy will not be in the loop
anymore. If that is not what you want, then you cannot use redirects at
all -- you would have to accelerate that other site for all requests
instead and make sure that other site does not contain absolute URLs
pointing the browser away from your reverse proxy.


Disclaimer: I have not tested the above ideas and, again, I may be
misinterpreting what you really want to achieve.

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020313.html">[squid-users] Squid and url modifying
</A></li>
	<LI>Next message (by thread): <A HREF="020322.html">[squid-users] Squid and url modifying
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20321">[ date ]</a>
              <a href="thread.html#20321">[ thread ]</a>
              <a href="subject.html#20321">[ subject ]</a>
              <a href="author.html#20321">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
