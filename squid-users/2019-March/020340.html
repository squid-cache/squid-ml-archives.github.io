<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Not Implemented error returned I believe due to chunking
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Not%20Implemented%20error%20returned%20I%20believe%20due%20to%0A%20chunking&In-Reply-To=%3C3de2ca31-bc99-0a8b-c1b3-f9f89827948f%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020339.html">
   <LINK REL="Next"  HREF="020341.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Not Implemented error returned I believe due to chunking</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Not%20Implemented%20error%20returned%20I%20believe%20due%20to%0A%20chunking&In-Reply-To=%3C3de2ca31-bc99-0a8b-c1b3-f9f89827948f%40measurement-factory.com%3E"
       TITLE="[squid-users] Not Implemented error returned I believe due to chunking">rousskov at measurement-factory.com
       </A><BR>
    <I>Wed Mar  6 20:21:47 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020339.html">[squid-users] Not Implemented error returned I believe due to	chunking
</A></li>
        <LI>Next message (by thread): <A HREF="020341.html">[squid-users] icap example server not working
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20340">[ date ]</a>
              <a href="thread.html#20340">[ thread ]</a>
              <a href="subject.html#20340">[ subject ]</a>
              <a href="author.html#20340">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 3/6/19 1:00 PM, Russel McDonald wrote:

&gt;<i> I've indeed read a few forum links about just this issue, but confused
</I>&gt;<i> as to whether chunking is supposed to finally work for 3.5.28
</I>
Chunked requests should be supported in all modern Squid versions,
including v3.5.28. There are some corner cases where dechunking code
fails, but they are very unlikely to affect you. I do not know what
forum links you have read, but I do not recall any general long-standing
problems with chunking support in modern Squids.


&gt;<i> If I instead only specify to pass the response to my adapter via
</I>&gt;<i> ECAP then the issue goes away. So I captured the HTTP header for the 
</I>&gt;<i> success case and the failure case and narrowed it down the the 
</I>&gt;<i> failure case not specifying the length and specifying &quot;,chunking&quot; at
</I>&gt;<i> the end.
</I>
Many adapters strip Content-Length header and effectively switch to
chunked encoding because it is easier and cheaper to adapt message
bodies that way. Does your eCAP adapter remove the Content-Length header
(possibly replacing it with Transfer-Encoding:chunked)? Such actions are
OK from HTTP point of view, but they may expose lack of chunked request
support at the _origin server_.


&gt;<i> I assume if the request is passed to the adapter then the header has
</I>&gt;<i> to be constructed at a time when the length of the file contents is
</I>&gt;<i> not known? Hence has to use chunking.
</I>
Squid does not &quot;construct&quot; that request header from scratch -- it
essentially forwards the request header sent by the client. If I
interpret your description correctly, the client sends a
Content-Length:N header, so the size of the request body (i.e. N bytes)
is known to Squid and, hence, to the REQMOD eCAP adapter in advance.

It is possible that your adapter strips that Content-Length header, and
then the origin server complains because it cannot handle chunked
requests. If that is what's happening, then you will need to seek
support from the adapter makers.

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020339.html">[squid-users] Not Implemented error returned I believe due to	chunking
</A></li>
	<LI>Next message (by thread): <A HREF="020341.html">[squid-users] icap example server not working
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20340">[ date ]</a>
              <a href="thread.html#20340">[ thread ]</a>
              <a href="subject.html#20340">[ subject ]</a>
              <a href="author.html#20340">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
