<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 3.5.28 crash regulary when many requests occur
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.5.28%20crash%20regulary%20when%20many%20requests%20occur&In-Reply-To=%3COF2C18C8B5.71089D87-ONC12583C4.005DD713-C12583C4.005E1562%40arz.at%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020388.html">
   <LINK REL="Next"  HREF="020396.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 3.5.28 crash regulary when many requests occur</H1>
    <B>Secinfo</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.5.28%20crash%20regulary%20when%20many%20requests%20occur&In-Reply-To=%3COF2C18C8B5.71089D87-ONC12583C4.005DD713-C12583C4.005E1562%40arz.at%3E"
       TITLE="[squid-users] Squid 3.5.28 crash regulary when many requests occur">secinfo.pcim at arz.at
       </A><BR>
    <I>Thu Mar 21 17:07:38 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020388.html">[squid-users] Squid HIER_NONE state in access logs
</A></li>
        <LI>Next message (by thread): <A HREF="020396.html">[squid-users] Squid 3.5.28 crash regulary when many requests occur
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20395">[ date ]</a>
              <a href="thread.html#20395">[ thread ]</a>
              <a href="subject.html#20395">[ subject ]</a>
              <a href="author.html#20395">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi we are using Squid as a Caching proxy for out patch deployment.

Since we moved to version 3.5.28 on windows Server ,we have problems in 
our
main spots.

typical cache.log entry&#180;s are
2019/03/12 14:12:00 kid1| Using Least Load store dir selection
2019/03/12 14:12:00 kid1| Set Current Directory to
C:\smart\Squid\var\cache\squid
2019/03/12 14:12:00 kid1| Finished loading MIME types and icons.
2019/03/12 14:12:00 kid1| HTCP Disabled.
2019/03/12 14:12:00 kid1| Squid plugin modules loaded: 0
2019/03/12 14:12:00 kid1| Adaptation support is off.
2019/03/12 14:12:00 kid1| Accepting HTTP Socket connections at 
local=[::]:81
remote=[::] FD 12 flags=9
2019/03/12 14:12:00 kid1| Done reading F:\LEMSS-Content swaplog (743
entries)
2019/03/12 14:12:00 kid1| Finished rebuilding storage from disk.
2019/03/12 14:12:00 kid1|       482 Entries scanned
2019/03/12 14:12:00 kid1|         0 Invalid entries.
2019/03/12 14:12:00 kid1|         0 With invalid flags.
2019/03/12 14:12:00 kid1|       223 Objects loaded.
2019/03/12 14:12:00 kid1|         0 Objects expired.
2019/03/12 14:12:00 kid1|         0 Objects cancelled.
2019/03/12 14:12:00 kid1|       119 Duplicate URLs purged.
2019/03/12 14:12:00 kid1|       140 Swapfile clashes avoided.
2019/03/12 14:12:00 kid1|   Took 0.14 seconds (1588.31 objects/sec).
2019/03/12 14:12:00 kid1| Beginning Validation Procedure
2019/03/12 14:12:00 kid1|   Completed Validation Procedure
2019/03/12 14:12:00 kid1|   Validated 223 Entries
2019/03/12 14:12:00 kid1|   store_swap_size = 6227808.00 KB
2019/03/12 14:12:01 kid1| storeLateRelease: released 0 objects
2019/03/12 14:12:03 kid1| DiskThreadsDiskFile::openDone: (2) No such file 
or
directory
2019/03/12 14:12:03 kid1|                F:\LEMSS-Content/00/00/00000025
2019/03/12 14:12:03 kid1| WARNING: 1 swapin MD5 mismatches
2019/03/12 14:12:03 kid1| DiskThreadsDiskFile::openDone: (2) No such file 
or
directory
2019/03/12 14:12:03 kid1|                F:\LEMSS-Content/00/00/00000025
2019/03/12 14:12:03 kid1| WARNING: 1 swapin MD5 mismatches
2019/03/12 14:12:03 kid1| DiskThreadsDiskFile::openDone: (2) No such file 
or
directory
2019/03/12 14:12:03 kid1|                F:\LEMSS-Content/00/00/0000002D
2019/03/12 14:12:24 kid1| DiskThreadsDiskFile::openDone: (16) Device or
resource busy
2019/03/12 14:12:24 kid1|                F:\LEMSS-Content/00/00/000000CC
2019/03/12 14:12:24 kid1| DiskThreadsDiskFile::openDone: (2) No such file 
or
directory
2019/03/12 14:12:24 kid1|                F:\LEMSS-Content/00/00/00000079
2019/03/12 14:12:31 kid1| DiskThreadsDiskFile::openDone: (2) No such file 
or
directory
2019/03/12 14:12:31 kid1|                F:\LEMSS-Content/00/00/00000008
2019/03/12 14:12:59 kid1| DiskThreadsDiskFile::openDone: (13) Permission
denied


after that squid service is running but does not keep connections ore
reastablish connections.
Squid service has to be restarted.

Depending on the location we have 100 Mbit to 10 Gbit.

our squid.conf at the main branches is like
#Local Settings
acl all src all
acl manager proto cache_object
acl localhost src 127.0.0.1/32
acl to_localhost dst 127.0.0.0/8

# Example rule allowing access from your local networks.
# Adapt to list your (internal) IP networks from where browsing
# should be allowed

acl localnet src 10.0.0.0/8              # RFC1918 possible internal 
network
acl localnet src 172.16.0.0/12           # RFC1918 possible internal 
network
acl localnet src 192.168.0.0/16          # RFC1918 possible internal 
network
acl localnet src fc00::/7       # RFC 4193 local private network range
acl localnet src fe80::/10      # RFC 4291 link-local (directly plugged)
machines
acl Windowsupdate dstdomain lemss.m287.local

acl SSL_ports port 443
acl Safe_ports port 80                           # http
acl Safe_ports port 21                           # ftp
acl Safe_ports port 443                          # https
acl Safe_ports port 70                           # gopher
acl Safe_ports port 210                          # wais
acl Safe_ports port 1025-65535           # unregistered ports
acl Safe_ports port 280                          # http-mgmt
acl Safe_ports port 488                          # gss-http
acl Safe_ports port 591                          # filemaker
acl Safe_ports port 777                          # multiling http
acl CONNECT method CONNECT

#
# Recommended minimum Access Permission configuration:
#

# Only allow cachemgr access from localhost
http_access allow localhost manager
# http_access allow windowsudpate localhost
http_access deny manager

# Deny requests to certain unsafe ports
http_access deny !Safe_ports

# Deny CONNECT to other than secure SSL ports
http_access deny CONNECT !SSL_ports

# We strongly recommend the following be uncommented to protect innocent
# web applications running on the proxy server who think the only
# one who can access services on &quot;localhost&quot; is a local user
#http_access deny to_localhost

#
# INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
#

# Example rule allowing access from your local networks.
# Adapt localnet in the ACL section to list your (internal) IP networks
# from where browsing should be allowed
http_access allow localnet
http_access allow localhost
http_access allow Windowsupdate

# And finally deny all other access to this proxy
http_access deny all

# Limit number of days to keep logs
# logfile_rotate 2

# Squid normally listens to port 3128
http_port 81

# Delay parameters
delay_pools 1
delay_class 1 1
delay_parameters 1 none -1/-1
delay_access 1 allow localnet


# Uncomment the line below to enable disk caching - path format is
/cygdrive/&lt;full path to cache folder&gt;, i.e.
cache_dir aufs F:\LEMSS-Content 10000 16 256
cache_mem 2048 MB

# Leave coredumps in the first cache dir
coredump_dir C:\smart\Squid\var\cache\squid

#debug_options All,1 33,2 28,9

# Add any of your own refresh_pattern entries above these.
# refresh_pattern -i
lemss.m287.local/.*\.(cab|exe|ms[i|u|f|p]|[ap]sf|wm[v|a]|dat|zip|psf) 
43200
80% 129600 reload-into-ims
refresh_pattern -i
lemss.m287.local/.*\.(cab|exe|ms[i|u|f|p]|[ap]sf|wm[v|a]|dat|zip|psf) 
43200
80% 129600 reload-into-ims
refresh_pattern ^ftp:                            1440            20%  
10080
refresh_pattern ^gopher:                 1440            0% 1440
refresh_pattern -i (/cgi-bin/|\?) 0              0%              0
refresh_pattern .                                0               20%  4320

dns_v4_first on

dns_nameservers 10.1.19.203 10.1.19.204

# pipeline_prefetch 2

max_filedescriptors 3200

range_offset_limit 2000 MB windowsupdate

maximum_object_size 2000 MB
collapsed_forwarding on

quick_abort_min -1

thats our squid.conf
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20190321/4a4cbf0e/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20190321/4a4cbf0e/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020388.html">[squid-users] Squid HIER_NONE state in access logs
</A></li>
	<LI>Next message (by thread): <A HREF="020396.html">[squid-users] Squid 3.5.28 crash regulary when many requests occur
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20395">[ date ]</a>
              <a href="thread.html#20395">[ thread ]</a>
              <a href="subject.html#20395">[ subject ]</a>
              <a href="author.html#20395">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
