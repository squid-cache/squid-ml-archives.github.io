<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Deny_Info TCP_RESET
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Deny_Info%20TCP_RESET&In-Reply-To=%3Cf444dab1-d621-4439-8375-9c7b12551cbc%40www.fastmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020404.html">
   <LINK REL="Next"  HREF="020406.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Deny_Info TCP_RESET</H1>
    <B>squid at buglecreek.com</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Deny_Info%20TCP_RESET&In-Reply-To=%3Cf444dab1-d621-4439-8375-9c7b12551cbc%40www.fastmail.com%3E"
       TITLE="[squid-users] Deny_Info TCP_RESET">squid at buglecreek.com
       </A><BR>
    <I>Wed Mar 27 21:17:19 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020404.html">[squid-users] How to catch a big spender ?
</A></li>
        <LI>Next message (by thread): <A HREF="020406.html">[squid-users] Deny_Info TCP_RESET
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20405">[ date ]</a>
              <a href="thread.html#20405">[ thread ]</a>
              <a href="subject.html#20405">[ subject ]</a>
              <a href="author.html#20405">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Operating in reverse proxy mode.   I'm trying to send a TCP reset in response to the acl below:

acl example_url url_regex -i [^:]+://[^0-9]*.example.com.*
deny_info TCP_RESET example_url
http_access deny example_url

Looking at the packets I see the following response:

HTTP/1.0 403 Forbidden
Server: squid
Mime-Version: 1.0
Date: Wed, 27 Mar 2019 20:36:20 GMT
Content-Type: text/html
Content-Length: 5
X-Squid-Error: TCP_RESET 0
Vary: Accept-Language
Content-Language: en
X-Cache: MISS from www.example.com
X-Cache-Lookup: NONE from www.example.com:80
Via: 1.0 www.example.com (squid)
Connection: keep-alive

reset

Squid sends the headers and the word reset.  Then future requests seem to work as expected.  No headers are sent, the word reset isn't sent and squid ultimately sends a RST and ACK.

Then after some time  or squid gets reloaded the headers are sent again, then things seem to work as I would expect.

I'm not sure if it will help, but wanted to try the following to see if that will get rid of that initial header being sent. 

acl example_url url_regex -i [^:]+://[^0-9]*.example.com.*
deny_info TCP_RESET example_url
http_reply_access deny example_url

Do I still need the http_access deny example_url in addition to the http_reply_access deny example_url statement, or does the http_reply_access take the place of http_access statement:


acl example_url url_regex -i [^:]+://[^0-9]*.example.com.*
deny_info TCP_RESET example_url
http_reply_access deny example_url
http_access deny example_url

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020404.html">[squid-users] How to catch a big spender ?
</A></li>
	<LI>Next message (by thread): <A HREF="020406.html">[squid-users] Deny_Info TCP_RESET
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20405">[ date ]</a>
              <a href="thread.html#20405">[ thread ]</a>
              <a href="subject.html#20405">[ subject ]</a>
              <a href="author.html#20405">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
