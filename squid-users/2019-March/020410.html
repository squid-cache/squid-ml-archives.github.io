<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] delay_pools don't work on squid 4.4
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20delay_pools%20don%27t%20work%20on%20squid%204.4&In-Reply-To=%3C02c601d4e57b%24329264e0%2497b72ea0%24%40eleccav.une.cu%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020408.html">
   <LINK REL="Next"  HREF="020413.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] delay_pools don't work on squid 4.4</H1>
    <B>Yanier Salazar Sanchez</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20delay_pools%20don%27t%20work%20on%20squid%204.4&In-Reply-To=%3C02c601d4e57b%24329264e0%2497b72ea0%24%40eleccav.une.cu%3E"
       TITLE="[squid-users] delay_pools don't work on squid 4.4">yanier at eleccav.une.cu
       </A><BR>
    <I>Thu Mar 28 15:30:39 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020408.html">[squid-users] delay_pools don't work on squid 4.4
</A></li>
        <LI>Next message (by thread): <A HREF="020413.html">[squid-users] kerberos
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20410">[ date ]</a>
              <a href="thread.html#20410">[ thread ]</a>
              <a href="subject.html#20410">[ subject ]</a>
              <a href="author.html#20410">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks for reply, I had already read that version 4 doesn't work and I thought that bug was already fixed. I use squid without using SSlBump or splice. I will try to download that code and compile it for ubuntu 18.04

-----Original Message-----
From: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; On Behalf Of Alex Rousskov
Sent: Wednesday, March 27, 2019 11:18 PM
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] delay_pools don't work on squid 4.4

On 3/27/19 5:29 PM, Yanier Salazar Sanchez wrote:

&gt;<i> I have squid4.4 installed in linux on ubuntu 18.04.1 and [...] 
</I>&gt;<i> delay_pools are functioning as if they didn&#8217;t have speed limits
</I>
While testing peering support for SslBump transactions[1], Factory has discovered that delay pools are broken in Squid v4 and v5 as far as tunneled traffic is concerned[2]. I do not have a stand-alone fix for that bug -- too many changes surrounding the fixed code in that pull request, but it is likely that the bug will be fixed in v5 if our pull request is accepted. The proposed code is available for testing[3].

[1] <A HREF="https://github.com/squid-cache/squid/pull/380">https://github.com/squid-cache/squid/pull/380</A>
[2] <A HREF="https://github.com/squid-cache/squid/pull/380/commits/679645f">https://github.com/squid-cache/squid/pull/380/commits/679645f</A>
[3] <A HREF="https://github.com/squid-cache/squid/pull/380.patch">https://github.com/squid-cache/squid/pull/380.patch</A>


HTH,

Alex.


&gt;<i> /etc/squid# squid -v
</I>&gt;<i> 
</I>&gt;<i> Squid Cache: Version 4.4
</I>&gt;<i> 
</I>&gt;<i> Service Name: squid
</I>&gt;<i> 
</I>&gt;<i> Debian linux
</I>&gt;<i> 
</I>&gt;<i> configure options:  '--build=x86_64-linux-gnu' '--prefix=/usr'
</I>&gt;<i> '--includedir=${prefix}/include' '--mandir=${prefix}/share/man'
</I>&gt;<i> '--infodir=${prefix}/share/info' '--sysconfdir=/etc'
</I>&gt;<i> '--localstatedir=/var' '--libexecdir=${prefix}/lib/squid' '--srcdir=.'
</I>&gt;<i> '--disable-maintainer-mode' '--disable-dependency-tracking'
</I>&gt;<i> '--disable-silent-rules' 'BUILDCXXFLAGS=-g -O2 
</I>&gt;<i> -fdebug-prefix-map=/build/squid-4.4=. -fstack-protector-strong 
</I>&gt;<i> -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2 
</I>&gt;<i> -Wl,-z,relro -Wl,-z,now -Wl,--as-needed -latomic' '--enable-build-info=Debian linux'
</I>&gt;<i> '--datadir=/usr/share/squid' '--sysconfdir=/etc/squid'
</I>&gt;<i> '--libexecdir=/usr/lib/squid' '--mandir=/usr/share/man'
</I>&gt;<i> '--enable-inline' '--disable-arch-native' '--enable-async-io=8'
</I>&gt;<i> '--enable-storeio=ufs,aufs,diskd,rock'
</I>&gt;<i> '--enable-removal-policies=lru,heap' '--enable-delay-pools'
</I>&gt;<i> '--enable-cache-digests' '--enable-icap-client'
</I>&gt;<i> '--enable-follow-x-forwarded-for'
</I>&gt;<i> '--enable-auth-basic=DB,fake,getpwnam,LDAP,NCSA,NIS,PAM,POP3,RADIUS,SASL,SMB'
</I>&gt;<i> '--enable-auth-digest=file,LDAP'
</I>&gt;<i> '--enable-auth-negotiate=kerberos,wrapper'
</I>&gt;<i> '--enable-auth-ntlm=fake,SMB_LM'
</I>&gt;<i> '--enable-external-acl-helpers=file_userip,kerberos_ldap_group,LDAP_group,session,SQL_session,time_quota,unix_group,wbinfo_group'
</I>&gt;<i> '--enable-security-cert-validators=fake'
</I>&gt;<i> '--enable-storeid-rewrite-helpers=file'
</I>&gt;<i> '--enable-url-rewrite-helpers=fake' '--enable-eui' '--enable-esi'
</I>&gt;<i> '--enable-icmp' '--enable-zph-qos' '--enable-ecap'
</I>&gt;<i> '--disable-translation' '--with-swapdir=/var/spool/squid'
</I>&gt;<i> '--with-logdir=/var/log/squid' '--with-pidfile=/var/run/squid.pid'
</I>&gt;<i> '--with-filedescriptors=65536' '--with-large-files'
</I>&gt;<i> '--with-default-user=proxy' '--with-gnutls' '--enable-linux-netfilter'
</I>&gt;<i> 'build_alias=x86_64-linux-gnu' 'CFLAGS=-g -O2 
</I>&gt;<i> -fdebug-prefix-map=/build/squid-4.4=. -fstack-protector-strong 
</I>&gt;<i> -Wformat -Werror=format-security -Wall' 'LDFLAGS=-Wl,-z,relro 
</I>&gt;<i> -Wl,-z,now -Wl,--as-needed -latomic' 'CPPFLAGS=-Wdate-time -D_FORTIFY_SOURCE=2'
</I>&gt;<i> 'CXXFLAGS=-g -O2 -fdebug-prefix-map=/build/squid-4.4=.
</I>&gt;<i> -fstack-protector-strong -Wformat -Werror=format-security'
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> squidstat shows me this
</I>&gt;<i> 
</I>&gt;<i> remote=10.100.1.150:49791
</I>&gt;<i> 
</I>&gt;<i> local=10.100.2.5:3128
</I>&gt;<i> 
</I>&gt;<i> uri=r4---sn-xuxaxasda234-i58e.googlevideo.com:443
</I>&gt;<i> 
</I>&gt;<i> bytes=3429753
</I>&gt;<i> 
</I>&gt;<i> seconds=20
</I>&gt;<i> 
</I>&gt;<i> username=juan
</I>&gt;<i> 
</I>&gt;<i> delay_pool=4
</I>&gt;<i> 
</I>&gt;<i> connection=0x55fd2432a158
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> squid.conf
</I>&gt;<i> 
</I>&gt;<i> acl youtube url_regex .youtube.com .youtube.com:443 .googlevideo.com
</I>&gt;<i> .googlevideo.com:443
</I>&gt;<i> 
</I>&gt;<i> delay_initial_bucket_level 90
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> delay_class 4 2
</I>&gt;<i> 
</I>&gt;<i> delay_access 4 allow youtube
</I>&gt;<i> 
</I>&gt;<i> delay_parameters 4 18000/19000 10000/11000
</I>&gt;<i> 
</I>&gt;<i> delay_access 4 deny all
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> 
</I>
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020408.html">[squid-users] delay_pools don't work on squid 4.4
</A></li>
	<LI>Next message (by thread): <A HREF="020413.html">[squid-users] kerberos
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20410">[ date ]</a>
              <a href="thread.html#20410">[ thread ]</a>
              <a href="subject.html#20410">[ subject ]</a>
              <a href="author.html#20410">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
