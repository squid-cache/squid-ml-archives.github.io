<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Unsuccessful at using Squid v4 with intercept
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Unsuccessful%20at%20using%20Squid%20v4%20with%20intercept&In-Reply-To=%3C2c5c409409f6460485395a13f16f5bbe%40ecritel.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021229.html">
   <LINK REL="Next"  HREF="021242.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Unsuccessful at using Squid v4 with intercept</H1>
    <B>FOUTREL S&#233;bastien</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Unsuccessful%20at%20using%20Squid%20v4%20with%20intercept&In-Reply-To=%3C2c5c409409f6460485395a13f16f5bbe%40ecritel.net%3E"
       TITLE="[squid-users] Unsuccessful at using Squid v4 with intercept">sfoutrel at ecritel.net
       </A><BR>
    <I>Mon Nov  4 12:57:23 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="021229.html">[squid-users] Unsuccessful at using Squid v4 with intercept
</A></li>
        <LI>Next message (by thread): <A HREF="021242.html">[squid-users] Unsuccessful at using Squid v4 with intercept
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21241">[ date ]</a>
              <a href="thread.html#21241">[ thread ]</a>
              <a href="subject.html#21241">[ subject ]</a>
              <a href="author.html#21241">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hello,
With your comments and help I succesfully did the fwmark/routing intercept squid.

&gt;<i>From what i read from the other examples, the only method to use if squid is not on the router is always using routes. Which means my squid MUST always be directly connected to the router.
</I>Am I wrong ?

The only way that seems to be able to work if not directly connected is the wccp one which seems to use gre.

Thanks.

________________________________
De : squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; de la part de Rafael Akchurin &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rafael.akchurin at diladele.com</A>&gt;
Envoy&#233; : vendredi 1 novembre 2019 07:35
&#192; : Amos Jeffries; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Objet : Re: [squid-users] Unsuccessful at using Squid v4 with intercept

Hello Sebastian,

If you decide to go policy routing way as Amos suggested - please see the tutorial at <A HREF="https://docs.diladele.com/tutorials/policy_based_routing_squid/index.html">https://docs.diladele.com/tutorials/policy_based_routing_squid/index.html</A>
Transparently filtering HTTPS with Squid and Policy Based Routing &#8212; Web Filter for Your Network&lt;<A HREF="https://docs.diladele.com/tutorials/policy_based_routing_squid/index.html">https://docs.diladele.com/tutorials/policy_based_routing_squid/index.html</A>&gt;
docs.diladele.com
Detailed tutorial for setting up policy based routing intercept-style HTTPS filtering on Ubuntu 16 using Squid, iptables and Web Safety.



Or <A HREF="https://docs.diladele.com/tutorials/web_filter_https_squid_cisco_wccp/index.html">https://docs.diladele.com/tutorials/web_filter_https_squid_cisco_wccp/index.html</A> for WCCP.
Transparent HTTPS Web Filter with Squid, Cisco ASA and ICAP &#8212; Web Filter for Your Network&lt;<A HREF="https://docs.diladele.com/tutorials/web_filter_https_squid_cisco_wccp/index.html">https://docs.diladele.com/tutorials/web_filter_https_squid_cisco_wccp/index.html</A>&gt;
docs.diladele.com
Step-by-step tutorial for enabling transparent HTTP and HTTPS filtering with Squid, Cisco ASA and Diladele Web Safety.




Best regards,
Rafael Akchurin
Diladele B.V.

-----Original Message-----
From: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; On Behalf Of Amos Jeffries
Sent: Friday, 1 November 2019 07:02
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] Unsuccessful at using Squid v4 with intercept

On 1/11/19 5:53 am, FOUTREL S&#233;bastien wrote:
&gt;<i> ----------------------------------------------------------------------
</I>&gt;<i> --
</I>&gt;<i> *De :* Antony Stone
</I>&gt;<i> *Envoy&#233; :* mercredi 30 octobre 2019 17:39
</I>&gt;<i>
</I>&gt;<i> On Wednesday 30 October 2019 at 17:11:29, FOUTREL S&#233;bastien wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Hello, I would like to use squid as a transparent proxy for my users.
</I>&gt;<i>
</I>&gt;&gt;<i> &quot;Clients&quot; are behind a Debian &quot;Router&quot; which MASQUERADE them (as they
</I>&gt;&gt;<i> use RFC 1918 ips).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I have a Squid 4.6 from Debian Buster packages installed on a &quot;Proxy&quot;
</I>&gt;&gt;<i> server which is outside my network.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I read a lot of tutorials and examples from squid site...
</I>&gt;<i>
</I>&gt;<i> Did that include the links I've given below?
</I>&gt;<i>
</I>&gt;<i> Yes I read almost all examples config from wiki.squid-cache.org
</I>&gt;<i> &lt;<A HREF="https://wiki.squid-cache.org/SquidFaq/InterceptionProxy">https://wiki.squid-cache.org/SquidFaq/InterceptionProxy</A>&gt;
</I>&gt;<i> &lt;<A HREF="https://wiki.squid-cache.org/SquidFaq/InterceptionProxy">https://wiki.squid-cache.org/SquidFaq/InterceptionProxy</A>&gt;And I was
</I>&gt;<i> mislead by the fact that there is a DNAT config and a REDIRECT config..
</I>&gt;<i> DNAT is completely useless if Squid only support to be on the router.
</I>&gt;<i> Wasn't it possible to dnat to a different server with older versions
</I>&gt;<i> (my memory is faulty) ?
</I>&gt;<i> <A HREF="http://tldp.org/HOWTO/TransparentProxy-6.html">http://tldp.org/HOWTO/TransparentProxy-6.html</A> for example.
</I>

Squid-2 used to ignore all NAT errors and just go where the client HTTP headers were claiming to be going. This proved to be a major security vulnerability with a pile of nasty related issues and side effects.
CVE-2009-0801 for reference.

DNAT is a tiny amount faster and less CPU cycles on the kernel NAT side of interception, and can be used in config tricks to get more than 64K entries in the NAT tables. So it is kept around for extremely high-traffic proxies.

REDIRECT is better for zero-conf installations or ones with a dynamic IP address on the proxy machine (eg IPv6 auto-conf and privacy addressing).


&gt;<i>
</I>&gt;<i> I read the &quot;fw mark and route policy&quot; method as an alternative not the
</I>&gt;<i> only way to go. My mistake.
</I>&gt;<i>
</I>
Easily made if you are reading *every* example config. Policy Routing _is_ an alternative ... to WCCP.

There are so many different types of routers with different config requirements, and also numerous NAT systems. Our formal Intercept examples are laid out as separate router config example and NAT config example. Pick one from each category as appropriate to the software your network uses for each machine.



Cheers
Amos
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20191104/b48c5552/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20191104/b48c5552/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="021229.html">[squid-users] Unsuccessful at using Squid v4 with intercept
</A></li>
	<LI>Next message (by thread): <A HREF="021242.html">[squid-users] Unsuccessful at using Squid v4 with intercept
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21241">[ date ]</a>
              <a href="thread.html#21241">[ thread ]</a>
              <a href="subject.html#21241">[ subject ]</a>
              <a href="author.html#21241">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
