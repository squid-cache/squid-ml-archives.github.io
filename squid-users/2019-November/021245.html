<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Fw: [Bug 4977] stmem.cc:98: &quot;lowestOffset () &lt;= target_offset&quot; assertion when adapting Content-Range value
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Fw%3A%20%5BBug%204977%5D%20stmem.cc%3A98%3A%20%22lowestOffset%20%28%29%20%3C%3D%0A%20target_offset%22%20assertion%20when%20adapting%20Content-Range%20value&In-Reply-To=%3Cb2e38136-dda2-239b-3a5b-3b518917bdde%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021244.html">
   <LINK REL="Next"  HREF="021246.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Fw: [Bug 4977] stmem.cc:98: &quot;lowestOffset () &lt;= target_offset&quot; assertion when adapting Content-Range value</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Fw%3A%20%5BBug%204977%5D%20stmem.cc%3A98%3A%20%22lowestOffset%20%28%29%20%3C%3D%0A%20target_offset%22%20assertion%20when%20adapting%20Content-Range%20value&In-Reply-To=%3Cb2e38136-dda2-239b-3a5b-3b518917bdde%40measurement-factory.com%3E"
       TITLE="[squid-users] Fw: [Bug 4977] stmem.cc:98: &quot;lowestOffset () &lt;= target_offset&quot; assertion when adapting Content-Range value">rousskov at measurement-factory.com
       </A><BR>
    <I>Mon Nov  4 17:13:06 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="021244.html">[squid-users] Fw: [Bug 4977] stmem.cc:98: &quot;lowestOffset () &lt;= target_offset&quot; assertion when adapting Content-Range value
</A></li>
        <LI>Next message (by thread): <A HREF="021246.html">[squid-users] Fw: [Bug 4977] stmem.cc:98: &quot;lowestOffset () &lt;= target_offset&quot; assertion when adapting Content-Range value
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21245">[ date ]</a>
              <a href="thread.html#21245">[ thread ]</a>
              <a href="subject.html#21245">[ subject ]</a>
              <a href="author.html#21245">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 11/4/19 11:21 AM, Matus UHLAR - fantomas wrote:
&gt;<i> the last request:
</I>&gt;<i> 
</I>&gt;<i> CONNECT www.google.com:443 HTTP/1.1
</I>&gt;<i> Host: www.google.com
</I>

That request does not seem to match the stack trace: The stack trace
points to a non-CONNECT transaction AFAICT. Perhaps you are bumping that
tunnel? Please note that you are not looking for the last request, but
for the request that triggered the assertion. It is very difficult to do
that with just ALL,2 and stripped executable, especially when you have
lots of concurrent transactions flying by.


Alex.



&gt;<i> ----------
</I>&gt;<i> 2019/11/04 16:59:09.721 kid1| 85,2| client_side_request.cc(752)
</I>&gt;<i> clientAccessCheckDone: The request CONNECT www.google.com:443 is
</I>&gt;<i> ALLOWED; last ACL checked: work_time1
</I>&gt;<i> 2019/11/04 16:59:09.721 kid1| 85,2| client_side_request.cc(728)
</I>&gt;<i> clientAccessCheck2: No adapted_http_access configuration. default: ALLOW
</I>&gt;<i> 2019/11/04 16:59:09.721 kid1| 85,2| client_side_request.cc(752)
</I>&gt;<i> clientAccessCheckDone: The request CONNECT www.google.com:443 is
</I>&gt;<i> ALLOWED; last ACL checked: work_time1
</I>&gt;<i> 2019/11/04 16:59:09.721 kid1| 44,2| peer_select.cc(281)
</I>&gt;<i> peerSelectDnsPaths: Find IP destination for: www.google.com:443' via
</I>&gt;<i> www.google.com
</I>&gt;<i> 2019/11/04 16:59:09.721 kid1| 44,2| peer_select.cc(302)
</I>&gt;<i> peerSelectDnsPaths: Found sources for 'www.google.com:443'
</I>&gt;<i> 2019/11/04 16:59:09.721 kid1| 44,2| peer_select.cc(303)
</I>&gt;<i> peerSelectDnsPaths:&#160;&#160; always_direct = DENIED
</I>&gt;<i> 2019/11/04 16:59:09.721 kid1| 44,2| peer_select.cc(304)
</I>&gt;<i> peerSelectDnsPaths:&#160;&#160;&#160; never_direct = DENIED
</I>&gt;<i> 2019/11/04 16:59:09.721 kid1| 44,2| peer_select.cc(308)
</I>&gt;<i> peerSelectDnsPaths:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; DIRECT = local=[::]
</I>&gt;<i> remote=[2a00:1450:4014:801::2004]:443 flags=1
</I>&gt;<i> 2019/11/04 16:59:09.721 kid1| 44,2| peer_select.cc(308)
</I>&gt;<i> peerSelectDnsPaths:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; DIRECT = local=0.0.0.0
</I>&gt;<i> remote=216.58.201.100:443 flags=1
</I>&gt;<i> 2019/11/04 16:59:09.721 kid1| 44,2| peer_select.cc(317)
</I>&gt;<i> peerSelectDnsPaths:&#160;&#160;&#160;&#160;&#160;&#160;&#160; timedout = 0
</I>&gt;<i> 2019/11/04 16:59:09.725 kid1| 20,2| store.cc(980) checkCachable:
</I>&gt;<i> StoreEntry::checkCachable: NO: not cachable
</I>&gt;<i> 2019/11/04 16:59:09.727 kid1| 33,2| client_side.cc(582) swanSong:
</I>&gt;<i> local=192.168.251.230:3128 remote=192.168.169.31:62822 flags=1
</I>&gt;<i> 2019/11/04 16:59:09.730 kid1| 20,2| store.cc(980) checkCachable:
</I>&gt;<i> StoreEntry::checkCachable: NO: not cachable
</I>&gt;<i> 2019/11/04 16:59:09.730 kid1| assertion failed: stmem.cc:98:
</I>&gt;<i> &quot;lowestOffset () &lt;= target_offset&quot;
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> and the gdb backtrace:
</I>&gt;<i> 
</I>&gt;<i> Core was generated by `(squid-1) --kid squid-1 -YC -f
</I>&gt;<i> /etc/squid/squid.conf'.
</I>&gt;<i> Program terminated with signal SIGABRT, Aborted.
</I>&gt;<i> #0&#160; __GI_raise (sig=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">sig at entry</A>=6) at ../sysdeps/unix/sysv/linux/raise.c:50
</I>&gt;<i> 50&#160;&#160;&#160;&#160;&#160; ../sysdeps/unix/sysv/linux/raise.c: No such file or directory.
</I>&gt;<i> [Current thread is 1 (Thread 0x7f939ea82e80 (LWP 13179))]
</I>&gt;<i> (gdb) backtrace
</I>&gt;<i> #0&#160; __GI_raise (sig=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">sig at entry</A>=6) at ../sysdeps/unix/sysv/linux/raise.c:50
</I>&gt;<i> #1&#160; 0x00007f93a15b2535 in __GI_abort () at abort.c:79
</I>&gt;<i> #2&#160; 0x00005654ebcee5ad in ?? ()
</I>&gt;<i> #3&#160; 0x00005654ebe6c170 in mem_hdr::freeDataUpto(long) ()
</I>&gt;<i> #4&#160; 0x00005654ebe27440 in MemObject::trimSwappable() ()
</I>&gt;<i> #5&#160; 0x00005654ebe74bf5 in StoreEntry::trimMemory(bool) ()
</I>&gt;<i> #6&#160; 0x00005654ec100a80 in Store::Controller::memoryOut(StoreEntry&amp;,
</I>&gt;<i> bool) ()
</I>&gt;<i> #7&#160; 0x00005654ebe84305 in StoreEntry::swapOut() ()
</I>&gt;<i> #8&#160; 0x00005654ebe7b3fd in StoreEntry::invokeHandlers() ()
</I>&gt;<i> #9&#160; 0x00005654ebe736ac in StoreEntry::write(StoreIOBuffer) ()
</I>&gt;<i> #10 0x00005654ebf0a590 in Client::storeReplyBody(char const*, long) ()
</I>&gt;<i> #11 0x00005654ebdeca37 in HttpStateData::writeReplyBody() ()
</I>&gt;<i> #12 0x00005654ebdf1bd5 in HttpStateData::processReplyBody() ()
</I>&gt;<i> #13 0x00005654ebdf382a in HttpStateData::processReply() ()
</I>&gt;<i> #14 0x00005654ebdf4da8 in HttpStateData::readReply(CommIoCbParams
</I>&gt;<i> const&amp;) ()
</I>&gt;<i> #15 0x00005654ebdf8d6b in JobDialer&lt;HttpStateData&gt;::dial(AsyncCall&amp;) ()
</I>&gt;<i> #16 0x00005654ebf5be51 in AsyncCall::make() ()
</I>&gt;<i> #17 0x00005654ebf5d3a4 in AsyncCallQueue::fireNext() ()
</I>&gt;<i> #18 0x00005654ebf5d6e9 in AsyncCallQueue::fire() ()
</I>&gt;<i> #19 0x00005654ebdb98ea in EventLoop::runOnce() ()
</I>&gt;<i> #20 0x00005654ebdb99d8 in EventLoop::run() ()
</I>&gt;<i> #21 0x00005654ebe22ab9 in SquidMain(int, char**) ()
</I>&gt;<i> #22 0x00005654ebd13901 in main ()
</I>&gt;<i> (gdb)
</I>&gt;<i> 
</I>&gt;<i> I don't know where do those raise.c and raise.c belong (libthread? glibc?)
</I>&gt;<i> 
</I>&gt;<i> squid is stripped, i could probably compile it without stripping and re-try
</I>&gt;<i> 
</I>&gt;<i> Any ideas how to debug further? (disabling multi-cpu?)
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="021244.html">[squid-users] Fw: [Bug 4977] stmem.cc:98: &quot;lowestOffset () &lt;= target_offset&quot; assertion when adapting Content-Range value
</A></li>
	<LI>Next message (by thread): <A HREF="021246.html">[squid-users] Fw: [Bug 4977] stmem.cc:98: &quot;lowestOffset () &lt;= target_offset&quot; assertion when adapting Content-Range value
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21245">[ date ]</a>
              <a href="thread.html#21245">[ thread ]</a>
              <a href="subject.html#21245">[ subject ]</a>
              <a href="author.html#21245">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
