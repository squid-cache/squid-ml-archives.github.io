<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Cannot configure squid 4.6 to splice without bumping
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Cannot%20configure%20squid%204.6%20to%20splice%20without%0A%20bumping&In-Reply-To=%3C07da2884-cba9-7b89-1db8-4c30af9f3cac%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021247.html">
   <LINK REL="Next"  HREF="021249.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Cannot configure squid 4.6 to splice without bumping</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Cannot%20configure%20squid%204.6%20to%20splice%20without%0A%20bumping&In-Reply-To=%3C07da2884-cba9-7b89-1db8-4c30af9f3cac%40measurement-factory.com%3E"
       TITLE="[squid-users] Cannot configure squid 4.6 to splice without bumping">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Nov  5 14:02:07 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="021247.html">[squid-users] Cannot configure squid 4.6 to splice without bumping
</A></li>
        <LI>Next message (by thread): <A HREF="021249.html">[squid-users] Another &quot;Forwarding loop detected&quot; issue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21253">[ date ]</a>
              <a href="thread.html#21253">[ thread ]</a>
              <a href="subject.html#21253">[ subject ]</a>
              <a href="author.html#21253">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 11/5/19 1:26 AM, John Lowry wrote:

&gt;<i> I've tried many, many different settings and I always get traffic
</I>&gt;<i> bumped. Here is an example:
</I>
&gt;<i> http_port 3128 intercept&#160;
</I>&gt;<i> 
</I>&gt;<i> https_port 3129 intercept tls-cert=/etc/squid/ssl_cert/myCA.pem
</I>&gt;<i> tls-key=/etc/squid/ssl_cert/myCA.pem
</I>
The above configuration does not enable SslBump features.


&gt;<i> ssl_bump peek step1
</I>&gt;<i> ssl_bump peek step2
</I>&gt;<i> ssl_bump splice step2
</I>
These rules are poorly written (the last one will never match), but they
are unused because the port directives do not enable SslBump.

If an SSL connection is bumped (or even peeked at!) with the above
configuration, then there is a Squid bug somewhere. However, I do not
think your TLS connections are actually bumped. Please see below.


&gt;<i> I've tried setting debug_options to 9 but cannot see anything useful in
</I>&gt;<i> the logs to indicate why it is not splicing. I always just see the full
</I>&gt;<i> set of request headers in the logs for HTTPS connections, indicating
</I>&gt;<i> that the connection is bumped.&#160;
</I>
I suspect your Squid is acting as an intercepting HTTPS proxy: It
terminates all intercepted SSL connections as if they were directed at
the Squid instance itself. The end result will look similar to bumping
from &quot;I can see the headers&quot; point of view.

You may be able to tell the difference by looking at certificate
details: With an HTTPS proxy, all connections will have the same leaf
myCA.pem certificate as opposed to mimicked origin server certificate
signed by myCA.pem. There may be other, more obvious signs like the
details of the &quot;Accepting...&quot; lines that Squid reports at startup.


&gt;<i> One thing I did notice is that the ssl logformat options do not work. I
</I>&gt;<i> get errors like this on restart:
</I>
&gt;<i> FATAL: Can't parse configuration token: '%ssl::&gt;sni'
</I>
Was your Squid built with OpenSSL support? The details are
version-specific, but you can find them (and the configuration result)
using the following commands:

  ./configure --help | fgrep -5i ssl
  squid -v

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="021247.html">[squid-users] Cannot configure squid 4.6 to splice without bumping
</A></li>
	<LI>Next message (by thread): <A HREF="021249.html">[squid-users] Another &quot;Forwarding loop detected&quot; issue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21253">[ date ]</a>
              <a href="thread.html#21253">[ thread ]</a>
              <a href="subject.html#21253">[ subject ]</a>
              <a href="author.html#21253">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
