<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Header forgery detected
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Header%20forgery%20detected&In-Reply-To=%3C7311932e-2438-4733-a505-06b1cca19b93%40www.fastmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021273.html">
   <LINK REL="Next"  HREF="021275.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Header forgery detected</H1>
    <B>Darren Breeze</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Header%20forgery%20detected&In-Reply-To=%3C7311932e-2438-4733-a505-06b1cca19b93%40www.fastmail.com%3E"
       TITLE="[squid-users] Header forgery detected">darren at ksn-systems.com
       </A><BR>
    <I>Fri Nov  8 17:53:41 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="021273.html">[squid-users] [squid-announce] [ADVISORY] SQUID-2019:11 Information Disclosure issue in HTTP Digest Authentication
</A></li>
        <LI>Next message (by thread): <A HREF="021275.html">[squid-users] Header forgery detected
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21274">[ date ]</a>
              <a href="thread.html#21274">[ thread ]</a>
              <a href="subject.html#21274">[ subject ]</a>
              <a href="author.html#21274">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hi All

I am trying to set up squid 3.5 (have to stick with this version) to intercept and https bump / splice, it's all working OK with the exception of some elements of a https site failing to load (the browser just shows &quot;failed&quot;). matched with the failures, I see this type of message in the cache log. 

2019/11/08 17:39:46 kid1| SECURITY ALERT: Host header forgery detected on local=23.213.186.14:443 remote=172.16.3.250:57041 FD 28 flags=33 (local IP does not match any domain IP)
2019/11/08 17:39:46 kid1| SECURITY ALERT: on URL: static1.squarespace.com:443

172.16.3.250 is the clients PC address. 

doing a lookup on the hostname returns

<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at cbuild</A>:~/build/ksn-boot/cmake-build-debug/bin# nslookup
&gt;<i> server 127.0.0.1
</I>Default server: 127.0.0.1
Address: 127.0.0.1#53
&gt;<i> static1.squarespace.com
</I>Server: 127.0.0.1
Address: 127.0.0.1#53

Non-authoritative answer:
static1.squarespace.com canonical name = prod.squarespace.map.fastly.net.
Name: prod.squarespace.map.fastly.net
Address: 151.101.0.238
Name: prod.squarespace.map.fastly.net
Address: 151.101.64.238
Name: prod.squarespace.map.fastly.net
Address: 151.101.128.238
Name: prod.squarespace.map.fastly.net
Address: 151.101.192.238

so the address is different and points to a CDN endpoint 

14.186.213.23.in-addr.arpa name = a23-213-186-14.deploy.static.akamaitechnologies.com.


The host is ubuntu 18.04 and both squid and the client are using the DNS on the squid box. 

Can anyone please point me where I need to start looking

thanks in advance

Darren B.


This email and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are addressed. If you have received this email in error please notify the system manager. This message contains confidential information and is intended only for the individual named. If you are not the named addressee you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately by e-mail if you have received this e-mail by mistake and delete this e-mail from your system. If you are not the intended recipient you are notified that disclosing, copying, distributing or taking any action in reliance on the contents of this information is strictly prohibited.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20191109/664b4d01/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20191109/664b4d01/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="021273.html">[squid-users] [squid-announce] [ADVISORY] SQUID-2019:11 Information Disclosure issue in HTTP Digest Authentication
</A></li>
	<LI>Next message (by thread): <A HREF="021275.html">[squid-users] Header forgery detected
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21274">[ date ]</a>
              <a href="thread.html#21274">[ thread ]</a>
              <a href="subject.html#21274">[ subject ]</a>
              <a href="author.html#21274">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
