<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid and SSLBump
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20and%20SSLBump&In-Reply-To=%3CCALP3%3Dx-hi%3Dhet4ifP6WYJQWU3n9fM_CZYChvFGa213aQ6Sd_aA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021329.html">
   <LINK REL="Next"  HREF="021330.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid and SSLBump</H1>
    <B>Monah Baki</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20and%20SSLBump&In-Reply-To=%3CCALP3%3Dx-hi%3Dhet4ifP6WYJQWU3n9fM_CZYChvFGa213aQ6Sd_aA%40mail.gmail.com%3E"
       TITLE="[squid-users] Squid and SSLBump">monahbaki at gmail.com
       </A><BR>
    <I>Thu Nov 21 14:25:28 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="021329.html">[squid-users] yum update fails when using squid even though .redhat.com is whitelisted
</A></li>
        <LI>Next message (by thread): <A HREF="021330.html">[squid-users] Squid and SSLBump
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21327">[ date ]</a>
              <a href="thread.html#21327">[ thread ]</a>
              <a href="subject.html#21327">[ subject ]</a>
              <a href="author.html#21327">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all,

I'm trying to configure my Centos 7 running:
Squid Cache: Version 3.5.28
configure options:  '--with-openssl' '--enable-ssl-crtd'
--enable-ltdl-convenience

The certs/keys are legit from my company.

My squid.conf is very simple since it's for proof of concept

acl localnet src 10.0.0.0/8     # RFC1918 possible internal network
acl localnet src 172.16.0.0/12  # RFC1918 possible internal network
acl localnet src 192.168.0.0/16 # RFC1918 possible internal network
acl SSL_ports port 443
acl Safe_ports port 80          # http
acl Safe_ports port 21          # ftp
acl Safe_ports port 443         # https
acl Safe_ports port 70          # gopher
acl Safe_ports port 210         # wais
acl Safe_ports port 1025-65535  # unregistered ports
acl Safe_ports port 280         # http-mgmt
acl Safe_ports port 488         # gss-http
acl Safe_ports port 591         # filemaker
acl Safe_ports port 777         # multiling http
acl CONNECT method CONNECT
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow localhost manager
http_access deny manager
http_access allow localnet
http_access allow localhost
http_access deny all

# Squid normally listens to port 3128
http_port 172.16.84.242:3128 ssl-bump \
  cert=/etc/squid/certs/wildcardcert.pem \
  key=/etc/squid/certs/wildcardkey.pem \
  generate-host-certificates=on dynamic_cert_mem_cache_size=16MB
acl step1 at_step SSlBump1
ssl_bump peek step1
ssl_bump bump all
sslcrtd_program /usr/local/squid/libexec/ssl_crtd -s /var/lib/ssl_db -M 16MB
sslcrtd_children 32 startup=5 idle=1

cache_dir ufs /var/spool/squid 100 16 256
coredump_dir /var/spool/squid
refresh_pattern ^ftp:           1440    20%     10080
refresh_pattern ^gopher:        1440    0%      1440
refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
refresh_pattern .               0       20%     4320

strip_query_terms off
# logformat squid %&gt;a - %un [%{%d/%b/%Y:%H:%M:%S %z}tl] &quot;%rm %ru&quot; %Hs %st
&quot;%{Referer}&gt;h&quot; &quot;%{User-agent}&gt;h&quot;
logformat squid %ts.%03tu %6tr %&gt;a %Ss/%03&gt;Hs %&lt;st %rm %ru %un %Sh/%&lt;A %mt
[%&gt;h] [%&lt;h]
access_log  /var/log/squid/access.log squid


Browsing http sites works fine, but I am having issues with https

In my access.log I get:
1574346211.538     30 172.16.84.241 TAG_NONE/200 0 CONNECT www.cnn.com:443
- HIER_DIRECT/www.cnn.com - [User-Agent: Mozilla/5.0 (Windows NT 10.0;
WOW64; Trident/7.0; rv:11.0) like Gecko\r\nContent-Length: 0\r\nDNT:
1\r\nProxy-Connection: Keep-Alive\r\nPragma: no-cache\r\nHost:
www.cnn.com:443\r\n] [-]


In Internet explorer I get the following:

Certificate Error: Navigation Blocked
There is a problem with this website&#8217;s security certificate.


The security certificate presented by this website is not secure.

Security certificate problems may indicate an attempt to fool you or
intercept any data you send to the server.
  *We recommend that you close this webpage and do not continue to this
website.*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20191121/ce959f22/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20191121/ce959f22/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="021329.html">[squid-users] yum update fails when using squid even though .redhat.com is whitelisted
</A></li>
	<LI>Next message (by thread): <A HREF="021330.html">[squid-users] Squid and SSLBump
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21327">[ date ]</a>
              <a href="thread.html#21327">[ thread ]</a>
              <a href="subject.html#21327">[ subject ]</a>
              <a href="author.html#21327">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
