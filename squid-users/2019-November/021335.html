<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] logformat for requests using PROXY protocol
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20logformat%20for%20requests%20using%20PROXY%20protocol&In-Reply-To=%3CCAKZYigHHW8iJpMb3FnpbkeB_dAFs_OiUbJ4dBaJJ1kQMc2hRWQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021334.html">
   <LINK REL="Next"  HREF="021306.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] logformat for requests using PROXY protocol</H1>
    <B>Chammi Kumarapathirage</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20logformat%20for%20requests%20using%20PROXY%20protocol&In-Reply-To=%3CCAKZYigHHW8iJpMb3FnpbkeB_dAFs_OiUbJ4dBaJJ1kQMc2hRWQ%40mail.gmail.com%3E"
       TITLE="[squid-users] logformat for requests using PROXY protocol">chammidhan at gmail.com
       </A><BR>
    <I>Fri Nov 22 20:45:11 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="021334.html">[squid-users] logformat for requests using PROXY protocol
</A></li>
        <LI>Next message (by thread): <A HREF="021306.html">[squid-users] ecap trickling (antivirus scan)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21335">[ date ]</a>
              <a href="thread.html#21335">[ thread ]</a>
              <a href="subject.html#21335">[ subject ]</a>
              <a href="author.html#21335">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks for the response Amos. This is an AWS Fargate instance and I'm not
exactly sure how patching works in that space. I'm rather new to both
serverless concept and Squid. I will research this and get back to you.
Thanks!

On Friday, November 22, 2019, Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; wrote:

&gt;<i> On 22/11/19 4:05 pm, Chammi Kumarapathirage wrote:
</I>&gt;<i> &gt; I have my logformat as follows.
</I>&gt;<i> &gt; logformat jsonformat {&quot;Client Hostname&quot;:&quot;%&gt;A&quot;,&quot;Source IP&quot;:&quot;%&gt;a&quot;,&quot;HTTP
</I>&gt;<i> &gt; Method&quot;:&quot;%rm&quot;,&quot;HTTP Protocol version&quot;:&quot;%rv&quot;,&quot;Request
</I>&gt;<i> &gt; Domain&quot;:&quot;%&gt;rd&quot;,&quot;Port&quot;:&quot;%&gt;rP&quot;,&quot;User Agent&quot;:&quot;%{User-Agent}&gt;h&quot;,&quot;Request
</I>&gt;<i> &gt; Size&quot;:&quot;%&gt;st&quot;,&quot;Reply Size&quot;:&quot;%&lt;st&quot;,&quot;Response Time(ms)&quot;:&quot;%tr&quot;,&quot;Status
</I>&gt;<i> &gt; Code&quot;:&quot;%&gt;Hs&quot;,&quot;Request Status&quot;:&quot;%Ss&quot;,&quot;Server FQDN&quot;:&quot;%&lt;A&quot;}
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The proxy is sitting behind a load balancer in AWS and Proxy Protocol V2
</I>&gt;<i> &gt; is enabled on both the LB and Squid. Everything seems to work fine. I
</I>&gt;<i> &gt; can create rules based on source IP of the client. However. I want to be
</I>&gt;<i> &gt; able to  create rules based on the hostname of the original client. But
</I>&gt;<i> &gt; it doesn't seem that Squid sees the original client's hostname. Rather
</I>&gt;<i> &gt; it takes the hostname of the LB as seen by below log.
</I>&gt;<i>
</I>&gt;<i> The %&gt;A log code is still tied to old logging state instead of the IP
</I>&gt;<i> values updated by PROXY protocol.
</I>&gt;<i>
</I>&gt;<i> The only way I can see to log that value without patching Squid is with
</I>&gt;<i> something complicated like an external_acl_type helper to do the lookup
</I>&gt;<i> and supply it as a tag or note to Squid.
</I>&gt;<i>
</I>&gt;<i> If you are happy to patch I can make a PR for you to try.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20191123/e7016fba/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20191123/e7016fba/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="021334.html">[squid-users] logformat for requests using PROXY protocol
</A></li>
	<LI>Next message (by thread): <A HREF="021306.html">[squid-users] ecap trickling (antivirus scan)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21335">[ date ]</a>
              <a href="thread.html#21335">[ thread ]</a>
              <a href="subject.html#21335">[ subject ]</a>
              <a href="author.html#21335">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
