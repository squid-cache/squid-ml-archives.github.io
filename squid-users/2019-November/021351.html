<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] What is the proper way to close an ICAP transaction?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20What%20is%20the%20proper%20way%20to%20close%20an%20ICAP%20transaction%3F&In-Reply-To=%3CCADcj3%3D5-SWRAZBJcPX1V5osf1%3Dhn25Bcw_6kqSp1%2BRJQkqHppg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021347.html">
   <LINK REL="Next"  HREF="021354.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] What is the proper way to close an ICAP transaction?</H1>
    <B>Felipe Arturo Polanco</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20What%20is%20the%20proper%20way%20to%20close%20an%20ICAP%20transaction%3F&In-Reply-To=%3CCADcj3%3D5-SWRAZBJcPX1V5osf1%3Dhn25Bcw_6kqSp1%2BRJQkqHppg%40mail.gmail.com%3E"
       TITLE="[squid-users] What is the proper way to close an ICAP transaction?">felipeapolanco at gmail.com
       </A><BR>
    <I>Tue Nov 26 15:15:33 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="021347.html">[squid-users] Help with squid proxy parent directive
</A></li>
        <LI>Next message (by thread): <A HREF="021354.html">[squid-users] What is the proper way to close an ICAP	transaction?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21351">[ date ]</a>
              <a href="thread.html#21351">[ thread ]</a>
              <a href="subject.html#21351">[ subject ]</a>
              <a href="author.html#21351">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

We have an ICAP server for Squid 4.

While we can successfully scan our files and do content adaptation, we have
been struggling to find a way to close the ICAP transaction before passing
the whole body back to squid and at the same time avoid squid marking one
icap failure.

This is for an ICAP server that does Virus scanning and if virus found, the
body is not sent back.

If we send an ICAP header with 500 then Squid mark us as ICAP FAILURE, if
we don't send anything then Squid keeps awaiting on us and then timeout,
increasing the icap failure counter by one and so on.

At some point squid just mark the server as down and stop sending
transactions to it.

We have been overcoming this by having a low OPTIONs TTL but that seems
inefficient for high traffic squid nodes.

Does anyone know how to proceed with this?

Thanks,
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20191126/fd493614/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20191126/fd493614/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="021347.html">[squid-users] Help with squid proxy parent directive
</A></li>
	<LI>Next message (by thread): <A HREF="021354.html">[squid-users] What is the proper way to close an ICAP	transaction?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21351">[ date ]</a>
              <a href="thread.html#21351">[ thread ]</a>
              <a href="subject.html#21351">[ subject ]</a>
              <a href="author.html#21351">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
