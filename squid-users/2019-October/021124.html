<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Annotating transaction from inside ICAP
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Annotating%20transaction%20from%20inside%20ICAP&In-Reply-To=%3C8283a238-e965-d5e0-e723-d0db989af205%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021123.html">
   <LINK REL="Next"  HREF="021125.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Annotating transaction from inside ICAP</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Annotating%20transaction%20from%20inside%20ICAP&In-Reply-To=%3C8283a238-e965-d5e0-e723-d0db989af205%40measurement-factory.com%3E"
       TITLE="[squid-users] Annotating transaction from inside ICAP">rousskov at measurement-factory.com
       </A><BR>
    <I>Wed Oct  2 19:21:18 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="021123.html">[squid-users] Annotating transaction from inside ICAP
</A></li>
        <LI>Next message (by thread): <A HREF="021125.html">[squid-users] Guidance needed. Issues with WPAD and Firefox
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21124">[ date ]</a>
              <a href="thread.html#21124">[ thread ]</a>
              <a href="subject.html#21124">[ subject ]</a>
              <a href="author.html#21124">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 10/2/19 2:51 PM, johnr wrote:

&gt;<i> I was wondering how / if it was possible to annotate a request from 
</I>&gt;<i> within an ICAP service.
</I>
A long-term solution requires two steps:

1. Modify your ICAP service to return a custom ICAP response header.

2. Modify Squid to treat ICAP response headers (with names listed in a
new squid.conf directive) as master transaction annotations.

Squid eCAP implementation already treats eCAP response metadata as
annotations, but there is no such code in ICAP yet IIRC. The ICAP use
case is complicated by the fact that not all ICAP response headers
should become annotations by default, but it is not very difficult to
add this configuration support (and it can be useful for eCAP
transactions as a way to tell Squid whether the metadata should annotate
the connection or just the current master transaction.


&gt;<i> My use-case is that I would like to add a note with information about
</I>&gt;<i> the request that is then available for use within external helpers. I
</I>&gt;<i> believe I can do a similar type of information share by setting HTTP
</I>&gt;<i> headers from within ICAP and reading them from the external helpers,
</I>&gt;<i> but that seems to be a bit more clunky of an approach.
</I>
Exactly. This workaround requires adapting the HTTP message (an
expensive and sometimes dangerous operation) as well as removing the
customer headers from outgoing messages using request_header_access (or
reply_header_access).


HTH,

Alex.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="021123.html">[squid-users] Annotating transaction from inside ICAP
</A></li>
	<LI>Next message (by thread): <A HREF="021125.html">[squid-users] Guidance needed. Issues with WPAD and Firefox
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21124">[ date ]</a>
              <a href="thread.html#21124">[ thread ]</a>
              <a href="subject.html#21124">[ subject ]</a>
              <a href="author.html#21124">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
