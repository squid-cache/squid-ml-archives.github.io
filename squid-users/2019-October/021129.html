<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Guidance needed. Issues with WPAD and Firefox
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Guidance%20needed.%20Issues%20with%20WPAD%20and%20Firefox&In-Reply-To=%3CCACXMG%2BuGAjm8Co7J3sxFv2ogrcbxZJYd6vbqtoJDM%2Bq5a%2Bd3-g%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021128.html">
   <LINK REL="Next"  HREF="021130.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Guidance needed. Issues with WPAD and Firefox</H1>
    <B>Erick Perez - Quadrian Enterprises</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Guidance%20needed.%20Issues%20with%20WPAD%20and%20Firefox&In-Reply-To=%3CCACXMG%2BuGAjm8Co7J3sxFv2ogrcbxZJYd6vbqtoJDM%2Bq5a%2Bd3-g%40mail.gmail.com%3E"
       TITLE="[squid-users] Guidance needed. Issues with WPAD and Firefox">eperez at quadrianweb.com
       </A><BR>
    <I>Thu Oct  3 08:35:22 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="021128.html">[squid-users] Guidance needed. Issues with WPAD and Firefox
</A></li>
        <LI>Next message (by thread): <A HREF="021130.html">[squid-users] IE and EDGE and Microsoft yammer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21129">[ date ]</a>
              <a href="thread.html#21129">[ thread ]</a>
              <a href="subject.html#21129">[ subject ]</a>
              <a href="author.html#21129">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, Oct 3, 2019, 2:07 AM Erick Perez - Quadrian Enterprises &lt;
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eperez at quadrianweb.com</A>&gt; wrote:

&gt;<i> On Thu, Oct 3, 2019 at 12:45 AM Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On 3/10/19 5:55 pm, Erick Perez - Quadrian Enterprises wrote:
</I>&gt;<i> &gt; &gt; On Wed, Oct 2, 2019 at 10:47 PM Erick Perez - Quadrian Enterprises
</I>&gt;<i> wrote:
</I>&gt;<i> &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; Hi, maybe somebody here experienced the same issues while working with
</I>&gt;<i> &gt; &gt;&gt; WPAD files.
</I>&gt;<i> &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; I have a working Centos 7.6/SQUID v4.8 that works as expected.
</I>&gt;<i> &gt; &gt;&gt; It works as long as I manually configure the proxy in the network
</I>&gt;<i> &gt; &gt;&gt; settings of each workstation (windows) firefox browser 69.0.1 (64bit)
</I>&gt;<i> &gt; &gt;&gt; and the same behavior with IE and Chrome.
</I>&gt;<i> &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; if I open <A HREF="http://squid_fqdn/wpad.dat">http://squid_fqdn/wpad.dat</A> the file gets downloaded and has
</I>&gt;<i> &gt; &gt;&gt; all the info.
</I>&gt;<i> &gt; &gt;&gt; apache logs show me the client is properly connecting and requesting
</I>&gt;<i> the file.
</I>&gt;<i> &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; the wpad.dat has two lines
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; That is one problem. The PAC file is supposed to define a fully formed
</I>&gt;<i> &gt; function like so:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; function FindProxyForURL(url, host) {
</I>&gt;<i> &gt;   if (isPlainHostName(host)) return &quot;DIRECT&quot;;
</I>&gt;<i> &gt;     return &quot;PROXY squid_fqdn:8080&quot;;}
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; You also need to ensure the web server is producing the HTTP response
</I>&gt;<i> &gt; with a &quot;Content-Type: application/x-ns-proxy-autoconfig&quot; header or it
</I>&gt;<i> &gt; will fail.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; see &lt;<A HREF="http://findproxyforurl.com/">http://findproxyforurl.com/</A>&gt; for more info about WPAD/PAC.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Amos
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; squid-users mailing list
</I>&gt;<i> &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> &gt; <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>&gt;<i> So sorry Amos,
</I>&gt;<i> actually the function is implemented properly. I just didnt paste it
</I>&gt;<i> And yes, wireshark shows me HTTP/1.1 200 OK
</I>&gt;<i> (application/x-ns-proxy-autoconfig)
</I>&gt;<i> I followed this document: <A HREF="https://www.giantstride.eu/proxy-autodiscovery/">https://www.giantstride.eu/proxy-autodiscovery/</A>
</I>&gt;<i> I created wpad CNAME in DNS that points to squidfqdn
</I>&gt;<i> I created option 252 in DHCP
</I>&gt;<i> and also unblocked wpad block in DNS according to same document
</I>&gt;<i> <A HREF="https://www.giantstride.eu/proxy-autodiscovery/">https://www.giantstride.eu/proxy-autodiscovery/</A>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i>
</I>---------------------
&gt;<i> Erick Perez
</I>&gt;<i>
</I>
Well, I believe it is because is 3:26am here and I am tired.

The issue was that Wpad.dat file was not being processed properly.

So, I opened another wpad from a working implementation and compared it.

They were the same EXCEPT that my non working file had some &quot;white spaces&quot;
at the end.
 It makes no sense for me (I'm mostly a Windows guy) but I removed the
empty spaces and the file was loaded and interpreted correctly.

I'm not sure if the problem is that Apache was serving the file with some
issues or if the browser was misinterpreting the file.

But it is working now.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20191003/01700527/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20191003/01700527/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="021128.html">[squid-users] Guidance needed. Issues with WPAD and Firefox
</A></li>
	<LI>Next message (by thread): <A HREF="021130.html">[squid-users] IE and EDGE and Microsoft yammer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21129">[ date ]</a>
              <a href="thread.html#21129">[ thread ]</a>
              <a href="subject.html#21129">[ subject ]</a>
              <a href="author.html#21129">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
