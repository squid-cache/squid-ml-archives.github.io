<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Clarification on behavior
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Clarification%20on%20behavior&In-Reply-To=%3C4b35ce30-36b6-ac39-5c59-e72088ef3c41%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021150.html">
   <LINK REL="Next"  HREF="021151.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Clarification on behavior</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Clarification%20on%20behavior&In-Reply-To=%3C4b35ce30-36b6-ac39-5c59-e72088ef3c41%40measurement-factory.com%3E"
       TITLE="[squid-users] Clarification on behavior">rousskov at measurement-factory.com
       </A><BR>
    <I>Thu Oct 10 22:06:49 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="021150.html">[squid-users] Clarification on behavior
</A></li>
        <LI>Next message (by thread): <A HREF="021151.html">[squid-users] Icap redirection issues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21154">[ date ]</a>
              <a href="thread.html#21154">[ thread ]</a>
              <a href="subject.html#21154">[ subject ]</a>
              <a href="author.html#21154">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 10/10/19 10:43 AM, Joseph Jones wrote:

&gt;<i> I've recently noticed is based on my current config it's possible to
</I>&gt;<i> make a request through squid to an HTTPS endpoint with out doing a
</I>&gt;<i> CONNECT request.
</I>

&gt;<i> I was wondering if this should be allowed behavior for a proxy or if
</I>&gt;<i> it's just a business requirement to deny that type of request or if
</I>&gt;<i> that behavior shouldn't be allowed anyway.
</I>
This is not a protocol issue: There are Squid deployments where &quot;GET
<A HREF="https://...">https://...</A>&quot; requests are perfectly normal, and there are Squid
deployments where such requests must be blocked. Configure your Squid to
match your environment.


&gt;<i> My concern being if squid is deployed in an environment that has
</I>&gt;<i> PCI/PII data I wouldn't want squid to hold that data decrypted even
</I>&gt;<i> for a little while and the client should have encrypted tunnel
</I>&gt;<i> through to the server.
</I>

&gt;<i> I'm wonder if my extra access rule of http_access deny SSL_PORTS
</I>&gt;<i> !CONNECT is sufficient enough to make sure squid doesn't decrypt the
</I>&gt;<i> response.
</I>
&gt;<i> http_access deny CONNECT !SSL_ports
</I>&gt;<i> http_access deny SSL_PORTS !CONNECT
</I>
The above does not deny &quot;GET <A HREF="https://example.com:80/">https://example.com:80/</A>&quot;. That may be OK in
your setup because there are no TLS servers on port 80 behind your
Squid, but, in general, it is not enough to prevent Squid decryption. If
you want to follow this path, you probably want access rules based on
request-target (a.k.a. URI) scheme -- prohibit requests with an &quot;https:&quot;
scheme.

If you do not want Squid to decrypt, consider building Squid without
OpenSSL (and GnuTLS) support. That way, if something slips past your
rules (for any reason), you can still be sure that Squid will not
decrypt anything.


HTH,

Alex.


&gt;<i> acl SSL_ports port 443
</I>&gt;<i> acl Safe_ports port 80    # http
</I>&gt;<i> acl Safe_ports port 8080  # http
</I>&gt;<i> acl Safe_ports port 443   # https
</I>
&gt;<i> # Deny requests to certain unsafe ports
</I>&gt;<i> http_access deny !Safe_ports
</I>&gt;<i> 
</I>&gt;<i> # Deny CONNECT to other than secure SSL ports
</I>&gt;<i> http_access deny CONNECT !SSL_ports
</I>&gt;<i> 
</I>&gt;<i> http_access deny SSL_Ports !CONNECT
</I>&gt;<i> 
</I>&gt;<i> http_access deny http_blacklist
</I>&gt;<i> http_access allow http_whitelist
</I>&gt;<i> 
</I>&gt;<i> http_access deny CONNECT http_blacklist
</I>&gt;<i> http_access allow CONNECT http_whitelist
</I>&gt;<i> 
</I>&gt;<i> http_access deny all
</I>&gt;<i> 
</I>&gt;<i> # disable caching
</I>&gt;<i> cache deny all
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> # Squid normally listens to port 3128
</I>&gt;<i> http_port 3128
</I>&gt;<i> visible_hostname squid
</I>&gt;<i> 
</I>&gt;<i> # Uncomment and adjust the following to add a disk cache directory.
</I>&gt;<i> cache_mem 0
</I>&gt;<i> # cache_dir rock /home/josepjones/.local/squid/var/spool 100
</I>&gt;<i> 
</I>&gt;<i> # Leave coredumps in the first cache dir
</I>&gt;<i> coredump_dir /home/josepjones/.local/squid
</I>&gt;<i> 
</I>&gt;<i> --&#160;
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Joseph M Jones
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="021150.html">[squid-users] Clarification on behavior
</A></li>
	<LI>Next message (by thread): <A HREF="021151.html">[squid-users] Icap redirection issues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21154">[ date ]</a>
              <a href="thread.html#21154">[ thread ]</a>
              <a href="subject.html#21154">[ subject ]</a>
              <a href="author.html#21154">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
