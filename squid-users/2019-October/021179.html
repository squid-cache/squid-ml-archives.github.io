<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] SSL negotiation errors on https_port
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL%20negotiation%20errors%20on%20https_port&In-Reply-To=%3Cbd894c8473925a91e05edd8eb11617eee8d72e3b.camel%40lists.microscopium.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021189.html">
   <LINK REL="Next"  HREF="021181.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] SSL negotiation errors on https_port</H1>
    <B>Robert</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL%20negotiation%20errors%20on%20https_port&In-Reply-To=%3Cbd894c8473925a91e05edd8eb11617eee8d72e3b.camel%40lists.microscopium.de%3E"
       TITLE="[squid-users] SSL negotiation errors on https_port">rs-squid at lists.microscopium.de
       </A><BR>
    <I>Thu Oct 17 20:52:14 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="021189.html">[squid-users] SIGBUS attempting to use rock
</A></li>
        <LI>Next message (by thread): <A HREF="021181.html">[squid-users] SSL negotiation errors on https_port
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21179">[ date ]</a>
              <a href="thread.html#21179">[ thread ]</a>
              <a href="subject.html#21179">[ subject ]</a>
              <a href="author.html#21179">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi there,

I have configured squid's https_port for client certificate
authorization:

https_port [2001:XXX:XX:XXX::2]:8008 cert=/etc/ssl/private/mydomain_de/mydomain_de.crt key=/etc/ssl/private/mydomain_de/mydomain_de.key clientca=/etc/squid/ssl-proxy/ca.crt tls-dh=/etc/squid/ssl/dh_2048.pem

This works as expected. Clients connect via client side stunnel4 using
their individual client certificates.

However, I see many lines like these in the cache.log file:

2019/10/17 22:38:33.552 kid1| Error negotiating SSL connection on FD 44: error:00000001:lib(0):func(0):reason(1) (1/-1)
2019/10/17 22:38:41.619 kid1| Error negotiating SSL connection on FD 37: error:00000001:lib(0):func(0):reason(1) (1/-1)
2019/10/17 22:38:42.174 kid1| Error negotiating SSL connection on FD 40: error:00000001:lib(0):func(0):reason(1) (1/-1)
2019/10/17 22:38:42.312 kid1| Error negotiating SSL connection on FD 42: error:00000001:lib(0):func(0):reason(1) (1/-1)
2019/10/17 22:38:42.507 kid1| Error negotiating SSL connection on FD 44: error:00000001:lib(0):func(0):reason(1) (1/-1)
2019/10/17 22:38:46.755 kid1| Error negotiating SSL connection on FD 48: error:00000001:lib(0):func(0):reason(1) (1/-1)
2019/10/17 22:38:46.763 kid1| Error negotiating SSL connection on FD 58: error:00000001:lib(0):func(0):reason(1) (1/-1)
2019/10/17 22:38:46.771 kid1| Error negotiating SSL connection on FD 48: error:00000001:lib(0):func(0):reason(1) (1/-1)
2019/10/17 22:38:50.306 kid1| Error negotiating SSL connection on FD 77: error:00000001:lib(0):func(0):reason(1) (1/-1)
2019/10/17 22:38:50.314 kid1| Error negotiating SSL connection on FD 80: error:00000001:lib(0):func(0):reason(1) (1/-1)
2019/10/17 22:38:50.324 kid1| Error negotiating SSL connection on FD 77: error:00000001:lib(0):func(0):reason(1) (1/-1)
2019/10/17 22:40:01.898 kid1| Error negotiating SSL connection on FD 13: error:00000001:lib(0):func(0):reason(1) (1/-1)

Increasing debug output tells me that SSL negotiation fails and then
succeeds, but I have no idea what causes these failures. Is it just
related to the ssl handshake and not to worry about? If so, why is that
reported to the logs? Setting min and max TLS version on the client
does not change the log outpu. TLS version used is 1.3 if allowed on
the client.

Thanks for clarification,

Robert 


-- 
Robert Senger



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="021189.html">[squid-users] SIGBUS attempting to use rock
</A></li>
	<LI>Next message (by thread): <A HREF="021181.html">[squid-users] SSL negotiation errors on https_port
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21179">[ date ]</a>
              <a href="thread.html#21179">[ thread ]</a>
              <a href="subject.html#21179">[ subject ]</a>
              <a href="author.html#21179">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
