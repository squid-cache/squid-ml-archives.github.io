<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] SIGBUS attempting to use rock
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SIGBUS%20attempting%20to%20use%20rock&In-Reply-To=%3C58f2af4a-a3b3-2b5a-41b3-e01ae3c5ec36%40spawn.link%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021178.html">
   <LINK REL="Next"  HREF="021182.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] SIGBUS attempting to use rock</H1>
    <B>Antonio SJ Musumeci</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SIGBUS%20attempting%20to%20use%20rock&In-Reply-To=%3C58f2af4a-a3b3-2b5a-41b3-e01ae3c5ec36%40spawn.link%3E"
       TITLE="[squid-users] SIGBUS attempting to use rock">trapexit at spawn.link
       </A><BR>
    <I>Thu Oct 17 21:07:58 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="021178.html">[squid-users] SIGBUS attempting to use rock
</A></li>
        <LI>Next message (by thread): <A HREF="021182.html">[squid-users] SIGBUS attempting to use rock
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21180">[ date ]</a>
              <a href="thread.html#21180">[ thread ]</a>
              <a href="subject.html#21180">[ subject ]</a>
              <a href="author.html#21180">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm currently unable to test fully due to my environment lacking 
CAP_IPC_LOCK. It does fail more gracefully saying it can't use mlock at all.

That said... the option is listed in relation to SMP and not referenced 
by rock docs. Also it should be possible to check /dev/shm's free space 
and compare that against the file size needed. Clearly it knows based on 
the requested storage and slot sizes. Even a guess with a warning rather 
than leaving it to fail otherwise silently with a SIGBUS.

On 10/17/2019 2:53 PM, Alex Rousskov wrote:
&gt;<i> On 10/17/19 12:28 PM, Antonio SJ Musumeci wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> After a lot of tinkering and turning on full debug I realized the reason
</I>&gt;&gt;<i> rock was failing for me in my container was due to the small default SHM
</I>&gt;&gt;<i> size allocated by Docker. Increasing the SHM size with `--shm-size`
</I>&gt;&gt;<i> fixed the issue.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> It'd be significantly more helpful if the Squid reported precisely what
</I>&gt;&gt;<i> the issue and exited gracefully rather than SIGBUS'ing.
</I>&gt;<i> Does enabling shared_memory_locking in squid.conf trigger the behavior
</I>&gt;<i> you want?
</I>&gt;<i>
</I>&gt;<i> If yes, then you may be wondering why this is not the default setting.
</I>&gt;<i> The answer is in the following two squid-dev messages. Message [1] is a
</I>&gt;<i> high-level description. Message [2] contains more low-level details and
</I>&gt;<i> examples of ~60 second startup delays that locking may cause.
</I>&gt;<i>
</I>&gt;<i> [1] <A HREF="http://lists.squid-cache.org/pipermail/squid-dev/2016-March/005260.html">http://lists.squid-cache.org/pipermail/squid-dev/2016-March/005260.html</A>
</I>&gt;<i>
</I>&gt;<i> [2]
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/pipermail/squid-dev/2015-December/004112.html">http://lists.squid-cache.org/pipermail/squid-dev/2015-December/004112.html</A>
</I>&gt;<i>
</I>&gt;<i> Enhancing shared memory management (e.g., implementing ideas mentioned
</I>&gt;<i> in the &quot;As we gain more experience&quot; paragraph of [1]) is welcomed.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> HTH,
</I>&gt;<i>
</I>&gt;<i> Alex.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="021178.html">[squid-users] SIGBUS attempting to use rock
</A></li>
	<LI>Next message (by thread): <A HREF="021182.html">[squid-users] SIGBUS attempting to use rock
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21180">[ date ]</a>
              <a href="thread.html#21180">[ thread ]</a>
              <a href="subject.html#21180">[ subject ]</a>
              <a href="author.html#21180">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
