<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Call for adaptation after sni peeked
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Call%20for%20adaptation%20after%20sni%20peeked&In-Reply-To=%3Cdec5c19f-be1d-f6f3-eda2-5c0d8b96f492%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021206.html">
   <LINK REL="Next"  HREF="021209.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Call for adaptation after sni peeked</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Call%20for%20adaptation%20after%20sni%20peeked&In-Reply-To=%3Cdec5c19f-be1d-f6f3-eda2-5c0d8b96f492%40measurement-factory.com%3E"
       TITLE="[squid-users] Call for adaptation after sni peeked">rousskov at measurement-factory.com
       </A><BR>
    <I>Wed Oct 23 20:55:07 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="021206.html">[squid-users] Call for adaptation after sni peeked
</A></li>
        <LI>Next message (by thread): <A HREF="021209.html">[squid-users] Call for adaptation after sni peeked
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21207">[ date ]</a>
              <a href="thread.html#21207">[ thread ]</a>
              <a href="subject.html#21207">[ subject ]</a>
              <a href="author.html#21207">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 10/23/19 3:37 PM, Jatin Bhasin wrote:

&gt;<i> This question is related to ssl decryption and ecap adaptation call.&#160;
</I>&gt;<i> When the ssl connection starts then before it even extracts sni squid sends&#160;
</I>&gt;<i> fakeConnect which comes to ecap as well.
</I>
Yes, this happens during SslBump step1 as described at
<A HREF="https://wiki.squid-cache.org/Features/SslPeekAndSplice">https://wiki.squid-cache.org/Features/SslPeekAndSplice</A>


&gt;<i> I am using peek in step 1 and after fakeConnect squid extracts the sni,
</I>&gt;<i> but at this point squid does not make another call to ecap.
</I>
According to the above wiki page (and my understanding of how SslBump
should work), Squid should make another adaptation pass during step2.
You may want to make sure that your Squid does not discover some error
_before_ it can start doing eCAP during step2.

If your eCAP service does not see the second CONNECT (during step2), I
suggest using the latest Squid v4 with the following &quot;minimal&quot; SslBump
configuration:

    ssl_bump peek step1
    ssl_bump splice all

Does the above work without problems when eCAP is turned off?

Does the above deliver the second CONNECT to eCAP when it is enabled?


&gt;<i> This function in squid is startPeekAndSpliceDone in file
</I>&gt;<i> client_side.cc
</I>

We should not be discussing code details on squid-users, but the latest
Squid v4 does not have that function AFAICT:

&gt;<i> $ git grep startPeekAndSpliceDone SQUID_4_8 | wc -l
</I>&gt;<i> 0
</I>

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="021206.html">[squid-users] Call for adaptation after sni peeked
</A></li>
	<LI>Next message (by thread): <A HREF="021209.html">[squid-users] Call for adaptation after sni peeked
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21207">[ date ]</a>
              <a href="thread.html#21207">[ thread ]</a>
              <a href="subject.html#21207">[ subject ]</a>
              <a href="author.html#21207">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
