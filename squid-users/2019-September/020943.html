<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Cant open some HTTPS with Squid 4.8
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Cant%20open%20some%20HTTPS%20with%20Squid%204.8&In-Reply-To=%3C1567511229549-0.post%40n4.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020954.html">
   <LINK REL="Next"  HREF="020951.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Cant open some HTTPS with Squid 4.8</H1>
    <B>KOTOXJle6</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Cant%20open%20some%20HTTPS%20with%20Squid%204.8&In-Reply-To=%3C1567511229549-0.post%40n4.nabble.com%3E"
       TITLE="[squid-users] Cant open some HTTPS with Squid 4.8">23dmitry23 at gmail.com
       </A><BR>
    <I>Tue Sep  3 11:47:09 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020954.html">[squid-users] help with helper
</A></li>
        <LI>Next message (by thread): <A HREF="020951.html">[squid-users] Cant open some HTTPS with Squid 4.8
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20943">[ date ]</a>
              <a href="thread.html#20943">[ thread ]</a>
              <a href="subject.html#20943">[ subject ]</a>
              <a href="author.html#20943">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Im trying to setup Squid 4.8 on Ubuntu 18.04 LTS with HTTPS redirecting to
squid error page for sites in ACL's. Yesterday i faced major problem HTTPS
sites doesnt open normally in IE11/EDGE and show blank page only + squid
replace certificate. If i tap F5, sometimes site opens like it should and
certificate replacement doesnt happen...and it works not for all sites. I
couldn't pinpoint the dependencies. I also can open some sites like
rambler.ru, kanobu.ru, alexa.com normally. The most interesting thing is
that other browsers like Chrome, FF and even Opera open all sites like it
should and spoof cert + redirect to error page only if site persist in ACL.

What i already did:
- Disabled IPv6 on Squid host
- Disabled/Enabled TLS in IE in any variations
- Disabled SPDY/3

Bump settings in squid.conf:

/http_port 3128 ssl-bump generate-host-certificates=on
dynamic_cert_mem_cache_size=4MB cert=/etc/squid/squidCA.pem
ssl_bump peek all/

I have this errors in /var/log/squid/cache.log

/ERROR: negotiating TLS on FD 46: error:1425F175:SSL
routines:ssl_choose_client_version:inappropriate fallback (1/-1/0)/

/ERROR: negotiating TLS on FD 104: error:14094410:SSL
routines:ssl3_read_bytes:sslv3 alert handshake failure (1/-1/0)
/

/ERROR: negotiating TLS on FD 27: error:1423406E:SSL
routines:tls_parse_stoc_sct:bad extension (1/-1/0)/

Error in access.log

/TCP_DENIED/407 4141 CONNECT i.ibb.co:443 - HIER_NONE/- text/html/

Same configuration work well on Squid 4.1. 

Sorry for complicated description, im new here and its really hard f or me.



--
Sent from: <A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html">http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html</A>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020954.html">[squid-users] help with helper
</A></li>
	<LI>Next message (by thread): <A HREF="020951.html">[squid-users] Cant open some HTTPS with Squid 4.8
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20943">[ date ]</a>
              <a href="thread.html#20943">[ thread ]</a>
              <a href="subject.html#20943">[ subject ]</a>
              <a href="author.html#20943">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
