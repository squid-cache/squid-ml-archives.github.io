<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Cant open some HTTPS with Squid 4.8
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Cant%20open%20some%20HTTPS%20with%20Squid%204.8&In-Reply-To=%3C1567529401506-0.post%40n4.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020951.html">
   <LINK REL="Next"  HREF="020952.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Cant open some HTTPS with Squid 4.8</H1>
    <B>KOTOXJle6</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Cant%20open%20some%20HTTPS%20with%20Squid%204.8&In-Reply-To=%3C1567529401506-0.post%40n4.nabble.com%3E"
       TITLE="[squid-users] Cant open some HTTPS with Squid 4.8">23dmitry23 at gmail.com
       </A><BR>
    <I>Tue Sep  3 16:50:01 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020951.html">[squid-users] Cant open some HTTPS with Squid 4.8
</A></li>
        <LI>Next message (by thread): <A HREF="020952.html">[squid-users] Cant open some HTTPS with Squid 4.8
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20957">[ date ]</a>
              <a href="thread.html#20957">[ thread ]</a>
              <a href="subject.html#20957">[ subject ]</a>
              <a href="author.html#20957">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Amos Jeffries wrote
&gt;<i> Huh? what is &quot;only if site persist in ACL&quot; meaning?
</I>
Ill try to explain by example. I have 2 ACL - blockvideo and blockvpn, they
contain urls for video hostings and vpn services. This ACLs appyed to domain
groups blockvideo and blockvpn. I have 2 users - adm1 and user1. User1 is a
member of both groups and adm1 is not. 
When user1 trying to open any sites from acls (even https), he should be
redirected to squid error page wich tells him that access restricted and he
should contact local administrator.


Amos Jeffries wrote
&gt;<i> Any of the above errors may occur when connecting a specific client to a
</I>&gt;<i> specific server. SSL-Bump is riding the fine line of capability/feature
</I>&gt;<i> matching between three TLS/SSL librarys and the software using them -
</I>&gt;<i> two sets of which are remote machinery.
</I>&gt;<i>  All of the above errors (and more) will result in the symptoms you
</I>&gt;<i> describe happening. If you don't already know what they mean, use your
</I>&gt;<i> favourite search engine. They are quite common and well explained
</I>&gt;<i> already by others.
</I>
At this point I realized that the problem is not in the browser settings.


Amos Jeffries wrote
&gt;<i> To make any real progress you (or someone) will need to view the TLS
</I>&gt;<i> Hello exchanges happening on *both* the client&lt;-&gt;Squid and the
</I>&gt;<i> Squid&lt;-&gt;server connections. I suggest combining a tcpdump capture
</I>&gt;<i> (_full_ packets) compared with Squid &quot;debug_options 11,2&quot; info about
</I>&gt;<i> what the FD are being used for.
</I>&gt;<i>  It may be obvious what is going on when you look at that info.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> [ If that process is new to you, then I do highly recommend you take a
</I>&gt;<i> little time to become familiar. TLS is a changing environment and
</I>&gt;<i> SSL-Bump will be presenting you with more these types of error/problem
</I>&gt;<i> that need dealing with in future. ]
</I>
Thank you. Missed that section somehow. Ill try to do this.



Amos Jeffries wrote
&gt;<i> 407 - HTTP authentication credentials are required for this CONNECT
</I>&gt;<i> transaction to happen.
</I>&gt;<i> 
</I>&gt;<i> IMPORTANT:  When you have configured proxy authentication and SSL-Bump
</I>&gt;<i> you need to be *very* careful to ensure the proxy requests (and gets)
</I>&gt;<i> the credentials on  the initial client CONNECT request - *and* that the
</I>&gt;<i> credentials remain valid for the entire time the HTTPS tunnel is going
</I>&gt;<i> to be open. If their need is only discovered later (or any
</I>&gt;<i> refresh/update to them) then all Squid can do is abort the HTTPS with an
</I>&gt;<i> error.
</I>
It looks like problem starts at first step of ssl_bump peek. If i understand
it right, problems apper when squid trying to get inside https session to
decide should it bump (if site in acl and user in group) or splice this
connection.  


Alex Rousskov wrote
&gt;<i> According to the discussion linked below, these errors may be &quot;normal&quot;:
</I>&gt;<i> <A HREF="https://security.stackexchange.com/questions/160922/ssl-error-inappropriate-fallback-and-tls-fallback-scsv">https://security.stackexchange.com/questions/160922/ssl-error-inappropriate-fallback-and-tls-fallback-scsv</A>
</I>&gt;<i> 
</I>&gt;<i> To confirm that they are normal, you would need to isolate traffic from
</I>&gt;<i> the affected client and see whether its previous connection or tunneling
</I>&gt;<i> attempt has failed for some reason.
</I>&gt;<i> 
</I>&gt;<i> A similar problem was discussed at
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/pipermail/squid-users/2019-April/020506.html">http://lists.squid-cache.org/pipermail/squid-users/2019-April/020506.html</A>
</I>&gt;<i> 
</I>&gt;<i> If your OpenSSL installation is reasonably fresh, then you will need to
</I>&gt;<i> isolate the failure to where you can connect TCP packet samples and/or
</I>&gt;<i> Squid debugging logs.
</I>
Thanks for links. Squid -v shows that this binary uses OpenSSL 1.1.1  11 Sep
2018.



--
Sent from: <A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html">http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html</A>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020951.html">[squid-users] Cant open some HTTPS with Squid 4.8
</A></li>
	<LI>Next message (by thread): <A HREF="020952.html">[squid-users] Cant open some HTTPS with Squid 4.8
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20957">[ date ]</a>
              <a href="thread.html#20957">[ thread ]</a>
              <a href="subject.html#20957">[ subject ]</a>
              <a href="author.html#20957">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
