<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Disable 302 redirect in squid,	but only to http://eais.rkn.gov.ru
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Disable%20302%20redirect%20in%20squid%2C%0A%09but%20only%20to%20http%3A//eais.rkn.gov.ru&In-Reply-To=%3C1913342111.3948186.1568231133574%40mail.yahoo.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020981.html">
   <LINK REL="Next"  HREF="020986.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Disable 302 redirect in squid,	but only to http://eais.rkn.gov.ru</H1>
    <B>Igor Rylov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Disable%20302%20redirect%20in%20squid%2C%0A%09but%20only%20to%20http%3A//eais.rkn.gov.ru&In-Reply-To=%3C1913342111.3948186.1568231133574%40mail.yahoo.com%3E"
       TITLE="[squid-users] Disable 302 redirect in squid,	but only to http://eais.rkn.gov.ru">igoryonya at yahoo.com
       </A><BR>
    <I>Wed Sep 11 19:45:33 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="020981.html">[squid-users] request_header_replace User-Agent 'UA string' for certain URLs/domains/ACLs
</A></li>
        <LI>Next message (by thread): <A HREF="020986.html">[squid-users] Disable 302 redirect in squid, but only to http://eais.rkn.gov.ru
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20984">[ date ]</a>
              <a href="thread.html#20984">[ thread ]</a>
              <a href="subject.html#20984">[ subject ]</a>
              <a href="author.html#20984">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>It is known, that RosComNadzor is blocking certain domains/IPs.Often it is bloking by rewriting url in place, i.e., when I try to access http(s)://blocked.domain, it changes in the location bar of the browser to <A HREF="http://eais.rkn.gov.ru">http://eais.rkn.gov.ru</A> (RosComNadzor's bloking page) in place, i.e. no ability to click the back button to see which url was blocked. RosComNadzor's blocking page has no mention of what url was blocked either. When I try to use Firefox'es or Chrom(e|ium)'s Developer Tools's Network section on blocked page to see, if I can find out what page was blocked by looking at Referer param of the HTTP header, it's already too late, because those Network sections don't show anything, because they were not started in advance, before the page was blocked. I have to reload the page, in order to see something in that networking section, but I would be reloading <A HREF="http://eais.rkn.gov.ru">http://eais.rkn.gov.ru</A> page already, not the required url and <A HREF="http://eais.rkn.gov.ru">http://eais.rkn.gov.ru</A> doesn't show any Referer in HTTP header, because, it's reloaded in place, and did not come from some other page. It's frustrating, because, when you have many tabs open, you have no way of knowing, which url's were blocked and no way of recovering the blocked address. squid's access log doesn't help either, because you can't tell for certain, that the log entry, previous to log entry with <A HREF="http://eais.rkn.gov.ru">http://eais.rkn.gov.ru</A> address belongs to the same tab of the browser.

I've found out, one of the urls, that is being blocked, because it happened in front of my eyes, so I've tested it with:$ curl -v '<A HREF="http://blocked.domain/">http://blocked.domain/</A>'
I got the dump:---DUMP START---
*&#160;&#160; Trying 127.0.0.1...
* Connected to 127.0.0.1 (127.0.0.1) port 3128 (#0)
&gt;<i> GET <A HREF="http://blocked.domain/">http://blocked.domain/</A> HTTP/1.1&gt; Host: blocked.domain&gt; User-Agent: curl/7.47.0
</I>&gt;<i> Accept: */*
</I>&gt;<i> Proxy-Connection: Keep-Alive
</I>&gt;<i>
</I>&lt; HTTP/1.1 302 Found
&lt; Date: Wed, 11 Sep 2019 08:48:44 GMT
&lt; Content-Length: 205
&lt; Location: <A HREF="http://eais.rkn.gov.ru">http://eais.rkn.gov.ru</A>
&lt; Content-Type: text/html; charset=UTF-8
&lt; X-Cache: MISS from ls02800008008u
&lt; X-Cache-Lookup: MISS from ls02800008008u:3128
&lt; X-Cache: MISS from ws02800008006
&lt; X-Cache-Lookup: MISS from ws02800008006:3128
&lt; X-Cache: MISS from cooldown-nb
&lt; X-Cache-Lookup: MISS from cooldown-nb:3128
&lt; Via: 1.1 ls02800008008u (squid/3.5.12), 1.1 ws02800008006 (squid/3.5.27), 1.1 cooldown-nb (squid/3.5.12)
&lt; Connection: keep-alive
&lt;
&lt;HTML&gt;&lt;HEAD&gt;&lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html;charset=utf-8&quot;&gt;
&lt;TITLE&gt;302 Found&lt;/TITLE&gt;&lt;/HEAD&gt;&lt;BODY&gt;
&lt;H1&gt;302 Found&lt;/H1&gt;
The document has moved
&lt;A HREF=&quot;<A HREF="http://eais.rkn.gov.ru">http://eais.rkn.gov.ru</A>&quot;&gt;here&lt;/A&gt;
* Connection #0 to host 127.0.0.1 left intact---DUMP END---

So, there is a 302 redirect, that happens automatically:Location: <A HREF="http://eais.rkn.gov.ru">http://eais.rkn.gov.ru</A>

How do I disable 302 redirect in squid, but only to <A HREF="http://eais.rkn.gov.ru">http://eais.rkn.gov.ru</A> address, so, in browser I see that page is blocked, but at least, I don't loose the information of what page is blocked, because it's not automatically redirected to <A HREF="http://eais.rkn.gov.ru">http://eais.rkn.gov.ru</A> and the location in the browser showing the original url?
After I've wrote my question, I thought, if it's possible to to do it with:
acl sites_blocking_redirect url_regex eais\.rkn\.gov\.ru
reply_header_access Location deny sites_blocking_redirect
Is it a workable or the correct way to do it, so it solves my problem?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20190911/2b17ee16/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20190911/2b17ee16/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="020981.html">[squid-users] request_header_replace User-Agent 'UA string' for certain URLs/domains/ACLs
</A></li>
	<LI>Next message (by thread): <A HREF="020986.html">[squid-users] Disable 302 redirect in squid, but only to http://eais.rkn.gov.ru
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20984">[ date ]</a>
              <a href="thread.html#20984">[ thread ]</a>
              <a href="subject.html#20984">[ subject ]</a>
              <a href="author.html#20984">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
