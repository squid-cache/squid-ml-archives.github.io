<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid Transparent Proxy with Coovachilli is not working
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20Transparent%20Proxy%20with%20Coovachilli%20is%20not%0A%20working&In-Reply-To=%3Cad8b0b84-73bb-274e-247c-ac1dec2f6841%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021013.html">
   <LINK REL="Next"  HREF="021015.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid Transparent Proxy with Coovachilli is not working</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20Transparent%20Proxy%20with%20Coovachilli%20is%20not%0A%20working&In-Reply-To=%3Cad8b0b84-73bb-274e-247c-ac1dec2f6841%40treenet.co.nz%3E"
       TITLE="[squid-users] Squid Transparent Proxy with Coovachilli is not working">squid3 at treenet.co.nz
       </A><BR>
    <I>Sat Sep 14 10:09:10 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="021013.html">[squid-users] Squid Transparent Proxy with Coovachilli is not	working
</A></li>
        <LI>Next message (by thread): <A HREF="021015.html">[squid-users] Squid Transparent Proxy with Coovachilli is not	working
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21014">[ date ]</a>
              <a href="thread.html#21014">[ thread ]</a>
              <a href="subject.html#21014">[ subject ]</a>
              <a href="author.html#21014">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 14/09/19 7:43 pm, sknz wrote:
&gt;<i> Hello Amos,
</I>&gt;<i> Okay, ports are fixed from here and forwarded 80 to 3127 in iptables.
</I>&gt;<i> 
</I>&gt;<i> http_port 3128 # for proxy client
</I>&gt;<i> http_port 3127 intercept # for http intercept
</I>&gt;<i> 
</I>
This does not match the config suggested.

Can you please re-post the config used with the below captures.


&gt;<i> 
</I>&gt;<i> When a user tries to connect an HTTP site,
</I>&gt;<i> 
</I>&gt;<i> tcpdump -vv -ni eth1 port 80 &gt;&gt;&gt;
</I>&gt;<i> <A HREF="https://paste.grasehotspot.org/view/raw/f81a60e4">https://paste.grasehotspot.org/view/raw/f81a60e4</A>
</I>&gt;<i> 
</I>&gt;<i> tcpdump -vv -ni tun0 port 80 &gt;&gt;&gt;
</I>&gt;<i> <A HREF="https://paste.grasehotspot.org/view/raw/bb0a4bc1">https://paste.grasehotspot.org/view/raw/bb0a4bc1</A>
</I>&gt;<i> 
</I>&gt;<i> tcpdump -vv -ni eth0 port 80 &gt;&gt;&gt;
</I>&gt;<i> <A HREF="https://paste.grasehotspot.org/view/raw/563912fd">https://paste.grasehotspot.org/view/raw/563912fd</A>
</I>&gt;<i> 
</I>&gt;<i> ... and the user never sees any output in the browser window. It's not
</I>&gt;<i> working somewhere in between tun0 &lt;--&gt; eth0. eth0 is WAN here.
</I>

The thing is - Squid, four layers of NAT, one more trip through the
Chilli portal engine, and two cycles through the firewall all sit in
that problem area. That is a LOT of complexity - figuring out what is
going on is difficult enough before you go changing the settings in
unexpected ways with every post to the mailing list.

What we are doing here is working through those carefully checking what
the traffic is doing until the exact problem point is found.

So far the traces show one trip through Chilli is working okay.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="021013.html">[squid-users] Squid Transparent Proxy with Coovachilli is not	working
</A></li>
	<LI>Next message (by thread): <A HREF="021015.html">[squid-users] Squid Transparent Proxy with Coovachilli is not	working
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21014">[ date ]</a>
              <a href="thread.html#21014">[ thread ]</a>
              <a href="subject.html#21014">[ subject ]</a>
              <a href="author.html#21014">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
