<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Non-Transparent HTTP+HTTP Proxy
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Non-Transparent%20HTTP%2BHTTP%20Proxy&In-Reply-To=%3C20190916105506.GB2934%40fantomas.sk%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021029.html">
   <LINK REL="Next"  HREF="021023.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Non-Transparent HTTP+HTTP Proxy</H1>
    <B>Matus UHLAR - fantomas</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Non-Transparent%20HTTP%2BHTTP%20Proxy&In-Reply-To=%3C20190916105506.GB2934%40fantomas.sk%3E"
       TITLE="[squid-users] Non-Transparent HTTP+HTTP Proxy">uhlar at fantomas.sk
       </A><BR>
    <I>Mon Sep 16 10:55:07 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="021029.html">[squid-users] Non-Transparent HTTP+HTTP Proxy
</A></li>
        <LI>Next message (by thread): <A HREF="021023.html">[squid-users] Problem with ssl_choose_client_version:inappropriate fallback on some sites when using TLS1.2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21030">[ date ]</a>
              <a href="thread.html#21030">[ thread ]</a>
              <a href="subject.html#21030">[ subject ]</a>
              <a href="author.html#21030">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 16.09.19 05:45, sknz wrote:
&gt;<i>[Updated] I'm trying to configure Squid 3.5.3 for access controller/captive
</I>&gt;<i>portal last few days.
</I>&gt;<i>
</I>&gt;<i>#1 For this config, on client device:  *URL could not be retrieved - Invalid
</I>&gt;<i>Url*
</I>&gt;<i>http_port 3128
</I>&gt;<i>
</I>&gt;<i>#2 Squid log throws an Error - No forward port
</I>&gt;<i>http_port 3128 intercept
</I>&gt;<i>
</I>&gt;<i>#3 On client device:  *URL could not be retrieved - Invalid Url*
</I>&gt;<i>http_port 3128
</I>&gt;<i>http_port 3127 intercept
</I>&gt;<i>
</I>&gt;<i>#4 On client device: Unable to forward this request
</I>&gt;<i>http_port 3128 accel
</I>&gt;<i>
</I>&gt;<i>#5 Now this works!
</I>&gt;<i>http_port 3128 accel allow-direct
</I>&gt;<i>
</I>&gt;<i>Under same settings in other things, I've changed Squid config # 1 to 5, can
</I>&gt;<i>you guess what's happening here? What's so special about &quot;allow-direct&quot;
</I>&gt;<i>here?  Why transparent proxy is not working? Why forward proxy is working
</I>&gt;<i>only with &quot;allow-direct&quot;?
</I>
first, configure proxy with port3128 without &quot;accel&quot;, &quot;intercept&quot;, &quot;tproxy&quot;,
and &quot;ssl-bump&quot;.

port 3128 should not use first three, and using the fourth can make things
more compicated.

then, cofigure your browser to use proxy at port 3128. This must work.

&quot;accel&quot; and further &quot;allow-direct&quot; should be used on reverse proxies, not
when you use proxy for connecting clients to the world. They need proper
configuration on squid. They must not be used on forward proxy ports.

&quot;intercept&quot; and further &quot;tproxy&quot; should be used on different port, both need
special configuration on the router/firewall.


Note that clients with explicit proxy should not connect to intercept port,
and clients without explicit proxy should not connect to the standard 3128
port without intercept and tproxy.

when using intercept, you should allow connections from proxy to the world
and not redirect them back to the proxy.

As I have already said, if you use solutions like coovachilli, they should
provide instructions on how to configure intercepting proxy.

-- 
Matus UHLAR - fantomas, <A HREF="https://lists.squid-cache.org/listinfo/squid-users">uhlar at fantomas.sk</A> ; <A HREF="http://www.fantomas.sk/">http://www.fantomas.sk/</A>
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
99 percent of lawyers give the rest a bad name.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="021029.html">[squid-users] Non-Transparent HTTP+HTTP Proxy
</A></li>
	<LI>Next message (by thread): <A HREF="021023.html">[squid-users] Problem with ssl_choose_client_version:inappropriate fallback on some sites when using TLS1.2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21030">[ date ]</a>
              <a href="thread.html#21030">[ thread ]</a>
              <a href="subject.html#21030">[ subject ]</a>
              <a href="author.html#21030">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
