<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid Can't catch AD user's group
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20Can%27t%20catch%20AD%20user%27s%20group&In-Reply-To=%3CCAJTWAhFvmWW44OSAvoa_7tPtn_B7avz691Q9cczH62kn6zbHpw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021078.html">
   <LINK REL="Next"  HREF="021080.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid Can't catch AD user's group</H1>
    <B>Tevfik Ceydeliler</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20Can%27t%20catch%20AD%20user%27s%20group&In-Reply-To=%3CCAJTWAhFvmWW44OSAvoa_7tPtn_B7avz691Q9cczH62kn6zbHpw%40mail.gmail.com%3E"
       TITLE="[squid-users] Squid Can't catch AD user's group">tevfik.ceydeliler at gmail.com
       </A><BR>
    <I>Mon Sep 23 12:45:27 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="021078.html">[squid-users] Error page headers
</A></li>
        <LI>Next message (by thread): <A HREF="021080.html">[squid-users] Working proxy_protocol_access settings on Squid 3.5	or 4?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21075">[ date ]</a>
              <a href="thread.html#21075">[ thread ]</a>
              <a href="subject.html#21075">[ subject ]</a>
              <a href="author.html#21075">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,
My squid ACL can't catch AD user's group of membership.That's why can't
send the request correct outgoing interface
Users member of group_g_internet_socialmediausers and its correct interface
IP address is 10.65.12.247. 10.65.12.250 is general outgoing address

### NTLM
&gt;<i> auth_param ntlm program /usr/bin/ntlm_auth --diagnostic
</I>&gt;<i> --helper-protocol=squid-2.5-ntlmssp --domain=COMPANY
</I>&gt;<i> auth_param ntlm children 100
</I>&gt;<i> auth_param ntlm max_challenge_reuses 0
</I>&gt;<i> auth_param ntlm max_challenge_lifetime 2 minutes
</I>&gt;<i> auth_param ntlm keep_alive off
</I>

group_g_internet_socialmediausers.acl:

&gt;<i> CN=G_Internet_SocialMedisUsers,OU=Internet Groups,DC=company,DC=grp
</I>

and  Configuration file:

&gt;<i> acl group_g_internet_socialmediausers  external nt_group
</I>&gt;<i> &quot;/etc/squid/group_g_internet_socialmediausers.acl&quot;
</I>


&gt;<i> http_access allow group_g_internet_socialmediausers
</I>


&gt;<i> tcp_outgoing_address 10.65.12.250
</I>


and outgoing part:
tcp_outgoing_address 10.65.12.247 group_g_internet_socialmediausers


cache.log shows:

&gt;<i> (truncated)
</I>&gt;<i> 2019/09/23 15:31:45.811 kid1| 28,5| Checklist.cc(400) bannedAction: Action
</I>&gt;<i> 'ALLOWED/0is not banned
</I>&gt;<i> 2019/09/23 15:31:45.811 kid1| 28,5| Acl.cc(138) matches: checking
</I>&gt;<i> http_access#10
</I>&gt;<i> 2019/09/23 15:31:45.811 kid1| 28,5| Acl.cc(138) matches: checking
</I>&gt;<i> group_g_internet_socialmediausers
</I>&gt;<i> 2019/09/23 15:31:45.811 kid1| 28,3| Acl.cc(158) matches: checked:
</I>&gt;<i> group_g_internet_socialmediausers = 0
</I>&gt;<i> 2019/09/23 15:31:45.811 kid1| 28,3| Acl.cc(158) matches: checked:
</I>&gt;<i> http_access#10 = 0
</I>&gt;<i> (truncated)
</I>&gt;<i> 2019/09/23 15:31:45.811 kid1| 28,3| Checklist.cc(70) preCheck:
</I>&gt;<i> 0x7fff26947320 checking fast ACLs
</I>&gt;<i> 2019/09/23 15:31:45.811 kid1| 28,5| Acl.cc(138) matches: checking
</I>&gt;<i> tcp_outgoing_address 10.65.12.247
</I>&gt;<i> 2019/09/23 15:31:45.811 kid1| 28,5| Acl.cc(138) matches: checking
</I>&gt;<i> (tcp_outgoing_address 10.65.12.247 line)
</I>&gt;<i> 2019/09/23 15:31:45.811 kid1| 28,5| Acl.cc(138) matches: checking
</I>&gt;<i> group_g_internet_socialmediausers
</I>&gt;<i> 2019/09/23 15:31:45.811 kid1| 28,3| Acl.cc(158) matches: checked:
</I>&gt;<i> group_g_internet_socialmediausers = 0
</I>&gt;<i> 2019/09/23 15:31:45.811 kid1| 28,3| Acl.cc(158) matches: checked:
</I>&gt;<i> (tcp_outgoing_address 10.65.12.247 line) = 0
</I>&gt;<i> 2019/09/23 15:31:45.811 kid1| 28,3| Acl.cc(158) matches: checked:
</I>&gt;<i> tcp_outgoing_address 10.65.12.247 = 0
</I>&gt;<i> 2019/09/23 15:31:46.094 kid1| 28,3| Checklist.cc(63) markFinished:
</I>&gt;<i> 0x7fff26946d40 answer AUTH_REQUIRED for aclMatchExternal exception
</I>&gt;<i> 2019/09/23 15:31:46.094 kid1| 28,3| Acl.cc(158) matches: checked:
</I>&gt;<i> group_g_internet_socialmediausers = -1
</I>&gt;<i> 2019/09/23 15:31:46.094 kid1| 28,3| Acl.cc(158) matches: checked:
</I>&gt;<i> (tcp_outgoing_address 10.65.12.247 line) = -1
</I>&gt;<i> 2019/09/23 15:31:46.094 kid1| 28,3| Acl.cc(158) matches: checked:
</I>&gt;<i> tcp_outgoing_address 10.65.12.247 = -1
</I>&gt;<i> 2019/09/23 15:31:46.094 kid1| 28,3| Checklist.cc(70) preCheck:
</I>&gt;<i> 0x7fff26946d40 checking fast ACLs
</I>&gt;<i> (truncated)
</I>&gt;<i> 2019/09/23 15:31:52.069 kid1| 28,3| Checklist.cc(70) preCheck:
</I>&gt;<i> 0x7fff26947320 checking fast ACLs
</I>&gt;<i> 2019/09/23 15:31:52.069 kid1| 28,5| Acl.cc(138) matches: checking
</I>&gt;<i> tcp_outgoing_address 10.65.12.247
</I>&gt;<i> 2019/09/23 15:31:52.069 kid1| 28,5| Acl.cc(138) matches: checking
</I>&gt;<i> (tcp_outgoing_address 10.65.12.247 line)
</I>&gt;<i> 2019/09/23 15:31:52.069 kid1| 28,5| Acl.cc(138) matches: checking
</I>&gt;<i> group_g_internet_socialmediausers
</I>&gt;<i> 2019/09/23 15:31:52.069 kid1| 28,3| Acl.cc(158) matches: checked:
</I>&gt;<i> group_g_internet_socialmediausers = 0
</I>&gt;<i> 2019/09/23 15:31:52.069 kid1| 28,3| Acl.cc(158) matches: checked:
</I>&gt;<i> (tcp_outgoing_address 10.65.12.247 line) = 0
</I>&gt;<i> 2019/09/23 15:31:52.069 kid1| 28,3| Acl.cc(158) matches: checked:
</I>&gt;<i> tcp_outgoing_address 10.65.12.247 = 0
</I>&gt;<i> 2019/09/23 15:31:52.069 kid1| 28,3| Checklist.cc(63) markFinished:
</I>&gt;<i> 0x7fff26947320 answer DENIED for ACLs failed to match
</I>&gt;<i> 2019/09/23 15:31:52.069 kid1| 28,3| Checklist.cc(70) preCheck:
</I>&gt;<i> 0x7fff26947320 checking fast ACLs
</I>&gt;<i> 2019/09/23 15:31:52.069 kid1| 28,5| Acl.cc(138) matches: checking
</I>&gt;<i> tcp_outgoing_address 10.65.12.250
</I>&gt;<i> 2019/09/23 15:31:52.069 kid1| 28,5| Acl.cc(138) matches: checking
</I>&gt;<i> (tcp_outgoing_address 10.65.12.250 line)
</I>&gt;<i> 2019/09/23 15:31:52.069 kid1| 28,5| Acl.cc(138) matches: checking
</I>&gt;<i> 8_18_sinirsiz
</I>&gt;<i> 2019/09/23 15:31:52.069 kid1| 28,3| Acl.cc(158) matches: checked:
</I>&gt;<i> 8_18_sinirsiz = 1
</I>&gt;<i> 2019/09/23 15:31:52.069 kid1| 28,3| Acl.cc(158) matches: checked:
</I>&gt;<i> (tcp_outgoing_address 10.65.12.250 line) = 1
</I>&gt;<i> 2019/09/23 15:31:52.069 kid1| 28,3| Acl.cc(158) matches: checked:
</I>&gt;<i> tcp_outgoing_address 10.65.12.250 = 1
</I>&gt;<i> 2019/09/23 15:31:52.069 kid1| 28,3| Checklist.cc(63) markFinished:
</I>&gt;<i> 0x7fff26947320 answer ALLOWED for match
</I>&gt;<i> 2019/09/23 15:31:52.069 kid1| 28,4| FilledChecklist.cc(66)
</I>&gt;<i> ~ACLFilledChecklist: ACLFilledChecklist destroyed 0x7fff26947320
</I>&gt;<i> 2019/09/23 15:31:52.069 kid1| 28,4| Checklist.cc(197) ~ACLChecklist:
</I>&gt;<i> ACLChecklist::~ACLChecklist: destroyed 0x7fff26947320
</I>&gt;<i> 2019/09/23 15:31:52.069 kid1| 28,4| FilledChecklist.cc(66)
</I>&gt;<i> ~ACLFilledChecklist: ACLFilledChecklist destroyed 0x7fff269470c0
</I>&gt;<i> 2019/09/23 15:31:52.069 kid1| 28,4| Checklist.cc(197) ~ACLChecklist:
</I>&gt;<i> ACLChecklist::~ACLChecklist: destroyed 0x7fff269470c0
</I>&gt;<i> 2019/09/23 15:31:52.069 kid1| 28,4| FilledChecklist.cc(66)
</I>&gt;<i> ~ACLFilledChecklist: ACLFilledChecklist destroyed 0x56416a6dc118
</I>&gt;<i> 2019/09/23 15:31:52.069 kid1| 28,4| Checklist.cc(197) ~ACLChecklist:
</I>&gt;<i> ACLChecklist::~ACLChecklist: destroyed 0x56416a6dc118
</I>&gt;<i> 2019/09/23 15:31:54.699 kid1| 28,3| Checklist.cc(70) preCheck:
</I>&gt;<i> 0x7fff269480a0 checking fast ACLs
</I>&gt;<i> 2019/09/23 15:31:54.700 kid1| 28,5| Acl.cc(138) matches: checking
</I>&gt;<i> cache_access_log /var/log/squid/access.log
</I>&gt;<i> 2019/09/23 15:31:54.700 kid1| 28,5| Acl.cc(138) matches: checking
</I>&gt;<i> (cache_access_log /var/log/squid/access.log line)
</I>&gt;<i> 2019/09/23 15:31:54.700 kid1| 28,3| Acl.cc(158) matches: checked:
</I>&gt;<i> (cache_access_log /var/log/squid/access.log line) = 1
</I>&gt;<i> 2019/09/23 15:31:54.700 kid1| 28,3| Acl.cc(158) matches: checked:
</I>&gt;<i> cache_access_log /var/log/squid/access.log = 1
</I>&gt;<i> 2019/09/23 15:31:54.700 kid1| 28,3| Checklist.cc(63) markFinished:
</I>&gt;<i> 0x7fff269480a0 answer ALLOWED for match
</I>&gt;<i> 2019/09/23 15:31:54.700 kid1| 28,4| FilledChecklist.cc(66)
</I>&gt;<i> ~ACLFilledChecklist: ACLFilledChecklist destroyed 0x7fff269480a0
</I>&gt;<i> 2019/09/23 15:31:54.700 kid1| 28,4| Checklist.cc(197) ~ACLChecklist:
</I>&gt;<i> ACLChecklist::~ACLChecklist: destroyed 0x7fff269480a0
</I>&gt;<i> 2019/09/23 15:31:59.925 kid1| 28,8| Acl.cc(355) aclCacheMatchFlush:
</I>&gt;<i> aclCacheMatchFlush called for cache 0x56416a71d1a8
</I>&gt;<i> 2019/09/23 15:33:11.925 kid1| 28,3| Checklist.cc(70) preCheck:
</I>&gt;<i> 0x7fff269480a0 checking fast ACLs
</I>&gt;<i> 2019/09/23 15:33:11.925 kid1| 28,5| Acl.cc(138) matches: checking
</I>&gt;<i> cache_access_log /var/log/squid/access.log
</I>&gt;<i> 2019/09/23 15:33:11.925 kid1| 28,5| Acl.cc(138) matches: checking
</I>&gt;<i> (cache_access_log /var/log/squid/access.log line)
</I>&gt;<i> 2019/09/23 15:33:11.925 kid1| 28,3| Acl.cc(158) matches: checked:
</I>&gt;<i> (cache_access_log /var/log/squid/access.log line) = 1
</I>&gt;<i> 2019/09/23 15:33:11.925 kid1| 28,3| Acl.cc(158) matches: checked:
</I>&gt;<i> cache_access_log /var/log/squid/access.log = 1
</I>&gt;<i> 2019/09/23 15:33:11.925 kid1| 28,3| Checklist.cc(63) markFinished:
</I>&gt;<i> 0x7fff269480a0 answer ALLOWED for match
</I>&gt;<i> 2019/09/23 15:33:11.925 kid1| 28,4| FilledChecklist.cc(66)
</I>&gt;<i> ~ACLFilledChecklist: ACLFilledChecklist destroyed 0x7fff269480a0
</I>&gt;<i> 2019/09/23 15:33:11.925 kid1| 28,4| Checklist.cc(197) ~ACLChecklist:
</I>&gt;<i> ACLChecklist::~ACLChecklist: destroyed 0x7fff269480a0
</I>&gt;<i> 2019/09/23 15:33:11.925 kid1| 28,8| Acl.cc(355) aclCacheMatchFlush:
</I>&gt;<i> aclCacheMatchFlush called for cache 0x56416a6ec138
</I>

At the end user routes to 10.65.12.250 which is not allowed for this users.
What is wrong?




-- 
Tevfik Ceydeliler
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20190923/4f1ce2f3/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20190923/4f1ce2f3/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="021078.html">[squid-users] Error page headers
</A></li>
	<LI>Next message (by thread): <A HREF="021080.html">[squid-users] Working proxy_protocol_access settings on Squid 3.5	or 4?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21075">[ date ]</a>
              <a href="thread.html#21075">[ thread ]</a>
              <a href="subject.html#21075">[ subject ]</a>
              <a href="author.html#21075">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
