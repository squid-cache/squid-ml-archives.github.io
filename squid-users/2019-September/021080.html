<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Working proxy_protocol_access settings on Squid 3.5	or 4?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Working%20proxy_protocol_access%20settings%20on%20Squid%203.5%0A%09or%204%3F&In-Reply-To=%3CCAGZ9WNr9Hs5v1ToBiwGh0yAd1TgDFb4UQahq5sJ5i7OzMZTmtg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021075.html">
   <LINK REL="Next"  HREF="021081.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Working proxy_protocol_access settings on Squid 3.5	or 4?</H1>
    <B>Tom Karches</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Working%20proxy_protocol_access%20settings%20on%20Squid%203.5%0A%09or%204%3F&In-Reply-To=%3CCAGZ9WNr9Hs5v1ToBiwGh0yAd1TgDFb4UQahq5sJ5i7OzMZTmtg%40mail.gmail.com%3E"
       TITLE="[squid-users] Working proxy_protocol_access settings on Squid 3.5	or 4?">twk at ncsu.edu
       </A><BR>
    <I>Mon Sep 23 20:14:42 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="021075.html">[squid-users] Squid Can't catch AD user's group
</A></li>
        <LI>Next message (by thread): <A HREF="021081.html">[squid-users] Working proxy_protocol_access settings on Squid 3.5 or 4?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21080">[ date ]</a>
              <a href="thread.html#21080">[ thread ]</a>
              <a href="subject.html#21080">[ subject ]</a>
              <a href="author.html#21080">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I am enabling proxy protocol on our FortiADC load balancer so that the
source IP of the proxy request can be logged. In the current configuration,
the address that is logged belongs to the NAT pool used by the load
balancer.

I added these config settings to configure the proxy_protocol_access. The
fortiadc ACL is the IP range of the NAT pool :

acl fortiadc src 10.50.54.0/24
proxy_protocol_access allow fortiadc

proxy_protocol_access allow localnet
follow_x_forwarded_for allow localhost
follow_x_forwarded_for allow localnet
acl_uses_indirect_client on
delay_pool_uses_indirect_client on
log_uses_indirect_client on
tproxy_uses_indirect_client off

I have updated my http_port line as such :
http_port 3128 require-proxy-header

I am now getting the error :
2019/09/23 16:03:15 kid1| PROXY protocol error: invalid header from local=
152.7.114.135:3128 remote=10.50.54.65:5028 FD 12 flags=1

The suggestion was to move to Squid 4 as noted here :
<A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/error-in-parsing-Proxy-protocol-version-2-by-Squid-proxy-protocol-td4686763.html">http://squid-web-proxy-cache.1019090.n4.nabble.com/error-in-parsing-Proxy-protocol-version-2-by-Squid-proxy-protocol-td4686763.html</A>

This was back in Oct 2018. Has anything changed since then? Do I need to
upgrade to Squid 4? Currently running 3.5.20.

Thanks,
Tom

-- 
Thomas Karches
NCSU OIT CSI - Systems Specialist
M.E Student - Technology Education
Hillsborough 319 / 919.515.5508
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20190923/2f89b32d/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20190923/2f89b32d/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="021075.html">[squid-users] Squid Can't catch AD user's group
</A></li>
	<LI>Next message (by thread): <A HREF="021081.html">[squid-users] Working proxy_protocol_access settings on Squid 3.5 or 4?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21080">[ date ]</a>
              <a href="thread.html#21080">[ thread ]</a>
              <a href="subject.html#21080">[ subject ]</a>
              <a href="author.html#21080">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
