<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Working proxy_protocol_access settings on Squid 3.5 or 4?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Working%20proxy_protocol_access%20settings%20on%20Squid%0A%203.5%20or%204%3F&In-Reply-To=%3CCAGZ9WNqkkEuPM2jQqCFrXdj1idOrMQekUFWQXA0GcaDW8Gmg8w%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021081.html">
   <LINK REL="Next"  HREF="021083.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Working proxy_protocol_access settings on Squid 3.5 or 4?</H1>
    <B>Tom Karches</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Working%20proxy_protocol_access%20settings%20on%20Squid%0A%203.5%20or%204%3F&In-Reply-To=%3CCAGZ9WNqkkEuPM2jQqCFrXdj1idOrMQekUFWQXA0GcaDW8Gmg8w%40mail.gmail.com%3E"
       TITLE="[squid-users] Working proxy_protocol_access settings on Squid 3.5 or 4?">twk at ncsu.edu
       </A><BR>
    <I>Tue Sep 24 16:02:07 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="021081.html">[squid-users] Working proxy_protocol_access settings on Squid 3.5 or 4?
</A></li>
        <LI>Next message (by thread): <A HREF="021083.html">[squid-users] Working proxy_protocol_access settings on Squid 3.5 or 4?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21082">[ date ]</a>
              <a href="thread.html#21082">[ thread ]</a>
              <a href="subject.html#21082">[ subject ]</a>
              <a href="author.html#21082">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Alex,

Our current production configuration is squid 3.123 with LVS load
balancing. The desired production configuration is 3.5.20 with a FortiADC
load balancer. I am working with networking staff on the configuration. If
I directly connect to the actual proxy server behind the load balancer, I
get :

2019/09/24 11:31:46 kid1| PROXY protocol error: invalid header from local=
152.7.114.8:3128 remote=152.7.148.47:65220 FD 16 flags=1

Relevant squid.conf on the server looks like this :

acl fortiadc src 10.50.54.0/24
acl fortiadc src 152.7.148.0/24 &lt;----temporary for testing by going
directly to the proxy server and not the load balancer
proxy_protocol_access allow fortiadc

proxy_protocol_access allow localnet
follow_x_forwarded_for allow localhost
follow_x_forwarded_for allow localnet
acl_uses_indirect_client on
delay_pool_uses_indirect_client on
log_uses_indirect_client on
tproxy_uses_indirect_client off
...
http_port 3128 require-proxy-header

I have tried adding the following...it appears to make no difference.

http_port 127.0.0.1:3128

So, you are saying that v4 does not contain changes to fix the &quot;PROXY
protocol error&quot; and my only option at this point is v5 code? (or fall back
to using LVS with 3.5.20) Just trying to understand my options.

Thanks,
Tom

On Mon, Sep 23, 2019 at 4:47 PM Alex Rousskov &lt;
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt; wrote:

&gt;<i> On 9/23/19 4:14 PM, Tom Karches wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; The suggestion was to move to Squid 4 as noted here :
</I>&gt;<i> &gt;
</I>&gt;<i> <A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/error-in-parsing-Proxy-protocol-version-2-by-Squid-proxy-protocol-td4686763.html">http://squid-web-proxy-cache.1019090.n4.nabble.com/error-in-parsing-Proxy-protocol-version-2-by-Squid-proxy-protocol-td4686763.html</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; This was back in Oct 2018. Has anything changed since then?
</I>&gt;<i>
</I>&gt;<i> Yes, the changes I mentioned then have been accepted:
</I>&gt;<i>
</I>&gt;<i>    <A HREF="https://github.com/squid-cache/squid/pull/342">https://github.com/squid-cache/squid/pull/342</A>
</I>&gt;<i>
</I>&gt;<i> The above pull request contained lots of PROXY protocol fixes and
</I>&gt;<i> several important improvements. Those changes are not in v4, but master
</I>&gt;<i> (future v5) code is available and works well for some. YMMV.
</I>&gt;<i>
</I>&gt;<i> I do not recall any fixes going back into v3, but I did not check.
</I>&gt;<i>
</I>&gt;<i> Alex.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>

-- 
Thomas Karches
NCSU OIT CSI - Systems Specialist
M.E Student - Technology Education
Hillsborough 319 / 919.515.5508
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20190924/d84a9fb3/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20190924/d84a9fb3/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="021081.html">[squid-users] Working proxy_protocol_access settings on Squid 3.5 or 4?
</A></li>
	<LI>Next message (by thread): <A HREF="021083.html">[squid-users] Working proxy_protocol_access settings on Squid 3.5 or 4?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21082">[ date ]</a>
              <a href="thread.html#21082">[ thread ]</a>
              <a href="subject.html#21082">[ subject ]</a>
              <a href="author.html#21082">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
