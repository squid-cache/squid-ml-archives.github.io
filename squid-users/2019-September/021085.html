<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Kerberos nad keytab problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Kerberos%20nad%20keytab%20problem&In-Reply-To=%3CCAJTWAhEy7ec%3DHwDNUKeWuHOL%2BidvX5nrws9GJjQncR%2B%2BLrHWqw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021094.html">
   <LINK REL="Next"  HREF="021088.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Kerberos nad keytab problem</H1>
    <B>Tevfik Ceydeliler</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Kerberos%20nad%20keytab%20problem&In-Reply-To=%3CCAJTWAhEy7ec%3DHwDNUKeWuHOL%2BidvX5nrws9GJjQncR%2B%2BLrHWqw%40mail.gmail.com%3E"
       TITLE="[squid-users] Kerberos nad keytab problem">tevfik.ceydeliler at gmail.com
       </A><BR>
    <I>Wed Sep 25 11:58:43 UTC 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="021094.html">[squid-users] Warning: ACL is used in context without an HTTP response
</A></li>
        <LI>Next message (by thread): <A HREF="021088.html">[squid-users] Kerberos nad keytab problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21085">[ date ]</a>
              <a href="thread.html#21085">[ thread ]</a>
              <a href="subject.html#21085">[ subject ]</a>
              <a href="author.html#21085">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi, I try to use kerberos in my squid. Nut I get an error message :

############################33
msktutil --auto-update --verbose --computer-name suqidpnb1 --server
dctoyo1.toyo.grp -k /etc/squid/PROXY.keytab
 -- init_password: Wiping the computer password structure
 -- generate_new_password: Generating a new, random password for the
computer account
 -- generate_new_password:  Characters read from /dev/urandom = 95
 -- create_fake_krb5_conf: Created a fake krb5.conf file:
/tmp/.msktkrb5.conf-QCbGC5
 -- destroy_g_context: Destroying Kerberos Context
 -- initialize_g_context: Creating Kerberos Context
 -- finalize_exec: SAM Account Name is: suqidpnb1$
 -- try_machine_keytab_princ: Trying to authenticate for suqidpnb1$ from
local keytab
 -- try_machine_keytab_princ: Error: krb5_get_init_creds_keytab failed (Key
table entry not found)
 -- try_machine_keytab_princ: Authentication with keytab failed
 -- try_machine_keytab_princ: Trying to authenticate for SUQIDPNB1$ from
local keytab
 -- try_machine_keytab_princ: Error: krb5_get_init_creds_keytab failed (Key
table entry not found)
 -- try_machine_keytab_princ: Authentication with keytab failed
 -- try_machine_keytab_princ: Trying to authenticate for host/localhost
from local keytab
 -- try_machine_keytab_princ: Error: krb5_get_init_creds_keytab failed (Key
table entry not found)
 -- try_machine_keytab_princ: Authentication with keytab failed
 -- try_machine_password: Trying to authenticate for suqidpnb1$ with
password
 -- create_default_machine_password: Default machine password for
suqidpnb1$ is suqidpnb1
 -- try_machine_password: Error: krb5_get_init_creds_keytab failed (Client
not found in Kerberos database)
 -- try_machine_password: Authentication with password failed
 -- try_user_creds: Checking if default ticket cache has tickets
 -- try_user_creds: Error: krb5_cc_get_principal failed (No credentials
cache found)
 -- try_user_creds: User ticket cache was not valid
Error: could not find any credentials to authenticate with. Neither keytab,
default machine password, nor calling user's tickets worked. Try
&quot;kinit&quot;ing yourself some tickets with permission to create computer
objects, or pre-creating the computer object in AD and selecting
'reset account'.

#############################33
Can't find why this happen:


My AD is 2012R2 function level
I create keytab with this:
msktutil -c -b &quot;OU=Servers,DC=toyo,DC=grp&quot; -s HTTP/squidtoyopnb1.toyo.grp
-k /etc/squid/PROXY.keytab --computer-name SQUIDPNB1 --upn
HTTP/squidtoyopnb1.toyo.grp --server dctoyo1.toyo.grp --verbose --enctypes
28

Keytab file permission is:
-rw-r----- 1 root squid 933 Sep 25 13:37 PROXY.keytab

and keytab file (klist -k output):

   3 SQUIDPNB1$@TOYO.GRP
   3 SQUIDPNB1$@TOYO.GRP
   3 SQUIDPNB1$@TOYO.GRP
   3 HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squidtoyopnb1.toyo.grp at TOYO.GRP</A>
   3 HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squidtoyopnb1.toyo.grp at TOYO.GRP</A>
   3 HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squidtoyopnb1.toyo.grp at TOYO.GRP</A>
   3 host/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squidtoyopnb1 at TOYO.GRP</A>
   3 host/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squidtoyopnb1 at TOYO.GRP</A>
   3 host/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squidtoyopnb1 at TOYO.GRP</A>
   3 host/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squidtoyopnb1.toyo.grp at TOYO.GRP</A>
   3 host/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squidtoyopnb1.toyo.grp at TOYO.GRP</A>
   3 host/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squidtoyopnb1.toyo.grp at TOYO.GRP</A>

krb5.conf:
[libdefaults]
default_realm = TOYO.GRP
        dns_lookup_kdc = no
        dns_lookup_realm = no
        ticket_lifetime = 24h
        default_keytab_name = /etc/squid/PROXY.keytab

    ; for Windows 2008 with AES
          default_tgs_enctypes = aes256-cts-hmac-sha1-96 rc4-hmac
des-cbc-crc des-cbc-md5
          default_tkt_enctypes = aes256-cts-hmac-sha1-96 rc4-hmac
des-cbc-crc des-cbc-md5
          permitted_enctypes = aes256-cts-hmac-sha1-96 rc4-hmac des-cbc-crc
des-cbc-md5

    [realms]
TOYO.GRP = {
                kdc = dctoyo1.toyo.grp
                kdc = DCTOYO2.toyo.grp
                admin_server = 10.65.12.254
                default_domain = toyo.grp
     }

    [domain_realm]
     toyo.grp = TOYO.GRP
     .toyo.grp = TOYO.GRP

    [logging]
      kdc = FILE:/var/log/kdc.log
      admin_server = FILE:/var/log/kadmin.log
      default = FILE:/var/log/krb5lib.log




-- 
Tevfik Ceydeliler
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20190925/b46c996d/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20190925/b46c996d/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="021094.html">[squid-users] Warning: ACL is used in context without an HTTP response
</A></li>
	<LI>Next message (by thread): <A HREF="021088.html">[squid-users] Kerberos nad keytab problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21085">[ date ]</a>
              <a href="thread.html#21085">[ thread ]</a>
              <a href="subject.html#21085">[ subject ]</a>
              <a href="author.html#21085">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
