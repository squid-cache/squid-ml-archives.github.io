<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Error negotiating SSL connection on FD 16
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Error%20negotiating%20SSL%20connection%20on%20FD%2016&In-Reply-To=%3C96388971-f784-fce5-c6c3-69e38384f4ef%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021877.html">
   <LINK REL="Next"  HREF="021880.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Error negotiating SSL connection on FD 16</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Error%20negotiating%20SSL%20connection%20on%20FD%2016&In-Reply-To=%3C96388971-f784-fce5-c6c3-69e38384f4ef%40treenet.co.nz%3E"
       TITLE="[squid-users] Error negotiating SSL connection on FD 16">squid3 at treenet.co.nz
       </A><BR>
    <I>Sat Apr  4 05:48:33 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="021877.html">[squid-users] Error negotiating SSL connection on FD 16
</A></li>
        <LI>Next message (by thread): <A HREF="021880.html">[squid-users] Squid transparent not caching apt requests from	deb.debian.org
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21884">[ date ]</a>
              <a href="thread.html#21884">[ thread ]</a>
              <a href="subject.html#21884">[ subject ]</a>
              <a href="author.html#21884">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2/04/20 5:42 pm, saiyan_gc wrote:
&gt;<i> Hi, thank you for reply me. Really appreciated!
</I>&gt;<i> 
</I>&gt;<i> I modified the squid conf file to:
</I>&gt;<i> 
</I>&gt;<i> http_port 2128 ssl-bump cert=/etc/squid/ssl_cert/example.com.cert \
</I>&gt;<i>     key=/etc/squid/ssl_cert/example.com.private \
</I>&gt;<i>     generate-host-certificates=on \
</I>&gt;<i>     dynamic_cert_mem_cache_size=4MB
</I>&gt;<i> https_port 3130 cert=/etc/squid/ssl_cert/example.com.cert \
</I>&gt;<i>     key=/etc/squid/ssl_cert/example.com.private  
</I>&gt;<i> auth_param basic program /usr/lib/squid/basic_ncsa_auth /etc/squid/passwords
</I>&gt;<i> auth_param basic children 5 startup=0 idle=1
</I>&gt;<i> auth_param basic credentialsttl 2 hours
</I>&gt;<i> auth_param basic casesensitive off
</I>&gt;<i> acl ncsa_users proxy_auth REQUIRED
</I>&gt;<i> acl step1 at_step SslBump1
</I>&gt;<i> ssl_bump peek step1
</I>&gt;<i> ssl_bump bump all
</I>&gt;<i> http_access deny !ncsa_users
</I>&gt;<i> http_access allow ncsa_users
</I>&gt;<i> 
</I>&gt;<i> And it's working for http_port. I put the cert into
</I>&gt;<i> /etc/pki/trust-ca/source/anchor, and run a update-ca-trust command. And both
</I>&gt;<i> aws cli and curl command work now. I am still not sure why https_port desn't
</I>&gt;<i> work.
</I>

What you have here is:

* TLS explicit/forward proxy on port 3130.

This requires a regular server certificate for the proxy to use it as a
server encrypting traffic between the client and proxy.


* Interception of HTTPS sent in CONNECT tunnels over a plain-text proxy
on port 2128.

This requires a CA certificate to sign auto-generated server
certificates encrypting the traffic between client and origin server.


That difference in cert type is why when one port works, the other will not.

So first thing to do is make sure the cert types are correct.


&gt;<i> The previous setting work with curl but not aws cli, not sure why it failure
</I>&gt;<i> during tls handshake.
</I>&gt;<i> 
</I>
The second thing you will need to do, is find out which port the tool is
using and whether it is using it in the right mode of traffic.


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="021877.html">[squid-users] Error negotiating SSL connection on FD 16
</A></li>
	<LI>Next message (by thread): <A HREF="021880.html">[squid-users] Squid transparent not caching apt requests from	deb.debian.org
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21884">[ date ]</a>
              <a href="thread.html#21884">[ thread ]</a>
              <a href="subject.html#21884">[ subject ]</a>
              <a href="author.html#21884">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
