<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] sometimes intermediate certificates were not downloaded when using sslbump
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20sometimes%20intermediate%20certificates%20were%20not%0A%20downloaded%20when%20using%20sslbump&In-Reply-To=%3C20200408131411.ofzazios7qelnfxr%40bloms.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021901.html">
   <LINK REL="Next"  HREF="021907.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] sometimes intermediate certificates were not downloaded when using sslbump</H1>
    <B>Dieter Bloms</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20sometimes%20intermediate%20certificates%20were%20not%0A%20downloaded%20when%20using%20sslbump&In-Reply-To=%3C20200408131411.ofzazios7qelnfxr%40bloms.de%3E"
       TITLE="[squid-users] sometimes intermediate certificates were not downloaded when using sslbump">squid.org at bloms.de
       </A><BR>
    <I>Wed Apr  8 13:14:11 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="021901.html">[squid-users] sometimes intermediate certificates were not downloaded when using sslbump
</A></li>
        <LI>Next message (by thread): <A HREF="021907.html">[squid-users] Setting up proxy with private to public
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21902">[ date ]</a>
              <a href="thread.html#21902">[ thread ]</a>
              <a href="subject.html#21902">[ subject ]</a>
              <a href="author.html#21902">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Louis,

thank you for your answer.

It is not my webserver. Am a user who wants to connect to the webserver.
I know that the certificate chain is incomplete.
As far as I know squid should be able to fetch the missing intermediate
certificates on its own with the help of Authority Information Access (AIA) to get the complete list.
So squid should be able to verify the server certificate even the
webserver doesn't deliver the intermediate certificates.

On Wed, Apr 08, L.P.H. van Belle wrote:

&gt;<i> This is a simple one. 
</I>&gt;<i> 
</I>&gt;<i> The certificate chain of that website is incorrect. 
</I>&gt;<i> As shown here : <A HREF="https://www.ssllabs.com/ssltest/analyze.html?d=www.formulare%2dbfinv.de&amp;latest">https://www.ssllabs.com/ssltest/analyze.html?d=www.formulare%2dbfinv.de&amp;latest</A> 
</I>&gt;<i> 
</I>&gt;<i> Check you webserver first and correct you ciphers in your apache webserver. 
</I>&gt;<i> 
</I>&gt;<i> Greetz, 
</I>&gt;<i> 
</I>&gt;<i> Louis
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> &gt; -----Oorspronkelijk bericht-----
</I>&gt;<i> &gt; Van: squid-users 
</I>&gt;<i> &gt; [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] Namens Dieter Bloms
</I>&gt;<i> &gt; Verzonden: woensdag 8 april 2020 13:37
</I>&gt;<i> &gt; Aan: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> &gt; Onderwerp: [squid-users] sometimes intermediate certificates 
</I>&gt;<i> &gt; were not downloaded when using sslbump
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Hello,
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; I use a self compiled squid 4.10 compiled as follow:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; ~# squid --version
</I>&gt;<i> &gt; Squid Cache: Version 4.10
</I>&gt;<i> &gt; Service Name: squid
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; This binary uses OpenSSL 1.1.1d  10 Sep 2019. For legal 
</I>&gt;<i> &gt; restrictions on distribution see 
</I>&gt;<i> &gt; <A HREF="https://www.openssl.org/source/license.html">https://www.openssl.org/source/license.html</A>
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; configure options:  '--prefix=/usr' '--sysconfdir=/etc/squid' 
</I>&gt;<i> &gt; '--bindir=/usr/sbin' '--sbindir=/usr/sbin' 
</I>&gt;<i> &gt; '--localstatedir=/var' '--libexecdir=/usr/sbin' 
</I>&gt;<i> &gt; '--datadir=/usr/share/squid' '--mandir=/usr/share/man' 
</I>&gt;<i> &gt; '--with-default-user=squid' '--with-filedescriptors=131072' 
</I>&gt;<i> &gt; '--with-logdir=/var/log/squid' '--disable-auto-locale' 
</I>&gt;<i> &gt; '--disable-auth-negotiate' '--disable-auth-ntlm' 
</I>&gt;<i> &gt; '--disable-eui' '--disable-carp' '--disable-htcp' 
</I>&gt;<i> &gt; '--disable-ident-lookups' '--disable-loadable-modules' 
</I>&gt;<i> &gt; '--disable-translation' '--disable-wccp' '--disable-wccpv2' 
</I>&gt;<i> &gt; '--enable-async-io=128' '--enable-auth' 
</I>&gt;<i> &gt; '--enable-auth-basic=LDAP NCSA' '--enable-auth-digest=LDAP 
</I>&gt;<i> &gt; file' '--enable-epoll' '--enable-log-daemon-helpers=file' 
</I>&gt;<i> &gt; '--enable-icap-client' '--enable-inline' '--enable-snmp' 
</I>&gt;<i> &gt; '--enable-disk-io=AIO,DiskThreads,IpcIo,Blocking' 
</I>&gt;<i> &gt; '--enable-storeio=ufs,aufs,rock' '--enable-referer-log' 
</I>&gt;<i> &gt; '--enable-useragent-log' '--enable-large-cache-files' 
</I>&gt;<i> &gt; '--enable-removal-policies=lru,heap' 
</I>&gt;<i> &gt; '--enable-follow-x-forwarded-for' '--enable-ssl-crtd' '--with-openssl'
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; in squid.conf I set following acl at the very benning of acl section:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; # allow fetching of missing intermediate certificates
</I>&gt;<i> &gt; acl fetch_intermediate_certificate transaction_initiator 
</I>&gt;<i> &gt; certificate-fetching
</I>&gt;<i> &gt; cache allow fetch_intermediate_certificate
</I>&gt;<i> &gt; cache deny all
</I>&gt;<i> &gt; http_access allow fetch_intermediate_certificate
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; and squid fetches intermediate certificates for websites 
</I>&gt;<i> &gt; like: <A HREF="https://incomplete-chain.badssl.com/">https://incomplete-chain.badssl.com/</A>
</I>&gt;<i> &gt; But squid doesn't fetch the intermediate certificates for the 
</I>&gt;<i> &gt; site <A HREF="https://www.formulare-bfinv.de/">https://www.formulare-bfinv.de/</A>
</I>&gt;<i> &gt; and I don't know why.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; I checked all AiA entries in the certificates and it looks good to me.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Can anybody try the site <A HREF="https://www.formulare-bfinv.de/">https://www.formulare-bfinv.de/</A> with 
</I>&gt;<i> &gt; enabled sslbump,
</I>&gt;<i> &gt; so I can see whether my installation is broken or the 
</I>&gt;<i> &gt; webserver configuration isn't correct ?
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Thank you very much.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; -- 
</I>&gt;<i> &gt; Best regards
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt;   Dieter Bloms
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; --
</I>&gt;<i> &gt; I do not get viruses because I do not use MS software.
</I>&gt;<i> &gt; If you use Outlook then please do not put my email address in your
</I>&gt;<i> &gt; address-book so that WHEN you get a virus it won't use my 
</I>&gt;<i> &gt; address in the
</I>&gt;<i> &gt; From field.
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; squid-users mailing list
</I>&gt;<i> &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> &gt; <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> &gt; 
</I>&gt;<i> 
</I>
-- 
Gru&#223;

  Dieter

--
I do not get viruses because I do not use MS software.
If you use Outlook then please do not put my email address in your
address-book so that WHEN you get a virus it won't use my address in the
From field.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="021901.html">[squid-users] sometimes intermediate certificates were not downloaded when using sslbump
</A></li>
	<LI>Next message (by thread): <A HREF="021907.html">[squid-users] Setting up proxy with private to public
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21902">[ date ]</a>
              <a href="thread.html#21902">[ thread ]</a>
              <a href="subject.html#21902">[ subject ]</a>
              <a href="author.html#21902">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
