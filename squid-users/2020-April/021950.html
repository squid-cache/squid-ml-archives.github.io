<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid access.log
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20access.log&In-Reply-To=%3C012aa72f-b893-ec9b-9f2b-00a65b434355%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021947.html">
   <LINK REL="Next"  HREF="021951.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid access.log</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20access.log&In-Reply-To=%3C012aa72f-b893-ec9b-9f2b-00a65b434355%40measurement-factory.com%3E"
       TITLE="[squid-users] squid access.log">rousskov at measurement-factory.com
       </A><BR>
    <I>Mon Apr 20 20:54:31 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="021947.html">[squid-users] squid access.log
</A></li>
        <LI>Next message (by thread): <A HREF="021951.html">[squid-users] tproxy sslbump and user authentication
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21950">[ date ]</a>
              <a href="thread.html#21950">[ thread ]</a>
              <a href="subject.html#21950">[ subject ]</a>
              <a href="author.html#21950">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 4/20/20 4:13 PM, <A HREF="https://lists.squid-cache.org/listinfo/squid-users">leomessi983 at yahoo.com</A> wrote:
&gt;<i> Well in my case for my single web request in first CONNECT log entry,
</I>&gt;<i> the domain address is IP address of server and URL is IP:PORT of server
</I>&gt;<i> and in second log entry domain is example.com and URL is example.com:443 .
</I>
Yes, this is typical.

&gt;<i> but why?
</I>
You see IP addresses in CONNECT URIs because that is what the client
(e.g., a browser) sent to Squid or, if you are intercepting, that is how
Squid shows intercepted TCP connections.

Per protocol specification, A CONNECT request URI (or request target)
syntax differs from the syntax of other common request URIs (e.g.,
HEAD). For details, see request-target at
<A HREF="https://tools.ietf.org/html/rfc7230#section-3.1.1">https://tools.ietf.org/html/rfc7230#section-3.1.1</A>


&gt;<i> I dont bump anything in this requests!
</I>
I probably do not know what you mean by this remark. You other comments
indicate that you do bump CONNECT tunnels. If you use &quot;ssl_bump bump&quot; or
equivalent deprecated rules, then, for the purposes of this discussion,
you are probably bumping (i.e., decrypting) some CONNECT tunnels.


&gt;<i> If I use ssl::server_name and specify IP address of server&#160;to bump
</I>&gt;<i> https request, my <A HREF="https://example.com">https://example.com</A> request will be blocked, I dont
</I>&gt;<i> send requests in the example format of <A HREF="https://1.1.1.1">https://1.1.1.1</A> .but they will be
</I>&gt;<i> blocked while I dont want to.
</I>
Your http_access and ssl_bump rules have to match reality. There is no
way around that. In reality, CONNECT requests use different request
target than, say, HEAD requests inside those CONNECT tunnels.

If you can configure Wireshark or a similar packet inspection tool to
decrypt CONNECT tunnels and show you both CONNECT requests and the
requests inside the tunnel, all these details may become a bit easier to
grasp. Unfortunately, I do not have ready-to-use instructions on how to
configure Wireshark to decrypt to- and from-Squid communications.


HTH,

Alex.


&gt;<i> On Monday, April 20, 2020, 11:39:23 PM GMT+4:30, Alex Rousskov wrote:
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On 4/20/20 2:04 PM, <A HREF="https://lists.squid-cache.org/listinfo/squid-users">leomessi983 at yahoo.com</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">leomessi983 at yahoo.com</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> hi
</I>&gt;&gt;<i> I have one question.
</I>&gt;&gt;<i> why for each https request that squid do peek or bump or splice ,squid
</I>&gt;&gt;<i> logs 2 lines?
</I>&gt;&gt;<i> one with connect method and one with head method?
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> ... because there are two HTTP[S] requests in those cases, one with the
</I>&gt;<i> CONNECT method and one with the HEAD method. There are other cases where
</I>&gt;<i> one bumped CONNECT tunnel carries hundreds or even thousands of
</I>&gt;<i> GET/HEAD/PUT/POST/CONNECT/etc. requests. And there are also cases where
</I>&gt;<i> a bumped CONNECT tunnel carries no requests at all.
</I>&gt;<i> 
</I>&gt;<i> In summary, one bumped CONNECT tunnel will (by default) result in one or
</I>&gt;<i> more access.log records, starting with the CONNECT record.
</I>&gt;<i> 
</I>&gt;<i> Alex.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="021947.html">[squid-users] squid access.log
</A></li>
	<LI>Next message (by thread): <A HREF="021951.html">[squid-users] tproxy sslbump and user authentication
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21950">[ date ]</a>
              <a href="thread.html#21950">[ thread ]</a>
              <a href="subject.html#21950">[ subject ]</a>
              <a href="author.html#21950">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
