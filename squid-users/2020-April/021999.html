<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid - Can't visit (government site and Banking Site) - Please help
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20-%20Can%27t%20visit%20%28government%20site%20and%20Banking%0A%20Site%29%20-%20Please%20help&In-Reply-To=%3Cf2e77210-801a-d043-f007-4d97ca95c318%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021995.html">
   <LINK REL="Next"  HREF="022001.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid - Can't visit (government site and Banking Site) - Please help</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20-%20Can%27t%20visit%20%28government%20site%20and%20Banking%0A%20Site%29%20-%20Please%20help&In-Reply-To=%3Cf2e77210-801a-d043-f007-4d97ca95c318%40treenet.co.nz%3E"
       TITLE="[squid-users] Squid - Can't visit (government site and Banking Site) - Please help">squid3 at treenet.co.nz
       </A><BR>
    <I>Sun Apr 26 08:18:02 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="021995.html">[squid-users] Squid - Can't visit (government site and Banking Site) - Please help
</A></li>
        <LI>Next message (by thread): <A HREF="022001.html">[squid-users] Squid - Can't visit (government site and Banking Site) - Please help
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21999">[ date ]</a>
              <a href="thread.html#21999">[ thread ]</a>
              <a href="subject.html#21999">[ subject ]</a>
              <a href="author.html#21999">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 25/04/20 9:09 am, russel0901 wrote:
&gt;<i> I am having a problem on my squid proxy
</I>&gt;<i> 
</I>
Which version of Squid are you using?
Output of squid -v would be best if you can provide.


&gt;<i> this settings is allow all but i can't visit sites like bancnetonline, rcbc,
</I>&gt;<i> philhealth (govt and bank site)
</I>&gt;<i> 
</I>&gt;<i> sometimes it can be visited, sometimes not... (weird???)
</I>&gt;<i> 
</I>&gt;<i> Please Help thank you.
</I>&gt;<i> 
</I>
Following is a free review of your config settings.

To actually determine your problem we will need log records of a failing
transaction. At least access.log entries you see for it, and maybe also
something from cache.log if that is not enough.

... which brings me to the first problem in your config.

&quot;cache_log /dev/null&quot; is a very bad idea. This completely hides all
information about problems from *you* - the problems still exist, still
seen by everyone else involved.
 All this does is erase most of your ability to troubleshoot.

If your objective is reduced log verbosity use this setting instead:
  debug_options ALL,0

That reduces cache.log contents to mentions about critical failures of
Squid.


&gt;<i> 
</I>&gt;<i> here is my squid conf...
</I>&gt;<i> 
</I>&gt;<i> max_filedesc 4096
</I>
Why so low? and why the deprecated RedHat experimental directive?

Current squid.conf directive is max_filedescriptors. It is a backup to
the --with-max-filedescriptors build option and system ulimit setup.



&gt;<i> request_header_access X-Forwarded-For allow all
</I>
This is pointless. All it does is waste CPU cycles on every request
through Squid.

&gt;<i> via off
</I>&gt;<i> httpd_suppress_version_string on
</I>&gt;<i> 
</I>&gt;<i> http_port 3333
</I>&gt;<i> icp_port 3535
</I>&gt;<i> 
</I>&gt;<i> hierarchy_stoplist cgi-bin ?
</I>
This is pointless. It is the default setting for all Squid-3 and later
versions.

&gt;<i> acl QUERY urlpath_regex cgi-bin \?
</I>&gt;<i> no_cache deny QUERY
</I>
QUERY is obsolete and actually somewhat harmful in current Squid.

For much improved caching you can add the missing refresh_pattern
mentioned below, then erase these and all other rules using QUERY ACL name.


&gt;<i> cache_mem 32 MB
</I>&gt;<i> maximum_object_size 5480 KB
</I>&gt;<i> cache_dir ufs /home/squidcache 6000 16 256
</I>&gt;<i> #cache_dir ufs /home/squidcache2 6000 16 256
</I>&gt;<i> cache_access_log /home/squidcache/access.log
</I>
This directive has been deprecated since early Squid-2.
Current Squid use:
  access_log /home/squidcache/access.log


&gt;<i> cache_log /dev/null
</I>
Already mentioned the problems with this. Please revert it to the
default for your Squid version. You will need this log to investigate
the current problem.


&gt;<i> cache_store_log none
</I>
This is pointless. It is the default for all current Squid.

&gt;<i> ftp_user <A HREF="https://lists.squid-cache.org/listinfo/squid-users">Squid at mds.com.sg</A>
</I>&gt;<i> dns_defnames on
</I>&gt;<i> request_body_max_size 10000 MB
</I>&gt;<i> refresh_pattern ^ftp:           1440    20%     10080
</I>&gt;<i> refresh_pattern ^gopher:        1440    0%      1440
</I>
Missing pattern:

  refresh_pattern -i (/cgi-bin/|\?) 0     0%      0


&gt;<i> refresh_pattern .               0       20%     4320
</I>&gt;<i> negative_ttl 1 minute
</I>&gt;<i> negative_dns_ttl 5 minute
</I>&gt;<i> connect_timeout 60 minute
</I>&gt;<i> read_timeout 5 minute
</I>&gt;<i> request_timeout 60 second
</I>&gt;<i> client_lifetime 4 hour
</I>&gt;<i> half_closed_clients off
</I>&gt;<i> pconn_timeout 240 second
</I>&gt;<i> shutdown_lifetime 5 second
</I>&gt;<i> #acl localhost src 127.0.0.1/32 ::1
</I>&gt;<i> #acl to_localhost dst 127.0.0.0/8 0.0.0.0/32 ::1
</I>&gt;<i> acl SSL_ports port 443 563 8003 8000 8080 8020 8021 8030 8031 8053 9053
</I>&gt;<i> acl Safe_ports port 80 81 88 21 443 563 70 210 1025-65535
</I>&gt;<i> acl Safe_ports port 280 # http-mgmt
</I>&gt;<i> acl Safe_ports port 488 # gss-http
</I>&gt;<i> acl Safe_ports port 591 # filemaker
</I>&gt;<i> acl Safe_ports port 777 # multiling http
</I>&gt;<i> acl CONNECT method CONNECT
</I>&gt;<i> acl PURGE method purge
</I>
Do you or clients actually use PURGE method requests?

It would be worth looking into why. That old Squid custom extension to
HTTP is deprecated.

Current Squid obey HTTP/1.1 caching far better than old Squid-2 and
earlier versions. You can use Cache-Control:no-cache *request* header to
update cache contents better than PURGE ever could.

Also, HTCP protocol is better for cache management with HTTP/1.1 than
either PURGE or ICP protocol. If you can find or adapt tools to use that
protocol they will be much better off.




&gt;<i> acl manager proto cache_object
</I>
This is also a deprecated manager ACL definition. This implies that your
Squid is quite old. Please upgrade to a more current version.


&gt;<i> acl apache src 10.20.0.245
</I>&gt;<i> 
</I>&gt;<i> acl QUERY urlpath_regex -i owa
</I>&gt;<i> acl QUERY2 urlpath_regex cgi-bin \?
</I>&gt;<i> acl QUERY3 urlpath_regex -i php
</I>&gt;<i> acl dontcache dstdomain &quot;/etc/squid/dontcache&quot;
</I>&gt;<i> no_cache deny QUERY
</I>&gt;<i> no_cache deny QUERY2
</I>&gt;<i> no_cache deny QUERY3
</I>
&quot;no_cache&quot; is deprecated. Above rules are actually doing &quot;cache deny&quot;.


It would be worth investigating why any URL containing the letters &quot;owa&quot;
or &quot;php&quot; are apparently trying to be forced to cache.

Please notice these ACL regex match if those letters occur *anywhere* in
the URL path portion. That includes 'folder' , 'filename', query-string,
and fragment strings. Also in non-HTTP URLs which have 'path' portions
and such.


&gt;<i> always_direct allow dontcache
</I>
This is a routing control directive. ACL called 'dontcache' is confusing
as reason to prevent routing to cache_peer - which do not exist in this
config anyway.

As a result of this any domain not listed in &quot;dontcache&quot; ACL will be
prevented from service by this proxy.

If that is actually what you want to happen, it would be better
configuring this:

 http_access deny !dontcache

... but you have explicitly put the exact opposite in your http_access
rules below. Which implies these rules are completely broken.


&gt;<i> 
</I>&gt;<i> #allowed sites
</I>&gt;<i> acl blockedsites dstdomain &quot;/etc/squid/blockedsites&quot;
</I>&gt;<i> acl allowedsites dstdomain &quot;/etc/squid/authorizedsites&quot;
</I>&gt;<i> acl tahiti src 172.16.20.254/32
</I>&gt;<i> acl elmo src 10.20.0.254/32
</I>&gt;<i> acl mnlnet2 src &quot;/etc/squid/authorized&quot;
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> http_access allow dontcache
</I>&gt;<i> http_access allow manager apache
</I>&gt;<i> http_access allow all
</I>
All following http_access rules are pointless.

Since all previous http_access rules are 'allow' they are also pointless
waste of CPU cycles.

This is an open proxy, with no logging. As such the only security
protection you have is the miss_access which *breaks* a huge amount of
traffic. If it were not for that your network would be completely open
to any type of attack.



&gt;<i> http_access allow elmo
</I>&gt;<i> #http_access allow localhost
</I>&gt;<i> #http_access allow purge localhost
</I>&gt;<i> #http_access allow manager localhost
</I>&gt;<i> http_access allow mnlnet2
</I>&gt;<i> http_access allow tahiti
</I>&gt;<i> http_access deny !Safe_ports
</I>&gt;<i> #http_access deny manager
</I>&gt;<i> http_access deny CONNECT !SSL_ports
</I>&gt;<i> http_access deny purge
</I>&gt;<i> http_access deny blockedsites
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> #icp_access  allow  localhost
</I>&gt;<i> icp_access allow all
</I>
None of the following icp_access rules have any effect.

This proxy does not have any cache_peer to send ICP traffic to.


&gt;<i> icp_access allow elmo
</I>&gt;<i> icp_access allow tahiti
</I>&gt;<i> icp_access allow mnlnet2
</I>&gt;<i> miss_access allow all
</I>
This miss_access is pointless. It is the default behaviour of Squid.


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="021995.html">[squid-users] Squid - Can't visit (government site and Banking Site) - Please help
</A></li>
	<LI>Next message (by thread): <A HREF="022001.html">[squid-users] Squid - Can't visit (government site and Banking Site) - Please help
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21999">[ date ]</a>
              <a href="thread.html#21999">[ thread ]</a>
              <a href="subject.html#21999">[ subject ]</a>
              <a href="author.html#21999">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
