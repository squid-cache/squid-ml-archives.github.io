<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Best way to prevent squid from bumping CONNECTs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Best%20way%20to%20prevent%20squid%20from%20bumping%20CONNECTs&In-Reply-To=%3C8e4ac1e0-871f-5532-116f-904df0ad9c80%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022014.html">
   <LINK REL="Next"  HREF="022037.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Best way to prevent squid from bumping CONNECTs</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Best%20way%20to%20prevent%20squid%20from%20bumping%20CONNECTs&In-Reply-To=%3C8e4ac1e0-871f-5532-116f-904df0ad9c80%40measurement-factory.com%3E"
       TITLE="[squid-users] Best way to prevent squid from bumping CONNECTs">rousskov at measurement-factory.com
       </A><BR>
    <I>Mon Apr 27 19:09:03 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="022014.html">[squid-users] Best way to prevent squid from bumping CONNECTs
</A></li>
        <LI>Next message (by thread): <A HREF="022037.html">[squid-users] Best way to prevent squid from bumping CONNECTs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22015">[ date ]</a>
              <a href="thread.html#22015">[ thread ]</a>
              <a href="subject.html#22015">[ subject ]</a>
              <a href="author.html#22015">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 4/27/20 12:21 PM, Scott wrote:

&gt;<i> my experience with ssl_bump is that it tries to bump SSL connections whether 
</I>&gt;<i> presented to Squid explicitly or implicitly.
</I>
* For http_port configured with an ssl-bump flag, HTTP CONNECT tunnels
are sent to the SslBump code.

* For https_port configured with an ssl-bump flag, all traffic is sent
to the SslBump code (by faking a corresponding HTTP CONNECT request).

* All other traffic is not sent to the SslBump code.

SslBump code honors ssl_bump rules when inspecting and
splicing/bumping/terminating/etc. traffic.


&gt;<i> When simply configuring `ssl_bump bump host_acl' the Squid logs show Squid 
</I>&gt;<i> trying, and failing, to bump CONNECT requests.  They may be failing due to 
</I>&gt;<i> certificate issue most likely, I'm not sure.  I can't add to the certificate 
</I>&gt;<i> store of the software that has the proxy configured (i.e. it will not permit 
</I>&gt;<i> bumping).
</I>
* If you do not want Squid to use SslBump features on traffic arriving
on port X, then do not add the ssl-bump flag to that port X.

* If you want to use the same port for traffic that should be bumped and
traffic that should not be inspected beyond step1, adjust your ssl_bump
step1 rules to distinguish the two kinds of messages.

Needless to say, you decide which traffic goes to which listening port
and whether a single port serves multiple traffic categories.


&gt;<i> Is it expected that Squid will bump/splice CONNECT requests?
</I>
It depends -- some CONNECT tunnels are expected to be inspected and
bumped, spliced, terminated, etc., according to the configuration.
Please see above for the details. Squid does not know what it will find
inside the CONNECT tunnel until it starts inspecting that tunnel.


&gt;<i> Because not all CONNECT sessions are SSL, if the CONNECT destination does not 
</I>&gt;<i> begin a TLS handshake will Squid revert to simply creating a TCP tunnel 
</I>&gt;<i> instead of bumping?
</I>
SslBump expects SSL/TLS traffic inside CONNECT tunnels that it is
configured to inspect. If an inspecting Squid decides that it got some
other traffic, Squid follows the on_unsupported_protocol configuration.


&gt;<i> My workaround has been to simply add `!CONNECT' to the `ssl_bump host_acl' 
</I>&gt;<i> statements.  Squid will happily bump the SSL sessions and proxy the CONNECT 
</I>&gt;<i> sessions.
</I>
AFAICT, that workaround cannot work on modern Squids because all traffic
subject to ssl_bump rules will start as a (real or fake) CONNECT request.


HTH,

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="022014.html">[squid-users] Best way to prevent squid from bumping CONNECTs
</A></li>
	<LI>Next message (by thread): <A HREF="022037.html">[squid-users] Best way to prevent squid from bumping CONNECTs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22015">[ date ]</a>
              <a href="thread.html#22015">[ thread ]</a>
              <a href="subject.html#22015">[ subject ]</a>
              <a href="author.html#22015">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
