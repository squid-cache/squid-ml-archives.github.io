<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Ubuntu 18 with Squid 4.11 SSL_BUMP
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Ubuntu%2018%20with%20Squid%204.11%20SSL_BUMP&In-Reply-To=%3Ce8cb2ef2-347e-d0ff-e92c-14ffb1665bef%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022032.html">
   <LINK REL="Next"  HREF="022034.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Ubuntu 18 with Squid 4.11 SSL_BUMP</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Ubuntu%2018%20with%20Squid%204.11%20SSL_BUMP&In-Reply-To=%3Ce8cb2ef2-347e-d0ff-e92c-14ffb1665bef%40treenet.co.nz%3E"
       TITLE="[squid-users] Ubuntu 18 with Squid 4.11 SSL_BUMP">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Apr 29 20:33:17 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="022032.html">[squid-users] [EXTERNAL] Re: Ubuntu 18 with Squid 4.11 SSL_BUMP
</A></li>
        <LI>Next message (by thread): <A HREF="022034.html">[squid-users] [EXTERNAL] Re: Ubuntu 18 with Squid 4.11 SSL_BUMP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22033">[ date ]</a>
              <a href="thread.html#22033">[ thread ]</a>
              <a href="subject.html#22033">[ subject ]</a>
              <a href="author.html#22033">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 30/04/20 8:15 am, Anthony Mead wrote:
&gt;<i> Thanks!  I've re-compiled without the unnecessary flag, and restarted the service with a new whitelist, unfortunately i'm getting such a varying of /var/log/squid/access.log messages that I'm not sure what to google anymore.
</I>&gt;<i> 
</I>&gt;<i> I want to deny all access to external sites except http/https github.com but some sites seem to connect, while others don't:
</I>&gt;<i> 
</I>
There are a lot of details missing from your quoted log lines. Details
such as which server was contacted are important when there are more
than one TCP connection involved.

Since this is SSL-Bump _each_ curl request should result in _3_
access.log lines - with varying client, server and URI values.

You are only showing us one log line at a time. With only the client and
URI parts.


Bellow is a *guess* about what is going on, based on what the status
says. This is only to demonstrate that for each line you show there is
at least one situation where your squid.conf file tells Squid to do an
action which would result in that line. Whether these guesses are right
requires all the information you are omitting.



&gt;<i> ~$ # this is correct
</I>&gt;<i> ~$ curl <A HREF="http://github.com/">http://github.com/</A>
</I>&gt;<i> 10.0.1.180 TCP_MISS/301 200 GET <A HREF="http://github.com/">http://github.com/</A>
</I>&gt;<i> 
</I>
 acl allowed_http_sites dstdomain &quot;/etc/squid/whitelist.txt&quot;
 http_access allow allowed_http_sites


&gt;<i> ~$ # this is correct
</I>&gt;<i> ~$ curl <A HREF="https://github.com/">https://github.com/</A> 
</I>&gt;<i> 10.0.1.180 TCP_TUNNEL/200 107323 CONNECT 140.82.114.4:443
</I>&gt;<i> 
</I>
  acl SSL_port port 443
  http_access allow SSL_port

  ssl_bump peek all


&gt;<i> ~$ # this should deny
</I>&gt;<i> ~$ curl <A HREF="https://youtube.com/">https://youtube.com/</A>
</I>&gt;<i> 10.0.1.180 TCP_TUNNEL/200 4844 CONNECT 172.217.15.110:443
</I>&gt;<i> 
</I>
  acl SSL_port port 443
  http_access allow SSL_port

  ssl_bump peek all


&gt;<i> ~$ # this should deny
</I>&gt;<i> ~$ curl <A HREF="https://google.com/">https://google.com/</A>
</I>&gt;<i> 10.0.1.180 TCP_TUNNEL_ABORTED/200 5103 CONNECT 172.217.2.110:443
</I>&gt;<i> 
</I>
  acl SSL_port port 443
  http_access allow SSL_port

  ssl_bump peek all


&gt;<i> ~$ # this is denying - but not from squid, but openssl?
</I>&gt;<i> ~$ curl <A HREF="https://news.ycombinator.com/">https://news.ycombinator.com/</A>
</I>&gt;<i> curl: (35) OpenSSL SSL_connect: SSL_ERROR_SYSCALL in connection to news.ycombinator.com:443
</I>&gt;<i> 10.0.1.180 NONE_ABORTED/200 0 CONNECT 209.216.230.240:443
</I>&gt;<i> 
</I>
  acl SSL_port port 443
  http_access allow SSL_port

  ssl_bump terminate all



Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="022032.html">[squid-users] [EXTERNAL] Re: Ubuntu 18 with Squid 4.11 SSL_BUMP
</A></li>
	<LI>Next message (by thread): <A HREF="022034.html">[squid-users] [EXTERNAL] Re: Ubuntu 18 with Squid 4.11 SSL_BUMP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22033">[ date ]</a>
              <a href="thread.html#22033">[ thread ]</a>
              <a href="subject.html#22033">[ subject ]</a>
              <a href="author.html#22033">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
