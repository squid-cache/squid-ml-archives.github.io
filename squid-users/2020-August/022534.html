<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] SOLVED:  ext_ldap_group_acl
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SOLVED%3A%20%20ext_ldap_group_acl&In-Reply-To=%3C020b01d66f2f%24888fcd80%2499af6880%24%40edu.ti.ch%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022552.html">
   <LINK REL="Next"  HREF="022536.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] SOLVED:  ext_ldap_group_acl</H1>
    <B>Roberto Nunnari</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SOLVED%3A%20%20ext_ldap_group_acl&In-Reply-To=%3C020b01d66f2f%24888fcd80%2499af6880%24%40edu.ti.ch%3E"
       TITLE="[squid-users] SOLVED:  ext_ldap_group_acl">roberto.nunnari at edu.ti.ch
       </A><BR>
    <I>Mon Aug 10 16:01:39 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="022552.html">[squid-users] R:  Basic explanation on configuration
</A></li>
        <LI>Next message (by thread): <A HREF="022536.html">[squid-users] WebServer-SRG or Application SRG for Squid?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22534">[ date ]</a>
              <a href="thread.html#22534">[ thread ]</a>
              <a href="subject.html#22534">[ subject ]</a>
              <a href="author.html#22534">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello.

 

I just solved myself this problem. It was my mistake with the filters.

Here&#146;s how it goes :

 

/usr/lib64/squid/ext_ldap_group_acl -R -b &quot;dc=my,dc=domain&quot; -D
&quot;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid at my.domain</A>&quot; -W /etc/squid/ldappass.txt -f
&quot;(&amp;(sAMAccountName=%u)(memberof:1.2.840.113556.1.4.1941:=CN=%g,DC=my,dc=doma
in)(objectClass=user))&quot; -h mydc.my.domain

 

That &#145;:1.2.840.113556.1.4.1941:&#146; will cause a recursive lookup until it
finds a user. Useful when the user is not directly member of that group, but
is member of a group that is member of that group.

 

Best regards.

Robi

 

 

Da: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; Per conto di
Roberto Nunnari
Inviato: luned&#236;, 10 agosto 2020 10:41
A: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Oggetto: [squid-users] ext_ldap_group_acl

 

Hello.

 

I&#146;m setting up squid on a CentOS 8 server.

Authentication against active directory works well with basic_ldap_auth, but
I fail when trying to check that a user belongs to a group.

It seems to me that for ext_ldap_group_acl it&#146;s enough that both the user
and the group exist and it returns OK. It returns ERR when it cannot find
the group or the user.

 

To make it more clear, here are the queries and results I get.

user1.test exists and is a member of group My_Group

user2.test exists and is NOT a member of group My_Group

Group asdf does NOT exist

 

So, I expect that when asking for

-          user1.test My_Group &gt;&gt; OK

-          user2.test My_Group &gt;&gt; ERR

But I get:

-          user1.test My_Group &gt;&gt; OK

-          user2.test My_Group &gt;&gt; OK

 

Here it is:

 

# /usr/lib64/squid/ext_ldap_group_acl -d -R -b &quot;dc=my,dc=domain&quot; -D
&quot;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid at my.domain</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid at my.domain</A>&gt; &quot; -W /etc/squid/ldappass.txt -F
&quot;(sAMAccountName=%s)&quot; -f &quot;(memberof=CN=%g,DC=my,DC=domain)&quot; -h
sv-102-dc.my.domain

user1.test asdf

ext_ldap_group_acl.cc(589): pid=194302 :Connected OK

ext_ldap_group_acl.cc(772): pid=194302 :user filter
'(sAMAccountName=user1.test)', searchbase 'dc=my,dc=domain'

ext_ldap_group_acl.cc(736): pid=194302 :group filter
'(memberof=CN=asdf,DC=my,DC=domain)', searchbase 'dc=my,dc=domain'

ERR

user1.test My_Group

ext_ldap_group_acl.cc(589): pid=194302 :Connected OK

ext_ldap_group_acl.cc(772): pid=194302 :user filter
'(sAMAccountName=user1.test)', searchbase 'dc=my,dc=domain'

ext_ldap_group_acl.cc(736): pid=194302 :group filter '(memberof=CN=My_Group,
DC=my,DC=domain)', searchbase 'dc=my,DC=domain'

OK

user2.test My_Group

ext_ldap_group_acl.cc(589): pid=194302 :Connected OK

ext_ldap_group_acl.cc(772): pid=194302 :user filter
'(sAMAccountName=user2.test)', searchbase 'dc=my,dc=domain'

ext_ldap_group_acl.cc(736): pid=194302 :group filter '(memberof=CN=My_Group,
DC=my,DC=domain)', searchbase 'dc=my,DC=domain'

OK

 

My env:

# uname -rms

Linux 4.18.0-193.14.2.el8_2.x86_64 x86_64

# rpm -qa | grep squid

squid-4.4-8.module_el8.2.0+319+d18e041f.1.x86_64

 

Could any kind soul help me out?

 

Thank you and best regards.

Robi

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20200810/d445ec50/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20200810/d445ec50/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="022552.html">[squid-users] R:  Basic explanation on configuration
</A></li>
	<LI>Next message (by thread): <A HREF="022536.html">[squid-users] WebServer-SRG or Application SRG for Squid?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22534">[ date ]</a>
              <a href="thread.html#22534">[ thread ]</a>
              <a href="subject.html#22534">[ subject ]</a>
              <a href="author.html#22534">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
