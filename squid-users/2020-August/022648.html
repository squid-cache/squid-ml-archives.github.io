<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 3.5 - icap parsing error
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.5%20-%20icap%20parsing%20error&In-Reply-To=%3Cdccc62c4-3426-8e4a-bc07-1eece3b6bb3e%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022647.html">
   <LINK REL="Next"  HREF="022649.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 3.5 - icap parsing error</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.5%20-%20icap%20parsing%20error&In-Reply-To=%3Cdccc62c4-3426-8e4a-bc07-1eece3b6bb3e%40measurement-factory.com%3E"
       TITLE="[squid-users] Squid 3.5 - icap parsing error">rousskov at measurement-factory.com
       </A><BR>
    <I>Sun Aug 30 01:48:31 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="022647.html">[squid-users] Squid 3.5 - icap parsing error
</A></li>
        <LI>Next message (by thread): <A HREF="022649.html">[squid-users] seeking assistance for home users wanting to cache https contents
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22648">[ date ]</a>
              <a href="thread.html#22648">[ thread ]</a>
              <a href="subject.html#22648">[ subject ]</a>
              <a href="author.html#22648">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 8/29/20 6:04 PM, Amos Jeffries wrote:
&gt;<i> On 29/08/20 8:29 am, VON EUW Andreas wrote:
</I>&gt;&gt;<i> Squid does send a OPTIONS request to the icap server.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> We get a valid answer from Symantec Protection Engine. 
</I>
As Amos correctly pointed out, the answer Squid gets is syntactically
invalid. The packet captures you have attached (thank you!) confirm that
the ICAP server forgets to send an empty line after the first 650 bytes
of the ICAP response header.


&gt;&gt;<i> But squid fails afterwards with a parsing exception:
</I>
More accurately, the exception is thrown later than the not-yet-failing
log lines you quoted. Here is the exception line:

  2020/08/26 10:04:54.593| 93,3| ...
Adaptation::Icap::Xaction::noteCommRead threw exception: parsed || !error

 &#160;
&gt;<i> So Squid is waiting for the rest of the headers to arrive from the server.
</I>
Yes, and (3ms later) Squid reads the EOF on the ICAP connection and
(correctly) throws the above exception.

Hopefully, you get get a fixed version of the ICAP server from Symantec.


Cheers,

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="022647.html">[squid-users] Squid 3.5 - icap parsing error
</A></li>
	<LI>Next message (by thread): <A HREF="022649.html">[squid-users] seeking assistance for home users wanting to cache https contents
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22648">[ date ]</a>
              <a href="thread.html#22648">[ thread ]</a>
              <a href="subject.html#22648">[ subject ]</a>
              <a href="author.html#22648">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
