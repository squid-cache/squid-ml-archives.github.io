<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] seeking assistance for home users wanting to cache https contents
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20seeking%20assistance%20for%20home%20users%20wanting%20to%0A%20cache%20https%20contents&In-Reply-To=%3C45ddd73d-cb27-13ba-08c5-1feff524a4e0%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022649.html">
   <LINK REL="Next"  HREF="022654.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] seeking assistance for home users wanting to cache https contents</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20seeking%20assistance%20for%20home%20users%20wanting%20to%0A%20cache%20https%20contents&In-Reply-To=%3C45ddd73d-cb27-13ba-08c5-1feff524a4e0%40treenet.co.nz%3E"
       TITLE="[squid-users] seeking assistance for home users wanting to cache https contents">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon Aug 31 11:04:03 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="022649.html">[squid-users] seeking assistance for home users wanting to cache https contents
</A></li>
        <LI>Next message (by thread): <A HREF="022654.html">[squid-users] limit bandwidth
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22650">[ date ]</a>
              <a href="thread.html#22650">[ thread ]</a>
              <a href="subject.html#22650">[ subject ]</a>
              <a href="author.html#22650">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 31/08/20 7:51 am, Michael Davis wrote:
&gt;<i> okay, so I'm working on making a public github repository for others
</I>&gt;<i> like me out there that are having such a hard time with this, given the
</I>&gt;<i> state of the web being almost completely&#160;run via SSL websites, who want
</I>&gt;<i> to use squid for bandwidth easing in these times of everyone being stuck
</I>&gt;<i> in home isolation, but given that this literally constitutes making what
</I>&gt;<i> is by design a man in the middle attack, I am finding it more difficult
</I>&gt;<i> than learning to do brain surgery (I am not a surgeon).
</I>
FYI, a github repository is not always the right answer. Everyones needs
are slightly different, so what we have in the Squid Project is a wiki
of examples with enough explanation that people should be able to make
the small changes necessary for their needs.

 &lt;<A HREF="https://wiki.squid-cache.org/ConfigExamples/">https://wiki.squid-cache.org/ConfigExamples/</A>&gt;

I have updated
&lt;<A HREF="https://wiki.squid-cache.org/ConfigExamples/Intercept/SslBumpWithIntermediateCA">https://wiki.squid-cache.org/ConfigExamples/Intercept/SslBumpWithIntermediateCA</A>&gt;
to clarify the squid.conf port lines you need.

&lt;<A HREF="https://wiki.squid-cache.org/Features/SslPeekAndSplice">https://wiki.squid-cache.org/Features/SslPeekAndSplice</A>&gt; documents the
ssl_bump access controls.


&gt;<i> 
</I>&gt;<i> my goal is to set up squid so that it can properly decrypt SSL traffic
</I>&gt;<i> for my own local devices, I own everything on this network, so this is
</I>&gt;<i> not an ethical problem for me given I am the sole user of everything on
</I>&gt;<i> my own network, and I want to PROPERLY be able to cache contents that
</I>&gt;<i> are otherwise delivered by SSL (nvidia graphics driver updates,
</I>
FYI, &quot;proper&quot; caching has nothing to do with SSL-Bump.

Separate any changes you want in relation to caching from the SSL-Bump
changes. Test each set of changes independently to get one feature going
before you move on to the other.


&gt;<i> 
</I>&gt;<i> I have done extensive research, and even after having another member of
</I>
Unfortunately TLS is one topic where things have been very volatile. So
the more research you do may expose you to outdated and/or irrelevant
details that just add confusion.

If you have two confusing sources of information (including archived
mailing list replies) go with the official wiki page as authoritative.
Or ask here, that is what this mailing list is for.


&gt;<i> the pfsense community join my attempts at this, we both are at a loss on
</I>
FYI, pfsense should not be relevant to SSL-Bump. Like caching the two
features can be used, but are not directly related to each other. So
setup, test and get each working separately.


&gt;<i> how to correctly set up peek and splice to do the job were after here,
</I>&gt;<i> that being decrypting SSL traffic for local lans (yes we both know the
</I>&gt;<i> implications, but they are in both of our cases our own property and
</I>&gt;<i> networks and we are both the only people using them individually
</I>&gt;<i> respectively) and yes we both have also installed our local certificate
</I>&gt;<i> authority certificates on our devices to let it work properly, we just
</I>&gt;<i> don't seem to understand enough on how peek and splice is supposed to
</I>&gt;<i> work, to implement it properly, and thus, the guy I'm working with on
</I>&gt;<i> this suggested we reach out to this mailing list and ask those here that
</I>&gt;<i> understand it more than we do.
</I>&gt;<i> 
</I>
So what I am understanding from your description is that you are trying to:
 A) intercept traffic with pfsense
 B) SSL-Bump the TLS which arrives at the proxy
 C) cache the decrypted HTTP messages

Is that correct?


The pfsense portion I cannot help much with right now, it has been too
long since I worked with that software.

All I can say is:

 1) the config examples we have in the wiki for setting up the
interception part should work fine, and

 2) test it *without* worrying about SSL-Bump or caching. Make sure it
works before going on to the other features, and

 3) &quot;working&quot; for the port 443 intercept (no bumping) can take the form
of HTTP error messages from Squid or client rejecting TLS handshake
details from Squid. Both of these mean the traffic is reaching Squid and
client getting whatever Squid produces.


For SSL-Bump when (after pfsense intercept is working) you want to
follow
&lt;<A HREF="https://wiki.squid-cache.org/ConfigExamples/Intercept/SslBumpWithIntermediateCA">https://wiki.squid-cache.org/ConfigExamples/Intercept/SslBumpWithIntermediateCA</A>&gt;
to get a successful TLS handshake happening.

You can use these bare-bones ssl_bump settings to pass the traffic
through Squid without decrypt to start with:

  acl step1 at_step SslBump1
  ssl_bump peek step1
  ssl_bump splice all


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="022649.html">[squid-users] seeking assistance for home users wanting to cache https contents
</A></li>
	<LI>Next message (by thread): <A HREF="022654.html">[squid-users] limit bandwidth
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22650">[ date ]</a>
              <a href="thread.html#22650">[ thread ]</a>
              <a href="subject.html#22650">[ subject ]</a>
              <a href="author.html#22650">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
