<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Proxy Server closes the connection to http server before transferring all application data to http client
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Proxy%20Server%20closes%20the%20connection%20to%20http%20server%0A%20before%20transferring%20all%20application%20data%20to%20http%20client&In-Reply-To=%3CCH2PR19MB4085702A69D77EB2B710C1A5F0C60%40CH2PR19MB4085.namprd19.prod.outlook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023034.html">
   <LINK REL="Next"  HREF="023040.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Proxy Server closes the connection to http server before transferring all application data to http client</H1>
    <B>Zhang, Lily (USD)</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Proxy%20Server%20closes%20the%20connection%20to%20http%20server%0A%20before%20transferring%20all%20application%20data%20to%20http%20client&In-Reply-To=%3CCH2PR19MB4085702A69D77EB2B710C1A5F0C60%40CH2PR19MB4085.namprd19.prod.outlook.com%3E"
       TITLE="[squid-users] Proxy Server closes the connection to http server before transferring all application data to http client">Lily.Zhang at dell.com
       </A><BR>
    <I>Tue Dec 15 07:52:18 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="023034.html">[squid-users] Proxy Server closes the connection to http server before transferring all application data to http client
</A></li>
        <LI>Next message (by thread): <A HREF="023040.html">[squid-users] Proxy Server closes the connection to http server before transferring all application data to http client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23035">[ date ]</a>
              <a href="thread.html#23035">[ thread ]</a>
              <a href="subject.html#23035">[ subject ]</a>
              <a href="author.html#23035">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks Amos for your quick reply.

Looks we can use &quot;Connection: keep-alive&quot; in http request to solve this issue.

Thanks
Lily

-----Original Message-----
From: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; On Behalf Of Amos Jeffries
Sent: Tuesday, December 15, 2020 3:47 PM
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] Proxy Server closes the connection to http server before transferring all application data to http client


[EXTERNAL EMAIL] 

On 15/12/20 4:21 pm, Zhang, Lily (USD) wrote:
&gt;<i> Hi
</I>&gt;<i> 
</I>&gt;<i> I installed 4.13 squid proxy server. See attachment, http server
</I>&gt;<i> (10.250.16.46) sends FIN, ACK to tells that response is finished. &#160;
</I>&gt;<i> Proxy server (10.244.102.133) sends FIN, ACK back to http server
</I>&gt;<i> (10.250.16.46) before &quot;Application Data&quot; is transferred to http client 
</I>&gt;<i> (10.245.166.20).
</I>&gt;<i> 
</I>&gt;<i> Would you please help me on questions below:
</I>&gt;<i> 
</I>&gt;<i>  1. Is it normal that proxy server sends FIN, ACK to http server before
</I>&gt;<i>     http client finishes receiving &#160;all the &#8220;Application Data&#8221; ?
</I>
That depends on the transaction which is being performed.

If it is a normal HTTP request-response transaction then yes. Once Squid has the response the server connection is done with - it may be closed or re-used for other transactions.

If it is a tunnel containing non-HTTP traffic then no. Squid should only close the server connection when the client closes its end of the tunnel.

Also, note that FIN+ACK in a single packet is a *response* to a FIN having come from the server itself. Not initiated by the proxy.



&gt;<i>  2. Does proxy server have option to stop item 1?
</I>&gt;<i> 
</I>
In general: No. This is something that is supposed to happen (or not) 
according to the relevant protocol requirements.

In specific, there may be some options that can be configured to change 
how the protocol behaves. Preventing it needing a close. You will have 
to find out what the cause actually is to determine where to look for 
solutions.


Amos

_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="023034.html">[squid-users] Proxy Server closes the connection to http server before transferring all application data to http client
</A></li>
	<LI>Next message (by thread): <A HREF="023040.html">[squid-users] Proxy Server closes the connection to http server before transferring all application data to http client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23035">[ date ]</a>
              <a href="thread.html#23035">[ thread ]</a>
              <a href="subject.html#23035">[ subject ]</a>
              <a href="author.html#23035">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
