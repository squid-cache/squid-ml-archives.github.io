<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Anyone has experience with Windows clients DNS timeout
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Anyone%20has%20experience%20with%20Windows%20clients%20DNS%0A%20timeout&In-Reply-To=%3Cvmime.5fec3556.184c.372ab7535569aa25%40ms249-lin-003.rotterdam.bazuin.nl%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023078.html">
   <LINK REL="Next"  HREF="023080.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Anyone has experience with Windows clients DNS timeout</H1>
    <B>L.P.H. van Belle</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Anyone%20has%20experience%20with%20Windows%20clients%20DNS%0A%20timeout&In-Reply-To=%3Cvmime.5fec3556.184c.372ab7535569aa25%40ms249-lin-003.rotterdam.bazuin.nl%3E"
       TITLE="[squid-users] Anyone has experience with Windows clients DNS timeout">belle at bazuin.nl
       </A><BR>
    <I>Wed Dec 30 08:07:50 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="023078.html">[squid-users] Anyone has experience with Windows clients DNS timeout
</A></li>
        <LI>Next message (by thread): <A HREF="023080.html">[squid-users] Anyone has experience with Windows clients DNS timeout
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23079">[ date ]</a>
              <a href="thread.html#23079">[ thread ]</a>
              <a href="subject.html#23079">[ subject ]</a>
              <a href="author.html#23079">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hai Elizer

Sorry, im not fully agreeing with Amos here.. 

If you DNS is taking 7-10 sec, i would investigate why the dns is that slow.
Something is off, that simple. 


A small example of my dns resolving to internet and my lan dnsservers. 

time dig a www.google.nl @8.8.8.8  @internet dns
real    0m0.115s

real    0m0.031s	@lan dns, lookup 1. 
real    0m0.016s	@lan dns, lookup 2. (cached one) 

So, in my opinion 7-10 seconds timeout is really off. 
In the last we.. 

Is the lan dns set as an authoritive server.
Are the pc's correctly registering in the dns with there primary DNS domain. 

in resolv.conf make sure the primaryDns domain is first in resolv.conf
primary.dnsdomain.tld = output of $(hostname -d)

search primary.dnsdomain.tld  (optional extra, other.dnsdomain.tld dnsdomain.tld ) 
nameserver 192.168.1.1
nameserver 192.168.1.2
nameserver 192.168.1.3
nameserver 192.168.1.4
nameserver 192.168.1.5

# these are the options to look into also. ( in this order ) 
options edns0		# allowed 4096 byte packages. 
options rotate		# if you have more then 1 dns server this can help. 
options timeout:3	
options no-check-names	# dont check for invalid characters such as underscore (_), non-ASCII, or control characters.


Check the following. 
- the DNS server tries to query first to the internet. 
fix might be, resolving (search line) in /etc/resolv.conf

ipv4 / ipv6, try disableing ipv6 on the windows clients.
Dns is Non authoritive where it might be needed to set it to Authoritive.
Dns server is missing forwaring to the authoritive server. 
Routing and routing orders
Are EDNS (4096bytes) big packages allowed
And is the firewall allowing UDP and TCP packages on port 53

I run 3 samba-AD dns servers with Bind9_DLZ
My proxy runs a Bind9 caching and forwarding setup. 
The primay DNS domain is forwarded to the Samba-AD dns server. 
These are the Authoritive servers. 

This is on average my slowest querie 0.1-0.2 sec  ( on the samba dns ) 
i checked the last year in my monitoring. 
Normal is 0.03-0.01 sec 

If there are problems in samba these days its 80% of all cases a resolving setup problem. 

I hope this gave you some ideas. 


Greetz, 

Louis

&gt;<i> -----Oorspronkelijk bericht-----
</I>&gt;<i> Van: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] Namens
</I>&gt;<i> NgTech LTD
</I>&gt;<i> Verzonden: dinsdag 29 december 2020 21:02
</I>&gt;<i> Aan: Squid Users
</I>&gt;<i> Onderwerp: [squid-users] Anyone has experience with Windows clients DNS
</I>&gt;<i> timeout
</I>&gt;<i> 
</I>&gt;<i> I have seen this issue on Windows clients over the past.
</I>&gt;<i> Windows nslookup shows that the query has timed out after 2 seconds.
</I>&gt;<i> On Linux and xBSD I have researched this issue and have seen that:
</I>&gt;<i> the DNS server is doing a recursive lookup and it takes from 7 to 10++
</I>&gt;<i> seconds sometimes.
</I>&gt;<i> When I pre-warn the DNS cache and the results are cached it takes
</I>&gt;<i> lower then 500 ms for a response to be on the client side and then
</I>&gt;<i> everything works fine.
</I>&gt;<i> 
</I>&gt;<i> I understand that Windows DNS client times out..
</I>&gt;<i> When using froward proxy with squid or any other it works as expected
</I>&gt;<i> since the DNS resolution is done on the proxy server.
</I>&gt;<i> However for this issue I believe that this timeout should be increased
</I>&gt;<i> instead of moving to DNS over HTTPS.
</I>&gt;<i> 
</I>&gt;<i> I would like to hear if anyone has any resolution for this issue on
</I>&gt;<i> the Windows clients side.
</I>&gt;<i> 
</I>&gt;<i> Thanks,
</I>&gt;<i> Eliezer
</I>&gt;<i> 
</I>&gt;<i> ----
</I>&gt;<i> Eliezer Croitoru
</I>&gt;<i> Tech Support
</I>&gt;<i> Mobile: +972-5-28704261
</I>&gt;<i> Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="023078.html">[squid-users] Anyone has experience with Windows clients DNS timeout
</A></li>
	<LI>Next message (by thread): <A HREF="023080.html">[squid-users] Anyone has experience with Windows clients DNS timeout
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23079">[ date ]</a>
              <a href="thread.html#23079">[ thread ]</a>
              <a href="subject.html#23079">[ subject ]</a>
              <a href="author.html#23079">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
