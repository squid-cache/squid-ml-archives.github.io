<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Anyone has experience with Windows clients DNS timeout
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Anyone%20has%20experience%20with%20Windows%20clients%20DNS%0A%20timeout&In-Reply-To=%3Cdcbb5e74-da52-23be-c4bf-552e20ca6d92%40westkamp.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023079.html">
   <LINK REL="Next"  HREF="023081.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Anyone has experience with Windows clients DNS timeout</H1>
    <B>Klaus Westkamp</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Anyone%20has%20experience%20with%20Windows%20clients%20DNS%0A%20timeout&In-Reply-To=%3Cdcbb5e74-da52-23be-c4bf-552e20ca6d92%40westkamp.net%3E"
       TITLE="[squid-users] Anyone has experience with Windows clients DNS timeout">klaus at westkamp.net
       </A><BR>
    <I>Wed Dec 30 09:57:21 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="023079.html">[squid-users] Anyone has experience with Windows clients DNS timeout
</A></li>
        <LI>Next message (by thread): <A HREF="023081.html">[squid-users] Anyone has experience with Windows clients DNS timeout
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23080">[ date ]</a>
              <a href="thread.html#23080">[ thread ]</a>
              <a href="subject.html#23080">[ subject ]</a>
              <a href="author.html#23080">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hi,

i fully agree with Amos. I experience several seconds delay these days 
in resolving names.

Using google, which is having a very fast and heavily caching dns,
is not a good example for recreating this effect.

I could imagine that the seveal DNS encryption methods,
DNS-over-TLS and -over-HTTPS, that are only supported by some
adding to that delay, as they require more overhead
and also the client has to find out which method is supported and which not

Cheers,

Klaus Westkamp


On 30/12/2020 09:07, L.P.H. van Belle wrote:
&gt;<i> Hai Elizer
</I>&gt;<i>
</I>&gt;<i> Sorry, im not fully agreeing with Amos here..
</I>&gt;<i>
</I>&gt;<i> If you DNS is taking 7-10 sec, i would investigate why the dns is that slow.
</I>&gt;<i> Something is off, that simple.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> A small example of my dns resolving to internet and my lan dnsservers.
</I>&gt;<i>
</I>&gt;<i> time dig a www.google.nl @8.8.8.8  @internet dns
</I>&gt;<i> real    0m0.115s
</I>&gt;<i>
</I>&gt;<i> real    0m0.031s	@lan dns, lookup 1.
</I>&gt;<i> real    0m0.016s	@lan dns, lookup 2. (cached one)
</I>&gt;<i>
</I>&gt;<i> So, in my opinion 7-10 seconds timeout is really off.
</I>&gt;<i> In the last we..
</I>&gt;<i>
</I>&gt;<i> Is the lan dns set as an authoritive server.
</I>&gt;<i> Are the pc's correctly registering in the dns with there primary DNS domain.
</I>&gt;<i>
</I>&gt;<i> in resolv.conf make sure the primaryDns domain is first in resolv.conf
</I>&gt;<i> primary.dnsdomain.tld = output of $(hostname -d)
</I>&gt;<i>
</I>&gt;<i> search primary.dnsdomain.tld  (optional extra, other.dnsdomain.tld dnsdomain.tld )
</I>&gt;<i> nameserver 192.168.1.1
</I>&gt;<i> nameserver 192.168.1.2
</I>&gt;<i> nameserver 192.168.1.3
</I>&gt;<i> nameserver 192.168.1.4
</I>&gt;<i> nameserver 192.168.1.5
</I>&gt;<i>
</I>&gt;<i> # these are the options to look into also. ( in this order )
</I>&gt;<i> options edns0		# allowed 4096 byte packages.
</I>&gt;<i> options rotate		# if you have more then 1 dns server this can help.
</I>&gt;<i> options timeout:3	
</I>&gt;<i> options no-check-names	# dont check for invalid characters such as underscore (_), non-ASCII, or control characters.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Check the following.
</I>&gt;<i> - the DNS server tries to query first to the internet.
</I>&gt;<i> fix might be, resolving (search line) in /etc/resolv.conf
</I>&gt;<i>
</I>&gt;<i> ipv4 / ipv6, try disableing ipv6 on the windows clients.
</I>&gt;<i> Dns is Non authoritive where it might be needed to set it to Authoritive.
</I>&gt;<i> Dns server is missing forwaring to the authoritive server.
</I>&gt;<i> Routing and routing orders
</I>&gt;<i> Are EDNS (4096bytes) big packages allowed
</I>&gt;<i> And is the firewall allowing UDP and TCP packages on port 53
</I>&gt;<i>
</I>&gt;<i> I run 3 samba-AD dns servers with Bind9_DLZ
</I>&gt;<i> My proxy runs a Bind9 caching and forwarding setup.
</I>&gt;<i> The primay DNS domain is forwarded to the Samba-AD dns server.
</I>&gt;<i> These are the Authoritive servers.
</I>&gt;<i>
</I>&gt;<i> This is on average my slowest querie 0.1-0.2 sec  ( on the samba dns )
</I>&gt;<i> i checked the last year in my monitoring.
</I>&gt;<i> Normal is 0.03-0.01 sec
</I>&gt;<i>
</I>&gt;<i> If there are problems in samba these days its 80% of all cases a resolving setup problem.
</I>&gt;<i>
</I>&gt;<i> I hope this gave you some ideas.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Greetz,
</I>&gt;<i>
</I>&gt;<i> Louis
</I>&gt;<i>
</I>&gt;&gt;<i> -----Oorspronkelijk bericht-----
</I>&gt;&gt;<i> Van: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] Namens
</I>&gt;&gt;<i> NgTech LTD
</I>&gt;&gt;<i> Verzonden: dinsdag 29 december 2020 21:02
</I>&gt;&gt;<i> Aan: Squid Users
</I>&gt;&gt;<i> Onderwerp: [squid-users] Anyone has experience with Windows clients DNS
</I>&gt;&gt;<i> timeout
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I have seen this issue on Windows clients over the past.
</I>&gt;&gt;<i> Windows nslookup shows that the query has timed out after 2 seconds.
</I>&gt;&gt;<i> On Linux and xBSD I have researched this issue and have seen that:
</I>&gt;&gt;<i> the DNS server is doing a recursive lookup and it takes from 7 to 10++
</I>&gt;&gt;<i> seconds sometimes.
</I>&gt;&gt;<i> When I pre-warn the DNS cache and the results are cached it takes
</I>&gt;&gt;<i> lower then 500 ms for a response to be on the client side and then
</I>&gt;&gt;<i> everything works fine.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I understand that Windows DNS client times out..
</I>&gt;&gt;<i> When using froward proxy with squid or any other it works as expected
</I>&gt;&gt;<i> since the DNS resolution is done on the proxy server.
</I>&gt;&gt;<i> However for this issue I believe that this timeout should be increased
</I>&gt;&gt;<i> instead of moving to DNS over HTTPS.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I would like to hear if anyone has any resolution for this issue on
</I>&gt;&gt;<i> the Windows clients side.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thanks,
</I>&gt;&gt;<i> Eliezer
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ----
</I>&gt;&gt;<i> Eliezer Croitoru
</I>&gt;&gt;<i> Tech Support
</I>&gt;&gt;<i> Mobile: +972-5-28704261
</I>&gt;&gt;<i> Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="023079.html">[squid-users] Anyone has experience with Windows clients DNS timeout
</A></li>
	<LI>Next message (by thread): <A HREF="023081.html">[squid-users] Anyone has experience with Windows clients DNS timeout
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23080">[ date ]</a>
              <a href="thread.html#23080">[ thread ]</a>
              <a href="subject.html#23080">[ subject ]</a>
              <a href="author.html#23080">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
