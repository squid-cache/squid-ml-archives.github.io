<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Anyone has experience with Windows clients DNS timeout
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Anyone%20has%20experience%20with%20Windows%20clients%20DNS%0A%20timeout&In-Reply-To=%3Cvmime.5fec5cf7.d9c.5e6680c11b8efee7%40ms249-lin-003.rotterdam.bazuin.nl%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023080.html">
   <LINK REL="Next"  HREF="023082.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Anyone has experience with Windows clients DNS timeout</H1>
    <B>L.P.H. van Belle</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Anyone%20has%20experience%20with%20Windows%20clients%20DNS%0A%20timeout&In-Reply-To=%3Cvmime.5fec5cf7.d9c.5e6680c11b8efee7%40ms249-lin-003.rotterdam.bazuin.nl%3E"
       TITLE="[squid-users] Anyone has experience with Windows clients DNS timeout">belle at bazuin.nl
       </A><BR>
    <I>Wed Dec 30 10:56:55 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="023080.html">[squid-users] Anyone has experience with Windows clients DNS timeout
</A></li>
        <LI>Next message (by thread): <A HREF="023082.html">[squid-users] Anyone has experience with Windows clients DNS timeout
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23081">[ date ]</a>
              <a href="thread.html#23081">[ thread ]</a>
              <a href="subject.html#23081">[ subject ]</a>
              <a href="author.html#23081">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>And, yes i agree, DNS over TLS might be slower, but really, if you have to wait seconds for a DNS reply... imagine.. 
Lots of websites have 10-20 hosts in them, if you have to wait 10 sec for a website, well, im gone already then.

Thats why i also showed the direct tests my internal Authoritive DNS servers. ( and i can pick any host, will show the same results ). 

All im saying is, before you are going to hunt for &quot;possible&quot; problems.
Make sure the resolving is perfectly setup. 
It will fix at least a lot of problems.

I just dont like Dns over HTTPS.. 
<A HREF="https://www.zdnet.com/article/dns-over-https-causes-more-problems-than-it-solves-experts-say/">https://www.zdnet.com/article/dns-over-https-causes-more-problems-than-it-solves-experts-say/</A> 

<A HREF="https://www.samknows.com/blog/dns-over-https-performance">https://www.samknows.com/blog/dns-over-https-performance</A>

Good articles to read. 

Enjoy. 

Greetz,

Louis


&gt;<i> -----Oorspronkelijk bericht-----
</I>&gt;<i> Van: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] Namens
</I>&gt;<i> Klaus Westkamp
</I>&gt;<i> Verzonden: woensdag 30 december 2020 10:57
</I>&gt;<i> Aan: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> Onderwerp: Re: [squid-users] Anyone has experience with Windows clients
</I>&gt;<i> DNS timeout
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> i fully agree with Amos. I experience several seconds delay these days
</I>&gt;<i> in resolving names.
</I>&gt;<i> 
</I>&gt;<i> Using google, which is having a very fast and heavily caching dns,
</I>&gt;<i> is not a good example for recreating this effect.
</I>&gt;<i> 
</I>&gt;<i> I could imagine that the seveal DNS encryption methods,
</I>&gt;<i> DNS-over-TLS and -over-HTTPS, that are only supported by some
</I>&gt;<i> adding to that delay, as they require more overhead
</I>&gt;<i> and also the client has to find out which method is supported and which
</I>&gt;<i> not
</I>&gt;<i> 
</I>&gt;<i> Cheers,
</I>&gt;<i> 
</I>&gt;<i> Klaus Westkamp
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On 30/12/2020 09:07, L.P.H. van Belle wrote:
</I>&gt;<i> &gt; Hai Elizer
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Sorry, im not fully agreeing with Amos here..
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; If you DNS is taking 7-10 sec, i would investigate why the dns is that
</I>&gt;<i> slow.
</I>&gt;<i> &gt; Something is off, that simple.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; A small example of my dns resolving to internet and my lan dnsservers.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; time dig a www.google.nl @8.8.8.8  @internet dns
</I>&gt;<i> &gt; real    0m0.115s
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; real    0m0.031s	@lan dns, lookup 1.
</I>&gt;<i> &gt; real    0m0.016s	@lan dns, lookup 2. (cached one)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; So, in my opinion 7-10 seconds timeout is really off.
</I>&gt;<i> &gt; In the last we..
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Is the lan dns set as an authoritive server.
</I>&gt;<i> &gt; Are the pc's correctly registering in the dns with there primary DNS
</I>&gt;<i> domain.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; in resolv.conf make sure the primaryDns domain is first in resolv.conf
</I>&gt;<i> &gt; primary.dnsdomain.tld = output of $(hostname -d)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; search primary.dnsdomain.tld  (optional extra, other.dnsdomain.tld
</I>&gt;<i> dnsdomain.tld )
</I>&gt;<i> &gt; nameserver 192.168.1.1
</I>&gt;<i> &gt; nameserver 192.168.1.2
</I>&gt;<i> &gt; nameserver 192.168.1.3
</I>&gt;<i> &gt; nameserver 192.168.1.4
</I>&gt;<i> &gt; nameserver 192.168.1.5
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; # these are the options to look into also. ( in this order )
</I>&gt;<i> &gt; options edns0		# allowed 4096 byte packages.
</I>&gt;<i> &gt; options rotate		# if you have more then 1 dns server this can
</I>&gt;<i> help.
</I>&gt;<i> &gt; options timeout:3
</I>&gt;<i> &gt; options no-check-names	# dont check for invalid characters such as
</I>&gt;<i> underscore (_), non-ASCII, or control characters.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Check the following.
</I>&gt;<i> &gt; - the DNS server tries to query first to the internet.
</I>&gt;<i> &gt; fix might be, resolving (search line) in /etc/resolv.conf
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ipv4 / ipv6, try disableing ipv6 on the windows clients.
</I>&gt;<i> &gt; Dns is Non authoritive where it might be needed to set it to
</I>&gt;<i> Authoritive.
</I>&gt;<i> &gt; Dns server is missing forwaring to the authoritive server.
</I>&gt;<i> &gt; Routing and routing orders
</I>&gt;<i> &gt; Are EDNS (4096bytes) big packages allowed
</I>&gt;<i> &gt; And is the firewall allowing UDP and TCP packages on port 53
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I run 3 samba-AD dns servers with Bind9_DLZ
</I>&gt;<i> &gt; My proxy runs a Bind9 caching and forwarding setup.
</I>&gt;<i> &gt; The primay DNS domain is forwarded to the Samba-AD dns server.
</I>&gt;<i> &gt; These are the Authoritive servers.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; This is on average my slowest querie 0.1-0.2 sec  ( on the samba dns )
</I>&gt;<i> &gt; i checked the last year in my monitoring.
</I>&gt;<i> &gt; Normal is 0.03-0.01 sec
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; If there are problems in samba these days its 80% of all cases a
</I>&gt;<i> resolving setup problem.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I hope this gave you some ideas.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Greetz,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Louis
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;&gt; -----Oorspronkelijk bericht-----
</I>&gt;<i> &gt;&gt; Van: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>]
</I>&gt;<i> Namens
</I>&gt;<i> &gt;&gt; NgTech LTD
</I>&gt;<i> &gt;&gt; Verzonden: dinsdag 29 december 2020 21:02
</I>&gt;<i> &gt;&gt; Aan: Squid Users
</I>&gt;<i> &gt;&gt; Onderwerp: [squid-users] Anyone has experience with Windows clients DNS
</I>&gt;<i> &gt;&gt; timeout
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; I have seen this issue on Windows clients over the past.
</I>&gt;<i> &gt;&gt; Windows nslookup shows that the query has timed out after 2 seconds.
</I>&gt;<i> &gt;&gt; On Linux and xBSD I have researched this issue and have seen that:
</I>&gt;<i> &gt;&gt; the DNS server is doing a recursive lookup and it takes from 7 to 10++
</I>&gt;<i> &gt;&gt; seconds sometimes.
</I>&gt;<i> &gt;&gt; When I pre-warn the DNS cache and the results are cached it takes
</I>&gt;<i> &gt;&gt; lower then 500 ms for a response to be on the client side and then
</I>&gt;<i> &gt;&gt; everything works fine.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; I understand that Windows DNS client times out..
</I>&gt;<i> &gt;&gt; When using froward proxy with squid or any other it works as expected
</I>&gt;<i> &gt;&gt; since the DNS resolution is done on the proxy server.
</I>&gt;<i> &gt;&gt; However for this issue I believe that this timeout should be increased
</I>&gt;<i> &gt;&gt; instead of moving to DNS over HTTPS.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; I would like to hear if anyone has any resolution for this issue on
</I>&gt;<i> &gt;&gt; the Windows clients side.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Thanks,
</I>&gt;<i> &gt;&gt; Eliezer
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; ----
</I>&gt;<i> &gt;&gt; Eliezer Croitoru
</I>&gt;<i> &gt;&gt; Tech Support
</I>&gt;<i> &gt;&gt; Mobile: +972-5-28704261
</I>&gt;<i> &gt;&gt; Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A>
</I>&gt;<i> &gt;&gt; _______________________________________________
</I>&gt;<i> &gt;&gt; squid-users mailing list
</I>&gt;<i> &gt;&gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> &gt;&gt; <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; squid-users mailing list
</I>&gt;<i> &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> &gt; <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="023080.html">[squid-users] Anyone has experience with Windows clients DNS timeout
</A></li>
	<LI>Next message (by thread): <A HREF="023082.html">[squid-users] Anyone has experience with Windows clients DNS timeout
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23081">[ date ]</a>
              <a href="thread.html#23081">[ thread ]</a>
              <a href="subject.html#23081">[ subject ]</a>
              <a href="author.html#23081">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
