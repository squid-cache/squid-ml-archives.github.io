<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] How do I rotate access.log?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20How%20do%20I%20rotate%20access.log%3F&In-Reply-To=%3CCAGCa14o_pNEPRUkY2-GwzfW0KGpszCeuNyrOw84JhNQLzTyi8g%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023076.html">
   <LINK REL="Next"  HREF="023095.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] How do I rotate access.log?</H1>
    <B>roee klinger</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20How%20do%20I%20rotate%20access.log%3F&In-Reply-To=%3CCAGCa14o_pNEPRUkY2-GwzfW0KGpszCeuNyrOw84JhNQLzTyi8g%40mail.gmail.com%3E"
       TITLE="[squid-users] How do I rotate access.log?">roeeklinger60 at gmail.com
       </A><BR>
    <I>Thu Dec 31 18:39:08 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="023076.html">[squid-users] How do I rotate access.log?
</A></li>
        <LI>Next message (by thread): <A HREF="023095.html">[squid-users] How do I rotate access.log?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23094">[ date ]</a>
              <a href="thread.html#23094">[ thread ]</a>
              <a href="subject.html#23094">[ subject ]</a>
              <a href="author.html#23094">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey Alex, thanks for the reply.

This is my Squid --version:

Squid Cache: Version 4.6
Service Name: squid
Debian linux
configure options:  '--build=i686-linux-gnu' '--prefix=/usr'
'--includedir=${prefix}/include' '--mandir=${prefix}/share/man'
'--infodir=${prefix}/share/info' '--sysconfdir=/etc' '--localstatedir=/var'
'--libexecdir=${prefix}/lib/squid' '--srcdir=.' '--disable-maintainer-mode'
'--disable-dependency-tracking' '--disable-silent-rules' 'BUILDCXXFLAGS=-g
-O2 -fdebug-prefix-map=/build/squid-wx8Sif/squid-4.6=.
-fstack-protector-strong -Wformat -Werror=format-security -Wdate-time
-D_FORTIFY_SOURCE=2 -Wl,-z,relro -Wl,-z,now -Wl,--as-needed -latomic'
'BUILDCXX=i686-linux-gnu-g++' '--with-build-environment=default'
'--enable-build-info=Debian linux' '--datadir=/usr/share/squid'
'--sysconfdir=/etc/squid' '--libexecdir=/usr/lib/squid'
'--mandir=/usr/share/man' '--enable-inline' '--disable-arch-native'
'--enable-async-io=8' '--enable-storeio=ufs,aufs,diskd,rock'
'--enable-removal-policies=lru,heap' '--enable-delay-pools'
'--enable-cache-digests' '--enable-icap-client'
'--enable-follow-x-forwarded-for'
'--enable-auth-basic=DB,fake,getpwnam,LDAP,NCSA,NIS,PAM,POP3,RADIUS,SASL,SMB'
'--enable-auth-digest=file,LDAP' '--enable-auth-negotiate=kerberos,wrapper'
'--enable-auth-ntlm=fake,SMB_LM'
'--enable-external-acl-helpers=file_userip,kerberos_ldap_group,LDAP_group,session,SQL_session,time_quota,unix_group,wbinfo_group'
'--enable-security-cert-validators=fake'
'--enable-storeid-rewrite-helpers=file' '--enable-url-rewrite-helpers=fake'
'--enable-eui' '--enable-esi' '--enable-icmp' '--enable-zph-qos'
'--enable-ecap' '--disable-translation' '--with-swapdir=/var/spool/squid'
'--with-logdir=/var/log/squid' '--with-pidfile=/var/run/squid.pid'
'--with-filedescriptors=65536' '--with-large-files'
'--with-default-user=proxy' '--with-gnutls' '--enable-linux-netfilter'
'build_alias=i686-linux-gnu' 'CC=i686-linux-gnu-gcc' 'CFLAGS=-g -O2
-fdebug-prefix-map=/build/squid-wx8Sif/squid-4.6=. -fstack-protector-strong
-Wformat -Werror=format-security -Wall' 'LDFLAGS=-Wl,-z,relro -Wl,-z,now
-Wl,--as-needed -latomic' 'CPPFLAGS=-Wdate-time -D_FORTIFY_SOURCE=2'
'CXX=i686-linux-gnu-g++' 'CXXFLAGS=-g -O2
-fdebug-prefix-map=/build/squid-wx8Sif/squid-4.6=. -fstack-protector-strong
-Wformat -Werror=format-security


If I follow your instructions, this is what I get:

2020/12/31 20:33:49 kid1| Logfile: opening log
daemon:/var/log/squid/access.log
2020/12/31 20:33:49 kid1| Logfile Daemon: opening log
/var/log/squid/access.log
2020/12/31 20:33:49 kid1| Store logging disabled
2020/12/31 20:33:57 kid1| logfileRotate: daemon:/var/log/squid/access.log
2020/12/31 20:33:57 kid1| logfileRotate: daemon:/var/log/squid/access.log
2020/12/31 20:33:57 kid1| Logfile: opening log
daemon:/var/log/squid/access.log
2020/12/31 20:33:57 kid1| Logfile Daemon: opening log
/var/log/squid/access.log
2020/12/31 20:33:57 kid1| Store logging disabled


For &quot;rotate&quot; I am getting nothing, but I do however see transactions
getting logged to access.log and my logging daemon is running properly.

&gt;<i> How do you know that your access.log was _not_ rotated?
</I>

Well, for cache.log I can that the file size is getting smaller and there
are several cache.log.N files getting created, for access.log nothing is
happening.

Any tips?


On Tue, Dec 29, 2020 at 8:37 PM Alex Rousskov &lt;
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt; wrote:

&gt;<i> On 12/29/20 12:33 PM, roee klinger wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; I am using a Raspberry Pi and the latest version of Squid which I
</I>&gt;<i> &gt; installed from apt.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; In my cache.log, here are all my logging and rotation-related messages:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 2020/12/29 17:37:14 kid1| logfileRotate: daemon:/var/log/squid/access.log
</I>&gt;<i> &gt; 2020/12/29 17:37:14 kid1| logfileRotate: daemon:/var/log/squid/access.log
</I>&gt;<i> &gt; 2020/12/29 17:37:14 kid1| Logfile: opening log
</I>&gt;<i> daemon:/var/log/squid/access.log
</I>&gt;<i> &gt; 2020/12/29 17:37:14 kid1| Logfile Daemon: opening log
</I>&gt;<i> /var/log/squid/access.log
</I>&gt;<i> &gt; 2020/12/29 17:37:14 kid1| Store logging disabled
</I>&gt;<i>
</I>&gt;<i> What is your Squid version? &quot;squid --version&quot; may answer that question.
</I>&gt;<i>
</I>&gt;<i> The &quot;opening log&quot; lines in your cache.log look strange. I do not see
</I>&gt;<i> them in my tests, but my version of Squid is probably different from
</I>&gt;<i> yours. If you shut down Squid completely, then remove all cache.log
</I>&gt;<i> files, then start Squid, and then rotate once, what logging and rotation
</I>&gt;<i> messages do you see in all the resulting cache.log files (including the
</I>&gt;<i> rotated ones)? Do not shut down or restart Squid until you collect all
</I>&gt;<i> those lines. Include all lines that mention &quot;log&quot; or &quot;rotate&quot;.
</I>&gt;<i>
</I>&gt;<i> Do you see transactions getting logged to access.log?
</I>&gt;<i>
</I>&gt;<i> Is the logging daemon running? &quot;ps aux | grep 'logfile[-]daemon'&quot; or a
</I>&gt;<i> similar command may answer that question.
</I>&gt;<i>
</I>&gt;<i> How do you know that your access.log was _not_ rotated?
</I>&gt;<i>
</I>&gt;<i> Alex.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; On Tue, Dec 29, 2020 at 6:40 PM Alex Rousskov wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     On 12/29/20 10:36 AM, roee klinger wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     &gt;     logfile_rotate 10
</I>&gt;<i> &gt;     &gt;     access_log daemon:/var/log/squid/access.log logformat=xxxx
</I>&gt;<i> &gt;     rotate=10
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     &gt; running &quot;squid -k rotate&quot; still does nothing for the access.log
</I>&gt;<i> file.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     Please note that, according to Squid documentation, your Squid is
</I>&gt;<i> &gt;     slightly misconfigured:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     &gt;       rotate=N                Specifies the number of log file
</I>&gt;<i> &gt;     rotations to
</I>&gt;<i> &gt;     &gt;                               make when you run 'squid -k rotate'.
</I>&gt;<i> &gt;     [...]
</I>&gt;<i> &gt;     &gt;                               Only supported by the stdio module.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     You are not using an &quot;stdio&quot; module. You are using a &quot;daemon&quot; module.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     This minor misconfiguraiton, if any, does not explain the lack of
</I>&gt;<i> &gt;     rotations. The deamon module should still rotate based on your global
</I>&gt;<i> &gt;     logfile_rotate directive setting.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     What is your Squid version? What logging and rotation-related
</I>&gt;<i> messages
</I>&gt;<i> &gt;     do you see in your cache.log (check both the pre-rotation and
</I>&gt;<i> &gt;     post-rotation files)?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     Alex.
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20201231/48618185/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20201231/48618185/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="023076.html">[squid-users] How do I rotate access.log?
</A></li>
	<LI>Next message (by thread): <A HREF="023095.html">[squid-users] How do I rotate access.log?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23094">[ date ]</a>
              <a href="thread.html#23094">[ thread ]</a>
              <a href="subject.html#23094">[ subject ]</a>
              <a href="author.html#23094">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
