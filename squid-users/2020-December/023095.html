<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] How do I rotate access.log?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20How%20do%20I%20rotate%20access.log%3F&In-Reply-To=%3C12630169-3781-0f11-487b-b0c7f9cd4f7a%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023094.html">
   <LINK REL="Next"  HREF="023077.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] How do I rotate access.log?</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20How%20do%20I%20rotate%20access.log%3F&In-Reply-To=%3C12630169-3781-0f11-487b-b0c7f9cd4f7a%40measurement-factory.com%3E"
       TITLE="[squid-users] How do I rotate access.log?">rousskov at measurement-factory.com
       </A><BR>
    <I>Thu Dec 31 23:38:46 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="023094.html">[squid-users] How do I rotate access.log?
</A></li>
        <LI>Next message (by thread): <A HREF="023077.html">[squid-users] Anyone has experience with Windows clients DNS timeout
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23095">[ date ]</a>
              <a href="thread.html#23095">[ thread ]</a>
              <a href="subject.html#23095">[ subject ]</a>
              <a href="author.html#23095">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 12/31/20 1:39 PM, roee klinger wrote:

&gt;<i>     2020/12/31 20:33:49 kid1| Logfile: opening log daemon:/var/log/squid/access.log
</I>&gt;<i>     2020/12/31 20:33:49 kid1| Logfile Daemon: opening log /var/log/squid/access.log
</I>&gt;<i>     2020/12/31 20:33:49 kid1| Store logging disabled
</I>&gt;<i>     2020/12/31 20:33:57 kid1| logfileRotate: daemon:/var/log/squid/access.log
</I>&gt;<i>     2020/12/31 20:33:57 kid1| logfileRotate: daemon:/var/log/squid/access.log
</I>&gt;<i>     2020/12/31 20:33:57 kid1| Logfile: opening log daemon:/var/log/squid/access.log
</I>&gt;<i>     2020/12/31 20:33:57 kid1| Logfile Daemon: opening log /var/log/squid/access.log
</I>&gt;<i>     2020/12/31 20:33:57 kid1| Store logging disabled
</I>
The second set of the &quot;opening log&quot; lines at 20:33:57 concern me -- why
would somebody start opening those files when you are asking Squid to
rotate the logs. However, this could be a red herring. Do you get the
same kind of output when you send USR1 signal to the process identifier
in the PID file (instead of running &quot;squid -k rotate&quot;)?


&gt;<i> Any tips?
</I>
I have not looked at v4.6 code, but I do not see anything in the more
recent code that would make the visible effects of access.log rotation
conditional except setting logfile_rotate to zero. I also do not see any
obviously relevant changes in v4 change.log (although there was one
access-logging bug fixed).

A few thing could go wrong. If you do not get better advice, I can
suggest the following:

* If you are a developer, I would recommend attaching a debugger to the
logging daemon process to (a) make sure it gets the rotation command
from Squid and (b) to understand why it ignores that command.

* If you are a sysadmin, you may be able to attach strace to the logging
daemon process and share its output. This is best done without user
traffic going through Squid to avoid accidentally sharing user info.
Here are rough steps:

1. Attach strace to the running daemon process (-p). Configure strace to
log at least 100 bytes of system call data (-s 100). Tell strace to
write the output into a file.

2. Rotate.

3. Wait a few seconds.

4. Stop strace. Compress and share a link to its output file.


Cheers,

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="023094.html">[squid-users] How do I rotate access.log?
</A></li>
	<LI>Next message (by thread): <A HREF="023077.html">[squid-users] Anyone has experience with Windows clients DNS timeout
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23095">[ date ]</a>
              <a href="thread.html#23095">[ thread ]</a>
              <a href="subject.html#23095">[ subject ]</a>
              <a href="author.html#23095">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
