From squid3 at treenet.co.nz  Sat Feb  1 09:15:43 2020
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 1 Feb 2020 22:15:43 +1300
Subject: [squid-users] squid4 config file doub
In-Reply-To: <792dda25-1569-63ed-23b9-f80651b07a40@esines.cu>
References: <792dda25-1569-63ed-23b9-f80651b07a40@esines.cu>
Message-ID: <187ba730-b056-6554-c485-9829271f2966@treenet.co.nz>

On 1/02/20 5:40 am, Alex Guti?rrez wrote:
> Hello community, I am using squid in debian 10 and for security reasons
> in the entity where i work we have as a policy to change the default
> configuration path for squid. I did this in the /etc/init.d/squid file
> and after restarting the proxy the change had no effect. Any idea why
> this happens after changing the value of the CONFIG variable in
> /etc/init.d/squid file?
> 

Squid-4 ships with init files for multiple init services. Debian 10 uses
the systemd squid.service file, not the SysVinit init.d/squid file.

Amos


From alex at esines.cu  Mon Feb  3 12:33:29 2020
From: alex at esines.cu (=?UTF-8?Q?Alex_Guti=c3=a9rrez?=)
Date: Mon, 3 Feb 2020 07:33:29 -0500
Subject: [squid-users] squid4 config file doub (Amos Jeffries)
Message-ID: <0e6c0af2-609f-3eef-cda5-20dcda21f296@esines.cu>

That work for me, thanks again Mr. Jeffries

-- 
Saludos cordiales

Lic. Alex Guti?rrez Mart?nez



From squid3 at treenet.co.nz  Mon Feb  3 11:54:17 2020
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 4 Feb 2020 00:54:17 +1300
Subject: [squid-users] [squid-announce] Squid 4.10 is available
Message-ID: <19c98dc6-3dbc-0c33-4b2d-c75fad7af5a5@treenet.co.nz>

The Squid HTTP Proxy team is very pleased to announce the availability
of the Squid-4.10 release!


This release is a security release resolving several issues found in
the prior Squid releases.


The major changes to be aware of:


 * SQUID-2020:1 Improper Input Validation issues in HTTP Request
   processing
   (CVE-2020-8449, CVE-2020-8450)

This issue allows attackers to perform denial of service on the
proxy and all clients using it.

This issue potentially allows attackers to bypass security access
controls in systems between client and proxy.

This issue potentially allows remote code execution under the
proxy low-privilege level. While restricted, it does have access
to a wide range of information about the network structure and
other clients using the proxy.

This issue is limited to Squid acting as a reverse-proxy. Some
effects also require allow_direct permissions.

See the advisory for updated patches:
 <http://www.squid-cache.org/Advisories/SQUID-2020_1.txt>


Please note that NTLM is a deprecated authentication mechanism.
All users of this tool are advised to plan migration to
Negotiate/Kerberos authentication.


 * SQUID-2020:2 Information Disclosure issue in FTP Gateway.
   (CVE-2019-12528)

Certain FTP server responses can result in Squid revealing
random amounts of memory content from heap.

When Squid mempools feature is enabled the leak is limited to
lines in FTP directory listings, possibly from other clients.

When mempools is disabled the information may be anything from
the heap area including information from other processes on the
machine.

See the advisory for more details:
 <http://www.squid-cache.org/Advisories/SQUID-2020_2.txt>


 * SQUID-2020:3 Buffer Overflow issue in ext_lm_group_acl helper.
   (CVE-2020-8517)

This problem is limited to installations using the ext_lm_group_acl
binary (previously shipped as mswin_check_lm_group).

Due to incorrect input validation the NTLM authentication
credentials parser in ext_lm_group_acl may write to memory
outside the credentials buffer.

On systems with memory access protections this can result in
the the helper process being terminated unexpectedly. Resulting
in Squid process also terminating and a denial of service for
all clients using the proxy.

See the advisory for more details:
 <http://www.squid-cache.org/Advisories/SQUID-2020_3.txt>


 * Bug 5008: SIGBUS in PagePool::level() with custom rock slot size

This shows up as SMP Squids crashing on arm64 with a SIGBUS error. The
issues was incorrect memory alignment with certain cache sizes. This
Squid release now forces alignment of the critical rock page details.


 * Bug 4735: Truncated chunked responses cached as whole

This bug shows up as clients getting the cached truncated response
objects until the cache object expires or is force removed.

In absence of partial-object caching this Squid release treats
incomplete responses as non-cacheable and prevents the chunked encoding
terminator chunk being delivered to the active client(s).


 * Fix server_cert_fingerprint on cert validator-reported errors

This bug shows up as a server_cert_fingerprint ACL mismatch when
sslproxy_cert_error directive was applied to validation errors reported
by the certificate validator, because the ACL could not find the server
certificate.


  All users of Squid are urged to upgrade as soon as possible.


See the ChangeLog for the full list of changes in this and earlier
releases.

Please refer to the release notes at
http://www.squid-cache.org/Versions/v4/RELEASENOTES.html
when you are ready to make the switch to Squid-4

This new release can be downloaded from our HTTP or FTP servers

  http://www.squid-cache.org/Versions/v4/
  ftp://ftp.squid-cache.org/pub/squid/
  ftp://ftp.squid-cache.org/pub/archive/4/

or the mirrors. For a list of mirror sites see

  http://www.squid-cache.org/Download/http-mirrors.html
  http://www.squid-cache.org/Download/mirrors.html

If you encounter any issues with this release please file a bug report.
  http://bugs.squid-cache.org/


Amos Jeffries
_______________________________________________
squid-announce mailing list
squid-announce at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-announce

From squid3 at treenet.co.nz  Mon Feb  3 11:54:40 2020
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 4 Feb 2020 00:54:40 +1300
Subject: [squid-users] [squid-announce] [ADVISORY] SQUID-2020:3 Buffer
 Overflow issue in ext_lm_group_acl helper.
Message-ID: <a7614004-b548-3672-eed0-73a03149532a@treenet.co.nz>

__________________________________________________________________

    Squid Proxy Cache Security Update Advisory SQUID-2020:3
__________________________________________________________________

Advisory ID:        SQUID-2020:3
Date:               February 02, 2020
Summary:            Buffer Overflow issue
                    in ext_lm_group_acl helper.
Affected versions:  Squid 2.x -> 2.7.STABLE9
                    Squid 3.x -> 3.5.28
                    Squid 4.x -> 4.9
Fixed in version:   Squid 4.10
__________________________________________________________________

    http://www.squid-cache.org/Advisories/SQUID-2019_3.txt
    http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-8517
__________________________________________________________________

Problem Description:

 Due to incorrect buffer management ext_lm_group_acl is vulnerable
 to a denial of service attack when processing NTLM Authentication
 credentials.

__________________________________________________________________

Severity:

 This problem is limited to installations using the
 ext_lm_group_acl binary.

 Due to incorrect input validation the NTLM authentication
 credentials parser in ext_lm_group_acl may write to memory
 outside the credentials buffer.

 On systems with memory access protections this can result in
 the the helper process being terminated unexpectedly. Resulting
 in Squid process also terminating and a denial of service for
 all clients using the proxy.

__________________________________________________________________

Updated Packages:

 This bug is fixed by ext_lm_group_acl from Squid version 4.10.

 In addition, patches addressing this problem for the stable
 releases can be found in our patch archives:

Squid 3.5:
 <http://www.squid-cache.org/Versions/v3/3.5/changesets/squid-3.5-c62d2b43ad4962ea44aa0c5edb4cc99cb83a413d.patch>

Squid 4:
 <http://www.squid-cache.org/Versions/v4/changesets/squid-4-6982f1187a26557e582172965e266f544ea562a5.patch>

 If you are using a prepackaged version of Squid then please refer
 to the package vendor for availability information on updated
 packages.

__________________________________________________________________

Determining if your version is vulnerable:

The helper was shipped as mswin_check_lm_group with Squid-3.1 and
older. Also as a third-party helper prior to Squid-2.6.

 All Squid using the mswin_check_lm_group helper for group
 based authorization are vulnerable.


 All Squid not using the ext_lm_group_acl helper for group
 based authorization are not vulnerable.

 All Squid-3.x up to and including 3.5.28 being used for NTLM
 Authentication with ext_lm_group_acl helper are vulnerable.

 All Squid-4.x up to and including 4.9 being used for NTLM
 Authentication with ext_lm_group_acl helper are vulnerable.


To determine whether Squid-3.2 and later are configured to use
the affected helper use the commands:

 squid -k parse | grep ext_lm_group_acl

 squid -k parse | grep mswin_check_lm_group


To determine whether Squid-3.1 and older are configured to use
the affected helper use the commands:

 grep ext_lm_group_acl /etc/squid/squid.conf

 grep mswin_check_lm_group /etc/squid/squid.conf

__________________________________________________________________

Workarounds:

Either;

 Remove 'auth_param NTLM ...' configuration settings from
 squid.conf.

Or,

 Use ext_lm_group_acl binary built from Squid-4.10 or later
 versions.


__________________________________________________________________

Contact details for the Squid project:

 For installation / upgrade support on binary packaged versions
 of Squid: Your first point of contact should be your binary
 package vendor.

 If your install and build Squid from the original Squid sources
 then the squid-users at lists.squid-cache.org mailing list is your
 primary support point. For subscription details see
 <http://www.squid-cache.org/Support/mailing-lists.html>.

 For reporting of non-security bugs in the latest STABLE release
 the squid bugzilla database should be used
 <http://bugs.squid-cache.org/>.

 For reporting of security sensitive bugs send an email to the
 squid-bugs at lists.squid-cache.org mailing list. It's a closed
 list (though anyone can post) and security related bug reports
 are treated in confidence until the impact has been established.

__________________________________________________________________

Credits:

 This vulnerability was discovered and fixed by Aaron Costello
 <aaron.costello at ymail.com>.

__________________________________________________________________

Revision history:

 2019-11-11 10:25:02 UTC Initial Report
 2019-11-22 02:44:29 UTC Patches Released
__________________________________________________________________
END
_______________________________________________
squid-announce mailing list
squid-announce at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-announce

From squid3 at treenet.co.nz  Mon Feb  3 11:54:23 2020
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 4 Feb 2020 00:54:23 +1300
Subject: [squid-users] [squid-announce] [ADVISORY] SQUID-2020:2 Information
	Disclosure	issue in FTP Gateway.
Message-ID: <3a32a734-2263-5cf9-3d74-43fa9cdcf4f4@treenet.co.nz>

__________________________________________________________________

    Squid Proxy Cache Security Update Advisory SQUID-2020:2
__________________________________________________________________

Advisory ID:        SQUID-2020:2
Date:               February 02, 2020
Summary:            Information Disclosure issue
                    in FTP Gateway.
Affected versions:  Squid 2.x -> 2.7.STABLE9
                    Squid 3.x -> 3.5.28
                    Squid 4.x -> 4.9
Fixed in version:   Squid 4.10
__________________________________________________________________

    http://www.squid-cache.org/Advisories/SQUID-2020_2.txt
    http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-12528
__________________________________________________________________

Problem Description:

 Due to incorrect data management Squid is vulnerable to a
 information disclosure when translating FTP server listings
 into HTTP responses.

__________________________________________________________________

Severity:

 Certain FTP server responses can result in Squid revealing
 random amounts of memory content from heap.

 When Squid mempools feature is enabled the leak is limited to
 lines in FTP directory listings, possibly from other clients.

 When mempools is disabled the information may be anything from
 the heap area including information from other processes on the
 machine.

__________________________________________________________________

Updated Packages:

 This bug is fixed by Squid version 4.10.

 In addition, a patch addressing this problem for the stable
 releases can be found in our patch archives:

Squid 3:
 <http://www.squid-cache.org/Versions/v3/3.5/changesets/squid-3.5-8cdb18ca1829a0b7faa1c9e472604ed0e7e105ac.patch>

Squid 4:
 <http://www.squid-cache.org/Versions/v4/changesets/squid-4-c1bebac9c1135b7add6589db35c62f16db195b8f.patch>

 If you are using a prepackaged version of Squid then please refer
 to the package vendor for availability information on updated
 packages.

__________________________________________________________________

Determining if your version is vulnerable:

 All Squid-2.x up to and including 2.7.STABLE9 are vulnerable.

 All Squid-3.x up to and including 3.5.28 are vulnerable.

 All Squid-4.x up to and including 4.9 are vulnerable.

__________________________________________________________________

Workarounds:

 * To disable FTP features

  Remove from squid.conf:

    acl Safe_ports 21

  Add to squid.conf:

    acl FTP proto FTP
    http_access deny FTP


 * To reduce leakage while retaining FTP features:

  Remove from squid.conf:

   memory_pools off


__________________________________________________________________

Contact details for the Squid project:

 For installation / upgrade support on binary packaged versions
 of Squid: Your first point of contact should be your binary
 package vendor.

 If your install and build Squid from the original Squid sources
 then the squid-users at lists.squid-cache.org mailing list is your
 primary support point. For subscription details see
 <http://www.squid-cache.org/Support/mailing-lists.html>.

 For reporting of non-security bugs in the latest STABLE release
 the squid bugzilla database should be used
 <http://bugs.squid-cache.org/>.

 For reporting of security sensitive bugs send an email to the
 squid-bugs at lists.squid-cache.org mailing list. It's a closed
 list (though anyone can post) and security related bug reports
 are treated in confidence until the impact has been established.

__________________________________________________________________

Credits:

 This vulnerability was discovered by Jeriko One
 <jeriko.one at gmx.us>.

 Fixed by Christos Tsantilas of The Measurement Factory.

__________________________________________________________________

Revision history:

 2019-05-14 14:56:49 UTC Initial Report
 2019-06-05 15:52:17 UTC CVE Assignment
 2019-12-20 07:29:58 UTC Patches Released
__________________________________________________________________
END
_______________________________________________
squid-announce mailing list
squid-announce at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-announce

From squid3 at treenet.co.nz  Mon Feb  3 11:54:20 2020
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 4 Feb 2020 00:54:20 +1300
Subject: [squid-users] [squid-announce] [ADVISORY] SQUID-2020:1 Improper
 Input Validation issues in HTTP Request processing.
Message-ID: <6b7c023e-5caa-b1e1-8817-7451fc905d5c@treenet.co.nz>

__________________________________________________________________

    Squid Proxy Cache Security Update Advisory SQUID-2020:1
__________________________________________________________________

Advisory ID:        SQUID-2020:1
Date:               February 03, 2020
Summary:            Improper Input Validation issues
                    in HTTP Request processing.
Affected versions:  Squid 2.x -> 2.7.STABLE9
                    Squid 3.x -> 3.5.28
                    Squid 4.x -> 4.9
Fixed in version:   Squid 4.10
__________________________________________________________________

    http://www.squid-cache.org/Advisories/SQUID-2020_1.txt
    http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-8449
    http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-8450
__________________________________________________________________

Problem Description:

 Due to incorrect input validation Squid can interpret crafted
 HTTP requests in unexpected ways to access server resources
 prohibited by earlier security filters.

 Due to incorrect buffer management a remote client can cause
 a buffer overflow in a Squid acting as reverse-proxy.

__________________________________________________________________

Severity:

 This issue allows attackers to perform denial of service on the
 proxy and all clients using it.

 This issue potentially allows attackers to bypass security access
 controls in systems between client and proxy.

 This issue potentially allows remote code execution under the
 proxy low-privilege level. While restricted, it does have access
 to a wide range of information about the network structure and
 other clients using the proxy.

 This issue is limited to Squid acting as a reverse-proxy. Some
 effects also require allow_direct permissions.

__________________________________________________________________

Updated Packages:

 This bug is fixed by Squid version 4.10.

 In addition, patches addressing this problem for the stable
 releases can be found in our patch archives:

Squid 3.5:
 <http://www.squid-cache.org/Versions/v3/3.5/changesets/SQUID-2020_1.patch>

Squid 4.8 and older:
 <http://www.squid-cache.org/Versions/v4/changesets/SQUID-2020_1.patch>

Squid 4.9:
 <http://www.squid-cache.org/Versions/v4/changesets/squid-4-b3a0719affab099c684f1cd62b79ab02816fa962.patch>

 If you are using a prepackaged version of Squid then please refer
 to the package vendor for availability information on updated
 packages.

__________________________________________________________________

Determining if your version is vulnerable:

 All Squid-2.x up to and including 2.7.STABLE9 with http_port
 'accel' or 'vhost' options configured are vulnerable.

 All Squid-3.x up to and including 3.5.28 with http_port
 'accel' or 'vhost' options configured are vulnerable.

 All Squid-4.x up to and including 4.9 with with http_port
 'accel' option configured are vulnerable.


To determine what port options are configured use the command:

 squid -k parse | grep -E _port

__________________________________________________________________

Workarounds:

 There are no workarounds.

__________________________________________________________________

Contact details for the Squid project:

 For installation / upgrade support on binary packaged versions
 of Squid: Your first point of contact should be your binary
 package vendor.

 If your install and build Squid from the original Squid sources
 then the squid-users at lists.squid-cache.org mailing list is your
 primary support point. For subscription details see
 <http://www.squid-cache.org/Support/mailing-lists.html>.

 For reporting of non-security bugs in the latest STABLE release
 the squid bugzilla database should be used
 <http://bugs.squid-cache.org/>.

 For reporting of security sensitive bugs send an email to the
 squid-bugs at lists.squid-cache.org mailing list. It's a closed
 list (though anyone can post) and security related bug reports
 are treated in confidence until the impact has been established.

__________________________________________________________________

Credits:

 Security Bypass and Server Side Request Forgery vulnerability
 was discovered by Regis Leroy (regilero from Makina Corpus).

 Denial of Service and Remote Code Execution vulnerability was
 discovered by Guido Vranken.

 Fixed by Amos Jeffries of Treehouse Networks Ltd. and Guido
 Vranken.

__________________________________________________________________

Revision history:

 2019-07-24 11:52:51 UTC Initial Report
 2019-08-13 13:50:06 UTC Initial Patches Released
 2019-10-05 02:05:23 UTC Additional Report
 2019-12-12 03:27:40 UTC Additional Patches Released
__________________________________________________________________
END
_______________________________________________
squid-announce mailing list
squid-announce at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-announce

From belle at bazuin.nl  Mon Feb  3 13:39:20 2020
From: belle at bazuin.nl (=?windows-1252?Q?L.P.H._van_Belle?=)
Date: Mon, 3 Feb 2020 14:39:20 +0100
Subject: [squid-users] Squid 4.10 for Debian Buster on my Repo.
In-Reply-To: <19c98dc6-3dbc-0c33-4b2d-c75fad7af5a5@treenet.co.nz>
References: <19c98dc6-3dbc-0c33-4b2d-c75fad7af5a5@treenet.co.nz>
Message-ID: <vmime.5e382288.2697.445bc1b8640b1708@ms249-lin-003.rotterdam.bazuin.nl>

Thanks Amos for the notify.

For the people on debian Buster.
I have Debian Buster squid 4.10 SSL enable and squidclamav on my repo. 
The debs and sources are available in amd64 andi386

----------- THE REPO SETUP ---------------
1) Choose http or https for you apt, both work, for https you need to :
apt-get install apt-transport-https

2) Import my public key
wget -O - http://apt.van-belle.nl/louis-van-belle.gpg-key.asc | apt-key add -

3) (optional) setup a header line for the repo file.
echo "# AptVanBelle repo for samba." | sudo tee /etc/apt/sources.list.d/van-belle.list

4) In the line below, change the OS and/or samba version to what you want. Shown is debian stretch with samba 4.10.
echo "deb http://apt.van-belle.nl/debian buster-squid410 main contrib non-free" | sudo tee -a /etc/apt/sources.list.d/van-belle.list

If you like my work, I appriciate a small donation. 
Even with 1$ your helping me to keep my server running.

https://www.paypal.me/LouisVanBelle
Bitcoin (BTC) : 3BMEXFUrncjVKByryNU1fcVLBLKE8i9TpX 
Etherium (ETH): 0x2Baf9dd82DA17C6762D8bB30B3C1294713c516fc
You can send you "shit" coins also, if you need an address pm me. 
;-)


Greetz, 

Louis



From squid3 at treenet.co.nz  Mon Feb  3 14:18:56 2020
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 4 Feb 2020 03:18:56 +1300
Subject: [squid-users] [squid-announce] Squid 4.10 is available
In-Reply-To: <19c98dc6-3dbc-0c33-4b2d-c75fad7af5a5@treenet.co.nz>
References: <19c98dc6-3dbc-0c33-4b2d-c75fad7af5a5@treenet.co.nz>
Message-ID: <f8f8e399-dbcf-13fd-7240-fbdae62e23e1@treenet.co.nz>

On 4/02/20 12:54 am, Amos Jeffries wrote:
> The Squid HTTP Proxy team is very pleased to announce the availability
> of the Squid-4.10 release!
> 
> 
> This release is a security release resolving several issues found in
> the prior Squid releases.
> 
> 
> The major changes to be aware of:
> 
> 
>  * SQUID-2020:1 Improper Input Validation issues in HTTP Request
>    processing
>    (CVE-2020-8449, CVE-2020-8450)
> 
> This issue allows attackers to perform denial of service on the
> proxy and all clients using it.
> 
> This issue potentially allows attackers to bypass security access
> controls in systems between client and proxy.
> 
> This issue potentially allows remote code execution under the
> proxy low-privilege level. While restricted, it does have access
> to a wide range of information about the network structure and
> other clients using the proxy.
> 
> This issue is limited to Squid acting as a reverse-proxy. Some
> effects also require allow_direct permissions.
> 
> See the advisory for updated patches:
>  <http://www.squid-cache.org/Advisories/SQUID-2020_1.txt>
> 
> 
> Please note that NTLM is a deprecated authentication mechanism.
> All users of this tool are advised to plan migration to
> Negotiate/Kerberos authentication.
> 

Apologies. This note was supposed to be under SQUID-2020:3 issue.
The issue(s) above are not related to NTLM.

> 
>  * SQUID-2020:2 Information Disclosure issue in FTP Gateway.
>    (CVE-2019-12528)
> 
> Certain FTP server responses can result in Squid revealing
> random amounts of memory content from heap.
> 
> When Squid mempools feature is enabled the leak is limited to
> lines in FTP directory listings, possibly from other clients.
> 
> When mempools is disabled the information may be anything from
> the heap area including information from other processes on the
> machine.
> 
> See the advisory for more details:
>  <http://www.squid-cache.org/Advisories/SQUID-2020_2.txt>
> 
> 
>  * SQUID-2020:3 Buffer Overflow issue in ext_lm_group_acl helper.
>    (CVE-2020-8517)
> 
> This problem is limited to installations using the ext_lm_group_acl
> binary (previously shipped as mswin_check_lm_group).
> 
> Due to incorrect input validation the NTLM authentication
> credentials parser in ext_lm_group_acl may write to memory
> outside the credentials buffer.
> 
> On systems with memory access protections this can result in
> the the helper process being terminated unexpectedly. Resulting
> in Squid process also terminating and a denial of service for
> all clients using the proxy.
> 
> See the advisory for more details:
>  <http://www.squid-cache.org/Advisories/SQUID-2020_3.txt>
> 
> 
>  * Bug 5008: SIGBUS in PagePool::level() with custom rock slot size
> 
> This shows up as SMP Squids crashing on arm64 with a SIGBUS error. The
> issues was incorrect memory alignment with certain cache sizes. This
> Squid release now forces alignment of the critical rock page details.
> 
> 
>  * Bug 4735: Truncated chunked responses cached as whole
> 
> This bug shows up as clients getting the cached truncated response
> objects until the cache object expires or is force removed.
> 
> In absence of partial-object caching this Squid release treats
> incomplete responses as non-cacheable and prevents the chunked encoding
> terminator chunk being delivered to the active client(s).
> 
> 
>  * Fix server_cert_fingerprint on cert validator-reported errors
> 
> This bug shows up as a server_cert_fingerprint ACL mismatch when
> sslproxy_cert_error directive was applied to validation errors reported
> by the certificate validator, because the ACL could not find the server
> certificate.
> 
> 
>   All users of Squid are urged to upgrade as soon as possible.
> 
> 
> See the ChangeLog for the full list of changes in this and earlier
> releases.
> 
> Please refer to the release notes at
> http://www.squid-cache.org/Versions/v4/RELEASENOTES.html
> when you are ready to make the switch to Squid-4
> 
> This new release can be downloaded from our HTTP or FTP servers
> 
>   http://www.squid-cache.org/Versions/v4/
>   ftp://ftp.squid-cache.org/pub/squid/
>   ftp://ftp.squid-cache.org/pub/archive/4/
> 
> or the mirrors. For a list of mirror sites see
> 
>   http://www.squid-cache.org/Download/http-mirrors.html
>   http://www.squid-cache.org/Download/mirrors.html
> 
> If you encounter any issues with this release please file a bug report.
>   http://bugs.squid-cache.org/
> 
> 
> Amos Jeffries
> _______________________________________________
> squid-announce mailing list
> squid-announce at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-announce
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 


From 457636876 at qq.com  Mon Feb  3 14:27:27 2020
From: 457636876 at qq.com (yohan83942)
Date: Mon, 3 Feb 2020 08:27:27 -0600 (CST)
Subject: [squid-users] Squid configuration cache_peer does not take
	effect?
In-Reply-To: <f30e199c-1a09-530f-89a2-2d62a019598f@treenet.co.nz>
References: <1578926186767-0.post@n4.nabble.com>
 <82599fa11eeaf0a86cdc90ba5eeb4fbc@schroeffu.ch>
 <1578930353782-0.post@n4.nabble.com>
 <f30e199c-1a09-530f-89a2-2d62a019598f@treenet.co.nz>
Message-ID: <1580740047940-0.post@n4.nabble.com>

I upgraded Squid to 5.0, prompt`Unknown http_port option 'ssl-bump'.`

[root at localhost ~]# /usr/local/squid/sbin/squid -z
2020/02/03 22:20:56| FATAL: Unknown http_port option 'ssl-bump'.
2020/02/03 22:20:56| FATAL: Bungled /usr/local/squid/etc/squid.conf line 68:
http_port 3128 ssl-bump cert=/etc/squid/squid.pem key=/etc/squid/squid.pem
generate-host-certificates=on options=NO_SSLv2
2020/02/03 22:20:56| Squid Cache (Version 5.0.1): Terminated abnormally.
CPU Usage: 0.016 seconds = 0.009 user + 0.007 sys
Maximum Resident Size: 17632 KB
Page faults with physical i/o: 0

Did it change to something?




--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From belle at bazuin.nl  Mon Feb  3 14:35:45 2020
From: belle at bazuin.nl (=?windows-1252?Q?L.P.H._van_Belle?=)
Date: Mon, 3 Feb 2020 15:35:45 +0100
Subject: [squid-users] Squid configuration cache_peer does not take
 effect?
In-Reply-To: <1580740047940-0.post@n4.nabble.com>
References: <f30e199c-1a09-530f-89a2-2d62a019598f@treenet.co.nz>
Message-ID: <vmime.5e382fc1.2218.4b7b08477a5c6d51@ms249-lin-003.rotterdam.bazuin.nl>

Hai, 

Most probely the ssl options are not correct enabled or missing while you compiled squid. 
So check if ssl is enabled. 
 
Greetz, 

Louis


> -----Oorspronkelijk bericht-----
> Van: squid-users 
> [mailto:squid-users-bounces at lists.squid-cache.org] Namens yohan83942
> Verzonden: maandag 3 februari 2020 15:27
> Aan: squid-users at lists.squid-cache.org
> Onderwerp: Re: [squid-users] Squid configuration cache_peer 
> does not take effect?
> 
> I upgraded Squid to 5.0, prompt`Unknown http_port option 'ssl-bump'.`
> 
> [root at localhost ~]# /usr/local/squid/sbin/squid -z
> 2020/02/03 22:20:56| FATAL: Unknown http_port option 'ssl-bump'.
> 2020/02/03 22:20:56| FATAL: Bungled 
> /usr/local/squid/etc/squid.conf line 68:
> http_port 3128 ssl-bump cert=/etc/squid/squid.pem 
> key=/etc/squid/squid.pem
> generate-host-certificates=on options=NO_SSLv2
> 2020/02/03 22:20:56| Squid Cache (Version 5.0.1): Terminated 
> abnormally.
> CPU Usage: 0.016 seconds = 0.009 user + 0.007 sys
> Maximum Resident Size: 17632 KB
> Page faults with physical i/o: 0
> 
> Did it change to something?
> 
> 
> 
> 
> --
> Sent from: 
> http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users
> -f1019091.html
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 



From squid3 at treenet.co.nz  Mon Feb  3 14:38:19 2020
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 4 Feb 2020 03:38:19 +1300
Subject: [squid-users] Squid configuration cache_peer does not take
 effect?
In-Reply-To: <1580740047940-0.post@n4.nabble.com>
References: <1578926186767-0.post@n4.nabble.com>
 <82599fa11eeaf0a86cdc90ba5eeb4fbc@schroeffu.ch>
 <1578930353782-0.post@n4.nabble.com>
 <f30e199c-1a09-530f-89a2-2d62a019598f@treenet.co.nz>
 <1580740047940-0.post@n4.nabble.com>
Message-ID: <fb66088e-4ea9-a908-f177-61c8a6cd606e@treenet.co.nz>

On 4/02/20 3:27 am, yohan83942 wrote:
> I upgraded Squid to 5.0, prompt`Unknown http_port option 'ssl-bump'.`
> 
> [root at localhost ~]# /usr/local/squid/sbin/squid -z
> 2020/02/03 22:20:56| FATAL: Unknown http_port option 'ssl-bump'.
> 2020/02/03 22:20:56| FATAL: Bungled /usr/local/squid/etc/squid.conf line 68:
> http_port 3128 ssl-bump cert=/etc/squid/squid.pem key=/etc/squid/squid.pem
> generate-host-certificates=on options=NO_SSLv2
> 2020/02/03 22:20:56| Squid Cache (Version 5.0.1): Terminated abnormally.
> CPU Usage: 0.016 seconds = 0.009 user + 0.007 sys
> Maximum Resident Size: 17632 KB
> Page faults with physical i/o: 0
> 
> Did it change to something?
> 


Your binary is missing the --with-openssl build option.


Amos


From heiler.bemerguy at cinbesa.com.br  Mon Feb  3 15:47:52 2020
From: heiler.bemerguy at cinbesa.com.br (Heiler Bemerguy)
Date: Mon, 3 Feb 2020 12:47:52 -0300
Subject: [squid-users] blaaaacklists
Message-ID: <361c2b3d-1f99-d98a-7a8c-a324a9f2c75e@cinbesa.com.br>

Hi guys,

Does anyone recommend a free blacklist listing, ufdb compatible?

Hugs,
Heiler Bemerguy



From m_zouhairy at skno.by  Tue Feb  4 05:50:34 2020
From: m_zouhairy at skno.by (Majed)
Date: Tue, 04 Feb 2020 08:50:34 +0300
Subject: [squid-users] blaaaacklists
In-Reply-To: <361c2b3d-1f99-d98a-7a8c-a324a9f2c75e@cinbesa.com.br>
References: <361c2b3d-1f99-d98a-7a8c-a324a9f2c75e@cinbesa.com.br>
Message-ID: <de655ac92599b89343273c247bf03c5e3563477f.camel@skno.by>

https://dsi.ut-capitole.fr/blacklists/

http://www.shallalist.de/

On Mon, 2020-02-03 at 12:47 -0300, Heiler Bemerguy wrote:
> Hi guys,
> 
> Does anyone recommend a free blacklist listing, ufdb compatible?
> 
> Hugs,
> Heiler Bemerguy
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users




From 457636876 at qq.com  Tue Feb  4 06:50:35 2020
From: 457636876 at qq.com (yohan83942)
Date: Tue, 4 Feb 2020 00:50:35 -0600 (CST)
Subject: [squid-users] Squid configuration cache_peer does not take
	effect?
In-Reply-To: <fb66088e-4ea9-a908-f177-61c8a6cd606e@treenet.co.nz>
References: <1578926186767-0.post@n4.nabble.com>
 <82599fa11eeaf0a86cdc90ba5eeb4fbc@schroeffu.ch>
 <1578930353782-0.post@n4.nabble.com>
 <f30e199c-1a09-530f-89a2-2d62a019598f@treenet.co.nz>
 <1580740047940-0.post@n4.nabble.com>
 <fb66088e-4ea9-a908-f177-61c8a6cd606e@treenet.co.nz>
Message-ID: <1580799035598-0.post@n4.nabble.com>

Something new has happened.

[root at localhost squid-5.0.1]# /usr/local/squid/sbin/squid -z
2020/02/04 14:46:00| ERROR: Unknown TLS option '-bump'
[root at localhost squid-5.0.1]# 2020/02/04 14:46:00| Created PID file
(/usr/local/squid/var/run/squid.pid)
2020/02/04 14:46:00 kid1| ERROR: Unknown TLS option '-bump'

This problem does not seem to affect the agent. But `cache_peer` still has
no effect.

# Squid normally listens to port 3128
sslproxy_cert_error allow all
#sslproxy_flags DONT_VERIFY_PEER
http_access allow all
always_direct allow all
ssl_bump bump all
ssl_bump stare all 
sslproxy_cert_error allow all
http_port 3128 ssl-bump cert=/usr/local/squid/etc/squid/squid.pem
key=/usr/local/squid/etc/squid/squid.pem generate-host-certificates=on
options=NO_SSLv2
#http_port 3128

#cache_peer 127.0.0.1 http parent 10809 0 no-query
#cache_peer 192.168.1.101 parent 10809 0 no-query originserver weight=1
#cache_peer_domain a www.google.com
#cache_peer_access a allow all

cache_peer 192.168.1.101 parent 10809 0 no-query ssl-bump ssl
sslcert=/usr/local/squid/etc/squid/squid.pem
sslcafile=/usr/local/squid/etc/squid/squid.pem
never_direct allow all

Squid does not access the Internet through 192.168.1.101:10809?

Can Squid access the Internet through a Socket5 proxy?



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From squid3 at treenet.co.nz  Tue Feb  4 08:24:08 2020
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 4 Feb 2020 21:24:08 +1300
Subject: [squid-users] Squid configuration cache_peer does not take
 effect?
In-Reply-To: <1580799035598-0.post@n4.nabble.com>
References: <1578926186767-0.post@n4.nabble.com>
 <82599fa11eeaf0a86cdc90ba5eeb4fbc@schroeffu.ch>
 <1578930353782-0.post@n4.nabble.com>
 <f30e199c-1a09-530f-89a2-2d62a019598f@treenet.co.nz>
 <1580740047940-0.post@n4.nabble.com>
 <fb66088e-4ea9-a908-f177-61c8a6cd606e@treenet.co.nz>
 <1580799035598-0.post@n4.nabble.com>
Message-ID: <a99713f0-0be6-d9bd-1222-e69df3246298@treenet.co.nz>

On 4/02/20 7:50 pm, yohan83942 wrote:
> Something new has happened.
> 
> [root at localhost squid-5.0.1]# /usr/local/squid/sbin/squid -z
> 2020/02/04 14:46:00| ERROR: Unknown TLS option '-bump'
> [root at localhost squid-5.0.1]# 2020/02/04 14:46:00| Created PID file
> (/usr/local/squid/var/run/squid.pid)
> 2020/02/04 14:46:00 kid1| ERROR: Unknown TLS option '-bump'
> 

"ssl-bump" is not an option of cache_peer.



> This problem does not seem to affect the agent. But `cache_peer` still has
> no effect.
> 
> # Squid normally listens to port 3128
> sslproxy_cert_error allow all
> #sslproxy_flags DONT_VERIFY_PEER
> http_access allow all
> always_direct allow all


This config requires traffic to *always* go direct to servers - not
cache_peers.


> ssl_bump bump all
> ssl_bump stare all 
> sslproxy_cert_error allow all
> http_port 3128 ssl-bump cert=/usr/local/squid/etc/squid/squid.pem
> key=/usr/local/squid/etc/squid/squid.pem generate-host-certificates=on
> options=NO_SSLv2

All settings related to SSLv2 are not supported in any way since Squid-4.

> #http_port 3128
> 
> #cache_peer 127.0.0.1 http parent 10809 0 no-query
> #cache_peer 192.168.1.101 parent 10809 0 no-query originserver weight=1
> #cache_peer_domain a www.google.com
> #cache_peer_access a allow all
> 
> cache_peer 192.168.1.101 parent 10809 0 no-query ssl-bump ssl
> sslcert=/usr/local/squid/etc/squid/squid.pem
> sslcafile=/usr/local/squid/etc/squid/squid.pem
> never_direct allow all



> Can Squid access the Internet through a Socket5 proxy?
> 

SOCKS proxies do not understand HTTP proxy syntax. So no, not like you
are thinking.

Amos


From 457636876 at qq.com  Tue Feb  4 08:58:58 2020
From: 457636876 at qq.com (yohan83942)
Date: Tue, 4 Feb 2020 02:58:58 -0600 (CST)
Subject: [squid-users] Squid configuration cache_peer does not take
	effect?
In-Reply-To: <a99713f0-0be6-d9bd-1222-e69df3246298@treenet.co.nz>
References: <1578926186767-0.post@n4.nabble.com>
 <82599fa11eeaf0a86cdc90ba5eeb4fbc@schroeffu.ch>
 <1578930353782-0.post@n4.nabble.com>
 <f30e199c-1a09-530f-89a2-2d62a019598f@treenet.co.nz>
 <1580740047940-0.post@n4.nabble.com>
 <fb66088e-4ea9-a908-f177-61c8a6cd606e@treenet.co.nz>
 <1580799035598-0.post@n4.nabble.com>
 <a99713f0-0be6-d9bd-1222-e69df3246298@treenet.co.nz>
Message-ID: <1580806738819-0.post@n4.nabble.com>

There is nothing wrong now, I use Squid 5.0.1.
The problem I have is that I want to let Squid access the Internet through
an https proxy. The address is
?http://192.168.1.101:10809  or  https://192.168.1.101:10809 or 
socket5://192.168.1.101:10808??
  
And Squid can cache https content, how to configure it? Hope to give a
complete configuration.

My current configuration is as follows, and I find that it still cannot
access the Google website. As long as Squid passes the proxy, Google can
definitely open it normally.

sslproxy_cert_error allow all
http_access allow all
always_direct allow all
ssl_bump bump all
ssl_bump stare all 
sslproxy_cert_error allow all
http_port 3128 ssl-bump cert=/usr/local/squid/etc/squid/squid.pem
key=/usr/local/squid/etc/squid/squid.pem generate-host-certificates=on
options=NO_SSLv2

cache_peer 192.168.1.101 parent 10809 0 no-query
never_direct allow all



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From squid3 at treenet.co.nz  Tue Feb  4 09:48:18 2020
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 4 Feb 2020 22:48:18 +1300
Subject: [squid-users] Squid configuration cache_peer does not take
 effect?
In-Reply-To: <1580806738819-0.post@n4.nabble.com>
References: <1578926186767-0.post@n4.nabble.com>
 <82599fa11eeaf0a86cdc90ba5eeb4fbc@schroeffu.ch>
 <1578930353782-0.post@n4.nabble.com>
 <f30e199c-1a09-530f-89a2-2d62a019598f@treenet.co.nz>
 <1580740047940-0.post@n4.nabble.com>
 <fb66088e-4ea9-a908-f177-61c8a6cd606e@treenet.co.nz>
 <1580799035598-0.post@n4.nabble.com>
 <a99713f0-0be6-d9bd-1222-e69df3246298@treenet.co.nz>
 <1580806738819-0.post@n4.nabble.com>
Message-ID: <03c28218-7b52-54f2-3ef2-b2bffeaadf88@treenet.co.nz>

On 4/02/20 9:58 pm, yohan83942 wrote:
> There is nothing wrong now, I use Squid 5.0.1.
> The problem I have is that I want to let Squid access the Internet through
> an https proxy. The address is
> ?http://192.168.1.101:10809  or  https://192.168.1.101:10809 or 
> socket5://192.168.1.101:10808??
>   
> And Squid can cache https content, how to configure it? Hope to give a
> complete configuration.

An "HTTPS proxy" is very different from HTTPS traffic.

To send traffic over TLS to another proxy all you need is the "tls"
option (or any beginning with "tls-") on the cache_peer line. All
traffic to that peer will be encrypted now.

For extra security use the tls-cacert option to tell Squid exactly which
root CA should be used to verify that peer's server certificate, and
"tls-default-ca=off" to prevent other CAs being accepted.


Amos


From Ralf.Hildebrandt at charite.de  Tue Feb  4 09:54:48 2020
From: Ralf.Hildebrandt at charite.de (Ralf Hildebrandt)
Date: Tue, 4 Feb 2020 10:54:48 +0100
Subject: [squid-users] Squid-5.0.1 affected by the recent advisories?
Message-ID: <20200204095446.zshaqibwmwgkvjch@charite.de>

Yesterdays advisories didn't list squid-5.x, but is squid-5.x really
not affected?

Ralf Hildebrandt
Charit? - Universit?tsmedizin Berlin
Gesch?ftsbereich IT | Abteilung Netzwerk

Campus Benjamin Franklin (CBF)
Haus I | 1. OG | Raum 105
Hindenburgdamm 30 | D-12203 Berlin

Tel. +49 30 450 570 155
ralf.hildebrandt at charite.de
https://www.charite.de


From 457636876 at qq.com  Tue Feb  4 10:06:51 2020
From: 457636876 at qq.com (yohan83942)
Date: Tue, 4 Feb 2020 04:06:51 -0600 (CST)
Subject: [squid-users] Squid configuration cache_peer does not take
	effect?
In-Reply-To: <03c28218-7b52-54f2-3ef2-b2bffeaadf88@treenet.co.nz>
References: <1578926186767-0.post@n4.nabble.com>
 <82599fa11eeaf0a86cdc90ba5eeb4fbc@schroeffu.ch>
 <1578930353782-0.post@n4.nabble.com>
 <f30e199c-1a09-530f-89a2-2d62a019598f@treenet.co.nz>
 <1580740047940-0.post@n4.nabble.com>
 <fb66088e-4ea9-a908-f177-61c8a6cd606e@treenet.co.nz>
 <1580799035598-0.post@n4.nabble.com>
 <a99713f0-0be6-d9bd-1222-e69df3246298@treenet.co.nz>
 <1580806738819-0.post@n4.nabble.com>
 <03c28218-7b52-54f2-3ef2-b2bffeaadf88@treenet.co.nz>
Message-ID: <1580810811354-0.post@n4.nabble.com>

Are you talking like this?

cache_peer 192.168.1.101 parent 10809 0 no-query tls-default-ca=off
cacert=/usr/local/squid/etc/squid/squid.pem

I tested it, still it doesn't work?



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From squid3 at treenet.co.nz  Tue Feb  4 11:17:29 2020
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 5 Feb 2020 00:17:29 +1300
Subject: [squid-users] Squid configuration cache_peer does not take
 effect?
In-Reply-To: <1580810811354-0.post@n4.nabble.com>
References: <1578926186767-0.post@n4.nabble.com>
 <82599fa11eeaf0a86cdc90ba5eeb4fbc@schroeffu.ch>
 <1578930353782-0.post@n4.nabble.com>
 <f30e199c-1a09-530f-89a2-2d62a019598f@treenet.co.nz>
 <1580740047940-0.post@n4.nabble.com>
 <fb66088e-4ea9-a908-f177-61c8a6cd606e@treenet.co.nz>
 <1580799035598-0.post@n4.nabble.com>
 <a99713f0-0be6-d9bd-1222-e69df3246298@treenet.co.nz>
 <1580806738819-0.post@n4.nabble.com>
 <03c28218-7b52-54f2-3ef2-b2bffeaadf88@treenet.co.nz>
 <1580810811354-0.post@n4.nabble.com>
Message-ID: <21febe18-23e8-4691-5f64-0ea2d709ff75@treenet.co.nz>

On 4/02/20 11:06 pm, yohan83942 wrote:
> Are you talking like this?
> 
> cache_peer 192.168.1.101 parent 10809 0 no-query tls-default-ca=off
> cacert=/usr/local/squid/etc/squid/squid.pem
> 
> I tested it, still it doesn't work?
> 


Start with:

 cache_peer 192.168.1.101 parent 10809 0 no-query tls


None of those other ssl-bump, ssl_bump or always_direct, or never_direct
settings.


Amos


From 457636876 at qq.com  Tue Feb  4 11:43:02 2020
From: 457636876 at qq.com (yohan83942)
Date: Tue, 4 Feb 2020 05:43:02 -0600 (CST)
Subject: [squid-users] Squid configuration cache_peer does not take
	effect?
In-Reply-To: <21febe18-23e8-4691-5f64-0ea2d709ff75@treenet.co.nz>
References: <1578930353782-0.post@n4.nabble.com>
 <f30e199c-1a09-530f-89a2-2d62a019598f@treenet.co.nz>
 <1580740047940-0.post@n4.nabble.com>
 <fb66088e-4ea9-a908-f177-61c8a6cd606e@treenet.co.nz>
 <1580799035598-0.post@n4.nabble.com>
 <a99713f0-0be6-d9bd-1222-e69df3246298@treenet.co.nz>
 <1580806738819-0.post@n4.nabble.com>
 <03c28218-7b52-54f2-3ef2-b2bffeaadf88@treenet.co.nz>
 <1580810811354-0.post@n4.nabble.com>
 <21febe18-23e8-4691-5f64-0ea2d709ff75@treenet.co.nz>
Message-ID: <1580816582952-0.post@n4.nabble.com>

do you mean this?

sslproxy_cert_error allow all
http_access allow all
#always_direct allow all
#ssl_bump bump all
#ssl_bump stare all 
http_port 3128 cert=/usr/local/squid/etc/squid/squid.pem
key=/usr/local/squid/etc/squid/squid.pem generate-host-certificates=on
options=NO_SSLv2

#cache_peer 192.168.1.101 parent 10809 0 no-query tls-default-ca=off
tls-cacert=/usr/local/squid/etc/squid/squid.pem
cache_peer 192.168.1.101 parent 10809 0 no-query tls
#never_direct allow all

After changing it, I still ca n?t open the Google website, Chrome prompts
`ERR_TUNNEL_CONNECTION_FAILED`



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From squid3 at treenet.co.nz  Tue Feb  4 11:42:50 2020
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 5 Feb 2020 00:42:50 +1300
Subject: [squid-users] Squid-5.0.1 affected by the recent advisories?
In-Reply-To: <20200204095446.zshaqibwmwgkvjch@charite.de>
References: <20200204095446.zshaqibwmwgkvjch@charite.de>
Message-ID: <3f3c7cbb-8099-c752-2e61-4879b4ba8d23@treenet.co.nz>

On 4/02/20 10:54 pm, Ralf Hildebrandt wrote:
> Yesterdays advisories didn't list squid-5.x, but is squid-5.x really
> not affected?

Yes. Squid-5.0.1 contains the fixes for these issues, just like Squid-4.10.

Amos


From 457636876 at qq.com  Wed Feb  5 07:52:09 2020
From: 457636876 at qq.com (yohan83942)
Date: Wed, 5 Feb 2020 01:52:09 -0600 (CST)
Subject: [squid-users] Squid configuration cache_peer does not take
	effect?
In-Reply-To: <21febe18-23e8-4691-5f64-0ea2d709ff75@treenet.co.nz>
References: <1578930353782-0.post@n4.nabble.com>
 <f30e199c-1a09-530f-89a2-2d62a019598f@treenet.co.nz>
 <1580740047940-0.post@n4.nabble.com>
 <fb66088e-4ea9-a908-f177-61c8a6cd606e@treenet.co.nz>
 <1580799035598-0.post@n4.nabble.com>
 <a99713f0-0be6-d9bd-1222-e69df3246298@treenet.co.nz>
 <1580806738819-0.post@n4.nabble.com>
 <03c28218-7b52-54f2-3ef2-b2bffeaadf88@treenet.co.nz>
 <1580810811354-0.post@n4.nabble.com>
 <21febe18-23e8-4691-5f64-0ea2d709ff75@treenet.co.nz>
Message-ID: <1580889129859-0.post@n4.nabble.com>

Can you help me to solve the above problem. How should I do it?



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From felipeapolanco at gmail.com  Sat Feb  8 16:17:02 2020
From: felipeapolanco at gmail.com (Felipe Arturo Polanco)
Date: Sat, 8 Feb 2020 12:17:02 -0400
Subject: [squid-users] Question about HTTPS transparent proxy with cache_peer
Message-ID: <CADcj3=6mUhCH-gYe-6hTd_hJ2ChH=JDQhUkAtVuefU0HSxFsWw@mail.gmail.com>

Hi,

Can squid be set up as a transparent proxy for HTTP and HTTPS and at
the same time use an upstream proxy?

It means converting GET request from a client to a CONNECT request to an
upstream server.

Thanks,
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20200208/b4a33476/attachment.htm>

From squid3 at treenet.co.nz  Sun Feb  9 00:34:15 2020
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sun, 9 Feb 2020 13:34:15 +1300
Subject: [squid-users] Question about HTTPS transparent proxy with
 cache_peer
In-Reply-To: <CADcj3=6mUhCH-gYe-6hTd_hJ2ChH=JDQhUkAtVuefU0HSxFsWw@mail.gmail.com>
References: <CADcj3=6mUhCH-gYe-6hTd_hJ2ChH=JDQhUkAtVuefU0HSxFsWw@mail.gmail.com>
Message-ID: <5797abd9-b892-4808-c942-b91b3562efcd@treenet.co.nz>

On 9/02/20 5:17 am, Felipe Arturo Polanco wrote:
> Hi,
> 
> Can squid be set up as a transparent proxy for HTTP and HTTPS and at
> the?same time use an upstream proxy?
> 
> It means converting GET request from a client to a CONNECT request to an
> upstream server.
> 

That depends on the GET request URL, the Squid version, and upstream
proxy capabilities.

For http:// URLs, yes all Squid versions can relay to an upstream proxy
as normal GET requests.

For https:// URLs all Squid which support SSL-Bump can send requests to
an upstream peer which supports TLS/SSL connections from the Squid as
normal GET requests.

The ability to generate CONNECT tunnels for sending HTTPS traffic
through plain-text peers has been added in Squid-5.

Amos


From felipeapolanco at gmail.com  Sun Feb  9 02:47:40 2020
From: felipeapolanco at gmail.com (Felipe Arturo Polanco)
Date: Sat, 8 Feb 2020 22:47:40 -0400
Subject: [squid-users] Question about HTTPS transparent proxy with
	cache_peer
In-Reply-To: <5797abd9-b892-4808-c942-b91b3562efcd@treenet.co.nz>
References: <CADcj3=6mUhCH-gYe-6hTd_hJ2ChH=JDQhUkAtVuefU0HSxFsWw@mail.gmail.com>
 <5797abd9-b892-4808-c942-b91b3562efcd@treenet.co.nz>
Message-ID: <CADcj3=5dsDRw73ZU0kT6UEwTs56it7t3eZwMuovkKeSXmAqonQ@mail.gmail.com>

Thanks for the reply,

Is there a documentation for squid 5 on this feature?

On Sat, Feb 8, 2020, 8:34 PM Amos Jeffries <squid3 at treenet.co.nz> wrote:

> On 9/02/20 5:17 am, Felipe Arturo Polanco wrote:
> > Hi,
> >
> > Can squid be set up as a transparent proxy for HTTP and HTTPS and at
> > the same time use an upstream proxy?
> >
> > It means converting GET request from a client to a CONNECT request to an
> > upstream server.
> >
>
> That depends on the GET request URL, the Squid version, and upstream
> proxy capabilities.
>
> For http:// URLs, yes all Squid versions can relay to an upstream proxy
> as normal GET requests.
>
> For https:// URLs all Squid which support SSL-Bump can send requests to
> an upstream peer which supports TLS/SSL connections from the Squid as
> normal GET requests.
>
> The ability to generate CONNECT tunnels for sending HTTPS traffic
> through plain-text peers has been added in Squid-5.
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20200208/3051941f/attachment.htm>

From squid3 at treenet.co.nz  Sun Feb  9 02:59:23 2020
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sun, 9 Feb 2020 15:59:23 +1300
Subject: [squid-users] Question about HTTPS transparent proxy with
 cache_peer
In-Reply-To: <CADcj3=5dsDRw73ZU0kT6UEwTs56it7t3eZwMuovkKeSXmAqonQ@mail.gmail.com>
References: <CADcj3=6mUhCH-gYe-6hTd_hJ2ChH=JDQhUkAtVuefU0HSxFsWw@mail.gmail.com>
 <5797abd9-b892-4808-c942-b91b3562efcd@treenet.co.nz>
 <CADcj3=5dsDRw73ZU0kT6UEwTs56it7t3eZwMuovkKeSXmAqonQ@mail.gmail.com>
Message-ID: <435a3d00-f4e0-a388-a517-8631f457f258@treenet.co.nz>

On 9/02/20 3:47 pm, Felipe Arturo Polanco wrote:
> Thanks for the reply,
> 
> Is there a documentation for squid 5 on this feature??
> 

Just the release notes.

There is nothing special to configure though. If the peer is allowed to
be used by your policy but not supporting TLS on its connections Squid
just automatically tries to use a CONNECT tunnel to go through it.

Amos


From yurakirychuk at gmail.com  Mon Feb 10 11:32:34 2020
From: yurakirychuk at gmail.com (Yurii Kirychuk)
Date: Mon, 10 Feb 2020 13:32:34 +0200
Subject: [squid-users] transparent https with delay
Message-ID: <CAMNP=fZEzTy_d8mYpvU1g_7BZj-nyYHf3KfFV98LvSkQm8D8SQ@mail.gmail.com>

Is it normal that a secure connection to the site is delayed by 10-15
seconds?
squid 4.10, transparent http/https

squid.conf
acl localnet src 10.3.198.0/24

acl SSL_ports port 443
acl Safe_ports port 80          # http
acl Safe_ports port 21          # ftp
acl Safe_ports port 443         # https
acl Safe_ports port 70          # gopher
acl Safe_ports port 210         # wais
acl Safe_ports port 1025-65535  # unregistered ports
acl Safe_ports port 280         # http-mgmt
acl Safe_ports port 488         # gss-http
acl Safe_ports port 591         # filemaker
acl Safe_ports port 777         # multiling http
acl CONNECT method CONNECT

acl blackmails dstdom_regex "/etc/squid/blackmailssl"

http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports

http_access deny blackmails

http_access allow localhost manager
http_access deny manager
http_access allow localnet
http_access allow localhost
http_access deny all

dns_nameservers 10.3.198.254 10.3.105.2 10.3.100.2
dns_v4_first on

http_port 10.3.198.226:3128
http_port 10.3.198.226:3129 intercept
https_port 10.3.198.226:3130 intercept ssl-bump
generate-host-certificates=on dynamic_cert_mem_cache_size=8MB
connection-auth=off tls-cert=/etc/squid/squidCA.pem

tls_outgoing_options options=NO_SSLv3

acl blackmailssl ssl::server_name_regex "/etc/squid/blackmailssl"
acl step1 at_step SslBump1

sslcrtd_program /usr/lib/squid/security_file_certgen -s
/usr/lib/squid/ssl_db -M 8MB

ssl_bump peek step1
acl blackmailssl ssl::server_name_regex "/etc/squid/blackmailssl"
ssl_bump splice !blackmailssl
ssl_bump terminate all

cache_dir ufs /var/spool/squid 10240 16 256
maximum_object_size 1024 KB

coredump_dir /var/spool/squid
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20200210/3bbbd6eb/attachment.htm>

From rousskov at measurement-factory.com  Mon Feb 10 15:38:11 2020
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Mon, 10 Feb 2020 10:38:11 -0500
Subject: [squid-users] transparent https with delay
In-Reply-To: <CAMNP=fZEzTy_d8mYpvU1g_7BZj-nyYHf3KfFV98LvSkQm8D8SQ@mail.gmail.com>
References: <CAMNP=fZEzTy_d8mYpvU1g_7BZj-nyYHf3KfFV98LvSkQm8D8SQ@mail.gmail.com>
Message-ID: <d8ccc73f-5b35-e823-803b-95ada754e095@measurement-factory.com>

On 2/10/20 6:32 AM, Yurii Kirychuk wrote:
> Is it normal that a secure connection to the site is delayed by 10-15
> seconds?

No, it is not. Most likely, you are suffering from some kind of a DNS,
IPv6, or TCP timeout.

You may be able to identify the culprit by watching DNS and TCP traffic
while reproducing the problem with a single transaction on an otherwise
idle Squid. Studying access.log may also be helpful, especially if you
add %codes reflecting DNS response times. If everything else fails,
studying cache.log with high debugging levels may be necessary (see
debug_options in squid.conf).

Alex.


> squid 4.10, transparent http/https
> 
> squid.conf
> acl localnet src 10.3.198.0/24 <http://10.3.198.0/24>
> 
> acl SSL_ports port 443
> acl Safe_ports port 80 ? ? ? ? ?# http
> acl Safe_ports port 21 ? ? ? ? ?# ftp
> acl Safe_ports port 443 ? ? ? ? # https
> acl Safe_ports port 70 ? ? ? ? ?# gopher
> acl Safe_ports port 210 ? ? ? ? # wais
> acl Safe_ports port 1025-65535 ?# unregistered ports
> acl Safe_ports port 280 ? ? ? ? # http-mgmt
> acl Safe_ports port 488 ? ? ? ? # gss-http
> acl Safe_ports port 591 ? ? ? ? # filemaker
> acl Safe_ports port 777 ? ? ? ? # multiling http
> acl CONNECT method CONNECT
> 
> acl blackmails dstdom_regex "/etc/squid/blackmailssl"
> 
> http_access deny !Safe_ports
> http_access deny CONNECT !SSL_ports
> 
> http_access deny blackmails
> 
> http_access allow localhost manager
> http_access deny manager
> http_access allow localnet
> http_access allow localhost
> http_access deny all
> 
> dns_nameservers 10.3.198.254 10.3.105.2 10.3.100.2
> dns_v4_first on
> 
> http_port 10.3.198.226:3128 <http://10.3.198.226:3128>
> http_port 10.3.198.226:3129 <http://10.3.198.226:3129> intercept
> https_port 10.3.198.226:3130 <http://10.3.198.226:3130> intercept
> ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=8MB
> connection-auth=off tls-cert=/etc/squid/squidCA.pem
> 
> tls_outgoing_options options=NO_SSLv3
> 
> acl blackmailssl ssl::server_name_regex "/etc/squid/blackmailssl"
> acl step1 at_step SslBump1
> 
> sslcrtd_program /usr/lib/squid/security_file_certgen -s
> /usr/lib/squid/ssl_db -M 8MB
> 
> ssl_bump peek step1
> acl blackmailssl ssl::server_name_regex "/etc/squid/blackmailssl"
> ssl_bump splice !blackmailssl
> ssl_bump terminate all
> 
> cache_dir ufs /var/spool/squid 10240 16 256
> maximum_object_size 1024 KB
> 
> coredump_dir /var/spool/squid
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 



From belle at bazuin.nl  Mon Feb 10 15:48:35 2020
From: belle at bazuin.nl (=?windows-1252?Q?L.P.H._van_Belle?=)
Date: Mon, 10 Feb 2020 16:48:35 +0100
Subject: [squid-users] Squid and iptables
Message-ID: <vmime.5e417b53.3b3c.331b2d453d390d03@ms249-lin-003.rotterdam.bazuin.nl>

Hai, 
 
I'm having a squid 4.10 on Debian 10 running ( with strongswan VPN ) and ufw firewall (iptables) 
Most is running fine but i still see some error and i somehow miss here what im doing wrong. 

So if someone has suggestions that would be great. I see for example these lines in the UFW log. 

Feb 10 15:42:21 rtd-proxy1 kernel: [14315.762249] [UFW AUDIT INVALID] IN=eth0 OUT= MAC=56:30:b7:fd:da:24:84:2b:2b:90:a5:f1:08:00 SRC=192.168.0.101 DST=192.168.0.1 LEN=40 TOS=0x00 PREC=0x00 TTL=128 ID=22171 DF PROTO=TCP SPT=52273 DPT=8080 WINDOW=0 RES=0x00 ACK RST URGP=0
Feb 10 15:42:21 rtd-proxy1 kernel: [14315.762308] [UFW BLOCK] IN=eth0 OUT= MAC=56:30:b7:fd:da:24:84:2b:2b:90:a5:f1:08:00 SRC=192.168.0.101 DST=192.168.0.1 LEN=40 TOS=0x00 PREC=0x00 TTL=128 ID=22171 DF PROTO=TCP SPT=52273 DPT=8080 WINDOW=0 RES=0x00 ACK RST URGP=0

Now, strange thing here is im allowing my traffic on my lan interface fully, so i dont see/get why i get these INVALID/BLOCK.
Im out of ideas, i looked to much at it, i done see it anymore..  :-( 

The needed parts of my squid and iptables (ufw) setup. 
ETH0 = LAN  192.168.0.1.0/24 	(ip: 192.168.0.1.1/24  )
ETH1 = WAN  1.2.4.4/32	
  
The squid part 
# From squid cache.log the needed lines from a start of squid with the lines from squid.conf 

# http_port localhost:3128 connection-auth=off
2020/02/10 11:44:13 kid1| Accepting HTTP Socket connections at local=[::1]:3128 remote=[::] FD 17 flags=1 
# all requests for and on loclhost are trusted, so fully allowed withouth authenticationn. 

# http_port 192.168.249.221:3128 intercept  ( no-authentication possbible on intercept ) 
2020/02/10 11:44:13 kid1| Accepting NAT intercepted HTTP Socket connections at local=192.168.0.1.1:3128 remote=[::] FD 21 flags=33

# https_port 192.168.249.221:3129 intercept ssl-bump \ .. (plus the cert - key parts, not relevant this works ). 
2020/02/10 11:44:13 kid1| Accepting NAT intercepted SSL bumped HTTPS Socket connections at local=192.168.0.1.1:3129 remote=[::] FD 25 flags=33

# Non-proxy aware  (with authentication)
# http_port 192.168.249.221:8080
2020/02/10 11:44:13 kid1| Accepting HTTP Socket connections at local=192.168.0.1.1:8080 remote=[::] FD 29 flags=1

# http_port 192.168.249.221:8081 ssl-bump \ .. (plus the cert - key parts, not relevant this works ). 
2020/02/10 11:44:13 kid1| Accepting SSL bumped HTTP Socket connections at local=192.168.0.1.1:8081 remote=[::] FD 37 flags=1


# Generated by xtables-save v1.8.2 on Mon Feb 10 15:16:26 2020
*filter
:INPUT DROP [213:54000]
:FORWARD ACCEPT [704:28436]
:OUTPUT ACCEPT [57:19155]
:ufw-before-logging-input - [0:0]
:ufw-before-logging-output - [0:0]
:ufw-before-logging-forward - [0:0]
:ufw-before-input - [0:0]
:ufw-before-output - [0:0]
:ufw-before-forward - [0:0]
:ufw-after-input - [0:0]
:ufw-after-output - [0:0]
:ufw-after-forward - [0:0]
:ufw-after-logging-input - [0:0]
:ufw-after-logging-output - [0:0]
:ufw-after-logging-forward - [0:0]
:ufw-reject-input - [0:0]
:ufw-reject-output - [0:0]
:ufw-reject-forward - [0:0]
:ufw-track-input - [0:0]
:ufw-track-output - [0:0]
:ufw-track-forward - [0:0]
:ufw-logging-deny - [0:0]
:ufw-logging-allow - [0:0]
:ufw-skip-to-policy-input - [0:0]
:ufw-skip-to-policy-output - [0:0]
:ufw-skip-to-policy-forward - [0:0]
:ufw-not-local - [0:0]
:ufw-user-input - [0:0]
:ufw-user-output - [0:0]
:ufw-user-forward - [0:0]
:ufw-user-logging-input - [0:0]
:ufw-user-logging-output - [0:0]
:ufw-user-logging-forward - [0:0]
:ufw-user-limit - [0:0]
:ufw-user-limit-accept - [0:0]
-A INPUT -j ufw-before-logging-input
-A INPUT -j ufw-before-input
-A INPUT -j ufw-after-input
-A INPUT -j ufw-after-logging-input
-A INPUT -j ufw-reject-input
-A INPUT -j ufw-track-input
-A FORWARD -s 10.1.2.00/24 -d 192.168.0.1.0/24 -i eth1 -m policy --dir in --pol ipsec --reqid 8 --proto esp -j ACCEPT
-A FORWARD -s 192.168.0.1.0/24 -d 10.1.2.00/24 -o eth1 -m policy --dir out --pol ipsec --reqid 8 --proto esp -j ACCEPT
-A FORWARD -j ufw-before-logging-forward
-A FORWARD -j ufw-before-forward
-A FORWARD -j ufw-after-forward
-A FORWARD -j ufw-after-logging-forward
-A FORWARD -j ufw-reject-forward
-A FORWARD -j ufw-track-forward
-A OUTPUT -j ufw-before-logging-output
-A OUTPUT -j ufw-before-output
-A OUTPUT -j ufw-after-output
-A OUTPUT -j ufw-after-logging-output
-A OUTPUT -j ufw-reject-output
-A OUTPUT -j ufw-track-output
-A ufw-before-logging-input -m conntrack --ctstate NEW -m limit --limit 3/min --limit-burst 10 -j LOG --log-prefix "[UFW AUDIT] "
-A ufw-before-logging-output -m conntrack --ctstate NEW -m limit --limit 3/min --limit-burst 10 -j LOG --log-prefix "[UFW AUDIT] "
-A ufw-before-logging-forward -m conntrack --ctstate NEW -m limit --limit 3/min --limit-burst 10 -j LOG --log-prefix "[UFW AUDIT] "
-A ufw-before-input -i lo -j ACCEPT
-A ufw-before-input -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A ufw-before-input -m conntrack --ctstate INVALID -j ufw-logging-deny
-A ufw-before-input -m conntrack --ctstate INVALID -j DROP
-A ufw-before-input -p icmp -m icmp --icmp-type 3 -j ACCEPT
-A ufw-before-input -p icmp -m icmp --icmp-type 11 -j ACCEPT
-A ufw-before-input -p icmp -m icmp --icmp-type 12 -j ACCEPT
-A ufw-before-input -p icmp -m icmp --icmp-type 8 -j ACCEPT
-A ufw-before-input -p udp -m udp --sport 67 --dport 68 -j ACCEPT
-A ufw-before-input -j ufw-not-local
-A ufw-before-input -j ufw-user-input
-A ufw-before-output -o lo -j ACCEPT
-A ufw-before-output -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A ufw-before-output -j ufw-user-output
-A ufw-before-forward -s 192.168.0.1.0/24 -m policy --dir in --pol ipsec --proto esp -m comment --comment "IN Strongswan-IpsecPol" -j ACCEPT
-A ufw-before-forward -d 192.168.0.1.0/24 -m policy --dir out --pol ipsec --proto esp -m comment --comment "OUT Strongswan-IpsecPol" -j ACCEPT
-A ufw-before-forward -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A ufw-before-forward -p icmp -m icmp --icmp-type 3 -j ACCEPT
-A ufw-before-forward -p icmp -m icmp --icmp-type 11 -j ACCEPT
-A ufw-before-forward -p icmp -m icmp --icmp-type 12 -j ACCEPT
-A ufw-before-forward -p icmp -m icmp --icmp-type 8 -j ACCEPT
-A ufw-before-forward -j ufw-user-forward
-A ufw-after-input -p udp -m udp --dport 137 -j ufw-skip-to-policy-input
-A ufw-after-input -p udp -m udp --dport 138 -j ufw-skip-to-policy-input
-A ufw-after-input -p tcp -m tcp --dport 139 -j ufw-skip-to-policy-input
-A ufw-after-input -p tcp -m tcp --dport 445 -j ufw-skip-to-policy-input
-A ufw-after-input -p udp -m udp --dport 67 -j ufw-skip-to-policy-input
-A ufw-after-input -p udp -m udp --dport 68 -j ufw-skip-to-policy-input
-A ufw-after-input -m addrtype --dst-type BROADCAST -j ufw-skip-to-policy-input
-A ufw-after-logging-input -m limit --limit 3/min --limit-burst 10 -j LOG --log-prefix "[UFW BLOCK] "
-A ufw-after-logging-output -m limit --limit 3/min --limit-burst 10 -j LOG --log-prefix "[UFW ALLOW] "
-A ufw-after-logging-forward -m limit --limit 3/min --limit-burst 10 -j LOG --log-prefix "[UFW ALLOW] "
-A ufw-track-output -p tcp -m conntrack --ctstate NEW -j ACCEPT
-A ufw-track-output -p udp -m conntrack --ctstate NEW -j ACCEPT
-A ufw-track-forward -p tcp -m conntrack --ctstate NEW -j ACCEPT
-A ufw-track-forward -p udp -m conntrack --ctstate NEW -j ACCEPT
-A ufw-logging-deny -m conntrack --ctstate INVALID -m limit --limit 3/min --limit-burst 10 -j LOG --log-prefix "[UFW AUDIT INVALID] "
-A ufw-logging-deny -m limit --limit 3/min --limit-burst 10 -j LOG --log-prefix "[UFW BLOCK] "
-A ufw-logging-allow -m limit --limit 3/min --limit-burst 10 -j LOG --log-prefix "[UFW ALLOW] "
-A ufw-skip-to-policy-input -j DROP
-A ufw-skip-to-policy-output -j ACCEPT
-A ufw-skip-to-policy-forward -j ACCEPT
-A ufw-not-local -m addrtype --dst-type LOCAL -j RETURN
-A ufw-not-local -m addrtype --dst-type MULTICAST -j RETURN
-A ufw-not-local -m addrtype --dst-type BROADCAST -j RETURN
-A ufw-user-input -s 192.168.0.1.0/24 -j ACCEPT
-A ufw-user-input -i eth1 -p udp -m multiport --dports 500,4500 -j ACCEPT
-A ufw-user-input -d 1.2.4.4/32 -i eth1 -p esp -j ACCEPT
-A ufw-user-input -d 1.2.4.4/32 -i eth1 -p ah -j ACCEPT
-A ufw-user-input -i eth0 -p udp -m multiport --dports 80,443 -j DROP
-A ufw-user-limit -m limit --limit 3/min -j LOG --log-prefix "[UFW LIMIT BLOCK] "
-A ufw-user-limit -j REJECT --reject-with icmp-port-unreachable
-A ufw-user-limit-accept -j ACCEPT
COMMIT
# Completed on Mon Feb 10 15:16:26 2020
# Generated by xtables-save v1.8.2 on Mon Feb 10 15:16:26 2020
*nat
:PREROUTING ACCEPT [0:0]
:INPUT ACCEPT [0:0]
:POSTROUTING ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
-A PREROUTING -i eth0 -p tcp -m tcp --dport 443 -m comment --comment "Squid-Intercept 443->3129" -j REDIRECT --to-ports 3129
-A PREROUTING -i eth0 -p tcp -m tcp --dport 80 -m comment --comment "Squid-Intercept 80->3128" -j REDIRECT --to-ports 3128
-A POSTROUTING -s 192.168.0.1.0/24 -o eth1 -m policy --dir out --pol ipsec -m comment --comment "StrongSwan-IpsecPol-Masq eth1 " -j ACCEPT
-A POSTROUTING -s 192.168.0.1.0/24 -o eth1 -m comment --comment "IP-Masq Lan via eth1" -j MASQUERADE
COMMIT
# Completed on Mon Feb 10 15:16:26 2020
# Generated by xtables-save v1.8.2 on Mon Feb 10 15:16:26 2020
*mangle
:PREROUTING ACCEPT [0:0]
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
:POSTROUTING ACCEPT [0:0]
-A FORWARD -s 192.168.0.1.0/24 -p tcp -m policy --dir in --pol ipsec -m tcp --tcp-flags SYN,RST SYN -m tcpmss --mss 1361:1536 -m comment --comment "Strongswan-IpsecPol Lower MTU" -j TCPMSS --set-mss 1360
COMMIT
# Completed on Mon Feb 10 15:16:26 2020


Thanks for looking at it.. 
I hope someone see what im doing wrong here..


Greetz, 

Louis



From rafael.akchurin at diladele.com  Tue Feb 11 08:09:52 2020
From: rafael.akchurin at diladele.com (Rafael Akchurin)
Date: Tue, 11 Feb 2020 08:09:52 +0000
Subject: [squid-users] Ubuntu 18 LTS repository for Squid 4.10 (rebuilt with
 sslbump support from sources in Debian unstable)
Message-ID: <AM0PR04MB475328F70FCB890038992A438F180@AM0PR04MB4753.eurprd04.prod.outlook.com>

Hello everyone,

The online repository with latest Squid 4.10 (rebuilt from Debian unstable with sslbump support) for Ubuntu 18 LTS 64-bit is available at squid410.diladele.com.
Github repo at https://github.com/diladele/squid-ubuntu contains the scripts we used to make this compilation.
Scripts for Ubuntu 16 are also available in that repo.

Here are simple instructions how to use the repo. For more information see readme at https://github.com/diladele/squid-ubuntu .

# add diladele apt key
wget -qO - http://packages.diladele.com/diladele_pub.asc | sudo apt-key add -

# add repo
echo "deb http://squid410.diladele.com/ubuntu/ bionic main" > /etc/apt/sources.list.d/squid410.diladele.com.list

# update the apt cache
apt-get update

# install
apt-get install squid-common
apt-get install squid
apt-get install squidclient

Hope you will find this useful. Note that older repo of squid49.diladele.com will be taken down in 2 years.

Best regards,
Rafael Akchurin
Diladele B.V.

--
Please take a look at another our project - DNS Safety filtering server.  Sort of Web Safety implemented as DNS Server. Might be interesting in deployments where HTTPS decryption is not possible.
https://dnssafety.diladele.com/

----
We are now also researching a possibility to have an iPhone/iPad built in DNS blocker that will allow you to filter outgoing DNS requests on any connection, even 4G.
The application will be built using Apple Network Extension<https://developer.apple.com/documentation/networkextension> framework. Stay tuned<https://www.diladele.com/community.html>!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20200211/de062898/attachment.htm>

From yurakirychuk at gmail.com  Tue Feb 11 13:24:09 2020
From: yurakirychuk at gmail.com (Yurii Kirychuk)
Date: Tue, 11 Feb 2020 15:24:09 +0200
Subject: [squid-users] transparent https with delay
Message-ID: <CAMNP=faRWvQjNtBLUO2R6-uiRtSzX5E_w4ouWi6=hzK6q44KVQ@mail.gmail.com>

Hello. Rebuild Squid with --disable-ipv6 (squid -v
https://pastebin.com/Gg2VPr0v).
Total time spent making DNS lookups (milliseconds) in access.log:
https://pastebin.com/zdwHjRHk

Can u tell more about TCP timeout?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20200211/81abc955/attachment.htm>

From squid.org at bloms.de  Wed Feb 12 12:54:47 2020
From: squid.org at bloms.de (Dieter Bloms)
Date: Wed, 12 Feb 2020 13:54:47 +0100
Subject: [squid-users] sslbump with pkcs11 possible ?
Message-ID: <20200212125447.7pbsopmvb2to42l3@bloms.de>

Hello,

I have a working setup with openssl, which use softhsm as pkcs11
backend.
I can sign csr requests with openssl command line tool.

Now I want to use this mechanism for squid ssl-bump.

Is it possible to use the pkcs11 mechanism with squid and openssl ?
I tried someting like:

http_port MYIP:3128 ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=32MB cert=/etc/squid/cacert.pem key=pkcs11:id=10 tls-dh=/etc/squid/dhparams.pem

but squid claims:

--snip--
2020/02/12 13:50:35| Initializing https:// proxy context
2020/02/12 13:50:35| Initializing http_port MYIP:3128 TLS contexts
2020/02/12 13:50:35| Using certificate in /etc/squid/cacert.pem
2020/02/12 13:50:35| Using certificate chain in /etc/squid/cacert.pem
2020/02/12 13:50:35| Adding issuer CA: /CN=dietershttpsca
2020/02/12 13:50:35| Using key in pkcs11:id=10
2020/02/12 13:50:35| WARNING: 'HTTP_port MYIP:3128' missing private key in 'pkcs11:id=10'
2020/02/12 13:50:35| storeDirWriteCleanLogs: Starting...
2020/02/12 13:50:35|   Finished.  Wrote 0 entries.
2020/02/12 13:50:35|   Took 0.00 seconds (  0.00 entries/sec).
2020/02/12 13:50:35| FATAL: No valid signing certificate configured for HTTP_port MYIP:3128
2020/02/12 13:50:35| Squid Cache (Version 4.10): Terminated abnormally.
CPU Usage: 0.816 seconds = 0.812 user + 0.004 sys
Maximum Resident Size: 42240 KB
Page faults with physical i/o: 0
--snip--

does anybody know, whether squid supports it and if yes how to configure it ?


-- 
regards

  Dieter

--
I do not get viruses because I do not use MS software.
If you use Outlook then please do not put my email address in your
address-book so that WHEN you get a virus it won't use my address in the
>From field.


From squid3 at treenet.co.nz  Wed Feb 12 15:05:44 2020
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 13 Feb 2020 04:05:44 +1300
Subject: [squid-users] sslbump with pkcs11 possible ?
In-Reply-To: <20200212125447.7pbsopmvb2to42l3@bloms.de>
References: <20200212125447.7pbsopmvb2to42l3@bloms.de>
Message-ID: <f612ffef-993e-4596-748d-c373c8047b14@treenet.co.nz>

On 13/02/20 1:54 am, Dieter Bloms wrote:
> Hello,
> 
> I have a working setup with openssl, which use softhsm as pkcs11
> backend.
> I can sign csr requests with openssl command line tool.
> 
> Now I want to use this mechanism for squid ssl-bump.
> 
> Is it possible to use the pkcs11 mechanism with squid and openssl ?

Not currently. Squid takes credentials from files in PEM format. The
PKCS data formats are quite different.


Amos


From psousadp at gmail.com  Thu Feb 13 15:10:08 2020
From: psousadp at gmail.com (=?UTF-8?Q?Patr=C3=ADcia_Sousa?=)
Date: Thu, 13 Feb 2020 15:10:08 +0000
Subject: [squid-users] Squid proxy incoming and outcoming connections?
Message-ID: <CAJiPhfnAFboGoX7wdWeZWpmA8JJNt=mr-pRnFtba32Xt4FHFeQ@mail.gmail.com>

I'm using the squid proxy and I'm trying to block some connections
(incoming and outcoming traffic) from a certain ip address. However, for
example, if I deny all the connections (http_access deny all) it only
blocks the connections that I made to websites for example, but if I use
another PC and try to ssh or wget the PC that owns the proxy squid, it is
allowed. How can I block the traffic from and to a specific IP or DNS? It
is possible to do this with Squid?

If not, what is the best way to do this?

Thank you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20200213/50351d09/attachment.htm>

From felipeapolanco at gmail.com  Thu Feb 13 15:32:03 2020
From: felipeapolanco at gmail.com (Felipe Arturo Polanco)
Date: Thu, 13 Feb 2020 11:32:03 -0400
Subject: [squid-users] Squid proxy incoming and outcoming connections?
In-Reply-To: <CAJiPhfnAFboGoX7wdWeZWpmA8JJNt=mr-pRnFtba32Xt4FHFeQ@mail.gmail.com>
References: <CAJiPhfnAFboGoX7wdWeZWpmA8JJNt=mr-pRnFtba32Xt4FHFeQ@mail.gmail.com>
Message-ID: <CADcj3=5qJr0yn+69dryYhY2xWBL3y+uxzruTNfz7TWiLHfbrJw@mail.gmail.com>

Hi,

For this, you need to use IPtables to block at the network level.

SSH uses port 22/tcp but wget uses HTTP, it should have been blocked by
squid.
Enabled debug_options in squid to see why it was allowed.



On Thu, Feb 13, 2020 at 11:10 AM Patr?cia Sousa <psousadp at gmail.com> wrote:

> I'm using the squid proxy and I'm trying to block some connections
> (incoming and outcoming traffic) from a certain ip address. However, for
> example, if I deny all the connections (http_access deny all) it only
> blocks the connections that I made to websites for example, but if I use
> another PC and try to ssh or wget the PC that owns the proxy squid, it is
> allowed. How can I block the traffic from and to a specific IP or DNS? It
> is possible to do this with Squid?
>
> If not, what is the best way to do this?
>
> Thank you.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20200213/6033405f/attachment.htm>

From dweimer at dweimer.net  Thu Feb 13 15:35:56 2020
From: dweimer at dweimer.net (Dean E. Weimer)
Date: Thu, 13 Feb 2020 09:35:56 -0600
Subject: [squid-users] Squid proxy incoming and outcoming connections?
In-Reply-To: <CAJiPhfnAFboGoX7wdWeZWpmA8JJNt=mr-pRnFtba32Xt4FHFeQ@mail.gmail.com>
References: <CAJiPhfnAFboGoX7wdWeZWpmA8JJNt=mr-pRnFtba32Xt4FHFeQ@mail.gmail.com>
Message-ID: <f8c3ccdbb4aa63f980687164f2694138@dweimer.net>

On 2020-02-13 9:10 am, Patr?cia Sousa wrote:

> I'm using the squid proxy and I'm trying to block some connections (incoming and outcoming traffic) from a certain ip address. However, for example, if I deny all the connections (http_access deny all) it only blocks the connections that I made to websites for example, but if I use another PC and try to ssh or wget the PC that owns the proxy squid, it is allowed. How can I block the traffic from and to a specific IP or DNS? It is possible to do this with Squid? 
> 
> If not, what is the best way to do this? 
> 
> Thank you.

You need two ACL lines: 
acl BadIPSource src 1.1.1.1/32 
acl BadIPDst dst 1.1.1.1/32 

You can use srcdomain & dstdomain instead of src & dst to use domain
instead of IP. 

Rules are processed in order, if you are specifically wanting to block
this domain/IP put it first. Then youur allow lines and finally the deny
all line to block anything you haven't specifically allowed. 

http_access deny BadIPSource  
http_access deny BadIPDst 
[...Youur Allow Lines Here...] 
http_access deny all 

-- 
Thanks,
   Dean E. Weimer
   http://www.dweimer.net/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20200213/eb01b0c8/attachment.htm>

From Chris.Latino at mastercard.com  Thu Feb 13 16:17:16 2020
From: Chris.Latino at mastercard.com (Latino, Chris)
Date: Thu, 13 Feb 2020 16:17:16 +0000
Subject: [squid-users] Squid 4.10 for windows
Message-ID: <c70d9b9892e741838880d6e95806dad8@mastercard.com>

Hi

Hoping you can help we are using squid for windows 3.5.28

Our vulnerability scanner is saying this isn't the latest version but I can't see a 4.10 version for windows and when I go to

https://squid.diladele.com/

It's still showing the 3.5.28 version

Chris Latino
Senior Systems Platform Engineer II

Mastercard
1 Angel Lane | London, EC4R 3AB
[cid:image001.png at 01D5E289.0D722900]<www.mastercard.com>

CONFIDENTIALITY NOTICE This e-mail message and any attachments are only for the use of the intended recipient and may contain information that is privileged, confidential or exempt from disclosure under applicable law. If you are not the intended recipient, any disclosure, distribution or other use of this e-mail message or attachments is prohibited. If you have received this e-mail message in error, please delete and notify the sender immediately. Thank you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20200213/3dbb31a6/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 3198 bytes
Desc: image001.png
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20200213/3dbb31a6/attachment.png>

From psousadp at gmail.com  Thu Feb 13 16:18:34 2020
From: psousadp at gmail.com (=?UTF-8?Q?Patr=C3=ADcia_Sousa?=)
Date: Thu, 13 Feb 2020 16:18:34 +0000
Subject: [squid-users] Squid proxy incoming and outcoming connections?
In-Reply-To: <CADcj3=5qJr0yn+69dryYhY2xWBL3y+uxzruTNfz7TWiLHfbrJw@mail.gmail.com>
References: <CAJiPhfnAFboGoX7wdWeZWpmA8JJNt=mr-pRnFtba32Xt4FHFeQ@mail.gmail.com>
 <CADcj3=5qJr0yn+69dryYhY2xWBL3y+uxzruTNfz7TWiLHfbrJw@mail.gmail.com>
Message-ID: <CAJiPhfkf99t=L04BPHomTtSLKJihsLYoDKY4RmMA6ED+seF2DA@mail.gmail.com>

Hi,

Thanks for the tip,

Enabling debug_options I can see that the wget from the machine computer to
the Squid machine does not goes through the proxy. Any idea why?

Felipe Arturo Polanco <felipeapolanco at gmail.com> escreveu no dia quinta,
13/02/2020 ?(s) 15:32:

> Hi,
>
> For this, you need to use IPtables to block at the network level.
>
> SSH uses port 22/tcp but wget uses HTTP, it should have been blocked by
> squid.
> Enabled debug_options in squid to see why it was allowed.
>
>
>
> On Thu, Feb 13, 2020 at 11:10 AM Patr?cia Sousa <psousadp at gmail.com>
> wrote:
>
>> I'm using the squid proxy and I'm trying to block some connections
>> (incoming and outcoming traffic) from a certain ip address. However, for
>> example, if I deny all the connections (http_access deny all) it only
>> blocks the connections that I made to websites for example, but if I use
>> another PC and try to ssh or wget the PC that owns the proxy squid, it is
>> allowed. How can I block the traffic from and to a specific IP or DNS? It
>> is possible to do this with Squid?
>>
>> If not, what is the best way to do this?
>>
>> Thank you.
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20200213/da75aa29/attachment.htm>

From felipeapolanco at gmail.com  Thu Feb 13 16:21:50 2020
From: felipeapolanco at gmail.com (Felipe Arturo Polanco)
Date: Thu, 13 Feb 2020 12:21:50 -0400
Subject: [squid-users] Squid proxy incoming and outcoming connections?
In-Reply-To: <CAJiPhfkf99t=L04BPHomTtSLKJihsLYoDKY4RmMA6ED+seF2DA@mail.gmail.com>
References: <CAJiPhfnAFboGoX7wdWeZWpmA8JJNt=mr-pRnFtba32Xt4FHFeQ@mail.gmail.com>
 <CADcj3=5qJr0yn+69dryYhY2xWBL3y+uxzruTNfz7TWiLHfbrJw@mail.gmail.com>
 <CAJiPhfkf99t=L04BPHomTtSLKJihsLYoDKY4RmMA6ED+seF2DA@mail.gmail.com>
Message-ID: <CADcj3=7Mn3ESHNY=H6DyhAq5Y7GjY1sOPS0XX6s8GHZsRiFtgg@mail.gmail.com>

Did you configure Squid to accept both HTTP and HTTPS ports?

Please share your squid.conf file.

Thanks,

On Thu, Feb 13, 2020 at 12:18 PM Patr?cia Sousa <psousadp at gmail.com> wrote:

> Hi,
>
> Thanks for the tip,
>
> Enabling debug_options I can see that the wget from the machine computer
> to the Squid machine does not goes through the proxy. Any idea why?
>
> Felipe Arturo Polanco <felipeapolanco at gmail.com> escreveu no dia quinta,
> 13/02/2020 ?(s) 15:32:
>
>> Hi,
>>
>> For this, you need to use IPtables to block at the network level.
>>
>> SSH uses port 22/tcp but wget uses HTTP, it should have been blocked by
>> squid.
>> Enabled debug_options in squid to see why it was allowed.
>>
>>
>>
>> On Thu, Feb 13, 2020 at 11:10 AM Patr?cia Sousa <psousadp at gmail.com>
>> wrote:
>>
>>> I'm using the squid proxy and I'm trying to block some connections
>>> (incoming and outcoming traffic) from a certain ip address. However, for
>>> example, if I deny all the connections (http_access deny all) it only
>>> blocks the connections that I made to websites for example, but if I use
>>> another PC and try to ssh or wget the PC that owns the proxy squid, it is
>>> allowed. How can I block the traffic from and to a specific IP or DNS? It
>>> is possible to do this with Squid?
>>>
>>> If not, what is the best way to do this?
>>>
>>> Thank you.
>>> _______________________________________________
>>> squid-users mailing list
>>> squid-users at lists.squid-cache.org
>>> http://lists.squid-cache.org/listinfo/squid-users
>>>
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20200213/db86f0df/attachment.htm>

From rafael.akchurin at diladele.com  Thu Feb 13 16:26:01 2020
From: rafael.akchurin at diladele.com (Rafael Akchurin)
Date: Thu, 13 Feb 2020 16:26:01 +0000
Subject: [squid-users] Squid 4.10 for windows
In-Reply-To: <c70d9b9892e741838880d6e95806dad8@mastercard.com>
References: <c70d9b9892e741838880d6e95806dad8@mastercard.com>
Message-ID: <AM0PR04MB4753CA7244BFD3628224DED38F1A0@AM0PR04MB4753.eurprd04.prod.outlook.com>

Sorry Chris,

We still cannot find time to finish compilation of Squid 4 for Windows.
The Linux version running within Hyper-V works much better most probably. Why not to try it?

Best regards,
Rafael Akchurin
Diladele B.V.


From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Latino, Chris
Sent: Thursday, 13 February 2020 17:17
To: squid-users at lists.squid-cache.org
Subject: [squid-users] Squid 4.10 for windows

Hi

Hoping you can help we are using squid for windows 3.5.28

Our vulnerability scanner is saying this isn't the latest version but I can't see a 4.10 version for windows and when I go to

https://squid.diladele.com/

It's still showing the 3.5.28 version

Chris Latino
Senior Systems Platform Engineer II

Mastercard
1 Angel Lane | London, EC4R 3AB
[cid:image001.png at 01D5E292.B0BD8290]<www.mastercard.com>

CONFIDENTIALITY NOTICE This e-mail message and any attachments are only for the use of the intended recipient and may contain information that is privileged, confidential or exempt from disclosure under applicable law. If you are not the intended recipient, any disclosure, distribution or other use of this e-mail message or attachments is prohibited. If you have received this e-mail message in error, please delete and notify the sender immediately. Thank you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20200213/fb7ecd56/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 3198 bytes
Desc: image001.png
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20200213/fb7ecd56/attachment.png>

From psousadp at gmail.com  Thu Feb 13 16:25:56 2020
From: psousadp at gmail.com (=?UTF-8?Q?Patr=C3=ADcia_Sousa?=)
Date: Thu, 13 Feb 2020 16:25:56 +0000
Subject: [squid-users] Squid proxy incoming and outcoming connections?
In-Reply-To: <CADcj3=7Mn3ESHNY=H6DyhAq5Y7GjY1sOPS0XX6s8GHZsRiFtgg@mail.gmail.com>
References: <CAJiPhfnAFboGoX7wdWeZWpmA8JJNt=mr-pRnFtba32Xt4FHFeQ@mail.gmail.com>
 <CADcj3=5qJr0yn+69dryYhY2xWBL3y+uxzruTNfz7TWiLHfbrJw@mail.gmail.com>
 <CAJiPhfkf99t=L04BPHomTtSLKJihsLYoDKY4RmMA6ED+seF2DA@mail.gmail.com>
 <CADcj3=7Mn3ESHNY=H6DyhAq5Y7GjY1sOPS0XX6s8GHZsRiFtgg@mail.gmail.com>
Message-ID: <CAJiPhfkism7N7_y-qtu=ZgG5VKgkQEC7HGn+M3XzZ8ZzGJmc2g@mail.gmail.com>

I think so.

Here is the conf file: https://pastebin.com/DKMbwNV6

Felipe Arturo Polanco <felipeapolanco at gmail.com> escreveu no dia quinta,
13/02/2020 ?(s) 16:22:

> Did you configure Squid to accept both HTTP and HTTPS ports?
>
> Please share your squid.conf file.
>
> Thanks,
>
> On Thu, Feb 13, 2020 at 12:18 PM Patr?cia Sousa <psousadp at gmail.com>
> wrote:
>
>> Hi,
>>
>> Thanks for the tip,
>>
>> Enabling debug_options I can see that the wget from the machine computer
>> to the Squid machine does not goes through the proxy. Any idea why?
>>
>> Felipe Arturo Polanco <felipeapolanco at gmail.com> escreveu no dia quinta,
>> 13/02/2020 ?(s) 15:32:
>>
>>> Hi,
>>>
>>> For this, you need to use IPtables to block at the network level.
>>>
>>> SSH uses port 22/tcp but wget uses HTTP, it should have been blocked by
>>> squid.
>>> Enabled debug_options in squid to see why it was allowed.
>>>
>>>
>>>
>>> On Thu, Feb 13, 2020 at 11:10 AM Patr?cia Sousa <psousadp at gmail.com>
>>> wrote:
>>>
>>>> I'm using the squid proxy and I'm trying to block some connections
>>>> (incoming and outcoming traffic) from a certain ip address. However, for
>>>> example, if I deny all the connections (http_access deny all) it only
>>>> blocks the connections that I made to websites for example, but if I use
>>>> another PC and try to ssh or wget the PC that owns the proxy squid, it is
>>>> allowed. How can I block the traffic from and to a specific IP or DNS? It
>>>> is possible to do this with Squid?
>>>>
>>>> If not, what is the best way to do this?
>>>>
>>>> Thank you.
>>>> _______________________________________________
>>>> squid-users mailing list
>>>> squid-users at lists.squid-cache.org
>>>> http://lists.squid-cache.org/listinfo/squid-users
>>>>
>>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20200213/6c959ba0/attachment.htm>

From felipeapolanco at gmail.com  Thu Feb 13 16:29:31 2020
From: felipeapolanco at gmail.com (Felipe Arturo Polanco)
Date: Thu, 13 Feb 2020 12:29:31 -0400
Subject: [squid-users] Squid proxy incoming and outcoming connections?
In-Reply-To: <CAJiPhfkism7N7_y-qtu=ZgG5VKgkQEC7HGn+M3XzZ8ZzGJmc2g@mail.gmail.com>
References: <CAJiPhfnAFboGoX7wdWeZWpmA8JJNt=mr-pRnFtba32Xt4FHFeQ@mail.gmail.com>
 <CADcj3=5qJr0yn+69dryYhY2xWBL3y+uxzruTNfz7TWiLHfbrJw@mail.gmail.com>
 <CAJiPhfkf99t=L04BPHomTtSLKJihsLYoDKY4RmMA6ED+seF2DA@mail.gmail.com>
 <CADcj3=7Mn3ESHNY=H6DyhAq5Y7GjY1sOPS0XX6s8GHZsRiFtgg@mail.gmail.com>
 <CAJiPhfkism7N7_y-qtu=ZgG5VKgkQEC7HGn+M3XzZ8ZzGJmc2g@mail.gmail.com>
Message-ID: <CADcj3=6d4SytLH0o4ppBsC1yCK5nP6cwb+d+dO+Myg84vFimkg@mail.gmail.com>

You only have one port open for Squid
http_port 3128
You need two ports, one for HTTP and another for HTTPS.
Also, if you are going to block HTTPS based on the domain name, you need to
do sslBump to get the SNI of the destination website and then terminate the
SSL connection.

On Thu, Feb 13, 2020 at 12:26 PM Patr?cia Sousa <psousadp at gmail.com> wrote:

> I think so.
>
> Here is the conf file: https://pastebin.com/DKMbwNV6
>
> Felipe Arturo Polanco <felipeapolanco at gmail.com> escreveu no dia quinta,
> 13/02/2020 ?(s) 16:22:
>
>> Did you configure Squid to accept both HTTP and HTTPS ports?
>>
>> Please share your squid.conf file.
>>
>> Thanks,
>>
>> On Thu, Feb 13, 2020 at 12:18 PM Patr?cia Sousa <psousadp at gmail.com>
>> wrote:
>>
>>> Hi,
>>>
>>> Thanks for the tip,
>>>
>>> Enabling debug_options I can see that the wget from the machine computer
>>> to the Squid machine does not goes through the proxy. Any idea why?
>>>
>>> Felipe Arturo Polanco <felipeapolanco at gmail.com> escreveu no dia
>>> quinta, 13/02/2020 ?(s) 15:32:
>>>
>>>> Hi,
>>>>
>>>> For this, you need to use IPtables to block at the network level.
>>>>
>>>> SSH uses port 22/tcp but wget uses HTTP, it should have been blocked by
>>>> squid.
>>>> Enabled debug_options in squid to see why it was allowed.
>>>>
>>>>
>>>>
>>>> On Thu, Feb 13, 2020 at 11:10 AM Patr?cia Sousa <psousadp at gmail.com>
>>>> wrote:
>>>>
>>>>> I'm using the squid proxy and I'm trying to block some connections
>>>>> (incoming and outcoming traffic) from a certain ip address. However, for
>>>>> example, if I deny all the connections (http_access deny all) it only
>>>>> blocks the connections that I made to websites for example, but if I use
>>>>> another PC and try to ssh or wget the PC that owns the proxy squid, it is
>>>>> allowed. How can I block the traffic from and to a specific IP or DNS? It
>>>>> is possible to do this with Squid?
>>>>>
>>>>> If not, what is the best way to do this?
>>>>>
>>>>> Thank you.
>>>>> _______________________________________________
>>>>> squid-users mailing list
>>>>> squid-users at lists.squid-cache.org
>>>>> http://lists.squid-cache.org/listinfo/squid-users
>>>>>
>>>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20200213/d317bf68/attachment.htm>

From Chris.Latino at mastercard.com  Thu Feb 13 16:36:50 2020
From: Chris.Latino at mastercard.com (Latino, Chris)
Date: Thu, 13 Feb 2020 16:36:50 +0000
Subject: [squid-users] squid-users Digest, Vol 66, Issue 13,
	Squid 4.10 for windows
Message-ID: <ea4b73032e214a469c90b4edc3d8b31b@mastercard.com>

Unfortunately due to design by architects here this will not be possible at this moment, but I will suggest this up the chain. So we will stick with v3.5.28. Is there plans to make the windows version available in the future.

Chris Latino
Systems Platform Engineer II

Mastercard
1 Angel Lane | London, EC4R 3AB


-----Original Message-----
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of squid-users-request at lists.squid-cache.org
Sent: 13 February 2020 16:26
To: squid-users at lists.squid-cache.org
Subject: squid-users Digest, Vol 66, Issue 13

Send squid-users mailing list submissions to
	squid-users at lists.squid-cache.org

To subscribe or unsubscribe via the World Wide Web, visit
	https://urldefense.proofpoint.com/v2/url?u=http-3A__lists.squid-2Dcache.org_listinfo_squid-2Dusers&d=DwIGaQ&c=uc5ZRXl8dGLM1RMQwf7xTCjRqXF0jmCF6SP0bDlmMmY&r=ZO_4u8yVNn_3q7TmkfoNDXPUaze1C-nxiq5H74Rmf8Y&m=E7G7-YCdvdwuhscn3KcjCIzHnY1HIdbZVfI2BbqgHWg&s=4AFST0RQi7tk2FMW7MRTtOlMTMORZwr4VWlcElN0uCk&e=
or, via email, send a message with subject or body 'help' to
	squid-users-request at lists.squid-cache.org

You can reach the person managing the list at
	squid-users-owner at lists.squid-cache.org

When replying, please edit your Subject line so it is more specific than "Re: Contents of squid-users digest..."


Today's Topics:

   1. Re: Squid proxy incoming and outcoming connections?
      (Patr?cia Sousa)
   2. Re: Squid proxy incoming and outcoming connections?
      (Felipe Arturo Polanco)
   3. Re: Squid 4.10 for windows (Rafael Akchurin)


----------------------------------------------------------------------

Message: 1
Date: Thu, 13 Feb 2020 16:18:34 +0000
From: Patr?cia Sousa <psousadp at gmail.com>
To: Felipe Arturo Polanco <felipeapolanco at gmail.com>
Cc: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Squid proxy incoming and outcoming
	connections?
Message-ID:
	<CAJiPhfkf99t=L04BPHomTtSLKJihsLYoDKY4RmMA6ED+seF2DA at mail.gmail.com>
Content-Type: text/plain; charset="utf-8"

Hi,

Thanks for the tip,

Enabling debug_options I can see that the wget from the machine computer to the Squid machine does not goes through the proxy. Any idea why?

Felipe Arturo Polanco <felipeapolanco at gmail.com> escreveu no dia quinta,
13/02/2020 ?(s) 15:32:

> Hi,
>
> For this, you need to use IPtables to block at the network level.
>
> SSH uses port 22/tcp but wget uses HTTP, it should have been blocked 
> by squid.
> Enabled debug_options in squid to see why it was allowed.
>
>
>
> On Thu, Feb 13, 2020 at 11:10 AM Patr?cia Sousa <psousadp at gmail.com>
> wrote:
>
>> I'm using the squid proxy and I'm trying to block some connections 
>> (incoming and outcoming traffic) from a certain ip address. However, 
>> for example, if I deny all the connections (http_access deny all) it 
>> only blocks the connections that I made to websites for example, but 
>> if I use another PC and try to ssh or wget the PC that owns the proxy 
>> squid, it is allowed. How can I block the traffic from and to a 
>> specific IP or DNS? It is possible to do this with Squid?
>>
>> If not, what is the best way to do this?
>>
>> Thank you.
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> https://urldefense.proofpoint.com/v2/url?u=http-3A__lists.squid-2Dcac
>> he.org_listinfo_squid-2Dusers&d=DwIGaQ&c=uc5ZRXl8dGLM1RMQwf7xTCjRqXF0
>> jmCF6SP0bDlmMmY&r=ZO_4u8yVNn_3q7TmkfoNDXPUaze1C-nxiq5H74Rmf8Y&m=E7G7-
>> YCdvdwuhscn3KcjCIzHnY1HIdbZVfI2BbqgHWg&s=4AFST0RQi7tk2FMW7MRTtOlMTMOR
>> Zwr4VWlcElN0uCk&e=
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://urldefense.proofpoint.com/v2/url?u=http-3A__lists.squid-2Dcache.org_pipermail_squid-2Dusers_attachments_20200213_da75aa29_attachment-2D0001.html&d=DwIGaQ&c=uc5ZRXl8dGLM1RMQwf7xTCjRqXF0jmCF6SP0bDlmMmY&r=ZO_4u8yVNn_3q7TmkfoNDXPUaze1C-nxiq5H74Rmf8Y&m=E7G7-YCdvdwuhscn3KcjCIzHnY1HIdbZVfI2BbqgHWg&s=E5BhBm28H6iaiIKGkoVlaMCeSMKIOpmgffp1u2A0Q1M&e= >

------------------------------

Message: 2
Date: Thu, 13 Feb 2020 12:21:50 -0400
From: Felipe Arturo Polanco <felipeapolanco at gmail.com>
To: Patr?cia Sousa <psousadp at gmail.com>
Cc: Squid Users <squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] Squid proxy incoming and outcoming
	connections?
Message-ID:
	<CADcj3=7Mn3ESHNY=H6DyhAq5Y7GjY1sOPS0XX6s8GHZsRiFtgg at mail.gmail.com>
Content-Type: text/plain; charset="utf-8"

Did you configure Squid to accept both HTTP and HTTPS ports?

Please share your squid.conf file.

Thanks,

On Thu, Feb 13, 2020 at 12:18 PM Patr?cia Sousa <psousadp at gmail.com> wrote:

> Hi,
>
> Thanks for the tip,
>
> Enabling debug_options I can see that the wget from the machine 
> computer to the Squid machine does not goes through the proxy. Any idea why?
>
> Felipe Arturo Polanco <felipeapolanco at gmail.com> escreveu no dia 
> quinta,
> 13/02/2020 ?(s) 15:32:
>
>> Hi,
>>
>> For this, you need to use IPtables to block at the network level.
>>
>> SSH uses port 22/tcp but wget uses HTTP, it should have been blocked 
>> by squid.
>> Enabled debug_options in squid to see why it was allowed.
>>
>>
>>
>> On Thu, Feb 13, 2020 at 11:10 AM Patr?cia Sousa <psousadp at gmail.com>
>> wrote:
>>
>>> I'm using the squid proxy and I'm trying to block some connections 
>>> (incoming and outcoming traffic) from a certain ip address. However, 
>>> for example, if I deny all the connections (http_access deny all) it 
>>> only blocks the connections that I made to websites for example, but 
>>> if I use another PC and try to ssh or wget the PC that owns the 
>>> proxy squid, it is allowed. How can I block the traffic from and to 
>>> a specific IP or DNS? It is possible to do this with Squid?
>>>
>>> If not, what is the best way to do this?
>>>
>>> Thank you.
>>> _______________________________________________
>>> squid-users mailing list
>>> squid-users at lists.squid-cache.org
>>> https://urldefense.proofpoint.com/v2/url?u=http-3A__lists.squid-2Dca
>>> che.org_listinfo_squid-2Dusers&d=DwIGaQ&c=uc5ZRXl8dGLM1RMQwf7xTCjRqX
>>> F0jmCF6SP0bDlmMmY&r=ZO_4u8yVNn_3q7TmkfoNDXPUaze1C-nxiq5H74Rmf8Y&m=E7
>>> G7-YCdvdwuhscn3KcjCIzHnY1HIdbZVfI2BbqgHWg&s=4AFST0RQi7tk2FMW7MRTtOlM
>>> TMORZwr4VWlcElN0uCk&e=
>>>
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://urldefense.proofpoint.com/v2/url?u=http-3A__lists.squid-2Dcache.org_pipermail_squid-2Dusers_attachments_20200213_db86f0df_attachment-2D0001.html&d=DwIGaQ&c=uc5ZRXl8dGLM1RMQwf7xTCjRqXF0jmCF6SP0bDlmMmY&r=ZO_4u8yVNn_3q7TmkfoNDXPUaze1C-nxiq5H74Rmf8Y&m=E7G7-YCdvdwuhscn3KcjCIzHnY1HIdbZVfI2BbqgHWg&s=_TmrQJSJ3OuJaLynfdQYRWTpY7kzpAzyzD9ra4sQyRA&e= >

------------------------------

Message: 3
Date: Thu, 13 Feb 2020 16:26:01 +0000
From: Rafael Akchurin <rafael.akchurin at diladele.com>
To: "Latino, Chris" <Chris.Latino at mastercard.com>,
	"squid-users at lists.squid-cache.org"
	<squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] Squid 4.10 for windows
Message-ID:
	<AM0PR04MB4753CA7244BFD3628224DED38F1A0 at AM0PR04MB4753.eurprd04.prod.outlook.com>
	
Content-Type: text/plain; charset="utf-8"

Sorry Chris,

We still cannot find time to finish compilation of Squid 4 for Windows.
The Linux version running within Hyper-V works much better most probably. Why not to try it?

Best regards,
Rafael Akchurin
Diladele B.V.


From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Latino, Chris
Sent: Thursday, 13 February 2020 17:17
To: squid-users at lists.squid-cache.org
Subject: [squid-users] Squid 4.10 for windows

Hi

Hoping you can help we are using squid for windows 3.5.28

Our vulnerability scanner is saying this isn't the latest version but I can't see a 4.10 version for windows and when I go to

https://urldefense.proofpoint.com/v2/url?u=https-3A__squid.diladele.com_&d=DwIGaQ&c=uc5ZRXl8dGLM1RMQwf7xTCjRqXF0jmCF6SP0bDlmMmY&r=ZO_4u8yVNn_3q7TmkfoNDXPUaze1C-nxiq5H74Rmf8Y&m=E7G7-YCdvdwuhscn3KcjCIzHnY1HIdbZVfI2BbqgHWg&s=Y0hsufOmiYEA7pVGmde7HI-FHkwvIn8Y5CETbQbLHW4&e= 

It's still showing the 3.5.28 version

Chris Latino
Senior Systems Platform Engineer II

Mastercard
1 Angel Lane | London, EC4R 3AB
[cid:image001.png at 01D5E292.B0BD8290]<http://www.mastercard.com>

CONFIDENTIALITY NOTICE This e-mail message and any attachments are only for the use of the intended recipient and may contain information that is privileged, confidential or exempt from disclosure under applicable law. If you are not the intended recipient, any disclosure, distribution or other use of this e-mail message or attachments is prohibited. If you have received this e-mail message in error, please delete and notify the sender immediately. Thank you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://urldefense.proofpoint.com/v2/url?u=http-3A__lists.squid-2Dcache.org_pipermail_squid-2Dusers_attachments_20200213_fb7ecd56_attachment.html&d=DwIGaQ&c=uc5ZRXl8dGLM1RMQwf7xTCjRqXF0jmCF6SP0bDlmMmY&r=ZO_4u8yVNn_3q7TmkfoNDXPUaze1C-nxiq5H74Rmf8Y&m=E7G7-YCdvdwuhscn3KcjCIzHnY1HIdbZVfI2BbqgHWg&s=vNMJAXph8SKM41XdvJCYMr3sly9Wp1Pielj8PfD7sXU&e= >
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 3198 bytes
Desc: image001.png
URL: <https://urldefense.proofpoint.com/v2/url?u=http-3A__lists.squid-2Dcache.org_pipermail_squid-2Dusers_attachments_20200213_fb7ecd56_attachment.png&d=DwIGaQ&c=uc5ZRXl8dGLM1RMQwf7xTCjRqXF0jmCF6SP0bDlmMmY&r=ZO_4u8yVNn_3q7TmkfoNDXPUaze1C-nxiq5H74Rmf8Y&m=E7G7-YCdvdwuhscn3KcjCIzHnY1HIdbZVfI2BbqgHWg&s=cxPx5sSkegRGwGAMSnBq-lOqaUBdmNG7zkTCB96m2aA&e= >

------------------------------

Subject: Digest Footer

_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
https://urldefense.proofpoint.com/v2/url?u=http-3A__lists.squid-2Dcache.org_listinfo_squid-2Dusers&d=DwIGaQ&c=uc5ZRXl8dGLM1RMQwf7xTCjRqXF0jmCF6SP0bDlmMmY&r=ZO_4u8yVNn_3q7TmkfoNDXPUaze1C-nxiq5H74Rmf8Y&m=E7G7-YCdvdwuhscn3KcjCIzHnY1HIdbZVfI2BbqgHWg&s=4AFST0RQi7tk2FMW7MRTtOlMTMORZwr4VWlcElN0uCk&e= 


------------------------------

End of squid-users Digest, Vol 66, Issue 13
*******************************************

From squid3 at treenet.co.nz  Fri Feb 14 08:21:32 2020
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 14 Feb 2020 21:21:32 +1300
Subject: [squid-users] Squid and iptables
In-Reply-To: <vmime.5e417b53.3b3c.331b2d453d390d03@ms249-lin-003.rotterdam.bazuin.nl>
References: <vmime.5e417b53.3b3c.331b2d453d390d03@ms249-lin-003.rotterdam.bazuin.nl>
Message-ID: <e099efd0-b389-fbb2-4357-e3dba9f7c6d7@treenet.co.nz>

On 11/02/20 4:48 am, L.P.H. van Belle wrote:
> Hai, 
>  
> I'm having a squid 4.10 on Debian 10 running ( with strongswan VPN ) and ufw firewall (iptables) 
> Most is running fine but i still see some error and i somehow miss here what im doing wrong. 
> 

You may not be doing anything.

INVALID from Conntrack means the packet is either corrupted at the
binary level, or not supposed to exist, maybe both if the corruption
makes something that looks like a valid but wrong packet.


> So if someone has suggestions that would be great. I see for example these lines in the UFW log. 
> 
> Feb 10 15:42:21 rtd-proxy1 kernel: [14315.762249] [UFW AUDIT INVALID] IN=eth0 OUT= MAC=56:30:b7:fd:da:24:84:2b:2b:90:a5:f1:08:00 SRC=192.168.0.101 DST=192.168.0.1 LEN=40 TOS=0x00 PREC=0x00 TTL=128 ID=22171 DF PROTO=TCP SPT=52273 DPT=8080 WINDOW=0 RES=0x00 ACK RST URGP=0
> Feb 10 15:42:21 rtd-proxy1 kernel: [14315.762308] [UFW BLOCK] IN=eth0 OUT= MAC=56:30:b7:fd:da:24:84:2b:2b:90:a5:f1:08:00 SRC=192.168.0.101 DST=192.168.0.1 LEN=40 TOS=0x00 PREC=0x00 TTL=128 ID=22171 DF PROTO=TCP SPT=52273 DPT=8080 WINDOW=0 RES=0x00 ACK RST URGP=0
> 
> Now, strange thing here is im allowing my traffic on my lan interface fully, so i dont see/get why i get these INVALID/BLOCK.
> Im out of ideas, i looked to much at it, i done see it anymore..  :-( 
> 
> The needed parts of my squid and iptables (ufw) setup. 
> ETH0 = LAN  192.168.0.1.0/24 	(ip: 192.168.0.1.1/24  )

Too many dots for an IP address. I hope that is manual obfuscation...


> ETH1 = WAN  1.2.4.4/32	
>   
> The squid part 
> # From squid cache.log the needed lines from a start of squid with the lines from squid.conf 
> 
> # http_port localhost:3128 connection-auth=off
> 2020/02/10 11:44:13 kid1| Accepting HTTP Socket connections at local=[::1]:3128 remote=[::] FD 17 flags=1 
> # all requests for and on loclhost are trusted, so fully allowed withouth authenticationn. 


NP: "connection-auth=" has nothing to do with whether the connection is
trusted or not. It is about whether the HTTP auth schemes are going to
be used. Disabling it breaks NTLM and Negotiate - the "connection based"
auth schemes.


> 
> # http_port 192.168.249.221:3128 intercept  ( no-authentication possbible on intercept ) 
> 2020/02/10 11:44:13 kid1| Accepting NAT intercepted HTTP Socket connections at local=192.168.0.1.1:3128 remote=[::] FD 21 flags=33
> 

 ... looks to be botched obfuscate. The config line does not match IPs
with the mentioned log line.

BTW, standardized IP ranges like 192.168.* do not really need
obfuscating. They are not (or should not be) globally accessible.


> # https_port 192.168.249.221:3129 intercept ssl-bump \ .. (plus the cert - key parts, not relevant this works ). 
> 2020/02/10 11:44:13 kid1| Accepting NAT intercepted SSL bumped HTTPS Socket connections at local=192.168.0.1.1:3129 remote=[::] FD 25 flags=33
> 
> # Non-proxy aware  (with authentication)
> # http_port 192.168.249.221:8080
> 2020/02/10 11:44:13 kid1| Accepting HTTP Socket connections at local=192.168.0.1.1:8080 remote=[::] FD 29 flags=1
> 
> # http_port 192.168.249.221:8081 ssl-bump \ .. (plus the cert - key parts, not relevant this works ). 
> 2020/02/10 11:44:13 kid1| Accepting SSL bumped HTTP Socket connections at local=192.168.0.1.1:8081 remote=[::] FD 37 flags=1
> 


[ I have unwound the nested tree of sub-chains to follow what is going
on more simply. ]

> 
> # Generated by xtables-save v1.8.2 on Mon Feb 10 15:16:26 2020
> *filter
> :INPUT DROP [213:54000]
> :FORWARD ACCEPT [704:28436]
> :OUTPUT ACCEPT [57:19155]

> -A INPUT -m conntrack --ctstate NEW -m limit --limit 3/min --limit-burst 10 -j LOG --log-prefix "[UFW AUDIT] "> -A INPUT -i lo -j ACCEPT

This should probably be done *after* the checks and handling of INVALID
traffic.

> -A INPUT -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
> -A INPUT -m conntrack --ctstate INVALID -m conntrack --ctstate INVALID -m limit --limit 3/min --limit-burst 10 -j LOG --log-prefix "[UFW AUDIT INVALID] "
> -A INPUT -m conntrack --ctstate INVALID -m limit --limit 3/min --limit-burst 10 -j LOG --log-prefix "[UFW BLOCK] "
> -A INPUT -m conntrack --ctstate INVALID -j DROP> -A INPUT -i eth0 -p udp -m multiport --dports 80,443 -j DROP

Use REJECT here. HTTP/3 uses these ports and DROP will cause Browsers
etc to have long timeouts on initial connection setup.

> -A INPUT -m limit --limit 3/min --limit-burst 10 -j LOG --log-prefix "[UFW BLOCK] "

> -A FORWARD -m conntrack --ctstate NEW -m limit --limit 3/min --limit-burst 10 -j LOG --log-prefix "[UFW AUDIT] "
> -A FORWARD -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
> -A FORWARD -m limit --limit 3/min --limit-burst 10 -j LOG --log-prefix "[UFW ALLOW] "
> -A FORWARD -p tcp -m conntrack --ctstate NEW -j ACCEPT
> -A FORWARD -p udp -m conntrack --ctstate NEW -j ACCEPT

> -A OUTPUT -m conntrack --ctstate NEW -m limit --limit 3/min
--limit-burst 10 -j LOG --log-prefix "[UFW AUDIT] "
> -A OUTPUT -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
> -A OUTPUT -o lo -j ACCEPT
> -A OUTPUT -m limit --limit 3/min --limit-burst 10 -j LOG --log-prefix "[UFW ALLOW] "
> -A OUTPUT -p tcp -m conntrack --ctstate NEW -j ACCEPT
> -A OUTPUT -p udp -m conntrack --ctstate NEW -j ACCEPT

> 
> *nat
> :PREROUTING ACCEPT [0:0]
> :INPUT ACCEPT [0:0]
> :POSTROUTING ACCEPT [0:0]
> :OUTPUT ACCEPT [0:0]

> -A PREROUTING -i eth0 -p tcp -m tcp --dport 443 -m comment --comment "Squid-Intercept 443->3129" -j REDIRECT --to-ports 3129
> -A PREROUTING -i eth0 -p tcp -m tcp --dport 80 -m comment --comment "Squid-Intercept 80->3128" -j REDIRECT --to-ports 3128

 1) Your Log lines above say that Squid is accepting *forward proxy*
traffic on port localhost:3128. The above rules will intercept that traffic.
  One of several reasons why one should avoid using a standard port for
purposes other than its officially registered use.

 2) there are no lines preventing NAT catching the traffic leaving Squid
to those ports and looping it back into Squid.


> -A POSTROUTING -s 192.168.0.1.0/24 -o eth1 -m comment --comment "IP-Masq Lan via eth1" -j MASQUERADE


> 
> *mangle
> :PREROUTING ACCEPT [0:0]
> :INPUT ACCEPT [0:0]
> :FORWARD ACCEPT [0:0]
> :OUTPUT ACCEPT [0:0]
> :POSTROUTING ACCEPT [0:0]


Missing rule(s) to prevent other machines and software sending traffic
directly to the NAT intercept ports Squid is using. You need those ports
to be locked down so only the NAT system can cause packets to arrive there.


> 
> Thanks for looking at it.. 
> I hope someone see what im doing wrong here..
> 

There are a few other things (ICMP handling etc.), But I am restricting
my comments to the rules that are processed for HTTP(S) traffic.


Amos


From uhlar at fantomas.sk  Fri Feb 14 09:41:50 2020
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Fri, 14 Feb 2020 10:41:50 +0100
Subject: [squid-users] Squid proxy incoming and outcoming connections?
In-Reply-To: <CAJiPhfkf99t=L04BPHomTtSLKJihsLYoDKY4RmMA6ED+seF2DA@mail.gmail.com>
References: <CAJiPhfnAFboGoX7wdWeZWpmA8JJNt=mr-pRnFtba32Xt4FHFeQ@mail.gmail.com>
 <CADcj3=5qJr0yn+69dryYhY2xWBL3y+uxzruTNfz7TWiLHfbrJw@mail.gmail.com>
 <CAJiPhfkf99t=L04BPHomTtSLKJihsLYoDKY4RmMA6ED+seF2DA@mail.gmail.com>
Message-ID: <20200214094150.GB16768@fantomas.sk>

On 13.02.20 16:18, Patr?cia Sousa wrote:
>Enabling debug_options I can see that the wget from the machine computer to
>the Squid machine does not goes through the proxy. Any idea why?

Because you apparently haven't configured anything to use the proxy.

Squid is a proxy, not a firewall, and it does not block connections to your
machine. 

Also, SQUID can only support HTTP and HTTPS connections, not SSH.

SSH and other TCP connections can be tunnelled through proxy, but the
clients need to be configured to use HTTP proxy, if they support it.



>Felipe Arturo Polanco <felipeapolanco at gmail.com> escreveu no dia quinta,
>13/02/2020 ?(s) 15:32:
>> For this, you need to use IPtables to block at the network level.
>>
>> SSH uses port 22/tcp but wget uses HTTP, it should have been blocked by
>> squid.
>> Enabled debug_options in squid to see why it was allowed.
>>
>>
>>
>> On Thu, Feb 13, 2020 at 11:10 AM Patr?cia Sousa <psousadp at gmail.com>
>> wrote:
>>
>>> I'm using the squid proxy and I'm trying to block some connections
>>> (incoming and outcoming traffic) from a certain ip address. However, for
>>> example, if I deny all the connections (http_access deny all) it only
>>> blocks the connections that I made to websites for example, but if I use
>>> another PC and try to ssh or wget the PC that owns the proxy squid, it is
>>> allowed. How can I block the traffic from and to a specific IP or DNS? It
>>> is possible to do this with Squid?
>>>
>>> If not, what is the best way to do this?

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
M$ Win's are shit, do not use it !


From uhlar at fantomas.sk  Fri Feb 14 09:43:35 2020
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Fri, 14 Feb 2020 10:43:35 +0100
Subject: [squid-users] Squid proxy incoming and outcoming connections?
In-Reply-To: <CADcj3=6d4SytLH0o4ppBsC1yCK5nP6cwb+d+dO+Myg84vFimkg@mail.gmail.com>
References: <CAJiPhfnAFboGoX7wdWeZWpmA8JJNt=mr-pRnFtba32Xt4FHFeQ@mail.gmail.com>
 <CADcj3=5qJr0yn+69dryYhY2xWBL3y+uxzruTNfz7TWiLHfbrJw@mail.gmail.com>
 <CAJiPhfkf99t=L04BPHomTtSLKJihsLYoDKY4RmMA6ED+seF2DA@mail.gmail.com>
 <CADcj3=7Mn3ESHNY=H6DyhAq5Y7GjY1sOPS0XX6s8GHZsRiFtgg@mail.gmail.com>
 <CAJiPhfkism7N7_y-qtu=ZgG5VKgkQEC7HGn+M3XzZ8ZzGJmc2g@mail.gmail.com>
 <CADcj3=6d4SytLH0o4ppBsC1yCK5nP6cwb+d+dO+Myg84vFimkg@mail.gmail.com>
Message-ID: <20200214094335.GC16768@fantomas.sk>

On 13.02.20 12:29, Felipe Arturo Polanco wrote:
>You only have one port open for Squid
>http_port 3128
>You need two ports, one for HTTP and another for HTTPS.
>Also, if you are going to block HTTPS based on the domain name, you need to
>do sslBump to get the SNI of the destination website and then terminate the
>SSL connection.

No, he does not.

both HTTP and HTTPS can be proxied through the same port, the difference is
https uses CONNECT requests.

He would need different port for intercepting proxy and another for
intercepting HTTPS proxy, but the interception is not configured yet.


>On Thu, Feb 13, 2020 at 12:26 PM Patr?cia Sousa <psousadp at gmail.com> wrote:
>> Here is the conf file: https://pastebin.com/DKMbwNV6

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Emacs is a complicated operating system without good text editor.


From 0xff1f at gmail.com  Fri Feb 14 09:45:16 2020
From: 0xff1f at gmail.com (Ahmad Alzaeem)
Date: Fri, 14 Feb 2020 12:45:16 +0300
Subject: [squid-users] How to match website subdomains and all others root
	domains
Message-ID: <F505881B-CBB9-41FF-A956-2D3CA22DC451@gmail.com>

Hello folks ,
How can I match all subdomains of google and all roots urls of google such as 

google.com <http://google.com/>
google.co.uk <http://google.co.uk/>
Google.eu
google.us <http://google.us/>

With an all ?



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20200214/5b53c59d/attachment.htm>

From psousadp at gmail.com  Fri Feb 14 10:05:22 2020
From: psousadp at gmail.com (=?UTF-8?Q?Patr=C3=ADcia_Sousa?=)
Date: Fri, 14 Feb 2020 10:05:22 +0000
Subject: [squid-users] Squid proxy incoming and outcoming connections?
In-Reply-To: <20200214094150.GB16768@fantomas.sk>
References: <CAJiPhfnAFboGoX7wdWeZWpmA8JJNt=mr-pRnFtba32Xt4FHFeQ@mail.gmail.com>
 <CADcj3=5qJr0yn+69dryYhY2xWBL3y+uxzruTNfz7TWiLHfbrJw@mail.gmail.com>
 <CAJiPhfkf99t=L04BPHomTtSLKJihsLYoDKY4RmMA6ED+seF2DA@mail.gmail.com>
 <20200214094150.GB16768@fantomas.sk>
Message-ID: <CAJiPhf=+QEswz8WORjR+5OhGVZuNCptwXSb3spAMf3zDF+sjqQ@mail.gmail.com>

I only configured the machine that has the squid proxy to use it. If I made
a wget from this machine to the another, it denies the request, as desired.
Only the reverse is not taken.

So, it's not possible to configure the http "incoming" connections to my
machine to go through the proxy?

Matus UHLAR - fantomas <uhlar at fantomas.sk> escreveu no dia sexta,
14/02/2020 ?(s) 09:41:

> On 13.02.20 16:18, Patr?cia Sousa wrote:
> >Enabling debug_options I can see that the wget from the machine computer
> to
> >the Squid machine does not goes through the proxy. Any idea why?
>
> Because you apparently haven't configured anything to use the proxy.
>
> Squid is a proxy, not a firewall, and it does not block connections to your
> machine.
>
> Also, SQUID can only support HTTP and HTTPS connections, not SSH.
>
> SSH and other TCP connections can be tunnelled through proxy, but the
> clients need to be configured to use HTTP proxy, if they support it.
>
>
>
> >Felipe Arturo Polanco <felipeapolanco at gmail.com> escreveu no dia quinta,
> >13/02/2020 ?(s) 15:32:
> >> For this, you need to use IPtables to block at the network level.
> >>
> >> SSH uses port 22/tcp but wget uses HTTP, it should have been blocked by
> >> squid.
> >> Enabled debug_options in squid to see why it was allowed.
> >>
> >>
> >>
> >> On Thu, Feb 13, 2020 at 11:10 AM Patr?cia Sousa <psousadp at gmail.com>
> >> wrote:
> >>
> >>> I'm using the squid proxy and I'm trying to block some connections
> >>> (incoming and outcoming traffic) from a certain ip address. However,
> for
> >>> example, if I deny all the connections (http_access deny all) it only
> >>> blocks the connections that I made to websites for example, but if I
> use
> >>> another PC and try to ssh or wget the PC that owns the proxy squid, it
> is
> >>> allowed. How can I block the traffic from and to a specific IP or DNS?
> It
> >>> is possible to do this with Squid?
> >>>
> >>> If not, what is the best way to do this?
>
> --
> Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
> Warning: I wish NOT to receive e-mail advertising to this address.
> Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
> M$ Win's are shit, do not use it !
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20200214/6ec60d92/attachment.htm>

From squid3 at treenet.co.nz  Fri Feb 14 10:30:41 2020
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 14 Feb 2020 23:30:41 +1300
Subject: [squid-users] How to match website subdomains and all others
 root domains
In-Reply-To: <F505881B-CBB9-41FF-A956-2D3CA22DC451@gmail.com>
References: <F505881B-CBB9-41FF-A956-2D3CA22DC451@gmail.com>
Message-ID: <325cd585-1024-f2b5-6fd6-16987dd575a8@treenet.co.nz>

On 14/02/20 10:45 pm, Ahmad Alzaeem wrote:
> Hello folks ,
> How can I match all subdomains of google and all roots urls of google
> such as?
> 
> google.com
> google.co.uk
> Google.eu
> google.us
> 
> With an all ?
> 

What do you mean "with an all" ?

all means all. Not just Google.

To match all domain names containing "google":

  acl google dstdomain_regex google

Note that this also matches non-Google domains which contain the word.
eg googlesucks.local

Also be aware that "google" is not the only domain, they have many.


Amos


From squid3 at treenet.co.nz  Fri Feb 14 10:25:48 2020
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 14 Feb 2020 23:25:48 +1300
Subject: [squid-users] Squid proxy incoming and outcoming connections?
In-Reply-To: <CAJiPhf=+QEswz8WORjR+5OhGVZuNCptwXSb3spAMf3zDF+sjqQ@mail.gmail.com>
References: <CAJiPhfnAFboGoX7wdWeZWpmA8JJNt=mr-pRnFtba32Xt4FHFeQ@mail.gmail.com>
 <CADcj3=5qJr0yn+69dryYhY2xWBL3y+uxzruTNfz7TWiLHfbrJw@mail.gmail.com>
 <CAJiPhfkf99t=L04BPHomTtSLKJihsLYoDKY4RmMA6ED+seF2DA@mail.gmail.com>
 <20200214094150.GB16768@fantomas.sk>
 <CAJiPhf=+QEswz8WORjR+5OhGVZuNCptwXSb3spAMf3zDF+sjqQ@mail.gmail.com>
Message-ID: <58a8d08a-d139-454b-a5aa-e74f72c8f788@treenet.co.nz>

On 14/02/20 11:05 pm, Patr?cia Sousa wrote:
> I only configured the machine that has the squid proxy to use it.

How did you configure an entire machine to use an HTTP-only proxy?

I think you mean something else. Details matter, so what *exactly* did
you configure?
 And no squid.conf does not count at the level you need to be looking.
It only controls traffic already arriving at the proxy.


> If I
> made a wget from this machine to the another, it denies the request, as
> desired. Only the reverse is not taken.?
> 

 "it" being Squid proxy, the machine firewall, the machine routing, the
destination machine firewall, or another firewall along the path between
them?
 Details matter.


> So, it's not possible to configure the http?"incoming" connections to my
> machine to go through the proxy??
> 

It is. Your words say you already did that. But the test results says
you did not. Without details of the machine setup its all just guesswork
rather than help.

Amos


From 3m9n51s2ewut at thismonkey.com  Fri Feb 14 15:23:38 2020
From: 3m9n51s2ewut at thismonkey.com (Scott)
Date: Sat, 15 Feb 2020 02:23:38 +1100
Subject: [squid-users] ssl::server_name matches non-TLS Host: header
Message-ID: <20200214152338.GA87057@thismonkey.com>

Hi,

I just noticed that ssl::server_name matches against the Host: header of 
non-TLS connections, which is handy, but it's not documented thusly in 
http://www.squid-cache.org/Doc/config/acl/

Is that behaviour expected? I'm running 4.9 btw.

Thanks,
Scott


From 3m9n51s2ewut at thismonkey.com  Fri Feb 14 15:36:21 2020
From: 3m9n51s2ewut at thismonkey.com (Scott)
Date: Sat, 15 Feb 2020 02:36:21 +1100
Subject: [squid-users] [Feature request] add IP version to logformat format
	codes
Message-ID: <20200214153620.GA36887@thismonkey.com>

Hi,

I know it's derivable by other means, but it would be nice to have a 
logformat format code that provided the client and server IP version numbers.

eg: >v for Client IP version (4 or 6) and <v for Server

Thanks,
Scott


From rousskov at measurement-factory.com  Fri Feb 14 16:03:50 2020
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Fri, 14 Feb 2020 11:03:50 -0500
Subject: [squid-users] [Feature request] add IP version to logformat
 format codes
In-Reply-To: <20200214153620.GA36887@thismonkey.com>
References: <20200214153620.GA36887@thismonkey.com>
Message-ID: <881b0fc6-e689-f1f2-9a84-2d8abd641464@measurement-factory.com>

On 2/14/20 10:36 AM, Scott wrote:

> I know it's derivable by other means, but it would be nice to have a 
> logformat format code that provided the client and server IP version numbers.

> eg: >v for Client IP version (4 or 6) and <v for Server


Other than client and server, Squid can log a few other IP addresses,
including:

    >a      Client source IP address
    >la     Local IP address the client connected to
    la      Local listening IP address the client connection was...
    <a      Server IP address of the last server or peer connection
    <la     Local IP address of the last server or peer connection
    icap::<A        ICAP server IP address. Similar to <A.


If we add support for automated IP version extraction, it should be
supported as a single new parameter for all existing %codes that log IP
addresses rather than new %codes (one %code for each of the existing
%codes that log IP addresses). For example:

    %>a{version}

FWIW, personally, I am not sure we should add such a %code option
because, I presume, the same information can be obtained simply by
checking the first character of the logged IP address for being '['.
Said that, I am open to hearing arguments why it should be added.


Cheers,

Alex.


From psousadp at gmail.com  Fri Feb 14 17:40:45 2020
From: psousadp at gmail.com (=?UTF-8?Q?Patr=C3=ADcia_Sousa?=)
Date: Fri, 14 Feb 2020 17:40:45 +0000
Subject: [squid-users] Squid proxy incoming and outcoming connections?
In-Reply-To: <58a8d08a-d139-454b-a5aa-e74f72c8f788@treenet.co.nz>
References: <CAJiPhfnAFboGoX7wdWeZWpmA8JJNt=mr-pRnFtba32Xt4FHFeQ@mail.gmail.com>
 <CADcj3=5qJr0yn+69dryYhY2xWBL3y+uxzruTNfz7TWiLHfbrJw@mail.gmail.com>
 <CAJiPhfkf99t=L04BPHomTtSLKJihsLYoDKY4RmMA6ED+seF2DA@mail.gmail.com>
 <20200214094150.GB16768@fantomas.sk>
 <CAJiPhf=+QEswz8WORjR+5OhGVZuNCptwXSb3spAMf3zDF+sjqQ@mail.gmail.com>
 <58a8d08a-d139-454b-a5aa-e74f72c8f788@treenet.co.nz>
Message-ID: <CAJiPhfnpfSefCprxdxO08eMpDsW67isccPJxSFWRn=3GgPY5Lw@mail.gmail.com>

Update:

It works now. There was a wrong iptables rule to redirect incoming traffic
to the proxy.

Amos Jeffries <squid3 at treenet.co.nz> escreveu no dia sexta, 14/02/2020 ?(s)
10:35:

> On 14/02/20 11:05 pm, Patr?cia Sousa wrote:
> > I only configured the machine that has the squid proxy to use it.
>
> How did you configure an entire machine to use an HTTP-only proxy?
>
> I think you mean something else. Details matter, so what *exactly* did
> you configure?
>  And no squid.conf does not count at the level you need to be looking.
> It only controls traffic already arriving at the proxy.
>
>
> > If I
> > made a wget from this machine to the another, it denies the request, as
> > desired. Only the reverse is not taken.
> >
>
>  "it" being Squid proxy, the machine firewall, the machine routing, the
> destination machine firewall, or another firewall along the path between
> them?
>  Details matter.
>
>
> > So, it's not possible to configure the http "incoming" connections to my
> > machine to go through the proxy?
> >
>
> It is. Your words say you already did that. But the test results says
> you did not. Without details of the machine setup its all just guesswork
> rather than help.
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20200214/c7a98f50/attachment.htm>

From uhlar at fantomas.sk  Fri Feb 14 18:02:40 2020
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Fri, 14 Feb 2020 19:02:40 +0100
Subject: [squid-users] Squid proxy incoming and outcoming connections?
In-Reply-To: <CAJiPhfnpfSefCprxdxO08eMpDsW67isccPJxSFWRn=3GgPY5Lw@mail.gmail.com>
References: <CAJiPhfnAFboGoX7wdWeZWpmA8JJNt=mr-pRnFtba32Xt4FHFeQ@mail.gmail.com>
 <CADcj3=5qJr0yn+69dryYhY2xWBL3y+uxzruTNfz7TWiLHfbrJw@mail.gmail.com>
 <CAJiPhfkf99t=L04BPHomTtSLKJihsLYoDKY4RmMA6ED+seF2DA@mail.gmail.com>
 <20200214094150.GB16768@fantomas.sk>
 <CAJiPhf=+QEswz8WORjR+5OhGVZuNCptwXSb3spAMf3zDF+sjqQ@mail.gmail.com>
 <58a8d08a-d139-454b-a5aa-e74f72c8f788@treenet.co.nz>
 <CAJiPhfnpfSefCprxdxO08eMpDsW67isccPJxSFWRn=3GgPY5Lw@mail.gmail.com>
Message-ID: <20200214180240.GA28051@fantomas.sk>

On 14.02.20 17:40, Patr?cia Sousa wrote:
>It works now. There was a wrong iptables rule to redirect incoming traffic
>to the proxy.

incoming traffic? Do people from the world connect to your proxy?


-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
"They say when you play that M$ CD backward you can hear satanic messages."
"That's nothing. If you play it forward it will install Windows."


From felipeapolanco at gmail.com  Fri Feb 14 21:28:48 2020
From: felipeapolanco at gmail.com (Felipe Polanco)
Date: Fri, 14 Feb 2020 17:28:48 -0400
Subject: [squid-users] Question regarding TPROXY and sslBump
Message-ID: <CADcj3=6fyPTOwK-==eeC+Je4kfipHMroi5D84JZ=uctsFKN9qQ@mail.gmail.com>

Hi,

Can squid running in TPROXY mode intercept and decrypt HTTPS payload with
sslBump?

This is for an in-line Layer 2 proxy application.

Thanks,
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20200214/0f80fc1e/attachment.htm>

From squid3 at treenet.co.nz  Sat Feb 15 07:16:50 2020
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 15 Feb 2020 20:16:50 +1300
Subject: [squid-users] Question regarding TPROXY and sslBump
In-Reply-To: <CADcj3=6fyPTOwK-==eeC+Je4kfipHMroi5D84JZ=uctsFKN9qQ@mail.gmail.com>
References: <CADcj3=6fyPTOwK-==eeC+Je4kfipHMroi5D84JZ=uctsFKN9qQ@mail.gmail.com>
Message-ID: <52557e98-fdeb-0266-c91a-18e203a2d883@treenet.co.nz>

On 15/02/20 10:28 am, Felipe Polanco wrote:
> Hi,
> 
> Can squid running in TPROXY mode intercept and decrypt HTTPS payload
> with sslBump?
> 

Maybe. It can do so about as well as NAT intercept mode can.

Wherther TPROXY works depends on what level of access you have to
control the TCP packet routing.

Whether SSL-Bump can decrypt depends on what TLS features are being used
by the HTTPS traffic - and whether it is HTTPS at all.

These things are only loosely related.


Amos


From 3m9n51s2ewut at thismonkey.com  Sat Feb 15 11:42:36 2020
From: 3m9n51s2ewut at thismonkey.com (Scott)
Date: Sat, 15 Feb 2020 22:42:36 +1100
Subject: [squid-users] squid-users Digest, Vol 66, Issue 17
In-Reply-To: <mailman.958.1581750994.3629.squid-users@lists.squid-cache.org>
References: <mailman.958.1581750994.3629.squid-users@lists.squid-cache.org>
Message-ID: <20200215114236.GA92638@thismonkey.com>

> Date: Fri, 14 Feb 2020 11:03:50 -0500
> From: Alex Rousskov <rousskov at measurement-factory.com>
> To: squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] [Feature request] add IP version to logformat
>  format codes
> 
> On 2/14/20 10:36 AM, Scott wrote:
> 
> > I know it's derivable by other means, but it would be nice to have a 
> > logformat format code that provided the client and server IP version numbers.
> 
> > eg: >v for Client IP version (4 or 6) and <v for Server
> 
> 
> Other than client and server, Squid can log a few other IP addresses,
> including:
> 
>     >a      Client source IP address
>     >la     Local IP address the client connected to
>     la      Local listening IP address the client connection was...
>     <a      Server IP address of the last server or peer connection
>     <la     Local IP address of the last server or peer connection
>     icap::<A        ICAP server IP address. Similar to <A.
> 
> 
> If we add support for automated IP version extraction, it should be
> supported as a single new parameter for all existing %codes that log IP
> addresses rather than new %codes (one %code for each of the existing
> %codes that log IP addresses). For example:
> 
>     %>a{version}
> 
> FWIW, personally, I am not sure we should add such a %code option
> because, I presume, the same information can be obtained simply by
> checking the first character of the logged IP address for being '['.
> Said that, I am open to hearing arguments why it should be added.
> 
> 
> Cheers,
> 
> Alex.
> 

Thanks Alex,

bear in mind that normally Squid handles but two connections (c->squid, 
squid->peer/origin), despite the fact that there are normally four addresses 
(client, squid-inside, squid-outside, peer/origin).  If it were agreed to 
support such a logging function, why would one bother having >a{version} and 
>la{version} when both MUST be the same?  Same goes for <a and <la.

That's the whole point of "<" and ">".  These two qualifiers are linked to 
the inside and outside IP versions, not the "l" in ">la" and "<la". That's 
why I suggested a new variable "v" with two sides/directions (>/<).

As to the suggestion that one differentiate IP versions by the signifier '[', 
from my experience "%>a" in logformat does NOT provide surrounding square 
brackets.

The argument I would make (and I do appreciate you hearing it) is that 
programmatically (think grep/awk or pcre filtering) it's much easier to 
determine how much traffic (client/server) is either v4 or v6 is by using a 
fixed field rather than positive/negative lookaheads in the address codes 
(given the lack of []).

Scott


From squid3 at treenet.co.nz  Sat Feb 15 12:50:19 2020
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sun, 16 Feb 2020 01:50:19 +1300
Subject: [squid-users] squid-users Digest, Vol 66, Issue 17
In-Reply-To: <20200215114236.GA92638@thismonkey.com>
References: <mailman.958.1581750994.3629.squid-users@lists.squid-cache.org>
 <20200215114236.GA92638@thismonkey.com>
Message-ID: <499171cc-17b3-bd84-ae00-58c25adda3e3@treenet.co.nz>

On 16/02/20 12:42 am, Scott wrote:
>> Date: Fri, 14 Feb 2020 11:03:50 -0500
>> From: Alex Rousskov
>>
>> On 2/14/20 10:36 AM, Scott wrote:
>>
>>> I know it's derivable by other means, but it would be nice to have a 
>>> logformat format code that provided the client and server IP version numbers.
>>
>>> eg: >v for Client IP version (4 or 6) and <v for Server
>>
>>
>> Other than client and server, Squid can log a few other IP addresses,
>> including:
>>
>>     >a      Client source IP address
>>     >la     Local IP address the client connected to
>>     la      Local listening IP address the client connection was...
>>     <a      Server IP address of the last server or peer connection
>>     <la     Local IP address of the last server or peer connection
>>     icap::<A        ICAP server IP address. Similar to <A.
>>
>>
>> If we add support for automated IP version extraction, it should be
>> supported as a single new parameter for all existing %codes that log IP
>> addresses rather than new %codes (one %code for each of the existing
>> %codes that log IP addresses). For example:
>>
>>     %>a{version}
>>
>> FWIW, personally, I am not sure we should add such a %code option
>> because, I presume, the same information can be obtained simply by
>> checking the first character of the logged IP address for being '['.
>> Said that, I am open to hearing arguments why it should be added.
>>
>>
>> Cheers,
>>
>> Alex.
>>
> 
> Thanks Alex,
> 
> bear in mind that normally Squid handles but two connections (c->squid, 
> squid->peer/origin), despite the fact that there are normally four addresses 
> (client, squid-inside, squid-outside, peer/origin).  If it were agreed to 
> support such a logging function, why would one bother having >a{version} and 
>> la{version} when both MUST be the same?  Same goes for <a and <la.
> 

If you are using an IPv6 enabled Squid on a Hybrid-stack machine you may
notice that it does not have IPv4 listeners at all. Squid talks to IPv4
clients through IPv6 :: or a v4-mapping address.



> That's the whole point of "<" and ">".  These two qualifiers are linked to 
> the inside and outside IP versions, not the "l" in ">la" and "<la". That's 
> why I suggested a new variable "v" with two sides/directions (>/<).
> 
> As to the suggestion that one differentiate IP versions by the signifier '[', 
> from my experience "%>a" in logformat does NOT provide surrounding square 
> brackets.

For Squid %<a / %>a codes the more correct sign is when the IP contains
a ':' it is IPv6 or later.


> 
> The argument I would make (and I do appreciate you hearing it) is that 
> programmatically (think grep/awk or pcre filtering) it's much easier to 
> determine how much traffic (client/server) is either v4 or v6 is by using a 
> fixed field rather than positive/negative lookaheads in the address codes 
> (given the lack of []).

IMO it would be better to implement the long outstanding request for
SNMP counters providing that information. No need to parse the logs then.

Amos


From felipeapolanco at gmail.com  Sat Feb 15 13:58:42 2020
From: felipeapolanco at gmail.com (Felipe Polanco)
Date: Sat, 15 Feb 2020 09:58:42 -0400
Subject: [squid-users] Question regarding TPROXY and sslBump
In-Reply-To: <52557e98-fdeb-0266-c91a-18e203a2d883@treenet.co.nz>
References: <CADcj3=6fyPTOwK-==eeC+Je4kfipHMroi5D84JZ=uctsFKN9qQ@mail.gmail.com>
 <52557e98-fdeb-0266-c91a-18e203a2d883@treenet.co.nz>
Message-ID: <CADcj3=44YdW5DU0je4wwm3HF-smzK9NWU4KnrX_d4AX-k6+vhg@mail.gmail.com>

Thanks for the reply,

Speaking strictly about TPROXY, are there any limitations compared to
regular transparent intercept?

We have full control of the network and TCP routing.

We have done regular https intercept in the past and is working fine, but
now we would like to try TPROXY in bridging mode instead of routing mode.

Thanks,

On Sat, Feb 15, 2020 at 3:17 AM Amos Jeffries <squid3 at treenet.co.nz> wrote:

> On 15/02/20 10:28 am, Felipe Polanco wrote:
> > Hi,
> >
> > Can squid running in TPROXY mode intercept and decrypt HTTPS payload
> > with sslBump?
> >
>
> Maybe. It can do so about as well as NAT intercept mode can.
>
> Wherther TPROXY works depends on what level of access you have to
> control the TCP packet routing.
>
> Whether SSL-Bump can decrypt depends on what TLS features are being used
> by the HTTPS traffic - and whether it is HTTPS at all.
>
> These things are only loosely related.
>
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20200215/58197095/attachment.htm>

From squid3 at treenet.co.nz  Sat Feb 15 15:40:55 2020
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sun, 16 Feb 2020 04:40:55 +1300
Subject: [squid-users] Question regarding TPROXY and sslBump
In-Reply-To: <CADcj3=44YdW5DU0je4wwm3HF-smzK9NWU4KnrX_d4AX-k6+vhg@mail.gmail.com>
References: <CADcj3=6fyPTOwK-==eeC+Je4kfipHMroi5D84JZ=uctsFKN9qQ@mail.gmail.com>
 <52557e98-fdeb-0266-c91a-18e203a2d883@treenet.co.nz>
 <CADcj3=44YdW5DU0je4wwm3HF-smzK9NWU4KnrX_d4AX-k6+vhg@mail.gmail.com>
Message-ID: <04b4ece1-e86c-5465-9edc-820337919ca3@treenet.co.nz>

On 16/02/20 2:58 am, Felipe Polanco wrote:
> Thanks for the reply,
> 
> Speaking strictly about TPROXY, are there any limitations compared to
> regular transparent intercept?

I assume that by "regular transparent intercept" you mean NAT intercept.

The primary difference between TPROXY and NAT ... is that NAT is *not*
"transparent". All the differences derive from that.

To use TPROXY the machine running it must have the ability to spoof IPs
on packets outgoing from Squid and to properly deliver them afterwards.
This primarily affects Squid hosted in cloud services where that
low-level control is not permitted or quite difficult.

The problems NAT introduces by having a different IP address on traffic
arriving at servers largely disappear. But all other issues related to
middleware touching the messages in transit remain the same.

Amos


From rousskov at measurement-factory.com  Sat Feb 15 18:15:58 2020
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Sat, 15 Feb 2020 13:15:58 -0500
Subject: [squid-users] squid-users Digest, Vol 66, Issue 17
In-Reply-To: <20200215114236.GA92638@thismonkey.com>
References: <mailman.958.1581750994.3629.squid-users@lists.squid-cache.org>
 <20200215114236.GA92638@thismonkey.com>
Message-ID: <34423317-31bc-bc86-69d8-54f370dfc757@measurement-factory.com>

On 2/15/20 6:42 AM, Scott wrote:
>> From: Alex Rousskov
>>     >a      Client source IP address
>>     >la     Local IP address the client connected to
>>     la      Local listening IP address the client connection was...
>>     <a      Server IP address of the last server or peer connection
>>     <la     Local IP address of the last server or peer connection
>>     icap::<A        ICAP server IP address. Similar to <A.
>>
>>
>> If we add support for automated IP version extraction, it should be
>> supported as a single new parameter for all existing %codes that log IP
>> addresses rather than new %codes (one %code for each of the existing
>> %codes that log IP addresses). For example:
>>
>>     %>a{version}

> bear in mind that normally Squid handles but two connections (c->squid, 
> squid->peer/origin), despite the fact that there are normally four addresses 
> (client, squid-inside, squid-outside, peer/origin).  If it were agreed to 
> support such a logging function, why would one bother having >a{version} and 
> >la{version} when both MUST be the same?  Same goes for <a and <la.

Sorry, I do not understand the relevance of your rhetorical(?) question
because my suggestion does not require anybody to log duplicate
information: If an admin wants the IP version of the client-to-Squid
connection, they can use either >a{version} or >la{version}, whichever
works best for them.

My point was that Squid can already log more than four IP addresses
(corresponding to more than two connections), and that number can only
go up. If additional version logging support is indeed warranted, then
%address_x{ip_version} is a better interface than %address_x_ip_version
or %connection_y_ip_version because the former needs to be documented
and implemented once, while the latter needs to be documented and
implemented once for every [two] address-logging options.

In other words, the "each connection has two addresses" observation
reduces the current pain of adding new %codes by 50%, but my suggestion
reduces that pain by 83% (and approaching 100% long-term).


> As to the suggestion that one differentiate IP versions by the signifier '[', 
> from my experience "%>a" in logformat does NOT provide surrounding square 
> brackets.

Yes, according to Amos, the admin should be using ':' instead. The
presence of a '.' can be used as well AFAICT. I am sorry for throwing a
bracketing red herring into the debate!


> The argument I would make (and I do appreciate you hearing it) is that 
> programmatically (think grep/awk or pcre filtering) it's much easier to 
> determine how much traffic (client/server) is either v4 or v6 is by using a 
> fixed field rather than positive/negative lookaheads in the address codes 
> (given the lack of []).

For grep/pcre, the complexity of using ':' instead of '6' (or '[.]'
instead of '4') seems about the same to me as far as "ease" of filtering
is concerned. You could argue that records with a fixed version field
can be filtered _faster_, but not "much easier" AFAICT.

Not sure about awk.


Please note that I am _not_ arguing against adding IP version logging
yet, just making sure that we use the right logging interface (and that
the arguments used in the debate are valid). I am not convinced either
way yet.

Convincing others that an already logged information should also be
available for logging in a different format would be difficult but
probably not impossible. After all, Squid does support %code .min_width
formatting option that may delete some of the field information and even
%code options that extract partial information (%>h{field} being one of
the best examples); perhaps "log just the IP version" could be seen as a
similar option.


HTH,

Alex.


From rafaelsilvadaniel at gmail.com  Sat Feb 15 20:08:21 2020
From: rafaelsilvadaniel at gmail.com (Rafael Silva Daniel)
Date: Sat, 15 Feb 2020 14:08:21 -0600 (CST)
Subject: [squid-users] please,
	can someone help me with the negotiate kerberos?
Message-ID: <1581797301595-0.post@n4.nabble.com>

Helo! i think i did almost everything right, firstly i made it in a test
enviroment with debian stretch running squid 3.5 and a windows server 2008
based domain controller, and it worked!

but when i tried to deploy it in the production enviroment running debian
stretch, squid 3.5 and windows server 2012 as the domain controller the
authentication never works, the file /var/log/squid/cache.log shows this:

2020/02/14 15:40:21 kid1| ERROR: Negotiate Authentication validating user.
Result: {result=BH, notes={message: gss_acquire_cred() failed: Unspecified
GSS failure.  Minor code may provide more information. No principal in
keytab matches desired name; }}
negotiate_kerberos_auth.cc(610): pid=13887 :2020/02/14 15:40:22|
negotiate_kerberos_auth: DEBUG: Got 'YR (LETTERS AND NUMBERS)' from squid
(length: 2439).
negotiate_kerberos_auth.cc(663): pid=13887 :2020/02/14 15:40:22|
negotiate_kerberos_auth: DEBUG: Decode '(LETTERS AND NUMBERS)' (decoded
length: 1826).

Obs1:I replaced a big string with letters and numbers by "(LETTERS AND
NUMBERS)"
Obs2: i posted more of the file in this link https://pastebin.com/Z2fe98dB

well, the results of running: kinit -kt /etc/squid/HTTP.keytab
HTTP/squid2.domain.local at DOMAIN.LOCAL:
root at SERVER:~# klist
Ticket cache: FILE:/tmp/krb5cc_0
Default principal: HTTP/squid2.domain.local at DOMAIN.LOCAL

Valid starting       Expires              Service principal
02/15/2020 10:55:32  02/15/2020 20:55:32  krbtgt/DOMAIN.LOCAL at DOMAIN.LOCAL
        renew until 02/16/2020 09:55:32



The results of running:klist -kte /etc/squid/HTTP.keytab

Keytab name: FILE:/etc/squid/HTTP.keytab
KVNO Timestamp           Principal
---- -------------------
------------------------------------------------------
   1 02/12/2020 17:33:15 squid2$@DOMAIN.LOCAL (arcfour-hmac)
   1 02/12/2020 17:33:16 squid2$@DOMAIN.LOCAL (aes128-cts-hmac-sha1-96)
   1 02/12/2020 17:33:16 squid2$@DOMAIN.LOCAL (aes256-cts-hmac-sha1-96)
   1 02/12/2020 17:33:16 SQUID2$@DOMAIN.LOCAL (arcfour-hmac)
   1 02/12/2020 17:33:16 SQUID2$@DOMAIN.LOCAL (aes128-cts-hmac-sha1-96)
   1 02/12/2020 17:33:16 SQUID2$@DOMAIN.LOCAL (aes256-cts-hmac-sha1-96)
   1 02/12/2020 17:33:16 HTTP/squid2.domain.local at DOMAIN.LOCAL
(arcfour-hmac)
   1 02/12/2020 17:33:16 HTTP/squid2.domain.local at DOMAIN.LOCAL
(aes128-cts-hmac-sha1-96)
   1 02/12/2020 17:33:16 HTTP/squid2.domain.local at DOMAIN.LOCAL
(aes256-cts-hmac-sha1-96)
   1 02/12/2020 17:33:16 host/squid2 at DOMAIN.LOCAL (arcfour-hmac)
   1 02/12/2020 17:33:16 host/squid2 at DOMAIN.LOCAL (aes128-cts-hmac-sha1-96)
   1 02/12/2020 17:33:16 host/squid2 at DOMAIN.LOCAL (aes256-cts-hmac-sha1-96)
   3 02/12/2020 17:36:59 squid2$@DOMAIN.LOCAL (arcfour-hmac)
   3 02/12/2020 17:36:59 squid2$@DOMAIN.LOCAL (aes128-cts-hmac-sha1-96)
   3 02/12/2020 17:36:59 squid2$@DOMAIN.LOCAL (aes256-cts-hmac-sha1-96)
   3 02/12/2020 17:36:59 SQUID2$@DOMAIN.LOCAL (arcfour-hmac)
   3 02/12/2020 17:36:59 SQUID2$@DOMAIN.LOCAL (aes128-cts-hmac-sha1-96)
   3 02/12/2020 17:36:59 SQUID2$@DOMAIN.LOCAL (aes256-cts-hmac-sha1-96)
   3 02/12/2020 17:36:59 HTTP/squid2.domain.local at DOMAIN.LOCAL
(arcfour-hmac)
   3 02/12/2020 17:36:59 HTTP/squid2.domain.local at DOMAIN.LOCAL
(aes128-cts-hmac-sha1-96)
   3 02/12/2020 17:36:59 HTTP/squid2.domain.local at DOMAIN.LOCAL
(aes256-cts-hmac-sha1-96)
   3 02/12/2020 17:36:59 host/squid2 at DOMAIN.LOCAL (arcfour-hmac)
   3 02/12/2020 17:36:59 host/squid2 at DOMAIN.LOCAL (aes128-cts-hmac-sha1-96)
   3 02/12/2020 17:36:59 host/squid2 at DOMAIN.LOCAL (aes256-cts-hmac-sha1-96)

And the results of running: root at SERVER:~#
/usr/lib/squid/negotiate_kerberos_auth_test server.domain.local
Token: (Alonglinewithnumbersandletters)

the configs of the /etc/krb5.conf:

[libdefaults]
    default_realm = DOMAIN.LOCAL
    dns_lookup_kdc = no
    dns_lookup_realm = no
    ticket_lifetime = 24h
    default_keytab_name = /etc/squid/HTTP.keytab

    default_tgs_enctypes = aes256-cts-hmac-sha1-96 rc4-hmac des-cbc-crc
des-cbc-md5
    default_tkt_enctypes = aes256-cts-hmac-sha1-96 rc4-hmac des-cbc-crc
des-cbc-md5
    permitted_enctypes = aes256-cts-hmac-sha1-96 rc4-hmac des-cbc-crc
des-cbc-md5

[realms]
    DOMAIN.LOCAL = {
        kdc = dc01.domain.local
        admin_server = dc01.domain.local
        default_domain = domain.local
    }

[domain_realm]
    .domain.local = DOMAIN.LOCAL
    domain.local = DOMAIN.LOCAL

and the /etc/squid/squid.conf:

http_port 3128
dns_nameservers 200.198.5.4 200.198.5.5
visible_hostname PROXY
cache_dir ufs /var/spool/squid 100 16 256
coredump_dir /var/spool/squid

url_rewrite_program /usr/bin/squidGuard

#auth parameter NEGOTIATE
auth_param negotiate program /usr/lib/squid/negotiate_kerberos_auth -d -s
HTTP/squid.domain.local -k /etc/squid/HTTP.keytab
auth_param negotiate children 30
auth_param negotiate keep_alive on

acl Safe_ports port 80 # http
acl Safe_ports port 443 # https
acl Safe_ports port 90 # metodo
acl Safe_ports port 21 # ftp
acl Safe_ports port 443 # https
acl Safe_ports port 70 # gopher
acl Safe_ports port 210 # wais
acl Safe_ports port 1025-65535 # unregistered ports
acl CONNECT method CONNECT
acl auth proxy_auth REQUIRED

http_access deny !Safe_ports
http_access deny CONNECT !Safe_ports
http_access allow localhost manager
http_access deny manager
http_access allow localhost
http_access deny !auth
http_access allow auth



In the domain controller i created in the two zones the proper dns records,
the host with squid can have his ip resolved to its right hostname, and its
hostname resolved to its right ip, in the clients i setted the proxy as
server.domain.local, and in the squid access.log the requests came but are
all denied and a prompt for user and password are showed to the user

Obs: the only data edited while posting was that i replaced our domain by
domain.local, the name of the host by SERVER, and long strings of data in
the cache log  and negotiate kerberos test out, all the rest is what is
really running in the files.

please someone help me, i tried to read everything i could find but i am not
finding how to understand what i am doing wrong, thanks in advance, D:





--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From 3m9n51s2ewut at thismonkey.com  Sun Feb 16 12:59:57 2020
From: 3m9n51s2ewut at thismonkey.com (Scott)
Date: Sun, 16 Feb 2020 23:59:57 +1100
Subject: [squid-users] [Feature request] add IP version to logformat
	format codes
In-Reply-To: <mailman.973.1581797263.3629.squid-users@lists.squid-cache.org>
References: <mailman.973.1581797263.3629.squid-users@lists.squid-cache.org>
Message-ID: <20200216125957.GA31389@thismonkey.com>

> Date: Sun, 16 Feb 2020 01:50:19 +1300
> From: Amos Jeffries <squid3 at treenet.co.nz>
> To: squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] squid-users Digest, Vol 66, Issue 17
> 
> On 16/02/20 12:42 am, Scott wrote:
> >> Date: Fri, 14 Feb 2020 11:03:50 -0500
> >> From: Alex Rousskov
> >>
> >> On 2/14/20 10:36 AM, Scott wrote:
> >>
> >>> I know it's derivable by other means, but it would be nice to have a 
> >>> logformat format code that provided the client and server IP version numbers.
> >>
> >>> eg: >v for Client IP version (4 or 6) and <v for Server
> >>
> >>
> >> Other than client and server, Squid can log a few other IP addresses,
> >> including:
> >>
> >>     >a      Client source IP address
> >>     >la     Local IP address the client connected to
> >>     la      Local listening IP address the client connection was...
> >>     <a      Server IP address of the last server or peer connection
> >>     <la     Local IP address of the last server or peer connection
> >>     icap::<A        ICAP server IP address. Similar to <A.
> >>
> >>
> >> If we add support for automated IP version extraction, it should be
> >> supported as a single new parameter for all existing %codes that log IP
> >> addresses rather than new %codes (one %code for each of the existing
> >> %codes that log IP addresses). For example:
> >>
> >>     %>a{version}
> >>
> >> FWIW, personally, I am not sure we should add such a %code option
> >> because, I presume, the same information can be obtained simply by
> >> checking the first character of the logged IP address for being '['.
> >> Said that, I am open to hearing arguments why it should be added.
> >>
> >>
> >> Cheers,
> >>
> >> Alex.
> >>
> > 
> > Thanks Alex,
> > 
> > bear in mind that normally Squid handles but two connections (c->squid, 
> > squid->peer/origin), despite the fact that there are normally four addresses 
> > (client, squid-inside, squid-outside, peer/origin).  If it were agreed to 
> > support such a logging function, why would one bother having >a{version} and 
> >> la{version} when both MUST be the same?  Same goes for <a and <la.
> > 
> 
> If you are using an IPv6 enabled Squid on a Hybrid-stack machine you may
> notice that it does not have IPv4 listeners at all. Squid talks to IPv4
> clients through IPv6 :: or a v4-mapping address.
> 
> 
> 
> > That's the whole point of "<" and ">".  These two qualifiers are linked to 
> > the inside and outside IP versions, not the "l" in ">la" and "<la". That's 
> > why I suggested a new variable "v" with two sides/directions (>/<).
> > 
> > As to the suggestion that one differentiate IP versions by the signifier '[', 
> > from my experience "%>a" in logformat does NOT provide surrounding square 
> > brackets.
> 
> For Squid %<a / %>a codes the more correct sign is when the IP contains
> a ':' it is IPv6 or later.
> 
> 
> > 
> > The argument I would make (and I do appreciate you hearing it) is that 
> > programmatically (think grep/awk or pcre filtering) it's much easier to 
> > determine how much traffic (client/server) is either v4 or v6 is by using a 
> > fixed field rather than positive/negative lookaheads in the address codes 
> > (given the lack of []).
> 
> IMO it would be better to implement the long outstanding request for
> SNMP counters providing that information. No need to parse the logs then.
> 
> Amos
> 

I don't believe SNMP is the best place for per-connection metrics/telemetry.  
SNMP is better suited to aggregated numerical data.

If I'm already logging proxy connections and gathering per-connection data 
such as IP endpoints, URIs, HTTP methods, etc. then I think it also makes 
sense to log the IP version.  In my case I am very interested in 
client->proxy and proxy->peer/origin sessions and whether they are IPv4 or 6.  
I would lose all context were the protocol version be stored in some SNMP 
gauge.  Also having to 'grep' a field to get the version seems a bit b-grade.

It's just a feature request that I thought some other people would also 
appreciate.  I'll just knock up a patch for myself.

Hey while you're here Amos, did you see a post from me a few days ago 
regarding ssl::server_name matching the Host: header in non-TLS connections?  
I didn't get any response and was wondering if the documentation should 
mention it.

Cheers
Scott

> Date: Sat, 15 Feb 2020 09:58:42 -0400
> From: Felipe Polanco <felipeapolanco at gmail.com>
> To: Amos Jeffries <squid3 at treenet.co.nz>
> CC: Squid Users <squid-users at lists.squid-cache.org>
> Subject: Re: [squid-users] Question regarding TPROXY and sslBump
> 
>    Thanks for the reply,
>    Speaking strictly about TPROXY, are there any limitations compared to
>    regular transparent intercept?
>    We have full control of the network and TCP routing.
>    We have done regular https intercept in the past and is working fine,
>    but now we would like to try TPROXY in bridging mode instead of routing
>    mode.
>    Thanks,
> 
>    On Sat, Feb 15, 2020 at 3:17 AM Amos Jeffries <[1]squid3 at treenet.co.nz>
>    wrote:
> 
>      On 15/02/20 10:28 am, Felipe Polanco wrote:
>      > Hi,
>      >
>      > Can squid running in TPROXY mode intercept and decrypt HTTPS
>      payload
>      > with sslBump?
>      >
>      Maybe. It can do so about as well as NAT intercept mode can.
>      Wherther TPROXY works depends on what level of access you have to
>      control the TCP packet routing.
>      Whether SSL-Bump can decrypt depends on what TLS features are being
>      used
>      by the HTTPS traffic - and whether it is HTTPS at all.
>      These things are only loosely related.
>      Amos
>      _______________________________________________
>      squid-users mailing list
>      [2]squid-users at lists.squid-cache.org
>      [3]http://lists.squid-cache.org/listinfo/squid-users
> 
> References
> 
>    1. mailto:squid3 at treenet.co.nz
>    2. mailto:squid-users at lists.squid-cache.org
>    3. http://lists.squid-cache.org/listinfo/squid-users

> Date: Sun, 16 Feb 2020 04:40:55 +1300
> From: Amos Jeffries <squid3 at treenet.co.nz>
> To: Squid Users <squid-users at lists.squid-cache.org>
> Subject: Re: [squid-users] Question regarding TPROXY and sslBump
> 
> On 16/02/20 2:58 am, Felipe Polanco wrote:
> > Thanks for the reply,
> > 
> > Speaking strictly about TPROXY, are there any limitations compared to
> > regular transparent intercept?
> 
> I assume that by "regular transparent intercept" you mean NAT intercept.
> 
> The primary difference between TPROXY and NAT ... is that NAT is *not*
> "transparent". All the differences derive from that.
> 
> To use TPROXY the machine running it must have the ability to spoof IPs
> on packets outgoing from Squid and to properly deliver them afterwards.
> This primarily affects Squid hosted in cloud services where that
> low-level control is not permitted or quite difficult.
> 
> The problems NAT introduces by having a different IP address on traffic
> arriving at servers largely disappear. But all other issues related to
> middleware touching the messages in transit remain the same.
> 
> Amos
> 

> Date: Sat, 15 Feb 2020 13:15:58 -0500
> From: Alex Rousskov <rousskov at measurement-factory.com>
> To: squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] squid-users Digest, Vol 66, Issue 17
> 
> On 2/15/20 6:42 AM, Scott wrote:
> >> From: Alex Rousskov
> >>     >a      Client source IP address
> >>     >la     Local IP address the client connected to
> >>     la      Local listening IP address the client connection was...
> >>     <a      Server IP address of the last server or peer connection
> >>     <la     Local IP address of the last server or peer connection
> >>     icap::<A        ICAP server IP address. Similar to <A.
> >>
> >>
> >> If we add support for automated IP version extraction, it should be
> >> supported as a single new parameter for all existing %codes that log IP
> >> addresses rather than new %codes (one %code for each of the existing
> >> %codes that log IP addresses). For example:
> >>
> >>     %>a{version}
> 
> > bear in mind that normally Squid handles but two connections (c->squid, 
> > squid->peer/origin), despite the fact that there are normally four addresses 
> > (client, squid-inside, squid-outside, peer/origin).  If it were agreed to 
> > support such a logging function, why would one bother having >a{version} and 
> > >la{version} when both MUST be the same?  Same goes for <a and <la.
> 
> Sorry, I do not understand the relevance of your rhetorical(?) question
> because my suggestion does not require anybody to log duplicate
> information: If an admin wants the IP version of the client-to-Squid
> connection, they can use either >a{version} or >la{version}, whichever
> works best for them.
> 
> My point was that Squid can already log more than four IP addresses
> (corresponding to more than two connections), and that number can only
> go up. If additional version logging support is indeed warranted, then
> %address_x{ip_version} is a better interface than %address_x_ip_version
> or %connection_y_ip_version because the former needs to be documented
> and implemented once, while the latter needs to be documented and
> implemented once for every [two] address-logging options.
> 
> In other words, the "each connection has two addresses" observation
> reduces the current pain of adding new %codes by 50%, but my suggestion
> reduces that pain by 83% (and approaching 100% long-term).
> 
> 
> > As to the suggestion that one differentiate IP versions by the signifier '[', 
> > from my experience "%>a" in logformat does NOT provide surrounding square 
> > brackets.
> 
> Yes, according to Amos, the admin should be using ':' instead. The
> presence of a '.' can be used as well AFAICT. I am sorry for throwing a
> bracketing red herring into the debate!
> 
> 
> > The argument I would make (and I do appreciate you hearing it) is that 
> > programmatically (think grep/awk or pcre filtering) it's much easier to 
> > determine how much traffic (client/server) is either v4 or v6 is by using a 
> > fixed field rather than positive/negative lookaheads in the address codes 
> > (given the lack of []).
> 
> For grep/pcre, the complexity of using ':' instead of '6' (or '[.]'
> instead of '4') seems about the same to me as far as "ease" of filtering
> is concerned. You could argue that records with a fixed version field
> can be filtered _faster_, but not "much easier" AFAICT.
> 
> Not sure about awk.
> 
> 
> Please note that I am _not_ arguing against adding IP version logging
> yet, just making sure that we use the right logging interface (and that
> the arguments used in the debate are valid). I am not convinced either
> way yet.
> 
> Convincing others that an already logged information should also be
> available for logging in a different format would be difficult but
> probably not impossible. After all, Squid does support %code .min_width
> formatting option that may delete some of the field information and even
> %code options that extract partial information (%>h{field} being one of
> the best examples); perhaps "log just the IP version" could be seen as a
> similar option.
> 
> 
> HTH,
> 
> Alex.
> 

> Date: Sat, 15 Feb 2020 14:08:21 -0600
> From: Rafael Silva Daniel <rafaelsilvadaniel at gmail.com>
> To: squid-users at lists.squid-cache.org
> Subject: [squid-users] please, can someone help me with the negotiate
>  kerberos?
> 
> Helo! i think i did almost everything right, firstly i made it in a test
> enviroment with debian stretch running squid 3.5 and a windows server 2008
> based domain controller, and it worked!
> 
> but when i tried to deploy it in the production enviroment running debian
> stretch, squid 3.5 and windows server 2012 as the domain controller the
> authentication never works, the file /var/log/squid/cache.log shows this:
> 
> 2020/02/14 15:40:21 kid1| ERROR: Negotiate Authentication validating user.
> Result: {result=BH, notes={message: gss_acquire_cred() failed: Unspecified
> GSS failure.  Minor code may provide more information. No principal in
> keytab matches desired name; }}
> negotiate_kerberos_auth.cc(610): pid=13887 :2020/02/14 15:40:22|
> negotiate_kerberos_auth: DEBUG: Got 'YR (LETTERS AND NUMBERS)' from squid
> (length: 2439).
> negotiate_kerberos_auth.cc(663): pid=13887 :2020/02/14 15:40:22|
> negotiate_kerberos_auth: DEBUG: Decode '(LETTERS AND NUMBERS)' (decoded
> length: 1826).
> 
> Obs1:I replaced a big string with letters and numbers by "(LETTERS AND
> NUMBERS)"
> Obs2: i posted more of the file in this link https://pastebin.com/Z2fe98dB
> 
> well, the results of running: kinit -kt /etc/squid/HTTP.keytab
> HTTP/squid2.domain.local at DOMAIN.LOCAL:
> root at SERVER:~# klist
> Ticket cache: FILE:/tmp/krb5cc_0
> Default principal: HTTP/squid2.domain.local at DOMAIN.LOCAL
> 
> Valid starting       Expires              Service principal
> 02/15/2020 10:55:32  02/15/2020 20:55:32  krbtgt/DOMAIN.LOCAL at DOMAIN.LOCAL
>         renew until 02/16/2020 09:55:32
> 
> 
> 
> The results of running:klist -kte /etc/squid/HTTP.keytab
> 
> Keytab name: FILE:/etc/squid/HTTP.keytab
> KVNO Timestamp           Principal
> ---- -------------------
> ------------------------------------------------------
>    1 02/12/2020 17:33:15 squid2$@DOMAIN.LOCAL (arcfour-hmac)
>    1 02/12/2020 17:33:16 squid2$@DOMAIN.LOCAL (aes128-cts-hmac-sha1-96)
>    1 02/12/2020 17:33:16 squid2$@DOMAIN.LOCAL (aes256-cts-hmac-sha1-96)
>    1 02/12/2020 17:33:16 SQUID2$@DOMAIN.LOCAL (arcfour-hmac)
>    1 02/12/2020 17:33:16 SQUID2$@DOMAIN.LOCAL (aes128-cts-hmac-sha1-96)
>    1 02/12/2020 17:33:16 SQUID2$@DOMAIN.LOCAL (aes256-cts-hmac-sha1-96)
>    1 02/12/2020 17:33:16 HTTP/squid2.domain.local at DOMAIN.LOCAL
> (arcfour-hmac)
>    1 02/12/2020 17:33:16 HTTP/squid2.domain.local at DOMAIN.LOCAL
> (aes128-cts-hmac-sha1-96)
>    1 02/12/2020 17:33:16 HTTP/squid2.domain.local at DOMAIN.LOCAL
> (aes256-cts-hmac-sha1-96)
>    1 02/12/2020 17:33:16 host/squid2 at DOMAIN.LOCAL (arcfour-hmac)
>    1 02/12/2020 17:33:16 host/squid2 at DOMAIN.LOCAL (aes128-cts-hmac-sha1-96)
>    1 02/12/2020 17:33:16 host/squid2 at DOMAIN.LOCAL (aes256-cts-hmac-sha1-96)
>    3 02/12/2020 17:36:59 squid2$@DOMAIN.LOCAL (arcfour-hmac)
>    3 02/12/2020 17:36:59 squid2$@DOMAIN.LOCAL (aes128-cts-hmac-sha1-96)
>    3 02/12/2020 17:36:59 squid2$@DOMAIN.LOCAL (aes256-cts-hmac-sha1-96)
>    3 02/12/2020 17:36:59 SQUID2$@DOMAIN.LOCAL (arcfour-hmac)
>    3 02/12/2020 17:36:59 SQUID2$@DOMAIN.LOCAL (aes128-cts-hmac-sha1-96)
>    3 02/12/2020 17:36:59 SQUID2$@DOMAIN.LOCAL (aes256-cts-hmac-sha1-96)
>    3 02/12/2020 17:36:59 HTTP/squid2.domain.local at DOMAIN.LOCAL
> (arcfour-hmac)
>    3 02/12/2020 17:36:59 HTTP/squid2.domain.local at DOMAIN.LOCAL
> (aes128-cts-hmac-sha1-96)
>    3 02/12/2020 17:36:59 HTTP/squid2.domain.local at DOMAIN.LOCAL
> (aes256-cts-hmac-sha1-96)
>    3 02/12/2020 17:36:59 host/squid2 at DOMAIN.LOCAL (arcfour-hmac)
>    3 02/12/2020 17:36:59 host/squid2 at DOMAIN.LOCAL (aes128-cts-hmac-sha1-96)
>    3 02/12/2020 17:36:59 host/squid2 at DOMAIN.LOCAL (aes256-cts-hmac-sha1-96)
> 
> And the results of running: root at SERVER:~#
> /usr/lib/squid/negotiate_kerberos_auth_test server.domain.local
> Token: (Alonglinewithnumbersandletters)
> 
> the configs of the /etc/krb5.conf:
> 
> [libdefaults]
>     default_realm = DOMAIN.LOCAL
>     dns_lookup_kdc = no
>     dns_lookup_realm = no
>     ticket_lifetime = 24h
>     default_keytab_name = /etc/squid/HTTP.keytab
> 
>     default_tgs_enctypes = aes256-cts-hmac-sha1-96 rc4-hmac des-cbc-crc
> des-cbc-md5
>     default_tkt_enctypes = aes256-cts-hmac-sha1-96 rc4-hmac des-cbc-crc
> des-cbc-md5
>     permitted_enctypes = aes256-cts-hmac-sha1-96 rc4-hmac des-cbc-crc
> des-cbc-md5
> 
> [realms]
>     DOMAIN.LOCAL = {
>         kdc = dc01.domain.local
>         admin_server = dc01.domain.local
>         default_domain = domain.local
>     }
> 
> [domain_realm]
>     .domain.local = DOMAIN.LOCAL
>     domain.local = DOMAIN.LOCAL
> 
> and the /etc/squid/squid.conf:
> 
> http_port 3128
> dns_nameservers 200.198.5.4 200.198.5.5
> visible_hostname PROXY
> cache_dir ufs /var/spool/squid 100 16 256
> coredump_dir /var/spool/squid
> 
> url_rewrite_program /usr/bin/squidGuard
> 
> #auth parameter NEGOTIATE
> auth_param negotiate program /usr/lib/squid/negotiate_kerberos_auth -d -s
> HTTP/squid.domain.local -k /etc/squid/HTTP.keytab
> auth_param negotiate children 30
> auth_param negotiate keep_alive on
> 
> acl Safe_ports port 80 # http
> acl Safe_ports port 443 # https
> acl Safe_ports port 90 # metodo
> acl Safe_ports port 21 # ftp
> acl Safe_ports port 443 # https
> acl Safe_ports port 70 # gopher
> acl Safe_ports port 210 # wais
> acl Safe_ports port 1025-65535 # unregistered ports
> acl CONNECT method CONNECT
> acl auth proxy_auth REQUIRED
> 
> http_access deny !Safe_ports
> http_access deny CONNECT !Safe_ports
> http_access allow localhost manager
> http_access deny manager
> http_access allow localhost
> http_access deny !auth
> http_access allow auth
> 
> 
> 
> In the domain controller i created in the two zones the proper dns records,
> the host with squid can have his ip resolved to its right hostname, and its
> hostname resolved to its right ip, in the clients i setted the proxy as
> server.domain.local, and in the squid access.log the requests came but are
> all denied and a prompt for user and password are showed to the user
> 
> Obs: the only data edited while posting was that i replaced our domain by
> domain.local, the name of the host by SERVER, and long strings of data in
> the cache log  and negotiate kerberos test out, all the rest is what is
> really running in the files.
> 
> please someone help me, i tried to read everything i could find but i am not
> finding how to understand what i am doing wrong, thanks in advance, D:
> 
> 
> 
> 
> 
> --
> Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html
> 


> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



From psousadp at gmail.com  Sun Feb 16 14:27:02 2020
From: psousadp at gmail.com (=?UTF-8?Q?Patr=C3=ADcia_Sousa?=)
Date: Sun, 16 Feb 2020 14:27:02 +0000
Subject: [squid-users] Squid proxy incoming and outcoming connections?
In-Reply-To: <20200214180240.GA28051@fantomas.sk>
References: <CAJiPhfnAFboGoX7wdWeZWpmA8JJNt=mr-pRnFtba32Xt4FHFeQ@mail.gmail.com>
 <CADcj3=5qJr0yn+69dryYhY2xWBL3y+uxzruTNfz7TWiLHfbrJw@mail.gmail.com>
 <CAJiPhfkf99t=L04BPHomTtSLKJihsLYoDKY4RmMA6ED+seF2DA@mail.gmail.com>
 <20200214094150.GB16768@fantomas.sk>
 <CAJiPhf=+QEswz8WORjR+5OhGVZuNCptwXSb3spAMf3zDF+sjqQ@mail.gmail.com>
 <58a8d08a-d139-454b-a5aa-e74f72c8f788@treenet.co.nz>
 <CAJiPhfnpfSefCprxdxO08eMpDsW67isccPJxSFWRn=3GgPY5Lw@mail.gmail.com>
 <20200214180240.GA28051@fantomas.sk>
Message-ID: <CAJiPhfnd3Rjr7sZuYCRcwp6kqRrs+WSzagBMdQ9gGRx8tb-fYg@mail.gmail.com>

I mean, for example, all the traffic that comes to the port 80. Obviously,
ssh, for example, I can't.

Matus UHLAR - fantomas <uhlar at fantomas.sk> escreveu no dia sexta,
14/02/2020 ?(s) 18:02:

> On 14.02.20 17:40, Patr?cia Sousa wrote:
> >It works now. There was a wrong iptables rule to redirect incoming traffic
> >to the proxy.
>
> incoming traffic? Do people from the world connect to your proxy?
>
>
> --
> Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
> Warning: I wish NOT to receive e-mail advertising to this address.
> Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
> "They say when you play that M$ CD backward you can hear satanic messages."
> "That's nothing. If you play it forward it will install Windows."
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20200216/bc811273/attachment.htm>

From rafaelsilvadaniel at gmail.com  Sun Feb 16 19:16:29 2020
From: rafaelsilvadaniel at gmail.com (Rafael Silva Daniel)
Date: Sun, 16 Feb 2020 13:16:29 -0600 (CST)
Subject: [squid-users] please,
	can someone help me with the negotiate kerberos?
In-Reply-To: <1581797301595-0.post@n4.nabble.com>
References: <1581797301595-0.post@n4.nabble.com>
Message-ID: <1581880589977-0.post@n4.nabble.com>

Hey guys! im still testing it, but i think i found my mistake, so i will let
it here for future reference

i compared the way i arranged things in my test enviroment between the
production enviroment, e noticed some differences in the keytab, i still
dont know if its obligatory, im still testing it, but when i deleted the
keytab, the account for the keytab in ad, the account for the machine in the
active directory, and created another one, i used a different name for HTTP/

like, the way i did that dont worked:

msktutil -c -b "CN=COMPUTERS" -s HTTP/squid2.domain.local -k
/etc/squid/HTTP.keytab --computer-name squid2 --upn HTTP/squid2.domain.local
--server dc01.domain.local --verbose --enctypes 28

the way i did that worked:

msktutil -c -b "CN=COMPUTERS" -s HTTP/squidproxy.domain.local -k
/etc/squid/HTTP.keytab --computer-name squid2 --upn
HTTP/squidproxy.domain.local --server dc01.domain.local --verbose --enctypes
28



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From Ralf.Hildebrandt at charite.de  Mon Feb 17 08:48:36 2020
From: Ralf.Hildebrandt at charite.de (Ralf Hildebrandt)
Date: Mon, 17 Feb 2020 09:48:36 +0100
Subject: [squid-users] Development goals in Squid-6?
Message-ID: <20200217084836.ktgl5e3jejwrjktp@charite.de>

What are the main development goals for Squid-6?
I wonder if I should already start tracking HEAD with at least one
machine.

Ralf Hildebrandt
Charit? - Universit?tsmedizin Berlin
Gesch?ftsbereich IT | Abteilung Netzwerk

Campus Benjamin Franklin (CBF)
Haus I | 1. OG | Raum 105
Hindenburgdamm 30 | D-12203 Berlin

Tel. +49 30 450 570 155
ralf.hildebrandt at charite.de
https://www.charite.de


From belle at bazuin.nl  Mon Feb 17 09:00:19 2020
From: belle at bazuin.nl (=?windows-1252?Q?L.P.H._van_Belle?=)
Date: Mon, 17 Feb 2020 10:00:19 +0100
Subject: [squid-users] please,
 can someone help me with the negotiate kerberos?
In-Reply-To: <1581880589977-0.post@n4.nabble.com>
References: <1581797301595-0.post@n4.nabble.com>
Message-ID: <vmime.5e4a5623.656e.59cc0eee63e82b42@ms249-lin-003.rotterdam.bazuin.nl>

Hai, 

This is the most stable way to run with kerberos, or at least for me. 
* below works for me since with samba 3.x-4.11.x and squid 3.2 upto 4.10

Im running this on Debian Buster now.  ( samba 4.11.6 + squid 4.10 ) 
( all packaged in own repo.) 

1) Setup samba and join the domain. this asumes an auth only setup. 
Install winbind : and setup smb.conf

#Example auth only smb.conf 
[global]
    workgroup = NTDOM_IN_CAPS
    security = ads
    realm = YOUR.REALM.TLD_IN_CAPS

    netbios name = HOSTNAME_IN_CAPS
    preferred master = no
    domain master = no
    host msdfs = no

    interfaces = 192.168.0.1 127.0.0.1
    bind interfaces only = yes
    dns proxy = yes

    #Add and Update TLS Key
	# Consider useing Certificates for samba also, you can re-use them in squid.
    tls enabled = yes
    tls keyfile = /etc/ssl/local/proxy1.key.pem
    tls certfile = /etc/ssl/local/proxy1.cert.pem
    tls cafile = /etc/ssl/certs/ca.pem

    ## map id's outside to domain to tdb files.
    idmap config *:backend = tdb
    idmap config *:range = 2000-9999

    ## map ids from the domain  the range may not overlap !
	# BACKEND RID, assuming no windows use expect proxy/auth.
    idmap config NTDOM : backend = rid
    idmap config NTDOM : range = 10000-3999999

    dedicated keytab file = /etc/krb5.keytab
    kerberos method = secrets and keytab

    # renew the kerberos ticket ! MUSE USE THIS
    winbind refresh tickets = yes

    # Optional use. 
    winbind use default domain = yes

    # enable offline logins
    winbind offline logon = yes
	
    # Added for freeradius support, if needed.
    #ntlm auth = mschapv2-and-ntlmv2-only

    # disable usershares creating, when set empty no error log messages.
    usershare path =

    # Disable printing completely
    load printers = no
    printing = bsd
    printcap name = /dev/null
    disable spoolss = yes

# 

And start winbind

Now create the squid keytab file. 
KRB5_KTNAME=FILE:/root/squid.keytab net ads keytab add HTTP -U Administrator
chown proxy:proxy /root/squid.keytab
chmod 640 /root/squid.keytab

And your done, move the keytab to where you need it. 


Greetz, 

Louis


> -----Oorspronkelijk bericht-----
> Van: squid-users 
> [mailto:squid-users-bounces at lists.squid-cache.org] Namens 
> Rafael Silva Daniel
> Verzonden: zondag 16 februari 2020 20:16
> Aan: squid-users at lists.squid-cache.org
> Onderwerp: Re: [squid-users] please, can someone help me with 
> the negotiate kerberos?
> 
> Hey guys! im still testing it, but i think i found my 
> mistake, so i will let
> it here for future reference
> 
> i compared the way i arranged things in my test enviroment between the
> production enviroment, e noticed some differences in the 
> keytab, i still
> dont know if its obligatory, im still testing it, but when i 
> deleted the
> keytab, the account for the keytab in ad, the account for the 
> machine in the
> active directory, and created another one, i used a different 
> name for HTTP/
> 
> like, the way i did that dont worked:
> 
> msktutil -c -b "CN=COMPUTERS" -s HTTP/squid2.domain.local -k
> /etc/squid/HTTP.keytab --computer-name squid2 --upn 
> HTTP/squid2.domain.local
> --server dc01.domain.local --verbose --enctypes 28
> 
> the way i did that worked:
> 
> msktutil -c -b "CN=COMPUTERS" -s HTTP/squidproxy.domain.local -k
> /etc/squid/HTTP.keytab --computer-name squid2 --upn
> HTTP/squidproxy.domain.local --server dc01.domain.local 
> --verbose --enctypes
> 28
> 
> 
> 
> --
> Sent from: 
> http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users
> -f1019091.html
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 



From squid3 at treenet.co.nz  Mon Feb 17 09:08:28 2020
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Mon, 17 Feb 2020 22:08:28 +1300
Subject: [squid-users] Development goals in Squid-6?
In-Reply-To: <20200217084836.ktgl5e3jejwrjktp@charite.de>
References: <20200217084836.ktgl5e3jejwrjktp@charite.de>
Message-ID: <3d671650-d303-df27-85a7-8800aabd2d3a@treenet.co.nz>

On 17/02/20 9:48 pm, Ralf Hildebrandt wrote:
> What are the main development goals for Squid-6?
> I wonder if I should already start tracking HEAD with at least one
> machine.
> 

We do not have a goal for v6 yet. It is just accumulating code
contributions that do to resolve bugs or otherwise lead to a more stable v5.

Amos


From belle at bazuin.nl  Mon Feb 17 09:18:58 2020
From: belle at bazuin.nl (=?windows-1252?Q?L.P.H._van_Belle?=)
Date: Mon, 17 Feb 2020 10:18:58 +0100
Subject: [squid-users] please,
 can someone help me with the negotiate kerberos?
In-Reply-To: <vmime.5e4a5623.656e.59cc0eee63e82b42@ms249-lin-003.rotterdam.bazuin.nl>
References: <1581880589977-0.post@n4.nabble.com>
Message-ID: <vmime.5e4a5a82.15e1.46c9ed8e730b05a2@ms249-lin-003.rotterdam.bazuin.nl>

Ps., forgot to say, 

After installing winbind and setting up smb.conf

Join the domain offcourse. 
net ads join -U Adminsitrator

or, 
kinit Administrator
net ads join -k yes

In debian, there is not need to change any files except the smb.conf as shown. 
All other defaults, should work out of the box. 


> -----Oorspronkelijk bericht-----
> Van: squid-users 
> [mailto:squid-users-bounces at lists.squid-cache.org] Namens 
> L.P.H. van Belle
> Verzonden: maandag 17 februari 2020 10:00
> Aan: squid-users at lists.squid-cache.org
> Onderwerp: Re: [squid-users] please, can someone help me with 
> the negotiate kerberos?
> 
> Hai, 
> 
> This is the most stable way to run with kerberos, or at least for me. 
> * below works for me since with samba 3.x-4.11.x and squid 
> 3.2 upto 4.10
> 
> Im running this on Debian Buster now.  ( samba 4.11.6 + squid 4.10 ) 
> ( all packaged in own repo.) 
> 
> 1) Setup samba and join the domain. this asumes an auth only setup. 
> Install winbind : and setup smb.conf
> 
> #Example auth only smb.conf 
> [global]
>     workgroup = NTDOM_IN_CAPS
>     security = ads
>     realm = YOUR.REALM.TLD_IN_CAPS
> 
>     netbios name = HOSTNAME_IN_CAPS
>     preferred master = no
>     domain master = no
>     host msdfs = no
> 
>     interfaces = 192.168.0.1 127.0.0.1
>     bind interfaces only = yes
>     dns proxy = yes
> 
>     #Add and Update TLS Key
> 	# Consider useing Certificates for samba also, you can 
> re-use them in squid.
>     tls enabled = yes
>     tls keyfile = /etc/ssl/local/proxy1.key.pem
>     tls certfile = /etc/ssl/local/proxy1.cert.pem
>     tls cafile = /etc/ssl/certs/ca.pem
> 
>     ## map id's outside to domain to tdb files.
>     idmap config *:backend = tdb
>     idmap config *:range = 2000-9999
> 
>     ## map ids from the domain  the range may not overlap !
> 	# BACKEND RID, assuming no windows use expect proxy/auth.
>     idmap config NTDOM : backend = rid
>     idmap config NTDOM : range = 10000-3999999
> 
>     dedicated keytab file = /etc/krb5.keytab
>     kerberos method = secrets and keytab
> 
>     # renew the kerberos ticket ! MUSE USE THIS
>     winbind refresh tickets = yes
> 
>     # Optional use. 
>     winbind use default domain = yes
> 
>     # enable offline logins
>     winbind offline logon = yes
> 	
>     # Added for freeradius support, if needed.
>     #ntlm auth = mschapv2-and-ntlmv2-only
> 
>     # disable usershares creating, when set empty no error 
> log messages.
>     usershare path =
> 
>     # Disable printing completely
>     load printers = no
>     printing = bsd
>     printcap name = /dev/null
>     disable spoolss = yes
> 
> # 
> 
> And start winbind
> 
> Now create the squid keytab file. 
> KRB5_KTNAME=FILE:/root/squid.keytab net ads keytab add HTTP 
> -U Administrator
> chown proxy:proxy /root/squid.keytab
> chmod 640 /root/squid.keytab
> 
> And your done, move the keytab to where you need it. 
> 
> 
> Greetz, 
> 
> Louis
> 
> 
> > -----Oorspronkelijk bericht-----
> > Van: squid-users 
> > [mailto:squid-users-bounces at lists.squid-cache.org] Namens 
> > Rafael Silva Daniel
> > Verzonden: zondag 16 februari 2020 20:16
> > Aan: squid-users at lists.squid-cache.org
> > Onderwerp: Re: [squid-users] please, can someone help me with 
> > the negotiate kerberos?
> > 
> > Hey guys! im still testing it, but i think i found my 
> > mistake, so i will let
> > it here for future reference
> > 
> > i compared the way i arranged things in my test enviroment 
> between the
> > production enviroment, e noticed some differences in the 
> > keytab, i still
> > dont know if its obligatory, im still testing it, but when i 
> > deleted the
> > keytab, the account for the keytab in ad, the account for the 
> > machine in the
> > active directory, and created another one, i used a different 
> > name for HTTP/
> > 
> > like, the way i did that dont worked:
> > 
> > msktutil -c -b "CN=COMPUTERS" -s HTTP/squid2.domain.local -k
> > /etc/squid/HTTP.keytab --computer-name squid2 --upn 
> > HTTP/squid2.domain.local
> > --server dc01.domain.local --verbose --enctypes 28
> > 
> > the way i did that worked:
> > 
> > msktutil -c -b "CN=COMPUTERS" -s HTTP/squidproxy.domain.local -k
> > /etc/squid/HTTP.keytab --computer-name squid2 --upn
> > HTTP/squidproxy.domain.local --server dc01.domain.local 
> > --verbose --enctypes
> > 28
> > 
> > 
> > 
> > --
> > Sent from: 
> > http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users
> > -f1019091.html
> > _______________________________________________
> > squid-users mailing list
> > squid-users at lists.squid-cache.org
> > http://lists.squid-cache.org/listinfo/squid-users
> > 
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 



From AndyBinder at gmx.de  Mon Feb 17 09:23:14 2020
From: AndyBinder at gmx.de (AndyBinder at gmx.de)
Date: Mon, 17 Feb 2020 10:23:14 +0100
Subject: [squid-users] Bump and Splice
Message-ID: <1745571.tdWV9SEqCh@nb-technik01>

Hi, i have a question regarding the ssl-bump feature of squid.
I have set up multiple ports for transparent mode on loopback interface and
one explicit on my real local interface. On the loopback interface the
parameters ssl-bump and intercept are set. On the explicit interface the ssl-
bump parameter is set. The ssl-bump is properly configured in acl.
The problem is that i can only configure bump and splice for both (explicit and
transparent).
I would like to achive different bumping behavior on the ports. For example
bump on regular interface and splice all on loopback (transparent proxy).
The bumping behavior is configured globally and i don't see a possibility to
separate it per port.

Maybe somebody has a hint for me?

Thanks, Andy




From squid3 at treenet.co.nz  Mon Feb 17 09:37:20 2020
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Mon, 17 Feb 2020 22:37:20 +1300
Subject: [squid-users] Bump and Splice
In-Reply-To: <1745571.tdWV9SEqCh@nb-technik01>
References: <1745571.tdWV9SEqCh@nb-technik01>
Message-ID: <ce861d4b-42b7-9b50-cdbd-92938fd9bc45@treenet.co.nz>

On 17/02/20 10:23 pm, AndyBinder wrote:
> Hi, i have a question regarding the ssl-bump feature of squid.
> I have set up multiple ports for transparent mode on loopback interface and
> one explicit on my real local interface. On the loopback interface the
> parameters ssl-bump and intercept are set. On the explicit interface the ssl-
> bump parameter is set. The ssl-bump is properly configured in acl.
> The problem is that i can only configure bump and splice for both (explicit and
> transparent).
> I would like to achive different bumping behavior on the ports. For example
> bump on regular interface and splice all on loopback (transparent proxy).
> The bumping behavior is configured globally and i don't see a possibility to
> separate it per port.
> 
> Maybe somebody has a hint for me?

The myportname ACL type should work in ssl_bump directive. It matches
against the name= parameter of port directives.

Amos


From Ralf.Hildebrandt at charite.de  Mon Feb 17 10:02:47 2020
From: Ralf.Hildebrandt at charite.de (Ralf Hildebrandt)
Date: Mon, 17 Feb 2020 11:02:47 +0100
Subject: [squid-users] [ext] Re:  Development goals in Squid-6?
In-Reply-To: <3d671650-d303-df27-85a7-8800aabd2d3a@treenet.co.nz>
References: <20200217084836.ktgl5e3jejwrjktp@charite.de>
 <3d671650-d303-df27-85a7-8800aabd2d3a@treenet.co.nz>
Message-ID: <20200217100247.6r3uzmchmhx6z222@charite.de>

* Amos Jeffries <squid3 at treenet.co.nz>:
> On 17/02/20 9:48 pm, Ralf Hildebrandt wrote:
> > What are the main development goals for Squid-6?
> > I wonder if I should already start tracking HEAD with at least one
> > machine.
> 
> We do not have a goal for v6 yet. It is just accumulating code
> contributions that do to resolve bugs or otherwise lead to a more stable v5.

Sounds good :) In that case I'll deploy a machine with v6 soon.


Ralf Hildebrandt
Charit? - Universit?tsmedizin Berlin
Gesch?ftsbereich IT | Abteilung Netzwerk

Campus Benjamin Franklin (CBF)
Haus I | 1. OG | Raum 105
Hindenburgdamm 30 | D-12203 Berlin

Tel. +49 30 450 570 155
ralf.hildebrandt at charite.de
https://www.charite.de


From rafael.akchurin at diladele.com  Mon Feb 17 10:06:22 2020
From: rafael.akchurin at diladele.com (Rafael Akchurin)
Date: Mon, 17 Feb 2020 10:06:22 +0000
Subject: [squid-users] please,
 can someone help me with the negotiate kerberos?
In-Reply-To: <1581797301595-0.post@n4.nabble.com>
References: <1581797301595-0.post@n4.nabble.com>
Message-ID: <AM0PR04MB47535825CDDF72187E79179D8F160@AM0PR04MB4753.eurprd04.prod.outlook.com>

Hello Rafael,

There is an easier option *without* joining the Squid machine to the domain,
See tutorial at https://docs.diladele.com/administrator_guide_stable/active_directory/index.html (it also applies to vanilla Squid without our UI - just you would need to do more manual steps).

Raf

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Rafael Silva Daniel
Sent: Saturday, 15 February 2020 21:08
To: squid-users at lists.squid-cache.org
Subject: [squid-users] please, can someone help me with the negotiate kerberos?

Helo! i think i did almost everything right, firstly i made it in a test enviroment with debian stretch running squid 3.5 and a windows server 2008 based domain controller, and it worked!

but when i tried to deploy it in the production enviroment running debian stretch, squid 3.5 and windows server 2012 as the domain controller the authentication never works, the file /var/log/squid/cache.log shows this:

2020/02/14 15:40:21 kid1| ERROR: Negotiate Authentication validating user.
Result: {result=BH, notes={message: gss_acquire_cred() failed: Unspecified GSS failure.  Minor code may provide more information. No principal in keytab matches desired name; }}
negotiate_kerberos_auth.cc(610): pid=13887 :2020/02/14 15:40:22|
negotiate_kerberos_auth: DEBUG: Got 'YR (LETTERS AND NUMBERS)' from squid
(length: 2439).
negotiate_kerberos_auth.cc(663): pid=13887 :2020/02/14 15:40:22|
negotiate_kerberos_auth: DEBUG: Decode '(LETTERS AND NUMBERS)' (decoded
length: 1826).

Obs1:I replaced a big string with letters and numbers by "(LETTERS AND NUMBERS)"
Obs2: i posted more of the file in this link https://pastebin.com/Z2fe98dB

well, the results of running: kinit -kt /etc/squid/HTTP.keytab
HTTP/squid2.domain.local at DOMAIN.LOCAL:
root at SERVER:~# klist
Ticket cache: FILE:/tmp/krb5cc_0
Default principal: HTTP/squid2.domain.local at DOMAIN.LOCAL

Valid starting       Expires              Service principal
02/15/2020 10:55:32  02/15/2020 20:55:32  krbtgt/DOMAIN.LOCAL at DOMAIN.LOCAL
        renew until 02/16/2020 09:55:32



The results of running:klist -kte /etc/squid/HTTP.keytab

Keytab name: FILE:/etc/squid/HTTP.keytab
KVNO Timestamp           Principal
---- -------------------
------------------------------------------------------
   1 02/12/2020 17:33:15 squid2$@DOMAIN.LOCAL (arcfour-hmac)
   1 02/12/2020 17:33:16 squid2$@DOMAIN.LOCAL (aes128-cts-hmac-sha1-96)
   1 02/12/2020 17:33:16 squid2$@DOMAIN.LOCAL (aes256-cts-hmac-sha1-96)
   1 02/12/2020 17:33:16 SQUID2$@DOMAIN.LOCAL (arcfour-hmac)
   1 02/12/2020 17:33:16 SQUID2$@DOMAIN.LOCAL (aes128-cts-hmac-sha1-96)
   1 02/12/2020 17:33:16 SQUID2$@DOMAIN.LOCAL (aes256-cts-hmac-sha1-96)
   1 02/12/2020 17:33:16 HTTP/squid2.domain.local at DOMAIN.LOCAL
(arcfour-hmac)
   1 02/12/2020 17:33:16 HTTP/squid2.domain.local at DOMAIN.LOCAL
(aes128-cts-hmac-sha1-96)
   1 02/12/2020 17:33:16 HTTP/squid2.domain.local at DOMAIN.LOCAL
(aes256-cts-hmac-sha1-96)
   1 02/12/2020 17:33:16 host/squid2 at DOMAIN.LOCAL (arcfour-hmac)
   1 02/12/2020 17:33:16 host/squid2 at DOMAIN.LOCAL (aes128-cts-hmac-sha1-96)
   1 02/12/2020 17:33:16 host/squid2 at DOMAIN.LOCAL (aes256-cts-hmac-sha1-96)
   3 02/12/2020 17:36:59 squid2$@DOMAIN.LOCAL (arcfour-hmac)
   3 02/12/2020 17:36:59 squid2$@DOMAIN.LOCAL (aes128-cts-hmac-sha1-96)
   3 02/12/2020 17:36:59 squid2$@DOMAIN.LOCAL (aes256-cts-hmac-sha1-96)
   3 02/12/2020 17:36:59 SQUID2$@DOMAIN.LOCAL (arcfour-hmac)
   3 02/12/2020 17:36:59 SQUID2$@DOMAIN.LOCAL (aes128-cts-hmac-sha1-96)
   3 02/12/2020 17:36:59 SQUID2$@DOMAIN.LOCAL (aes256-cts-hmac-sha1-96)
   3 02/12/2020 17:36:59 HTTP/squid2.domain.local at DOMAIN.LOCAL
(arcfour-hmac)
   3 02/12/2020 17:36:59 HTTP/squid2.domain.local at DOMAIN.LOCAL
(aes128-cts-hmac-sha1-96)
   3 02/12/2020 17:36:59 HTTP/squid2.domain.local at DOMAIN.LOCAL
(aes256-cts-hmac-sha1-96)
   3 02/12/2020 17:36:59 host/squid2 at DOMAIN.LOCAL (arcfour-hmac)
   3 02/12/2020 17:36:59 host/squid2 at DOMAIN.LOCAL (aes128-cts-hmac-sha1-96)
   3 02/12/2020 17:36:59 host/squid2 at DOMAIN.LOCAL (aes256-cts-hmac-sha1-96)

And the results of running: root at SERVER:~# /usr/lib/squid/negotiate_kerberos_auth_test server.domain.local
Token: (Alonglinewithnumbersandletters)

the configs of the /etc/krb5.conf:

[libdefaults]
    default_realm = DOMAIN.LOCAL
    dns_lookup_kdc = no
    dns_lookup_realm = no
    ticket_lifetime = 24h
    default_keytab_name = /etc/squid/HTTP.keytab

    default_tgs_enctypes = aes256-cts-hmac-sha1-96 rc4-hmac des-cbc-crc
des-cbc-md5
    default_tkt_enctypes = aes256-cts-hmac-sha1-96 rc4-hmac des-cbc-crc
des-cbc-md5
    permitted_enctypes = aes256-cts-hmac-sha1-96 rc4-hmac des-cbc-crc
des-cbc-md5

[realms]
    DOMAIN.LOCAL = {
        kdc = dc01.domain.local
        admin_server = dc01.domain.local
        default_domain = domain.local
    }

[domain_realm]
    .domain.local = DOMAIN.LOCAL
    domain.local = DOMAIN.LOCAL

and the /etc/squid/squid.conf:

http_port 3128
dns_nameservers 200.198.5.4 200.198.5.5
visible_hostname PROXY
cache_dir ufs /var/spool/squid 100 16 256 coredump_dir /var/spool/squid

url_rewrite_program /usr/bin/squidGuard

#auth parameter NEGOTIATE
auth_param negotiate program /usr/lib/squid/negotiate_kerberos_auth -d -s HTTP/squid.domain.local -k /etc/squid/HTTP.keytab auth_param negotiate children 30 auth_param negotiate keep_alive on

acl Safe_ports port 80 # http
acl Safe_ports port 443 # https
acl Safe_ports port 90 # metodo
acl Safe_ports port 21 # ftp
acl Safe_ports port 443 # https
acl Safe_ports port 70 # gopher
acl Safe_ports port 210 # wais
acl Safe_ports port 1025-65535 # unregistered ports acl CONNECT method CONNECT acl auth proxy_auth REQUIRED

http_access deny !Safe_ports
http_access deny CONNECT !Safe_ports
http_access allow localhost manager
http_access deny manager
http_access allow localhost
http_access deny !auth
http_access allow auth



In the domain controller i created in the two zones the proper dns records, the host with squid can have his ip resolved to its right hostname, and its hostname resolved to its right ip, in the clients i setted the proxy as server.domain.local, and in the squid access.log the requests came but are all denied and a prompt for user and password are showed to the user

Obs: the only data edited while posting was that i replaced our domain by domain.local, the name of the host by SERVER, and long strings of data in the cache log  and negotiate kerberos test out, all the rest is what is really running in the files.

please someone help me, i tried to read everything i could find but i am not finding how to understand what i am doing wrong, thanks in advance, D:





--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users

From belle at bazuin.nl  Mon Feb 17 10:22:59 2020
From: belle at bazuin.nl (=?windows-1252?Q?L.P.H._van_Belle?=)
Date: Mon, 17 Feb 2020 11:22:59 +0100
Subject: [squid-users] please,
 can someone help me with the negotiate kerberos?
In-Reply-To: <AM0PR04MB47535825CDDF72187E79179D8F160@AM0PR04MB4753.eurprd04.prod.outlook.com>
References: <1581797301595-0.post@n4.nabble.com>
Message-ID: <vmime.5e4a6983.4515.6f50909512442633@ms249-lin-003.rotterdam.bazuin.nl>

Hai Rafeal, 

Yes, i agree, this is the other most simple way, but i suggest, you remove/change on this page:

https://docs.diladele.com/administrator_guide_stable/active_directory/kerberos/keytab.html 
The generated Kerberos configuration file will usually look like:

[libdefaults]
default_realm = EXAMPLE.LAN
default_tgs_enctypes = rc4-hmac des3-hmac-sha1
default_tkt_enctypes = rc4-hmac des3-hmac-sha1 

These are really outdated. ;-) 


To ( just the default )

[libdefaults]
    default_realm = EXAMPLE.LAN
    dns_lookup_kdc = true
    dns_lookup_realm = false


Keytabs and samba, read: 
https://wiki.samba.org/index.php/Generating_Keytabs

https://wiki.samba.org/index.php/Keytab_Extraction 



Greetz, 

Louis




> -----Oorspronkelijk bericht-----
> Van: squid-users 
> [mailto:squid-users-bounces at lists.squid-cache.org] Namens 
> Rafael Akchurin
> Verzonden: maandag 17 februari 2020 11:06
> Aan: Rafael Silva Daniel; squid-users at lists.squid-cache.org
> Onderwerp: Re: [squid-users] please, can someone help me with 
> the negotiate kerberos?
> 
> Hello Rafael,
> 
> There is an easier option *without* joining the Squid machine 
> to the domain,
> See tutorial at 
> https://docs.diladele.com/administrator_guide_stable/active_di
> rectory/index.html (it also applies to vanilla Squid without 
> our UI - just you would need to do more manual steps).
> 
> Raf
> 
> -----Original Message-----
> From: squid-users <squid-users-bounces at lists.squid-cache.org> 
> On Behalf Of Rafael Silva Daniel
> Sent: Saturday, 15 February 2020 21:08
> To: squid-users at lists.squid-cache.org
> Subject: [squid-users] please, can someone help me with the 
> negotiate kerberos?
> 
> Helo! i think i did almost everything right, firstly i made 
> it in a test enviroment with debian stretch running squid 3.5 
> and a windows server 2008 based domain controller, and it worked!
> 
> but when i tried to deploy it in the production enviroment 
> running debian stretch, squid 3.5 and windows server 2012 as 
> the domain controller the authentication never works, the 
> file /var/log/squid/cache.log shows this:
> 
> 2020/02/14 15:40:21 kid1| ERROR: Negotiate Authentication 
> validating user.
> Result: {result=BH, notes={message: gss_acquire_cred() 
> failed: Unspecified GSS failure.  Minor code may provide more 
> information. No principal in keytab matches desired name; }}
> negotiate_kerberos_auth.cc(610): pid=13887 :2020/02/14 15:40:22|
> negotiate_kerberos_auth: DEBUG: Got 'YR (LETTERS AND 
> NUMBERS)' from squid
> (length: 2439).
> negotiate_kerberos_auth.cc(663): pid=13887 :2020/02/14 15:40:22|
> negotiate_kerberos_auth: DEBUG: Decode '(LETTERS AND 
> NUMBERS)' (decoded
> length: 1826).
> 
> Obs1:I replaced a big string with letters and numbers by 
> "(LETTERS AND NUMBERS)"
> Obs2: i posted more of the file in this link 
> https://pastebin.com/Z2fe98dB
> 
> well, the results of running: kinit -kt /etc/squid/HTTP.keytab
> HTTP/squid2.domain.local at DOMAIN.LOCAL:
> root at SERVER:~# klist
> Ticket cache: FILE:/tmp/krb5cc_0
> Default principal: HTTP/squid2.domain.local at DOMAIN.LOCAL
> 
> Valid starting       Expires              Service principal
> 02/15/2020 10:55:32  02/15/2020 20:55:32  
> krbtgt/DOMAIN.LOCAL at DOMAIN.LOCAL
>         renew until 02/16/2020 09:55:32
> 
> 
> 
> The results of running:klist -kte /etc/squid/HTTP.keytab
> 
> Keytab name: FILE:/etc/squid/HTTP.keytab
> KVNO Timestamp           Principal
> ---- -------------------
> ------------------------------------------------------
>    1 02/12/2020 17:33:15 squid2$@DOMAIN.LOCAL (arcfour-hmac)
>    1 02/12/2020 17:33:16 squid2$@DOMAIN.LOCAL 
> (aes128-cts-hmac-sha1-96)
>    1 02/12/2020 17:33:16 squid2$@DOMAIN.LOCAL 
> (aes256-cts-hmac-sha1-96)
>    1 02/12/2020 17:33:16 SQUID2$@DOMAIN.LOCAL (arcfour-hmac)
>    1 02/12/2020 17:33:16 SQUID2$@DOMAIN.LOCAL 
> (aes128-cts-hmac-sha1-96)
>    1 02/12/2020 17:33:16 SQUID2$@DOMAIN.LOCAL 
> (aes256-cts-hmac-sha1-96)
>    1 02/12/2020 17:33:16 HTTP/squid2.domain.local at DOMAIN.LOCAL
> (arcfour-hmac)
>    1 02/12/2020 17:33:16 HTTP/squid2.domain.local at DOMAIN.LOCAL
> (aes128-cts-hmac-sha1-96)
>    1 02/12/2020 17:33:16 HTTP/squid2.domain.local at DOMAIN.LOCAL
> (aes256-cts-hmac-sha1-96)
>    1 02/12/2020 17:33:16 host/squid2 at DOMAIN.LOCAL (arcfour-hmac)
>    1 02/12/2020 17:33:16 host/squid2 at DOMAIN.LOCAL 
> (aes128-cts-hmac-sha1-96)
>    1 02/12/2020 17:33:16 host/squid2 at DOMAIN.LOCAL 
> (aes256-cts-hmac-sha1-96)
>    3 02/12/2020 17:36:59 squid2$@DOMAIN.LOCAL (arcfour-hmac)
>    3 02/12/2020 17:36:59 squid2$@DOMAIN.LOCAL 
> (aes128-cts-hmac-sha1-96)
>    3 02/12/2020 17:36:59 squid2$@DOMAIN.LOCAL 
> (aes256-cts-hmac-sha1-96)
>    3 02/12/2020 17:36:59 SQUID2$@DOMAIN.LOCAL (arcfour-hmac)
>    3 02/12/2020 17:36:59 SQUID2$@DOMAIN.LOCAL 
> (aes128-cts-hmac-sha1-96)
>    3 02/12/2020 17:36:59 SQUID2$@DOMAIN.LOCAL 
> (aes256-cts-hmac-sha1-96)
>    3 02/12/2020 17:36:59 HTTP/squid2.domain.local at DOMAIN.LOCAL
> (arcfour-hmac)
>    3 02/12/2020 17:36:59 HTTP/squid2.domain.local at DOMAIN.LOCAL
> (aes128-cts-hmac-sha1-96)
>    3 02/12/2020 17:36:59 HTTP/squid2.domain.local at DOMAIN.LOCAL
> (aes256-cts-hmac-sha1-96)
>    3 02/12/2020 17:36:59 host/squid2 at DOMAIN.LOCAL (arcfour-hmac)
>    3 02/12/2020 17:36:59 host/squid2 at DOMAIN.LOCAL 
> (aes128-cts-hmac-sha1-96)
>    3 02/12/2020 17:36:59 host/squid2 at DOMAIN.LOCAL 
> (aes256-cts-hmac-sha1-96)
> 
> And the results of running: root at SERVER:~# 
> /usr/lib/squid/negotiate_kerberos_auth_test server.domain.local
> Token: (Alonglinewithnumbersandletters)
> 
> the configs of the /etc/krb5.conf:
> 
> [libdefaults]
>     default_realm = DOMAIN.LOCAL
>     dns_lookup_kdc = no
>     dns_lookup_realm = no
>     ticket_lifetime = 24h
>     default_keytab_name = /etc/squid/HTTP.keytab
> 
>     default_tgs_enctypes = aes256-cts-hmac-sha1-96 rc4-hmac 
> des-cbc-crc
> des-cbc-md5
>     default_tkt_enctypes = aes256-cts-hmac-sha1-96 rc4-hmac 
> des-cbc-crc
> des-cbc-md5
>     permitted_enctypes = aes256-cts-hmac-sha1-96 rc4-hmac des-cbc-crc
> des-cbc-md5
> 
> [realms]
>     DOMAIN.LOCAL = {
>         kdc = dc01.domain.local
>         admin_server = dc01.domain.local
>         default_domain = domain.local
>     }
> 
> [domain_realm]
>     .domain.local = DOMAIN.LOCAL
>     domain.local = DOMAIN.LOCAL
> 
> and the /etc/squid/squid.conf:
> 
> http_port 3128
> dns_nameservers 200.198.5.4 200.198.5.5
> visible_hostname PROXY
> cache_dir ufs /var/spool/squid 100 16 256 coredump_dir 
> /var/spool/squid
> 
> url_rewrite_program /usr/bin/squidGuard
> 
> #auth parameter NEGOTIATE
> auth_param negotiate program 
> /usr/lib/squid/negotiate_kerberos_auth -d -s 
> HTTP/squid.domain.local -k /etc/squid/HTTP.keytab auth_param 
> negotiate children 30 auth_param negotiate keep_alive on
> 
> acl Safe_ports port 80 # http
> acl Safe_ports port 443 # https
> acl Safe_ports port 90 # metodo
> acl Safe_ports port 21 # ftp
> acl Safe_ports port 443 # https
> acl Safe_ports port 70 # gopher
> acl Safe_ports port 210 # wais
> acl Safe_ports port 1025-65535 # unregistered ports acl 
> CONNECT method CONNECT acl auth proxy_auth REQUIRED
> 
> http_access deny !Safe_ports
> http_access deny CONNECT !Safe_ports
> http_access allow localhost manager
> http_access deny manager
> http_access allow localhost
> http_access deny !auth
> http_access allow auth
> 
> 
> 
> In the domain controller i created in the two zones the 
> proper dns records, the host with squid can have his ip 
> resolved to its right hostname, and its hostname resolved to 
> its right ip, in the clients i setted the proxy as 
> server.domain.local, and in the squid access.log the requests 
> came but are all denied and a prompt for user and password 
> are showed to the user
> 
> Obs: the only data edited while posting was that i replaced 
> our domain by domain.local, the name of the host by SERVER, 
> and long strings of data in the cache log  and negotiate 
> kerberos test out, all the rest is what is really running in 
> the files.
> 
> please someone help me, i tried to read everything i could 
> find but i am not finding how to understand what i am doing 
> wrong, thanks in advance, D:
> 
> 
> 
> 
> 
> --
> Sent from: 
> http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users
> -f1019091.html
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 



From rafael.akchurin at diladele.com  Mon Feb 17 10:48:34 2020
From: rafael.akchurin at diladele.com (Rafael Akchurin)
Date: Mon, 17 Feb 2020 10:48:34 +0000
Subject: [squid-users] please,
 can someone help me with the negotiate kerberos?
In-Reply-To: <vmime.5e4a6983.4515.6f50909512442633@ms249-lin-003.rotterdam.bazuin.nl>
References: <1581797301595-0.post@n4.nabble.com>
 <vmime.5e4a6983.4515.6f50909512442633@ms249-lin-003.rotterdam.bazuin.nl>
Message-ID: <AM0PR04MB475387042C5FBC00DD45DD698F160@AM0PR04MB4753.eurprd04.prod.outlook.com>

Thanks will do!
When you say outdated you means cyphers? Or instructions?

Raf

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of L.P.H. van Belle
Sent: Monday, 17 February 2020 11:23
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] please, can someone help me with the negotiate kerberos?

Hai Rafeal, 

Yes, i agree, this is the other most simple way, but i suggest, you remove/change on this page:

https://docs.diladele.com/administrator_guide_stable/active_directory/kerberos/keytab.html
The generated Kerberos configuration file will usually look like:

[libdefaults]
default_realm = EXAMPLE.LAN
default_tgs_enctypes = rc4-hmac des3-hmac-sha1 default_tkt_enctypes = rc4-hmac des3-hmac-sha1 

These are really outdated. ;-) 


To ( just the default )

[libdefaults]
    default_realm = EXAMPLE.LAN
    dns_lookup_kdc = true
    dns_lookup_realm = false


Keytabs and samba, read: 
https://wiki.samba.org/index.php/Generating_Keytabs

https://wiki.samba.org/index.php/Keytab_Extraction 



Greetz, 

Louis




> -----Oorspronkelijk bericht-----
> Van: squid-users
> [mailto:squid-users-bounces at lists.squid-cache.org] Namens Rafael 
> Akchurin
> Verzonden: maandag 17 februari 2020 11:06
> Aan: Rafael Silva Daniel; squid-users at lists.squid-cache.org
> Onderwerp: Re: [squid-users] please, can someone help me with the 
> negotiate kerberos?
> 
> Hello Rafael,
> 
> There is an easier option *without* joining the Squid machine to the 
> domain, See tutorial at 
> https://docs.diladele.com/administrator_guide_stable/active_di
> rectory/index.html (it also applies to vanilla Squid without our UI - 
> just you would need to do more manual steps).
> 
> Raf
> 
> -----Original Message-----
> From: squid-users <squid-users-bounces at lists.squid-cache.org>
> On Behalf Of Rafael Silva Daniel
> Sent: Saturday, 15 February 2020 21:08
> To: squid-users at lists.squid-cache.org
> Subject: [squid-users] please, can someone help me with the negotiate 
> kerberos?
> 
> Helo! i think i did almost everything right, firstly i made it in a 
> test enviroment with debian stretch running squid 3.5 and a windows 
> server 2008 based domain controller, and it worked!
> 
> but when i tried to deploy it in the production enviroment running 
> debian stretch, squid 3.5 and windows server 2012 as the domain 
> controller the authentication never works, the file 
> /var/log/squid/cache.log shows this:
> 
> 2020/02/14 15:40:21 kid1| ERROR: Negotiate Authentication validating 
> user.
> Result: {result=BH, notes={message: gss_acquire_cred()
> failed: Unspecified GSS failure.  Minor code may provide more 
> information. No principal in keytab matches desired name; }}
> negotiate_kerberos_auth.cc(610): pid=13887 :2020/02/14 15:40:22|
> negotiate_kerberos_auth: DEBUG: Got 'YR (LETTERS AND NUMBERS)' from 
> squid
> (length: 2439).
> negotiate_kerberos_auth.cc(663): pid=13887 :2020/02/14 15:40:22|
> negotiate_kerberos_auth: DEBUG: Decode '(LETTERS AND NUMBERS)' 
> (decoded
> length: 1826).
> 
> Obs1:I replaced a big string with letters and numbers by "(LETTERS AND 
> NUMBERS)"
> Obs2: i posted more of the file in this link 
> https://pastebin.com/Z2fe98dB
> 
> well, the results of running: kinit -kt /etc/squid/HTTP.keytab
> HTTP/squid2.domain.local at DOMAIN.LOCAL:
> root at SERVER:~# klist
> Ticket cache: FILE:/tmp/krb5cc_0
> Default principal: HTTP/squid2.domain.local at DOMAIN.LOCAL
> 
> Valid starting       Expires              Service principal
> 02/15/2020 10:55:32  02/15/2020 20:55:32 
> krbtgt/DOMAIN.LOCAL at DOMAIN.LOCAL
>         renew until 02/16/2020 09:55:32
> 
> 
> 
> The results of running:klist -kte /etc/squid/HTTP.keytab
> 
> Keytab name: FILE:/etc/squid/HTTP.keytab
> KVNO Timestamp           Principal
> ---- -------------------
> ------------------------------------------------------
>    1 02/12/2020 17:33:15 squid2$@DOMAIN.LOCAL (arcfour-hmac)
>    1 02/12/2020 17:33:16 squid2$@DOMAIN.LOCAL
> (aes128-cts-hmac-sha1-96)
>    1 02/12/2020 17:33:16 squid2$@DOMAIN.LOCAL
> (aes256-cts-hmac-sha1-96)
>    1 02/12/2020 17:33:16 SQUID2$@DOMAIN.LOCAL (arcfour-hmac)
>    1 02/12/2020 17:33:16 SQUID2$@DOMAIN.LOCAL
> (aes128-cts-hmac-sha1-96)
>    1 02/12/2020 17:33:16 SQUID2$@DOMAIN.LOCAL
> (aes256-cts-hmac-sha1-96)
>    1 02/12/2020 17:33:16 HTTP/squid2.domain.local at DOMAIN.LOCAL
> (arcfour-hmac)
>    1 02/12/2020 17:33:16 HTTP/squid2.domain.local at DOMAIN.LOCAL
> (aes128-cts-hmac-sha1-96)
>    1 02/12/2020 17:33:16 HTTP/squid2.domain.local at DOMAIN.LOCAL
> (aes256-cts-hmac-sha1-96)
>    1 02/12/2020 17:33:16 host/squid2 at DOMAIN.LOCAL (arcfour-hmac)
>    1 02/12/2020 17:33:16 host/squid2 at DOMAIN.LOCAL
> (aes128-cts-hmac-sha1-96)
>    1 02/12/2020 17:33:16 host/squid2 at DOMAIN.LOCAL
> (aes256-cts-hmac-sha1-96)
>    3 02/12/2020 17:36:59 squid2$@DOMAIN.LOCAL (arcfour-hmac)
>    3 02/12/2020 17:36:59 squid2$@DOMAIN.LOCAL
> (aes128-cts-hmac-sha1-96)
>    3 02/12/2020 17:36:59 squid2$@DOMAIN.LOCAL
> (aes256-cts-hmac-sha1-96)
>    3 02/12/2020 17:36:59 SQUID2$@DOMAIN.LOCAL (arcfour-hmac)
>    3 02/12/2020 17:36:59 SQUID2$@DOMAIN.LOCAL
> (aes128-cts-hmac-sha1-96)
>    3 02/12/2020 17:36:59 SQUID2$@DOMAIN.LOCAL
> (aes256-cts-hmac-sha1-96)
>    3 02/12/2020 17:36:59 HTTP/squid2.domain.local at DOMAIN.LOCAL
> (arcfour-hmac)
>    3 02/12/2020 17:36:59 HTTP/squid2.domain.local at DOMAIN.LOCAL
> (aes128-cts-hmac-sha1-96)
>    3 02/12/2020 17:36:59 HTTP/squid2.domain.local at DOMAIN.LOCAL
> (aes256-cts-hmac-sha1-96)
>    3 02/12/2020 17:36:59 host/squid2 at DOMAIN.LOCAL (arcfour-hmac)
>    3 02/12/2020 17:36:59 host/squid2 at DOMAIN.LOCAL
> (aes128-cts-hmac-sha1-96)
>    3 02/12/2020 17:36:59 host/squid2 at DOMAIN.LOCAL
> (aes256-cts-hmac-sha1-96)
> 
> And the results of running: root at SERVER:~# 
> /usr/lib/squid/negotiate_kerberos_auth_test server.domain.local
> Token: (Alonglinewithnumbersandletters)
> 
> the configs of the /etc/krb5.conf:
> 
> [libdefaults]
>     default_realm = DOMAIN.LOCAL
>     dns_lookup_kdc = no
>     dns_lookup_realm = no
>     ticket_lifetime = 24h
>     default_keytab_name = /etc/squid/HTTP.keytab
> 
>     default_tgs_enctypes = aes256-cts-hmac-sha1-96 rc4-hmac 
> des-cbc-crc
> des-cbc-md5
>     default_tkt_enctypes = aes256-cts-hmac-sha1-96 rc4-hmac 
> des-cbc-crc
> des-cbc-md5
>     permitted_enctypes = aes256-cts-hmac-sha1-96 rc4-hmac des-cbc-crc
> des-cbc-md5
> 
> [realms]
>     DOMAIN.LOCAL = {
>         kdc = dc01.domain.local
>         admin_server = dc01.domain.local
>         default_domain = domain.local
>     }
> 
> [domain_realm]
>     .domain.local = DOMAIN.LOCAL
>     domain.local = DOMAIN.LOCAL
> 
> and the /etc/squid/squid.conf:
> 
> http_port 3128
> dns_nameservers 200.198.5.4 200.198.5.5 visible_hostname PROXY 
> cache_dir ufs /var/spool/squid 100 16 256 coredump_dir 
> /var/spool/squid
> 
> url_rewrite_program /usr/bin/squidGuard
> 
> #auth parameter NEGOTIATE
> auth_param negotiate program
> /usr/lib/squid/negotiate_kerberos_auth -d -s HTTP/squid.domain.local 
> -k /etc/squid/HTTP.keytab auth_param negotiate children 30 auth_param 
> negotiate keep_alive on
> 
> acl Safe_ports port 80 # http
> acl Safe_ports port 443 # https
> acl Safe_ports port 90 # metodo
> acl Safe_ports port 21 # ftp
> acl Safe_ports port 443 # https
> acl Safe_ports port 70 # gopher
> acl Safe_ports port 210 # wais
> acl Safe_ports port 1025-65535 # unregistered ports acl CONNECT method 
> CONNECT acl auth proxy_auth REQUIRED
> 
> http_access deny !Safe_ports
> http_access deny CONNECT !Safe_ports
> http_access allow localhost manager
> http_access deny manager
> http_access allow localhost
> http_access deny !auth
> http_access allow auth
> 
> 
> 
> In the domain controller i created in the two zones the proper dns 
> records, the host with squid can have his ip resolved to its right 
> hostname, and its hostname resolved to its right ip, in the clients i 
> setted the proxy as server.domain.local, and in the squid access.log 
> the requests came but are all denied and a prompt for user and 
> password are showed to the user
> 
> Obs: the only data edited while posting was that i replaced our domain 
> by domain.local, the name of the host by SERVER, and long strings of 
> data in the cache log  and negotiate kerberos test out, all the rest 
> is what is really running in the files.
> 
> please someone help me, i tried to read everything i could find but i 
> am not finding how to understand what i am doing wrong, thanks in 
> advance, D:
> 
> 
> 
> 
> 
> --
> Sent from: 
> http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users
> -f1019091.html
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 

_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users

From rafaelsilvadaniel at gmail.com  Mon Feb 17 13:29:26 2020
From: rafaelsilvadaniel at gmail.com (Rafael Silva Daniel)
Date: Mon, 17 Feb 2020 07:29:26 -0600 (CST)
Subject: [squid-users] please,
	can someone help me with the negotiate kerberos?
In-Reply-To: <vmime.5e4a5623.656e.59cc0eee63e82b42@ms249-lin-003.rotterdam.bazuin.nl>
References: <1581797301595-0.post@n4.nabble.com>
 <1581880589977-0.post@n4.nabble.com>
 <vmime.5e4a5623.656e.59cc0eee63e82b42@ms249-lin-003.rotterdam.bazuin.nl>
Message-ID: <1581946166294-0.post@n4.nabble.com>

ooh, thanks L.P.H.!! this is exactly what i was wanting, a more stable way to
feel secure using this authentication, i will experiment with this today!
thanks a lot for the attention!



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From rafaelsilvadaniel at gmail.com  Mon Feb 17 13:37:05 2020
From: rafaelsilvadaniel at gmail.com (Rafael Silva Daniel)
Date: Mon, 17 Feb 2020 07:37:05 -0600 (CST)
Subject: [squid-users] please,
	can someone help me with the negotiate kerberos?
In-Reply-To: <AM0PR04MB47535825CDDF72187E79179D8F160@AM0PR04MB4753.eurprd04.prod.outlook.com>
References: <1581797301595-0.post@n4.nabble.com>
 <AM0PR04MB47535825CDDF72187E79179D8F160@AM0PR04MB4753.eurprd04.prod.outlook.com>
Message-ID: <1581946625508-0.post@n4.nabble.com>

ooh thanks too Rafael! while i was researching i used your guide as reference
to understand better the mechanics, in part thanks to it i got this far
ahahah very well documented! but some points i feared it would be
distribution specic and felt insecure to try, with your tip i will read more
deeply into it! thanks!

when i get the things settled in the server i will post a conclusion, really
thanks for the attention guys, it will really help me get unstuck with this



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From AndyBinder at gmx.de  Mon Feb 17 14:56:11 2020
From: AndyBinder at gmx.de (AndyBinder at gmx.de)
Date: Mon, 17 Feb 2020 15:56:11 +0100
Subject: [squid-users] Bump and Splice
In-Reply-To: <ce861d4b-42b7-9b50-cdbd-92938fd9bc45@treenet.co.nz>
References: <1745571.tdWV9SEqCh@nb-technik01>
 <ce861d4b-42b7-9b50-cdbd-92938fd9bc45@treenet.co.nz>
Message-ID: <4534580.31r3eYUQgx@nb-technik01>

Am Montag, 17. Februar 2020, 10:37:20 CET schrieb Amos Jeffries:
> On 17/02/20 10:23 pm, AndyBinder wrote:
> > Hi, i have a question regarding the ssl-bump feature of squid.
> > I have set up multiple ports for transparent mode on loopback interface
> > and
> > one explicit on my real local interface. On the loopback interface the
> > parameters ssl-bump and intercept are set. On the explicit interface the
> > ssl- bump parameter is set. The ssl-bump is properly configured in acl.
> > The problem is that i can only configure bump and splice for both
> > (explicit and transparent).
> > I would like to achive different bumping behavior on the ports. For
> > example
> > bump on regular interface and splice all on loopback (transparent proxy).
> > The bumping behavior is configured globally and i don't see a possibility
> > to separate it per port.
> >
> > Maybe somebody has a hint for me?
>
> The myportname ACL type should work in ssl_bump directive. It matches
> against the name= parameter of port directives.
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

Thank You very much for your answer! But i think i am doing something wrong..
In brackets there are the changes i have made.

Sample snippet from my squid.conf:

    http_port 127.0.0.1:3128 name=transparent intercept ssl-bump cert=/var/
squid/ssl/ca.pem dynamic_cert_mem_cache_size=10MB generate-host-certificates=on
    https_port 127.0.0.1:3129 name=transparent intercept ssl-bump cert=/var/
squid/ssl/ca.pem dynamic_cert_mem_cache_size=10MB generate-host-certificates=on

    http_port 192.168.1.1:3128  ssl-bump cert=/var/squid/ssl/ca.pem
dynamic_cert_mem_cache_size=10MB generate-host-certificates=on

    sslcrtd_program /usr/local/libexec/squid/security_file_certgen -s /var/
squid/ssl_crtd -M 4MB
    sslcrtd_children 5

    tls_outgoing_options options=NO_TLSv1 cipher=HIGH:MEDIUM:!RC4:!aNULL:!
eNULL:!LOW:!3DES:!MD5:!EXP:!PSK:!SRP:!DSS

    acl bump_step1 at_step SslBump1
    acl bump_step2 at_step SslBump2
    acl bump_step3 at_step SslBump3
    acl bump_nobumpsites ssl::server_name "/usr/local/etc/squid/
nobumpsites.acl"
--> (acl bump_nobumpport myportname transparent)

    ssl_bump peek bump_step1 all
    ssl_bump peek bump_step2 bump_nobumpsites
--> (ssl_bump peek bump_step2 bump_nobumpport)
    ssl_bump splice bump_step3 bump_nobumpsites
--> (ssl_bump splice bump_step3 bump_nobumpport)
    ssl_bump stare bump_step2
    ssl_bump bump bump_step3

    sslproxy_cert_error deny all
...





From rousskov at measurement-factory.com  Tue Feb 18 18:42:30 2020
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Tue, 18 Feb 2020 13:42:30 -0500
Subject: [squid-users] Bump and Splice
In-Reply-To: <4534580.31r3eYUQgx@nb-technik01>
References: <1745571.tdWV9SEqCh@nb-technik01>
 <ce861d4b-42b7-9b50-cdbd-92938fd9bc45@treenet.co.nz>
 <4534580.31r3eYUQgx@nb-technik01>
Message-ID: <38806b27-9e34-7145-bc90-44c49a31cf74@measurement-factory.com>

On 2/17/20 9:56 AM, AndyBinder at gmx.de wrote:
> i think i am doing something wrong..

What exactly is not working now? You have not disclosed what new problem
you are facing, and Amos has given you the correct answer to your
original question.


> In brackets there are the changes i have made.
> 
> Sample snippet from my squid.conf:
> 
>     http_port 127.0.0.1:3128 name=transparent intercept ssl-bump ..
>     https_port 127.0.0.1:3129 name=transparent intercept ssl-bump ...

I have not checked, but I would not be surprised if some Squid parts
assume (or will assume) that port name is unique. I recommend avoiding
using the same name=value for two *_ports.


>     http_port 192.168.1.1:3128  ssl-bump ...

>     tls_outgoing_options ...

>     acl bump_nobumpsites ssl::server_name ...
> --> (acl bump_nobumpport myportname transparent)
> 
>     ssl_bump peek bump_step1 all
>     ssl_bump peek bump_step2 bump_nobumpsites
> --> (ssl_bump peek bump_step2 bump_nobumpport)
>     ssl_bump splice bump_step3 bump_nobumpsites
> --> (ssl_bump splice bump_step3 bump_nobumpport)
>     ssl_bump stare bump_step2
>     ssl_bump bump bump_step3

>     sslproxy_cert_error deny all

I will reorder/polish your rules slightly for clarity sake:

  ssl_bump peek bump_step1
  ssl_bump peek bump_step2 bump_nobumpsites
  ssl_bump peek bump_step2 bump_nobumpport
  ssl_bump stare bump_step2
  ssl_bump splice bump_step3 bump_nobumpsites
  ssl_bump splice bump_step3 bump_nobumpport
  ssl_bump bump bump_step3

It looks like you are trying to make a splice-or-bump decision at step3.
That is impossible because staring at step2 makes splicing (at step 3)
impossible and, similarly, peeking at step2 makes bumping (at step3)
impossible. Squid skips impossible actions (and provides step2-based
defaults) so your configuration is, essentially:

  # step1
  ssl_bump peek bump_step1

  # step2
  ssl_bump peek bump_step2 bump_nobumpport
  ssl_bump peek bump_step2 bump_nobumpsites
  ssl_bump stare all

  # step3
  ssl_bump splice all
  ssl_bump bump all

In other words, you were trying to make a splice-or-bump decision at
step3, but modern Squid has to (and does) make that decision at step2.


If you are not peeking at step2 for some useful side effect, then you
can simplify further:

  # step1
  ssl_bump peek bump_step1

  # step2
  ssl_bump splice bump_step2 bump_nobumpport
  ssl_bump splice bump_step2 bump_nobumpsites
  ssl_bump stare all

  # step3
  ssl_bump bump all


Please note that since I do not know what you are trying to accomplish
and what does not work, I cannot say why the above simplified
configuration does not do what you want it to do.


HTH,

Alex.


From AndyBinder at gmx.de  Wed Feb 19 12:35:22 2020
From: AndyBinder at gmx.de (AndyBinder at gmx.de)
Date: Wed, 19 Feb 2020 13:35:22 +0100
Subject: [squid-users] Bump and Splice
In-Reply-To: <38806b27-9e34-7145-bc90-44c49a31cf74@measurement-factory.com>
References: <1745571.tdWV9SEqCh@nb-technik01> <4534580.31r3eYUQgx@nb-technik01>
 <38806b27-9e34-7145-bc90-44c49a31cf74@measurement-factory.com>
Message-ID: <4511062.GXAFRqVoOG@nb-technik01>

Am Dienstag, 18. Februar 2020, 19:42:30 CET schrieb Alex Rousskov:
> On 2/17/20 9:56 AM, AndyBinder at gmx.de wrote:
> > i think i am doing something wrong..
>
> What exactly is not working now? You have not disclosed what new problem
> you are facing, and Amos has given you the correct answer to your
> original question.
>
> > In brackets there are the changes i have made.
> >
> > Sample snippet from my squid.conf:
> >     http_port 127.0.0.1:3128 name=transparent intercept ssl-bump ..
> >     https_port 127.0.0.1:3129 name=transparent intercept ssl-bump ...
>
> I have not checked, but I would not be surprised if some Squid parts
> assume (or will assume) that port name is unique. I recommend avoiding
> using the same name=value for two *_ports.
>
> >     http_port 192.168.1.1:3128  ssl-bump ...
> >
> >     tls_outgoing_options ...
> >
> >     acl bump_nobumpsites ssl::server_name ...
> >
> > --> (acl bump_nobumpport myportname transparent)
> >
> >     ssl_bump peek bump_step1 all
> >     ssl_bump peek bump_step2 bump_nobumpsites
> >
> > --> (ssl_bump peek bump_step2 bump_nobumpport)
> >
> >     ssl_bump splice bump_step3 bump_nobumpsites
> >
> > --> (ssl_bump splice bump_step3 bump_nobumpport)
> >
> >     ssl_bump stare bump_step2
> >     ssl_bump bump bump_step3
> >
> >     sslproxy_cert_error deny all
>
> I will reorder/polish your rules slightly for clarity sake:
>
>   ssl_bump peek bump_step1
>   ssl_bump peek bump_step2 bump_nobumpsites
>   ssl_bump peek bump_step2 bump_nobumpport
>   ssl_bump stare bump_step2
>   ssl_bump splice bump_step3 bump_nobumpsites
>   ssl_bump splice bump_step3 bump_nobumpport
>   ssl_bump bump bump_step3
>
> It looks like you are trying to make a splice-or-bump decision at step3.
> That is impossible because staring at step2 makes splicing (at step 3)
> impossible and, similarly, peeking at step2 makes bumping (at step3)
> impossible. Squid skips impossible actions (and provides step2-based
> defaults) so your configuration is, essentially:
>
>   # step1
>   ssl_bump peek bump_step1
>
>   # step2
>   ssl_bump peek bump_step2 bump_nobumpport
>   ssl_bump peek bump_step2 bump_nobumpsites
>   ssl_bump stare all
>
>   # step3
>   ssl_bump splice all
>   ssl_bump bump all
>
> In other words, you were trying to make a splice-or-bump decision at
> step3, but modern Squid has to (and does) make that decision at step2.
>
>
> If you are not peeking at step2 for some useful side effect, then you
> can simplify further:
>
>   # step1
>   ssl_bump peek bump_step1
>
>   # step2
>   ssl_bump splice bump_step2 bump_nobumpport
>   ssl_bump splice bump_step2 bump_nobumpsites
>   ssl_bump stare all
>
>   # step3
>   ssl_bump bump all
>
>
> Please note that since I do not know what you are trying to accomplish
> and what does not work, I cannot say why the above simplified
> configuration does not do what you want it to do.
>
>
> HTH,
>
> Alex.

Thank You both for your answers and explanations!

Okay, i will try to explain my original intention.

Currently i have 2 working bumping configurations (Squid 4.9):

1. Splice everything (working for blacklisting http and https sites without
Bumping)

ssl_bump peek bump_step1 all
ssl_bump splice all
ssl_bump peek bump_step2 all
ssl_bump splice bump_step3 all
ssl_bump bump

2. Bump everything except bump_nobumpsites

ssl_bump peek bump_step1 all
ssl_bump peek bump_step2 bump_nobumpsites
ssl_bump splice bump_step3 bump_nobumpsites
ssl_bump stare bump_step2
ssl_bump bump bump_step3

Now i try to combine both of them into one configuration and want to decide
weather bumping or splicing via the nametag of the port (=acl
bump_nobumpport).

Final wanted situation in words:

Bump everything except bump_nobumpsites and bump_nobumpports, but the SNI must
be visible to match agains blacklisted urls.

@Alex: I tried your configuration examples but the blacklisted urls won't match
on https sites.

Thanks Andy





From 0xff1f at gmail.com  Wed Feb 19 13:47:47 2020
From: 0xff1f at gmail.com (Ahmad Alzaeem)
Date: Wed, 19 Feb 2020 16:47:47 +0300
Subject: [squid-users] Is there an option to completely disable IPV4
 outgoing address for Squid
Message-ID: <5D40BF39-D47D-42FB-A3F5-5BA807A52FFD@gmail.com>

Say we want to have Testing IPV4-IPV6 access for An ISP .
We want to access squid over IPV4 , 
DNS server ip on squid is 8.8.8.8

But we want dns queries only solved with IPV6 address so that squid don?t pickup any ipv4 destination for website .

I tried dns_v4_1st directive to be off but I had like 98 % of results with IPV6 but still like 2 % results as IPV4 .
So as an example , if I say Facebook is IPV4/IPV6 .
I was able to get 98 % destination of FB as IPV6 , but very low results on IPV4 ip addresses .

Is there an option for squid to use IPV6 for outgoing and always skip IPV4 of websites resolving address ?


Thanks 





From rousskov at measurement-factory.com  Wed Feb 19 14:33:55 2020
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Wed, 19 Feb 2020 09:33:55 -0500
Subject: [squid-users] Is there an option to completely disable IPV4
 outgoing address for Squid
In-Reply-To: <5D40BF39-D47D-42FB-A3F5-5BA807A52FFD@gmail.com>
References: <5D40BF39-D47D-42FB-A3F5-5BA807A52FFD@gmail.com>
Message-ID: <38925557-3add-1368-ddd3-7b31641191c6@measurement-factory.com>

On 2/19/20 8:47 AM, Ahmad Alzaeem wrote:

> Is there an option for squid to use IPV6 for outgoing and always skip
> IPV4 of websites resolving address ?

AFAIK, there is no such option. You might be able to fake it by denying
requests on IPv4-destined connections (via Squid ACLs and/or at the OS
level), in hope that requests on those denied connections will be
reforwarded, but I would not recommend this clumsy approach.

However, it is easy to add a DNS forwarder that would immediately
respond to all Squid A queries with an empty set of IPv4 addresses. If
you cannot configure BIND/etc. to do that, then it would only take a few
lines of code to write such a forwarder in Perl/etc. using existing DNS
resolver libraries -- you do not need a generic forwarder; only
something that can handle Squid queries...

What are you going to do with sites that have no IPv6 addresses?

Alex.


From 0xff1f at gmail.com  Wed Feb 19 14:41:17 2020
From: 0xff1f at gmail.com (Ahmad Alzaeem)
Date: Wed, 19 Feb 2020 17:41:17 +0300
Subject: [squid-users] Is there an option to completely disable IPV4
 outgoing address for Squid
In-Reply-To: <38925557-3add-1368-ddd3-7b31641191c6@measurement-factory.com>
References: <5D40BF39-D47D-42FB-A3F5-5BA807A52FFD@gmail.com>
 <38925557-3add-1368-ddd3-7b31641191c6@measurement-factory.com>
Message-ID: <25C4BE55-EDB4-4058-B7BD-1A951DB6E329@gmail.com>

We just need IPV4-IPV6 conversation system to for an ISP that has ran out of ipv4 .
So we need to minimize IPV4 usage with them .


Thanks 


> On Feb 19, 2020, at 5:33 PM, Alex Rousskov <rousskov at measurement-factory.com> wrote:
> 
> On 2/19/20 8:47 AM, Ahmad Alzaeem wrote:
> 
>> Is there an option for squid to use IPV6 for outgoing and always skip
>> IPV4 of websites resolving address ?
> 
> AFAIK, there is no such option. You might be able to fake it by denying
> requests on IPv4-destined connections (via Squid ACLs and/or at the OS
> level), in hope that requests on those denied connections will be
> reforwarded, but I would not recommend this clumsy approach.
> 
> However, it is easy to add a DNS forwarder that would immediately
> respond to all Squid A queries with an empty set of IPv4 addresses. If
> you cannot configure BIND/etc. to do that, then it would only take a few
> lines of code to write such a forwarder in Perl/etc. using existing DNS
> resolver libraries -- you do not need a generic forwarder; only
> something that can handle Squid queries...
> 
> What are you going to do with sites that have no IPv6 addresses?
> 
> Alex.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



From squid3 at treenet.co.nz  Thu Feb 20 04:31:12 2020
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 20 Feb 2020 17:31:12 +1300
Subject: [squid-users] Is there an option to completely disable IPV4
 outgoing address for Squid
In-Reply-To: <25C4BE55-EDB4-4058-B7BD-1A951DB6E329@gmail.com>
References: <5D40BF39-D47D-42FB-A3F5-5BA807A52FFD@gmail.com>
 <38925557-3add-1368-ddd3-7b31641191c6@measurement-factory.com>
 <25C4BE55-EDB4-4058-B7BD-1A951DB6E329@gmail.com>
Message-ID: <953358a3-6df1-feb4-bb7c-42cdef504ceb@treenet.co.nz>

On 20/02/20 3:41 am, Ahmad Alzaeem wrote:
> We just need IPV4-IPV6 conversation system to for an ISP that has ran out of ipv4 .
> So we need to minimize IPV4 usage with them .
> 

Stopping Squid from contacting IPv4 servers will not solve that problem
in any significant way.

On the other hand using Squid in its default dual-stack form with one
single IPv4 address. All clients can get full access to the HTTP web by
having them contact Squid over whichever IP version they support and
Squid does the IPv4 server part.

Amos


From 0xff1f at gmail.com  Thu Feb 20 04:43:28 2020
From: 0xff1f at gmail.com (Ahmad Alzaeem)
Date: Thu, 20 Feb 2020 07:43:28 +0300
Subject: [squid-users] Is there an option to completely disable IPV4
 outgoing address for Squid
In-Reply-To: <953358a3-6df1-feb4-bb7c-42cdef504ceb@treenet.co.nz>
References: <5D40BF39-D47D-42FB-A3F5-5BA807A52FFD@gmail.com>
 <38925557-3add-1368-ddd3-7b31641191c6@measurement-factory.com>
 <25C4BE55-EDB4-4058-B7BD-1A951DB6E329@gmail.com>
 <953358a3-6df1-feb4-bb7c-42cdef504ceb@treenet.co.nz>
Message-ID: <2D51D7BA-2290-499F-B10A-E338A9473678@gmail.com>

Hello Amos ,
You are correct , but are plan is using IPV6 as possible .
As I said the IPV6 of dual stack as like 98 % IPV6 . 

My question is how squid or under which circumstances can go to IPV4 as long as IPV6 dual stack exist ? How come it used 98 % for FB  IPV6 destinations as an example and 2 % FB IPV4 destinations .

Is it random process or DNS answers type ?
 Also Have not found squid directives for this area .


Is there an option to tell squid use AAAA DNS reply from DNS for certain websites always or even with certain squid process  ? And others non Dual stack use default case ?

Many Thanks .

> On Feb 20, 2020, at 7:31 AM, Amos Jeffries <squid3 at treenet.co.nz> wrote:
> 
> On 20/02/20 3:41 am, Ahmad Alzaeem wrote:
>> We just need IPV4-IPV6 conversation system to for an ISP that has ran out of ipv4 .
>> So we need to minimize IPV4 usage with them .
>> 
> 
> Stopping Squid from contacting IPv4 servers will not solve that problem
> in any significant way.
> 
> On the other hand using Squid in its default dual-stack form with one
> single IPv4 address. All clients can get full access to the HTTP web by
> having them contact Squid over whichever IP version they support and
> Squid does the IPv4 server part.
> 
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



From squid3 at treenet.co.nz  Thu Feb 20 10:21:23 2020
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 20 Feb 2020 23:21:23 +1300
Subject: [squid-users] Is there an option to completely disable IPV4
 outgoing address for Squid
In-Reply-To: <2D51D7BA-2290-499F-B10A-E338A9473678@gmail.com>
References: <5D40BF39-D47D-42FB-A3F5-5BA807A52FFD@gmail.com>
 <38925557-3add-1368-ddd3-7b31641191c6@measurement-factory.com>
 <25C4BE55-EDB4-4058-B7BD-1A951DB6E329@gmail.com>
 <953358a3-6df1-feb4-bb7c-42cdef504ceb@treenet.co.nz>
 <2D51D7BA-2290-499F-B10A-E338A9473678@gmail.com>
Message-ID: <589e9b4c-271b-5b32-4daf-b7f335009870@treenet.co.nz>

On 20/02/20 5:43 pm, Ahmad Alzaeem wrote:
> Hello Amos ,
> You are correct , but are plan is using IPV6 as possible .
> As I said the IPV6 of dual stack as like 98 % IPV6 . 
> 
> My question is how squid or under which circumstances can go to IPV4 as long as IPV6 dual stack exist ? How come it used 98 % for FB  IPV6 destinations as an example and 2 % FB IPV4 destinations .
> 


Could be any number of reasons.
 - the IPv6 pipe on your network being full making the IPv4 routes
faster sometimes.
 - other transient routing issues causing connection failures when IPv6
was tried, Squid falling back to IPv4 which worked.
 - DNS resolver failing to supply AAAA fast enough so Squid uses A
result for some connections.

... or a mix of all reasons.


> Is it random process or DNS answers type ?

DNS answers using "Happy Eyeballs" algorithms. With AAAA results
preferred over tried before A results when both are available.


>  Also Have not found squid directives for this area .
> 
> 
> Is there an option to tell squid use AAAA DNS reply from DNS for certain websites always or even with certain squid process  ? And others non Dual stack use default case ?
> 

The BCP specifications require both to be supported with a preference
towards IPv6 whenever possible. That is what Squid does. We only provide
the --disable-ipv6 and dns_v4_first for networks with seriously broken
IPv6 setups, and both already deprecated.


Amos


From squid3 at treenet.co.nz  Thu Feb 20 11:20:37 2020
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 21 Feb 2020 00:20:37 +1300
Subject: [squid-users] Bump and Splice
In-Reply-To: <4511062.GXAFRqVoOG@nb-technik01>
References: <1745571.tdWV9SEqCh@nb-technik01> <4534580.31r3eYUQgx@nb-technik01>
 <38806b27-9e34-7145-bc90-44c49a31cf74@measurement-factory.com>
 <4511062.GXAFRqVoOG@nb-technik01>
Message-ID: <28f2079e-ca64-5476-52d8-4a7eac723ba5@treenet.co.nz>

On 20/02/20 1:35 am, AndyBinder wrote:
> 
> Currently i have 2 working bumping configurations (Squid 4.9):
> 
> 1. Splice everything (working for blacklisting http and https sites without
> Bumping)
> 
> ssl_bump peek bump_step1 all
> ssl_bump splice all

Following lines are unreachable. You can just erase from the config.

PS. Also you do not need the 'all' ACL on that first line.


> ssl_bump peek bump_step2 all
> ssl_bump splice bump_step3 all
> ssl_bump bump
> 
> 2. Bump everything except bump_nobumpsites
> 
> ssl_bump peek bump_step1 all
> ssl_bump peek bump_step2 bump_nobumpsites
> ssl_bump splice bump_step3 bump_nobumpsites
> ssl_bump stare bump_step2
> ssl_bump bump bump_step3
> 
> Now i try to combine both of them into one configuration and want to decide
> weather bumping or splicing via the nametag of the port (=acl
> bump_nobumpport).
> 
> Final wanted situation in words:
> 
> Bump everything except bump_nobumpsites and bump_nobumpports, but the SNI must
> be visible to match agains blacklisted urls.

How important is that word "and" in your policy statement?

The config earlier used an OR condition:

  ssl_bump peek bump_step2 bump_nobumpsites
  ssl_bump peek bump_step2 bump_nobumpport

This would be AND condition:

  ssl_bump peek bump_step2 bump_nobumpport bump_nobumpsites


> 
> @Alex: I tried your configuration examples but the blacklisted urls won't match
> on https sites.

If you are matching *URLs* that is the problem. Only the domain name is
available during ssl_bump checks. The URL only appears after bumping,
and only from http_access onwards.

Amos


From prabu.mohan at outlook.com  Thu Feb 20 23:14:35 2020
From: prabu.mohan at outlook.com (pmohan)
Date: Thu, 20 Feb 2020 17:14:35 -0600 (CST)
Subject: [squid-users] Sibling cache_peer inside docker containers
In-Reply-To: <d34cb012-cc9c-8368-6c3f-4c46fc6bc4cd@treenet.co.nz>
References: <1556236818002-0.post@n4.nabble.com>
 <d34cb012-cc9c-8368-6c3f-4c46fc6bc4cd@treenet.co.nz>
Message-ID: <1582240475552-0.post@n4.nabble.com>

was this issue sorted in the end ?



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From david at articatech.com  Fri Feb 21 12:11:02 2020
From: david at articatech.com (David Touzeau)
Date: Fri, 21 Feb 2020 13:11:02 +0100
Subject: [squid-users] TCP Fast open and squid4
Message-ID: <9122f0e0-fb79-5256-9347-b920c52b6982@articatech.com>

Hi

Is Squid handle TCP Fast open on modern kernel ?

Has anyone tried to implement this directive and noticed a performance 
improvement ?

Best regards.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20200221/159cd8d9/attachment.htm>

From rafaelsilvadaniel at gmail.com  Fri Feb 21 13:30:01 2020
From: rafaelsilvadaniel at gmail.com (Rafael Silva Daniel)
Date: Fri, 21 Feb 2020 07:30:01 -0600 (CST)
Subject: [squid-users] please,
	can someone help me with the negotiate kerberos?
In-Reply-To: <1581797301595-0.post@n4.nabble.com>
References: <1581797301595-0.post@n4.nabble.com>
Message-ID: <1582291801472-0.post@n4.nabble.com>

Just to close the case and concluding, Louis tip worked flawlessly, it
combined well with the settings i already was using and the authentication
is working rock solid and stable, and the documentation Rafael provided
clarificate a lot of the ins and outs of kerberos authentication with squid
so i recomended to everyone who is having difficulties learning how to set
up kerberos authentication with squid to combine the official config example
from squid with their tips and information, you will get it totally covered

Thanks for the help!



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From belle at bazuin.nl  Fri Feb 21 13:40:10 2020
From: belle at bazuin.nl (=?windows-1252?Q?L.P.H._van_Belle?=)
Date: Fri, 21 Feb 2020 14:40:10 +0100
Subject: [squid-users] please,
 can someone help me with the negotiate kerberos?
In-Reply-To: <1582291801472-0.post@n4.nabble.com>
References: <1581797301595-0.post@n4.nabble.com>
Message-ID: <vmime.5e4fddba.3487.5ab34162ae8905a@ms249-lin-003.rotterdam.bazuin.nl>

Yeah, if you know how it is pretty simple ;-) 
And thank for the reply back and nice words.. 

And your welkom..  :-) 


Greetz, 

Louis


> -----Oorspronkelijk bericht-----
> Van: squid-users 
> [mailto:squid-users-bounces at lists.squid-cache.org] Namens 
> Rafael Silva Daniel
> Verzonden: vrijdag 21 februari 2020 14:30
> Aan: squid-users at lists.squid-cache.org
> Onderwerp: Re: [squid-users] please, can someone help me with 
> the negotiate kerberos?
> 
> Just to close the case and concluding, Louis tip worked flawlessly, it
> combined well with the settings i already was using and the 
> authentication
> is working rock solid and stable, and the documentation 
> Rafael provided
> clarificate a lot of the ins and outs of kerberos 
> authentication with squid
> so i recomended to everyone who is having difficulties 
> learning how to set
> up kerberos authentication with squid to combine the official 
> config example
> from squid with their tips and information, you will get it 
> totally covered
> 
> Thanks for the help!
> 
> 
> 
> --
> Sent from: 
> http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users
> -f1019091.html
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 



From uhlar at fantomas.sk  Sun Feb 23 18:04:26 2020
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Sun, 23 Feb 2020 19:04:26 +0100
Subject: [squid-users] Squid proxy incoming and outcoming connections?
In-Reply-To: <CAJiPhfnd3Rjr7sZuYCRcwp6kqRrs+WSzagBMdQ9gGRx8tb-fYg@mail.gmail.com>
References: <CAJiPhfnAFboGoX7wdWeZWpmA8JJNt=mr-pRnFtba32Xt4FHFeQ@mail.gmail.com>
 <CADcj3=5qJr0yn+69dryYhY2xWBL3y+uxzruTNfz7TWiLHfbrJw@mail.gmail.com>
 <CAJiPhfkf99t=L04BPHomTtSLKJihsLYoDKY4RmMA6ED+seF2DA@mail.gmail.com>
 <20200214094150.GB16768@fantomas.sk>
 <CAJiPhf=+QEswz8WORjR+5OhGVZuNCptwXSb3spAMf3zDF+sjqQ@mail.gmail.com>
 <58a8d08a-d139-454b-a5aa-e74f72c8f788@treenet.co.nz>
 <CAJiPhfnpfSefCprxdxO08eMpDsW67isccPJxSFWRn=3GgPY5Lw@mail.gmail.com>
 <20200214180240.GA28051@fantomas.sk>
 <CAJiPhfnd3Rjr7sZuYCRcwp6kqRrs+WSzagBMdQ9gGRx8tb-fYg@mail.gmail.com>
Message-ID: <20200223180426.GB7196@fantomas.sk>

>> On 14.02.20 17:40, Patr?cia Sousa wrote:
>> >It works now. There was a wrong iptables rule to redirect incoming traffic
>> >to the proxy.

>Matus UHLAR - fantomas <uhlar at fantomas.sk> escreveu no dia sexta,
>14/02/2020 ?(s) 18:02:
>> incoming traffic? Do people from the world connect to your proxy?

On 16.02.20 14:27, Patr?cia Sousa wrote:
>I mean, for example, all the traffic that comes to the port 80. Obviously,
>ssh, for example, I can't.

By "incoming traffic" I (and I guess most of people) understand traffic that
comes to your machine, not traffic thatgoes to port 80 somewhere in the
world.

by "outgoing traffic" I (see above) understand traffic that goes out to the
world.

If you call packets coming to your machine (router) with destiny in the
outside world an incoming traffic, then you should learn about stateful
firewalling, that will help you to configure firewalls properly and
avoid confusion and problems you have described.

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Atheism is a non-prophet organization.


From rousskov at measurement-factory.com  Sun Feb 23 22:42:45 2020
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Sun, 23 Feb 2020 17:42:45 -0500
Subject: [squid-users] Is there an option to completely disable IPV4
 outgoing address for Squid
In-Reply-To: <589e9b4c-271b-5b32-4daf-b7f335009870@treenet.co.nz>
References: <5D40BF39-D47D-42FB-A3F5-5BA807A52FFD@gmail.com>
 <38925557-3add-1368-ddd3-7b31641191c6@measurement-factory.com>
 <25C4BE55-EDB4-4058-B7BD-1A951DB6E329@gmail.com>
 <953358a3-6df1-feb4-bb7c-42cdef504ceb@treenet.co.nz>
 <2D51D7BA-2290-499F-B10A-E338A9473678@gmail.com>
 <589e9b4c-271b-5b32-4daf-b7f335009870@treenet.co.nz>
Message-ID: <907c53ac-06ef-2b78-7126-382dd37b504a@measurement-factory.com>

On 2/20/20 5:21 AM, Amos Jeffries wrote:
> On 20/02/20 5:43 pm, Ahmad Alzaeem wrote:
>> My question is how squid or under which circumstances can go to
>> IPV4 as long as IPV6 dual stack exist ? How come it used 98 % for
>> FB  IPV6 destinations as an example and 2 % FB IPV4 destinations .

> Could be any number of reasons.
>  - the IPv6 pipe on your network being full making the IPv4 routes
> faster sometimes.
>  - other transient routing issues causing connection failures when IPv6
> was tried, Squid falling back to IPv4 which worked.
>  - DNS resolver failing to supply AAAA fast enough so Squid uses A
> result for some connections.
> 
> ... or a mix of all reasons.


>> Is it random process or DNS answers type ?

> DNS answers using "Happy Eyeballs" algorithms. With AAAA results
> preferred over tried before A results when both are available.

I do not remember which Squid version the OP is using, but most Happy
Eyeballs-related changes are only available starting with v5. Before v5
commit fd9c47d, Squid was indeed waiting for both A and AAAA answers if
both queries were sent, breaking use cases where one query answer was
badly delayed.

For v5+ users:

In practice, "when both are available" in Amos explanation means "when
both are found in Squid's DNS cache". In all other cases (i.e., none
found or just one family of addresses is found), Happy Eyeballs tries to
establish a TCP connection with the first available IP address (e.g.,
the first one to get resolved), regardless of that address family.

IIRC, if Squid has to send both A and AAAA queries to resolve a domain,
Squid always sends AAAA first, so there is some IPv6 bias in that case,
but there is no artificial delay between the two queries.


HTH,

Alex.


From Walter.H at mathemainzel.info  Mon Feb 24 16:00:36 2020
From: Walter.H at mathemainzel.info (Walter H.)
Date: Mon, 24 Feb 2020 17:00:36 +0100
Subject: [squid-users] several sites - cloudflare not working with ssl-bump
	...
Message-ID: <5E53F324.2000808@mathemainzel.info>

Hello,

can someone explain, why
sites as https://dnslytics.com/
do not work any more if 'server-first',
they only work with 'client-first' why?

Thanks,
Walter

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 3491 bytes
Desc: S/MIME Cryptographic Signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20200224/5d733ab4/attachment.bin>

From squid3 at treenet.co.nz  Tue Feb 25 05:30:25 2020
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 25 Feb 2020 18:30:25 +1300
Subject: [squid-users] several sites - cloudflare not working with
 ssl-bump ...
In-Reply-To: <5E53F324.2000808@mathemainzel.info>
References: <5E53F324.2000808@mathemainzel.info>
Message-ID: <31a74043-1e3b-5c9f-54d6-e26d9a00dad2@treenet.co.nz>

On 25/02/20 5:00 am, Walter H. wrote:
> Hello,
> 
> can someone explain, why
> sites as https://dnslytics.com/
> do not work any more if 'server-first',
> they only work with 'client-first' why?
> 

Not with the lack of information supplied.

Amos


From walter.h at mathemainzel.info  Tue Feb 25 11:22:19 2020
From: walter.h at mathemainzel.info (Walter H.)
Date: Tue, 25 Feb 2020 12:22:19 +0100
Subject: [squid-users] several sites - cloudflare not working with
 ssl-bump ...
Message-ID: <6fb8231bbcfb8db4be0d9fceffb85fa5.1582629739@squirrel.mail>

On Tue, February 25, 2020 06:30, Amos Jeffries wrote:
> On 25/02/20 5:00 am, Walter H. wrote:
>> Hello,
>>
>> can someone explain, why
>> sites as https://dnslytics.com/
>> do not work any more if 'server-first',
>> they only work with 'client-first' why?
>>
>
> Not with the lack of information supplied.
>
> Amos

part of my squid.conf

acl step1 at_step SslBump1
acl step2 at_step SslBump2
acl step3 at_step SslBump3
acl nobumpsites ssl::server_name "/etc/squid/sslnobumpsites-acl.squid"

# this doesn't work, my own Site also only with SNI works
ssl_bump peek step1
ssl_bump splice nobumpsites
ssl_bump stare step2
ssl_bump bump all

# this works
#ssl_bump client-first

# this doesn't work with these sites
#ssl_bump server-first

even WGET shows this:
ERROR: no certificate subject alternative name matches
which means that SNI isn't correctly handled, but why and which part of
the chain is causing this?

this problem is since e.g. dnslytics.com got a new SSL certificate this year

Thanks,
Walter





From felipeapolanco at gmail.com  Tue Feb 25 16:17:28 2020
From: felipeapolanco at gmail.com (Felipe Polanco)
Date: Tue, 25 Feb 2020 12:17:28 -0400
Subject: [squid-users] Missing ICAP header in
	adaptation_masterx_shared_names in RESPMOD only
Message-ID: <CADcj3=7vn_5BnG8rt-VvqAKCH-=PaZD9kg1UAzWnEFsPGHEeVQ@mail.gmail.com>

Hi,

I'm consuming an ICAP service that requires Squid to send the masterx
shared names header in the RESPMOD call.

For an unknown reason, the header is missing if squid is sending RESPMOD
only to the ICAP server.

If I enable REQMOD and RESPMOD then the header is attached.

Is this a bug or intentional?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20200225/ca215799/attachment.htm>

From yurakirychuk at gmail.com  Tue Feb 25 19:49:25 2020
From: yurakirychuk at gmail.com (Yurii)
Date: Tue, 25 Feb 2020 13:49:25 -0600 (CST)
Subject: [squid-users] About intercept https
Message-ID: <1582660165483-0.post@n4.nabble.com>

Hi to all. I need help.
The task is to configure squid in intercept mode to proxy http/https
traffic.

Installed Squid 4.10 (configuration: https://pastebin.com/Gg2VPr0v) Ubuntu
18.04. Redirect traffic from Mikrotik to Ubuntu (ip firewall mangle & ip
route: https://pastebin.com/5UrNcsEc), and there 80, 443 traffic to Squid
3129, 3130 (iptables: https://pastebin.com/kXxy8zHb). 

DNS squid use the same as on client machines. In squid.conf /dns_v4_first
on/. DNS lookup time in access.log: https://pastebin.com/zdwHjRHk

There is a problem - long loading of http/https pages.  In the case of https
- /"Creating a secure connection"/, http - /"Waiting..."/ and so for 5-10
seconds.
Please, tell me what is wrong?

/*Squid.conf* is here -  https://pastebin.com/MX5mNi5q
*Localnet* - 10.3.198.0/24
*Mikrotik* - 10.3.198.254
*Squid* - 10.3.198.224/



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From Antony.Stone at squid.open.source.it  Tue Feb 25 19:57:29 2020
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Tue, 25 Feb 2020 20:57:29 +0100
Subject: [squid-users] About intercept https
In-Reply-To: <1582660165483-0.post@n4.nabble.com>
References: <1582660165483-0.post@n4.nabble.com>
Message-ID: <202002252057.29842.Antony.Stone@squid.open.source.it>

On Tuesday 25 February 2020 at 20:49:25, Yurii wrote:

> Hi to all. I need help.
> The task is to configure squid in intercept mode to proxy http/https
> traffic.

I cannot view any of the pastebin links you provide below.

Please just cut and paste the information into an email reply, so we can read 
it here and then hopefully advise you.

> Installed Squid 4.10 (configuration: https://pastebin.com/Gg2VPr0v) Ubuntu
> 18.04. Redirect traffic from Mikrotik to Ubuntu (ip firewall mangle & ip
> route: https://pastebin.com/5UrNcsEc), and there 80, 443 traffic to Squid
> 3129, 3130 (iptables: https://pastebin.com/kXxy8zHb).
> 
> DNS squid use the same as on client machines. In squid.conf /dns_v4_first
> on/. DNS lookup time in access.log: https://pastebin.com/zdwHjRHk
> 
> There is a problem - long loading of http/https pages.  In the case of
> https - /"Creating a secure connection"/, http - /"Waiting..."/ and so for
> 5-10 seconds.
> Please, tell me what is wrong?
> 
> /*Squid.conf* is here -  https://pastebin.com/MX5mNi5q
> *Localnet* - 10.3.198.0/24
> *Mikrotik* - 10.3.198.254
> *Squid* - 10.3.198.224/

Regards,


Antony.

-- 
Numerous psychological studies over the years have demonstrated that the 
majority of people genuinely believe they are not like the majority of people.

                                                   Please reply to the list;
                                                         please *don't* CC me.


From yurakirychuk at gmail.com  Tue Feb 25 20:23:21 2020
From: yurakirychuk at gmail.com (Yurii)
Date: Tue, 25 Feb 2020 14:23:21 -0600 (CST)
Subject: [squid-users] About intercept https
In-Reply-To: <202002252057.29842.Antony.Stone@squid.open.source.it>
References: <1582660165483-0.post@n4.nabble.com>
 <202002252057.29842.Antony.Stone@squid.open.source.it>
Message-ID: <1582662201459-0.post@n4.nabble.com>

squid configuration:
Squid Cache: Version 4.10
Service Name: squid
 
This binary uses OpenSSL 1.1.1  11 Sep 2018. For legal restrictions on
distribution see https://www.openssl.org/source/license.html
 
configure options:  '--datadir=/usr/share/squid' '--sysconfdir=/etc/squid'
'--libexecdir=/usr/lib/squid' '--mandir=/usr/share/man' '--enable-inline'
'--disable-arch-native' '--disable-ipv6' '--enable-async-io=8'
'--enable-storeio=ufs,aufs,diskd,rock' '--enable-removal-policies=lru,heap'
'--enable-delay-pools' '--enable-cache-digests' '--enable-icap-client'
'--enable-follow-x-forwarded-for'
'--enable-auth-basic=DB,fake,getpwnam,LDAP,NCSA,NIS,PAM,POP3,RADIUS,SASL,SMB'
'--enable-url-rewrite-helpers=fake' '--enable-eui' '--enable-esi'
'--enable-icmp' '--enable-zph-qos' '--enable-ecap' '--enable-ssl'
'--enable-ssl-crtd' '--with-openssl' '--disable-translation'
'--with-swapdir=/var/spool/squid' '--with-logdir=/var/log/squid'
'--with-pidfile=/var/run/squid.pid' '--with-filedescriptors=65536'
'--with-large-files' '--with-default-user=proxy'

ip firewall mangle & route on Mikrotik:
/ip firewall mangle
add chain=prerouting src-address=10.3.198.0/24 dst-port=80 protocol=tcp
action=mark-routing new-routing-mark=to_squid
add chain=prerouting src-address=10.3.198.0/24 dst-port=443 protocol=tcp
action=mark-routing new-routing-mark=to_squid
/ip route
add disabled=no distance=1 dst-address=0.0.0.0/0 gateway=10.3.198.224
routing-mark=to_squid scope=30 target-scope=10

iptables on Ubuntu:
# redirect HTTP to locally installed Squid instance
iptables -t nat -A PREROUTING -i ens160 -p tcp --dport 80 -j REDIRECT
--to-ports 3129
# redirect HTTPS to locally installed Squid instance
iptables -t nat -A PREROUTING -i ens160 -p tcp --dport 443 -j REDIRECT
--to-ports 3130

access.log:
1581426261.762   7924 10.3.198.8 TCP_TUNNEL/200 4602 CONNECT
facebook.com:443 - ORIGINAL_DST/facebook.com - DNS lookup 1  splice
facebook.com
1581426261.762   2598 10.3.198.8 TCP_TUNNEL/200 105429 CONNECT
www.softserveinc.com:443 - ORIGINAL_DST/www.softserveinc.com - DNS lookup - 
splice www.softserveinc.com
1581426262.495   2073 10.3.198.8 NONE/200 0 CONNECT 185.60.216.35:443 -
HIER_NONE/- - DNS lookup -  splice www.facebook.com
1581426264.059   2101 10.3.198.8 NONE/200 0 CONNECT 185.60.216.19:443 -
HIER_NONE/- - DNS lookup -  splice static.xx.fbcdn.net
1581426267.809     22 10.3.198.8 NONE/200 0 CONNECT 104.17.212.204:443 -
HIER_NONE/- - DNS lookup 22  splice js.hs-scripts.com
1581426269.372   2037 10.3.198.8 NONE/200 0 CONNECT 185.60.216.35:443 -
HIER_NONE/- - DNS lookup -  splice www.facebook.com
1581426269.376   2041 10.3.198.8 NONE/200 0 CONNECT 152.199.19.161:443 -
HIER_NONE/- - DNS lookup -  splice cdn-cws-prod.azureedge.net
1581426270.172   2069 10.3.198.8 NONE/200 0 CONNECT 185.60.216.19:443 -
HIER_NONE/- - DNS lookup -  splice connect.facebook.net
1581426270.206   2103 10.3.198.8 NONE/200 0 CONNECT 216.58.215.78:443 -
HIER_NONE/- - DNS lookup -  splice www.google-analytics.com
1581426270.213   2109 10.3.198.8 NONE/200 0 CONNECT 185.63.144.5:443 -
HIER_NONE/- - DNS lookup 1  splice px.ads.linkedin.com
1581426270.219   2116 10.3.198.8 NONE/200 0 CONNECT 216.58.215.98:443 -
HIER_NONE/- - DNS lookup -  splice googleads.g.doubleclick.net
1581426271.763   7703 10.3.198.8 TCP_TUNNEL/200 443 CONNECT
static.xx.fbcdn.net:443 - ORIGINAL_DST/static.xx.fbcdn.net - DNS lookup - 
splice static.xx.fbcdn.net
1581426271.763   2391 10.3.198.8 TCP_TUNNEL/200 3393 CONNECT
www.facebook.com:443 - ORIGINAL_DST/www.facebook.com - DNS lookup -  splice
www.facebook.com
1581426271.763   1544 10.3.198.8 TCP_TUNNEL/200 2891 CONNECT
googleads.g.doubleclick.net:443 - ORIGINAL_DST/googleads.g.doubleclick.net -
DNS lookup 2  splice googleads.g.doubleclick.net
1581426271.764   1551 10.3.198.8 TCP_TUNNEL/200 4093 CONNECT
px.ads.linkedin.com:443 - ORIGINAL_DST/px.ads.linkedin.com - DNS lookup - 
splice px.ads.linkedin.com
1581426271.764   9268 10.3.198.8 TCP_TUNNEL/200 2012 CONNECT
www.facebook.com:443 - ORIGINAL_DST/www.facebook.com - DNS lookup 1  splice
www.facebook.com
1581426271.764   2388 10.3.198.8 TCP_TUNNEL/200 10117 CONNECT
cdn-cws-prod.azureedge.net:443 - ORIGINAL_DST/cdn-cws-prod.azureedge.net -
DNS lookup -  splice cdn-cws-prod.azureedge.net
1581426271.764   3954 10.3.198.8 TCP_TUNNEL/200 1036 CONNECT
js.hs-scripts.com:443 - ORIGINAL_DST/js.hs-scripts.com - DNS lookup 1 
splice js.hs-scripts.com
1581426271.764   1558 10.3.198.8 TCP_TUNNEL/200 1816 CONNECT
www.google-analytics.com:443 - ORIGINAL_DST/www.google-analytics.com - DNS
lookup -  splice www.google-analytics.com
1581426271.764   1592 10.3.198.8 TCP_TUNNEL/200 150372 CONNECT
connect.facebook.net:443 - ORIGINAL_DST/connect.facebook.net - DNS lookup 2 
splice connect.facebook.net

Squid.conf:

acl localnet src 10.3.198.0/24
 
acl SSL_ports port 443
acl Safe_ports port 80          # http
acl Safe_ports port 21          # ftp
acl Safe_ports port 443         # https
acl Safe_ports port 70          # gopher
acl Safe_ports port 210         # wais
acl Safe_ports port 1025-65535  # unregistered ports
acl Safe_ports port 280         # http-mgmt
acl Safe_ports port 488         # gss-http
acl Safe_ports port 591         # filemaker
acl Safe_ports port 777         # multiling http
acl CONNECT method CONNECT
 
acl manager proto cache_object
 
acl whitelist dstdomain "/etc/squid/whitelistssl"
acl blackmails dstdomain "/etc/squid/blackmailssl"
 
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
 
http_access allow whitelist
http_access deny blackmails
 
http_access allow manager localhost
http_access allow localnet
http_access allow localhost
http_access deny all
 
dns_v4_first on
dns_nameservers 10.3.198.254 10.3.102.5 10.3.100.5
 
# debug_options ALL,1 26,2 83,2
 
logfile_rotate 31
 
http_port 10.3.198.224:3128
http_port 10.3.198.224:3129 intercept
https_port 10.3.198.224:3130 intercept ssl-bump \
                                generate-host-certificates=on \
                                dynamic_cert_mem_cache_size=16MB \
                                connection-auth=off
tls-cert=/etc/squid/squidCA.pem
 
acl step1 at_step SslBump1
acl blackmailssl ssl::server_name "/etc/squid/blackmailssl"
 
sslcrtd_program /usr/lib/squid/security_file_certgen -s
/usr/lib/squid/ssl_db -M 8MB
 
ssl_bump peek step1
ssl_bump terminate blackmailssl
ssl_bump splice all
 
cache_dir ufs /var/spool/squid 1024 16 256
maximum_object_size 1 MB
 
coredump_dir /var/spool/squid
 
refresh_pattern ^ftp:           1440    20%     10080
refresh_pattern ^gopher:        1440    0%      1440
refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
refresh_pattern .               0       20%     4320



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From rousskov at measurement-factory.com  Tue Feb 25 21:13:34 2020
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Tue, 25 Feb 2020 16:13:34 -0500
Subject: [squid-users] Missing ICAP header in
 adaptation_masterx_shared_names in RESPMOD only
In-Reply-To: <CADcj3=7vn_5BnG8rt-VvqAKCH-=PaZD9kg1UAzWnEFsPGHEeVQ@mail.gmail.com>
References: <CADcj3=7vn_5BnG8rt-VvqAKCH-=PaZD9kg1UAzWnEFsPGHEeVQ@mail.gmail.com>
Message-ID: <8e9b7757-01fa-ca17-4bf4-0cb78c1abcb3@measurement-factory.com>

On 2/25/20 11:17 AM, Felipe Polanco wrote:

> I'm consuming an ICAP service that requires Squid to send the masterx
> shared names header in the RESPMOD call.

What service or Squid configuration creates that header?


> For an unknown reason, the header is missing if squid is sending RESPMOD
> only to the ICAP server.
> 
> If I enable REQMOD and RESPMOD then the header is attached.

> Is this a bug or intentional?

Difficult to say for sure without more info, but perhaps the REQMOD
service was creating the header, and when you removed that service, the
header was gone, and Squid had nothing to share with the RESPMOD
service? If the removed REQMOD service was not creating that header,
then where did the header come from?


>From http://www.squid-cache.org/Doc/config/adaptation_masterx_shared_names/:

> 	Squid will store and forward the set entry to subsequent adaptation
> 	transactions within the same master transaction scope.

Note the word "subsequent" in the above documentation paragraph. I
suspect that with only one (RESPMOD) service, nothing else may be
creating that header before Squid starts that RESPMOD transaction.


HTH,

Alex.



From prabu.mohan at outlook.com  Tue Feb 25 21:48:45 2020
From: prabu.mohan at outlook.com (pmohan)
Date: Tue, 25 Feb 2020 15:48:45 -0600 (CST)
Subject: [squid-users] Docker squid container setup
Message-ID: <1582667325630-0.post@n4.nabble.com>

hi team, Could anyone guide me with details on how to setup squid ( sibling)
in dockerized containers? I have them running n standalone machine, thinking
to get this do the same with the container.Thanks,Prabu



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From dm at belkam.com  Wed Feb 26 07:42:06 2020
From: dm at belkam.com (Dmitry Melekhov)
Date: Wed, 26 Feb 2020 11:42:06 +0400
Subject: [squid-users] 4.10 crash
Message-ID: <909198d8-a09c-c9f8-49ad-8be4ac506c7a@belkam.com>

Hello!

see this in log, after this squid dies.

2020/02/26 11:17:47 kid1| UPGRADE WARNING: URL rewriter reponded with 
garbage ' 192.168.23.54/ABDRASHITOV-RR.p98a3.belkam.com abdrashitovrr 
CONNECT myip=192.168.22.254 myport=8090'. Future Squid wil
l treat this as part of the URL.
2020/02/26 11:17:48 kid1| assertion failed: MemBuf.cc:354: "new_cap > 
(size_t) capacity"


from systemctl status:


??? 26 11:17:48 inetgw2 squid[1167]: Squid Parent: squid-1 process 11576 
exited due to signal 6 with
??? 26 11:17:48 inetgw2 squid[1167]: Squid Parent: squid-1 process 11576 
will not be restarted for 3
??? 26 11:17:48 inetgw2 squid[1167]: Exiting due to repeated, frequent 
failures

I see this several times, have no idea what? caused this, even if this 
is redirector error, squid should not crash...

Is there any way to fix this?


Thank you!





From dm at belkam.com  Wed Feb 26 07:46:49 2020
From: dm at belkam.com (dm)
Date: Wed, 26 Feb 2020 11:46:49 +0400
Subject: [squid-users] 4.10 crash
In-Reply-To: <909198d8-a09c-c9f8-49ad-8be4ac506c7a@belkam.com>
References: <909198d8-a09c-c9f8-49ad-8be4ac506c7a@belkam.com>
Message-ID: <9097d0be-9321-bef2-bbe9-b7e1fec93de3@belkam.com>

26.02.2020 11:42, Dmitry Melekhov ?????:
> Hello!
>
> see this in log, after this squid dies.
>
> 2020/02/26 11:17:47 kid1| UPGRADE WARNING: URL rewriter reponded with 
> garbage ' 192.168.23.54/ABDRASHITOV-RR.p98a3.belkam.com abdrashitovrr 
> CONNECT myip=192.168.22.254 myport=8090'. Future Squid wil
> l treat this as part of the URL.
> 2020/02/26 11:17:48 kid1| assertion failed: MemBuf.cc:354: "new_cap > 
> (size_t) capacity"
>
>
> from systemctl status:
>
>
> ??? 26 11:17:48 inetgw2 squid[1167]: Squid Parent: squid-1 process 
> 11576 exited due to signal 6 with
> ??? 26 11:17:48 inetgw2 squid[1167]: Squid Parent: squid-1 process 
> 11576 will not be restarted for 3
> ??? 26 11:17:48 inetgw2 squid[1167]: Exiting due to repeated, frequent 
> failures
>
> I see this several times, have no idea what? caused this, even if this 
> is redirector error, squid should not crash...
>
> Is there any way to fix this?
>
>
> Thank you!
>
>
>
btw, looks like here is request, which causes problem - time can be 
different, we hit this several times...


1582701916.487???? 34 192.168.23.54 TCP_MISS/404 723 GET 
http://detectportal.firefox.com/success.txt192.168.23.54/ABDRASHITOV-RR.p98a3.belkam.comabdrashitovrrGETmyip=192.168.22.254myport=8090 
abdrashitovrr HIER_DIRECT/212.188.32.137 application/xml



From squid3 at treenet.co.nz  Wed Feb 26 12:33:35 2020
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 27 Feb 2020 01:33:35 +1300
Subject: [squid-users] 4.10 crash
In-Reply-To: <9097d0be-9321-bef2-bbe9-b7e1fec93de3@belkam.com>
References: <909198d8-a09c-c9f8-49ad-8be4ac506c7a@belkam.com>
 <9097d0be-9321-bef2-bbe9-b7e1fec93de3@belkam.com>
Message-ID: <a3d59e88-232e-08d1-9f01-912f9710cb32@treenet.co.nz>



On 26/02/20 8:46 pm, dm wrote:
> 26.02.2020 11:42, Dmitry Melekhov ?????:
>> Hello!
>>
>> see this in log, after this squid dies.
>>
>> 2020/02/26 11:17:47 kid1| UPGRADE WARNING: URL rewriter reponded with
>> garbage ' 192.168.23.54/ABDRASHITOV-RR.p98a3.belkam.com abdrashitovrr
>> CONNECT myip=192.168.22.254 myport=8090'. Future Squid wil
>> l treat this as part of the URL.

And guess what?

>From your access.log this is the URL:

>
http://detectportal.firefox.com/success.txt192.168.23.54/ABDRASHITOV-RR.p98a3.belkam.comabdrashitovrrGETmyip=192.168.22.254myport=8090


... so the helper is one thing you definitely need to get fixed.


>> 2020/02/26 11:17:48 kid1| assertion failed: MemBuf.cc:354: "new_cap >
>> (size_t) capacity"


This happened up to two seconds after the previous log entry. A great
many transactions may have passed in between the two occurances.


>>
>>
>> from systemctl status:
>>
>>
>> ??? 26 11:17:48 inetgw2 squid[1167]: Squid Parent: squid-1 process
>> 11576 exited due to signal 6 with
>> ??? 26 11:17:48 inetgw2 squid[1167]: Squid Parent: squid-1 process
>> 11576 will not be restarted for 3
>> ??? 26 11:17:48 inetgw2 squid[1167]: Exiting due to repeated, frequent
>> failures
>>
>> I see this several times, have no idea what? caused this, even if this
>> is redirector error, squid should not crash...
>>
>> Is there any way to fix this?
>>

All the info we have now on the assertion is that the capacity value for
a memory buffer is trying to be grown into a negative size range (32-bit
overflow?). We will need a stack trace from assertion/crash to know
which buffer is being expanded and maybe find out why.

Details on how to get a stack traces are documented at
<https://wiki.squid-cache.org/SquidFaq/BugReporting>. That includes from
core files, or from a running proxy without affecting uptime any worse
than the crash already does.


Amos


From squid3 at treenet.co.nz  Wed Feb 26 12:37:17 2020
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 27 Feb 2020 01:37:17 +1300
Subject: [squid-users] Docker squid container setup
In-Reply-To: <1582667325630-0.post@n4.nabble.com>
References: <1582667325630-0.post@n4.nabble.com>
Message-ID: <5d730232-39e2-124f-8b99-3285c76da30e@treenet.co.nz>

On 26/02/20 10:48 am, pmohan wrote:
> hi team, Could anyone guide me with details on how to setup squid ( sibling)
> in dockerized containers? I have them running n standalone machine, thinking
> to get this do the same with the container.Thanks,Prabu
> 

There should not be any difference running a Squid inside a container
than running it outside one.

The details will all be in the Docker settings to allow the proxy access
to machine resources. And yes there are people using Squid inside Docker
containers.

Amos


From rousskov at measurement-factory.com  Wed Feb 26 14:45:38 2020
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Wed, 26 Feb 2020 09:45:38 -0500
Subject: [squid-users] 4.10 crash
In-Reply-To: <909198d8-a09c-c9f8-49ad-8be4ac506c7a@belkam.com>
References: <909198d8-a09c-c9f8-49ad-8be4ac506c7a@belkam.com>
Message-ID: <9519367d-75e8-976e-0a06-a62fc83f8420@measurement-factory.com>

On 2/26/20 2:42 AM, Dmitry Melekhov wrote:
> 2020/02/26 11:17:48 kid1| assertion failed: MemBuf.cc:354: "new_cap >
> (size_t) capacity"

This is most likely a Squid bug. I recommend filing a bug report with
Squid Bugzilla and providing the details that Amos has mentioned in his
response.


Thank you,

Alex.


From ml at netfence.it  Fri Feb 28 13:26:05 2020
From: ml at netfence.it (Andrea Venturoli)
Date: Fri, 28 Feb 2020 14:26:05 +0100
Subject: [squid-users] Squid and DoH
Message-ID: <e5755f7c-927c-05c0-04de-568d7556ef57@netfence.it>

Hello.

In some corporate environment it might be desiderable to have all 
clients use the internal DNS.
This is easily done with firewalls until DNS-over-HTTP comes into play.

How does Squid deals with this?
How to block it?

  bye & Thanks
	av.


From claudiu.vasadi at gmail.com  Fri Feb 28 13:35:00 2020
From: claudiu.vasadi at gmail.com (claudiu vasadi)
Date: Fri, 28 Feb 2020 14:35:00 +0100
Subject: [squid-users] using "acl <name> user_cert CN <cn>"
Message-ID: <CAM-i3ii6N-OcQxPF=7QWmahcJfO_Jxub+ho71xEPFy-VvxN8FA@mail.gmail.com>

Hello list,

I?m currently trying to wrap my head around the concept of using ?acl
name user_cert CN cn? on squid 3.5. What I would like to achieve is a
setup where the client needs to pass a certificate and squid
allows/denies access to the internet based on said certificate CN. So
far I came up empty.

My current config:

acl ssl_authentication user_cert CN user.cn.com
http_access allow all ssl_authentication

http_port 443 ssl-bump  \
  cert=/etc/squid/myCA.pem \
  generate-host-certificates=on dynamic_cert_mem_cache_size=4MB

#this is what generates certs on the fly. Point to the CA you generated above.
sslcrtd_program /usr/lib64/squid/ssl_crtd -s /tmp/squid/ssl_db -M 4MB
sslcrtd_children 5

acl step1 at_step SslBump1
ssl_bump peek step1
ssl_bump bump all
ssl_bump stare all
always_direct allow all


>From the client side I do:

curl -E certificate.pem -k -x http://myproxy:443 https://www.google.de


but I get the access denied page.

Checking cache.log I see:
matches: checking ssl_authentication = 0
clientAccessCheckDone: The request CONNECT www.google.de:443 is
DENIED; last ACL checked: all

So it?s clear the acl doesn?t match.

What am I doing wrong here? How should I adjust the acl?

PS: checking the certificate confirms the CN to be user.cn.com


From squid3 at treenet.co.nz  Sat Feb 29 09:19:48 2020
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 29 Feb 2020 22:19:48 +1300
Subject: [squid-users] Squid and DoH
In-Reply-To: <e5755f7c-927c-05c0-04de-568d7556ef57@netfence.it>
References: <e5755f7c-927c-05c0-04de-568d7556ef57@netfence.it>
Message-ID: <2f5d1e29-1388-ac38-226a-7c06c4678aeb@treenet.co.nz>

On 29/02/20 2:26 am, Andrea Venturoli wrote:
> Hello.
> 
> In some corporate environment it might be desiderable to have all
> clients use the internal DNS.
> This is easily done with firewalls until DNS-over-HTTP comes into play.
> 
> How does Squid deals with this?

DoH is just HTTP messages like any other. Squid handles them the same ways.

> How to block it?

With ACL that identify the relevant messages:

  acl dns-query-url urlpath_regex ^/dns-query\??
  acl dns-req-message req_header Content-Type ^application/dns-message$

  acl doh_request any-of dns-query-url dns-req-message

  acl doh_reply rep_header Content-Type ^application/dns-message$


Amos


From squid3 at treenet.co.nz  Sat Feb 29 09:43:08 2020
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 29 Feb 2020 22:43:08 +1300
Subject: [squid-users] using "acl <name> user_cert CN <cn>"
In-Reply-To: <CAM-i3ii6N-OcQxPF=7QWmahcJfO_Jxub+ho71xEPFy-VvxN8FA@mail.gmail.com>
References: <CAM-i3ii6N-OcQxPF=7QWmahcJfO_Jxub+ho71xEPFy-VvxN8FA@mail.gmail.com>
Message-ID: <0f2072cb-4d12-8172-6e25-714aa4e21e71@treenet.co.nz>

On 29/02/20 2:35 am, claudiu vasadi wrote:
> Hello list,
> 
> I?m currently trying to wrap my head around the concept of using ?acl
> name user_cert CN cn? on squid 3.5. What I would like to achieve is a
> setup where the client needs to pass a certificate and squid
> allows/denies access to the internet based on said certificate CN. So
> far I came up empty.


Well, first you need that part of getting the client to send its
certificate.

http_port ... clientca=/path/to/clients/ca.pem


> 
> My current config:
> 
> acl ssl_authentication user_cert CN user.cn.com
> http_access allow all ssl_authentication
> 

The "all" in that line is completely pointless.


> http_port 443 ssl-bump  \
>   cert=/etc/squid/myCA.pem \
>   generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
> 
> #this is what generates certs on the fly. Point to the CA you generated above.
> sslcrtd_program /usr/lib64/squid/ssl_crtd -s /tmp/squid/ssl_db -M 4MB
> sslcrtd_children 5
> 
> acl step1 at_step SslBump1
> ssl_bump peek step1
> ssl_bump bump all
> ssl_bump stare all
> always_direct allow all
> 

Where are the cache_peer's this always_direct rule is bypassing?

Hint: pointless config again. Remove it.

> 
> From the client side I do:
> 
> curl -E certificate.pem -k -x http://myproxy:443 https://www.google.de
> 
> 
> but I get the access denied page.
> 
> Checking cache.log I see:
> matches: checking ssl_authentication = 0
> clientAccessCheckDone: The request CONNECT www.google.de:443 is
> DENIED; last ACL checked: all
> 
> So it?s clear the acl doesn?t match.

Indeed. TLS has not started yet. Not even the handshake parts.

Your config says that HTTP messages (lacking client TLS certs) are to be
denied. That means everything arriving in an http_port.


Amos


From uhlar at fantomas.sk  Sat Feb 29 13:17:53 2020
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Sat, 29 Feb 2020 14:17:53 +0100
Subject: [squid-users] Squid and DoH
In-Reply-To: <2f5d1e29-1388-ac38-226a-7c06c4678aeb@treenet.co.nz>
References: <e5755f7c-927c-05c0-04de-568d7556ef57@netfence.it>
 <2f5d1e29-1388-ac38-226a-7c06c4678aeb@treenet.co.nz>
Message-ID: <20200229131753.GC15379@fantomas.sk>

>On 29/02/20 2:26 am, Andrea Venturoli wrote:
>> In some corporate environment it might be desiderable to have all
>> clients use the internal DNS.
>> This is easily done with firewalls until DNS-over-HTTP comes into play.
>>
>> How does Squid deals with this?
>> How to block it?

On 29.02.20 22:19, Amos Jeffries wrote:
>With ACL that identify the relevant messages:
>
>  acl dns-query-url urlpath_regex ^/dns-query\??
>  acl dns-req-message req_header Content-Type ^application/dns-message$
>
>  acl doh_request any-of dns-query-url dns-req-message
>
>  acl doh_reply rep_header Content-Type ^application/dns-message$

I guess DoH means dns over https and thus needs sslbump enabled.  the easy
but limited way would be to disable connections to publicly available DoH
servers.

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Atheism is a non-prophet organization.


From 3m9n51s2ewut at thismonkey.com  Sat Feb 29 03:11:09 2020
From: 3m9n51s2ewut at thismonkey.com (Scott)
Date: Sat, 29 Feb 2020 14:11:09 +1100
Subject: [squid-users] Invalid URL when trying to access cachemgr
Message-ID: <20200229031109.GA64494@thismonkey.com>

Hi all,

I have three squid proxies, two of which respond normally to cachemgr 
requests:

# printf "GET cache_object://localhost/info HTTP/1.0\r\n\r\n" | nc HOSTNAME 
3128

The third proxy however returns an html error page:

	<body id=ERR_INVALID_URL>
	<div id="titles">
	<h1>ERROR</h1>
	<h2>The requested URL could not be retrieved</h2>
	</div>
	<hr>

	<div id="content">
	<p>The following error was encountered while trying to retrieve the 
	URL: <a 
	href="cache_object://localhost/info">cache_object://localhost/info</a></p>

I have tried replacing `localhost' with the visible_hostname to no avail.

Does anyone have any clues as to why this may be?

Thanks,
Scott


