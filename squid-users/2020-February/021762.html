<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid-users Digest, Vol 66, Issue 17
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid-users%20Digest%2C%20Vol%2066%2C%20Issue%2017&In-Reply-To=%3C34423317-31bc-bc86-69d8-54f370dfc757%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021759.html">
   <LINK REL="Next"  HREF="021763.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid-users Digest, Vol 66, Issue 17</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid-users%20Digest%2C%20Vol%2066%2C%20Issue%2017&In-Reply-To=%3C34423317-31bc-bc86-69d8-54f370dfc757%40measurement-factory.com%3E"
       TITLE="[squid-users] squid-users Digest, Vol 66, Issue 17">rousskov at measurement-factory.com
       </A><BR>
    <I>Sat Feb 15 18:15:58 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="021759.html">[squid-users] squid-users Digest, Vol 66, Issue 17
</A></li>
        <LI>Next message (by thread): <A HREF="021763.html">[squid-users] please,	can someone help me with the negotiate kerberos?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21762">[ date ]</a>
              <a href="thread.html#21762">[ thread ]</a>
              <a href="subject.html#21762">[ subject ]</a>
              <a href="author.html#21762">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2/15/20 6:42 AM, Scott wrote:
&gt;&gt;<i> From: Alex Rousskov
</I>&gt;&gt;<i>     &gt;a      Client source IP address
</I>&gt;&gt;<i>     &gt;la     Local IP address the client connected to
</I>&gt;&gt;<i>     la      Local listening IP address the client connection was...
</I>&gt;&gt;<i>     &lt;a      Server IP address of the last server or peer connection
</I>&gt;&gt;<i>     &lt;la     Local IP address of the last server or peer connection
</I>&gt;&gt;<i>     icap::&lt;A        ICAP server IP address. Similar to &lt;A.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> If we add support for automated IP version extraction, it should be
</I>&gt;&gt;<i> supported as a single new parameter for all existing %codes that log IP
</I>&gt;&gt;<i> addresses rather than new %codes (one %code for each of the existing
</I>&gt;&gt;<i> %codes that log IP addresses). For example:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     %&gt;a{version}
</I>
&gt;<i> bear in mind that normally Squid handles but two connections (c-&gt;squid, 
</I>&gt;<i> squid-&gt;peer/origin), despite the fact that there are normally four addresses 
</I>&gt;<i> (client, squid-inside, squid-outside, peer/origin).  If it were agreed to 
</I>&gt;<i> support such a logging function, why would one bother having &gt;a{version} and 
</I>&gt;<i> &gt;la{version} when both MUST be the same?  Same goes for &lt;a and &lt;la.
</I>
Sorry, I do not understand the relevance of your rhetorical(?) question
because my suggestion does not require anybody to log duplicate
information: If an admin wants the IP version of the client-to-Squid
connection, they can use either &gt;a{version} or &gt;la{version}, whichever
works best for them.

My point was that Squid can already log more than four IP addresses
(corresponding to more than two connections), and that number can only
go up. If additional version logging support is indeed warranted, then
%address_x{ip_version} is a better interface than %address_x_ip_version
or %connection_y_ip_version because the former needs to be documented
and implemented once, while the latter needs to be documented and
implemented once for every [two] address-logging options.

In other words, the &quot;each connection has two addresses&quot; observation
reduces the current pain of adding new %codes by 50%, but my suggestion
reduces that pain by 83% (and approaching 100% long-term).


&gt;<i> As to the suggestion that one differentiate IP versions by the signifier '[', 
</I>&gt;<i> from my experience &quot;%&gt;a&quot; in logformat does NOT provide surrounding square 
</I>&gt;<i> brackets.
</I>
Yes, according to Amos, the admin should be using ':' instead. The
presence of a '.' can be used as well AFAICT. I am sorry for throwing a
bracketing red herring into the debate!


&gt;<i> The argument I would make (and I do appreciate you hearing it) is that 
</I>&gt;<i> programmatically (think grep/awk or pcre filtering) it's much easier to 
</I>&gt;<i> determine how much traffic (client/server) is either v4 or v6 is by using a 
</I>&gt;<i> fixed field rather than positive/negative lookaheads in the address codes 
</I>&gt;<i> (given the lack of []).
</I>
For grep/pcre, the complexity of using ':' instead of '6' (or '[.]'
instead of '4') seems about the same to me as far as &quot;ease&quot; of filtering
is concerned. You could argue that records with a fixed version field
can be filtered _faster_, but not &quot;much easier&quot; AFAICT.

Not sure about awk.


Please note that I am _not_ arguing against adding IP version logging
yet, just making sure that we use the right logging interface (and that
the arguments used in the debate are valid). I am not convinced either
way yet.

Convincing others that an already logged information should also be
available for logging in a different format would be difficult but
probably not impossible. After all, Squid does support %code .min_width
formatting option that may delete some of the field information and even
%code options that extract partial information (%&gt;h{field} being one of
the best examples); perhaps &quot;log just the IP version&quot; could be seen as a
similar option.


HTH,

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="021759.html">[squid-users] squid-users Digest, Vol 66, Issue 17
</A></li>
	<LI>Next message (by thread): <A HREF="021763.html">[squid-users] please,	can someone help me with the negotiate kerberos?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21762">[ date ]</a>
              <a href="thread.html#21762">[ thread ]</a>
              <a href="subject.html#21762">[ subject ]</a>
              <a href="author.html#21762">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
