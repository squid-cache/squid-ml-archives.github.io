<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Need help setting up DD-WRT router to use Squid as a transparent proxy
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Need%20help%20setting%20up%20DD-WRT%20router%20to%20use%20Squid%0A%20as%20a%20transparent%20proxy&In-Reply-To=%3Cc422de0e-305e-b37f-1add-05b5af05ea6d%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021643.html">
   <LINK REL="Next"  HREF="021646.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Need help setting up DD-WRT router to use Squid as a transparent proxy</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Need%20help%20setting%20up%20DD-WRT%20router%20to%20use%20Squid%0A%20as%20a%20transparent%20proxy&In-Reply-To=%3Cc422de0e-305e-b37f-1add-05b5af05ea6d%40treenet.co.nz%3E"
       TITLE="[squid-users] Need help setting up DD-WRT router to use Squid as a transparent proxy">squid3 at treenet.co.nz
       </A><BR>
    <I>Sun Jan 19 09:33:16 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="021643.html">[squid-users] Need help setting up DD-WRT router to use Squid as a	transparent proxy
</A></li>
        <LI>Next message (by thread): <A HREF="021646.html">[squid-users] follow_x_forwarded_for to get client ip instead of	sibling proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21661">[ date ]</a>
              <a href="thread.html#21661">[ thread ]</a>
              <a href="subject.html#21661">[ subject ]</a>
              <a href="author.html#21661">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 16/01/20 9:30 pm, Robert Marshall wrote:
&gt;<i> Hi all,
</I>&gt;<i> 
</I>&gt;<i> I'm trying to set up a transparent proxy on my network so that all
</I>&gt;<i> devices are forced to use Squid/SquidGuard for network traffic, and can
</I>&gt;<i> filter out undesirable destinations.
</I>&gt;<i> 
</I>&gt;<i> I have Squid/SquidGuard running on a Raspberry Pi 4, running the latest
</I>&gt;<i> release of Raspian Buster. The route is a D-Link DIR-860L, flashed with
</I>&gt;<i> the 01/14/20 build of DD-WRT. I tried using the instructions at DD-WRT.
</I>&gt;<i> But, am running into problems.
</I>
What Instructions? If they are telling you to &quot;port forward&quot; or NAT
traffic to wards a separate Squid *machine* they are outdated and now wrong.


&lt;<A HREF="https://wiki.squid-cache.org/ConfigExamples/Intercept/LinuxDnat">https://wiki.squid-cache.org/ConfigExamples/Intercept/LinuxDnat</A>&gt;
Note that traffic MUST only have the NAT performed on the Squid machine.
Any use of DNAT (aka port forwarding) results in the problem you are seeing.

Last time I setup devices like DD-WRT the UI only provided a &quot;DMZ
server&quot; option. If you cannot do Policy Routing for only the port 80 or
443 traffic on the DD-WRT device then the DMZ equivalent may be used
instead.
Either way you need correct and separate routing and NAT rules for
traffic arriving at the Squid machine to send the appropriate
connections to Squid and anything else to its proper destination.


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="021643.html">[squid-users] Need help setting up DD-WRT router to use Squid as a	transparent proxy
</A></li>
	<LI>Next message (by thread): <A HREF="021646.html">[squid-users] follow_x_forwarded_for to get client ip instead of	sibling proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21661">[ date ]</a>
              <a href="thread.html#21661">[ thread ]</a>
              <a href="subject.html#21661">[ subject ]</a>
              <a href="author.html#21661">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
