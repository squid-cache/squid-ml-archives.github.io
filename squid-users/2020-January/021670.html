<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid and netdata causes squid to drop SYN?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20and%20netdata%20causes%20squid%20to%20drop%20SYN%3F&In-Reply-To=%3Cd5356e74-53f8-b873-7490-329b05c2ef28%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021667.html">
   <LINK REL="Next"  HREF="021671.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid and netdata causes squid to drop SYN?</H1>
    <B>Amish</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20and%20netdata%20causes%20squid%20to%20drop%20SYN%3F&In-Reply-To=%3Cd5356e74-53f8-b873-7490-329b05c2ef28%40gmail.com%3E"
       TITLE="[squid-users] squid and netdata causes squid to drop SYN?">anon.amish at gmail.com
       </A><BR>
    <I>Tue Jan 21 04:28:15 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="021667.html">[squid-users] unsuscribe
</A></li>
        <LI>Next message (by thread): <A HREF="021671.html">[squid-users] squid and netdata causes squid to drop SYN?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21670">[ date ]</a>
              <a href="thread.html#21670">[ thread ]</a>
              <a href="subject.html#21670">[ subject ]</a>
              <a href="author.html#21670">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

Recently, I started using netdata to monitor various system functions 
(which also monitors squid)

I am using squid (v4.9) with transparent (NAT) as well as Proxy mode (on 
different ports). Network has 10-15 users. Some on transparent proxy 
(redirection to port 3128) and some via proxy setting (port 8080) in 
browser.

Netdata calls squidclient every second to fetch squid statistics. (for 
generating per second graphs / statistics)

After I started using netdata, everything worked fine for a while. But 
then many users started complaining that they are not able to access 
sites. (Sometimes it worked and sometimes not.)

I could see SYN packets coming in but there were no SYN,ACK going back. 
I quickly went through cache.log but did not find anything. (searched 
for descriptors). I believe (but not 100% sure) that this happened only 
with those on transparent proxy. (again not sure)

Then I restarted the squid and all was well. But then issue happened 
again and I disabled netdata's squid module and now all is working fine 
from few days.

So I suspect that netdata calling squidclient every second is not a 
right thing to do. Its probably causing denial-of-service on squid.

So:
1) Is there any squid setting which I can adjust? (File descriptors 
available is 16384)
2) Is calling squidclient so frequently a right thing to do by netdata? 
Its probably over loading squid. (I will report to netdata if not)

Please guide,

Thank you,

Regards,

Amish


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="021667.html">[squid-users] unsuscribe
</A></li>
	<LI>Next message (by thread): <A HREF="021671.html">[squid-users] squid and netdata causes squid to drop SYN?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21670">[ date ]</a>
              <a href="thread.html#21670">[ thread ]</a>
              <a href="subject.html#21670">[ subject ]</a>
              <a href="author.html#21670">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
