<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid ICAP -&gt; Sophos SAVDI -&gt; read_ahead_gap question
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20ICAP%20-%3E%20Sophos%20SAVDI%20-%3E%20read_ahead_gap%20question&In-Reply-To=%3C1580151135195-0.post%40n4.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021687.html">
   <LINK REL="Next"  HREF="021692.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid ICAP -&gt; Sophos SAVDI -&gt; read_ahead_gap question</H1>
    <B>netadmin</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20ICAP%20-%3E%20Sophos%20SAVDI%20-%3E%20read_ahead_gap%20question&In-Reply-To=%3C1580151135195-0.post%40n4.nabble.com%3E"
       TITLE="[squid-users] Squid ICAP -&gt; Sophos SAVDI -&gt; read_ahead_gap question">netadmin at aicta.ro
       </A><BR>
    <I>Mon Jan 27 18:52:15 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="021687.html">[squid-users] Squid not coming up with dynamic host certificate	on ssl bum
</A></li>
        <LI>Next message (by thread): <A HREF="021692.html">[squid-users] Squid ICAP -&gt; Sophos SAVDI -&gt; read_ahead_gap question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21691">[ date ]</a>
              <a href="thread.html#21691">[ thread ]</a>
              <a href="subject.html#21691">[ subject ]</a>
              <a href="author.html#21691">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>My system:
7th generation Intel processor with 32 GB RAM
HDD on SATA without RAID
OS: Linux Slackware 64 bit
Squid version: 4.10 (compiled from sources)
Number of clients using ICAP: 20
Relevant squid.conf options:
reply_body_max_size 20 MB localnet
http_port 192.168.1.1:3128 ssl-bump \
cert=/usr/local/squid/ssl_cert/myCA.pem \
generate-host-certificates=on dynamic_cert_mem_cache_size=16MB
acl step1 at_step SslBump1
ssl_bump peek step1
ssl_bump bump all
sslcrtd_program /usr/local/squid/libexec/security_file_certgen -s
/var/lib/ssl_db -M 16MB
sslcrtd_children 32 startup=10 idle=2
cache_mem 4096 MB
maximum_object_size_in_memory 20 MB
maximum_object_size 200 MB
cache_dir ufs &lt;...&gt; 10240 16 256
quick_abort_min -1
read_ahead_gap 20 MB
icap_enable on
icap_service_failure_limit 20
icap_service sophosicap respmod_precache <A HREF="icap://127.0.0.1:4020/sophos">icap://127.0.0.1:4020/sophos</A>
adaptation_access sophosicap deny CONNECT
adaptation_access sophosicap allow all

If I try to download a 20 MB file on all workstations at the same time,
without the option &quot;read_ahead_gap 20 MB&quot;, the download fails on a small
number of workstations.
After about a week of searching and reading the documentation I tried the
above option, the download errors are gone and the processor load is low.
I do not fully understand the transfer mechanism between the ICAP client
(Squid) and the ICAP server (Sophos SAVDI), but I noticed that the download
time is shorter if the file is stored in RAM cache (using cache_mem)
compared to disk storage.
If I use disk storage for the 20 MB file, during the simultaneous download
the processor load reaches 100% - this I think not because of the ICAP
server - and download errors occur.
Is the maximum supported size for a file transmitted to the ICAP server 20
MB?
Is there anything wrong with my settings?



--
Sent from: <A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html">http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html</A>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="021687.html">[squid-users] Squid not coming up with dynamic host certificate	on ssl bum
</A></li>
	<LI>Next message (by thread): <A HREF="021692.html">[squid-users] Squid ICAP -&gt; Sophos SAVDI -&gt; read_ahead_gap question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21691">[ date ]</a>
              <a href="thread.html#21691">[ thread ]</a>
              <a href="subject.html#21691">[ subject ]</a>
              <a href="author.html#21691">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
