<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid ICAP -&gt; Sophos SAVDI -&gt; read_ahead_gap	question
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20ICAP%20-%3E%20Sophos%20SAVDI%20-%3E%20read_ahead_gap%0A%09question&In-Reply-To=%3C1580289964479-0.post%40n4.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021692.html">
   <LINK REL="Next"  HREF="021693.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid ICAP -&gt; Sophos SAVDI -&gt; read_ahead_gap	question</H1>
    <B>netadmin</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20ICAP%20-%3E%20Sophos%20SAVDI%20-%3E%20read_ahead_gap%0A%09question&In-Reply-To=%3C1580289964479-0.post%40n4.nabble.com%3E"
       TITLE="[squid-users] Squid ICAP -&gt; Sophos SAVDI -&gt; read_ahead_gap	question">netadmin at aicta.ro
       </A><BR>
    <I>Wed Jan 29 09:26:04 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="021692.html">[squid-users] Squid ICAP -&gt; Sophos SAVDI -&gt; read_ahead_gap question
</A></li>
        <LI>Next message (by thread): <A HREF="021693.html">[squid-users] Issues with TLS inspection- 3 Follow up question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21694">[ date ]</a>
              <a href="thread.html#21694">[ thread ]</a>
              <a href="subject.html#21694">[ subject ]</a>
              <a href="author.html#21694">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> reply_body_max_size 20 MB localnet
</I>This is the last line for the respective option, before it there are others
that set limits, for example:
reply_body_max_size 200 MB ubuntu_updates
The line has the role of blocking the download of files larger than 20 MB
for which antivirus scanning (with the current settings) takes too long.
&gt;<i> read_ahead_gap 20 MB
</I>The setting was wrong, it works for my particular case, but it creates
problems when downloading the package updates for Ubuntu, which do not go
through the ICAP filter. Now I have reduced the value to 64 KB and the
problem when downloading the Ubuntu updates has disappeared.
Simultaneous download on 20 workstations, with antivirus scanning through
the ICAP server works without problems only for files of up to 10 MB and
anyway a 100% load on the processor appears for a period of several seconds
from the moment the download for customers begins.
For example, if I use wget:
wget
<A HREF="http://mirror.slackware.hr/slackware/slackware-13.1/slackware/kde/oxygen-icons-4.4.3-i486-1.txz">http://mirror.slackware.hr/slackware/slackware-13.1/slackware/kde/oxygen-icons-4.4.3-i486-1.txz</A>
--2020-01-29 10:32:37 -
<A HREF="http://mirror.slackware.hr/slackware/slackware-13.1/slackware/kde/oxygen-icons-4.4.3-i486-1.txz">http://mirror.slackware.hr/slackware/slackware-13.1/slackware/kde/oxygen-icons-4.4.3-i486-1.txz</A>
Connecting to 192.168.1.1:3128 ... connected.
Proxy request sent, awaiting response ... 200 OK
Length: 21117900 (20M)
Saving to: 'oxygen-icons-4.4.3-i486-1.txz'
oxygen-icons-4.4.3- 47% [========&gt;] 9.47M 609KB / s in 18s
2020-01-29 10:33:25 (553 KB / s) - Connection closed at byte 9926425.
Retrying.
--2020-01-29 10: 33: 26-- (try: 2)
<A HREF="http://mirror.slackware.hr/slackware/slackware-13.1/slackware/kde/oxygen-icons-4.4.3-i486-1">http://mirror.slackware.hr/slackware/slackware-13.1/slackware/kde/oxygen-icons-4.4.3-i486-1</A>
.txz
Connecting to 192.168.1.1:3128 ... connected.
Proxy request sent, awaiting response ... 206 Partial Content
Length: 21117900 (20M), 11191475 (11M) remaining
Saving to: 'oxygen-icons-4.4.3-i486-1.txz'
oxygen-icons-4.4.3- 100% [+++++++++ ==========&gt;] 20.14M 2.08MB / s in 7.9s
2020-01-29 10:33:46 (1.34 MB / s) - 'oxygen-icons-4.4.3-i486-1.txz' saved
[21117900/21117900]
I think the &quot;read_ahead_gap 20 MB&quot; option here helps maintain the
connection.
So the problem is not at the client-to-server connection (Squid -&gt; Sophos
SAVDI), nor at the antivirus scan but it can be in the server-to-client
response buffer.



--
Sent from: <A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html">http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html</A>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="021692.html">[squid-users] Squid ICAP -&gt; Sophos SAVDI -&gt; read_ahead_gap question
</A></li>
	<LI>Next message (by thread): <A HREF="021693.html">[squid-users] Issues with TLS inspection- 3 Follow up question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21694">[ date ]</a>
              <a href="thread.html#21694">[ thread ]</a>
              <a href="subject.html#21694">[ subject ]</a>
              <a href="author.html#21694">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
