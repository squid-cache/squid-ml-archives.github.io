<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] rock issue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20rock%20issue&In-Reply-To=%3C3e3d3eac-a515-0948-e14b-0fef7f9b0c85%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022353.html">
   <LINK REL="Next"  HREF="022357.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] rock issue</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20rock%20issue&In-Reply-To=%3C3e3d3eac-a515-0948-e14b-0fef7f9b0c85%40treenet.co.nz%3E"
       TITLE="[squid-users] rock issue">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Jul  2 10:20:08 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="022353.html">[squid-users] rock issue
</A></li>
        <LI>Next message (by thread): <A HREF="022357.html">[squid-users] rock issue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22355">[ date ]</a>
              <a href="thread.html#22355">[ thread ]</a>
              <a href="subject.html#22355">[ subject ]</a>
              <a href="author.html#22355">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2/07/20 8:45 am, patrick mkhael wrote:
&gt;<i> 
</I>&gt;<i> ***Please note that you have 20 kids worth mapping (10 workers and 10
</I>&gt;<i> diskers), but you map only the first 10.&#8203;{since i did not get the point
</I>&gt;<i> of the diskers ,as far as i understood&#160; , it should be like&#160; (simple
</I>&gt;<i> example)
</I>&gt;<i> &#160;&gt;workers 2
</I>&gt;&gt;<i> cpu_affinity_map process_numbers=1,2,3,4 cores=1,2,3,4
</I>&gt;&gt;<i> cache_dir rock /mnt/sdb/1&#160;&#160; 2048 max-size=10000 max-swap-rate=200 swap-timeout=300
</I>&gt;&gt;<i> cache_dir rock /mnt/sdb/2&#160;&#160; 2048 max-size=10000 max-swap-rate=200 swap-timeout=300
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> ***Why do you have 10 rock caches of various sizes?&#160;[ to be honest , i
</I>&gt;<i> saw in many websites that it should be like this from the smallest to
</I>&gt;<i> the bigest with diff size, i tought it should serve from small size pool
</I>&gt;<i> to high ]
</I>&gt;<i> 
</I>
In general yes. BUT the size ranges to use should be determined via
traffic analysis. Specifically measure and graph the object sizes being
handled. There will be a wavy / cyclic line resulting. The size
boundaries should be set to the *minimum* point(s) along that line.


That said. Since you are comparing the new rock to an old UFS setup. It
would be best to start with the rock being setup as similar to the UFS
as you can - number of cache_dir, ranges of objects stored there etc.

ie. if these ranges were in the old UFS, then keep them for now. That
can be re-calculated after the HIT ratio drop is identified.


&gt;<i> *****How many independent disk spindles (or equivalent) do you have? [ i
</I>&gt;<i> have one raid 5 ssd disks , used by the 10 rock cache dir]
</I>&gt;<i> 
</I>
Ouch.

Ideally you would have either:

 5x SSD disks separately mounted. With one rock cache on each.

or,

 1x RAID 10 with one rock cache per disk pair/stripe. This requires
ability for controller to map a sub-directory tree exclusively onto one
of the sub-array stripes.

or,

 2x RAID 1 (drive pair mirroring) with one rock cache on each pair. This
is the simplest way to achieve above when sub-array feature is not
available in RAID 10.

or,

 1x RAID 10 with a single rock cache



The reasons;

Squid I/O pattern is mostly writes and erase. Low on reads.

RAID types in order of best-&gt;worst for that pattern are:
  none, RAID 1, RAID 10, RAID 5, RAID 0
&lt;<A HREF="https://wiki.squid-cache.org/SquidFaq/RAID">https://wiki.squid-cache.org/SquidFaq/RAID</A>&gt;

Normal SSD controllers cannot handle the Squid I/O pattern well. Squid
*will* age the disk much faster than manufacturer measured statistics
indicate. (True for even HDD, just less of a problem there).

This means that the design needs to plan for coping with relatively
frequent disk failures. Loss of the data itself irrelevant. Only the
outage time + reduction in HIT ratio actually matter on failures.

Look for SSD with high write cycle measurements, and for RAID hot-swap
capability (even if the machine itself cant do that).



&gt;<i> ***How did you select the swap rate limits and timeouts for
</I>&gt;<i> cache_dirs?[I took it also from online forum , can i leave it empty for
</I>&gt;<i> both]
</I>&gt;<i> 
</I>
Alex may have better ideas if you can refer us to which tutorials or
documents you found that info in.

Without specific details on why they were chosen I would go with one
rock cache with default values to start with. Only changing them if
followup analysis indicates some other value is better.


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="022353.html">[squid-users] rock issue
</A></li>
	<LI>Next message (by thread): <A HREF="022357.html">[squid-users] rock issue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22355">[ date ]</a>
              <a href="thread.html#22355">[ thread ]</a>
              <a href="subject.html#22355">[ subject ]</a>
              <a href="author.html#22355">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
