<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid 5.0.3 Segment Violation when using ssl bump and cache peer
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%205.0.3%20Segment%20Violation%20when%20using%20ssl%20bump%0A%20and%20cache%20peer&In-Reply-To=%3C091fa965-6a56-036e-e3d1-5d3ccd1b069b%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022365.html">
   <LINK REL="Next"  HREF="022368.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid 5.0.3 Segment Violation when using ssl bump and cache peer</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%205.0.3%20Segment%20Violation%20when%20using%20ssl%20bump%0A%20and%20cache%20peer&In-Reply-To=%3C091fa965-6a56-036e-e3d1-5d3ccd1b069b%40measurement-factory.com%3E"
       TITLE="[squid-users] squid 5.0.3 Segment Violation when using ssl bump and cache peer">rousskov at measurement-factory.com
       </A><BR>
    <I>Sat Jul  4 00:59:08 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="022365.html">[squid-users] squid 5.0.3 Segment Violation when using ssl bump and cache peer
</A></li>
        <LI>Next message (by thread): <A HREF="022368.html">[squid-users] squid 5.0.3 Segment Violation when using ssl bump and cache peer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22367">[ date ]</a>
              <a href="thread.html#22367">[ thread ]</a>
              <a href="subject.html#22367">[ subject ]</a>
              <a href="author.html#22367">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 7/3/20 7:49 PM, &#27211;&#26412;&#32024;&#24076; wrote:
&gt;<i> I have a problem with squid 5.0.3.
</I>&gt;<i> 
</I>&gt;<i> I would like to use &quot;Peering support for SSL-Bump&quot; introduced in squid 5.
</I>&gt;<i> <A HREF="http://squid.mirror.colo-serv.net/archive/5/squid-5.0.2-RELEASENOTES.html#ss2.6">http://squid.mirror.colo-serv.net/archive/5/squid-5.0.2-RELEASENOTES.html#ss2.6</A>
</I>&gt;<i> 
</I>&gt;<i> I configured this environment using docker-compose.
</I>&gt;<i> client -&gt; childproxy -&gt; parentproxy -&gt; server
</I>&gt;<i> 
</I>&gt;<i> When I communicated client to server via childproxy and parentproxy,
</I>&gt;<i> &quot;Segment Violation&quot; happened and squid exited abnormally.
</I>
You need Squid v5 commit 056ad44 or the corresponding patch:
<A HREF="https://github.com/squid-cache/squid/commit/056ad44.patch">https://github.com/squid-cache/squid/commit/056ad44.patch</A>

FTR, the commit message lies about the second case being benign. I must
have looked at the wrong code base when writing that description. Sorry.
Both cases are deadly.


&gt;<i> Do I need any extra configuration to use &quot;Peering support for SSL-Bump&quot; feature?
</I>
I do not think so.


HTH,

Alex.


&gt;<i> Squid Cache: Version 5.0.3
</I>
&gt;<i> #0  0x00007f8b433da387 in raise () from /lib64/libc.so.6
</I>&gt;<i> #1  0x00007f8b433dba78 in abort () from /lib64/libc.so.6
</I>&gt;<i> #2  0x000000000088b4bc in death (sig=11) at tools.cc:359
</I>&gt;<i> #3  &lt;signal handler called&gt;
</I>&gt;<i> #4  0x00000000009dbd12 in Comm::Connection::getPeer (this=0x0) at
</I>&gt;<i> Connection.cc:102
</I>&gt;<i> #5  0x00000000009dbed8 in Comm::Connection::connectTimeout (this=0x0,
</I>&gt;<i> fwdStart=1593816953) at Connection.cc:143
</I>&gt;<i> #6  0x00000000007b1332 in FwdState::connectingTimeout (this=0x2870a48,
</I>&gt;<i> conn=...) at FwdState.cc:1381
</I>&gt;<i> #7  0x00000000007ae351 in FwdState::establishTunnelThruProxy
</I>&gt;<i> (this=0x2870a48, conn=...) at FwdState.cc:850
</I>&gt;<i> #8  0x00000000007adba5 in FwdState::__lambda2::operator()
</I>&gt;<i> (__closure=0x7ffead0888f0) at FwdState.cc:836
</I>&gt;<i> #9  0x00000000007b1ca7 in
</I>&gt;<i> FwdState::advanceDestination&lt;FwdState::noteConnection(HappyConnOpener::Answer&amp;)::__lambda2&gt;(const
</I>&gt;<i> char *, const Comm::ConnectionPointer &amp;, const FwdState::__lambda2 &amp;)
</I>&gt;<i> (this=0x2870a48,
</I>&gt;<i>     stepDescription=0xb487f0 &quot;establish tunnel through proxy&quot;,
</I>&gt;<i> conn=..., startStep=...) at FwdState.cc:777
</I>&gt;<i> #10 0x00000000007ae1ca in FwdState::noteConnection (this=0x2870a48,
</I>&gt;<i> answer=...) at FwdState.cc:837
</I>&gt;<i> #11 0x00000000007b5f64 in HappyConnOpener::CbDialer&lt;FwdState&gt;::dial
</I>&gt;<i> (this=0x2871af8) at HappyConnOpener.h:120
</I>&gt;<i> #12 0x00000000007b56ed in
</I>&gt;<i> AsyncCallT&lt;HappyConnOpener::CbDialer&lt;FwdState&gt; &gt;::fire
</I>&gt;<i> (this=0x2871ac0)
</I>&gt;<i>     at ../src/base/AsyncCall.h:150
</I>&gt;<i> #13 0x000000000096c293 in AsyncCall::make (this=0x2871ac0) at AsyncCall.cc:44
</I>&gt;<i> #14 0x000000000096cfca in AsyncCallQueue::fireNext (this=0x23b6ec0) at
</I>&gt;<i> AsyncCallQueue.cc:60
</I>&gt;<i> #15 0x000000000096cd43 in AsyncCallQueue::fire (this=0x23b6ec0) at
</I>&gt;<i> AsyncCallQueue.cc:43
</I>&gt;<i> #16 0x000000000079afbf in EventLoop::dispatchCalls
</I>&gt;<i> (this=0x7ffead088c80) at EventLoop.cc:144
</I>&gt;<i> #17 0x000000000079aee7 in EventLoop::runOnce (this=0x7ffead088c80) at
</I>&gt;<i> EventLoop.cc:121
</I>&gt;<i> #18 0x000000000079ad4e in EventLoop::run (this=0x7ffead088c80) at
</I>&gt;<i> EventLoop.cc:83
</I>&gt;<i> #19 0x000000000081ce58 in SquidMain (argc=3, argv=0x7ffead088fb8) at
</I>&gt;<i> main.cc:1716
</I>&gt;<i> #20 0x000000000081c2c3 in SquidMainSafe (argc=3, argv=0x7ffead088fb8)
</I>&gt;<i> at main.cc:1403
</I>&gt;<i> #21 0x000000000081c296 in main (argc=3, argv=0x7ffead088fb8) at main.cc:1391
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="022365.html">[squid-users] squid 5.0.3 Segment Violation when using ssl bump and cache peer
</A></li>
	<LI>Next message (by thread): <A HREF="022368.html">[squid-users] squid 5.0.3 Segment Violation when using ssl bump and cache peer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22367">[ date ]</a>
              <a href="thread.html#22367">[ thread ]</a>
              <a href="subject.html#22367">[ subject ]</a>
              <a href="author.html#22367">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
