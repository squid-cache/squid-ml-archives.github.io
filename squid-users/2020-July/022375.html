<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Redirect request to cache_peer using username and	passwords
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Redirect%20request%20to%20cache_peer%20using%20username%20and%0A%09passwords&In-Reply-To=%3CCACbtF4Pq8EOBQijBzvD3BXMh7MQuSHHqfei8m06%2BBbybxDOWfg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022374.html">
   <LINK REL="Next"  HREF="022377.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Redirect request to cache_peer using username and	passwords</H1>
    <B>Prem Chand</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Redirect%20request%20to%20cache_peer%20using%20username%20and%0A%09passwords&In-Reply-To=%3CCACbtF4Pq8EOBQijBzvD3BXMh7MQuSHHqfei8m06%2BBbybxDOWfg%40mail.gmail.com%3E"
       TITLE="[squid-users] Redirect request to cache_peer using username and	passwords">premchand142 at gmail.com
       </A><BR>
    <I>Mon Jul  6 15:58:30 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="022374.html">[squid-users] Redirect request to cache_peer using username and	passwords
</A></li>
        <LI>Next message (by thread): <A HREF="022377.html">[squid-users] Redirect request to cache_peer using username and	passwords
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22375">[ date ]</a>
              <a href="thread.html#22375">[ thread ]</a>
              <a href="subject.html#22375">[ subject ]</a>
              <a href="author.html#22375">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Amos,

On further digging I understood that acl route  via cache_peer_access
(cache_peer_access  Peer1 allow user1)  is not working hence requests are
failing. I'm not sure the exact reason. Can you please suggest how to fix
this?

acl user1 note user username1
cache_peer Peer1 parent 3218 0 round-robin no-query weight=1
connect-fail-limit=1 name=Peer1
cache_peer_access  Peer1 allow user1
cache_peer_access deny all


On Mon, Jul 6, 2020 at 4:00 PM Prem Chand &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">premchand142 at gmail.com</A>&gt; wrote:

&gt;<i> Hi Amos,
</I>&gt;<i>
</I>&gt;<i> I tried the configuration that you suggested but I'm getting below error.
</I>&gt;<i> It seems the requests are not getting forward to cache_peer. I'm unable to
</I>&gt;<i> figure out what is the cause of the issue. If I revert it to my previous
</I>&gt;<i> configuration I'm not seeing any issue with  cache_peer's.
</I>&gt;<i>
</I>&gt;<i> ** Establish HTTP proxy tunnel to www.google.com:443
</I>&gt;<i> * Proxy auth using Basic with user 'username1'
</I>&gt;<i> &gt; CONNECT www.google.com:443 HTTP/1.1
</I>&gt;<i> &gt; Host: www.google.com:443
</I>&gt;<i> &gt; Proxy-Authorization: Basic bGluZTE6dGVzdGluZw==
</I>&gt;<i> &gt; User-Agent: curl/7.58.0
</I>&gt;<i> &gt; Proxy-Connection: Keep-Alive
</I>&gt;<i> &gt;
</I>&gt;<i> &lt; HTTP/1.1 503 Service Unavailable
</I>&gt;<i> &lt; Server: squid/3.5.27
</I>&gt;<i> &lt; Mime-Version: 1.0
</I>&gt;<i> &lt; Date: Mon, 06 Jul 2020 10:24:28 GMT
</I>&gt;<i> &lt; Content-Type: text/html;charset=utf-8
</I>&gt;<i> &lt; Content-Length: 3905
</I>&gt;<i> &lt; X-Squid-Error: ERR_CANNOT_FORWARD 0
</I>&gt;<i> &lt; Vary: Accept-Language
</I>&gt;<i> &lt; Content-Language: en
</I>&gt;<i> &lt;
</I>&gt;<i> * Received HTTP code 503 from proxy after CONNECT
</I>&gt;<i> * CONNECT phase completed!
</I>&gt;<i> * Closing connection 0
</I>&gt;<i> curl: (56) Received HTTP code 503 from proxy after CONNECT
</I>&gt;<i>
</I>&gt;<i> On Thu, Jul 2, 2020 at 6:29 PM Prem Chand &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">premchand142 at gmail.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Hi Amos,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thanks for the response.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> However, what do you want to happen when that user's dedicated peer is
</I>&gt;&gt;<i> unavailable?
</I>&gt;&gt;<i> Can it be routed to another peer if a dedicated peer is unavailable?
</I>&gt;&gt;<i> because each peer is accessed by a different username and password. If
</I>&gt;&gt;<i> there is an option to route then I will keep a backup peer(Peer4) so if any
</I>&gt;&gt;<i> one of the peers(Peer1,Peer2,Peer3) is unavailable it can route to the
</I>&gt;&gt;<i> backup peer and once the unavailable peer become available then traffic
</I>&gt;&gt;<i> should auto route to them from backup peer.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> If there is no option that fits as I explained above then I want to stop
</I>&gt;&gt;<i> all access for them.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Are you wanting to keep this behaviour?
</I>&gt;&gt;<i> I don't want to use the round-robin behaviour. I want to route requests
</I>&gt;&gt;<i> to dedicated Peer/Client.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Thu, Jul 2, 2020 at 3:19 PM Prem Chand &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">premchand142 at gmail.com</A>&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Hi,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I need to redirect my clients requests to different Cache_peers using
</I>&gt;&gt;&gt;<i> username and passwords through my proxy. Below is the rough sketch. Can
</I>&gt;&gt;&gt;<i> someone suggest to me how I can achieve this?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Client1(Username1:password1) -&gt;Proxy:443 -&gt; Cache_peer:3218
</I>&gt;&gt;&gt;<i> Client 2(Username2:password2)-&gt;Proxy:443-&gt; Cache_peer:3219
</I>&gt;&gt;&gt;<i> .
</I>&gt;&gt;&gt;<i> .
</I>&gt;&gt;&gt;<i> .
</I>&gt;&gt;&gt;<i> .
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> This is my current configuration, I'm doing round robin through
</I>&gt;&gt;&gt;<i> cache_peers when authenticated with a single username and password in
</I>&gt;&gt;&gt;<i> /etc/squid/squidpasswdfile file
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> auth_param basic program /usr/lib64/squid/ncsa_auth
</I>&gt;&gt;&gt;<i> /etc/squid/squidpasswdfile
</I>&gt;&gt;&gt;<i> auth_param basic realm proxy
</I>&gt;&gt;&gt;<i> acl auth_users proxy_auth REQUIRED
</I>&gt;&gt;&gt;<i> http_access allow auth_users
</I>&gt;&gt;&gt;<i> http_access deny all
</I>&gt;&gt;&gt;<i> cache_peer Peer1 parent 3218 0 round-robin no-query weight=1
</I>&gt;&gt;&gt;<i> connect-fail-limit=1
</I>&gt;&gt;&gt;<i> cache_peer Peer2 parent 3219 0 round-robin no-query weight=1
</I>&gt;&gt;&gt;<i> connect-fail-limit=1
</I>&gt;&gt;&gt;<i> cache_peer Peer3 parent 3219 0 round-robin no-query weight=1
</I>&gt;&gt;&gt;<i> connect-fail-limit=1
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Thanks &amp; Regards
</I>&gt;&gt;&gt;<i> Premchand.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> --
</I>&gt;&gt;<i> prem
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> prem
</I>&gt;<i>
</I>

-- 
prem
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20200706/524e9be6/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20200706/524e9be6/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="022374.html">[squid-users] Redirect request to cache_peer using username and	passwords
</A></li>
	<LI>Next message (by thread): <A HREF="022377.html">[squid-users] Redirect request to cache_peer using username and	passwords
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22375">[ date ]</a>
              <a href="thread.html#22375">[ thread ]</a>
              <a href="subject.html#22375">[ subject ]</a>
              <a href="author.html#22375">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
