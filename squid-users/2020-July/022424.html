<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid doesn't fetch the intermediate certificate for some sites
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20doesn%27t%20fetch%20the%20intermediate%20certificate%0A%20for%20some%20sites&In-Reply-To=%3C20200721085949.GB8980%40fantomas.sk%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022423.html">
   <LINK REL="Next"  HREF="022425.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid doesn't fetch the intermediate certificate for some sites</H1>
    <B>Matus UHLAR - fantomas</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20doesn%27t%20fetch%20the%20intermediate%20certificate%0A%20for%20some%20sites&In-Reply-To=%3C20200721085949.GB8980%40fantomas.sk%3E"
       TITLE="[squid-users] squid doesn't fetch the intermediate certificate for some sites">uhlar at fantomas.sk
       </A><BR>
    <I>Tue Jul 21 08:59:49 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="022423.html">[squid-users] squid doesn't fetch the intermediate certificate for	some sites
</A></li>
        <LI>Next message (by thread): <A HREF="022425.html">[squid-users] squid doesn't fetch the intermediate certificate for some sites
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22424">[ date ]</a>
              <a href="thread.html#22424">[ thread ]</a>
              <a href="subject.html#22424">[ subject ]</a>
              <a href="author.html#22424">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 21.07.20 09:41, Dieter Bloms wrote:
&gt;<i>we use the sslbump feature and it works very well.
</I>&gt;<i>But some sites can't be reached because of missing intermediate
</I>&gt;<i>certificate.
</I>&gt;<i>
</I>&gt;<i>In squid.conf we have configured the following parameters:
</I>&gt;<i>
</I>&gt;<i>--snip--
</I>&gt;<i># allow fetching of missing intermediate certificates
</I>&gt;<i>acl fetch_intermediate_certificate transaction_initiator certificate-fetching
</I>&gt;<i>http_access allow fetch_intermediate_certificate
</I>&gt;<i>cache allow fetch_intermediate_certificate
</I>&gt;<i>cache deny all
</I>&gt;<i>--snip--
</I>&gt;<i>
</I>&gt;<i>and fetching the intermediate certificate works for sites like: <A HREF="https://incomplete-chain.badssl.com/">https://incomplete-chain.badssl.com/</A>
</I>&gt;<i>
</I>&gt;<i>but for some sites like <A HREF="https://mycase.cloudapps.cisco.com/">https://mycase.cloudapps.cisco.com/</A>
</I>&gt;<i>squid doesn't fetch the intermediate certificate and returns X509_V_ERR_UNABLE_TO_GET_ISSUER_CERT_LOCALLY
</I>&gt;<i>
</I>&gt;<i>In my eyes the certificate of mycase.cloudapps.cisco.com contains an AiA
</I>&gt;<i>record.
</I>&gt;<i>
</I>&gt;<i>output of openssl on certificate of mycase.cloudapps.cisco.com
</I>&gt;<i>--snip--
</I>&gt;<i>            Authority Information Access:
</I>&gt;<i>                CA Issuers - URI:<A HREF="http://trust.quovadisglobal.com/hydsslg2.crt">http://trust.quovadisglobal.com/hydsslg2.crt</A>
</I>&gt;<i>                OCSP - URI:<A HREF="http://ocsp.quovadisglobal.com">http://ocsp.quovadisglobal.com</A>
</I>&gt;<i>--snip--
</I>&gt;<i>
</I>&gt;<i>so does anybody see what's the reason, why squid doesn't download the
</I>&gt;<i>intermediate certificate for mycase.cloudapps.cisco.com ?
</I>
squid can't download certificates other than the website provides.
if a website does not provide valid certificate chain, it's up to the client
to produce an error. With browser, you can allow the certificate explicitly.

It is also possible that browser has the intermediace certificate
remembered.

testing certificate for mycase.cloudapps.cisco.com shows only one
certificate I can see:

Certificate chain
 0 s:C = US, ST = California, L = San Jose, O = &quot;Cisco Systems, Inc.&quot;, CN = mycase.cloudapps.cisco.com
   i:C = US, O = HydrantID (Avalanche Cloud Corporation), CN = HydrantID SSL ICA G2

the HydrantID SSL ICA G2 certificate seems to be missing here.



-- 
Matus UHLAR - fantomas, <A HREF="https://lists.squid-cache.org/listinfo/squid-users">uhlar at fantomas.sk</A> ; <A HREF="http://www.fantomas.sk/">http://www.fantomas.sk/</A>
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Windows 2000: 640 MB ought to be enough for anybody

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="022423.html">[squid-users] squid doesn't fetch the intermediate certificate for	some sites
</A></li>
	<LI>Next message (by thread): <A HREF="022425.html">[squid-users] squid doesn't fetch the intermediate certificate for some sites
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22424">[ date ]</a>
              <a href="thread.html#22424">[ thread ]</a>
              <a href="subject.html#22424">[ subject ]</a>
              <a href="author.html#22424">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
