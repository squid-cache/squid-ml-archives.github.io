<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid kerberos auth, acl note group
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20kerberos%20auth%2C%20acl%20note%20group&In-Reply-To=%3C8805045d-b0f8-b0e5-b1b8-cbaad9350557%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022426.html">
   <LINK REL="Next"  HREF="022431.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid kerberos auth, acl note group</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20kerberos%20auth%2C%20acl%20note%20group&In-Reply-To=%3C8805045d-b0f8-b0e5-b1b8-cbaad9350557%40measurement-factory.com%3E"
       TITLE="[squid-users] squid kerberos auth, acl note group">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Jul 21 18:21:46 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="022426.html">[squid-users] squid kerberos auth, acl note group
</A></li>
        <LI>Next message (by thread): <A HREF="022431.html">[squid-users] squid kerberos auth, acl note group
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22428">[ date ]</a>
              <a href="thread.html#22428">[ thread ]</a>
              <a href="subject.html#22428">[ subject ]</a>
              <a href="author.html#22428">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 7/21/20 10:41 AM, Klaus Brandl wrote:

&gt;<i> we have a problem with the squid kerberos auth helper and the note acl 
</I>&gt;<i> matching to user groups in an active directory.
</I>&gt;<i> First the user was in one group, which was configured via the groupSid base64 
</I>&gt;<i> string as a note acl, and this was working very well.
</I>&gt;<i> Then there was added a new group to the user, and the note acl was changed to 
</I>&gt;<i> this new groupSid string, but now this group is not matching. We also do not 
</I>&gt;<i> see this group string in the debug output from the auth helper like this:
</I>
If the helper is not returning the new groupSid to Squid then the note
ACL using that new groupSid should not match. Unfortunately, I do not
know enough about that helper to tell you why it does not tell Squid
about the new group.


&gt;<i> /tmp/ports.squid-4.11pg0.AFNuqpKCuX/squid-4.11/src/auth/negotiate/kerberos/negot
</I>&gt;<i> iate_kerberos_auth.cc(806): pid=32868 :2020/07/21 14:34:54| 
</I>&gt;<i> negotiate_kerberos_auth: DEBUG: Groups group=AQUAAAAAAAUVAAAAMq9NXuhR/XHUeZSdjV0AAA== 
</I>&gt;<i> group=AQUAAAAAAAUVAAAAMq9NXuhR/XHUeZSdAQIAAA== 
</I>&gt;<i> group=AQUAAAAAAAUVAAAAMq9NXuhR/XHUeZSdIXIAAA== 
</I>&gt;<i> group=AQUAAAAAAAUVAAAAMq9NXuhR/XHUeZSdkE8AAA== 
</I>&gt;<i> group=AQUAAAAAAAUVAAAAMq9NXuhR/XHUeZSdKUMAAA== 
</I>&gt;<i> group=AQUAAAAAAAUVAAAAMq9NXuhR/XHUeZSd2UAAAA== 
</I>&gt;<i> group=AQUAAAAAAAUVAAAAMq9NXuhR/XHUeZSdh0wAAA== 
</I>&gt;<i> group=AQUAAAAAAAUVAAAAMq9NXuhR/XHUeZSdZk4AAA== 
</I>&gt;<i> group=AQUAAAAAAAUVAAAAMq9NXuhR/XHUeZSdFFsAAA== 
</I>&gt;<i> group=AQUAAAAAAAUVAAAAMq9NXuhR/XHUeZSdH0cAAA== 
</I>&gt;<i> group=AQUAAAAAAAUVAAAAMq9NXuhR/XHUeZSd+1QAAA== 
</I>&gt;<i> group=AQUAAAAAAAUVAAAAMq9NXuhR/XHUeZSdDFEAAA== 
</I>&gt;<i> group=AQUAAAAAAAUVAAAAMq9NXuhR/XHUeZSdWlIAAA== 
</I>&gt;<i> group=AQUAAAAAAAUVAAAAMq9NXuhR/XHUeZSdOEAAAA== 
</I>&gt;<i> group=AQUAAAAAAAUVAAAAMq9NXuhR/XHUeZSdPUMAAA== 
</I>&gt;<i> group=AQUAAAAAAAUVAAAAMq9NXuhR/XHUeZSdJ3AAAA== 
</I>&gt;<i> group=AQUAAAAAAAUVAAAAMq9NXuhR/XHUeZSdOMQAAA== group=AQEAAAAAABIBAAAA
</I>&gt;<i> 
</I>&gt;<i> The config is like this:
</I>&gt;<i> 
</I>&gt;<i> auth_param negotiate program /usr/local/libexec/squid/negotiate_kerberos_auth 
</I>&gt;<i> \
</I>&gt;<i> -i -d -s GSS_C_NO_NAME
</I>&gt;<i> auth_param negotiate children 100
</I>&gt;<i> auth_param negotiate keep_alive on
</I>&gt;<i> acl authenticated proxy_auth REQUIRED
</I>&gt;<i> acl surfen note group AQUAAAAAAAUVAAAAMq9NXuhR/XHUeZSdmZ0AAA==
</I>&gt;<i> http_access allow authenticated surfen
</I>&gt;<i> http_access deny all
</I>&gt;<i> 
</I>&gt;<i> Any idea, what the problem could be?
</I>&gt;<i> Where are this groups from in the debug output, are they from the decoded 
</I>&gt;<i> authentication token from the client, or from the kerberos connection to the 
</I>&gt;<i> domain controller?
</I>
The group membership info should be coming from the authentication
service, not the client.


&gt;<i> And why does the last group string looks like truncated?
</I>
I could not find the source of the debug() function used by the helper,
but I would not be surprised it that function has a fixed buffer that
does not accommodate all the groups. It is also possible that there is
not enough space in the helper buffers to store the actual groups -- I
cannot tell whether that is the case from the debugging output you
shared (and the source code has many conditional branches that allocate
this space differently based on various factors AFAICT).

A local developer or a very capable local admin should be able to answer
this question by studying (and possibly adding more) helper debugging.


Please also note that there are a couple of possibly related known bugs:

* <A HREF="https://bugs.squid-cache.org/show_bug.cgi?id=5063">https://bugs.squid-cache.org/show_bug.cgi?id=5063</A>
* <A HREF="https://bugs.squid-cache.org/show_bug.cgi?id=5063">https://bugs.squid-cache.org/show_bug.cgi?id=5063</A>

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="022426.html">[squid-users] squid kerberos auth, acl note group
</A></li>
	<LI>Next message (by thread): <A HREF="022431.html">[squid-users] squid kerberos auth, acl note group
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22428">[ date ]</a>
              <a href="thread.html#22428">[ thread ]</a>
              <a href="subject.html#22428">[ subject ]</a>
              <a href="author.html#22428">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
