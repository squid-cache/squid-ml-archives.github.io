<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] error:invalid-request HTTP/1.1 (iPhone requesting	icloud.com)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20error%3Ainvalid-request%20HTTP/1.1%20%28iPhone%20requesting%0A%09icloud.com%29&In-Reply-To=%3C20200723053916.GA69311%40thismonkey.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022439.html">
   <LINK REL="Next"  HREF="022442.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] error:invalid-request HTTP/1.1 (iPhone requesting	icloud.com)</H1>
    <B>Scott</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20error%3Ainvalid-request%20HTTP/1.1%20%28iPhone%20requesting%0A%09icloud.com%29&In-Reply-To=%3C20200723053916.GA69311%40thismonkey.com%3E"
       TITLE="[squid-users] error:invalid-request HTTP/1.1 (iPhone requesting	icloud.com)">3m9n51s2ewut at thismonkey.com
       </A><BR>
    <I>Thu Jul 23 05:39:16 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="022439.html">[squid-users] Simple REGEX not working...
</A></li>
        <LI>Next message (by thread): <A HREF="022442.html">[squid-users] Squid and multipart form decode
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22440">[ date ]</a>
              <a href="thread.html#22440">[ thread ]</a>
              <a href="subject.html#22440">[ subject ]</a>
              <a href="author.html#22440">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

some iOS requests to gateway.icloud.com via squid (explicit) throw the 
following error in the logs:

2020-07-23T15:31:08+10:00 00.11.22.68 (squid-1): ABCD::17 (iphoneXs.domain.com) - via -:- - - [23/Jul/2020:15:31:08 +1000] &quot;- error:invalid-request HTTP/1.1&quot; 400 3739 &quot;-&quot; &quot;-&quot; NONE_NONE:HIER _NONE (mode:- sni:-)

Cache file logging of HTTP only shows Squid's response (not the client 
request).

tcpdump gives the following TCP stream (in ASCII):

C-&gt;S:
................_\...&amp;_&lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">. at 4....</A>/..K.......' ........z...h.q.B..H..c....0L&gt;...4.......,.+.$.#.
.	...0./.(.'...........=.&lt;.5./.....
..................gateway.icloud.com.....
..............................................h2.http/1.1.......3.&amp;.$... R..{V$_&lt;]..yM..L...1b	..d...).
..-.....+.	..........
.
.........................................................................................................................................................................................................................

S-&gt;C:
HTTP/1.1 400 Bad Request
Server: squid/5.0.1-20200312-r8a511d5e0
Mime-Version: 1.0
Date: Thu, 23 Jul 2020 05:00:20 GMT
Content-Type: text/html;charset=utf-8
Content-Length: 3406
X-Squid-Error: ERR_PROTOCOL_UNKNOWN 0
Vary: Accept-Language
Content-Language: en
X-Cache: MISS from proxy-01.thismonkey.com
Connection: close

&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01//EN&quot; &quot;<A HREF="http://www.w3.org/TR/html4/strict.dtd">http://www.w3.org/TR/html4/strict.dtd</A>&quot;&gt;
&lt;html&gt;&lt;head&gt;
&lt;meta type=&quot;copyright&quot; content=&quot;Copyright (C) 1996-2020 The Squid Software Foundation and contributors&quot;&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;
&lt;title&gt;ERROR: The requested URL could not be retrieved&lt;/title&gt;
&lt;style type=&quot;text/css&quot;&gt;&lt;!-- 

&lt;snip&gt;

Does anyone know what type of request the client is sending?  And why squid is unhappy with it?

To my eye it doesn't look like HTTP - perhaps the h2 is a clue?

Thanks

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="022439.html">[squid-users] Simple REGEX not working...
</A></li>
	<LI>Next message (by thread): <A HREF="022442.html">[squid-users] Squid and multipart form decode
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22440">[ date ]</a>
              <a href="thread.html#22440">[ thread ]</a>
              <a href="subject.html#22440">[ subject ]</a>
              <a href="author.html#22440">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
