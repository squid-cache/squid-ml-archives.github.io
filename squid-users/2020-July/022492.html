<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] SQUID with cache_peer config + E2guardian - too many connections
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SQUID%20with%20cache_peer%20config%20%2B%20E2guardian%20-%20too%0A%20many%20connections&In-Reply-To=%3C562fb0a9-4198-dc95-04fd-c705184e13b4%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022491.html">
   <LINK REL="Next"  HREF="022493.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] SQUID with cache_peer config + E2guardian - too many connections</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SQUID%20with%20cache_peer%20config%20%2B%20E2guardian%20-%20too%0A%20many%20connections&In-Reply-To=%3C562fb0a9-4198-dc95-04fd-c705184e13b4%40treenet.co.nz%3E"
       TITLE="[squid-users] SQUID with cache_peer config + E2guardian - too many connections">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Jul 29 12:24:52 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="022491.html">[squid-users] SQUID with cache_peer config + E2guardian - too many connections
</A></li>
        <LI>Next message (by thread): <A HREF="022493.html">[squid-users] SQUID with cache_peer config + E2guardian - too many connections
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22492">[ date ]</a>
              <a href="thread.html#22492">[ thread ]</a>
              <a href="subject.html#22492">[ subject ]</a>
              <a href="author.html#22492">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 29/07/20 11:58 pm, Klaus Brandl wrote:
&gt;<i> On Wednesday 29 July 2020 23:03:43 Amos Jeffries wrote:
</I>&gt;&gt;<i> On 29/07/20 8:29 pm, Klaus Brandl wrote:
</I>&gt;&gt;&gt;<i> Setting an other &quot;visible_hostname&quot; may also help.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Why do you think the hostname has any relation to the problem?
</I>&gt;<i> 
</I>&gt;<i> because we had also a forwarding loop by connection 2 squids on the same host 
</I>&gt;<i> together via a parent statement. Then in the via header there was the same 
</I>&gt;<i> hostname 2 times, and this issued squid to detect a forwarding loop.
</I>&gt;<i> Setting an other visible_hostname on one of the squids solved this problem.&gt;
</I>
In your situation the parent proxy was wrongly reporting loops since it
saw its own name coming out of the child proxy. That is not a real loop,
just a misconfiguration on your part to begin with.

NP: Klaus, unique_hostname is probably a better solution to your
problem. That lets loop detection work properly but both proxies send
URLs containing the shared visible_hostname to clients when they need to
reference proxy resources.


For this thread the OP has only one Squid and it is first in the proxy
chain.

For a loop to happen the peer must already be accepting traffic from
Squid with its current visible/public hostname. Only after that the
traffic might loop back to Squid to begin another circle. So setting the
Squid hostname to a different value will not stop any real loops, only
alter the string placed in the Via header each cycle.

Right now in the troubleshooting we are trying to get loops to show up
to see whether that is the hidden problem.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="022491.html">[squid-users] SQUID with cache_peer config + E2guardian - too many connections
</A></li>
	<LI>Next message (by thread): <A HREF="022493.html">[squid-users] SQUID with cache_peer config + E2guardian - too many connections
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22492">[ date ]</a>
              <a href="thread.html#22492">[ thread ]</a>
              <a href="subject.html#22492">[ subject ]</a>
              <a href="author.html#22492">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
