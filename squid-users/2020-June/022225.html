<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Problem with squid proxy authentication configuration
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Problem%20with%20squid%20proxy%20authentication%0A%20configuration&In-Reply-To=%3C11cd0d12-38e3-21e0-71f2-4496d83c8d8b%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022235.html">
   <LINK REL="Next"  HREF="022234.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Problem with squid proxy authentication configuration</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Problem%20with%20squid%20proxy%20authentication%0A%20configuration&In-Reply-To=%3C11cd0d12-38e3-21e0-71f2-4496d83c8d8b%40treenet.co.nz%3E"
       TITLE="[squid-users] Problem with squid proxy authentication configuration">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Jun 10 14:34:40 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="022235.html">[squid-users] Problem with squid proxy authentication	configuration
</A></li>
        <LI>Next message (by thread): <A HREF="022234.html">[squid-users] Problem with squid proxy authentication	configuration
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22225">[ date ]</a>
              <a href="thread.html#22225">[ thread ]</a>
              <a href="subject.html#22225">[ subject ]</a>
              <a href="author.html#22225">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 10/06/20 9:26 pm, Amiq Nahas wrote:
&gt;<i> Hi Guys,
</I>&gt;<i> 
</I>&gt;<i> I am trying to configure squid so as to have user proxy
</I>&gt;<i> authentication, below is how my squid.conf file looks like:
</I>&gt;<i> 
</I>&gt;<i> -----
</I>&gt;<i> acl SSL_ports port 443
</I>&gt;<i> acl Safe_ports port 80        # http
</I>&gt;<i> acl Safe_ports port 21        # ftp
</I>&gt;<i> acl Safe_ports port 443        # https
</I>&gt;<i> acl Safe_ports port 70        # gopher
</I>&gt;<i> acl Safe_ports port 210        # wais
</I>&gt;<i> acl Safe_ports port 1025-65535    # unregistered ports
</I>&gt;<i> acl Safe_ports port 280        # http-mgmt
</I>&gt;<i> acl Safe_ports port 488        # gss-http
</I>&gt;<i> acl Safe_ports port 591        # filemaker
</I>&gt;<i> acl Safe_ports port 777        # multiling http
</I>&gt;<i> acl CONNECT method CONNECT
</I>&gt;<i> 
</I>&gt;<i> http_access deny !Safe_ports
</I>&gt;<i> http_access deny CONNECT !SSL_ports
</I>&gt;<i> http_access allow localhost manager
</I>&gt;<i> http_access deny manager
</I>&gt;<i> http_access allow localhost
</I>&gt;<i> http_access deny all
</I>&gt;<i> http_port 3128
</I>&gt;<i> coredump_dir /var/spool/squid
</I>&gt;<i> 
</I>&gt;<i> refresh_pattern ^ftp:        1440    20%    10080
</I>&gt;<i> refresh_pattern ^gopher:    1440    0%    1440
</I>&gt;<i> refresh_pattern -i (/cgi-bin/|\?) 0    0%    0
</I>&gt;<i> refresh_pattern (Release|Packages(.gz)*)$      0       20%     2880
</I>&gt;<i> refresh_pattern .        0    20%    4320
</I>&gt;<i> -----
</I>&gt;<i> 
</I>&gt;<i> The above lines were default in squid.conf file.
</I>&gt;<i> 
</I>&gt;<i> I have added below lines:
</I>&gt;<i> 
</I>
*Where* did you add them? order is important.


&gt;<i> -----
</I>&gt;<i> icap_enable on
</I>&gt;<i> icap_send_client_ip on
</I>&gt;<i> icap_send_client_username on
</I>&gt;<i> icap_client_username_header X-Authenticated-User
</I>&gt;<i> icap_preview_enable on
</I>&gt;<i> icap_preview_size 1024
</I>&gt;<i> 
</I>&gt;<i> icap_service service_req reqmod_precache bypass=1 <A HREF="icap://127.0.0.1:1344/echo">icap://127.0.0.1:1344/echo</A>
</I>&gt;<i> adaptation_access service_req allow all
</I>&gt;<i> 
</I>&gt;<i> icap_service service_resp respmod_precache bypass=0 <A HREF="icap://127.0.0.1:1344/echo">icap://127.0.0.1:1344/echo</A>
</I>&gt;<i> adaptation_access service_resp allow all
</I>&gt;<i> 
</I>&gt;<i> acl ncsa src 0.0.0.0/0.0.0.0
</I>
Don't do that. Use &quot;all&quot; to match any IP address.

If you want to match IPv4-only clients there is a special value &quot;ipv4&quot;
which is used like so:
  acl ipv4_only src ipv4

Be careful with these type of control. Different access behaviours for
IPv4 and IPv6 is how security bypass issues are created.



&gt;<i> auth_param basic program /usr/lib/squid/basic_ncsa_auth /etc/squid/squid_passwd
</I>&gt;<i> auth_param basic realm proxy
</I>&gt;<i> acl ncsa proxy_auth REQUIRED
</I>
&quot;ncsa&quot; was already defined as a IP address matching ACL.


&gt;<i> http access allow ncsa
</I>

This will only allow clients who are already trying to send credentials.
It will not inform clients that they need to and no sane client will
broadcast its credential secrets unless it has to.

To have HTTP auth work in the usual way it is best to *deny*
non-authenticated traffic and allow based on any other criteria you
have. Like so:

  http_access deny !ncsa
  http_access allow localnet

or

  http_access deny !ncsa
  http_access allow ncsa





Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="022235.html">[squid-users] Problem with squid proxy authentication	configuration
</A></li>
	<LI>Next message (by thread): <A HREF="022234.html">[squid-users] Problem with squid proxy authentication	configuration
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22225">[ date ]</a>
              <a href="thread.html#22225">[ thread ]</a>
              <a href="subject.html#22225">[ subject ]</a>
              <a href="author.html#22225">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
