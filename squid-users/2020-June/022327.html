<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid stores multiple copies of identical ETags
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20stores%20multiple%20copies%20of%20identical%20ETags&In-Reply-To=%3C1cac51ab-30ba-b196-a96d-87e7bc7cd1bb%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022326.html">
   <LINK REL="Next"  HREF="022344.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid stores multiple copies of identical ETags</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20stores%20multiple%20copies%20of%20identical%20ETags&In-Reply-To=%3C1cac51ab-30ba-b196-a96d-87e7bc7cd1bb%40measurement-factory.com%3E"
       TITLE="[squid-users] squid stores multiple copies of identical ETags">rousskov at measurement-factory.com
       </A><BR>
    <I>Sun Jun 28 21:07:21 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="022326.html">[squid-users] squid stores multiple copies of identical ETags
</A></li>
        <LI>Next message (by thread): <A HREF="022344.html">[squid-users] R:  squid stores multiple copies of identical ETags
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22327">[ date ]</a>
              <a href="thread.html#22327">[ thread ]</a>
              <a href="subject.html#22327">[ subject ]</a>
              <a href="author.html#22327">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 6/28/20 2:41 PM, Tabacchiera, Stefano wrote:

&gt;&gt;<i>    Squid does not know that the response headers and body have not changed.
</I>&gt;&gt;<i>    Squid could, in theory, trust the URL+Vary+ETag+etc. combination as a
</I>&gt;&gt;<i>    precise response identity, but it is a bit risky to do that by default
</I>&gt;&gt;<i>    because ETags/etc. might lie. There is currently no code implementing
</I>&gt;&gt;<i>    that optimization either.
</I>
&gt;<i> now I know that only URL/Vary are taken into account when storing an object.
</I>
For the record: I did not say or imply that only URL/Vary are taken into
account. Other request aspects such as request method also influence the
cache key.


&gt;<i> I mean: squid would store a new copy of the object while leaving the
</I>&gt;<i> old copy deletion to cleanup task?
</I>
Some parts of the cleanup process may be delegated. The details depend
on the cache_dir type. I do not know or remember aufs specifics, but I
suspect that all ufs-based cache_dirs, including aufs, use lazy garbage
collection (under normal circumstances). The cache_swap_low and
cache_swap_high directives should determine what is &quot;normal&quot;.


&gt;<i> I'm hesitant to to turn the store_log on, 'cause the performance impact.
</I>&gt;<i> Btw, is there a specific debug_option?
</I>
FWIW, I would not try to debug this on a live/production cache,
especially if you are not used to navigating debugging cache.logs from
busy proxies. The same bug (if any) should be reproducible in lab settings.

These debugging sections may be relevant (but this is not meant as a
comprehensive list, and I do not know what exactly you need to look at):

&gt;<i> doc/debug-sections.txt:section 20    Memory Cache
</I>&gt;<i> doc/debug-sections.txt:section 20    Storage Manager MD5 Cache Keys
</I>&gt;<i> doc/debug-sections.txt:section 20    Store Controller
</I>&gt;<i> doc/debug-sections.txt:section 32    Asynchronous Disk I/O
</I>&gt;<i> doc/debug-sections.txt:section 43    AIOPS
</I>&gt;<i> doc/debug-sections.txt:section 47    Store Directory Routines
</I>&gt;<i> doc/debug-sections.txt:section 81    Store HEAP Removal Policies
</I>
Most of the AUFS/AIO code is in src/DiskIO/DiskThreads


HTH,

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="022326.html">[squid-users] squid stores multiple copies of identical ETags
</A></li>
	<LI>Next message (by thread): <A HREF="022344.html">[squid-users] R:  squid stores multiple copies of identical ETags
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22327">[ date ]</a>
              <a href="thread.html#22327">[ thread ]</a>
              <a href="subject.html#22327">[ subject ]</a>
              <a href="author.html#22327">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
