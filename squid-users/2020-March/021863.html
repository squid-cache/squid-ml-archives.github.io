<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] How to perform regex only after Squid knows the full url with SslBump
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20How%20to%20perform%20regex%20only%20after%20Squid%20knows%20the%20full%0A%20url%20with%20SslBump&In-Reply-To=%3C1584740929482-0.post%40n4.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021866.html">
   <LINK REL="Next"  HREF="021864.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] How to perform regex only after Squid knows the full url with SslBump</H1>
    <B>laviier</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20How%20to%20perform%20regex%20only%20after%20Squid%20knows%20the%20full%0A%20url%20with%20SslBump&In-Reply-To=%3C1584740929482-0.post%40n4.nabble.com%3E"
       TITLE="[squid-users] How to perform regex only after Squid knows the full url with SslBump">laviier at gmail.com
       </A><BR>
    <I>Fri Mar 20 21:48:49 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="021866.html">[squid-users] How to Configure Proxy Chaining with ssl-bump
</A></li>
        <LI>Next message (by thread): <A HREF="021864.html">[squid-users] How to perform regex only after Squid knows the full url with SslBump
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21863">[ date ]</a>
              <a href="thread.html#21863">[ thread ]</a>
              <a href="subject.html#21863">[ subject ]</a>
              <a href="author.html#21863">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I have a use case that I want to access a certain URL path of a domain but
not other. i.e. I want client to be able to access example.com/abc/login,
but not other paths.

Hence, I created ACL rule to achieve that, see below:

```
acl to_domain_whitelist url_regex &quot;/squid-config/whitelist/allow.acl&quot;
acl http port 80
acl https port 443
acl connect method CONNECT

http_access allow all to_domain_whitelist
http_access deny all

http_reply_access allow all

acl step1 at_step SslBump1
acl step2 at_step SslBump2
acl step3 at_step SslBump3

ssl_bump peek step3
ssl_bump bump all
```

However the above code does not work properly, the URL regex matching
happens before Squid performs decryption so that it can only match against
the host name instead of full URL path. I wonder if there's a way to perform
the URL regex only after Squid knows the full url with SslBump? Below is a
briefing of the log. Thank you so much!!!!
```
---------
CONNECT example.com:443 HTTP/1.1
Host: example.com:443
User-Agent: curl/7.54.0
Proxy-Connection: Keep-Alive
X-Forwarded-For: xx.xxx.xx.xx
----------
...
2020/03/20 14:51:43.067| 28,3| Acl.cc(158) matches: checked:
to_domain_whitelist = 0
2020/03/20 14:51:43.071| 85,2| client_side_request.cc(745)
clientAccessCheckDone: The request CONNECT example.com:443 is DENIED; last
ACL checked: all
...
---------
GET /abc/login HTTP/1.1
Host: example.com
User-Agent: curl/7.54.0
Accept: */*
----------
....
```



--
Sent from: <A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html">http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html</A>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="021866.html">[squid-users] How to Configure Proxy Chaining with ssl-bump
</A></li>
	<LI>Next message (by thread): <A HREF="021864.html">[squid-users] How to perform regex only after Squid knows the full url with SslBump
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21863">[ date ]</a>
              <a href="thread.html#21863">[ thread ]</a>
              <a href="subject.html#21863">[ subject ]</a>
              <a href="author.html#21863">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
