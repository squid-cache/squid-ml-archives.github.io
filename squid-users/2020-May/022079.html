<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Encrypt CONNECT Header
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Encrypt%20CONNECT%20Header&In-Reply-To=%3CCANqqF0qG_VfYfiSW3Z5tWZP9NyxORZxNZX4tQ1vnC_uSXwQ7gg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022077.html">
   <LINK REL="Next"  HREF="022083.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Encrypt CONNECT Header</H1>
    <B>Ryan Le</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Encrypt%20CONNECT%20Header&In-Reply-To=%3CCANqqF0qG_VfYfiSW3Z5tWZP9NyxORZxNZX4tQ1vnC_uSXwQ7gg%40mail.gmail.com%3E"
       TITLE="[squid-users] Encrypt CONNECT Header">ryanlele264 at gmail.com
       </A><BR>
    <I>Tue May  5 21:29:04 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="022077.html">[squid-users] Encrypt CONNECT Header
</A></li>
        <LI>Next message (by thread): <A HREF="022083.html">[squid-users] Encrypt CONNECT Header
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22079">[ date ]</a>
              <a href="thread.html#22079">[ thread ]</a>
              <a href="subject.html#22079">[ subject ]</a>
              <a href="author.html#22079">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi All,
Thanks for providing the information.
The issue is not related to the server certificate SNI. It's related to
exposing a few other sensitive data points such as the domain which is
clearly exposed in the CONNECT header. This would be exposed regardless of
TLS 1.3. Also, there are other headers that are sensitive and outside the
encrypted payload including User-Agent and Proxy-Authorization. The
Proxy-Authorization is of concern here. Most modern browsers now support
PAC with HTTPS versus PROXY.

The Proxy-Authorization can carry the Basic Auth (and NTLM) credentials
which is of concern currently since all users are mobile.

Being proactive before this become a problem at causes unnecessary
exposure. Zoom had a lot of issues and wouldn't want this to affect squid
or squid users.

On Tue, May 5, 2020 at 11:33 AM Alex Rousskov &lt;
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt; wrote:

&gt;<i> On 5/5/20 10:18 AM, Ryan Le wrote:
</I>&gt;<i> &gt; Is there plans to support explicit forward proxy over HTTPS to the proxy
</I>&gt;<i> &gt; with ssl-bump?
</I>&gt;<i>
</I>&gt;<i> There have been a few requests for TLS-inside-TLS support, but I am not
</I>&gt;<i> aware of any actual sponsors or features on the road map. It is a
</I>&gt;<i> complicated project, even though each of its two components already
</I>&gt;<i> works today.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; We would like to use https_port ssl-bump without using the
</I>&gt;<i> &gt; intercept or tproxy option. Clients will use PAC with a HTTPS directive
</I>&gt;<i> &gt; rather than a PROXY directive. The goal is to also encrypted the CONNECT
</I>&gt;<i> &gt; header which exposes the domain in plain text while it traverses to the
</I>&gt;<i> &gt; proxy.
</I>&gt;<i>
</I>&gt;<i> Yes, it is a valid use case (that few people understand).
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; Felipe: you don't need to use ssl-bump with explicit https proxy.
</I>&gt;<i>
</I>&gt;<i> Popular browsers barely support HTTPS proxies and refuse to delegate TLS
</I>&gt;<i> handling to them. Thus, a connection to a secure origin server will be
</I>&gt;<i> encrypted by the browser and sent over an encrypted channel through the
</I>&gt;<i> HTTPS proxy -- TLS-inside-TLS. If you want to look inside that browser
</I>&gt;<i> connection, you have to remove both TLS layers. To remove the outer
</I>&gt;<i> layer, you need an https_port in a forward proxy configuration. To
</I>&gt;<i> remove the inner layer, you need SslBump. The combination is not yet
</I>&gt;<i> supported.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; Matus: people will still be able to see SNI SSL header.
</I>&gt;<i>
</I>&gt;<i> ... but not the origin server SNI. Only the proxy SNI is exposed in this
</I>&gt;<i> use case, and that exposure is usually not a problem.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Cheers,
</I>&gt;<i>
</I>&gt;<i> Alex.
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20200505/e29f1b30/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20200505/e29f1b30/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="022077.html">[squid-users] Encrypt CONNECT Header
</A></li>
	<LI>Next message (by thread): <A HREF="022083.html">[squid-users] Encrypt CONNECT Header
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22079">[ date ]</a>
              <a href="thread.html#22079">[ thread ]</a>
              <a href="subject.html#22079">[ subject ]</a>
              <a href="author.html#22079">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
