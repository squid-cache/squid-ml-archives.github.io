<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid logging disable based on ACL &amp; kernel: Out	of memory
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20logging%20disable%20based%20on%20ACL%20%26%20kernel%3A%20Out%0A%09of%20memory&In-Reply-To=%3CCAH1tzCR4G7Bzr0bgC1eXcp2jStFgc2zPW16kiYNFqoEhymvFVw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022046.html">
   <LINK REL="Next"  HREF="022082.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid logging disable based on ACL &amp; kernel: Out	of memory</H1>
    <B>Akshay Hegde</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20logging%20disable%20based%20on%20ACL%20%26%20kernel%3A%20Out%0A%09of%20memory&In-Reply-To=%3CCAH1tzCR4G7Bzr0bgC1eXcp2jStFgc2zPW16kiYNFqoEhymvFVw%40mail.gmail.com%3E"
       TITLE="[squid-users] squid logging disable based on ACL &amp; kernel: Out	of memory">akshay.k.hegde at gmail.com
       </A><BR>
    <I>Wed May  6 12:58:17 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="022046.html">[squid-users] squid logging disable based on ACL &amp; kernel: Out	of memory
</A></li>
        <LI>Next message (by thread): <A HREF="022082.html">[squid-users] squid logging disable based on ACL &amp; kernel: Out of memory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22081">[ date ]</a>
              <a href="thread.html#22081">[ thread ]</a>
              <a href="subject.html#22081">[ subject ]</a>
              <a href="author.html#22081">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Alex,

I updated to latest squid as you suggested, and I tried SSL-Bump using
below config (which filters URLs which are in 443 too), however I have 600
users (windows, linux, Mac, mobile OS like Androd, Windows etc), so asking
them to import CA certificate in browser is not feasible.

1. Is there any way to filter HTTPS URLs without importing CA certificates
on client side? if available can you share config snippet
2. for 16GB RAM, 4 core CPU, 8GB Swap, expected to have 10GB cache,  how to
calculate configurations parameters, is there any thumb rule ? please share
how you usually calculate.

# config
cache_mgr webmaster
cache deny QUERY
cache_mem 256 MB
cache_swap_low 90
cache_swap_high 95
maximum_object_size 4 MB
minimum_object_size 0 KB
maximum_object_size_in_memory 512 kB
ipcache_size 2048
ipcache_low 90
ipcache_high 95
fqdncache_size 1024
cache_replacement_policy lru
memory_replacement_policy lru
cache_dir ufs /var/spool/squid 10000 16 256
cache_effective_user squid
cache_effective_group squid
cache_log /var/log/squid/cache.log
cache_store_log /var/log/squid/store.log
memory_pools on
memory_pools_limit 5 MB

# SSL-Bump -working but not feasible.
http_port 3128 ssl-bump cert=/etc/squid/sslcert/proxyCA.pem
generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
sslcrtd_program /usr/lib64/squid/security_file_certgen -s
 /var/spool/squid/ssl_db -M 4MB
sslcrtd_children 5
acl step1 at_step SslBump1
ssl_bump peek step1
ssl_bump bump all

------------------------------------ My New Environment --------------------
# squid -v
Squid Cache: Version 4.4
Service Name: squid

# cat /etc/redhat-release
CentOS Linux release 8.1.1911 (Core)


# Tested ACLs
logformat test_log %ts.%03tu %6tr %&gt;a %Ss/%03&gt;Hs %&lt;st %rm %&gt;ru %[un %Sh/%&lt;a
%mt
acl test_sites dstdomain &quot;/etc/squid/acls/test_sites.acl&quot;
access_log /var/log/squid/test_site.log test_log test_sites

# tail -f /var/log/squid/test_site.log
1588678050.178   3247 10.0.2.15 TCP_TUNNEL/200 28073 CONNECT
nav.sciencedirect.com:443 akshay HIER_DIRECT/91.235.133.74 -
1588678050.189   3942 10.0.2.15 TCP_TUNNEL/200 24000 CONNECT
nav.sciencedirect.com:443 akshay HIER_DIRECT/91.235.133.74 -
1588678050.355   2552 10.0.2.15 TCP_TUNNEL/200 788 CONNECT
nav.sciencedirect.com:443 akshay HIER_DIRECT/91.235.133.74 -
1588681419.635    647 10.0.2.15 TCP_MISS/200 402 POST
<A HREF="http://scratchpads.eu/modules/statistics/statistics.php">http://scratchpads.eu/modules/statistics/statistics.php</A> akshay HIER_DIRECT/
157.140.2.32 text/html
1588681420.055   1069 10.0.2.15 TCP_MISS/200 46772 GET
<A HREF="http://scratchpads.eu/sites/all/themes/scratchpads_eu/images/shrimp-202px.png">http://scratchpads.eu/sites/all/themes/scratchpads_eu/images/shrimp-202px.png</A>
akshay HIER_DIRECT/157.140.2.32 image/png




On Sat, May 2, 2020 at 1:00 AM Alex Rousskov &lt;
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt; wrote:

&gt;<i> On 5/1/20 12:43 PM, Akshay Hegde wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; I have below option globally, which I don't want to make &quot;off&quot;
</I>&gt;<i> &gt; strip_query_terms on
</I>&gt;<i>
</I>&gt;<i> &gt; acl track dstdomain &quot;/etc/squid/sites_track.txt&quot;
</I>&gt;<i> &gt; access_log /var/log/squid/full_site_links.log squid_custom track
</I>&gt;<i>
</I>&gt;<i> &gt; however for specific ACL I would like to log full URL with query
</I>&gt;<i> &gt; parameters, how this can be done ?
</I>&gt;<i>
</I>&gt;<i> I have not tested this, and the results may be version-dependent, but
</I>&gt;<i> according to logformat documentation[1], %ru honors strip_query_terms
</I>&gt;<i> while %&gt;ru does not:
</I>&gt;<i>
</I>&gt;<i>     logformat strippedFormat %ts... %ru ...
</I>&gt;<i>     access_log ... strippedFormat track !specific_ACL
</I>&gt;<i>
</I>&gt;<i>     logformat detailedFormat %ts... %&gt;ru ...
</I>&gt;<i>     access_log ... detailedFormat track specific_ACL
</I>&gt;<i>
</I>&gt;<i> [1] <A HREF="http://www.squid-cache.org/Doc/config/logformat/">http://www.squid-cache.org/Doc/config/logformat/</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> HTH,
</I>&gt;<i>
</I>&gt;<i> Alex.
</I>&gt;<i>
</I>&gt;<i> &gt; On Fri, May 1, 2020 at 7:05 PM Alex Rousskov wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     On 5/1/20 1:20 AM, Akshay Hegde wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     &gt; *1. How to disable logging of few ACLs ?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     Use &quot;access_log none aclX&quot; to prevent creation of access.log records
</I>&gt;<i> for
</I>&gt;<i> &gt;     transactions matching aclX. See
</I>&gt;<i> &gt;
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/pipermail/squid-users/2020-April/021876.html">http://lists.squid-cache.org/pipermail/squid-users/2020-April/021876.html</A>
</I>&gt;<i> &gt;     for
</I>&gt;<i> &gt;     some related caveats.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     &gt; *2. Kernel Out of Memory
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     This problem is most likely unrelated to logging. If your Squid is
</I>&gt;<i> &gt;     gradually leaking memory (rather than just being overwhelmed with
</I>&gt;<i> &gt;     traffic), then the first step towards removing those memory leaks
</I>&gt;<i> would
</I>&gt;<i> &gt;     be to upgrade your Squid from the unsupported and buggy v3.1.10.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     HTH,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     Alex.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; --
</I>&gt;<i> &gt; &lt;
</I>&gt;<i> <A HREF="https://about.me/akshay.k.hegde?promo=email_sig&amp;utm_source=product&amp;utm_medium=email_sig&amp;utm_campaign=edit_panel&amp;utm_content=thumb">https://about.me/akshay.k.hegde?promo=email_sig&amp;utm_source=product&amp;utm_medium=email_sig&amp;utm_campaign=edit_panel&amp;utm_content=thumb</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Akshay Hegde
</I>&gt;<i> &gt; about.me/akshay.k.hegde
</I>&gt;<i> &gt; &lt;
</I>&gt;<i> <A HREF="https://about.me/akshay.k.hegde?promo=email_sig&amp;utm_source=product&amp;utm_medium=email_sig&amp;utm_campaign=edit_panel&amp;utm_content=thumb">https://about.me/akshay.k.hegde?promo=email_sig&amp;utm_source=product&amp;utm_medium=email_sig&amp;utm_campaign=edit_panel&amp;utm_content=thumb</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i>
</I>
-- 
&lt;<A HREF="https://about.me/akshay.k.hegde?promo=email_sig&amp;utm_source=product&amp;utm_medium=email_sig&amp;utm_campaign=edit_panel&amp;utm_content=thumb">https://about.me/akshay.k.hegde?promo=email_sig&amp;utm_source=product&amp;utm_medium=email_sig&amp;utm_campaign=edit_panel&amp;utm_content=thumb</A>&gt;
Akshay Hegde
about.me/akshay.k.hegde
&lt;<A HREF="https://about.me/akshay.k.hegde?promo=email_sig&amp;utm_source=product&amp;utm_medium=email_sig&amp;utm_campaign=edit_panel&amp;utm_content=thumb">https://about.me/akshay.k.hegde?promo=email_sig&amp;utm_source=product&amp;utm_medium=email_sig&amp;utm_campaign=edit_panel&amp;utm_content=thumb</A>&gt;
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20200506/b710bb17/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20200506/b710bb17/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="022046.html">[squid-users] squid logging disable based on ACL &amp; kernel: Out	of memory
</A></li>
	<LI>Next message (by thread): <A HREF="022082.html">[squid-users] squid logging disable based on ACL &amp; kernel: Out of memory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22081">[ date ]</a>
              <a href="thread.html#22081">[ thread ]</a>
              <a href="subject.html#22081">[ subject ]</a>
              <a href="author.html#22081">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
