<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid logging disable based on ACL &amp; kernel: Out of memory
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20logging%20disable%20based%20on%20ACL%20%26%20kernel%3A%20Out%0A%20of%20memory&In-Reply-To=%3C5d08b65c-2eb3-e9fa-6926-c58dc13fe254%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022081.html">
   <LINK REL="Next"  HREF="022084.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid logging disable based on ACL &amp; kernel: Out of memory</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20logging%20disable%20based%20on%20ACL%20%26%20kernel%3A%20Out%0A%20of%20memory&In-Reply-To=%3C5d08b65c-2eb3-e9fa-6926-c58dc13fe254%40measurement-factory.com%3E"
       TITLE="[squid-users] squid logging disable based on ACL &amp; kernel: Out of memory">rousskov at measurement-factory.com
       </A><BR>
    <I>Wed May  6 14:26:22 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="022081.html">[squid-users] squid logging disable based on ACL &amp; kernel: Out	of memory
</A></li>
        <LI>Next message (by thread): <A HREF="022084.html">[squid-users] squid logging disable based on ACL &amp; kernel: Out	of memory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22082">[ date ]</a>
              <a href="thread.html#22082">[ thread ]</a>
              <a href="subject.html#22082">[ subject ]</a>
              <a href="author.html#22082">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 5/6/20 8:58 AM, Akshay Hegde wrote:

&gt;<i> 1. Is there any way to filter HTTPS URLs without importing CA
</I>&gt;<i> certificates on client side?
</I>
No, there is no way for a proxy to look at request URLs without the
browser trusting the proxy certificate. There are other ways to police
traffic (e.g., browser plugins), but they all require fiddling with the
client environment.


&gt;<i> 2. for 16GB RAM, 4 core CPU, 8GB Swap, expected to have 10GB cache,&#160; how
</I>&gt;<i> to calculate configurations parameters, is there any thumb rule ?
</I>
I believe there is some related advice on Squid wiki:
<A HREF="https://wiki.squid-cache.org/SquidFaq/SquidMemory">https://wiki.squid-cache.org/SquidFaq/SquidMemory</A>

HTH,

Alex.


&gt;<i> # config
</I>&gt;<i> cache_mgr webmaster
</I>&gt;<i> cache deny QUERY
</I>&gt;<i> cache_mem 256 MB
</I>&gt;<i> cache_swap_low 90
</I>&gt;<i> cache_swap_high 95
</I>&gt;<i> maximum_object_size 4 MB
</I>&gt;<i> minimum_object_size 0 KB
</I>&gt;<i> maximum_object_size_in_memory 512 kB
</I>&gt;<i> ipcache_size 2048
</I>&gt;<i> ipcache_low 90
</I>&gt;<i> ipcache_high 95
</I>&gt;<i> fqdncache_size 1024
</I>&gt;<i> cache_replacement_policy lru
</I>&gt;<i> memory_replacement_policy lru
</I>&gt;<i> cache_dir ufs /var/spool/squid 10000 16 256
</I>&gt;<i> cache_effective_user squid
</I>&gt;<i> cache_effective_group squid
</I>&gt;<i> cache_log /var/log/squid/cache.log
</I>&gt;<i> cache_store_log /var/log/squid/store.log
</I>&gt;<i> memory_pools on
</I>&gt;<i> memory_pools_limit 5 MB
</I>&gt;<i> 
</I>&gt;<i> # SSL-Bump -working but not feasible.
</I>&gt;<i> http_port 3128 ssl-bump cert=/etc/squid/sslcert/proxyCA.pem
</I>&gt;<i> generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
</I>&gt;<i> sslcrtd_program /usr/lib64/squid/security_file_certgen -s
</I>&gt;<i> &#160;/var/spool/squid/ssl_db -M 4MB
</I>&gt;<i> sslcrtd_children 5
</I>&gt;<i> acl step1 at_step SslBump1
</I>&gt;<i> ssl_bump peek step1
</I>&gt;<i> ssl_bump bump all
</I>&gt;<i> 
</I>&gt;<i> ------------------------------------ My New Environment --------------------
</I>&gt;<i> # squid -v
</I>&gt;<i> Squid Cache: Version 4.4
</I>&gt;<i> Service Name: squid
</I>&gt;<i> 
</I>&gt;<i> # cat /etc/redhat-release
</I>&gt;<i> CentOS Linux release 8.1.1911 (Core)
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> # Tested ACLs
</I>&gt;<i> logformat test_log %ts.%03tu %6tr %&gt;a %Ss/%03&gt;Hs %&lt;st %rm %&gt;ru %[un
</I>&gt;<i> %Sh/%&lt;a %mt
</I>&gt;<i> acl test_sites dstdomain &quot;/etc/squid/acls/test_sites.acl&quot;
</I>&gt;<i> access_log /var/log/squid/test_site.log test_log test_sites
</I>&gt;<i> 
</I>&gt;<i> # tail -f /var/log/squid/test_site.log
</I>&gt;<i> 1588678050.178 &#160; 3247 10.0.2.15 TCP_TUNNEL/200 28073 CONNECT
</I>&gt;<i> nav.sciencedirect.com:443 &lt;<A HREF="http://nav.sciencedirect.com:443">http://nav.sciencedirect.com:443</A>&gt; akshay
</I>&gt;<i> HIER_DIRECT/91.235.133.74 &lt;<A HREF="http://91.235.133.74">http://91.235.133.74</A>&gt; -
</I>&gt;<i> 1588678050.189 &#160; 3942 10.0.2.15 TCP_TUNNEL/200 24000 CONNECT
</I>&gt;<i> nav.sciencedirect.com:443 &lt;<A HREF="http://nav.sciencedirect.com:443">http://nav.sciencedirect.com:443</A>&gt; akshay
</I>&gt;<i> HIER_DIRECT/91.235.133.74 &lt;<A HREF="http://91.235.133.74">http://91.235.133.74</A>&gt; -
</I>&gt;<i> 1588678050.355 &#160; 2552 10.0.2.15 TCP_TUNNEL/200 788 CONNECT
</I>&gt;<i> nav.sciencedirect.com:443 &lt;<A HREF="http://nav.sciencedirect.com:443">http://nav.sciencedirect.com:443</A>&gt; akshay
</I>&gt;<i> HIER_DIRECT/91.235.133.74 &lt;<A HREF="http://91.235.133.74">http://91.235.133.74</A>&gt; -
</I>&gt;<i> 1588681419.635 &#160; &#160;647 10.0.2.15 TCP_MISS/200 402 POST
</I>&gt;<i> <A HREF="http://scratchpads.eu/modules/statistics/statistics.php">http://scratchpads.eu/modules/statistics/statistics.php</A> akshay
</I>&gt;<i> HIER_DIRECT/157.140.2.32 &lt;<A HREF="http://157.140.2.32">http://157.140.2.32</A>&gt; text/html
</I>&gt;<i> 1588681420.055 &#160; 1069 10.0.2.15 TCP_MISS/200 46772 GET
</I>&gt;<i> <A HREF="http://scratchpads.eu/sites/all/themes/scratchpads_eu/images/shrimp-202px.png">http://scratchpads.eu/sites/all/themes/scratchpads_eu/images/shrimp-202px.png</A>
</I>&gt;<i> akshay HIER_DIRECT/157.140.2.32 &lt;<A HREF="http://157.140.2.32">http://157.140.2.32</A>&gt; image/png
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On Sat, May 2, 2020 at 1:00 AM Alex Rousskov
</I>&gt;<i> &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>
</I>&gt;<i> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt;&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i>     On 5/1/20 12:43 PM, Akshay Hegde wrote:
</I>&gt;<i> 
</I>&gt;<i>     &gt; I have below option globally, which I don't want to make &quot;off&quot;
</I>&gt;<i>     &gt; strip_query_terms on
</I>&gt;<i> 
</I>&gt;<i>     &gt; acl track dstdomain &quot;/etc/squid/sites_track.txt&quot;
</I>&gt;<i>     &gt; access_log /var/log/squid/full_site_links.log squid_custom track
</I>&gt;<i> 
</I>&gt;<i>     &gt; however for specific ACL I would like to log full URL with query
</I>&gt;<i>     &gt; parameters, how this can be done ?
</I>&gt;<i> 
</I>&gt;<i>     I have not tested this, and the results may be version-dependent, but
</I>&gt;<i>     according to logformat documentation[1], %ru honors strip_query_terms
</I>&gt;<i>     while %&gt;ru does not:
</I>&gt;<i> 
</I>&gt;<i>     &#160; &#160; logformat strippedFormat %ts... %ru ...
</I>&gt;<i>     &#160; &#160; access_log ... strippedFormat track !specific_ACL
</I>&gt;<i> 
</I>&gt;<i>     &#160; &#160; logformat detailedFormat %ts... %&gt;ru ...
</I>&gt;<i>     &#160; &#160; access_log ... detailedFormat track specific_ACL
</I>&gt;<i> 
</I>&gt;<i>     [1] <A HREF="http://www.squid-cache.org/Doc/config/logformat/">http://www.squid-cache.org/Doc/config/logformat/</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     HTH,
</I>&gt;<i> 
</I>&gt;<i>     Alex.
</I>&gt;<i> 
</I>&gt;<i>     &gt; On Fri, May 1, 2020 at 7:05 PM Alex Rousskov wrote:
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;On 5/1/20 1:20 AM, Akshay Hegde wrote:
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; *1. How to disable logging of few ACLs ?
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;Use &quot;access_log none aclX&quot; to prevent creation of access.log
</I>&gt;<i>     records for
</I>&gt;<i>     &gt;&#160; &#160; &#160;transactions matching aclX. See
</I>&gt;<i>     &gt;&#160; &#160;
</I>&gt;<i>     &#160;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/2020-April/021876.html">http://lists.squid-cache.org/pipermail/squid-users/2020-April/021876.html</A>
</I>&gt;<i>     &gt;&#160; &#160; &#160;for
</I>&gt;<i>     &gt;&#160; &#160; &#160;some related caveats.
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; *2. Kernel Out of Memory
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;This problem is most likely unrelated to logging. If your Squid is
</I>&gt;<i>     &gt;&#160; &#160; &#160;gradually leaking memory (rather than just being overwhelmed with
</I>&gt;<i>     &gt;&#160; &#160; &#160;traffic), then the first step towards removing those memory
</I>&gt;<i>     leaks would
</I>&gt;<i>     &gt;&#160; &#160; &#160;be to upgrade your Squid from the unsupported and buggy v3.1.10.
</I>&gt;<i>     &gt;
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="022081.html">[squid-users] squid logging disable based on ACL &amp; kernel: Out	of memory
</A></li>
	<LI>Next message (by thread): <A HREF="022084.html">[squid-users] squid logging disable based on ACL &amp; kernel: Out	of memory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22082">[ date ]</a>
              <a href="thread.html#22082">[ thread ]</a>
              <a href="subject.html#22082">[ subject ]</a>
              <a href="author.html#22082">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
