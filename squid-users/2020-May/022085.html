<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid logging disable based on ACL &amp; kernel: Out of memory
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20logging%20disable%20based%20on%20ACL%20%26%20kernel%3A%20Out%0A%20of%20memory&In-Reply-To=%3Cadce0a2e-10b5-72e0-3d9d-b2b40ca59417%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022084.html">
   <LINK REL="Next"  HREF="022045.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid logging disable based on ACL &amp; kernel: Out of memory</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20logging%20disable%20based%20on%20ACL%20%26%20kernel%3A%20Out%0A%20of%20memory&In-Reply-To=%3Cadce0a2e-10b5-72e0-3d9d-b2b40ca59417%40measurement-factory.com%3E"
       TITLE="[squid-users] squid logging disable based on ACL &amp; kernel: Out of memory">rousskov at measurement-factory.com
       </A><BR>
    <I>Wed May  6 14:51:50 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="022084.html">[squid-users] squid logging disable based on ACL &amp; kernel: Out	of memory
</A></li>
        <LI>Next message (by thread): <A HREF="022045.html">[squid-users] squid logging disable based on ACL &amp; kernel: Out of memory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22085">[ date ]</a>
              <a href="thread.html#22085">[ thread ]</a>
              <a href="subject.html#22085">[ subject ]</a>
              <a href="author.html#22085">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 5/6/20 10:45 AM, Akshay Hegde wrote:

&gt;<i> Can you share some link or details about below
</I>
Sorry, I cannot -- it has been many years since I worked on browser
plugins, and I have heard that there were significant changes in
APIs/rights since then. Perhaps others on the mailing list can help you.
If not, most of the related information should be publicly available.

Alex.

&gt;&gt;<i> There are other ways to police
</I>&gt;<i> traffic (e.g., browser plugins), but they all require fiddling with the
</I>&gt;<i> client environment.
</I>&gt;<i> 
</I>&gt;<i> On Wed, May 6, 2020, 7:56 PM Alex Rousskov wrote:
</I>&gt;<i> 
</I>&gt;<i>     On 5/6/20 8:58 AM, Akshay Hegde wrote:
</I>&gt;<i> 
</I>&gt;<i>     &gt; 1. Is there any way to filter HTTPS URLs without importing CA
</I>&gt;<i>     &gt; certificates on client side?
</I>&gt;<i> 
</I>&gt;<i>     No, there is no way for a proxy to look at request URLs without the
</I>&gt;<i>     browser trusting the proxy certificate. There are other ways to police
</I>&gt;<i>     traffic (e.g., browser plugins), but they all require fiddling with the
</I>&gt;<i>     client environment.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     &gt; 2. for 16GB RAM, 4 core CPU, 8GB Swap, expected to have 10GB
</I>&gt;<i>     cache,&#160; how
</I>&gt;<i>     &gt; to calculate configurations parameters, is there any thumb rule ?
</I>&gt;<i> 
</I>&gt;<i>     I believe there is some related advice on Squid wiki:
</I>&gt;<i>     <A HREF="https://wiki.squid-cache.org/SquidFaq/SquidMemory">https://wiki.squid-cache.org/SquidFaq/SquidMemory</A>
</I>&gt;<i> 
</I>&gt;<i>     HTH,
</I>&gt;<i> 
</I>&gt;<i>     Alex.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     &gt; # config
</I>&gt;<i>     &gt; cache_mgr webmaster
</I>&gt;<i>     &gt; cache deny QUERY
</I>&gt;<i>     &gt; cache_mem 256 MB
</I>&gt;<i>     &gt; cache_swap_low 90
</I>&gt;<i>     &gt; cache_swap_high 95
</I>&gt;<i>     &gt; maximum_object_size 4 MB
</I>&gt;<i>     &gt; minimum_object_size 0 KB
</I>&gt;<i>     &gt; maximum_object_size_in_memory 512 kB
</I>&gt;<i>     &gt; ipcache_size 2048
</I>&gt;<i>     &gt; ipcache_low 90
</I>&gt;<i>     &gt; ipcache_high 95
</I>&gt;<i>     &gt; fqdncache_size 1024
</I>&gt;<i>     &gt; cache_replacement_policy lru
</I>&gt;<i>     &gt; memory_replacement_policy lru
</I>&gt;<i>     &gt; cache_dir ufs /var/spool/squid 10000 16 256
</I>&gt;<i>     &gt; cache_effective_user squid
</I>&gt;<i>     &gt; cache_effective_group squid
</I>&gt;<i>     &gt; cache_log /var/log/squid/cache.log
</I>&gt;<i>     &gt; cache_store_log /var/log/squid/store.log
</I>&gt;<i>     &gt; memory_pools on
</I>&gt;<i>     &gt; memory_pools_limit 5 MB
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; # SSL-Bump -working but not feasible.
</I>&gt;<i>     &gt; http_port 3128 ssl-bump cert=/etc/squid/sslcert/proxyCA.pem
</I>&gt;<i>     &gt; generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
</I>&gt;<i>     &gt; sslcrtd_program /usr/lib64/squid/security_file_certgen -s
</I>&gt;<i>     &gt; &#160;/var/spool/squid/ssl_db -M 4MB
</I>&gt;<i>     &gt; sslcrtd_children 5
</I>&gt;<i>     &gt; acl step1 at_step SslBump1
</I>&gt;<i>     &gt; ssl_bump peek step1
</I>&gt;<i>     &gt; ssl_bump bump all
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; ------------------------------------ My New Environment
</I>&gt;<i>     --------------------
</I>&gt;<i>     &gt; # squid -v
</I>&gt;<i>     &gt; Squid Cache: Version 4.4
</I>&gt;<i>     &gt; Service Name: squid
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; # cat /etc/redhat-release
</I>&gt;<i>     &gt; CentOS Linux release 8.1.1911 (Core)
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; # Tested ACLs
</I>&gt;<i>     &gt; logformat test_log %ts.%03tu %6tr %&gt;a %Ss/%03&gt;Hs %&lt;st %rm %&gt;ru %[un
</I>&gt;<i>     &gt; %Sh/%&lt;a %mt
</I>&gt;<i>     &gt; acl test_sites dstdomain &quot;/etc/squid/acls/test_sites.acl&quot;
</I>&gt;<i>     &gt; access_log /var/log/squid/test_site.log test_log test_sites
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; # tail -f /var/log/squid/test_site.log
</I>&gt;<i>     &gt; 1588678050.178 &#160; 3247 10.0.2.15 TCP_TUNNEL/200 28073 CONNECT
</I>&gt;<i>     &gt; nav.sciencedirect.com:443 &lt;<A HREF="http://nav.sciencedirect.com:443">http://nav.sciencedirect.com:443</A>&gt;
</I>&gt;<i>     &lt;<A HREF="http://nav.sciencedirect.com:443">http://nav.sciencedirect.com:443</A>&gt; akshay
</I>&gt;<i>     &gt; HIER_DIRECT/91.235.133.74 &lt;<A HREF="http://91.235.133.74">http://91.235.133.74</A>&gt;
</I>&gt;<i>     &lt;<A HREF="http://91.235.133.74">http://91.235.133.74</A>&gt; -
</I>&gt;<i>     &gt; 1588678050.189 &#160; 3942 10.0.2.15 TCP_TUNNEL/200 24000 CONNECT
</I>&gt;<i>     &gt; nav.sciencedirect.com:443 &lt;<A HREF="http://nav.sciencedirect.com:443">http://nav.sciencedirect.com:443</A>&gt;
</I>&gt;<i>     &lt;<A HREF="http://nav.sciencedirect.com:443">http://nav.sciencedirect.com:443</A>&gt; akshay
</I>&gt;<i>     &gt; HIER_DIRECT/91.235.133.74 &lt;<A HREF="http://91.235.133.74">http://91.235.133.74</A>&gt;
</I>&gt;<i>     &lt;<A HREF="http://91.235.133.74">http://91.235.133.74</A>&gt; -
</I>&gt;<i>     &gt; 1588678050.355 &#160; 2552 10.0.2.15 TCP_TUNNEL/200 788 CONNECT
</I>&gt;<i>     &gt; nav.sciencedirect.com:443 &lt;<A HREF="http://nav.sciencedirect.com:443">http://nav.sciencedirect.com:443</A>&gt;
</I>&gt;<i>     &lt;<A HREF="http://nav.sciencedirect.com:443">http://nav.sciencedirect.com:443</A>&gt; akshay
</I>&gt;<i>     &gt; HIER_DIRECT/91.235.133.74 &lt;<A HREF="http://91.235.133.74">http://91.235.133.74</A>&gt;
</I>&gt;<i>     &lt;<A HREF="http://91.235.133.74">http://91.235.133.74</A>&gt; -
</I>&gt;<i>     &gt; 1588681419.635 &#160; &#160;647 10.0.2.15 TCP_MISS/200 402 POST
</I>&gt;<i>     &gt; <A HREF="http://scratchpads.eu/modules/statistics/statistics.php">http://scratchpads.eu/modules/statistics/statistics.php</A> akshay
</I>&gt;<i>     &gt; HIER_DIRECT/157.140.2.32 &lt;<A HREF="http://157.140.2.32">http://157.140.2.32</A>&gt;
</I>&gt;<i>     &lt;<A HREF="http://157.140.2.32">http://157.140.2.32</A>&gt; text/html
</I>&gt;<i>     &gt; 1588681420.055 &#160; 1069 10.0.2.15 TCP_MISS/200 46772 GET
</I>&gt;<i>     &gt;
</I>&gt;<i>     <A HREF="http://scratchpads.eu/sites/all/themes/scratchpads_eu/images/shrimp-202px.png">http://scratchpads.eu/sites/all/themes/scratchpads_eu/images/shrimp-202px.png</A>
</I>&gt;<i>     &gt; akshay HIER_DIRECT/157.140.2.32 &lt;<A HREF="http://157.140.2.32">http://157.140.2.32</A>&gt;
</I>&gt;<i>     &lt;<A HREF="http://157.140.2.32">http://157.140.2.32</A>&gt; image/png
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; On Sat, May 2, 2020 at 1:00 AM Alex Rousskov
</I>&gt;<i>     &gt; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt;
</I>&gt;<i>     &gt; &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt;&gt;&gt; wrote:
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;On 5/1/20 12:43 PM, Akshay Hegde wrote:
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; I have below option globally, which I don't want to make &quot;off&quot;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; strip_query_terms on
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; acl track dstdomain &quot;/etc/squid/sites_track.txt&quot;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; access_log /var/log/squid/full_site_links.log squid_custom track
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; however for specific ACL I would like to log full URL with query
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; parameters, how this can be done ?
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;I have not tested this, and the results may be
</I>&gt;<i>     version-dependent, but
</I>&gt;<i>     &gt;&#160; &#160; &#160;according to logformat documentation[1], %ru honors
</I>&gt;<i>     strip_query_terms
</I>&gt;<i>     &gt;&#160; &#160; &#160;while %&gt;ru does not:
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&#160; &#160; logformat strippedFormat %ts... %ru ...
</I>&gt;<i>     &gt;&#160; &#160; &#160;&#160; &#160; access_log ... strippedFormat track !specific_ACL
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&#160; &#160; logformat detailedFormat %ts... %&gt;ru ...
</I>&gt;<i>     &gt;&#160; &#160; &#160;&#160; &#160; access_log ... detailedFormat track specific_ACL
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;[1] <A HREF="http://www.squid-cache.org/Doc/config/logformat/">http://www.squid-cache.org/Doc/config/logformat/</A>
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;HTH,
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;Alex.
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; On Fri, May 1, 2020 at 7:05 PM Alex Rousskov wrote:
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&#160; &#160; &#160;On 5/1/20 1:20 AM, Akshay Hegde wrote:
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&#160; &#160; &#160;&gt; *1. How to disable logging of few ACLs ?
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&#160; &#160; &#160;Use &quot;access_log none aclX&quot; to prevent creation of access.log
</I>&gt;<i>     &gt;&#160; &#160; &#160;records for
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&#160; &#160; &#160;transactions matching aclX. See
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&#160; &#160;
</I>&gt;<i>     &gt;&#160; &#160;
</I>&gt;<i>     &#160;&#160;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/2020-April/021876.html">http://lists.squid-cache.org/pipermail/squid-users/2020-April/021876.html</A>
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&#160; &#160; &#160;for
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&#160; &#160; &#160;some related caveats.
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&#160; &#160; &#160;&gt; *2. Kernel Out of Memory
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&#160; &#160; &#160;This problem is most likely unrelated to logging. If
</I>&gt;<i>     your Squid is
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&#160; &#160; &#160;gradually leaking memory (rather than just being
</I>&gt;<i>     overwhelmed with
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&#160; &#160; &#160;traffic), then the first step towards removing those memory
</I>&gt;<i>     &gt;&#160; &#160; &#160;leaks would
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&#160; &#160; &#160;be to upgrade your Squid from the unsupported and buggy
</I>&gt;<i>     v3.1.10.
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="022084.html">[squid-users] squid logging disable based on ACL &amp; kernel: Out	of memory
</A></li>
	<LI>Next message (by thread): <A HREF="022045.html">[squid-users] squid logging disable based on ACL &amp; kernel: Out of memory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22085">[ date ]</a>
              <a href="thread.html#22085">[ thread ]</a>
              <a href="subject.html#22085">[ subject ]</a>
              <a href="author.html#22085">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
