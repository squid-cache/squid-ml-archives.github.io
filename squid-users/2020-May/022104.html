<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] SQUID PROBLEM WITH SITES THAT HAVE MORE THAN ONE IP ADDRESSES
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SQUID%20PROBLEM%20WITH%20SITES%20THAT%20HAVE%20MORE%20THAN%20ONE%0A%20IP%20ADDRESSES&In-Reply-To=%3C20f4fe4b-972b-09d8-58ac-33ce62cb03fe%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022103.html">
   <LINK REL="Next"  HREF="022105.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] SQUID PROBLEM WITH SITES THAT HAVE MORE THAN ONE IP ADDRESSES</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SQUID%20PROBLEM%20WITH%20SITES%20THAT%20HAVE%20MORE%20THAN%20ONE%0A%20IP%20ADDRESSES&In-Reply-To=%3C20f4fe4b-972b-09d8-58ac-33ce62cb03fe%40treenet.co.nz%3E"
       TITLE="[squid-users] SQUID PROBLEM WITH SITES THAT HAVE MORE THAN ONE IP ADDRESSES">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon May 11 09:17:24 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="022103.html">[squid-users] SQUID PROBLEM WITH SITES THAT HAVE MORE THAN ONE IP	ADDRESSES
</A></li>
        <LI>Next message (by thread): <A HREF="022105.html">[squid-users] SQUID PROBLEM WITH SITES THAT HAVE MORE THAN ONE IP	ADDRESSES
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22104">[ date ]</a>
              <a href="thread.html#22104">[ thread ]</a>
              <a href="subject.html#22104">[ subject ]</a>
              <a href="author.html#22104">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 11/05/20 8:57 pm, <A HREF="https://lists.squid-cache.org/listinfo/squid-users">leomessi983 at yahoo.com</A> wrote:
&gt;<i> HI
</I>&gt;<i> COULD YOU PLEASE HELP ME?
</I>
Please don't yell.

&gt;<i> IN INTERCEPTED TOPOLOGY WITH TPROXY I HAVE PROBLEM.
</I>&gt;<i> 
</I>&gt;<i> WHAT IS SQUID SOLUTION FOR SITES THAT HAVE MORE THAN ONE IP ADDRESSES?
</I>&gt;<i> FOR EXAMPLE SITE LIKE GOOGLE.COM RETURN DIFFERENT IP ADDRESS IN EVERY
</I>&gt;<i> REQUEST AND IF CLIENT GET IP ADDRESS FOR EXAMPLE 1.1.1.1 THAT IS
</I>&gt;<i> POSSIBLE THAT SQUID GET 2.2.2.2 FOR GOOGLE AND SQUID CAN NOT WORK
</I>&gt;<i> PROBABLE AND SHOW FORGERY DETECTED ERROR.
</I>&gt;<i> 
</I>
Squid will still serve requests with Host header forgery issues. All
that will happen is Squid will not cache the response - so no other
clients get corrupted.


&gt;<i> IS THERE ANY WAY TO IGNORE THIS OR USE ONLY ONE DNS SERVER OR PREVENT
</I>&gt;<i> SQUID OR CLIENT TO NOT RESOLVE URLS?
</I>

see &lt;<A HREF="https://wiki.squid-cache.org/KnowledgeBase/HostHeaderForgery">https://wiki.squid-cache.org/KnowledgeBase/HostHeaderForgery</A>&gt;

Amos

&gt;<i> 
</I>&gt;<i> I use same DNS-Server on my clients and my squid server.
</I>&gt;<i> 
</I>&gt;<i> Is there any configuration directive in squid to does not resolve requested URLs from client or use their resolved IP addresses?
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> I use this configuration:
</I>&gt;<i> 
</I>&gt;<i> acl acl1 clientside_mark *****
</I>&gt;<i> tcp_outgoing_mark ***** acl1
</I>&gt;<i> acl https1 ssl::server_name &quot;/Files/blklist&quot;
</I>&gt;<i> ssl_bump bump https1 acl1
</I>&gt;<i> acl url1 dstdomain &quot;/Files/blklist&quot;
</I>&gt;<i> acl Regex1 url_regex &quot;/Files/Reglist&quot;
</I>&gt;<i> http_access deny Regex1 acl1
</I>&gt;<i> http_access deny url1 acl1
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> #Http configurations
</I>&gt;<i> http_access allow all
</I>
Do not do that.


&gt;<i> http_port 0.0.0.0:3128
</I>&gt;<i> http_port 0.0.0.0:3129 tproxy disable-pmtu-discovery=transparent
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> #Https configurations
</I>&gt;<i> reply_header_access Strict-Transport-Security deny all
</I>&gt;<i> https_port 3130 tproxy ssl-bump \
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160; tls-cert=/conf/cert.cer \
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160; tls-key=/conf/cert.key \
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160; generate-host-certificates=on dynamic_cert_mem_cache_size=20MB
</I>&gt;<i> disable-pmtu-discovery=transparent
</I>&gt;<i> sslcrtd_program /usr/lib64/squid/security_file_certgen -s
</I>&gt;<i> /var/lib/ssl_db -M 20MB
</I>&gt;<i> sslcrtd_children 10 startup=5 idle=1
</I>&gt;<i> acl step1 at_step SslBump1
</I>&gt;<i> ssl_bump peek step1
</I>&gt;<i> ssl_bump splice all
</I>&gt;<i> 
</I>&gt;<i> I got this error messeges:
</I>&gt;<i> 
</I>...
&gt;<i> May 10 12:47:54 squid[23231] [daemon:info:1e]: 2020/05/10 12:47:54| ERROR: negotiating TLS on FD 523: error:14090086:SSL routines:ssl3_get_server_certificate:certificate verify failed (1/-1/0)
</I>&gt;<i> May 10 12:47:54 squid[23231] [daemon:info:1e]: 2020/05/10 12:47:54| Error negotiating SSL connection on FD 518: error:00000001:lib(0):func(0):reason(1) (1/0)
</I>
So TLS is not working. This is your worst problem.

&gt;<i> May 10 12:47:58 squid[23231] [daemon:info:1e]: 2020/05/10 12:47:58| Squid Cache (Version 4.7): Terminated abnormally.
</I>
Please upgrade. Current v4 is 4.11.

You may want to consider upgrade to the latest v5 release for better
SSL-Bump behaviour.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="022103.html">[squid-users] SQUID PROBLEM WITH SITES THAT HAVE MORE THAN ONE IP	ADDRESSES
</A></li>
	<LI>Next message (by thread): <A HREF="022105.html">[squid-users] SQUID PROBLEM WITH SITES THAT HAVE MORE THAN ONE IP	ADDRESSES
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22104">[ date ]</a>
              <a href="thread.html#22104">[ thread ]</a>
              <a href="subject.html#22104">[ subject ]</a>
              <a href="author.html#22104">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
