<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Sending CONNECT method requests over HTTPS
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Sending%20CONNECT%20method%20requests%20over%20HTTPS&In-Reply-To=%3C4666633b-9f98-5111-119e-43201d80b51b%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022132.html">
   <LINK REL="Next"  HREF="022141.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Sending CONNECT method requests over HTTPS</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Sending%20CONNECT%20method%20requests%20over%20HTTPS&In-Reply-To=%3C4666633b-9f98-5111-119e-43201d80b51b%40measurement-factory.com%3E"
       TITLE="[squid-users] Sending CONNECT method requests over HTTPS">rousskov at measurement-factory.com
       </A><BR>
    <I>Wed May 20 13:42:12 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="022132.html">[squid-users] Sending CONNECT method requests over HTTPS
</A></li>
        <LI>Next message (by thread): <A HREF="022141.html">[squid-users] Sending CONNECT method requests over HTTPS
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22135">[ date ]</a>
              <a href="thread.html#22135">[ thread ]</a>
              <a href="subject.html#22135">[ subject ]</a>
              <a href="author.html#22135">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 5/20/20 6:07 AM, Matus UHLAR - fantomas wrote:
&gt;<i> On 20.05.20 05:07, Ronan Lucio wrote:
</I>&gt;&gt;<i> I read a similar thread a couple of weeks ago, but my scenario has
</I>&gt;&gt;<i> some differences.
</I>&gt;&gt;<i> Anyway, my need is sending CONNECT method requests over HTTPS as well.
</I>
&gt;<i> already possible.
</I>
I assume that, here and below, &quot;over HTTPS&quot; means &quot;to an HTTPS proxy&quot;.

Yes, any HTTP request, including CONNECT can be sent to an HTTPS proxy.


&gt;&gt;<i> 1) To send CONNECT method requests over HTTPS I'm supposed to use
</I>&gt;&gt;<i> https_port.
</I>
&gt;<i> no. It's very common to use HTTP proxy over HTTP, and the CONNECT requests
</I>&gt;<i> creates communication between client and server
</I>
The question is difficult to interpret correctly. Here are arguably
better questions (with answers):

Q: If I want to use an HTTPS proxy, what Squid port should I configure?
A: You must use an https_port directive.

Q: Does https_port support CONNECT requests?
A: Yes. Squid https_port supports all HTTP requests supported by
   http_port, including CONNECT.

Q: How does Squid, in an HTTPS proxy mode, handle a CONNECT request?
A: Squid handles it as it would handle a CONNECT request
   received over an http_port (by default) -- by establishing a TCP
   tunnel to the origin server and shoveling bytes back and force.
   The client-Squid portion of that tunnel would be protected by
   TLS in this case, of course -- that is always true for an HTTPS
   proxy. SslBump features are not supported in HTTPS mode (yet).


&gt;&gt;<i> May I use it on the same way as http_port (without intercept, proxy,
</I>&gt;&gt;<i> or accelerate)?
</I>
&gt;<i> yes.
</I>
Q: Can https_port be used without an explicit mode (i.e., without
   an intercept, tproxy, accel, or ssl-bump parameter)?
A: Yes. The https_port directive supports the default (i.e. forward
   proxy) mode.

Q: What happens when https_port is used without an explicit mode?
A: Traffic on such https_port is treated as if Squid was an HTTPS proxy.


&gt;&gt;<i> 2) If I need to apply ACL rules to restrict some destinations, I'm
</I>&gt;&gt;<i> supposed to use bump_ssl.
</I>&gt;<i> 
</I>&gt;<i> without bumping, you can only see the destination host:port and possible
</I>&gt;<i> hostname sent in the SNI request and contents of the SSL certificate.
</I>
Again, it is difficult to interpret this question correctly. Here are a
few versions with correct answers:

Q: Can I use ssl_bump with an HTTPS proxy?
A: No, that is not supported yet.

Q: What ACLs can I use in an HTTPS proxy mode?
A: All ACLs that do not require inspecting packets inside
   TLS connections from client to origin. Please note that
   a single client-origin TLS connection involves two
   TCP connections. That inspection is what SslBump does (among
   other things). This answer is (too) complex. Unfortunately,
   there is currently no documentation that, for every ACL,
   details precisely what information sources are required for
   that ACL to work. Some ACLs use multiple information sources,
   depending on Squid configuration and/or transaction state,
   complicating the matters further.

Q: Is TLS origin SNI available to Squid ACLs in HTTPS proxy mode?
A: No, not today. SslBump features are not yet supported in that mode.

Q: Are URL paths of HTTP requests inside CONNECT tunnels
   available to Squid ACLS in HTTPS proxy mode?
A: No, not today. SslBump features are not yet supported in that mode.


HTH,

Alex.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="022132.html">[squid-users] Sending CONNECT method requests over HTTPS
</A></li>
	<LI>Next message (by thread): <A HREF="022141.html">[squid-users] Sending CONNECT method requests over HTTPS
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22135">[ date ]</a>
              <a href="thread.html#22135">[ thread ]</a>
              <a href="subject.html#22135">[ subject ]</a>
              <a href="author.html#22135">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
