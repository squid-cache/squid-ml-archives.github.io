<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] issues with sslbump and &quot;Host header forgery detected&quot; warnings
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20issues%20with%20sslbump%20and%20%22Host%20header%20forgery%0A%20detected%22%20warnings&In-Reply-To=%3C355e9d18-e781-33ed-c885-6a94f8bb7f14%40solutti.com.br%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022917.html">
   <LINK REL="Next"  HREF="022915.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] issues with sslbump and &quot;Host header forgery detected&quot; warnings</H1>
    <B>Leonardo Rodrigues</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20issues%20with%20sslbump%20and%20%22Host%20header%20forgery%0A%20detected%22%20warnings&In-Reply-To=%3C355e9d18-e781-33ed-c885-6a94f8bb7f14%40solutti.com.br%3E"
       TITLE="[squid-users] issues with sslbump and &quot;Host header forgery detected&quot; warnings">leolistas at solutti.com.br
       </A><BR>
    <I>Mon Nov  9 13:41:20 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="022917.html">[squid-users] issues with sslbump and &quot;Host header forgery detected&quot; warnings
</A></li>
        <LI>Next message (by thread): <A HREF="022915.html">[squid-users] Squid4/5: Feature request identify access rules.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22919">[ date ]</a>
              <a href="thread.html#22919">[ thread ]</a>
              <a href="subject.html#22919">[ subject ]</a>
              <a href="author.html#22919">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Em 07/11/2020 22:19, Eliezer Croitor escreveu:
&gt;<i> Hey Leonardo,
</I>&gt;<i>
</I>&gt;<i> I assume The best solution for you is a simple SNI proxy.
</I>&gt;<i> Squid does also that and you can try to debug this issue to make sure you understand what is wrong.
</I>&gt;<i> It clearly states that Squid doesn't see this specific address: local=216.58.222.106:443
</I>&gt;<i> As the domain: chromesyncpasswords-pa.googleapis.com:443 &quot;real&quot; destination address.
</I>&gt;<i>
</I>&gt;<i> Maybe Alex or Amos remember the exact and relevant debug_options:
</I>&gt;<i> <A HREF="https://wiki.squid-cache.org/KnowledgeBase/DebugSections">https://wiki.squid-cache.org/KnowledgeBase/DebugSections</A>
</I>&gt;<i>
</I>&gt;<i> I assume section 78 would be of help.
</I>&gt;<i> debug_options ALL,1 78,3
</I>&gt;<i>
</I>&gt;<i> Is probably enough to discover what are the DNS responses and from where these are.
</I>&gt;<i> On what OS are you running this Squid?
</I>&gt;<i>
</I>&gt;<i>
</I>
 &#160;&#160;&#160; Hi Eliezer,

 &#160;&#160;&#160; I have already tracked the DNS stuff and I could confirm that squid 
is resolving to a different IP address than the client is, despite both 
using the same DNS server. It only happens for hosts with multiple A 
addresses or CDN hostnames that changes IP very often (every 10 seconds 
for example). It's not a bug in that regards, absolutely not, the client 
connecting to a specific IP address and squid seeing another IP to that 
hostname caught on the TLS transaction is real.

 &#160;&#160;&#160; I'm running on CentOS 8 ... and after all, maybe these findings, 
I'm about to realize doing this kind of interception, even without the 
full decrypt part, is not trivial at all, despite it works flawlessly 
(and very easily) for &quot;regular&quot; hostnames which translates to a single 
IP and never changes it.

 &#160;&#160;&#160; Will study this a little more. Thanks for your observations and 
recommendations!



-- 


	Atenciosamente / Sincerily,
	Leonardo Rodrigues
	Solutti Tecnologia
	<A HREF="http://www.solutti.com.br">http://www.solutti.com.br</A>

	Minha armadilha de SPAM, N&#195;O mandem email
	<A HREF="https://lists.squid-cache.org/listinfo/squid-users">gertrudes at solutti.com.br</A>
	My SPAMTRAP, do not email it




</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="022917.html">[squid-users] issues with sslbump and &quot;Host header forgery detected&quot; warnings
</A></li>
	<LI>Next message (by thread): <A HREF="022915.html">[squid-users] Squid4/5: Feature request identify access rules.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22919">[ date ]</a>
              <a href="thread.html#22919">[ thread ]</a>
              <a href="subject.html#22919">[ subject ]</a>
              <a href="author.html#22919">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
