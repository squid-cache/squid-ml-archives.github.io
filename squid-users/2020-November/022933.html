<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] auth_param tls? limiting proxy access based on client TLS authentication
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20auth_param%20tls%3F%20limiting%20proxy%20access%20based%20on%0A%20client%20TLS%20authentication&In-Reply-To=%3C6c15f9b1-2487-7e90-9831-9033954e00ea%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022932.html">
   <LINK REL="Next"  HREF="022934.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] auth_param tls? limiting proxy access based on client TLS authentication</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20auth_param%20tls%3F%20limiting%20proxy%20access%20based%20on%0A%20client%20TLS%20authentication&In-Reply-To=%3C6c15f9b1-2487-7e90-9831-9033954e00ea%40treenet.co.nz%3E"
       TITLE="[squid-users] auth_param tls? limiting proxy access based on client TLS authentication">squid3 at treenet.co.nz
       </A><BR>
    <I>Sat Nov 14 03:24:43 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="022932.html">[squid-users] auth_param tls? limiting proxy access based on client TLS authentication
</A></li>
        <LI>Next message (by thread): <A HREF="022934.html">[squid-users] auth_param tls? limiting proxy access based on client TLS authentication
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22933">[ date ]</a>
              <a href="thread.html#22933">[ thread ]</a>
              <a href="subject.html#22933">[ subject ]</a>
              <a href="author.html#22933">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 14/11/20 8:30 am, Bob Rich wrote:
&gt;<i> 
</I>&gt;<i> I've got squid configured as an old-school explicit forward proxy.
</I>&gt;<i> 
</I>&gt;<i> I would like to limit access through the proxy to only those clients 
</I>&gt;<i> that authenticate either to an HTTPS proxy listener or via client auth 
</I>&gt;<i> injected into a CONNECT request to the origin server.&#160; Please note that 
</I>&gt;<i> in this use case the origin server is not expecting TLS auth in any 
</I>&gt;<i> way.&#160; This is just being used initially to prevent unauthenticated 
</I>&gt;<i> clients from using the proxy.
</I>&gt;<i> 
</I>
You seem to have been confused by the presence of TLS / HTTPS.

 From your description it appears that the clients are talking to Squid 
using HTTP. Any authentication they send to Squid has to be using HTTP 
Authentication. Which is validated by the auth_param helper and 
proxy_auth ACL type.
  &lt;<A HREF="https://wiki.squid-cache.org/Features/Authentication">https://wiki.squid-cache.org/Features/Authentication</A>&gt;


To a regular forward-proxy a CONNECT request is an instruction to open a 
TCP tunnel to the origin. There is no way to pass authentication 
credentials in a TCP SYN packet. So the origin will not be aware of 
*which* client authenticated.

However, the way you described your requirement implies that the origin 
does not need the credentials anyway. It is only the proxy which cares 
about auth to decide whether to relay or block a client.



&gt;<i> Ideally we would be able to base access control on information derived 
</I>&gt;<i> from subject DN or other attributes in the certificate, but I'm just 
</I>&gt;<i> aiming for basic functionality right now.
</I>&gt;<i> 
</I>
That requires a completely different design for the proxy architecture. 
One which has no relation to HTTP authentication at all.


If you really want this TLS certification to be the primary access for 
clients I think it better to concentrate on getting that design working, 
then add any HTTP auth as a backup later.



&gt;<i> I built 4.13 locally on Ubuntu and as far as I can tell all of the other 
</I>&gt;<i> SSL features are working (ssl_bump, generate-host-certificates, etc)
</I>&gt;<i> 
</I>&gt;<i> Thanks in advance for any advice!
</I>&gt;<i> 
</I>

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="022932.html">[squid-users] auth_param tls? limiting proxy access based on client TLS authentication
</A></li>
	<LI>Next message (by thread): <A HREF="022934.html">[squid-users] auth_param tls? limiting proxy access based on client TLS authentication
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22933">[ date ]</a>
              <a href="thread.html#22933">[ thread ]</a>
              <a href="subject.html#22933">[ subject ]</a>
              <a href="author.html#22933">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
