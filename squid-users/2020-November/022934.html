<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] auth_param tls? limiting proxy access based on client TLS authentication
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20auth_param%20tls%3F%20limiting%20proxy%20access%20based%20on%0A%20client%20TLS%20authentication&In-Reply-To=%3CCAJkLLZ3BTL1BXE2mSaj5kTaR7BBirrFBtnDsqidusJ%3DiAe7hHQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022933.html">
   <LINK REL="Next"  HREF="022935.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] auth_param tls? limiting proxy access based on client TLS authentication</H1>
    <B>Bob Rich</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20auth_param%20tls%3F%20limiting%20proxy%20access%20based%20on%0A%20client%20TLS%20authentication&In-Reply-To=%3CCAJkLLZ3BTL1BXE2mSaj5kTaR7BBirrFBtnDsqidusJ%3DiAe7hHQ%40mail.gmail.com%3E"
       TITLE="[squid-users] auth_param tls? limiting proxy access based on client TLS authentication">bobrich at gmail.com
       </A><BR>
    <I>Sat Nov 14 18:53:40 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="022933.html">[squid-users] auth_param tls? limiting proxy access based on client TLS authentication
</A></li>
        <LI>Next message (by thread): <A HREF="022935.html">[squid-users] auth_param tls? limiting proxy access based on client TLS authentication
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22934">[ date ]</a>
              <a href="thread.html#22934">[ thread ]</a>
              <a href="subject.html#22934">[ subject ]</a>
              <a href="author.html#22934">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks for the reply Amos.

Couple of quick points

1 - Nothing exists today aside from a little prototyping environment, so
anything that's possible is still in play.
2 - The CA issuing the client certificates and any signing certificates for
the proxy is internal.  Just to reinforce, the web applications that the
clients intend to access have no knowledge of the CA or requirement for
client certificate authentication.

Stating the goal possibly in another way, only clients that possess this
internally issued client certificate should be able to connect to a web
application through the proxy.  If the client does not have a certificate,
there is no requirement around whether or not it can connect to the proxy
and issue requests...the only requirement is that any requests to connect
to applications on the other side of the proxy fail.

On Fri, Nov 13, 2020 at 10:33 PM Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; wrote:

&gt;<i>  From your description it appears that the clients are talking to Squid
</I>&gt;<i> using HTTP. Any authentication they send to Squid has to be using HTTP
</I>&gt;<i> Authentication. Which is validated by the auth_param helper and
</I>&gt;<i> proxy_auth ACL type.
</I>&gt;<i>   &lt;<A HREF="https://wiki.squid-cache.org/Features/Authentication">https://wiki.squid-cache.org/Features/Authentication</A>&gt;
</I>&gt;<i>
</I>
Agree, this seems to be a non-starter for the reasons you describe.  We do
not wish to use HTTP authorization headers if it can be avoided.


&gt;<i> However, the way you described your requirement implies that the origin
</I>&gt;<i> does not need the credentials anyway. It is only the proxy which cares
</I>&gt;<i> about auth to decide whether to relay or block a client.
</I>&gt;<i>
</I>
This is correct.

To me there are only a few options for introducing TLS client certificate
authentication.

1 - Run TLS on the proxy listener.  This would use https_port directive and
would require that we are able to configure the proxy to mandate client
certificates before allowing the connection to complete.  Clients with
no/invalid certificates wouldn't even get to the point where they can send
a request to the proxy.

2 - Use ssl-bump functionality to modify the TLS handshake that occurs
after a CONNECT request to require a valid client certificate before
completing the request.  No idea if this is possible.

3 - Use either of the above to establish the mutually authenticated TLS
context and then surface that information through ICAP to offload the
authorization decision.

I've been able to get ssl-bump working to generate custom certs and I have
Squid talking to c-icap. I haven't successfully got Squid to prompt the
client to authenticate and I still have quite a bit of learning to do on
the ICAP side.

Thanks in advance for any steers (including 'this is a terrible idea' of
course :)

Lastly I haven't used gmail with a mailing list before.  Let me know if
i've stomping on some etiquette.


&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20201114/f3f5aff7/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20201114/f3f5aff7/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="022933.html">[squid-users] auth_param tls? limiting proxy access based on client TLS authentication
</A></li>
	<LI>Next message (by thread): <A HREF="022935.html">[squid-users] auth_param tls? limiting proxy access based on client TLS authentication
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22934">[ date ]</a>
              <a href="thread.html#22934">[ thread ]</a>
              <a href="subject.html#22934">[ subject ]</a>
              <a href="author.html#22934">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
