<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] auth_param tls? limiting proxy access based on client TLS authentication
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20auth_param%20tls%3F%20limiting%20proxy%20access%20based%20on%0A%20client%20TLS%20authentication&In-Reply-To=%3Cc6f71e27-5fd2-ae3b-4547-2bf4ceeb4876%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022934.html">
   <LINK REL="Next"  HREF="022936.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] auth_param tls? limiting proxy access based on client TLS authentication</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20auth_param%20tls%3F%20limiting%20proxy%20access%20based%20on%0A%20client%20TLS%20authentication&In-Reply-To=%3Cc6f71e27-5fd2-ae3b-4547-2bf4ceeb4876%40measurement-factory.com%3E"
       TITLE="[squid-users] auth_param tls? limiting proxy access based on client TLS authentication">rousskov at measurement-factory.com
       </A><BR>
    <I>Sat Nov 14 22:26:57 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="022934.html">[squid-users] auth_param tls? limiting proxy access based on client TLS authentication
</A></li>
        <LI>Next message (by thread): <A HREF="022936.html">[squid-users] Gather POST request on HTTPS traffic?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22935">[ date ]</a>
              <a href="thread.html#22935">[ thread ]</a>
              <a href="subject.html#22935">[ subject ]</a>
              <a href="author.html#22935">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 11/14/20 1:53 PM, Bob Rich wrote:

&gt;<i> 1 - Run TLS on the proxy listener.&#160; This would use https_port directive
</I>&gt;<i> and would require that we are able to configure the proxy to mandate
</I>&gt;<i> client certificates before allowing the connection to complete.&#160; Clients
</I>&gt;<i> with no/invalid certificates wouldn't even get to the point where they
</I>&gt;<i> can send a request to the proxy.
</I>
Yes, this is how certificate-based authentication is usually done with
Squid. There are large Squid deployments using this mechanism. It is
also the most secure method of using a proxy...

    https_port 3443 clientca=auth.pem tls-cert=squid.pem ...

The biggest problem with this approach is being able to configure
clients to use an HTTPS proxy (as opposed to using an HTTP proxy for
HTTPS traffic). Popular browsers support HTTPS proxies (but may require
PAC-based configuration to enable that support[1]). Many clients do not
support HTTPS proxies.

[1] Look for &quot;HTTPS proxy&quot; at
<A HREF="https://developer.mozilla.org/en-US/docs/Web/HTTP/Proxy_servers_and_tunneling/Proxy_Auto-Configuration_(PAC">https://developer.mozilla.org/en-US/docs/Web/HTTP/Proxy_servers_and_tunneling/Proxy_Auto-Configuration_(PAC</A>)_file

Please note that one cannot combine SslBump and certificate-based client
authentication on the same port (yet?).

BTW, the other two options for certificate-based authentication that you
were thinking about will not work out of the box, for various reasons.


HTH,

Alex.


&gt;<i> 2 - Use ssl-bump functionality to modify the TLS handshake that occurs
</I>&gt;<i> after a CONNECT request to require a valid client certificate before
</I>&gt;<i> completing the request.&#160; No idea if this is possible.
</I>&gt;<i> 
</I>&gt;<i> 3 - Use either of the above to establish the mutually authenticated TLS
</I>&gt;<i> context and then surface that information through ICAP to offload the
</I>&gt;<i> authorization decision.
</I>&gt;<i> 
</I>&gt;<i> I've been able to get ssl-bump working to generate custom certs and I
</I>&gt;<i> have Squid talking to c-icap. I haven't successfully got Squid to prompt
</I>&gt;<i> the client to authenticate and I still have quite a bit of learning to
</I>&gt;<i> do on the ICAP side.
</I>&gt;<i> 
</I>&gt;<i> Thanks in advance for any steers (including 'this is a terrible idea' of
</I>&gt;<i> course :)
</I>&gt;<i> 
</I>&gt;<i> Lastly I haven't used gmail with a mailing list before.&#160; Let me know if
</I>&gt;<i> i've stomping on some etiquette.
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="022934.html">[squid-users] auth_param tls? limiting proxy access based on client TLS authentication
</A></li>
	<LI>Next message (by thread): <A HREF="022936.html">[squid-users] Gather POST request on HTTPS traffic?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22935">[ date ]</a>
              <a href="thread.html#22935">[ thread ]</a>
              <a href="subject.html#22935">[ subject ]</a>
              <a href="author.html#22935">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
