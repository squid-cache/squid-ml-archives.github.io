<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Debugging a slow Squid?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Debugging%20a%20slow%20Squid%3F&In-Reply-To=%3C011801d6c5b7%2440c68f50%24c253adf0%24%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022960.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Debugging a slow Squid?</H1>
    <B>Eliezer Croitor</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Debugging%20a%20slow%20Squid%3F&In-Reply-To=%3C011801d6c5b7%2440c68f50%24c253adf0%24%40gmail.com%3E"
       TITLE="[squid-users] Debugging a slow Squid?">ngtech1ltd at gmail.com
       </A><BR>
    <I>Sat Nov 28 18:49:49 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="022960.html">[squid-users] Debugging a slow Squid?
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22961">[ date ]</a>
              <a href="thread.html#22961">[ thread ]</a>
              <a href="subject.html#22961">[ subject ]</a>
              <a href="author.html#22961">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I must add that to verify any browsing speed issue there are couple very specific tests which should be tested:
- DNS response speed, response content ie A/AAAA/CNAME etc..
- Basic traceroute tests
- periodic Ping tests
- CPU load(top, htop, others..)
- curl/wget/other specific pages speed download tests
- Another http/socks proxy (tinyproxy/others, see the root folder of the onedrive shared link)
   <A HREF="https://onedrive.live.com/?authkey=%21AFs60Exv3C4B%2DNI&amp;id=6AB28772521B8B88%214385&amp;cid=6AB28772521B8B88">https://onedrive.live.com/?authkey=%21AFs60Exv3C4B%2DNI&amp;id=6AB28772521B8B88%214385&amp;cid=6AB28772521B8B88</A>

Depend on the up-stream line.
A microwave link can work well for 50-100 Meters however when rain drops pop here and there you would even see 3000ms plus++ delays.
There are ways to compensate on these but these are measurable enough so you would know about them.

I would start with:
How can I make Squid work almost with no DISK?
access_log none ? access_log stdio:/dev/null ?
cache deny all ?
cache_mem 0 MB ?

Adding a local dns cache might resolve many issues(bind, unbound, dnsmasq..)
Without writing a book.
What might cache_mgr interface has to say about this?

----
Eliezer Croitoru
Tech Support
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A>

-----Original Message-----
From: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; On Behalf Of Alex Rousskov
Sent: Saturday, November 28, 2020 6:24 PM
To: roee klinger &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">roeeklinger60 at gmail.com</A>&gt;; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] Debugging a slow Squid?

On 11/28/20 7:00 AM, roee klinger wrote:

&gt;<i> I am aware of the &lt;tr&gt; in the Squid log, but does it show the time it
</I>&gt;<i> took Squid to process the request or does it also include the time it
</I>&gt;<i> took the request to even get to Squid (for example the time from the
</I>&gt;<i> router to Squid, from the user to the router, etc)?
</I>
Overall, do not expect Squid to measure what happens before the HTTP
request header is received. Squid could (and should and eventually will)
measure more than it does now when it comes to the beginning of the
transaction, but often there is just not enough information to measure
the client-Squid propagation/communication delay for the initial TCP
packet(s) or for the initial HTTP request packet on a previously used
persistent connection.

Specifically, %tr logformat code logs the difference between master
transaction start time and master transaction logging time.

* According to %tS documentation, Squid currently considers the master
transaction started when a complete HTTP request header initiating the
transaction is received from the client.

* Currently, Squid logs the master transaction when the client-Squid
transaction that was handling the client HTTP request gets destroyed.
Usually, that destruction happens when Squid receives the entire request
from the client and sends the entire response to that client.



&gt;<i> What would be the best way to isolate, inspect, and improve Squid
</I>&gt;<i> performance, regardless of network performance?
</I>
One could write a book answering this question, but I would start by
running atop to exclude system bottlenecks (memory, CPU, disk) first.
Once system/global bottlenecks are eliminated, you may be able to detect
processing stages that slow down the transaction the most by sending
representative test requests.


HTH,

Alex.
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="022960.html">[squid-users] Debugging a slow Squid?
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22961">[ date ]</a>
              <a href="thread.html#22961">[ thread ]</a>
              <a href="subject.html#22961">[ subject ]</a>
              <a href="author.html#22961">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
