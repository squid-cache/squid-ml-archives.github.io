<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] I want to know the concerns of load testing
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20I%20want%20to%20know%20the%20concerns%20of%20load%20testing&In-Reply-To=%3C2e0b245d-8e3e-b9a9-c440-e6c820a22339%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022796.html">
   <LINK REL="Next"  HREF="022804.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] I want to know the concerns of load testing</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20I%20want%20to%20know%20the%20concerns%20of%20load%20testing&In-Reply-To=%3C2e0b245d-8e3e-b9a9-c440-e6c820a22339%40treenet.co.nz%3E"
       TITLE="[squid-users] I want to know the concerns of load testing">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Oct  2 06:08:27 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="022796.html">[squid-users] I want to know the concerns of load testing
</A></li>
        <LI>Next message (by thread): <A HREF="022804.html">[squid-users] I want to know the concerns of load testing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22765">[ date ]</a>
              <a href="thread.html#22765">[ thread ]</a>
              <a href="subject.html#22765">[ subject ]</a>
              <a href="author.html#22765">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2/10/20 3:15 pm, m k wrote:
&gt;<i> Hello,
</I>&gt;<i> 
</I>&gt;<i> I'm planning a proxy renewal for a company with 45k clients.
</I>&gt;<i> I'm looking at the performance of a single Squid to determine the number
</I>&gt;<i> of Squids.
</I>&gt;<i> 
</I>&gt;<i> Environment: Virtual (OpenStack)
</I>&gt;<i> OS: CentOS8.1
</I>&gt;<i> CPU: 4 cores
</I>&gt;<i> MEM: 8GB
</I>&gt;<i> DISK: SATA30GB / 100GB
</I>
See our notes on relative disk JBOD / RAID performances.
&lt;<A HREF="https://wiki.squid-cache.org/SquidFaq/RAID">https://wiki.squid-cache.org/SquidFaq/RAID</A>&gt;


&gt;<i> Squid 4.4
</I>
I know it can be hard to get hold of newer packages on CentOS. Please do
try hard to upgrade to the 4.13 release for production. There have been
more than a few critical security issues fixed this past year.


&gt;<i> &#160;SSL Bump
</I>&gt;<i> &#160;Blacklist: 1,700k
</I>&gt;<i> &#160;auth: NTLM
</I>
NTLM is a major performance issue. With every request needing to be sent
twice it will essentially halve the traffic your proxy can serve to clients.

I do know that Squid used to be able to handle way more RPS than Windows
DC would like to handle. So the DC may be a bottleneck there.

Negotiate/Kerberos auth is the solution to all those problems. If you
are really interested in good performance avoid NTLM.


&gt;<i> &#160;cache: 4GB
</I>&gt;<i> 
</I>&gt;<i> In an environment with authentication disabled and SSL decoding enabled
</I>&gt;<i> A load test was performed with Jmeter.
</I>&gt;<i> 
</I>&gt;<i> Result: CPU high load (100rps-1000rps: CPU Usage 80-90%)
</I>&gt;<i> (Confirm with top command)
</I>&gt;<i> 
</I>
If the proxy is not using 100% of the core(s) it is supposed to be
using. Then you have not reached the capacity limits of the proxy.

What you do about that depends on whether you are trying to find
theoretical limits, or performance for a specific traffic profile.


For a specific traffic profile the measurement is likely hitting disk
I/O or network I/O limits. Double-check which it was - that is what to
change to improve performance.


For theoretical limits the same detail about I/O applies. But also to
max the proxy out fully you may need to tune the test traffic load for
either higher TCP connection concurrency, or to utilize less resource
consuming features. eg requests that will HIT on memory cached (small)
objects and only need simple fast-type ACL checks. Memory-only traffic
is approximately 100x faster than any involving disk I/O.

 To be clear this is to find the theoretical maximum performance. You
cannot tune clients real traffic like this.



&gt;<i> Added multi-core support settings to squid.conf
</I>&gt;<i> &quot;workers 4&quot;
</I>&gt;<i> 
</I>&gt;<i> A load test with Jmeter was performed again.
</I>&gt;<i> 
</I>&gt;<i> Result: CPU load is distributed to 4 cores (CPU Usage 20-40%)
</I>&gt;<i> (Confirm with top command)
</I>
See above. That 20% implies the same 80% is spread over 4 cores.


&gt;<i> 
</I>&gt;<i> Question
</I>&gt;<i> 1. 1. How much will CPU Usage increase if NTLM authentication is enabled?
</I>
NTLM requires 2 HTTP messages to authenticate every new TCP connection.
So there will be one extra HTTP message on every set of pipelined requests.

It depends on how many requests are pipelined on each TCP connection as
to how much impact that auth overhead is.


After disk I/O capacity the CPU cycles are what limit Squid most. The
RPS achievable is capped out when all CPU cores assigned for Squid reach
100%.


&gt;<i> 2. 2. Are there any concerns other than CPU Usage in Squid?
</I>
The usual bottlenecks:

 * disk I/O limits
 * Network latency (DNS in particular. In general, TCP to _everywhere_)
 * features used (CPU drains)
 * memory

The order is my own experience of service impact, YMMV


&gt;<i> 3. 3. When I enabled the cache in this test, the CPU Usage decreased,
</I>&gt;<i> but in general, does the Squid cache increase the CPU Usage?
</I>

In general cache should have little effect on CPU. Processing HTTP
headers is by far the major use of CPU cycles in Squid. SSL-Bump is
expected to be a close second, especially if decrypting.

In some cases it can. A large number of small cache objects can consume
many cycles CPU searching for an object. Or Range requests on very large
objects can spend a lot of cycles to generate the Range response HIT
payload.



HTH
Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="022796.html">[squid-users] I want to know the concerns of load testing
</A></li>
	<LI>Next message (by thread): <A HREF="022804.html">[squid-users] I want to know the concerns of load testing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22765">[ date ]</a>
              <a href="thread.html#22765">[ thread ]</a>
              <a href="subject.html#22765">[ subject ]</a>
              <a href="author.html#22765">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
