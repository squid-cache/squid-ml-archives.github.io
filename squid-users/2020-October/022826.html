<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] BUG 3556
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20BUG%203556&In-Reply-To=%3C074fa628-2b78-7d97-755e-6f059f534e7c%40borrill.org.uk%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022825.html">
   <LINK REL="Next"  HREF="022827.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] BUG 3556</H1>
    <B>Stephen Borrill</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20BUG%203556&In-Reply-To=%3C074fa628-2b78-7d97-755e-6f059f534e7c%40borrill.org.uk%3E"
       TITLE="[squid-users] BUG 3556">squid at borrill.org.uk
       </A><BR>
    <I>Thu Oct 15 08:07:54 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="022825.html">[squid-users] Help with with delay pools
</A></li>
        <LI>Next message (by thread): <A HREF="022827.html">[squid-users] BUG 3556
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22826">[ date ]</a>
              <a href="thread.html#22826">[ thread ]</a>
              <a href="subject.html#22826">[ subject ]</a>
              <a href="author.html#22826">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>At a few installations of squid 4.12 (patched for GREASE) on NetBSD 9,
I'm seeing that occasionally one of the listening ports no longer
accepts connections (it doesn't reject them, but a connection does not
get established). The port appears random; it's not the same every time
and isn't related to ports with SSL interception. A restart of squid
fixes it.

Looking through the logs, this appears to coincide with lines such as:

2020/10/14 22:32:16 kid1| ERROR: getsockname() failed to locate local-IP
on local=[::] remote=10.0.106.147:61996 FD 25 flags=1: (22) Invalid argument
2020/10/14 22:32:16 kid1| BUG 3556: FD 25 is not an open socket.

This looks similar to Alex Rousskov's recent observations:
<A HREF="https://bugs.squid-cache.org/show_bug.cgi?id=3556#c15">https://bugs.squid-cache.org/show_bug.cgi?id=3556#c15</A>

However, we have also seen with at sites where there is no SSL
interception (the above lines are from such an installation).

Based on this, I have 4 questions;

1) Am I right that triggering BUG 3556 could lead to the described symptoms?

2) Is this a squid bug or triggered by a problem in the underlying OS?
If the latter, where to start looking?

3) What workarounds are there? Given that a restart fixes it, in some
respects it would be better for squid to quit so it can be restarted
rather than continue to run in a half-working state.

4) Related to 3), are there any other ways to detect the problem when it
is happening besides parsing logs or testing if all ports are accepting
connections? This could be used to trigger an automated restart as a
temporary workaround.

-- 
Stephen

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="022825.html">[squid-users] Help with with delay pools
</A></li>
	<LI>Next message (by thread): <A HREF="022827.html">[squid-users] BUG 3556
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22826">[ date ]</a>
              <a href="thread.html#22826">[ thread ]</a>
              <a href="subject.html#22826">[ subject ]</a>
              <a href="author.html#22826">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
