<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] allow certian user ips to access only 2 domains and disallow everything
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20allow%20certian%20user%20ips%20to%20access%20only%202%20domains%0A%20and%20disallow%20everything&In-Reply-To=%3Ce64648f2-c570-35f8-e6bf-c9f4bc3eeb46%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022835.html">
   <LINK REL="Next"  HREF="022844.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] allow certian user ips to access only 2 domains and disallow everything</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20allow%20certian%20user%20ips%20to%20access%20only%202%20domains%0A%20and%20disallow%20everything&In-Reply-To=%3Ce64648f2-c570-35f8-e6bf-c9f4bc3eeb46%40treenet.co.nz%3E"
       TITLE="[squid-users] allow certian user ips to access only 2 domains and disallow everything">squid3 at treenet.co.nz
       </A><BR>
    <I>Sat Oct 17 02:58:54 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="022835.html">[squid-users] allow certian user ips to access only 2 domains and disallow everything
</A></li>
        <LI>Next message (by thread): <A HREF="022844.html">[squid-users] allow certian user ips to access only 2 domains and disallow everything
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22841">[ date ]</a>
              <a href="thread.html#22841">[ thread ]</a>
              <a href="subject.html#22841">[ subject ]</a>
              <a href="author.html#22841">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 16/10/20 10:21 pm, simon ben wrote:
&gt;<i> I have squid running perfectly fine on centos 7 64 bit with no issues
</I>&gt;<i> I want to allow certain user ips to access a few sites and block
</I>&gt;<i> everything else so below is the config
</I>&gt;<i> the sites are&#160;
</I>&gt;<i> 1) paloaltonetworks.com
</I>&gt;<i> 2) redcloak.secureworks.com
</I>&gt;<i> 
</I>
Notice the sitelist file contains the entire range of *.secureworks.com
domains and some others.


&gt;<i> in squid.conf
</I>&gt;<i> -------------------
</I>&gt;<i> acl userlist src &quot;/etc/squid/userlist&quot;
</I>&gt;<i> acl sitelist dstdomain &quot;/etc/squid/sitelist&quot;
</I>

# allow certain user ips to access a few sites
&gt;<i> http_access allow userlist sitelist
</I>&gt;<i> 
</I>
# ...  and block everything else

?? nothing specified for that part of your policy.


So, you need to followup with either:

  http_access deny all

or,

  http_access deny userips


&gt;<i> -------------------
</I>&gt;<i> 
</I>&gt;<i> user list file has the ips
</I>&gt;<i> -----------
</I>&gt;<i> 192.168.62.128
</I>&gt;<i> 192.168.62.1
</I>&gt;<i> 192.168.62.129
</I>&gt;<i> 192.168.61.1
</I>&gt;<i> 192.168.62.130
</I>&gt;<i> 192.168.62.3
</I>&gt;<i> 192.168.61.128
</I>&gt;<i> 172.16.120.160
</I>&gt;<i> ------------------------------
</I>&gt;<i> 
</I>
Er, these are not &quot;users&quot; these are IP addresses. Aka clients.

The difference is important because one machine/IP can be used by
multiple users. There is no difference to the proxy whether the IP is
switched between users or shared by multiple simultaneously.

Also, sorting the file can ease management. There are some entries which
could be represented by a IP-range for more efficient matching instead
of listed individually.



&gt;<i> site list file has the sites
</I>&gt;<i> ----------------------------------------
</I>&gt;<i> .paloaltonetworks.com
</I>&gt;<i> .secureworks.com
</I>&gt;<i> <A HREF="https://ch-baladia.traps.paloaltonetworks.com">https://ch-baladia.traps.paloaltonetworks.com</A>
</I>&gt;<i> baladia.xdr.eu.paloaltonetworks.com
</I>&gt;<i> identity.paloaltonetworks.com
</I>&gt;<i> login.paloaltonetworks.com
</I>&gt;<i> assets.adobedtm.com
</I>&gt;<i> www.paloaltonetworks.com
</I>&gt;<i> redcloak.secureworks.com
</I>&gt;<i> 
</I>&gt;<i> ------------------------------------------------
</I>&gt;<i> 
</I>&gt;<i> I see that the first page and some links are working but some do not .
</I>
Only the first two lines of that file are &quot;sites&quot;.

The third is a URL. This will never match with dstdomain.

The rest are individual domains. They will only match the one domain
within their site.

Also, most of your entries are sub-domains of the sites listed on the
first lines. The contents of this file redux to:


  .paloaltonetworks.com
  .secureworks.com
  assets.adobedtm.com


However, your stated policy says that it should only contain:

  .paloaltonetworks.com
  .redcloak.secureworks.com


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="022835.html">[squid-users] allow certian user ips to access only 2 domains and disallow everything
</A></li>
	<LI>Next message (by thread): <A HREF="022844.html">[squid-users] allow certian user ips to access only 2 domains and disallow everything
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22841">[ date ]</a>
              <a href="thread.html#22841">[ thread ]</a>
              <a href="subject.html#22841">[ subject ]</a>
              <a href="author.html#22841">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
