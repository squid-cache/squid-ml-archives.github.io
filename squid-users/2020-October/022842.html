<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] websockets through Squid
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20websockets%20through%20Squid&In-Reply-To=%3Cb6c6058f-504f-546e-73a6-838e74044514%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022836.html">
   <LINK REL="Next"  HREF="022843.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] websockets through Squid</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20websockets%20through%20Squid&In-Reply-To=%3Cb6c6058f-504f-546e-73a6-838e74044514%40treenet.co.nz%3E"
       TITLE="[squid-users] websockets through Squid">squid3 at treenet.co.nz
       </A><BR>
    <I>Sat Oct 17 03:03:00 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="022836.html">[squid-users] websockets through Squid
</A></li>
        <LI>Next message (by thread): <A HREF="022843.html">[squid-users] websockets through Squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22842">[ date ]</a>
              <a href="thread.html#22842">[ thread ]</a>
              <a href="subject.html#22842">[ subject ]</a>
              <a href="author.html#22842">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 17/10/20 3:07 am, Vieri wrote:
&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> I think I found something in the cache.log I posted before.
</I>&gt;<i> 
</I>&gt;<i> sendRequest: HTTP Server conn* local=PUB_IPv4_ADDR_3
</I>&gt;<i> ...
</I>&gt;<i> sendRequest: HTTP Server conn* local=PUB_IPv4_ADDR_2
</I>&gt;<i> 
</I>&gt;<i> It seems that Squid sometimes connects to the remote HTTP server with either one of the available addresses on the Squid box (eg. PUB_IPv4_ADDR_2, PUB_IPv4_ADDR_3, etc). These addresses are on ppp interfaces. In fact, I noticed that if the Firefox client shows this error message in its console as in my previous post:
</I>&gt;<i> 
</I>&gt;<i> The connection to <A HREF="wss://ed1lncb62801.webex.com/direct?type=websocket&amp;dtype=binary&amp;rand=1602830016480&amp;uuidtag=5659FGE6-DF29-47A7-859A-G4D5FDC937A2&amp;gatewayip=PUB_IPv4_ADDR_2">wss://ed1lncb62801.webex.com/direct?type=websocket&amp;dtype=binary&amp;rand=1602830016480&amp;uuidtag=5659FGE6-DF29-47A7-859A-G4D5FDC937A2&amp;gatewayip=PUB_IPv4_ADDR_2</A> was interrupted while the page was loading.
</I>&gt;<i> 
</I>&gt;<i> then I see a corresponding 'sendRequest: HTTP Server conn* local=PUB_IPv4_ADDR_3' when trying to connect to the same origin. So I'm deducing that the remote websocket server is expecting a client connection from PUB_IPv4_ADDR_2 when in fact Squid is trying to connect from PUB_IPv4_ADDR_3 -- hence the &quot;interruption&quot; message.
</I>
That implies a broken server. For new connections through a proxy there
is no guarantee of any particular IP address being used. As you can see
from that behaviour the OS may select any of its available addresses if
it needs to.


&gt;<i> 
</I>&gt;<i> My test Squid instance is running on a multi-ISP router, so I guess I have to figure out how to either force connections out one interface only for the Squid cache or tell Squid to only bind to one interface.
</I>&gt;<i> 
</I>
tcp_outgoing_* directives can send details to the OS to hint at
preferred server connection details. It is up to the OS whether those
are followed or not.


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="022836.html">[squid-users] websockets through Squid
</A></li>
	<LI>Next message (by thread): <A HREF="022843.html">[squid-users] websockets through Squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22842">[ date ]</a>
              <a href="thread.html#22842">[ thread ]</a>
              <a href="subject.html#22842">[ subject ]</a>
              <a href="author.html#22842">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
