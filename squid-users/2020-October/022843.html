<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] websockets through Squid
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20websockets%20through%20Squid&In-Reply-To=%3C1102607393.539506.1602949858804%40mail.yahoo.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022842.html">
   <LINK REL="Next"  HREF="022837.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] websockets through Squid</H1>
    <B>Vieri</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20websockets%20through%20Squid&In-Reply-To=%3C1102607393.539506.1602949858804%40mail.yahoo.com%3E"
       TITLE="[squid-users] websockets through Squid">rentorbuy at yahoo.com
       </A><BR>
    <I>Sat Oct 17 15:50:58 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="022842.html">[squid-users] websockets through Squid
</A></li>
        <LI>Next message (by thread): <A HREF="022837.html">[squid-users] websockets through Squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22843">[ date ]</a>
              <a href="thread.html#22843">[ thread ]</a>
              <a href="subject.html#22843">[ subject ]</a>
              <a href="author.html#22843">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Saturday, October 17, 2020, 5:10:08 AM GMT+2, Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; wrote: 

&gt;<i> tcp_outgoing_* directives can send details to the OS to hint at preferred server connection details. It is up to the OS whether those are followed or not.
</I>

Yes, I finally solved my network issue, and now Squid is sending traffic as expected (same interface).

In fact, I know Squid 5.0.4 and websockets are &quot;working&quot; because I can properly test this protocol here:

<A HREF="https://www.websocket.org/echo.html">https://www.websocket.org/echo.html</A>

and elsewhere. The above site did not work with Squid 4, but it's working now with Squid 5.0.4.

However, the webex test site is still failing with the same client error message.

Maybe someone on this list can reproduce the problem or share a squid configuration that actually works with or without sslbump (for the webex test site, that is).

Here's a simple sslbump config that only requires redirecting tcp 443 traffic to the custom Squid port 3130 (tproxy can be ignored in this example):

# cat squid.conf
# optional:
# tcp_outgoing_address 1.2.3.4

http_port 3128
http_port 3129 tproxy
https_port 3130 intercept ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=16MB cert=/etc/ssl/squid/proxyserver.pem
sslcrtd_program /usr/libexec/squid/security_file_certgen -s /var/lib/squid/ssl_db -M 16MB
sslcrtd_children 40 startup=20 idle=10

acl SSL_ports port 443

acl Safe_ports port 443
acl Safe_ports port 80

acl CONNECT method CONNECT

acl localnet src your.local.net.work

http_access deny !Safe_ports

http_access deny CONNECT !SSL_ports

http_access deny all !localnet

http_access allow CONNECT localnet SSL_ports

http_upgrade_request_protocols OTHER allow all

http_access allow localnet all
http_reply_access allow localnet all

debug_options rotate=1 ALL,9

ssl_bump stare all
ssl_bump bump all

http_access allow localhost

http_access deny all

-------------------------------------

You can then go to <A HREF="https://www.webex.com/test-meeting.html">https://www.webex.com/test-meeting.html</A> to see if the websocket test actually works.

There has to be a glitch there or something I'm overlooking.

Thanks,

Vieri

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="022842.html">[squid-users] websockets through Squid
</A></li>
	<LI>Next message (by thread): <A HREF="022837.html">[squid-users] websockets through Squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22843">[ date ]</a>
              <a href="thread.html#22843">[ thread ]</a>
              <a href="subject.html#22843">[ subject ]</a>
              <a href="author.html#22843">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
