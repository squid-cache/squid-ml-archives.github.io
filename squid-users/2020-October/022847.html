<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Request timing headers
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Request%20timing%20headers&In-Reply-To=%3C6058301c-08fb-2f9d-1181-1a9dd7b5ea4e%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022846.html">
   <LINK REL="Next"  HREF="022850.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Request timing headers</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Request%20timing%20headers&In-Reply-To=%3C6058301c-08fb-2f9d-1181-1a9dd7b5ea4e%40measurement-factory.com%3E"
       TITLE="[squid-users] Request timing headers">rousskov at measurement-factory.com
       </A><BR>
    <I>Sat Oct 17 21:35:01 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="022846.html">[squid-users] Request timing headers
</A></li>
        <LI>Next message (by thread): <A HREF="022850.html">[squid-users] squid kerberos auth, acl note group
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22847">[ date ]</a>
              <a href="thread.html#22847">[ thread ]</a>
              <a href="subject.html#22847">[ subject ]</a>
              <a href="author.html#22847">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 10/17/20 5:14 PM, Juraj Masar wrote:

&gt;<i> Is it possible for Squid to return request timing information in
</I>&gt;<i> response headers?
</I>
Interesting question! In theory, a custom response header can use
logformat %codes, including %codes that carry timing information, such
as %tr and %dt. You will need to quote the whole customer header value
for those %codes to be honored. See reply_header_add and logformat
directives for more info.

However, I did not test whether this actually works. Some Squid code may
(increasingly incorrectly) assume that a particular %code is only
expanded after the master transaction is done. Needless to say, the
transaction is still ongoing when the response header is being formed.
If you face such problems, you may want to just add %master_xaction to
your custom response header (and to access.log records) and then match
the response with the access log record containing all the details.
Adding %tS may also help in this case (if that %code works in the
response header context).


HTH,

Alex.

&gt;<i> 		tr	Response time (milliseconds)
</I>&gt;<i> 		dt	Total time spent making DNS lookups (milliseconds)
</I>&gt;<i> 		tS	Approximate master transaction start time in 
</I>&gt;<i> 			&lt;full seconds since epoch&gt;.&lt;fractional seconds&gt; format.
</I>&gt;<i> 			Currently, Squid considers the master transaction
</I>&gt;<i> 			started when a complete HTTP request header initiating
</I>&gt;<i> 			the transaction is received from the client. This is
</I>&gt;<i> 			the same value that Squid uses to calculate transaction
</I>&gt;<i> 			response time when logging %tr to access.log. Currently,
</I>&gt;<i> 			Squid uses millisecond resolution for %tS values,
</I>&gt;<i> 			similar to the default access.log &quot;current time&quot; field
</I>&gt;<i> 			(%ts.%03tu).
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="022846.html">[squid-users] Request timing headers
</A></li>
	<LI>Next message (by thread): <A HREF="022850.html">[squid-users] squid kerberos auth, acl note group
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22847">[ date ]</a>
              <a href="thread.html#22847">[ thread ]</a>
              <a href="subject.html#22847">[ subject ]</a>
              <a href="author.html#22847">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
