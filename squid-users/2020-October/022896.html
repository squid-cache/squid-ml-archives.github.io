<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Best practice for adding or removing ACLs dynamically ?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Best%20practice%20for%20adding%20or%20removing%20ACLs%0A%20dynamically%20%3F&In-Reply-To=%3Ce7119d05-4ab8-59f3-b616-dd7ce2d48ccb%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022893.html">
   <LINK REL="Next"  HREF="022899.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Best practice for adding or removing ACLs dynamically ?</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Best%20practice%20for%20adding%20or%20removing%20ACLs%0A%20dynamically%20%3F&In-Reply-To=%3Ce7119d05-4ab8-59f3-b616-dd7ce2d48ccb%40treenet.co.nz%3E"
       TITLE="[squid-users] Best practice for adding or removing ACLs dynamically ?">squid3 at treenet.co.nz
       </A><BR>
    <I>Sat Oct 31 15:40:17 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="022893.html">[squid-users] Best practice for adding or removing ACLs dynamically ?
</A></li>
        <LI>Next message (by thread): <A HREF="022899.html">[squid-users] Best practice for adding or removing ACLs dynamically ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22896">[ date ]</a>
              <a href="thread.html#22896">[ thread ]</a>
              <a href="subject.html#22896">[ subject ]</a>
              <a href="author.html#22896">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 31/10/20 1:34 pm, roee klinger wrote:
&gt;<i> &#65279;
</I>&gt;<i> Hey,
</I>&gt;<i> I have Squid configured to send users to different outgoing interface like so:
</I>&gt;<i> 
</I>&gt;<i> ..
</I>&gt;<i> auth_param basic program /usr/lib/squid/basic_ncsa_auth /etc/squid/htpassword
</I>&gt;<i> acl acl_for_user3002 proxy_auth user2
</I>&gt;<i> tcp_outgoing_address 192.168.8.12 acl_for_user3002
</I>&gt;<i> http_port 3002 name=3002
</I>

No need to name a *_port like this. The default name is the first 
parameter string (&quot;3002&quot; on this line).


&gt;<i> http_access allow authenticated
</I>&gt;<i> ..
</I>&gt;<i> 
</I>&gt;<i> When I wanted to change the username:password for user2, I run a bash script to change it in squid.conf and also in htpassword and then I run &quot;squid -k reconfigure&quot;, if I don't reconfigure the old user still has access to the proxy and the new one doesn't for about 30 minutes.
</I>&gt;<i> 
</I>
No need to restart for that change. The helper you have there will 
automatically detect changes to the htpassword file and reload it.

It is a little odd that the new user was not able to authenticate. Check 
that your test did not lookup and cache a non-existence result for them 
prior to being added.


The delay is due to the credentials being valid for a period of time. To 
reduce workload on the auth system Squid caches credential details for a 
while.

Set &quot;auth_param basic credentialsttl &quot; to shorter values to reduce the 
delay (default is 2hrs).


&gt;<i> I am expecting to have 100s of users soon that will change credentials often, and also I would like to blacklist websites often and on the fly, so I was searching for a better way to manage this without reconfiguring every time, since sometimes a reconfigure can take up to 10-15 seconds.
</I>&gt;<i> 
</I>
This helper does not need a reconfigure at all as far as I can tell from 
the code.

All the reconfigure was doing for you previously was triggering an early 
prune of the records in the credentials cache. Probably why you saw 
about 30min delay instead of about 2hrs.


&gt;<i> I am new to Squid and wasn't able to find any info on this, am I doing this currently or there is a better way to change users/ACLs on the fly without reloading Squid?
</I>&gt;<i> 
</I>
Config changes in squid.conf itself needs a reconfigure or sometimes a 
restart.


For auth and ACLs whose values that come into Squid from a helper it 
depends on the helper itself. Most can auto-detect changes to their 
background databases and not need anything from Squid to update the 
outputs. All helpers do have some form of caching of their results by 
Squid, so there are settings in squid.conf to tune that to your needs - 
as you can see from the auth issue above.


For ACLs with values that are expected to change often it is best to use 
an external_acl_type helper that manages the updates or fetches from 
somewhere the updates are handled without a reload.



Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="022893.html">[squid-users] Best practice for adding or removing ACLs dynamically ?
</A></li>
	<LI>Next message (by thread): <A HREF="022899.html">[squid-users] Best practice for adding or removing ACLs dynamically ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22896">[ date ]</a>
              <a href="thread.html#22896">[ thread ]</a>
              <a href="subject.html#22896">[ subject ]</a>
              <a href="author.html#22896">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
