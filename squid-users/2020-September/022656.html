<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid.service with Type=Notify is not always reliable (Arch Linux)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid.service%20with%20Type%3DNotify%20is%20not%20always%20reliable%0A%20%28Arch%20Linux%29&In-Reply-To=%3C40fe50ea-6c26-63cc-de32-ba8366d0d234%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   
   <LINK REL="Next"  HREF="022659.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid.service with Type=Notify is not always reliable (Arch Linux)</H1>
    <B>Amish</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid.service%20with%20Type%3DNotify%20is%20not%20always%20reliable%0A%20%28Arch%20Linux%29&In-Reply-To=%3C40fe50ea-6c26-63cc-de32-ba8366d0d234%40gmail.com%3E"
       TITLE="[squid-users] squid.service with Type=Notify is not always reliable (Arch Linux)">anon.amish at gmail.com
       </A><BR>
    <I>Tue Sep  1 06:32:05 UTC 2020</I>
    <P><UL>
        
        <LI>Next message (by thread): <A HREF="022659.html">[squid-users] squid.service with Type=Notify is not always reliable (Arch Linux)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22656">[ date ]</a>
              <a href="thread.html#22656">[ thread ]</a>
              <a href="subject.html#22656">[ subject ]</a>
              <a href="author.html#22656">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

I have frequently observed an issue with squid.service but I am not able 
to detect the real cause. As mostly it works but sometimes does not.

I am using Arch Linux with squid 4.13 (but I had noticed same issue in 
4.10 as well)

Most likely I am noticing this issue ever since service Type was changed 
from forking to notify in squid.service

Commit: 
<A HREF="https://github.com/squid-cache/squid/commit/6fa8c66435d55a2e713db0222cdca3a9dccf5bbe">https://github.com/squid-cache/squid/commit/6fa8c66435d55a2e713db0222cdca3a9dccf5bbe</A>

What happens is squid starts correctly, but systemd does not seem to be 
getting the notification from squid that it has started.

Sep 01 06:40:04 foo systemd[1]: Starting Squid Web Proxy Server...
Sep 01 06:41:34 foo systemd[1]: squid.service: start operation timed 
out. Terminating.
Sep 01 06:42:06 foo systemd[1]: squid.service: Failed with result 'timeout'.
Sep 01 06:42:06 foo systemd[1]: Failed to start Squid Web Proxy Server.

Then it kills squid process.

Squid cache.log shows no error w.r.t. notify and seems to start correctly.

What surprises me is that it works most of the times. Just randomly the 
above timeout error occurs.

If in service override file, I change type to forking and remove 
--foreground. It starts working again.

Like this: (comment lines are original lines when the issue occurs)

[Service]
#Type=notify
Type=forking
ExecStart=
#ExecStart=/usr/bin/squid -f /etc/squid/custom.conf --foreground -sYC
ExecStart=/usr/bin/squid -f /etc/squid/custom.conf -sYC

Any idea what could be issue? Is there any squid.conf setting which I 
may using and stopping notify randomly?

Any help would be highly appreciated.

Thanks and regards,

Amish


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message (by thread): <A HREF="022659.html">[squid-users] squid.service with Type=Notify is not always reliable (Arch Linux)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22656">[ date ]</a>
              <a href="thread.html#22656">[ thread ]</a>
              <a href="subject.html#22656">[ subject ]</a>
              <a href="author.html#22656">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
