<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid.service with Type=Notify is not always reliable (Arch Linux)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid.service%20with%20Type%3DNotify%20is%20not%20always%0A%20reliable%20%28Arch%20Linux%29&In-Reply-To=%3C6242263b-d765-8184-a3ae-127854902918%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022660.html">
   <LINK REL="Next"  HREF="022664.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid.service with Type=Notify is not always reliable (Arch Linux)</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid.service%20with%20Type%3DNotify%20is%20not%20always%0A%20reliable%20%28Arch%20Linux%29&In-Reply-To=%3C6242263b-d765-8184-a3ae-127854902918%40measurement-factory.com%3E"
       TITLE="[squid-users] squid.service with Type=Notify is not always reliable (Arch Linux)">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Sep  1 15:01:20 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="022660.html">[squid-users] squid.service with Type=Notify is not always reliable (Arch Linux)
</A></li>
        <LI>Next message (by thread): <A HREF="022664.html">[squid-users] squid.service with Type=Notify is not always reliable (Arch Linux)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22661">[ date ]</a>
              <a href="thread.html#22661">[ thread ]</a>
              <a href="subject.html#22661">[ subject ]</a>
              <a href="author.html#22661">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 9/1/20 10:27 AM, Amish wrote:

&gt;<i> Accepting ... connections at ...&#160; message came almost immediately (in 1
</I>&gt;<i> second).
</I>&gt;<i> Sep 01 06:40:05 foo squid[8446]: Accepting SSL bumped HTTP Socket
</I>&gt;<i> connections at local=[::]:3128 remote=[::] FD 27 flags=9
</I>
OK, so you are not using SMP Squid and, assuming your Squid build
supports calling sd_notify(), sd_notify() was called. We need to figure
out why it had no effect. Suggested next steps:

1. Adjust Squid to print the value of $NOTIFY_SOCKET together with the
&quot;Accepting...&quot; line. This will confirm that the variable is set. It
should be set. This debugging can be added without fear of producing too
much info but it is unlikely to be insightful.

2. Add some kind of sd_notify() debugging that would show us what the
first sd_notify() call was doing and when/whether systemd received the
notification from Squid. I have not researched how to do that, but I am
sure it is possible. I bet there are not enough notifications happening
on your production server to cause problems, but you should practice on
a lab server first, of course.


&gt;<i> Not sure that parse URL line has anything to do with this bug as
</I>&gt;<i> sd_notify() was expected to happen long before that.
</I>
Right. I would only worry if that line appears every time Squid starts,
indicating some kind of automated systemd-related(?) probe/test (which
fails).


HTH,

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="022660.html">[squid-users] squid.service with Type=Notify is not always reliable (Arch Linux)
</A></li>
	<LI>Next message (by thread): <A HREF="022664.html">[squid-users] squid.service with Type=Notify is not always reliable (Arch Linux)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22661">[ date ]</a>
              <a href="thread.html#22661">[ thread ]</a>
              <a href="subject.html#22661">[ subject ]</a>
              <a href="author.html#22661">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
