<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid.service with Type=Notify is not always reliable (Arch Linux)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid.service%20with%20Type%3DNotify%20is%20not%20always%0A%20reliable%20%28Arch%20Linux%29&In-Reply-To=%3C2d0f01d2-1c9b-040d-4019-4b6b13111cd5%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022665.html">
   <LINK REL="Next"  HREF="022668.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid.service with Type=Notify is not always reliable (Arch Linux)</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid.service%20with%20Type%3DNotify%20is%20not%20always%0A%20reliable%20%28Arch%20Linux%29&In-Reply-To=%3C2d0f01d2-1c9b-040d-4019-4b6b13111cd5%40treenet.co.nz%3E"
       TITLE="[squid-users] squid.service with Type=Notify is not always reliable (Arch Linux)">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Sep  2 14:35:00 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="022665.html">[squid-users] squid.service with Type=Notify is not always reliable (Arch Linux)
</A></li>
        <LI>Next message (by thread): <A HREF="022668.html">[squid-users] squid.service with Type=Notify is not always reliable (Arch Linux)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22666">[ date ]</a>
              <a href="thread.html#22666">[ thread ]</a>
              <a href="subject.html#22666">[ subject ]</a>
              <a href="author.html#22666">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2/09/20 7:01 pm, Amish wrote:
&gt;<i> 
</I>&gt;<i> On 01/09/20 8:31 pm, Alex Rousskov wrote:
</I>&gt;&gt;<i> On 9/1/20 10:27 AM, Amish wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Accepting ... connections at ...&#160; message came almost immediately (in 1
</I>&gt;&gt;&gt;<i> second).
</I>&gt;&gt;&gt;<i> Sep 01 06:40:05 foo squid[8446]: Accepting SSL bumped HTTP Socket
</I>&gt;&gt;&gt;<i> connections at local=[::]:3128 remote=[::] FD 27 flags=9
</I>&gt;&gt;<i> OK, so you are not using SMP Squid and, assuming your Squid build
</I>&gt;&gt;<i> supports calling sd_notify(), sd_notify() was called. We need to figure
</I>&gt;&gt;<i> out why it had no effect. Suggested next steps:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 1. Adjust Squid to print the value of $NOTIFY_SOCKET together with the
</I>&gt;&gt;<i> &quot;Accepting...&quot; line. This will confirm that the variable is set. It
</I>&gt;&gt;<i> should be set. This debugging can be added without fear of producing too
</I>&gt;&gt;<i> much info but it is unlikely to be insightful.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 2. Add some kind of sd_notify() debugging that would show us what the
</I>&gt;&gt;<i> first sd_notify() call was doing and when/whether systemd received the
</I>&gt;&gt;<i> notification from Squid. I have not researched how to do that, but I am
</I>&gt;&gt;<i> sure it is possible. I bet there are not enough notifications happening
</I>&gt;&gt;<i> on your production server to cause problems, but you should practice on
</I>&gt;&gt;<i> a lab server first, of course.
</I>&gt;<i> 
</I>&gt;<i> Ok. I will try above. But here is a note from &quot;man sd_notify&quot; about race
</I>&gt;<i> condition that MAY occur.
</I>

You are guessing now. Please don't do that until every possible check
has been done and narrowed the vast range of possibilities down.

The purpose of the checks suggested by Alex was to identify whether a
race is occuring or not.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="022665.html">[squid-users] squid.service with Type=Notify is not always reliable (Arch Linux)
</A></li>
	<LI>Next message (by thread): <A HREF="022668.html">[squid-users] squid.service with Type=Notify is not always reliable (Arch Linux)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22666">[ date ]</a>
              <a href="thread.html#22666">[ thread ]</a>
              <a href="subject.html#22666">[ subject ]</a>
              <a href="author.html#22666">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
