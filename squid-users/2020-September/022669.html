<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] seeking assistance for home users wanting to cache https contents
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20seeking%20assistance%20for%20home%20users%20wanting%20to%0A%20cache%20https%20contents&In-Reply-To=%3C76e86a03-e6d8-48ec-d1f3-d9018004982e%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022663.html">
   <LINK REL="Next"  HREF="022670.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] seeking assistance for home users wanting to cache https contents</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20seeking%20assistance%20for%20home%20users%20wanting%20to%0A%20cache%20https%20contents&In-Reply-To=%3C76e86a03-e6d8-48ec-d1f3-d9018004982e%40treenet.co.nz%3E"
       TITLE="[squid-users] seeking assistance for home users wanting to cache https contents">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Sep  3 02:10:31 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="022663.html">[squid-users] [EXTERNAL] Re:  Squid 3.5 - icap parsing error
</A></li>
        <LI>Next message (by thread): <A HREF="022670.html">[squid-users] Squid ICAP DNS lookup failure fixed?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22669">[ date ]</a>
              <a href="thread.html#22669">[ thread ]</a>
              <a href="subject.html#22669">[ subject ]</a>
              <a href="author.html#22669">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 1/09/20 6:52 am, Michael Davis wrote:
&gt;<i> &#8226;The github repo is actually for refresh patterns specifically
</I>&gt;<i> 
</I>&gt;<i> &#8226;I extensively read over almost every squid wiki page, but unfortunately
</I>&gt;<i> my attempts to understand them felt kind of useless, i did read likely
</I>&gt;<i> well over fifty different attempts guides, and found myself realizing to
</I>&gt;<i> your point, most info IS highly outdated
</I>&gt;<i> 
</I>&gt;<i> &#8226;my config for everything is fine so far, so we can ignore pfsense snd
</I>&gt;<i> things unrelated to squid safely, thank heavens for that one
</I>&gt;<i> 
</I>&gt;<i> &#8226; as far as i can tell, squid is properly?? Caching non ssl delivered
</I>&gt;<i> contents *disclaimer, i am fully guessing on this one* it shows bulk
</I>&gt;<i> access logs of tcp_miss/200 | tcp_tunnel/200 | tcp_inm_hit/200 |
</I>&gt;<i> none/200 real time results
</I>

Okay. So some HTTP(S) is happening.

You can possibly do some finer grain tests to see which of these are for
regular <A HREF="http://">http://</A> requests by the Browser and which are for <A HREF="https://">https://</A>
traffic. That is, checking to see which of port 80 and 443 got
intercepted and how the log looks from that.


&gt;<i> 
</I>&gt;<i> &#8226; &quot;FYI, &quot;proper&quot; caching has nothing to do with SSL-Bump.
</I>&gt;<i> 
</I>&gt;<i> Separate any changes you want in relation to caching from the SSL-Bump
</I>&gt;<i> changes. Test each set of changes independently to get one feature going
</I>&gt;<i> before you move on to the other.&quot; ...... much as i don't want to admit
</I>&gt;<i> this,&#160; THAT should have been obvious, but i think i might have over
</I>&gt;<i> looked that fact....
</I>&gt;<i> 
</I>&gt;<i> &#9679; &quot;So what I am understanding from your description is that you are
</I>&gt;<i> trying to:
</I>&gt;<i> &#160;A) intercept traffic with pfsense
</I>&gt;<i> &#160;B) SSL-Bump the TLS which arrives at the proxy
</I>&gt;<i> &#160;C) cache the decrypted HTTP messages
</I>&gt;<i> 
</I>&gt;<i> Is that correct?&quot;&#160; THAT is exactly what my goals are, yes.
</I>&gt;<i> 
</I>&gt;<i> &#8226; as for that bare bones config example, that's exactly what im using
</I>&gt;<i> right now, but admittedly im not knowledgeable enough to fully and
</I>&gt;<i> confidently tell if it's working at this point, i feel it isnt however
</I>&gt;<i> 
</I>

IIRC SSL-Bump traffic from that minimal test ssl_bump config should log
as one NONE/200 [if I remember wrong this might be TCP_TUNNEL/200] with
&quot;CONNECT raw-IP:port&quot; (the &quot;peek&quot; happening) followed by a
TCP_TUNNEL/200 (the &quot;splice&quot;) with &quot;CONNECT domain:port&quot; - depending on
client sending TLS SNI.

Squid does not have any part in the TLS handshakes for that minimal
config, so any TLS errors are between the client and origin server.


If that all checks out as what you are seeing. Adding a &quot;stare step2&quot;
instead of splice, and a &quot;bump all&quot; final line starts Squid decrypting.
You should see the two CONNECT transactions mentioned above will still
be logged, maybe a third one as well from the &quot;stare&quot; with updated
domain name from the server cert. But the main sign of bump happening is
that log now also contains normal GET/POST etc lines where the URL
starts with &quot;<A HREF="https://">https://</A>&quot; scheme.


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="022663.html">[squid-users] [EXTERNAL] Re:  Squid 3.5 - icap parsing error
</A></li>
	<LI>Next message (by thread): <A HREF="022670.html">[squid-users] Squid ICAP DNS lookup failure fixed?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22669">[ date ]</a>
              <a href="thread.html#22669">[ thread ]</a>
              <a href="subject.html#22669">[ subject ]</a>
              <a href="author.html#22669">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
