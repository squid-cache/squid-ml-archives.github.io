<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Forwarded-for functionality(squid)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Forwarded-for%20functionality%28squid%29&In-Reply-To=%3C15343_1599570962_5F578412_15343_93_1_03f4a0be-7496-48ec-b76c-904a48f9e9a4%40OPEXCAUBM33.corporate.adroot.infra.ftgroup%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022675.html">
   <LINK REL="Next"  HREF="022677.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Forwarded-for functionality(squid)</H1>
    <B>piyush.gaba at orange.com</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Forwarded-for%20functionality%28squid%29&In-Reply-To=%3C15343_1599570962_5F578412_15343_93_1_03f4a0be-7496-48ec-b76c-904a48f9e9a4%40OPEXCAUBM33.corporate.adroot.infra.ftgroup%3E"
       TITLE="[squid-users] Forwarded-for functionality(squid)">piyush.gaba at orange.com
       </A><BR>
    <I>Tue Sep  8 13:15:57 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="022675.html">[squid-users] Forwarded-for functionality(squid)
</A></li>
        <LI>Next message (by thread): <A HREF="022677.html">[squid-users] Forwarded-for functionality(squid)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22676">[ date ]</a>
              <a href="thread.html#22676">[ thread ]</a>
              <a href="subject.html#22676">[ subject ]</a>
              <a href="author.html#22676">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Matus,

Thank you for your reply.

I think my whole struggle is to get the desired output as:
&lt;ip&gt;- - [17/Aug/2018:08:43:29 +0200] &quot;GET /index1.html HTTP/1.1&quot; 200 36 &quot;-&quot; &quot;curl/7.29.0&quot; unknown

Which has &quot;unknown&quot; at the end because forwarded_for was set to &quot;off&quot;.

But now when I am working with squid 4.13 I am not getting the desired output, I am getting the output as,
&lt;ip&gt; - - [08/Sep/2020:15:07:19 +0200] &quot;GET /index1.html HTTP/1.1&quot; 200 8 &quot;-&quot; &quot;curl/7.29.0&quot;

Which does not have anything at the end, while the forwarded_for is set to &quot;off&quot;.

Please let me know if you have any advice to give for this logging problem.

I am using below log format in my httpd file,
LogFormat &quot;%{X-Forwarded-For}i %l %u %t \&quot;%r\&quot; %&gt;s %b \&quot;%{Referer}i\&quot; \&quot;%{User-Agent}i\&quot;&quot; combined

Bien cordialement,
Piyush Gaba
Software Engineer
TGI/OLN- INDIA
Tower B, 8th Floor, DLF Infinity Towers, 
DLF Cyber City Phase - II
Gurgaon - 122002, Haryana, INDIA
 [Email] <A HREF="https://lists.squid-cache.org/listinfo/squid-users">piyush.gaba at orange.com</A>


-----Original Message-----
From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of Matus UHLAR - fantomas
Sent: Tuesday, September 8, 2020 15:23
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] Forwarded-for functionality(squid)

On 08.09.20 09:01, <A HREF="https://lists.squid-cache.org/listinfo/squid-users">piyush.gaba at orange.com</A> wrote:
&gt;<i>I would like to ask for your inputs/resolution for one of the issues that I am facing while using forwarded_for functionality with new version of squid i.e. v4.13
</I>&gt;<i>
</I>&gt;<i>UseCase:
</I>&gt;<i>I have a client, a webserver and squid hosted in 3 different VMs.  I have
</I>&gt;<i> set up interfaces in such a way that Client cannot access webserver
</I>&gt;<i> directly, but only through squid proxy.(Works fine)
</I>&gt;<i>
</I>&gt;<i>Now, When I append forwarded_for off to my squid.conf and then curl the
</I>&gt;<i> webserver from client [ curl {Webserver.mgmtIP} ], the expected logs on
</I>&gt;<i> webserver should have, &quot;unknown&quot; at the end of line.
</I>
You can configure webserver to log contents of X-Forwarded-For: line.
Note that that line can contain anything clients can send.
So, unless you really want to see that content, don't log it.

&gt;<i>And if there is nothing appended or forwarded_for on is appended, it should have &quot;Client_IP&quot; at the end of the line in log file.
</I>&gt;<i>But I am not getting expected output.
</I>

-- 
Matus UHLAR - fantomas, <A HREF="https://lists.squid-cache.org/listinfo/squid-users">uhlar at fantomas.sk</A> ; <A HREF="http://www.fantomas.sk/">http://www.fantomas.sk/</A>
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
He who laughs last thinks slowest.
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>

_________________________________________________________________________________________________________________________

Ce message et ses pieces jointes peuvent contenir des informations confidentielles ou privilegiees et ne doivent donc
pas etre diffuses, exploites ou copies sans autorisation. Si vous avez recu ce message par erreur, veuillez le signaler
a l'expediteur et le detruire ainsi que les pieces jointes. Les messages electroniques etant susceptibles d'alteration,
Orange decline toute responsabilite si ce message a ete altere, deforme ou falsifie. Merci.

This message and its attachments may contain confidential or privileged information that may be protected by law;
they should not be distributed, used or copied without authorisation.
If you have received this email in error, please notify the sender and delete this message and its attachments.
As emails may be altered, Orange is not liable for messages that have been modified, changed or falsified.
Thank you.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="022675.html">[squid-users] Forwarded-for functionality(squid)
</A></li>
	<LI>Next message (by thread): <A HREF="022677.html">[squid-users] Forwarded-for functionality(squid)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22676">[ date ]</a>
              <a href="thread.html#22676">[ thread ]</a>
              <a href="subject.html#22676">[ subject ]</a>
              <a href="author.html#22676">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
