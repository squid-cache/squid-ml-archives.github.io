<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Forwarded-for functionality(squid)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Forwarded-for%20functionality%28squid%29&In-Reply-To=%3C4058_1599582778_5F57B23A_4058_397_1_FB9F07820FAE75499D7A4E37F6CD7664AA81BC%40OPEXCAUBMA1.corporate.adroot.infra.ftgroup%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022677.html">
   <LINK REL="Next"  HREF="022679.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Forwarded-for functionality(squid)</H1>
    <B>piyush.gaba at orange.com</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Forwarded-for%20functionality%28squid%29&In-Reply-To=%3C4058_1599582778_5F57B23A_4058_397_1_FB9F07820FAE75499D7A4E37F6CD7664AA81BC%40OPEXCAUBMA1.corporate.adroot.infra.ftgroup%3E"
       TITLE="[squid-users] Forwarded-for functionality(squid)">piyush.gaba at orange.com
       </A><BR>
    <I>Tue Sep  8 16:32:57 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="022677.html">[squid-users] Forwarded-for functionality(squid)
</A></li>
        <LI>Next message (by thread): <A HREF="022679.html">[squid-users] Forwarded-for functionality(squid)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22678">[ date ]</a>
              <a href="thread.html#22678">[ thread ]</a>
              <a href="subject.html#22678">[ subject ]</a>
              <a href="author.html#22678">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Amos,

Thank you so much for your reply.

I did debug and I found below output in the squid logs,

1599582079.051      3 &lt;Client_Ip&gt; TCP_MISS/200 430 GET <A HREF="http://">http://</A> &lt;webserverIp&gt;/index1.html - HIER_DIRECT/&lt;webserverIp&gt; text/html

I would like to share a URL for squid directive and that is the output I am expecting at the end of the line of my output and as I have given in the trail.
<A HREF="http://www.squid-cache.org/Doc/config/forwarded_for/">http://www.squid-cache.org/Doc/config/forwarded_for/</A> 

When set to off, it should show &quot;unknown&quot;. Right ? 

Bien cordialement,
Piyush Gaba
Software Engineer
TGI/OLN- INDIA
Tower B, 8th Floor, DLF Infinity Towers, 
DLF Cyber City Phase - II
Gurgaon - 122002, Haryana, INDIA
[Email] <A HREF="https://lists.squid-cache.org/listinfo/squid-users">piyush.gaba at orange.com</A>


-----Original Message-----
From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of Amos Jeffries
Sent: Tuesday, September 8, 2020 20:42
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] Forwarded-for functionality(squid)

On 9/09/20 1:15 am, piyush.gaba wrote:
&gt;<i> Hi Matus,
</I>&gt;<i> 
</I>&gt;<i> Thank you for your reply.
</I>&gt;<i> 
</I>&gt;<i> I think my whole struggle is to get the desired output as:
</I>&gt;<i> &lt;ip&gt;- - [17/Aug/2018:08:43:29 +0200] &quot;GET /index1.html HTTP/1.1&quot; 200 36 &quot;-&quot; &quot;curl/7.29.0&quot; unknown
</I>&gt;<i> 
</I>&gt;<i> Which has &quot;unknown&quot; at the end because forwarded_for was set to &quot;off&quot;.
</I>&gt;<i> 
</I>&gt;<i> But now when I am working with squid 4.13 I am not getting the desired output, I am getting the output as,
</I>&gt;<i> &lt;ip&gt; - - [08/Sep/2020:15:07:19 +0200] &quot;GET /index1.html HTTP/1.1&quot; 200 8 &quot;-&quot; &quot;curl/7.29.0&quot;
</I>&gt;<i> 
</I>&gt;<i> Which does not have anything at the end, while the forwarded_for is set to &quot;off&quot;.
</I>&gt;<i> 
</I>&gt;<i> Please let me know if you have any advice to give for this logging problem.
</I>&gt;<i> 
</I>&gt;<i> I am using below log format in my httpd file,
</I>&gt;<i> LogFormat &quot;%{X-Forwarded-For}i %l %u %t \&quot;%r\&quot; %&gt;s %b \&quot;%{Referer}i\&quot; \&quot;%{User-Agent}i\&quot;&quot; combined
</I>&gt;<i> 
</I>
That LogFormat tells us the first column of the log file is the contents
of the X-Forwarded-For header. The first column of the log lines you
showed is &quot;&lt;ip&gt;&quot; - the value of XFF header is supposed to be one or more
IPs, so that looks like it is working.

Use the debug_options setting I gave you to *actually* see what is
happening. The Apache log is only showing you what values are _after_
the httpd process and all modules have done their modifications to the
HTTP input ... including replacing the transaction client-IP with any
value from XFF header.


Amos
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>

_________________________________________________________________________________________________________________________

Ce message et ses pieces jointes peuvent contenir des informations confidentielles ou privilegiees et ne doivent donc
pas etre diffuses, exploites ou copies sans autorisation. Si vous avez recu ce message par erreur, veuillez le signaler
a l'expediteur et le detruire ainsi que les pieces jointes. Les messages electroniques etant susceptibles d'alteration,
Orange decline toute responsabilite si ce message a ete altere, deforme ou falsifie. Merci.

This message and its attachments may contain confidential or privileged information that may be protected by law;
they should not be distributed, used or copied without authorisation.
If you have received this email in error, please notify the sender and delete this message and its attachments.
As emails may be altered, Orange is not liable for messages that have been modified, changed or falsified.
Thank you.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="022677.html">[squid-users] Forwarded-for functionality(squid)
</A></li>
	<LI>Next message (by thread): <A HREF="022679.html">[squid-users] Forwarded-for functionality(squid)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22678">[ date ]</a>
              <a href="thread.html#22678">[ thread ]</a>
              <a href="subject.html#22678">[ subject ]</a>
              <a href="author.html#22678">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
