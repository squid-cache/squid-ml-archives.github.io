<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid within a network namespace
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20within%20a%20network%20namespace&In-Reply-To=%3Cb472eb7d-2ed6-45a5-0f77-3f88fa3de0da%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023537.html">
   <LINK REL="Next"  HREF="023538.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid within a network namespace</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20within%20a%20network%20namespace&In-Reply-To=%3Cb472eb7d-2ed6-45a5-0f77-3f88fa3de0da%40measurement-factory.com%3E"
       TITLE="[squid-users] Squid within a network namespace">rousskov at measurement-factory.com
       </A><BR>
    <I>Mon Apr 12 16:13:14 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="023537.html">[squid-users] Squid within a network namespace
</A></li>
        <LI>Next message (by thread): <A HREF="023538.html">[squid-users] Is there a way to bind squid's outbound traffice to a specific network interface
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23545">[ date ]</a>
              <a href="thread.html#23545">[ thread ]</a>
              <a href="subject.html#23545">[ subject ]</a>
              <a href="author.html#23545">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 4/11/21 12:46 PM, Francois wrote:

&gt;<i> I am running my development tools and VMs in a dedicated network
</I>&gt;<i> namespace on my laptop (through Linux &quot;netns&quot;), so they are fully
</I>&gt;<i> isolated from the rest of my network. I would like to set-up a proxy
</I>&gt;<i> so that if there is a need to connect to the outside, I could set-up
</I>&gt;<i> some fine grained ACL to open some very specific HTTP traffic. For
</I>&gt;<i> this to work with Squid, there must be a socket opened within the
</I>&gt;<i> namespace, while Squid is still running on the default namespace.
</I>&gt;<i> 
</I>&gt;<i> This can be achieved without modifying the code by using socat for
</I>&gt;<i> example, where a socat running within the namespace sends traffic to a
</I>&gt;<i> Unix socket, and another socat outside the namespace, reads from the
</I>&gt;<i> Unix socket, and sends the traffic to Squid... it's quite some
</I>&gt;<i> plumbing effort, and Squid won't be able to know from which VM the
</I>&gt;<i> traffic originates (the X-Forwarded-For is localhost)
</I>&gt;<i> 
</I>&gt;<i> Seeing that HAProxy implemented something
</I>&gt;<i> (<A HREF="https://github.com/haproxy/haproxy/commit/b3e54fe387c7c1ea750f39d3029672d640c499f9">https://github.com/haproxy/haproxy/commit/b3e54fe387c7c1ea750f39d3029672d640c499f9</A>)
</I>&gt;<i> so that the process moves into the namespace just for the time of the
</I>&gt;<i> socket creation, I came up with a similar change for Squid
</I>&gt;<i> (<A HREF="https://github.com/freedge/squid/commit/a778666d8f4760448e29e4a0cc75dcd305b40d02">https://github.com/freedge/squid/commit/a778666d8f4760448e29e4a0cc75dcd305b40d02</A>).
</I>
Thank you for a detailed explanation of your use case and sample code.


&gt;<i> As this is a Linux only change, and also the community lived without
</I>&gt;<i> it so far, I am sending this mail to see if there is any interest in
</I>&gt;<i> this feature, if there was ever any request for it in the past?
</I>
I cannot answer your questions, but I can tell you that, IMO, quality
namespace support should be accepted by the Squid Project. I hope others
will chime in regarding its usefulness to them.

The feature should probably be configured at least on a listening port
basis (rather than globally) and implementation would have to to meet
modern Squid requirements (failing on error, C++, etc.). Your sample
code could be a good starting point.


Cheers,

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="023537.html">[squid-users] Squid within a network namespace
</A></li>
	<LI>Next message (by thread): <A HREF="023538.html">[squid-users] Is there a way to bind squid's outbound traffice to a specific network interface
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23545">[ date ]</a>
              <a href="thread.html#23545">[ thread ]</a>
              <a href="subject.html#23545">[ subject ]</a>
              <a href="author.html#23545">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
