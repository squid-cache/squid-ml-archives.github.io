<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] allow request to cloudfront after 302 redirection.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20allow%20request%20to%20cloudfront%20after%20302%20redirection.&In-Reply-To=%3CCAJtdwusCo2m%3Dyrg6eBfw-fqR3YPN16CjAceZ-CxgXvz4h_6kwQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023559.html">
   <LINK REL="Next"  HREF="023565.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] allow request to cloudfront after 302 redirection.</H1>
    <B>Miroslaw Malinowski</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20allow%20request%20to%20cloudfront%20after%20302%20redirection.&In-Reply-To=%3CCAJtdwusCo2m%3Dyrg6eBfw-fqR3YPN16CjAceZ-CxgXvz4h_6kwQ%40mail.gmail.com%3E"
       TITLE="[squid-users] allow request to cloudfront after 302 redirection.">mr.miroslaw.malinowski at gmail.com
       </A><BR>
    <I>Wed Apr 21 16:48:53 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="023559.html">[squid-users] How to see running configuration paramters
</A></li>
        <LI>Next message (by thread): <A HREF="023565.html">[squid-users] allow request to cloudfront after 302 redirection.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23564">[ date ]</a>
              <a href="thread.html#23564">[ thread ]</a>
              <a href="subject.html#23564">[ subject ]</a>
              <a href="author.html#23564">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Is it possible to create a whitelist that allows cloudfront 302
redirections, e.g. gitlab is using cloudfront as CDN and when we whitelist
package.gitlab.com the URL is redirected (302) to
<A HREF="https://d20rj4el6vkp4c.cloudfront.net/7/11/ubuntu/package_files/35938.deb?t=1619023239_a63698472b6bebeaee980e7c030632d97a29c15d.">https://d20rj4el6vkp4c.cloudfront.net/7/11/ubuntu/package_files/35938.deb?t=1619023239_a63698472b6bebeaee980e7c030632d97a29c15d.</A>
I could whitelist a whole .cloudfront.net domain or url_regex, but what I
would like to achieve, I don't know if possible, is a chain of events like:
If packages.gitlab.com return 302 Location .cloudfront, then allow
<A HREF="https://d20rj4el6vkp4c.cloudfront.net/7/11/ubuntu/package_files/35938.deb?t=1619023239_a63698472b6bebeaee980e7c030632d97a29c">https://d20rj4el6vkp4c.cloudfront.net/7/11/ubuntu/package_files/35938.deb?t=1619023239_a63698472b6bebeaee980e7c030632d97a29c</A>
request.
I've been playing around with http_reply_access and rep_headers, but I can
only go as far as allow replay of the first request to package.gitlab.com,
but then a GET to cloudfront is blocked anyway as it's not on our whitelist.
e.g.
1619022938.916   423 172.16.230.237 NONE/200 0 CONNECT 54.153.54.194:443 -
ORIGINAL_DST/54.153.54.194 -
1619022939.074   153 172.16.230.237 TCP_MISS/302 758 GET
<A HREF="https://packages.gitlab.com/gitlab/gitlab-ee/packages/ubuntu/bionic/gitlab-ee_11.0.1-ee.0_amd64.deb/download.deb">https://packages.gitlab.com/gitlab/gitlab-ee/packages/ubuntu/bionic/gitlab-ee_11.0.1-ee.0_amd64.deb/download.deb</A>
- ORIGINAL_DST/54.153.54.194 text/html
1619022939.108    20 172.16.230.237 NONE/200 0 CONNECT 52.84.90.34:443 -
ORIGINAL_DST/52.84.90.34 -
1619022939.114     2 172.16.230.237 TCP_DENIED/403 19053 GET
<A HREF="https://d20rj4el6vkp4c.cloudfront.net/7/11/ubuntu/package_files/35938.deb?">https://d20rj4el6vkp4c.cloudfront.net/7/11/ubuntu/package_files/35938.deb?</A>
- HIER_NONE/- text/html

Thanks,
Mirek
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20210421/9650a8db/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20210421/9650a8db/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="023559.html">[squid-users] How to see running configuration paramters
</A></li>
	<LI>Next message (by thread): <A HREF="023565.html">[squid-users] allow request to cloudfront after 302 redirection.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23564">[ date ]</a>
              <a href="thread.html#23564">[ thread ]</a>
              <a href="subject.html#23564">[ subject ]</a>
              <a href="author.html#23564">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
