<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Allowing User Certificate Authentication with SSL Bump
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Allowing%20User%20Certificate%20Authentication%20with%20SSL%0A%20Bump&In-Reply-To=%3Cebf4fea1-146f-fef5-f741-315e6c75ea34%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023578.html">
   <LINK REL="Next"  HREF="023580.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Allowing User Certificate Authentication with SSL Bump</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Allowing%20User%20Certificate%20Authentication%20with%20SSL%0A%20Bump&In-Reply-To=%3Cebf4fea1-146f-fef5-f741-315e6c75ea34%40measurement-factory.com%3E"
       TITLE="[squid-users] Allowing User Certificate Authentication with SSL Bump">rousskov at measurement-factory.com
       </A><BR>
    <I>Wed Apr 28 19:40:54 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="023578.html">[squid-users] Allowing User Certificate Authentication with SSL Bump
</A></li>
        <LI>Next message (by thread): <A HREF="023580.html">[squid-users] Allowing User Certificate Authentication with SSL Bump
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23579">[ date ]</a>
              <a href="thread.html#23579">[ thread ]</a>
              <a href="subject.html#23579">[ subject ]</a>
              <a href="author.html#23579">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 4/27/21 6:23 PM, Justin Cook wrote:
&gt;<i> In this case we're not looking to authenticate the user themselves with
</I>&gt;<i> the squid server but with the destination web server, does that change
</I>&gt;<i> the scope?
</I>
* If you do need to bump TLS connections:

Yes, certificate authentication with an origin server is a different
problem. If Squid does not possess the client certificate key, then
Squid cannot both bump the TLS client connection (i.e. become the client
from the origin server point of view) and keep the old client from the
origin server point of view.

In this case, this is not a technical limitation of the current Squid
implementation like &quot;TLS inside TLS&quot;; it is a protocol-level conflict
that no implementation can resolve. TLS design makes
faking/impersonating the authenticating client impossible without
leaking the client key to the proxy.

If you can refactor so that the origin server trusts Squid instead of
the client, and Squid authenticates the TLS client, then we will be back
to the earlier &quot;TLS inside TLS&quot; problem (not to mention client
changes/complications), so this kind of refactoring is unlikely to be
the right way forward.


* If you only need to peek at TLS connections:

You should be able to keep client certificate authentication. If Squid
cannot keep that while peeking at the TLS client or the origin server,
then there is a Squid bug somewhere.


HTH,

Alex.


&gt;<i> On Tue, Apr 27, 2021 at 10:57 AM Alex Rousskov wrote:
</I>&gt;<i> 
</I>&gt;<i>     On 4/27/21 1:33 PM, Justin Cook wrote:
</I>&gt;<i>     &gt; We are running into a situation where we are unable to fully
</I>&gt;<i>     &gt; authenticate our users to an internal tooling service that requires
</I>&gt;<i>     &gt; certificate authentication as part of its login process, when going
</I>&gt;<i>     &gt; through squid forward proxy with SSL bump enabled.
</I>&gt;<i> 
</I>&gt;<i>     SslBump does not support &quot;TLS inside TLS&quot; configurations, which is what
</I>&gt;<i>     you get when you combine certificate-based proxy authentication (which
</I>&gt;<i>     requires an https_port working in a forward proxy mode) with SslBump
</I>&gt;<i>     (which, for an https_port, currently requires an interception proxy
</I>&gt;<i>     mode).
</I>&gt;<i> 
</I>&gt;<i>     It is possible to add support for &quot;TLS inside TLS&quot;, but it requires a
</I>&gt;<i>     serious development effort.
</I>&gt;<i> 
</I>&gt;<i>     <A HREF="https://wiki.squid-cache.org/SquidFaq/AboutSquid#How_to_add_a_new_Squid_feature.2C_enhance.2C_of_fix_something.3F">https://wiki.squid-cache.org/SquidFaq/AboutSquid#How_to_add_a_new_Squid_feature.2C_enhance.2C_of_fix_something.3F</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     HTH,
</I>&gt;<i> 
</I>&gt;<i>     Alex.
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="023578.html">[squid-users] Allowing User Certificate Authentication with SSL Bump
</A></li>
	<LI>Next message (by thread): <A HREF="023580.html">[squid-users] Allowing User Certificate Authentication with SSL Bump
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23579">[ date ]</a>
              <a href="thread.html#23579">[ thread ]</a>
              <a href="subject.html#23579">[ subject ]</a>
              <a href="author.html#23579">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
