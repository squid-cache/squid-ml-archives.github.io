<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid 5.1 missing ENTRY_REQUIRES_COLLAPSING
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%205.1%20missing%20ENTRY_REQUIRES_COLLAPSING&In-Reply-To=%3C72DD5D5CF661B5459DC08A060BF26B53010896FB%40kjj-server.KJJ.local%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023944.html">
   <LINK REL="Next"  HREF="023941.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid 5.1 missing ENTRY_REQUIRES_COLLAPSING</H1>
    <B>Lou&#269;ansk&#253; Luk&#225;&#353;</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%205.1%20missing%20ENTRY_REQUIRES_COLLAPSING&In-Reply-To=%3C72DD5D5CF661B5459DC08A060BF26B53010896FB%40kjj-server.KJJ.local%3E"
       TITLE="[squid-users] squid 5.1 missing ENTRY_REQUIRES_COLLAPSING">Loucansky.Lukas at kjj.cz
       </A><BR>
    <I>Wed Aug 11 06:43:44 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="023944.html">[squid-users] no ssl intercept - question how it works
</A></li>
        <LI>Next message (by thread): <A HREF="023941.html">[squid-users] squid 5.1 missing ENTRY_REQUIRES_COLLAPSING
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23936">[ date ]</a>
              <a href="thread.html#23936">[ thread ]</a>
              <a href="subject.html#23936">[ subject ]</a>
              <a href="author.html#23936">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,
just rolled out squid 5.1 into production machine and got several of
 
2021/08/11 08:10:45 kid2| BUG: missing ENTRY_REQUIRES_COLLAPSING for e:tr4315=V/0x556f34ceba10*0
    current master transaction: master55
2021/08/11 08:10:48 kid2| BUG: missing ENTRY_REQUIRES_COLLAPSING for e:tr4315=V/0x556f34e7f030*0
    current master transaction: master55
2021/08/11 08:10:49 kid2| BUG: missing ENTRY_REQUIRES_COLLAPSING for e:tr4315=V/0x556f3448d400*0
    current master transaction: master55
2021/08/11 08:10:51 kid2| BUG: missing ENTRY_REQUIRES_COLLAPSING for e:tr4315=V/0x556f375bb810*0
    current master transaction: master55
2021/08/11 08:10:59 kid2| BUG: missing ENTRY_REQUIRES_COLLAPSING for e:tr9536=V/0x556f36dace30*0
    current master transaction: master55

 
kids 1 to 4 are workers. I Was using {process_number} macro to create separate aufs cache_dirs for each worker process, recently have changed to one more rock storage. ie no aufs cache_dirs - only rock with different max-size and slot size. However I'm using {process_number} macro to run store_id_program for each worker - like this
 
#worker1
if ${process_number} = 1
store_id_program /lib/squid5/storeid_file_rewrite /etc/squid5/acl/storeid_rewrite.conf
store_id_children 4 startup=1 idle=1 concurrency=0
acl noStoreID url_regex &quot;/etc/squid5/acl/storeid.whitelist&quot;
store_id_access deny noStoreID
store_id_access allow all
endif

etc. for other workers.
 
 
Seems connected with downloading of MS updates from:
2021/08/11 08:05:04 kid2| ctx: enter level  0: '<A HREF="http://9.tlu.dl.delivery.mp.microsoft.com/filestreamingservice/files/c11c61e1-2c71-4bdc-be53-3c44d1d491f8?P1=1628662587&amp;P2=404&amp;P3=2&amp;P4=AFBNnEb3I1J1i2txgqn9sgKDx6g4wu4Nk8w9MYCvYZqnQg%2fWduDXekI58E264AhA3%2fpZmM5%2b2%2fPFmER9Vr8xnw%3d%3d">http://9.tlu.dl.delivery.mp.microsoft.com/filestreamingservice/files/c11c61e1-2c71-4bdc-be53-3c44d1d491f8?P1=1628662587&amp;P2=404&amp;P3=2&amp;P4=AFBNnEb3I1J1i2txgqn9sgKDx6g4wu4Nk8w9MYCvYZqnQg%2fWduDXekI58E264AhA3%2fpZmM5%2b2%2fPFmER9Vr8xnw%3d%3d</A>'
2021/08/11 08:05:04 kid2| BUG: missing ENTRY_REQUIRES_COLLAPSING for e:tr15985=V/0x556f3450d800*0
    current master transaction: master55
2021/08/11 08:05:38 kid2| ctx: exit level  0
2021/08/11 08:05:38 kid2| ctx: enter level  0: '<A HREF="http://2.tlu.dl.delivery.mp.microsoft.com/filestreamingservice/files/696b26de-18b8-4bd4-8b77-f7f700102951?P1=1628667955&amp;P2=404&amp;P3=2&amp;P4=B6QCKlBJwUdlz1WE9pHnSFs1fgTTOrjLFl%2fAsdkytWDzyqVeKXqCfdO7IocO2%2bbE1RVMyU7whVyM7iM8MSTs1g%3d%3d">http://2.tlu.dl.delivery.mp.microsoft.com/filestreamingservice/files/696b26de-18b8-4bd4-8b77-f7f700102951?P1=1628667955&amp;P2=404&amp;P3=2&amp;P4=B6QCKlBJwUdlz1WE9pHnSFs1fgTTOrjLFl%2fAsdkytWDzyqVeKXqCfdO7IocO2%2bbE1RVMyU7whVyM7iM8MSTs1g%3d%3d</A>'
2021/08/11 08:05:38 kid2| BUG: missing ENTRY_REQUIRES_COLLAPSING for e:tr12742=V/0x556f373e32d0*0
    current master transaction: master55
2021/08/11 08:09:18 kid2| ctx: exit level  0
2021/08/11 08:09:18 kid2| BUG: missing ENTRY_REQUIRES_COLLAPSING for e:tr4315=V/0x556f35068920*0
    current master transaction: master55

storeid_rewrite.conf entry for microsoft.com looks like
^https?:\/\/.+?\.ws\.microsoft\.com\/.+?_([0-9a-z]{40})\.(cab|exe|ms[i|u|f]|asf|wm[v|a]|dat|zip|psf|appx)       <A HREF="http://wupdate.squid.local/$1">http://wupdate.squid.local/$1</A>

Several of 2021/08/10 08:46:54 kid2| assertion failed: Controller.cc:930: &quot;!transients || e.hasTransients()&quot; have been logged yesterday, but none since I swapped to all-rocks.

I'm going to change my config to remove store_id configuration for each worker and instead run it without {process_number} macros. I;m not sure why I did it - I tried to conserver resources - like filedescriptors allocation, dns cache entries etc. not important for diskers - so I created these macro statements to allocate it only for workers.

THX
LL 

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="023944.html">[squid-users] no ssl intercept - question how it works
</A></li>
	<LI>Next message (by thread): <A HREF="023941.html">[squid-users] squid 5.1 missing ENTRY_REQUIRES_COLLAPSING
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23936">[ date ]</a>
              <a href="thread.html#23936">[ thread ]</a>
              <a href="subject.html#23936">[ subject ]</a>
              <a href="author.html#23936">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
