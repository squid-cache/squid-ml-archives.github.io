<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] no ssl intercept - question how it works
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20no%20ssl%20intercept%20-%20question%20how%20it%20works&In-Reply-To=%3CCAGU_CiJJnMoYwYZa04z2yv1xtZhL_1GqBZ7a9-jF1ZSo%3DZF3rw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023935.html">
   <LINK REL="Next"  HREF="023943.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] no ssl intercept - question how it works</H1>
    <B>robert k Wild</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20no%20ssl%20intercept%20-%20question%20how%20it%20works&In-Reply-To=%3CCAGU_CiJJnMoYwYZa04z2yv1xtZhL_1GqBZ7a9-jF1ZSo%3DZF3rw%40mail.gmail.com%3E"
       TITLE="[squid-users] no ssl intercept - question how it works">robertkwild at gmail.com
       </A><BR>
    <I>Wed Aug 11 16:06:00 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="023935.html">[squid-users] no ssl intercept - question how it works
</A></li>
        <LI>Next message (by thread): <A HREF="023943.html">[squid-users] no ssl intercept - question how it works
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23942">[ date ]</a>
              <a href="thread.html#23942">[ thread ]</a>
              <a href="subject.html#23942">[ subject ]</a>
              <a href="author.html#23942">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Great thanks Amos as always

So shall I leave this ssl bump lines in

ssl_bump splice NoSSLIntercept
&gt;<i> ssl_bump peek DiscoverSNIHost
</I>&gt;<i> ssl_bump bump all
</I>
And delete this one

acl step1 at_step SslBump1
&gt;<i> ssl_bump peek step1
</I>&gt;<i> ssl_bump bump all
</I>
As your right there both the same, I didn't spot that

My understanding is the &quot;no ssl intercept&quot;, squid doesn't even bother to
inspect the packets ie man in the middle and just literally passes it
straight to the client

Is that right?

Thanks,
Rob


On Wed, 11 Aug 2021, 06:48 Amos Jeffries, &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; wrote:

&gt;<i> On 11/08/21 4:56 am, robert k Wild wrote:
</I>&gt;<i> &gt; hi all,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; before i continue, so sorry for the stupid question but trying to learn
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; basically heres my squid.conf
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; #NO SSL Interception
</I>&gt;<i> &gt; acl DiscoverSNIHost at_step SslBump1
</I>&gt;<i> &gt; acl NoSSLIntercept ssl::server_name
</I>&gt;<i> &gt; &quot;/usr/local/squid/etc/nointerceptssl.txt&quot;
</I>&gt;<i> &gt; ssl_bump splice NoSSLIntercept
</I>&gt;<i> &gt; ssl_bump peek DiscoverSNIHost
</I>&gt;<i> &gt; ssl_bump bump all
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; #SSL Bump
</I>&gt;<i> &gt; http_port 3128 ssl-bump cert=/usr/local/squid/etc/ssl_cert/myCA.pem
</I>&gt;<i> &gt; generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
</I>&gt;<i> &gt; sslcrtd_program /usr/local/squid/libexec/security_file_certgen -s
</I>&gt;<i> &gt; /var/lib/ssl_db -M 4MB
</I>&gt;<i>
</I>&gt;<i> Note:
</I>&gt;<i>
</I>&gt;<i>   You already have ssl_bump rules above which either splice or bump at
</I>&gt;<i> step 1. These following ssl_bump rule either never get reached, or are
</I>&gt;<i> already known impossible to perform if they do get reached.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; acl step1 at_step SslBump1
</I>&gt;<i> &gt; ssl_bump peek step1
</I>&gt;<i> &gt; ssl_bump bump all
</I>&gt;<i> &gt; #
</I>&gt;<i> &gt; #allow special URL paths
</I>&gt;<i> &gt; acl special_url url_regex &quot;/usr/local/squid/etc/urlspecial.txt&quot;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; #deny MIME types
</I>&gt;<i> &gt; acl mimetype rep_mime_type &quot;/usr/local/squid/etc/mimedeny.txt&quot;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; http_reply_access allow special_url
</I>&gt;<i> &gt; http_reply_access deny mimetype
</I>&gt;<i> &gt; #
</I>&gt;<i> &gt; #HTTP_HTTPS whitelist websites
</I>&gt;<i> &gt; acl whitelist ssl::server_name &quot;/usr/local/squid/etc/urlwhite.txt&quot;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; #HTTP_HTTPS whitelist websites regex
</I>&gt;<i> &gt; acl whitelistreg ssl::server_name_regex
</I>&gt;<i> &gt; &quot;/usr/local/squid/etc/urlregwhite.txt&quot;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; http_access allow activation whitelist
</I>&gt;<i> &gt; http_access allow activation whitelistreg
</I>&gt;<i> &gt; http_access deny all
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; in my urlwhitelist is this
</I>&gt;<i> &gt;
</I>&gt;<i> ...
</I>&gt;<i> &gt; in my nointerceptssl is this
</I>&gt;<i> &gt;
</I>&gt;<i> ...
</I>&gt;<i>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; i got all the urls etc looking at tail -f access.log and greping the ip
</I>&gt;<i> &gt; and tcp denied
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; but when i try to load the apple app store the whitelist isnt enough, i
</I>&gt;<i> &gt; need to add a couple of urls to the nointerceptssl
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; i got that list by doing the same method ie looking at tail -f
</I>&gt;<i> &gt; access.log and greping the ip but as ive already whitelisted the urls
</I>&gt;<i> &gt; they all came back as none or ok instead of saying tcp denied
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; my question is why do i need to add some urls to the nointerceptssl and
</I>&gt;<i> &gt; why isnt it enough just to add it to urlwhite list
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> Because you are using those ACLs exclusively for very different things.
</I>&gt;<i>
</I>&gt;<i>   - &quot;whitelist&quot; is being exclusively used to check URI domains found in
</I>&gt;<i> HTTP messages (http_access). Where &quot;server name&quot; is the CONNECT tunnel
</I>&gt;<i> authority name or IPs reverse-DNS name, or decrypted <A HREF="https://">https://</A> URL
</I>&gt;<i> domain. It has nothing to do with the TLS handshake activity.
</I>&gt;<i>
</I>&gt;<i>   - &quot;NoSSLIntercept&quot; is being exclusively used for TLS handshake
</I>&gt;<i> decisions (ssl_bump). Where &quot;server name&quot; is the CONNECT tunnel
</I>&gt;<i> authority name or raw-IP, TLS SNI, or server certificate altSubjectName.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> You could use whitelist ACL in ssl_bump checks instead of
</I>&gt;<i> NoSSLIntercept. At which point the ACL is now being used for both sets
</I>&gt;<i> of checks and decisions.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20210811/a859d628/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20210811/a859d628/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="023935.html">[squid-users] no ssl intercept - question how it works
</A></li>
	<LI>Next message (by thread): <A HREF="023943.html">[squid-users] no ssl intercept - question how it works
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23942">[ date ]</a>
              <a href="thread.html#23942">[ thread ]</a>
              <a href="subject.html#23942">[ subject ]</a>
              <a href="author.html#23942">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
