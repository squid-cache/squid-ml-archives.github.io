<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid v4.45
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20v4.45&In-Reply-To=%3Cvmime.6123465b.2dd.78478a7d20d5148b%40ms249-lin-003.rotterdam.bazuin.nl%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023971.html">
   <LINK REL="Next"  HREF="023988.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid v4.45</H1>
    <B>L.P.H. van Belle</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20v4.45&In-Reply-To=%3Cvmime.6123465b.2dd.78478a7d20d5148b%40ms249-lin-003.rotterdam.bazuin.nl%3E"
       TITLE="[squid-users] Squid v4.45">belle at bazuin.nl
       </A><BR>
    <I>Mon Aug 23 06:55:23 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="023971.html">[squid-users] Squid v4.45
</A></li>
        <LI>Next message (by thread): <A HREF="023988.html">[squid-users] Squid v4.45
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23972">[ date ]</a>
              <a href="thread.html#23972">[ thread ]</a>
              <a href="subject.html#23972">[ subject ]</a>
              <a href="author.html#23972">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>In your windows config. 
Remove the ip adres from the gateway and configure your proxy settings.  
Without proxy and gateway no internet.

Or setup SSL proxy 
Add something like this in your firewall and you catch all. 

# Redirect HTTP on eth0 from LAN_CIDR to locally installed Squid instance using REDIRECT for intercept mode
iptables -t mangle -A PREROUTING -i eth0 -s 192.168.0.0/24 -p tcp --dport 80 -j REDIRECT --to-port 6080 -m comment --comment &quot;Squid-Intercept 80-&gt;6080&quot;

# Redirect HTTPS on eth0 from CIDR to locally installed Squid instance using REDIRECT for intercept mode
-A PREROUTING -i eth0 -s 192.168.0.0/24 -p tcp --dport 443 -j REDIRECT --to-port 6433 -m comment --comment &quot;Squid-Intercept 443-&gt;6433&quot;

And read : 
<A HREF="https://wiki.squid-cache.org/KnowledgeBase/Block%20QUIC%20protocol">https://wiki.squid-cache.org/KnowledgeBase/Block%20QUIC%20protocol</A>


&gt;<i>The NIC status simply says that *somehow* the Internet is available.
</I>No, windows 10 does a DNS querie to an MS server, block that and and you see &quot;no internet&quot; 
Even if you have internet. 

Maybe PiHole is something for you that does most of what you want. 


Greetz, 

Louis


&gt;<i> -----Oorspronkelijk bericht-----
</I>&gt;<i> Van: squid-users 
</I>&gt;<i> [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] Namens 
</I>&gt;<i> Periko Support
</I>&gt;<i> Verzonden: maandag 23 augustus 2021 7:55
</I>&gt;<i> Aan: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> Onderwerp: Re: [squid-users] Squid v4.45
</I>&gt;<i> 
</I>&gt;<i> On Thu, Aug 19, 2021 at 7:40 PM Amos Jeffries 
</I>&gt;<i> &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; FYI, there is no such version as Squid 4.45.
</I>&gt;<i> 
</I>&gt;<i> Amos sorry, is 4.15 my mistake.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; What is the output when you run &quot;squid -v&quot; ?
</I>&gt;<i> &gt;
</I>&gt;<i>  squid -v
</I>&gt;<i> Squid Cache: Version 4.15
</I>&gt;<i> Service Name: squid
</I>&gt;<i> 
</I>&gt;<i> This binary uses OpenSSL 1.1.1k-freebsd  25 Mar 2021. For legal
</I>&gt;<i> restrictions on distribution see
</I>&gt;<i> <A HREF="https://www.openssl.org/source/license.html">https://www.openssl.org/source/license.html</A>
</I>&gt;<i> 
</I>&gt;<i> configure options:  '--with-default-user=squid'
</I>&gt;<i> '--bindir=/usr/local/sbin' '--sbindir=/usr/local/sbin'
</I>&gt;<i> '--datadir=/usr/local/etc/squid'
</I>&gt;<i> '--libexecdir=/usr/local/libexec/squid' '--localstatedir=/var'
</I>&gt;<i> '--sysconfdir=/usr/local/etc/squid' '--with-logdir=/var/log/squid'
</I>&gt;<i> '--with-pidfile=/var/run/squid/squid.pid'
</I>&gt;<i> '--with-swapdir=/var/squid/cache' '--without-gnutls'
</I>&gt;<i> '--with-included-ltdl' '--enable-auth' '--enable-zph-qos'
</I>&gt;<i> '--enable-build-info' '--enable-loadable-modules'
</I>&gt;<i> '--enable-removal-policies=lru heap' '--disable-epoll'
</I>&gt;<i> '--disable-linux-netfilter' '--disable-linux-tproxy'
</I>&gt;<i> '--disable-translation' '--disable-arch-native'
</I>&gt;<i> '--disable-strict-error-checking' '--enable-eui'
</I>&gt;<i> '--enable-cache-digests' '--enable-delay-pools' '--disable-ecap'
</I>&gt;<i> '--disable-esi' '--enable-follow-x-forwarded-for'
</I>&gt;<i> '--with-mit-krb5=/usr/local' 'CFLAGS=-I/usr/local/include -O2 -pipe
</I>&gt;<i> -I/usr/local/include -I/usr/local/include -fstack-protector-strong
</I>&gt;<i> -DLDAP_DEPRECATED -fno-strict-aliasing ' 'LDFLAGS=-L/usr/local/lib
</I>&gt;<i> -L/usr/local/lib -L/usr/local/lib -pthread -L/usr/local/lib
</I>&gt;<i> -lpcreposix -lpcre -Wl,-rpath,/usr/local/lib:/usr/lib
</I>&gt;<i> -fstack-protector-strong ' 'LIBS=-lkrb5 -lgssapi_krb5 '
</I>&gt;<i> 'KRB5CONFIG=/usr/local/bin/krb5-config'
</I>&gt;<i> 'krb5_config=/usr/local/bin/krb5-config' '--enable-htcp'
</I>&gt;<i> '--enable-icap-client' '--enable-icmp' '--enable-ident-lookups'
</I>&gt;<i> '--enable-ipv6' '--enable-kqueue' '--with-large-files'
</I>&gt;<i> '--enable-http-violations' '--without-nettle' '--enable-snmp'
</I>&gt;<i> '--enable-ssl' '--with-openssl=/usr'
</I>&gt;<i> '--enable-security-cert-generators=file'
</I>&gt;<i> 'LIBOPENSSL_CFLAGS=-I/usr/include' 'LIBOPENSSL_LIBS=-lcrypto -lssl'
</I>&gt;<i> '--enable-ssl-crtd' '--disable-stacktraces'
</I>&gt;<i> '--disable-ipf-transparent' '--disable-ipfw-transparent'
</I>&gt;<i> '--enable-pf-transparent' '--with-nat-devpf' '--disable-forw-via-db'
</I>&gt;<i> '--enable-wccp' '--enable-wccpv2' '--enable-auth-basic=LDAP SASL DB
</I>&gt;<i> SMB_LM NCSA PAM POP3 RADIUS fake getpwnam NIS'
</I>&gt;<i> '--enable-auth-digest=eDirectory LDAP file'
</I>&gt;<i> '--enable-external-acl-helpers=LDAP_group eDirectory_userip
</I>&gt;<i> file_userip unix_group delayer kerberos_ldap_group'
</I>&gt;<i> '--enable-auth-negotiate=kerberos wrapper' '--enable-auth-ntlm=fake
</I>&gt;<i> SMB_LM' '--enable-storeio=aufs diskd ufs'
</I>&gt;<i> '--enable-disk-io=DiskThreads DiskDaemon AIO Blocking IpcIo Mmapped'
</I>&gt;<i> '--enable-log-daemon-helpers=file DB'
</I>&gt;<i> '--enable-url-rewrite-helpers=fake LFS'
</I>&gt;<i> '--enable-storeid-rewrite-helpers=file'
</I>&gt;<i> '--enable-security-cert-validators=fake' '--prefix=/usr/local'
</I>&gt;<i> '--mandir=/usr/local/man' '--disable-silent-rules'
</I>&gt;<i> '--infodir=/usr/local/share/info/' '--build=amd64-portbld-freebsd12.2'
</I>&gt;<i> 'build_alias=amd64-portbld-freebsd12.2' 'CC=cc'
</I>&gt;<i> 'CPPFLAGS=-I/usr/local/include -I/usr/local/include' 'CXX=c++'
</I>&gt;<i> 'CXXFLAGS=-O2 -pipe -I/usr/local/include -I/usr/local/include
</I>&gt;<i> -fstack-protector-strong -DLDAP_DEPRECATED -fno-strict-aliasing  '
</I>&gt;<i> 'CPP=cpp' --enable-ltdl-convenience
</I>&gt;<i> &gt; On 19/08/21 4:12 am, Periko Support wrote:
</I>&gt;<i> &gt; &gt; Hello guys.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; I have been searching the issue I have with windows 10 
</I>&gt;<i> and the ugly
</I>&gt;<i> &gt; &gt; job he do to put the NIC &quot;Internet access&quot; and went we have squid
</I>&gt;<i> &gt; &gt; behind &quot;no internet&quot;.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The NIC status simply says that *somehow* the Internet is available.
</I>&gt;<i> &gt; that means DNS resolution, TCP connectivity, HTTP 
</I>&gt;<i> transactions and HTTPS
</I>&gt;<i> &gt; transactions are all fully working and producing responses.
</I>&gt;<i> 
</I>&gt;<i> Windows 10 if for some reason cannot reach the internet will 
</I>&gt;<i> say &quot;no internet&quot;.
</I>&gt;<i> 
</I>&gt;<i> I had sniff the communication and I just found thos 2 sites that looks
</I>&gt;<i> like windows use to check connectivity.
</I>&gt;<i> 
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Break any one and you will get &quot;no internet&quot;. Even when the rest
</I>&gt;<i> &gt; continue working fine. So it can tell you when some sort of failure
</I>&gt;<i> &gt; occurs, but is not reliable when it claims success.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Please be aware that using your Squid proxy properly is one 
</I>&gt;<i> way Windows
</I>&gt;<i> &gt; can receive all those services and claim &quot;Internet Access&quot;.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; I have sniff logs and  I just found this sites went I 
</I>&gt;<i> turn on the computer:
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; .msftconnecttest.com
</I>&gt;<i> &gt; &gt; .windows.com
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Some has win over this annoying thing with windows 10?
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; No-Trans[parent Proxy WPAD.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Check that your firewall does not permit HTTP(S) 
</I>&gt;<i> connections directly
</I>&gt;<i> &gt; from clients to the Internet.
</I>&gt;<i> 
</I>&gt;<i> I don't allow direct connection to the Internet, all 80/443 must cross
</I>&gt;<i> under squid.
</I>&gt;<i> 
</I>&gt;<i> &gt; When;
</I>&gt;<i> &gt;   * your network gateway firewall(s) block direct connections (other
</I>&gt;<i> &gt; than from Squid) to HTTP(S), and
</I>&gt;<i> &gt;   * your proxy logs show those Win10 connection URLs happening, and
</I>&gt;<i> &gt;   * Win10 NIC says &quot;Interent Access&quot;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Then you know that the proxy usage is how &quot;Internet Access&quot; happens,
</I>&gt;<i> &gt; that is what you want so no problem.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> 
</I>&gt;<i> I still haven't found the solution to this little issue.
</I>&gt;<i> 
</I>&gt;<i> Regards!!!
</I>&gt;<i> 
</I>&gt;<i> &gt; Amos
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; squid-users mailing list
</I>&gt;<i> &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> &gt; <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="023971.html">[squid-users] Squid v4.45
</A></li>
	<LI>Next message (by thread): <A HREF="023988.html">[squid-users] Squid v4.45
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23972">[ date ]</a>
              <a href="thread.html#23972">[ thread ]</a>
              <a href="subject.html#23972">[ subject ]</a>
              <a href="author.html#23972">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
