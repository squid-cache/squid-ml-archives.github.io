<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Setting Squid to work with a remote DB?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Setting%20Squid%20to%20work%20with%20a%20remote%20DB%3F&In-Reply-To=%3C3f986125-b56e-f40d-eee9-9287c281d4f8%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023978.html">
   <LINK REL="Next"  HREF="023980.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Setting Squid to work with a remote DB?</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Setting%20Squid%20to%20work%20with%20a%20remote%20DB%3F&In-Reply-To=%3C3f986125-b56e-f40d-eee9-9287c281d4f8%40measurement-factory.com%3E"
       TITLE="[squid-users] Setting Squid to work with a remote DB?">rousskov at measurement-factory.com
       </A><BR>
    <I>Sat Aug 28 19:33:21 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="023978.html">[squid-users] Setting Squid to work with a remote DB?
</A></li>
        <LI>Next message (by thread): <A HREF="023980.html">[squid-users] Setting Squid to work with a remote DB?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23979">[ date ]</a>
              <a href="thread.html#23979">[ thread ]</a>
              <a href="subject.html#23979">[ subject ]</a>
              <a href="author.html#23979">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 8/28/21 2:59 PM, roee klinger wrote:

&gt;<i> I have multiple Squid servers installed in different data centers across
</I>&gt;<i> different cloud providers, and they all need to authenticate&#160;users using
</I>&gt;<i> a&#160;single database (MySQL) on a separate server, which is also on a
</I>&gt;<i> different cloud provider&#160;on a different data center.
</I>&gt;<i> 
</I>&gt;<i> I have already written an external authentication&#160;script that reads from
</I>&gt;<i> MySQL and everything is working&#160;fine, however, I have some
</I>&gt;<i> performance&#160;concerns, since the DB is located externally and in a
</I>&gt;<i> different region of the world from the Squid server.
</I>&gt;<i> 
</I>&gt;<i> I made some speed tests to see how long it takes to query the DB as
</I>&gt;<i> Squid would:
</I>&gt;<i> 
</I>&gt;<i> if the database is located on the same machine as Squid:
</I>&gt;<i> 1.067-millisecond average query
</I>&gt;<i> 
</I>&gt;<i> if the database is located on the same datacenter as Squid:
</I>&gt;<i> 2.67-millisecond average query
</I>&gt;<i> 
</I>&gt;<i> if the database is located on a different datacenter than Squid
</I>&gt;<i> (different country as well): 38.9-millisecond average query
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Now I am wondering, is&#160;36-millisecond average added query time a big
</I>&gt;<i> deal when dealing with HTTP/S traffic? how significant is this added
</I>&gt;<i> time to Squid and will performance&#160;get hurt drastically?
</I>
* When you look at a single HTTP transaction, adding 36ms is usually not
a big deal: Humans are incapable of discerning such delays and
automatons that need true real-time performance are unlikely to go
through your Squids.

* Additional 36ms added to mean transaction response time create
significant perceived delays for sites/services that load lots of
resources _sequentially,_ especially if such a site/service has lighting
fast response times without those extra delays. For example, without
authentication caching and similar optimizations, a cumulative extra
delay of 100 sequential transactions (that would normally take, say,
300ms total) would be 3.6 seconds -- something many humans will be
annoyed with!

* Additional 36ms added to mean transaction response time can kill
performance of a Squid instance that is operating at the limit of some
resource capacity.

For example, imagine that, without authentication delays, your Squid
transactions have 10ms mean response time, and your Squid instance is
dealing with 10'000 requests per second load. That combination results
in just 100 concurrent requests (10'000r/s * 0.01s = 100r). If you add
36ms to that 10ms response time, your Squid would have to deal with 460
concurrent requests (10'000r/s * 0.046s = 460r) -- a 360% increase in
concurrency levels and associated resource consumption. Such an increase
is likely to maim any Squid that was operating without significant spare
resources.

For an opposite example, imagine that, without authentication delays,
your Squid transactions have 1 second mean response time, and your Squid
instance is dealing with 10'000 requests per second load. That
combination results in 10'000 concurrent requests. If you add 36ms to
that 1s response time, your Squid would have to deal with 10'360
concurrent requests -- a mere 3.6% increase in concurrency levels and
associated resource consumption.

Keep in mind that as Squid approaches resource limits, things usually
get _exponentially_ worse.


The impact of additional authentication delays should be fairly easy to
model/test.


HTH,

Alex.


&gt;<i> I know there is some caching going on the Squid side, but I had to set
</I>&gt;<i> the caching to really low values (around 15s), as per the requirement I
</I>&gt;<i> was given.
</I>&gt;<i> 
</I>&gt;<i> If I will have no other choice, I will simply replicate the DB table
</I>&gt;<i> from the DB server to the Squid server, but I prefer not to do that, as
</I>&gt;<i> it will require installing MySQL on all the Squid servers (or some other
</I>&gt;<i> DB, but then I have to do replication from different DBs).
</I>&gt;<i> 
</I>&gt;<i> Thanks.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="023978.html">[squid-users] Setting Squid to work with a remote DB?
</A></li>
	<LI>Next message (by thread): <A HREF="023980.html">[squid-users] Setting Squid to work with a remote DB?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23979">[ date ]</a>
              <a href="thread.html#23979">[ thread ]</a>
              <a href="subject.html#23979">[ subject ]</a>
              <a href="author.html#23979">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
