<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Setting Squid to work with a remote DB?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Setting%20Squid%20to%20work%20with%20a%20remote%20DB%3F&In-Reply-To=%3CCAGCa14ri%3DoGaZVEHuBBCUMR-rw%2BkemLZgSgB3de1NPhbfq3eMA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023979.html">
   <LINK REL="Next"  HREF="023981.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Setting Squid to work with a remote DB?</H1>
    <B>roee klinger</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Setting%20Squid%20to%20work%20with%20a%20remote%20DB%3F&In-Reply-To=%3CCAGCa14ri%3DoGaZVEHuBBCUMR-rw%2BkemLZgSgB3de1NPhbfq3eMA%40mail.gmail.com%3E"
       TITLE="[squid-users] Setting Squid to work with a remote DB?">roeeklinger60 at gmail.com
       </A><BR>
    <I>Sat Aug 28 20:00:22 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="023979.html">[squid-users] Setting Squid to work with a remote DB?
</A></li>
        <LI>Next message (by thread): <A HREF="023981.html">[squid-users] Setting Squid to work with a remote DB?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23980">[ date ]</a>
              <a href="thread.html#23980">[ thread ]</a>
              <a href="subject.html#23980">[ subject ]</a>
              <a href="author.html#23980">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thank you Alex, for the detailed response, I will keep that info in mind
while testing.

If I can convenience the team to increase the &quot;auth_param basic
credentialsttl&quot; to around 60
minutes, we should have absolutely no problem, please correct me if I am
wrong.

As per my understanding, even if the DB server is all the way across the
world, and we have an added
response time of 1 second that occurs only once every 60 minutes, that
would have almost 0 impact
on the performance and resources used by Squid.

My only concern is for 407s, do users that get 407 are also cached?
In case that they do get cached, that would mean that if I send one request
using some username, it gets 407, and then I add the username to the DB,
it will still not work for 60 minutes.

However, if it is not cached, that could potentially cause big resources
usage as well,
since every 407 request takes around 1 second to resolve, and we have a lot
of those.

Anyway, it seems that no matter if 407 are cached or not, it will cause
some issues
if the DB response takes around 1 second unless I am overestimating the
resource
use of these requests.

I would love to hear your thoughts on that solution,
Thanks,
Roee


On Sat, Aug 28, 2021 at 10:33 PM Alex Rousskov &lt;
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt; wrote:

&gt;<i> On 8/28/21 2:59 PM, roee klinger wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; I have multiple Squid servers installed in different data centers across
</I>&gt;<i> &gt; different cloud providers, and they all need to authenticate users using
</I>&gt;<i> &gt; a single database (MySQL) on a separate server, which is also on a
</I>&gt;<i> &gt; different cloud provider on a different data center.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I have already written an external authentication script that reads from
</I>&gt;<i> &gt; MySQL and everything is working fine, however, I have some
</I>&gt;<i> &gt; performance concerns, since the DB is located externally and in a
</I>&gt;<i> &gt; different region of the world from the Squid server.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I made some speed tests to see how long it takes to query the DB as
</I>&gt;<i> &gt; Squid would:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; if the database is located on the same machine as Squid:
</I>&gt;<i> &gt; 1.067-millisecond average query
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; if the database is located on the same datacenter as Squid:
</I>&gt;<i> &gt; 2.67-millisecond average query
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; if the database is located on a different datacenter than Squid
</I>&gt;<i> &gt; (different country as well): 38.9-millisecond average query
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Now I am wondering, is 36-millisecond average added query time a big
</I>&gt;<i> &gt; deal when dealing with HTTP/S traffic? how significant is this added
</I>&gt;<i> &gt; time to Squid and will performance get hurt drastically?
</I>&gt;<i>
</I>&gt;<i> * When you look at a single HTTP transaction, adding 36ms is usually not
</I>&gt;<i> a big deal: Humans are incapable of discerning such delays and
</I>&gt;<i> automatons that need true real-time performance are unlikely to go
</I>&gt;<i> through your Squids.
</I>&gt;<i>
</I>&gt;<i> * Additional 36ms added to mean transaction response time create
</I>&gt;<i> significant perceived delays for sites/services that load lots of
</I>&gt;<i> resources _sequentially,_ especially if such a site/service has lighting
</I>&gt;<i> fast response times without those extra delays. For example, without
</I>&gt;<i> authentication caching and similar optimizations, a cumulative extra
</I>&gt;<i> delay of 100 sequential transactions (that would normally take, say,
</I>&gt;<i> 300ms total) would be 3.6 seconds -- something many humans will be
</I>&gt;<i> annoyed with!
</I>&gt;<i>
</I>&gt;<i> * Additional 36ms added to mean transaction response time can kill
</I>&gt;<i> performance of a Squid instance that is operating at the limit of some
</I>&gt;<i> resource capacity.
</I>&gt;<i>
</I>&gt;<i> For example, imagine that, without authentication delays, your Squid
</I>&gt;<i> transactions have 10ms mean response time, and your Squid instance is
</I>&gt;<i> dealing with 10'000 requests per second load. That combination results
</I>&gt;<i> in just 100 concurrent requests (10'000r/s * 0.01s = 100r). If you add
</I>&gt;<i> 36ms to that 10ms response time, your Squid would have to deal with 460
</I>&gt;<i> concurrent requests (10'000r/s * 0.046s = 460r) -- a 360% increase in
</I>&gt;<i> concurrency levels and associated resource consumption. Such an increase
</I>&gt;<i> is likely to maim any Squid that was operating without significant spare
</I>&gt;<i> resources.
</I>&gt;<i>
</I>&gt;<i> For an opposite example, imagine that, without authentication delays,
</I>&gt;<i> your Squid transactions have 1 second mean response time, and your Squid
</I>&gt;<i> instance is dealing with 10'000 requests per second load. That
</I>&gt;<i> combination results in 10'000 concurrent requests. If you add 36ms to
</I>&gt;<i> that 1s response time, your Squid would have to deal with 10'360
</I>&gt;<i> concurrent requests -- a mere 3.6% increase in concurrency levels and
</I>&gt;<i> associated resource consumption.
</I>&gt;<i>
</I>&gt;<i> Keep in mind that as Squid approaches resource limits, things usually
</I>&gt;<i> get _exponentially_ worse.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> The impact of additional authentication delays should be fairly easy to
</I>&gt;<i> model/test.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> HTH,
</I>&gt;<i>
</I>&gt;<i> Alex.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; I know there is some caching going on the Squid side, but I had to set
</I>&gt;<i> &gt; the caching to really low values (around 15s), as per the requirement I
</I>&gt;<i> &gt; was given.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; If I will have no other choice, I will simply replicate the DB table
</I>&gt;<i> &gt; from the DB server to the Squid server, but I prefer not to do that, as
</I>&gt;<i> &gt; it will require installing MySQL on all the Squid servers (or some other
</I>&gt;<i> &gt; DB, but then I have to do replication from different DBs).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Thanks.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; squid-users mailing list
</I>&gt;<i> &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> &gt; <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20210828/2b2c7d34/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20210828/2b2c7d34/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="023979.html">[squid-users] Setting Squid to work with a remote DB?
</A></li>
	<LI>Next message (by thread): <A HREF="023981.html">[squid-users] Setting Squid to work with a remote DB?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23980">[ date ]</a>
              <a href="thread.html#23980">[ thread ]</a>
              <a href="subject.html#23980">[ subject ]</a>
              <a href="author.html#23980">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
