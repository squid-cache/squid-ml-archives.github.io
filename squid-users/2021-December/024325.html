<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] missing response body with https requests
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20missing%20response%20body%20with%20https%20requests&In-Reply-To=%3C753F6D18-4F96-4584-BFE0-494ABFE6C5D2%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024330.html">
   <LINK REL="Next"  HREF="024326.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] missing response body with https requests</H1>
    <B>Mateusz &#321;o&#347;</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20missing%20response%20body%20with%20https%20requests&In-Reply-To=%3C753F6D18-4F96-4584-BFE0-494ABFE6C5D2%40gmail.com%3E"
       TITLE="[squid-users] missing response body with https requests">los.mateusz at gmail.com
       </A><BR>
    <I>Thu Dec  9 13:18:02 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="024330.html">[squid-users] deny squid to bump deny_info
</A></li>
        <LI>Next message (by thread): <A HREF="024326.html">[squid-users] missing response body with https requests
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24325">[ date ]</a>
              <a href="thread.html#24325">[ thread ]</a>
              <a href="subject.html#24325">[ subject ]</a>
              <a href="author.html#24325">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Everyone,

I have a squid running as a caching proxy. Some users of proxy noticed that in their java applications they are getting improper response from squid.
While connecting to https site through parent proxy we can see 407 response with Content-Length header but with empty body content which causes applications to fail as they are trying to read that body

lHttpAsyncClient [exchange: 71] connection aborted||The problematic lines are:|...|Consume content|-1 bytes read

with squid 5 I can see missing body in logs

2021/10/26 07:17:32.684 kid1| 11,2| src/clients/HttpTunneler.cc(324) handleResponse: Tunnel Server RESPONSE:
---------
&lt;HTML&gt;&lt;HEAD&gt;

&lt;TITLE&gt;Access Denied&lt;/TITLE&gt;

&lt;STYLE TYPE=&quot;text/css&quot;&gt;

	TABLE.DETAILS TD{

	  font-family: Helvetica;

	  font-size: 9pt;

	}

&lt;/STYLE&gt;

&lt;/HEAD&gt;

&lt;BODY&gt;

&lt;FONT face=&quot;Helvetica&quot;&gt;

&lt;big&gt;&lt;strong&gt;&lt;/strong&gt;&lt;/big&gt;&lt;BR&gt;

&lt;/FON----------
2021/10/26 07:17:32.684 kid1| TCP connection to &lt;parent_proxy_ip&gt;/8080 failed
    current master transaction: master95
2021/10/26 07:17:32.684 kid1| Detected DEAD Parent: &lt;parent_proxy_ip&gt;
    current master transaction: master95

Parent proxy configuration:
cache_peer myparentproxy_ipaddress parent 8080 0 no-query no-digest no-netdb-exchange login=PASSTHRU

While connecting through parent proxy directly there is no issue and response can be parsed properly.

I was unable to find configuration options to change this, while connecting to http site there is no such issue and body is being send properly with 407 answer.

<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at testvm</A>:~# curl -x 192.168.3.19:3128 <A HREF="https://webhook.site">https://webhook.site</A> -Lv
*   Trying 192.168.3.19:3128...
* TCP_NODELAY set
* Connected to 192.168.3.19 (192.168.3.19) port 3128 (#0)
* allocate connect buffer!
* Establish HTTP proxy tunnel to webhook.site:443
&gt;<i> CONNECT webhook.site:443 HTTP/1.1
</I>&gt;<i> Host: webhook.site:443
</I>&gt;<i> User-Agent: curl/7.68.0
</I>&gt;<i> Proxy-Connection: Keep-Alive
</I>&gt;<i>
</I>&lt; HTTP/1.1 407 Proxy Authentication Required
&lt; Proxy-Authenticate: BASIC realm=&quot;LDAP&quot;
&lt; Cache-Control: no-cache
&lt; Pragma: no-cache
&lt; X-XSS-Protection: 1
&lt; Content-Type: text/html; charset=utf-8
&lt; Proxy-Connection: close
&lt; Connection: close
&lt; Content-Length: 1590
&lt;
* Ignore 1590 bytes of response-body
* Proxy CONNECT connection closed
* Closing connection 9
* Hostname 192.168.3.19 was found in DNS cache
*   Trying 192.168.3.19:3128...
* TCP_NODELAY set
* Connected to 192.168.3.19 (192.168.3.19) port 3128 (#10)
* allocate connect buffer!
* Establish HTTP proxy tunnel to webhook.site:443
&gt;<i> CONNECT webhook.site:443 HTTP/1.1
</I>&gt;<i> Host: webhook.site:443
</I>&gt;<i> User-Agent: curl/7.68.0
</I>&gt;<i> Proxy-Connection: Keep-Alive
</I>&gt;<i>
</I>&lt; HTTP/1.1 500 Internal Server Error
&lt; Server: squid/5.2-VCS
&lt; Mime-Version: 1.0
&lt; Date: Tue, 26 Oct 2021 07:17:32 GMT
&lt; Content-Type: text/html;charset=utf-8
&lt; Content-Length: 3814
&lt; X-Squid-Error: ERR_CANNOT_FORWARD 0
&lt; Content-Language: en
&lt;
* Received HTTP code 500 from proxy after CONNECT
* CONNECT phase completed!
* Closing connection 10
curl: (56) Received HTTP code 500 from proxy after CONNECT

<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at testvm</A>:~# curl -x 192.168.3.19:3128 <A HREF="http://webhook.site">http://webhook.site</A> -Lv
*   Trying 192.168.3.19:3128...
* TCP_NODELAY set
* Connected to 192.168.3.19 (192.168.3.19) port 3128 (#0)
&gt;<i> GET <A HREF="http://webhook.site/">http://webhook.site/</A> HTTP/1.1
</I>&gt;<i> Host: webhook.site
</I>&gt;<i> User-Agent: curl/7.68.0
</I>&gt;<i> Accept: */*
</I>&gt;<i> Proxy-Connection: Keep-Alive
</I>&gt;<i>
</I>* Mark bundle as not supporting multiuse
&lt; HTTP/1.1 407 Proxy Authentication Required
&lt; Proxy-Authenticate: BASIC realm=&quot;LDAP&quot;
&lt; Cache-Control: no-cache
&lt; Pragma: no-cache
&lt; X-XSS-Protection: 1
&lt; Content-Type: text/html; charset=utf-8
&lt; Set-Cookie: BCSI-CS-53409a6e5b6816df=2; Path=/
&lt; Content-Length: 1582
&lt; Date: Tue, 26 Oct 2021 07:17:01 GMT
&lt; X-Cache: MISS from testvm
&lt; Via: 1.1 testvm (squid/5.2-VCS)
&lt; Connection: keep-alive
&lt;
&lt;HTML&gt;&lt;HEAD&gt;

&lt;TITLE&gt;Access Denied&lt;/TITLE&gt;

&lt;STYLE TYPE=&quot;text/css&quot;&gt;




Is there anything that can be done on configuration level to make it work?


Regards,
Mateusz
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20211209/202c4df1/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20211209/202c4df1/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="024330.html">[squid-users] deny squid to bump deny_info
</A></li>
	<LI>Next message (by thread): <A HREF="024326.html">[squid-users] missing response body with https requests
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24325">[ date ]</a>
              <a href="thread.html#24325">[ thread ]</a>
              <a href="subject.html#24325">[ subject ]</a>
              <a href="author.html#24325">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
