<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] deny squid to bump deny_info
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20deny%20squid%20to%20bump%20deny_info&In-Reply-To=%3C%21%26%21AAAAAAAAAAAuAAAAAAAAAJJD97gEMN5Ch2HBNn/5W3IBAMO2jhD3dRHOtM0AqgC7tuYAAAAAAA4AABAAAAC%2BXiB/A/C0QZAesfoTnTsTAQAAAAA%3D%40articatech.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024328.html">
   <LINK REL="Next"  HREF="024330.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] deny squid to bump deny_info</H1>
    <B>Andr&#233; Bolinhas</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20deny%20squid%20to%20bump%20deny_info&In-Reply-To=%3C%21%26%21AAAAAAAAAAAuAAAAAAAAAJJD97gEMN5Ch2HBNn/5W3IBAMO2jhD3dRHOtM0AqgC7tuYAAAAAAA4AABAAAAC%2BXiB/A/C0QZAesfoTnTsTAQAAAAA%3D%40articatech.com%3E"
       TITLE="[squid-users] deny squid to bump deny_info">andre.bolinhas at articatech.com
       </A><BR>
    <I>Fri Dec 10 23:03:10 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="024328.html">[squid-users] deny squid to bump deny_info
</A></li>
        <LI>Next message (by thread): <A HREF="024330.html">[squid-users] deny squid to bump deny_info
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24329">[ date ]</a>
              <a href="thread.html#24329">[ thread ]</a>
              <a href="subject.html#24329">[ subject ]</a>
              <a href="author.html#24329">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi, 
Actually if I remove http_access deny I works, squid is manage to terminate the connection for the https blocked sites, but this causes a new issue, even mange to block all https request without bump it, now all http request are allowed now.


-----Mensagem original-----
De: Alex Rousskov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt; 
Enviada: 10 de dezembro de 2021 16:42
Para: Andr&#233; Bolinhas &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">andre.bolinhas at articatech.com</A>&gt;; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Assunto: Re: [squid-users] deny squid to bump deny_info

On 12/10/21 11:01 AM, Andr&#233; Bolinhas wrote:

&gt;<i> I put this code at the beginning of squid.conf, just after listen_ports:
</I>&gt;<i> 
</I>&gt;<i> http_port 0.0.0.0:3128  name=MyPortNameID1 ssl-bump  
</I>&gt;<i> generate-host-certificates=on dynamic_cert_mem_cache_size=4MB 
</I>&gt;<i> cert=/etc/squid3/ssl/861be42112afac3b82f6b992bcc464aa.dyn 
</I>&gt;<i> sslflags=VERIFY_CRL_ALL options=NO_SSLv3,No_Compression 
</I>&gt;<i> tls-dh=/etc/squid3/ssl/dhparam.pem
</I>&gt;<i> 
</I>&gt;<i> acl denybump dstdomain .xvideos.com
</I>&gt;<i> acl CONNECT1 method CONNECT
</I>&gt;<i> http_access deny CONNECT1 denybump
</I>&gt;<i> ssl_bump terminate denybump
</I>&gt;<i> http_access deny denybump
</I>&gt;<i> 
</I>&gt;<i> but still don't work, squid continues to bump the error page.
</I>&gt;<i> 
</I>&gt;<i> If I change the code to terminat all
</I>&gt;<i> acl denybump dstdomain .xvideos.com
</I>&gt;<i> acl CONNECT1 method CONNECT
</I>&gt;<i> http_access deny CONNECT1 denybump
</I>&gt;<i> ssl_bump terminate all
</I>&gt;<i> http_access deny denybump
</I>&gt;<i> 
</I>&gt;<i> Squid is able to terminate all connections except the xvideos, because xvideos is denied, squid continues to bump it to shot the error page.
</I>
AFAICT, your configuration denies CONNECT requests _before_ &quot;ssl_bump terminate&quot; logic kicks in. The existing SslBump documentation can be interpreted as matching what is going on in your tests; see steps 1.ii and 1.iii at <A HREF="https://wiki.squid-cache.org/Features/SslPeekAndSplice">https://wiki.squid-cache.org/Features/SslPeekAndSplice</A>

We probably should document that a step1 http_access denial (which happens during step 1.ii) blocks/prevents ssl_bump rules evaluation (which happens in step 1.iii).

My recommendation from the very first response on this email thread still stands: Close the offending client connection using an &quot;ssl_bump terminate&quot; rule instead[1] of blocking client access using &quot;http_access&quot;.

[1] It may be a good idea to also/still block client access using http_access rules, as an additional safety layer, but it has to be done carefully so that &quot;ssl_bump terminate&quot; rule matches _before_ any of the corresponding &quot;http_access deny&quot; rules may match. For example, the two rules cannot have exactly the same condition because step 1.ii happens before step 1.iii.


HTH,

Alex.

&gt;<i> You can see the result images here:
</I>&gt;<i> gmail bump terminated - <A HREF="https://ibb.co/3MsMt0C">https://ibb.co/3MsMt0C</A> Xvideos bump not 
</I>&gt;<i> terminated - <A HREF="https://ibb.co/b24hL44">https://ibb.co/b24hL44</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> -----Mensagem original-----
</I>&gt;<i> De: Alex Rousskov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt;
</I>&gt;<i> Enviada: 8 de dezembro de 2021 16:02
</I>&gt;<i> Para: Andr&#233; Bolinhas &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">andre.bolinhas at articatech.com</A>&gt;; 
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> Assunto: Re: [squid-users] deny squid to bump deny_info
</I>&gt;<i> 
</I>&gt;<i> On 12/8/21 10:40 AM, Andr&#233; Bolinhas wrote:
</I>&gt;&gt;<i> where I need to add the ssl_bump terminate rule? Inside ssl.conf or 
</I>&gt;&gt;<i> http_access.conf?
</I>&gt;&gt;<i> I have tried in both both but continues to bump the error page.
</I>&gt;<i> 
</I>&gt;<i> Unfortunately, I cannot edit your configuration right now, but others 
</I>&gt;<i> on the mailing list may be able to help you. Please note that we do 
</I>&gt;<i> not know how those two files are included into your primary 
</I>&gt;<i> configuration file and whether that primary configuration file 
</I>&gt;<i> contains any relevant settings itself. The primary configuration file 
</I>&gt;<i> is what Squid parses first (e.g., it may be specified using &quot;squid -f&quot;).
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> Also tried ssl_bump terminate all in the top of both files and always 
</I>&gt;&gt;<i> bump ther error_page.
</I>&gt;<i> 
</I>&gt;<i> I am not sure, but AFAICT, Squid bugs notwithstanding, if &quot;ssl_bump 
</I>&gt;<i> terminate all&quot; is the very first ssl_bump rule in the entire Squid 
</I>&gt;<i> configuration, and Squid still bumps traffic, then you may be denying 
</I>&gt;<i> explicit CONNECT requests _before_ SslBump kicks in.
</I>&gt;<i> 
</I>&gt;<i> Alex.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> This is my current files:
</I>&gt;&gt;<i> http_access.conf
</I>&gt;&gt;<i> #### tcp_outgoing_tos ####
</I>&gt;&gt;<i> #### tcp_outgoing_tos 0 Rules ####
</I>&gt;&gt;<i> # webfilters_sqacls HaClusterClient=0 2 rules [202] 
</I>&gt;&gt;<i> [class.squid.acls.groups.inc] # webfilters_sqacls #10 : aclport=0 (  
</I>&gt;&gt;<i> ) [212] [class.squid.acls.groups.inc] # [L.268]: rule id: 10 
</I>&gt;&gt;<i> access_allow Port Direction=0 () # [L.303]:
</I>&gt;&gt;<i> class.squid.acls.groups.inc buildacls_bytype_items(10,..) http_access 
</I>&gt;&gt;<i> allow Group17 # webfilters_sqacls #5 : aclport=0 (  ) [212] 
</I>&gt;&gt;<i> [class.squid.acls.groups.inc] # [L.268]: rule id: 5 access_deny Port
</I>&gt;&gt;<i> Direction=0 () # [L.303]: class.squid.acls.groups.inc
</I>&gt;&gt;<i> buildacls_bytype_items(5,..) # Template Enabled for this ACL.
</I>&gt;&gt;<i> # Final acl is all, Template ID=1
</I>&gt;&gt;<i> deny_info TEMPLATE_5 all
</I>&gt;&gt;<i> http_access deny all
</I>&gt;&gt;<i> #
</I>&gt;&gt;<i> #
</I>&gt;&gt;<i> # ------------------ HTTP ACCESS -------------------- # 0 rule(s) 
</I>&gt;&gt;<i> from engine (Line 2170)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # SquidStandardLDAPAuth = 0
</I>&gt;&gt;<i> # EnableOpenLDAP = 0
</I>&gt;&gt;<i> # SquidRadiusAuth = 0
</I>&gt;&gt;<i> # LDAP_AUTH = 0 caused by EnableOpenLDAP acl MyBlockedIPs src 
</I>&gt;&gt;<i> &quot;/etc/squid3/acls/DenyIPSrc&quot;
</I>&gt;&gt;<i> http_access allow WindowsUpdates
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # LDAP Auth = 0
</I>&gt;&gt;<i> http_access deny HTTP !Safe_ports all http_access deny CONNECT 
</I>&gt;&gt;<i> !SSL_ports all http_access deny MyBlockedIPs http_access deny 
</I>&gt;&gt;<i> blockedsites http_access deny DomainsBlackLists http_access deny 
</I>&gt;&gt;<i> NetworksBlackLists include /etc/squid3/http_access_final.conf
</I>&gt;&gt;<i> # END http_access (defaults)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # Allow all networks to finally pass trough proxy.
</I>&gt;&gt;<i> http_access allow all
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ssl.conf
</I>&gt;&gt;<i> # SSL used for port ID 1, :3128 on
</I>&gt;&gt;<i> # Patch 2020 - 08 - 03 SquidMikrotikEnabled = 0 # SSL Proxy options 
</I>&gt;&gt;<i> Proxy version:5.2 [134] sslcrtd_program 
</I>&gt;&gt;<i> /lib/squid3/security_file_certgen -s 
</I>&gt;&gt;<i> /var/lib/squid/session/ssl/ssl_db -M 32MB sslcrtd_children 32 
</I>&gt;&gt;<i> startup=5 idle=1 queue-size=64 #The AppStore application in IOS 
</I>&gt;&gt;<i> (iPhone, iPad, MacOS) uses SSL Certificate Pinning, #it means the 
</I>&gt;&gt;<i> application knows what certificate to expect when accessing AppStore.
</I>&gt;&gt;<i> #When you enable SSL Bump of HTTPS connections Squid replaces the 
</I>&gt;&gt;<i> default certificate with a  ^`^xmimicked ^`^y one; #the application 
</I>&gt;&gt;<i> detects that and refuses to function.
</I>&gt;&gt;<i> #
</I>&gt;&gt;<i> acl FakeCert ssl::server_name .apple.com acl FakeCert 
</I>&gt;&gt;<i> ssl::server_name .icloud.com acl FakeCert ssl::server_name 
</I>&gt;&gt;<i> .mzstatic.com acl FakeCert ssl::server_name .dropbox.com acl FakeCert 
</I>&gt;&gt;<i> ssl::server_name .bnpparisbas acl ssl_step1 at_step SslBump1 acl 
</I>&gt;&gt;<i> ssl_step2 at_step
</I>&gt;&gt;<i> SslBump2 acl ssl_step3 at_step SslBump3 ssl_bump peek ssl_step1 
</I>&gt;&gt;<i> ssl_bump splice GlobalWhitelistDSTNet ssl_bump splice 
</I>&gt;&gt;<i> GlobalWhitelistDomainsRx ssl_bump splice GlobalWhitelistDomains 
</I>&gt;&gt;<i> ssl_bump splice FakeCert
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # SNI Group google_sni/ssl_sni
</I>&gt;&gt;<i> # id:16 Type: ssl_sni
</I>&gt;&gt;<i> acl SNIGroup16 ssl::server_name_regex -i accounts\.google\.com
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # 0 Splice rules...
</I>&gt;&gt;<i> acl KeepSSL ssl::server_name &quot;/etc/squid3/acls_whitelist.dstdomain.conf&quot;
</I>&gt;&gt;<i> ssl_bump splice KeepSSL
</I>&gt;&gt;<i> ssl_bump splice GlobalWhitelistDSTNet
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # Rules (spliced) added by admins....
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # 1 BUMP rules...
</I>&gt;&gt;<i> #ssl_bump stare all
</I>&gt;&gt;<i> ssl_bump bump ssl_step2 SNIGroup16
</I>&gt;&gt;<i> ssl_bump splice all
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> tls_outgoing_options options=NO_SSLv3,NO_TICKET 
</I>&gt;&gt;<i> cipher=ALL:!SSLv2:!SSLv3:!ADH:!DSS:!MD5:!EXP:!DES:!PSK:!SRP:!RC4:!IDE
</I>&gt;&gt;<i> A :!SEED:!aNULL:!eNULL flags=DONT_VERIFY_PEER sslproxy_cert_error 
</I>&gt;&gt;<i> allow all on_unsupported_protocol tunnel all
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> -----Mensagem original-----
</I>&gt;&gt;<i> De: Alex Rousskov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt;
</I>&gt;&gt;<i> Enviada: 8 de dezembro de 2021 15:13
</I>&gt;&gt;<i> Para: Andr&#233; Bolinhas &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">andre.bolinhas at articatech.com</A>&gt;; 
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i> Assunto: Re: [squid-users] deny squid to bump deny_info
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On 12/7/21 8:39 PM, Andr&#233; Bolinhas wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> We use Squid v5 with ssl_bump to decrypt only google domains. With a 
</I>&gt;&gt;&gt;<i> special configuration we also need to deny important websites. Squid 
</I>&gt;&gt;&gt;<i> tries to bump returned error pages
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Yes, when SslBump encounters an error, it tries to bump the client 
</I>&gt;&gt;<i> connection to deliver the error response.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> One way to prevent that error handling algorithm from kicking in is 
</I>&gt;&gt;<i> to close the offending client connection using an &quot;ssl_bump 
</I>&gt;&gt;<i> terminate&quot; rule (instead[1] of blocking client access using &quot;http_access&quot;).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> We have tried using a TCP_RESET deny_info but this does not fix the 
</I>&gt;&gt;&gt;<i> bump operation
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I suspect the TCP_RESET feature is checked at error delivery time, 
</I>&gt;&gt;<i> after the client connection is bumped to prepare it for error 
</I>&gt;&gt;<i> delivery. This suspect behavior should be considered a Squid 
</I>&gt;&gt;<i> bug/deficiency IMO -- Squid should not be bumping the TLS connection 
</I>&gt;&gt;<i> to deliver a TCP RST or FIN packet.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> HTH,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Alex.
</I>&gt;&gt;<i> [1] It may be a good idea to also/still block client access using 
</I>&gt;&gt;<i> http_access rules, as an additional safety layer, but it has to be 
</I>&gt;&gt;<i> done carefully so that &quot;ssl_bump terminate&quot; rule matches _before_ any 
</I>&gt;&gt;<i> of the corresponding &quot;http_access deny&quot; rules may match.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> In this peace of log, you can see that squid is forcing bump for 
</I>&gt;&gt;&gt;<i> Access Denied website under https:
</I>&gt;&gt;&gt;<i> 2021/12/08 05:05:53.774 kid2| 85,5| client_side_request.cc(769)
</I>&gt;&gt;&gt;<i> clientAccessCheckDone: Access Denied: beacons2.gvt2.com:443
</I>&gt;&gt;&gt;<i> 2021/12/08 05:05:53.774 kid2| 85,5| client_side_request.cc(770)
</I>&gt;&gt;&gt;<i> clientAccessCheckDone: AclMatchedName = all
</I>&gt;&gt;&gt;<i> 2021/12/08 05:05:53.774 kid2| 83,7| LogTags.cc(57) update: TAG_NONE 
</I>&gt;&gt;&gt;<i> to TCP_DENIED
</I>&gt;&gt;&gt;<i> 2021/12/08 05:05:53.774 kid2| 28,4| FilledChecklist.cc(67)
</I>&gt;&gt;&gt;<i> ~ACLFilledChecklist: ACLFilledChecklist destroyed 0x7ffc945c5b40
</I>&gt;&gt;&gt;<i> 2021/12/08 05:05:53.774 kid2| 28,4| Checklist.cc(197) ~ACLChecklist:
</I>&gt;&gt;&gt;<i> ACLChecklist::~ACLChecklist: destroyed 0x7ffc945c5b40
</I>&gt;&gt;&gt;<i> 2021/12/08 05:05:53.774 kid2| 85,5| client_side_request.cc(1461)
</I>&gt;&gt;&gt;<i> sslBumpAccessCheck: SslBump applies. Force bump action on error 
</I>&gt;&gt;&gt;<i> UNKNOWN
</I>&gt;&gt;&gt;<i> 2021/12/08 05:05:53.774 kid2| 83,3| client_side_request.cc(1562)
</I>&gt;&gt;&gt;<i> sslBumpNeed: sslBump required: bump
</I>&gt;&gt;&gt;<i> 2021/12/08 05:05:53.774 kid2| 73,3| HttpRequest.cc(683) storeId: 
</I>&gt;&gt;&gt;<i> sent back
</I>&gt;&gt;&gt;<i> effectiveRequestUrl: beacons2.gvt2.com:443
</I>&gt;&gt;&gt;<i> 2021/12/08 05:05:53.774 kid2| 24,7| SBuf.cc(160) rawSpace: reserving
</I>&gt;&gt;&gt;<i> 1 for
</I>&gt;&gt;&gt;<i> SBuf77493929
</I>&gt;&gt;&gt;<i> 2021/12/08 05:05:53.774 kid2| 24,7| SBuf.cc(866) reAlloc:
</I>&gt;&gt;&gt;<i> SBuf77493929 new store capacity: 40
</I>&gt;&gt;&gt;<i> 2021/12/08 05:05:53.774 kid2| 20,3| store.cc(769) storeCreatePureEntry:
</I>&gt;&gt;&gt;<i> storeCreateEntry: 'beacons2.gvt2.com:443'
</I>&gt;&gt;&gt;<i> 2021/12/08 05:05:53.774 kid2| 20,5| store.cc(349) StoreEntry:
</I>&gt;&gt;&gt;<i> StoreEntry constructed, this=0x5561d9347e90
</I>&gt;&gt;&gt;<i> 2021/12/08 05:05:53.774 kid2| 20,3| MemObject.cc(100) MemObject:
</I>&gt;&gt;&gt;<i> MemObject constructed, this=0x5561d5e66f50
</I>&gt;&gt;&gt;<i> 2021/12/08 05:05:53.774 kid2| 55,7| HttpHeader.cc(155) HttpHeader:
</I>&gt;&gt;&gt;<i> init-ing
</I>&gt;&gt;&gt;<i> hdr: 0x5561d80af128 owner: 3
</I>&gt;&gt;&gt;<i> 2021/12/08 05:05:53.774 kid2| 88,3| MemObject.cc(83) setUris:
</I>&gt;&gt;&gt;<i> 0x5561d5e66f50
</I>&gt;&gt;&gt;<i> storeId: beacons2.gvt2.com:443
</I>&gt;&gt;&gt;<i> 2021/12/08 05:05:53.774 kid2| 24,7| SBuf.cc(85) assign: assigning
</I>&gt;&gt;&gt;<i> SBuf77493930 from SBuf77493860
</I>&gt;&gt;&gt;<i> 2021/12/08 05:05:53.774 kid2| 20,3| store.cc(443) lock:
</I>&gt;&gt;&gt;<i> storeCreateEntry locked key [null_store_key] e:=V/0x5561d9347e90*1
</I>&gt;&gt;&gt;<i> 2021/12/08 05:05:53.774 kid2| 20,3| store.cc(569) setPrivateKey: 01
</I>&gt;&gt;&gt;<i> e:=V/0x5561d9347e90*1
</I>&gt;&gt;&gt;<i> 2021/12/08 05:05:53.774 kid2| 20,3| store.cc(421) hashInsert:
</I>&gt;&gt;&gt;<i> StoreEntry::hashInsert: Inserting Entry e:=XIV/0x5561d9347e90*1 key 
</I>&gt;&gt;&gt;<i> '71570400000000002412000002000000'
</I>&gt;&gt;&gt;<i> 2021/12/08 05:05:53.774 kid2| 83,3| client_side_request.cc(1562)
</I>&gt;&gt;&gt;<i> sslBumpNeed: sslBump required: client-first
</I>&gt;&gt;&gt;<i> 2021/12/08 05:05:53.774 kid2| 33,4| ServerBump.cc(28) ServerBump:
</I>&gt;&gt;&gt;<i> will peek at beacons2.gvt2.com:443
</I>&gt;&gt;&gt;<i> 2021/12/08 05:05:53.774 kid2| 20,3| store.cc(443) lock:
</I>&gt;&gt;&gt;<i> Ssl::ServerBump locked key 71570400000000002412000002000000
</I>&gt;&gt;&gt;<i> e:=XIV/0x5561d9347e90*2
</I>&gt;&gt;&gt;<i> 2021/12/08 05:05:53.774 kid2| 4,4| errorpage.cc(720) errorAppendEntry:
</I>&gt;&gt;&gt;<i> storing TEMPLATE_5 in e:=XIV/0x5561d9347e90*2
</I>&gt;&gt;&gt;<i> 2021/12/08 05:05:53.774 kid2| 55,7| HttpHeader.cc(155) HttpHeader:
</I>&gt;&gt;&gt;<i> init-ing
</I>&gt;&gt;&gt;<i> hdr: 0x5561d66a8078 owner: 3
</I>&gt;&gt;&gt;<i> 2021/12/08 05:05:53.774 kid2| 4,2| errorpage.cc(1389) buildBody: No 
</I>&gt;&gt;&gt;<i> existing error page language negotiated for TEMPLATE_5. Using 
</I>&gt;&gt;&gt;<i> default error file.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Ssl.conf
</I>&gt;&gt;&gt;<i> # SSL used for port ID 1, :3128 on
</I>&gt;&gt;&gt;<i> # Patch 2020 - 08 - 03 SquidMikrotikEnabled = 0 # SSL Proxy options 
</I>&gt;&gt;&gt;<i> Proxy
</I>&gt;&gt;&gt;<i> version:5.2 [134] sslcrtd_program /lib/squid3/security_file_certgen 
</I>&gt;&gt;&gt;<i> sslcrtd_children 32 startup=5 idle=1 queue-size=64 #The AppStore 
</I>&gt;&gt;&gt;<i> application in IOS (iPhone, iPad, MacOS) uses SSL Certificate 
</I>&gt;&gt;&gt;<i> Pinning, #it means the application knows what certificate to expect 
</I>&gt;&gt;&gt;<i> when accessing AppStore.
</I>&gt;&gt;&gt;<i> #When you enable SSL Bump of HTTPS connections Squid replaces the 
</I>&gt;&gt;&gt;<i> default certificate with a  ^`^xmimicked ^`^y one;
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> #the application detects that and refuses to function.
</I>&gt;&gt;&gt;<i> #
</I>&gt;&gt;&gt;<i> acl FakeCert ssl::server_name .apple.com acl FakeCert 
</I>&gt;&gt;&gt;<i> ssl::server_name .icloud.com acl FakeCert ssl::server_name 
</I>&gt;&gt;&gt;<i> .mzstatic.com acl FakeCert ssl::server_name .dropbox.com acl 
</I>&gt;&gt;&gt;<i> FakeCert ssl::server_name .bnpparisbas acl notbump ssl::server_name 
</I>&gt;&gt;&gt;<i> .redtube.com acl ssl_step1 at_step SslBump1 acl
</I>&gt;&gt;&gt;<i> ssl_step2 at_step SslBump2 acl ssl_step3 at_step SslBump3
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> acl Me dst 127.0.0.1 192.168.58.11
</I>&gt;&gt;&gt;<i> acl GlobalWhitelistDSTNet dst &quot;/etc/squid3/acls_whitelist.dst.conf&quot;
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> ssl_bump splice notbump all
</I>&gt;&gt;&gt;<i> ssl_bump splice GlobalWhitelistDSTNet
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> ssl_bump splice ssl_step1 Me
</I>&gt;&gt;&gt;<i> ssl_bump splice ByPassRBL
</I>&gt;&gt;&gt;<i> ssl_bump splice FakeCert
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> # SNI Group sni_domains/ssl_sni
</I>&gt;&gt;&gt;<i> # id:7 Type: ssl_sni
</I>&gt;&gt;&gt;<i> acl SNIGroup7 ssl::server_name_regex -i account\.google\.com acl
</I>&gt;&gt;&gt;<i> SNIGroup7 ssl::server_name_regex -i accounts\.google\.com ssl_bump 
</I>&gt;&gt;&gt;<i> peek ssl_step1 all # 0 Splice rules...
</I>&gt;&gt;&gt;<i> ssl_bump splice ByPassRBL
</I>&gt;&gt;&gt;<i> ssl_bump splice GlobalWhitelistDSTNet
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> # Rules (spliced) added by admins....
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> # 1 BUMP rules...
</I>&gt;&gt;&gt;<i> ssl_bump bump ssl_step2 SNIGroup7
</I>&gt;&gt;&gt;<i> ssl_bump splice all
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> tls_outgoing_options options=NO_SSLv3,NO_TICKET 
</I>&gt;&gt;&gt;<i> cipher=ALL:!SSLv2:!SSLv3:!ADH:!DSS:!MD5:!EXP:!DES:!PSK:!SRP:!RC4:!ID
</I>&gt;&gt;&gt;<i> E A :!SEED :!aNULL:!eNULL flags=DONT_VERIFY_PEER sslproxy_cert_error 
</I>&gt;&gt;&gt;<i> allow all
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> http_access.conf
</I>&gt;&gt;&gt;<i> #### tcp_outgoing_tos ####
</I>&gt;&gt;&gt;<i> #### tcp_outgoing_tos 0 Rules ####
</I>&gt;&gt;&gt;<i> # SquidUrgency = 0 exec.squid.global.access.php[2233]
</I>&gt;&gt;&gt;<i> #       HaClusterClient=0 class.squid.acls.groups.inc/buildacls_order
</I>&gt;&gt;&gt;<i> #       mysql_for_port='' aclgpid=0 [L.174]
</I>&gt;&gt;&gt;<i> #       [3] rules [220]
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> # webfilters_sqacls #2 : aclport=0 (  ) [239] 
</I>&gt;&gt;&gt;<i> [class.squid.acls.groups.inc] # [L.292]: rule id: 2 access_allow 
</I>&gt;&gt;&gt;<i> Port
</I>&gt;&gt;&gt;<i> Direction=0 () # [L.320]:
</I>&gt;&gt;&gt;<i> class.squid.acls.groups.inc buildacls_bytype_items(2,..) acl
</I>&gt;&gt;&gt;<i> AnnotateRule2 annotate_transaction accessrule=Rule2 http_access 
</I>&gt;&gt;&gt;<i> allow
</I>&gt;&gt;&gt;<i> Group2 AnnotateRule2 # webfilters_sqacls #4 : aclport=0 (  ) [239] 
</I>&gt;&gt;&gt;<i> [class.squid.acls.groups.inc] # [L.292]: rule id: 4 access_allow 
</I>&gt;&gt;&gt;<i> Port
</I>&gt;&gt;&gt;<i> Direction=0 () # [L.320]:
</I>&gt;&gt;&gt;<i> class.squid.acls.groups.inc buildacls_bytype_items(4,..) acl
</I>&gt;&gt;&gt;<i> AnnotateRule4 annotate_transaction accessrule=Rule4 http_access 
</I>&gt;&gt;&gt;<i> allow
</I>&gt;&gt;&gt;<i> Group8 AnnotateRule4 # webfilters_sqacls #3 : aclport=0 (  ) [239] 
</I>&gt;&gt;&gt;<i> [class.squid.acls.groups.inc] # [L.292]: rule id: 3 access_deny Port
</I>&gt;&gt;&gt;<i> Direction=0 () # [L.320]:
</I>&gt;&gt;&gt;<i> class.squid.acls.groups.inc buildacls_bytype_items(3,..) # Template 
</I>&gt;&gt;&gt;<i> Enabled for this ACL.
</I>&gt;&gt;&gt;<i> # Final acl is all, Template ID=1
</I>&gt;&gt;&gt;<i> acl AnnotateRule3 annotate_transaction accessrule=Rule3 http_access 
</I>&gt;&gt;&gt;<i> deny CONNECT  AnnotateRule3 deny_info TCP_RESET AnnotateRule3
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> acl MyAll dst 0.0.0.0/0
</I>&gt;&gt;&gt;<i> http_access deny Myall
</I>&gt;&gt;&gt;<i> deny_info 302:<A HREF="http://artica/me">http://artica/me</A> Myall # # # ------------------ HTTP 
</I>&gt;&gt;&gt;<i> ACCESS -------------------- # 0 rule(s) from engine (Line 2240)
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> #
</I>&gt;&gt;&gt;<i> # SquidStandardLDAPAuth = 0
</I>&gt;&gt;&gt;<i> # EnableOpenLDAP = 0
</I>&gt;&gt;&gt;<i> # SquidRadiusAuth = 0
</I>&gt;&gt;&gt;<i> # LDAP_AUTH = 0 caused by EnableOpenLDAP acl MyBlockedIPs src 
</I>&gt;&gt;&gt;<i> &quot;/etc/squid3/acls/DenyIPSrc&quot;
</I>&gt;&gt;&gt;<i> acl AnnotateWindowsUpdates annotate_transaction 
</I>&gt;&gt;&gt;<i> accessrule=AllowWindowsUpdates http_access allow WindowsUpdates 
</I>&gt;&gt;&gt;<i> AnnotateWindowsUpdates # # -------------------- AUTH Schemes Squid
</I>&gt;&gt;&gt;<i> v5.2-----------------------
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> # ----------------------------------------------------------
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> # LDAP Auth = 0
</I>&gt;&gt;&gt;<i> acl AnnotateSafePorts annotate_transaction 
</I>&gt;&gt;&gt;<i> accessrule=deny_remote_ports http_access deny HTTP !Safe_ports all 
</I>&gt;&gt;&gt;<i> AnnotateSafePorts http_access deny CONNECT !SSL_ports all 
</I>&gt;&gt;&gt;<i> AnnotateSafePorts deny_info TCP_RESET all
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> acl AnnotateBLK annotate_transaction accessrule=global_blacklist 
</I>&gt;&gt;&gt;<i> http_access deny MyBlockedIPs AnnotateBLK http_access deny 
</I>&gt;&gt;&gt;<i> blockedsites AnnotateBLK http_access deny DomainsBlackLists 
</I>&gt;&gt;&gt;<i> AnnotateBLK http_access deny NetworksBlackLists AnnotateBLK include 
</I>&gt;&gt;&gt;<i> /etc/squid3/http_access_final.conf
</I>&gt;&gt;&gt;<i> # END http_access (defaults)
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i> 
</I>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="024328.html">[squid-users] deny squid to bump deny_info
</A></li>
	<LI>Next message (by thread): <A HREF="024330.html">[squid-users] deny squid to bump deny_info
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24329">[ date ]</a>
              <a href="thread.html#24329">[ thread ]</a>
              <a href="subject.html#24329">[ subject ]</a>
              <a href="author.html#24329">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
