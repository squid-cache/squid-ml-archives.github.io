<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Originserver load balancing and health checks in Squid reverse proxy mode
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Originserver%20load%20balancing%20and%20health%20checks%20in%0A%20Squid%20reverse%20proxy%20mode&In-Reply-To=%3Cf89a5cb9-88f0-aec6-f146-c7ee896d3cf7%40kisswebdev.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023312.html">
   <LINK REL="Next"  HREF="023309.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Originserver load balancing and health checks in Squid reverse proxy mode</H1>
    <B>Chris</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Originserver%20load%20balancing%20and%20health%20checks%20in%0A%20Squid%20reverse%20proxy%20mode&In-Reply-To=%3Cf89a5cb9-88f0-aec6-f146-c7ee896d3cf7%40kisswebdev.com%3E"
       TITLE="[squid-users] Originserver load balancing and health checks in Squid reverse proxy mode">ml+squidusers at kisswebdev.com
       </A><BR>
    <I>Mon Feb  8 14:40:39 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="023312.html">[squid-users] Port or switch level authorization
</A></li>
        <LI>Next message (by thread): <A HREF="023309.html">[squid-users] Originserver load balancing and health checks in Squid reverse proxy mode
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23308">[ date ]</a>
              <a href="thread.html#23308">[ thread ]</a>
              <a href="subject.html#23308">[ subject ]</a>
              <a href="author.html#23308">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all,

I'm trying to figure out the best way to use squid (version 3.5.27) in 
reverse proxy mode in regard to originserver health checks and load 
balancing.

So far I had been using the round-robin originserver cache peer 
selection algorithm while using weight to favor originservers with 
closer proximity/lower latency.

The problem: if one cache_peer is dead it takes ages for squid to choose 
the second originserver. It does look as if (e.g. if one originserver 
has a weight of 32, the other of 2) squid tries the dead server several 
times before accessing the other one.

Now instead of using round-robin plus weight it would be best to use 
weighted-round-robin. But as I understand it, this wouldn't work with 
originserver if (as it's normally the case) the originserver won't 
handle icp or htcp requests. Did I miss sth. here? Would background-ping 
work?

I tried weighted-round-robin and background-ping on originservers but 
got only an evenly distributed request handling even if ones 
originservers rtt would be less than half of the others. But then again, 
those originservers won't handle icp requests.

So what's the best solution to a) choose the originserver with the 
lowest rtt and b) still have a fast switch if one of the originservers 
switches into dead state?

Would I have to span another proxy (like e.g. HAProxy) between Squid and 
originserver or better install Squid on those originservers as well 
(only for serving icp requests from the squid fellows)?

Is there a better way to update the dead state of an originserver?

How do you handle this?

Thanks a lot,

Chris


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="023312.html">[squid-users] Port or switch level authorization
</A></li>
	<LI>Next message (by thread): <A HREF="023309.html">[squid-users] Originserver load balancing and health checks in Squid reverse proxy mode
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23308">[ date ]</a>
              <a href="thread.html#23308">[ thread ]</a>
              <a href="subject.html#23308">[ subject ]</a>
              <a href="author.html#23308">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
