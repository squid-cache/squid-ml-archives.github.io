<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Originserver load balancing and health checks in Squid reverse proxy mode
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Originserver%20load%20balancing%20and%20health%20checks%20in%0A%20Squid%20reverse%20proxy%20mode&In-Reply-To=%3C003301d6fe70%2420f46c50%2462dd44f0%24%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023308.html">
   <LINK REL="Next"  HREF="023310.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Originserver load balancing and health checks in Squid reverse proxy mode</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Originserver%20load%20balancing%20and%20health%20checks%20in%0A%20Squid%20reverse%20proxy%20mode&In-Reply-To=%3C003301d6fe70%2420f46c50%2462dd44f0%24%40gmail.com%3E"
       TITLE="[squid-users] Originserver load balancing and health checks in Squid reverse proxy mode">ngtech1ltd at gmail.com
       </A><BR>
    <I>Mon Feb  8 23:14:18 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="023308.html">[squid-users] Originserver load balancing and health checks in Squid reverse proxy mode
</A></li>
        <LI>Next message (by thread): <A HREF="023310.html">[squid-users] Originserver load balancing and health checks in Squid reverse proxy mode
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23309">[ date ]</a>
              <a href="thread.html#23309">[ thread ]</a>
              <a href="subject.html#23309">[ subject ]</a>
              <a href="author.html#23309">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey Chris,

The main question is &quot; what do you need squid for?&quot;
If you need squid for caching it one thing.
RFC compliance is another thing..
Anyway Haproxy is better in Load Balancing and traffic control/management.
If you need load balancer use haproxy.
If you need caching for very specific known use cases then use it.
For general purpose these days it might not work as you might expect.

Take into account that browsers cache lots of things, even these who shouldn't so the gain/profit
should be tested first.

Eliezer

----
Eliezer Croitoru
Tech Support
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A>
Zoom: Coming soon


-----Original Message-----
From: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; On Behalf Of Chris
Sent: Monday, February 8, 2021 4:41 PM
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: [squid-users] Originserver load balancing and health checks in Squid reverse proxy mode

Hi all,

I'm trying to figure out the best way to use squid (version 3.5.27) in 
reverse proxy mode in regard to originserver health checks and load 
balancing.

So far I had been using the round-robin originserver cache peer 
selection algorithm while using weight to favor originservers with 
closer proximity/lower latency.

The problem: if one cache_peer is dead it takes ages for squid to choose 
the second originserver. It does look as if (e.g. if one originserver 
has a weight of 32, the other of 2) squid tries the dead server several 
times before accessing the other one.

Now instead of using round-robin plus weight it would be best to use 
weighted-round-robin. But as I understand it, this wouldn't work with 
originserver if (as it's normally the case) the originserver won't 
handle icp or htcp requests. Did I miss sth. here? Would background-ping 
work?

I tried weighted-round-robin and background-ping on originservers but 
got only an evenly distributed request handling even if ones 
originservers rtt would be less than half of the others. But then again, 
those originservers won't handle icp requests.

So what's the best solution to a) choose the originserver with the 
lowest rtt and b) still have a fast switch if one of the originservers 
switches into dead state?

Would I have to span another proxy (like e.g. HAProxy) between Squid and 
originserver or better install Squid on those originservers as well 
(only for serving icp requests from the squid fellows)?

Is there a better way to update the dead state of an originserver?

How do you handle this?

Thanks a lot,

Chris

_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="023308.html">[squid-users] Originserver load balancing and health checks in Squid reverse proxy mode
</A></li>
	<LI>Next message (by thread): <A HREF="023310.html">[squid-users] Originserver load balancing and health checks in Squid reverse proxy mode
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23309">[ date ]</a>
              <a href="thread.html#23309">[ thread ]</a>
              <a href="subject.html#23309">[ subject ]</a>
              <a href="author.html#23309">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
