<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Originserver load balancing and health checks in Squid reverse proxy mode
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Originserver%20load%20balancing%20and%20health%20checks%20in%0A%20Squid%20reverse%20proxy%20mode&In-Reply-To=%3C525fc74b-48e0-b3ae-ef64-388ce69e4afc%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023319.html">
   <LINK REL="Next"  HREF="023324.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Originserver load balancing and health checks in Squid reverse proxy mode</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Originserver%20load%20balancing%20and%20health%20checks%20in%0A%20Squid%20reverse%20proxy%20mode&In-Reply-To=%3C525fc74b-48e0-b3ae-ef64-388ce69e4afc%40treenet.co.nz%3E"
       TITLE="[squid-users] Originserver load balancing and health checks in Squid reverse proxy mode">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Feb 10 00:25:30 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="023319.html">[squid-users] Originserver load balancing and health checks in Squid reverse proxy mode
</A></li>
        <LI>Next message (by thread): <A HREF="023324.html">[squid-users] c-icap, clamav and squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23321">[ date ]</a>
              <a href="thread.html#23321">[ thread ]</a>
              <a href="subject.html#23321">[ subject ]</a>
              <a href="author.html#23321">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 10/02/21 9:59 am, Alex Rousskov wrote:
&gt;<i> On 2/9/21 11:35 AM, Chris wrote:
</I>&gt;&gt;<i> This is what I'm seeing in peer_select in cache_log with 44,3 debug
</I>&gt;&gt;<i> options:
</I>&gt;<i> 
</I>&gt;<i> Add (at least) &quot;15,3&quot; to your debug_options and then look for
</I>&gt;<i> getWeightedRoundRobinParent lines. Looking at mgr:server_list Cache
</I>&gt;<i> Manager page may also be useful.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> Does the weighted-round-robin need some time to use those rtt values?
</I>&gt;<i> 
</I>&gt;<i> I am not 100% sure, but I think the answer to that question is &quot;no&quot;.
</I>&gt;<i> 
</I>
Well, only the time it takes to find out what the RTT actually is. As 
soon as RTT is known it is used.

This algorithm works like round-robin in that each selection cycle the 
peer with fewest &quot;uses&quot; gets selected. However, where normal round-robin 
adds &quot;(1 * weight) uses&quot; to a peer each time it gets selected, this 
algorithm adds &quot;(RTT * weight) uses&quot;.

The debug lines Alex mentioned will tell you what weighted_rtt your 
proxy is using as its RTT count per use. If that shows &quot;1&quot;, then the RTT 
is too small to calculate speed difference (math code improvements 
needed to cope with modern fast networks).

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="023319.html">[squid-users] Originserver load balancing and health checks in Squid reverse proxy mode
</A></li>
	<LI>Next message (by thread): <A HREF="023324.html">[squid-users] c-icap, clamav and squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23321">[ date ]</a>
              <a href="thread.html#23321">[ thread ]</a>
              <a href="subject.html#23321">[ subject ]</a>
              <a href="author.html#23321">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
