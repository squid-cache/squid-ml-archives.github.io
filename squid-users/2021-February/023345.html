<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Data tricking implementation is on ICAP side or Squid side?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Data%20tricking%20implementation%20is%20on%20ICAP%20side%20or%0A%20Squid%20side%3F&In-Reply-To=%3C4054ac33-daab-b8ae-35db-12fdbb627c05%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023344.html">
   <LINK REL="Next"  HREF="023346.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Data tricking implementation is on ICAP side or Squid side?</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Data%20tricking%20implementation%20is%20on%20ICAP%20side%20or%0A%20Squid%20side%3F&In-Reply-To=%3C4054ac33-daab-b8ae-35db-12fdbb627c05%40measurement-factory.com%3E"
       TITLE="[squid-users] Data tricking implementation is on ICAP side or Squid side?">rousskov at measurement-factory.com
       </A><BR>
    <I>Thu Feb 18 06:27:11 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="023344.html">[squid-users] Data tricking implementation is on ICAP side or Squid side?
</A></li>
        <LI>Next message (by thread): <A HREF="023346.html">[squid-users] Data tricking implementation is on ICAP side or Squid side?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23345">[ date ]</a>
              <a href="thread.html#23345">[ thread ]</a>
              <a href="subject.html#23345">[ subject ]</a>
              <a href="author.html#23345">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2/18/21 12:36 AM, John Zhu wrote:

&gt;<i> I have a wired issue. I setup the &#160;Squid and ICAP.&#160;&#160; When ICAP (in
</I>&gt;<i> RespMod) sends response body (any file types, most of time are large
</I>&gt;<i> size files) in a relative slow speed to squid, &#160;if the time elapses
</I>&gt;<i> longer than 1 minute, the browser will close the session and fail the
</I>&gt;<i> downloading,
</I>
During that minute, does the browser actually get any HTTP response
bytes that the ICAP service sent to Squid? Just the response headers?
Nothing at all?


&gt;<i> the squid log shows the error of TCP_MISS_ABORTED/206
</I>
HTTP 206 is Partial Content response to a Range request. Did the origin
server respond with an HTTP 206 response? Or did the ICAP server
converted an HTTP 200 response into an HTTP 206 response? Or did Squid
do that conversion?

If Squid does the conversion, then perhaps Squid just has no data to
send to the client because the requested range has not come from the
data trickling ICAP service yet?


HTH,

Alex.



&gt;<i> Here are the configuration.&#160; I am new to squid. &#160;
</I>&gt;<i> 
</I>&gt;<i> &#160;
</I>&gt;<i> 
</I>&gt;<i> ==&gt; /usr/local/squid/var/logs/access.log &lt;==
</I>&gt;<i> 
</I>&gt;<i> 1613593651.769&#160; 59962 172.90.1.1 TCP_MISS_ABORTED/206 3635 GET
</I>&gt;<i> <A HREF="https://pfpt-my.sharepoint.com/personal/jzhu_company">https://pfpt-my.sharepoint.com/personal/jzhu_company</A>
</I>&gt;<i> _com/_layouts/15/download.aspx? - HIER_DIRECT/13.107.136.9 application/pdf
</I>&gt;<i> 
</I>&gt;<i> &#160;
</I>&gt;<i> 
</I>&gt;<i> &#160;
</I>&gt;<i> 
</I>&gt;<i> acl SSL_ports port 443
</I>&gt;<i> acl Safe_ports port 80&#160;&#160;&#160; # http
</I>&gt;<i> acl Safe_ports port 21&#160;&#160;&#160; # ftp
</I>&gt;<i> acl Safe_ports port 443&#160;&#160;&#160;&#160;&#160;&#160; # https
</I>&gt;<i> acl Safe_ports port 70&#160;&#160;&#160; # gopher
</I>&gt;<i> acl Safe_ports port 210&#160;&#160;&#160;&#160;&#160;&#160; # wais
</I>&gt;<i> acl Safe_ports port 1025-65535 # unregistered ports
</I>&gt;<i> acl Safe_ports port 280&#160;&#160;&#160;&#160;&#160;&#160; # http-mgmt
</I>&gt;<i> acl Safe_ports port 488&#160;&#160;&#160;&#160;&#160;&#160; # gss-http
</I>&gt;<i> acl Safe_ports port 591&#160;&#160;&#160;&#160;&#160;&#160; # filemaker
</I>&gt;<i> acl Safe_ports port 777&#160;&#160;&#160;&#160;&#160;&#160; # multiling http
</I>&gt;<i> acl CONNECT method CONNECT
</I>&gt;<i> http_access deny !Safe_ports
</I>&gt;<i> http_access deny CONNECT !SSL_ports
</I>&gt;<i> http_access allow localhost manager
</I>&gt;<i> http_access deny manager
</I>&gt;<i> http_access allow all
</I>&gt;<i> 
</I>&gt;<i> # This is to help with the development process only
</I>&gt;<i> #cache deny all
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> cache_mem 1024 MB
</I>&gt;<i> maximum_object_size 200 MB
</I>&gt;<i> cache_swap_low 90
</I>&gt;<i> cache_swap_high 95
</I>&gt;<i> quick_abort_min -1
</I>&gt;<i> 
</I>&gt;<i> refresh_pattern ^ftp:&#160;&#160;&#160;&#160; 1440&#160;&#160; 20%&#160;&#160;&#160; 10080
</I>&gt;<i> refresh_pattern ^gopher:&#160;&#160; 1440&#160;&#160; 0% 1440
</I>&gt;<i> refresh_pattern -i (/cgi-bin/|\?) 0&#160;&#160;&#160; 0% 0
</I>&gt;<i> refresh_pattern (Release|Packages(.gz)*)$&#160;&#160;&#160;&#160;&#160; 0&#160;&#160;&#160;&#160;&#160;&#160; 20%&#160;&#160;&#160;&#160; 2880
</I>&gt;<i> refresh_pattern .&#160;&#160;&#160;&#160; 0&#160; 20%&#160;&#160;&#160; 4320
</I>&gt;<i> 
</I>&gt;<i> # Docker-compose setup
</I>&gt;<i> icap_enable on
</I>&gt;<i> icap_io_timeout 600 seconds
</I>&gt;<i> icap_connect_timeout 600 seconds
</I>&gt;<i> 
</I>&gt;<i> icap_service service_req reqmod_precache bypass=1 <A HREF="icap://icapserver:1344/req">icap://icapserver:1344/req</A>
</I>&gt;<i> icap_service service_resp respmod_precache bypass=1
</I>&gt;<i> <A HREF="icap://icapserver:1344/resp">icap://icapserver:1344/resp</A>
</I>&gt;<i> adaptation_access service_req allow all
</I>&gt;<i> adaptation_access service_resp allow all
</I>&gt;<i> 
</I>&gt;<i> &#160;
</I>&gt;<i> 
</I>&gt;<i> &#160;
</I>&gt;<i> 
</I>&gt;<i> Thank you all,
</I>&gt;<i> 
</I>&gt;<i> &#160;
</I>&gt;<i> 
</I>&gt;<i> John Zhu
</I>&gt;<i> 
</I>&gt;<i> &#160;
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="023344.html">[squid-users] Data tricking implementation is on ICAP side or Squid side?
</A></li>
	<LI>Next message (by thread): <A HREF="023346.html">[squid-users] Data tricking implementation is on ICAP side or Squid side?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23345">[ date ]</a>
              <a href="thread.html#23345">[ thread ]</a>
              <a href="subject.html#23345">[ subject ]</a>
              <a href="author.html#23345">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
