<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Data tricking implementation is on ICAP side or Squid side?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Data%20tricking%20implementation%20is%20on%20ICAP%20side%20or%0A%20Squid%20side%3F&In-Reply-To=%3C9D996C66-BA3E-4571-9EC8-CC882C4534E8%40proofpoint.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023345.html">
   <LINK REL="Next"  HREF="023347.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Data tricking implementation is on ICAP side or Squid side?</H1>
    <B>John Zhu</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Data%20tricking%20implementation%20is%20on%20ICAP%20side%20or%0A%20Squid%20side%3F&In-Reply-To=%3C9D996C66-BA3E-4571-9EC8-CC882C4534E8%40proofpoint.com%3E"
       TITLE="[squid-users] Data tricking implementation is on ICAP side or Squid side?">jzhu at proofpoint.com
       </A><BR>
    <I>Thu Feb 18 06:52:32 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="023345.html">[squid-users] Data tricking implementation is on ICAP side or Squid side?
</A></li>
        <LI>Next message (by thread): <A HREF="023347.html">[squid-users] Data tricking implementation is on ICAP side or Squid side?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23346">[ date ]</a>
              <a href="thread.html#23346">[ thread ]</a>
              <a href="subject.html#23346">[ subject ]</a>
              <a href="author.html#23346">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

&#65279;On 2/17/21, 10:28 PM, &quot;Alex Rousskov&quot; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt; wrote:

    On 2/18/21 12:36 AM, John Zhu wrote:

    &gt; I have a wired issue. I setup the  Squid and ICAP.   When ICAP (in
    &gt; RespMod) sends response body (any file types, most of time are large
    &gt; size files) in a relative slow speed to squid,  if the time elapses
    &gt; longer than 1 minute, the browser will close the session and fail the
    &gt; downloading,

    During that minute, does the browser actually get any HTTP response
    bytes that the ICAP service sent to Squid? Just the response headers?
    Nothing at all?

    --- Yes, I implemented the data trickling feature at ICAP server side. I can see in the Firefox browser.:
1)  prompt to save or open file
2)  the progress bar is receiving a few bytes every seconds  


    &gt; the squid log shows the error of TCP_MISS_ABORTED/206

    HTTP 206 is Partial Content response to a Range request. Did the origin
    server respond with an HTTP 206 response? Or did the ICAP server
    converted an HTTP 200 response into an HTTP 206 response? Or did Squid
    do that conversion?

 -- Yes, sending back to squid from ICAP server 206 partial body data, not the original server.

    If Squid does the conversion, then perhaps Squid just has no data to
    send to the client because the requested range has not come from the
    data trickling ICAP service yet?

--- What is request range?  Does it put in the header of icap response header?  This is the ICAP header back to squid
ICAP/1.0 200 OK



Date: Mon, 15 Feb 2021 04:35:37 +0000


    HTH,

    Alex.



    &gt; Here are the configuration.  I am new to squid.  
    &gt; 
    &gt;  
    &gt; 
    &gt; ==&gt; /usr/local/squid/var/logs/access.log &lt;==
    &gt; 
    &gt; 1613593651.769  59962 172.90.1.1 TCP_MISS_ABORTED/206 3635 GET
    &gt; <A HREF="https://urldefense.com/v3/__https://pfpt-my.sharepoint.com/personal/jzhu_company__;!!ORgEfCBsr282Fw!-GAUSOBJG8F9UUMSLCJJWioLebLx-daFRj1qtCC8n3lXrg-1bD6s1AF2-2wMthz3$">https://urldefense.com/v3/__https://pfpt-my.sharepoint.com/personal/jzhu_company__;!!ORgEfCBsr282Fw!-GAUSOBJG8F9UUMSLCJJWioLebLx-daFRj1qtCC8n3lXrg-1bD6s1AF2-2wMthz3$</A> 
    &gt; _com/_layouts/15/download.aspx? - HIER_DIRECT/13.107.136.9 application/pdf
    &gt; 
    &gt;  
    &gt; 
    &gt;  
    &gt; 
    &gt; acl SSL_ports port 443
    &gt; acl Safe_ports port 80    # http
    &gt; acl Safe_ports port 21    # ftp
    &gt; acl Safe_ports port 443       # https
    &gt; acl Safe_ports port 70    # gopher
    &gt; acl Safe_ports port 210       # wais
    &gt; acl Safe_ports port 1025-65535 # unregistered ports
    &gt; acl Safe_ports port 280       # http-mgmt
    &gt; acl Safe_ports port 488       # gss-http
    &gt; acl Safe_ports port 591       # filemaker
    &gt; acl Safe_ports port 777       # multiling http
    &gt; acl CONNECT method CONNECT
    &gt; http_access deny !Safe_ports
    &gt; http_access deny CONNECT !SSL_ports
    &gt; http_access allow localhost manager
    &gt; http_access deny manager
    &gt; http_access allow all
    &gt; 
    &gt; # This is to help with the development process only
    &gt; #cache deny all
    &gt; 
    &gt; 
    &gt; cache_mem 1024 MB
    &gt; maximum_object_size 200 MB
    &gt; cache_swap_low 90
    &gt; cache_swap_high 95
    &gt; quick_abort_min -1
    &gt; 
    &gt; refresh_pattern ^ftp:     1440   20%    10080
    &gt; refresh_pattern ^gopher:   1440   0% 1440
    &gt; refresh_pattern -i (/cgi-bin/|\?) 0    0% 0
    &gt; refresh_pattern (Release|Packages(.gz)*)$      0       20%     2880
    &gt; refresh_pattern .     0  20%    4320
    &gt; 
    &gt; # Docker-compose setup
    &gt; icap_enable on
    &gt; icap_io_timeout 600 seconds
    &gt; icap_connect_timeout 600 seconds
    &gt; 
    &gt; icap_service service_req reqmod_precache bypass=1 <A HREF="icap://icapserver:1344/req">icap://icapserver:1344/req</A>
    &gt; icap_service service_resp respmod_precache bypass=1
    &gt; <A HREF="icap://icapserver:1344/resp">icap://icapserver:1344/resp</A>
    &gt; adaptation_access service_req allow all
    &gt; adaptation_access service_resp allow all
    &gt; 
    &gt;  
    &gt; 
    &gt;  
    &gt; 
    &gt; Thank you all,
    &gt; 
    &gt;  
    &gt; 
    &gt; John Zhu
    &gt; 
    &gt;  
    &gt; 
    &gt; 
    &gt; _______________________________________________
    &gt; squid-users mailing list
    &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
    &gt; <A HREF="https://urldefense.com/v3/__http://lists.squid-cache.org/listinfo/squid-users__;!!ORgEfCBsr282Fw!-GAUSOBJG8F9UUMSLCJJWioLebLx-daFRj1qtCC8n3lXrg-1bD6s1AF2-5jdkNI7$">https://urldefense.com/v3/__http://lists.squid-cache.org/listinfo/squid-users__;!!ORgEfCBsr282Fw!-GAUSOBJG8F9UUMSLCJJWioLebLx-daFRj1qtCC8n3lXrg-1bD6s1AF2-5jdkNI7$</A> 
    &gt; 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="023345.html">[squid-users] Data tricking implementation is on ICAP side or Squid side?
</A></li>
	<LI>Next message (by thread): <A HREF="023347.html">[squid-users] Data tricking implementation is on ICAP side or Squid side?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23346">[ date ]</a>
              <a href="thread.html#23346">[ thread ]</a>
              <a href="subject.html#23346">[ subject ]</a>
              <a href="author.html#23346">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
