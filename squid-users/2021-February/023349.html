<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] icap server name lookup
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20icap%20server%20name%20lookup&In-Reply-To=%3CCAGEc96nZ%3DyaZsOka74k52GMa5fygDYsm94j1Sry5%2BSZU1vh0Bg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023347.html">
   <LINK REL="Next"  HREF="023350.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] icap server name lookup</H1>
    <B>Justin Michael Schwartzbeck</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20icap%20server%20name%20lookup&In-Reply-To=%3CCAGEc96nZ%3DyaZsOka74k52GMa5fygDYsm94j1Sry5%2BSZU1vh0Bg%40mail.gmail.com%3E"
       TITLE="[squid-users] icap server name lookup">justinmschw at gmail.com
       </A><BR>
    <I>Sun Feb 21 20:39:58 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="023347.html">[squid-users] Data tricking implementation is on ICAP side or Squid side?
</A></li>
        <LI>Next message (by thread): <A HREF="023350.html">[squid-users] icap server name lookup
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23349">[ date ]</a>
              <a href="thread.html#23349">[ thread ]</a>
              <a href="subject.html#23349">[ subject ]</a>
              <a href="author.html#23349">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

I am a little puzzled by something.
I am using squid 4.11 in a docker container.
So I am setting things up so that I have two docker containers, a squid
container and an e2guardian container, where the e2guardian is an ICAP
service. I am connecting these two containers to the same network and
giving them names squid and e2guardian, respectively.

I added the following lines to my squid config:

*icap_service service_req reqmod_precache bypass=0
<A HREF="icap://e2guardian:1344/request*">icap://e2guardian:1344/request*</A>
*icap_service service_resp respmod_precache bypass=0
<A HREF="icap://e2guardian:1344/response*">icap://e2guardian:1344/response*</A>

But when I try to access I get an ICAP error, and the following log message:
*essential ICAP service is down after an options fetch failure:
<A HREF="icap://e2guardian:1344/request">icap://e2guardian:1344/request</A> [down,!opt]*

If I exec into the docker container and ping e2guardian, it resolves fine.
If I take the IP address of the docker container and add it to that ICAP
line in my squid.conf, it works just fine. But I don't want to have to do
this obviously because I don't know what the IP of the docker container
will be when it comes up.

I should also mention that if I manually add the docker IP to my /etc/hosts
file on the squid container and give it the hostname of e2guardian, it
*still* doesn't work. This inclines me to believe that, for some reason, no
name resolution of any kind is performed when resolving the ICAP service.

My problem looks very similar to the following problem:
<A HREF="https://squid-users.squid-cache.narkive.com/YZLtJNiW/dns-lookup-fails-initially-for-fqdn-in-squid">https://squid-users.squid-cache.narkive.com/YZLtJNiW/dns-lookup-fails-initially-for-fqdn-in-squid</A>
Except that in my case it never comes up even after the three minutes, and
it doesn't work either if I add e2guardian to my /etc/hosts file.

I should also mention that I am waiting at least three seconds after the
e2guardian container comes up before I start the squid container.

Can someone help me diagnose this?

Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20210221/488559c8/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20210221/488559c8/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="023347.html">[squid-users] Data tricking implementation is on ICAP side or Squid side?
</A></li>
	<LI>Next message (by thread): <A HREF="023350.html">[squid-users] icap server name lookup
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23349">[ date ]</a>
              <a href="thread.html#23349">[ thread ]</a>
              <a href="subject.html#23349">[ subject ]</a>
              <a href="author.html#23349">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
