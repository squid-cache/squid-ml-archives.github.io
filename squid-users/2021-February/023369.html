<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] My cache gived me a content-length of 0, and a 200 TCP_REFRESH_UNMODIFIED_ABORTED
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20My%20cache%20gived%20me%20a%20content-length%20of%200%2C%0A%20and%20a%20200%20TCP_REFRESH_UNMODIFIED_ABORTED&In-Reply-To=%3C73780f0c-9bde-07ea-6432-e3e36a6ee227%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023367.html">
   <LINK REL="Next"  HREF="023370.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] My cache gived me a content-length of 0, and a 200 TCP_REFRESH_UNMODIFIED_ABORTED</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20My%20cache%20gived%20me%20a%20content-length%20of%200%2C%0A%20and%20a%20200%20TCP_REFRESH_UNMODIFIED_ABORTED&In-Reply-To=%3C73780f0c-9bde-07ea-6432-e3e36a6ee227%40treenet.co.nz%3E"
       TITLE="[squid-users] My cache gived me a content-length of 0, and a 200 TCP_REFRESH_UNMODIFIED_ABORTED">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Feb 25 11:00:04 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="023367.html">[squid-users] My cache gived me a content-length of 0, and a 200 TCP_REFRESH_UNMODIFIED_ABORTED
</A></li>
        <LI>Next message (by thread): <A HREF="023370.html">[squid-users] My cache gived me a content-length of 0, and a 200 TCP_REFRESH_UNMODIFIED_ABORTED
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23369">[ date ]</a>
              <a href="thread.html#23369">[ thread ]</a>
              <a href="subject.html#23369">[ subject ]</a>
              <a href="author.html#23369">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 25/02/21 4:45 am, Se&#241;or J Onion wrote:
&gt;<i> Thanks Amos - that&#8217;s a very kind and thorough explanation.
</I>&gt;<i> 
</I>&gt;<i> Ok - I understand why the content-length is 0 as the server responded with a 304. Gotcha. Squid in response responds with a 200.
</I>&gt;<i> 
</I>&gt;<i> And I also understand why it is a REFRESH because the server responded saying that it should not cache. (As a side note - I don&#8217;t understand what these directives do then: ignore-no-cache ignore-no-store ignore-must-revalidate ignore-private)
</I>&gt;<i> 
</I>
ignore-no-cache no longer exists, even in your old Squid version.

ignore-must-revalidate and ignore-auth were intended to help admin work 
around caching issues in HTTP/1.0 traffic and during the early days of 
the web's transition to HTTP/1.1. In latest Squid they no longer exist. 
In your old version they are buggy to the point of being somewhat 
dangerous. The ignore-auth is actively *preventing* things caching in 
Squid-3.

ignore-no-store and ignore-private are for admin who think the bandwidth 
saving of not having to transfer response bodies outweigh the risks of 
hitting protocol issues - including the one you hit.



&gt;<i> What isn&#8217;t clear to me then is whether Squid actually returns the cached image? (content-length being 0).
</I>&gt;<i> 
</I>
There should be 0 bytes of payload/body/object in the 200 response Squid 
delivers.  But I'm not certain Squid is working correctly there 
(dropping the cached object).


&gt;<i> The reason being, is that I am using Squid between my server and AWS S3 (or Google Storage)
</I>&gt;<i> 
</I>&gt;<i> The first time I call my nodejs code to fetch the image from S3 (via the proxy) it works.
</I>&gt;<i> The second time I call my nodejs code to fetch the image from S3, it fails. (Same Squid logs - instead of curl I am using nodejs code)
</I>&gt;<i> 
</I>&gt;<i> My nodejs code fails with an HTTP Parse error (HPE_INVALID_CONSTANT). My guess is that the response from Squid  is malformed. My guess is that the response is empty. Or that the image is in the response, but the content-length 0 causes the nodejs HTTP response parser to fail.
</I>&gt;<i> 
</I>
The response you presented earlier is fine. It is simply a 0-byte object 
with the 200 status.


*IF* Squid is delivering the cached object, or any part of it along with 
that Content-Length:0 header. Then the software receiving will be seeing 
those bytes as if they were a second HTTP response message received - 
and failing to parse it because actually an image.


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="023367.html">[squid-users] My cache gived me a content-length of 0, and a 200 TCP_REFRESH_UNMODIFIED_ABORTED
</A></li>
	<LI>Next message (by thread): <A HREF="023370.html">[squid-users] My cache gived me a content-length of 0, and a 200 TCP_REFRESH_UNMODIFIED_ABORTED
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23369">[ date ]</a>
              <a href="thread.html#23369">[ thread ]</a>
              <a href="subject.html#23369">[ subject ]</a>
              <a href="author.html#23369">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
