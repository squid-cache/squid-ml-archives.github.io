<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] SSL-BUMP 5.0.4 not working as expected
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL-BUMP%205.0.4%20not%20working%20as%20expected&In-Reply-To=%3Cf2f33c39-7c40-b8f8-7fa2-3362e7430ac6%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023099.html">
   <LINK REL="Next"  HREF="023102.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] SSL-BUMP 5.0.4 not working as expected</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL-BUMP%205.0.4%20not%20working%20as%20expected&In-Reply-To=%3Cf2f33c39-7c40-b8f8-7fa2-3362e7430ac6%40treenet.co.nz%3E"
       TITLE="[squid-users] SSL-BUMP 5.0.4 not working as expected">squid3 at treenet.co.nz
       </A><BR>
    <I>Sun Jan  3 07:12:02 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="023099.html">[squid-users] SSL-BUMP 5.0.4 not working as expected
</A></li>
        <LI>Next message (by thread): <A HREF="023102.html">[squid-users] SSL-BUMP 5.0.4 not working as expected
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23100">[ date ]</a>
              <a href="thread.html#23100">[ thread ]</a>
              <a href="subject.html#23100">[ subject ]</a>
              <a href="author.html#23100">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 3/01/21 9:08 am, ngtech1ltd wrote:
&gt;<i> I am trying to configure 5.0.4 with sslbump to bump only a set of domains.
</I>&gt;<i> 
</I>&gt;<i> I am unsure about the right way it should be done.
</I>&gt;<i> 
</I>&gt;<i> The basic constrains are POLICY vs a set of rules.
</I>&gt;<i> 
</I>&gt;<i>   * Should I bump all connections with exceptions?
</I>&gt;<i>   * Should I bump non else then the exceptions?
</I>&gt;<i>   * Based on server_name regex and/or server_name domains
</I>&gt;<i>
</I>
In regards to policy:

Security best-practice is to reject as early as possible. So for 
transactions that early bump steps are indicating going to forbidden 
places should reject immediately on that detection.

For transactions which appear to be not-bad, there is no &quot;best&quot; way. 
That depends on your specific setup needs and the side-effects of making 
a wrong deision.

I prefer to advise bump'ing at step 3 where the most information is 
available for checks and correction of client claims.


...
&gt;<i> I have tried the next set of rules:
</I>&gt;<i> 
</I>&gt;<i> ## START
</I>&gt;<i> 
</I>&gt;<i> acl step1 at_step SslBump1
</I>&gt;<i> 
</I>&gt;<i> acl step2 at_step SslBump2
</I>&gt;<i> 
</I>&gt;<i> acl step3 at_step SslBump3
</I>&gt;<i> 
</I>&gt;<i> acl NoBump_server_regex ssl::server_name_regex -i 
</I>&gt;<i> /etc/squid/server-regex.nobump
</I>&gt;<i> 
</I>&gt;<i> acl NoBump_server_name ssl::server_name /etc/squid/server-name.nobump
</I>&gt;<i> 
</I>&gt;<i> acl NoBump_ALL_regex ssl::server_name_regex -i 
</I>&gt;<i> /etc/squid/all_server-regex.nobump
</I>&gt;<i> 
</I>&gt;<i> acl MustBump_server_regex ssl::server_name_regex -i 
</I>&gt;<i> /etc/squid/must_server-regex.bump
</I>&gt;<i> 
</I>&gt;<i> acl MustBump_server_name ssl::server_name /etc/squid/must_server-name.bump
</I>&gt;<i> 
</I>&gt;<i> ssl_bump peek step1
</I>&gt;<i> 
</I>&gt;<i> ssl_bump splice NoBump_server_regex
</I>&gt;<i> 
</I>&gt;<i> ssl_bump splice NoBump_server_name
</I>&gt;<i> 
</I>&gt;<i> ssl_bump bump MustBump_server_regex
</I>&gt;<i> 
</I>&gt;<i> ssl_bump bump MustBump_server_name
</I>&gt;<i> 
</I>&gt;<i> ssl_bump splice NoBump_ALL_regex
</I>&gt;<i> 
</I>&gt;<i> ssl_bump bump all
</I>&gt;<i> 
</I>&gt;<i> ##END
</I>&gt;<i> 
</I>&gt;<i> But the BoBump are not applied.
</I>&gt;<i> 
</I>&gt;<i> I tried to understand why squid is bumping despite the explicit splice 
</I>&gt;<i> action.
</I>
Note that all these splice/bump rules are being applied at step2. There 
is no step3 taking place.


Does your actual config have the required &quot;&quot; marks around those filenames?

Without that all your ACLs will non-match (SNI vs name of the file) and 
the last &quot;bump all&quot; will be applied below.


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="023099.html">[squid-users] SSL-BUMP 5.0.4 not working as expected
</A></li>
	<LI>Next message (by thread): <A HREF="023102.html">[squid-users] SSL-BUMP 5.0.4 not working as expected
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23100">[ date ]</a>
              <a href="thread.html#23100">[ thread ]</a>
              <a href="subject.html#23100">[ subject ]</a>
              <a href="author.html#23100">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
