<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] SSL-BUMP 5.0.4 not working as expected
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL-BUMP%205.0.4%20not%20working%20as%20expected&In-Reply-To=%3C000501d6e1ca%24b1c9bcc0%24155d3640%24%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023100.html">
   <LINK REL="Next"  HREF="023101.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] SSL-BUMP 5.0.4 not working as expected</H1>
    <B>ngtech1ltd at gmail.com</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL-BUMP%205.0.4%20not%20working%20as%20expected&In-Reply-To=%3C000501d6e1ca%24b1c9bcc0%24155d3640%24%40gmail.com%3E"
       TITLE="[squid-users] SSL-BUMP 5.0.4 not working as expected">ngtech1ltd at gmail.com
       </A><BR>
    <I>Sun Jan  3 12:19:32 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="023100.html">[squid-users] SSL-BUMP 5.0.4 not working as expected
</A></li>
        <LI>Next message (by thread): <A HREF="023101.html">[squid-users] SSL-BUMP 5.0.4 not working as expected
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23102">[ date ]</a>
              <a href="thread.html#23102">[ thread ]</a>
              <a href="subject.html#23102">[ subject ]</a>
              <a href="author.html#23102">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Comments bellow

-----Original Message-----
From: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; On Behalf Of Amos Jeffries
Sent: Sunday, January 3, 2021 9:12 AM
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] SSL-BUMP 5.0.4 not working as expected

On 3/01/21 9:08 am, ngtech1ltd wrote:
&gt;<i> I am trying to configure 5.0.4 with sslbump to bump only a set of domains.
</I>&gt;<i> 
</I>&gt;<i> I am unsure about the right way it should be done.
</I>&gt;<i> 
</I>&gt;<i> The basic constrains are POLICY vs a set of rules.
</I>&gt;<i> 
</I>&gt;<i>   * Should I bump all connections with exceptions?
</I>&gt;<i>   * Should I bump non else then the exceptions?
</I>&gt;<i>   * Based on server_name regex and/or server_name domains
</I>&gt;<i>
</I>
In regards to policy:

Security best-practice is to reject as early as possible. So for 
transactions that early bump steps are indicating going to forbidden 
places should reject immediately on that detection.

For transactions which appear to be not-bad, there is no &quot;best&quot; way. 
That depends on your specific setup needs and the side-effects of making 
a wrong deision.

I prefer to advise bump'ing at step 3 where the most information is 
available for checks and correction of client claims.


# How to do that? I tried to read the docs at:
<A HREF="https://wiki.squid-cache.org/Features/SslPeekAndSplice">https://wiki.squid-cache.org/Features/SslPeekAndSplice</A>

But couldn't understand or grasp how to implement what you are talking about.
#

...
&gt;<i> I have tried the next set of rules:
</I>&gt;<i> 
</I>&gt;<i> ## START
</I>&gt;<i> 
</I>&gt;<i> acl step1 at_step SslBump1
</I>&gt;<i> 
</I>&gt;<i> acl step2 at_step SslBump2
</I>&gt;<i> 
</I>&gt;<i> acl step3 at_step SslBump3
</I>&gt;<i> 
</I>&gt;<i> acl NoBump_server_regex ssl::server_name_regex -i 
</I>&gt;<i> /etc/squid/server-regex.nobump
</I>&gt;<i> 
</I>&gt;<i> acl NoBump_server_name ssl::server_name /etc/squid/server-name.nobump
</I>&gt;<i> 
</I>&gt;<i> acl NoBump_ALL_regex ssl::server_name_regex -i 
</I>&gt;<i> /etc/squid/all_server-regex.nobump
</I>&gt;<i> 
</I>&gt;<i> acl MustBump_server_regex ssl::server_name_regex -i 
</I>&gt;<i> /etc/squid/must_server-regex.bump
</I>&gt;<i> 
</I>&gt;<i> acl MustBump_server_name ssl::server_name /etc/squid/must_server-name.bump
</I>&gt;<i> 
</I>&gt;<i> ssl_bump peek step1
</I>&gt;<i> 
</I>&gt;<i> ssl_bump splice NoBump_server_regex
</I>&gt;<i> 
</I>&gt;<i> ssl_bump splice NoBump_server_name
</I>&gt;<i> 
</I>&gt;<i> ssl_bump bump MustBump_server_regex
</I>&gt;<i> 
</I>&gt;<i> ssl_bump bump MustBump_server_name
</I>&gt;<i> 
</I>&gt;<i> ssl_bump splice NoBump_ALL_regex
</I>&gt;<i> 
</I>&gt;<i> ssl_bump bump all
</I>&gt;<i> 
</I>&gt;<i> ##END
</I>&gt;<i> 
</I>&gt;<i> But the BoBump are not applied.
</I>&gt;<i> 
</I>&gt;<i> I tried to understand why squid is bumping despite the explicit splice 
</I>&gt;<i> action.
</I>
Note that all these splice/bump rules are being applied at step2. There 
is no step3 taking place.


Does your actual config have the required &quot;&quot; marks around those filenames?

Without that all your ACLs will non-match (SNI vs name of the file) and 
the last &quot;bump all&quot; will be applied below.

# I didn't understood how to separate the different steps and to make the right config which will either allow me bump or splice.
I want to be able to bump or splice by my acls and I couldn't make this happen.
Either I'm really confused or didn't understood how to do that.
With another software I was able to do that and more and this is why it's probably so hard for me.

Thanks,
Eliezer


Amos
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="023100.html">[squid-users] SSL-BUMP 5.0.4 not working as expected
</A></li>
	<LI>Next message (by thread): <A HREF="023101.html">[squid-users] SSL-BUMP 5.0.4 not working as expected
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23102">[ date ]</a>
              <a href="thread.html#23102">[ thread ]</a>
              <a href="subject.html#23102">[ subject ]</a>
              <a href="author.html#23102">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
