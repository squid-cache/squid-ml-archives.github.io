<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] SSL-BUMP 5.0.4 not working as expected
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL-BUMP%205.0.4%20not%20working%20as%20expected&In-Reply-To=%3Cddcffc48-6f9f-e45b-6828-acfe2b5a18b5%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023101.html">
   <LINK REL="Next"  HREF="023103.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] SSL-BUMP 5.0.4 not working as expected</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL-BUMP%205.0.4%20not%20working%20as%20expected&In-Reply-To=%3Cddcffc48-6f9f-e45b-6828-acfe2b5a18b5%40measurement-factory.com%3E"
       TITLE="[squid-users] SSL-BUMP 5.0.4 not working as expected">rousskov at measurement-factory.com
       </A><BR>
    <I>Sun Jan  3 22:44:58 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="023101.html">[squid-users] SSL-BUMP 5.0.4 not working as expected
</A></li>
        <LI>Next message (by thread): <A HREF="023103.html">[squid-users] PCI Certification compliance lists
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23108">[ date ]</a>
              <a href="thread.html#23108">[ thread ]</a>
              <a href="subject.html#23108">[ subject ]</a>
              <a href="author.html#23108">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 1/2/21 3:08 PM, <A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A> wrote:
&gt;<i> I am trying to configure 5.0.4 with sslbump to bump only a set of domains.
</I>
&gt;<i>   * Should I bump all connections with exceptions?
</I>&gt;<i>   * Should I bump non else then the exceptions?
</I>&gt;<i>   * Based on server_name regex and/or server_name domains
</I>
Policy-wise, you should bump as little as possible. The rest depends on
your local specifics/goals.

As for implementing any policy, here is a rule of thumb: Workarounds and
exceptions aside, make the splicing-vs-bumping _decision_ during step2:
stare if the transaction matches your bumping policy, and peek
otherwise. Trigger the final splice/bump action during step3 based on
the decision made during step2 (modern Squids will do that for you by
default).

Rationale:

* It is not possible to properly bump at step1 -- Squid usually does not
have enough details (e.g., SNI) to do it properly so early. Thus, it is
usually best to just peek at step1.

* It is not possible to make the splicing-vs-bumping _decision_ during
step3 -- Squid has to know your intent at the end of step2 because the
TLS Hello Squid sends at the beginning of step3 depends on that intent.
Thus, the decision has to be made during the only remaining step -- step2.

* Bumping may work better when Squid mimics the server certificate and
that can only happen during step3. Splicing works well at earlier steps,
but splicing later gives Squid access to the TLS server Hello details
that can be useful for logging/triage. Thus, it may be a good idea to
delay the splice/bump action until step3. Please keep in mind that the
step3 action itself is fully determined by your decision during step2.


&gt;<i> I tried to understand why squid is bumping despite the explicit splice
</I>&gt;<i> action.
</I>
Squid bumps either when a bump rule matches OR when Squid decides to
serve an error response to the client. The latter often happens when
your http_access rules deny CONNECT requests, especially during step1.
Examine your http_access rules and study the response to the first
bumped request to confirm that it is a Squid error page.


HTH,

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="023101.html">[squid-users] SSL-BUMP 5.0.4 not working as expected
</A></li>
	<LI>Next message (by thread): <A HREF="023103.html">[squid-users] PCI Certification compliance lists
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23108">[ date ]</a>
              <a href="thread.html#23108">[ thread ]</a>
              <a href="subject.html#23108">[ subject ]</a>
              <a href="author.html#23108">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
