<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Host header forgery detected on domain: mobile.pipe.aria.microsoft.com
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Host%20header%20forgery%20detected%20on%20domain%3A%0A%20mobile.pipe.aria.microsoft.com&In-Reply-To=%3C05fbb740-83f3-9f55-67ae-1a5d5b03e7a8%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023130.html">
   <LINK REL="Next"  HREF="023133.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Host header forgery detected on domain: mobile.pipe.aria.microsoft.com</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Host%20header%20forgery%20detected%20on%20domain%3A%0A%20mobile.pipe.aria.microsoft.com&In-Reply-To=%3C05fbb740-83f3-9f55-67ae-1a5d5b03e7a8%40measurement-factory.com%3E"
       TITLE="[squid-users] Host header forgery detected on domain: mobile.pipe.aria.microsoft.com">rousskov at measurement-factory.com
       </A><BR>
    <I>Thu Jan  7 16:08:04 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="023130.html">[squid-users] Host header forgery detected on domain: mobile.pipe.aria.microsoft.com
</A></li>
        <LI>Next message (by thread): <A HREF="023133.html">[squid-users] Host header forgery detected on domain: mobile.pipe.aria.microsoft.com
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23132">[ date ]</a>
              <a href="thread.html#23132">[ thread ]</a>
              <a href="subject.html#23132">[ subject ]</a>
              <a href="author.html#23132">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 1/6/21 10:26 PM, Eliezer Croitoru wrote:

&gt;<i> The main issue now is the extensive logging.
</I>
Please note that excessive logging may be the main issue for you and
_some_ Squid admins. For many, the main issue is denied transactions.
For some, it is cache misses. For some, it is a combination of things.
These facts make any single simple solution inapplicable to some use cases.

For example, you can trivially decrease the number (or, with a few more
code lines, frequency) of these messages, but it will not help with the
other problems I mentioned. FWIW, Factory is working on making all
level-0/1 messages configurable that way, but we need more time to
finish that project.

This does not mean that any simple partial solution is going to be
rejected, but please be very careful/specific in defining the problem
when proposing (or asking for) a solution.


&gt;<i> Should we continue this on Squid-dev?
</I>
IMO, if you are going to discuss the problem and possible
functionality-level solutions, then squid-users may be the best place
for that. If you are going to discuss code changes and similar
developer-level issues, use squid-dev.

Alex.


&gt;<i> -----Original Message-----
</I>&gt;<i> From: Alex Rousskov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt; 
</I>&gt;<i> Sent: Wednesday, January 6, 2021 10:42 PM
</I>&gt;<i> To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> Cc: Eliezer Croitoru &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A>&gt;
</I>&gt;<i> Subject: Re: [squid-users] Host header forgery detected on domain: mobile.pipe.aria.microsoft.com
</I>&gt;<i> 
</I>&gt;<i> On 1/6/21 2:49 PM, Eliezer Croitoru wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> I am trying to think about the right solution for the next issue:
</I>&gt;&gt;<i> SECURITY ALERT: Host header forgery detected on conn18767
</I>&gt;&gt;<i> local=52.114.32.24:443 remote=192.168.189.52:65107 FD 15 flags=33 (local IP
</I>&gt;&gt;<i> does not match any domain IP)
</I>&gt;<i> 
</I>&gt;<i> As you know, this has been discussed many times on this list before,
</I>&gt;<i> including recently[1]. I doubt anything has changed since then.
</I>&gt;<i> 
</I>&gt;<i> [1]
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/pipermail/squid-users/2020-November/022912.html">http://lists.squid-cache.org/pipermail/squid-users/2020-November/022912.html</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> All of the hosts use the same DNS service in the LAN however for some reason
</I>&gt;&gt;<i> both squid and the client are resolving different addresses
</I>&gt;&gt;<i> in a period of  10  Seconds.
</I>&gt;<i> 
</I>&gt;<i> The &quot;however for some reason&quot; part feels misleading to me -- what you
</I>&gt;<i> observe is the direct, expected consequence of the low-TTL environment
</I>&gt;<i> you have described. There is no contradiction or uncertainty here AFAICT.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> The solution I am thinking is to force a minimum of 60 seconds caching using
</I>&gt;&gt;<i> dnsmasq or another caching service.
</I>&gt;<i> 
</I>&gt;<i> FTR: Increasing DNS response TTL will reduce the number/probability of
</I>&gt;<i> false positives in forged Host header detection. No more. No less.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> Can we teach (theoretically) squid a way to look at these short TTLs as
</I>&gt;&gt;<i> something to decide by an ACL?
</I>&gt;<i> 
</I>&gt;<i> Yes, it is possible. There is positive_dns_ttl already which specifies
</I>&gt;<i> an upper bound. One could add a similar positive_dns_ttl_min option that
</I>&gt;<i> would specify the lower bound. Like virtually any Squid directive, it
</I>&gt;<i> can be made conditional on ACLs.
</I>&gt;<i> 
</I>&gt;<i> IMO, violating DNS TTLs is not the right solution for this problem
</I>&gt;<i> though. See my response on the [1] thread for a better medium-term solution.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> HTH,
</I>&gt;<i> 
</I>&gt;<i> Alex.
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="023130.html">[squid-users] Host header forgery detected on domain: mobile.pipe.aria.microsoft.com
</A></li>
	<LI>Next message (by thread): <A HREF="023133.html">[squid-users] Host header forgery detected on domain: mobile.pipe.aria.microsoft.com
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23132">[ date ]</a>
              <a href="thread.html#23132">[ thread ]</a>
              <a href="subject.html#23132">[ subject ]</a>
              <a href="author.html#23132">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
