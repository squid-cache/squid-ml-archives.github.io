<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] generate-host-certificates=on fails to generate certificates for _some_ hosts
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20generate-host-certificates%3Don%20fails%20to%20generate%0A%20certificates%20for%20_some_%20hosts&In-Reply-To=%3C36205A40-0297-47CE-BB95-2E75C0AC549B%40me.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023180.html">
   <LINK REL="Next"  HREF="023183.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] generate-host-certificates=on fails to generate certificates for _some_ hosts</H1>
    <B>Greg Hulands</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20generate-host-certificates%3Don%20fails%20to%20generate%0A%20certificates%20for%20_some_%20hosts&In-Reply-To=%3C36205A40-0297-47CE-BB95-2E75C0AC549B%40me.com%3E"
       TITLE="[squid-users] generate-host-certificates=on fails to generate certificates for _some_ hosts">ghulands at me.com
       </A><BR>
    <I>Wed Jan 13 21:33:05 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="023180.html">[squid-users] Squid vs. Telegram
</A></li>
        <LI>Next message (by thread): <A HREF="023183.html">[squid-users] generate-host-certificates=on fails to generate certificates for _some_ hosts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23182">[ date ]</a>
              <a href="thread.html#23182">[ thread ]</a>
              <a href="subject.html#23182">[ subject ]</a>
              <a href="author.html#23182">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,
I am setting up squid 5.0.3 and during testing I have found some websites fail to have their certificates generated correctly. I am able to go to sites like YouTube.com &lt;<A HREF="http://youtube.com/">http://youtube.com/</A>&gt; and have the certificates for that be generated correctly, but when I try to go to some others, like arstechnica.com &lt;<A HREF="http://arstechnica.com/">http://arstechnica.com/</A>&gt;, they fail to generate and return the CA cert that squid is using to sign certificates with.

I turned the logging up on certificate stuff to 5 and have the cache log from trying to make a request here: <A HREF="https://gist.github.com/ghulands/f89b49bf180bfac86c98c46c4260f1eb">https://gist.github.com/ghulands/f89b49bf180bfac86c98c46c4260f1eb</A> &lt;<A HREF="https://gist.github.com/ghulands/f89b49bf180bfac86c98c46c4260f1eb">https://gist.github.com/ghulands/f89b49bf180bfac86c98c46c4260f1eb</A>&gt;

My ssl-bump config is 

ssl_bump peek step1
ssl_bump bump all

Does anyone have any suggestions or insight on what might the problem be?

Thanks,
Greg


$ squid --version
Squid Cache: Version 5.0.3
Service Name: squid

This binary uses OpenSSL 1.1.1i  8 Dec 2020. For legal restrictions on distribution see <A HREF="https://www.openssl.org/source/license.html">https://www.openssl.org/source/license.html</A> &lt;<A HREF="https://www.openssl.org/source/license.html">https://www.openssl.org/source/license.html</A>&gt;

configure options:  '--with-default-user=squid' '--bindir=/usr/local/sbin' '--sbindir=/usr/local/sbin' '--datadir=/usr/local/etc/squid' '--libexecdir=/usr/local/libexec/squid' '--localstatedir=/var' '--sysconfdir=/usr/local/etc/squid' '--with-logdir=/var/log/squid' '--with-pidfile=/var/run/squid/squid.pid' '--with-swapdir=/var/squid/cache' '--without-gnutls' '--with-included-ltdl' '--enable-auth' '--enable-zph-qos' '--enable-build-info' '--enable-loadable-modules' '--enable-removal-policies=lru heap' '--disable-epoll' '--disable-linux-netfilter' '--disable-linux-tproxy' '--disable-translation' '--disable-arch-native' '--disable-strict-error-checking' '--enable-eui' '--enable-cache-digests' '--enable-delay-pools' '--disable-ecap' '--disable-esi' '--enable-follow-x-forwarded-for' '--with-mit-krb5=/usr/local' 'CFLAGS=-I/usr/local/include -O2 -pipe  -fstack-protector-strong -fno-strict-aliasing ' 'LDFLAGS=-L/usr/local/lib  -pthread -L/usr/local/lib -lpcreposix -lpcre -Wl,-rpath,/usr/local/lib:/usr/lib -Wl,-rpath,/usr/local/lib -fstack-protector-strong ' 'LIBS=-lkrb5 -lgssapi_krb5 ' 'KRB5CONFIG=/usr/local/bin/krb5-config' 'krb5_config=/usr/local/bin/krb5-config' '--enable-htcp' '--enable-icap-client' '--enable-icmp' '--enable-ident-lookups' '--enable-ipv6' '--enable-kqueue' '--with-large-files' '--enable-http-violations' '--without-nettle' '--enable-snmp' '--enable-ssl' '--with-openssl=/usr/local' '--enable-security-cert-generators=file' 'LIBOPENSSL_CFLAGS=-I/usr/local/include' 'LIBOPENSSL_LIBS=-lcrypto -lssl' '--enable-ssl-crtd' '--disable-stacktraces' '--disable-tdb' '--disable-ipf-transparent' '--enable-ipfw-transparent' '--disable-pf-transparent' '--without-nat-devpf' '--enable-forw-via-db' '--enable-wccp' '--enable-wccpv2' '--enable-auth-basic=DB SMB_LM NCSA PAM POP3 RADIUS fake getpwnam NIS' '--enable-auth-digest=file' '--enable-external-acl-helpers=file_userip unix_group delayer' '--enable-auth-negotiate=kerberos wrapper' '--enable-auth-ntlm=fake SMB_LM' '--enable-storeio=aufs diskd rock ufs' '--enable-disk-io=DiskThreads DiskDaemon AIO Blocking IpcIo Mmapped' '--enable-log-daemon-helpers=file DB' '--enable-url-rewrite-helpers=fake LFS' '--enable-storeid-rewrite-helpers=file' '--enable-security-cert-validators=fake' '--prefix=/usr/local' '--mandir=/usr/local/man' '--disable-silent-rules' '--infodir=/usr/local/share/info/' '--build=amd64-portbld-freebsd12.2' 'build_alias=amd64-portbld-freebsd12.2' 'CC=cc' 'CPPFLAGS=-I/usr/local/include' 'CXX=c++' 'CXXFLAGS=-O2 -pipe -fstack-protector-strong -fno-strict-aliasing  ' 'CPP=cpp' --enable-ltdl-convenience
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20210113/4ccca489/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20210113/4ccca489/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="023180.html">[squid-users] Squid vs. Telegram
</A></li>
	<LI>Next message (by thread): <A HREF="023183.html">[squid-users] generate-host-certificates=on fails to generate certificates for _some_ hosts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23182">[ date ]</a>
              <a href="thread.html#23182">[ thread ]</a>
              <a href="subject.html#23182">[ subject ]</a>
              <a href="author.html#23182">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
