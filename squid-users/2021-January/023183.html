<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] generate-host-certificates=on fails to generate certificates for _some_ hosts
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20generate-host-certificates%3Don%20fails%20to%20generate%0A%20certificates%20for%20_some_%20hosts&In-Reply-To=%3C6a1bf364-9dd8-fc73-22de-71b71974b51d%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023182.html">
   <LINK REL="Next"  HREF="023184.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] generate-host-certificates=on fails to generate certificates for _some_ hosts</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20generate-host-certificates%3Don%20fails%20to%20generate%0A%20certificates%20for%20_some_%20hosts&In-Reply-To=%3C6a1bf364-9dd8-fc73-22de-71b71974b51d%40measurement-factory.com%3E"
       TITLE="[squid-users] generate-host-certificates=on fails to generate certificates for _some_ hosts">rousskov at measurement-factory.com
       </A><BR>
    <I>Wed Jan 13 22:23:00 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="023182.html">[squid-users] generate-host-certificates=on fails to generate certificates for _some_ hosts
</A></li>
        <LI>Next message (by thread): <A HREF="023184.html">[squid-users] generate-host-certificates=on fails to generate certificates for _some_ hosts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23183">[ date ]</a>
              <a href="thread.html#23183">[ thread ]</a>
              <a href="subject.html#23183">[ subject ]</a>
              <a href="author.html#23183">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 1/13/21 4:33 PM, Greg Hulands wrote:

&gt;<i> I am setting up squid 5.0.3 and during testing I have found some 
</I>&gt;<i> websites fail to have their certificates generated correctly. I am
</I>&gt;<i> able to go to sites like YouTube.com and have the certificates for
</I>&gt;<i> that be generated correctly, but when I try to go to some others,
</I>&gt;<i> like arstechnica.com, they fail to generate and return the CA cert
</I>&gt;<i> that squid is using to sign certificates with.
</I>
Just to double check: Are you sure that the certificate the client gets
is the configured CA certificate? For example, do the two certificates
have the same fingerprint?


&gt;<i> I turned the logging up on certificate stuff to 5 and have the cache log
</I>&gt;<i> from trying to make a request
</I>&gt;<i> here:&#160;<A HREF="https://gist.github.com/ghulands/f89b49bf180bfac86c98c46c4260f1eb">https://gist.github.com/ghulands/f89b49bf180bfac86c98c46c4260f1eb</A>
</I>
The posted snippet shows successful TLS negotiation with the origin
server (FD 23) and a subsequently failed negotiation with the client (FD
21). The latter may have failed because the client did not like the
certificate generated by Squid, but I did not check the exact failure
reason carefully.

The snippet has no information about Squid sending the (generated)
certificates to the client, but Squid appears to receive some generated
certificate from the helper (crtGenRq3180846).

* If you are sure that the client gets a wrong certificate from Squid,
then I recommend posting an ALL,9 log of the problematic transaction.
With some luck, we may be able to see what went wrong with certificate
generation (or virgin certificate validation??).

* Otherwise, I recommend double checking what certificate the client
gets. If the client gets the correct generated certificate, then the
problem is not in certificate validation or generation.

Posting the certificate that the client actually gets may help a lot
with the triage as well.


HTH,

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="023182.html">[squid-users] generate-host-certificates=on fails to generate certificates for _some_ hosts
</A></li>
	<LI>Next message (by thread): <A HREF="023184.html">[squid-users] generate-host-certificates=on fails to generate certificates for _some_ hosts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23183">[ date ]</a>
              <a href="thread.html#23183">[ thread ]</a>
              <a href="subject.html#23183">[ subject ]</a>
              <a href="author.html#23183">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
