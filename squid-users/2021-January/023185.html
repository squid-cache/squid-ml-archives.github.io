<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] generate-host-certificates=on fails to generate certificates for _some_ hosts
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20generate-host-certificates%3Don%20fails%20to%20generate%0A%20certificates%20for%20_some_%20hosts&In-Reply-To=%3Cba51b826-3979-78e4-4f70-43e40f7e532c%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023184.html">
   <LINK REL="Next"  HREF="023188.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] generate-host-certificates=on fails to generate certificates for _some_ hosts</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20generate-host-certificates%3Don%20fails%20to%20generate%0A%20certificates%20for%20_some_%20hosts&In-Reply-To=%3Cba51b826-3979-78e4-4f70-43e40f7e532c%40measurement-factory.com%3E"
       TITLE="[squid-users] generate-host-certificates=on fails to generate certificates for _some_ hosts">rousskov at measurement-factory.com
       </A><BR>
    <I>Thu Jan 14 04:44:28 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="023184.html">[squid-users] generate-host-certificates=on fails to generate certificates for _some_ hosts
</A></li>
        <LI>Next message (by thread): <A HREF="023188.html">[squid-users] generate-host-certificates=on fails to generate certificates for _some_ hosts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23185">[ date ]</a>
              <a href="thread.html#23185">[ thread ]</a>
              <a href="subject.html#23185">[ subject ]</a>
              <a href="author.html#23185">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 1/13/21 9:47 PM, Greg Hulands wrote:
&gt;<i> I have put the ALL,9 log
</I>&gt;<i> here&#160;<A HREF="https://gist.github.com/ghulands/4a689db93fc87f9e7f69174f292f1914">https://gist.github.com/ghulands/4a689db93fc87f9e7f69174f292f1914</A>
</I>
&gt;<i> I can see it generates the certificate correctly,
</I>
Agreed. Squid receives (from the helper) a generated certificate with
the right wildcard CN, not a CA certificate.


&gt;<i> but couldn&#8217;t identify why it didn&#8217;t return the cert to the client.
</I>
Yeah... Squid is calling the code that should set the certificate for
the client connection. Unfortunately, I cannot easily tell whether that
code is using the right certificate -- the existing debugging may not
even reveal that detail.

If you see a different certificate received by the client -- something I
cannot verify from the logs -- then perhaps Squid incorrectly switched
the right certificate to a different one or Squid failed to set the
right certificate but forgot to report the problem (and the CA
certificate from the related context was used?). These are just wild
guesses.

If you do not get better suggestions for going forward, consider these
last-straw ideas:

* Testing with a client like openssl, try disabling TLS v1.3. It is
being used by the client in your logs. Perhaps there is something in TLS
v1.3 that requires special handing when talking to the client. I know
that Squid has problems with TLS v1.3 on the Squid-to-server
connections... (In your case, the Squid-to-server connection is TLS v1.2
AFAICT).

* Upgrade to the latest v5 or even v6. I see no relevant fixes in v5 but
I could miss them.

* If you are a developer, add more debugging or use gdb to find out what
happens with the Squid-to-client certificate. Otherwise, find a
developer who can do that for you.

Sorry I cannot think of any good options here.

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="023184.html">[squid-users] generate-host-certificates=on fails to generate certificates for _some_ hosts
</A></li>
	<LI>Next message (by thread): <A HREF="023188.html">[squid-users] generate-host-certificates=on fails to generate certificates for _some_ hosts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23185">[ date ]</a>
              <a href="thread.html#23185">[ thread ]</a>
              <a href="subject.html#23185">[ subject ]</a>
              <a href="author.html#23185">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
