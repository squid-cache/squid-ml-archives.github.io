<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] sslcrtvalidator_program
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20sslcrtvalidator_program&In-Reply-To=%3C002201d6edba%247b44ba50%2471ce2ef0%24%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023213.html">
   <LINK REL="Next"  HREF="023216.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] sslcrtvalidator_program</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20sslcrtvalidator_program&In-Reply-To=%3C002201d6edba%247b44ba50%2471ce2ef0%24%40gmail.com%3E"
       TITLE="[squid-users] sslcrtvalidator_program">ngtech1ltd at gmail.com
       </A><BR>
    <I>Mon Jan 18 16:53:43 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="023213.html">[squid-users] Making destination IP available in ICAP REQMOD request
</A></li>
        <LI>Next message (by thread): <A HREF="023216.html">[squid-users] sslcrtvalidator_program
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23212">[ date ]</a>
              <a href="thread.html#23212">[ thread ]</a>
              <a href="subject.html#23212">[ subject ]</a>
              <a href="author.html#23212">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey Alex,

I have tried to read the documentation and to compose a single certificate validation &quot;call&quot; or &quot;request&quot;.
The issue with this is that I am unable to do that.
It would help a lot if a single verification request would be public and available to me and maybe others.
The example shows:
0 cert_validate 1519 host=dmz.example-domain.com
cert_0=-----BEGIN CERTIFICATE-----
MIID+DCCA2GgAwIBAgIJAIDcHRUxB2O4MA0GCSqGSIb3DQEBBAUAMIGvMQswCQYD
...
YpVJGt5CJuNfCcB/
-----END CERTIFICATE-----
error_name_0=X509_V_ERR_DEPTH_ZERO_SELF_SIGNED_CERT
error_cert_0=cert0

so where ix the 0x01 byte and where are the new lines?
Maybe it's written but I do not see it like in the examples of the external_acl helpres.
My assumption for now is that:
## START
0 cert_validate 1519 host=dmz.example-domain.com0x01
cert_0=-----BEGIN CERTIFICATE-----0x01
MIID+DCCA2GgAwIBAgIJAIDcHRUxB2O4MA0GCSqGSIb3DQEBBAUAMIGvMQswCQYD0x01
...
YpVJGt5CJuNfCcB/0x01
-----END CERTIFICATE-----0x01
error_name_0=X509_V_ERR_DEPTH_ZERO_SELF_SIGNED_CERT0x01
error_cert_0=cert0\n
## END

I am pretty sure I am wrong since the helper I wrote doesn't work.

In bash I thing I can use the next echo:
echo -n -e 'test\x01'

to emulate it but I still don't get it right.

Hope for a hint about the subject.

Thanks,
Eliezer

----
Eliezer Croitoru
Tech Support
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A>
Zoom: Coming soon


-----Original Message-----
From: Alex Rousskov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt; 
Sent: Monday, December 14, 2020 9:05 PM
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Cc: Eliezer Croitor &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A>&gt;
Subject: Re: [squid-users] sslcrtvalidator_program

On 12/14/20 1:55 PM, Eliezer Croitor wrote:

&gt;<i> We can use this as an example for a single transaction in the wiki:
</I>&gt;<i> <A HREF="https://gist.githubusercontent.com/elico/a0397c879776336eeae569317015edc1/raw/b34dff8ece76e480007a950655efff3564afcccc/cache.log">https://gist.githubusercontent.com/elico/a0397c879776336eeae569317015edc1/raw/b34dff8ece76e480007a950655efff3564afcccc/cache.log</A>
</I>
&gt;<i> Let me know if it's enough to document this subject.
</I>
I am not sure I understand your question -- the format is already
documented. If you think that attaching an example of a raw helper
request to that wiki page would help others, please feel free to do so!
Just avoid the implication that all helper requests would have the same
set of fields.

Alex.


&gt;<i> -----Original Message-----
</I>&gt;<i> From: Alex Rousskov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt; 
</I>&gt;<i> Sent: Monday, December 14, 2020 6:42 PM
</I>&gt;<i> To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> Cc: Eliezer Croitor &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A>&gt;
</I>&gt;<i> Subject: Re: [squid-users] sslcrtvalidator_program
</I>&gt;<i> 
</I>&gt;<i> On 12/14/20 4:26 AM, Eliezer Croitor wrote:
</I>&gt;&gt;<i> So starts with:
</I>&gt;&gt;<i> 0 cert_validate... line
</I>&gt;<i> 
</I>&gt;&gt;<i> And ends with?:
</I>&gt;&gt;<i> error_name_0=X509_V_ERR_DEPTH_ZERO_SELF_SIGNED_CERT
</I>&gt;&gt;<i> error_cert_0=cert0
</I>&gt;&gt;<i> ?
</I>&gt;<i> 
</I>&gt;<i> No. The size of the key=value block is specified on the first request
</I>&gt;<i> line. Please try to follow documentation that Amos has pointed you to:
</I>&gt;<i> <A HREF="https://wiki.squid-cache.org/Features/AddonHelpers#SSL_server_certificate_validator">https://wiki.squid-cache.org/Features/AddonHelpers#SSL_server_certificate_validator</A>
</I>&gt;<i> 
</I>&gt;<i> If that documentation is missing some details, we should fix it.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> I am unsure, let me try to re-read this section.
</I>&gt;&gt;<i> I am missing a fake helper for this..
</I>&gt;&gt;<i> And a &quot;real world&quot; full example.
</I>&gt;<i> 
</I>&gt;&gt;<i> Can someone simulate it for me?
</I>&gt;<i> 
</I>&gt;<i> Glad you found
</I>&gt;<i> src/security/cert_validators/fake/security_fake_certverify.pl.in. I hope
</I>&gt;<i> it still works!
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> HTH,
</I>&gt;<i> 
</I>&gt;<i> Alex.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> -----Original Message-----
</I>&gt;&gt;<i> From: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; On Behalf Of Amos Jeffries
</I>&gt;&gt;<i> Sent: Monday, December 14, 2020 10:15 AM
</I>&gt;&gt;<i> To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i> Subject: Re: [squid-users] sslcrtvalidator_program
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On 14/12/20 9:11 am, Eliezer Croitor wrote:
</I>&gt;&gt;&gt;<i> I am trying to understand the way the sslcrtvalidator_program  works.
</I>&gt;&gt;&gt;<i> I am pretty sure I have asked this in the past but didn&#8217;t found it for some
</I>&gt;&gt;&gt;<i> reason.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I want to read line by line so.
</I>&gt;&gt;&gt;<i> /^-----BEGIN CERTIFICATE-----$/
</I>&gt;&gt;&gt;<i> ***
</I>&gt;&gt;&gt;<i> /^-----END CERTIFICATE-----$/
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> What else should I look for? I was thinking about validating with some extra
</I>&gt;&gt;&gt;<i> values in the request, for example ip/domain:port and sni.
</I>&gt;&gt;&gt;<i> Are these available in some way?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The details you need are all here:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  
</I>&gt;&gt;<i> &lt;<A HREF="https://wiki.squid-cache.org/Features/AddonHelpers#SSL_server_certificate_validator">https://wiki.squid-cache.org/Features/AddonHelpers#SSL_server_certificate_validator</A>&gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Notice that it receives chains of certificates - maybe several, and/or 
</I>&gt;&gt;<i> out of order. Whatever the client sends.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Amos
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;&gt;<i>
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="023213.html">[squid-users] Making destination IP available in ICAP REQMOD request
</A></li>
	<LI>Next message (by thread): <A HREF="023216.html">[squid-users] sslcrtvalidator_program
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23212">[ date ]</a>
              <a href="thread.html#23212">[ thread ]</a>
              <a href="subject.html#23212">[ subject ]</a>
              <a href="author.html#23212">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
