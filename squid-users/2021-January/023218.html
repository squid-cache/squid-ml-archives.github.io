<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Trying to verify couple tls issues
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Trying%20to%20verify%20couple%20tls%20issues&In-Reply-To=%3C8116b402-9606-f189-1359-c1b4673c179e%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023214.html">
   <LINK REL="Next"  HREF="023215.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Trying to verify couple tls issues</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Trying%20to%20verify%20couple%20tls%20issues&In-Reply-To=%3C8116b402-9606-f189-1359-c1b4673c179e%40treenet.co.nz%3E"
       TITLE="[squid-users] Trying to verify couple tls issues">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon Jan 18 18:45:31 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="023214.html">[squid-users] Trying to verify couple tls issues
</A></li>
        <LI>Next message (by thread): <A HREF="023215.html">[squid-users] What is this access.log line?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23218">[ date ]</a>
              <a href="thread.html#23218">[ thread ]</a>
              <a href="subject.html#23218">[ subject ]</a>
              <a href="author.html#23218">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 19/01/21 6:04 am, Eliezer Croitoru wrote:
&gt;<i> I wrote the next &quot;helping/helper/testing scripts&quot;:
</I>&gt;<i> <A HREF="https://github.com/elico/tls-check-script/blob/master/tls-check.rb">https://github.com/elico/tls-check-script/blob/master/tls-check.rb</A>
</I>&gt;<i> <A HREF="https://github.com/elico/tls-check-script/blob/master/check-dns-san.sh">https://github.com/elico/tls-check-script/blob/master/check-dns-san.sh</A>
</I>&gt;<i> 
</I>&gt;<i> Now I am trying to verify what issues exists that causes squid to this
</I>&gt;<i> result:
</I>&gt;<i> 2021/01/18 18:54:47 kid1| Error negotiating SSL connection on FD 46:
</I>&gt;<i> error:00000001:lib(0):func(0):reason(1) (1/-1)
</I>&gt;<i>      connection: conn407043 local=161.117.96.220:443 remote=192.16.XYZ
</I>&gt;<i> flags=33
</I>&gt;<i> 
</I>&gt;<i> So the output of: bash check-dns-san.sh 161.117.96.220 443 is:
</I>&gt;<i> ## START
</I>&gt;<i> Can't use SSL_get_servername
</I>&gt;<i> depth=2 C = US, O = DigiCert Inc, OU = www.digicert.com, CN = DigiCert
</I>&gt;<i> Global Root CA
</I>&gt;<i> verify return:1
</I>&gt;<i> depth=1 C = US, O = DigiCert Inc, OU = www.digicert.com, CN = RapidSSL RSA
</I>&gt;<i> CA 2018
</I>&gt;<i> verify return:1
</I>&gt;<i> depth=0 CN = data.mistat.intl.xiaomi.com
</I>&gt;<i> verify return:1
</I>&gt;<i> DONE
</I>&gt;<i> X509v3 Subject Alternative Name:
</I>&gt;<i>      DNS:data.mistat.intl.xiaomi.com
</I>&gt;<i> ## END
</I>&gt;<i> 
</I>&gt;<i> And then I am testing with the next command: ruby tls-check.rb
</I>&gt;<i> 161.117.96.220 443 and the output is:
</I>&gt;<i> ## START
</I>&gt;<i> ### Number of Ciphers to be tested: 66
</I>&gt;<i> ### Timeout per test: 3
</I>&gt;<i> ### Delay between tests: 1
</I>&gt;<i> Testing TLS_AES_256_GCM_SHA384...  NO, SSL_CTX_set_cipher_list
</I>&gt;<i> Testing TLS_CHACHA20_POLY1305_SHA256...  NO, SSL_CTX_set_cipher_list
</I>&gt;<i> Testing TLS_AES_128_GCM_SHA256...  NO, SSL_CTX_set_cipher_list
</I>&gt;<i> Testing TLS_AES_128_CCM_SHA256...  NO, SSL_CTX_set_cipher_list
</I>&gt;<i> Testing ECDHE-ECDSA-AES256-GCM-SHA384...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing ECDHE-RSA-AES256-GCM-SHA384...  CONNECTED:
</I>&gt;<i> ECDHE-RSA-AES256-GCM-SHA384, YES, Secure Renegotiation IS supported
</I>&gt;<i> Testing DHE-RSA-AES256-GCM-SHA384...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing ECDHE-ECDSA-CHACHA20-POLY1305...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing ECDHE-RSA-CHACHA20-POLY1305...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing DHE-RSA-CHACHA20-POLY1305...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing ECDHE-ECDSA-AES256-CCM8...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing ECDHE-ECDSA-AES256-CCM...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing DHE-RSA-AES256-CCM8...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing DHE-RSA-AES256-CCM...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing ECDHE-ECDSA-ARIA256-GCM-SHA384...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing ECDHE-ARIA256-GCM-SHA384...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing DHE-RSA-ARIA256-GCM-SHA384...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing ECDHE-ECDSA-AES128-GCM-SHA256...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing ECDHE-RSA-AES128-GCM-SHA256...  CONNECTED:
</I>&gt;<i> ECDHE-RSA-AES128-GCM-SHA256, YES, Secure Renegotiation IS supported
</I>&gt;<i> Testing DHE-RSA-AES128-GCM-SHA256...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing ECDHE-ECDSA-AES128-CCM8...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing ECDHE-ECDSA-AES128-CCM...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing DHE-RSA-AES128-CCM8...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing DHE-RSA-AES128-CCM...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing ECDHE-ECDSA-ARIA128-GCM-SHA256...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing ECDHE-ARIA128-GCM-SHA256...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing DHE-RSA-ARIA128-GCM-SHA256...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing ECDHE-ECDSA-AES256-SHA384...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing ECDHE-RSA-AES256-SHA384...  CONNECTED: ECDHE-RSA-AES256-SHA384, YES,
</I>&gt;<i> Secure Renegotiation IS supported
</I>&gt;<i> Testing DHE-RSA-AES256-SHA256...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing ECDHE-ECDSA-CAMELLIA256-SHA384...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing ECDHE-RSA-CAMELLIA256-SHA384...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing DHE-RSA-CAMELLIA256-SHA256...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing ECDHE-ECDSA-AES128-SHA256...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing ECDHE-RSA-AES128-SHA256...  CONNECTED: ECDHE-RSA-AES128-SHA256, YES,
</I>&gt;<i> Secure Renegotiation IS supported
</I>&gt;<i> Testing DHE-RSA-AES128-SHA256...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing ECDHE-ECDSA-CAMELLIA128-SHA256...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing ECDHE-RSA-CAMELLIA128-SHA256...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing DHE-RSA-CAMELLIA128-SHA256...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing ECDHE-ECDSA-AES256-SHA...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing ECDHE-RSA-AES256-SHA...  CONNECTED: ECDHE-RSA-AES256-SHA, YES,
</I>&gt;<i> Secure Renegotiation IS supported
</I>&gt;<i> Testing DHE-RSA-AES256-SHA...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing DHE-RSA-CAMELLIA256-SHA...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing ECDHE-ECDSA-AES128-SHA...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing ECDHE-RSA-AES128-SHA...  CONNECTED: ECDHE-RSA-AES128-SHA, YES,
</I>&gt;<i> Secure Renegotiation IS supported
</I>&gt;<i> Testing DHE-RSA-AES128-SHA...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing DHE-RSA-CAMELLIA128-SHA...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing AES256-GCM-SHA384...  CONNECTED: AES256-GCM-SHA384, YES, Secure
</I>&gt;<i> Renegotiation IS supported
</I>&gt;<i> Testing AES256-CCM8...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing AES256-CCM...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing ARIA256-GCM-SHA384...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing AES128-GCM-SHA256...  CONNECTED: AES128-GCM-SHA256, YES, Secure
</I>&gt;<i> Renegotiation IS supported
</I>&gt;<i> Testing AES128-CCM8...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing AES128-CCM...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing ARIA128-GCM-SHA256...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing AES256-SHA256...  CONNECTED: AES256-SHA256, YES, Secure
</I>&gt;<i> Renegotiation IS supported
</I>&gt;<i> Testing CAMELLIA256-SHA256...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing AES128-SHA256...  CONNECTED: AES128-SHA256, YES, Secure
</I>&gt;<i> Renegotiation IS supported
</I>&gt;<i> Testing CAMELLIA128-SHA256...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing AES256-SHA...  CONNECTED: AES256-SHA, YES, Secure Renegotiation IS
</I>&gt;<i> supported
</I>&gt;<i> Testing CAMELLIA256-SHA...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing AES128-SHA...  CONNECTED: AES128-SHA, YES, Secure Renegotiation IS
</I>&gt;<i> supported
</I>&gt;<i> Testing CAMELLIA128-SHA...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing DHE-RSA-SEED-SHA...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing SEED-SHA...  NO, sslv3 alert handshake failure
</I>&gt;<i> Testing IDEA-CBC-SHA...  NO, ssl_cipher_process_rulestr
</I>&gt;<i> ## END
</I>&gt;<i> 
</I>&gt;<i> I assume that the above results might give a clue why mentioned error line:
</I>&gt;<i> 2021/01/18 18:54:47 kid1| Error negotiating SSL connection on FD 46:
</I>&gt;<i> error:00000001:lib(0):func(0):reason(1) (1/-1)
</I>&gt;<i>      connection: conn407043 local=161.117.96.220:443 remote=192.16.XYZ
</I>&gt;<i> flags=33
</I>
Take the output above and grep &quot;CONNECTED: &quot;. If the client or Squid do 
not support those combinations, the above error will result when 
connecting to that server.


 &gt; Testing ECDHE-RSA-AES256-GCM-SHA384...  CONNECTED:
 &gt; ECDHE-RSA-AES256-GCM-SHA384, YES, Secure Renegotiation IS supported

 &gt; Testing ECDHE-RSA-AES128-GCM-SHA256...CONNECTED:
 &gt; ECDHE-RSA-AES128-GCM-SHA256, YES, Secure Renegotiation IS supported

 &gt; Testing ECDHE-RSA-AES256-SHA384...CONNECTED: ECDHE-RSA-AES256-SHA384,
 &gt; Testing ECDHE-RSA-AES128-SHA256...CONNECTED: ECDHE-RSA-AES128-SHA256,
 &gt; Testing ECDHE-RSA-AES256-SHA...  CONNECTED: ECDHE-RSA-AES256-SHA, YES,
 &gt; Testing AES256-GCM-SHA384...  CONNECTED: AES256-GCM-SHA384, YES,
 &gt; Testing AES128-GCM-SHA256...  CONNECTED: AES128-GCM-SHA256, YES,
 &gt; Testing AES256-SHA256...  CONNECTED: AES256-SHA256, YES, Secure
 &gt; Testing AES128-SHA256...  CONNECTED: AES128-SHA256, YES, Secure
 &gt; Testing AES256-SHA...  CONNECTED: AES256-SHA, YES, Secure
 &gt; Testing AES128-SHA...  CONNECTED: AES128-SHA, YES, Secure
 &gt; ## END


&gt;<i> 
</I>&gt;<i> happens. However I am not sure.
</I>&gt;<i> Are there any config that might affect this negotiation in squid?
</I>

When either SHA or AES are not possible for Squid to use it will happen. 
Depending on whether your Squid is doing bumping or not will will 
determine whether it is possible to affect with a configuration change 
or if the issue is the client software.


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="023214.html">[squid-users] Trying to verify couple tls issues
</A></li>
	<LI>Next message (by thread): <A HREF="023215.html">[squid-users] What is this access.log line?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23218">[ date ]</a>
              <a href="thread.html#23218">[ thread ]</a>
              <a href="subject.html#23218">[ subject ]</a>
              <a href="author.html#23218">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
