<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid doesn't notice AD group changes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20doesn%27t%20notice%20AD%20group%20changes&In-Reply-To=%3C000201d6f04b%2430e9cb10%2492bd6130%24%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023230.html">
   <LINK REL="Next"  HREF="023233.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid doesn't notice AD group changes</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20doesn%27t%20notice%20AD%20group%20changes&In-Reply-To=%3C000201d6f04b%2430e9cb10%2492bd6130%24%40gmail.com%3E"
       TITLE="[squid-users] Squid doesn't notice AD group changes">ngtech1ltd at gmail.com
       </A><BR>
    <I>Thu Jan 21 23:14:37 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="023230.html">[squid-users] Squid doesn't notice AD group changes
</A></li>
        <LI>Next message (by thread): <A HREF="023233.html">[squid-users] Squid doesn't notice AD group changes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23232">[ date ]</a>
              <a href="thread.html#23232">[ thread ]</a>
              <a href="subject.html#23232">[ subject ]</a>
              <a href="author.html#23232">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Have You tried to use external_acl_type for group membership checks?

 

Something like this should do the trick:

external_acl_type ad_group_member_check ttl=120 %LOGIN /usr/lib/squid/ext_ldap_group_acl -d -R -K -S -b &quot;dc=ng,dc=tech&quot; -D <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid at ng.tech</A> -W /etc/squid/ldappass.txt  -f &quot;(&amp;(sAMAccountName=%u)(memberOf=CN=%g,OU=Groups,DC=ng,DC=tech))&quot; -h ngtech-dc.ng.tech

 


Eliezer

 

----

Eliezer Croitoru

Tech Support

Mobile: +972-5-28704261

Email:  &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A>&gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A>

Zoom: Coming soon

 

 

From: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; On Behalf Of <A HREF="https://lists.squid-cache.org/listinfo/squid-users">heimarbeit123.99 at web.de</A>
Sent: Wednesday, January 20, 2021 3:51 PM
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: [squid-users] Squid doesn't notice AD group changes

 

Hello all! :)

 

I am running squid 4.1 on the newest Linux Mint with Kerberos SSO(connected to my AD), so I can check for AD groups and therefore block websites and so on. Thanks to the very good documentation everything looks good so far!

But there is one realy big problem: Squid does not recognize AD group membership changes.

What does that mean?

 

Imagine I have TestUser1 and TestGroup1 and Testgroup2 in my AD. If I join TestUser1 to Testgroup1 everything is working(the first time ever, this specific user is getting member of one of these two groups). SSO works and the forbidden websites get blocked. So far so good ;)

But if I remove TestUser1 from TestGroup1 and make him a member of Testgroup2, shit is about to hit the fan!

After some seconds(winbind cache time = 30 in smb.conf) winbind recognizes, that TestUser1 is not member of TestGroup1 anymore, but now is a member of Testgroup2. But Squid doesn't!! Squid further treats TestUser1 as he would still be in TestGroup1.

But if I now add a completly new user TestUser2 to the AD and then to Testgroup2, squid will treat this user corretly. If I then remove TestUser2 from Testgroup2 and add this user to TestGroup1, same shit again: winbind recognizes the change, but squid still treats TestUser2 like he would be member of TestGroup2.

 

What I tried:

-remove cache (net cache flush, &quot;cache deny all&quot;, &quot;no_cache deny all&quot;)

-remove squid with &quot;purge&quot; and reinstall it, still same problem

 

Can anyone help???

 

remember: Everything works with a new user, so I dont think kerberos is the problem. And winbind recognizes the change, so I think winbind is well configured too. Maybe squid is caching something(only explanation for me) but I don't see any caching.. Maybe someone had the same issue. Would be awesome, if someone could help me!

 

Regards

Philipp

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20210122/a1c8a95b/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20210122/a1c8a95b/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="023230.html">[squid-users] Squid doesn't notice AD group changes
</A></li>
	<LI>Next message (by thread): <A HREF="023233.html">[squid-users] Squid doesn't notice AD group changes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23232">[ date ]</a>
              <a href="thread.html#23232">[ thread ]</a>
              <a href="subject.html#23232">[ subject ]</a>
              <a href="author.html#23232">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
