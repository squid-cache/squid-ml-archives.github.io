<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] acl aclname server_cert_fingerprint
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20acl%20aclname%20server_cert_fingerprint&In-Reply-To=%3C000201d6f3b2%243b626240%24b22726c0%24%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023261.html">
   <LINK REL="Next"  HREF="023265.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] acl aclname server_cert_fingerprint</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20acl%20aclname%20server_cert_fingerprint&In-Reply-To=%3C000201d6f3b2%243b626240%24b22726c0%24%40gmail.com%3E"
       TITLE="[squid-users] acl aclname server_cert_fingerprint">ngtech1ltd at gmail.com
       </A><BR>
    <I>Tue Jan 26 07:09:46 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="023261.html">[squid-users] acl aclname server_cert_fingerprint
</A></li>
        <LI>Next message (by thread): <A HREF="023265.html">[squid-users] acl aclname server_cert_fingerprint
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23262">[ date ]</a>
              <a href="thread.html#23262">[ thread ]</a>
              <a href="subject.html#23262">[ subject ]</a>
              <a href="author.html#23262">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I will try to test it when users are not on the proxy later.

I have another issue with the &quot;server_cert_fingerprint&quot; directive.
I have a working setup which I am unable to make it work with &quot;server_cert_fingerprint&quot;.
I'm not sure how and in what step or place in the config it should be used.

My squid conf attached and one server cert fingerprint is:
1C:8C:EC:C8:C4:7F:DF:36:62:69:B1:6A:92:5A:AE:4A:F2:06:E6:B2

Which is in the file:
no-ssl-bump-server-fingerprint.list

I'm trying to understand what I'm doing wrong in the config that stil lets edition.cnn.com be decrypted instead of spliced?

Thanks,
Eliezer

----
Eliezer Croitoru
Tech Support
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A>
Zoom: Coming soon


-----Original Message-----
From: Alex Rousskov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt; 
Sent: Tuesday, January 26, 2021 6:22 AM
To: Eliezer Croitoru &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A>&gt;; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] acl aclname server_cert_fingerprint

On 1/25/21 6:03 AM, Eliezer Croitoru wrote:
&gt;<i> I'm trying to use:
</I>&gt;<i> acl aclname server_cert_fingerprint [-sha1] fingerprint
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> I have cerated the next file:
</I>&gt;<i> /etc/squid/no-ssl-bump-server-fingerprint.list
</I>&gt;<i> 
</I>&gt;<i> And trying to use the next line:
</I>&gt;<i> acl NoBump_certificate_fingerprint server_cert_fingerprint -sha1
</I>&gt;<i> &quot;/etc/squid/no-ssl-bump-server-fingerprint.list&quot;
</I>&gt;<i> 
</I>&gt;<i> To be explicit despite that only sha1 is a valid checksum.
</I>&gt;<i> Squid doesn't accept the above line 
</I>

Does not accept how? What is the error message?


&gt;<i> but this one yes:
</I>&gt;<i> acl NoBump_certificate_fingerprint server_cert_fingerprint
</I>&gt;<i> &quot;/etc/squid/no-ssl-bump-server-fingerprint.list&quot;
</I>
&gt;<i> Is there a reason for that?
</I>

The use of ACL options and ACL parameter options is poorly documented.

Squid Bug 4847 is marked as fixed, but the corresponding commit d4c6aca
says that server_cert_fingerprint is still broken. Not sure whether that
was true, whether some other commit has fixed that ACL, and whether the
problem mentioned in the commit message is related to your troubles.
<A HREF="https://bugs.squid-cache.org/show_bug.cgi?id=4847">https://bugs.squid-cache.org/show_bug.cgi?id=4847</A>
<A HREF="https://github.com/squid-cache/squid/pull/191">https://github.com/squid-cache/squid/pull/191</A>

Also, according to my 2015 notes, server_cert_fingerprint happens to be
case sensitive. I consider that a bug. I am not sure, but I think Squid
expects uppercase hex letters (if any). I do not know whether that has
been fixed.


Finally, it is dangerous to list ACL parameter options like -sha1 in
front of parameter filename when that parameter file may contain its own
parameter options. A reader may think that -sha1 in squid.conf
overwrites, say, -sha256 in the parameter file, but that is not what
probably will happen when Squid starts supporting both options.

That consideration may actually be the reason why Squid rejects your
first configuration sample (or perhaps it should be the reason even if
it does not).

I am sure there are use cases where the admin wants to apply one
parameter option to the whole file, but the ambiguity is too dangerous
to allow IMO. We should make the choice explicit.


HTH,

Alex.



-------------- next part --------------
A non-text attachment was scrubbed...
Name: squid.conf
Type: application/octet-stream
Size: 7195 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20210126/6e4f94c4/attachment.obj">http://lists.squid-cache.org/pipermail/squid-users/attachments/20210126/6e4f94c4/attachment.obj</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="023261.html">[squid-users] acl aclname server_cert_fingerprint
</A></li>
	<LI>Next message (by thread): <A HREF="023265.html">[squid-users] acl aclname server_cert_fingerprint
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23262">[ date ]</a>
              <a href="thread.html#23262">[ thread ]</a>
              <a href="subject.html#23262">[ subject ]</a>
              <a href="author.html#23262">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
