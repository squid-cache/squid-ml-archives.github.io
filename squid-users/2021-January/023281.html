<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Fixing Squid configuration for caching proxy?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Fixing%20Squid%20configuration%20for%20caching%20proxy%3F&In-Reply-To=%3Ceb45d98e-1e74-72f2-187b-37f66248cc8b%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023280.html">
   <LINK REL="Next"  HREF="023282.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Fixing Squid configuration for caching proxy?</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Fixing%20Squid%20configuration%20for%20caching%20proxy%3F&In-Reply-To=%3Ceb45d98e-1e74-72f2-187b-37f66248cc8b%40measurement-factory.com%3E"
       TITLE="[squid-users] Fixing Squid configuration for caching proxy?">rousskov at measurement-factory.com
       </A><BR>
    <I>Sat Jan 30 03:22:11 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="023280.html">[squid-users] Fixing Squid configuration for caching proxy?
</A></li>
        <LI>Next message (by thread): <A HREF="023282.html">[squid-users] Fixing Squid configuration for caching proxy?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23281">[ date ]</a>
              <a href="thread.html#23281">[ thread ]</a>
              <a href="subject.html#23281">[ subject ]</a>
              <a href="author.html#23281">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 1/29/21 6:06 PM, Milos Dodic wrote:

&gt;<i> The log is very long :)
</I>&gt;<i> I think I found the important part though, but you might need more than
</I>&gt;<i> this.
</I>
No, the snippets you found show an already released cache entry. We
still do not know why it was released earlier.


&gt;<i> If you need more, could you tell me what to parse for exactly, as I
</I>&gt;<i> don't think I can paste the whole log :)
</I>
Unfortunately, I cannot guess the exact lines to look for -- the true
answer may be hidden in many places, and the meaning of many messages
depends on their surrounding context. IMO, these low-level debugging
logs are only suitable for analysis by capable Squid developers.

To save time and effort, I always recommend sharing a link to the
compressed log instead. In the past, folks have shared links to DropBox,
GitHub gists, Google Drive, and similar temporary upload areas. As
always, do not use sensitive data in shared tests and test configurations!


Thank you,

Alex.

&gt;<i> On Fri, Jan 29, 2021 at 8:57 PM Alex Rousskov wrote:
</I>&gt;<i> 
</I>&gt;<i>     On 1/29/21 12:56 PM, Milos Dodic wrote:
</I>&gt;<i> 
</I>&gt;<i>     &gt; Here are the logs, but first to mention, from the server that is going
</I>&gt;<i>     &gt; through the Squid, I am using curl -k (-k to ignore SSL insecure
</I>&gt;<i>     &gt; warnings atm). From the Squid iself, I use squidclient, as using curl
</I>&gt;<i>     &gt; from Squid doesn't do much.
</I>&gt;<i> 
</I>&gt;<i>     It is possible that SslBump (your first/&quot;server&quot; test) side effects
</I>&gt;<i>     somehow disable caching, but I cannot tell that from the logs you have
</I>&gt;<i>     shared. IIRC, SslBump does not prevent caching by default.
</I>&gt;<i> 
</I>&gt;<i>     I see nothing special in the HTTP headers. TLS ServerHello parsing
</I>&gt;<i>     errors look suspicious, but they happen in both tests, and I suspect
</I>&gt;<i>     that they are unrelated to the transactions we are talking about -- I
</I>&gt;<i>     could not quickly tell for sure from the logs you shared.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     &gt;&gt; 2021/01/29 17:31:02.537 kid1| 20,2| store.cc(986) checkCachable:
</I>&gt;<i>     &gt;&gt; StoreEntry::checkCachable: NO: not cachable
</I>&gt;<i> 
</I>&gt;<i>     If this log entry is about the transaction in question, then it tells us
</I>&gt;<i>     that Squid marked the response for deletion some time ago. We need to
</I>&gt;<i>     figure out why Squid is releasing this response. I do not see the answer
</I>&gt;<i>     in your logs.
</I>&gt;<i> 
</I>&gt;<i>     Sorry, I cannot offer more help without ALL,9 logs [for the first
</I>&gt;<i>     transaction in the first/failing test].
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     HTH,
</I>&gt;<i> 
</I>&gt;<i>     Alex.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     &gt; So when I curl the newly uploaded test file from the server that has
</I>&gt;<i>     &gt; Squid as default gateway, the access logs shows:
</I>&gt;<i>     &gt;
</I>&gt;<i>     ------------------------------------------------------------------------------------------------------------------
</I>&gt;<i>     &gt; 1611941462.501 &#160; &#160; 13 10.10.1.249 NONE/200 0 CONNECT
</I>&gt;<i>     52.217.88.134:443 &lt;<A HREF="http://52.217.88.134:443">http://52.217.88.134:443</A>&gt;
</I>&gt;<i>     &gt; &lt;<A HREF="http://52.217.88.134:443">http://52.217.88.134:443</A>&gt; - ORIGINAL_DST/52.217.88.134
</I>&gt;<i>     &lt;<A HREF="http://52.217.88.134">http://52.217.88.134</A>&gt;
</I>&gt;<i>     &gt; &lt;<A HREF="http://52.217.88.134">http://52.217.88.134</A>&gt; -
</I>&gt;<i>     &gt; 1611941462.537 &#160; &#160; 22 10.10.1.249 TCP_MISS/200 488 GET
</I>&gt;<i>     &gt; <A HREF="https://s3.amazonaws.com/test.XXXXX.com/testFile">https://s3.amazonaws.com/test.XXXXX.com/testFile</A> -
</I>&gt;<i>     &gt; ORIGINAL_DST/52.217.88.134 &lt;<A HREF="http://52.217.88.134">http://52.217.88.134</A>&gt;
</I>&gt;<i>     &lt;<A HREF="http://52.217.88.134">http://52.217.88.134</A>&gt; binary/octet-stream
</I>&gt;<i>     &gt;
</I>&gt;<i>     ------------------------------------------------------------------------------------------------------------------
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; Cache log is quite long, but won't truncate in order to not omit
</I>&gt;<i>     &gt; something potentially important:
</I>&gt;<i>     &gt;
</I>&gt;<i>     --------------------------------------------------------------------------------------------------------------------------------
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.488 kid1| 5,2| TcpAcceptor.cc(224) doAccept: New
</I>&gt;<i>     &gt; connection on FD 30
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.488 kid1| 5,2| TcpAcceptor.cc(312) acceptNext:
</I>&gt;<i>     &gt; connection on local=[::]:3130 remote=[::] FD 30 flags=41
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.488 kid1| 33,2| client_side.cc(2748)
</I>&gt;<i>     &gt; httpsSslBumpAccessCheckDone: sslBump action stareneeded for
</I>&gt;<i>     &gt; local=52.217.88.134:443 &lt;<A HREF="http://52.217.88.134:443">http://52.217.88.134:443</A>&gt;
</I>&gt;<i>     &lt;<A HREF="http://52.217.88.134:443">http://52.217.88.134:443</A>&gt;
</I>&gt;<i>     &gt; remote=10.10.1.249:43538 &lt;<A HREF="http://10.10.1.249:43538">http://10.10.1.249:43538</A>&gt;
</I>&gt;<i>     &lt;<A HREF="http://10.10.1.249:43538">http://10.10.1.249:43538</A>&gt; FD 13 flags=33
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.488 kid1| 33,2| client_side.cc(3424)
</I>&gt;<i>     &gt; fakeAConnectRequest: fake a CONNECT request to force connState to
</I>&gt;<i>     tunnel
</I>&gt;<i>     &gt; for ssl-bump
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.491 kid1| 85,2| client_side_request.cc(753)
</I>&gt;<i>     &gt; clientAccessCheckDone: The request CONNECT 52.217.88.134:443
</I>&gt;<i>     &lt;<A HREF="http://52.217.88.134:443">http://52.217.88.134:443</A>&gt;
</I>&gt;<i>     &gt; &lt;<A HREF="http://52.217.88.134:443">http://52.217.88.134:443</A>&gt; is ALLOWED; last ACL checked:
</I>&gt;<i>     allowed_http_sites
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.492 kid1| 85,2| client_side_request.cc(729)
</I>&gt;<i>     &gt; clientAccessCheck2: No adapted_http_access configuration. default:
</I>&gt;<i>     ALLOW
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.492 kid1| 85,2| client_side_request.cc(753)
</I>&gt;<i>     &gt; clientAccessCheckDone: The request CONNECT 52.217.88.134:443
</I>&gt;<i>     &lt;<A HREF="http://52.217.88.134:443">http://52.217.88.134:443</A>&gt;
</I>&gt;<i>     &gt; &lt;<A HREF="http://52.217.88.134:443">http://52.217.88.134:443</A>&gt; is ALLOWED; last ACL checked:
</I>&gt;<i>     allowed_http_sites
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.494 kid1| 17,2| FwdState.cc(142) FwdState:
</I>&gt;<i>     &gt; Forwarding client request local=52.217.88.134:443
</I>&gt;<i>     &lt;<A HREF="http://52.217.88.134:443">http://52.217.88.134:443</A>&gt;
</I>&gt;<i>     &gt; &lt;<A HREF="http://52.217.88.134:443">http://52.217.88.134:443</A>&gt; remote=10.10.1.249:43538
</I>&gt;<i>     &lt;<A HREF="http://10.10.1.249:43538">http://10.10.1.249:43538</A>&gt;
</I>&gt;<i>     &gt; &lt;<A HREF="http://10.10.1.249:43538">http://10.10.1.249:43538</A>&gt; FD 13 flags=33, url=52.217.88.134:443
</I>&gt;<i>     &lt;<A HREF="http://52.217.88.134:443">http://52.217.88.134:443</A>&gt;
</I>&gt;<i>     &gt; &lt;<A HREF="http://52.217.88.134:443">http://52.217.88.134:443</A>&gt;
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.494 kid1| 44,2| peer_select.cc(302)
</I>&gt;<i>     &gt; peerSelectDnsPaths: Found sources for '52.217.88.134:443
</I>&gt;<i>     &lt;<A HREF="http://52.217.88.134:443">http://52.217.88.134:443</A>&gt;
</I>&gt;<i>     &gt; &lt;<A HREF="http://52.217.88.134:443">http://52.217.88.134:443</A>&gt;'
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.494 kid1| 44,2| peer_select.cc(303)
</I>&gt;<i>     &gt; peerSelectDnsPaths: &#160; always_direct = DENIED
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.494 kid1| 44,2| peer_select.cc(304)
</I>&gt;<i>     &gt; peerSelectDnsPaths: &#160; &#160;never_direct = DENIED
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.494 kid1| 44,2| peer_select.cc(310)
</I>&gt;<i>     &gt; peerSelectDnsPaths: &#160; &#160;ORIGINAL_DST = local=0.0.0.0
</I>&gt;<i>     &gt; remote=52.217.88.134:443 &lt;<A HREF="http://52.217.88.134:443">http://52.217.88.134:443</A>&gt;
</I>&gt;<i>     &lt;<A HREF="http://52.217.88.134:443">http://52.217.88.134:443</A>&gt; flags=1
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.494 kid1| 44,2| peer_select.cc(317)
</I>&gt;<i>     &gt; peerSelectDnsPaths: &#160; &#160; &#160; &#160;timedout = 0
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.496 kid1| 83,2| bio.cc(316) readAndParse: parsing
</I>&gt;<i>     &gt; error on FD 15: check failed: state &lt; atHelloReceived
</I>&gt;<i>     &gt; &#160; &#160; exception location: Handshake.cc(324) parseHandshakeMessage
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.496 kid1| Error parsing SSL Server Hello
</I>&gt;<i>     Message on
</I>&gt;<i>     &gt; FD 15
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.501 kid1| 37,2| IcmpSquid.cc(91) SendEcho: to
</I>&gt;<i>     &gt; 52.217.88.134, opcode 3, len 13
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.501| 42,2| IcmpPinger.cc(205) Recv: &#160;Pass
</I>&gt;<i>     &gt; 52.217.88.134 off to ICMPv4 module.
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.501| 42,2| Icmp.cc(95) Log: pingerLog:
</I>&gt;<i>     &gt; 1611941462.501640 52.217.88.134 &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; 32
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.501 kid1| 20,2| store.cc(986) checkCachable:
</I>&gt;<i>     &gt; StoreEntry::checkCachable: NO: not cachable
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.501 kid1| 20,2| store.cc(986) checkCachable:
</I>&gt;<i>     &gt; StoreEntry::checkCachable: NO: not cachable
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.502| 42,2| IcmpPinger.cc(218) SendResult: return
</I>&gt;<i>     &gt; result to squid. len=7994
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.502| 42,2| Icmp.cc(95) Log: pingerLog:
</I>&gt;<i>     &gt; 1611941462.502816 52.217.88.134 &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; 0 Echo
</I>&gt;<i>     &gt; Reply &#160; &#160; &#160;1ms 6 hops
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.514 kid1| 83,2| client_side.cc(2683)
</I>&gt;<i>     &gt; clientNegotiateSSL: New session 0x19d4690 on FD 13
</I>&gt;<i>     (10.10.1.249:43538 &lt;<A HREF="http://10.10.1.249:43538">http://10.10.1.249:43538</A>&gt;
</I>&gt;<i>     &gt; &lt;<A HREF="http://10.10.1.249:43538">http://10.10.1.249:43538</A>&gt;)
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.515 kid1| 11,2| client_side.cc(1306)
</I>&gt;<i>     &gt; parseHttpRequest: HTTP Client local=52.217.88.134:443
</I>&gt;<i>     &lt;<A HREF="http://52.217.88.134:443">http://52.217.88.134:443</A>&gt;
</I>&gt;<i>     &gt; &lt;<A HREF="http://52.217.88.134:443">http://52.217.88.134:443</A>&gt; remote=10.10.1.249:43538
</I>&gt;<i>     &lt;<A HREF="http://10.10.1.249:43538">http://10.10.1.249:43538</A>&gt;
</I>&gt;<i>     &gt; &lt;<A HREF="http://10.10.1.249:43538">http://10.10.1.249:43538</A>&gt; FD 13 flags=33
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.515 kid1| 11,2| client_side.cc(1310)
</I>&gt;<i>     &gt; parseHttpRequest: HTTP Client REQUEST:
</I>&gt;<i>     &gt; ---------
</I>&gt;<i>     &gt; GET /test.XXXXX.com/testFile &lt;<A HREF="http://test.XXXXX.com/testFile">http://test.XXXXX.com/testFile</A>&gt;
</I>&gt;<i>     &lt;<A HREF="http://test.XXXXX.com/testFile">http://test.XXXXX.com/testFile</A>&gt; HTTP/1.1
</I>&gt;<i>     &gt; Host: s3.amazonaws.com &lt;<A HREF="http://s3.amazonaws.com">http://s3.amazonaws.com</A>&gt;
</I>&gt;<i>     &lt;<A HREF="http://s3.amazonaws.com">http://s3.amazonaws.com</A>&gt;
</I>&gt;<i>     &gt; User-Agent: curl/7.61.1
</I>&gt;<i>     &gt; Accept: */*
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; ----------
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.520 kid1| 85,2| client_side_request.cc(753)
</I>&gt;<i>     &gt; clientAccessCheckDone: The request GET
</I>&gt;<i>     &gt; <A HREF="https://s3.amazonaws.com/test.XXXXX.com/testFile">https://s3.amazonaws.com/test.XXXXX.com/testFile</A> is ALLOWED; last ACL
</I>&gt;<i>     &gt; checked: allowed_http_sites
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.520 kid1| 85,2| client_side_request.cc(729)
</I>&gt;<i>     &gt; clientAccessCheck2: No adapted_http_access configuration. default:
</I>&gt;<i>     ALLOW
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.520 kid1| 85,2| client_side_request.cc(753)
</I>&gt;<i>     &gt; clientAccessCheckDone: The request GET
</I>&gt;<i>     &gt; <A HREF="https://s3.amazonaws.com/test.XXXXX.com/testFile">https://s3.amazonaws.com/test.XXXXX.com/testFile</A> is ALLOWED; last ACL
</I>&gt;<i>     &gt; checked: allowed_http_sites
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.520 kid1| 17,2| FwdState.cc(142) FwdState:
</I>&gt;<i>     &gt; Forwarding client request local=52.217.88.134:443
</I>&gt;<i>     &lt;<A HREF="http://52.217.88.134:443">http://52.217.88.134:443</A>&gt;
</I>&gt;<i>     &gt; &lt;<A HREF="http://52.217.88.134:443">http://52.217.88.134:443</A>&gt; remote=10.10.1.249:43538
</I>&gt;<i>     &lt;<A HREF="http://10.10.1.249:43538">http://10.10.1.249:43538</A>&gt;
</I>&gt;<i>     &gt; &lt;<A HREF="http://10.10.1.249:43538">http://10.10.1.249:43538</A>&gt; FD 13 flags=33,
</I>&gt;<i>     &gt; url=<A HREF="https://s3.amazonaws.com/test.XXXXX.com/testFile">https://s3.amazonaws.com/test.XXXXX.com/testFile</A>
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.520 kid1| 44,2| peer_select.cc(281)
</I>&gt;<i>     &gt; peerSelectDnsPaths: Find IP destination for:
</I>&gt;<i>     &gt; <A HREF="https://s3.amazonaws.com/test.XXXXX.com/testFile">https://s3.amazonaws.com/test.XXXXX.com/testFile</A>' via
</I>&gt;<i>     s3.amazonaws.com &lt;<A HREF="http://s3.amazonaws.com">http://s3.amazonaws.com</A>&gt;
</I>&gt;<i>     &gt; &lt;<A HREF="http://s3.amazonaws.com">http://s3.amazonaws.com</A>&gt;
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.520 kid1| 44,2| peer_select.cc(302)
</I>&gt;<i>     &gt; peerSelectDnsPaths: Found sources for
</I>&gt;<i>     &gt; '<A HREF="https://s3.amazonaws.com/test.XXXXX.com/testFile">https://s3.amazonaws.com/test.XXXXX.com/testFile</A>'
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.520 kid1| 44,2| peer_select.cc(303)
</I>&gt;<i>     &gt; peerSelectDnsPaths: &#160; always_direct = DENIED
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.520 kid1| 44,2| peer_select.cc(304)
</I>&gt;<i>     &gt; peerSelectDnsPaths: &#160; &#160;never_direct = DENIED
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.520 kid1| 44,2| peer_select.cc(312)
</I>&gt;<i>     &gt; peerSelectDnsPaths: &#160; &#160; &#160; &#160; &#160;PINNED = local=0.0.0.0
</I>&gt;<i>     &gt; remote=52.216.80.75:443 &lt;<A HREF="http://52.216.80.75:443">http://52.216.80.75:443</A>&gt;
</I>&gt;<i>     &lt;<A HREF="http://52.216.80.75:443">http://52.216.80.75:443</A>&gt; flags=1
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.521 kid1| 44,2| peer_select.cc(310)
</I>&gt;<i>     &gt; peerSelectDnsPaths: &#160; &#160;ORIGINAL_DST = local=0.0.0.0
</I>&gt;<i>     &gt; remote=52.217.88.134:443 &lt;<A HREF="http://52.217.88.134:443">http://52.217.88.134:443</A>&gt;
</I>&gt;<i>     &lt;<A HREF="http://52.217.88.134:443">http://52.217.88.134:443</A>&gt; flags=1
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.521 kid1| 44,2| peer_select.cc(317)
</I>&gt;<i>     &gt; peerSelectDnsPaths: &#160; &#160; &#160; &#160;timedout = 0
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.521 kid1| 37,2| IcmpSquid.cc(91) SendEcho: to
</I>&gt;<i>     &gt; 52.216.80.75, opcode 3, len 16
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.521| 42,2| IcmpPinger.cc(205) Recv: &#160;Pass
</I>&gt;<i>     &gt; 52.216.80.75 off to ICMPv4 module.
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.521| 42,2| Icmp.cc(95) Log: pingerLog:
</I>&gt;<i>     &gt; 1611941462.521215 52.216.80.75 &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;32
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.521 kid1| 11,2| http.cc(2260) sendRequest: HTTP
</I>&gt;<i>     &gt; Server local=10.10.0.135:36120 &lt;<A HREF="http://10.10.0.135:36120">http://10.10.0.135:36120</A>&gt;
</I>&gt;<i>     &lt;<A HREF="http://10.10.0.135:36120">http://10.10.0.135:36120</A>&gt;
</I>&gt;<i>     &gt; remote=52.217.88.134:443 &lt;<A HREF="http://52.217.88.134:443">http://52.217.88.134:443</A>&gt;
</I>&gt;<i>     &lt;<A HREF="http://52.217.88.134:443">http://52.217.88.134:443</A>&gt; FD 15 flags=1
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.521 kid1| 11,2| http.cc(2261) sendRequest: HTTP
</I>&gt;<i>     &gt; Server REQUEST:
</I>&gt;<i>     &gt; ---------
</I>&gt;<i>     &gt; GET /test.XXXXX.com/testFile &lt;<A HREF="http://test.XXXXX.com/testFile">http://test.XXXXX.com/testFile</A>&gt;
</I>&gt;<i>     &lt;<A HREF="http://test.XXXXX.com/testFile">http://test.XXXXX.com/testFile</A>&gt; HTTP/1.1
</I>&gt;<i>     &gt; User-Agent: curl/7.61.1
</I>&gt;<i>     &gt; Accept: */*
</I>&gt;<i>     &gt; Host: s3.amazonaws.com &lt;<A HREF="http://s3.amazonaws.com">http://s3.amazonaws.com</A>&gt;
</I>&gt;<i>     &lt;<A HREF="http://s3.amazonaws.com">http://s3.amazonaws.com</A>&gt;
</I>&gt;<i>     &gt; Via: 1.1 squid (squid/4.9)
</I>&gt;<i>     &gt; X-Forwarded-For: 10.10.1.249
</I>&gt;<i>     &gt; Cache-Control: max-age=259200
</I>&gt;<i>     &gt; Connection: keep-alive
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; ----------
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.521| 42,2| IcmpPinger.cc(218) SendResult: return
</I>&gt;<i>     &gt; result to squid. len=7997
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.521| 42,2| Icmp.cc(95) Log: pingerLog:
</I>&gt;<i>     &gt; 1611941462.521561 52.216.80.75 &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;0 Echo
</I>&gt;<i>     &gt; Reply &#160; &#160; &#160;0ms 5 hops
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.536 kid1| ctx: enter level &#160;0:
</I>&gt;<i>     &gt; '<A HREF="https://s3.amazonaws.com/test.XXXXX.com/testFile">https://s3.amazonaws.com/test.XXXXX.com/testFile</A>'
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.536 kid1| 11,2| http.cc(719) processReplyHeader:
</I>&gt;<i>     &gt; HTTP Server local=10.10.0.135:36120 &lt;<A HREF="http://10.10.0.135:36120">http://10.10.0.135:36120</A>&gt;
</I>&gt;<i>     &lt;<A HREF="http://10.10.0.135:36120">http://10.10.0.135:36120</A>&gt;
</I>&gt;<i>     &gt; remote=52.217.88.134:443 &lt;<A HREF="http://52.217.88.134:443">http://52.217.88.134:443</A>&gt;
</I>&gt;<i>     &lt;<A HREF="http://52.217.88.134:443">http://52.217.88.134:443</A>&gt; FD 15 flags=1
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.536 kid1| 11,2| http.cc(723) processReplyHeader:
</I>&gt;<i>     &gt; HTTP Server RESPONSE:
</I>&gt;<i>     &gt; ---------
</I>&gt;<i>     &gt; HTTP/1.1 200 OK
</I>&gt;<i>     &gt; x-amz-id-2:
</I>&gt;<i>     &gt;
</I>&gt;<i>     hZbtwwRSyeN8TkE+V7V9iUuEEMwyXLVblsFhmazae3kqofWK5EuQf+dH6rU3CF8hDUbj8YcMyw4=
</I>&gt;<i>     &gt; x-amz-request-id: CD6D86AAA3FDA43F
</I>&gt;<i>     &gt; Date: Fri, 29 Jan 2021 17:31:03 GMT
</I>&gt;<i>     &gt; Last-Modified: Fri, 29 Jan 2021 17:27:47 GMT
</I>&gt;<i>     &gt; ETag: &quot;eb1a3227cdc3fedbaec2fe38bf6c044a&quot;
</I>&gt;<i>     &gt; Accept-Ranges: bytes
</I>&gt;<i>     &gt; Content-Type: binary/octet-stream
</I>&gt;<i>     &gt; Content-Length: 8
</I>&gt;<i>     &gt; Server: AmazonS3
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; ----------
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.536 kid1| ctx: exit level &#160;0
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.537 kid1| 20,2| store.cc(986) checkCachable:
</I>&gt;<i>     &gt; StoreEntry::checkCachable: NO: not cachable
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.537 kid1| 20,2| store.cc(986) checkCachable:
</I>&gt;<i>     &gt; StoreEntry::checkCachable: NO: not cachable
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.537 kid1| 88,2| client_side_reply.cc(2061)
</I>&gt;<i>     &gt; processReplyAccessResult: The reply for GET
</I>&gt;<i>     &gt; <A HREF="https://s3.amazonaws.com/test.XXXXX.com/testFile">https://s3.amazonaws.com/test.XXXXX.com/testFile</A> is ALLOWED,
</I>&gt;<i>     because it
</I>&gt;<i>     &gt; matched allowed_http_sites
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.537 kid1| 11,2| Stream.cc(266) sendStartOfMessage:
</I>&gt;<i>     &gt; HTTP Client local=52.217.88.134:443 &lt;<A HREF="http://52.217.88.134:443">http://52.217.88.134:443</A>&gt;
</I>&gt;<i>     &lt;<A HREF="http://52.217.88.134:443">http://52.217.88.134:443</A>&gt;
</I>&gt;<i>     &gt; remote=10.10.1.249:43538 &lt;<A HREF="http://10.10.1.249:43538">http://10.10.1.249:43538</A>&gt;
</I>&gt;<i>     &lt;<A HREF="http://10.10.1.249:43538">http://10.10.1.249:43538</A>&gt; FD 13 flags=33
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.537 kid1| 11,2| Stream.cc(267) sendStartOfMessage:
</I>&gt;<i>     &gt; HTTP Client REPLY:
</I>&gt;<i>     &gt; ---------
</I>&gt;<i>     &gt; HTTP/1.1 200 OK
</I>&gt;<i>     &gt; x-amz-id-2:
</I>&gt;<i>     &gt;
</I>&gt;<i>     hZbtwwRSyeN8TkE+V7V9iUuEEMwyXLVblsFhmazae3kqofWK5EuQf+dH6rU3CF8hDUbj8YcMyw4=
</I>&gt;<i>     &gt; x-amz-request-id: CD6D86AAA3FDA43F
</I>&gt;<i>     &gt; Date: Fri, 29 Jan 2021 17:31:03 GMT
</I>&gt;<i>     &gt; Last-Modified: Fri, 29 Jan 2021 17:27:47 GMT
</I>&gt;<i>     &gt; ETag: &quot;eb1a3227cdc3fedbaec2fe38bf6c044a&quot;
</I>&gt;<i>     &gt; Accept-Ranges: bytes
</I>&gt;<i>     &gt; Content-Type: binary/octet-stream
</I>&gt;<i>     &gt; Content-Length: 8
</I>&gt;<i>     &gt; Server: AmazonS3
</I>&gt;<i>     &gt; X-Cache: MISS from squid
</I>&gt;<i>     &gt; X-Cache-Lookup: MISS from squid:3128
</I>&gt;<i>     &gt; Via: 1.1 squid (squid/4.9)
</I>&gt;<i>     &gt; Connection: keep-alive
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; ----------
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.537 kid1| 20,2| store.cc(986) checkCachable:
</I>&gt;<i>     &gt; StoreEntry::checkCachable: NO: not cachable
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.537 kid1| 20,2| store.cc(986) checkCachable:
</I>&gt;<i>     &gt; StoreEntry::checkCachable: NO: not cachable
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.537 kid1| 20,2| store.cc(986) checkCachable:
</I>&gt;<i>     &gt; StoreEntry::checkCachable: NO: not cachable
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.537 kid1| 20,2| store.cc(986) checkCachable:
</I>&gt;<i>     &gt; StoreEntry::checkCachable: NO: not cachable
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.538 kid1| 33,2| client_side.cc(582) swanSong:
</I>&gt;<i>     &gt; local=52.217.88.134:443 &lt;<A HREF="http://52.217.88.134:443">http://52.217.88.134:443</A>&gt;
</I>&gt;<i>     &lt;<A HREF="http://52.217.88.134:443">http://52.217.88.134:443</A>&gt;
</I>&gt;<i>     &gt; remote=10.10.1.249:43538 &lt;<A HREF="http://10.10.1.249:43538">http://10.10.1.249:43538</A>&gt;
</I>&gt;<i>     &lt;<A HREF="http://10.10.1.249:43538">http://10.10.1.249:43538</A>&gt; flags=33
</I>&gt;<i>     &gt; 2021/01/29 17:31:02.538 kid1| 20,2| store.cc(986) checkCachable:
</I>&gt;<i>     &gt; StoreEntry::checkCachable: NO: not cachable
</I>&gt;<i>     &gt;
</I>&gt;<i>     --------------------------------------------------------------------------------------------------------------------------------
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; On the other hand, with squidclient from the Squid itself, access log
</I>&gt;<i>     &gt; (the first run, when nothing is cached for the new test file yet):
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;
</I>&gt;<i>     ------------------------------------------------------------------------------------------------------------------
</I>&gt;<i>     &gt; 1611942152.986 &#160; &#160; 29 127.0.0.1 TCP_MISS/200 483 GET
</I>&gt;<i>     &gt; <A HREF="https://s3.amazonaws.com/test.dvabearqloza.com/testFile">https://s3.amazonaws.com/test.dvabearqloza.com/testFile</A> -
</I>&gt;<i>     &gt; HIER_DIRECT/52.216.226.131 &lt;<A HREF="http://52.216.226.131">http://52.216.226.131</A>&gt;
</I>&gt;<i>     &lt;<A HREF="http://52.216.226.131">http://52.216.226.131</A>&gt; binary/octet-stream
</I>&gt;<i>     &gt;
</I>&gt;<i>     ------------------------------------------------------------------------------------------------------------------
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; And cache log:
</I>&gt;<i>     &gt;
</I>&gt;<i>     ------------------------------------------------------------------------------------------------------------------
</I>&gt;<i>     &gt; 2021/01/29 17:42:32.956 kid1| 5,2| TcpAcceptor.cc(312) acceptNext:
</I>&gt;<i>     &gt; connection on local=[::]:3128 remote=[::] FD 28 flags=9
</I>&gt;<i>     &gt; 2021/01/29 17:42:32.957 kid1| 11,2| client_side.cc(1306)
</I>&gt;<i>     &gt; parseHttpRequest: HTTP Client local=127.0.0.1:3128
</I>&gt;<i>     &lt;<A HREF="http://127.0.0.1:3128">http://127.0.0.1:3128</A>&gt;
</I>&gt;<i>     &gt; &lt;<A HREF="http://127.0.0.1:3128">http://127.0.0.1:3128</A>&gt; remote=127.0.0.1:50584
</I>&gt;<i>     &lt;<A HREF="http://127.0.0.1:50584">http://127.0.0.1:50584</A>&gt; &lt;<A HREF="http://127.0.0.1:50584">http://127.0.0.1:50584</A>&gt;
</I>&gt;<i>     &gt; FD 13 flags=1
</I>&gt;<i>     &gt; 2021/01/29 17:42:32.957 kid1| 11,2| client_side.cc(1310)
</I>&gt;<i>     &gt; parseHttpRequest: HTTP Client REQUEST:
</I>&gt;<i>     &gt; ---------
</I>&gt;<i>     &gt; GET <A HREF="https://s3.amazonaws.com/test.XXXXX.com/testFile">https://s3.amazonaws.com/test.XXXXX.com/testFile</A> HTTP/1.0
</I>&gt;<i>     &gt; Host: s3.amazonaws.com &lt;<A HREF="http://s3.amazonaws.com">http://s3.amazonaws.com</A>&gt;
</I>&gt;<i>     &lt;<A HREF="http://s3.amazonaws.com">http://s3.amazonaws.com</A>&gt;
</I>&gt;<i>     &gt; User-Agent: squidclient/4.9
</I>&gt;<i>     &gt; Accept: */*
</I>&gt;<i>     &gt; Connection: close
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; ----------
</I>&gt;<i>     &gt; 2021/01/29 17:42:32.957 kid1| 85,2| client_side_request.cc(753)
</I>&gt;<i>     &gt; clientAccessCheckDone: The request GET
</I>&gt;<i>     &gt; <A HREF="https://s3.amazonaws.com/test.XXXXX.com/testFile">https://s3.amazonaws.com/test.XXXXX.com/testFile</A> is ALLOWED; last ACL
</I>&gt;<i>     &gt; checked: allowed_http_sites
</I>&gt;<i>     &gt; 2021/01/29 17:42:32.957 kid1| 85,2| client_side_request.cc(729)
</I>&gt;<i>     &gt; clientAccessCheck2: No adapted_http_access configuration. default:
</I>&gt;<i>     ALLOW
</I>&gt;<i>     &gt; 2021/01/29 17:42:32.957 kid1| 85,2| client_side_request.cc(753)
</I>&gt;<i>     &gt; clientAccessCheckDone: The request GET
</I>&gt;<i>     &gt; <A HREF="https://s3.amazonaws.com/test.XXXXX.com/testFile">https://s3.amazonaws.com/test.XXXXX.com/testFile</A> is ALLOWED; last ACL
</I>&gt;<i>     &gt; checked: allowed_http_sites
</I>&gt;<i>     &gt; 2021/01/29 17:42:32.957 kid1| 17,2| FwdState.cc(142) FwdState:
</I>&gt;<i>     &gt; Forwarding client request local=127.0.0.1:3128
</I>&gt;<i>     &lt;<A HREF="http://127.0.0.1:3128">http://127.0.0.1:3128</A>&gt; &lt;<A HREF="http://127.0.0.1:3128">http://127.0.0.1:3128</A>&gt;
</I>&gt;<i>     &gt; remote=127.0.0.1:50584 &lt;<A HREF="http://127.0.0.1:50584">http://127.0.0.1:50584</A>&gt;
</I>&gt;<i>     &lt;<A HREF="http://127.0.0.1:50584">http://127.0.0.1:50584</A>&gt; FD 13 flags=1,
</I>&gt;<i>     &gt; url=<A HREF="https://s3.amazonaws.com/test.XXXXX.com/testFile">https://s3.amazonaws.com/test.XXXXX.com/testFile</A>
</I>&gt;<i>     &gt; 2021/01/29 17:42:32.957 kid1| 44,2| peer_select.cc(281)
</I>&gt;<i>     &gt; peerSelectDnsPaths: Find IP destination for:
</I>&gt;<i>     &gt; <A HREF="https://s3.amazonaws.com/test.XXXXX.com/testFile">https://s3.amazonaws.com/test.XXXXX.com/testFile</A>' via
</I>&gt;<i>     s3.amazonaws.com &lt;<A HREF="http://s3.amazonaws.com">http://s3.amazonaws.com</A>&gt;
</I>&gt;<i>     &gt; &lt;<A HREF="http://s3.amazonaws.com">http://s3.amazonaws.com</A>&gt;
</I>&gt;<i>     &gt; 2021/01/29 17:42:32.959 kid1| 44,2| peer_select.cc(302)
</I>&gt;<i>     &gt; peerSelectDnsPaths: Found sources for
</I>&gt;<i>     &gt; '<A HREF="https://s3.amazonaws.com/test.XXXXX.com/testFile">https://s3.amazonaws.com/test.XXXXX.com/testFile</A>'
</I>&gt;<i>     &gt; 2021/01/29 17:42:32.959 kid1| 44,2| peer_select.cc(303)
</I>&gt;<i>     &gt; peerSelectDnsPaths: &#160; always_direct = DENIED
</I>&gt;<i>     &gt; 2021/01/29 17:42:32.959 kid1| 44,2| peer_select.cc(304)
</I>&gt;<i>     &gt; peerSelectDnsPaths: &#160; &#160;never_direct = DENIED
</I>&gt;<i>     &gt; 2021/01/29 17:42:32.959 kid1| 44,2| peer_select.cc(308)
</I>&gt;<i>     &gt; peerSelectDnsPaths: &#160; &#160; &#160; &#160; &#160;DIRECT = local=0.0.0.0
</I>&gt;<i>     &gt; remote=52.216.226.131:443 &lt;<A HREF="http://52.216.226.131:443">http://52.216.226.131:443</A>&gt;
</I>&gt;<i>     &lt;<A HREF="http://52.216.226.131:443">http://52.216.226.131:443</A>&gt; flags=1
</I>&gt;<i>     &gt; 2021/01/29 17:42:32.959 kid1| 44,2| peer_select.cc(317)
</I>&gt;<i>     &gt; peerSelectDnsPaths: &#160; &#160; &#160; &#160;timedout = 0
</I>&gt;<i>     &gt; 2021/01/29 17:42:32.961 kid1| 83,2| bio.cc(316) readAndParse: parsing
</I>&gt;<i>     &gt; error on FD 15: check failed: state &lt; atHelloReceived
</I>&gt;<i>     &gt; &#160; &#160; exception location: Handshake.cc(324) parseHandshakeMessage
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; 2021/01/29 17:42:32.961 kid1| Error parsing SSL Server Hello
</I>&gt;<i>     Message on
</I>&gt;<i>     &gt; FD 15
</I>&gt;<i>     &gt; 2021/01/29 17:42:32.965 kid1| 37,2| IcmpSquid.cc(91) SendEcho: to
</I>&gt;<i>     &gt; 52.216.226.131, opcode 3, len 16
</I>&gt;<i>     &gt; 2021/01/29 17:42:32.965| 42,2| IcmpPinger.cc(205) Recv: &#160;Pass
</I>&gt;<i>     &gt; 52.216.226.131 off to ICMPv4 module.
</I>&gt;<i>     &gt; 2021/01/29 17:42:32.965| 42,2| Icmp.cc(95) Log: pingerLog:
</I>&gt;<i>     &gt; 1611942152.965403 52.216.226.131 &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;32
</I>&gt;<i>     &gt; 2021/01/29 17:42:32.965 kid1| 11,2| http.cc(2260) sendRequest: HTTP
</I>&gt;<i>     &gt; Server local=10.10.0.135:33004 &lt;<A HREF="http://10.10.0.135:33004">http://10.10.0.135:33004</A>&gt;
</I>&gt;<i>     &lt;<A HREF="http://10.10.0.135:33004">http://10.10.0.135:33004</A>&gt;
</I>&gt;<i>     &gt; remote=52.216.226.131:443 &lt;<A HREF="http://52.216.226.131:443">http://52.216.226.131:443</A>&gt;
</I>&gt;<i>     &lt;<A HREF="http://52.216.226.131:443">http://52.216.226.131:443</A>&gt; FD 15 flags=1
</I>&gt;<i>     &gt; 2021/01/29 17:42:32.965 kid1| 11,2| http.cc(2261) sendRequest: HTTP
</I>&gt;<i>     &gt; Server REQUEST:
</I>&gt;<i>     &gt; ---------
</I>&gt;<i>     &gt; GET /test.XXXXX.com/testFile &lt;<A HREF="http://test.XXXXX.com/testFile">http://test.XXXXX.com/testFile</A>&gt;
</I>&gt;<i>     &lt;<A HREF="http://test.XXXXX.com/testFile">http://test.XXXXX.com/testFile</A>&gt; HTTP/1.1
</I>&gt;<i>     &gt; User-Agent: squidclient/4.9
</I>&gt;<i>     &gt; Accept: */*
</I>&gt;<i>     &gt; Host: s3.amazonaws.com &lt;<A HREF="http://s3.amazonaws.com">http://s3.amazonaws.com</A>&gt;
</I>&gt;<i>     &lt;<A HREF="http://s3.amazonaws.com">http://s3.amazonaws.com</A>&gt;
</I>&gt;<i>     &gt; Via: 1.0 squid (squid/4.9)
</I>&gt;<i>     &gt; X-Forwarded-For: 127.0.0.1
</I>&gt;<i>     &gt; Cache-Control: max-age=259200
</I>&gt;<i>     &gt; Connection: keep-alive
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; ----------
</I>&gt;<i>     &gt; 2021/01/29 17:42:32.966| 42,2| IcmpPinger.cc(218) SendResult: return
</I>&gt;<i>     &gt; result to squid. len=7997
</I>&gt;<i>     &gt; 2021/01/29 17:42:32.966| 42,2| Icmp.cc(95) Log: pingerLog:
</I>&gt;<i>     &gt; 1611942152.966514 52.216.226.131 &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;0 Echo
</I>&gt;<i>     &gt; Reply &#160; &#160; &#160;1ms 6 hops
</I>&gt;<i>     &gt; 2021/01/29 17:42:32.985 kid1| ctx: enter level &#160;0:
</I>&gt;<i>     &gt; '<A HREF="https://s3.amazonaws.com/test.XXXXX.com/testFile">https://s3.amazonaws.com/test.XXXXX.com/testFile</A>'
</I>&gt;<i>     &gt; 2021/01/29 17:42:32.985 kid1| 11,2| http.cc(719) processReplyHeader:
</I>&gt;<i>     &gt; HTTP Server local=10.10.0.135:33004 &lt;<A HREF="http://10.10.0.135:33004">http://10.10.0.135:33004</A>&gt;
</I>&gt;<i>     &lt;<A HREF="http://10.10.0.135:33004">http://10.10.0.135:33004</A>&gt;
</I>&gt;<i>     &gt; remote=52.216.226.131:443 &lt;<A HREF="http://52.216.226.131:443">http://52.216.226.131:443</A>&gt;
</I>&gt;<i>     &lt;<A HREF="http://52.216.226.131:443">http://52.216.226.131:443</A>&gt; FD 15 flags=1
</I>&gt;<i>     &gt; 2021/01/29 17:42:32.985 kid1| 11,2| http.cc(723) processReplyHeader:
</I>&gt;<i>     &gt; HTTP Server RESPONSE:
</I>&gt;<i>     &gt; ---------
</I>&gt;<i>     &gt; HTTP/1.1 200 OK
</I>&gt;<i>     &gt; x-amz-id-2:
</I>&gt;<i>     &gt;
</I>&gt;<i>     z//C9o0g1wI5ep44MaSBbU7ptfDlvOjTZLIBYSpaI8+h8oxt607nyA9zumm8eEk+wTJb3jRD7wU=
</I>&gt;<i>     &gt; x-amz-request-id: A6E14CC59FE63894
</I>&gt;<i>     &gt; Date: Fri, 29 Jan 2021 17:42:33 GMT
</I>&gt;<i>     &gt; Last-Modified: Fri, 29 Jan 2021 17:27:47 GMT
</I>&gt;<i>     &gt; ETag: &quot;eb1a3227cdc3fedbaec2fe38bf6c044a&quot;
</I>&gt;<i>     &gt; Accept-Ranges: bytes
</I>&gt;<i>     &gt; Content-Type: binary/octet-stream
</I>&gt;<i>     &gt; Content-Length: 8
</I>&gt;<i>     &gt; Server: AmazonS3
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; ----------
</I>&gt;<i>     &gt; 2021/01/29 17:42:32.986 kid1| ctx: exit level &#160;0
</I>&gt;<i>     &gt; 2021/01/29 17:42:32.986 kid1| 88,2| client_side_reply.cc(2061)
</I>&gt;<i>     &gt; processReplyAccessResult: The reply for GET
</I>&gt;<i>     &gt; <A HREF="https://s3.amazonaws.com/test.XXXXX.com/testFile">https://s3.amazonaws.com/test.XXXXX.com/testFile</A> is ALLOWED,
</I>&gt;<i>     because it
</I>&gt;<i>     &gt; matched allowed_http_sites
</I>&gt;<i>     &gt; 2021/01/29 17:42:32.986 kid1| 11,2| Stream.cc(266) sendStartOfMessage:
</I>&gt;<i>     &gt; HTTP Client local=127.0.0.1:3128 &lt;<A HREF="http://127.0.0.1:3128">http://127.0.0.1:3128</A>&gt;
</I>&gt;<i>     &lt;<A HREF="http://127.0.0.1:3128">http://127.0.0.1:3128</A>&gt;
</I>&gt;<i>     &gt; remote=127.0.0.1:50584 &lt;<A HREF="http://127.0.0.1:50584">http://127.0.0.1:50584</A>&gt;
</I>&gt;<i>     &lt;<A HREF="http://127.0.0.1:50584">http://127.0.0.1:50584</A>&gt; FD 13 flags=1
</I>&gt;<i>     &gt; 2021/01/29 17:42:32.986 kid1| 11,2| Stream.cc(267) sendStartOfMessage:
</I>&gt;<i>     &gt; HTTP Client REPLY:
</I>&gt;<i>     &gt; ---------
</I>&gt;<i>     &gt; HTTP/1.1 200 OK
</I>&gt;<i>     &gt; x-amz-id-2:
</I>&gt;<i>     &gt;
</I>&gt;<i>     z//C9o0g1wI5ep44MaSBbU7ptfDlvOjTZLIBYSpaI8+h8oxt607nyA9zumm8eEk+wTJb3jRD7wU=
</I>&gt;<i>     &gt; x-amz-request-id: A6E14CC59FE63894
</I>&gt;<i>     &gt; Date: Fri, 29 Jan 2021 17:42:33 GMT
</I>&gt;<i>     &gt; Last-Modified: Fri, 29 Jan 2021 17:27:47 GMT
</I>&gt;<i>     &gt; ETag: &quot;eb1a3227cdc3fedbaec2fe38bf6c044a&quot;
</I>&gt;<i>     &gt; Accept-Ranges: bytes
</I>&gt;<i>     &gt; Content-Type: binary/octet-stream
</I>&gt;<i>     &gt; Content-Length: 8
</I>&gt;<i>     &gt; Server: AmazonS3
</I>&gt;<i>     &gt; X-Cache: MISS from squid
</I>&gt;<i>     &gt; X-Cache-Lookup: MISS from squid:3128
</I>&gt;<i>     &gt; Via: 1.1 squid (squid/4.9)
</I>&gt;<i>     &gt; Connection: close
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; ----------
</I>&gt;<i>     &gt; 2021/01/29 17:42:32.986 kid1| 20,2| store_io.cc(43) storeCreate:
</I>&gt;<i>     &gt; storeCreate: Selected dir 0 for e:=sp2V/0x1f582b0*4
</I>&gt;<i>     &gt; 2021/01/29 17:42:32.986 kid1| 33,2| client_side.cc(891) kick:
</I>&gt;<i>     &gt; local=127.0.0.1:3128 &lt;<A HREF="http://127.0.0.1:3128">http://127.0.0.1:3128</A>&gt;
</I>&gt;<i>     &lt;<A HREF="http://127.0.0.1:3128">http://127.0.0.1:3128</A>&gt; remote=127.0.0.1:50584 &lt;<A HREF="http://127.0.0.1:50584">http://127.0.0.1:50584</A>&gt;
</I>&gt;<i>     &gt; &lt;<A HREF="http://127.0.0.1:50584">http://127.0.0.1:50584</A>&gt; flags=1 Connection was closed
</I>&gt;<i>     &gt; 2021/01/29 17:42:32.986 kid1| 33,2| client_side.cc(582) swanSong:
</I>&gt;<i>     &gt; local=127.0.0.1:3128 &lt;<A HREF="http://127.0.0.1:3128">http://127.0.0.1:3128</A>&gt;
</I>&gt;<i>     &lt;<A HREF="http://127.0.0.1:3128">http://127.0.0.1:3128</A>&gt; remote=127.0.0.1:50584 &lt;<A HREF="http://127.0.0.1:50584">http://127.0.0.1:50584</A>&gt;
</I>&gt;<i>     &gt; &lt;<A HREF="http://127.0.0.1:50584">http://127.0.0.1:50584</A>&gt; flags=1
</I>&gt;<i>     &gt;
</I>&gt;<i>     ------------------------------------------------------------------------------------------------------------------
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; The first thing that caught my attention was the line:
</I>&gt;<i>     &gt; &quot;checkCachable: StoreEntry::checkCachable: NO: not cachable&quot;, that
</I>&gt;<i>     &gt; appears in the logs when server tries to go through proxy.
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; Any idea what might be the issue overall?
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; Thanks again!!!
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; On Fri, Jan 29, 2021 at 5:40 PM Alex Rousskov
</I>&gt;<i>     &gt; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt;
</I>&gt;<i>     &gt; &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt;&gt;&gt; wrote:
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;On 1/28/21 1:34 PM, Milos Dodic wrote:
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; I have noticed that the test server also doesn't cache anything
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; So if I try to go for a file in S3, it says MISS, and after
</I>&gt;<i>     that, MISS
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; again, and I see no new objects in cache being created.
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; If I try the same thing from the proxy itself, I get the
</I>&gt;<i>     MISS, and the
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; object gets cached, as it should.
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; When I go back to the test server, and try again, it sees the
</I>&gt;<i>     &gt;&#160; &#160; &#160;object in
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; cache and returns TCP_MEM_HIT/200 instead.
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;Without more details, I can only speculate that the client
</I>&gt;<i>     running on
</I>&gt;<i>     &gt;&#160; &#160; &#160;the test server sends different HTTP request headers than the
</I>&gt;<i>     client
</I>&gt;<i>     &gt;&#160; &#160; &#160;running on the proxy itself. You can see the headers in
</I>&gt;<i>     cache.log if you
</I>&gt;<i>     &gt;&#160; &#160; &#160;set debug_options to ALL,2. If you are not sure whether they
</I>&gt;<i>     are the
</I>&gt;<i>     &gt;&#160; &#160; &#160;same, please share those logs. They will also contain response
</I>&gt;<i>     headers
</I>&gt;<i>     &gt;&#160; &#160; &#160;and other potentially useful details.
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;If the request headers are the same in both tests, then I would
</I>&gt;<i>     &gt;&#160; &#160; &#160;recommend sharing compressed ALL,7 or ALL,9 debugging logs of both
</I>&gt;<i>     &gt;&#160; &#160; &#160;successful and unsuccessful tests (four transactions, two
</I>&gt;<i>     logs) for
</I>&gt;<i>     &gt;&#160; &#160; &#160;analysis. Do not use sensitive data for these tests.
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160;
</I>&gt;<i>     &#160;<A HREF="https://wiki.squid-cache.org/SquidFaq/BugReporting#Debugging_a_single_transaction">https://wiki.squid-cache.org/SquidFaq/BugReporting#Debugging_a_single_transaction</A>
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;Alex.
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; This is the entire config file:
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; visible_hostname squid
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; cache_dir ufs /test/cache/squid 10000 16 256
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; http_access allow localhost
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; http_access alow all
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; http_port 3128
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; http_port 3129 intercept
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; acl allowed_http_sites dstdomain .amazonaws.com
</I>&gt;<i>     &lt;<A HREF="http://amazonaws.com">http://amazonaws.com</A>&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&lt;<A HREF="http://amazonaws.com">http://amazonaws.com</A>&gt; &lt;<A HREF="http://amazonaws.com">http://amazonaws.com</A>&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; http_access allow allowed_http_sites
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; https_port 3130 cert=/etc/squid/ssl/squid.pem ssl-bump intercept
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; acl SSL_port port 443
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; http_access allow SSL_port
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; acl allowed_https_sites ssl::server_name .amazonaws.com
</I>&gt;<i>     &lt;<A HREF="http://amazonaws.com">http://amazonaws.com</A>&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&lt;<A HREF="http://amazonaws.com">http://amazonaws.com</A>&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; &lt;<A HREF="http://amazonaws.com">http://amazonaws.com</A>&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; ssl_bump stare all
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; ssl_bump bump allowed_https_sites
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; ssl_bump terminate all
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt; On Tue, Jan 26, 2021 at 9:14 PM Alex Rousskov wrote:
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&#160; &#160; &#160;On 1/26/21 1:54 PM, Milos Dodic wrote:
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&#160; &#160; &#160;&gt; when the test server goes for a picture I have stored
</I>&gt;<i>     &gt;&#160; &#160; &#160;somewhere in
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&#160; &#160; &#160;&gt; the cloud, the squid access log shows
</I>&gt;<i>     &quot;TCP_TUNNEL/200&quot;. But
</I>&gt;<i>     &gt;&#160; &#160; &#160;when I
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&#160; &#160; &#160;&gt; try from the proxy itself with squidclient tool, I get
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&#160; &#160; &#160;&gt; &quot;TCP_MEM_HIT/200&quot;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&#160; &#160; &#160;Given the very limited information you have provided, I am
</I>&gt;<i>     &gt;&#160; &#160; &#160;guessing that
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&#160; &#160; &#160;* the primary tests opens a CONNECT tunnel through Squid
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&#160; &#160; &#160;* the squidclient test sends a plain text HTTP request
</I>&gt;<i>     to Squid
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&#160; &#160; &#160;The final origin server destination may be the same in both
</I>&gt;<i>     &gt;&#160; &#160; &#160;tests, but
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&#160; &#160; &#160;the two transactions are completely different from Squid
</I>&gt;<i>     point
</I>&gt;<i>     &gt;&#160; &#160; &#160;of view.
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&#160; &#160; &#160;&gt; ssl_bump peek step1 all
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&#160; &#160; &#160;&gt; ssl_bump peek step2 allowed_https_sites
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&#160; &#160; &#160;&gt; ssl_bump splice step3 allowed_https_sites
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&#160; &#160; &#160;&gt; ssl_bump terminate step3 all
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&#160; &#160; &#160;AFAICT, this configuration is splicing or terminating
</I>&gt;<i>     all TLS
</I>&gt;<i>     &gt;&#160; &#160; &#160;traffic.
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&#160; &#160; &#160;No bumping at all. If you want your Squid to bump TLS
</I>&gt;<i>     tunnels,
</I>&gt;<i>     &gt;&#160; &#160; &#160;then you
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&#160; &#160; &#160;have to have at least one &quot;bump&quot; rule!
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&#160; &#160; &#160;I do not know what your overall SslBump needs are, but
</I>&gt;<i>     perhaps
</I>&gt;<i>     &gt;&#160; &#160; &#160;you meant
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&#160; &#160; &#160;something like the following?
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&#160; &#160; &#160;&#160; &#160; acl shouldBeBumped ssl::server_name .amazonaws.com
</I>&gt;<i>     &lt;<A HREF="http://amazonaws.com">http://amazonaws.com</A>&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&lt;<A HREF="http://amazonaws.com">http://amazonaws.com</A>&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&#160; &#160; &#160;&lt;<A HREF="http://amazonaws.com">http://amazonaws.com</A>&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&#160; &#160; &#160;&#160; &#160; ssl_bump stare all
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&#160; &#160; &#160;&#160; &#160; ssl_bump bump shouldBeBumped
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&#160; &#160; &#160;&#160; &#160; ssl_bump terminate all
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&#160; &#160; &#160;Please do not use the configuration above until you
</I>&gt;<i>     understand
</I>&gt;<i>     &gt;&#160; &#160; &#160;what it
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&#160; &#160; &#160;does. Please see
</I>&gt;<i>     &gt;&#160; &#160; &#160;<A HREF="https://wiki.squid-cache.org/Features/SslPeekAndSplice">https://wiki.squid-cache.org/Features/SslPeekAndSplice</A>
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&#160; &#160; &#160;for details.
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&#160; &#160; &#160;Depending on your environment, the http_access rules may
</I>&gt;<i>     need
</I>&gt;<i>     &gt;&#160; &#160; &#160;to be
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&#160; &#160; &#160;adjusted to allow CONNECT requests (to TLS-safe ports) to IP
</I>&gt;<i>     &gt;&#160; &#160; &#160;addresses
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&#160; &#160; &#160;that do not result in .amazonaws.com
</I>&gt;<i>     &lt;<A HREF="http://amazonaws.com">http://amazonaws.com</A>&gt; &lt;<A HREF="http://amazonaws.com">http://amazonaws.com</A>&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&lt;<A HREF="http://amazonaws.com">http://amazonaws.com</A>&gt; in
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&#160; &#160; &#160;reverse DNS lookups.
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&#160; &#160; &#160;HTH,
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;&#160; &#160; &#160;Alex.
</I>&gt;<i>     &gt;&#160; &#160; &#160;&gt;
</I>&gt;<i>     &gt;
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="023280.html">[squid-users] Fixing Squid configuration for caching proxy?
</A></li>
	<LI>Next message (by thread): <A HREF="023282.html">[squid-users] Fixing Squid configuration for caching proxy?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23281">[ date ]</a>
              <a href="thread.html#23281">[ thread ]</a>
              <a href="subject.html#23281">[ subject ]</a>
              <a href="author.html#23281">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
