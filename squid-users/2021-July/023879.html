<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] TPROXY Error
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TPROXY%20Error&In-Reply-To=%3CCADAqQfxVHUfTqdtyPWc6AbBFyM4pNnWAeyrnvrqEJ8NvUJ4SFA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023878.html">
   <LINK REL="Next"  HREF="023851.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] TPROXY Error</H1>
    <B>Ben Goz</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TPROXY%20Error&In-Reply-To=%3CCADAqQfxVHUfTqdtyPWc6AbBFyM4pNnWAeyrnvrqEJ8NvUJ4SFA%40mail.gmail.com%3E"
       TITLE="[squid-users] TPROXY Error">ben.goz87 at gmail.com
       </A><BR>
    <I>Tue Jul 13 10:58:06 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="023878.html">[squid-users] TPROXY Error
</A></li>
        <LI>Next message (by thread): <A HREF="023851.html">[squid-users] SNMP mib data a subset of that available via cache:// ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23879">[ date ]</a>
              <a href="thread.html#23879">[ thread ]</a>
              <a href="subject.html#23879">[ subject ]</a>
              <a href="author.html#23879">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>By the help of God.

Sorry,
I thought I sent it in the last email.
I found out what was the problem, I built squid without libcap. :/

Anyway sorry for the time loss, and thanks for your help.

Regards,
Ben



&#8235;&#1489;&#1514;&#1488;&#1512;&#1497;&#1498; &#1497;&#1493;&#1501; &#1490;&#1523;, 13 &#1489;&#1497;&#1493;&#1500;&#1497; 2021 &#1489;-13:48 &#1502;&#1488;&#1514; &#8234;Eliezer Croitoru&#8236;&#8207; &lt;&#8234;
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A>&#8236;&#8207;&gt;:&#8236;

&gt;<i> Hey Ben,
</I>&gt;<i>
</I>&gt;<i> Still waiting for the relevant output.
</I>&gt;<i> Once I will have the relevant details I will probably be able to verify
</I>&gt;<i> how and what is the issue.
</I>&gt;<i>
</I>&gt;<i> Eliezer
</I>&gt;<i>
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: Eliezer Croitoru &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A>&gt;
</I>&gt;<i> Sent: Thursday, July 8, 2021 12:04 AM
</I>&gt;<i> To: '<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>' &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> &gt;
</I>&gt;<i> Cc: 'Ben Goz' &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">ben.goz87 at gmail.com</A>&gt;
</I>&gt;<i> Subject: RE: [squid-users] TPROXY Error
</I>&gt;<i>
</I>&gt;<i> Hey Ben,
</I>&gt;<i>
</I>&gt;<i> You are missing the critical output of the full command:
</I>&gt;<i> Ip route show table 100
</I>&gt;<i>
</I>&gt;<i> What you posted was:
</I>&gt;<i> &gt; 5.  the output of 'ip route show table 100'
</I>&gt;<i> $ ip route show
</I>&gt;<i> default via 8.13.140.14 dev bond0.212 proto static
</I>&gt;<i> 1.21.213.0/24 dev bond0.213 proto kernel scope link src 1.21.213.1
</I>&gt;<i> 8.11.39.248/30 dev enx00e04c3600d3 proto kernel scope link src 8.11.39.250
</I>&gt;<i> 8.13.140.0/28 dev bond0.212 proto kernel scope link src 8.13.140.1
</I>&gt;<i> 8.13.144.0/20 via 1.21.213.254 dev bond0.213
</I>&gt;<i> 8.13.148.1 via 1.21.213.254 dev bond0.213
</I>&gt;<i> ##
</I>&gt;<i>
</I>&gt;<i> It's important to see the relevant routing table.
</I>&gt;<i> The linux Kernel have couple routing tables which each can contain
</I>&gt;<i> different routing/forwarding table.
</I>&gt;<i> If you want to understand a bit more you might be able to try and lookup
</I>&gt;<i> for FIB.
</I>&gt;<i> ( take a peek at: <A HREF="http://linux-ip.net/html/routing-tables.html">http://linux-ip.net/html/routing-tables.html</A>)
</I>&gt;<i>
</I>&gt;<i> Eliezer
</I>&gt;<i>
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: Ben Goz &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">ben.goz87 at gmail.com</A>&gt;
</I>&gt;<i> Sent: Wednesday, July 7, 2021 3:36 PM
</I>&gt;<i> To: Eliezer Croitoru &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A>&gt;;
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> Subject: Re: [squid-users] TPROXY Error
</I>&gt;<i>
</I>&gt;<i> By the help of God.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Hi Eliezer,
</I>&gt;<i>
</I>&gt;<i> Thanks for your help.
</I>&gt;<i>
</I>&gt;<i> Please let me know if you need more information.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Regards,
</I>&gt;<i>
</I>&gt;<i> Ben
</I>&gt;<i>
</I>&gt;<i> On 07/07/2021 14:01, Eliezer Croitoru wrote:
</I>&gt;<i> &gt; Hey Ben,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I want to try and reset this issue because I am missing some technical
</I>&gt;<i> &gt; details.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 1. What Linux Distro and what version are you using?'
</I>&gt;<i> Ubuntu 20.04
</I>&gt;<i> &gt; 2. the output of 'ip address'
</I>&gt;<i> $ ip address
</I>&gt;<i> 1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN
</I>&gt;<i> group default qlen 1000
</I>&gt;<i>      link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
</I>&gt;<i>      inet 127.0.0.1/8 scope host lo
</I>&gt;<i>         valid_lft forever preferred_lft forever
</I>&gt;<i>      inet6 ::1/128 scope host
</I>&gt;<i>         valid_lft forever preferred_lft forever
</I>&gt;<i> 2: ens1f0: &lt;BROADCAST,MULTICAST,SLAVE,UP,LOWER_UP&gt; mtu 1500 qdisc mq
</I>&gt;<i> master bond0 state UP group default qlen 1000
</I>&gt;<i>      link/ether ba:59:58:58:23:2b brd ff:ff:ff:ff:ff:ff
</I>&gt;<i> 3: ens1f1: &lt;BROADCAST,MULTICAST,SLAVE,UP,LOWER_UP&gt; mtu 1500 qdisc mq
</I>&gt;<i> master bond0 state UP group default qlen 1000
</I>&gt;<i>      link/ether ba:59:58:58:23:2b brd ff:ff:ff:ff:ff:ff
</I>&gt;<i> 4: usb0: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group
</I>&gt;<i> default qlen 1000
</I>&gt;<i>      link/ether ca:13:59:65:c2:56 brd ff:ff:ff:ff:ff:ff
</I>&gt;<i> 5: enx00e04c3600d3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc
</I>&gt;<i> fq_codel state UP group default qlen 1000
</I>&gt;<i>      link/ether 00:e0:4c:36:00:d3 brd ff:ff:ff:ff:ff:ff
</I>&gt;<i>      inet 8.11.39.250/30 brd 8.11.39.251 scope global enx00e04c3600d3
</I>&gt;<i>         valid_lft forever preferred_lft forever
</I>&gt;<i>      inet6 fe80::2e0:4cff:fe36:d3/64 scope link
</I>&gt;<i>         valid_lft forever preferred_lft forever
</I>&gt;<i> 6: bond0: &lt;BROADCAST,MULTICAST,MASTER,UP,LOWER_UP&gt; mtu 1500 qdisc
</I>&gt;<i> noqueue state UP group default qlen 1000
</I>&gt;<i>      link/ether ba:59:58:58:23:2b brd ff:ff:ff:ff:ff:ff
</I>&gt;<i>      inet6 fe80::b859:58ff:fe58:232b/64 scope link
</I>&gt;<i>         valid_lft forever preferred_lft forever
</I>&gt;<i> 7: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">bond0.212 at bond0</A>: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc
</I>&gt;<i> noqueue state UP group default qlen 1000
</I>&gt;<i>      link/ether ba:59:58:58:23:2b brd ff:ff:ff:ff:ff:ff
</I>&gt;<i>      inet 8.13.140.1/28 brd 8.13.140.15 scope global bond0.212
</I>&gt;<i>         valid_lft forever preferred_lft forever
</I>&gt;<i>      inet6 fe80::b859:58ff:fe58:232b/64 scope link
</I>&gt;<i>         valid_lft forever preferred_lft forever
</I>&gt;<i> 8: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">bond0.213 at bond0</A>: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc
</I>&gt;<i> noqueue state UP group default qlen 1000
</I>&gt;<i>      link/ether ba:59:58:58:23:2b brd ff:ff:ff:ff:ff:ff
</I>&gt;<i>      inet 1.21.213.1/24 brd 1.21.213.255 scope global bond0.213
</I>&gt;<i>         valid_lft forever preferred_lft forever
</I>&gt;<i>      inet6 fe80::b859:58ff:fe58:232b/64 scope link
</I>&gt;<i>         valid_lft forever preferred_lft forever
</I>&gt;<i> &gt; 3. the output of 'ip rule'
</I>&gt;<i> $ ip rule
</I>&gt;<i> 0:    from all lookup local
</I>&gt;<i> 32762:    from all fwmark 0x1 lookup 100
</I>&gt;<i> 32763:    from all fwmark 0x1 lookup 100
</I>&gt;<i> 32764:    from all fwmark 0x1 lookup 100
</I>&gt;<i> 32765:    from all fwmark 0x1 lookup 100
</I>&gt;<i> 32766:    from all lookup main
</I>&gt;<i> 32767:    from all lookup default
</I>&gt;<i>
</I>&gt;<i> &gt; 4.  the output of 'ip route show'
</I>&gt;<i>
</I>&gt;<i> $ ip route show
</I>&gt;<i> default via 8.13.140.14 dev bond0.212 proto static
</I>&gt;<i> 1.21.213.0/24 dev bond0.213 proto kernel scope link src 1.21.213.1
</I>&gt;<i> 8.11.39.248/30 dev enx00e04c3600d3 proto kernel scope link src 8.11.39.250
</I>&gt;<i> 8.13.140.0/28 dev bond0.212 proto kernel scope link src 8.13.140.1
</I>&gt;<i> 8.13.144.0/20 via 1.21.213.254 dev bond0.213
</I>&gt;<i> 8.13.148.1 via 1.21.213.254 dev bond0.213
</I>&gt;<i>
</I>&gt;<i> &gt; 5.  the output of 'ip route show table 100'
</I>&gt;<i> $ ip route show
</I>&gt;<i> default via 8.13.140.14 dev bond0.212 proto static
</I>&gt;<i> 1.21.213.0/24 dev bond0.213 proto kernel scope link src 1.21.213.1
</I>&gt;<i> 8.11.39.248/30 dev enx00e04c3600d3 proto kernel scope link src 8.11.39.250
</I>&gt;<i> 8.13.140.0/28 dev bond0.212 proto kernel scope link src 8.13.140.1
</I>&gt;<i> 8.13.144.0/20 via 1.21.213.254 dev bond0.213
</I>&gt;<i> 8.13.148.1 via 1.21.213.254 dev bond0.213
</I>&gt;<i> &gt; 6. the output of 'iptables-save'
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> $ sudo iptables-save
</I>&gt;<i> # Generated by iptables-save v1.8.4 on Wed Jul  7 12:25:05 2021
</I>&gt;<i> *mangle
</I>&gt;<i> :PREROUTING ACCEPT [72898710:6084386298]
</I>&gt;<i> :INPUT ACCEPT [0:0]
</I>&gt;<i> :FORWARD ACCEPT [0:0]
</I>&gt;<i> :OUTPUT ACCEPT [0:0]
</I>&gt;<i> :POSTROUTING ACCEPT [0:0]
</I>&gt;<i> :DIVERT - [0:0]
</I>&gt;<i> -A PREROUTING -p tcp -m socket -j DIVERT
</I>&gt;<i> -A PREROUTING -i bond0.213 -p tcp -m tcp --dport 80 -j TPROXY --on-port
</I>&gt;<i> 15644 --on-ip 0.0.0.0 --tproxy-mark 0x1/0x1
</I>&gt;<i> -A PREROUTING -i bond0.213 -p tcp -m tcp --dport 443 -j TPROXY --on-port
</I>&gt;<i> 15645 --on-ip 0.0.0.0 --tproxy-mark 0x1/0x1
</I>&gt;<i> -A INPUT -j ACCEPT
</I>&gt;<i> -A FORWARD -j ACCEPT
</I>&gt;<i> -A OUTPUT -j ACCEPT
</I>&gt;<i> -A POSTROUTING -j ACCEPT
</I>&gt;<i> -A DIVERT -j MARK --set-xmark 0x1/0xffffffff
</I>&gt;<i> -A DIVERT -j ACCEPT
</I>&gt;<i> COMMIT
</I>&gt;<i> # Completed on Wed Jul  7 12:25:05 2021
</I>&gt;<i> # Generated by iptables-save v1.8.4 on Wed Jul  7 12:25:05 2021
</I>&gt;<i> *nat
</I>&gt;<i> :PREROUTING ACCEPT [26338415:1392747531]
</I>&gt;<i> :INPUT ACCEPT [820462:44161193]
</I>&gt;<i> :OUTPUT ACCEPT [1053:92773]
</I>&gt;<i> :POSTROUTING ACCEPT [25514534:1348449899]
</I>&gt;<i> -A PREROUTING -i eth1 -p udp -m udp --dport 53 -j REDIRECT --to-ports 53
</I>&gt;<i> -A PREROUTING -i eth1 -p tcp -m tcp --dport 53 -j REDIRECT --to-ports 53
</I>&gt;<i> COMMIT
</I>&gt;<i> # Completed on Wed Jul  7 12:25:05 2021
</I>&gt;<i> # Generated by iptables-save v1.8.4 on Wed Jul  7 12:25:05 2021
</I>&gt;<i> *filter
</I>&gt;<i> :INPUT ACCEPT [5045387:2170630036]
</I>&gt;<i> :FORWARD ACCEPT [72544426:6194710400]
</I>&gt;<i> :OUTPUT ACCEPT [2471930:252759773]
</I>&gt;<i> COMMIT
</I>&gt;<i> # Completed on Wed Jul  7 12:25:05 20
</I>&gt;<i>
</I>&gt;<i> &gt; 7. the output of 'nft -nn list ruleset' (if exists on the OS)
</I>&gt;<i> Doesn't exists.
</I>&gt;<i> &gt; 8. the output of your squid.conf
</I>&gt;<i> $ cat squid.conf
</I>&gt;<i> #
</I>&gt;<i> # Recommended minimum configuration:
</I>&gt;<i> #
</I>&gt;<i>
</I>&gt;<i> # Example rule allowing access from your local networks.
</I>&gt;<i> # Adapt to list your (internal) IP networks from where browsing
</I>&gt;<i> # should be allowed
</I>&gt;<i> acl localnet src 0.0.0.1-0.255.255.255    # RFC 1122 &quot;this&quot; network (LAN)
</I>&gt;<i> acl localnet src 10.0.0.0/8        # RFC 1918 local private network (LAN)
</I>&gt;<i> acl localnet src 100.64.0.0/10        # RFC 6598 shared address space
</I>&gt;<i> (CGN)
</I>&gt;<i> acl localnet src 169.254.0.0/16     # RFC 3927 link-local (directly
</I>&gt;<i> plugged) machines
</I>&gt;<i> acl localnet src 172.16.0.0/12        # RFC 1918 local private network
</I>&gt;<i> (LAN)
</I>&gt;<i> acl localnet src 192.168.0.0/16        # RFC 1918 local private network
</I>&gt;<i> (LAN)
</I>&gt;<i> acl localnet src fc00::/7           # RFC 4193 local private network range
</I>&gt;<i> acl localnet src fe80::/10          # RFC 4291 link-local (directly
</I>&gt;<i> plugged) machines
</I>&gt;<i>
</I>&gt;<i> acl SSL_ports port 443
</I>&gt;<i> acl Safe_ports port 80        # http
</I>&gt;<i> acl Safe_ports port 21        # ftp
</I>&gt;<i> acl Safe_ports port 443        # https
</I>&gt;<i> acl Safe_ports port 70        # gopher
</I>&gt;<i> acl Safe_ports port 210        # wais
</I>&gt;<i> acl Safe_ports port 1025-65535    # unregistered ports
</I>&gt;<i> acl Safe_ports port 280        # http-mgmt
</I>&gt;<i> acl Safe_ports port 488        # gss-http
</I>&gt;<i> acl Safe_ports port 591        # filemaker
</I>&gt;<i> acl Safe_ports port 777        # multiling http
</I>&gt;<i> acl CONNECT method CONNECT
</I>&gt;<i>
</I>&gt;<i> #
</I>&gt;<i> # Recommended minimum Access Permission configuration:
</I>&gt;<i> #
</I>&gt;<i> # Deny requests to certain unsafe ports
</I>&gt;<i> http_access deny !Safe_ports
</I>&gt;<i>
</I>&gt;<i> # Deny CONNECT to other than secure SSL ports
</I>&gt;<i> http_access deny CONNECT !SSL_ports
</I>&gt;<i>
</I>&gt;<i> # Only allow cachemgr access from localhost
</I>&gt;<i> http_access allow localhost manager
</I>&gt;<i> http_access deny manager
</I>&gt;<i>
</I>&gt;<i> # We strongly recommend the following be uncommented to protect innocent
</I>&gt;<i> # web applications running on the proxy server who think the only
</I>&gt;<i> # one who can access services on &quot;localhost&quot; is a local user
</I>&gt;<i> #http_access deny to_localhost
</I>&gt;<i>
</I>&gt;<i> #
</I>&gt;<i> # INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
</I>&gt;<i> #
</I>&gt;<i>
</I>&gt;<i> # Example rule allowing access from your local networks.
</I>&gt;<i> # Adapt localnet in the ACL section to list your (internal) IP networks
</I>&gt;<i> # from where browsing should be allowed
</I>&gt;<i> http_access allow localnet
</I>&gt;<i> http_access allow localhost
</I>&gt;<i>
</I>&gt;<i> # And finally deny all other access to this proxy
</I>&gt;<i> #http_access deny all
</I>&gt;<i>
</I>&gt;<i> http_access allow all
</I>&gt;<i>
</I>&gt;<i> # Squid normally listens to port 3128
</I>&gt;<i> http_port 15643
</I>&gt;<i> http_port 15644 tproxy
</I>&gt;<i> https_port 15645 ssl-bump tproxy generate-host-certificates=on
</I>&gt;<i> options=ALL dynamic_cert_mem_cache_size=4MB
</I>&gt;<i> cert=/usr/local/squid/etc/ssl_cert/myCA.pem
</I>&gt;<i> dhparams=/usr/local/squid/etc/dhparam.pem
</I>&gt;<i> always_direct allow all
</I>&gt;<i> acl DiscoverSNIHost at_step SslBump1
</I>&gt;<i> acl NoSSLInterceptRegexp_always ssl::server_name_regex -i xxx
</I>&gt;<i> acl NoSSLIntercept ssl::server_name  &quot;xxx&quot;
</I>&gt;<i> acl NoSSLInterceptRegexp ssl::server_name_regex -i &quot;xxx&quot;
</I>&gt;<i> ssl_bump splice NoSSLInterceptRegexp_always
</I>&gt;<i> ssl_bump splice NoSSLIntercept
</I>&gt;<i> ssl_bump splice NoSSLInterceptRegexp
</I>&gt;<i> ssl_bump peek DiscoverSNIHost
</I>&gt;<i> ssl_bump bump all
</I>&gt;<i> sslcrtd_program /usr/local/squid/libexec/security_file_certgen -s
</I>&gt;<i> /var/lib/ssl_db -M 4MB
</I>&gt;<i> sslcrtd_children 32 startup=15 idle=3
</I>&gt;<i> #sslproxy_capath /etc/ssl/certs
</I>&gt;<i>
</I>&gt;<i> # Uncomment and adjust the following to add a disk cache directory.
</I>&gt;<i> #cache_dir ufs /usr/local/squid/var/cache/squid 100 16 256
</I>&gt;<i>
</I>&gt;<i> # Leave coredumps in the first cache dir
</I>&gt;<i> coredump_dir /usr/local/squid/var/cache/squid
</I>&gt;<i>
</I>&gt;<i> #
</I>&gt;<i> # Add any of your own refresh_pattern entries above these.
</I>&gt;<i> #
</I>&gt;<i> refresh_pattern ^ftp:        1440    20%    10080
</I>&gt;<i> refresh_pattern ^gopher:    1440    0%    1440
</I>&gt;<i> refresh_pattern -i (/cgi-bin/|\?) 0    0%    0
</I>&gt;<i> refresh_pattern .        0    20%    4320
</I>&gt;<i>
</I>&gt;<i> range_offset_limit -1
</I>&gt;<i>
</I>&gt;<i> dns_v4_first on
</I>&gt;<i> forwarded_for off
</I>&gt;<i> cache deny all
</I>&gt;<i> &gt; 9. the output of 'squid -v'
</I>&gt;<i> $ ./squid -v
</I>&gt;<i> Squid Cache: Version 4.15
</I>&gt;<i> Service Name: squid
</I>&gt;<i>
</I>&gt;<i> This binary uses OpenSSL 1.1.1f  31 Mar 2020. For legal restrictions on
</I>&gt;<i> distribution see <A HREF="https://www.openssl.org/source/license.html">https://www.openssl.org/source/license.html</A>
</I>&gt;<i>
</I>&gt;<i> configure options:  '--with-openssl' '--enable-ssl-crtd' '--enable-ecap'
</I>&gt;<i> '--enable-linux-netfilter' --enable-ltdl-convenience
</I>&gt;<i>
</I>&gt;<i> &gt; 10. the output of 'uname -a'
</I>&gt;<i> uname -a
</I>&gt;<i> Linux xxx 5.4.0-77-generic #86-Ubuntu SMP Thu Jun 17 02:35:03 UTC 2021
</I>&gt;<i> x86_64 x86_64 x86_64 GNU/Linux
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Once we will have all the above details (reducing/modifying any private
</I>&gt;<i> &gt; details) we can try to maybe help you.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Eliezer
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; -----Original Message-----
</I>&gt;<i> &gt; From: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; On Behalf
</I>&gt;<i> Of
</I>&gt;<i> &gt; Ben Goz
</I>&gt;<i> &gt; Sent: Wednesday, June 30, 2021 3:16 PM
</I>&gt;<i> &gt; To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> &gt; Subject: [squid-users] TPROXY Error
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;   By the help of God.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Hi All,
</I>&gt;<i> &gt; I'm trying to configure squid as a transparent proxy using TPROXY.
</I>&gt;<i> &gt; The machine I'm using has 2 NICs, one for input and the other one for
</I>&gt;<i> &gt; output traffic.
</I>&gt;<i> &gt; The TPROXY iptables rules are configured on the input NIC.
</I>&gt;<i> &gt; It looks like iptables TPROXY redirect works but squid prints out the
</I>&gt;<i> &gt; following error:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ERROR: NAT/TPROXY lookup failed to locate original IPs on
</I>&gt;<i> &gt; local=xxx:443 remote=xxx:49471 FD 14 flags=17
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I think I loaded all TPROXY required kernel modules.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The ip forwarding works fine without the iptables rules. and I don't
</I>&gt;<i> &gt; see any squid ERROR on getsockopt
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Please let me know what I'm missing?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Thanks,
</I>&gt;<i> &gt; Ben
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; squid-users mailing list
</I>&gt;<i> &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> &gt; <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20210713/203f7b0e/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20210713/203f7b0e/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="023878.html">[squid-users] TPROXY Error
</A></li>
	<LI>Next message (by thread): <A HREF="023851.html">[squid-users] SNMP mib data a subset of that available via cache:// ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23879">[ date ]</a>
              <a href="thread.html#23879">[ thread ]</a>
              <a href="subject.html#23879">[ subject ]</a>
              <a href="author.html#23879">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
