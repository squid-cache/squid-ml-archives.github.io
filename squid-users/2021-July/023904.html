<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Ubuntu 20.04 &quot;apt update&quot; issues behind a VPN and Squid proxy
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Ubuntu%2020.04%20%22apt%20update%22%20issues%20behind%20a%20VPN%20and%0A%20Squid%20proxy&In-Reply-To=%3CCAF28NiaJFXNWqSY8%3D2mAoMuYeqHdDYrQHe2MLFR2Hnf%3DWc7ZFA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023898.html">
   <LINK REL="Next"  HREF="023872.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Ubuntu 20.04 &quot;apt update&quot; issues behind a VPN and Squid proxy</H1>
    <B>David Mills</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Ubuntu%2020.04%20%22apt%20update%22%20issues%20behind%20a%20VPN%20and%0A%20Squid%20proxy&In-Reply-To=%3CCAF28NiaJFXNWqSY8%3D2mAoMuYeqHdDYrQHe2MLFR2Hnf%3DWc7ZFA%40mail.gmail.com%3E"
       TITLE="[squid-users] Ubuntu 20.04 &quot;apt update&quot; issues behind a VPN and Squid proxy">david.mills at acusensus.com
       </A><BR>
    <I>Thu Jul 22 04:51:18 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="023898.html">[squid-users] Ubuntu 20.04 &quot;apt update&quot; issues behind a VPN and Squid proxy
</A></li>
        <LI>Next message (by thread): <A HREF="023872.html">[squid-users] Ubuntu 20.04 &quot;apt update&quot; issues behind a VPN and Squid proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23904">[ date ]</a>
              <a href="thread.html#23904">[ thread ]</a>
              <a href="subject.html#23904">[ subject ]</a>
              <a href="author.html#23904">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Amos,

Upgrading to Squid 4.1 resolved the issue. I had to run

&gt;<i> /usr/lib64/squid/security_file_certgen -c -s /var/spool/squid/ssl_db -M 4MB
</I>&gt;<i>
</I>
to get squid to start. But after that all worked well. We'll do a bit more
testing before we roll out to our production servers.

Thanks very much for your help.

Regards,

David Mills

Senior DevOps Engineer

 E: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">david.mills at acusensus.com</A>

 M: +61 411 513 404

 W: acusensus.com





On Sun, 18 Jul 2021 at 16:45, Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; wrote:

&gt;<i> On 16/07/21 4:38 pm, David Mills wrote:
</I>&gt;<i> &gt; Hi Amos,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; sorry for the big delay here - I've had lots of other things to attend
</I>&gt;<i> &gt; to. It turned on the logging you suggested. For a failed &quot;apt update&quot;
</I>&gt;<i> &gt; attempt on the client I get the following attached access.log and
</I>&gt;<i> cache.log.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Are any of the lines
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     2021/07/16 04:28:01.423 kid1| 83,5| bio.cc(396) adjustSSL: Extension
</I>&gt;<i> &gt;     13 does not supported!
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     ...
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     20212021/07/16 04:28:32.465 kid1| 83,2| client_side.cc(3749)
</I>&gt;<i> &gt;     Squid_SSL_accept: Error negotiating SSL connection on FD 11: Aborted
</I>&gt;<i> &gt;     by client: 5
</I>&gt;<i> &gt;     ...
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     2021/07/16 04:28:02.452 kid1| Error negotiating SSL on FD 17:
</I>&gt;<i> &gt;     error:140920F8:SSL routines:ssl3_get_server_hello:unknown cipher
</I>&gt;<i> &gt;     returned (1/-1/0)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     ...
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     2021/07/16 04:28:01.413 kid1| 83,2| client_side.cc(4293)
</I>&gt;<i> &gt;     clientPeekAndSpliceSSL: SSL_accept failed.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; important?
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> Very. It means the libssl Squid is built with and using is not able to
</I>&gt;<i> understand the TLS the server is sending.
</I>&gt;<i>
</I>&gt;<i> Squid-4 should be more tolerant of this particular issue, or at least
</I>&gt;<i> able to follow the on_unsupported_protocol directive when it is
</I>&gt;<i> encountered.
</I>&gt;<i>
</I>&gt;<i> Older Squid depend more directly on the library TLS parsing - which
</I>&gt;<i> cannot handle unknown values well.
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>
-- 
DISCLAIMER: Acusensus puts the privacy and security of its clients, its 
data and information at the core of everything we do. The information 
contained in this email (including attachments) is intended only for the 
use of the person(s) to whom it is addressed to, as it may be confidential 
and contain legally privileged information. If you have received this email 
in error, please delete all copies and notify the sender immediately. Any 
views or opinions presented are
solely those of the author and do not 
necessarily represent the views of Acusensus
Pty Ltd. Please consider the 
environment
before printing this email.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20210722/4aa51e24/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20210722/4aa51e24/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="023898.html">[squid-users] Ubuntu 20.04 &quot;apt update&quot; issues behind a VPN and Squid proxy
</A></li>
	<LI>Next message (by thread): <A HREF="023872.html">[squid-users] Ubuntu 20.04 &quot;apt update&quot; issues behind a VPN and Squid proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23904">[ date ]</a>
              <a href="thread.html#23904">[ thread ]</a>
              <a href="subject.html#23904">[ subject ]</a>
              <a href="author.html#23904">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
