<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Problems with websockets
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Problems%20with%20websockets&In-Reply-To=%3C7f9b44bd-3706-d066-64a1-300657bee828%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023748.html">
   <LINK REL="Next"  HREF="023751.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Problems with websockets</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Problems%20with%20websockets&In-Reply-To=%3C7f9b44bd-3706-d066-64a1-300657bee828%40measurement-factory.com%3E"
       TITLE="[squid-users] Problems with websockets">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Jun  8 16:08:56 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="023748.html">[squid-users] Problems with websockets
</A></li>
        <LI>Next message (by thread): <A HREF="023751.html">[squid-users] Is it possible to force some dstdomain to ipv4 protocol without define an outgoing ip address ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23750">[ date ]</a>
              <a href="thread.html#23750">[ thread ]</a>
              <a href="subject.html#23750">[ subject ]</a>
              <a href="author.html#23750">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 6/8/21 11:55 AM, Alex Irmel Oviedo Solis wrote:
&gt;<i> I have been trying to do it by placing the rules from line 86
</I>&gt;<i> to line 91 in squid.conf
</I>
acl DiscoverSNIHost at_step SslBump1
acl NoSSLIntercept ssl::server_name_regex &quot;/etc/squid/acl.url.nobump&quot;

ssl_bump peek DiscoverSNIHost
ssl_bump splice NoSSLIntercept
ssl_bump bump all

I wonder if your acl.url.nobump regexes do not match step2 CONNECT URIs.
The current cache.log snippet does not show that detail. Consider
posting more detailed logs that show ACL matching attempts (e.g., &quot;ALL,3
28,7&quot;?).

Alex.


&gt;<i> El mar, 8 de jun. de 2021 a la(s) 10:45, Alex Rousskov
</I>&gt;<i> (<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>
</I>&gt;<i> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt;) escribi&#243;:
</I>&gt;<i> 
</I>&gt;<i>     On 6/8/21 11:36 AM, Alex Irmel Oviedo Solis wrote:
</I>&gt;<i>     &gt; Hello all, I'm having problems with squid 4.11 on RHEL 8.4. I was
</I>&gt;<i>     trying
</I>&gt;<i>     &gt; to access to whatsapp with no luck, but I'm currently to test with
</I>&gt;<i>     &gt; <A HREF="https://www.websocket.org/echo.html">https://www.websocket.org/echo.html</A>
</I>&gt;<i>     &lt;<A HREF="https://www.websocket.org/echo.html">https://www.websocket.org/echo.html</A>&gt;, &#160;the errors in both cases are
</I>&gt;<i> 
</I>&gt;<i>     &gt; http.cc(723) processReplyHeader: HTTP Server RESPONSE:
</I>&gt;<i>     &gt; HTTP/1.1 400 WebSocket Upgrade Failure
</I>&gt;<i> 
</I>&gt;<i>     Squid v4 does not fully support HTTP Upgrade (it drops it). You should
</I>&gt;<i>     splice connections to websocket services or use
</I>&gt;<i>     http_upgrade_request_protocols available in Squid v5.
</I>&gt;<i> 
</I>&gt;<i>     HTH,
</I>&gt;<i> 
</I>&gt;<i>     Alex.
</I>&gt;<i>     P.S. Thank you for providing detailed triage information!
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     &gt; My squid.conf is in <A HREF="https://paste.centos.org/view/b98e8510">https://paste.centos.org/view/b98e8510</A>
</I>&gt;<i>     &lt;<A HREF="https://paste.centos.org/view/b98e8510">https://paste.centos.org/view/b98e8510</A>&gt;
</I>&gt;<i>     &gt; My cache.log is in <A HREF="https://paste.centos.org/view/a2b6ac81">https://paste.centos.org/view/a2b6ac81</A>
</I>&gt;<i>     &lt;<A HREF="https://paste.centos.org/view/a2b6ac81">https://paste.centos.org/view/a2b6ac81</A>&gt;
</I>&gt;<i>     &gt; My access.lorg is in <A HREF="https://paste.centos.org/view/eef2180a">https://paste.centos.org/view/eef2180a</A>
</I>&gt;<i>     &lt;<A HREF="https://paste.centos.org/view/eef2180a">https://paste.centos.org/view/eef2180a</A>&gt;
</I>&gt;<i>     _______________________________________________
</I>&gt;<i>     squid-users mailing list
</I>&gt;<i>     <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i>     <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>     &lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> -- 
</I>&gt;<i> //&quot;Una alegr&#237;a compartida se transforma en doble alegr&#237;a; una pena
</I>&gt;<i> compartida, en media pena.&quot;//
</I>&gt;<i> --&gt;&#160;<A HREF="http://www.alexove.me">http://www.alexove.me</A> &lt;<A HREF="http://www.alexove.me/">http://www.alexove.me/</A>&gt;
</I>&gt;<i> --&gt; Celular (Movistar): +51-959-625-001
</I>&gt;<i> --&gt; Sigueme en Twitter:&#160;<A HREF="http://twitter.com/alexove_pe">http://twitter.com/alexove_pe</A>
</I>&gt;<i> &lt;<A HREF="http://twitter.com/alexove_pe">http://twitter.com/alexove_pe</A>&gt;
</I>&gt;<i> --&gt; Perfil:&#160;<A HREF="http://fedoraproject.org/wiki/user:alexove">http://fedoraproject.org/wiki/user:alexove</A>
</I>&gt;<i> &lt;<A HREF="http://fedoraproject.org/wiki/user:alexove">http://fedoraproject.org/wiki/user:alexove</A>&gt;
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="023748.html">[squid-users] Problems with websockets
</A></li>
	<LI>Next message (by thread): <A HREF="023751.html">[squid-users] Is it possible to force some dstdomain to ipv4 protocol without define an outgoing ip address ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23750">[ date ]</a>
              <a href="thread.html#23750">[ thread ]</a>
              <a href="subject.html#23750">[ subject ]</a>
              <a href="author.html#23750">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
