<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid spliced TLS handshake failing with chrome/ium fallback for certain servers
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20spliced%20TLS%20handshake%20failing%20with%0A%20chrome/ium%20fallback%20for%20certain%20servers&In-Reply-To=%3C0bf164b9-87cb-5a0b-66fe-8cd81fea9c6c%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023761.html">
   <LINK REL="Next"  HREF="023763.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid spliced TLS handshake failing with chrome/ium fallback for certain servers</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20spliced%20TLS%20handshake%20failing%20with%0A%20chrome/ium%20fallback%20for%20certain%20servers&In-Reply-To=%3C0bf164b9-87cb-5a0b-66fe-8cd81fea9c6c%40measurement-factory.com%3E"
       TITLE="[squid-users] Squid spliced TLS handshake failing with chrome/ium fallback for certain servers">rousskov at measurement-factory.com
       </A><BR>
    <I>Thu Jun 10 20:04:01 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="023761.html">[squid-users] Squid spliced TLS handshake failing with chrome/ium fallback for certain servers
</A></li>
        <LI>Next message (by thread): <A HREF="023763.html">[squid-users] Squid spliced TLS handshake failing with chrome/ium fallback for certain servers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23764">[ date ]</a>
              <a href="thread.html#23764">[ thread ]</a>
              <a href="subject.html#23764">[ subject ]</a>
              <a href="author.html#23764">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 6/10/21 11:00 AM, Andreas Weigel wrote:

&gt;&gt;<i> I can only suggest to either fix the Squid bug/limitation or decide to
</I>&gt;&gt;<i> splice during step1 (based on client SNI, etc., before Squid talks to
</I>&gt;&gt;<i> the origin server).
</I>
&gt;<i> don't know why I haven't yet had the idea, but indeed, if I force
</I>&gt;<i> splicing at step 1 or even 2, the site loads without error. This is not
</I>&gt;<i> exaclty a solution, but at least something to work with.
</I>

If you tell Squid to proceed to step3, then Squid has a duty to validate
the TLS server. Failure to do so should result in an error. This is what
<A HREF="https://wiki.squid-cache.org/Features/SslPeekAndSplice">https://wiki.squid-cache.org/Features/SslPeekAndSplice</A> promises to do
during step3:

i. Get TLS Server Hello info from the server, including the server
certificate.
ii. Validate the TLS server certificate.
iii. Evaluate again all ssl_bump rules and perform the first matching
action (splice, bump, or terminate) for the connection.

We probably should enhance Squid to better control its reaction to 3i
failures, but such adjustments may have to be guarded by some new
explicit configuration because they would allow splicing connections to
non-TLS servers or very insecure TLS servers (that were previously
reported as errors).


HTH,

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="023761.html">[squid-users] Squid spliced TLS handshake failing with chrome/ium fallback for certain servers
</A></li>
	<LI>Next message (by thread): <A HREF="023763.html">[squid-users] Squid spliced TLS handshake failing with chrome/ium fallback for certain servers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23764">[ date ]</a>
              <a href="thread.html#23764">[ thread ]</a>
              <a href="subject.html#23764">[ subject ]</a>
              <a href="author.html#23764">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
