<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Data not being cached
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Data%20not%20being%20cached&In-Reply-To=%3C099ec2a0-65eb-bf74-fcb7-7380a9c606c4%40transsee.ca%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023779.html">
   <LINK REL="Next"  HREF="023785.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Data not being cached</H1>
    <B>Darwin O'Connor</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Data%20not%20being%20cached&In-Reply-To=%3C099ec2a0-65eb-bf74-fcb7-7380a9c606c4%40transsee.ca%3E"
       TITLE="[squid-users] Data not being cached">doconnor at transsee.ca
       </A><BR>
    <I>Sun Jun 20 18:41:40 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="023779.html">[squid-users] password
</A></li>
        <LI>Next message (by thread): <A HREF="023785.html">[squid-users] Data not being cached
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23783">[ date ]</a>
              <a href="thread.html#23783">[ thread ]</a>
              <a href="subject.html#23783">[ subject ]</a>
              <a href="author.html#23783">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I run a transit prediction web app &lt;<A HREF="https://www.transsee.ca/">https://www.transsee.ca/</A>&gt;. It 
connects to a variety of web APIs to collect the real time transit data 
it needs. The app's activities are split among many processes. They 
currently uses libcurl to connect to squid for caching (often for as 
little as 10-30 seconds) and benefits of connection sharing.

There is still cases where data isn't being cached no matter what I do. 
It is https data, but I am able to cache other https pages like 
<A HREF="https://cdn.mbta.com/realtime/Alerts.pb">https://cdn.mbta.com/realtime/Alerts.pb</A>

The refresh_pattern:

refresh_pattern .&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 60&#160;&#160;&#160;&#160;&#160; 99999%&#160; 7200 override-expire 
override-lastmod reload-into-ims ignore-reload ignore-no-cache 
ignore-no-store ignore-private ignore-auth store-stale

The http headers from curl of an example where it is not being cached:

*&#160;&#160; Trying 127.0.0.1:3128...
* Connected to 127.0.0.1 (127.0.0.1) port 3128 (#0)
 &gt; GET <A HREF="https://api.transport.nsw.gov.au/v1/gtfs/alerts/buses">https://api.transport.nsw.gov.au/v1/gtfs/alerts/buses</A> HTTP/1.1
Host: 127.0.0.1:3128
User-Agent: curl/7.77.0 (+<A HREF="https://www.transsee.ca/">https://www.transsee.ca/</A>)
Accept: */*
Accept-Encoding: gzip
Authorization: apikey 2eYEqXXxOPEDChnpeF7sZL2aR8moD2DtdNmn
Cache-Control: max-age=60
Content-Encoding: aes128gcm

* Mark bundle as not supporting multiuse
&lt; HTTP/1.1 200 OK
&lt; Date: Sun, 20 Jun 2021 17:52:14 GMT
&lt; Content-Type: application/protobuf
&lt; Content-Length: 7455
&lt; Set-Cookie: 
AWSALB=EEAv0EXNaGzBkgAPS1JzrAiQZi7aKDk063qjM4ApeOuIArbwQ+s17/jimuq7AzzuC+a35t5Lx/y+H5YMqTC9bL6LqS4Y75auumXt7LWnvSFE/SMXQd/OFa6TSCW9; 
Expires=Sun, 27 Jun 2021 17:52:14 GMT; Path=/
&lt; Set-Cookie: 
AWSALBCORS=EEAv0EXNaGzBkgAPS1JzrAiQZi7aKDk063qjM4ApeOuIArbwQ+s17/jimuq7AzzuC+a35t5Lx/y+H5YMqTC9bL6LqS4Y75auumXt7LWnvSFE/SMXQd/OFa6TSCW9; 
Expires=Sun, 27 Jun 2021 17:52:14 GMT; Path=/; SameSite=None; Secure
&lt; Server: Apache-Coyote/1.1
&lt; X-Powered-By: Express
&lt; Access-Control-Allow-Credentials: true
&lt; ETag: W/&quot;ab70-8SI2GdBV4SJG4edSc4E5W8LBJWk&quot;
&lt; Vary: Accept-Encoding
&lt; X-Cache: Hit from cloudfront
&lt; X-Amz-Cf-Pop: SYD1-C1
&lt; X-Amz-Cf-Id: hCoQckLsNONQMpgPr2kXJVdTDHu98jxl-rPXqV_PHB2vTCEomAd-Nw==
&lt; Age: 35
&lt; Access-Control-Allow-Origin: *
&lt; Content-Encoding: gzip
&lt; X-Cache: MISS from transsee
&lt; X-Cache-Lookup: MISS from transsee:3128
&lt; Via: 1.1 359a113ca166631b42f31a0f2e6a1aab.cloudfront.net (CloudFront), 
1.1 transsee (squid/4.15)
&lt; Connection: keep-alive

Here is a sample from the Squid access log:

1624212034.891&#160;&#160;&#160; 246 127.0.0.1 59216 TCP_MISS/200 8517 GET 
<A HREF="https://api.transport.nsw.gov.au/v1/gtfs/alerts/buses">https://api.transport.nsw.gov.au/v1/gtfs/alerts/buses</A> - 
HIER_DIRECT/52.65.222.24 application/protobuf


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="023779.html">[squid-users] password
</A></li>
	<LI>Next message (by thread): <A HREF="023785.html">[squid-users] Data not being cached
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23783">[ date ]</a>
              <a href="thread.html#23783">[ thread ]</a>
              <a href="subject.html#23783">[ subject ]</a>
              <a href="author.html#23783">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
