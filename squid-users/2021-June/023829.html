<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] How to use request headers in external_acl_type
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20How%20to%20use%20request%20headers%20in%20external_acl_type&In-Reply-To=%3Cef3618b8b036c03d7d208de91e2daf78%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023828.html">
   <LINK REL="Next"  HREF="023846.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] How to use request headers in external_acl_type</H1>
    <B>squid3 at treenet.co.nz</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20How%20to%20use%20request%20headers%20in%20external_acl_type&In-Reply-To=%3Cef3618b8b036c03d7d208de91e2daf78%40treenet.co.nz%3E"
       TITLE="[squid-users] How to use request headers in external_acl_type">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Jun 25 23:20:06 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="023828.html">[squid-users] How to use request headers in external_acl_type
</A></li>
        <LI>Next message (by thread): <A HREF="023846.html">[squid-users] How to use request headers in external_acl_type
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23829">[ date ]</a>
              <a href="thread.html#23829">[ thread ]</a>
              <a href="subject.html#23829">[ subject ]</a>
              <a href="author.html#23829">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2021-06-26 07:18, Yosi Greenfield wrote:
&gt;<i> Hello all,
</I>&gt;<i> 
</I>&gt;<i> I'm trying to use request headers in an external acl, and I'm probably
</I>&gt;<i> doing it incorrectly, and it's not working.
</I>&gt;<i> 
</I>
Looks like its working fine.


&gt;<i> Here's my acl definiton:
</I>&gt;<i> 
</I>&gt;<i> external_acl_type ext_acl_program  %SRC %&gt;{Connection} %&gt;{Accept}
</I>&gt;<i> %&gt;{Custom_header} %&gt;{Host} /etc/squid/ext_acl_program.pl
</I>&gt;<i> 
</I>&gt;<i> The program ext_acl_program.pl simply prints out the input
</I>&gt;<i> 
</I>&gt;<i>    chomp ($line);
</I>&gt;<i>    @fields          = split(' ', $line);
</I>&gt;<i>    my $ip           = $fields[0];
</I>&gt;<i>    my $connection   = $fields[1];
</I>&gt;<i>    my $accept       = $fields[2];
</I>&gt;<i>    my $custom       = $fields[3];
</I>&gt;<i>    my $host         = $fields[4];
</I>&gt;<i> 
</I>&gt;<i>    print LOGFILE  &quot;IP: $ip\n Conn: $connection\n Accept: $accept\n
</I>&gt;<i> Custom: $custom\n Host: $host&quot;;
</I>&gt;<i> 
</I>&gt;<i> The output looks like this:
</I>&gt;<i> 
</I>&gt;<i> IP: 10.200.10.2
</I>&gt;<i> Conn: keep-alive
</I>&gt;<i> Accept: -
</I>&gt;<i> Custom: -
</I>&gt;<i> Host: www.wsws.com:443 [1]
</I>&gt;<i> 
</I>&gt;<i> As you see, it has values for %SRC, %&gt;{Connection} and %&gt;{Host}.  It
</I>&gt;<i> does not have values for %&gt;{Accept} and %&gt;{Custom_header}
</I>&gt;<i> 
</I>&gt;<i> So the question is, are these %&gt;{} substitutions coming from
</I>&gt;<i> request_headers (as I thought)?
</I>
The Host header only exists in request messages so I would say they are.
It may not be the request message you are thinking about though. Request 
headers can come from clients, but they could also be generated by Squid 
or ICAP/eCAP services.

&gt;<i> 
</I>&gt;<i> If yes, why does it only have Connection and Host, and not Accept or
</I>&gt;<i> my custom header?
</I>&gt;<i> 
</I>
Because those are the headers the message being printed contain.
You do not provide enough details about where the request came from. eg 
how it was created and/or changed between creation and the helper being 
called.


&gt;<i> If they are not coming from request headers, where are they coming
</I>&gt;<i> from?
</I>&gt;<i> 
</I>
You can use &quot;debug_options 11,2&quot; to see the HTTP messages Squid is 
processing.


&gt;<i> And mostly, how can I pass my custom header into the program?
</I>
Exactly as you configured above. Assuming that the header is actually 
&quot;Custom_header: ...&quot; with that underscore included.


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="023828.html">[squid-users] How to use request headers in external_acl_type
</A></li>
	<LI>Next message (by thread): <A HREF="023846.html">[squid-users] How to use request headers in external_acl_type
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23829">[ date ]</a>
              <a href="thread.html#23829">[ thread ]</a>
              <a href="subject.html#23829">[ subject ]</a>
              <a href="author.html#23829">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
