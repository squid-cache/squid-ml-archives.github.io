<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid full request logging
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20full%20request%20logging&In-Reply-To=%3C384D8BCA-4AD7-4C47-9EB6-470FB82398B7%40ironpeak.be%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023409.html">
   <LINK REL="Next"  HREF="023411.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid full request logging</H1>
    <B>Niels Hofmans</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20full%20request%20logging&In-Reply-To=%3C384D8BCA-4AD7-4C47-9EB6-470FB82398B7%40ironpeak.be%3E"
       TITLE="[squid-users] Squid full request logging">hello at ironpeak.be
       </A><BR>
    <I>Thu Mar  4 21:33:17 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="023409.html">[squid-users] Squid full request logging
</A></li>
        <LI>Next message (by thread): <A HREF="023411.html">[squid-users] Squid full request logging
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23410">[ date ]</a>
              <a href="thread.html#23410">[ thread ]</a>
              <a href="subject.html#23410">[ subject ]</a>
              <a href="author.html#23410">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Alex,

Thanks for the feedback. Although I am not proficient in C for writing an ecap service, is there some binding available online for Go?
This was the reason I originally opted for an ICAP service since I can abstract Go behind the HTTP ICAP layer.
Now I understand this has its limitations, but AFAIK a preview cap at 100kb would be sufficient per request.
But this will slow down my current setup greatly, as I&#8217;m currently sending -only- the headers.

Would you think that a) using Go for the ecap adapter or b) using two ICAP services.
One would validate the headers and return OK or NOT (bypass=0), while the other only pushes the 1kb request/response to a queue.
Ideally those two would be contacted simultaneously while only the first one is blocking.
..just thinking aloud tough.

Regards,
Niels Hofmans

SITE   <A HREF="https://ironpeak.be">https://ironpeak.be</A>
BTW   BE0694785660
BANK BE76068909740795

On 4 Mar 2021, at 22:23, Alex Rousskov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt; wrote:

On 3/4/21 2:52 PM, Niels Hofmans wrote:

&gt;<i> is it possible to do full request/response logging?
</I>
Squid can log HTTP headers with %&gt;h and %&lt;h logformat codes.

Squid cannot log HTTP message bodies.


&gt;<i> I do not see the appropriate log_format directive in the docs.
</I>&gt;<i> I was hoping not having to do this in my ICAP service since this slows
</I>&gt;<i> down approval of the HTTP request. (Empty preview v.s. a request capped
</I>&gt;<i> at 1MB that needs to be sent over every time)
</I>
FWIW, an ICAP or eCAP service can start responding to the request
_before_ the service receives the entire HTTP message body. To get
things going, all the service needs is HTTP headers (and even that is,
technically, optional in some cases).

Using an adaptation service is still an overhead, of course, but, very
few legitimate Squid use cases involve logging message bodies, so there
is no built-in mechanism optimized for that specific rare purpose
(yet?). The fastest option available today is probably a dedicated eCAP
service that refuses to adapt the message bit continues to receive (and
log) the message body.


HTH,

Alex.
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20210304/239f4a34/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20210304/239f4a34/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="023409.html">[squid-users] Squid full request logging
</A></li>
	<LI>Next message (by thread): <A HREF="023411.html">[squid-users] Squid full request logging
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23410">[ date ]</a>
              <a href="thread.html#23410">[ thread ]</a>
              <a href="subject.html#23410">[ subject ]</a>
              <a href="author.html#23410">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
