<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Protecting squid
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Protecting%20squid&In-Reply-To=%3Ccf4376cb-223e-49b0-abd5-7200a4d21a9d%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023461.html">
   <LINK REL="Next"  HREF="023468.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Protecting squid</H1>
    <B>Ben Goz</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Protecting%20squid&In-Reply-To=%3Ccf4376cb-223e-49b0-abd5-7200a4d21a9d%40gmail.com%3E"
       TITLE="[squid-users] Protecting squid">ben.goz87 at gmail.com
       </A><BR>
    <I>Wed Mar 17 13:54:25 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="023461.html">[squid-users] Protecting squid
</A></li>
        <LI>Next message (by thread): <A HREF="023468.html">[squid-users] Protecting squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23466">[ date ]</a>
              <a href="thread.html#23466">[ thread ]</a>
              <a href="subject.html#23466">[ subject ]</a>
              <a href="author.html#23466">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>By the help of God.


Hi Amos,

Sounds interesting.

Maybe I should modify the external_acl_type to talk with internal API 
inside my system.

Can you please point me to some code examples and documentation?

Also if you can please point me to squid code that invokes the external 
ACL program?

Thanks,

Ben

On 15/03/2021 15:27, Amos Jeffries wrote:
&gt;<i> On 15/03/21 2:26 am, Ben Goz wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Can I configure squid authentication TTL per only source IP and 
</I>&gt;&gt;<i> ignores other parameters so authentication will be requested only 
</I>&gt;&gt;<i> once in TTL for all the sessions?
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Not with just authentication. You will need to use a slightly more 
</I>&gt;<i> complicated system involving an external_acl_type helper as well and 
</I>&gt;<i> switch to an SQL database auth system.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> The idea for that is that you have a database of authenticated users 
</I>&gt;<i> with their last-known IP address.
</I>&gt;<i>
</I>&gt;<i> &#160;Your auth_param helper is changed to one which takes client IP 
</I>&gt;<i> address in the auth_param key_extras setting, and adds records to the 
</I>&gt;<i> SQL database before telling Squid the login is OK.
</I>&gt;<i>
</I>&gt;<i> &#160;Use an ext_sql_session_acl helper which takes IP address and checks 
</I>&gt;<i> the database to find the username who last authenticated from there. 
</I>&gt;<i> This needs to be checked and permit existing sessions before the auth 
</I>&gt;<i> helper.
</I>&gt;<i>
</I>&gt;<i> The config looks something like this:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &#160; external_acl_type ipuser negative_ttl=0 ttl=7200 %&lt;a \
</I>&gt;<i> &#160;&#160;&#160; /usr/bin/squid/ext_sql_session_acl \
</I>&gt;<i> &#160;&#160;&#160; --dsn &quot;...&quot; --user dbUsername --password dbPassword --persist \
</I>&gt;<i> &#160;&#160;&#160; --usercol username --uidcol ipaddress
</I>&gt;<i>
</I>&gt;<i> &#160; acl user_known external ipuser
</I>&gt;<i> &#160; http_access allow user_known
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &#160; auth_param basic program /path/to/helper
</I>&gt;<i> &#160; auth_param basic key_extras %&lt;a
</I>&gt;<i> &#160; auth_param basic credentialsttl 2 hours
</I>&gt;<i>
</I>&gt;<i> &#160; acl authenticated proxy_auth REQUIRED
</I>&gt;<i>
</I>&gt;<i> &#160; http_access allow authenticated
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="023461.html">[squid-users] Protecting squid
</A></li>
	<LI>Next message (by thread): <A HREF="023468.html">[squid-users] Protecting squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23466">[ date ]</a>
              <a href="thread.html#23466">[ thread ]</a>
              <a href="subject.html#23466">[ subject ]</a>
              <a href="author.html#23466">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
