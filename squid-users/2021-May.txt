From neven.vrenko at gmail.com  Sat May  1 21:23:13 2021
From: neven.vrenko at gmail.com (Neven Vrenko)
Date: Sat, 1 May 2021 23:23:13 +0200
Subject: [squid-users] Client certificate authentication problem
Message-ID: <CAF7xqN4A7uFevMn_YnqUp_3uNXfa8vOG9D0ROccXMXBpz42+bA@mail.gmail.com>

Message-ID:
        <248ca98d-1862-0ead-87c0-67a0aa408ea8 at measurement-factory.com>
Content-Type: text/plain; charset=utf-8

> On 4/30/21 4:40 AM, Neven Vrenko wrote:
> Hello Alex,
>
> thank you for your answer. I was little bit puzzled since I haven't got
> any error when using "clientca" with "http_port". I thought, maybe it
> was somehow possible, beyond my understanding. :)
>
> The reason why I didn't respond immediately, because I wanted to test
> everything with the "https_port" configuration.
>
> Now my configuration looks like this:
>
>> https_port 443 tls-cert=/etc/squid/certs/new-squid.cert
> tls-key=/etc/squid/certs/new-squid.key
> clientca=/etc/squid/certs/autn.pem capath=/etc/squid/certs/CAs sslcontext=id
>
> This works...
>
> What I'm trying to do is access control with *user_cert* ACL based on CN
> information.
>
> My ACL configuration is super minimal:
>
>> acl ssl_auth user_cert CN "/etc/squid/allowed.cn <http://allowed.cn>"
>> http_access allow ssl_auth
>>
>> http_access deny all
>
> File "/etc/squid/allowed.cn" contains one row/entry:
> "Doe John PKI 1234567890" (without quotes)
>
> However this doesn't work.
>
> From the cache.log, it is visible that client certificate information is
> fetched:
>
>> clientNegotiateSSL: New session 0x11415a0 on FD 12 (10.x.x.x:60308)
>> retrieveNegotiatedInfo: SSL connection info on FD 12 SSL version
> TLS/1.2 negotiated cipher AES128-GCM-SHA256
>> clientNegotiateSSL: FD 12 client certificate: subject: /DC=tst/CN=Doe
> John PKI 1234567890
>> clientNegotiateSSL: FD 12 client certificate: issuer:
> /DC=com/DC=tst/DC=PKI/CN=CA-AUTH-01
>> Server.cc(90) readSomeData: conn7 local=10.x.x.x:443
> remote=10.x.x.x:60308 FD 12 flags=1: reading request...
>
> From the cache.log is as well visible that ssl_auth ACL is checked, but
> there is NO MATCH:
>
>> Acl.cc(124) matches: checking http_access
>> Checklist.cc(398) bannedAction: Action 'ALLOWED/0' is not banned
>> Acl.cc(124) matches: checking http_access#1
>> Acl.cc(124) matches: checking ssl_auth     < --- Access list
>>
>> CertificateData.cc(68) match: CN=Doe John PKI 1234567890   < ---
> Client certificate CN
>>
>> MemBlob.cc(56) MemBlob: constructed, this=0x14dccc0 id=blob1388
> reserveSize=35
>> MemBlob.cc(101) memAlloc: blob1388 memAlloc: requested=35, received=40
>> SBuf.cc(866) reAlloc: SBuf5096 new store capacity: 40
>> StringData.cc(33) match: aclMatchStringList: checking 'Doe John PKI
> 1234567890'
>>
>> StringData.cc(36) match: aclMatchStringList: 'Doe John PKI 1234567890'
> NOT found   < --- doesn't match
>>
>> Acl.cc(151) matches: checked: ssl_auth = 0
>> Acl.cc(151) matches: checked: http_access#1 = 0
>
>
> I'm really not sure what I have missed...
> I tried to put CN directly in the ACL, so with no reference to thefile.
> I tried to put single and double quotes around CN in allowed.cn
> <http://allowed.cn> file, as well.
>
> Could you please help me further? What am I doing wrong here?

>I see no red flags in what you are describing and in the provided logs.
>Unfortunately, ACLStringData::match() does not log the strings it is
>comparing the configured ACL value against, and I lack the free time
>necessary to triage this further for you right now. Hopefully, somebody
>else will volunteer to triage this. It should not be very difficult to
>get to the bottom of it.


>Sorry,

>Alex.

Hi Alex,

thank you for your opinion and time you took for answering. I dove
into the code a little bit and did some debugging.
It seems that nothing is wrong there. What I did eventually, more out
of desperation than common sense, was restarting the whole machine,
rather than the Squid process for 1001st time.

That did the trick... Now everything is working... I don't have an
explanation for why, but now it works...

Thank you one again,
Neven


From vinod9987 at gmail.com  Mon May  3 20:10:48 2021
From: vinod9987 at gmail.com (vinod mg)
Date: Tue, 4 May 2021 01:40:48 +0530
Subject: [squid-users] Can I configure squid5 with Boring SSL
Message-ID: <CALLSHhx7BQRe-Yyo9=2sa_gU2tEtJsxkkJamPee3KCRhpLFftw@mail.gmail.com>

Hi Team,

I have followed -
https://www.interserver.net/tips/kb/openssl-vs-boringssl-boringssl-install-boringssl/
and was able to install in server's /home/src/boringssl

while configuring squid I am using below options -

./configure '--prefix=/opt/boring/squid5'
'--with-openssl=/home/src/boringssl' '--enable-ssl-crtd'
'--with-filedescriptors=3276800' '--enable-storeio=diskd,aufs,ufs'
'--with-large-files' '--enable-useragent-log' '--enable-ltdl-convenience'
'--with-tls' '--enable-http-violations'

while running 'make' I am getting below error, and I am not able to find
solution for this.

In file included from ../../src/ssl/support.h:21,

                 from ../../src/SquidConfig.h:29,

                 from old_api.cc:24:

../../src/ssl/gadgets.h:56:25: error: ?TXT_DB? was not declared in this
scope

 typedef std::unique_ptr<TXT_DB, HardFun<void, TXT_DB*, &TXT_DB_free>>
TXT_DB_Pointer;

../../src/ssl/gadgets.h:56:47: error: ?TXT_DB? was not declared in this
scope

 typedef std::unique_ptr<TXT_DB, HardFun<void, TXT_DB*, &TXT_DB_free>>
TXT_DB_Pointer;

../../src/ssl/gadgets.h:56:68: error: template argument 2 is invalid

 typedef std::unique_ptr<TXT_DB, HardFun<void, TXT_DB*, &TXT_DB_free>>
TXT_DB_Pointer;

../../src/ssl/gadgets.h:56:68: error: template argument 3 is invalid

../../src/ssl/gadgets.h:56:71: error: template argument 1 is invalid

 typedef std::unique_ptr<TXT_DB, HardFun<void, TXT_DB*, &TXT_DB_free>>
TXT_DB_Pointer;

../../src/ssl/gadgets.h:56:71: error: template argument 2 is invalid

../../src/ssl/gadgets.h:56:1: error: ?typedef? was ignored in this
declaration [-Werror]

 typedef std::unique_ptr<TXT_DB, HardFun<void, TXT_DB*, &TXT_DB_free>>
TXT_DB_Pointer;

cc1plus: all warnings being treated as errors

make[3]: *** [Makefile:840: old_api.lo] Error 1

make[3]: Leaving directory '/tmp/squid-5.0.5/src/mem'

make[2]: *** [Makefile:6851: all-recursive] Error 1

make[2]: Leaving directory '/tmp/squid-5.0.5/src'

make[1]: *** [Makefile:5840: all] Error 2

make[1]: Leaving directory '/tmp/squid-5.0.5/src'

make: *** [Makefile:593: all-recursive] Error 1

My node is running on - CentOS Linux release 8.3.2011
Squid version - 5.0.4
Installed Openssl version - OpenSSL 1.1.1g FIPS  21 Apr 2020

Thanks,
Vinod
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210504/eac566d7/attachment.htm>

From rousskov at measurement-factory.com  Mon May  3 20:42:16 2021
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Mon, 3 May 2021 16:42:16 -0400
Subject: [squid-users] Can I configure squid5 with Boring SSL
In-Reply-To: <CALLSHhx7BQRe-Yyo9=2sa_gU2tEtJsxkkJamPee3KCRhpLFftw@mail.gmail.com>
References: <CALLSHhx7BQRe-Yyo9=2sa_gU2tEtJsxkkJamPee3KCRhpLFftw@mail.gmail.com>
Message-ID: <b12da087-c2d9-095c-8b44-6e86768dfefb@measurement-factory.com>

Hello Vinod,

    Squid does not support BoringSSL, and we will not add such support
in the foreseeable future. We have more than enough troubles with GnuTLS
support and not enough resources to support a yet another TLS library,
especially the one that is not meant for general use[1]!

[1] https://boringssl.googlesource.com/boringssl/
Although BoringSSL is an open source project, it is not intended for
general use, as OpenSSL is. We don't recommend that third parties depend
upon it. Doing so is likely to be frustrating because there are no
guarantees of API or ABI stability.


HTH,

Alex.


On 5/3/21 4:10 PM, vinod mg wrote:
> Hi Team,
> 
> I have followed
> -?https://www.interserver.net/tips/kb/openssl-vs-boringssl-boringssl-install-boringssl/
> <https://www.interserver.net/tips/kb/openssl-vs-boringssl-boringssl-install-boringssl/>
> and was able to install in server's /home/src/boringssl
> 
> while configuring squid I am using below options -?
> 
> ./configure '--prefix=/opt/boring/squid5'
> '--with-openssl=/home/src/boringssl' '--enable-ssl-crtd'
> '--with-filedescriptors=3276800' '--enable-storeio=diskd,aufs,ufs'
> '--with-large-files' '--enable-useragent-log'
> '--enable-ltdl-convenience' '--with-tls' '--enable-http-violations'
> 
> 
> while running 'make' I am getting below error, and I am not able to find
> solution for this.
> 
> In file included from ../../src/ssl/support.h:21,
> 
> ?? ? ? ? ? ? ? ? from ../../src/SquidConfig.h:29,
> 
> ?? ? ? ? ? ? ? ? from old_api.cc:24:
> 
> ../../src/ssl/gadgets.h:56:25: error: ?TXT_DB? was not declared in this
> scope
> 
> ?typedef std::unique_ptr<TXT_DB, HardFun<void, TXT_DB*, &TXT_DB_free>>
> TXT_DB_Pointer;
> 
> ../../src/ssl/gadgets.h:56:47: error: ?TXT_DB? was not declared in this
> scope
> 
> ?typedef std::unique_ptr<TXT_DB, HardFun<void, TXT_DB*, &TXT_DB_free>>
> TXT_DB_Pointer;
> 
> ../../src/ssl/gadgets.h:56:68: error: template argument 2 is invalid
> 
> ?typedef std::unique_ptr<TXT_DB, HardFun<void, TXT_DB*, &TXT_DB_free>>
> TXT_DB_Pointer;
> 
> ../../src/ssl/gadgets.h:56:68: error: template argument 3 is invalid
> 
> ../../src/ssl/gadgets.h:56:71: error: template argument 1 is invalid
> 
> ?typedef std::unique_ptr<TXT_DB, HardFun<void, TXT_DB*, &TXT_DB_free>>
> TXT_DB_Pointer;
> 
> ../../src/ssl/gadgets.h:56:71: error: template argument 2 is invalid
> 
> ../../src/ssl/gadgets.h:56:1: error: ?typedef? was ignored in this
> declaration [-Werror]
> 
> ?typedef std::unique_ptr<TXT_DB, HardFun<void, TXT_DB*, &TXT_DB_free>>
> TXT_DB_Pointer;
> 
> cc1plus: all warnings being treated as errors
> 
> make[3]: *** [Makefile:840: old_api.lo] Error 1
> 
> make[3]: Leaving directory '/tmp/squid-5.0.5/src/mem'
> 
> make[2]: *** [Makefile:6851: all-recursive] Error 1
> 
> make[2]: Leaving directory '/tmp/squid-5.0.5/src'
> 
> make[1]: *** [Makefile:5840: all] Error 2
> 
> make[1]: Leaving directory '/tmp/squid-5.0.5/src'
> 
> make: *** [Makefile:593: all-recursive] Error 1
> 
> 
> My node is running on -?CentOS Linux release 8.3.2011
> Squid version -?5.0.4
> Installed Openssl version -?OpenSSL 1.1.1g FIPS? 21 Apr 2020
> 
> Thanks,
> Vinod
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 



From agnrie at hotmail.com  Mon May  3 21:14:09 2021
From: agnrie at hotmail.com (Aniruddha Gore)
Date: Mon, 3 May 2021 21:14:09 +0000
Subject: [squid-users] HTTPS request times out going through Squid proxy
In-Reply-To: <MW4PR15MB4524AC3130A7C0D346DD7D71D95B9@MW4PR15MB4524.namprd15.prod.outlook.com>
References: <MW4PR15MB4524AC3130A7C0D346DD7D71D95B9@MW4PR15MB4524.namprd15.prod.outlook.com>
Message-ID: <MW4PR15MB452469A0C3E520A35CD82AB3D95B9@MW4PR15MB4524.namprd15.prod.outlook.com>

Hello there,


Context I have an application running on a machine (A) that does not have internet connectivity. It, however, can talk to another machine (B) which has full connectivity. The application makes HTTPS calls. I am hoping to set-up Squid on B and set-up web proxy (ip address and port) when making HTTPS calls in the app. I have installed Squid for Windows<https://squid.diladele.com/> on B with default squid config.


Problem HTTPS requests are timing out.


I am new to proxy so don't know lot of ways to investigate further. This is what Wireshark captured running on B. Unfortunately, I am unable to gather any actionable info from this, it just confirms that calls do make it to B and then something wrong happens.

Attaching a capture from the Wireshark trace.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210503/85e1eed4/attachment.htm>

From jazjred at gmail.com  Tue May  4 03:07:08 2021
From: jazjred at gmail.com (Jazmine Redmond)
Date: Mon, 3 May 2021 20:07:08 -0700
Subject: [squid-users] Fwd: Squid Proxy Ignoring Hosts File?
In-Reply-To: <1203019456.371819.1620097409122@connect.xfinity.com>
References: <1203019456.371819.1620097409122@connect.xfinity.com>
Message-ID: <CA+WwRd9tJczo4r0SSbv0zKLXA6Mg=mUhPeUbUNEqxe+faAdBxQ@mail.gmail.com>

Hi,

I am having issues configuring Squid using a proxy to resolve host names
specified in a host file. While using the proxy I can navigate to other
website domains successfully, however when I try to use a name specified in
my hosts file then I receive this page in my browser:

I have configured the host file on my machine to resolve the IP address:

In the Squid configuration folder I've added the following line:

It seems what I've added to my hosts file is being ignored by the Squid
proxy server. I have ensured the path is correct and I restart my Squid
each time I make edits to any configuration files yet the error persists. I'm
wondering if there is something I am missing in the configuration or
elsewhere. I've attached my entire Squid configuration file for further
reference. I am running Squid version 3.5.28 on Windows

Thank you in advance,

Jazmine Redmond
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210503/1f0e941e/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image.png
Type: image/png
Size: 38060 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210503/1f0e941e/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image.png
Type: image/png
Size: 6859 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210503/1f0e941e/attachment-0001.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image.png
Type: image/png
Size: 3484 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210503/1f0e941e/attachment-0002.png>
-------------- next part --------------
#
# Recommended minimum configuration:
#

# Example rule allowing access from your local networks.
# Adapt to list your (internal) IP networks from where browsing
# should be allowed

acl localnet src 10.0.0.0/8	# RFC1918 possible internal network
acl localnet src 172.16.0.0/12	# RFC1918 possible internal network
acl localnet src 192.168.0.0/16	# RFC1918 possible internal network
acl localnet src fc00::/7       # RFC 4193 local private network range
acl localnet src fe80::/10      # RFC 4291 link-local (directly plugged) machines

acl SSL_ports port 443
acl Safe_ports port 80		# http
acl Safe_ports port 21		# ftp
acl Safe_ports port 443		# https
acl Safe_ports port 70		# gopher
acl Safe_ports port 210		# wais
acl Safe_ports port 1025-65535	# unregistered ports
acl Safe_ports port 280		# http-mgmt
acl Safe_ports port 488		# gss-http
acl Safe_ports port 591		# filemaker
acl Safe_ports port 777		# multiling http
acl CONNECT method CONNECT

#
# Recommended minimum Access Permission configuration:
#

# Only allow cachemgr access from localhost
http_access allow localhost manager
http_access deny manager

# Deny requests to certain unsafe ports
http_access deny !Safe_ports

# Deny CONNECT to other than secure SSL ports
http_access deny CONNECT !SSL_ports

# We strongly recommend the following be uncommented to protect innocent
# web applications running on the proxy server who think the only
# one who can access services on "localhost" is a local user
#http_access deny to_localhost

#
# INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
#

# Example rule allowing access from your local networks.
# Adapt localnet in the ACL section to list your (internal) IP networks
# from where browsing should be allowed
http_access allow localnet
http_access allow localhost

# And finally deny all other access to this proxy
http_access allow all

# Squid normally listens to port 3128
http_port 3128

# Uncomment the line below to enable disk caching - path format is /cygdrive/<full path to cache folder>, i.e.
#cache_dir aufs /cygdrive/d/squid/cache 3000 16 256

# Leave coredumps in the first cache dir
coredump_dir /var/cache/squid

# Use a different hosts file? 
hosts_file C:/Windows/System32/drivers/etc/hosts


# Add any of your own refresh_pattern entries above these.
refresh_pattern ^ftp:		1440	20%	10080
refresh_pattern ^gopher:	1440	0%	1440
refresh_pattern -i (/cgi-bin/|\?) 0	0%	0
refresh_pattern .		0	20%	4320

dns_nameservers 8.8.8.8 208.67.222.222

max_filedescriptors 3200

From roierachamim at gmail.com  Tue May  4 05:16:58 2021
From: roierachamim at gmail.com (roie rachamim)
Date: Tue, 4 May 2021 08:16:58 +0300
Subject: [squid-users] Squid complains on missing Intermediate certificate
 in version 4.14 and 5.0.5
Message-ID: <CAD=NrcAXG6RyoZhROd9yTeXBBfv8AZwwNcaF+MAYh3RZ0OVrvw@mail.gmail.com>

Hi,

When trying to reach some times via https e.g. https://acadamy.atera.com

Squid complains on missing Intermediate certificate.
I see this in the logs:

2021/05/03 10:58:14.554| 83,4| support.cc(1147) untrustedToStoreCtx_cb: Try
to use pre-downloaded intermediate certificates
2021/05/03 10:58:14.554| 83,5| support.cc(333) ssl_verify_cb: Unable to get
local issuer certificate: /CN=*.atera.com

>From what i saw in the Wiki Squid 4 should include a mechanism to download
required intermediate certificate, So does what i see make sense ?

Many Thanks,
Roie
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210504/9e2a20cc/attachment.htm>

From vinod9987 at gmail.com  Tue May  4 09:33:46 2021
From: vinod9987 at gmail.com (vinod mg)
Date: Tue, 4 May 2021 15:03:46 +0530
Subject: [squid-users] Can I configure squid5 with Boring SSL
In-Reply-To: <b12da087-c2d9-095c-8b44-6e86768dfefb@measurement-factory.com>
References: <CALLSHhx7BQRe-Yyo9=2sa_gU2tEtJsxkkJamPee3KCRhpLFftw@mail.gmail.com>
 <b12da087-c2d9-095c-8b44-6e86768dfefb@measurement-factory.com>
Message-ID: <CALLSHhx9DRuf6guFT1nQe_YMi7Df7bwJ-eLT2qjZ-pCBZ=9FmQ@mail.gmail.com>

Hi Alex,

Thanks for confirming this, it saved me lot of time :)

The reason why I wanted to try build squid5 with BoringSSL is -
1) Current squid build with OpenSSL is not showing transactional ciphers
while browsing via chrome eg: (TLS_GREASE_DA), (TLS_GREASE_IS_THE_WORD_BA)
--> is there any way to add these?
2) I am unable to supress Named group 'secp521r1' while going via this
squid build on chrome browser. --> Is there any way to supress this?

I am using - https://browserleaks.com/ssl and https://www.howsmyssl.com to
check above parameters.

I am using below configs with OpenSSL and it works fine except for above
mentioned issues.

acl manager proto cache_object
acl localnet src 10.0.0.0/8 # RFC1918 possible internal network
acl localnet src 172.16.0.0/12 # RFC1918 possible internal network
acl localnet src 192.168.0.0/16 # RFC1918 possible internal network
acl SSL_ports port 443
acl SSL_ports port 8443
acl Safe_ports port 80 # http
acl Safe_ports port 21 # ftp
acl Safe_ports port 443 # https
acl Safe_ports port 70 # gopher
acl Safe_ports port 210 # wais
acl Safe_ports port 1025-65535 # unregistered ports
acl Safe_ports port 280 # http-mgmt
acl Safe_ports port 488 # gss-http
acl Safe_ports port 591 # filemaker
acl Safe_ports port 777 # multiling http
acl Safe_ports port 8443 # multiling http
acl CONNECT method CONNECT
acl intermediate_fetching transaction_initiator certificate-fetching
http_access allow intermediate_fetching
http_access allow manager localhost
http_access deny manager
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
acl blocked_sites ssl::server_name .apple.com
acl amazon_deny dstdomain "/opt/squid/squid5/etc/blockdomains"
http_access allow localnet
http_access allow localhost
http_access deny blocked_sites
http_access deny amazon_deny
http_access allow all
http_port 443 ssl-bump generate-host-certificates=on
dynamic_cert_mem_cache_size=512MB
tls-cert=/opt/squid/squid5/etc/certs/ProxyBump.crt
tls-key=/opt/squid/squid5/etc/certs/ProxyBump.key
tls-dh=prime256v1:/opt/squid/squid5/etc/certs/ProxyBump.pem
sslcrtd_program /opt/squid/squid5/libexec/security_file_certgen -s
/var/lib/squid/ssl_db -M 512MB
sslproxy_cert_error allow all
acl step1 at_step SslBump1
ssl_bump peek step1
ssl_bump bump all
ssl_bump splice all
tls_outgoing_options
cipher=HIGH:!MEDIUM:!RC4:!aNULL:!eNULL:!LOW:!3DES:!MD5:!EXP:!PSK:!SRP:!DSS
options=NO_SSLv3,SINGLE_DH_USE,SINGLE_ECDH_USE
cache_mem 1024 MB
cache deny all
cache_dir aufs /opt/squid/squid5/var/cache/squid 1024 16 256
shutdown_lifetime 2 seconds
coredump_dir /opt/squid/squid5/var/cache/squid
refresh_pattern ^ftp: 1440 20% 10080
refresh_pattern ^gopher: 1440 0% 1440
refresh_pattern -i (/cgi-bin/|\?) 0 0% 0
refresh_pattern . 0 20% 4320
cache_peer 10.12.11.2 parent 8080 0 no-query default login=abc:abc at 123
never_direct allow all
server_persistent_connections off
logfile_rotate 30
via off
forwarded_for delete
visible_hostname localhost
logformat squid  %ts.%03tu %6tr %>a %Ss/%03>Hs %<st %rm %ru %[un %Sh/%<A
%mt %>h %Se %>sh
logformat extended  %tl %6tr %>a %Ss/%03Hs %<st %rm %ru %un %Sh/%<A %mt %Hs
%<st "%{Referer}>h" "%{User-agent}>h"
cache_log /opt/squid/squid5/var/logs/cache.log
acl hasRequest has request
access_log none !hasRequest
access_log stdio:/opt/squid/squid5/var/logs/access.log
access_log stdio:/opt/squid/squid5/var/logs/access.log.mitm extended
pid_filename /opt/squid/squid5/var/run/squid.pid
max_filedescriptors 5000

Any help is appreciated. Thanks in advance!

Thanks,
Vinod

On Tue, May 4, 2021 at 2:12 AM Alex Rousskov <
rousskov at measurement-factory.com> wrote:

> Hello Vinod,
>
>     Squid does not support BoringSSL, and we will not add such support
> in the foreseeable future. We have more than enough troubles with GnuTLS
> support and not enough resources to support a yet another TLS library,
> especially the one that is not meant for general use[1]!
>
> [1] https://boringssl.googlesource.com/boringssl/
> Although BoringSSL is an open source project, it is not intended for
> general use, as OpenSSL is. We don't recommend that third parties depend
> upon it. Doing so is likely to be frustrating because there are no
> guarantees of API or ABI stability.
>
>
> HTH,
>
> Alex.
>
>
> On 5/3/21 4:10 PM, vinod mg wrote:
> > Hi Team,
> >
> > I have followed
> > -
> https://www.interserver.net/tips/kb/openssl-vs-boringssl-boringssl-install-boringssl/
> > <
> https://www.interserver.net/tips/kb/openssl-vs-boringssl-boringssl-install-boringssl/
> >
> > and was able to install in server's /home/src/boringssl
> >
> > while configuring squid I am using below options -
> >
> > ./configure '--prefix=/opt/boring/squid5'
> > '--with-openssl=/home/src/boringssl' '--enable-ssl-crtd'
> > '--with-filedescriptors=3276800' '--enable-storeio=diskd,aufs,ufs'
> > '--with-large-files' '--enable-useragent-log'
> > '--enable-ltdl-convenience' '--with-tls' '--enable-http-violations'
> >
> >
> > while running 'make' I am getting below error, and I am not able to find
> > solution for this.
> >
> > In file included from ../../src/ssl/support.h:21,
> >
> >                  from ../../src/SquidConfig.h:29,
> >
> >                  from old_api.cc:24:
> >
> > ../../src/ssl/gadgets.h:56:25: error: ?TXT_DB? was not declared in this
> > scope
> >
> >  typedef std::unique_ptr<TXT_DB, HardFun<void, TXT_DB*, &TXT_DB_free>>
> > TXT_DB_Pointer;
> >
> > ../../src/ssl/gadgets.h:56:47: error: ?TXT_DB? was not declared in this
> > scope
> >
> >  typedef std::unique_ptr<TXT_DB, HardFun<void, TXT_DB*, &TXT_DB_free>>
> > TXT_DB_Pointer;
> >
> > ../../src/ssl/gadgets.h:56:68: error: template argument 2 is invalid
> >
> >  typedef std::unique_ptr<TXT_DB, HardFun<void, TXT_DB*, &TXT_DB_free>>
> > TXT_DB_Pointer;
> >
> > ../../src/ssl/gadgets.h:56:68: error: template argument 3 is invalid
> >
> > ../../src/ssl/gadgets.h:56:71: error: template argument 1 is invalid
> >
> >  typedef std::unique_ptr<TXT_DB, HardFun<void, TXT_DB*, &TXT_DB_free>>
> > TXT_DB_Pointer;
> >
> > ../../src/ssl/gadgets.h:56:71: error: template argument 2 is invalid
> >
> > ../../src/ssl/gadgets.h:56:1: error: ?typedef? was ignored in this
> > declaration [-Werror]
> >
> >  typedef std::unique_ptr<TXT_DB, HardFun<void, TXT_DB*, &TXT_DB_free>>
> > TXT_DB_Pointer;
> >
> > cc1plus: all warnings being treated as errors
> >
> > make[3]: *** [Makefile:840: old_api.lo] Error 1
> >
> > make[3]: Leaving directory '/tmp/squid-5.0.5/src/mem'
> >
> > make[2]: *** [Makefile:6851: all-recursive] Error 1
> >
> > make[2]: Leaving directory '/tmp/squid-5.0.5/src'
> >
> > make[1]: *** [Makefile:5840: all] Error 2
> >
> > make[1]: Leaving directory '/tmp/squid-5.0.5/src'
> >
> > make: *** [Makefile:593: all-recursive] Error 1
> >
> >
> > My node is running on - CentOS Linux release 8.3.2011
> > Squid version - 5.0.4
> > Installed Openssl version - OpenSSL 1.1.1g FIPS  21 Apr 2020
> >
> > Thanks,
> > Vinod
> >
> > _______________________________________________
> > squid-users mailing list
> > squid-users at lists.squid-cache.org
> > http://lists.squid-cache.org/listinfo/squid-users
> >
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210504/728af526/attachment.htm>

From rousskov at measurement-factory.com  Tue May  4 13:45:15 2021
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Tue, 4 May 2021 09:45:15 -0400
Subject: [squid-users] Can I configure squid5 with Boring SSL
In-Reply-To: <CALLSHhx9DRuf6guFT1nQe_YMi7Df7bwJ-eLT2qjZ-pCBZ=9FmQ@mail.gmail.com>
References: <CALLSHhx7BQRe-Yyo9=2sa_gU2tEtJsxkkJamPee3KCRhpLFftw@mail.gmail.com>
 <b12da087-c2d9-095c-8b44-6e86768dfefb@measurement-factory.com>
 <CALLSHhx9DRuf6guFT1nQe_YMi7Df7bwJ-eLT2qjZ-pCBZ=9FmQ@mail.gmail.com>
Message-ID: <dccdf35b-acb1-6da3-6f71-18fbc61899d8@measurement-factory.com>

On 5/4/21 5:33 AM, vinod mg wrote:

> 1) Current squid build with OpenSSL is not showing transactional ciphers
> while browsing via chrome eg: (TLS_GREASE_DA),
> (TLS_GREASE_IS_THE_WORD_BA)? --> is there any way to add these?

> 2) I am unable to supress?Named group 'secp521r1' while going via this
> squid build on chrome browser. --> Is there any way to supress?this?

I do not know the answers to your questions, but they sound like OpenSSL
questions (rather than Squid questions) to me. AFAIK, Squid code is
unaware of the concepts you are talking about -- it just passes your
configuration to OpenSSL. If OpenSSL can be configured to do what you
want, then, in most cases, you can configure Squid+OpenSSL to do that.

Alex.


> I am using -?https://browserleaks.com/ssl <https://browserleaks.com/ssl>
> and?https://www.howsmyssl.com <https://www.howsmyssl.com> to check above
> parameters.
> 
> I am using below configs with OpenSSL and it works fine except for above
> mentioned issues.
> 
> acl manager proto cache_object
> acl localnet src 10.0.0.0/8 <http://10.0.0.0/8>	# RFC1918 possible
> internal network
> acl localnet src 172.16.0.0/12 <http://172.16.0.0/12>	# RFC1918 possible
> internal network
> acl localnet src 192.168.0.0/16 <http://192.168.0.0/16>	# RFC1918
> possible internal network
> acl SSL_ports port 443
> acl SSL_ports port 8443
> acl Safe_ports port 80 # http
> acl Safe_ports port 21 # ftp
> acl Safe_ports port 443 # https
> acl Safe_ports port 70 # gopher
> acl Safe_ports port 210 # wais
> acl Safe_ports port 1025-65535 # unregistered ports
> acl Safe_ports port 280 # http-mgmt
> acl Safe_ports port 488 # gss-http
> acl Safe_ports port 591 # filemaker
> acl Safe_ports port 777 # multiling http
> acl Safe_ports port 8443 # multiling http
> acl CONNECT method CONNECT
> acl intermediate_fetching transaction_initiator certificate-fetching
> http_access allow intermediate_fetching
> http_access allow manager localhost
> http_access deny manager
> http_access deny !Safe_ports
> http_access deny CONNECT !SSL_ports
> acl blocked_sites ssl::server_name .apple.com <http://apple.com>
> acl amazon_deny dstdomain "/opt/squid/squid5/etc/blockdomains"
> http_access allow localnet
> http_access allow localhost
> http_access deny blocked_sites
> http_access deny amazon_deny
> http_access allow all
> http_port 443 ssl-bump generate-host-certificates=on
> dynamic_cert_mem_cache_size=512MB
> tls-cert=/opt/squid/squid5/etc/certs/ProxyBump.crt
> tls-key=/opt/squid/squid5/etc/certs/ProxyBump.key
> tls-dh=prime256v1:/opt/squid/squid5/etc/certs/ProxyBump.pem
> sslcrtd_program /opt/squid/squid5/libexec/security_file_certgen -s
> /var/lib/squid/ssl_db -M 512MB
> sslproxy_cert_error allow all
> acl step1 at_step SslBump1
> ssl_bump peek step1
> ssl_bump bump all
> ssl_bump splice all
> tls_outgoing_options
> cipher=HIGH:!MEDIUM:!RC4:!aNULL:!eNULL:!LOW:!3DES:!MD5:!EXP:!PSK:!SRP:!DSS
> options=NO_SSLv3,SINGLE_DH_USE,SINGLE_ECDH_USE
> cache_mem 1024 MB
> cache deny all
> cache_dir aufs /opt/squid/squid5/var/cache/squid 1024 16 256
> shutdown_lifetime 2 seconds
> coredump_dir /opt/squid/squid5/var/cache/squid
> refresh_pattern ^ftp: 1440 20% 10080
> refresh_pattern ^gopher: 1440 0% 1440
> refresh_pattern -i (/cgi-bin/|\?) 0 0% 0
> refresh_pattern . 0 20% 4320
> cache_peer 10.12.11.2 parent 8080 0 no-query default login=abc:abc at 123
> never_direct allow all
> server_persistent_connections off
> logfile_rotate 30
> via off
> forwarded_for delete
> visible_hostname localhost
> logformat squid ?%ts.%03tu %6tr %>a %Ss/%03>Hs %<st %rm %ru %[un %Sh/%<A
> %mt %>h %Se %>sh
> logformat extended ?%tl %6tr %>a %Ss/%03Hs %<st %rm %ru %un %Sh/%<A %mt
> %Hs %<st "%{Referer}>h" "%{User-agent}>h"
> cache_log /opt/squid/squid5/var/logs/cache.log
> acl hasRequest has request
> access_log none !hasRequest
> access_log stdio:/opt/squid/squid5/var/logs/access.log
> access_log stdio:/opt/squid/squid5/var/logs/access.log.mitm extended
> pid_filename /opt/squid/squid5/var/run/squid.pid
> max_filedescriptors 5000
> 
> Any help is appreciated. Thanks in advance!
> 
> Thanks,
> Vinod
> 
> On Tue, May 4, 2021 at 2:12 AM Alex Rousskov
> <rousskov at measurement-factory.com
> <mailto:rousskov at measurement-factory.com>> wrote:
> 
>     Hello Vinod,
> 
>     ? ? Squid does not support BoringSSL, and we will not add such support
>     in the foreseeable future. We have more than enough troubles with GnuTLS
>     support and not enough resources to support a yet another TLS library,
>     especially the one that is not meant for general use[1]!
> 
>     [1] https://boringssl.googlesource.com/boringssl/
>     <https://boringssl.googlesource.com/boringssl/>
>     Although BoringSSL is an open source project, it is not intended for
>     general use, as OpenSSL is. We don't recommend that third parties depend
>     upon it. Doing so is likely to be frustrating because there are no
>     guarantees of API or ABI stability.
> 
> 
>     HTH,
> 
>     Alex.
> 
> 
>     On 5/3/21 4:10 PM, vinod mg wrote:
>     > Hi Team,
>     >
>     > I have followed
>     >
>     -?https://www.interserver.net/tips/kb/openssl-vs-boringssl-boringssl-install-boringssl/
>     <https://www.interserver.net/tips/kb/openssl-vs-boringssl-boringssl-install-boringssl/>
>     >
>     <https://www.interserver.net/tips/kb/openssl-vs-boringssl-boringssl-install-boringssl/
>     <https://www.interserver.net/tips/kb/openssl-vs-boringssl-boringssl-install-boringssl/>>
>     > and was able to install in server's /home/src/boringssl
>     >
>     > while configuring squid I am using below options -?
>     >
>     > ./configure '--prefix=/opt/boring/squid5'
>     > '--with-openssl=/home/src/boringssl' '--enable-ssl-crtd'
>     > '--with-filedescriptors=3276800' '--enable-storeio=diskd,aufs,ufs'
>     > '--with-large-files' '--enable-useragent-log'
>     > '--enable-ltdl-convenience' '--with-tls' '--enable-http-violations'
>     >
>     >
>     > while running 'make' I am getting below error, and I am not able
>     to find
>     > solution for this.
>     >
>     > In file included from ../../src/ssl/support.h:21,
>     >
>     > ?? ? ? ? ? ? ? ? from ../../src/SquidConfig.h:29,
>     >
>     > ?? ? ? ? ? ? ? ? from old_api.cc:24:
>     >
>     > ../../src/ssl/gadgets.h:56:25: error: ?TXT_DB? was not declared in
>     this
>     > scope
>     >
>     > ?typedef std::unique_ptr<TXT_DB, HardFun<void, TXT_DB*, &TXT_DB_free>>
>     > TXT_DB_Pointer;
>     >
>     > ../../src/ssl/gadgets.h:56:47: error: ?TXT_DB? was not declared in
>     this
>     > scope
>     >
>     > ?typedef std::unique_ptr<TXT_DB, HardFun<void, TXT_DB*, &TXT_DB_free>>
>     > TXT_DB_Pointer;
>     >
>     > ../../src/ssl/gadgets.h:56:68: error: template argument 2 is invalid
>     >
>     > ?typedef std::unique_ptr<TXT_DB, HardFun<void, TXT_DB*, &TXT_DB_free>>
>     > TXT_DB_Pointer;
>     >
>     > ../../src/ssl/gadgets.h:56:68: error: template argument 3 is invalid
>     >
>     > ../../src/ssl/gadgets.h:56:71: error: template argument 1 is invalid
>     >
>     > ?typedef std::unique_ptr<TXT_DB, HardFun<void, TXT_DB*, &TXT_DB_free>>
>     > TXT_DB_Pointer;
>     >
>     > ../../src/ssl/gadgets.h:56:71: error: template argument 2 is invalid
>     >
>     > ../../src/ssl/gadgets.h:56:1: error: ?typedef? was ignored in this
>     > declaration [-Werror]
>     >
>     > ?typedef std::unique_ptr<TXT_DB, HardFun<void, TXT_DB*, &TXT_DB_free>>
>     > TXT_DB_Pointer;
>     >
>     > cc1plus: all warnings being treated as errors
>     >
>     > make[3]: *** [Makefile:840: old_api.lo] Error 1
>     >
>     > make[3]: Leaving directory '/tmp/squid-5.0.5/src/mem'
>     >
>     > make[2]: *** [Makefile:6851: all-recursive] Error 1
>     >
>     > make[2]: Leaving directory '/tmp/squid-5.0.5/src'
>     >
>     > make[1]: *** [Makefile:5840: all] Error 2
>     >
>     > make[1]: Leaving directory '/tmp/squid-5.0.5/src'
>     >
>     > make: *** [Makefile:593: all-recursive] Error 1
>     >
>     >
>     > My node is running on -?CentOS Linux release 8.3.2011
>     > Squid version -?5.0.4
>     > Installed Openssl version -?OpenSSL 1.1.1g FIPS? 21 Apr 2020
>     >
>     > Thanks,
>     > Vinod
>     >
>     > _______________________________________________
>     > squid-users mailing list
>     > squid-users at lists.squid-cache.org
>     <mailto:squid-users at lists.squid-cache.org>
>     > http://lists.squid-cache.org/listinfo/squid-users
>     <http://lists.squid-cache.org/listinfo/squid-users>
>     >
> 



From rousskov at measurement-factory.com  Tue May  4 15:30:23 2021
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Tue, 4 May 2021 11:30:23 -0400
Subject: [squid-users] Squid complains on missing Intermediate
 certificate in version 4.14 and 5.0.5
In-Reply-To: <CAD=NrcAXG6RyoZhROd9yTeXBBfv8AZwwNcaF+MAYh3RZ0OVrvw@mail.gmail.com>
References: <CAD=NrcAXG6RyoZhROd9yTeXBBfv8AZwwNcaF+MAYh3RZ0OVrvw@mail.gmail.com>
Message-ID: <19cd6614-9277-4ae6-e03b-cd7c4085c7b0@measurement-factory.com>

On 5/4/21 1:16 AM, roie rachamim wrote:

> When trying to reach some times via https e.g. https://acadamy.atera.com
> 
> Squid complains on missing Intermediate certificate.
> I see this in the logs:
> 
> 2021/05/03 10:58:14.554| 83,4| support.cc(1147) untrustedToStoreCtx_cb:
> Try to use pre-downloaded intermediate certificates
> 2021/05/03 10:58:14.554| 83,5| support.cc(333) ssl_verify_cb: Unable to
> get local issuer certificate: /CN=*.atera.com <http://atera.com>
> 
> From what i saw in the Wiki Squid 4 should include a mechanism to
> download required intermediate certificate, So does what i see make sense ?

I see no red flags in those two cache.log lines.

* If this is a TLS v1.3 connection, then you need to try with the latest
v5 snapshot to get commit 4624a2e. See Bug 5067 for more info:
https://bugs.squid-cache.org/show_bug.cgi?id=5067

* Otherwise, more information is needed to figure out why Squid did not
try to fetch the missing certificates, tried but failed, or succeeded
but they were not enough to validate. To know whether Squid tried to
fetch intermediate certificates, you can check access.log. For more
details, consider sharing debugging cache.log of the whole problematic
transaction.

https://wiki.squid-cache.org/SquidFaq/BugReporting#Debugging_a_single_transaction


HTH,
 Alex.


From admin at pinglabs.co.uk  Wed May  5 14:03:25 2021
From: admin at pinglabs.co.uk (Ping Technology Labs LTD)
Date: Wed, 5 May 2021 15:03:25 +0100
Subject: [squid-users] Advanced Dynamic/Conditional Squid Configuration
Message-ID: <CAMtE0smauJ9LpQ82yng5cqVp58fqvb33EdwDstYcGJouObFvfw@mail.gmail.com>

Hello,
We currently have a squid system which handles outgoing requests through
thousands of IP addresses and hundreds of users. We want to change the
system and make it more complex but we are unsure if some of our "wants"
are even possible within squid-cache:

1. Replace Htpasswd users file with syncing to an external MySQL database
which manages users
2. Logging which syncs to an external MySQL database
3. Conditional / Dynamic Rules, for instance:
Serving each request with a different outbound IP
If user_X serve IP_1, If user_Y serve IP_2
Pulls outgoing IPs list from a server and then rotates through etc
I believe 1 & 2 to be possible but not quite sure if you 3 is possible in
squid or any other software.

If anyone would can give some guidance or is looking for a project we are
looking to hire someone to help us build our this system. Email:
admin at pinglabs.co.uk

Many Thanks,
Ping Technology Labs LTD
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210505/4cfdcdb7/attachment.htm>

From agnrie at hotmail.com  Thu May  6 01:06:44 2021
From: agnrie at hotmail.com (Aniruddha Gore)
Date: Thu, 6 May 2021 01:06:44 +0000
Subject: [squid-users] HTTPS request times out going through Squid proxy
In-Reply-To: <MW4PR15MB452469A0C3E520A35CD82AB3D95B9@MW4PR15MB4524.namprd15.prod.outlook.com>
References: <MW4PR15MB4524AC3130A7C0D346DD7D71D95B9@MW4PR15MB4524.namprd15.prod.outlook.com>,
 <MW4PR15MB452469A0C3E520A35CD82AB3D95B9@MW4PR15MB4524.namprd15.prod.outlook.com>
Message-ID: <MW4PR15MB45247FBE0AB19C63BEB2D335D9589@MW4PR15MB4524.namprd15.prod.outlook.com>

Hello again,

Pinging back hoping to get some help. I suspect I am missing something very basic and would really appreciate if someone could point me in the right direction. :)


________________________________
From: squid-users <squid-users-bounces at lists.squid-cache.org> on behalf of Aniruddha Gore <agnrie at hotmail.com>
Sent: Monday, May 3, 2021 2:14 PM
To: squid-users at lists.squid-cache.org <squid-users at lists.squid-cache.org>
Subject: [squid-users] HTTPS request times out going through Squid proxy

Hello there,


Context I have an application running on a machine (A) that does not have internet connectivity. It, however, can talk to another machine (B) which has full connectivity. The application makes HTTPS calls. I am hoping to set-up Squid on B and set-up web proxy (ip address and port) when making HTTPS calls in the app. I have installed Squid for Windows<https://na01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fsquid.diladele.com%2F&data=04%7C01%7C%7C51a192d767494cb9611c08d90e786a74%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C637556732608034593%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&sdata=gzK6Yzyid07bLdhctILNqdTjKwIneouGwKmCS78tRA8%3D&reserved=0> on B with default squid config.


Problem HTTPS requests are timing out.


I am new to proxy so don't know lot of ways to investigate further. This is what Wireshark captured running on B. Unfortunately, I am unable to gather any actionable info from this, it just confirms that calls do make it to B and then something wrong happens.

Attaching a capture from the Wireshark trace.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210506/e4cd426f/attachment.htm>

From jazjred at gmail.com  Thu May  6 04:09:09 2021
From: jazjred at gmail.com (Jazmine Redmond)
Date: Wed, 5 May 2021 21:09:09 -0700
Subject: [squid-users] Squid not using hosts file
Message-ID: <CA+WwRd9G_Bjzcnz3aU5N3unnYC4A7pUzABUg8sO9PK4t3M9PzA@mail.gmail.com>

 Hi,

I am having issues getting Squid to use the hosts file on the squid server.

I added the hosts_file configuration directive to my squid config file as
follows:

hosts_file  C:/Windows/System32/drivers/etc/hosts

But, when my squid client browser specifies a URL with a machine name
listed in the hosts file, squid returns an error that says:

?Unable to determine IP address from host name. The DNS server returned:
Name Error: the domain name does not exist. This means that the cache was
not able to resolve the hostname presented in the URL.?

So, it seems that squid is NOT using my hosts file.

I have tried using forward slashes (/) and backward slashes (\) in the
hosts_file configuration directive, yet the error persists.

I have verified the path to the hosts file is correct and I restart Squid
each time I make edits to the configuration file. Yet the error persists.

I am running Squid version 3.5.28 on Windows 10.

Am I missing something?

Thanks,
Jazmine
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210505/6403cfb7/attachment.htm>

From uhlar at fantomas.sk  Thu May  6 06:12:18 2021
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Thu, 6 May 2021 08:12:18 +0200
Subject: [squid-users] HTTPS request times out going through Squid proxy
In-Reply-To: <MW4PR15MB45247FBE0AB19C63BEB2D335D9589@MW4PR15MB4524.namprd15.prod.outlook.com>
References: <MW4PR15MB4524AC3130A7C0D346DD7D71D95B9@MW4PR15MB4524.namprd15.prod.outlook.com>
 <MW4PR15MB452469A0C3E520A35CD82AB3D95B9@MW4PR15MB4524.namprd15.prod.outlook.com>
 <MW4PR15MB45247FBE0AB19C63BEB2D335D9589@MW4PR15MB4524.namprd15.prod.outlook.com>
Message-ID: <20210506061218.GA12715@fantomas.sk>

On 06.05.21 01:06, Aniruddha Gore wrote:
> Pinging back hoping to get some help.  I suspect I am missing something
> very basic and would really appreciate if someone could point me in the
> right direction.  :)

Hello,

I haven't seen your packet trace but so far it shouldn't be needed.

> Context I have an application running on a machine (A) that does not have
> internet connectivity.  It, however, can talk to another machine (B) which
> has full connectivity.  The application makes HTTPS calls.  I am hoping to
> set-up Squid on B and set-up web proxy (ip address and port) when making
> HTTPS calls in the app.

have you set up your squid host:port as HTTP proxy in the application?
Can you see anything in squid logs?

> I have installed Squid for
> Windows<https://na01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fsquid.diladele.com%2F&data=04%7C01%7C%7C51a192d767494cb9611c08d90e786a74%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C637556732608034593%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&sdata=gzK6Yzyid07bLdhctILNqdTjKwIneouGwKmCS78tRA8%3D&reserved=0>
> on B with default squid config.
>
>
> Problem HTTPS requests are timing out.
>
>
> I am new to proxy so don't know lot of ways to investigate further.  This
> is what Wireshark captured running on B.  Unfortunately, I am unable to
> gather any actionable info from this, it just confirms that calls do make
> it to B and then something wrong happens.

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
   One OS to rule them all, One OS to find them,
One OS to bring them all and into darkness bind them


From rousskov at measurement-factory.com  Thu May  6 14:04:26 2021
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Thu, 6 May 2021 10:04:26 -0400
Subject: [squid-users] Squid not using hosts file
In-Reply-To: <CA+WwRd9G_Bjzcnz3aU5N3unnYC4A7pUzABUg8sO9PK4t3M9PzA@mail.gmail.com>
References: <CA+WwRd9G_Bjzcnz3aU5N3unnYC4A7pUzABUg8sO9PK4t3M9PzA@mail.gmail.com>
Message-ID: <7d081eaf-0060-e004-5144-06fdc89e6049@measurement-factory.com>

On 5/6/21 12:09 AM, Jazmine Redmond wrote:
> Hi,?
> 
> I am having issues getting Squid to use the hosts file on the squid server.
> ?
> I added the hosts_file configuration directive to my squid config file
> as follows:
> ?
> hosts_file? C:/Windows/System32/drivers/etc/hosts
> ?
> But, when my squid client browser specifies a URL with a machine name
> listed in the hosts file, squid returns an error that says:
> ?
> ?Unable to determine IP address from host name. The DNS server returned:
> Name Error: the domain name does not exist. This means that the cache
> was not able to resolve the hostname presented in the URL.?
> ?
> So, it seems that squid is NOT using my hosts file.
> ?
> I have tried using forward slashes (/) and backward slashes (\) in the
> hosts_file configuration directive, yet the error persists.
> ?
> I have verified the path to the hosts file is correct and I restart
> Squid each time I make edits to the configuration file. Yet the error
> persists.
> ?
> I am running Squid version 3.5.28 on Windows 10.
> ?
> Am I missing something?

Supported Squid versions are known to use /etc/hosts file. I do not know
whether there are any Windows-specific or v3-specific bugs in that area.
Unfortunately, very few people responding on this mailing list are using
Squid v3 and Squid on Windows in general. That is probably why you are
not getting any responses.

If you can try a supported Squid version, please do so (especially if
you can try it on Linux). You may also share a pointer to a compressed
cache.log after setting debug_options to ALL,9 in case somebody
volunteers to help you with triage.

Alex.


From agnrie at hotmail.com  Fri May  7 06:52:20 2021
From: agnrie at hotmail.com (Aniruddha Gore)
Date: Fri, 7 May 2021 06:52:20 +0000
Subject: [squid-users] HTTPS request times out going through Squid proxy
In-Reply-To: <20210506061218.GA12715@fantomas.sk>
References: <MW4PR15MB4524AC3130A7C0D346DD7D71D95B9@MW4PR15MB4524.namprd15.prod.outlook.com>
 <MW4PR15MB452469A0C3E520A35CD82AB3D95B9@MW4PR15MB4524.namprd15.prod.outlook.com>
 <MW4PR15MB45247FBE0AB19C63BEB2D335D9589@MW4PR15MB4524.namprd15.prod.outlook.com>,
 <20210506061218.GA12715@fantomas.sk>
Message-ID: <PH0PR15MB452574B2AFBE4CF86F558DF2D9579@PH0PR15MB4525.namprd15.prod.outlook.com>

Thanks Matus for responding ?

Following is what the relevant line in squid.conf:

# Squid normally listens to port 3128
http_port 3128

I suspect you might be pointing out that there is no https_port configured. While I was adding https_port, I noticed no process is listening on port 3128 (doesn't appear in output of netstat -aon on Windows). So now the calls are failing with "WinHttpSendRequest: 12029: A connection with the server could not be established" ?

________________________________
From: squid-users <squid-users-bounces at lists.squid-cache.org> on behalf of Matus UHLAR - fantomas <uhlar at fantomas.sk>
Sent: Wednesday, May 5, 2021 11:12 PM
To: squid-users at lists.squid-cache.org <squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] HTTPS request times out going through Squid proxy

On 06.05.21 01:06, Aniruddha Gore wrote:
> Pinging back hoping to get some help.  I suspect I am missing something
> very basic and would really appreciate if someone could point me in the
> right direction.  :)

Hello,

I haven't seen your packet trace but so far it shouldn't be needed.

> Context I have an application running on a machine (A) that does not have
> internet connectivity.  It, however, can talk to another machine (B) which
> has full connectivity.  The application makes HTTPS calls.  I am hoping to
> set-up Squid on B and set-up web proxy (ip address and port) when making
> HTTPS calls in the app.

have you set up your squid host:port as HTTP proxy in the application?
Can you see anything in squid logs?

> I have installed Squid for
> Windows<https://na01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fsquid.diladele.com%2F&amp;data=04%7C01%7C%7Ceb0f33fc98ae42629d1e08d91055edbb%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C637558783534261214%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&amp;sdata=iT5UB59%2BSbNulVVbsgRSh81lxp0lMkSeBv%2Fmj5y1CVE%3D&amp;reserved=0>
> on B with default squid config.
>
>
> Problem HTTPS requests are timing out.
>
>
> I am new to proxy so don't know lot of ways to investigate further.  This
> is what Wireshark captured running on B.  Unfortunately, I am unable to
> gather any actionable info from this, it just confirms that calls do make
> it to B and then something wrong happens.

--
Matus UHLAR - fantomas, uhlar at fantomas.sk ; https://na01.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.fantomas.sk%2F&amp;data=04%7C01%7C%7Ceb0f33fc98ae42629d1e08d91055edbb%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C637558783534261214%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&amp;sdata=7xYKgDqzMX9kAzjQcbsiJQKxMXb6hPkaGHnmX8n%2Bx9I%3D&amp;reserved=0
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
   One OS to rule them all, One OS to find them,
One OS to bring them all and into darkness bind them
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
https://na01.safelinks.protection.outlook.com/?url=http%3A%2F%2Flists.squid-cache.org%2Flistinfo%2Fsquid-users&amp;data=04%7C01%7C%7Ceb0f33fc98ae42629d1e08d91055edbb%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C637558783534261214%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&amp;sdata=OTA2tTiE3lIg%2FVwI8sGgIExaLnHOBOF4%2FZn1eyWfTCo%3D&amp;reserved=0
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210507/7e458db3/attachment.htm>

From uhlar at fantomas.sk  Fri May  7 07:16:37 2021
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Fri, 7 May 2021 09:16:37 +0200
Subject: [squid-users] HTTPS request times out going through Squid proxy
In-Reply-To: <PH0PR15MB452574B2AFBE4CF86F558DF2D9579@PH0PR15MB4525.namprd15.prod.outlook.com>
References: <MW4PR15MB4524AC3130A7C0D346DD7D71D95B9@MW4PR15MB4524.namprd15.prod.outlook.com>
 <MW4PR15MB452469A0C3E520A35CD82AB3D95B9@MW4PR15MB4524.namprd15.prod.outlook.com>
 <MW4PR15MB45247FBE0AB19C63BEB2D335D9589@MW4PR15MB4524.namprd15.prod.outlook.com>
 <20210506061218.GA12715@fantomas.sk>
 <PH0PR15MB452574B2AFBE4CF86F558DF2D9579@PH0PR15MB4525.namprd15.prod.outlook.com>
Message-ID: <20210507071637.GC20827@fantomas.sk>

On 07.05.21 06:52, Aniruddha Gore wrote:
>Thanks Matus for responding ?

no need for private copy, mailing list is enough.

>Following is what the relevant line in squid.conf:
>
># Squid normally listens to port 3128
>http_port 3128
>
>I suspect you might be pointing out that there is no https_port configured. 

no. https_port is used for reverse proxying, not for forward proxying of
HTTPS requests.

> While I was adding https_port, I noticed no process is listening on port
> 3128 (doesn't appear in output of netstat -aon on Windows).  So now the
> calls are failing with "WinHttpSendRequest: 12029: A connection with the
> server could not be established" ?

>have you set up your squid host:port as HTTP proxy in the application?
- means: have you set up the applictaion to use HTTP proxy?

>Can you see anything in squid logs?
- what is in squid logs?


>From: squid-users <squid-users-bounces at lists.squid-cache.org> on behalf of Matus UHLAR - fantomas <uhlar at fantomas.sk>

>On 06.05.21 01:06, Aniruddha Gore wrote:
>> Pinging back hoping to get some help.  I suspect I am missing something
>> very basic and would really appreciate if someone could point me in the
>> right direction.  :)

>I haven't seen your packet trace but so far it shouldn't be needed.
>
>> Context I have an application running on a machine (A) that does not have
>> internet connectivity.  It, however, can talk to another machine (B) which
>> has full connectivity.  The application makes HTTPS calls.  I am hoping to
>> set-up Squid on B and set-up web proxy (ip address and port) when making
>> HTTPS calls in the app.
>
>
>> I have installed Squid for
>> Windows<https://na01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fsquid.diladele.com%2F&amp;data=04%7C01%7C%7Ceb0f33fc98ae42629d1e08d91055edbb%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C637558783534261214%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&amp;sdata=iT5UB59%2BSbNulVVbsgRSh81lxp0lMkSeBv%2Fmj5y1CVE%3D&amp;reserved=0>
>> on B with default squid config.
>>
>>
>> Problem HTTPS requests are timing out.
>>
>>
>> I am new to proxy so don't know lot of ways to investigate further.  This
>> is what Wireshark captured running on B.  Unfortunately, I am unable to
>> gather any actionable info from this, it just confirms that calls do make
>> it to B and then something wrong happens.


-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Spam = (S)tupid (P)eople's (A)dvertising (M)ethod


From agnrie at hotmail.com  Fri May  7 09:14:45 2021
From: agnrie at hotmail.com (Aniruddha Gore)
Date: Fri, 7 May 2021 09:14:45 +0000
Subject: [squid-users] HTTPS request times out going through Squid proxy
In-Reply-To: <20210507071637.GC20827@fantomas.sk>
References: <MW4PR15MB4524AC3130A7C0D346DD7D71D95B9@MW4PR15MB4524.namprd15.prod.outlook.com>
 <MW4PR15MB452469A0C3E520A35CD82AB3D95B9@MW4PR15MB4524.namprd15.prod.outlook.com>
 <MW4PR15MB45247FBE0AB19C63BEB2D335D9589@MW4PR15MB4524.namprd15.prod.outlook.com>
 <20210506061218.GA12715@fantomas.sk>
 <PH0PR15MB452574B2AFBE4CF86F558DF2D9579@PH0PR15MB4525.namprd15.prod.outlook.com>,
 <20210507071637.GC20827@fantomas.sk>
Message-ID: <MW4PR15MB452451647269BC78DB438BD0D9579@MW4PR15MB4524.namprd15.prod.outlook.com>

Matus, thanks a ton for your responses. I removed https_port and things started working again. Unfortunately, I am not sure what I was doing wrong before adding https_port. Well, it works now ?

________________________________
From: squid-users <squid-users-bounces at lists.squid-cache.org> on behalf of Matus UHLAR - fantomas <uhlar at fantomas.sk>
Sent: Friday, May 7, 2021 12:16 AM
To: squid-users at lists.squid-cache.org <squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] HTTPS request times out going through Squid proxy

On 07.05.21 06:52, Aniruddha Gore wrote:
>Thanks Matus for responding ?

no need for private copy, mailing list is enough.

>Following is what the relevant line in squid.conf:
>
># Squid normally listens to port 3128
>http_port 3128
>
>I suspect you might be pointing out that there is no https_port configured.

no. https_port is used for reverse proxying, not for forward proxying of
HTTPS requests.

> While I was adding https_port, I noticed no process is listening on port
> 3128 (doesn't appear in output of netstat -aon on Windows).  So now the
> calls are failing with "WinHttpSendRequest: 12029: A connection with the
> server could not be established" ?

>have you set up your squid host:port as HTTP proxy in the application?
- means: have you set up the applictaion to use HTTP proxy?

>Can you see anything in squid logs?
- what is in squid logs?


>From: squid-users <squid-users-bounces at lists.squid-cache.org> on behalf of Matus UHLAR - fantomas <uhlar at fantomas.sk>

>On 06.05.21 01:06, Aniruddha Gore wrote:
>> Pinging back hoping to get some help.  I suspect I am missing something
>> very basic and would really appreciate if someone could point me in the
>> right direction.  :)

>I haven't seen your packet trace but so far it shouldn't be needed.
>
>> Context I have an application running on a machine (A) that does not have
>> internet connectivity.  It, however, can talk to another machine (B) which
>> has full connectivity.  The application makes HTTPS calls.  I am hoping to
>> set-up Squid on B and set-up web proxy (ip address and port) when making
>> HTTPS calls in the app.
>
>
>> I have installed Squid for
>> Windows<https://na01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fsquid.diladele.com%2F&amp;data=04%7C01%7C%7C4d7fbe73b6a54cb719d908d911281327%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C637559686103881002%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&amp;sdata=hWCJM%2F3qqUc8Bz1%2BXup9cuVgJuX1ebIOi0i0tEBCUHU%3D&amp;reserved=0>
>> on B with default squid config.
>>
>>
>> Problem HTTPS requests are timing out.
>>
>>
>> I am new to proxy so don't know lot of ways to investigate further.  This
>> is what Wireshark captured running on B.  Unfortunately, I am unable to
>> gather any actionable info from this, it just confirms that calls do make
>> it to B and then something wrong happens.


--
Matus UHLAR - fantomas, uhlar at fantomas.sk ; https://na01.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.fantomas.sk%2F&amp;data=04%7C01%7C%7C4d7fbe73b6a54cb719d908d911281327%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C637559686103881002%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&amp;sdata=qC21DM3hdaq8G7RL31UzChySvc4zp47nTDEZKyRLzvg%3D&amp;reserved=0
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Spam = (S)tupid (P)eople's (A)dvertising (M)ethod
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
https://na01.safelinks.protection.outlook.com/?url=http%3A%2F%2Flists.squid-cache.org%2Flistinfo%2Fsquid-users&amp;data=04%7C01%7C%7C4d7fbe73b6a54cb719d908d911281327%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C637559686103881002%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&amp;sdata=aiHtVTBCRrd2X4OMofMnANin%2BXJa%2FkCTraf3VHa3ou0%3D&amp;reserved=0
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210507/136e2a5a/attachment.htm>

From agnrie at hotmail.com  Fri May  7 17:57:04 2021
From: agnrie at hotmail.com (Aniruddha Gore)
Date: Fri, 7 May 2021 17:57:04 +0000
Subject: [squid-users] HTTPS request times out going through Squid proxy
In-Reply-To: <MW4PR15MB452451647269BC78DB438BD0D9579@MW4PR15MB4524.namprd15.prod.outlook.com>
References: <MW4PR15MB4524AC3130A7C0D346DD7D71D95B9@MW4PR15MB4524.namprd15.prod.outlook.com>
 <MW4PR15MB452469A0C3E520A35CD82AB3D95B9@MW4PR15MB4524.namprd15.prod.outlook.com>
 <MW4PR15MB45247FBE0AB19C63BEB2D335D9589@MW4PR15MB4524.namprd15.prod.outlook.com>
 <20210506061218.GA12715@fantomas.sk>
 <PH0PR15MB452574B2AFBE4CF86F558DF2D9579@PH0PR15MB4525.namprd15.prod.outlook.com>,
 <20210507071637.GC20827@fantomas.sk>,
 <MW4PR15MB452451647269BC78DB438BD0D9579@MW4PR15MB4524.namprd15.prod.outlook.com>
Message-ID: <MW4PR15MB4524D997958D8AF37C23F4B4D9579@MW4PR15MB4524.namprd15.prod.outlook.com>

I spoke too soon, so embarrassed ?

When I run Squid on the same machine where my application is running it works fine, but when I run Squid with the same exact default config on a different machine it doesn't. I supply other machine's IP address and port (3128) on command line to my app, and it simply takes it and sets web proxy property on CPPRest SDK's http_config object.

The access.log file has many lines like the following:
1620409014.520  42289 <ip adress> TAG_NONE/500 0 CONNECT <uri>:443 - HIER_DIRECT/13.107.246.70 -

When capturing network calls via Wireshark (on this other machine where Squid is running), the CONNECT call succeeds but the following TCP call seems to fail with a RESET status (Wireshark is highlighting it in Yellow). Here's the frame if I am doing it right:

Frame 317: 54 bytes on wire (432 bits), 54 bytes captured (432 bits) on interface \Device\NPF_{5DF77CC1-9630-47C0-883C-EB71B3CB5012}, id 0
    Interface id: 0 (\Device\NPF_{5DF77CC1-9630-47C0-883C-EB71B3CB5012})
    Encapsulation type: Ethernet (1)
    Arrival Time: May  7, 2021 10:36:16.229675000 Pacific Daylight Time
    [Time shift for this packet: 0.000000000 seconds]
    Epoch Time: 1620408976.229675000 seconds
    [Time delta from previous captured frame: 0.009061000 seconds]
    [Time delta from previous displayed frame: 3.998702000 seconds]
    [Time since reference or first frame: 8.098563000 seconds]
    Frame Number: 317
    Frame Length: 54 bytes (432 bits)
    Capture Length: 54 bytes (432 bits)
    [Frame is marked: False]
    [Frame is ignored: False]
    [Protocols in frame: eth:ethertype:ip:tcp]
    [Coloring Rule Name: TCP RST]
    [Coloring Rule String: tcp.flags.reset eq 1]
Ethernet II, Src: IntelCor_5a:b3:e2 (c8:09:a8:5a:b3:e2), Dst: IntelCor_4e:5e:85 (34:02:86:4e:5e:85)
Internet Protocol Version 4, Src: 192.168.1.13, Dst: 192.168.1.10
Transmission Control Protocol, Src Port: 5526, Dst Port: 3128, Seq: 112, Ack: 1, Len: 0
    Source Port: 5526
    Destination Port: 3128
    [Stream index: 7]
    [TCP Segment Len: 0]
    Sequence Number: 112    (relative sequence number)
    Sequence Number (raw): 3926084777
    [Next Sequence Number: 112    (relative sequence number)]
    Acknowledgment Number: 1    (relative ack number)
    Acknowledgment number (raw): 363949443
    0101 .... = Header Length: 20 bytes (5)
    Flags: 0x014 (RST, ACK)
        000. .... .... = Reserved: Not set
        ...0 .... .... = Nonce: Not set
        .... 0... .... = Congestion Window Reduced (CWR): Not set
        .... .0.. .... = ECN-Echo: Not set
        .... ..0. .... = Urgent: Not set
        .... ...1 .... = Acknowledgment: Set
        .... .... 0... = Push: Not set
        .... .... .1.. = Reset: Set
        .... .... ..0. = Syn: Not set
        .... .... ...0 = Fin: Not set
        [TCP Flags: ???????A?R??]
    Window: 0
    [Calculated window size: 0]
    [Window size scaling factor: 256]
    Checksum: 0x50b9 [unverified]
    [Checksum Status: Unverified]
    Urgent Pointer: 0
    [Timestamps]

________________________________
From: squid-users <squid-users-bounces at lists.squid-cache.org> on behalf of Aniruddha Gore <agnrie at hotmail.com>
Sent: Friday, May 7, 2021 2:14 AM
To: squid-users at lists.squid-cache.org <squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] HTTPS request times out going through Squid proxy

Matus, thanks a ton for your responses. I removed https_port and things started working again. Unfortunately, I am not sure what I was doing wrong before adding https_port. Well, it works now ?

________________________________
From: squid-users <squid-users-bounces at lists.squid-cache.org> on behalf of Matus UHLAR - fantomas <uhlar at fantomas.sk>
Sent: Friday, May 7, 2021 12:16 AM
To: squid-users at lists.squid-cache.org <squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] HTTPS request times out going through Squid proxy

On 07.05.21 06:52, Aniruddha Gore wrote:
>Thanks Matus for responding ?

no need for private copy, mailing list is enough.

>Following is what the relevant line in squid.conf:
>
># Squid normally listens to port 3128
>http_port 3128
>
>I suspect you might be pointing out that there is no https_port configured.

no. https_port is used for reverse proxying, not for forward proxying of
HTTPS requests.

> While I was adding https_port, I noticed no process is listening on port
> 3128 (doesn't appear in output of netstat -aon on Windows).  So now the
> calls are failing with "WinHttpSendRequest: 12029: A connection with the
> server could not be established" ?

>have you set up your squid host:port as HTTP proxy in the application?
- means: have you set up the applictaion to use HTTP proxy?

>Can you see anything in squid logs?
- what is in squid logs?


>From: squid-users <squid-users-bounces at lists.squid-cache.org> on behalf of Matus UHLAR - fantomas <uhlar at fantomas.sk>

>On 06.05.21 01:06, Aniruddha Gore wrote:
>> Pinging back hoping to get some help.  I suspect I am missing something
>> very basic and would really appreciate if someone could point me in the
>> right direction.  :)

>I haven't seen your packet trace but so far it shouldn't be needed.
>
>> Context I have an application running on a machine (A) that does not have
>> internet connectivity.  It, however, can talk to another machine (B) which
>> has full connectivity.  The application makes HTTPS calls.  I am hoping to
>> set-up Squid on B and set-up web proxy (ip address and port) when making
>> HTTPS calls in the app.
>
>
>> I have installed Squid for
>> Windows<https://na01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fsquid.diladele.com%2F&amp;data=04%7C01%7C%7C4d7fbe73b6a54cb719d908d911281327%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C637559686103881002%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&amp;sdata=hWCJM%2F3qqUc8Bz1%2BXup9cuVgJuX1ebIOi0i0tEBCUHU%3D&amp;reserved=0<https://na01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fsquid.diladele.com%2F&data=04%7C01%7C%7C02baab1a6a994dfc276208d9113893b2%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C637559756979097848%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&sdata=0g9cnxKoIB%2FoJnlgGTm7CrQv6dOqq3K2gSG7hKkQwfo%3D&reserved=0>>
>> on B with default squid config.
>>
>>
>> Problem HTTPS requests are timing out.
>>
>>
>> I am new to proxy so don't know lot of ways to investigate further.  This
>> is what Wireshark captured running on B.  Unfortunately, I am unable to
>> gather any actionable info from this, it just confirms that calls do make
>> it to B and then something wrong happens.


--
Matus UHLAR - fantomas, uhlar at fantomas.sk ; https://na01.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.fantomas.sk%2F&amp;data=04%7C01%7C%7C4d7fbe73b6a54cb719d908d911281327%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C637559686103881002%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&amp;sdata=qC21DM3hdaq8G7RL31UzChySvc4zp47nTDEZKyRLzvg%3D&amp;reserved=0<https://na01.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.fantomas.sk%2F&data=04%7C01%7C%7C02baab1a6a994dfc276208d9113893b2%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C637559756979107805%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&sdata=VB7bUOGYVd4kiwcm8vCDbezCh5du0UzXkNH1BlJalzc%3D&reserved=0>
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Spam = (S)tupid (P)eople's (A)dvertising (M)ethod
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
https://na01.safelinks.protection.outlook.com/?url=http%3A%2F%2Flists.squid-cache.org%2Flistinfo%2Fsquid-users&amp;data=04%7C01%7C%7C4d7fbe73b6a54cb719d908d911281327%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C637559686103881002%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&amp;sdata=aiHtVTBCRrd2X4OMofMnANin%2BXJa%2FkCTraf3VHa3ou0%3D&amp;reserved=0<https://na01.safelinks.protection.outlook.com/?url=http%3A%2F%2Flists.squid-cache.org%2Flistinfo%2Fsquid-users&data=04%7C01%7C%7C02baab1a6a994dfc276208d9113893b2%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C637559756979117764%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&sdata=Xzhxvj%2Flj1iepxLJiSfIGa0knNgF7%2BIHtGkCmijsczg%3D&reserved=0>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210507/2c9e20ab/attachment.htm>

From jazjred at gmail.com  Fri May  7 21:01:57 2021
From: jazjred at gmail.com (Jazmine Redmond)
Date: Fri, 7 May 2021 14:01:57 -0700
Subject: [squid-users] Squid not using hosts file
In-Reply-To: <7d081eaf-0060-e004-5144-06fdc89e6049@measurement-factory.com>
References: <CA+WwRd9G_Bjzcnz3aU5N3unnYC4A7pUzABUg8sO9PK4t3M9PzA@mail.gmail.com>
 <7d081eaf-0060-e004-5144-06fdc89e6049@measurement-factory.com>
Message-ID: <CA+WwRd-P6Zt8weC+VG8=s9XxN+QTYi76s9TSVV+D9my+HZxR_w@mail.gmail.com>

Thanks for the reply.
You mentioned supported Squid versions. For Windows I see Squid versions
3.5, 3.3 and 2.7. Which ones are supported?
Additionally, what are the supported versions for Linux?

Jazmine

On Thu, May 6, 2021 at 7:04 AM Alex Rousskov <
rousskov at measurement-factory.com> wrote:

> On 5/6/21 12:09 AM, Jazmine Redmond wrote:
> > Hi,
> >
> > I am having issues getting Squid to use the hosts file on the squid
> server.
> >
> > I added the hosts_file configuration directive to my squid config file
> > as follows:
> >
> > hosts_file  C:/Windows/System32/drivers/etc/hosts
> >
> > But, when my squid client browser specifies a URL with a machine name
> > listed in the hosts file, squid returns an error that says:
> >
> > ?Unable to determine IP address from host name. The DNS server returned:
> > Name Error: the domain name does not exist. This means that the cache
> > was not able to resolve the hostname presented in the URL.?
> >
> > So, it seems that squid is NOT using my hosts file.
> >
> > I have tried using forward slashes (/) and backward slashes (\) in the
> > hosts_file configuration directive, yet the error persists.
> >
> > I have verified the path to the hosts file is correct and I restart
> > Squid each time I make edits to the configuration file. Yet the error
> > persists.
> >
> > I am running Squid version 3.5.28 on Windows 10.
> >
> > Am I missing something?
>
> Supported Squid versions are known to use /etc/hosts file. I do not know
> whether there are any Windows-specific or v3-specific bugs in that area.
> Unfortunately, very few people responding on this mailing list are using
> Squid v3 and Squid on Windows in general. That is probably why you are
> not getting any responses.
>
> If you can try a supported Squid version, please do so (especially if
> you can try it on Linux). You may also share a pointer to a compressed
> cache.log after setting debug_options to ALL,9 in case somebody
> volunteers to help you with triage.
>
> Alex.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210507/9af093f8/attachment.htm>

From jazjred at gmail.com  Sat May  8 02:16:38 2021
From: jazjred at gmail.com (Jazmine Redmond)
Date: Fri, 7 May 2021 19:16:38 -0700
Subject: [squid-users] Squid not using hosts file
In-Reply-To: <CA+WwRd-P6Zt8weC+VG8=s9XxN+QTYi76s9TSVV+D9my+HZxR_w@mail.gmail.com>
References: <CA+WwRd9G_Bjzcnz3aU5N3unnYC4A7pUzABUg8sO9PK4t3M9PzA@mail.gmail.com>
 <7d081eaf-0060-e004-5144-06fdc89e6049@measurement-factory.com>
 <CA+WwRd-P6Zt8weC+VG8=s9XxN+QTYi76s9TSVV+D9my+HZxR_w@mail.gmail.com>
Message-ID: <CA+WwRd-1T=TT1p8-HAXRSN_x93JEz1vjVNeTMxbNV6=LWBYoJQ@mail.gmail.com>

Hey all,
I fixed the issue.
The problem was in the hosts file. Each new line should begin with the IP
address, followed by one or more spaces, followed by a name.
My hosts file had a space before the IP address. Once I removed the space
at the beginning of the line, everything worked fine.
I downgraded my Squid to a supported version v2.7 so I can confirm it works
on this version. I have not upgraded to v3.5 yet... perhaps in the future.

Thanks for the help!
Jazmine



On Fri, May 7, 2021 at 2:01 PM Jazmine Redmond <jazjred at gmail.com> wrote:

> Thanks for the reply.
> You mentioned supported Squid versions. For Windows I see Squid versions
> 3.5, 3.3 and 2.7. Which ones are supported?
> Additionally, what are the supported versions for Linux?
>
> Jazmine
>
> On Thu, May 6, 2021 at 7:04 AM Alex Rousskov <
> rousskov at measurement-factory.com> wrote:
>
>> On 5/6/21 12:09 AM, Jazmine Redmond wrote:
>> > Hi,
>> >
>> > I am having issues getting Squid to use the hosts file on the squid
>> server.
>> >
>> > I added the hosts_file configuration directive to my squid config file
>> > as follows:
>> >
>> > hosts_file  C:/Windows/System32/drivers/etc/hosts
>> >
>> > But, when my squid client browser specifies a URL with a machine name
>> > listed in the hosts file, squid returns an error that says:
>> >
>> > ?Unable to determine IP address from host name. The DNS server returned:
>> > Name Error: the domain name does not exist. This means that the cache
>> > was not able to resolve the hostname presented in the URL.?
>> >
>> > So, it seems that squid is NOT using my hosts file.
>> >
>> > I have tried using forward slashes (/) and backward slashes (\) in the
>> > hosts_file configuration directive, yet the error persists.
>> >
>> > I have verified the path to the hosts file is correct and I restart
>> > Squid each time I make edits to the configuration file. Yet the error
>> > persists.
>> >
>> > I am running Squid version 3.5.28 on Windows 10.
>> >
>> > Am I missing something?
>>
>> Supported Squid versions are known to use /etc/hosts file. I do not know
>> whether there are any Windows-specific or v3-specific bugs in that area.
>> Unfortunately, very few people responding on this mailing list are using
>> Squid v3 and Squid on Windows in general. That is probably why you are
>> not getting any responses.
>>
>> If you can try a supported Squid version, please do so (especially if
>> you can try it on Linux). You may also share a pointer to a compressed
>> cache.log after setting debug_options to ALL,9 in case somebody
>> volunteers to help you with triage.
>>
>> Alex.
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210507/c2973aca/attachment.htm>

From justinmschw at gmail.com  Sat May  8 02:22:55 2021
From: justinmschw at gmail.com (Justin Michael Schwartzbeck)
Date: Fri, 7 May 2021 21:22:55 -0500
Subject: [squid-users] "helperHandleRead: unexpected read" for helper
 function
Message-ID: <CAGEc96mf=LUh7J1Gx+RStv712PN-hoRqpb4Bjf_TyfBFkGD4TA@mail.gmail.com>

Hello all... I would really appreciate some help.

So I have written an external acl helper in C++ that talks to a REST API
that I developed. Here is a github link (don't worry, it is pretty short,
and the only parts you need to look at are lines 46, 52, 58 and 60):

https://github.com/e2guardian-angel/squid-acl-category-helper/blob/main/category_host.cpp

I have it all configured in my squid.conf:
external_acl_type host_category_helper %ACL %DST
/usr/local/bin/squidhelpers/host_category_helper
acl searchengines external host_category_helper
...
ssl_bump bump searchengines
ssl_bump none all

and as far as I can tell, it is working: search engines are being matched
(for the most part) and decrypted, as expected, and nothing else is being
decrypted.

However, I am seeing a million of the following lines:
2021/05/08 02:04:57| helperHandleRead: unexpected read from
host_category_helper #Hlpr6, 4 bytes 'ERR

I notice it only seems to be happening for the ERR (no match), I don't see
it for the OK (match).

I googled this issue and see a lot of threads here about making sure there
is only one line of output per line of input. I am definitely seeing this
when I just run the helper manually:
$ docker exec -it squid /usr/local/bin/squidhelpers/host_category_helper

searchengines google.com
OK
searchengines facebook.com
ERR
searchengines imdb.com
ERR


So it seems that it should be working as expected. I don't see any other
newlines. I saw also some snippet about concurrency being an issue, this
could be the case, since I did see this one-off in the squid output:
2021/05/08 02:04:59| helperHandleRead: unexpected read from
host_category_helper #Hlpr6, 8 bytes 'ERR
ERR
'

But this doesn't make sense to me since only one helper appears to be
running:
2021/05/08 01:52:04| helperOpenServers: Starting 1/5 'host_category_helper'
processes


Is there anything glaring here that could be the issue? Is it indeed a
concurrency problem? I would have assumed that each helper (there are 5 of
them) would have their own stdin/stdout and be writing to/from it rather
than everyone at once. It also seems a little suspicious that I am only
seeing this for ERR, not OK... you are supposed to print ERR when there is
not a match, correct?

Any help would be greatly appreciated... I am getting so close to having
this fully functional.

-Justin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210507/40211260/attachment.htm>

From rousskov at measurement-factory.com  Sat May  8 14:40:02 2021
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Sat, 8 May 2021 10:40:02 -0400
Subject: [squid-users] Squid not using hosts file
In-Reply-To: <CA+WwRd-P6Zt8weC+VG8=s9XxN+QTYi76s9TSVV+D9my+HZxR_w@mail.gmail.com>
References: <CA+WwRd9G_Bjzcnz3aU5N3unnYC4A7pUzABUg8sO9PK4t3M9PzA@mail.gmail.com>
 <7d081eaf-0060-e004-5144-06fdc89e6049@measurement-factory.com>
 <CA+WwRd-P6Zt8weC+VG8=s9XxN+QTYi76s9TSVV+D9my+HZxR_w@mail.gmail.com>
Message-ID: <c6f7b31c-434d-7f0c-ea55-6944521277d2@measurement-factory.com>

On 5/7/21 5:01 PM, Jazmine Redmond wrote:

> You mentioned supported Squid versions. For Windows I see Squid versions
> 3.5, 3.3 and 2.7. Which ones are supported?

None of the above, IMO. Moreover, the support status of Windows (as a
Squid platform) is rather difficult to define at the moment. FWIW, I
tried to push for a clear Project statement regarding environment
support tiers, including Windows, but no proposal gained consensus.

[1] https://github.com/squid-cache/squid/pull/619#issuecomment-622063467


> Additionally, what are the supported versions for Linux??

Squid v4.


HTH,

Alex.


> On Thu, May 6, 2021 at 7:04 AM Alex Rousskov wrote:
> 
>     On 5/6/21 12:09 AM, Jazmine Redmond wrote:
>     > Hi,?
>     >
>     > I am having issues getting Squid to use the hosts file on the
>     squid server.
>     > ?
>     > I added the hosts_file configuration directive to my squid config file
>     > as follows:
>     > ?
>     > hosts_file? C:/Windows/System32/drivers/etc/hosts
>     > ?
>     > But, when my squid client browser specifies a URL with a machine name
>     > listed in the hosts file, squid returns an error that says:
>     > ?
>     > ?Unable to determine IP address from host name. The DNS server
>     returned:
>     > Name Error: the domain name does not exist. This means that the cache
>     > was not able to resolve the hostname presented in the URL.?
>     > ?
>     > So, it seems that squid is NOT using my hosts file.
>     > ?
>     > I have tried using forward slashes (/) and backward slashes (\) in the
>     > hosts_file configuration directive, yet the error persists.
>     > ?
>     > I have verified the path to the hosts file is correct and I restart
>     > Squid each time I make edits to the configuration file. Yet the error
>     > persists.
>     > ?
>     > I am running Squid version 3.5.28 on Windows 10.
>     > ?
>     > Am I missing something?
> 
>     Supported Squid versions are known to use /etc/hosts file. I do not know
>     whether there are any Windows-specific or v3-specific bugs in that area.
>     Unfortunately, very few people responding on this mailing list are using
>     Squid v3 and Squid on Windows in general. That is probably why you are
>     not getting any responses.
> 
>     If you can try a supported Squid version, please do so (especially if
>     you can try it on Linux). You may also share a pointer to a compressed
>     cache.log after setting debug_options to ALL,9 in case somebody
>     volunteers to help you with triage.
> 
>     Alex.
> 



From rousskov at measurement-factory.com  Sat May  8 14:49:14 2021
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Sat, 8 May 2021 10:49:14 -0400
Subject: [squid-users] Squid not using hosts file
In-Reply-To: <CA+WwRd-1T=TT1p8-HAXRSN_x93JEz1vjVNeTMxbNV6=LWBYoJQ@mail.gmail.com>
References: <CA+WwRd9G_Bjzcnz3aU5N3unnYC4A7pUzABUg8sO9PK4t3M9PzA@mail.gmail.com>
 <7d081eaf-0060-e004-5144-06fdc89e6049@measurement-factory.com>
 <CA+WwRd-P6Zt8weC+VG8=s9XxN+QTYi76s9TSVV+D9my+HZxR_w@mail.gmail.com>
 <CA+WwRd-1T=TT1p8-HAXRSN_x93JEz1vjVNeTMxbNV6=LWBYoJQ@mail.gmail.com>
Message-ID: <16df7023-89e2-a9b8-daf9-dfa976281f75@measurement-factory.com>

On 5/7/21 10:16 PM, Jazmine Redmond wrote:
> The problem was in the hosts file. Each new line should begin with the
> IP address, followed by one or more spaces, followed by a name.
> My hosts file had a space before the IP address. Once I removed the
> space at the beginning of the line, everything worked fine.

If a supported Squid version does not at least log ERROR messages about
(what it considers) malformed /etc/hosts lines, please consider filing a
bug report with Squid bugzilla. This problem is not something admins
should be guessing on their own, and surprising interpretation of
/etc/hosts file may have security implications in some environments.


> I downgraded my Squid to a supported version v2.7 so I can confirm it
> works on this version. I have not upgraded to v3.5 yet... perhaps in the
> future.

Please note that there has been no work on Squid v2 for about 10 years.
Those ancient versions are full of security vulnerabilities and are not
supported by the Squid Project in any shape or form.

Alex.


> On Fri, May 7, 2021 at 2:01 PM Jazmine Redmond wrote:
> 
>     Thanks for the reply.
>     You mentioned supported Squid versions. For Windows I see Squid
>     versions 3.5, 3.3 and 2.7. Which ones are supported?
>     Additionally, what are the supported versions for Linux??
> 
>     Jazmine
> 
>     On Thu, May 6, 2021 at 7:04 AM Alex Rousskov wrote:
> 
>         On 5/6/21 12:09 AM, Jazmine Redmond wrote:
>         > Hi,?
>         >
>         > I am having issues getting Squid to use the hosts file on the
>         squid server.
>         > ?
>         > I added the hosts_file configuration directive to my squid
>         config file
>         > as follows:
>         > ?
>         > hosts_file? C:/Windows/System32/drivers/etc/hosts
>         > ?
>         > But, when my squid client browser specifies a URL with a
>         machine name
>         > listed in the hosts file, squid returns an error that says:
>         > ?
>         > ?Unable to determine IP address from host name. The DNS server
>         returned:
>         > Name Error: the domain name does not exist. This means that
>         the cache
>         > was not able to resolve the hostname presented in the URL.?
>         > ?
>         > So, it seems that squid is NOT using my hosts file.
>         > ?
>         > I have tried using forward slashes (/) and backward slashes
>         (\) in the
>         > hosts_file configuration directive, yet the error persists.
>         > ?
>         > I have verified the path to the hosts file is correct and I
>         restart
>         > Squid each time I make edits to the configuration file. Yet
>         the error
>         > persists.
>         > ?
>         > I am running Squid version 3.5.28 on Windows 10.
>         > ?
>         > Am I missing something?
> 
>         Supported Squid versions are known to use /etc/hosts file. I do
>         not know
>         whether there are any Windows-specific or v3-specific bugs in
>         that area.
>         Unfortunately, very few people responding on this mailing list
>         are using
>         Squid v3 and Squid on Windows in general. That is probably why
>         you are
>         not getting any responses.
> 
>         If you can try a supported Squid version, please do so
>         (especially if
>         you can try it on Linux). You may also share a pointer to a
>         compressed
>         cache.log after setting debug_options to ALL,9 in case somebody
>         volunteers to help you with triage.
> 
>         Alex.
> 



From justinmschw at gmail.com  Sat May  8 14:52:31 2021
From: justinmschw at gmail.com (Justin Michael Schwartzbeck)
Date: Sat, 8 May 2021 09:52:31 -0500
Subject: [squid-users] "helperHandleRead: unexpected read" for helper
 function
In-Reply-To: <CAGEc96mf=LUh7J1Gx+RStv712PN-hoRqpb4Bjf_TyfBFkGD4TA@mail.gmail.com>
References: <CAGEc96mf=LUh7J1Gx+RStv712PN-hoRqpb4Bjf_TyfBFkGD4TA@mail.gmail.com>
Message-ID: <CAGEc96mM6w3SBb-_iY7D0CGwTPe0WXxbOOUcT-5B-h_Nf-C9xg@mail.gmail.com>

I think I may have found the problem. I am updating my source, so the lines
I mentioned before won't count here. I will get back.

On Fri, May 7, 2021 at 9:22 PM Justin Michael Schwartzbeck <
justinmschw at gmail.com> wrote:

> Hello all... I would really appreciate some help.
>
> So I have written an external acl helper in C++ that talks to a REST API
> that I developed. Here is a github link (don't worry, it is pretty short,
> and the only parts you need to look at are lines 46, 52, 58 and 60):
>
>
> https://github.com/e2guardian-angel/squid-acl-category-helper/blob/main/category_host.cpp
>
> I have it all configured in my squid.conf:
> external_acl_type host_category_helper %ACL %DST
> /usr/local/bin/squidhelpers/host_category_helper
> acl searchengines external host_category_helper
> ...
> ssl_bump bump searchengines
> ssl_bump none all
>
> and as far as I can tell, it is working: search engines are being matched
> (for the most part) and decrypted, as expected, and nothing else is being
> decrypted.
>
> However, I am seeing a million of the following lines:
> 2021/05/08 02:04:57| helperHandleRead: unexpected read from
> host_category_helper #Hlpr6, 4 bytes 'ERR
>
> I notice it only seems to be happening for the ERR (no match), I don't see
> it for the OK (match).
>
> I googled this issue and see a lot of threads here about making sure there
> is only one line of output per line of input. I am definitely seeing this
> when I just run the helper manually:
> $ docker exec -it squid /usr/local/bin/squidhelpers/host_category_helper
>
> searchengines google.com
> OK
> searchengines facebook.com
> ERR
> searchengines imdb.com
> ERR
>
>
> So it seems that it should be working as expected. I don't see any other
> newlines. I saw also some snippet about concurrency being an issue, this
> could be the case, since I did see this one-off in the squid output:
> 2021/05/08 02:04:59| helperHandleRead: unexpected read from
> host_category_helper #Hlpr6, 8 bytes 'ERR
> ERR
> '
>
> But this doesn't make sense to me since only one helper appears to be
> running:
> 2021/05/08 01:52:04| helperOpenServers: Starting 1/5
> 'host_category_helper' processes
>
>
> Is there anything glaring here that could be the issue? Is it indeed a
> concurrency problem? I would have assumed that each helper (there are 5 of
> them) would have their own stdin/stdout and be writing to/from it rather
> than everyone at once. It also seems a little suspicious that I am only
> seeing this for ERR, not OK... you are supposed to print ERR when there is
> not a match, correct?
>
> Any help would be greatly appreciated... I am getting so close to having
> this fully functional.
>
> -Justin
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210508/f17f3b2b/attachment.htm>

From justinmschw at gmail.com  Sat May  8 15:00:39 2021
From: justinmschw at gmail.com (Justin Michael Schwartzbeck)
Date: Sat, 8 May 2021 10:00:39 -0500
Subject: [squid-users] "helperHandleRead: unexpected read" for helper
 function
In-Reply-To: <CAGEc96mM6w3SBb-_iY7D0CGwTPe0WXxbOOUcT-5B-h_Nf-C9xg@mail.gmail.com>
References: <CAGEc96mf=LUh7J1Gx+RStv712PN-hoRqpb4Bjf_TyfBFkGD4TA@mail.gmail.com>
 <CAGEc96mM6w3SBb-_iY7D0CGwTPe0WXxbOOUcT-5B-h_Nf-C9xg@mail.gmail.com>
Message-ID: <CAGEc96kiLZQ6k9iEKOHGiR==P66VmS=OuErdrCRNt3z31BFrQQ@mail.gmail.com>

Yes I solved my problem... when there are multiple lines on the input, then
it flakes out. I basically am using getline now with \n as the delimiter.
It works flawlessly now.
Thanks

On Sat, May 8, 2021 at 9:52 AM Justin Michael Schwartzbeck <
justinmschw at gmail.com> wrote:

> I think I may have found the problem. I am updating my source, so the
> lines I mentioned before won't count here. I will get back.
>
> On Fri, May 7, 2021 at 9:22 PM Justin Michael Schwartzbeck <
> justinmschw at gmail.com> wrote:
>
>> Hello all... I would really appreciate some help.
>>
>> So I have written an external acl helper in C++ that talks to a REST API
>> that I developed. Here is a github link (don't worry, it is pretty short,
>> and the only parts you need to look at are lines 46, 52, 58 and 60):
>>
>>
>> https://github.com/e2guardian-angel/squid-acl-category-helper/blob/main/category_host.cpp
>>
>> I have it all configured in my squid.conf:
>> external_acl_type host_category_helper %ACL %DST
>> /usr/local/bin/squidhelpers/host_category_helper
>> acl searchengines external host_category_helper
>> ...
>> ssl_bump bump searchengines
>> ssl_bump none all
>>
>> and as far as I can tell, it is working: search engines are being matched
>> (for the most part) and decrypted, as expected, and nothing else is being
>> decrypted.
>>
>> However, I am seeing a million of the following lines:
>> 2021/05/08 02:04:57| helperHandleRead: unexpected read from
>> host_category_helper #Hlpr6, 4 bytes 'ERR
>>
>> I notice it only seems to be happening for the ERR (no match), I don't
>> see it for the OK (match).
>>
>> I googled this issue and see a lot of threads here about making sure
>> there is only one line of output per line of input. I am definitely seeing
>> this when I just run the helper manually:
>> $ docker exec -it squid /usr/local/bin/squidhelpers/host_category_helper
>>
>> searchengines google.com
>> OK
>> searchengines facebook.com
>> ERR
>> searchengines imdb.com
>> ERR
>>
>>
>> So it seems that it should be working as expected. I don't see any other
>> newlines. I saw also some snippet about concurrency being an issue, this
>> could be the case, since I did see this one-off in the squid output:
>> 2021/05/08 02:04:59| helperHandleRead: unexpected read from
>> host_category_helper #Hlpr6, 8 bytes 'ERR
>> ERR
>> '
>>
>> But this doesn't make sense to me since only one helper appears to be
>> running:
>> 2021/05/08 01:52:04| helperOpenServers: Starting 1/5
>> 'host_category_helper' processes
>>
>>
>> Is there anything glaring here that could be the issue? Is it indeed a
>> concurrency problem? I would have assumed that each helper (there are 5 of
>> them) would have their own stdin/stdout and be writing to/from it rather
>> than everyone at once. It also seems a little suspicious that I am only
>> seeing this for ERR, not OK... you are supposed to print ERR when there is
>> not a match, correct?
>>
>> Any help would be greatly appreciated... I am getting so close to having
>> this fully functional.
>>
>> -Justin
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210508/c4529f95/attachment.htm>

From rousskov at measurement-factory.com  Sat May  8 15:18:43 2021
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Sat, 8 May 2021 11:18:43 -0400
Subject: [squid-users] "helperHandleRead: unexpected read" for helper
 function
In-Reply-To: <CAGEc96mf=LUh7J1Gx+RStv712PN-hoRqpb4Bjf_TyfBFkGD4TA@mail.gmail.com>
References: <CAGEc96mf=LUh7J1Gx+RStv712PN-hoRqpb4Bjf_TyfBFkGD4TA@mail.gmail.com>
Message-ID: <78173529-0995-0e78-5e94-8e7f17c850aa@measurement-factory.com>

On 5/7/21 10:22 PM, Justin Michael Schwartzbeck wrote:

> So I have written an external acl helper

> while(1) {
>     string category, hostname;
>     cin >> category >> hostname;
>     
>     // Perform REST API


> I have it all configured in my squid.conf:
> external_acl_type host_category_helper %ACL %DST
> /usr/local/bin/squidhelpers/host_category_helper
> acl searchengines external host_category_helper

> I am seeing a million of the following lines:
> 2021/05/08 02:04:57| helperHandleRead: unexpected read from
> host_category_helper #Hlpr6, 4 bytes 'ERR

AFAICT, your helper does not validate its input in any way. Until you
fix that critical design flaw, you may face surprises like this even if
things appear to work in your tests. Check that each line contains the
number of fields you expect (which is 2 AFAICT) _and_ nothing else.

I suspect I know where the immediate bug is, but I think it is best if I
keep those details to myself as a motivation for you to add input
validation :-).


BTW, you should also handle input EOF, which is how Squid gracefully
terminates helpers IIRC.


> I saw also some snippet about concurrency being an issue, ...
> But this doesn't make sense to me since only one helper appears to be
> running:

In this context, concurrency is about concurrent transactions (a.k.a
requests or queries) sent to a single helper instance, not about
concurrent helper instances.

Documentation is rather vague on this point, but, AFAICT, external
helpers are assumed to lack concurrency support by default, so this
should not be an issue for your specific helper configuration. Once you
add validation, you will know for sure.

Said that, your helper does not support and silently breaks concurrent
requests.


> I would have assumed that each helper (there are 5
> of them) would have their own stdin/stdout and be writing to/from it
> rather than everyone at once. 

Your assumption is correct.


> you are supposed to print ERR when there is not a match, correct?

Correct.

On invalid input, respond with BH if you think your helper can recover
from that bad input. Respond with BH _and_ quit the helper otherwise.


HTH,

Alex.


From agnrie at hotmail.com  Mon May 10 07:52:48 2021
From: agnrie at hotmail.com (Aniruddha Gore)
Date: Mon, 10 May 2021 07:52:48 +0000
Subject: [squid-users] HTTPS request times out going through Squid proxy
In-Reply-To: <MW4PR15MB4524D997958D8AF37C23F4B4D9579@MW4PR15MB4524.namprd15.prod.outlook.com>
References: <MW4PR15MB4524AC3130A7C0D346DD7D71D95B9@MW4PR15MB4524.namprd15.prod.outlook.com>
 <MW4PR15MB452469A0C3E520A35CD82AB3D95B9@MW4PR15MB4524.namprd15.prod.outlook.com>
 <MW4PR15MB45247FBE0AB19C63BEB2D335D9589@MW4PR15MB4524.namprd15.prod.outlook.com>
 <20210506061218.GA12715@fantomas.sk>
 <PH0PR15MB452574B2AFBE4CF86F558DF2D9579@PH0PR15MB4525.namprd15.prod.outlook.com>,
 <20210507071637.GC20827@fantomas.sk>,
 <MW4PR15MB452451647269BC78DB438BD0D9579@MW4PR15MB4524.namprd15.prod.outlook.com>,
 <MW4PR15MB4524D997958D8AF37C23F4B4D9579@MW4PR15MB4524.namprd15.prod.outlook.com>
Message-ID: <MW4PR15MB45246F662CB41C46DA007679D9549@MW4PR15MB4524.namprd15.prod.outlook.com>

Any help I could use? :) The gist is: I have squid running on machine A, and an app on machine B. The app sets proxy (A's ip address and squid port #) when making HTTP requests but the requests are failing.

Aniruddha Gore
Sent from Outlook.com<http://www.microsoft.com/en-us/outlook-com/compare/>
________________________________
From: squid-users <squid-users-bounces at lists.squid-cache.org> on behalf of Aniruddha Gore <agnrie at hotmail.com>
Sent: Friday, May 7, 2021 10:57 AM
To: squid-users at lists.squid-cache.org <squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] HTTPS request times out going through Squid proxy

I spoke too soon, so embarrassed ?

When I run Squid on the same machine where my application is running it works fine, but when I run Squid with the same exact default config on a different machine it doesn't. I supply other machine's IP address and port (3128) on command line to my app, and it simply takes it and sets web proxy property on CPPRest SDK's http_config object.

The access.log file has many lines like the following:
1620409014.520  42289 <ip adress> TAG_NONE/500 0 CONNECT <uri>:443 - HIER_DIRECT/13.107.246.70 -

When capturing network calls via Wireshark (on this other machine where Squid is running), the CONNECT call succeeds but the following TCP call seems to fail with a RESET status (Wireshark is highlighting it in Yellow). Here's the frame if I am doing it right:

Frame 317: 54 bytes on wire (432 bits), 54 bytes captured (432 bits) on interface \Device\NPF_{5DF77CC1-9630-47C0-883C-EB71B3CB5012}, id 0
    Interface id: 0 (\Device\NPF_{5DF77CC1-9630-47C0-883C-EB71B3CB5012})
    Encapsulation type: Ethernet (1)
    Arrival Time: May  7, 2021 10:36:16.229675000 Pacific Daylight Time
    [Time shift for this packet: 0.000000000 seconds]
    Epoch Time: 1620408976.229675000 seconds
    [Time delta from previous captured frame: 0.009061000 seconds]
    [Time delta from previous displayed frame: 3.998702000 seconds]
    [Time since reference or first frame: 8.098563000 seconds]
    Frame Number: 317
    Frame Length: 54 bytes (432 bits)
    Capture Length: 54 bytes (432 bits)
    [Frame is marked: False]
    [Frame is ignored: False]
    [Protocols in frame: eth:ethertype:ip:tcp]
    [Coloring Rule Name: TCP RST]
    [Coloring Rule String: tcp.flags.reset eq 1]
Ethernet II, Src: IntelCor_5a:b3:e2 (c8:09:a8:5a:b3:e2), Dst: IntelCor_4e:5e:85 (34:02:86:4e:5e:85)
Internet Protocol Version 4, Src: 192.168.1.13, Dst: 192.168.1.10
Transmission Control Protocol, Src Port: 5526, Dst Port: 3128, Seq: 112, Ack: 1, Len: 0
    Source Port: 5526
    Destination Port: 3128
    [Stream index: 7]
    [TCP Segment Len: 0]
    Sequence Number: 112    (relative sequence number)
    Sequence Number (raw): 3926084777
    [Next Sequence Number: 112    (relative sequence number)]
    Acknowledgment Number: 1    (relative ack number)
    Acknowledgment number (raw): 363949443
    0101 .... = Header Length: 20 bytes (5)
    Flags: 0x014 (RST, ACK)
        000. .... .... = Reserved: Not set
        ...0 .... .... = Nonce: Not set
        .... 0... .... = Congestion Window Reduced (CWR): Not set
        .... .0.. .... = ECN-Echo: Not set
        .... ..0. .... = Urgent: Not set
        .... ...1 .... = Acknowledgment: Set
        .... .... 0... = Push: Not set
        .... .... .1.. = Reset: Set
        .... .... ..0. = Syn: Not set
        .... .... ...0 = Fin: Not set
        [TCP Flags: ???????A?R??]
    Window: 0
    [Calculated window size: 0]
    [Window size scaling factor: 256]
    Checksum: 0x50b9 [unverified]
    [Checksum Status: Unverified]
    Urgent Pointer: 0
    [Timestamps]

________________________________
From: squid-users <squid-users-bounces at lists.squid-cache.org> on behalf of Aniruddha Gore <agnrie at hotmail.com>
Sent: Friday, May 7, 2021 2:14 AM
To: squid-users at lists.squid-cache.org <squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] HTTPS request times out going through Squid proxy

Matus, thanks a ton for your responses. I removed https_port and things started working again. Unfortunately, I am not sure what I was doing wrong before adding https_port. Well, it works now ?

________________________________
From: squid-users <squid-users-bounces at lists.squid-cache.org> on behalf of Matus UHLAR - fantomas <uhlar at fantomas.sk>
Sent: Friday, May 7, 2021 12:16 AM
To: squid-users at lists.squid-cache.org <squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] HTTPS request times out going through Squid proxy

On 07.05.21 06:52, Aniruddha Gore wrote:
>Thanks Matus for responding ?

no need for private copy, mailing list is enough.

>Following is what the relevant line in squid.conf:
>
># Squid normally listens to port 3128
>http_port 3128
>
>I suspect you might be pointing out that there is no https_port configured.

no. https_port is used for reverse proxying, not for forward proxying of
HTTPS requests.

> While I was adding https_port, I noticed no process is listening on port
> 3128 (doesn't appear in output of netstat -aon on Windows).  So now the
> calls are failing with "WinHttpSendRequest: 12029: A connection with the
> server could not be established" ?

>have you set up your squid host:port as HTTP proxy in the application?
- means: have you set up the applictaion to use HTTP proxy?

>Can you see anything in squid logs?
- what is in squid logs?


>From: squid-users <squid-users-bounces at lists.squid-cache.org> on behalf of Matus UHLAR - fantomas <uhlar at fantomas.sk>

>On 06.05.21 01:06, Aniruddha Gore wrote:
>> Pinging back hoping to get some help.  I suspect I am missing something
>> very basic and would really appreciate if someone could point me in the
>> right direction.  :)

>I haven't seen your packet trace but so far it shouldn't be needed.
>
>> Context I have an application running on a machine (A) that does not have
>> internet connectivity.  It, however, can talk to another machine (B) which
>> has full connectivity.  The application makes HTTPS calls.  I am hoping to
>> set-up Squid on B and set-up web proxy (ip address and port) when making
>> HTTPS calls in the app.
>
>
>> I have installed Squid for
>> Windows<https://na01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fsquid.diladele.com%2F&amp;data=04%7C01%7C%7C4d7fbe73b6a54cb719d908d911281327%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C637559686103881002%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&amp;sdata=hWCJM%2F3qqUc8Bz1%2BXup9cuVgJuX1ebIOi0i0tEBCUHU%3D&amp;reserved=0<https://na01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fsquid.diladele.com%2F&data=04%7C01%7C%7C5b9f4ed3b2034204fc8208d911818b94%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C637560070374693084%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&sdata=UsLb7lFoSjmXaeuRWeOar6dLcrYnzg7wu9SdnOen9q0%3D&reserved=0>>
>> on B with default squid config.
>>
>>
>> Problem HTTPS requests are timing out.
>>
>>
>> I am new to proxy so don't know lot of ways to investigate further.  This
>> is what Wireshark captured running on B.  Unfortunately, I am unable to
>> gather any actionable info from this, it just confirms that calls do make
>> it to B and then something wrong happens.


--
Matus UHLAR - fantomas, uhlar at fantomas.sk ; https://na01.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.fantomas.sk%2F&amp;data=04%7C01%7C%7C4d7fbe73b6a54cb719d908d911281327%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C637559686103881002%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&amp;sdata=qC21DM3hdaq8G7RL31UzChySvc4zp47nTDEZKyRLzvg%3D&amp;reserved=0<https://na01.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.fantomas.sk%2F&data=04%7C01%7C%7C5b9f4ed3b2034204fc8208d911818b94%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C637560070374703036%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&sdata=gD8S69S7YlhWJa%2Bp2e320Kp0F8wla3NAYA%2F5p5LKCys%3D&reserved=0>
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Spam = (S)tupid (P)eople's (A)dvertising (M)ethod
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
https://na01.safelinks.protection.outlook.com/?url=http%3A%2F%2Flists.squid-cache.org%2Flistinfo%2Fsquid-users&amp;data=04%7C01%7C%7C4d7fbe73b6a54cb719d908d911281327%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C637559686103881002%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&amp;sdata=aiHtVTBCRrd2X4OMofMnANin%2BXJa%2FkCTraf3VHa3ou0%3D&amp;reserved=0<https://na01.safelinks.protection.outlook.com/?url=http%3A%2F%2Flists.squid-cache.org%2Flistinfo%2Fsquid-users&data=04%7C01%7C%7C5b9f4ed3b2034204fc8208d911818b94%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C637560070374703036%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&sdata=c%2BDCZc7oj9eYa8O02xog9xX7Tf376EjKq9a8Pg%2Btmow%3D&reserved=0>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210510/859a1c69/attachment.htm>

From uhlar at fantomas.sk  Mon May 10 08:39:35 2021
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Mon, 10 May 2021 10:39:35 +0200
Subject: [squid-users] HTTPS request times out going through Squid proxy
In-Reply-To: <MW4PR15MB45246F662CB41C46DA007679D9549@MW4PR15MB4524.namprd15.prod.outlook.com>
References: <MW4PR15MB4524AC3130A7C0D346DD7D71D95B9@MW4PR15MB4524.namprd15.prod.outlook.com>
 <MW4PR15MB452469A0C3E520A35CD82AB3D95B9@MW4PR15MB4524.namprd15.prod.outlook.com>
 <MW4PR15MB45247FBE0AB19C63BEB2D335D9589@MW4PR15MB4524.namprd15.prod.outlook.com>
 <20210506061218.GA12715@fantomas.sk>
 <PH0PR15MB452574B2AFBE4CF86F558DF2D9579@PH0PR15MB4525.namprd15.prod.outlook.com>
 <20210507071637.GC20827@fantomas.sk>
 <MW4PR15MB452451647269BC78DB438BD0D9579@MW4PR15MB4524.namprd15.prod.outlook.com>
 <MW4PR15MB4524D997958D8AF37C23F4B4D9579@MW4PR15MB4524.namprd15.prod.outlook.com>
 <MW4PR15MB45246F662CB41C46DA007679D9549@MW4PR15MB4524.namprd15.prod.outlook.com>
Message-ID: <20210510083935.GA32242@fantomas.sk>

On 10.05.21 07:52, Aniruddha Gore wrote:
>Any help I could use?  :) The gist is: I have squid running on machine A,
> and an app on machine B.  The app sets proxy (A's ip address and squid
> port #) when making HTTP requests but the requests are failing.

>When I run Squid on the same machine where my application is running it
> works fine, but when I run Squid with the same exact default config on a
> different machine it doesn't.  I supply other machine's IP address and
> port (3128) on command line to my app, and it simply takes it and sets web
> proxy property on CPPRest SDK's http_config object.

>The access.log file has many lines like the following:
>1620409014.520  42289 <ip adress> TAG_NONE/500 0 CONNECT <uri>:443 - HIER_DIRECT/13.107.246.70 -

looks like the application correctly asks SQUID for CONNECT but something
happens after that.
Is there anything in cache.log for that time?
  
>When capturing network calls via Wireshark (on this other machine where
> Squid is running), the CONNECT call succeeds but the following TCP call
> seems to fail with a RESET status (Wireshark is highlighting it in
> Yellow).  Here's the frame if I am doing it right:

well, the CONNECT is send, but later squid replies with 500 internal error 

https://wiki.squid-cache.org/SquidFaq/SquidLogs#Squid_result_codes

the wireshark details don't show any message from squid. Maybe there is
none. 
-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
"One World. One Web. One Program." - Microsoft promotional advertisement
"Ein Volk, ein Reich, ein Fuhrer!" - Adolf Hitler


From kbvz at ymail.com  Mon May 10 10:26:59 2021
From: kbvz at ymail.com (Stephane Simon)
Date: Mon, 10 May 2021 10:26:59 +0000 (UTC)
Subject: [squid-users] SSL BUMP
References: <217701640.3617459.1620642419464.ref@mail.yahoo.com>
Message-ID: <217701640.3617459.1620642419464@mail.yahoo.com>

Hello,
I try to configure https? with ssl bump.I use redhat 8.

i follow?https://blog.microlinux.fr/squid-https-centos-7/when i restart squid, he doesn't cooperate and say:
"FATAL: The usr/lib64/squid/security_file_certgen -s /var/lib/squid/ssl_db -M 64MB helpers are crashing too rapidly, need help!"

i don't know how to fix this error..i dont know why i've this error ^^

Does someone have an idea please ?

squid.conf:
http_port 3130http_port 3128 intercepthttps_port 3129 intercept ssl-bump \? cert=/etc/squid/ssl_cert/certificat.pem \? generate-host-certificates=on \? dynamic_cert_mem_cache_size=64MB
#SSL certificate generationsslcrtd_program usr/lib64/squid/security_file_certgen -s /var/lib/squid/ssl_db -M 64MBsslcrtd_children 32 startup=5 idle=1
# SSL-Bumpacl step1 at_step SslBump1ssl_bump peek step1ssl_bump bump all

THANKS
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210510/c91e501a/attachment.htm>

From squid3 at treenet.co.nz  Mon May 10 12:54:37 2021
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Mon, 10 May 2021 12:54:37 -0000
Subject: [squid-users] [squid-announce] [ADVISORY] SQUID-2020:11 HTTP
 Request Smuggling
Message-ID: <7d4014d2-2be5-d435-e587-081596ea5902@treenet.co.nz>

__________________________________________________________________

     Squid Proxy Cache Security Update Advisory SQUID-2020:11
__________________________________________________________________

Advisory ID:       | SQUID-2020:11
Date:              | Oct 4, 2020
Summary:           | HTTP Request Smuggling
Affected versions: | Squid 2.x -> 2.7.STABLE9
                    | Squid 3.x -> 3.5.28
                    | Squid 4.x -> 4.13
                    | Squid 5.x -> 5.0.4
Fixed in version:  | Squid 4.14 and 5.0.5
__________________________________________________________________

   <http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-25097>
__________________________________________________________________

Problem Description:

  Due to improper input validation Squid is vulnerable to an HTTP
  Request Smuggling attack.

__________________________________________________________________

Severity:

  This problem allows a trusted client to perform HTTP Request
  Smuggling and access services otherwise forbidden by Squid
  security controls.

CVSS Score of 9.3
<https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:N/A:N/E:F/RL:O/RC:C/CR:H/IR:X/AR:X/MAV:N/MAC:L/MPR:N/MUI:N/MS:C/MC:H/MI:X/MA:X&version=3.1>

__________________________________________________________________

Updated Packages:

  This bug is fixed by Squid versions 4.14 and 5.0.5.

  In addition, patches addressing this problem for the stable
  releases can be found in our patch archives:

Squid 4:
  <http://www.squid-cache.org/Versions/v4/changesets/SQUID-2020_11.patch>

  If you are using a prepackaged version of Squid then please refer
  to the package vendor for availability information on updated
  packages.

__________________________________________________________________

Determining if your version is vulnerable:

  All Squid with squid.conf containing "uri_whitespace deny" are
  not vulnerable.

  All Squid with squid.conf containing "uri_whitespace encode" are
  not vulnerable.

  All Squid-4.x up to and including 4.13 without uri_whitespace in
  squid.conf are vulnerable.

  All Squid-4.x up to and including 4.13 with uri_whitespace in
  squid.conf configured to "allow" are vulnerable.

  All Squid-4.x up to and including 4.13 with uri_whitespace in
  squid.conf configured to "chop" are vulnerable.

  All Squid-4.x up to and including 4.13 with uri_whitespace in
  squid.conf configured to "strip" are vulnerable.

  All Squid-5.x up to and including 5.0.4 without uri_whitespace
  in squid.conf are vulnerable.

  All Squid-5.x up to and including 5.0.4 with uri_whitespace in
  squid.conf configured to "allow" are vulnerable.

  All Squid-5.x up to and including 5.0.4 with uri_whitespace in
  squid.conf configured to "chop" are vulnerable.

  All Squid-5.x up to and including 5.0.4 with uri_whitespace in
  squid.conf configured to "strip" are vulnerable.

__________________________________________________________________

Workaround:

Either,

   Configure squid.conf with uri_whitespace deny

Or,

   Configure squid.conf with uri_whitespace encode

__________________________________________________________________

Contact details for the Squid project:

  For installation / upgrade support on binary packaged versions
  of Squid: Your first point of contact should be your binary
  package vendor.

  If you install and build Squid from the original Squid sources
  then the <squid-users at lists.squid-cache.org> mailing list is your
  primary support point. For subscription details see
  <http://www.squid-cache.org/Support/mailing-lists.html>.

  For reporting of non-security bugs in the latest STABLE release
  the squid bugzilla database should be used
  <http://bugs.squid-cache.org/>.

  For reporting of security sensitive bugs send an email to the
  <squid-bugs at lists.squid-cache.org> mailing list. It's a closed
  list (though anyone can post) and security related bug reports
  are treated in confidence until the impact has been established.

__________________________________________________________________

Credits:

  This vulnerability was discovered by Jianjun Chen from ICSI,
  Berkeley.

  Fixed by Amos Jeffries of Treehouse Networks Ltd and
  Alex Rousskov of The Measurement Factory.

__________________________________________________________________

Revision history:

  2020-09-01 03:58:36 UTC Initial Report
  2020-09-03 03:03:24 UTC CVE Allocation
  2020-09-04 04:38:30 UTC Patches released
__________________________________________________________________
END
_______________________________________________
squid-announce mailing list
squid-announce at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-announce

From squid3 at treenet.co.nz  Mon May 10 12:33:20 2021
From: squid3 at treenet.co.nz (squid3 at treenet.co.nz)
Date: Tue, 11 May 2021 00:33:20 +1200
Subject: [squid-users] [squid-announce] Squid 4.15 is available
Message-ID: <b4aa817f251e803c193385e066a9a80c@treenet.co.nz>

The Squid HTTP Proxy team is very pleased to announce the availability
of the Squid-4.15 release!


This release is a security release resolving several issues found in
the prior Squid releases.


The major changes to be aware of since 4.13:

  * SQUID-2020:11 HTTP Request Smuggling
    (CVE-2020-25097)

This problem allows a trusted client to perform HTTP Request
Smuggling and access services otherwise forbidden by Squid
security controls.

See the advisory for patches:
  
<https://github.com/squid-cache/squid/security/advisories/GHSA-jvf6-h9gj-pmj6>


  * SQUID-2021:1 Denial of Service in URN processing
    (CVE-2021-28651)

This problem allows a malicious server in collaboration with a
trusted client to consume arbitrarily large amounts of memory
on the server running Squid.

Lack of available memory resources impacts all services on the
machine running Squid. Once initiated the DoS situation will
persist until Squid is shutdown.

See the advisory for patches:
  
<https://github.com/squid-cache/squid/security/advisories/GHSA-ch36-9jhx-phm4>


  * SQUID-2021:2 Denial of Service in HTTP Response Processing
    (CVE-2021-28662)

This problem allows a remote server to perform Denial of Service
when delivering HTTP Response messages. The issue trigger is a
header which can be expected to exist in HTTP traffic without any
malicious intent by the server.

See the advisory for patches:
  
<https://github.com/squid-cache/squid/security/advisories/GHSA-jjq6-mh2h-g39h>


  * SQUID-2021:3 Denial of Service issue in Cache Manager
    (CVE-2021-28652)

This problem allows a trusted client to trigger memory leaks
which over time lead to a Denial of Service against Squid and
the machine it is operating on.

This attack is limited to clients with Cache Manager API access
privilege.

See the advisory for patches:
  
<https://github.com/squid-cache/squid/security/advisories/GHSA-m47m-9hvw-7447>


  * SQUID-2021:4 Multiple issues in HTTP Range header
    (CVE-2021-31806, CVE-2021-31807, CVE-2021-31808)

These problems all allow a trusted client to perform Denial of
Service when making HTTP Range requests.

The CVE-2021-31808 problem allows a remote server to perform
Denial of Service when delivering responses to HTTP Range
requests. The issue trigger is a header which can be expected
to exist in HTTP traffic without any malicious intent.

See the advisory for patches:
  
<https://github.com/squid-cache/squid/security/advisories/GHSA-pxwq-f3qr-w2xf>


  * SQUID-2021:5 Denial of Service in HTTP Response Processing
    (CVE pending allocation)

This problem allows a remote server to perform Denial of Service
when delivering HTTP Response messages. The issue trigger is a
header which can be expected to exist in HTTP traffic without
any malicious intent by the server.

See the advisory for patches:
  
<https://github.com/squid-cache/squid/security/advisories/GHSA-572g-rvwr-6c7f>


   All users of Squid are urged to upgrade as soon as possible.


See the ChangeLog for the full list of changes in this and earlier
releases.

Please refer to the release notes at
http://www.squid-cache.org/Versions/v4/RELEASENOTES.html
when you are ready to make the switch to Squid-4

This new release can be downloaded from our HTTP or FTP servers

   http://www.squid-cache.org/Versions/v4/
   ftp://ftp.squid-cache.org/pub/squid/
   ftp://ftp.squid-cache.org/pub/archive/4/

or the mirrors. For a list of mirror sites see

   http://www.squid-cache.org/Download/http-mirrors.html
   http://www.squid-cache.org/Download/mirrors.html

If you encounter any issues with this release please file a bug report.
   http://bugs.squid-cache.org/


Amos Jeffries
_______________________________________________
squid-announce mailing list
squid-announce at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-announce

From squid3 at treenet.co.nz  Mon May 10 12:38:43 2021
From: squid3 at treenet.co.nz (squid3 at treenet.co.nz)
Date: Tue, 11 May 2021 00:38:43 +1200
Subject: [squid-users] [squid-announce] Squid 5.0.6 beta is available
Message-ID: <70a1893de7c4f9d20cf7a1560365df1b@treenet.co.nz>

The Squid HTTP Proxy team is very pleased to announce the availability
of the Squid-5.0.6 beta release!


This release is a security release resolving several issues found in
the prior Squid releases.


The major changes to be aware of since 5.0.4:

  * SQUID-2020:11 HTTP Request Smuggling
    (CVE-2020-25097)

This problem allows a trusted client to perform HTTP Request
Smuggling and access services otherwise forbidden by Squid
security controls.

See the advisory for patches:
  
<https://github.com/squid-cache/squid/security/advisories/GHSA-jvf6-h9gj-pmj6>


  * SQUID-2021:1 Denial of Service in URN processing
    (CVE-2021-28651)

This problem allows a malicious server in collaboration with a
trusted client to consume arbitrarily large amounts of memory
on the server running Squid.

Lack of available memory resources impacts all services on the
machine running Squid. Once initiated the DoS situation will
persist until Squid is shutdown.

See the advisory for patches:
  
<https://github.com/squid-cache/squid/security/advisories/GHSA-ch36-9jhx-phm4>


  * SQUID-2021:2 Denial of Service in HTTP Response Processing
    (CVE-2021-28662)

This problem allows a remote server to perform Denial of Service
when delivering HTTP Response messages. The issue trigger is a
header which can be expected to exist in HTTP traffic without any
malicious intent by the server.

See the advisory for patches:
  
<https://github.com/squid-cache/squid/security/advisories/GHSA-jjq6-mh2h-g39h>


  * SQUID-2021:3 Denial of Service issue in Cache Manager
    (CVE-2021-28652)

This problem allows a trusted client to trigger memory leaks
which over time lead to a Denial of Service against Squid and
the machine it is operating on.

This attack is limited to clients with Cache Manager API access
privilege.

See the advisory for patches:
  
<https://github.com/squid-cache/squid/security/advisories/GHSA-m47m-9hvw-7447>


  * SQUID-2021:4 Multiple issues in HTTP Range header
    (CVE-2021-31806, CVE-2021-31807, CVE-2021-31808)

These problems all allow a trusted client to perform Denial of
Service when making HTTP Range requests.

The CVE-2021-31808 problem allows a remote server to perform
Denial of Service when delivering responses to HTTP Range
requests. The issue trigger is a header which can be expected
to exist in HTTP traffic without any malicious intent.

See the advisory for patches:
  
<https://github.com/squid-cache/squid/security/advisories/GHSA-pxwq-f3qr-w2xf>


  * SQUID-2021:5 Denial of Service in HTTP Response Processing
    (CVE pending allocation)

This problem allows a remote server to perform Denial of Service
when delivering HTTP Response messages. The issue trigger is a
header which can be expected to exist in HTTP traffic without
any malicious intent by the server.

See the advisory for patches:
  
<https://github.com/squid-cache/squid/security/advisories/GHSA-572g-rvwr-6c7f>


  * TLS/1.3 support improvements

Prior to TLS v1.3 Squid could detect and fetch missing intermediate
server certificates by parsing TLS ServerHello. TLS v1.3 encrypts the
relevant part of the handshake, making such "prefetch" impossible.

This release contains a workaround that should be able to identify
the missing certificates on most (but maybe not all) TLS connections.

This release enhances existing error detailing code so that more
information is logged via the existing %err_code, %err_detail,
%ssl::<negotiated_version and %ssl::>negotiated_version logformat
codes.

Fix certificate validation error handling. This has an immediate
positive effect on the existing reporting of the client
certificate validation errors.


  * Regression in CONNECT URI syntax

Since Peering support for SSL-Bump feature was added CONNECT
request URI have not always contained a port. Squid-5.0.5
and later now correctly send a port number on all requests.


   All users of Squid are urged to upgrade as soon as possible.


See the ChangeLog for the full list of changes in this and earlier
releases.

Please refer to the release notes at
http://www.squid-cache.org/Versions/v5/RELEASENOTES.html
when you are ready to make the switch to Squid-5

This new release can be downloaded from our HTTP or FTP servers

   http://www.squid-cache.org/Versions/v5/
   ftp://ftp.squid-cache.org/pub/squid/
   ftp://ftp.squid-cache.org/pub/archive/5/

or the mirrors. For a list of mirror sites see

   http://www.squid-cache.org/Download/http-mirrors.html
   http://www.squid-cache.org/Download/mirrors.html

If you encounter any issues with this release please file a bug report.
   http://bugs.squid-cache.org/


Amos Jeffries
_______________________________________________
squid-announce mailing list
squid-announce at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-announce

From squid3 at treenet.co.nz  Mon May 10 12:39:55 2021
From: squid3 at treenet.co.nz (squid3 at treenet.co.nz)
Date: Tue, 11 May 2021 00:39:55 +1200
Subject: [squid-users] [squid-announce] [ADVISORY] SQUID-2021:1 Denial of
 Service in URN processing
Message-ID: <d77e50649a1d49c4cfc716b5abbb61d2@treenet.co.nz>

__________________________________________________________________

     Squid Proxy Cache Security Update Advisory SQUID-2021:1
__________________________________________________________________

Advisory ID:       | SQUID-2021:1
Date:              | May 10, 2021
Summary:           | Denial of Service in URN processing
Affected versions: | Squid 2.0 -> 4.14
                    | Squid 5.x -> 5.0.5
Fixed in version:  | Squid 4.15 and 5.0.6
__________________________________________________________________

   <http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-28651>
__________________________________________________________________

Problem Description:

  Due to a buffer management bug Squid is vulnerable to a
  Denial of service attack against the server it is operating on.

  This attack is limited to proxies which attempt to resolve a
  "urn:" resource identifier. Support for this resolving is enabled
  by default in all Squid.

__________________________________________________________________

Severity:

  This problem allows a malicious server in collaboration with a
  trusted client to consume arbitrarily large amounts of memory
  on the server running Squid.

  Lack of available memory resources impacts all services on the
  machine running Squid. Once initiated the DoS situation will
  persist until Squid is shutdown.

CVSS Score of 8.5
<https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=AV:N/AC:L/PR:N/UI:N/S:C/C:N/I:N/A:H/E:P/RL:O/RC:C/CR:X/IR:X/AR:H/MAV:N/MAC:L/MPR:N/MUI:R/MS:C/MC:X/MI:X/MA:H&version=3.1>

__________________________________________________________________

Updated Packages:

This bug is fixed by Squid versions 4.15 and 5.0.6.

  In addition, patches addressing this problem for the stable
  releases can be found in our patch archives:

Squid 4:
  
<http://www.squid-cache.org/Versions/v4/changesets/squid-4-a975fd5aedc866629214aaaccb38376855351899.patch>

  If you are using a prepackaged version of Squid then please refer
  to the package vendor for availability information on updated
  packages.

__________________________________________________________________

Determining if your version is vulnerable:

  Squid older than 3.5.28 have not been tested and should be
  assumed to be vulnerable.

  All Squid-4.x up to and including 4.14 are vulnerable.

  All Squid-5.x up to and including 5.0.5 are vulnerable.

__________________________________________________________________

Workaround:

  Disable URN processing by the proxy. Add these lines to
  squid.conf:

    acl URN proto URN
    http_access deny URN

__________________________________________________________________

Contact details for the Squid project:

  For installation / upgrade support on binary packaged versions
  of Squid: Your first point of contact should be your binary
  package vendor.

  If you install and build Squid from the original Squid sources
  then the <squid-users at lists.squid-cache.org> mailing list is your
  primary support point. For subscription details see
  <http://www.squid-cache.org/Support/mailing-lists.html>.

  For reporting of non-security bugs in the latest STABLE release
  the squid bugzilla database should be used
  <http://bugs.squid-cache.org/>.

  For reporting of security sensitive bugs send an email to the
  <squid-bugs at lists.squid-cache.org> mailing list. It's a closed
  list (though anyone can post) and security related bug reports
  are treated in confidence until the impact has been established.

__________________________________________________________________

Credits:

  This vulnerability was discovered by Joshua Rogers of Opera
  Software.

  Fixed by Amos Jeffries of Treehouse Networks Ltd.

__________________________________________________________________

Revision history:

  2021-02-22 06:55:38 UTC Initial Report
  2021-02-24 00:53:21 UTC Patch Released
  2021-03-17 06:19:09 UTC CVE Assignment
__________________________________________________________________
END
_______________________________________________
squid-announce mailing list
squid-announce at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-announce

From squid3 at treenet.co.nz  Mon May 10 12:40:58 2021
From: squid3 at treenet.co.nz (squid3 at treenet.co.nz)
Date: Tue, 11 May 2021 00:40:58 +1200
Subject: [squid-users] [squid-announce] [ADVISORY] SQUID-2021:2 Denial of
 Service in HTTP Response Processing
Message-ID: <1f452afd8db7e5da14d58c450af4bd8b@treenet.co.nz>

__________________________________________________________________

     Squid Proxy Cache Security Update Advisory SQUID-2021:2
__________________________________________________________________

Advisory ID:       | SQUID-2021:2
Date:              | May 10, 2021
Summary:           | Denial of Service in HTTP Response Processing
Affected versions: | Squid 4.x -> 4.14
                    | Squid 5.x -> 5.0.5
Fixed in version:  | Squid 4.15, 5.0.6
__________________________________________________________________

   <http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-28662>
__________________________________________________________________

Problem Description:

  Due to an input validation bug Squid is vulnerable to a Denial
  of Service against all clients using the proxy.

__________________________________________________________________

Severity:

  This problem allows a remote server to perform Denial of Service
  when delivering HTTP Response messages. The issue trigger is a
  header which can be expected to exist in HTTP traffic without any
  malicious intent by the server.

CVSS Score of 7.9
<https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:N/A:H/E:X/RL:O/RC:C/CR:X/IR:X/AR:H/MAV:N/MAC:L/MPR:N/MUI:R/MS:U/MC:N/MI:N/MA:H&version=3.1>

__________________________________________________________________

Updated Packages:

  This bug is fixed by Squid versions 4.15 and 5.0.6.

  In addition, patches addressing this problem for the stable
  releases can be found in our patch archives:

Squid 4:
  
<http://www.squid-cache.org/Versions/v4/changesets/squid-4-b1c37c9e7b30d0efb5e5ccf8200f2a646b9c36f8.patch>

  If you are using a prepackaged version of Squid then please refer
  to the package vendor for availability information on updated
  packages.

__________________________________________________________________

Determining if your version is vulnerable:

  All Squid older than 4.0 are not vulnerable.

  All Squid-4.x up to and including 4.14 are vulnerable.

  All Squid-5.x up to and including 5.0.5 are vulnerable.

__________________________________________________________________

Workaround:

  There are no known workarounds for this vulnerability.

__________________________________________________________________

Contact details for the Squid project:

  For installation / upgrade support on binary packaged versions
  of Squid: Your first point of contact should be your binary
  package vendor.

  If you install and build Squid from the original Squid sources
  then the <squid-users at lists.squid-cache.org> mailing list is your
  primary support point. For subscription details see
  <http://www.squid-cache.org/Support/mailing-lists.html>.

  For reporting of non-security bugs in the latest STABLE release
  the squid bugzilla database should be used
  <http://bugs.squid-cache.org/>.

  For reporting of security sensitive bugs send an email to the
  <squid-bugs at lists.squid-cache.org> mailing list. It's a closed
  list (though anyone can post) and security related bug reports
  are treated in confidence until the impact has been established.

__________________________________________________________________

Credits:

  This vulnerability was discovered by Joshua Rogers of Opera
  Software.

  Fixed by Alex Rousskov of The Measurement Factory.

__________________________________________________________________

Revision history:

  2021-03-08 19:45:14 UTC Initial Report
  2021-03-16 15:45:11 UTC Patch Released
  2021-03-18 01:33:50 UTC CVE Allocation
__________________________________________________________________
END
_______________________________________________
squid-announce mailing list
squid-announce at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-announce

From squid3 at treenet.co.nz  Mon May 10 12:43:06 2021
From: squid3 at treenet.co.nz (squid3 at treenet.co.nz)
Date: Tue, 11 May 2021 00:43:06 +1200
Subject: [squid-users] [squid-announce] [ADVISORY] SQUID-2021:4 Multiple
 issues in HTTP Range header
Message-ID: <80e8ffc8716ff55f379758c45f811803@treenet.co.nz>

__________________________________________________________________

Squid Proxy Cache Security Update Advisory SQUID-2021:4
__________________________________________________________________

Advisory ID:       | SQUID-2021:4
Date:              | May 10, 2021
Summary:           | Multiple issues in HTTP Range header
Affected versions: | Squid 2.5 -> 2.7.STABLE9
                    | Squid 3.x -> 3.5.28
                    | Squid 4.x -> 4.14
                    | Squid 5.x -> 5.0.5
Fixed in version:  | Squid 4.16, 5.0.6
__________________________________________________________________

   <http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-31806>
   <http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-31807>
   <http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-31808>
__________________________________________________________________

Problem Description:

  Due to an incorrect input validation bug Squid is vulnerable to
  a Denial of Service attack against all clients using the proxy.

  Due to an incorrect memory management bug Squid is vulnerable to
  a Denial of Service attack against all clients using the proxy.

  Due to an integer overflow bug Squid is vulnerable to a Denial
  of Service attack against all clients using the proxy.

__________________________________________________________________

Severity:

  These problems all allow a trusted client to perform Denial of
  Service when making HTTP Range requests.

  The integer overflow problem allows a remote server to perform
  Denial of Service when delivering responses to HTTP Range
  requests. The issue trigger is a header which can be expected to
  exist in HTTP traffic without any malicious intent.

CVSS Score of 8.0
<https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H/E:P/RL:O/RC:C/CR:X/IR:X/AR:H/MAV:N/MAC:L/MPR:L/MUI:N/MS:C/MC:X/MI:X/MA:H&version=3.1>

__________________________________________________________________

Updated Packages:

This bug is fixed by Squid versions 4.15 and 5.0.6.

  In addition, patches addressing this problem for the stable
  releases can be found in our patch archives:

Squid 4:
  
<http://www.squid-cache.org/Versions/v4/changesets/squid-4-e7cf864f938f24eea8af0692c04d16790983c823.patch>

Squid 5:
  
<http://www.squid-cache.org/Versions/v5/changesets/squid-5-6bf66733c122804fada7f5839ef5f3b57e57591c.patch>

  If you are using a prepackaged version of Squid then please refer
  to the package vendor for availability information on updated
  packages.

__________________________________________________________________

Determining if your version is vulnerable:

  Squid older than 3.5.28 have not been tested and should be
  assumed to be vulnerable.

  All Squid-4.x up to and including 4.14 are vulnerable.

  All Squid-5.x up to and including 5.0.5 are vulnerable.

__________________________________________________________________

Workaround:

  There are no workarounds known for these problems.

__________________________________________________________________

Contact details for the Squid project:

  For installation / upgrade support on binary packaged versions
  of Squid: Your first point of contact should be your binary
  package vendor.

  If you install and build Squid from the original Squid sources
  then the <squid-users at lists.squid-cache.org> mailing list is your
  primary support point. For subscription details see
  <http://www.squid-cache.org/Support/mailing-lists.html>.

  For reporting of non-security bugs in the latest STABLE release
  the squid bugzilla database should be used
  <http://bugs.squid-cache.org/>.

  For reporting of security sensitive bugs send an email to the
  <squid-bugs at lists.squid-cache.org> mailing list. It's a closed
  list (though anyone can post) and security related bug reports
  are treated in confidence until the impact has been established.

__________________________________________________________________

Credits:

  This vulnerability was discovered by Joshua Rogers of Opera
  Software.

  Fixed by Alex Rousskov of The Measurement Factory.

__________________________________________________________________

Revision history:

  2021-03-19 06:49:52 UTC Initial Report of Denial of Service
  2021-03-24 08:51:08 UTC Additional Report of Use-After-Free
  2021-03-25 21:57:07 UTC Additional Report of integer-overflow
__________________________________________________________________
END
_______________________________________________
squid-announce mailing list
squid-announce at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-announce

From squid3 at treenet.co.nz  Mon May 10 12:44:36 2021
From: squid3 at treenet.co.nz (squid3 at treenet.co.nz)
Date: Tue, 11 May 2021 00:44:36 +1200
Subject: [squid-users] [squid-announce] [ADVISORY] SQUID-2021:3 Denial of
 Service issue in Cache Manager
Message-ID: <75dea3b7e7204af75cc3d0a960f72c18@treenet.co.nz>

__________________________________________________________________

Squid Proxy Cache Security Update Advisory SQUID-2021:3
__________________________________________________________________

Advisory ID:       | SQUID-2021:3
Date:              | May 10, 2021
Summary:           | Denial of Service issue in Cache Manager
Affected versions: | Squid 1.x -> 3.5.28
                    | Squid 4.x -> 4.14
                    | Squid 5.x -> 5.0.4
Fixed in version:  | Squid 4.15 and 5.0.5
__________________________________________________________________

   <http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-28652>
__________________________________________________________________

Problem Description:

  Due to an incorrect parser validation bug Squid is vulnerable to
  a Denial of Service attack against the Cache Manager API.

__________________________________________________________________

Severity:

  This problem allows a trusted client to trigger memory leaks
  which over time lead to a Denial of Service against Squid and
  the machine it is operating on.

  This attack is limited to clients with Cache Manager API access
  privilege.

CVSS Score of 7.8
https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=AV:N/AC:H/PR:H/UI:N/S:C/C:N/I:N/A:H/E:F/RL:O/RC:C/CR:X/IR:X/AR:H/MAV:N/MAC:H/MPR:H/MUI:N/MS:C/MC:X/MI:X/MA:H&version=3.1

__________________________________________________________________

Updated Packages:

This bug is fixed by Squid versions 4.15 and 5.0.6.

  In addition, patches addressing this problem for the stable
  releases can be found in our patch archives:

Squid 4:
  
<http://www.squid-cache.org/Versions/v4/changesets/squid-4-0003e3518dc95e4b5ab46b5140af79b22253048e.patch>

Squid 5:
  
<http://www.squid-cache.org/Versions/v5/changesets/squid-5-2db70e04723cedd19a90dba8b863ccbc2e708f8e.patch>

  If you are using a prepackaged version of Squid then please refer
  to the package vendor for availability information on updated
  packages.

__________________________________________________________________

Determining if your version is vulnerable:

  Squid older than 3.5.28 have not been tested and should be
  assumed to be vulnerable.

  All Squid-4.x up to and including 4.14 are vulnerable.

  All Squid-5.x up to and including 5.0.4 are vulnerable.

__________________________________________________________________

Workaround:

Either,

  Disable Cache Manager access entirely if not needed.

  Place the following line in squid.conf before lines containing
  "allow" :

    http_access deny manager

Or,

  Harden Cache Manager access privileges.

  For example; require authentication or other access controls in
  http_access beyond the default IP address restriction.

__________________________________________________________________

Contact details for the Squid project:

  For installation / upgrade support on binary packaged versions
  of Squid: Your first point of contact should be your binary
  package vendor.

  If you install and build Squid from the original Squid sources
  then the <squid-users at lists.squid-cache.org> mailing list is your
  primary support point. For subscription details see
  <http://www.squid-cache.org/Support/mailing-lists.html>.

  For reporting of non-security bugs in the latest STABLE release
  the squid bugzilla database should be used
  <http://bugs.squid-cache.org/>.

  For reporting of security sensitive bugs send an email to the
  <squid-bugs at lists.squid-cache.org> mailing list. It's a closed
  list (though anyone can post) and security related bug reports
  are treated in confidence until the impact has been established.

__________________________________________________________________

Credits:

  This vulnerability was discovered by Joshua Rogers of Opera
  Software.

  Fixed by Amos Jeffries of Treehouse Networks Ltd.

__________________________________________________________________

Revision history:

  2021-03-03 17:02:25 UTC Initial Report
  2021-03-16 01:59:45 UTC Patch Released
  2021-03-17 06:19:09 UTC CVE Assignment
__________________________________________________________________
END
_______________________________________________
squid-announce mailing list
squid-announce at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-announce

From squid3 at treenet.co.nz  Mon May 10 12:46:42 2021
From: squid3 at treenet.co.nz (squid3 at treenet.co.nz)
Date: Tue, 11 May 2021 00:46:42 +1200
Subject: [squid-users] [squid-announce] [ADVISORY] SQUID-2021:5 Denial of
 Service in HTTP Response Processing
Message-ID: <c2593db6716cd41dc0c279fe2e24fa2a@treenet.co.nz>

__________________________________________________________________

Squid Proxy Cache Security Update Advisory SQUID-2021:5
__________________________________________________________________

Advisory ID:       | SQUID-2021:5
Date:              | May 10, 2021
Summary:           | Denial of Service in HTTP Response Processing
Affected versions: | Squid 2.x -> 2.7.STABLE9
                    | Squid 3.x -> 3.5.28
                    | Squid 4.x -> 4.14
                    | Squid 5.x -> 5.0.5
Fixed in version:  | Squid 4.15, 5.0.6
__________________________________________________________________


__________________________________________________________________

Problem Description:

  Due to an input validation bug Squid is vulnerable to a Denial
  of Service against all clients using the proxy.

__________________________________________________________________

Severity:

  This problem allows a remote server to perform Denial of Service
  when delivering HTTP Response messages. The issue trigger is a
  header which can be expected to exist in HTTP traffic without
  any malicious intent by the server.

CVSS Score of 8.8
<https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H/E:P/RL:O/RC:C/CR:X/IR:X/AR:H/MAV:N/MAC:L/MPR:L/MUI:N/MS:C/MC:X/MI:X/MA:H&version=3.1>

__________________________________________________________________

Updated Packages:

This bug is fixed by Squid versions 4.15 and 5.0.6.

  In addition, patches addressing this problem for the stable
  releases can be found in our patch archives:

Squid 4:
  
<http://www.squid-cache.org/Versions/v4/changesets/squid-4-1e05a85bd28c22c9ca5d3ac9f5e86d6269ec0a8c.patch>

Squid 5:
  
<http://www.squid-cache.org/Versions/v5/changesets/squid-5-8af775ed98bfd610f9ce762fe177e01b2675588c.patch>

  If you are using a prepackaged version of Squid then please refer
  to the package vendor for availability information on updated
  packages.

__________________________________________________________________

Determining if your version is vulnerable:

  Squid older than 4.15 have not been tested and should be
  assumed to be vulnerable.

  All Squid-5.x up to and including 5.0.5 are vulnerable.

__________________________________________________________________

Workaround:

  There are no known workarounds to this issue.

__________________________________________________________________

Contact details for the Squid project:

  For installation / upgrade support on binary packaged versions
  of Squid: Your first point of contact should be your binary
  package vendor.

  If you install and build Squid from the original Squid sources
  then the <squid-users at lists.squid-cache.org> mailing list is your
  primary support point. For subscription details see
  <http://www.squid-cache.org/Support/mailing-lists.html>.

  For reporting of non-security bugs in the latest STABLE release
  the squid bugzilla database should be used
  <http://bugs.squid-cache.org/>.

  For reporting of security sensitive bugs send an email to the
  <squid-bugs at lists.squid-cache.org> mailing list. It's a closed
  list (though anyone can post) and security related bug reports
  are treated in confidence until the impact has been established.

__________________________________________________________________

Credits:

  This vulnerability was discovered by Joshua Rogers of Opera
  Software.

  Fixed by Alex Rousskov of The Measurement Factory.

__________________________________________________________________

Revision history:

  2021-03-05 22:11:43 UTC Initial Report
__________________________________________________________________
END
_______________________________________________
squid-announce mailing list
squid-announce at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-announce

From agnrie at hotmail.com  Mon May 10 16:31:34 2021
From: agnrie at hotmail.com (Aniruddha Gore)
Date: Mon, 10 May 2021 16:31:34 +0000
Subject: [squid-users] HTTPS request times out going through Squid proxy
In-Reply-To: <20210510083935.GA32242@fantomas.sk>
References: <MW4PR15MB4524AC3130A7C0D346DD7D71D95B9@MW4PR15MB4524.namprd15.prod.outlook.com>
 <MW4PR15MB452469A0C3E520A35CD82AB3D95B9@MW4PR15MB4524.namprd15.prod.outlook.com>
 <MW4PR15MB45247FBE0AB19C63BEB2D335D9589@MW4PR15MB4524.namprd15.prod.outlook.com>
 <20210506061218.GA12715@fantomas.sk>
 <PH0PR15MB452574B2AFBE4CF86F558DF2D9579@PH0PR15MB4525.namprd15.prod.outlook.com>
 <20210507071637.GC20827@fantomas.sk>
 <MW4PR15MB452451647269BC78DB438BD0D9579@MW4PR15MB4524.namprd15.prod.outlook.com>
 <MW4PR15MB4524D997958D8AF37C23F4B4D9579@MW4PR15MB4524.namprd15.prod.outlook.com>
 <MW4PR15MB45246F662CB41C46DA007679D9549@MW4PR15MB4524.namprd15.prod.outlook.com>,
 <20210510083935.GA32242@fantomas.sk>
Message-ID: <MW4PR15MB4524D114DD759AE1765BDA8ED9549@MW4PR15MB4524.namprd15.prod.outlook.com>

Matus, I see multiple lines like the following in access.log:

1620413633.857  42280 <source ip address> TAG_NONE/500 0 CONNECT <uri>:443 - HIER_DIRECT/13.107.246.70 -

There is no other information in those logs.

Aniruddha Gore
Sent from Outlook.com<http://www.microsoft.com/en-us/outlook-com/compare/>
________________________________
From: squid-users <squid-users-bounces at lists.squid-cache.org> on behalf of Matus UHLAR - fantomas <uhlar at fantomas.sk>
Sent: Monday, May 10, 2021 1:39 AM
To: squid-users at lists.squid-cache.org <squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] HTTPS request times out going through Squid proxy

On 10.05.21 07:52, Aniruddha Gore wrote:
>Any help I could use?  :) The gist is: I have squid running on machine A,
> and an app on machine B.  The app sets proxy (A's ip address and squid
> port #) when making HTTP requests but the requests are failing.

>When I run Squid on the same machine where my application is running it
> works fine, but when I run Squid with the same exact default config on a
> different machine it doesn't.  I supply other machine's IP address and
> port (3128) on command line to my app, and it simply takes it and sets web
> proxy property on CPPRest SDK's http_config object.

>The access.log file has many lines like the following:
>1620409014.520  42289 <ip adress> TAG_NONE/500 0 CONNECT <uri>:443 - HIER_DIRECT/13.107.246.70 -

looks like the application correctly asks SQUID for CONNECT but something
happens after that.
Is there anything in cache.log for that time?

>When capturing network calls via Wireshark (on this other machine where
> Squid is running), the CONNECT call succeeds but the following TCP call
> seems to fail with a RESET status (Wireshark is highlighting it in
> Yellow).  Here's the frame if I am doing it right:

well, the CONNECT is send, but later squid replies with 500 internal error

https://na01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwiki.squid-cache.org%2FSquidFaq%2FSquidLogs%23Squid_result_codes&amp;data=04%7C01%7C%7Cdc69a637d58a4576c96408d9138f29c0%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C637562327862884909%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&amp;sdata=%2FQkaYj8Qg3zlUkUo6DEVUGnWIyr2ztSC0p0kmqcOcD8%3D&amp;reserved=0

the wireshark details don't show any message from squid. Maybe there is
none.
--
Matus UHLAR - fantomas, uhlar at fantomas.sk ; https://na01.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.fantomas.sk%2F&amp;data=04%7C01%7C%7Cdc69a637d58a4576c96408d9138f29c0%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C637562327862894867%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&amp;sdata=cG%2FSXRy9Pn23Rzg9OqEKHwZP3tJZRk5Ckm527qZrjGM%3D&amp;reserved=0
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
"One World. One Web. One Program." - Microsoft promotional advertisement
"Ein Volk, ein Reich, ein Fuhrer!" - Adolf Hitler
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
https://na01.safelinks.protection.outlook.com/?url=http%3A%2F%2Flists.squid-cache.org%2Flistinfo%2Fsquid-users&amp;data=04%7C01%7C%7Cdc69a637d58a4576c96408d9138f29c0%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C637562327862894867%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&amp;sdata=FzZeIhD54BRaLwTpkQeJh4b8lutAaCw1I48UfwYyPK8%3D&amp;reserved=0
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210510/abbf8c4a/attachment.htm>

From uhlar at fantomas.sk  Mon May 10 17:06:27 2021
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Mon, 10 May 2021 19:06:27 +0200
Subject: [squid-users] HTTPS request times out going through Squid proxy
In-Reply-To: <MW4PR15MB4524D114DD759AE1765BDA8ED9549@MW4PR15MB4524.namprd15.prod.outlook.com>
References: <MW4PR15MB452469A0C3E520A35CD82AB3D95B9@MW4PR15MB4524.namprd15.prod.outlook.com>
 <MW4PR15MB45247FBE0AB19C63BEB2D335D9589@MW4PR15MB4524.namprd15.prod.outlook.com>
 <20210506061218.GA12715@fantomas.sk>
 <PH0PR15MB452574B2AFBE4CF86F558DF2D9579@PH0PR15MB4525.namprd15.prod.outlook.com>
 <20210507071637.GC20827@fantomas.sk>
 <MW4PR15MB452451647269BC78DB438BD0D9579@MW4PR15MB4524.namprd15.prod.outlook.com>
 <MW4PR15MB4524D997958D8AF37C23F4B4D9579@MW4PR15MB4524.namprd15.prod.outlook.com>
 <MW4PR15MB45246F662CB41C46DA007679D9549@MW4PR15MB4524.namprd15.prod.outlook.com>
 <20210510083935.GA32242@fantomas.sk>
 <MW4PR15MB4524D114DD759AE1765BDA8ED9549@MW4PR15MB4524.namprd15.prod.outlook.com>
Message-ID: <20210510170627.GA14812@fantomas.sk>

On 10.05.21 16:31, Aniruddha Gore wrote:
>Matus, I see multiple lines like the following in access.log:
>
>1620413633.857  42280 <source ip address> TAG_NONE/500 0 CONNECT <uri>:443 - HIER_DIRECT/13.107.246.70 -

>There is no other information in those logs.

cache.log is different logfile, I have asked for that one.
I hope windows version of squid doesn't send cache log to system event log.

>On 10.05.21 07:52, Aniruddha Gore wrote:
>>Any help I could use?  :) The gist is: I have squid running on machine A,
>> and an app on machine B.  The app sets proxy (A's ip address and squid
>> port #) when making HTTP requests but the requests are failing.
>
>>When I run Squid on the same machine where my application is running it
>> works fine, but when I run Squid with the same exact default config on a
>> different machine it doesn't.  I supply other machine's IP address and
>> port (3128) on command line to my app, and it simply takes it and sets web
>> proxy property on CPPRest SDK's http_config object.
>
>>The access.log file has many lines like the following:
>>1620409014.520  42289 <ip adress> TAG_NONE/500 0 CONNECT <uri>:443 - HIER_DIRECT/13.107.246.70 -
>
>looks like the application correctly asks SQUID for CONNECT but something
>happens after that.
>Is there anything in cache.log for that time?
>
>>When capturing network calls via Wireshark (on this other machine where
>> Squid is running), the CONNECT call succeeds but the following TCP call
>> seems to fail with a RESET status (Wireshark is highlighting it in
>> Yellow).  Here's the frame if I am doing it right:
>
>well, the CONNECT is send, but later squid replies with 500 internal error
>
>https://na01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwiki.squid-cache.org%2FSquidFaq%2FSquidLogs%23Squid_result_codes&amp;data=04%7C01%7C%7Cdc69a637d58a4576c96408d9138f29c0%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C637562327862884909%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&amp;sdata=%2FQkaYj8Qg3zlUkUo6DEVUGnWIyr2ztSC0p0kmqcOcD8%3D&amp;reserved=0
>
>the wireshark details don't show any message from squid. Maybe there is
>none.

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Spam is for losers who can't get business any other way.


From agnrie at hotmail.com  Mon May 10 17:43:46 2021
From: agnrie at hotmail.com (Aniruddha Gore)
Date: Mon, 10 May 2021 17:43:46 +0000
Subject: [squid-users] HTTPS request times out going through Squid proxy
In-Reply-To: <20210510170627.GA14812@fantomas.sk>
References: <MW4PR15MB452469A0C3E520A35CD82AB3D95B9@MW4PR15MB4524.namprd15.prod.outlook.com>
 <MW4PR15MB45247FBE0AB19C63BEB2D335D9589@MW4PR15MB4524.namprd15.prod.outlook.com>
 <20210506061218.GA12715@fantomas.sk>
 <PH0PR15MB452574B2AFBE4CF86F558DF2D9579@PH0PR15MB4525.namprd15.prod.outlook.com>
 <20210507071637.GC20827@fantomas.sk>
 <MW4PR15MB452451647269BC78DB438BD0D9579@MW4PR15MB4524.namprd15.prod.outlook.com>
 <MW4PR15MB4524D997958D8AF37C23F4B4D9579@MW4PR15MB4524.namprd15.prod.outlook.com>
 <MW4PR15MB45246F662CB41C46DA007679D9549@MW4PR15MB4524.namprd15.prod.outlook.com>
 <20210510083935.GA32242@fantomas.sk>
 <MW4PR15MB4524D114DD759AE1765BDA8ED9549@MW4PR15MB4524.namprd15.prod.outlook.com>,
 <20210510170627.GA14812@fantomas.sk>
Message-ID: <MW4PR15MB4524F0BFAF5C8E5B1A2D541DD9549@MW4PR15MB4524.namprd15.prod.outlook.com>

My bad, here is cache.log lines from that same day:

2021/05/07 02:50:34 kid1| Set Current Directory to /var/cache/squid
2021/05/07 02:50:34 kid1| Starting Squid Cache version 3.5.28 for x86_64-unknown-cygwin...
2021/05/07 02:50:34 kid1| Service Name: squid
2021/05/07 02:50:34 kid1| Process ID 5300
2021/05/07 02:50:34 kid1| Process Roles: worker
2021/05/07 02:50:34 kid1| With 3200 file descriptors available
2021/05/07 02:50:34 kid1| Initializing IP Cache...
2021/05/07 02:50:34 kid1| parseEtcHosts: /etc/hosts: (2) No such file or directory
2021/05/07 02:50:34 kid1| DNS Socket created at [::], FD 5
2021/05/07 02:50:34 kid1| DNS Socket created at 0.0.0.0, FD 6
2021/05/07 02:50:34 kid1| Adding nameserver 8.8.8.8 from squid.conf
2021/05/07 02:50:34 kid1| Adding nameserver 208.67.222.222 from squid.conf
2021/05/07 02:50:35 kid1| Logfile: opening log daemon:/var/log/squid/access.log
2021/05/07 02:50:35 kid1| Logfile Daemon: opening log /var/log/squid/access.log
2021/05/07 02:50:35 kid1| WARNING: no_suid: setuid(0): (22) Invalid argument
2021/05/07 02:50:35 kid1| Store logging disabled
2021/05/07 02:50:35 kid1| Swap maxSize 0 + 262144 KB, estimated 20164 objects
2021/05/07 02:50:35 kid1| Target number of buckets: 1008
2021/05/07 02:50:35 kid1| Using 8192 Store buckets
2021/05/07 02:50:35 kid1| Max Mem  size: 262144 KB
2021/05/07 02:50:35 kid1| Max Swap size: 0 KB
2021/05/07 02:50:35 kid1| Using Least Load store dir selection
2021/05/07 02:50:35 kid1| Set Current Directory to /var/cache/squid
2021/05/07 02:50:35 kid1| Finished loading MIME types and icons.
2021/05/07 02:50:35 kid1| HTCP Disabled.
2021/05/07 02:50:35 kid1| Squid plugin modules loaded: 0
2021/05/07 02:50:35 kid1| Adaptation support is off.
2021/05/07 02:50:35 kid1| Accepting HTTP Socket connections at local=[::]:3128 remote=[::] FD 10 flags=9
2021/05/07 02:50:36 kid1| storeLateRelease: released 0 objects
2021/05/07 10:24:37 kid1| Set Current Directory to /var/cache/squid
2021/05/07 10:24:37 kid1| Starting Squid Cache version 3.5.28 for x86_64-unknown-cygwin...
2021/05/07 10:24:37 kid1| Service Name: squid
2021/05/07 10:24:37 kid1| Process ID 25760
2021/05/07 10:24:37 kid1| Process Roles: worker
2021/05/07 10:24:37 kid1| With 3200 file descriptors available
2021/05/07 10:24:37 kid1| Initializing IP Cache...
2021/05/07 10:24:37 kid1| parseEtcHosts: /etc/hosts: (2) No such file or directory
2021/05/07 10:24:37 kid1| DNS Socket created at [::], FD 5
2021/05/07 10:24:37 kid1| DNS Socket created at 0.0.0.0, FD 6
2021/05/07 10:24:37 kid1| Adding nameserver 8.8.8.8 from squid.conf
2021/05/07 10:24:37 kid1| Adding nameserver 208.67.222.222 from squid.conf
2021/05/07 10:24:38 kid1| Logfile: opening log daemon:/var/log/squid/access.log
2021/05/07 10:24:38 kid1| Logfile Daemon: opening log /var/log/squid/access.log
2021/05/07 10:24:38 kid1| WARNING: no_suid: setuid(0): (22) Invalid argument
2021/05/07 10:24:38 kid1| Store logging disabled
2021/05/07 10:24:38 kid1| Swap maxSize 0 + 262144 KB, estimated 20164 objects
2021/05/07 10:24:38 kid1| Target number of buckets: 1008
2021/05/07 10:24:38 kid1| Using 8192 Store buckets
2021/05/07 10:24:38 kid1| Max Mem  size: 262144 KB
2021/05/07 10:24:38 kid1| Max Swap size: 0 KB
2021/05/07 10:24:38 kid1| Using Least Load store dir selection
2021/05/07 10:24:38 kid1| Set Current Directory to /var/cache/squid
2021/05/07 10:24:38 kid1| Finished loading MIME types and icons.
2021/05/07 10:24:38 kid1| HTCP Disabled.
2021/05/07 10:24:38 kid1| Squid plugin modules loaded: 0
2021/05/07 10:24:38 kid1| Adaptation support is off.
2021/05/07 10:24:38 kid1| Accepting HTTP Socket connections at local=[::]:3128 remote=[::] FD 10 flags=9
2021/05/07 10:24:39 kid1| storeLateRelease: released 0 objects
2021/05/07 10:26:22 kid1| Set Current Directory to /var/cache/squid
2021/05/07 10:26:22 kid1| Starting Squid Cache version 3.5.28 for x86_64-unknown-cygwin...
2021/05/07 10:26:22 kid1| Service Name: squid
2021/05/07 10:26:22 kid1| Process ID 16944
2021/05/07 10:26:22 kid1| Process Roles: worker
2021/05/07 10:26:22 kid1| With 3200 file descriptors available
2021/05/07 10:26:22 kid1| Initializing IP Cache...
2021/05/07 10:26:22 kid1| parseEtcHosts: /etc/hosts: (2) No such file or directory
2021/05/07 10:26:22 kid1| DNS Socket created at [::], FD 5
2021/05/07 10:26:22 kid1| DNS Socket created at 0.0.0.0, FD 6
2021/05/07 10:26:22 kid1| Adding nameserver 8.8.8.8 from squid.conf
2021/05/07 10:26:22 kid1| Adding nameserver 208.67.222.222 from squid.conf
2021/05/07 10:26:22 kid1| Logfile: opening log daemon:/var/log/squid/access.log
2021/05/07 10:26:22 kid1| Logfile Daemon: opening log /var/log/squid/access.log
2021/05/07 10:26:22 kid1| WARNING: no_suid: setuid(0): (22) Invalid argument
2021/05/07 10:26:22 kid1| Store logging disabled
2021/05/07 10:26:22 kid1| Swap maxSize 0 + 262144 KB, estimated 20164 objects
2021/05/07 10:26:22 kid1| Target number of buckets: 1008
2021/05/07 10:26:22 kid1| Using 8192 Store buckets
2021/05/07 10:26:22 kid1| Max Mem  size: 262144 KB
2021/05/07 10:26:22 kid1| Max Swap size: 0 KB
2021/05/07 10:26:22 kid1| Using Least Load store dir selection
2021/05/07 10:26:22 kid1| Set Current Directory to /var/cache/squid
2021/05/07 10:26:22 kid1| Finished loading MIME types and icons.
2021/05/07 10:26:22 kid1| HTCP Disabled.
2021/05/07 10:26:22 kid1| Squid plugin modules loaded: 0
2021/05/07 10:26:22 kid1| Adaptation support is off.
2021/05/07 10:26:22 kid1| Accepting HTTP Socket connections at local=[::]:3128 remote=[::] FD 10 flags=9
2021/05/07 10:26:23 kid1| storeLateRelease: released 0 objects
2021/05/07 10:31:27 kid1| Set Current Directory to /var/cache/squid
2021/05/07 10:31:27 kid1| Starting Squid Cache version 3.5.28 for x86_64-unknown-cygwin...
2021/05/07 10:31:27 kid1| Service Name: squid
2021/05/07 10:31:27 kid1| Process ID 25116
2021/05/07 10:31:27 kid1| Process Roles: worker
2021/05/07 10:31:27 kid1| With 3200 file descriptors available
2021/05/07 10:31:27 kid1| Initializing IP Cache...
2021/05/07 10:31:27 kid1| parseEtcHosts: /etc/hosts: (2) No such file or directory
2021/05/07 10:31:27 kid1| DNS Socket created at [::], FD 5
2021/05/07 10:31:27 kid1| DNS Socket created at 0.0.0.0, FD 6
2021/05/07 10:31:27 kid1| Adding nameserver 8.8.8.8 from squid.conf
2021/05/07 10:31:27 kid1| Adding nameserver 208.67.222.222 from squid.conf
2021/05/07 10:31:27 kid1| Logfile: opening log daemon:/var/log/squid/access.log
2021/05/07 10:31:27 kid1| Logfile Daemon: opening log /var/log/squid/access.log
2021/05/07 10:31:27 kid1| WARNING: no_suid: setuid(0): (22) Invalid argument
2021/05/07 10:31:27 kid1| Store logging disabled
2021/05/07 10:31:27 kid1| Swap maxSize 0 + 262144 KB, estimated 20164 objects
2021/05/07 10:31:27 kid1| Target number of buckets: 1008
2021/05/07 10:31:27 kid1| Using 8192 Store buckets
2021/05/07 10:31:27 kid1| Max Mem  size: 262144 KB
2021/05/07 10:31:27 kid1| Max Swap size: 0 KB
2021/05/07 10:31:27 kid1| Using Least Load store dir selection
2021/05/07 10:31:27 kid1| Set Current Directory to /var/cache/squid
2021/05/07 10:31:27 kid1| Finished loading MIME types and icons.
2021/05/07 10:31:27 kid1| HTCP Disabled.
2021/05/07 10:31:27 kid1| Squid plugin modules loaded: 0
2021/05/07 10:31:27 kid1| Adaptation support is off.
2021/05/07 10:31:27 kid1| Accepting HTTP Socket connections at local=192.168.1.10:3128 remote=[::] FD 10 flags=9
2021/05/07 10:31:28 kid1| storeLateRelease: released 0 objects
2021/05/07 10:35:43 kid1| Set Current Directory to /var/cache/squid
2021/05/07 10:35:43 kid1| Starting Squid Cache version 3.5.28 for x86_64-unknown-cygwin...
2021/05/07 10:35:43 kid1| Service Name: squid
2021/05/07 10:35:43 kid1| Process ID 27908
2021/05/07 10:35:43 kid1| Process Roles: worker
2021/05/07 10:35:43 kid1| With 3200 file descriptors available
2021/05/07 10:35:43 kid1| Initializing IP Cache...
2021/05/07 10:35:43 kid1| parseEtcHosts: /etc/hosts: (2) No such file or directory
2021/05/07 10:35:43 kid1| DNS Socket created at [::], FD 5
2021/05/07 10:35:43 kid1| DNS Socket created at 0.0.0.0, FD 6
2021/05/07 10:35:43 kid1| Adding nameserver 8.8.8.8 from squid.conf
2021/05/07 10:35:43 kid1| Adding nameserver 208.67.222.222 from squid.conf
2021/05/07 10:35:43 kid1| Logfile: opening log daemon:/var/log/squid/access.log
2021/05/07 10:35:43 kid1| Logfile Daemon: opening log /var/log/squid/access.log
2021/05/07 10:35:43 kid1| WARNING: no_suid: setuid(0): (22) Invalid argument
2021/05/07 10:35:43 kid1| Store logging disabled
2021/05/07 10:35:43 kid1| Swap maxSize 0 + 262144 KB, estimated 20164 objects
2021/05/07 10:35:43 kid1| Target number of buckets: 1008
2021/05/07 10:35:43 kid1| Using 8192 Store buckets
2021/05/07 10:35:43 kid1| Max Mem  size: 262144 KB
2021/05/07 10:35:43 kid1| Max Swap size: 0 KB
2021/05/07 10:35:43 kid1| Using Least Load store dir selection
2021/05/07 10:35:43 kid1| Set Current Directory to /var/cache/squid
2021/05/07 10:35:43 kid1| Finished loading MIME types and icons.
2021/05/07 10:35:43 kid1| HTCP Disabled.
2021/05/07 10:35:43 kid1| Squid plugin modules loaded: 0
2021/05/07 10:35:43 kid1| Adaptation support is off.
2021/05/07 10:35:43 kid1| Accepting HTTP Socket connections at local=[::]:3128 remote=[::] FD 10 flags=9
2021/05/07 10:35:44 kid1| storeLateRelease: released 0 objects

Aniruddha Gore
Sent from Outlook.com<http://www.microsoft.com/en-us/outlook-com/compare/>
________________________________
From: squid-users <squid-users-bounces at lists.squid-cache.org> on behalf of Matus UHLAR - fantomas <uhlar at fantomas.sk>
Sent: Monday, May 10, 2021 10:06 AM
To: squid-users at lists.squid-cache.org <squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] HTTPS request times out going through Squid proxy

On 10.05.21 16:31, Aniruddha Gore wrote:
>Matus, I see multiple lines like the following in access.log:
>
>1620413633.857  42280 <source ip address> TAG_NONE/500 0 CONNECT <uri>:443 - HIER_DIRECT/13.107.246.70 -

>There is no other information in those logs.

cache.log is different logfile, I have asked for that one.
I hope windows version of squid doesn't send cache log to system event log.

>On 10.05.21 07:52, Aniruddha Gore wrote:
>>Any help I could use?  :) The gist is: I have squid running on machine A,
>> and an app on machine B.  The app sets proxy (A's ip address and squid
>> port #) when making HTTP requests but the requests are failing.
>
>>When I run Squid on the same machine where my application is running it
>> works fine, but when I run Squid with the same exact default config on a
>> different machine it doesn't.  I supply other machine's IP address and
>> port (3128) on command line to my app, and it simply takes it and sets web
>> proxy property on CPPRest SDK's http_config object.
>
>>The access.log file has many lines like the following:
>>1620409014.520  42289 <ip adress> TAG_NONE/500 0 CONNECT <uri>:443 - HIER_DIRECT/13.107.246.70 -
>
>looks like the application correctly asks SQUID for CONNECT but something
>happens after that.
>Is there anything in cache.log for that time?
>
>>When capturing network calls via Wireshark (on this other machine where
>> Squid is running), the CONNECT call succeeds but the following TCP call
>> seems to fail with a RESET status (Wireshark is highlighting it in
>> Yellow).  Here's the frame if I am doing it right:
>
>well, the CONNECT is send, but later squid replies with 500 internal error
>
>https://na01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwiki.squid-cache.org%2FSquidFaq%2FSquidLogs%23Squid_result_codes&amp;data=04%7C01%7C%7Cba2a4006c18e4ff3723108d913d5f7f2%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C637562631981471410%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&amp;sdata=%2BIItkpb8W05X87re%2FzVJkidwwbVILzFlVydt7P4Z%2BiA%3D&amp;reserved=0
>
>the wireshark details don't show any message from squid. Maybe there is
>none.

--
Matus UHLAR - fantomas, uhlar at fantomas.sk ; https://na01.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.fantomas.sk%2F&amp;data=04%7C01%7C%7Cba2a4006c18e4ff3723108d913d5f7f2%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C637562631981471410%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&amp;sdata=JG0lcXKvmSB1efOI%2Fj6393lZmzHMDjDLrFhg0xTkQyo%3D&amp;reserved=0
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Spam is for losers who can't get business any other way.
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
https://na01.safelinks.protection.outlook.com/?url=http%3A%2F%2Flists.squid-cache.org%2Flistinfo%2Fsquid-users&amp;data=04%7C01%7C%7Cba2a4006c18e4ff3723108d913d5f7f2%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C637562631981471410%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&amp;sdata=SuahHW%2F%2FWnWzyk4JdgByQrnaECwTkfcHLKCctlaHyP0%3D&amp;reserved=0
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210510/d76469fc/attachment.htm>

From uhlar at fantomas.sk  Mon May 10 18:12:51 2021
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Mon, 10 May 2021 20:12:51 +0200
Subject: [squid-users] HTTPS request times out going through Squid proxy
In-Reply-To: <MW4PR15MB4524F0BFAF5C8E5B1A2D541DD9549@MW4PR15MB4524.namprd15.prod.outlook.com>
References: <20210506061218.GA12715@fantomas.sk>
 <PH0PR15MB452574B2AFBE4CF86F558DF2D9579@PH0PR15MB4525.namprd15.prod.outlook.com>
 <20210507071637.GC20827@fantomas.sk>
 <MW4PR15MB452451647269BC78DB438BD0D9579@MW4PR15MB4524.namprd15.prod.outlook.com>
 <MW4PR15MB4524D997958D8AF37C23F4B4D9579@MW4PR15MB4524.namprd15.prod.outlook.com>
 <MW4PR15MB45246F662CB41C46DA007679D9549@MW4PR15MB4524.namprd15.prod.outlook.com>
 <20210510083935.GA32242@fantomas.sk>
 <MW4PR15MB4524D114DD759AE1765BDA8ED9549@MW4PR15MB4524.namprd15.prod.outlook.com>
 <20210510170627.GA14812@fantomas.sk>
 <MW4PR15MB4524F0BFAF5C8E5B1A2D541DD9549@MW4PR15MB4524.namprd15.prod.outlook.com>
Message-ID: <20210510181251.GA16199@fantomas.sk>

>>1620413633.857  42280 <source ip address> TAG_NONE/500 0 CONNECT <uri>:443 - HIER_DIRECT/13.107.246.70 -

% date -d @1620413633.857
Fri May  7 20:53:53 CEST 2021

which timezone are you in?

I'd expect an error to be shown at the time of your request.

On 10.05.21 17:43, Aniruddha Gore wrote:
>My bad, here is cache.log lines from that same day:

>2021/05/07 02:50:34 kid1| Set Current Directory to /var/cache/squid
>2021/05/07 02:50:34 kid1| Starting Squid Cache version 3.5.28 for x86_64-unknown-cygwin...
>2021/05/07 02:50:34 kid1| Service Name: squid
>2021/05/07 02:50:34 kid1| Process ID 5300
>2021/05/07 02:50:34 kid1| Process Roles: worker
>2021/05/07 02:50:34 kid1| With 3200 file descriptors available
>2021/05/07 02:50:34 kid1| Initializing IP Cache...
>2021/05/07 02:50:34 kid1| parseEtcHosts: /etc/hosts: (2) No such file or directory
>2021/05/07 02:50:34 kid1| DNS Socket created at [::], FD 5
>2021/05/07 02:50:34 kid1| DNS Socket created at 0.0.0.0, FD 6
>2021/05/07 02:50:34 kid1| Adding nameserver 8.8.8.8 from squid.conf
>2021/05/07 02:50:34 kid1| Adding nameserver 208.67.222.222 from squid.conf
>2021/05/07 02:50:35 kid1| Logfile: opening log daemon:/var/log/squid/access.log
>2021/05/07 02:50:35 kid1| Logfile Daemon: opening log /var/log/squid/access.log
>2021/05/07 02:50:35 kid1| WARNING: no_suid: setuid(0): (22) Invalid argument
>2021/05/07 02:50:35 kid1| Store logging disabled
>2021/05/07 02:50:35 kid1| Swap maxSize 0 + 262144 KB, estimated 20164 objects
>2021/05/07 02:50:35 kid1| Target number of buckets: 1008
>2021/05/07 02:50:35 kid1| Using 8192 Store buckets
>2021/05/07 02:50:35 kid1| Max Mem  size: 262144 KB
>2021/05/07 02:50:35 kid1| Max Swap size: 0 KB
>2021/05/07 02:50:35 kid1| Using Least Load store dir selection
>2021/05/07 02:50:35 kid1| Set Current Directory to /var/cache/squid
>2021/05/07 02:50:35 kid1| Finished loading MIME types and icons.
>2021/05/07 02:50:35 kid1| HTCP Disabled.
>2021/05/07 02:50:35 kid1| Squid plugin modules loaded: 0
>2021/05/07 02:50:35 kid1| Adaptation support is off.
>2021/05/07 02:50:35 kid1| Accepting HTTP Socket connections at local=[::]:3128 remote=[::] FD 10 flags=9
>2021/05/07 02:50:36 kid1| storeLateRelease: released 0 objects
>2021/05/07 10:24:37 kid1| Set Current Directory to /var/cache/squid
>2021/05/07 10:24:37 kid1| Starting Squid Cache version 3.5.28 for x86_64-unknown-cygwin...
>2021/05/07 10:24:37 kid1| Service Name: squid
>2021/05/07 10:24:37 kid1| Process ID 25760
>2021/05/07 10:24:37 kid1| Process Roles: worker
>2021/05/07 10:24:37 kid1| With 3200 file descriptors available
>2021/05/07 10:24:37 kid1| Initializing IP Cache...
>2021/05/07 10:24:37 kid1| parseEtcHosts: /etc/hosts: (2) No such file or directory
>2021/05/07 10:24:37 kid1| DNS Socket created at [::], FD 5
>2021/05/07 10:24:37 kid1| DNS Socket created at 0.0.0.0, FD 6
>2021/05/07 10:24:37 kid1| Adding nameserver 8.8.8.8 from squid.conf
>2021/05/07 10:24:37 kid1| Adding nameserver 208.67.222.222 from squid.conf
>2021/05/07 10:24:38 kid1| Logfile: opening log daemon:/var/log/squid/access.log
>2021/05/07 10:24:38 kid1| Logfile Daemon: opening log /var/log/squid/access.log
>2021/05/07 10:24:38 kid1| WARNING: no_suid: setuid(0): (22) Invalid argument
>2021/05/07 10:24:38 kid1| Store logging disabled
>2021/05/07 10:24:38 kid1| Swap maxSize 0 + 262144 KB, estimated 20164 objects
>2021/05/07 10:24:38 kid1| Target number of buckets: 1008
>2021/05/07 10:24:38 kid1| Using 8192 Store buckets
>2021/05/07 10:24:38 kid1| Max Mem  size: 262144 KB
>2021/05/07 10:24:38 kid1| Max Swap size: 0 KB
>2021/05/07 10:24:38 kid1| Using Least Load store dir selection
>2021/05/07 10:24:38 kid1| Set Current Directory to /var/cache/squid
>2021/05/07 10:24:38 kid1| Finished loading MIME types and icons.
>2021/05/07 10:24:38 kid1| HTCP Disabled.
>2021/05/07 10:24:38 kid1| Squid plugin modules loaded: 0
>2021/05/07 10:24:38 kid1| Adaptation support is off.
>2021/05/07 10:24:38 kid1| Accepting HTTP Socket connections at local=[::]:3128 remote=[::] FD 10 flags=9
>2021/05/07 10:24:39 kid1| storeLateRelease: released 0 objects
>2021/05/07 10:26:22 kid1| Set Current Directory to /var/cache/squid
>2021/05/07 10:26:22 kid1| Starting Squid Cache version 3.5.28 for x86_64-unknown-cygwin...
>2021/05/07 10:26:22 kid1| Service Name: squid
>2021/05/07 10:26:22 kid1| Process ID 16944
>2021/05/07 10:26:22 kid1| Process Roles: worker
>2021/05/07 10:26:22 kid1| With 3200 file descriptors available
>2021/05/07 10:26:22 kid1| Initializing IP Cache...
>2021/05/07 10:26:22 kid1| parseEtcHosts: /etc/hosts: (2) No such file or directory
>2021/05/07 10:26:22 kid1| DNS Socket created at [::], FD 5
>2021/05/07 10:26:22 kid1| DNS Socket created at 0.0.0.0, FD 6
>2021/05/07 10:26:22 kid1| Adding nameserver 8.8.8.8 from squid.conf
>2021/05/07 10:26:22 kid1| Adding nameserver 208.67.222.222 from squid.conf
>2021/05/07 10:26:22 kid1| Logfile: opening log daemon:/var/log/squid/access.log
>2021/05/07 10:26:22 kid1| Logfile Daemon: opening log /var/log/squid/access.log
>2021/05/07 10:26:22 kid1| WARNING: no_suid: setuid(0): (22) Invalid argument
>2021/05/07 10:26:22 kid1| Store logging disabled
>2021/05/07 10:26:22 kid1| Swap maxSize 0 + 262144 KB, estimated 20164 objects
>2021/05/07 10:26:22 kid1| Target number of buckets: 1008
>2021/05/07 10:26:22 kid1| Using 8192 Store buckets
>2021/05/07 10:26:22 kid1| Max Mem  size: 262144 KB
>2021/05/07 10:26:22 kid1| Max Swap size: 0 KB
>2021/05/07 10:26:22 kid1| Using Least Load store dir selection
>2021/05/07 10:26:22 kid1| Set Current Directory to /var/cache/squid
>2021/05/07 10:26:22 kid1| Finished loading MIME types and icons.
>2021/05/07 10:26:22 kid1| HTCP Disabled.
>2021/05/07 10:26:22 kid1| Squid plugin modules loaded: 0
>2021/05/07 10:26:22 kid1| Adaptation support is off.
>2021/05/07 10:26:22 kid1| Accepting HTTP Socket connections at local=[::]:3128 remote=[::] FD 10 flags=9
>2021/05/07 10:26:23 kid1| storeLateRelease: released 0 objects
>2021/05/07 10:31:27 kid1| Set Current Directory to /var/cache/squid
>2021/05/07 10:31:27 kid1| Starting Squid Cache version 3.5.28 for x86_64-unknown-cygwin...
>2021/05/07 10:31:27 kid1| Service Name: squid
>2021/05/07 10:31:27 kid1| Process ID 25116
>2021/05/07 10:31:27 kid1| Process Roles: worker
>2021/05/07 10:31:27 kid1| With 3200 file descriptors available
>2021/05/07 10:31:27 kid1| Initializing IP Cache...
>2021/05/07 10:31:27 kid1| parseEtcHosts: /etc/hosts: (2) No such file or directory
>2021/05/07 10:31:27 kid1| DNS Socket created at [::], FD 5
>2021/05/07 10:31:27 kid1| DNS Socket created at 0.0.0.0, FD 6
>2021/05/07 10:31:27 kid1| Adding nameserver 8.8.8.8 from squid.conf
>2021/05/07 10:31:27 kid1| Adding nameserver 208.67.222.222 from squid.conf
>2021/05/07 10:31:27 kid1| Logfile: opening log daemon:/var/log/squid/access.log
>2021/05/07 10:31:27 kid1| Logfile Daemon: opening log /var/log/squid/access.log
>2021/05/07 10:31:27 kid1| WARNING: no_suid: setuid(0): (22) Invalid argument
>2021/05/07 10:31:27 kid1| Store logging disabled
>2021/05/07 10:31:27 kid1| Swap maxSize 0 + 262144 KB, estimated 20164 objects
>2021/05/07 10:31:27 kid1| Target number of buckets: 1008
>2021/05/07 10:31:27 kid1| Using 8192 Store buckets
>2021/05/07 10:31:27 kid1| Max Mem  size: 262144 KB
>2021/05/07 10:31:27 kid1| Max Swap size: 0 KB
>2021/05/07 10:31:27 kid1| Using Least Load store dir selection
>2021/05/07 10:31:27 kid1| Set Current Directory to /var/cache/squid
>2021/05/07 10:31:27 kid1| Finished loading MIME types and icons.
>2021/05/07 10:31:27 kid1| HTCP Disabled.
>2021/05/07 10:31:27 kid1| Squid plugin modules loaded: 0
>2021/05/07 10:31:27 kid1| Adaptation support is off.
>2021/05/07 10:31:27 kid1| Accepting HTTP Socket connections at local=192.168.1.10:3128 remote=[::] FD 10 flags=9
>2021/05/07 10:31:28 kid1| storeLateRelease: released 0 objects
>2021/05/07 10:35:43 kid1| Set Current Directory to /var/cache/squid
>2021/05/07 10:35:43 kid1| Starting Squid Cache version 3.5.28 for x86_64-unknown-cygwin...
>2021/05/07 10:35:43 kid1| Service Name: squid
>2021/05/07 10:35:43 kid1| Process ID 27908
>2021/05/07 10:35:43 kid1| Process Roles: worker
>2021/05/07 10:35:43 kid1| With 3200 file descriptors available
>2021/05/07 10:35:43 kid1| Initializing IP Cache...
>2021/05/07 10:35:43 kid1| parseEtcHosts: /etc/hosts: (2) No such file or directory
>2021/05/07 10:35:43 kid1| DNS Socket created at [::], FD 5
>2021/05/07 10:35:43 kid1| DNS Socket created at 0.0.0.0, FD 6
>2021/05/07 10:35:43 kid1| Adding nameserver 8.8.8.8 from squid.conf
>2021/05/07 10:35:43 kid1| Adding nameserver 208.67.222.222 from squid.conf
>2021/05/07 10:35:43 kid1| Logfile: opening log daemon:/var/log/squid/access.log
>2021/05/07 10:35:43 kid1| Logfile Daemon: opening log /var/log/squid/access.log
>2021/05/07 10:35:43 kid1| WARNING: no_suid: setuid(0): (22) Invalid argument
>2021/05/07 10:35:43 kid1| Store logging disabled
>2021/05/07 10:35:43 kid1| Swap maxSize 0 + 262144 KB, estimated 20164 objects
>2021/05/07 10:35:43 kid1| Target number of buckets: 1008
>2021/05/07 10:35:43 kid1| Using 8192 Store buckets
>2021/05/07 10:35:43 kid1| Max Mem  size: 262144 KB
>2021/05/07 10:35:43 kid1| Max Swap size: 0 KB
>2021/05/07 10:35:43 kid1| Using Least Load store dir selection
>2021/05/07 10:35:43 kid1| Set Current Directory to /var/cache/squid
>2021/05/07 10:35:43 kid1| Finished loading MIME types and icons.
>2021/05/07 10:35:43 kid1| HTCP Disabled.
>2021/05/07 10:35:43 kid1| Squid plugin modules loaded: 0
>2021/05/07 10:35:43 kid1| Adaptation support is off.
>2021/05/07 10:35:43 kid1| Accepting HTTP Socket connections at local=[::]:3128 remote=[::] FD 10 flags=9
>2021/05/07 10:35:44 kid1| storeLateRelease: released 0 objects


-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Remember half the people you know are below average.


From agnrie at hotmail.com  Mon May 10 18:19:40 2021
From: agnrie at hotmail.com (Aniruddha Gore)
Date: Mon, 10 May 2021 18:19:40 +0000
Subject: [squid-users] HTTPS request times out going through Squid proxy
In-Reply-To: <20210510181251.GA16199@fantomas.sk>
References: <20210506061218.GA12715@fantomas.sk>
 <PH0PR15MB452574B2AFBE4CF86F558DF2D9579@PH0PR15MB4525.namprd15.prod.outlook.com>
 <20210507071637.GC20827@fantomas.sk>
 <MW4PR15MB452451647269BC78DB438BD0D9579@MW4PR15MB4524.namprd15.prod.outlook.com>
 <MW4PR15MB4524D997958D8AF37C23F4B4D9579@MW4PR15MB4524.namprd15.prod.outlook.com>
 <MW4PR15MB45246F662CB41C46DA007679D9549@MW4PR15MB4524.namprd15.prod.outlook.com>
 <20210510083935.GA32242@fantomas.sk>
 <MW4PR15MB4524D114DD759AE1765BDA8ED9549@MW4PR15MB4524.namprd15.prod.outlook.com>
 <20210510170627.GA14812@fantomas.sk>
 <MW4PR15MB4524F0BFAF5C8E5B1A2D541DD9549@MW4PR15MB4524.namprd15.prod.outlook.com>,
 <20210510181251.GA16199@fantomas.sk>
Message-ID: <MW4PR15MB4524CA97C882ABBB0C25BE9AD9549@MW4PR15MB4524.namprd15.prod.outlook.com>

I am in PST. Yeah I dont see any error in that log. Do I need to do something about ssl_bump, etc?

Aniruddha Gore
Sent from Outlook.com<http://www.microsoft.com/en-us/outlook-com/compare/>
________________________________
From: squid-users <squid-users-bounces at lists.squid-cache.org> on behalf of Matus UHLAR - fantomas <uhlar at fantomas.sk>
Sent: Monday, May 10, 2021 11:12 AM
To: squid-users at lists.squid-cache.org <squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] HTTPS request times out going through Squid proxy

>>1620413633.857  42280 <source ip address> TAG_NONE/500 0 CONNECT <uri>:443 - HIER_DIRECT/13.107.246.70 -

% date -d @1620413633.857
Fri May  7 20:53:53 CEST 2021

which timezone are you in?

I'd expect an error to be shown at the time of your request.

On 10.05.21 17:43, Aniruddha Gore wrote:
>My bad, here is cache.log lines from that same day:

>2021/05/07 02:50:34 kid1| Set Current Directory to /var/cache/squid
>2021/05/07 02:50:34 kid1| Starting Squid Cache version 3.5.28 for x86_64-unknown-cygwin...
>2021/05/07 02:50:34 kid1| Service Name: squid
>2021/05/07 02:50:34 kid1| Process ID 5300
>2021/05/07 02:50:34 kid1| Process Roles: worker
>2021/05/07 02:50:34 kid1| With 3200 file descriptors available
>2021/05/07 02:50:34 kid1| Initializing IP Cache...
>2021/05/07 02:50:34 kid1| parseEtcHosts: /etc/hosts: (2) No such file or directory
>2021/05/07 02:50:34 kid1| DNS Socket created at [::], FD 5
>2021/05/07 02:50:34 kid1| DNS Socket created at 0.0.0.0, FD 6
>2021/05/07 02:50:34 kid1| Adding nameserver 8.8.8.8 from squid.conf
>2021/05/07 02:50:34 kid1| Adding nameserver 208.67.222.222 from squid.conf
>2021/05/07 02:50:35 kid1| Logfile: opening log daemon:/var/log/squid/access.log
>2021/05/07 02:50:35 kid1| Logfile Daemon: opening log /var/log/squid/access.log
>2021/05/07 02:50:35 kid1| WARNING: no_suid: setuid(0): (22) Invalid argument
>2021/05/07 02:50:35 kid1| Store logging disabled
>2021/05/07 02:50:35 kid1| Swap maxSize 0 + 262144 KB, estimated 20164 objects
>2021/05/07 02:50:35 kid1| Target number of buckets: 1008
>2021/05/07 02:50:35 kid1| Using 8192 Store buckets
>2021/05/07 02:50:35 kid1| Max Mem  size: 262144 KB
>2021/05/07 02:50:35 kid1| Max Swap size: 0 KB
>2021/05/07 02:50:35 kid1| Using Least Load store dir selection
>2021/05/07 02:50:35 kid1| Set Current Directory to /var/cache/squid
>2021/05/07 02:50:35 kid1| Finished loading MIME types and icons.
>2021/05/07 02:50:35 kid1| HTCP Disabled.
>2021/05/07 02:50:35 kid1| Squid plugin modules loaded: 0
>2021/05/07 02:50:35 kid1| Adaptation support is off.
>2021/05/07 02:50:35 kid1| Accepting HTTP Socket connections at local=[::]:3128 remote=[::] FD 10 flags=9
>2021/05/07 02:50:36 kid1| storeLateRelease: released 0 objects
>2021/05/07 10:24:37 kid1| Set Current Directory to /var/cache/squid
>2021/05/07 10:24:37 kid1| Starting Squid Cache version 3.5.28 for x86_64-unknown-cygwin...
>2021/05/07 10:24:37 kid1| Service Name: squid
>2021/05/07 10:24:37 kid1| Process ID 25760
>2021/05/07 10:24:37 kid1| Process Roles: worker
>2021/05/07 10:24:37 kid1| With 3200 file descriptors available
>2021/05/07 10:24:37 kid1| Initializing IP Cache...
>2021/05/07 10:24:37 kid1| parseEtcHosts: /etc/hosts: (2) No such file or directory
>2021/05/07 10:24:37 kid1| DNS Socket created at [::], FD 5
>2021/05/07 10:24:37 kid1| DNS Socket created at 0.0.0.0, FD 6
>2021/05/07 10:24:37 kid1| Adding nameserver 8.8.8.8 from squid.conf
>2021/05/07 10:24:37 kid1| Adding nameserver 208.67.222.222 from squid.conf
>2021/05/07 10:24:38 kid1| Logfile: opening log daemon:/var/log/squid/access.log
>2021/05/07 10:24:38 kid1| Logfile Daemon: opening log /var/log/squid/access.log
>2021/05/07 10:24:38 kid1| WARNING: no_suid: setuid(0): (22) Invalid argument
>2021/05/07 10:24:38 kid1| Store logging disabled
>2021/05/07 10:24:38 kid1| Swap maxSize 0 + 262144 KB, estimated 20164 objects
>2021/05/07 10:24:38 kid1| Target number of buckets: 1008
>2021/05/07 10:24:38 kid1| Using 8192 Store buckets
>2021/05/07 10:24:38 kid1| Max Mem  size: 262144 KB
>2021/05/07 10:24:38 kid1| Max Swap size: 0 KB
>2021/05/07 10:24:38 kid1| Using Least Load store dir selection
>2021/05/07 10:24:38 kid1| Set Current Directory to /var/cache/squid
>2021/05/07 10:24:38 kid1| Finished loading MIME types and icons.
>2021/05/07 10:24:38 kid1| HTCP Disabled.
>2021/05/07 10:24:38 kid1| Squid plugin modules loaded: 0
>2021/05/07 10:24:38 kid1| Adaptation support is off.
>2021/05/07 10:24:38 kid1| Accepting HTTP Socket connections at local=[::]:3128 remote=[::] FD 10 flags=9
>2021/05/07 10:24:39 kid1| storeLateRelease: released 0 objects
>2021/05/07 10:26:22 kid1| Set Current Directory to /var/cache/squid
>2021/05/07 10:26:22 kid1| Starting Squid Cache version 3.5.28 for x86_64-unknown-cygwin...
>2021/05/07 10:26:22 kid1| Service Name: squid
>2021/05/07 10:26:22 kid1| Process ID 16944
>2021/05/07 10:26:22 kid1| Process Roles: worker
>2021/05/07 10:26:22 kid1| With 3200 file descriptors available
>2021/05/07 10:26:22 kid1| Initializing IP Cache...
>2021/05/07 10:26:22 kid1| parseEtcHosts: /etc/hosts: (2) No such file or directory
>2021/05/07 10:26:22 kid1| DNS Socket created at [::], FD 5
>2021/05/07 10:26:22 kid1| DNS Socket created at 0.0.0.0, FD 6
>2021/05/07 10:26:22 kid1| Adding nameserver 8.8.8.8 from squid.conf
>2021/05/07 10:26:22 kid1| Adding nameserver 208.67.222.222 from squid.conf
>2021/05/07 10:26:22 kid1| Logfile: opening log daemon:/var/log/squid/access.log
>2021/05/07 10:26:22 kid1| Logfile Daemon: opening log /var/log/squid/access.log
>2021/05/07 10:26:22 kid1| WARNING: no_suid: setuid(0): (22) Invalid argument
>2021/05/07 10:26:22 kid1| Store logging disabled
>2021/05/07 10:26:22 kid1| Swap maxSize 0 + 262144 KB, estimated 20164 objects
>2021/05/07 10:26:22 kid1| Target number of buckets: 1008
>2021/05/07 10:26:22 kid1| Using 8192 Store buckets
>2021/05/07 10:26:22 kid1| Max Mem  size: 262144 KB
>2021/05/07 10:26:22 kid1| Max Swap size: 0 KB
>2021/05/07 10:26:22 kid1| Using Least Load store dir selection
>2021/05/07 10:26:22 kid1| Set Current Directory to /var/cache/squid
>2021/05/07 10:26:22 kid1| Finished loading MIME types and icons.
>2021/05/07 10:26:22 kid1| HTCP Disabled.
>2021/05/07 10:26:22 kid1| Squid plugin modules loaded: 0
>2021/05/07 10:26:22 kid1| Adaptation support is off.
>2021/05/07 10:26:22 kid1| Accepting HTTP Socket connections at local=[::]:3128 remote=[::] FD 10 flags=9
>2021/05/07 10:26:23 kid1| storeLateRelease: released 0 objects
>2021/05/07 10:31:27 kid1| Set Current Directory to /var/cache/squid
>2021/05/07 10:31:27 kid1| Starting Squid Cache version 3.5.28 for x86_64-unknown-cygwin...
>2021/05/07 10:31:27 kid1| Service Name: squid
>2021/05/07 10:31:27 kid1| Process ID 25116
>2021/05/07 10:31:27 kid1| Process Roles: worker
>2021/05/07 10:31:27 kid1| With 3200 file descriptors available
>2021/05/07 10:31:27 kid1| Initializing IP Cache...
>2021/05/07 10:31:27 kid1| parseEtcHosts: /etc/hosts: (2) No such file or directory
>2021/05/07 10:31:27 kid1| DNS Socket created at [::], FD 5
>2021/05/07 10:31:27 kid1| DNS Socket created at 0.0.0.0, FD 6
>2021/05/07 10:31:27 kid1| Adding nameserver 8.8.8.8 from squid.conf
>2021/05/07 10:31:27 kid1| Adding nameserver 208.67.222.222 from squid.conf
>2021/05/07 10:31:27 kid1| Logfile: opening log daemon:/var/log/squid/access.log
>2021/05/07 10:31:27 kid1| Logfile Daemon: opening log /var/log/squid/access.log
>2021/05/07 10:31:27 kid1| WARNING: no_suid: setuid(0): (22) Invalid argument
>2021/05/07 10:31:27 kid1| Store logging disabled
>2021/05/07 10:31:27 kid1| Swap maxSize 0 + 262144 KB, estimated 20164 objects
>2021/05/07 10:31:27 kid1| Target number of buckets: 1008
>2021/05/07 10:31:27 kid1| Using 8192 Store buckets
>2021/05/07 10:31:27 kid1| Max Mem  size: 262144 KB
>2021/05/07 10:31:27 kid1| Max Swap size: 0 KB
>2021/05/07 10:31:27 kid1| Using Least Load store dir selection
>2021/05/07 10:31:27 kid1| Set Current Directory to /var/cache/squid
>2021/05/07 10:31:27 kid1| Finished loading MIME types and icons.
>2021/05/07 10:31:27 kid1| HTCP Disabled.
>2021/05/07 10:31:27 kid1| Squid plugin modules loaded: 0
>2021/05/07 10:31:27 kid1| Adaptation support is off.
>2021/05/07 10:31:27 kid1| Accepting HTTP Socket connections at local=192.168.1.10:3128 remote=[::] FD 10 flags=9
>2021/05/07 10:31:28 kid1| storeLateRelease: released 0 objects
>2021/05/07 10:35:43 kid1| Set Current Directory to /var/cache/squid
>2021/05/07 10:35:43 kid1| Starting Squid Cache version 3.5.28 for x86_64-unknown-cygwin...
>2021/05/07 10:35:43 kid1| Service Name: squid
>2021/05/07 10:35:43 kid1| Process ID 27908
>2021/05/07 10:35:43 kid1| Process Roles: worker
>2021/05/07 10:35:43 kid1| With 3200 file descriptors available
>2021/05/07 10:35:43 kid1| Initializing IP Cache...
>2021/05/07 10:35:43 kid1| parseEtcHosts: /etc/hosts: (2) No such file or directory
>2021/05/07 10:35:43 kid1| DNS Socket created at [::], FD 5
>2021/05/07 10:35:43 kid1| DNS Socket created at 0.0.0.0, FD 6
>2021/05/07 10:35:43 kid1| Adding nameserver 8.8.8.8 from squid.conf
>2021/05/07 10:35:43 kid1| Adding nameserver 208.67.222.222 from squid.conf
>2021/05/07 10:35:43 kid1| Logfile: opening log daemon:/var/log/squid/access.log
>2021/05/07 10:35:43 kid1| Logfile Daemon: opening log /var/log/squid/access.log
>2021/05/07 10:35:43 kid1| WARNING: no_suid: setuid(0): (22) Invalid argument
>2021/05/07 10:35:43 kid1| Store logging disabled
>2021/05/07 10:35:43 kid1| Swap maxSize 0 + 262144 KB, estimated 20164 objects
>2021/05/07 10:35:43 kid1| Target number of buckets: 1008
>2021/05/07 10:35:43 kid1| Using 8192 Store buckets
>2021/05/07 10:35:43 kid1| Max Mem  size: 262144 KB
>2021/05/07 10:35:43 kid1| Max Swap size: 0 KB
>2021/05/07 10:35:43 kid1| Using Least Load store dir selection
>2021/05/07 10:35:43 kid1| Set Current Directory to /var/cache/squid
>2021/05/07 10:35:43 kid1| Finished loading MIME types and icons.
>2021/05/07 10:35:43 kid1| HTCP Disabled.
>2021/05/07 10:35:43 kid1| Squid plugin modules loaded: 0
>2021/05/07 10:35:43 kid1| Adaptation support is off.
>2021/05/07 10:35:43 kid1| Accepting HTTP Socket connections at local=[::]:3128 remote=[::] FD 10 flags=9
>2021/05/07 10:35:44 kid1| storeLateRelease: released 0 objects


--
Matus UHLAR - fantomas, uhlar at fantomas.sk ; https://na01.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.fantomas.sk%2F&amp;data=04%7C01%7C%7C155efb167c734f54697c08d913df3f4b%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C637562671824826597%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&amp;sdata=32Vn1WCqE6w2YJbrqwDzxRq55Z2xdH%2B%2BeAPMqwPEaa8%3D&amp;reserved=0
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Remember half the people you know are below average.
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
https://na01.safelinks.protection.outlook.com/?url=http%3A%2F%2Flists.squid-cache.org%2Flistinfo%2Fsquid-users&amp;data=04%7C01%7C%7C155efb167c734f54697c08d913df3f4b%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C637562671824836550%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&amp;sdata=pwZe%2FG%2BS8WXN60%2BCpZ1l1QSS6lKTA63xIaAlHOnFW%2Fo%3D&amp;reserved=0
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210510/a64e683f/attachment.htm>

From dan at mirageid.com  Tue May 11 22:06:10 2021
From: dan at mirageid.com (Dan Steen)
Date: Tue, 11 May 2021 18:06:10 -0400
Subject: [squid-users] https_port not correctly sending ssl cert information?
Message-ID: <5942a26b-2328-4479-a807-1f3954e400b1@www.fastmail.com>

Hi!,

I've recently been trying to update my version of squid from 4.0.20 to something more modern (4.13), but I'm having issues with my TLS enabled proxy not returning certificates correctly (it seems).   Specifically, when I try and run the following curl (url replaced to protect the innocent):
 
curl -vvI  --proxy https://test.example.com:5000 <https://vvnncqvnjkclsuu3ctvdp5k4ck72-uupfpbnf.mirageid.com:5000/> https://google.com

I get the following result:

*   Trying 167.99.53.100:5000...
* Connected to test.example.com port 5000
* ALPN, offering http/1.1
* successfully set certificate verify locations:
*  CAfile: /etc/ssl/certs/ca-certificates.crt
*  CApath: none
* TLSv1.3 (OUT), TLS handshake, Client hello (1):
* TLSv1.3 (IN), TLS handshake, Server hello (2):
* TLSv1.3 (IN), TLS handshake, Encrypted Extensions (8):
* TLSv1.3 (IN), TLS handshake, Certificate (11):
* TLSv1.3 (OUT), TLS alert, unknown CA (560):
* SSL certificate problem: unable to get local issuer certificate
* Closing connection 0
curl: (60) SSL certificate problem: unable to get local issuer certificate

This is different then what I get for my old 4.0.20 server:

* Connected to test.example.com port 3128 (#0)
* successfully set certificate verify locations:
*  CAfile: /etc/ssl/certs/ca-certificates.crt
*  CApath: none
* TLSv1.3 (OUT), TLS handshake, Client hello (1):
* TLSv1.3 (IN), TLS handshake, Server hello (2):
* TLSv1.2 (IN), TLS handshake, Certificate (11):
* TLSv1.2 (IN), TLS handshake, Server key exchange (12):
* TLSv1.2 (IN), TLS handshake, Server finished (14):
* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):
* TLSv1.2 (OUT), TLS change cipher, Change cipher spec (1):
* TLSv1.2 (OUT), TLS handshake, Finished (20):
* TLSv1.2 (IN), TLS handshake, Finished (20):
* SSL connection using TLSv1.2 / ECDHE-RSA-AES256-GCM-SHA384
* Proxy certificate:
*  subject: CN=*.example.com
*  start date: Apr  5 21:02:06 2021 GMT
*  expire date: May  7 21:02:06 2022 GMT
*  issuer: C=BE; O=GlobalSign nv-sa; CN=AlphaSSL CA - SHA256 - G2
*  SSL certificate verify ok.

But the config and certs are exactly the same!  I've pasted the config, output of squid -v, and cert information here:  https://gist.github.com/dansteen/c28343fd025c713bcfba8368ce2b728b

One difference between the two that I noticed is that the old version is compiled with --with-openssl and --enable-ssl and -enable-ssl-crtd, and the new version only has --with-gnutls.  Would that be the issue?  I appreciate the help!

Thanks!
Dan Steen

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210511/c0b83906/attachment.htm>

From squid3 at treenet.co.nz  Wed May 12 01:16:54 2021
From: squid3 at treenet.co.nz (=?UTF-8?B?4oCqQW1vcyBKZWZmcmllc+KArA==?=)
Date: Wed, 12 May 2021 13:16:54 +1200
Subject: [squid-users] https_port not correctly sending ssl cert
 information?
References: <5942a26b-2328-4479-a807-1f3954e400b1@www.fastmail.com>
Message-ID: <-1fums4-nmpyy2rqqhw9-hxq1bg56fgaibnubyem5td3sxlq18k4lv781rsyuhvzhc531yk7eqt7fv68s-qvqlul2mxsaq-gevsrxu7xhdf7rfwk-qv7kxg7whfysm9us3a493ivulnv9vx-6ekibs.1620782214676@email.android.com>

An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210512/f5ae724c/attachment.htm>

From dan at mirageid.com  Wed May 12 01:23:49 2021
From: dan at mirageid.com (Dan Steen)
Date: Tue, 11 May 2021 21:23:49 -0400
Subject: [squid-users] 
 =?utf-8?q?https=5Fport_not_correctly_sending_ssl_c?=
 =?utf-8?q?ert_information=3F?=
In-Reply-To: <-1fums4-nmpyy2rqqhw9-hxq1bg56fgaibnubyem5td3sxlq18k4lv781rsyuhvzhc531yk7eqt7fv68s-qvqlul2mxsaq-gevsrxu7xhdf7rfwk-qv7kxg7whfysm9us3a493ivulnv9vx-6ekibs.1620782214676@email.android.com>
References: <5942a26b-2328-4479-a807-1f3954e400b1@www.fastmail.com>
 <-1fums4-nmpyy2rqqhw9-hxq1bg56fgaibnubyem5td3sxlq18k4lv781rsyuhvzhc531yk7eqt7fv68s-qvqlul2mxsaq-gevsrxu7xhdf7rfwk-qv7kxg7whfysm9us3a493ivulnv9vx-6ekibs.1620782214676@email.android.com>
Message-ID: <aaf9ba3f-221f-4a99-9e97-b9e2cfaa1b91@www.fastmail.com>

Hi Amos!

Thanks for the response!  I put my full config in that gist (https://gist.github.com/dansteen/c28343fd025c713bcfba8368ce2b728b) if that helps.  Is there something else that would be helpuful to see?  

Thanks!

On Tue, May 11, 2021, at 9:16 PM, ?Amos Jeffries? wrote:
> The main issue you are having is that the old version had no TLS/1.3 support. The newer squid have some, but not enough for what you are doing.
> 
> Switching the build from GnuTLS to OpenSSL may work a little better. But without details of your config it is hard to be certain.
> 
> Amos
> 
> 
> -------- Original message --------
> From: Dan Steen <dan at mirageid.com>
> Date: Wed, 12 May 2021, 10:06
> To: squid-users at lists.squid-cache.org
> Subject: [squid-users] https_port not correctly sending ssl cert information?
>> Hi!,
>> 
>> I've recently been trying to update my version of squid from 4.0.20 to something more modern (4.13), but I'm having issues with my TLS enabled proxy not returning certificates correctly (it seems).   Specifically, when I try and run the following curl (url replaced to protect the innocent):
>>  
>> curl -vvI  --proxy https://test.example.com:5000 <https://vvnncqvnjkclsuu3ctvdp5k4ck72-uupfpbnf.mirageid.com:5000/> https://google.com
>> 
>> 
>> I get the following result:
>> 
>> *   Trying 167.99.53.100:5000...
>> * Connected to test.example.com port 5000
>> * ALPN, offering http/1.1
>> * successfully set certificate verify locations:
>> *  CAfile: /etc/ssl/certs/ca-certificates.crt
>> *  CApath: none
>> * TLSv1.3 (OUT), TLS handshake, Client hello (1):
>> * TLSv1.3 (IN), TLS handshake, Server hello (2):
>> * TLSv1.3 (IN), TLS handshake, Encrypted Extensions (8):
>> * TLSv1.3 (IN), TLS handshake, Certificate (11):
>> * TLSv1.3 (OUT), TLS alert, unknown CA (560):
>> * SSL certificate problem: unable to get local issuer certificate
>> * Closing connection 0
>> curl: (60) SSL certificate problem: unable to get local issuer certificate
>> 
>> This is different then what I get for my old 4.0.20 server:
>> 
>> * Connected to test.example.com port 3128 (#0)
>> * successfully set certificate verify locations:
>> *  CAfile: /etc/ssl/certs/ca-certificates.crt
>> *  CApath: none
>> * TLSv1.3 (OUT), TLS handshake, Client hello (1):
>> * TLSv1.3 (IN), TLS handshake, Server hello (2):
>> * TLSv1.2 (IN), TLS handshake, Certificate (11):
>> * TLSv1.2 (IN), TLS handshake, Server key exchange (12):
>> * TLSv1.2 (IN), TLS handshake, Server finished (14):
>> * TLSv1.2 (OUT), TLS handshake, Client key exchange (16):
>> * TLSv1.2 (OUT), TLS change cipher, Change cipher spec (1):
>> * TLSv1.2 (OUT), TLS handshake, Finished (20):
>> * TLSv1.2 (IN), TLS handshake, Finished (20):
>> * SSL connection using TLSv1.2 / ECDHE-RSA-AES256-GCM-SHA384
>> * Proxy certificate:
>> *  subject: CN=*.example.com
>> *  start date: Apr  5 21:02:06 2021 GMT
>> *  expire date: May  7 21:02:06 2022 GMT
>> *  issuer: C=BE; O=GlobalSign nv-sa; CN=AlphaSSL CA - SHA256 - G2
>> *  SSL certificate verify ok.
>> 
>> 
>> But the config and certs are exactly the same!  I've pasted the config, output of squid -v, and cert information here:  https://gist.github.com/dansteen/c28343fd025c713bcfba8368ce2b728b
>> 
>> One difference between the two that I noticed is that the old version is compiled with --with-openssl and --enable-ssl and -enable-ssl-crtd, and the new version only has --with-gnutls.  Would that be the issue?  I appreciate the help!
>> 
>> Thanks!
>> Dan Steen
>> 
>> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org <mailto:squid-users%40lists.squid-cache.org>
> http://lists.squid-cache.org/listinfo/squid-users
> 

Dan Steen
Founder, CTO
*MirageID*
_dan at MirageID.com <mailto:esther at MirageID.com>_
443-204-9478
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210511/ca1398bf/attachment.htm>

From squid3 at treenet.co.nz  Wed May 12 02:03:51 2021
From: squid3 at treenet.co.nz (squid3 at treenet.co.nz)
Date: Wed, 12 May 2021 14:03:51 +1200
Subject: [squid-users] https_port not correctly sending ssl cert
 information?
In-Reply-To: <aaf9ba3f-221f-4a99-9e97-b9e2cfaa1b91@www.fastmail.com>
References: <5942a26b-2328-4479-a807-1f3954e400b1@www.fastmail.com>
 <-1fums4-nmpyy2rqqhw9-hxq1bg56fgaibnubyem5td3sxlq18k4lv781rsyuhvzhc531yk7eqt7fv68s-qvqlul2mxsaq-gevsrxu7xhdf7rfwk-qv7kxg7whfysm9us3a493ivulnv9vx-6ekibs.1620782214676@email.android.com>
 <aaf9ba3f-221f-4a99-9e97-b9e2cfaa1b91@www.fastmail.com>
Message-ID: <6a0addd0e4e6a6443fd3f276989f816f@treenet.co.nz>

Oh, I see. With that simple config the issue has to be lack of cert 
chain support in GnuTLS. Simply rebuilding using --with-openssl should 
resolve it.

Amos


From dan at mirageid.com  Wed May 12 02:08:23 2021
From: dan at mirageid.com (Dan Steen)
Date: Tue, 11 May 2021 22:08:23 -0400
Subject: [squid-users] 
 =?utf-8?q?https=5Fport_not_correctly_sending_ssl_c?=
 =?utf-8?q?ert_information=3F?=
In-Reply-To: <6a0addd0e4e6a6443fd3f276989f816f@treenet.co.nz>
References: <5942a26b-2328-4479-a807-1f3954e400b1@www.fastmail.com>
 <-1fums4-nmpyy2rqqhw9-hxq1bg56fgaibnubyem5td3sxlq18k4lv781rsyuhvzhc531yk7eqt7fv68s-qvqlul2mxsaq-gevsrxu7xhdf7rfwk-qv7kxg7whfysm9us3a493ivulnv9vx-6ekibs.1620782214676@email.android.com>
 <aaf9ba3f-221f-4a99-9e97-b9e2cfaa1b91@www.fastmail.com>
 <6a0addd0e4e6a6443fd3f276989f816f@treenet.co.nz>
Message-ID: <53507ef9-85f0-4cbd-8889-ca3e3241d23e@www.fastmail.com>

great!  i'll give it a try and report back.  thanks so much!

On Tue, May 11, 2021, at 10:03 PM, squid3 at treenet.co.nz <mailto:squid3%40treenet.co.nz> wrote:
> Oh, I see. With that simple config the issue has to be lack of cert 
> chain support in GnuTLS. Simply rebuilding using --with-openssl should 
> resolve it.
> 
> Amos
> 

Dan Steen

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210511/25112193/attachment.htm>

From squid3 at treenet.co.nz  Wed May 12 12:46:48 2021
From: squid3 at treenet.co.nz (squid3 at treenet.co.nz)
Date: Thu, 13 May 2021 00:46:48 +1200
Subject: [squid-users] SSL BUMP
In-Reply-To: <217701640.3617459.1620642419464@mail.yahoo.com>
References: <217701640.3617459.1620642419464.ref@mail.yahoo.com>
 <217701640.3617459.1620642419464@mail.yahoo.com>
Message-ID: <60f6159611d811b152e8dccbd5663940@treenet.co.nz>

On 2021-05-10 22:26, Stephane Simon wrote:
> Hello,
> 
> I try to configure https  with ssl bump.
> I use redhat 8.
> 
> i follow https://blog.microlinux.fr/squid-https-centos-7/
> when i restart squid, he doesn't cooperate and say:
> 
> "FATAL: The usr/lib64/squid/security_file_certgen -s
> /var/lib/squid/ssl_db -M 64MB helpers are crashing too rapidly, need
> help!"
> 
> i don't know how to fix this error..i dont know why i've this error ^^
> 
> Does someone have an idea please ?

The helper crashing is required by Squid to generate certificates for 
bumping.
Without it working perfectly Squid cannot handle any HTTPS traffic.


> 
> http_port 3130
> http_port 3128 intercept
> https_port 3129 intercept ssl-bump \
>   cert=/etc/squid/ssl_cert/certificat.pem \
>   generate-host-certificates=on \
>   dynamic_cert_mem_cache_size=64MB
> 
> #SSL certificate generation
> sslcrtd_program usr/lib64/squid/security_file_certgen -s

The path should begin with '/usr/' not just 'usr/

> /var/lib/squid/ssl_db -M 64MB

Check that this /var path actually exists. That the low-privilege 
account the proxy uses has both read and write access to it.

Run the helper command to initialize the database before starting Squid. 
Do so using the low-privilege account Squid uses to ensure the database 
files have correct ownership.



> sslcrtd_children 32 startup=5 idle=1
> 
> # SSL-Bump
> acl step1 at_step SslBump1
> ssl_bump peek step1
> ssl_bump bump all
> 

Please be aware that this configuration is trying to forge server 
certificates without having any details about the real server 
certificate. When you are past the helper problem it is likely that this 
basic configuration will cause a number of TLS problems.

For bumping as much as possible this is a better config:

  acl step1 at_step SslBump1
  ssl_bump peek step1
  ssl_bump stare all
  ssl_bump bump all


Amos


From agnrie at hotmail.com  Wed May 12 23:22:43 2021
From: agnrie at hotmail.com (Aniruddha Gore)
Date: Wed, 12 May 2021 23:22:43 +0000
Subject: [squid-users] HTTPS request times out going through Squid proxy
In-Reply-To: <MW4PR15MB4524CA97C882ABBB0C25BE9AD9549@MW4PR15MB4524.namprd15.prod.outlook.com>
References: <20210506061218.GA12715@fantomas.sk>
 <PH0PR15MB452574B2AFBE4CF86F558DF2D9579@PH0PR15MB4525.namprd15.prod.outlook.com>
 <20210507071637.GC20827@fantomas.sk>
 <MW4PR15MB452451647269BC78DB438BD0D9579@MW4PR15MB4524.namprd15.prod.outlook.com>
 <MW4PR15MB4524D997958D8AF37C23F4B4D9579@MW4PR15MB4524.namprd15.prod.outlook.com>
 <MW4PR15MB45246F662CB41C46DA007679D9549@MW4PR15MB4524.namprd15.prod.outlook.com>
 <20210510083935.GA32242@fantomas.sk>
 <MW4PR15MB4524D114DD759AE1765BDA8ED9549@MW4PR15MB4524.namprd15.prod.outlook.com>
 <20210510170627.GA14812@fantomas.sk>
 <MW4PR15MB4524F0BFAF5C8E5B1A2D541DD9549@MW4PR15MB4524.namprd15.prod.outlook.com>,
 <20210510181251.GA16199@fantomas.sk>,
 <MW4PR15MB4524CA97C882ABBB0C25BE9AD9549@MW4PR15MB4524.namprd15.prod.outlook.com>
Message-ID: <MW4PR15MB4524333835402100D069320DD9529@MW4PR15MB4524.namprd15.prod.outlook.com>

Pinging the thread again since I think mine is a straightforward set-up. Just wondering if I need to setup the config a certain way to start supporting HTTPS calls. They work if squid is running on the same machine, but I start seeing problems if squid is running on another machine and I use webproxy on HTTP requests.

Aniruddha Gore
Sent from Outlook.com<http://www.microsoft.com/en-us/outlook-com/compare/>

________________________________
From: squid-users <squid-users-bounces at lists.squid-cache.org> on behalf of Aniruddha Gore <agnrie at hotmail.com>
Sent: Monday, May 10, 2021 11:19 AM
To: squid-users at lists.squid-cache.org <squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] HTTPS request times out going through Squid proxy

I am in PST. Yeah I dont see any error in that log. Do I need to do something about ssl_bump, etc?

Aniruddha Gore
Sent from Outlook.com<https://na01.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.microsoft.com%2Fen-us%2Foutlook-com%2Fcompare%2F&data=04%7C01%7C%7Ce371054e7fe14a3ebea808d913e0324e%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C637562676027187008%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&sdata=PEJuCDdjbJmUAobTFcz%2FnF%2FBSkGoS3vfCeXd8ajtQZI%3D&reserved=0>
________________________________
From: squid-users <squid-users-bounces at lists.squid-cache.org> on behalf of Matus UHLAR - fantomas <uhlar at fantomas.sk>
Sent: Monday, May 10, 2021 11:12 AM
To: squid-users at lists.squid-cache.org <squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] HTTPS request times out going through Squid proxy

>>1620413633.857  42280 <source ip address> TAG_NONE/500 0 CONNECT <uri>:443 - HIER_DIRECT/13.107.246.70 -

% date -d @1620413633.857
Fri May  7 20:53:53 CEST 2021

which timezone are you in?

I'd expect an error to be shown at the time of your request.

On 10.05.21 17:43, Aniruddha Gore wrote:
>My bad, here is cache.log lines from that same day:

>2021/05/07 02:50:34 kid1| Set Current Directory to /var/cache/squid
>2021/05/07 02:50:34 kid1| Starting Squid Cache version 3.5.28 for x86_64-unknown-cygwin...
>2021/05/07 02:50:34 kid1| Service Name: squid
>2021/05/07 02:50:34 kid1| Process ID 5300
>2021/05/07 02:50:34 kid1| Process Roles: worker
>2021/05/07 02:50:34 kid1| With 3200 file descriptors available
>2021/05/07 02:50:34 kid1| Initializing IP Cache...
>2021/05/07 02:50:34 kid1| parseEtcHosts: /etc/hosts: (2) No such file or directory
>2021/05/07 02:50:34 kid1| DNS Socket created at [::], FD 5
>2021/05/07 02:50:34 kid1| DNS Socket created at 0.0.0.0, FD 6
>2021/05/07 02:50:34 kid1| Adding nameserver 8.8.8.8 from squid.conf
>2021/05/07 02:50:34 kid1| Adding nameserver 208.67.222.222 from squid.conf
>2021/05/07 02:50:35 kid1| Logfile: opening log daemon:/var/log/squid/access.log
>2021/05/07 02:50:35 kid1| Logfile Daemon: opening log /var/log/squid/access.log
>2021/05/07 02:50:35 kid1| WARNING: no_suid: setuid(0): (22) Invalid argument
>2021/05/07 02:50:35 kid1| Store logging disabled
>2021/05/07 02:50:35 kid1| Swap maxSize 0 + 262144 KB, estimated 20164 objects
>2021/05/07 02:50:35 kid1| Target number of buckets: 1008
>2021/05/07 02:50:35 kid1| Using 8192 Store buckets
>2021/05/07 02:50:35 kid1| Max Mem  size: 262144 KB
>2021/05/07 02:50:35 kid1| Max Swap size: 0 KB
>2021/05/07 02:50:35 kid1| Using Least Load store dir selection
>2021/05/07 02:50:35 kid1| Set Current Directory to /var/cache/squid
>2021/05/07 02:50:35 kid1| Finished loading MIME types and icons.
>2021/05/07 02:50:35 kid1| HTCP Disabled.
>2021/05/07 02:50:35 kid1| Squid plugin modules loaded: 0
>2021/05/07 02:50:35 kid1| Adaptation support is off.
>2021/05/07 02:50:35 kid1| Accepting HTTP Socket connections at local=[::]:3128 remote=[::] FD 10 flags=9
>2021/05/07 02:50:36 kid1| storeLateRelease: released 0 objects
>2021/05/07 10:24:37 kid1| Set Current Directory to /var/cache/squid
>2021/05/07 10:24:37 kid1| Starting Squid Cache version 3.5.28 for x86_64-unknown-cygwin...
>2021/05/07 10:24:37 kid1| Service Name: squid
>2021/05/07 10:24:37 kid1| Process ID 25760
>2021/05/07 10:24:37 kid1| Process Roles: worker
>2021/05/07 10:24:37 kid1| With 3200 file descriptors available
>2021/05/07 10:24:37 kid1| Initializing IP Cache...
>2021/05/07 10:24:37 kid1| parseEtcHosts: /etc/hosts: (2) No such file or directory
>2021/05/07 10:24:37 kid1| DNS Socket created at [::], FD 5
>2021/05/07 10:24:37 kid1| DNS Socket created at 0.0.0.0, FD 6
>2021/05/07 10:24:37 kid1| Adding nameserver 8.8.8.8 from squid.conf
>2021/05/07 10:24:37 kid1| Adding nameserver 208.67.222.222 from squid.conf
>2021/05/07 10:24:38 kid1| Logfile: opening log daemon:/var/log/squid/access.log
>2021/05/07 10:24:38 kid1| Logfile Daemon: opening log /var/log/squid/access.log
>2021/05/07 10:24:38 kid1| WARNING: no_suid: setuid(0): (22) Invalid argument
>2021/05/07 10:24:38 kid1| Store logging disabled
>2021/05/07 10:24:38 kid1| Swap maxSize 0 + 262144 KB, estimated 20164 objects
>2021/05/07 10:24:38 kid1| Target number of buckets: 1008
>2021/05/07 10:24:38 kid1| Using 8192 Store buckets
>2021/05/07 10:24:38 kid1| Max Mem  size: 262144 KB
>2021/05/07 10:24:38 kid1| Max Swap size: 0 KB
>2021/05/07 10:24:38 kid1| Using Least Load store dir selection
>2021/05/07 10:24:38 kid1| Set Current Directory to /var/cache/squid
>2021/05/07 10:24:38 kid1| Finished loading MIME types and icons.
>2021/05/07 10:24:38 kid1| HTCP Disabled.
>2021/05/07 10:24:38 kid1| Squid plugin modules loaded: 0
>2021/05/07 10:24:38 kid1| Adaptation support is off.
>2021/05/07 10:24:38 kid1| Accepting HTTP Socket connections at local=[::]:3128 remote=[::] FD 10 flags=9
>2021/05/07 10:24:39 kid1| storeLateRelease: released 0 objects
>2021/05/07 10:26:22 kid1| Set Current Directory to /var/cache/squid
>2021/05/07 10:26:22 kid1| Starting Squid Cache version 3.5.28 for x86_64-unknown-cygwin...
>2021/05/07 10:26:22 kid1| Service Name: squid
>2021/05/07 10:26:22 kid1| Process ID 16944
>2021/05/07 10:26:22 kid1| Process Roles: worker
>2021/05/07 10:26:22 kid1| With 3200 file descriptors available
>2021/05/07 10:26:22 kid1| Initializing IP Cache...
>2021/05/07 10:26:22 kid1| parseEtcHosts: /etc/hosts: (2) No such file or directory
>2021/05/07 10:26:22 kid1| DNS Socket created at [::], FD 5
>2021/05/07 10:26:22 kid1| DNS Socket created at 0.0.0.0, FD 6
>2021/05/07 10:26:22 kid1| Adding nameserver 8.8.8.8 from squid.conf
>2021/05/07 10:26:22 kid1| Adding nameserver 208.67.222.222 from squid.conf
>2021/05/07 10:26:22 kid1| Logfile: opening log daemon:/var/log/squid/access.log
>2021/05/07 10:26:22 kid1| Logfile Daemon: opening log /var/log/squid/access.log
>2021/05/07 10:26:22 kid1| WARNING: no_suid: setuid(0): (22) Invalid argument
>2021/05/07 10:26:22 kid1| Store logging disabled
>2021/05/07 10:26:22 kid1| Swap maxSize 0 + 262144 KB, estimated 20164 objects
>2021/05/07 10:26:22 kid1| Target number of buckets: 1008
>2021/05/07 10:26:22 kid1| Using 8192 Store buckets
>2021/05/07 10:26:22 kid1| Max Mem  size: 262144 KB
>2021/05/07 10:26:22 kid1| Max Swap size: 0 KB
>2021/05/07 10:26:22 kid1| Using Least Load store dir selection
>2021/05/07 10:26:22 kid1| Set Current Directory to /var/cache/squid
>2021/05/07 10:26:22 kid1| Finished loading MIME types and icons.
>2021/05/07 10:26:22 kid1| HTCP Disabled.
>2021/05/07 10:26:22 kid1| Squid plugin modules loaded: 0
>2021/05/07 10:26:22 kid1| Adaptation support is off.
>2021/05/07 10:26:22 kid1| Accepting HTTP Socket connections at local=[::]:3128 remote=[::] FD 10 flags=9
>2021/05/07 10:26:23 kid1| storeLateRelease: released 0 objects
>2021/05/07 10:31:27 kid1| Set Current Directory to /var/cache/squid
>2021/05/07 10:31:27 kid1| Starting Squid Cache version 3.5.28 for x86_64-unknown-cygwin...
>2021/05/07 10:31:27 kid1| Service Name: squid
>2021/05/07 10:31:27 kid1| Process ID 25116
>2021/05/07 10:31:27 kid1| Process Roles: worker
>2021/05/07 10:31:27 kid1| With 3200 file descriptors available
>2021/05/07 10:31:27 kid1| Initializing IP Cache...
>2021/05/07 10:31:27 kid1| parseEtcHosts: /etc/hosts: (2) No such file or directory
>2021/05/07 10:31:27 kid1| DNS Socket created at [::], FD 5
>2021/05/07 10:31:27 kid1| DNS Socket created at 0.0.0.0, FD 6
>2021/05/07 10:31:27 kid1| Adding nameserver 8.8.8.8 from squid.conf
>2021/05/07 10:31:27 kid1| Adding nameserver 208.67.222.222 from squid.conf
>2021/05/07 10:31:27 kid1| Logfile: opening log daemon:/var/log/squid/access.log
>2021/05/07 10:31:27 kid1| Logfile Daemon: opening log /var/log/squid/access.log
>2021/05/07 10:31:27 kid1| WARNING: no_suid: setuid(0): (22) Invalid argument
>2021/05/07 10:31:27 kid1| Store logging disabled
>2021/05/07 10:31:27 kid1| Swap maxSize 0 + 262144 KB, estimated 20164 objects
>2021/05/07 10:31:27 kid1| Target number of buckets: 1008
>2021/05/07 10:31:27 kid1| Using 8192 Store buckets
>2021/05/07 10:31:27 kid1| Max Mem  size: 262144 KB
>2021/05/07 10:31:27 kid1| Max Swap size: 0 KB
>2021/05/07 10:31:27 kid1| Using Least Load store dir selection
>2021/05/07 10:31:27 kid1| Set Current Directory to /var/cache/squid
>2021/05/07 10:31:27 kid1| Finished loading MIME types and icons.
>2021/05/07 10:31:27 kid1| HTCP Disabled.
>2021/05/07 10:31:27 kid1| Squid plugin modules loaded: 0
>2021/05/07 10:31:27 kid1| Adaptation support is off.
>2021/05/07 10:31:27 kid1| Accepting HTTP Socket connections at local=192.168.1.10:3128 remote=[::] FD 10 flags=9
>2021/05/07 10:31:28 kid1| storeLateRelease: released 0 objects
>2021/05/07 10:35:43 kid1| Set Current Directory to /var/cache/squid
>2021/05/07 10:35:43 kid1| Starting Squid Cache version 3.5.28 for x86_64-unknown-cygwin...
>2021/05/07 10:35:43 kid1| Service Name: squid
>2021/05/07 10:35:43 kid1| Process ID 27908
>2021/05/07 10:35:43 kid1| Process Roles: worker
>2021/05/07 10:35:43 kid1| With 3200 file descriptors available
>2021/05/07 10:35:43 kid1| Initializing IP Cache...
>2021/05/07 10:35:43 kid1| parseEtcHosts: /etc/hosts: (2) No such file or directory
>2021/05/07 10:35:43 kid1| DNS Socket created at [::], FD 5
>2021/05/07 10:35:43 kid1| DNS Socket created at 0.0.0.0, FD 6
>2021/05/07 10:35:43 kid1| Adding nameserver 8.8.8.8 from squid.conf
>2021/05/07 10:35:43 kid1| Adding nameserver 208.67.222.222 from squid.conf
>2021/05/07 10:35:43 kid1| Logfile: opening log daemon:/var/log/squid/access.log
>2021/05/07 10:35:43 kid1| Logfile Daemon: opening log /var/log/squid/access.log
>2021/05/07 10:35:43 kid1| WARNING: no_suid: setuid(0): (22) Invalid argument
>2021/05/07 10:35:43 kid1| Store logging disabled
>2021/05/07 10:35:43 kid1| Swap maxSize 0 + 262144 KB, estimated 20164 objects
>2021/05/07 10:35:43 kid1| Target number of buckets: 1008
>2021/05/07 10:35:43 kid1| Using 8192 Store buckets
>2021/05/07 10:35:43 kid1| Max Mem  size: 262144 KB
>2021/05/07 10:35:43 kid1| Max Swap size: 0 KB
>2021/05/07 10:35:43 kid1| Using Least Load store dir selection
>2021/05/07 10:35:43 kid1| Set Current Directory to /var/cache/squid
>2021/05/07 10:35:43 kid1| Finished loading MIME types and icons.
>2021/05/07 10:35:43 kid1| HTCP Disabled.
>2021/05/07 10:35:43 kid1| Squid plugin modules loaded: 0
>2021/05/07 10:35:43 kid1| Adaptation support is off.
>2021/05/07 10:35:43 kid1| Accepting HTTP Socket connections at local=[::]:3128 remote=[::] FD 10 flags=9
>2021/05/07 10:35:44 kid1| storeLateRelease: released 0 objects


--
Matus UHLAR - fantomas, uhlar at fantomas.sk ; https://na01.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.fantomas.sk%2F&amp;data=04%7C01%7C%7C155efb167c734f54697c08d913df3f4b%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C637562671824826597%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&amp;sdata=32Vn1WCqE6w2YJbrqwDzxRq55Z2xdH%2B%2BeAPMqwPEaa8%3D&amp;reserved=0<https://na01.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.fantomas.sk%2F&data=04%7C01%7C%7Ce371054e7fe14a3ebea808d913e0324e%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C637562676027196964%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&sdata=ZD4Q3L2mLd4FIqxRairW2jSbiqzZqs3vib3BEnBp68w%3D&reserved=0>
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Remember half the people you know are below average.
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
https://na01.safelinks.protection.outlook.com/?url=http%3A%2F%2Flists.squid-cache.org%2Flistinfo%2Fsquid-users&amp;data=04%7C01%7C%7C155efb167c734f54697c08d913df3f4b%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C637562671824836550%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&amp;sdata=pwZe%2FG%2BS8WXN60%2BCpZ1l1QSS6lKTA63xIaAlHOnFW%2Fo%3D&amp;reserved=0<https://na01.safelinks.protection.outlook.com/?url=http%3A%2F%2Flists.squid-cache.org%2Flistinfo%2Fsquid-users&data=04%7C01%7C%7Ce371054e7fe14a3ebea808d913e0324e%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C637562676027196964%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&sdata=6EqBlKY%2BM0w0ecPxfx6oi3eUMPRHUiA5YNmUJsCfyP8%3D&reserved=0>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210512/d22418a8/attachment.htm>

From uhlar at fantomas.sk  Thu May 13 08:01:41 2021
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Thu, 13 May 2021 10:01:41 +0200
Subject: [squid-users] HTTPS request times out going through Squid proxy
In-Reply-To: <MW4PR15MB4524CA97C882ABBB0C25BE9AD9549@MW4PR15MB4524.namprd15.prod.outlook.com>
References: <20210507071637.GC20827@fantomas.sk>
 <MW4PR15MB452451647269BC78DB438BD0D9579@MW4PR15MB4524.namprd15.prod.outlook.com>
 <MW4PR15MB4524D997958D8AF37C23F4B4D9579@MW4PR15MB4524.namprd15.prod.outlook.com>
 <MW4PR15MB45246F662CB41C46DA007679D9549@MW4PR15MB4524.namprd15.prod.outlook.com>
 <20210510083935.GA32242@fantomas.sk>
 <MW4PR15MB4524D114DD759AE1765BDA8ED9549@MW4PR15MB4524.namprd15.prod.outlook.com>
 <20210510170627.GA14812@fantomas.sk>
 <MW4PR15MB4524F0BFAF5C8E5B1A2D541DD9549@MW4PR15MB4524.namprd15.prod.outlook.com>
 <20210510181251.GA16199@fantomas.sk>
 <MW4PR15MB4524CA97C882ABBB0C25BE9AD9549@MW4PR15MB4524.namprd15.prod.outlook.com>
Message-ID: <20210513080141.GB21969@fantomas.sk>

On 10.05.21 18:19, Aniruddha Gore wrote:
>I am in PST. Yeah I dont see any error in that log. Do I need to do something about ssl_bump, etc?

ssl_bump is only in effect if you decide to use it.
If you did, try turning it off and retry.


>From: squid-users <squid-users-bounces at lists.squid-cache.org> on behalf of Matus UHLAR - fantomas <uhlar at fantomas.sk>
>Sent: Monday, May 10, 2021 11:12 AM
>To: squid-users at lists.squid-cache.org <squid-users at lists.squid-cache.org>
>Subject: Re: [squid-users] HTTPS request times out going through Squid proxy
>
>>>1620413633.857  42280 <source ip address> TAG_NONE/500 0 CONNECT <uri>:443 - HIER_DIRECT/13.107.246.70 -
>
>% date -d @1620413633.857
>Fri May  7 20:53:53 CEST 2021

% env TZ=PST8PDT date -d @1620413633.857
Fri May  7 11:53:53 PDT 2021

still nothing.


>which timezone are you in?
>
>I'd expect an error to be shown at the time of your request.
>
>On 10.05.21 17:43, Aniruddha Gore wrote:
>>My bad, here is cache.log lines from that same day:
>
>>2021/05/07 02:50:34 kid1| Set Current Directory to /var/cache/squid
>>2021/05/07 02:50:34 kid1| Starting Squid Cache version 3.5.28 for x86_64-unknown-cygwin...
>>2021/05/07 02:50:34 kid1| Service Name: squid
>>2021/05/07 02:50:34 kid1| Process ID 5300
>>2021/05/07 02:50:34 kid1| Process Roles: worker
>>2021/05/07 02:50:34 kid1| With 3200 file descriptors available
>>2021/05/07 02:50:34 kid1| Initializing IP Cache...
>>2021/05/07 02:50:34 kid1| parseEtcHosts: /etc/hosts: (2) No such file or directory
>>2021/05/07 02:50:34 kid1| DNS Socket created at [::], FD 5
>>2021/05/07 02:50:34 kid1| DNS Socket created at 0.0.0.0, FD 6
>>2021/05/07 02:50:34 kid1| Adding nameserver 8.8.8.8 from squid.conf
>>2021/05/07 02:50:34 kid1| Adding nameserver 208.67.222.222 from squid.conf
>>2021/05/07 02:50:35 kid1| Logfile: opening log daemon:/var/log/squid/access.log
>>2021/05/07 02:50:35 kid1| Logfile Daemon: opening log /var/log/squid/access.log
>>2021/05/07 02:50:35 kid1| WARNING: no_suid: setuid(0): (22) Invalid argument
>>2021/05/07 02:50:35 kid1| Store logging disabled
>>2021/05/07 02:50:35 kid1| Swap maxSize 0 + 262144 KB, estimated 20164 objects
>>2021/05/07 02:50:35 kid1| Target number of buckets: 1008
>>2021/05/07 02:50:35 kid1| Using 8192 Store buckets
>>2021/05/07 02:50:35 kid1| Max Mem  size: 262144 KB
>>2021/05/07 02:50:35 kid1| Max Swap size: 0 KB
>>2021/05/07 02:50:35 kid1| Using Least Load store dir selection
>>2021/05/07 02:50:35 kid1| Set Current Directory to /var/cache/squid
>>2021/05/07 02:50:35 kid1| Finished loading MIME types and icons.
>>2021/05/07 02:50:35 kid1| HTCP Disabled.
>>2021/05/07 02:50:35 kid1| Squid plugin modules loaded: 0
>>2021/05/07 02:50:35 kid1| Adaptation support is off.
>>2021/05/07 02:50:35 kid1| Accepting HTTP Socket connections at local=[::]:3128 remote=[::] FD 10 flags=9
>>2021/05/07 02:50:36 kid1| storeLateRelease: released 0 objects
>>2021/05/07 10:24:37 kid1| Set Current Directory to /var/cache/squid
>>2021/05/07 10:24:37 kid1| Starting Squid Cache version 3.5.28 for x86_64-unknown-cygwin...
>>2021/05/07 10:24:37 kid1| Service Name: squid
>>2021/05/07 10:24:37 kid1| Process ID 25760
>>2021/05/07 10:24:37 kid1| Process Roles: worker
>>2021/05/07 10:24:37 kid1| With 3200 file descriptors available
>>2021/05/07 10:24:37 kid1| Initializing IP Cache...
>>2021/05/07 10:24:37 kid1| parseEtcHosts: /etc/hosts: (2) No such file or directory
>>2021/05/07 10:24:37 kid1| DNS Socket created at [::], FD 5
>>2021/05/07 10:24:37 kid1| DNS Socket created at 0.0.0.0, FD 6
>>2021/05/07 10:24:37 kid1| Adding nameserver 8.8.8.8 from squid.conf
>>2021/05/07 10:24:37 kid1| Adding nameserver 208.67.222.222 from squid.conf
>>2021/05/07 10:24:38 kid1| Logfile: opening log daemon:/var/log/squid/access.log
>>2021/05/07 10:24:38 kid1| Logfile Daemon: opening log /var/log/squid/access.log
>>2021/05/07 10:24:38 kid1| WARNING: no_suid: setuid(0): (22) Invalid argument
>>2021/05/07 10:24:38 kid1| Store logging disabled
>>2021/05/07 10:24:38 kid1| Swap maxSize 0 + 262144 KB, estimated 20164 objects
>>2021/05/07 10:24:38 kid1| Target number of buckets: 1008
>>2021/05/07 10:24:38 kid1| Using 8192 Store buckets
>>2021/05/07 10:24:38 kid1| Max Mem  size: 262144 KB
>>2021/05/07 10:24:38 kid1| Max Swap size: 0 KB
>>2021/05/07 10:24:38 kid1| Using Least Load store dir selection
>>2021/05/07 10:24:38 kid1| Set Current Directory to /var/cache/squid
>>2021/05/07 10:24:38 kid1| Finished loading MIME types and icons.
>>2021/05/07 10:24:38 kid1| HTCP Disabled.
>>2021/05/07 10:24:38 kid1| Squid plugin modules loaded: 0
>>2021/05/07 10:24:38 kid1| Adaptation support is off.
>>2021/05/07 10:24:38 kid1| Accepting HTTP Socket connections at local=[::]:3128 remote=[::] FD 10 flags=9
>>2021/05/07 10:24:39 kid1| storeLateRelease: released 0 objects
>>2021/05/07 10:26:22 kid1| Set Current Directory to /var/cache/squid
>>2021/05/07 10:26:22 kid1| Starting Squid Cache version 3.5.28 for x86_64-unknown-cygwin...
>>2021/05/07 10:26:22 kid1| Service Name: squid
>>2021/05/07 10:26:22 kid1| Process ID 16944
>>2021/05/07 10:26:22 kid1| Process Roles: worker
>>2021/05/07 10:26:22 kid1| With 3200 file descriptors available
>>2021/05/07 10:26:22 kid1| Initializing IP Cache...
>>2021/05/07 10:26:22 kid1| parseEtcHosts: /etc/hosts: (2) No such file or directory
>>2021/05/07 10:26:22 kid1| DNS Socket created at [::], FD 5
>>2021/05/07 10:26:22 kid1| DNS Socket created at 0.0.0.0, FD 6
>>2021/05/07 10:26:22 kid1| Adding nameserver 8.8.8.8 from squid.conf
>>2021/05/07 10:26:22 kid1| Adding nameserver 208.67.222.222 from squid.conf
>>2021/05/07 10:26:22 kid1| Logfile: opening log daemon:/var/log/squid/access.log
>>2021/05/07 10:26:22 kid1| Logfile Daemon: opening log /var/log/squid/access.log
>>2021/05/07 10:26:22 kid1| WARNING: no_suid: setuid(0): (22) Invalid argument
>>2021/05/07 10:26:22 kid1| Store logging disabled
>>2021/05/07 10:26:22 kid1| Swap maxSize 0 + 262144 KB, estimated 20164 objects
>>2021/05/07 10:26:22 kid1| Target number of buckets: 1008
>>2021/05/07 10:26:22 kid1| Using 8192 Store buckets
>>2021/05/07 10:26:22 kid1| Max Mem  size: 262144 KB
>>2021/05/07 10:26:22 kid1| Max Swap size: 0 KB
>>2021/05/07 10:26:22 kid1| Using Least Load store dir selection
>>2021/05/07 10:26:22 kid1| Set Current Directory to /var/cache/squid
>>2021/05/07 10:26:22 kid1| Finished loading MIME types and icons.
>>2021/05/07 10:26:22 kid1| HTCP Disabled.
>>2021/05/07 10:26:22 kid1| Squid plugin modules loaded: 0
>>2021/05/07 10:26:22 kid1| Adaptation support is off.
>>2021/05/07 10:26:22 kid1| Accepting HTTP Socket connections at local=[::]:3128 remote=[::] FD 10 flags=9
>>2021/05/07 10:26:23 kid1| storeLateRelease: released 0 objects
>>2021/05/07 10:31:27 kid1| Set Current Directory to /var/cache/squid
>>2021/05/07 10:31:27 kid1| Starting Squid Cache version 3.5.28 for x86_64-unknown-cygwin...
>>2021/05/07 10:31:27 kid1| Service Name: squid
>>2021/05/07 10:31:27 kid1| Process ID 25116
>>2021/05/07 10:31:27 kid1| Process Roles: worker
>>2021/05/07 10:31:27 kid1| With 3200 file descriptors available
>>2021/05/07 10:31:27 kid1| Initializing IP Cache...
>>2021/05/07 10:31:27 kid1| parseEtcHosts: /etc/hosts: (2) No such file or directory
>>2021/05/07 10:31:27 kid1| DNS Socket created at [::], FD 5
>>2021/05/07 10:31:27 kid1| DNS Socket created at 0.0.0.0, FD 6
>>2021/05/07 10:31:27 kid1| Adding nameserver 8.8.8.8 from squid.conf
>>2021/05/07 10:31:27 kid1| Adding nameserver 208.67.222.222 from squid.conf
>>2021/05/07 10:31:27 kid1| Logfile: opening log daemon:/var/log/squid/access.log
>>2021/05/07 10:31:27 kid1| Logfile Daemon: opening log /var/log/squid/access.log
>>2021/05/07 10:31:27 kid1| WARNING: no_suid: setuid(0): (22) Invalid argument
>>2021/05/07 10:31:27 kid1| Store logging disabled
>>2021/05/07 10:31:27 kid1| Swap maxSize 0 + 262144 KB, estimated 20164 objects
>>2021/05/07 10:31:27 kid1| Target number of buckets: 1008
>>2021/05/07 10:31:27 kid1| Using 8192 Store buckets
>>2021/05/07 10:31:27 kid1| Max Mem  size: 262144 KB
>>2021/05/07 10:31:27 kid1| Max Swap size: 0 KB
>>2021/05/07 10:31:27 kid1| Using Least Load store dir selection
>>2021/05/07 10:31:27 kid1| Set Current Directory to /var/cache/squid
>>2021/05/07 10:31:27 kid1| Finished loading MIME types and icons.
>>2021/05/07 10:31:27 kid1| HTCP Disabled.
>>2021/05/07 10:31:27 kid1| Squid plugin modules loaded: 0
>>2021/05/07 10:31:27 kid1| Adaptation support is off.
>>2021/05/07 10:31:27 kid1| Accepting HTTP Socket connections at local=192.168.1.10:3128 remote=[::] FD 10 flags=9
>>2021/05/07 10:31:28 kid1| storeLateRelease: released 0 objects
>>2021/05/07 10:35:43 kid1| Set Current Directory to /var/cache/squid
>>2021/05/07 10:35:43 kid1| Starting Squid Cache version 3.5.28 for x86_64-unknown-cygwin...
>>2021/05/07 10:35:43 kid1| Service Name: squid
>>2021/05/07 10:35:43 kid1| Process ID 27908
>>2021/05/07 10:35:43 kid1| Process Roles: worker
>>2021/05/07 10:35:43 kid1| With 3200 file descriptors available
>>2021/05/07 10:35:43 kid1| Initializing IP Cache...
>>2021/05/07 10:35:43 kid1| parseEtcHosts: /etc/hosts: (2) No such file or directory
>>2021/05/07 10:35:43 kid1| DNS Socket created at [::], FD 5
>>2021/05/07 10:35:43 kid1| DNS Socket created at 0.0.0.0, FD 6
>>2021/05/07 10:35:43 kid1| Adding nameserver 8.8.8.8 from squid.conf
>>2021/05/07 10:35:43 kid1| Adding nameserver 208.67.222.222 from squid.conf
>>2021/05/07 10:35:43 kid1| Logfile: opening log daemon:/var/log/squid/access.log
>>2021/05/07 10:35:43 kid1| Logfile Daemon: opening log /var/log/squid/access.log
>>2021/05/07 10:35:43 kid1| WARNING: no_suid: setuid(0): (22) Invalid argument
>>2021/05/07 10:35:43 kid1| Store logging disabled
>>2021/05/07 10:35:43 kid1| Swap maxSize 0 + 262144 KB, estimated 20164 objects
>>2021/05/07 10:35:43 kid1| Target number of buckets: 1008
>>2021/05/07 10:35:43 kid1| Using 8192 Store buckets
>>2021/05/07 10:35:43 kid1| Max Mem  size: 262144 KB
>>2021/05/07 10:35:43 kid1| Max Swap size: 0 KB
>>2021/05/07 10:35:43 kid1| Using Least Load store dir selection
>>2021/05/07 10:35:43 kid1| Set Current Directory to /var/cache/squid
>>2021/05/07 10:35:43 kid1| Finished loading MIME types and icons.
>>2021/05/07 10:35:43 kid1| HTCP Disabled.
>>2021/05/07 10:35:43 kid1| Squid plugin modules loaded: 0
>>2021/05/07 10:35:43 kid1| Adaptation support is off.
>>2021/05/07 10:35:43 kid1| Accepting HTTP Socket connections at local=[::]:3128 remote=[::] FD 10 flags=9
>>2021/05/07 10:35:44 kid1| storeLateRelease: released 0 objects


-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
WinError #99999: Out of error messages.


From agnrie at hotmail.com  Thu May 13 08:04:25 2021
From: agnrie at hotmail.com (Aniruddha Gore)
Date: Thu, 13 May 2021 08:04:25 +0000
Subject: [squid-users] HTTPS request times out going through Squid proxy
In-Reply-To: <20210513080141.GB21969@fantomas.sk>
References: <20210507071637.GC20827@fantomas.sk>
 <MW4PR15MB452451647269BC78DB438BD0D9579@MW4PR15MB4524.namprd15.prod.outlook.com>
 <MW4PR15MB4524D997958D8AF37C23F4B4D9579@MW4PR15MB4524.namprd15.prod.outlook.com>
 <MW4PR15MB45246F662CB41C46DA007679D9549@MW4PR15MB4524.namprd15.prod.outlook.com>
 <20210510083935.GA32242@fantomas.sk>
 <MW4PR15MB4524D114DD759AE1765BDA8ED9549@MW4PR15MB4524.namprd15.prod.outlook.com>
 <20210510170627.GA14812@fantomas.sk>
 <MW4PR15MB4524F0BFAF5C8E5B1A2D541DD9549@MW4PR15MB4524.namprd15.prod.outlook.com>
 <20210510181251.GA16199@fantomas.sk>
 <MW4PR15MB4524CA97C882ABBB0C25BE9AD9549@MW4PR15MB4524.namprd15.prod.outlook.com>,
 <20210513080141.GB21969@fantomas.sk>
Message-ID: <MW4PR15MB452456CB515C0361CC26FC4ED9519@MW4PR15MB4524.namprd15.prod.outlook.com>

Thanks Matus. I have not tried ssl_bumo yet. If you were me, where would you see next?

Aniruddha Gore
Sent from Outlook.com<http://www.microsoft.com/en-us/outlook-com/compare/>

________________________________
From: squid-users <squid-users-bounces at lists.squid-cache.org> on behalf of Matus UHLAR - fantomas <uhlar at fantomas.sk>
Sent: Thursday, May 13, 2021 1:01 AM
To: squid-users at lists.squid-cache.org <squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] HTTPS request times out going through Squid proxy

On 10.05.21 18:19, Aniruddha Gore wrote:
>I am in PST. Yeah I dont see any error in that log. Do I need to do something about ssl_bump, etc?

ssl_bump is only in effect if you decide to use it.
If you did, try turning it off and retry.


>From: squid-users <squid-users-bounces at lists.squid-cache.org> on behalf of Matus UHLAR - fantomas <uhlar at fantomas.sk>
>Sent: Monday, May 10, 2021 11:12 AM
>To: squid-users at lists.squid-cache.org <squid-users at lists.squid-cache.org>
>Subject: Re: [squid-users] HTTPS request times out going through Squid proxy
>
>>>1620413633.857  42280 <source ip address> TAG_NONE/500 0 CONNECT <uri>:443 - HIER_DIRECT/13.107.246.70 -
>
>% date -d @1620413633.857
>Fri May  7 20:53:53 CEST 2021

% env TZ=PST8PDT date -d @1620413633.857
Fri May  7 11:53:53 PDT 2021

still nothing.


>which timezone are you in?
>
>I'd expect an error to be shown at the time of your request.
>
>On 10.05.21 17:43, Aniruddha Gore wrote:
>>My bad, here is cache.log lines from that same day:
>
>>2021/05/07 02:50:34 kid1| Set Current Directory to /var/cache/squid
>>2021/05/07 02:50:34 kid1| Starting Squid Cache version 3.5.28 for x86_64-unknown-cygwin...
>>2021/05/07 02:50:34 kid1| Service Name: squid
>>2021/05/07 02:50:34 kid1| Process ID 5300
>>2021/05/07 02:50:34 kid1| Process Roles: worker
>>2021/05/07 02:50:34 kid1| With 3200 file descriptors available
>>2021/05/07 02:50:34 kid1| Initializing IP Cache...
>>2021/05/07 02:50:34 kid1| parseEtcHosts: /etc/hosts: (2) No such file or directory
>>2021/05/07 02:50:34 kid1| DNS Socket created at [::], FD 5
>>2021/05/07 02:50:34 kid1| DNS Socket created at 0.0.0.0, FD 6
>>2021/05/07 02:50:34 kid1| Adding nameserver 8.8.8.8 from squid.conf
>>2021/05/07 02:50:34 kid1| Adding nameserver 208.67.222.222 from squid.conf
>>2021/05/07 02:50:35 kid1| Logfile: opening log daemon:/var/log/squid/access.log
>>2021/05/07 02:50:35 kid1| Logfile Daemon: opening log /var/log/squid/access.log
>>2021/05/07 02:50:35 kid1| WARNING: no_suid: setuid(0): (22) Invalid argument
>>2021/05/07 02:50:35 kid1| Store logging disabled
>>2021/05/07 02:50:35 kid1| Swap maxSize 0 + 262144 KB, estimated 20164 objects
>>2021/05/07 02:50:35 kid1| Target number of buckets: 1008
>>2021/05/07 02:50:35 kid1| Using 8192 Store buckets
>>2021/05/07 02:50:35 kid1| Max Mem  size: 262144 KB
>>2021/05/07 02:50:35 kid1| Max Swap size: 0 KB
>>2021/05/07 02:50:35 kid1| Using Least Load store dir selection
>>2021/05/07 02:50:35 kid1| Set Current Directory to /var/cache/squid
>>2021/05/07 02:50:35 kid1| Finished loading MIME types and icons.
>>2021/05/07 02:50:35 kid1| HTCP Disabled.
>>2021/05/07 02:50:35 kid1| Squid plugin modules loaded: 0
>>2021/05/07 02:50:35 kid1| Adaptation support is off.
>>2021/05/07 02:50:35 kid1| Accepting HTTP Socket connections at local=[::]:3128 remote=[::] FD 10 flags=9
>>2021/05/07 02:50:36 kid1| storeLateRelease: released 0 objects
>>2021/05/07 10:24:37 kid1| Set Current Directory to /var/cache/squid
>>2021/05/07 10:24:37 kid1| Starting Squid Cache version 3.5.28 for x86_64-unknown-cygwin...
>>2021/05/07 10:24:37 kid1| Service Name: squid
>>2021/05/07 10:24:37 kid1| Process ID 25760
>>2021/05/07 10:24:37 kid1| Process Roles: worker
>>2021/05/07 10:24:37 kid1| With 3200 file descriptors available
>>2021/05/07 10:24:37 kid1| Initializing IP Cache...
>>2021/05/07 10:24:37 kid1| parseEtcHosts: /etc/hosts: (2) No such file or directory
>>2021/05/07 10:24:37 kid1| DNS Socket created at [::], FD 5
>>2021/05/07 10:24:37 kid1| DNS Socket created at 0.0.0.0, FD 6
>>2021/05/07 10:24:37 kid1| Adding nameserver 8.8.8.8 from squid.conf
>>2021/05/07 10:24:37 kid1| Adding nameserver 208.67.222.222 from squid.conf
>>2021/05/07 10:24:38 kid1| Logfile: opening log daemon:/var/log/squid/access.log
>>2021/05/07 10:24:38 kid1| Logfile Daemon: opening log /var/log/squid/access.log
>>2021/05/07 10:24:38 kid1| WARNING: no_suid: setuid(0): (22) Invalid argument
>>2021/05/07 10:24:38 kid1| Store logging disabled
>>2021/05/07 10:24:38 kid1| Swap maxSize 0 + 262144 KB, estimated 20164 objects
>>2021/05/07 10:24:38 kid1| Target number of buckets: 1008
>>2021/05/07 10:24:38 kid1| Using 8192 Store buckets
>>2021/05/07 10:24:38 kid1| Max Mem  size: 262144 KB
>>2021/05/07 10:24:38 kid1| Max Swap size: 0 KB
>>2021/05/07 10:24:38 kid1| Using Least Load store dir selection
>>2021/05/07 10:24:38 kid1| Set Current Directory to /var/cache/squid
>>2021/05/07 10:24:38 kid1| Finished loading MIME types and icons.
>>2021/05/07 10:24:38 kid1| HTCP Disabled.
>>2021/05/07 10:24:38 kid1| Squid plugin modules loaded: 0
>>2021/05/07 10:24:38 kid1| Adaptation support is off.
>>2021/05/07 10:24:38 kid1| Accepting HTTP Socket connections at local=[::]:3128 remote=[::] FD 10 flags=9
>>2021/05/07 10:24:39 kid1| storeLateRelease: released 0 objects
>>2021/05/07 10:26:22 kid1| Set Current Directory to /var/cache/squid
>>2021/05/07 10:26:22 kid1| Starting Squid Cache version 3.5.28 for x86_64-unknown-cygwin...
>>2021/05/07 10:26:22 kid1| Service Name: squid
>>2021/05/07 10:26:22 kid1| Process ID 16944
>>2021/05/07 10:26:22 kid1| Process Roles: worker
>>2021/05/07 10:26:22 kid1| With 3200 file descriptors available
>>2021/05/07 10:26:22 kid1| Initializing IP Cache...
>>2021/05/07 10:26:22 kid1| parseEtcHosts: /etc/hosts: (2) No such file or directory
>>2021/05/07 10:26:22 kid1| DNS Socket created at [::], FD 5
>>2021/05/07 10:26:22 kid1| DNS Socket created at 0.0.0.0, FD 6
>>2021/05/07 10:26:22 kid1| Adding nameserver 8.8.8.8 from squid.conf
>>2021/05/07 10:26:22 kid1| Adding nameserver 208.67.222.222 from squid.conf
>>2021/05/07 10:26:22 kid1| Logfile: opening log daemon:/var/log/squid/access.log
>>2021/05/07 10:26:22 kid1| Logfile Daemon: opening log /var/log/squid/access.log
>>2021/05/07 10:26:22 kid1| WARNING: no_suid: setuid(0): (22) Invalid argument
>>2021/05/07 10:26:22 kid1| Store logging disabled
>>2021/05/07 10:26:22 kid1| Swap maxSize 0 + 262144 KB, estimated 20164 objects
>>2021/05/07 10:26:22 kid1| Target number of buckets: 1008
>>2021/05/07 10:26:22 kid1| Using 8192 Store buckets
>>2021/05/07 10:26:22 kid1| Max Mem  size: 262144 KB
>>2021/05/07 10:26:22 kid1| Max Swap size: 0 KB
>>2021/05/07 10:26:22 kid1| Using Least Load store dir selection
>>2021/05/07 10:26:22 kid1| Set Current Directory to /var/cache/squid
>>2021/05/07 10:26:22 kid1| Finished loading MIME types and icons.
>>2021/05/07 10:26:22 kid1| HTCP Disabled.
>>2021/05/07 10:26:22 kid1| Squid plugin modules loaded: 0
>>2021/05/07 10:26:22 kid1| Adaptation support is off.
>>2021/05/07 10:26:22 kid1| Accepting HTTP Socket connections at local=[::]:3128 remote=[::] FD 10 flags=9
>>2021/05/07 10:26:23 kid1| storeLateRelease: released 0 objects
>>2021/05/07 10:31:27 kid1| Set Current Directory to /var/cache/squid
>>2021/05/07 10:31:27 kid1| Starting Squid Cache version 3.5.28 for x86_64-unknown-cygwin...
>>2021/05/07 10:31:27 kid1| Service Name: squid
>>2021/05/07 10:31:27 kid1| Process ID 25116
>>2021/05/07 10:31:27 kid1| Process Roles: worker
>>2021/05/07 10:31:27 kid1| With 3200 file descriptors available
>>2021/05/07 10:31:27 kid1| Initializing IP Cache...
>>2021/05/07 10:31:27 kid1| parseEtcHosts: /etc/hosts: (2) No such file or directory
>>2021/05/07 10:31:27 kid1| DNS Socket created at [::], FD 5
>>2021/05/07 10:31:27 kid1| DNS Socket created at 0.0.0.0, FD 6
>>2021/05/07 10:31:27 kid1| Adding nameserver 8.8.8.8 from squid.conf
>>2021/05/07 10:31:27 kid1| Adding nameserver 208.67.222.222 from squid.conf
>>2021/05/07 10:31:27 kid1| Logfile: opening log daemon:/var/log/squid/access.log
>>2021/05/07 10:31:27 kid1| Logfile Daemon: opening log /var/log/squid/access.log
>>2021/05/07 10:31:27 kid1| WARNING: no_suid: setuid(0): (22) Invalid argument
>>2021/05/07 10:31:27 kid1| Store logging disabled
>>2021/05/07 10:31:27 kid1| Swap maxSize 0 + 262144 KB, estimated 20164 objects
>>2021/05/07 10:31:27 kid1| Target number of buckets: 1008
>>2021/05/07 10:31:27 kid1| Using 8192 Store buckets
>>2021/05/07 10:31:27 kid1| Max Mem  size: 262144 KB
>>2021/05/07 10:31:27 kid1| Max Swap size: 0 KB
>>2021/05/07 10:31:27 kid1| Using Least Load store dir selection
>>2021/05/07 10:31:27 kid1| Set Current Directory to /var/cache/squid
>>2021/05/07 10:31:27 kid1| Finished loading MIME types and icons.
>>2021/05/07 10:31:27 kid1| HTCP Disabled.
>>2021/05/07 10:31:27 kid1| Squid plugin modules loaded: 0
>>2021/05/07 10:31:27 kid1| Adaptation support is off.
>>2021/05/07 10:31:27 kid1| Accepting HTTP Socket connections at local=192.168.1.10:3128 remote=[::] FD 10 flags=9
>>2021/05/07 10:31:28 kid1| storeLateRelease: released 0 objects
>>2021/05/07 10:35:43 kid1| Set Current Directory to /var/cache/squid
>>2021/05/07 10:35:43 kid1| Starting Squid Cache version 3.5.28 for x86_64-unknown-cygwin...
>>2021/05/07 10:35:43 kid1| Service Name: squid
>>2021/05/07 10:35:43 kid1| Process ID 27908
>>2021/05/07 10:35:43 kid1| Process Roles: worker
>>2021/05/07 10:35:43 kid1| With 3200 file descriptors available
>>2021/05/07 10:35:43 kid1| Initializing IP Cache...
>>2021/05/07 10:35:43 kid1| parseEtcHosts: /etc/hosts: (2) No such file or directory
>>2021/05/07 10:35:43 kid1| DNS Socket created at [::], FD 5
>>2021/05/07 10:35:43 kid1| DNS Socket created at 0.0.0.0, FD 6
>>2021/05/07 10:35:43 kid1| Adding nameserver 8.8.8.8 from squid.conf
>>2021/05/07 10:35:43 kid1| Adding nameserver 208.67.222.222 from squid.conf
>>2021/05/07 10:35:43 kid1| Logfile: opening log daemon:/var/log/squid/access.log
>>2021/05/07 10:35:43 kid1| Logfile Daemon: opening log /var/log/squid/access.log
>>2021/05/07 10:35:43 kid1| WARNING: no_suid: setuid(0): (22) Invalid argument
>>2021/05/07 10:35:43 kid1| Store logging disabled
>>2021/05/07 10:35:43 kid1| Swap maxSize 0 + 262144 KB, estimated 20164 objects
>>2021/05/07 10:35:43 kid1| Target number of buckets: 1008
>>2021/05/07 10:35:43 kid1| Using 8192 Store buckets
>>2021/05/07 10:35:43 kid1| Max Mem  size: 262144 KB
>>2021/05/07 10:35:43 kid1| Max Swap size: 0 KB
>>2021/05/07 10:35:43 kid1| Using Least Load store dir selection
>>2021/05/07 10:35:43 kid1| Set Current Directory to /var/cache/squid
>>2021/05/07 10:35:43 kid1| Finished loading MIME types and icons.
>>2021/05/07 10:35:43 kid1| HTCP Disabled.
>>2021/05/07 10:35:43 kid1| Squid plugin modules loaded: 0
>>2021/05/07 10:35:43 kid1| Adaptation support is off.
>>2021/05/07 10:35:43 kid1| Accepting HTTP Socket connections at local=[::]:3128 remote=[::] FD 10 flags=9
>>2021/05/07 10:35:44 kid1| storeLateRelease: released 0 objects


--
Matus UHLAR - fantomas, uhlar at fantomas.sk ; https://na01.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.fantomas.sk%2F&amp;data=04%7C01%7C%7C4c81508715fd4e0a083008d915e55e0c%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C637564897135492645%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&amp;sdata=j92dPnLAjPfFdzqXc1mTk7433vUCe0exEiEuue40vvM%3D&amp;reserved=0
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
WinError #99999: Out of error messages.
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
https://na01.safelinks.protection.outlook.com/?url=http%3A%2F%2Flists.squid-cache.org%2Flistinfo%2Fsquid-users&amp;data=04%7C01%7C%7C4c81508715fd4e0a083008d915e55e0c%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C637564897135492645%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&amp;sdata=To9lcSfAiRXfNeX26Ersv49hIuFxb9XX4E77BnI0kz4%3D&amp;reserved=0
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210513/a69346a5/attachment.htm>

From uhlar at fantomas.sk  Thu May 13 08:04:56 2021
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Thu, 13 May 2021 10:04:56 +0200
Subject: [squid-users] HTTPS request times out going through Squid proxy
In-Reply-To: <MW4PR15MB4524333835402100D069320DD9529@MW4PR15MB4524.namprd15.prod.outlook.com>
References: <MW4PR15MB452451647269BC78DB438BD0D9579@MW4PR15MB4524.namprd15.prod.outlook.com>
 <MW4PR15MB4524D997958D8AF37C23F4B4D9579@MW4PR15MB4524.namprd15.prod.outlook.com>
 <MW4PR15MB45246F662CB41C46DA007679D9549@MW4PR15MB4524.namprd15.prod.outlook.com>
 <20210510083935.GA32242@fantomas.sk>
 <MW4PR15MB4524D114DD759AE1765BDA8ED9549@MW4PR15MB4524.namprd15.prod.outlook.com>
 <20210510170627.GA14812@fantomas.sk>
 <MW4PR15MB4524F0BFAF5C8E5B1A2D541DD9549@MW4PR15MB4524.namprd15.prod.outlook.com>
 <20210510181251.GA16199@fantomas.sk>
 <MW4PR15MB4524CA97C882ABBB0C25BE9AD9549@MW4PR15MB4524.namprd15.prod.outlook.com>
 <MW4PR15MB4524333835402100D069320DD9529@MW4PR15MB4524.namprd15.prod.outlook.com>
Message-ID: <20210513080456.GC21969@fantomas.sk>

On 12.05.21 23:22, Aniruddha Gore wrote:
> Pinging the thread again since I think mine is a straightforward set-up. 
> Just wondering if I need to setup the config a certain way to start
> supporting HTTPS calls.

https requests through squid just work as CONNECT requests where squid just
passes the request to destination server, doing nothing with that.

>  They work if squid is running on the same
> machine, but I start seeing problems if squid is running on another
> machine and I use webproxy on HTTP requests.

webproxy? Doesn't your software connect directly to squid?

there should be no difference if your client software connects to squid on
your or other machine, unless there's anything in between that tries to
intercept those connections. 
Such interception could explain your problems.

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
My mind is like a steel trap - rusty and illegal in 37 states.


From agnrie at hotmail.com  Thu May 13 15:39:31 2021
From: agnrie at hotmail.com (Aniruddha Gore)
Date: Thu, 13 May 2021 15:39:31 +0000
Subject: [squid-users] HTTPS request times out going through Squid proxy
In-Reply-To: <20210513080456.GC21969@fantomas.sk>
References: <MW4PR15MB452451647269BC78DB438BD0D9579@MW4PR15MB4524.namprd15.prod.outlook.com>
 <MW4PR15MB4524D997958D8AF37C23F4B4D9579@MW4PR15MB4524.namprd15.prod.outlook.com>
 <MW4PR15MB45246F662CB41C46DA007679D9549@MW4PR15MB4524.namprd15.prod.outlook.com>
 <20210510083935.GA32242@fantomas.sk>
 <MW4PR15MB4524D114DD759AE1765BDA8ED9549@MW4PR15MB4524.namprd15.prod.outlook.com>
 <20210510170627.GA14812@fantomas.sk>
 <MW4PR15MB4524F0BFAF5C8E5B1A2D541DD9549@MW4PR15MB4524.namprd15.prod.outlook.com>
 <20210510181251.GA16199@fantomas.sk>
 <MW4PR15MB4524CA97C882ABBB0C25BE9AD9549@MW4PR15MB4524.namprd15.prod.outlook.com>
 <MW4PR15MB4524333835402100D069320DD9529@MW4PR15MB4524.namprd15.prod.outlook.com>,
 <20210513080456.GC21969@fantomas.sk>
Message-ID: <MW4PR15MB4524E8C530E1CCFE27A5BAB3D9519@MW4PR15MB4524.namprd15.prod.outlook.com>

By webproxy I meant the property I set when making HTTP requests. I use CPPRestSDK, here is the reference to set_proxy() method:
https://microsoft.github.io/cpprestsdk/classweb_1_1http_1_1client_1_1http__client__config.html#aee5ef5ba25992d4b9b41cb28f3fb0d0c

It works seamlessly with another proxy I have tried, but that other proxy does not have some features that Squid has which is why I am trying to use Squid ?

Should I be looking into any options listed for http_port squid config, like intercept?

Aniruddha Gore
Sent from Outlook.com<http://www.microsoft.com/en-us/outlook-com/compare/>
________________________________
From: squid-users <squid-users-bounces at lists.squid-cache.org> on behalf of Matus UHLAR - fantomas <uhlar at fantomas.sk>
Sent: Thursday, May 13, 2021 1:04 AM
To: squid-users at lists.squid-cache.org <squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] HTTPS request times out going through Squid proxy

On 12.05.21 23:22, Aniruddha Gore wrote:
> Pinging the thread again since I think mine is a straightforward set-up.
> Just wondering if I need to setup the config a certain way to start
> supporting HTTPS calls.

https requests through squid just work as CONNECT requests where squid just
passes the request to destination server, doing nothing with that.

>  They work if squid is running on the same
> machine, but I start seeing problems if squid is running on another
> machine and I use webproxy on HTTP requests.

webproxy? Doesn't your software connect directly to squid?

there should be no difference if your client software connects to squid on
your or other machine, unless there's anything in between that tries to
intercept those connections.
Such interception could explain your problems.

--
Matus UHLAR - fantomas, uhlar at fantomas.sk ; https://na01.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.fantomas.sk%2F&amp;data=04%7C01%7C%7C78eda7ac32fe4134afd508d915e5d06a%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C637564899052690268%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&amp;sdata=8GN%2Bq5JrEi67axE29LCJULDUOuN8u1yb%2F2navVxoyMY%3D&amp;reserved=0
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
My mind is like a steel trap - rusty and illegal in 37 states.
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
https://na01.safelinks.protection.outlook.com/?url=http%3A%2F%2Flists.squid-cache.org%2Flistinfo%2Fsquid-users&amp;data=04%7C01%7C%7C78eda7ac32fe4134afd508d915e5d06a%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C637564899052690268%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&amp;sdata=GJQv4OnGZ3cgsGmcy8dmYJmg73A98JCLAXtQg8eZKgw%3D&amp;reserved=0
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210513/e3784e06/attachment.htm>

From uhlar at fantomas.sk  Thu May 13 15:42:16 2021
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Thu, 13 May 2021 17:42:16 +0200
Subject: [squid-users] HTTPS request times out going through Squid proxy
In-Reply-To: <MW4PR15MB4524E8C530E1CCFE27A5BAB3D9519@MW4PR15MB4524.namprd15.prod.outlook.com>
References: <MW4PR15MB45246F662CB41C46DA007679D9549@MW4PR15MB4524.namprd15.prod.outlook.com>
 <20210510083935.GA32242@fantomas.sk>
 <MW4PR15MB4524D114DD759AE1765BDA8ED9549@MW4PR15MB4524.namprd15.prod.outlook.com>
 <20210510170627.GA14812@fantomas.sk>
 <MW4PR15MB4524F0BFAF5C8E5B1A2D541DD9549@MW4PR15MB4524.namprd15.prod.outlook.com>
 <20210510181251.GA16199@fantomas.sk>
 <MW4PR15MB4524CA97C882ABBB0C25BE9AD9549@MW4PR15MB4524.namprd15.prod.outlook.com>
 <MW4PR15MB4524333835402100D069320DD9529@MW4PR15MB4524.namprd15.prod.outlook.com>
 <20210513080456.GC21969@fantomas.sk>
 <MW4PR15MB4524E8C530E1CCFE27A5BAB3D9519@MW4PR15MB4524.namprd15.prod.outlook.com>
Message-ID: <20210513154215.GA4077@fantomas.sk>

On 13.05.21 15:39, Aniruddha Gore wrote:
>By webproxy I meant the property I set when making HTTP requests. I use CPPRestSDK, here is the reference to set_proxy() method:
>https://microsoft.github.io/cpprestsdk/classweb_1_1http_1_1client_1_1http__client__config.html#aee5ef5ba25992d4b9b41cb28f3fb0d0c
>
>It works seamlessly with another proxy I have tried, but that other proxy does not have some features that Squid has which is why I am trying to use Squid ?
>
>Should I be looking into any options listed for http_port squid config, like intercept?

remove intercept if you can configure squid as proxy.

use intercept on different ports, if needed.

>From: squid-users <squid-users-bounces at lists.squid-cache.org> on behalf of Matus UHLAR - fantomas <uhlar at fantomas.sk>
>Sent: Thursday, May 13, 2021 1:04 AM
>To: squid-users at lists.squid-cache.org <squid-users at lists.squid-cache.org>
>Subject: Re: [squid-users] HTTPS request times out going through Squid proxy
>
>On 12.05.21 23:22, Aniruddha Gore wrote:
>> Pinging the thread again since I think mine is a straightforward set-up.
>> Just wondering if I need to setup the config a certain way to start
>> supporting HTTPS calls.
>
>https requests through squid just work as CONNECT requests where squid just
>passes the request to destination server, doing nothing with that.
>
>>  They work if squid is running on the same
>> machine, but I start seeing problems if squid is running on another
>> machine and I use webproxy on HTTP requests.
>
>webproxy? Doesn't your software connect directly to squid?
>
>there should be no difference if your client software connects to squid on
>your or other machine, unless there's anything in between that tries to
>intercept those connections.
>Such interception could explain your problems.

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Nothing is fool-proof to a talented fool.


From kbvz at ymail.com  Thu May 13 19:18:07 2021
From: kbvz at ymail.com (Stephane Simon)
Date: Thu, 13 May 2021 19:18:07 +0000 (UTC)
Subject: [squid-users] =?utf-8?b?UmXCoDpSZTogIFNTTCBCVU1Q?=
In-Reply-To: <60f6159611d811b152e8dccbd5663940@treenet.co.nz>
References: <217701640.3617459.1620642419464.ref@mail.yahoo.com>
 <217701640.3617459.1620642419464@mail.yahoo.com>
 <60f6159611d811b152e8dccbd5663940@treenet.co.nz>
Message-ID: <2065759767.458986.1620933487843@mail.yahoo.com>

Hello,?
Thanks a lot for you help !!?I ll look that soon :)?

Cordialement, kbvz/Stephane  
 
  Le mer., mai 12, 2021 ? 14:46, squid3 at treenet.co.nz<squid3 at treenet.co.nz> a ?crit :   On 2021-05-10 22:26, Stephane Simon wrote:
> Hello,
> 
> I try to configure https? with ssl bump.
> I use redhat 8.
> 
> i follow https://blog.microlinux.fr/squid-https-centos-7/
> when i restart squid, he doesn't cooperate and say:
> 
> "FATAL: The usr/lib64/squid/security_file_certgen -s
> /var/lib/squid/ssl_db -M 64MB helpers are crashing too rapidly, need
> help!"
> 
> i don't know how to fix this error..i dont know why i've this error ^^
> 
> Does someone have an idea please ?

The helper crashing is required by Squid to generate certificates for 
bumping.
Without it working perfectly Squid cannot handle any HTTPS traffic.


> 
> http_port 3130
> http_port 3128 intercept
> https_port 3129 intercept ssl-bump \
>? cert=/etc/squid/ssl_cert/certificat.pem \
>? generate-host-certificates=on \
>? dynamic_cert_mem_cache_size=64MB
> 
> #SSL certificate generation
> sslcrtd_program usr/lib64/squid/security_file_certgen -s

The path should begin with '/usr/' not just 'usr/

> /var/lib/squid/ssl_db -M 64MB

Check that this /var path actually exists. That the low-privilege 
account the proxy uses has both read and write access to it.

Run the helper command to initialize the database before starting Squid. 
Do so using the low-privilege account Squid uses to ensure the database 
files have correct ownership.



> sslcrtd_children 32 startup=5 idle=1
> 
> # SSL-Bump
> acl step1 at_step SslBump1
> ssl_bump peek step1
> ssl_bump bump all
> 

Please be aware that this configuration is trying to forge server 
certificates without having any details about the real server 
certificate. When you are past the helper problem it is likely that this 
basic configuration will cause a number of TLS problems.

For bumping as much as possible this is a better config:

? acl step1 at_step SslBump1
? ssl_bump peek step1
? ssl_bump stare all
? ssl_bump bump all


Amos
  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210513/5c874ff7/attachment.htm>

From dan at mirageid.com  Thu May 13 19:47:17 2021
From: dan at mirageid.com (Dan Steen)
Date: Thu, 13 May 2021 15:47:17 -0400
Subject: [squid-users] 
 =?utf-8?q?https=5Fport_not_correctly_sending_ssl_c?=
 =?utf-8?q?ert_information=3F?=
In-Reply-To: <53507ef9-85f0-4cbd-8889-ca3e3241d23e@www.fastmail.com>
References: <5942a26b-2328-4479-a807-1f3954e400b1@www.fastmail.com>
 <-1fums4-nmpyy2rqqhw9-hxq1bg56fgaibnubyem5td3sxlq18k4lv781rsyuhvzhc531yk7eqt7fv68s-qvqlul2mxsaq-gevsrxu7xhdf7rfwk-qv7kxg7whfysm9us3a493ivulnv9vx-6ekibs.1620782214676@email.android.com>
 <aaf9ba3f-221f-4a99-9e97-b9e2cfaa1b91@www.fastmail.com>
 <6a0addd0e4e6a6443fd3f276989f816f@treenet.co.nz>
 <53507ef9-85f0-4cbd-8889-ca3e3241d23e@www.fastmail.com>
Message-ID: <407acb93-e962-4df7-9aea-bea88f800d21@www.fastmail.com>

That looks like it solved the issue!  Switching to an openssl build fixed things.   Thanks so much for the responses!


On Tue, May 11, 2021, at 10:08 PM, Dan Steen wrote:
> great!  i'll give it a try and report back.  thanks so much!
> 
> On Tue, May 11, 2021, at 10:03 PM, squid3 at treenet.co.nz <mailto:squid3%40treenet.co.nz> wrote:
>> Oh, I see. With that simple config the issue has to be lack of cert 
>> chain support in GnuTLS. Simply rebuilding using --with-openssl should 
>> resolve it.
>> 
>> Amos
>> 
> 
> Dan Steen
> 
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org <mailto:squid-users%40lists.squid-cache.org>
> http://lists.squid-cache.org/listinfo/squid-users
> 

Dan Steen

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210513/9dc13428/attachment.htm>

From nikhildeshpande18 at gmail.com  Fri May 14 09:45:31 2021
From: nikhildeshpande18 at gmail.com (nikhil deshpande)
Date: Fri, 14 May 2021 15:15:31 +0530
Subject: [squid-users] Probable release date for squid V5
Message-ID: <CALO-o=zbOzdHb8+=z_Yn=QP=W+2QL8sc-7YFNP54fDRBExo8XQ@mail.gmail.com>

Hi Guys,

I am Nikhil from India. We use squid in our project. Currently, we can see
squid version 5 release is in beta as per this link
http://www.squid-cache.org/Versions/.
I wanted to ask what is the probable timeline for Squid version 5 stable
release?

Regards,
Nikhil
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210514/717b11f9/attachment.htm>

From squid3 at treenet.co.nz  Sat May 15 01:01:59 2021
From: squid3 at treenet.co.nz (squid3 at treenet.co.nz)
Date: Sat, 15 May 2021 13:01:59 +1200
Subject: [squid-users] Probable release date for squid V5
In-Reply-To: <CALO-o=zbOzdHb8+=z_Yn=QP=W+2QL8sc-7YFNP54fDRBExo8XQ@mail.gmail.com>
References: <CALO-o=zbOzdHb8+=z_Yn=QP=W+2QL8sc-7YFNP54fDRBExo8XQ@mail.gmail.com>
Message-ID: <5834b26896a759511115ac6f6fe96f99@treenet.co.nz>



From squid3 at treenet.co.nz  Sat May 15 01:06:52 2021
From: squid3 at treenet.co.nz (squid3 at treenet.co.nz)
Date: Sat, 15 May 2021 13:06:52 +1200
Subject: [squid-users] Probable release date for squid V5
In-Reply-To: <CALO-o=zbOzdHb8+=z_Yn=QP=W+2QL8sc-7YFNP54fDRBExo8XQ@mail.gmail.com>
References: <CALO-o=zbOzdHb8+=z_Yn=QP=W+2QL8sc-7YFNP54fDRBExo8XQ@mail.gmail.com>
Message-ID: <016af5a388434f58bb60ce4c5cb436da@treenet.co.nz>

On 2021-05-14 21:45, nikhil deshpande wrote:
> Hi Guys,
> 
> I am Nikhil from India. We use squid in our project. Currently, we can
> see squid version 5 release is in beta as per this link
> http://www.squid-cache.org/Versions/.
> I wanted to ask what is the probable timeline for Squid version 5
> stable release?
> 

Normally I would be able to estimate a rough month. However the past 
year has seen the core developers all have workload commitments that 
delay things. So right now I am reluctant to even guess at a date.

What I can say is that there are 4 bugs that need fixing. One is nearly 
done now, but the rest still need investigating to find the actual 
problem.


Amos


From nikhildeshpande18 at gmail.com  Mon May 17 06:23:51 2021
From: nikhildeshpande18 at gmail.com (nikhil deshpande)
Date: Mon, 17 May 2021 11:53:51 +0530
Subject: [squid-users] Probable release date for squid V5
In-Reply-To: <016af5a388434f58bb60ce4c5cb436da@treenet.co.nz>
References: <CALO-o=zbOzdHb8+=z_Yn=QP=W+2QL8sc-7YFNP54fDRBExo8XQ@mail.gmail.com>
 <016af5a388434f58bb60ce4c5cb436da@treenet.co.nz>
Message-ID: <CALO-o=y1ehqUmwCHL9i9qF1bOHkTH+fh8DA=05KcdQyQM3Pc4w@mail.gmail.com>

Ok. Thanks a lot for the update. Can we assume that version 5 will be
released in quarter 3 2021 timelines? I am just guessing for a date so that
I can convey it to management.


Regards,
Nikhil

On Sat, May 15, 2021 at 6:36 AM <squid3 at treenet.co.nz> wrote:

> On 2021-05-14 21:45, nikhil deshpande wrote:
> > Hi Guys,
> >
> > I am Nikhil from India. We use squid in our project. Currently, we can
> > see squid version 5 release is in beta as per this link
> > http://www.squid-cache.org/Versions/.
> > I wanted to ask what is the probable timeline for Squid version 5
> > stable release?
> >
>
> Normally I would be able to estimate a rough month. However the past
> year has seen the core developers all have workload commitments that
> delay things. So right now I am reluctant to even guess at a date.
>
> What I can say is that there are 4 bugs that need fixing. One is nearly
> done now, but the rest still need investigating to find the actual
> problem.
>
>
> Amos
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210517/a169eeda/attachment.htm>

From rafael.akchurin at diladele.com  Mon May 17 09:23:35 2021
From: rafael.akchurin at diladele.com (Rafael Akchurin)
Date: Mon, 17 May 2021 09:23:35 +0000
Subject: [squid-users] Squid for Windows 4.14 is available
Message-ID: <AM8PR04MB7745C0D160EE5A5729294A3E8F2D9@AM8PR04MB7745.eurprd04.prod.outlook.com>

Hello everyone,

After years of postponing we were finally able to build and pack the Squid 4 for Microsoft Windows.
Sorry it took a lot more time and efforts than anticipated. The already existing version 4.15 is also being packed.
I will update once again when it is available.

The MSI can be downloaded from https://squid.diladele.com/ site.

While you are there be sure to check out our other projects - Web Safety ICAP web filter and Admin UI for Squid (https://www.diladele.com/) and
DNS Safety filter (something like web safety but on DNS level - https://dnssafety.diladele.com/).

Repo for development of Squid for Windows is available at  https://github.com/diladele/squid-windows.
Please post your question *for MSI problems only* at support at diladele.com<mailto:support at diladele.com> - and for Squid part here.

Best regards,
Rafael




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210517/41f8dd63/attachment.htm>

From lbrtchx at gmail.com  Tue May 18 03:21:33 2021
From: lbrtchx at gmail.com (Albretch Mueller)
Date: Mon, 17 May 2021 23:21:33 -0400
Subject: [squid-users] hindsight recommendations on using existing or
 writing an ICAP server ...
Message-ID: <CAFakBwg7sCHRTgZ63KKuyAuY7HaoJa4ezgYcC+t6fQUV88sFMg@mail.gmail.com>

 I need to either use an existing open source implementation of RFC
3507 or write one myself.

 My main interest would be then connecting it to java using the JNI in
order to do the deep content inspection and dynamic customization from
events happening in java programs.

 I need a thoroughgoing step-by-step guideline.

 Any books, blogs, ? ideas you would recommend?

 thank you,
 lbrtchx


From robertkwild at gmail.com  Tue May 18 11:15:43 2021
From: robertkwild at gmail.com (robert k Wild)
Date: Tue, 18 May 2021 12:15:43 +0100
Subject: [squid-users] squid clamav configure options
Message-ID: <CAGU_Ci+HEAMonER3untasDm0T5KX99Wnj-OTR9RmNm5uS1vryQ@mail.gmail.com>

hi all,

as i have squid 4.9, im planning to upgrade to squid 4.15 as i got emails
saying 4.9 is now deprecated

i was wondering, if these configuration options would still work for squid
4.15

cd /tmp/squid-4.9
./configure --with-openssl --enable-ssl-crtd --enable-icap-client
--enable-http-violations && make && make install
#
cd /tmp/c_icap-0.5.6
./configure 'CXXFLAGS=-O2 -m64 -pipe' 'CFLAGS=-O2 -m64 -pipe' --without-bdb
--prefix=/usr/local && make && make install
#
cd /tmp/squidclamav-7.1
./configure 'CXXFLAGS=-O2 -m64 -pipe' 'CFLAGS=-O2 -m64 -pipe'
--with-c-icap=/usr/local --with-libarchive && make && make install
#
cd /tmp/c_icap_modules-0.5.4
./configure 'CFLAGS=-O3 -m64 -pipe' 'CPPFLAGS=-I/usr/local/clamav/include'
'LDFLAGS=-L/usr/local/lib -L/usr/local/clamav/lib/' && make && make install

thanks,
rob

-- 
Regards,

Robert K Wild.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210518/f1c02a61/attachment.htm>

From rousskov at measurement-factory.com  Tue May 18 14:23:55 2021
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Tue, 18 May 2021 10:23:55 -0400
Subject: [squid-users] hindsight recommendations on using existing or
 writing an ICAP server ...
In-Reply-To: <CAFakBwg7sCHRTgZ63KKuyAuY7HaoJa4ezgYcC+t6fQUV88sFMg@mail.gmail.com>
References: <CAFakBwg7sCHRTgZ63KKuyAuY7HaoJa4ezgYcC+t6fQUV88sFMg@mail.gmail.com>
Message-ID: <b33fda9c-d9d4-82dd-6f57-64249832638f@measurement-factory.com>

On 5/17/21 11:21 PM, Albretch Mueller wrote:
> I need to either use an existing open source implementation of RFC
> 3507 or write one myself.
> 
> My main interest would be then connecting it to java using the JNI in
> order to do the deep content inspection and dynamic customization from
> events happening in java programs.
> 
> I need a thoroughgoing step-by-step guideline.
> 
> Any books, blogs, ? ideas you would recommend?


In my experience[1], creating an ICAP server for experiments is easy,
but writing a yet another production ICAP server is almost always a bad
choice. I have seen many attempts that ultimately failed after spending
a lot of resources on writing and fixing the new server. RFC 3507 may
seem simple, but ICAP complexity lies beyond parsing ICAP messages, and
some RFC problems are not fixed by the errata.

I do not think you will find thoroughgoing step-by-step guidelines, but
there are existing ICAP servers that can be customized or loaded with
custom adapters.

* https://wiki.squid-cache.org/Features/ICAP#ICAP_Servers
* https://wiki.squid-cache.org/SquidFaq/ContentAdaptation#ICAP


HTH,

Alex.
[1] About 15+ years worth of writing and maintaining ICAP servers,
clients, adapters, and related software/RFCs.


From squid3 at treenet.co.nz  Tue May 18 22:35:51 2021
From: squid3 at treenet.co.nz (=?UTF-8?B?4oCqQW1vcyBKZWZmcmllc+KArA==?=)
Date: Wed, 19 May 2021 10:35:51 +1200
Subject: [squid-users] squid clamav configure options
References: <CAGU_Ci+HEAMonER3untasDm0T5KX99Wnj-OTR9RmNm5uS1vryQ@mail.gmail.com>
Message-ID: <jveh79-10nil7-z2wg58-k5ol611988tc-tktqm41p634zv2hxos-tia3z9eocys-bqrk52p0t8ku-7s6tkx-lblzcralafe8jziattmwcp4650f2t-fdvj9y9jlyq764zqqyvj4242-d15q6z-1gk6xv.1621377351249@email.android.com>

An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210519/e72863fc/attachment.htm>

From robertkwild at gmail.com  Wed May 19 06:13:37 2021
From: robertkwild at gmail.com (robert k Wild)
Date: Wed, 19 May 2021 07:13:37 +0100
Subject: [squid-users] squid clamav configure options
In-Reply-To: <jveh79-10nil7-z2wg58-k5ol611988tc-tktqm41p634zv2hxos-tia3z9eocys-bqrk52p0t8ku-7s6tkx-lblzcralafe8jziattmwcp4650f2t-fdvj9y9jlyq764zqqyvj4242-d15q6z-1gk6xv.1621377351249@email.android.com>
References: <CAGU_Ci+HEAMonER3untasDm0T5KX99Wnj-OTR9RmNm5uS1vryQ@mail.gmail.com>
 <jveh79-10nil7-z2wg58-k5ol611988tc-tktqm41p634zv2hxos-tia3z9eocys-bqrk52p0t8ku-7s6tkx-lblzcralafe8jziattmwcp4650f2t-fdvj9y9jlyq764zqqyvj4242-d15q6z-1gk6xv.1621377351249@email.android.com>
Message-ID: <CAGU_CiJptu2nY4r2dtmutvS1p7Kg2Fg22LiaHAEoeZf48VaPrw@mail.gmail.com>

Thank you Amos

On Tue, 18 May 2021, 23:36 ?Amos Jeffries?, <squid3 at treenet.co.nz> wrote:

> Squid-4 is a stable release series. That means we go out of our way to
> ensure UI (eg build and squid.conf) does not change behaviour.
>
> So yes all *squid* settings should work the same between those versions.
>
> c-icap and squidclamav are third party software. You should not need to
> change them just to update squid.
>
> Amos
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210519/157a242d/attachment.htm>

From robertkwild at gmail.com  Wed May 19 12:54:15 2021
From: robertkwild at gmail.com (robert k Wild)
Date: Wed, 19 May 2021 13:54:15 +0100
Subject: [squid-users] squid self signed cert error on some websites
Message-ID: <CAGU_CiJPBE7b+RRue6bavj9W-rzCrYd2=uewPRDd4z0sim7GQA@mail.gmail.com>

hi all,

i have squid 4.15

i have imported my self signed cert on firefox and now i can access https
website (where as before i got a software is preventing this website from
opening)

but on some websites i get an error saying

secure connection failed
Error code: SEC_ERROR_BAD_SIGNATURE

i attach my ssl bump conf in my squid.conf file

#SSL Bump
http_port 3128 ssl-bump cert=/usr/local/squid/etc/ssl_cert/myCA.pem
generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
cipher=HIGH:MEDIUM:RC4:3DES:!aNULL:!eNULL:!LOW:!MD5:!EXP:!PSK:!SRP:!DSS
sslcrtd_program /usr/local/squid/libexec/security_file_certgen -s
/var/lib/ssl_db -M 4MB
acl step1 at_step SslBump1
ssl_bump peek step1
ssl_bump bump all

is there anything wrong you can see, i have tried to make a new CA but
error still occures

thanks,
rob

-- 
Regards,

Robert K Wild.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210519/0d6db6d6/attachment.htm>

From robertkwild at gmail.com  Wed May 19 14:41:18 2021
From: robertkwild at gmail.com (robert k Wild)
Date: Wed, 19 May 2021 15:41:18 +0100
Subject: [squid-users] squid self signed cert error on some websites
In-Reply-To: <CAGU_CiJPBE7b+RRue6bavj9W-rzCrYd2=uewPRDd4z0sim7GQA@mail.gmail.com>
References: <CAGU_CiJPBE7b+RRue6bavj9W-rzCrYd2=uewPRDd4z0sim7GQA@mail.gmail.com>
Message-ID: <CAGU_CiLTwe2OqJOnMrRugBNfiivsHnxyZ0-Gk6-5H-dq5JSJjw@mail.gmail.com>

ok i found out what the error is

its because in my squid.conf, i have a whitelist file

#HTTP_HTTPS whitelist websites
acl whitelist ssl::server_name "/usr/local/squid/etc/urlwhite.txt"
http_access allow activation whitelist
http_access deny all

once i added the url to that file, it worked

but surely, instead of giving me an error saying

secure connection failed
Error code: SEC_ERROR_BAD_SIGNATURE

it should be the default error ie

The following error was encountered while trying to retrieve the URL:
https://blah.blah

    Access Denied.

how can i change this please

thanks,
rob

On Wed, 19 May 2021 at 13:54, robert k Wild <robertkwild at gmail.com> wrote:

> hi all,
>
> i have squid 4.15
>
> i have imported my self signed cert on firefox and now i can access https
> website (where as before i got a software is preventing this website from
> opening)
>
> but on some websites i get an error saying
>
> secure connection failed
> Error code: SEC_ERROR_BAD_SIGNATURE
>
> i attach my ssl bump conf in my squid.conf file
>
> #SSL Bump
> http_port 3128 ssl-bump cert=/usr/local/squid/etc/ssl_cert/myCA.pem
> generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
> cipher=HIGH:MEDIUM:RC4:3DES:!aNULL:!eNULL:!LOW:!MD5:!EXP:!PSK:!SRP:!DSS
> sslcrtd_program /usr/local/squid/libexec/security_file_certgen -s
> /var/lib/ssl_db -M 4MB
> acl step1 at_step SslBump1
> ssl_bump peek step1
> ssl_bump bump all
>
> is there anything wrong you can see, i have tried to make a new CA but
> error still occures
>
> thanks,
> rob
>
> --
> Regards,
>
> Robert K Wild.
>


-- 
Regards,

Robert K Wild.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210519/e86995c7/attachment.htm>

From rousskov at measurement-factory.com  Wed May 19 18:12:21 2021
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Wed, 19 May 2021 14:12:21 -0400
Subject: [squid-users] squid self signed cert error on some websites
In-Reply-To: <CAGU_CiLTwe2OqJOnMrRugBNfiivsHnxyZ0-Gk6-5H-dq5JSJjw@mail.gmail.com>
References: <CAGU_CiJPBE7b+RRue6bavj9W-rzCrYd2=uewPRDd4z0sim7GQA@mail.gmail.com>
 <CAGU_CiLTwe2OqJOnMrRugBNfiivsHnxyZ0-Gk6-5H-dq5JSJjw@mail.gmail.com>
Message-ID: <c0f88993-b7da-521d-ee29-f052f6272454@measurement-factory.com>

On 5/19/21 10:41 AM, robert k Wild wrote:
> ok i found out what the error is
> 
> its because in my squid.conf, i have a whitelist file
> 
> #HTTP_HTTPS whitelist websites
> acl whitelist ssl::server_name "/usr/local/squid/etc/urlwhite.txt"
> http_access allow activation whitelist
> http_access deny all
> 
> once i added the url to that file, it worked
> 
> but surely, instead of giving me an error saying
> 
> secure connection failed
> Error code: SEC_ERROR_BAD_SIGNATURE
> 
> it should be the default error ie
> 
> The following error was encountered while trying to retrieve the URL:
> https://blah.blah <https://blah.blah>
> 
> ? ? Access Denied.
> 
> how can i change this please

The answer depends on _why_ you get that SEC_ERROR_BAD_SIGNATURE error.

If Squid does not have enough information to properly bump your client
connection, then there may be no bumping-based solution at all (e.g.
when the client is using certificate pinning), or you would have to bump
at step2 when more information is available to Squid (to generate a
better fake certificate).

For the next step, try comparing the fake certificate that causes
SEC_ERROR_BAD_SIGNATURE with the fake same-site certificate that works
after you whitelist the problematic site. The browser should allow you
to view both certificates. You can download them and use certificate
printing tools like "openssl x509 -noout -text -in ..." to compare two
certificate printouts.

HTH,

Alex.


> On Wed, 19 May 2021 at 13:54, robert k Wild wrote:
> 
>     hi all,
> 
>     i have squid 4.15
> 
>     i have imported my self signed cert on firefox and now i can access
>     https website (where as before i got a software is preventing this
>     website from opening)
> 
>     but on some websites i get an error saying
> 
>     secure connection failed
>     Error code: SEC_ERROR_BAD_SIGNATURE
> 
>     i attach my ssl bump conf in my squid.conf file
> 
>     #SSL Bump
>     http_port 3128 ssl-bump cert=/usr/local/squid/etc/ssl_cert/myCA.pem
>     generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
>     cipher=HIGH:MEDIUM:RC4:3DES:!aNULL:!eNULL:!LOW:!MD5:!EXP:!PSK:!SRP:!DSS
>     sslcrtd_program /usr/local/squid/libexec/security_file_certgen -s
>     /var/lib/ssl_db -M 4MB
>     acl step1 at_step SslBump1
>     ssl_bump peek step1
>     ssl_bump bump all
> 
>     is there anything wrong you can see, i have tried to make a new CA
>     but error still occures
> 
>     thanks,
>     rob
> 
>     -- 
>     Regards,
> 
>     Robert K Wild.
> 
> 
> 
> -- 
> Regards,
> 
> Robert K Wild.
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 



From robertkwild at gmail.com  Wed May 19 19:44:12 2021
From: robertkwild at gmail.com (robert k Wild)
Date: Wed, 19 May 2021 20:44:12 +0100
Subject: [squid-users] squid self signed cert error on some websites
In-Reply-To: <c0f88993-b7da-521d-ee29-f052f6272454@measurement-factory.com>
References: <CAGU_CiJPBE7b+RRue6bavj9W-rzCrYd2=uewPRDd4z0sim7GQA@mail.gmail.com>
 <CAGU_CiLTwe2OqJOnMrRugBNfiivsHnxyZ0-Gk6-5H-dq5JSJjw@mail.gmail.com>
 <c0f88993-b7da-521d-ee29-f052f6272454@measurement-factory.com>
Message-ID: <CAGU_CiLWx_VJ57YLHVtxUbrVZ3ZAw1ncdO608_Ej-EgRdsvgkA@mail.gmail.com>

Thanks Alex,

i think i know why now after further digging

when i dont add it to the white list i cant view the website (obviously)
but can see the cert is provided by my squid (default company ltd)...i was
lazy creating it but cant view the cert

when i add it to the white list, i can view the website and the cert info
and its def from my squid cert (default company ltd) as i see the valid
dates ie before and after

i think i need to relax the ciphers in my squid.conf as some other https
websites i get the error page and i dont get the cert error message

do you think relaxing the ciphers will work?


On Wed, 19 May 2021, 19:12 Alex Rousskov, <rousskov at measurement-factory.com>
wrote:

> On 5/19/21 10:41 AM, robert k Wild wrote:
> > ok i found out what the error is
> >
> > its because in my squid.conf, i have a whitelist file
> >
> > #HTTP_HTTPS whitelist websites
> > acl whitelist ssl::server_name "/usr/local/squid/etc/urlwhite.txt"
> > http_access allow activation whitelist
> > http_access deny all
> >
> > once i added the url to that file, it worked
> >
> > but surely, instead of giving me an error saying
> >
> > secure connection failed
> > Error code: SEC_ERROR_BAD_SIGNATURE
> >
> > it should be the default error ie
> >
> > The following error was encountered while trying to retrieve the URL:
> > https://blah.blah <https://blah.blah>
> >
> >     Access Denied.
> >
> > how can i change this please
>
> The answer depends on _why_ you get that SEC_ERROR_BAD_SIGNATURE error.
>
> If Squid does not have enough information to properly bump your client
> connection, then there may be no bumping-based solution at all (e.g.
> when the client is using certificate pinning), or you would have to bump
> at step2 when more information is available to Squid (to generate a
> better fake certificate).
>
> For the next step, try comparing the fake certificate that causes
> SEC_ERROR_BAD_SIGNATURE with the fake same-site certificate that works
> after you whitelist the problematic site. The browser should allow you
> to view both certificates. You can download them and use certificate
> printing tools like "openssl x509 -noout -text -in ..." to compare two
> certificate printouts.
>
> HTH,
>
> Alex.
>
>
> > On Wed, 19 May 2021 at 13:54, robert k Wild wrote:
> >
> >     hi all,
> >
> >     i have squid 4.15
> >
> >     i have imported my self signed cert on firefox and now i can access
> >     https website (where as before i got a software is preventing this
> >     website from opening)
> >
> >     but on some websites i get an error saying
> >
> >     secure connection failed
> >     Error code: SEC_ERROR_BAD_SIGNATURE
> >
> >     i attach my ssl bump conf in my squid.conf file
> >
> >     #SSL Bump
> >     http_port 3128 ssl-bump cert=/usr/local/squid/etc/ssl_cert/myCA.pem
> >     generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
> >
>  cipher=HIGH:MEDIUM:RC4:3DES:!aNULL:!eNULL:!LOW:!MD5:!EXP:!PSK:!SRP:!DSS
> >     sslcrtd_program /usr/local/squid/libexec/security_file_certgen -s
> >     /var/lib/ssl_db -M 4MB
> >     acl step1 at_step SslBump1
> >     ssl_bump peek step1
> >     ssl_bump bump all
> >
> >     is there anything wrong you can see, i have tried to make a new CA
> >     but error still occures
> >
> >     thanks,
> >     rob
> >
> >     --
> >     Regards,
> >
> >     Robert K Wild.
> >
> >
> >
> > --
> > Regards,
> >
> > Robert K Wild.
> >
> > _______________________________________________
> > squid-users mailing list
> > squid-users at lists.squid-cache.org
> > http://lists.squid-cache.org/listinfo/squid-users
> >
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210519/0303877a/attachment.htm>

From rousskov at measurement-factory.com  Wed May 19 20:05:30 2021
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Wed, 19 May 2021 16:05:30 -0400
Subject: [squid-users] squid self signed cert error on some websites
In-Reply-To: <CAGU_CiLWx_VJ57YLHVtxUbrVZ3ZAw1ncdO608_Ej-EgRdsvgkA@mail.gmail.com>
References: <CAGU_CiJPBE7b+RRue6bavj9W-rzCrYd2=uewPRDd4z0sim7GQA@mail.gmail.com>
 <CAGU_CiLTwe2OqJOnMrRugBNfiivsHnxyZ0-Gk6-5H-dq5JSJjw@mail.gmail.com>
 <c0f88993-b7da-521d-ee29-f052f6272454@measurement-factory.com>
 <CAGU_CiLWx_VJ57YLHVtxUbrVZ3ZAw1ncdO608_Ej-EgRdsvgkA@mail.gmail.com>
Message-ID: <72fbb60c-9b1c-7ce7-ef21-00355defd139@measurement-factory.com>

On 5/19/21 3:44 PM, robert k Wild wrote:

> when i dont add it to the white list i cant view the website (obviously)
> but can see the cert is provided by my squid (default company ltd)...i
> was lazy creating it but cant view the cert
> 
> when i add it to the white list, i can view the website and the cert
> info and its def from my squid cert (default company ltd) as i see the
> valid dates ie before and after

The difference between those two certificates, if any, may be able to
explain the difference in browser behavior. It would also be useful to
compare those fake certificates with the real one.


> i think i need to relax the ciphers in my squid.conf as some other https
> websites i get the error page and i dont get the cert error message
> 
> do you think relaxing the ciphers will work?

Sorry, I do not know. Obviously, you can trivially check this theory.

Alex.


> On Wed, 19 May 2021, 19:12 Alex Rousskov wrote:
> 
>     On 5/19/21 10:41 AM, robert k Wild wrote:
>     > ok i found out what the error is
>     >
>     > its because in my squid.conf, i have a whitelist file
>     >
>     > #HTTP_HTTPS whitelist websites
>     > acl whitelist ssl::server_name "/usr/local/squid/etc/urlwhite.txt"
>     > http_access allow activation whitelist
>     > http_access deny all
>     >
>     > once i added the url to that file, it worked
>     >
>     > but surely, instead of giving me an error saying
>     >
>     > secure connection failed
>     > Error code: SEC_ERROR_BAD_SIGNATURE
>     >
>     > it should be the default error ie
>     >
>     > The following error was encountered while trying to retrieve the URL:
>     > https://blah.blah <https://blah.blah> <https://blah.blah
>     <https://blah.blah>>
>     >
>     > ? ? Access Denied.
>     >
>     > how can i change this please
> 
>     The answer depends on _why_ you get that SEC_ERROR_BAD_SIGNATURE error.
> 
>     If Squid does not have enough information to properly bump your client
>     connection, then there may be no bumping-based solution at all (e.g.
>     when the client is using certificate pinning), or you would have to bump
>     at step2 when more information is available to Squid (to generate a
>     better fake certificate).
> 
>     For the next step, try comparing the fake certificate that causes
>     SEC_ERROR_BAD_SIGNATURE with the fake same-site certificate that works
>     after you whitelist the problematic site. The browser should allow you
>     to view both certificates. You can download them and use certificate
>     printing tools like "openssl x509 -noout -text -in ..." to compare two
>     certificate printouts.
> 
>     HTH,
> 
>     Alex.
> 
> 
>     > On Wed, 19 May 2021 at 13:54, robert k Wild wrote:
>     >
>     >? ? ?hi all,
>     >
>     >? ? ?i have squid 4.15
>     >
>     >? ? ?i have imported my self signed cert on firefox and now i can
>     access
>     >? ? ?https website (where as before i got a software is preventing this
>     >? ? ?website from opening)
>     >
>     >? ? ?but on some websites i get an error saying
>     >
>     >? ? ?secure connection failed
>     >? ? ?Error code: SEC_ERROR_BAD_SIGNATURE
>     >
>     >? ? ?i attach my ssl bump conf in my squid.conf file
>     >
>     >? ? ?#SSL Bump
>     >? ? ?http_port 3128 ssl-bump
>     cert=/usr/local/squid/etc/ssl_cert/myCA.pem
>     >? ? ?generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
>     >? ?
>     ?cipher=HIGH:MEDIUM:RC4:3DES:!aNULL:!eNULL:!LOW:!MD5:!EXP:!PSK:!SRP:!DSS
>     >? ? ?sslcrtd_program /usr/local/squid/libexec/security_file_certgen -s
>     >? ? ?/var/lib/ssl_db -M 4MB
>     >? ? ?acl step1 at_step SslBump1
>     >? ? ?ssl_bump peek step1
>     >? ? ?ssl_bump bump all
>     >
>     >? ? ?is there anything wrong you can see, i have tried to make a new CA
>     >? ? ?but error still occures
>     >
>     >? ? ?thanks,
>     >? ? ?rob
>     >
>     >? ? ?--
>     >? ? ?Regards,
>     >
>     >? ? ?Robert K Wild.
>     >
>     >
>     >
>     > --
>     > Regards,
>     >
>     > Robert K Wild.
>     >
>     > _______________________________________________
>     > squid-users mailing list
>     > squid-users at lists.squid-cache.org
>     <mailto:squid-users at lists.squid-cache.org>
>     > http://lists.squid-cache.org/listinfo/squid-users
>     <http://lists.squid-cache.org/listinfo/squid-users>
>     >
> 
>     _______________________________________________
>     squid-users mailing list
>     squid-users at lists.squid-cache.org
>     <mailto:squid-users at lists.squid-cache.org>
>     http://lists.squid-cache.org/listinfo/squid-users
>     <http://lists.squid-cache.org/listinfo/squid-users>
> 



From robertkwild at gmail.com  Wed May 19 20:20:18 2021
From: robertkwild at gmail.com (robert k Wild)
Date: Wed, 19 May 2021 21:20:18 +0100
Subject: [squid-users] squid self signed cert error on some websites
In-Reply-To: <72fbb60c-9b1c-7ce7-ef21-00355defd139@measurement-factory.com>
References: <CAGU_CiJPBE7b+RRue6bavj9W-rzCrYd2=uewPRDd4z0sim7GQA@mail.gmail.com>
 <CAGU_CiLTwe2OqJOnMrRugBNfiivsHnxyZ0-Gk6-5H-dq5JSJjw@mail.gmail.com>
 <c0f88993-b7da-521d-ee29-f052f6272454@measurement-factory.com>
 <CAGU_CiLWx_VJ57YLHVtxUbrVZ3ZAw1ncdO608_Ej-EgRdsvgkA@mail.gmail.com>
 <72fbb60c-9b1c-7ce7-ef21-00355defd139@measurement-factory.com>
Message-ID: <CAGU_CiLpvgAVxCzJyFSRKgnquiMOC90STMZeo0V5QGqnrQyQEw@mail.gmail.com>

Thanks Alex,

When I don't add the website to the white list I can't view the cert, so I
cant download it and compare it with the one I can view/download when I do
add it to the white list

Or are you talking about turn the proxy off on Firefox and access the
website normally?

Thanks,
Rob

On Wed, 19 May 2021, 21:05 Alex Rousskov, <rousskov at measurement-factory.com>
wrote:

> On 5/19/21 3:44 PM, robert k Wild wrote:
>
> > when i dont add it to the white list i cant view the website (obviously)
> > but can see the cert is provided by my squid (default company ltd)...i
> > was lazy creating it but cant view the cert
> >
> > when i add it to the white list, i can view the website and the cert
> > info and its def from my squid cert (default company ltd) as i see the
> > valid dates ie before and after
>
> The difference between those two certificates, if any, may be able to
> explain the difference in browser behavior. It would also be useful to
> compare those fake certificates with the real one.
>
>
> > i think i need to relax the ciphers in my squid.conf as some other https
> > websites i get the error page and i dont get the cert error message
> >
> > do you think relaxing the ciphers will work?
>
> Sorry, I do not know. Obviously, you can trivially check this theory.
>
> Alex.
>
>
> > On Wed, 19 May 2021, 19:12 Alex Rousskov wrote:
> >
> >     On 5/19/21 10:41 AM, robert k Wild wrote:
> >     > ok i found out what the error is
> >     >
> >     > its because in my squid.conf, i have a whitelist file
> >     >
> >     > #HTTP_HTTPS whitelist websites
> >     > acl whitelist ssl::server_name "/usr/local/squid/etc/urlwhite.txt"
> >     > http_access allow activation whitelist
> >     > http_access deny all
> >     >
> >     > once i added the url to that file, it worked
> >     >
> >     > but surely, instead of giving me an error saying
> >     >
> >     > secure connection failed
> >     > Error code: SEC_ERROR_BAD_SIGNATURE
> >     >
> >     > it should be the default error ie
> >     >
> >     > The following error was encountered while trying to retrieve the
> URL:
> >     > https://blah.blah <https://blah.blah> <https://blah.blah
> >     <https://blah.blah>>
> >     >
> >     >     Access Denied.
> >     >
> >     > how can i change this please
> >
> >     The answer depends on _why_ you get that SEC_ERROR_BAD_SIGNATURE
> error.
> >
> >     If Squid does not have enough information to properly bump your
> client
> >     connection, then there may be no bumping-based solution at all (e.g.
> >     when the client is using certificate pinning), or you would have to
> bump
> >     at step2 when more information is available to Squid (to generate a
> >     better fake certificate).
> >
> >     For the next step, try comparing the fake certificate that causes
> >     SEC_ERROR_BAD_SIGNATURE with the fake same-site certificate that
> works
> >     after you whitelist the problematic site. The browser should allow
> you
> >     to view both certificates. You can download them and use certificate
> >     printing tools like "openssl x509 -noout -text -in ..." to compare
> two
> >     certificate printouts.
> >
> >     HTH,
> >
> >     Alex.
> >
> >
> >     > On Wed, 19 May 2021 at 13:54, robert k Wild wrote:
> >     >
> >     >     hi all,
> >     >
> >     >     i have squid 4.15
> >     >
> >     >     i have imported my self signed cert on firefox and now i can
> >     access
> >     >     https website (where as before i got a software is preventing
> this
> >     >     website from opening)
> >     >
> >     >     but on some websites i get an error saying
> >     >
> >     >     secure connection failed
> >     >     Error code: SEC_ERROR_BAD_SIGNATURE
> >     >
> >     >     i attach my ssl bump conf in my squid.conf file
> >     >
> >     >     #SSL Bump
> >     >     http_port 3128 ssl-bump
> >     cert=/usr/local/squid/etc/ssl_cert/myCA.pem
> >     >     generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
> >     >
> >
>   cipher=HIGH:MEDIUM:RC4:3DES:!aNULL:!eNULL:!LOW:!MD5:!EXP:!PSK:!SRP:!DSS
> >     >     sslcrtd_program /usr/local/squid/libexec/security_file_certgen
> -s
> >     >     /var/lib/ssl_db -M 4MB
> >     >     acl step1 at_step SslBump1
> >     >     ssl_bump peek step1
> >     >     ssl_bump bump all
> >     >
> >     >     is there anything wrong you can see, i have tried to make a
> new CA
> >     >     but error still occures
> >     >
> >     >     thanks,
> >     >     rob
> >     >
> >     >     --
> >     >     Regards,
> >     >
> >     >     Robert K Wild.
> >     >
> >     >
> >     >
> >     > --
> >     > Regards,
> >     >
> >     > Robert K Wild.
> >     >
> >     > _______________________________________________
> >     > squid-users mailing list
> >     > squid-users at lists.squid-cache.org
> >     <mailto:squid-users at lists.squid-cache.org>
> >     > http://lists.squid-cache.org/listinfo/squid-users
> >     <http://lists.squid-cache.org/listinfo/squid-users>
> >     >
> >
> >     _______________________________________________
> >     squid-users mailing list
> >     squid-users at lists.squid-cache.org
> >     <mailto:squid-users at lists.squid-cache.org>
> >     http://lists.squid-cache.org/listinfo/squid-users
> >     <http://lists.squid-cache.org/listinfo/squid-users>
> >
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210519/1eecdd84/attachment.htm>

From rousskov at measurement-factory.com  Wed May 19 20:25:55 2021
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Wed, 19 May 2021 16:25:55 -0400
Subject: [squid-users] squid self signed cert error on some websites
In-Reply-To: <CAGU_CiLpvgAVxCzJyFSRKgnquiMOC90STMZeo0V5QGqnrQyQEw@mail.gmail.com>
References: <CAGU_CiJPBE7b+RRue6bavj9W-rzCrYd2=uewPRDd4z0sim7GQA@mail.gmail.com>
 <CAGU_CiLTwe2OqJOnMrRugBNfiivsHnxyZ0-Gk6-5H-dq5JSJjw@mail.gmail.com>
 <c0f88993-b7da-521d-ee29-f052f6272454@measurement-factory.com>
 <CAGU_CiLWx_VJ57YLHVtxUbrVZ3ZAw1ncdO608_Ej-EgRdsvgkA@mail.gmail.com>
 <72fbb60c-9b1c-7ce7-ef21-00355defd139@measurement-factory.com>
 <CAGU_CiLpvgAVxCzJyFSRKgnquiMOC90STMZeo0V5QGqnrQyQEw@mail.gmail.com>
Message-ID: <3da64e45-713c-f2cd-9b58-8d948dd7d60b@measurement-factory.com>

On 5/19/21 4:20 PM, robert k Wild wrote:

> When I don't add the website to the white list I can't view the cert

What prevents you from viewing the certificate? Can you click on the
site information icon to the left of the browser Location(?) bar when
the error is displayed? If not, perhaps you can use FireFox built-in
"Web Developer Tools" (Ctrl-Shift-I on my machine) to get to the
certificate? I am not a browser expert, but there is usually a way to
see the certificate if the browser received it.

If nothing works, can you try reproducing using curl or wget instead of
a browser?


> Or are you talking about turn the proxy off on Firefox and access the
> website normally?

That would give you the third certificate to compare.

Alex.


> On Wed, 19 May 2021, 21:05 Alex Rousskov,
> <rousskov at measurement-factory.com
> <mailto:rousskov at measurement-factory.com>> wrote:
> 
>     On 5/19/21 3:44 PM, robert k Wild wrote:
> 
>     > when i dont add it to the white list i cant view the website
>     (obviously)
>     > but can see the cert is provided by my squid (default company ltd)...i
>     > was lazy creating it but cant view the cert
>     >
>     > when i add it to the white list, i can view the website and the cert
>     > info and its def from my squid cert (default company ltd) as i see the
>     > valid dates ie before and after
> 
>     The difference between those two certificates, if any, may be able to
>     explain the difference in browser behavior. It would also be useful to
>     compare those fake certificates with the real one.
> 
> 
>     > i think i need to relax the ciphers in my squid.conf as some other
>     https
>     > websites i get the error page and i dont get the cert error message
>     >
>     > do you think relaxing the ciphers will work?
> 
>     Sorry, I do not know. Obviously, you can trivially check this theory.
> 
>     Alex.
> 
> 
>     > On Wed, 19 May 2021, 19:12 Alex Rousskov wrote:
>     >
>     >? ? ?On 5/19/21 10:41 AM, robert k Wild wrote:
>     >? ? ?> ok i found out what the error is
>     >? ? ?>
>     >? ? ?> its because in my squid.conf, i have a whitelist file
>     >? ? ?>
>     >? ? ?> #HTTP_HTTPS whitelist websites
>     >? ? ?> acl whitelist ssl::server_name
>     "/usr/local/squid/etc/urlwhite.txt"
>     >? ? ?> http_access allow activation whitelist
>     >? ? ?> http_access deny all
>     >? ? ?>
>     >? ? ?> once i added the url to that file, it worked
>     >? ? ?>
>     >? ? ?> but surely, instead of giving me an error saying
>     >? ? ?>
>     >? ? ?> secure connection failed
>     >? ? ?> Error code: SEC_ERROR_BAD_SIGNATURE
>     >? ? ?>
>     >? ? ?> it should be the default error ie
>     >? ? ?>
>     >? ? ?> The following error was encountered while trying to retrieve
>     the URL:
>     >? ? ?> https://blah.blah <https://blah.blah> <https://blah.blah
>     <https://blah.blah>> <https://blah.blah <https://blah.blah>
>     >? ? ?<https://blah.blah <https://blah.blah>>>
>     >? ? ?>
>     >? ? ?> ? ? Access Denied.
>     >? ? ?>
>     >? ? ?> how can i change this please
>     >
>     >? ? ?The answer depends on _why_ you get that
>     SEC_ERROR_BAD_SIGNATURE error.
>     >
>     >? ? ?If Squid does not have enough information to properly bump
>     your client
>     >? ? ?connection, then there may be no bumping-based solution at all
>     (e.g.
>     >? ? ?when the client is using certificate pinning), or you would
>     have to bump
>     >? ? ?at step2 when more information is available to Squid (to
>     generate a
>     >? ? ?better fake certificate).
>     >
>     >? ? ?For the next step, try comparing the fake certificate that causes
>     >? ? ?SEC_ERROR_BAD_SIGNATURE with the fake same-site certificate
>     that works
>     >? ? ?after you whitelist the problematic site. The browser should
>     allow you
>     >? ? ?to view both certificates. You can download them and use
>     certificate
>     >? ? ?printing tools like "openssl x509 -noout -text -in ..." to
>     compare two
>     >? ? ?certificate printouts.
>     >
>     >? ? ?HTH,
>     >
>     >? ? ?Alex.
>     >
>     >
>     >? ? ?> On Wed, 19 May 2021 at 13:54, robert k Wild wrote:
>     >? ? ?>
>     >? ? ?>? ? ?hi all,
>     >? ? ?>
>     >? ? ?>? ? ?i have squid 4.15
>     >? ? ?>
>     >? ? ?>? ? ?i have imported my self signed cert on firefox and now i can
>     >? ? ?access
>     >? ? ?>? ? ?https website (where as before i got a software is
>     preventing this
>     >? ? ?>? ? ?website from opening)
>     >? ? ?>
>     >? ? ?>? ? ?but on some websites i get an error saying
>     >? ? ?>
>     >? ? ?>? ? ?secure connection failed
>     >? ? ?>? ? ?Error code: SEC_ERROR_BAD_SIGNATURE
>     >? ? ?>
>     >? ? ?>? ? ?i attach my ssl bump conf in my squid.conf file
>     >? ? ?>
>     >? ? ?>? ? ?#SSL Bump
>     >? ? ?>? ? ?http_port 3128 ssl-bump
>     >? ? ?cert=/usr/local/squid/etc/ssl_cert/myCA.pem
>     >? ? ?>? ? ?generate-host-certificates=on
>     dynamic_cert_mem_cache_size=4MB
>     >? ? ?>? ?
>     >? ?
>     ??cipher=HIGH:MEDIUM:RC4:3DES:!aNULL:!eNULL:!LOW:!MD5:!EXP:!PSK:!SRP:!DSS
>     >? ? ?>? ? ?sslcrtd_program
>     /usr/local/squid/libexec/security_file_certgen -s
>     >? ? ?>? ? ?/var/lib/ssl_db -M 4MB
>     >? ? ?>? ? ?acl step1 at_step SslBump1
>     >? ? ?>? ? ?ssl_bump peek step1
>     >? ? ?>? ? ?ssl_bump bump all
>     >? ? ?>
>     >? ? ?>? ? ?is there anything wrong you can see, i have tried to
>     make a new CA
>     >? ? ?>? ? ?but error still occures
>     >? ? ?>
>     >? ? ?>? ? ?thanks,
>     >? ? ?>? ? ?rob
>     >? ? ?>
>     >? ? ?>? ? ?--
>     >? ? ?>? ? ?Regards,
>     >? ? ?>
>     >? ? ?>? ? ?Robert K Wild.
>     >? ? ?>
>     >? ? ?>
>     >? ? ?>
>     >? ? ?> --
>     >? ? ?> Regards,
>     >? ? ?>
>     >? ? ?> Robert K Wild.
>     >? ? ?>
>     >? ? ?> _______________________________________________
>     >? ? ?> squid-users mailing list
>     >? ? ?> squid-users at lists.squid-cache.org
>     <mailto:squid-users at lists.squid-cache.org>
>     >? ? ?<mailto:squid-users at lists.squid-cache.org
>     <mailto:squid-users at lists.squid-cache.org>>
>     >? ? ?> http://lists.squid-cache.org/listinfo/squid-users
>     <http://lists.squid-cache.org/listinfo/squid-users>
>     >? ? ?<http://lists.squid-cache.org/listinfo/squid-users
>     <http://lists.squid-cache.org/listinfo/squid-users>>
>     >? ? ?>
>     >
>     >? ? ?_______________________________________________
>     >? ? ?squid-users mailing list
>     >? ? ?squid-users at lists.squid-cache.org
>     <mailto:squid-users at lists.squid-cache.org>
>     >? ? ?<mailto:squid-users at lists.squid-cache.org
>     <mailto:squid-users at lists.squid-cache.org>>
>     >? ? ?http://lists.squid-cache.org/listinfo/squid-users
>     <http://lists.squid-cache.org/listinfo/squid-users>
>     >? ? ?<http://lists.squid-cache.org/listinfo/squid-users
>     <http://lists.squid-cache.org/listinfo/squid-users>>
>     >
> 



From robertkwild at gmail.com  Wed May 19 20:34:28 2021
From: robertkwild at gmail.com (robert k Wild)
Date: Wed, 19 May 2021 21:34:28 +0100
Subject: [squid-users] squid self signed cert error on some websites
In-Reply-To: <3da64e45-713c-f2cd-9b58-8d948dd7d60b@measurement-factory.com>
References: <CAGU_CiJPBE7b+RRue6bavj9W-rzCrYd2=uewPRDd4z0sim7GQA@mail.gmail.com>
 <CAGU_CiLTwe2OqJOnMrRugBNfiivsHnxyZ0-Gk6-5H-dq5JSJjw@mail.gmail.com>
 <c0f88993-b7da-521d-ee29-f052f6272454@measurement-factory.com>
 <CAGU_CiLWx_VJ57YLHVtxUbrVZ3ZAw1ncdO608_Ej-EgRdsvgkA@mail.gmail.com>
 <72fbb60c-9b1c-7ce7-ef21-00355defd139@measurement-factory.com>
 <CAGU_CiLpvgAVxCzJyFSRKgnquiMOC90STMZeo0V5QGqnrQyQEw@mail.gmail.com>
 <3da64e45-713c-f2cd-9b58-8d948dd7d60b@measurement-factory.com>
Message-ID: <CAGU_CiJR1GScqaM2i-YabXEuBtha7c0PiHZjvadxAfbDoVFLcw@mail.gmail.com>

Thanks Alex, I will do this tomorrow and let you know

Thank you, have a great day

On Wed, 19 May 2021, 21:25 Alex Rousskov, <rousskov at measurement-factory.com>
wrote:

> On 5/19/21 4:20 PM, robert k Wild wrote:
>
> > When I don't add the website to the white list I can't view the cert
>
> What prevents you from viewing the certificate? Can you click on the
> site information icon to the left of the browser Location(?) bar when
> the error is displayed? If not, perhaps you can use FireFox built-in
> "Web Developer Tools" (Ctrl-Shift-I on my machine) to get to the
> certificate? I am not a browser expert, but there is usually a way to
> see the certificate if the browser received it.
>
> If nothing works, can you try reproducing using curl or wget instead of
> a browser?
>
>
> > Or are you talking about turn the proxy off on Firefox and access the
> > website normally?
>
> That would give you the third certificate to compare.
>
> Alex.
>
>
> > On Wed, 19 May 2021, 21:05 Alex Rousskov,
> > <rousskov at measurement-factory.com
> > <mailto:rousskov at measurement-factory.com>> wrote:
> >
> >     On 5/19/21 3:44 PM, robert k Wild wrote:
> >
> >     > when i dont add it to the white list i cant view the website
> >     (obviously)
> >     > but can see the cert is provided by my squid (default company
> ltd)...i
> >     > was lazy creating it but cant view the cert
> >     >
> >     > when i add it to the white list, i can view the website and the
> cert
> >     > info and its def from my squid cert (default company ltd) as i see
> the
> >     > valid dates ie before and after
> >
> >     The difference between those two certificates, if any, may be able to
> >     explain the difference in browser behavior. It would also be useful
> to
> >     compare those fake certificates with the real one.
> >
> >
> >     > i think i need to relax the ciphers in my squid.conf as some other
> >     https
> >     > websites i get the error page and i dont get the cert error message
> >     >
> >     > do you think relaxing the ciphers will work?
> >
> >     Sorry, I do not know. Obviously, you can trivially check this theory.
> >
> >     Alex.
> >
> >
> >     > On Wed, 19 May 2021, 19:12 Alex Rousskov wrote:
> >     >
> >     >     On 5/19/21 10:41 AM, robert k Wild wrote:
> >     >     > ok i found out what the error is
> >     >     >
> >     >     > its because in my squid.conf, i have a whitelist file
> >     >     >
> >     >     > #HTTP_HTTPS whitelist websites
> >     >     > acl whitelist ssl::server_name
> >     "/usr/local/squid/etc/urlwhite.txt"
> >     >     > http_access allow activation whitelist
> >     >     > http_access deny all
> >     >     >
> >     >     > once i added the url to that file, it worked
> >     >     >
> >     >     > but surely, instead of giving me an error saying
> >     >     >
> >     >     > secure connection failed
> >     >     > Error code: SEC_ERROR_BAD_SIGNATURE
> >     >     >
> >     >     > it should be the default error ie
> >     >     >
> >     >     > The following error was encountered while trying to retrieve
> >     the URL:
> >     >     > https://blah.blah <https://blah.blah> <https://blah.blah
> >     <https://blah.blah>> <https://blah.blah <https://blah.blah>
> >     >     <https://blah.blah <https://blah.blah>>>
> >     >     >
> >     >     >     Access Denied.
> >     >     >
> >     >     > how can i change this please
> >     >
> >     >     The answer depends on _why_ you get that
> >     SEC_ERROR_BAD_SIGNATURE error.
> >     >
> >     >     If Squid does not have enough information to properly bump
> >     your client
> >     >     connection, then there may be no bumping-based solution at all
> >     (e.g.
> >     >     when the client is using certificate pinning), or you would
> >     have to bump
> >     >     at step2 when more information is available to Squid (to
> >     generate a
> >     >     better fake certificate).
> >     >
> >     >     For the next step, try comparing the fake certificate that
> causes
> >     >     SEC_ERROR_BAD_SIGNATURE with the fake same-site certificate
> >     that works
> >     >     after you whitelist the problematic site. The browser should
> >     allow you
> >     >     to view both certificates. You can download them and use
> >     certificate
> >     >     printing tools like "openssl x509 -noout -text -in ..." to
> >     compare two
> >     >     certificate printouts.
> >     >
> >     >     HTH,
> >     >
> >     >     Alex.
> >     >
> >     >
> >     >     > On Wed, 19 May 2021 at 13:54, robert k Wild wrote:
> >     >     >
> >     >     >     hi all,
> >     >     >
> >     >     >     i have squid 4.15
> >     >     >
> >     >     >     i have imported my self signed cert on firefox and now i
> can
> >     >     access
> >     >     >     https website (where as before i got a software is
> >     preventing this
> >     >     >     website from opening)
> >     >     >
> >     >     >     but on some websites i get an error saying
> >     >     >
> >     >     >     secure connection failed
> >     >     >     Error code: SEC_ERROR_BAD_SIGNATURE
> >     >     >
> >     >     >     i attach my ssl bump conf in my squid.conf file
> >     >     >
> >     >     >     #SSL Bump
> >     >     >     http_port 3128 ssl-bump
> >     >     cert=/usr/local/squid/etc/ssl_cert/myCA.pem
> >     >     >     generate-host-certificates=on
> >     dynamic_cert_mem_cache_size=4MB
> >     >     >
> >     >
> >
>    cipher=HIGH:MEDIUM:RC4:3DES:!aNULL:!eNULL:!LOW:!MD5:!EXP:!PSK:!SRP:!DSS
> >     >     >     sslcrtd_program
> >     /usr/local/squid/libexec/security_file_certgen -s
> >     >     >     /var/lib/ssl_db -M 4MB
> >     >     >     acl step1 at_step SslBump1
> >     >     >     ssl_bump peek step1
> >     >     >     ssl_bump bump all
> >     >     >
> >     >     >     is there anything wrong you can see, i have tried to
> >     make a new CA
> >     >     >     but error still occures
> >     >     >
> >     >     >     thanks,
> >     >     >     rob
> >     >     >
> >     >     >     --
> >     >     >     Regards,
> >     >     >
> >     >     >     Robert K Wild.
> >     >     >
> >     >     >
> >     >     >
> >     >     > --
> >     >     > Regards,
> >     >     >
> >     >     > Robert K Wild.
> >     >     >
> >     >     > _______________________________________________
> >     >     > squid-users mailing list
> >     >     > squid-users at lists.squid-cache.org
> >     <mailto:squid-users at lists.squid-cache.org>
> >     >     <mailto:squid-users at lists.squid-cache.org
> >     <mailto:squid-users at lists.squid-cache.org>>
> >     >     > http://lists.squid-cache.org/listinfo/squid-users
> >     <http://lists.squid-cache.org/listinfo/squid-users>
> >     >     <http://lists.squid-cache.org/listinfo/squid-users
> >     <http://lists.squid-cache.org/listinfo/squid-users>>
> >     >     >
> >     >
> >     >     _______________________________________________
> >     >     squid-users mailing list
> >     >     squid-users at lists.squid-cache.org
> >     <mailto:squid-users at lists.squid-cache.org>
> >     >     <mailto:squid-users at lists.squid-cache.org
> >     <mailto:squid-users at lists.squid-cache.org>>
> >     >     http://lists.squid-cache.org/listinfo/squid-users
> >     <http://lists.squid-cache.org/listinfo/squid-users>
> >     >     <http://lists.squid-cache.org/listinfo/squid-users
> >     <http://lists.squid-cache.org/listinfo/squid-users>>
> >     >
> >
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210519/24862b9d/attachment.htm>

From robertkwild at gmail.com  Wed May 19 20:52:09 2021
From: robertkwild at gmail.com (robert k Wild)
Date: Wed, 19 May 2021 21:52:09 +0100
Subject: [squid-users] squid self signed cert error on some websites
In-Reply-To: <CAGU_CiJR1GScqaM2i-YabXEuBtha7c0PiHZjvadxAfbDoVFLcw@mail.gmail.com>
References: <CAGU_CiJPBE7b+RRue6bavj9W-rzCrYd2=uewPRDd4z0sim7GQA@mail.gmail.com>
 <CAGU_CiLTwe2OqJOnMrRugBNfiivsHnxyZ0-Gk6-5H-dq5JSJjw@mail.gmail.com>
 <c0f88993-b7da-521d-ee29-f052f6272454@measurement-factory.com>
 <CAGU_CiLWx_VJ57YLHVtxUbrVZ3ZAw1ncdO608_Ej-EgRdsvgkA@mail.gmail.com>
 <72fbb60c-9b1c-7ce7-ef21-00355defd139@measurement-factory.com>
 <CAGU_CiLpvgAVxCzJyFSRKgnquiMOC90STMZeo0V5QGqnrQyQEw@mail.gmail.com>
 <3da64e45-713c-f2cd-9b58-8d948dd7d60b@measurement-factory.com>
 <CAGU_CiJR1GScqaM2i-YabXEuBtha7c0PiHZjvadxAfbDoVFLcw@mail.gmail.com>
Message-ID: <CAGU_CiJEWq5buAeN=vyU5zgPPkgATFzqNQDR=N=CpqSgsaVOYQ@mail.gmail.com>

I'm following this guide

https://wiki.squid-cache.org/ConfigExamples/Intercept/SslBumpExplicit

The section

Alternative trust roots

I don't have a dir called

Usr local openssl

Do I have to download the the ca bundle file somewhere?



On Wed, 19 May 2021, 21:34 robert k Wild, <robertkwild at gmail.com> wrote:

> Thanks Alex, I will do this tomorrow and let you know
>
> Thank you, have a great day
>
> On Wed, 19 May 2021, 21:25 Alex Rousskov, <
> rousskov at measurement-factory.com> wrote:
>
>> On 5/19/21 4:20 PM, robert k Wild wrote:
>>
>> > When I don't add the website to the white list I can't view the cert
>>
>> What prevents you from viewing the certificate? Can you click on the
>> site information icon to the left of the browser Location(?) bar when
>> the error is displayed? If not, perhaps you can use FireFox built-in
>> "Web Developer Tools" (Ctrl-Shift-I on my machine) to get to the
>> certificate? I am not a browser expert, but there is usually a way to
>> see the certificate if the browser received it.
>>
>> If nothing works, can you try reproducing using curl or wget instead of
>> a browser?
>>
>>
>> > Or are you talking about turn the proxy off on Firefox and access the
>> > website normally?
>>
>> That would give you the third certificate to compare.
>>
>> Alex.
>>
>>
>> > On Wed, 19 May 2021, 21:05 Alex Rousskov,
>> > <rousskov at measurement-factory.com
>> > <mailto:rousskov at measurement-factory.com>> wrote:
>> >
>> >     On 5/19/21 3:44 PM, robert k Wild wrote:
>> >
>> >     > when i dont add it to the white list i cant view the website
>> >     (obviously)
>> >     > but can see the cert is provided by my squid (default company
>> ltd)...i
>> >     > was lazy creating it but cant view the cert
>> >     >
>> >     > when i add it to the white list, i can view the website and the
>> cert
>> >     > info and its def from my squid cert (default company ltd) as i
>> see the
>> >     > valid dates ie before and after
>> >
>> >     The difference between those two certificates, if any, may be able
>> to
>> >     explain the difference in browser behavior. It would also be useful
>> to
>> >     compare those fake certificates with the real one.
>> >
>> >
>> >     > i think i need to relax the ciphers in my squid.conf as some other
>> >     https
>> >     > websites i get the error page and i dont get the cert error
>> message
>> >     >
>> >     > do you think relaxing the ciphers will work?
>> >
>> >     Sorry, I do not know. Obviously, you can trivially check this
>> theory.
>> >
>> >     Alex.
>> >
>> >
>> >     > On Wed, 19 May 2021, 19:12 Alex Rousskov wrote:
>> >     >
>> >     >     On 5/19/21 10:41 AM, robert k Wild wrote:
>> >     >     > ok i found out what the error is
>> >     >     >
>> >     >     > its because in my squid.conf, i have a whitelist file
>> >     >     >
>> >     >     > #HTTP_HTTPS whitelist websites
>> >     >     > acl whitelist ssl::server_name
>> >     "/usr/local/squid/etc/urlwhite.txt"
>> >     >     > http_access allow activation whitelist
>> >     >     > http_access deny all
>> >     >     >
>> >     >     > once i added the url to that file, it worked
>> >     >     >
>> >     >     > but surely, instead of giving me an error saying
>> >     >     >
>> >     >     > secure connection failed
>> >     >     > Error code: SEC_ERROR_BAD_SIGNATURE
>> >     >     >
>> >     >     > it should be the default error ie
>> >     >     >
>> >     >     > The following error was encountered while trying to retrieve
>> >     the URL:
>> >     >     > https://blah.blah <https://blah.blah> <https://blah.blah
>> >     <https://blah.blah>> <https://blah.blah <https://blah.blah>
>> >     >     <https://blah.blah <https://blah.blah>>>
>> >     >     >
>> >     >     >     Access Denied.
>> >     >     >
>> >     >     > how can i change this please
>> >     >
>> >     >     The answer depends on _why_ you get that
>> >     SEC_ERROR_BAD_SIGNATURE error.
>> >     >
>> >     >     If Squid does not have enough information to properly bump
>> >     your client
>> >     >     connection, then there may be no bumping-based solution at all
>> >     (e.g.
>> >     >     when the client is using certificate pinning), or you would
>> >     have to bump
>> >     >     at step2 when more information is available to Squid (to
>> >     generate a
>> >     >     better fake certificate).
>> >     >
>> >     >     For the next step, try comparing the fake certificate that
>> causes
>> >     >     SEC_ERROR_BAD_SIGNATURE with the fake same-site certificate
>> >     that works
>> >     >     after you whitelist the problematic site. The browser should
>> >     allow you
>> >     >     to view both certificates. You can download them and use
>> >     certificate
>> >     >     printing tools like "openssl x509 -noout -text -in ..." to
>> >     compare two
>> >     >     certificate printouts.
>> >     >
>> >     >     HTH,
>> >     >
>> >     >     Alex.
>> >     >
>> >     >
>> >     >     > On Wed, 19 May 2021 at 13:54, robert k Wild wrote:
>> >     >     >
>> >     >     >     hi all,
>> >     >     >
>> >     >     >     i have squid 4.15
>> >     >     >
>> >     >     >     i have imported my self signed cert on firefox and now
>> i can
>> >     >     access
>> >     >     >     https website (where as before i got a software is
>> >     preventing this
>> >     >     >     website from opening)
>> >     >     >
>> >     >     >     but on some websites i get an error saying
>> >     >     >
>> >     >     >     secure connection failed
>> >     >     >     Error code: SEC_ERROR_BAD_SIGNATURE
>> >     >     >
>> >     >     >     i attach my ssl bump conf in my squid.conf file
>> >     >     >
>> >     >     >     #SSL Bump
>> >     >     >     http_port 3128 ssl-bump
>> >     >     cert=/usr/local/squid/etc/ssl_cert/myCA.pem
>> >     >     >     generate-host-certificates=on
>> >     dynamic_cert_mem_cache_size=4MB
>> >     >     >
>> >     >
>> >
>>    cipher=HIGH:MEDIUM:RC4:3DES:!aNULL:!eNULL:!LOW:!MD5:!EXP:!PSK:!SRP:!DSS
>> >     >     >     sslcrtd_program
>> >     /usr/local/squid/libexec/security_file_certgen -s
>> >     >     >     /var/lib/ssl_db -M 4MB
>> >     >     >     acl step1 at_step SslBump1
>> >     >     >     ssl_bump peek step1
>> >     >     >     ssl_bump bump all
>> >     >     >
>> >     >     >     is there anything wrong you can see, i have tried to
>> >     make a new CA
>> >     >     >     but error still occures
>> >     >     >
>> >     >     >     thanks,
>> >     >     >     rob
>> >     >     >
>> >     >     >     --
>> >     >     >     Regards,
>> >     >     >
>> >     >     >     Robert K Wild.
>> >     >     >
>> >     >     >
>> >     >     >
>> >     >     > --
>> >     >     > Regards,
>> >     >     >
>> >     >     > Robert K Wild.
>> >     >     >
>> >     >     > _______________________________________________
>> >     >     > squid-users mailing list
>> >     >     > squid-users at lists.squid-cache.org
>> >     <mailto:squid-users at lists.squid-cache.org>
>> >     >     <mailto:squid-users at lists.squid-cache.org
>> >     <mailto:squid-users at lists.squid-cache.org>>
>> >     >     > http://lists.squid-cache.org/listinfo/squid-users
>> >     <http://lists.squid-cache.org/listinfo/squid-users>
>> >     >     <http://lists.squid-cache.org/listinfo/squid-users
>> >     <http://lists.squid-cache.org/listinfo/squid-users>>
>> >     >     >
>> >     >
>> >     >     _______________________________________________
>> >     >     squid-users mailing list
>> >     >     squid-users at lists.squid-cache.org
>> >     <mailto:squid-users at lists.squid-cache.org>
>> >     >     <mailto:squid-users at lists.squid-cache.org
>> >     <mailto:squid-users at lists.squid-cache.org>>
>> >     >     http://lists.squid-cache.org/listinfo/squid-users
>> >     <http://lists.squid-cache.org/listinfo/squid-users>
>> >     >     <http://lists.squid-cache.org/listinfo/squid-users
>> >     <http://lists.squid-cache.org/listinfo/squid-users>>
>> >     >
>> >
>>
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210519/218cae5f/attachment.htm>

From roierachamim at gmail.com  Wed May 19 21:31:44 2021
From: roierachamim at gmail.com (roie rachamim)
Date: Thu, 20 May 2021 00:31:44 +0300
Subject: [squid-users] All Adaptation ICAPs go down at the same time
In-Reply-To: <000001d734fb$6081bd70$21853850$@gmail.com>
References: <CAD=NrcALoEGqctFUpuTZcfkpEbsS=KU4QqXG+LAVd-XtJvfnXg@mail.gmail.com>
 <000001d734fb$6081bd70$21853850$@gmail.com>
Message-ID: <CAD=NrcD_gaS3cSuz426ktqhB2vfeyUH6Umwy6NQY0DUXuhBJTA@mail.gmail.com>

Hi,

This are the logs i manage to capture during disconnection (I enabled 93 in
debug_options)

2021/05/12 12:27:24.209| 93,5| ServiceRep.cc(378) noteTimeToUpdate:
performs a regular options update [up]
2021/05/12 12:27:24.209| 93,6| ServiceRep.cc(611) startGettingOptions: will
get new options [up]
2021/05/12 12:27:24.209| 93,5| AsyncJob.cc(34) AsyncJob: AsyncJob
constructed, this=0x55a73f3bc468 type=Adaptation::Icap::OptXactLauncher
[job31639]
2021/05/12 12:27:24.209| 93,5| AsyncCall.cc(26) AsyncCall: The AsyncCall
AsyncJob::start constructed, this=0x55a73ef1ebc0 [call661700]
2021/05/12 12:27:24.209| 93,5| AsyncCall.cc(93) ScheduleCall:
AsyncJob.cc(26) will call AsyncJob::start() [call661700]
2021/05/12 12:27:24.209| 93,5| AsyncCallQueue.cc(55) fireNext: entering
AsyncJob::start()
2021/05/12 12:27:24.209| 93,5| AsyncCall.cc(38) make: make call
AsyncJob::start [call661700]
2021/05/12 12:27:24.209| 93,5| AsyncJob.cc(123) callStart:
Adaptation::Icap::OptXactLauncher status in: [ job31639]
2021/05/12 12:27:24.209| 93,4| Launcher.cc(49) launchXaction: launching
first xaction #1
2021/05/12 12:27:24.209| 93,5| AsyncJob.cc(34) AsyncJob: AsyncJob
constructed, this=0x55a73f3bca30 type=Adaptation::Icap::OptXact [job31640]
2021/05/12 12:27:24.209| 93,3| Xaction.cc(101) Xaction:
Adaptation::Icap::OptXact constructed, this=0x55a73f3bc948 [icapxjob31640]
2021/05/12 12:27:24.209| 93,5| Xaction.cc(141) disableRepeats:
Adaptation::Icap::OptXact from now on cannot be repeated because over
icap_retry_limit [/ job31640]
2021/05/12 12:27:24.209| 93,5| AsyncCall.cc(26) AsyncCall: The AsyncCall
AsyncJob::start constructed, this=0x55a73ef1ecb0 [call661701]
2021/05/12 12:27:24.209| 93,5| AsyncCall.cc(93) ScheduleCall:
AsyncJob.cc(26) will call AsyncJob::start() [call661701]
2021/05/12 12:27:24.209| 93,5| AsyncJob.cc(154) callEnd:
Adaptation::Icap::OptXactLauncher status out: [ job31639]
2021/05/12 12:27:24.209| 93,5| AsyncCallQueue.cc(57) fireNext: leaving
AsyncJob::start()
2021/05/12 12:27:24.209| 93,5| AsyncCallQueue.cc(55) fireNext: entering
AsyncJob::start()
2021/05/12 12:27:24.209| 93,5| AsyncCall.cc(38) make: make call
AsyncJob::start [call661701]
2021/05/12 12:27:24.209| 93,5| AsyncJob.cc(123) callStart:
Adaptation::Icap::OptXact status in: [/ job31640]
2021/05/12 12:27:24.209| 93,3| ServiceRep.cc(142) getConnection: got
connection:
2021/05/12 12:27:24.209| 93,5| Xaction.cc(134) disableRetries:
Adaptation::Icap::OptXact from now on cannot be retried  [/ job31640]
2021/05/12 12:27:24.209| 93,3| Xaction.cc(189) openConnection:
Adaptation::Icap::OptXact opens connection to skipper.proxy:14590
2021/05/12 12:27:24.209| 93,5| AsyncJob.cc(139) callEnd: AsyncJob::start()
ends job [/ job31640]
2021/05/12 12:27:24.210| 93,5| Initiate.cc(64) swanSong: swan sings [/
job31640]
2021/05/12 12:27:24.210| 93,5| Initiate.cc(71) swanSong: swan sang [/
job31640]
2021/05/12 12:27:24.210| 93,3| Xaction.cc(113) ~Xaction:
Adaptation::Icap::OptXact destructed, this=0x55a73f3bc948 [icapxjob31640]
2021/05/12 12:27:24.210| 93,5| AsyncJob.cc(40) ~AsyncJob: AsyncJob
destructed, this=0x55a73f3bca30 type=Adaptation::Icap::OptXact [job31640]
2021/05/12 12:27:24.210| 93,6| AsyncJob.cc(149) callEnd: AsyncJob::start()
ended 0x55a73f3bca30
2021/05/12 12:27:24.210| 93,5| AsyncCallQueue.cc(57) fireNext: leaving
AsyncJob::start()
2021/05/12 12:27:24.210| 93,5| Launcher.cc(85) noteXactAbort:
theXaction:0x55a73f3bc948/0x55a73f3bc948 launches: 1
2021/05/12 12:27:24.210| 93,9| Launcher.cc(127) canRepeat: 0
2021/05/12 12:27:24.210| 93,3| Launcher.cc(95) noteXactAbort: cannot retry
or repeat a failed transaction
2021/05/12 12:27:24.210| 93,4| Answer.cc(20) Error: error: 0
2021/05/12 12:27:24.210| 93,5| AsyncCall.cc(26) AsyncCall: The AsyncCall
Initiator::noteAdaptationAnswer constructed, this=0x55a73f27e950
[call661703]
2021/05/12 12:27:24.210| 93,5| AsyncCall.cc(93) ScheduleCall:
Initiate.cc(83) will call Initiator::noteAdaptationAnswer(2) [call661703]
2021/05/12 12:27:24.210| 93,5| AsyncJob.cc(139) callEnd:
Launcher::noteXactAbort(0,0) ends job [ job31639]
2021/05/12 12:27:24.210| 93,5| Initiate.cc(64) swanSong: swan sings [
job31639]
2021/05/12 12:27:24.210| 93,5| Initiate.cc(71) swanSong: swan sang [
job31639]
2021/05/12 12:27:24.210| 93,5| AsyncJob.cc(40) ~AsyncJob: AsyncJob
destructed, this=0x55a73f3bc468 type=Adaptation::Icap::OptXactLauncher
[job31639]
2021/05/12 12:27:24.210| 93,6| AsyncJob.cc(149) callEnd:
Launcher::noteXactAbort(0,0) ended 0x55a73f3bc468
2021/05/12 12:27:24.210| 93,7| HttpRequest.cc(63) ~HttpRequest: destructed,
this=0x55a73f3c9580
2021/05/12 12:27:24.210| 93,5| AsyncCallQueue.cc(55) fireNext: entering
Initiator::noteAdaptationAnswer(2)
2021/05/12 12:27:24.210| 93,5| AsyncCall.cc(38) make: make call
Initiator::noteAdaptationAnswer [call661703]
2021/05/12 12:27:24.210| 93,5| AsyncJob.cc(123) callStart:
Adaptation::Icap::ServiceRep status in:[up,fetch]
2021/05/12 12:27:24.210| 93,3| ServiceRep.cc(554) noteAdaptationAnswer:
failed to fetch options [up]
2021/05/12 12:27:24.210| 93,8| ServiceRep.cc(468) changeOptions: changes
options from 0x55a73f3c9470 to 0 [up]
2021/05/12 12:27:24.210| optional ICAP service is down after an options
fetch failure: icap://skipper.proxy:14590/response [down,!opt]
2021/05/12 12:27:24.210| 93,3| ServiceRep.cc(591) handleNewOptions: got new
options and is now [down,!opt]
2021/05/12 12:27:24.210| 93,7| ServiceRep.cc(634) scheduleUpdate: raw
OPTIONS fetch at 1620822474 or in 30 sec
2021/05/12 12:27:24.210| 93,9| ServiceRep.cc(636) scheduleUpdate: last
fetched at 1620822444 or 0 sec ago
2021/05/12 12:27:24.210| 93,5| ServiceRep.cc(649) scheduleUpdate: will
fetch OPTIONS in 30 sec
2021/05/12 12:27:24.210| 93,7| ServiceRep.cc(456) scheduleNotification:
will notify 0 clients
2021/05/12 12:27:24.210| 93,5| AsyncCall.cc(26) AsyncCall: The AsyncCall
Adaptation::Icap::ServiceRep::noteTimeToNotify constructed,
this=0x55a73ef1ecb0 [call661704]
2021/05/12 12:27:24.210| 93,5| AsyncCall.cc(93) ScheduleCall:
ServiceRep.cc(457) will call
Adaptation::Icap::ServiceRep::noteTimeToNotify() [call661704]
2021/05/12 12:27:24.210| 93,5| AsyncJob.cc(154) callEnd:
Adaptation::Icap::ServiceRep status out:[down,!opt]
2021/05/12 12:27:24.210| 93,5| AsyncCallQueue.cc(57) fireNext: leaving
Initiator::noteAdaptationAnswer(2)
2021/05/12 12:27:24.210| 93,5| AsyncCallQueue.cc(55) fireNext: entering
Adaptation::Icap::ServiceRep::noteTimeToNotify()
2021/05/12 12:27:24.210| 93,5| AsyncCall.cc(38) make: make call
Adaptation::Icap::ServiceRep::noteTimeToNotify [call661704]
2021/05/12 12:27:24.210| 93,5| AsyncJob.cc(123) callStart:
Adaptation::Icap::ServiceRep status in:[down,!opt]
2021/05/12 12:27:24.210| 93,7| ServiceRep.cc(397) noteTimeToNotify:
notifies 0 clients [down,!opt,notif]
2021/05/12 12:27:24.210| 93,5| AsyncJob.cc(154) callEnd:
Adaptation::Icap::ServiceRep status out:[down,!opt]
2021/05/12 12:27:24.210| 93,5| AsyncCallQueue.cc(57) fireNext: leaving
Adaptation::Icap::ServiceRep::noteTimeToNotify()

Thanks,
Roie

On Mon, Apr 19, 2021 at 12:07 PM Eliezer Croitoru <ngtech1ltd at gmail.com>
wrote:

> Hey Roie,
>
>
>
> From the output I assume it?s a dns resolution issue.
>
> In the past I remember that Docker was updating the hosts file with the
> relevant names but  it?s not working the same way now.
>
> Currently Docker is using a local network dns service which is being
> accessed via 127.0.0.53.
>
> From I remember Squid is resolving the icap service name only at startup
> or reload.
>
> Lately Alex published a testable patch that might fix specific issues with
> icap services which are resolved by dns. ( sorry I don?t remember the bug
> report)
>
> I assume you can try to test this patch first.
>
> If these services are static to some degree you might be able to create a
> script that updates the hosts file and reload squid on each change.
>
> When using the hosts file it?s possible that some issues will disappear.
>
>
> There is also another possibility which is a malformed ICAP response or
> wrong sessions handling which cause this issue.
>
> You might be able to use tcpdump from either the host or the container
> side to capture traffic when these goes down.
>
> Depends on your preference of debug level you might even be able to debug
> specific debug_options like for ICAP services
> and/or requests to the degree you might be able to see what happens on the
> basic level of the ICAP encapsulation.
>
> If you really need help with a diagnosis and a solution you might be able
> to use Alex and the measurement factory.
>
> All The Bests,
>
> Eliezer
>
>
>
> *From:* squid-users <squid-users-bounces at lists.squid-cache.org> *On
> Behalf Of *roie rachamim
> *Sent:* Monday, April 12, 2021 12:54 PM
> *To:* squid-users at lists.squid-cache.org
> *Subject:* [squid-users] All Adaptation ICAPs go down at the same time
>
>
>
> Hi,
>
>
>
> Our setup includes squid that runs in docker container with several ICAP
> servers in additional containers.
>
> From time to time we see in cache.log the following messages:
> 2021/04/12 00:22:39| optional ICAP service is down after an options fetch
> failure: icap://icap1.proxy:14590/censor [down,!opt]
> 2021/04/12 00:22:39| optional ICAP service is down after an options fetch
> failure: icap://icap2.proxy:1344/request [down,!opt]
> 2021/04/12 00:22:39| optional ICAP service is down after an options fetch
> failure: icap://icap3.proxy:14590/response [down,!opt]
>
> 2021/04/12 06:10:45| optional ICAP service is down after an options fetch
> failure: icap://icap1.proxy:14590/censor [down,!opt]
> 2021/04/12 06:10:45| optional ICAP service is down after an options fetch
> failure: icap://icap2.proxy:1344/request [down,!opt]
> 2021/04/12 06:10:45| optional ICAP service is down after an options fetch
> failure: icap://icap3.proxy:14590/response [down,!opt]
>
>
>
> We're trying to understand why it happens to all ICAPs at once. This
> happens in 4.14 and in 5.0.4
>
> Any thoughts about what might cause this ?
>
> Many Thanks,
>
> Roie
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210520/d8c46e2e/attachment.htm>

From rousskov at measurement-factory.com  Wed May 19 21:53:28 2021
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Wed, 19 May 2021 17:53:28 -0400
Subject: [squid-users] All Adaptation ICAPs go down at the same time
In-Reply-To: <CAD=NrcD_gaS3cSuz426ktqhB2vfeyUH6Umwy6NQY0DUXuhBJTA@mail.gmail.com>
References: <CAD=NrcALoEGqctFUpuTZcfkpEbsS=KU4QqXG+LAVd-XtJvfnXg@mail.gmail.com>
 <000001d734fb$6081bd70$21853850$@gmail.com>
 <CAD=NrcD_gaS3cSuz426ktqhB2vfeyUH6Umwy6NQY0DUXuhBJTA@mail.gmail.com>
Message-ID: <da23b8c7-c680-fe01-ec8b-76882e881a7d@measurement-factory.com>

On 5/19/21 5:31 PM, roie rachamim wrote:

> 2021/05/12 12:27:24.209| 93,5| AsyncJob.cc(139) callEnd:
> AsyncJob::start() ends job [/ job31640]

To me, this looks like bug 4528:
https://bugs.squid-cache.org/show_bug.cgi?id=4528

That bug is being fixed in PR 795:
https://github.com/squid-cache/squid/pull/795

You might be able to patch your Squid using the corresponding patch:
https://github.com/squid-cache/squid/pull/795.diff

Testing feedback is very weclomed.


HTH,

Alex.


> On Mon, Apr 19, 2021 at 12:07 PM Eliezer Croitoru wrote:
> 
>     Hey Roie,____
> 
>     __?__
> 
>     From the output I assume it?s a dns resolution issue.____
> 
>     In the past I remember that Docker was updating the hosts file with
>     the relevant names but ?it?s not working the same way now.____
> 
>     Currently Docker is using a local network dns service which is being
>     accessed via 127.0.0.53.____
> 
>     From I remember Squid is resolving the icap service name only at
>     startup or reload.____
> 
>     Lately Alex published a testable patch that might fix specific
>     issues with icap services which are resolved by dns. ( sorry I don?t
>     remember the bug report)____
> 
>     I assume you can try to test this patch first.____
> 
>     If these services are static to some degree you might be able to
>     create a script that updates the hosts file and reload squid on each
>     change.____
> 
>     When using the hosts file it?s possible that some issues will
>     disappear.____
> 
> 
>     There is also another possibility which is a malformed ICAP response
>     or wrong sessions handling which cause this issue.____
> 
>     You might be able to use tcpdump from either the host or the
>     container side to capture traffic when these goes down.____
> 
>     Depends on your preference of debug level you might even be able to
>     debug specific debug_options like for ICAP services
>     and/or requests to the degree you might be able to see what happens
>     on the basic level of the ICAP encapsulation.____
> 
>     If you really need help with a diagnosis and a solution you might be
>     able to use Alex and the measurement factory.
> 
>     ____
> 
>     All The Bests,____
> 
>     Eliezer____
> 
>     __?__
> 
>     *From:* squid-users <squid-users-bounces at lists.squid-cache.org
>     <mailto:squid-users-bounces at lists.squid-cache.org>> *On Behalf Of
>     *roie rachamim
>     *Sent:* Monday, April 12, 2021 12:54 PM
>     *To:* squid-users at lists.squid-cache.org
>     <mailto:squid-users at lists.squid-cache.org>
>     *Subject:* [squid-users] All Adaptation ICAPs go down at the same
>     time____
> 
>     __?__
> 
>     Hi,____
> 
>     __?__
> 
>     Our setup includes squid that runs in docker container with several
>     ICAP servers in additional containers.____
> 
>     From time to time we see in cache.log the following messages:
>     2021/04/12 00:22:39| optional ICAP service is down after an options
>     fetch failure: icap://icap1.proxy:14590/censor [down,!opt]
>     2021/04/12 00:22:39| optional ICAP service is down after an options
>     fetch failure: icap://icap2.proxy:1344/request [down,!opt]
>     2021/04/12 00:22:39| optional ICAP service is down after an options
>     fetch failure: icap://icap3.proxy:14590/response [down,!opt]
> 
>     2021/04/12 06:10:45| optional ICAP service is down after an options
>     fetch failure: icap://icap1.proxy:14590/censor [down,!opt]
>     2021/04/12 06:10:45| optional ICAP service is down after an options
>     fetch failure: icap://icap2.proxy:1344/request [down,!opt]
>     2021/04/12 06:10:45| optional ICAP service is down after an options
>     fetch failure: icap://icap3.proxy:14590/response [down,!opt]____
> 
>     __?__
> 
>     We're trying to understand why it happens to all ICAPs at once. This
>     happens in 4.14 and in 5.0.4____
> 
>     Any thoughts about what might cause this ?____
> 
>     Many Thanks,____
> 
>     Roie____
> 
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 



From odhiambo at gmail.com  Wed May 19 22:12:33 2021
From: odhiambo at gmail.com (Odhiambo Washington)
Date: Thu, 20 May 2021 01:12:33 +0300
Subject: [squid-users] Squid for Windows 4.14 is available
In-Reply-To: <AM8PR04MB7745C0D160EE5A5729294A3E8F2D9@AM8PR04MB7745.eurprd04.prod.outlook.com>
References: <AM8PR04MB7745C0D160EE5A5729294A3E8F2D9@AM8PR04MB7745.eurprd04.prod.outlook.com>
Message-ID: <CAAdA2WPxvhoU20NQG=ZDi6JrG3bNtXMF_J85tGKzOouCgby7cg@mail.gmail.com>

On Mon, May 17, 2021 at 12:23 PM Rafael Akchurin <
rafael.akchurin at diladele.com> wrote:

> Hello everyone,
>
>
>
> After years of postponing we were finally able to build and pack the Squid
> 4 for Microsoft Windows.
>
> Sorry it took a lot more time and efforts than anticipated. The already
> existing version 4.15 is also being packed.
>
> I will update once again when it is available.
>
>
>
> The MSI can be downloaded from https://squid.diladele.com/ site.
>
>
>
> While you are there be sure to check out our other projects ? Web Safety
> ICAP web filter and Admin UI for Squid (https://www.diladele.com/) and
>
> DNS Safety filter (something like web safety but on DNS level -
> https://dnssafety.diladele.com/).
>
>
>
> Repo for development of Squid for Windows is available at
> https://github.com/diladele/squid-windows.
>
> Please post your question **for MSI problems only** at
> support at diladele.com ? and for Squid part here.
>
>
I installed this on my Windows 10, but gave up when I could not make it to
cache anything.
cache_dir aufs c:\Squid\cachedir 3000 16 256

I created this director, but squid -z would not hear of it!

The given example:

#cache_dir aufs /cygdrive/d/squid/cache 3000 16 256

.. is unix lingo, not Windows

What is the correct format of the above config on Windows?





-- 
Best regards,
Odhiambo WASHINGTON,
Nairobi,KE
+254 7 3200 0004/+254 7 2274 3223
"Oh, the cruft.", egrep -v "^$|^.*#" :-)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210520/a7aa3c4f/attachment.htm>

From agnrie at hotmail.com  Thu May 20 00:05:50 2021
From: agnrie at hotmail.com (Aniruddha Gore)
Date: Thu, 20 May 2021 00:05:50 +0000
Subject: [squid-users] Add header to HTTPS requests
Message-ID: <MW4PR15MB45241EDD9029271562C9C2EDD92B9@MW4PR15MB4524.namprd15.prod.outlook.com>

Hello folks, I am using Squid as a simple [forward] proxy and was wondering if it is feasible and advised to add custom headers to HTTPS requests?

I think I can achieve it using ssl_bump but I am still teaching myself about it. However, it seems to help more with examining HTTPS requests than modifying them.

I also came across a stern warning at https://wiki.squid-cache.org/Features/HTTPS and was wondering if what I want to do is even advised ?


Aniruddha Gore
Sent from Outlook.com<http://www.microsoft.com/en-us/outlook-com/compare/>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210520/a4d2df96/attachment.htm>

From gkinkie at gmail.com  Thu May 20 05:45:58 2021
From: gkinkie at gmail.com (Francesco Chemolli)
Date: Thu, 20 May 2021 07:45:58 +0200
Subject: [squid-users] Add header to HTTPS requests
In-Reply-To: <MW4PR15MB45241EDD9029271562C9C2EDD92B9@MW4PR15MB4524.namprd15.prod.outlook.com>
References: <MW4PR15MB45241EDD9029271562C9C2EDD92B9@MW4PR15MB4524.namprd15.prod.outlook.com>
Message-ID: <CA+Y8hcMpDgw5dcdAWqq1=qoC8w+2R2GwNiYqg09i9LicrYA8xg@mail.gmail.com>

On Thu, May 20, 2021 at 2:05 AM Aniruddha Gore <agnrie at hotmail.com> wrote:

> Hello folks, I am using Squid as a simple [forward] proxy and was
> wondering if it is feasible and advised to add custom headers to HTTPS
> requests?
>

Hi Ainiruddha,
  feasible, yes. Advised, maybe.


> I think I can achieve it using ssl_bump but I am still teaching myself
> about it. However, it seems to help more with examining HTTPS requests than
> modifying them.
>

That's actually the only way to do it. The whole point of https is to
prevent intermediaries (such as squid) from seeing the contents of the
requests and meddle with them. sslbump breaks that assumption


>
> I also came across a stern warning at
> https://wiki.squid-cache.org/Features/HTTPS and was wondering if what I
> want to do is even advised ?
>

It really depends on your context and objectives. For sure it can be pretty
informative, if your objective is to learn how http works to the wire.

-- 
    Francesco
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210520/7c93dbd0/attachment.htm>

From agnrie at hotmail.com  Thu May 20 05:52:05 2021
From: agnrie at hotmail.com (Aniruddha Gore)
Date: Thu, 20 May 2021 05:52:05 +0000
Subject: [squid-users] Add header to HTTPS requests
In-Reply-To: <CA+Y8hcMpDgw5dcdAWqq1=qoC8w+2R2GwNiYqg09i9LicrYA8xg@mail.gmail.com>
References: <MW4PR15MB45241EDD9029271562C9C2EDD92B9@MW4PR15MB4524.namprd15.prod.outlook.com>,
 <CA+Y8hcMpDgw5dcdAWqq1=qoC8w+2R2GwNiYqg09i9LicrYA8xg@mail.gmail.com>
Message-ID: <MW4PR15MB452469B105ED0DCF956026D1D92A9@MW4PR15MB4524.namprd15.prod.outlook.com>

Thanks Franchesco. If there are any samples that you know of I would sincerely appreciate. ?

Get Outlook for iOS<https://aka.ms/o0ukef>
________________________________
From: Francesco Chemolli <gkinkie at gmail.com>
Sent: Wednesday, May 19, 2021 10:46 PM
To: Aniruddha Gore
Cc: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Add header to HTTPS requests



On Thu, May 20, 2021 at 2:05 AM Aniruddha Gore <agnrie at hotmail.com<mailto:agnrie at hotmail.com>> wrote:
Hello folks, I am using Squid as a simple [forward] proxy and was wondering if it is feasible and advised to add custom headers to HTTPS requests?

Hi Ainiruddha,
  feasible, yes. Advised, maybe.

I think I can achieve it using ssl_bump but I am still teaching myself about it. However, it seems to help more with examining HTTPS requests than modifying them.

That's actually the only way to do it. The whole point of https is to prevent intermediaries (such as squid) from seeing the contents of the requests and meddle with them. sslbump breaks that assumption


I also came across a stern warning at https://wiki.squid-cache.org/Features/HTTPS<https://na01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwiki.squid-cache.org%2FFeatures%2FHTTPS&data=04%7C01%7C%7C6137554eece347cf64d008d91b529264%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C637570863715009526%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C1000&sdata=1RWirW4tVR83LpuwuMql5jnN61lUOF7DHci%2B6qZjvB0%3D&reserved=0> and was wondering if what I want to do is even advised ?

It really depends on your context and objectives. For sure it can be pretty informative, if your objective is to learn how http works to the wire.

--
    Francesco
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210520/e1a1c73f/attachment.htm>

From squid.org at bloms.de  Thu May 20 12:12:14 2021
From: squid.org at bloms.de (Dieter Bloms)
Date: Thu, 20 May 2021 14:12:14 +0200
Subject: [squid-users] SSL_Bump not working correctly for IP destiantions
 like https:/1.1.1.1/
Message-ID: <20210520121214.hxolut2emt2qmsf5@bloms.de>

Hello,

I've a working setup with squid 4.14 and enabled sslbump under debian buster.
But when I try destinations like https://1.1.1.1/ I get an error ERR_CERT_COMMON_NAME_INVALID

The alternate DNS Names in the certificate of the original webserver is:

X509v3 Subject Alternative Name: 
    DNS:cloudflare-dns.com, DNS:*.cloudflare-dns.com, DNS:one.one.one.one, IP Address:1.1.1.1, IP Address:1.0.0.1, IP Address:162.159.36.1, IP Address:162.159.46.1, IP Address:2606:4700:4700:0:0:0:0:1111, IP Address:2606:4700:4700:0:0:0:0:1001, IP Address:2606:4700:4700:0:0:0:0:64, IP Address:2606:4700:4700:0:0:0:0:6400

for the client using the proxy with sslbump it looks like:

X509v3 Subject Alternative Name: 
    DNS:1.1.1.1

so the SAN is a DNS and not an IP Address one.
I think is has to be something like this:

X509v3 Subject Alternative Name: 
    IP Address:1.1.1.1

Can someone confirm this, or may I have a mistake in my squid configuration.

Here some sslbum related details of my config:

http_port MYIP:8080 ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=32MB cert=/etc/squid/cert.pem key=/etc/squid/key.pem tls-dh=/etc/squid/dhparams.pem
http_port MYIP:8880 ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=32MB cert=/etc/squid/cert.pem key=/etc/squid/key.pem tls-dh=/etc/squid/dhparams.pem
sslcrtd_program /usr/sbin/security_file_certgen -s /var/cache/squid/sslcert_db -M 32MB
sslcrtd_children 32 startup=10 idle=3
tls_outgoing_options capath=/etc/ssl/certs min-version=1.2
ssl_bump peek step1
ssl_bump stare all
ssl_bump bump all


-- 
Regards

  Dieter

--
I do not get viruses because I do not use MS software.
If you use Outlook then please do not put my email address in your
address-book so that WHEN you get a virus it won't use my address in the
>From field.


From rousskov at measurement-factory.com  Thu May 20 13:21:47 2021
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Thu, 20 May 2021 09:21:47 -0400
Subject: [squid-users] SSL_Bump not working correctly for IP
 destiantions like https:/1.1.1.1/
In-Reply-To: <20210520121214.hxolut2emt2qmsf5@bloms.de>
References: <20210520121214.hxolut2emt2qmsf5@bloms.de>
Message-ID: <466709cc-934d-2334-2d8f-a377dec67de8@measurement-factory.com>

On 5/20/21 8:12 AM, Dieter Bloms wrote:

> I've a working setup with squid 4.14 and enabled sslbump under debian buster.
> But when I try destinations like https://1.1.1.1/ I get an error ERR_CERT_COMMON_NAME_INVALID
> 
> The alternate DNS Names in the certificate of the original webserver is:
> 
> X509v3 Subject Alternative Name: 
>     DNS:cloudflare-dns.com, DNS:*.cloudflare-dns.com, DNS:one.one.one.one, IP Address:1.1.1.1, IP Address:1.0.0.1, IP Address:162.159.36.1, IP Address:162.159.46.1, IP Address:2606:4700:4700:0:0:0:0:1111, IP Address:2606:4700:4700:0:0:0:0:1001, IP Address:2606:4700:4700:0:0:0:0:64, IP Address:2606:4700:4700:0:0:0:0:6400
> 
> for the client using the proxy with sslbump it looks like:
> 
> X509v3 Subject Alternative Name: 
>     DNS:1.1.1.1
> 
> so the SAN is a DNS and not an IP Address one.
> I think is has to be something like this:
> 
> X509v3 Subject Alternative Name: 
>     IP Address:1.1.1.1
> 
> Can someone confirm this, or may I have a mistake in my squid configuration.

If this happens on an otherwise successful HTTP response (not an error
page), then I would suspect a Squid bug (or insufficient support for
X509v3 extensions).

Alex.


> Here some sslbum related details of my config:
> 
> http_port MYIP:8080 ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=32MB cert=/etc/squid/cert.pem key=/etc/squid/key.pem tls-dh=/etc/squid/dhparams.pem
> http_port MYIP:8880 ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=32MB cert=/etc/squid/cert.pem key=/etc/squid/key.pem tls-dh=/etc/squid/dhparams.pem
> sslcrtd_program /usr/sbin/security_file_certgen -s /var/cache/squid/sslcert_db -M 32MB
> sslcrtd_children 32 startup=10 idle=3
> tls_outgoing_options capath=/etc/ssl/certs min-version=1.2
> ssl_bump peek step1
> ssl_bump stare all
> ssl_bump bump all
> 
> 



From squid.org at bloms.de  Thu May 20 15:23:49 2021
From: squid.org at bloms.de (Dieter Bloms)
Date: Thu, 20 May 2021 17:23:49 +0200
Subject: [squid-users] SSL_Bump not working correctly for IP
 destiantions like https:/1.1.1.1/
In-Reply-To: <466709cc-934d-2334-2d8f-a377dec67de8@measurement-factory.com>
References: <20210520121214.hxolut2emt2qmsf5@bloms.de>
 <466709cc-934d-2334-2d8f-a377dec67de8@measurement-factory.com>
Message-ID: <20210520152349.w6xrupuyjwdsxvyz@bloms.de>

Hello Alex,

thank yout for the fast response.

On Thu, May 20, Alex Rousskov wrote:

> On 5/20/21 8:12 AM, Dieter Bloms wrote:
> 
> > I've a working setup with squid 4.14 and enabled sslbump under debian buster.
> > But when I try destinations like https://1.1.1.1/ I get an error ERR_CERT_COMMON_NAME_INVALID
> > 
> > The alternate DNS Names in the certificate of the original webserver is:
> > 
> > X509v3 Subject Alternative Name: 
> >     DNS:cloudflare-dns.com, DNS:*.cloudflare-dns.com, DNS:one.one.one.one, IP Address:1.1.1.1, IP Address:1.0.0.1, IP Address:162.159.36.1, IP Address:162.159.46.1, IP Address:2606:4700:4700:0:0:0:0:1111, IP Address:2606:4700:4700:0:0:0:0:1001, IP Address:2606:4700:4700:0:0:0:0:64, IP Address:2606:4700:4700:0:0:0:0:6400
> > 
> > for the client using the proxy with sslbump it looks like:
> > 
> > X509v3 Subject Alternative Name: 
> >     DNS:1.1.1.1
> > 
> > so the SAN is a DNS and not an IP Address one.
> > I think is has to be something like this:
> > 
> > X509v3 Subject Alternative Name: 
> >     IP Address:1.1.1.1
> > 
> > Can someone confirm this, or may I have a mistake in my squid configuration.
> 
> If this happens on an otherwise successful HTTP response (not an error
> page), then I would suspect a Squid bug (or insufficient support for
> X509v3 extensions).

The chrome browser shows me this error page, but you are right it is an
error page of squid with SQUID_X509_V_ERR_DOMAIN_MISMATCH.
So it looks like insufficient support for X509v3 extensions
I filled a bug report https://bugs.squid-cache.org/show_bug.cgi?id=5130

> > Here some sslbum related details of my config:
> > 
> > http_port MYIP:8080 ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=32MB cert=/etc/squid/cert.pem key=/etc/squid/key.pem tls-dh=/etc/squid/dhparams.pem
> > http_port MYIP:8880 ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=32MB cert=/etc/squid/cert.pem key=/etc/squid/key.pem tls-dh=/etc/squid/dhparams.pem
> > sslcrtd_program /usr/sbin/security_file_certgen -s /var/cache/squid/sslcert_db -M 32MB
> > sslcrtd_children 32 startup=10 idle=3
> > tls_outgoing_options capath=/etc/ssl/certs min-version=1.2
> > ssl_bump peek step1
> > ssl_bump stare all
> > ssl_bump bump all
> > 
> > 
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-- 
Gru?

  Dieter

--
I do not get viruses because I do not use MS software.
If you use Outlook then please do not put my email address in your
address-book so that WHEN you get a virus it won't use my address in the
From field.


From robertkwild at gmail.com  Thu May 20 17:05:52 2021
From: robertkwild at gmail.com (robert k Wild)
Date: Thu, 20 May 2021 18:05:52 +0100
Subject: [squid-users] squid self signed cert error on some websites
In-Reply-To: <CAGU_CiJEWq5buAeN=vyU5zgPPkgATFzqNQDR=N=CpqSgsaVOYQ@mail.gmail.com>
References: <CAGU_CiJPBE7b+RRue6bavj9W-rzCrYd2=uewPRDd4z0sim7GQA@mail.gmail.com>
 <CAGU_CiLTwe2OqJOnMrRugBNfiivsHnxyZ0-Gk6-5H-dq5JSJjw@mail.gmail.com>
 <c0f88993-b7da-521d-ee29-f052f6272454@measurement-factory.com>
 <CAGU_CiLWx_VJ57YLHVtxUbrVZ3ZAw1ncdO608_Ej-EgRdsvgkA@mail.gmail.com>
 <72fbb60c-9b1c-7ce7-ef21-00355defd139@measurement-factory.com>
 <CAGU_CiLpvgAVxCzJyFSRKgnquiMOC90STMZeo0V5QGqnrQyQEw@mail.gmail.com>
 <3da64e45-713c-f2cd-9b58-8d948dd7d60b@measurement-factory.com>
 <CAGU_CiJR1GScqaM2i-YabXEuBtha7c0PiHZjvadxAfbDoVFLcw@mail.gmail.com>
 <CAGU_CiJEWq5buAeN=vyU5zgPPkgATFzqNQDR=N=CpqSgsaVOYQ@mail.gmail.com>
Message-ID: <CAGU_Ci+LcrtQxSopQUhAuubz-6vY+fN2bGJ881JhaFKyZzMacA@mail.gmail.com>

ok, bit wierd but its sorted itself out after a reboot?!?!

so now even when i dont whitelist the websites, when i go on them, instead
of getting the cert error message, i get now the normal error message,
saying access denied by your admin

On Wed, 19 May 2021 at 21:52, robert k Wild <robertkwild at gmail.com> wrote:

> I'm following this guide
>
> https://wiki.squid-cache.org/ConfigExamples/Intercept/SslBumpExplicit
>
> The section
>
> Alternative trust roots
>
> I don't have a dir called
>
> Usr local openssl
>
> Do I have to download the the ca bundle file somewhere?
>
>
>
> On Wed, 19 May 2021, 21:34 robert k Wild, <robertkwild at gmail.com> wrote:
>
>> Thanks Alex, I will do this tomorrow and let you know
>>
>> Thank you, have a great day
>>
>> On Wed, 19 May 2021, 21:25 Alex Rousskov, <
>> rousskov at measurement-factory.com> wrote:
>>
>>> On 5/19/21 4:20 PM, robert k Wild wrote:
>>>
>>> > When I don't add the website to the white list I can't view the cert
>>>
>>> What prevents you from viewing the certificate? Can you click on the
>>> site information icon to the left of the browser Location(?) bar when
>>> the error is displayed? If not, perhaps you can use FireFox built-in
>>> "Web Developer Tools" (Ctrl-Shift-I on my machine) to get to the
>>> certificate? I am not a browser expert, but there is usually a way to
>>> see the certificate if the browser received it.
>>>
>>> If nothing works, can you try reproducing using curl or wget instead of
>>> a browser?
>>>
>>>
>>> > Or are you talking about turn the proxy off on Firefox and access the
>>> > website normally?
>>>
>>> That would give you the third certificate to compare.
>>>
>>> Alex.
>>>
>>>
>>> > On Wed, 19 May 2021, 21:05 Alex Rousskov,
>>> > <rousskov at measurement-factory.com
>>> > <mailto:rousskov at measurement-factory.com>> wrote:
>>> >
>>> >     On 5/19/21 3:44 PM, robert k Wild wrote:
>>> >
>>> >     > when i dont add it to the white list i cant view the website
>>> >     (obviously)
>>> >     > but can see the cert is provided by my squid (default company
>>> ltd)...i
>>> >     > was lazy creating it but cant view the cert
>>> >     >
>>> >     > when i add it to the white list, i can view the website and the
>>> cert
>>> >     > info and its def from my squid cert (default company ltd) as i
>>> see the
>>> >     > valid dates ie before and after
>>> >
>>> >     The difference between those two certificates, if any, may be able
>>> to
>>> >     explain the difference in browser behavior. It would also be
>>> useful to
>>> >     compare those fake certificates with the real one.
>>> >
>>> >
>>> >     > i think i need to relax the ciphers in my squid.conf as some
>>> other
>>> >     https
>>> >     > websites i get the error page and i dont get the cert error
>>> message
>>> >     >
>>> >     > do you think relaxing the ciphers will work?
>>> >
>>> >     Sorry, I do not know. Obviously, you can trivially check this
>>> theory.
>>> >
>>> >     Alex.
>>> >
>>> >
>>> >     > On Wed, 19 May 2021, 19:12 Alex Rousskov wrote:
>>> >     >
>>> >     >     On 5/19/21 10:41 AM, robert k Wild wrote:
>>> >     >     > ok i found out what the error is
>>> >     >     >
>>> >     >     > its because in my squid.conf, i have a whitelist file
>>> >     >     >
>>> >     >     > #HTTP_HTTPS whitelist websites
>>> >     >     > acl whitelist ssl::server_name
>>> >     "/usr/local/squid/etc/urlwhite.txt"
>>> >     >     > http_access allow activation whitelist
>>> >     >     > http_access deny all
>>> >     >     >
>>> >     >     > once i added the url to that file, it worked
>>> >     >     >
>>> >     >     > but surely, instead of giving me an error saying
>>> >     >     >
>>> >     >     > secure connection failed
>>> >     >     > Error code: SEC_ERROR_BAD_SIGNATURE
>>> >     >     >
>>> >     >     > it should be the default error ie
>>> >     >     >
>>> >     >     > The following error was encountered while trying to
>>> retrieve
>>> >     the URL:
>>> >     >     > https://blah.blah <https://blah.blah> <https://blah.blah
>>> >     <https://blah.blah>> <https://blah.blah <https://blah.blah>
>>> >     >     <https://blah.blah <https://blah.blah>>>
>>> >     >     >
>>> >     >     >     Access Denied.
>>> >     >     >
>>> >     >     > how can i change this please
>>> >     >
>>> >     >     The answer depends on _why_ you get that
>>> >     SEC_ERROR_BAD_SIGNATURE error.
>>> >     >
>>> >     >     If Squid does not have enough information to properly bump
>>> >     your client
>>> >     >     connection, then there may be no bumping-based solution at
>>> all
>>> >     (e.g.
>>> >     >     when the client is using certificate pinning), or you would
>>> >     have to bump
>>> >     >     at step2 when more information is available to Squid (to
>>> >     generate a
>>> >     >     better fake certificate).
>>> >     >
>>> >     >     For the next step, try comparing the fake certificate that
>>> causes
>>> >     >     SEC_ERROR_BAD_SIGNATURE with the fake same-site certificate
>>> >     that works
>>> >     >     after you whitelist the problematic site. The browser should
>>> >     allow you
>>> >     >     to view both certificates. You can download them and use
>>> >     certificate
>>> >     >     printing tools like "openssl x509 -noout -text -in ..." to
>>> >     compare two
>>> >     >     certificate printouts.
>>> >     >
>>> >     >     HTH,
>>> >     >
>>> >     >     Alex.
>>> >     >
>>> >     >
>>> >     >     > On Wed, 19 May 2021 at 13:54, robert k Wild wrote:
>>> >     >     >
>>> >     >     >     hi all,
>>> >     >     >
>>> >     >     >     i have squid 4.15
>>> >     >     >
>>> >     >     >     i have imported my self signed cert on firefox and now
>>> i can
>>> >     >     access
>>> >     >     >     https website (where as before i got a software is
>>> >     preventing this
>>> >     >     >     website from opening)
>>> >     >     >
>>> >     >     >     but on some websites i get an error saying
>>> >     >     >
>>> >     >     >     secure connection failed
>>> >     >     >     Error code: SEC_ERROR_BAD_SIGNATURE
>>> >     >     >
>>> >     >     >     i attach my ssl bump conf in my squid.conf file
>>> >     >     >
>>> >     >     >     #SSL Bump
>>> >     >     >     http_port 3128 ssl-bump
>>> >     >     cert=/usr/local/squid/etc/ssl_cert/myCA.pem
>>> >     >     >     generate-host-certificates=on
>>> >     dynamic_cert_mem_cache_size=4MB
>>> >     >     >
>>> >     >
>>> >
>>>    cipher=HIGH:MEDIUM:RC4:3DES:!aNULL:!eNULL:!LOW:!MD5:!EXP:!PSK:!SRP:!DSS
>>> >     >     >     sslcrtd_program
>>> >     /usr/local/squid/libexec/security_file_certgen -s
>>> >     >     >     /var/lib/ssl_db -M 4MB
>>> >     >     >     acl step1 at_step SslBump1
>>> >     >     >     ssl_bump peek step1
>>> >     >     >     ssl_bump bump all
>>> >     >     >
>>> >     >     >     is there anything wrong you can see, i have tried to
>>> >     make a new CA
>>> >     >     >     but error still occures
>>> >     >     >
>>> >     >     >     thanks,
>>> >     >     >     rob
>>> >     >     >
>>> >     >     >     --
>>> >     >     >     Regards,
>>> >     >     >
>>> >     >     >     Robert K Wild.
>>> >     >     >
>>> >     >     >
>>> >     >     >
>>> >     >     > --
>>> >     >     > Regards,
>>> >     >     >
>>> >     >     > Robert K Wild.
>>> >     >     >
>>> >     >     > _______________________________________________
>>> >     >     > squid-users mailing list
>>> >     >     > squid-users at lists.squid-cache.org
>>> >     <mailto:squid-users at lists.squid-cache.org>
>>> >     >     <mailto:squid-users at lists.squid-cache.org
>>> >     <mailto:squid-users at lists.squid-cache.org>>
>>> >     >     > http://lists.squid-cache.org/listinfo/squid-users
>>> >     <http://lists.squid-cache.org/listinfo/squid-users>
>>> >     >     <http://lists.squid-cache.org/listinfo/squid-users
>>> >     <http://lists.squid-cache.org/listinfo/squid-users>>
>>> >     >     >
>>> >     >
>>> >     >     _______________________________________________
>>> >     >     squid-users mailing list
>>> >     >     squid-users at lists.squid-cache.org
>>> >     <mailto:squid-users at lists.squid-cache.org>
>>> >     >     <mailto:squid-users at lists.squid-cache.org
>>> >     <mailto:squid-users at lists.squid-cache.org>>
>>> >     >     http://lists.squid-cache.org/listinfo/squid-users
>>> >     <http://lists.squid-cache.org/listinfo/squid-users>
>>> >     >     <http://lists.squid-cache.org/listinfo/squid-users
>>> >     <http://lists.squid-cache.org/listinfo/squid-users>>
>>> >     >
>>> >
>>>
>>>

-- 
Regards,

Robert K Wild.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210520/6a8cb5f0/attachment.htm>

From odhiambo at gmail.com  Fri May 21 14:06:01 2021
From: odhiambo at gmail.com (Odhiambo Washington)
Date: Fri, 21 May 2021 17:06:01 +0300
Subject: [squid-users] Caching configuration for Squid on Windows
Message-ID: <CAAdA2WNAPL4ABxdzhd4BVyAPWoEQ49Q0WP_DYh76qNCr76E8ug@mail.gmail.com>

Hello everyone,

I installed this on my Windows 10 but gave up when I could not make it to
cache anything.

What is the correct format of the above config on Windows?

cache_dir aufs c:\Squid\cachedir 3000 16 256

I created this director, but squid -z would not hear of it!

The given example:

#cache_dir aufs /cygdrive/d/squid/cache 3000 16 256

.. is unix lingo, not Windows and also does not work.

Or is Squid on Windows not supposed to cache?

Or I am just stupid :-)


-- 
Best regards,
Odhiambo WASHINGTON,
Nairobi,KE
+254 7 3200 0004/+254 7 2274 3223
"Oh, the cruft.", egrep -v "^$|^.*#" :-)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210521/ec78950c/attachment.htm>

From roierachamim at gmail.com  Sun May 23 06:05:43 2021
From: roierachamim at gmail.com (roie rachamim)
Date: Sun, 23 May 2021 09:05:43 +0300
Subject: [squid-users] All Adaptation ICAPs go down at the same time
In-Reply-To: <da23b8c7-c680-fe01-ec8b-76882e881a7d@measurement-factory.com>
References: <CAD=NrcALoEGqctFUpuTZcfkpEbsS=KU4QqXG+LAVd-XtJvfnXg@mail.gmail.com>
 <000001d734fb$6081bd70$21853850$@gmail.com>
 <CAD=NrcD_gaS3cSuz426ktqhB2vfeyUH6Umwy6NQY0DUXuhBJTA@mail.gmail.com>
 <da23b8c7-c680-fe01-ec8b-76882e881a7d@measurement-factory.com>
Message-ID: <CAD=NrcBh=+8_qzEkUy+X7r_+pmH2CDcbEhx1_oZWer39et0Tqw@mail.gmail.com>

Hi Alex,

Patch seems to do the trick,
When is it expected to be merged ?

Thanks,
Roie

On Thu, May 20, 2021 at 12:53 AM Alex Rousskov <
rousskov at measurement-factory.com> wrote:

> On 5/19/21 5:31 PM, roie rachamim wrote:
>
> > 2021/05/12 12:27:24.209| 93,5| AsyncJob.cc(139) callEnd:
> > AsyncJob::start() ends job [/ job31640]
>
> To me, this looks like bug 4528:
> https://bugs.squid-cache.org/show_bug.cgi?id=4528
>
> That bug is being fixed in PR 795:
> https://github.com/squid-cache/squid/pull/795
>
> You might be able to patch your Squid using the corresponding patch:
> https://github.com/squid-cache/squid/pull/795.diff
>
> Testing feedback is very weclomed.
>
>
> HTH,
>
> Alex.
>
>
> > On Mon, Apr 19, 2021 at 12:07 PM Eliezer Croitoru wrote:
> >
> >     Hey Roie,____
> >
> >     __ __
> >
> >     From the output I assume it?s a dns resolution issue.____
> >
> >     In the past I remember that Docker was updating the hosts file with
> >     the relevant names but  it?s not working the same way now.____
> >
> >     Currently Docker is using a local network dns service which is being
> >     accessed via 127.0.0.53.____
> >
> >     From I remember Squid is resolving the icap service name only at
> >     startup or reload.____
> >
> >     Lately Alex published a testable patch that might fix specific
> >     issues with icap services which are resolved by dns. ( sorry I don?t
> >     remember the bug report)____
> >
> >     I assume you can try to test this patch first.____
> >
> >     If these services are static to some degree you might be able to
> >     create a script that updates the hosts file and reload squid on each
> >     change.____
> >
> >     When using the hosts file it?s possible that some issues will
> >     disappear.____
> >
> >
> >     There is also another possibility which is a malformed ICAP response
> >     or wrong sessions handling which cause this issue.____
> >
> >     You might be able to use tcpdump from either the host or the
> >     container side to capture traffic when these goes down.____
> >
> >     Depends on your preference of debug level you might even be able to
> >     debug specific debug_options like for ICAP services
> >     and/or requests to the degree you might be able to see what happens
> >     on the basic level of the ICAP encapsulation.____
> >
> >     If you really need help with a diagnosis and a solution you might be
> >     able to use Alex and the measurement factory.
> >
> >     ____
> >
> >     All The Bests,____
> >
> >     Eliezer____
> >
> >     __ __
> >
> >     *From:* squid-users <squid-users-bounces at lists.squid-cache.org
> >     <mailto:squid-users-bounces at lists.squid-cache.org>> *On Behalf Of
> >     *roie rachamim
> >     *Sent:* Monday, April 12, 2021 12:54 PM
> >     *To:* squid-users at lists.squid-cache.org
> >     <mailto:squid-users at lists.squid-cache.org>
> >     *Subject:* [squid-users] All Adaptation ICAPs go down at the same
> >     time____
> >
> >     __ __
> >
> >     Hi,____
> >
> >     __ __
> >
> >     Our setup includes squid that runs in docker container with several
> >     ICAP servers in additional containers.____
> >
> >     From time to time we see in cache.log the following messages:
> >     2021/04/12 00:22:39| optional ICAP service is down after an options
> >     fetch failure: icap://icap1.proxy:14590/censor [down,!opt]
> >     2021/04/12 00:22:39| optional ICAP service is down after an options
> >     fetch failure: icap://icap2.proxy:1344/request [down,!opt]
> >     2021/04/12 00:22:39| optional ICAP service is down after an options
> >     fetch failure: icap://icap3.proxy:14590/response [down,!opt]
> >
> >     2021/04/12 06:10:45| optional ICAP service is down after an options
> >     fetch failure: icap://icap1.proxy:14590/censor [down,!opt]
> >     2021/04/12 06:10:45| optional ICAP service is down after an options
> >     fetch failure: icap://icap2.proxy:1344/request [down,!opt]
> >     2021/04/12 06:10:45| optional ICAP service is down after an options
> >     fetch failure: icap://icap3.proxy:14590/response [down,!opt]____
> >
> >     __ __
> >
> >     We're trying to understand why it happens to all ICAPs at once. This
> >     happens in 4.14 and in 5.0.4____
> >
> >     Any thoughts about what might cause this ?____
> >
> >     Many Thanks,____
> >
> >     Roie____
> >
> >
> > _______________________________________________
> > squid-users mailing list
> > squid-users at lists.squid-cache.org
> > http://lists.squid-cache.org/listinfo/squid-users
> >
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210523/907b8549/attachment.htm>

From rousskov at measurement-factory.com  Sun May 23 14:09:58 2021
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Sun, 23 May 2021 10:09:58 -0400
Subject: [squid-users] All Adaptation ICAPs go down at the same time
In-Reply-To: <CAD=NrcBh=+8_qzEkUy+X7r_+pmH2CDcbEhx1_oZWer39et0Tqw@mail.gmail.com>
References: <CAD=NrcALoEGqctFUpuTZcfkpEbsS=KU4QqXG+LAVd-XtJvfnXg@mail.gmail.com>
 <000001d734fb$6081bd70$21853850$@gmail.com>
 <CAD=NrcD_gaS3cSuz426ktqhB2vfeyUH6Umwy6NQY0DUXuhBJTA@mail.gmail.com>
 <da23b8c7-c680-fe01-ec8b-76882e881a7d@measurement-factory.com>
 <CAD=NrcBh=+8_qzEkUy+X7r_+pmH2CDcbEhx1_oZWer39et0Tqw@mail.gmail.com>
Message-ID: <afb66752-9768-47ff-fd81-9bc3ad96a262@measurement-factory.com>

On 5/23/21 2:05 AM, roie rachamim wrote:

> Patch seems to do the trick,
> When is it expected to be merged ?

It will be merged into master/v6 in a few hours AFAICT. You can track
status using the PR 795 link.

Alex.


> On Thu, May 20, 2021 at 12:53 AM Alex Rousskov wrote:
> 
>     On 5/19/21 5:31 PM, roie rachamim wrote:
> 
>     > 2021/05/12 12:27:24.209| 93,5| AsyncJob.cc(139) callEnd:
>     > AsyncJob::start() ends job [/ job31640]
> 
>     To me, this looks like bug 4528:
>     https://bugs.squid-cache.org/show_bug.cgi?id=4528
>     <https://bugs.squid-cache.org/show_bug.cgi?id=4528>
> 
>     That bug is being fixed in PR 795:
>     https://github.com/squid-cache/squid/pull/795
>     <https://github.com/squid-cache/squid/pull/795>
> 
>     You might be able to patch your Squid using the corresponding patch:
>     https://github.com/squid-cache/squid/pull/795.diff
>     <https://github.com/squid-cache/squid/pull/795.diff>
> 
>     Testing feedback is very weclomed.
> 
> 
>     HTH,
> 
>     Alex.
> 
> 
>     > On Mon, Apr 19, 2021 at 12:07 PM Eliezer Croitoru wrote:
>     >
>     >? ? ?Hey Roie,____
>     >
>     >? ? ?__?__
>     >
>     >? ? ?From the output I assume it?s a dns resolution issue.____
>     >
>     >? ? ?In the past I remember that Docker was updating the hosts file
>     with
>     >? ? ?the relevant names but ?it?s not working the same way now.____
>     >
>     >? ? ?Currently Docker is using a local network dns service which is
>     being
>     >? ? ?accessed via 127.0.0.53.____
>     >
>     >? ? ?From I remember Squid is resolving the icap service name only at
>     >? ? ?startup or reload.____
>     >
>     >? ? ?Lately Alex published a testable patch that might fix specific
>     >? ? ?issues with icap services which are resolved by dns. ( sorry I
>     don?t
>     >? ? ?remember the bug report)____
>     >
>     >? ? ?I assume you can try to test this patch first.____
>     >
>     >? ? ?If these services are static to some degree you might be able to
>     >? ? ?create a script that updates the hosts file and reload squid
>     on each
>     >? ? ?change.____
>     >
>     >? ? ?When using the hosts file it?s possible that some issues will
>     >? ? ?disappear.____
>     >
>     >
>     >? ? ?There is also another possibility which is a malformed ICAP
>     response
>     >? ? ?or wrong sessions handling which cause this issue.____
>     >
>     >? ? ?You might be able to use tcpdump from either the host or the
>     >? ? ?container side to capture traffic when these goes down.____
>     >
>     >? ? ?Depends on your preference of debug level you might even be
>     able to
>     >? ? ?debug specific debug_options like for ICAP services
>     >? ? ?and/or requests to the degree you might be able to see what
>     happens
>     >? ? ?on the basic level of the ICAP encapsulation.____
>     >
>     >? ? ?If you really need help with a diagnosis and a solution you
>     might be
>     >? ? ?able to use Alex and the measurement factory.
>     >
>     >? ? ?____
>     >
>     >? ? ?All The Bests,____
>     >
>     >? ? ?Eliezer____
>     >
>     >? ? ?__?__
>     >
>     >? ? ?*From:* squid-users <squid-users-bounces at lists.squid-cache.org
>     <mailto:squid-users-bounces at lists.squid-cache.org>
>     >? ? ?<mailto:squid-users-bounces at lists.squid-cache.org
>     <mailto:squid-users-bounces at lists.squid-cache.org>>> *On Behalf Of
>     >? ? ?*roie rachamim
>     >? ? ?*Sent:* Monday, April 12, 2021 12:54 PM
>     >? ? ?*To:* squid-users at lists.squid-cache.org
>     <mailto:squid-users at lists.squid-cache.org>
>     >? ? ?<mailto:squid-users at lists.squid-cache.org
>     <mailto:squid-users at lists.squid-cache.org>>
>     >? ? ?*Subject:* [squid-users] All Adaptation ICAPs go down at the same
>     >? ? ?time____
>     >
>     >? ? ?__?__
>     >
>     >? ? ?Hi,____
>     >
>     >? ? ?__?__
>     >
>     >? ? ?Our setup includes squid that runs in docker container with
>     several
>     >? ? ?ICAP servers in additional containers.____
>     >
>     >? ? ?From time to time we see in cache.log the following messages:
>     >? ? ?2021/04/12 00:22:39| optional ICAP service is down after an
>     options
>     >? ? ?fetch failure: icap://icap1.proxy:14590/censor [down,!opt]
>     >? ? ?2021/04/12 00:22:39| optional ICAP service is down after an
>     options
>     >? ? ?fetch failure: icap://icap2.proxy:1344/request [down,!opt]
>     >? ? ?2021/04/12 00:22:39| optional ICAP service is down after an
>     options
>     >? ? ?fetch failure: icap://icap3.proxy:14590/response [down,!opt]
>     >
>     >? ? ?2021/04/12 06:10:45| optional ICAP service is down after an
>     options
>     >? ? ?fetch failure: icap://icap1.proxy:14590/censor [down,!opt]
>     >? ? ?2021/04/12 06:10:45| optional ICAP service is down after an
>     options
>     >? ? ?fetch failure: icap://icap2.proxy:1344/request [down,!opt]
>     >? ? ?2021/04/12 06:10:45| optional ICAP service is down after an
>     options
>     >? ? ?fetch failure: icap://icap3.proxy:14590/response [down,!opt]____
>     >
>     >? ? ?__?__
>     >
>     >? ? ?We're trying to understand why it happens to all ICAPs at
>     once. This
>     >? ? ?happens in 4.14 and in 5.0.4____
>     >
>     >? ? ?Any thoughts about what might cause this ?____
>     >
>     >? ? ?Many Thanks,____
>     >
>     >? ? ?Roie____
>     >
>     >
>     > _______________________________________________
>     > squid-users mailing list
>     > squid-users at lists.squid-cache.org
>     <mailto:squid-users at lists.squid-cache.org>
>     > http://lists.squid-cache.org/listinfo/squid-users
>     <http://lists.squid-cache.org/listinfo/squid-users>
>     >
> 



From ngtech1ltd at gmail.com  Mon May 24 09:52:04 2021
From: ngtech1ltd at gmail.com (Eliezer Croitoru)
Date: Mon, 24 May 2021 12:52:04 +0300
Subject: [squid-users] allow request to cloudfront after 302 redirection.
In-Reply-To: <00a2f0e6-0acb-0f8a-b867-74efe1fff59f@measurement-factory.com>
References: <CAJtdwusCo2m=yrg6eBfw-fqR3YPN16CjAceZ-CxgXvz4h_6kwQ@mail.gmail.com>
 <00a2f0e6-0acb-0f8a-b867-74efe1fff59f@measurement-factory.com>
Message-ID: <000001d75082$741961b0$5c4c2510$@gmail.com>

Hey Alex,

Following up this thread I was wondering about an example how to do that with an external_acl helper.
With ICAP I can do that easily to some degree.
With an external_acl helper I am not sure what values to send.
I would guess that the response code and response Location header might be the ones which should be passed to the helper?

What do you think about the next acls, should do the trick?(code to be followed)

acl redirect http_status 301-308
acl gitlab_package dstdomain package.gitlab.com

external_acl_type openlocation children=15 %DST %SRC %<{Location} /usr/local/bin/location-openner.rb
acl location_openner external openlocation
http_access deny gitlab_package redirect location_openner
http_access allow location_openner


Thanks,
----
Eliezer Croitoru
Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com


-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Alex Rousskov
Sent: Wednesday, April 21, 2021 8:49 PM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] allow request to cloudfront after 302 redirection.

On 4/21/21 12:48 PM, Miroslaw Malinowski wrote:
> Is it possible to create a whitelist that allows cloudfront 302
> redirections, e.g. gitlab is using cloudfront as CDN and when we
> whitelist package.gitlab.com the URL is redirected (302) to
> https://d20rj4el6vkp4c.cloudfront.net/7/11/ubuntu/package_files/35938.deb?t=1619023239_a63698472b6bebeaee980e7c030632d97a29c15d


Yes, it is possible to allow future requests to Location-listed URLs,
but since we are talking about two (or more) independent HTTP
transactions, on two (or more) TCP connections, you will need to store
the allowed Location values (at least) somewhere, maintain that storage
(e.g., remove stale entries), and (optionally) determine whether the
request for an allowed cloudfront URL came from the same user agent as
the gitlab request that was redirected to that URL.

Storing, maintenance, and checking of allowed Locations/etc. can be done
using external ACLs and/or eCAP/ICAP adaptation services. It cannot be
reliably done using built-in ACLs alone AFAICT.


HTH,

Alex.


> I could whitelist a whole .cloudfront.net <http://cloudfront.net> domain
> or url_regex, but what I would like to achieve, I don't know if
> possible, is a chain of events like:
> If packages.gitlab.com <http://packages.gitlab.com> return 302 Location
> .cloudfront, then allow
> https://d20rj4el6vkp4c.cloudfront.net/7/11/ubuntu/package_files/35938.deb?t=1619023239_a63698472b6bebeaee980e7c030632d97a29c
> <https://d20rj4el6vkp4c.cloudfront.net/7/11/ubuntu/package_files/35938.deb?t=1619023239_a63698472b6bebeaee980e7c030632d97a29c>
> request.
> I've been playing around with http_reply_access and rep_headers, but I
> can only go as far as allow replay of the first request to
> package.gitlab.com <http://package.gitlab.com>, but then a GET to
> cloudfront is blocked anyway as it's not on our whitelist.
> e.g.
> 1619022938.916   423 172.16.230.237 NONE/200 0 CONNECT 54.153.54.194:443
> <http://54.153.54.194:443> - ORIGINAL_DST/54.153.54.194
> <http://54.153.54.194> -
> 1619022939.074   153 172.16.230.237 TCP_MISS/302 758 GET
> https://packages.gitlab.com/gitlab/gitlab-ee/packages/ubuntu/bionic/gitlab-ee_11.0.1-ee.0_amd64.deb/download.deb
> <https://packages.gitlab.com/gitlab/gitlab-ee/packages/ubuntu/bionic/gitlab-ee_11.0.1-ee.0_amd64.deb/download.deb>
> - ORIGINAL_DST/54.153.54.194 <http://54.153.54.194> text/html
> 1619022939.108    20 172.16.230.237 NONE/200 0 CONNECT 52.84.90.34:443
> <http://52.84.90.34:443> - ORIGINAL_DST/52.84.90.34 <http://52.84.90.34> -
> 1619022939.114     2 172.16.230.237 TCP_DENIED/403 19053 GET
> https://d20rj4el6vkp4c.cloudfront.net/7/11/ubuntu/package_files/35938.deb <https://d20rj4el6vkp4c.cloudfront.net/7/11/ubuntu/package_files/35938.deb>?
> - HIER_NONE/- text/html

_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From rousskov at measurement-factory.com  Mon May 24 18:25:38 2021
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Mon, 24 May 2021 14:25:38 -0400
Subject: [squid-users] allow request to cloudfront after 302 redirection.
In-Reply-To: <000001d75082$741961b0$5c4c2510$@gmail.com>
References: <CAJtdwusCo2m=yrg6eBfw-fqR3YPN16CjAceZ-CxgXvz4h_6kwQ@mail.gmail.com>
 <00a2f0e6-0acb-0f8a-b867-74efe1fff59f@measurement-factory.com>
 <000001d75082$741961b0$5c4c2510$@gmail.com>
Message-ID: <eedf9edf-5f88-e7cc-b5a5-f9fa2ec9d58c@measurement-factory.com>

On 5/24/21 5:52 AM, Eliezer Croitoru wrote:

> Following up this thread I was wondering about an example how to do
> that with an external_acl helper. With ICAP I can do that easily to
> some degree. With an external_acl helper I am not sure what values to
> send.

AFAICT, the external ACL helper(s) should be sent the Location URI
values the helper(s) should cache (at response time) and the request URI
values the helper(s) should examine (at request time). More information
may be sent/cached, of course, depending on the exact decision logic.


> I would guess that the response code and response Location header
> might be the ones which should be passed to the helper?

I do not see the value in sending the response status code (because
Squid can check that itself), but the correct answer depends on the
exact decision logic.


> What do you think about the next acls, should do the trick?

> acl redirect http_status 301-308
> acl gitlab_package dstdomain package.gitlab.com

> external_acl_type openlocation children=15 %DST %SRC %<{Location} /usr/local/bin/location-openner.rb
> acl location_openner external openlocation
> http_access deny gitlab_package redirect location_openner
> http_access allow location_openner

The above sketch does not make sense to me because it uses response
information (e.g., %<h{Location}) in a request-time directive (i.e.
http_access). FWIW, I would expect something along these lines:

  http_access allow toPreviouslySeenLocation

  http_reply_access allow isRedirect storeSeenLocation
  http_reply_access allow all

... where toPreviouslySeenLocation and storeSeenLocation are external
ACLs (using one shared or two dedicated external ACL helpers).
storeSeenLocation always matches and is used for its side effect.


HTH,

Alex.


> -----Original Message-----
> From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Alex Rousskov
> Sent: Wednesday, April 21, 2021 8:49 PM
> To: squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] allow request to cloudfront after 302 redirection.
> 
> On 4/21/21 12:48 PM, Miroslaw Malinowski wrote:
>> Is it possible to create a whitelist that allows cloudfront 302
>> redirections, e.g. gitlab is using cloudfront as CDN and when we
>> whitelist package.gitlab.com the URL is redirected (302) to
>> https://d20rj4el6vkp4c.cloudfront.net/7/11/ubuntu/package_files/35938.deb?t=1619023239_a63698472b6bebeaee980e7c030632d97a29c15d
> 
> 
> Yes, it is possible to allow future requests to Location-listed URLs,
> but since we are talking about two (or more) independent HTTP
> transactions, on two (or more) TCP connections, you will need to store
> the allowed Location values (at least) somewhere, maintain that storage
> (e.g., remove stale entries), and (optionally) determine whether the
> request for an allowed cloudfront URL came from the same user agent as
> the gitlab request that was redirected to that URL.
> 
> Storing, maintenance, and checking of allowed Locations/etc. can be done
> using external ACLs and/or eCAP/ICAP adaptation services. It cannot be
> reliably done using built-in ACLs alone AFAICT.
> 
> 
> HTH,
> 
> Alex.
> 
> 
>> I could whitelist a whole .cloudfront.net <http://cloudfront.net> domain
>> or url_regex, but what I would like to achieve, I don't know if
>> possible, is a chain of events like:
>> If packages.gitlab.com <http://packages.gitlab.com> return 302 Location
>> .cloudfront, then allow
>> https://d20rj4el6vkp4c.cloudfront.net/7/11/ubuntu/package_files/35938.deb?t=1619023239_a63698472b6bebeaee980e7c030632d97a29c
>> <https://d20rj4el6vkp4c.cloudfront.net/7/11/ubuntu/package_files/35938.deb?t=1619023239_a63698472b6bebeaee980e7c030632d97a29c>
>> request.
>> I've been playing around with http_reply_access and rep_headers, but I
>> can only go as far as allow replay of the first request to
>> package.gitlab.com <http://package.gitlab.com>, but then a GET to
>> cloudfront is blocked anyway as it's not on our whitelist.
>> e.g.
>> 1619022938.916   423 172.16.230.237 NONE/200 0 CONNECT 54.153.54.194:443
>> <http://54.153.54.194:443> - ORIGINAL_DST/54.153.54.194
>> <http://54.153.54.194> -
>> 1619022939.074   153 172.16.230.237 TCP_MISS/302 758 GET
>> https://packages.gitlab.com/gitlab/gitlab-ee/packages/ubuntu/bionic/gitlab-ee_11.0.1-ee.0_amd64.deb/download.deb
>> <https://packages.gitlab.com/gitlab/gitlab-ee/packages/ubuntu/bionic/gitlab-ee_11.0.1-ee.0_amd64.deb/download.deb>
>> - ORIGINAL_DST/54.153.54.194 <http://54.153.54.194> text/html
>> 1619022939.108    20 172.16.230.237 NONE/200 0 CONNECT 52.84.90.34:443
>> <http://52.84.90.34:443> - ORIGINAL_DST/52.84.90.34 <http://52.84.90.34> -
>> 1619022939.114     2 172.16.230.237 TCP_DENIED/403 19053 GET
>> https://d20rj4el6vkp4c.cloudfront.net/7/11/ubuntu/package_files/35938.deb <https://d20rj4el6vkp4c.cloudfront.net/7/11/ubuntu/package_files/35938.deb>?
>> - HIER_NONE/- text/html
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 



From lbrtchx at gmail.com  Mon May 24 21:12:21 2021
From: lbrtchx at gmail.com (Albretch Mueller)
Date: Mon, 24 May 2021 17:12:21 -0400
Subject: [squid-users] manual proxy configuration ...
Message-ID: <CAFakBwg=yD3JWLfD0s+WsuaKmEzp-863WrE8QLpmkfY1P7c+dw@mail.gmail.com>

 After installing squid, I tried to configure:

$ firefox --version
Mozilla Firefox 52.6.0

 based on the steps on that link:

 https://linuxize.com/post/how-to-install-and-configure-squid-proxy-on-debian-10/

 but I can't find the value I should enter as "http proxy"

 as port I will simply use the default.

 this is what squid tells me

# systemctl status squid
? squid.service - LSB: Squid HTTP Proxy version 3.x
   Loaded: loaded (/etc/init.d/squid; generated; vendor preset: enabled)
   Active: active (running) since Mon 2021-05-24 22:41:50 EDT; 21min ago
     Docs: man:systemd-sysv-generator(8)
  Process: 12808 ExecStop=/etc/init.d/squid stop (code=exited, status=0/SUCCESS)
  Process: 12834 ExecStart=/etc/init.d/squid start (code=exited,
status=0/SUCCESS)
 Main PID: 12874 (squid)
    Tasks: 4 (limit: 4915)
   CGroup: /system.slice/squid.service
           ??12872 /usr/sbin/squid -YC -f /etc/squid/squid.conf
           ??12874 (squid-1) -YC -f /etc/squid/squid.conf
           ??12875 (logfile-daemon) /var/log/squid/access.log
           ??12876 (pinger)

May 24 22:41:50 debian systemd[1]: Stopped LSB: Squid HTTP Proxy version 3.x.
May 24 22:41:50 debian systemd[1]: Starting LSB: Squid HTTP Proxy version 3.x...
May 24 22:41:50 debian squid[12872]: Squid Parent: will start 1 kids
May 24 22:41:50 debian squid[12834]: Starting Squid HTTP Proxy: squid.
May 24 22:41:50 debian systemd[1]: squid.service: PID file
/var/run/squid.pid not readable (yet?) after start:
May 24 22:41:50 debian squid[12872]: Squid Parent: (squid-1) process
12874 started
May 24 22:41:50 debian systemd[1]: squid.service: Supervising process
12874 which is not our child. We'll most
May 24 22:41:50 debian systemd[1]: Started LSB: Squid HTTP Proxy version 3.x.
~
 what should I do? Are there any foolproof step by step guidelines out there?

 I should be able to find the values out of squid configuration file
that I must use as entries in firefox

 lbrtchx


From jose.rodriguez at cenpalab.cu  Mon May 24 21:27:48 2021
From: jose.rodriguez at cenpalab.cu (jose.rodriguez at cenpalab.cu)
Date: Mon, 24 May 2021 21:27:48 +0000
Subject: [squid-users] Strange squid status warning
Message-ID: <a1ddfdb44ac3a436adbecbf61eb312ca@cenpalab.cu>

I cannot find anything related to this warning obtained with 'systemctl status squid'. What could it mean?


May 24 17:22:57 proxynew squid[77148]: Starting Squid Cache version 5.0.6 for x86_64-pc-linux-gnu...
May 24 17:22:57 proxynew squid[77148]: Service Name: squid
May 24 17:22:57 proxynew squid[77148]: WARNING: The following configuration error will be fatal in future Squid versions
May 24 17:22:57 proxynew squid[77148]: [110B blob data]


Regards,

Joe1962



From rousskov at measurement-factory.com  Tue May 25 00:00:12 2021
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Mon, 24 May 2021 20:00:12 -0400
Subject: [squid-users] Strange squid status warning
In-Reply-To: <a1ddfdb44ac3a436adbecbf61eb312ca@cenpalab.cu>
References: <a1ddfdb44ac3a436adbecbf61eb312ca@cenpalab.cu>
Message-ID: <b088d373-f535-2b7e-b55e-d2a59c0990bb@measurement-factory.com>

On 5/24/21 5:27 PM, jose.rodriguez at cenpalab.cu wrote:
> I cannot find anything related to this warning obtained with 'systemctl status squid'. What could it mean?
> 
> 
> May 24 17:22:57 proxynew squid[77148]: Starting Squid Cache version 5.0.6 for x86_64-pc-linux-gnu...
> May 24 17:22:57 proxynew squid[77148]: Service Name: squid
> May 24 17:22:57 proxynew squid[77148]: WARNING: The following configuration error will be fatal in future Squid versions
> May 24 17:22:57 proxynew squid[77148]: [110B blob data]

The answer to your question is supposed to be on the line following the
WARNING line.

The "[110B blob data]" part in the above systemctl output does not seem
to match what Squid can log AFAICT. If that is exactly what systemctl
prints, then can you look in your Squid cache.log (if you have one) and
see what that actually says?

Alex.


From jose.rodriguez at cenpalab.cu  Tue May 25 00:14:04 2021
From: jose.rodriguez at cenpalab.cu (jose.rodriguez at cenpalab.cu)
Date: Tue, 25 May 2021 00:14:04 +0000
Subject: [squid-users] Strange squid status warning
In-Reply-To: <b088d373-f535-2b7e-b55e-d2a59c0990bb@measurement-factory.com>
References: <b088d373-f535-2b7e-b55e-d2a59c0990bb@measurement-factory.com>
 <a1ddfdb44ac3a436adbecbf61eb312ca@cenpalab.cu>
Message-ID: <d1a86e55eedb34d9684e73a71833e695@cenpalab.cu>

May 24, 2021 8:00 PM, "Alex Rousskov" <rousskov at measurement-factory.com> wrote:

> On 5/24/21 5:27 PM, jose.rodriguez at cenpalab.cu wrote:
> 
>> I cannot find anything related to this warning obtained with 'systemctl status squid'. What could
>> it mean?
>> 
>> May 24 17:22:57 proxynew squid[77148]: Starting Squid Cache version 5.0.6 for
>> x86_64-pc-linux-gnu...
>> May 24 17:22:57 proxynew squid[77148]: Service Name: squid
>> May 24 17:22:57 proxynew squid[77148]: WARNING: The following configuration error will be fatal in
>> future Squid versions
>> May 24 17:22:57 proxynew squid[77148]: [110B blob data]
> 
> The answer to your question is supposed to be on the line following the
> WARNING line.
> 
> The "[110B blob data]" part in the above systemctl output does not seem
> to match what Squid can log AFAICT. If that is exactly what systemctl
> prints, then can you look in your Squid cache.log (if you have one) and
> see what that actually says?
> 
> Alex.

Sorry, false alarm. Just checked cache.log and it was the same [Bug 5128] Typo error in /usr/share/squid/errors/es/ERR_FORWARDING_DENIED I reported last week in 5.0.6 and you patched. I had reported this to my packager friend and he sent me a supposedly fixed package, which I must have installed over my own manual edit of the error file. Guess he didn't really fix it, only the pinger permissions issue I had also reported to him.

Regards,
Joe1962



From lbrtchx at gmail.com  Tue May 25 05:51:21 2021
From: lbrtchx at gmail.com (Albretch Mueller)
Date: Tue, 25 May 2021 01:51:21 -0400
Subject: [squid-users] (possibly dynamic?) multiple port forwarding in the
 same internal Network ...
Message-ID: <CAFakBwjLO=xOnc1WRYNZV1WF2HUwf_sb9yaVKo4js_TZy3wE+Q@mail.gmail.com>

 As part of a teaching and learning (TaL)/school software, I need squid:

 a) to detect one of the connected computers in an internal network
comprising wirelessly connected and wired computers as the "master"
(operated by the teacher);

 b) when that master reach out to an outside URL, the response should
be replicated in that master's and all other internal computers; but

 c) responses to requests originating in the non master ("slave"?)
ends, return to their corresponding ends;

 d) at times the master should be able to switch off that replicating feature;

 e) more than one or all computers should be able to play "master";

 f) all other "slave" should operate in a "transparent proxy" mode;

 g) on a single computer, someone could use different
browsers/versions to do a-f ...

 I have seen that partially implemented one way or the other, however
I need to integrate/manage all parts as part of an integrated whole.

 I could imagine these kinds of setups being used in TaL and
conferencing environments, as well as in testing environments and, for
example, ?a could be achieved with the mac address and/or cookies, but
someone could run macchanger and delete all cookies in their browser,
so an extra authentication barrier should be used, which I see as the
only fool proof way of setup and know who the masters are, or? How
could disable slave ends from authenticating? I am not a networking
kind of guy, so I am not quite sure about the kind of scenarios that
could play out in those kinds of dynamic "master"/"slaves" setups.

 Probably, all the functional requirements relating to what I have
described can not straight-forwardly done with squid, but there should
be a way to use other applications' output to dynamically reconfigure:

 /etc/squid/squid.conf

 So, my questions could be reduced to: which exactly are the
configuration lines that should be changed in both squid and the
browsers on the connected computers or the different browsers in the
same computer?

 lbrtchx


From Antony.Stone at squid.open.source.it  Tue May 25 08:31:31 2021
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Tue, 25 May 2021 10:31:31 +0200
Subject: [squid-users] (possibly dynamic?) multiple port forwarding in
 the same internal Network ...
In-Reply-To: <CAFakBwjLO=xOnc1WRYNZV1WF2HUwf_sb9yaVKo4js_TZy3wE+Q@mail.gmail.com>
References: <CAFakBwjLO=xOnc1WRYNZV1WF2HUwf_sb9yaVKo4js_TZy3wE+Q@mail.gmail.com>
Message-ID: <202105251031.31366.Antony.Stone@squid.open.source.it>

On Tuesday 25 May 2021 at 07:51:21, Albretch Mueller wrote:

>  As part of a teaching and learning (TaL)/school software, I need squid:
> 
>  a) to detect one of the connected computers in an internal network
> comprising wirelessly connected and wired computers as the "master"
> (operated by the teacher);

What information is available to Squid in order to "detect" that this is the 
"master" machine?

>  b) when that master reach out to an outside URL, the response should
> be replicated in that master's and all other internal computers; but

What do you mean by "the response should be replicated in ... all other 
internal computers"?

Are you assuming that these computers are already running a browser, and that 
they should suddenly get some (apparently) web server response via Squid and 
display it, even though they did not make any request?

If so, I would say this is impossible - you can't get a computer to show a 
response to a request it did not make.

If I have misunderstood, please explain which this does mean.

>  c) responses to requests originating in the non master ("slave"?)
> ends, return to their corresponding ends;

So, any computer other than the "master" simply makes requests and gets 
standard responses as usual.  Fie.

>  d) at times the master should be able to switch off that replicating
> feature;

What times?  How?  I really think you need to explain this "replicating 
feature" in more detail (and preferably in network terms, from the point of 
view of the software running on the master, and the software running on a non-
master.

>  e) more than one or all computers should be able to play "master";

I repeat my first question - what information is available to Squid in order to 
"detect" that this is the "master" machine?

>  f) all other "slave" should operate in a "transparent proxy" mode;

Are you including SSL in this?

>  g) on a single computer, someone could use different
> browsers/versions to do a-f ...
> 
>  I have seen that partially implemented one way or the other, however
> I need to integrate/manage all parts as part of an integrated whole.


>  So, my questions could be reduced to: which exactly are the
> configuration lines that should be changed in both squid and the
> browsers on the connected computers or the different browsers in the
> same computer?

I think this request is (a) a *lot* more complicated than this, and probably a 
lot more complicated than you think it is, and (b) in parts, impossible.


Regards,


Antony.

-- 
The difference between theory and practice is that in theory there is no 
difference, whereas in practice there is.

                                                   Please reply to the list;
                                                         please *don't* CC me.


From fbartolom at gmail.com  Tue May 25 09:31:30 2021
From: fbartolom at gmail.com (Fabrizio Bartolomucci)
Date: Tue, 25 May 2021 11:31:30 +0200
Subject: [squid-users] Accessing external web page with squid
Message-ID: <1AAD8C7F-E076-4E5B-85D8-C1618010CC5D@gmail.com>

I configured squid on my centos web site and successfully tested an access by it with:

curl -x http://taxiprofessional.net:3128 <http://taxiprofessional.net:3128/> -L https://books.apple.com/it/book/bibbia-traduzione-letterale-genesi/id1276275493 <https://books.apple.com/it/book/bibbia-traduzione-letterale-genesi/id1276275493>

What should I use to replicate this connection in a url in order to access that page by proxy from a web browser of the kind, perhaps, https://taxiprofessional.net:3128 <https://taxiprofessional.net:3128/>??

Thanks,
Dr. Fabrizio Bartolomucci
IOS Software Programmer
Mia Foto

3474013121 <tel:3474013121> | 3474013121 <tel:3474013121>
	fbartolom at gmail.com <mailto:fbartolom at gmail.com>
	pizzomarinella.inarrivo.com <x-msg://pizzomarinella.inarrivo.com>
	Via Riviera Prangi, dev IV, 3C, Residence Roseto, Pizzo (VV)
 <https://www.facebook.com/fabriziob>	
 <https://www.twitter.com/fbartolom>	
 <https://www.linkedin.com/in/fbartolom/>	
 





-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210525/a156968d/attachment.htm>

From uhlar at fantomas.sk  Tue May 25 10:18:41 2021
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Tue, 25 May 2021 12:18:41 +0200
Subject: [squid-users] Accessing external web page with squid
In-Reply-To: <1AAD8C7F-E076-4E5B-85D8-C1618010CC5D@gmail.com>
References: <1AAD8C7F-E076-4E5B-85D8-C1618010CC5D@gmail.com>
Message-ID: <20210525101841.GA22492@fantomas.sk>

On 25.05.21 11:31, Fabrizio Bartolomucci wrote:
>I configured squid on my centos web site and successfully tested an access by it with:
>
>curl -x http://taxiprofessional.net:3128 -L https://books.apple.com/it/book/bibbia-traduzione-letterale-genesi/id1276275493

(oh, stupid gmail duplicated URLs in plaintext messages...)

the website is https://books.apple.com/it/book/bibbia-traduzione-letterale-genesi/id1276275493
the proxy address is http://taxiprofessional.net:3128

>What should I use to replicate this connection in a url in order to access
> that page by proxy from a web browser of the kind, perhaps,

configure that browser to use proxy http://taxiprofessional.net:3128
and simply try to access address
https://books.apple.com/it/book/bibbia-traduzione-letterale-genesi/id1276275493

> https://taxiprofessional.net:3128

Are you trying to connect squid via https?

If so, you need to have squid compiled with SSL/TLS, configure https_port
there (different than http_port) and configure client to use https proxy.
CURL can to https proxy.

if not, explain what exactly you want to do.
-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
The only substitute for good manners is fast reflexes.


From lbrtchx at gmail.com  Tue May 25 12:36:09 2021
From: lbrtchx at gmail.com (Albretch Mueller)
Date: Tue, 25 May 2021 08:36:09 -0400
Subject: [squid-users] (possibly dynamic?) multiple port forwarding in
 the same internal Network ...
In-Reply-To: <202105251031.31366.Antony.Stone@squid.open.source.it>
References: <CAFakBwjLO=xOnc1WRYNZV1WF2HUwf_sb9yaVKo4js_TZy3wE+Q@mail.gmail.com>
 <202105251031.31366.Antony.Stone@squid.open.source.it>
Message-ID: <CAFakBwhKyPe=ZFUjgbfxi_d+fAn_dvPd2N-veFxSLj1S_xzxEA@mail.gmail.com>

On 5/25/21, Antony Stone <Antony.Stone at squid.open.source.it> wrote:
> On Tuesday 25 May 2021 at 07:51:21, Albretch Mueller wrote:
>
>>  As part of a teaching and learning (TaL)/school software, I need squid:
>>
>>  a) to detect one of the connected computers in an internal network
>> comprising wirelessly connected and wired computers as the "master"
>> (operated by the teacher);

> What information is available to Squid in order to "detect" that this is the
> "master" machine?

 I think a combination of cookies, its mac address and, when both
fail, authentication. Wouldn't that be enough?, perhaps with an extra
proxy server? My main problem is that I don't want for students boxes
to be prompted for or trying to initiate an authentication and I don't
know of a fool proof way of achieving that. If possible, all students'
business should let go through with squid serving as transparent
proxy.

 Probably squid could cache that request as local files to the extent
that it can and just redirect the requests of students' clients as
references to that file using an ICAP server somehow?

>>  b) when that master reach out to an outside URL, the response should
>> be replicated in that master's and all other internal computers; but
>
> What do you mean by "the response should be replicated in ... all other
> internal computers"?

 that the initial request by the teacher should be received as
response by all students

> Are you assuming that these computers are already running a browser,

 Well, technically, I think we could assume that, why would that be
problematic? How bad would if be if they are not running a browser,
you could interrupt an initiated request, you could even shot down
your computer in the middle of a download or transaction without a
problem. Why would that be that difficult? or, was is it exactly I am
not getting right?

> that
> they should suddenly get some (apparently) web server response via Squid and
> display it, even though they did not make any request?

> If so, I would say this is impossible - you can't get a computer to show a
> response to a request it did not make.

 Yes, this is what I meant, why is that so hard? Again, my forte is
not networking, but I could see how the requested file could be cached
and forwarded to all student boxes. Perhaps using an ICAP server.

>>  c) responses to requests originating in the non master ("slave"?)
>> ends, return to their corresponding ends;
>
> So, any computer other than the "master" simply makes requests and gets
> standard responses as usual.  Fie.

 Yes, once you know the request originated in the non master machine,
it would go back to the initiating client. Again, why would that be
that problematic?

>>  d) at times the master should be able to switch off that replicating
>> feature;
>
> What times?

 Teacher may decide to "privately" check out some information by
herself without it being displayed on all students' ends or even
concurrently open another "private" browser window.

> How?

 This is what I don't know but I think (probably somewhat naively) it
shouldn't be that hard. Again, session tracking via cookies or URL
rewriting, maybe?

>  I really think you need to explain this "replicating
> feature" in more detail (and preferably in network terms, from the point of
> view of the software running on the master, and the software running on a
> non-master.

 I am not a networking guy but probably you could point out to me some
related documents explaining specifically the kinds of problematics
around these kinds of issues.

>>  e) more than one or all computers should be able to play "master";
>
> I repeat my first question - what information is available to Squid in order
> to
> "detect" that this is the "master" machine?

 I think I answer that in ?a. Again, why would that be that hard?

>>  f) all other "slave" should operate in a "transparent proxy" mode;
>
> Are you including SSL in this?

 Yes, if possibly, all kinds of communications, but just http (no
encryption) for the student client machines would be fine.

>>  g) on a single computer, someone could use different
>> browsers/versions to do a-f ...
>>
>>  I have seen that partially implemented one way or the other, however
>> I need to integrate/manage all parts as part of an integrated whole.
>
>>  So, my questions could be reduced to: which exactly are the
>> configuration lines that should be changed in both squid and the
>> browsers on the connected computers or the different browsers in the
>> same computer?
>
> I think this request is (a) a *lot* more complicated than this, and probably
> a
> lot more complicated than you think it is, and (b) in parts, impossible.

 I am squarely OK with "lots of complication" and as I said, you might
not be able to completely and directly implement all aspects using
squid, but what aspects of that integrated whole do you think are
impossible?

 lbrtchx


From Antony.Stone at squid.open.source.it  Tue May 25 12:56:02 2021
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Tue, 25 May 2021 14:56:02 +0200
Subject: [squid-users] (possibly dynamic?) multiple port forwarding in
 the same internal Network ...
In-Reply-To: <CAFakBwhKyPe=ZFUjgbfxi_d+fAn_dvPd2N-veFxSLj1S_xzxEA@mail.gmail.com>
References: <CAFakBwjLO=xOnc1WRYNZV1WF2HUwf_sb9yaVKo4js_TZy3wE+Q@mail.gmail.com>
 <202105251031.31366.Antony.Stone@squid.open.source.it>
 <CAFakBwhKyPe=ZFUjgbfxi_d+fAn_dvPd2N-veFxSLj1S_xzxEA@mail.gmail.com>
Message-ID: <202105251456.02376.Antony.Stone@squid.open.source.it>

On Tuesday 25 May 2021 at 14:36:09, Albretch Mueller wrote:

> On 5/25/21, Antony Stone <Antony.Stone at squid.open.source.it> wrote:
> > On Tuesday 25 May 2021 at 07:51:21, Albretch Mueller wrote:
> >>  As part of a teaching and learning (TaL)/school software, I need squid:
> >>  
> >>  a) to detect one of the connected computers in an internal network
> >> comprising wirelessly connected and wired computers as the "master"
> >> (operated by the teacher);
> > 
> > What information is available to Squid in order to "detect" that this is
> > the "master" machine?
> 
> I think a combination of cookies,

What system generates / checks the cookies?

What URL are the cookies associated with in the browser?

> its mac address and, when both fail, authentication.

Ah, some form of authentication, where the master user has to log in to 
something, would certainly be effective.  It was just the way you used the word 
"detect" that made me think this should be some action on the part of Squid 
independently of what the master machine user was doing.

> Wouldn't that be enough?, perhaps with an extra proxy server?

Perhaps with an extra *web* server (for authentication), yes, but where would 
an extra proxy server point to?

> My main problem is that I don't want for students boxes to be prompted for
> or trying to initiate an authentication and I don't know of a fool proof way
> of achieving that.

How about the teacher accesses a URL that the students don't know, or at least 
are not supposed to access, and it is that URL which prompts the teacher to 
authenticate?

If the students go to that URL then they will also be prompted to 
authenticate, but in general they will not.

> If possible, all students' business should let go through with squid serving
> as transparent proxy.

That's just down to your networking configuration.

> Probably squid could cache that request as local files to the extent
> that it can and just redirect the requests of students' clients as
> references to that file using an ICAP server somehow?

So, the student asks for the Wikipedia article on Amethyst and finds that their 
browser shows them the web page the teacher is looking at instead?

I think there's no way you're going to achieve this sort of thing with the 
current popularity of SSL/TLS.

> >>  b) when that master reach out to an outside URL, the response should
> >> be replicated in that master's and all other internal computers; but
> > 
> > What do you mean by "the response should be replicated in ... all other
> > internal computers"?
> 
>  that the initial request by the teacher should be received as
> response by all students

Response to what?

> > Are you assuming that these computers are already running a browser,
> 
> Well, technically, I think we could assume that, why would that be
> problematic? How bad would if be if they are not running a browser,
> you could interrupt an initiated request, you could even shot down
> your computer in the middle of a download or transaction without a
> problem. Why would that be that difficult? or, was is it exactly I am
> not getting right?

I'm asking "what application is going to receive this "response" sent by 
Squid, and be expecting it so that it can process it and display it to the 
user?"

You can't just send a chunk of HTML to a computer over the network and expect 
a browser window to suddenly appear and display it.

Aside from anything else, you have to get a TCP session going in the first 
place.

> > that they should suddenly get some (apparently) web server response via
> > Squid and display it, even though they did not make any request?
> > 
> > If so, I would say this is impossible - you can't get a computer to show
> > a response to a request it did not make.
> 
> Yes, this is what I meant, why is that so hard?

a) the client (user's computer) did not open a TCP session to anything (either 
Squid, or a web server), so it's not going to accept TCP "replies"

b) the client did not send an HTTP request to anything, so it's not going to 
accept some HTML which simply turns up on its network port

> Again, my forte is not networking, but I could see how the requested file
> could be cached and forwarded to all student boxes. Perhaps using an ICAP
> server.

You can modify a request sent from the client, or you can modify a response 
sent back from a sever, but you cannot simply send a response to a machine 
which did not make a request.

> >>  c) responses to requests originating in the non master ("slave"?)
> >> ends, return to their corresponding ends;
> > 
> > So, any computer other than the "master" simply makes requests and gets
> > standard responses as usual.  Fine.
> 
> Yes, once you know the request originated in the non master machine,
> it would go back to the initiating client. Again, why would that be
> that problematic?

That is not problematic - it's fine.

> >>  d) at times the master should be able to switch off that replicating
> >> feature;
> > 
> > What times?
> 
> Teacher may decide to "privately" check out some information by
> herself without it being displayed on all students' ends or even
> concurrently open another "private" browser window.

So, the Squid proxy needs somehow to be able to identify which session or 
window the teacher is using, and react differently.  I suspect this is probably 
doable, but far from simple.

> > How?
> 
> This is what I don't know but I think (probably somewhat naively) it
> shouldn't be that hard. Again, session tracking via cookies or URL
> rewriting, maybe?

I think you are completely overlooking modern security practices here.

a) many websites use SSL/TLS - you can't just intercept the requests or 
responses and replace them with whatever you want

b) most browsers and related applications will either not support, or 
definitely warn about, cross-site scripting and foreign cookies

> > I really think you need to explain this "replicating feature" in more
> > detail (and preferably in network terms, from the point of view of the
> > software running on the master, and the software running on a non-master.
> 
> I am not a networking guy but probably you could point out to me some
> related documents explaining specifically the kinds of problematics
> around these kinds of issues.

Just look up "TCP 3-way handshake" and read any basic introduction to "client-
server connectivity" for an understanding of how an HTTP request gets made and 
the response received.

Without a request, the response will be ignored.

> > I think this request is (a) a *lot* more complicated than this, and
> > probably a lot more complicated than you think it is, and (b) in parts,
> > impossible.
> 
> I am squarely OK with "lots of complication" and as I said, you might
> not be able to completely and directly implement all aspects using
> squid, but what aspects of that integrated whole do you think are
> impossible?

Basic networking protocols, from what I understand of how you expect this to 
work.


Antony.

-- 
Most people are aware that the Universe is big.

 - Paul Davies, Professor of Theoretical Physics

                                                   Please reply to the list;
                                                         please *don't* CC me.


From uhlar at fantomas.sk  Tue May 25 13:08:10 2021
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Tue, 25 May 2021 15:08:10 +0200
Subject: [squid-users] (possibly dynamic?) multiple port forwarding in
 the same internal Network ...
In-Reply-To: <CAFakBwjLO=xOnc1WRYNZV1WF2HUwf_sb9yaVKo4js_TZy3wE+Q@mail.gmail.com>
References: <CAFakBwjLO=xOnc1WRYNZV1WF2HUwf_sb9yaVKo4js_TZy3wE+Q@mail.gmail.com>
Message-ID: <20210525130810.GA2033@fantomas.sk>

On 25.05.21 01:51, Albretch Mueller wrote:
>Subject: [squid-users] (possibly dynamic?) multiple port forwarding in the
> same internal Network ...

> As part of a teaching and learning (TaL)/school software, I need squid:

as first I'd like to note that squid is a HTTP/FTP proxy, not a port
forwarder (see Subject)

> a) to detect one of the connected computers in an internal network
>comprising wirelessly connected and wired computers as the "master"
>(operated by the teacher);

> b) when that master reach out to an outside URL, the response should
>be replicated in that master's and all other internal computers; but

squid also does not actively distribute content.
It can fetch and cache it, but the rest is on you.

and according to your description, most of the work is on you.

> c) responses to requests originating in the non master ("slave"?)
>ends, return to their corresponding ends;
>
> d) at times the master should be able to switch off that replicating feature;
>
> e) more than one or all computers should be able to play "master";
>
> f) all other "slave" should operate in a "transparent proxy" mode;

> g) on a single computer, someone could use different
>browsers/versions to do a-f ...
>
> I have seen that partially implemented one way or the other, however
>I need to integrate/manage all parts as part of an integrated whole.
>
> I could imagine these kinds of setups being used in TaL and
>conferencing environments, as well as in testing environments and, for
>example, ?a could be achieved with the mac address and/or cookies, but
>someone could run macchanger and delete all cookies in their browser,
>so an extra authentication barrier should be used, which I see as the
>only fool proof way of setup and know who the masters are, or? How
>could disable slave ends from authenticating? I am not a networking
>kind of guy, so I am not quite sure about the kind of scenarios that
>could play out in those kinds of dynamic "master"/"slaves" setups.
>
> Probably, all the functional requirements relating to what I have
>described can not straight-forwardly done with squid, but there should
>be a way to use other applications' output to dynamically reconfigure:
>
> /etc/squid/squid.conf
>
> So, my questions could be reduced to: which exactly are the
>configuration lines that should be changed in both squid and the
>browsers on the connected computers or the different browsers in the
>same computer?

this apaprently means that all squid caches running on their machines will
transparently intercept outgoing port 80 connections. Should be easier on
local machine.

https://wiki.squid-cache.org/SquidFaq/InterceptionProxy

note that intercepting HTTPS (port 443) is much more work and issues than
port 80 (http).

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
On the other hand, you have different fingers.


From rousskov at measurement-factory.com  Tue May 25 13:28:53 2021
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Tue, 25 May 2021 09:28:53 -0400
Subject: [squid-users] Accessing external web page with squid
In-Reply-To: <1AAD8C7F-E076-4E5B-85D8-C1618010CC5D@gmail.com>
References: <1AAD8C7F-E076-4E5B-85D8-C1618010CC5D@gmail.com>
Message-ID: <e854b7a5-c54b-e588-1b96-d738ca9a5fd5@measurement-factory.com>

On 5/25/21 5:31 AM, Fabrizio Bartolomucci wrote:
> I configured squid on my centos web site and successfully tested an
> access by it with:
> 
> curl -x http://taxiprofessional.net:3128 -L
> https://books.apple.com/it/book/bibbia-traduzione-letterale-genesi/id1276275493

> What should I use to replicate this connection in a url in order to
> access that page by proxy from a web browser of the kind,

I doubt there is a way way to tell a popular browser to use a proxy
using the Location bar alone. Instead, you should _configure_ your
browser to use an HTTP proxy (located at the taxiprofessional.net:3128
address) and then request the desired URL (by typing that URL in the
browser Location bar, by clicking a link on another page, or requesting
it via Javascript -- all those accesses will go through the configured
proxy).

If you want to access a proxy from Javascript from inside a browser that
is _not_ configured to use a proxy, then I am not sure what the best way
to do that is, but others on the list may help you with that.


HTH,

Alex.


From lbrtchx at gmail.com  Tue May 25 13:57:06 2021
From: lbrtchx at gmail.com (Albretch Mueller)
Date: Tue, 25 May 2021 09:57:06 -0400
Subject: [squid-users] (possibly dynamic?) multiple port forwarding in
 the same internal Network ...
In-Reply-To: <20210525130810.GA2033@fantomas.sk>
References: <CAFakBwjLO=xOnc1WRYNZV1WF2HUwf_sb9yaVKo4js_TZy3wE+Q@mail.gmail.com>
 <20210525130810.GA2033@fantomas.sk>
Message-ID: <CAFakBwj20yAcDEti0cCE_KW991X2vQZ-S2AESTC9fmcs9miXnw@mail.gmail.com>

On 5/25/21, Antony Stone <Antony.Stone at squid.open.source.it> wrote:
> On Tuesday 25 May 2021 at 14:36:09, Albretch Mueller wrote:
>
>> On 5/25/21, Antony Stone <Antony.Stone at squid.open.source.it> wrote:
>> > On Tuesday 25 May 2021 at 07:51:21, Albretch Mueller wrote:
>> >>  As part of a teaching and learning (TaL)/school software, I need
>> >> squid:
>> >>
>> >>  a) to detect one of the connected computers in an internal network
>> >> comprising wirelessly connected and wired computers as the "master"
>> >> (operated by the teacher);
>> >
>> > What information is available to Squid in order to "detect" that this is
>> > the "master" machine?
>>
>> I think a combination of cookies,
>
> What system generates / checks the cookies?

 OK, I am just guessing here in the direction I'd wish that
implementation would go, but  probably an intermidiate proxy or
another running instance internally running an ICAP server should be
used?

> What URL are the cookies associated with in the browser?

 OK, again ;-), here I clearly see your point, but the communication
associated with certain computers could be handled differently based
on other autenticating aspects. Also, say, teachers have their own
dedicated tablets, we know the time frames in which classes run in
each classroom...

>> its mac address and, when both fail, authentication.
>
> Ah, some form of authentication, where the master user has to log in to
> something, would certainly be effective.  It was just the way you used the
> word
> "detect" that made me think this should be some action on the part of Squid
> independently of what the master machine user was doing.

 So, that issue we could see as checked.

>> Wouldn't that be enough?, perhaps with an extra proxy server?
>
> Perhaps with an extra *web* server (for authentication), yes, but where
> would
> an extra proxy server point to?

 [teacher] |\                                                      /|
...........| .>.[extra proxy server*2].<.>.[squid server + ICAP].<. | Internet
[students] |/                                                      \|

 * [2] extra proxy server discriminating between communications
started by the teacher or server
 * extra ICAP server used to do some page content marshalling, e.g.:
if a youtube video is accessed, students would see only a page with
all the js crap removed and a link pointing to a local file with the
video (which, of course, could have been pre downloaded)

>> My main problem is that I don't want for students boxes to be prompted for
>> or trying to initiate an authentication and I don't know of a fool proof
>> way
>> of achieving that.
>
> How about the teacher accesses a URL that the students don't know, or at
> least
> are not supposed to access, and it is that URL which prompts the teacher to
> authenticate?

 You are not a teacher, right? ;-) or at least not a teacher in the
40's section of the South Bronx in NYC. I think it would be much
better if the teacher carries around something (probably, just her
face and/or fingerprints? which could be checked via biometrics, the
webcam on her tablet). In a school (kind of like in a prison) keeping
protected functional spaces vertically disentangled is very important.

>> If possible, all students' business should let go through with squid
>> serving
>> as transparent proxy.
>
> That's just down to your networking configuration.

 Great!

>> Probably squid could cache that request as local files to the extent
>> that it can and just redirect the requests of students' clients as
>> references to that file using an ICAP server somehow?
>
> So, the student asks for the Wikipedia article on Amethyst and finds that
> their
> browser shows them the web page the teacher is looking at instead?
>
> I think there's no way you're going to achieve this sort of thing with the
> current popularity of SSL/TLS.

 No, I don't see things happening in that way. There are certain
moments during the class in which students can "freely" access the
Internet, but teacher should be able to direct the class. So her inet
request trumps  whatever the students may be attempting to do.

 Yes, it seems to be a bit facist, but I do believe we should offer
kids with a safe leaning environment while in school. They will have
enough time to watch all that crappy nonsense floating around outside
of the school for the rest of their lives.

>> >>  b) when that master reach out to an outside URL, the response should
>> >> be replicated in that master's and all other internal computers; but
>> >
>> > What do you mean by "the response should be replicated in ... all other
>> > internal computers"?
>>
>>  that the initial request by the teacher should be received as
>> response by all students
>
> Response to what?

 response to the initial teacher request

>> > Are you assuming that these computers are already running a browser,
>>
>> Well, technically, I think we could assume that, why would that be
>> problematic? How bad would if be if they are not running a browser,
>> you could interrupt an initiated request, you could even shot down
>> your computer in the middle of a download or transaction without a
>> problem. Why would that be that difficult? or, was is it exactly I am
>> not getting right?
>
> I'm asking "what application is going to receive this "response" sent by
> Squid, and be expecting it so that it can process it and display it to the
> user?"
>
> You can't just send a chunk of HTML to a computer over the network and
> expect
> a browser window to suddenly appear and display it.

 It would not be a big deal for me/anyone with some moderate
programming experience, to code in minutes an application that:

 a) fields/intercepts a response to an initial request
 b) saves it to a local file (if it is a media file) and
 c) parses and marshalls the response page to include a link to that ?b file

> Aside from anything else, you have to get a TCP session going in the first
> place.
>

 Well, yes and that, like making sure or checking if a browser window
is open, would be an aspect that squid can't do for us, but it is
doable in some other ways.

>> > that they should suddenly get some (apparently) web server response via
>> > Squid and display it, even though they did not make any request?
>> >
>> > If so, I would say this is impossible - you can't get a computer to show
>> > a response to a request it did not make.
>>
>> Yes, this is what I meant, why is that so hard?
>
> a) the client (user's computer) did not open a TCP session to anything
> (either
> Squid, or a web server), so it's not going to accept TCP "replies"
>
> b) the client did not send an HTTP request to anything, so it's not going to
> accept some HTML which simply turns up on its network port
>
>> Again, my forte is not networking, but I could see how the requested file
>> could be cached and forwarded to all student boxes. Perhaps using an ICAP
>> server.
>
> You can modify a request sent from the client, or you can modify a response
> sent back from a sever, but you cannot simply send a response to a machine
> which did not make a request.

 As explained above you could channel some data to any computer with a
physical and addressable connection to a network, web/application
servers do that all the time.

 Or probably the idea of "beating"/"polling" requests from a browser
should be exploited?

>> >>  c) responses to requests originating in the non master ("slave"?)
>> >> ends, return to their corresponding ends;
>> >
>> > So, any computer other than the "master" simply makes requests and gets
>> > standard responses as usual.  Fine.
>>
>> Yes, once you know the request originated in the non master machine,
>> it would go back to the initiating client. Again, why would that be
>> that problematic?
>
> That is not problematic - it's fine.

 Great!

>> >>  d) at times the master should be able to switch off that replicating
>> >> feature;
>> >
>> > What times?
>>
>> Teacher may decide to "privately" check out some information by
>> herself without it being displayed on all students' ends or even
>> concurrently open another "private" browser window.
>
> So, the Squid proxy needs somehow to be able to identify which session or
> window the teacher is using, and react differently.  I suspect this is
> probably
> doable, but far from simple.

 Great! You see it is all falling into place little by little

 All that needs to be done then is qualifying/deal with the "far from
simple" aspects relating to it.

>> > How?
>>
>> This is what I don't know but I think (probably somewhat naively) it
>> shouldn't be that hard. Again, session tracking via cookies or URL
>> rewriting, maybe?
>
> I think you are completely overlooking modern security practices here.
>
> a) many websites use SSL/TLS - you can't just intercept the requests or
> responses and replace them with whatever you want
>
> b) most browsers and related applications will either not support, or
> definitely warn about, cross-site scripting and foreign cookies

 Computers and browsers are in the classrooms are owned and it is OK
if students see all pages as plain text, non SSL/TLS ones.

 I may be missing something here, but in princip I think it is doable somehow.

>> > I really think you need to explain this "replicating feature" in more
>> > detail (and preferably in network terms, from the point of view of the
>> > software running on the master, and the software running on a
>> > non-master.
>>
>> I am not a networking guy but probably you could point out to me some
>> related documents explaining specifically the kinds of problematics
>> around these kinds of issues.
>
> Just look up "TCP 3-way handshake" and read any basic introduction to
> "client-
> server connectivity" for an understanding of how an HTTP request gets made
> and
> the response received.
>
> Without a request, the response will be ignored.

 Thank you I will look up "TCP 3-way handshake" and then see what is doable.

 I still think that if browsers create so many problems you could:

 a) reconfiger or remove/recompile the part of the browsers which
create such "problems", other

 b) code and use, for example, JavaFX-based reach clients

>> > I think this request is (a) a *lot* more complicated than this, and
>> > probably a lot more complicated than you think it is, and (b) in parts,
>> > impossible.
>>
>> I am squarely OK with "lots of complication" and as I said, you might
>> not be able to completely and directly implement all aspects using
>> squid, but what aspects of that integrated whole do you think are
>> impossible?
>
> Basic networking protocols, from what I understand of how you expect this to
> work.

 Thank you very much Anthony/[squid users]. As I squeeze some time to
do it, I will start working little by little on the implementation of
such a stack. I thought something like that or pretty close to it
would be available out already. There definitely is a need for such a
thing.

 I will definitely keep bothering you as I stumble on hurdles along the way ;-)

 The first hurdle I have in sight is how to locally run squid with
more than one browser open on my own computer as a test environment.
This is something I think (again probably I am being a bit too
imaginative here) shouldn't be a problem. How do people who design and
troubleshoot browsers do such things?

 Thanks to all,

 lbrtchx


From fbartolom at gmail.com  Tue May 25 14:11:10 2021
From: fbartolom at gmail.com (Fabrizio Bartolomucci)
Date: Tue, 25 May 2021 16:11:10 +0200
Subject: [squid-users] Accessing external web page with squid
In-Reply-To: <e854b7a5-c54b-e588-1b96-d738ca9a5fd5@measurement-factory.com>
References: <1AAD8C7F-E076-4E5B-85D8-C1618010CC5D@gmail.com>
 <e854b7a5-c54b-e588-1b96-d738ca9a5fd5@measurement-factory.com>
Message-ID: <FE61FE54-0CA3-445A-AB34-7C80BC87ED53@gmail.com>

As a matter of fact it should all be the transparent to the user. She would click a button and get the requested page by way of the proxy, instead of directly. Like for example: taxiprofessional.net:3000?https://books.apple.com/it/book/bibbia-traduzione-letterale-genesi/id1276275493 <https://books.apple.com/it/book/bibbia-traduzione-letterale-genesi/id1276275493>
would return page https://books.apple.com/it/book/bibbia-traduzione-letterale-genesi/id1276275493 <https://books.apple.com/it/book/bibbia-traduzione-letterale-genesi/id1276275493>

More strategically that url would also be inserted in the links of a RapidWeaver stack allowing to search the website, that doesn't work with the Apple web site due to Cors security issues.
Greetings,

> Il giorno 25 mag 2021, alle ore 15:28, Alex Rousskov <rousskov at measurement-factory.com> ha scritto:
> 
> On 5/25/21 5:31 AM, Fabrizio Bartolomucci wrote:
>> I configured squid on my centos web site and successfully tested an
>> access by it with:
>> 
>> curl -x http://taxiprofessional.net:3128 -L
>> https://books.apple.com/it/book/bibbia-traduzione-letterale-genesi/id1276275493
> 
>> What should I use to replicate this connection in a url in order to
>> access that page by proxy from a web browser of the kind,
> 
> I doubt there is a way way to tell a popular browser to use a proxy
> using the Location bar alone. Instead, you should _configure_ your
> browser to use an HTTP proxy (located at the taxiprofessional.net:3128
> address) and then request the desired URL (by typing that URL in the
> browser Location bar, by clicking a link on another page, or requesting
> it via Javascript -- all those accesses will go through the configured
> proxy).
> 
> If you want to access a proxy from Javascript from inside a browser that
> is _not_ configured to use a proxy, then I am not sure what the best way
> to do that is, but others on the list may help you with that.
> 
> 
> HTH,
> 
> Alex.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

Dr. Fabrizio Bartolomucci
IOS Software Programmer
Mia Foto

3474013121 <tel:3474013121> | 3474013121 <tel:3474013121>
	fbartolom at gmail.com <mailto:fbartolom at gmail.com>
	pizzomarinella.inarrivo.com <applewebdata://pizzomarinella.inarrivo.com>
	Via Riviera Prangi, dev IV, 3C, Residence Roseto, Pizzo (VV)
 <https://www.facebook.com/fabriziob>	
 <https://www.twitter.com/fbartolom>	
 <https://www.linkedin.com/in/fbartolom/>	
 





-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210525/5d90a5b9/attachment.htm>

From lbrtchx at gmail.com  Tue May 25 14:14:14 2021
From: lbrtchx at gmail.com (Albretch Mueller)
Date: Tue, 25 May 2021 10:14:14 -0400
Subject: [squid-users] (possibly dynamic?) multiple port forwarding in
 the same internal Network ...
In-Reply-To: <20210525130810.GA2033@fantomas.sk>
References: <CAFakBwjLO=xOnc1WRYNZV1WF2HUwf_sb9yaVKo4js_TZy3wE+Q@mail.gmail.com>
 <20210525130810.GA2033@fantomas.sk>
Message-ID: <CAFakBwiSdd8FG72eJCBROxzO7R2H4=dZFOZO5SG6dtmOtwHd2A@mail.gmail.com>

On 5/25/21, Matus UHLAR - fantomas <uhlar at fantomas.sk> wrote:
> as first I'd like to note that squid is a HTTP/FTP proxy, not a port
> forwarder (see Subject)
>
> squid also does not actively distribute content.
> It can fetch and cache it, but the rest is on you.
>
> and according to your description, most of the work is on you.

 Well, yes that I see. I ask here because the most important part of
what I have in mind is squid in tandem with an ICAP plugin, so you
should know best about technologies around it. I am not asking for you
to do such thing or change the design of squid for me.

>> Probably, all the functional requirements relating to what I have
>>described can not straight-forwardly done with squid, but there should
>>be a way to use other applications' output to dynamically reconfigure:
>>
>> /etc/squid/squid.conf
>>
>> So, my questions could be reduced to: which exactly are the
>>configuration lines that should be changed in both squid and the
>>browsers on the connected computers or the different browsers in the
>>same computer?
>
> this apaprently means that all squid caches running on their machines will
> transparently intercept outgoing port 80 connections. Should be easier on
> local machine.
>
> https://wiki.squid-cache.org/SquidFaq/InterceptionProxy
>
> note that intercepting HTTPS (port 443) is much more work and issues than
> port 80 (http).

 I was actually thinking in terms of some sort of "squid caching
sessions" instead of having squid running on all local machines, but I
have to think more about why you have suggested such a solution (or
possibly misinterpreted my idea)

 lbrtchx


From uhlar at fantomas.sk  Tue May 25 14:26:32 2021
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Tue, 25 May 2021 16:26:32 +0200
Subject: [squid-users] (possibly dynamic?) multiple port forwarding in
 the same internal Network ...
In-Reply-To: <CAFakBwiSdd8FG72eJCBROxzO7R2H4=dZFOZO5SG6dtmOtwHd2A@mail.gmail.com>
References: <CAFakBwjLO=xOnc1WRYNZV1WF2HUwf_sb9yaVKo4js_TZy3wE+Q@mail.gmail.com>
 <20210525130810.GA2033@fantomas.sk>
 <CAFakBwiSdd8FG72eJCBROxzO7R2H4=dZFOZO5SG6dtmOtwHd2A@mail.gmail.com>
Message-ID: <20210525142632.GA3066@fantomas.sk>

>On 5/25/21, Matus UHLAR - fantomas <uhlar at fantomas.sk> wrote:
>> as first I'd like to note that squid is a HTTP/FTP proxy, not a port
>> forwarder (see Subject)
>>
>> squid also does not actively distribute content.
>> It can fetch and cache it, but the rest is on you.
>>
>> and according to your description, most of the work is on you.
>
> Well, yes that I see. I ask here because the most important part of
>what I have in mind is squid in tandem with an ICAP plugin, so you
>should know best about technologies around it. I am not asking for you
>to do such thing or change the design of squid for me.
>
>>> Probably, all the functional requirements relating to what I have
>>>described can not straight-forwardly done with squid, but there should
>>>be a way to use other applications' output to dynamically reconfigure:
>>>
>>> /etc/squid/squid.conf
>>>
>>> So, my questions could be reduced to: which exactly are the
>>>configuration lines that should be changed in both squid and the
>>>browsers on the connected computers or the different browsers in the
>>>same computer?
>>
>> this apaprently means that all squid caches running on their machines will
>> transparently intercept outgoing port 80 connections. Should be easier on
>> local machine.
>>
>> https://wiki.squid-cache.org/SquidFaq/InterceptionProxy
>>
>> note that intercepting HTTPS (port 443) is much more work and issues than
>> port 80 (http).

On 25.05.21 10:14, Albretch Mueller wrote:
> I was actually thinking in terms of some sort of "squid caching
>sessions" instead of having squid running on all local machines, but I
>have to think more about why you have suggested such a solution (or
>possibly misinterpreted my idea)

your description sounded like running caching squid on each machine ("all
other internal computers")

Also, it's much easier to do intercepting proxy on local machine, as you
don't have to play with routing (which is required for intercepting
connections).

Also, it's easier to reconfigure multiple squid caches on multiple computers
than (tons of) different clients on each computer...

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Atheism is a non-prophet organization.


From Antony.Stone at squid.open.source.it  Tue May 25 14:31:27 2021
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Tue, 25 May 2021 16:31:27 +0200
Subject: [squid-users] (possibly dynamic?) multiple port forwarding in
 the same internal Network ...
In-Reply-To: <CAFakBwjLO=xOnc1WRYNZV1WF2HUwf_sb9yaVKo4js_TZy3wE+Q@mail.gmail.com>
References: <CAFakBwjLO=xOnc1WRYNZV1WF2HUwf_sb9yaVKo4js_TZy3wE+Q@mail.gmail.com>
Message-ID: <202105251631.27423.Antony.Stone@squid.open.source.it>

On Tuesday 25 May 2021 at 07:51:21, Albretch Mueller wrote:

>  As part of a teaching and learning (TaL)/school software, I need squid:
> 
>  a) to detect one of the connected computers in an internal network
> comprising wirelessly connected and wired computers as the "master"
> (operated by the teacher);
> 
>  b) when that master reach out to an outside URL, the response should
> be replicated in that master's and all other internal computers; but
> 
>  c) responses to requests originating in the non master ("slave"?)
> ends, return to their corresponding ends;
> 
>  d) at times the master should be able to switch off that replicating
> feature;
> 
>  e) more than one or all computers should be able to play "master";
> 
>  f) all other "slave" should operate in a "transparent proxy" mode;
> 
>  g) on a single computer, someone could use different
> browsers/versions to do a-f ...

I've returned to your original question here, after discussing several points 
already in some detail, and I can't help wondering - why are you trying to do 
all this in browsers and web proxies, by manipulating network communications 
in ways that were not indended?

Why not give the students a video conferencing / screen sharing application 
such as MS Teams, Jitsi, Zoom, etc and then block them from accessing websites 
during lessons?

They are required to use the screen sharing application in order to see what 
the teacher is showing them during the lesson (are the days of video 
projectors and intelligent whiteboards already over?), and they are not 
allowed to play around on their own (are these devices their own personal 
equipment, or are they supplied and managed by the school?) using the school's 
networking resources.

That would seem to me to be a far simpler solution to your requirement, 
assuming I have now correctly understood that you essentially want a teacher 
to share their screen with the students, and for the students not to be able 
to "wander off on their own" into the general Internet.


Antony.

-- 
Users don't know what they want until they see what they get.

                                                   Please reply to the list;
                                                         please *don't* CC me.


From uhlar at fantomas.sk  Tue May 25 14:32:28 2021
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Tue, 25 May 2021 16:32:28 +0200
Subject: [squid-users] Accessing external web page with squid
In-Reply-To: <FE61FE54-0CA3-445A-AB34-7C80BC87ED53@gmail.com>
References: <1AAD8C7F-E076-4E5B-85D8-C1618010CC5D@gmail.com>
 <e854b7a5-c54b-e588-1b96-d738ca9a5fd5@measurement-factory.com>
 <FE61FE54-0CA3-445A-AB34-7C80BC87ED53@gmail.com>
Message-ID: <20210525143228.GB3066@fantomas.sk>

On 25.05.21 16:11, Fabrizio Bartolomucci wrote:
>As a matter of fact it should all be the transparent to the user.

for "transparent" usage we udually recommend procy autoconfig or WPAD.

https://wiki.squid-cache.org/SquidFaq/ConfiguringBrowsers

> She would click a button and get the requested page by way of the proxy, instead of directly. Like for example: taxiprofessional.net:3000?https://books.apple.com/it/book/bibbia-traduzione-letterale-genesi/id1276275493

this looks like asking webserver on taxiprofessional.net port 3000 to
provide its URL:

/https://books.apple.com/it/book/bibbia-traduzione-letterale-genesi/id1276275493

This has issues (mostly related to certificates) and clients do NOT work like
this.

>More strategically that url would also be inserted in the links of a
> RapidWeaver stack allowing to search the website, that doesn't work with
> the Apple web site due to Cors security issues.

so, you want some random webserver to download and scan the remote URL for
you.
That means no privacy, no security on clients' sides and huge problems on
your side when clients (browsers, not users) will reject such content.

use autoconfiguration as described above.
-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
I intend to live forever - so far so good.


From lbrtchx at gmail.com  Tue May 25 17:50:11 2021
From: lbrtchx at gmail.com (Albretch Mueller)
Date: Tue, 25 May 2021 13:50:11 -0400
Subject: [squid-users] (possibly dynamic?) multiple port forwarding in
 the same internal Network ...
In-Reply-To: <202105251631.27423.Antony.Stone@squid.open.source.it>
References: <CAFakBwjLO=xOnc1WRYNZV1WF2HUwf_sb9yaVKo4js_TZy3wE+Q@mail.gmail.com>
 <202105251631.27423.Antony.Stone@squid.open.source.it>
Message-ID: <CAFakBwiuZLNaG4G6ELu99BPwNcZSbmMqH6VyTgy1SX2wS5CW4w@mail.gmail.com>

On 5/25/21, Antony Stone <Antony.Stone at squid.open.source.it> wrote:
> I've returned to your original question here, after discussing several
> points
> already in some detail, and I can't help wondering - why are you trying to
> do
> all this in browsers and web proxies, by manipulating network communications
> in ways that were not indended?

> That would seem to me to be a far simpler solution to your requirement,
> assuming I have now correctly understood that you essentially want a teacher
> to share their screen with the students, and for the students not to be able
> to "wander off on their own" into the general Internet.

 Unfortunately (or, probably, actually fortunately!) most of the
information out there is on the web and virtually anyone relate to it
naturally as their first step/view out there, but the web has become
way too wild to invite it into a TaL environment. I think "the best
possible world" we could possibly benefit from when it comes to the
web is by doing your best at "cutting the crap" in the most
functional, least taxing way you possibly could. Also, content on the
web changes in its own unpredictable ways and even subject matter
experts (with more than one responsibility) can't keep up with its
content. Yet, I do think that there are ways to do that by (a more or
less explicit description of what I have in mind):

 a) teacher has lesson plan(s) which include links to the web

 b) those links include pages on the web, which content she could
sanitize by "simply" clicking on the upper left and lower right corner
of the content area (firefox' js-based page reader isn't that great),
just clicking on the first of a number of linked pages (they do such
idiotic things to make you watch their ads) ... just two or three
clicks on pages you have on your field of view at this very moment,
anyway. That feature can be easily programmed based on a JavaFX
Webview, which would internally parse the page in an XPath kind of way
and "automatically" submit that XML-ish data to some sort of DB which
an ICAP server uses for its own parsing logic, for it to "know" what
to do with responses relating to such requested URLs ...

> Why not give the students a video conferencing / screen sharing application
> such as MS Teams, Jitsi, Zoom, etc and then block them from accessing
> websites
> during lessons?

 I (personally and generally) find those video conferencing/screen
sharing applications way too taxing for busy teachers and too
constraining for students. You would have to rewrite your lesson
plans, redesign your presentations. Also, all forms of communications
have their own intersubjective aspects. You can't reasonably expect to
regiment a class as if it were a marching squadron. Students have
their own ways to direct their own conscious attention, take thinking
pauses, ? as they interact with their learning environments.

 lbrtchx


From squid3 at treenet.co.nz  Tue May 25 22:26:39 2021
From: squid3 at treenet.co.nz (=?UTF-8?B?4oCqQW1vcyBKZWZmcmllc+KArA==?=)
Date: Wed, 26 May 2021 10:26:39 +1200
Subject: [squid-users] manual proxy configuration ...
References: <CAFakBwg=yD3JWLfD0s+WsuaKmEzp-863WrE8QLpmkfY1P7c+dw@mail.gmail.com>
Message-ID: <-bz4tx9po45wq-rfeqxh450vfb-jk4dprfbigkgsijevaov9xw18tqj332ui0tt-6jgm167686jn7zxjk60ulbf36q5bn-xw1eg9fkvgz8-aw8mm8-f3yc46-xj7nicgamyus-lhf3k8e1hnqsb3qey6.1621981599992@email.android.com>

An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210526/2af91103/attachment.htm>

From squid3 at treenet.co.nz  Wed May 26 00:57:16 2021
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 26 May 2021 12:57:16 +1200
Subject: [squid-users] Caching configuration for Squid on Windows
In-Reply-To: <CAAdA2WNAPL4ABxdzhd4BVyAPWoEQ49Q0WP_DYh76qNCr76E8ug@mail.gmail.com>
References: <CAAdA2WNAPL4ABxdzhd4BVyAPWoEQ49Q0WP_DYh76qNCr76E8ug@mail.gmail.com>
Message-ID: <278aa9e9-486a-06ee-7c31-49ca4642413e@treenet.co.nz>

On 22/05/21 2:06 am, Odhiambo Washington wrote:
> Hello everyone,
> 
> I installed this on my Windows 10 but gave up when I could not make it 
> to cache anything.
> 

Squid by default uses a memory based cache these days. Unless your 
traffic is non-cacheable you should be seeing some things stored there 
without any configuration.


> What is the correct format of the above config on Windows?
> 
> cache_dir aufs c:\Squid\cachedir?3000 16 256
> 

As far as I know that directory path should be written as:

  /c/Squid/cachedir


The '/cygdir' prefix from examples tutorials is part of CygWin 
environment configuration.

Amos


From uhlar at fantomas.sk  Wed May 26 07:18:02 2021
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Wed, 26 May 2021 09:18:02 +0200
Subject: [squid-users] Caching configuration for Squid on Windows
In-Reply-To: <278aa9e9-486a-06ee-7c31-49ca4642413e@treenet.co.nz>
References: <CAAdA2WNAPL4ABxdzhd4BVyAPWoEQ49Q0WP_DYh76qNCr76E8ug@mail.gmail.com>
 <278aa9e9-486a-06ee-7c31-49ca4642413e@treenet.co.nz>
Message-ID: <20210526071802.GA2767@fantomas.sk>

>On 22/05/21 2:06 am, Odhiambo Washington wrote:
>>I installed this on my Windows 10 but gave up when I could not make 
>>it to cache anything.

On 26.05.21 12:57, Amos Jeffries wrote:
>Squid by default uses a memory based cache these days. Unless your 
>traffic is non-cacheable you should be seeing some things stored there 
>without any configuration.

The main problem is that most of web content it HTTPS, which means it's
hardly cacheable outside of web browsers.

with https, proxy only sees stream of encrypted data:
the "s" in https means "secure" so no third party sees your data.

caching it requires decrypting of the connection, which means doing
man-in-the-mittle attack.  It requires private certififacion authority
installed on squid and in the browser, and for some domains using CAA
browsers will still complain, or you'll have to fake DNS CAA records, which
is harder with when using DNSSES, DoT or DoH.


-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Fighting for peace is like fucking for virginity...


From odhiambo at gmail.com  Wed May 26 08:25:17 2021
From: odhiambo at gmail.com (Odhiambo Washington)
Date: Wed, 26 May 2021 11:25:17 +0300
Subject: [squid-users] Caching configuration for Squid on Windows
In-Reply-To: <20210526071802.GA2767@fantomas.sk>
References: <CAAdA2WNAPL4ABxdzhd4BVyAPWoEQ49Q0WP_DYh76qNCr76E8ug@mail.gmail.com>
 <278aa9e9-486a-06ee-7c31-49ca4642413e@treenet.co.nz>
 <20210526071802.GA2767@fantomas.sk>
Message-ID: <CAAdA2WNPNTQKhBST71K_UuvUsdmPsNk5X_U+mcEPSANecOeSpA@mail.gmail.com>

On Wed, May 26, 2021 at 10:18 AM Matus UHLAR - fantomas <uhlar at fantomas.sk>
wrote:

> >On 22/05/21 2:06 am, Odhiambo Washington wrote:
> >>I installed this on my Windows 10 but gave up when I could not make
> >>it to cache anything.
>
> On 26.05.21 12:57, Amos Jeffries wrote:
> >Squid by default uses a memory based cache these days. Unless your
> >traffic is non-cacheable you should be seeing some things stored there
> >without any configuration.
>
> The main problem is that most of web content it HTTPS, which means it's
> hardly cacheable outside of web browsers.
>
> with https, proxy only sees stream of encrypted data:
> the "s" in https means "secure" so no third party sees your data.
>
> caching it requires decrypting of the connection, which means doing
> man-in-the-mittle attack.  It requires private certififacion authority
> installed on squid and in the browser, and for some domains using CAA
> browsers will still complain, or you'll have to fake DNS CAA records, which
> is harder with when using DNSSES, DoT or DoH.


In the light of the foregoing, what is the standard way of deploying Squid
these days?
Is the use of the ssl_bump becoming standard or no one needs any caching
within Squid these days so that Squid
has become a tool for filtering and access control only?


-- 
Best regards,
Odhiambo WASHINGTON,
Nairobi,KE
+254 7 3200 0004/+254 7 2274 3223
"Oh, the cruft.", egrep -v "^$|^.*#" :-)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210526/4ebc7afc/attachment.htm>

From uhlar at fantomas.sk  Wed May 26 08:32:13 2021
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Wed, 26 May 2021 10:32:13 +0200
Subject: [squid-users] Caching configuration for Squid on Windows
In-Reply-To: <CAAdA2WNPNTQKhBST71K_UuvUsdmPsNk5X_U+mcEPSANecOeSpA@mail.gmail.com>
References: <CAAdA2WNAPL4ABxdzhd4BVyAPWoEQ49Q0WP_DYh76qNCr76E8ug@mail.gmail.com>
 <278aa9e9-486a-06ee-7c31-49ca4642413e@treenet.co.nz>
 <20210526071802.GA2767@fantomas.sk>
 <CAAdA2WNPNTQKhBST71K_UuvUsdmPsNk5X_U+mcEPSANecOeSpA@mail.gmail.com>
Message-ID: <20210526083213.GB2767@fantomas.sk>

>> >On 22/05/21 2:06 am, Odhiambo Washington wrote:
>> >>I installed this on my Windows 10 but gave up when I could not make
>> >>it to cache anything.
>>
>> On 26.05.21 12:57, Amos Jeffries wrote:
>> >Squid by default uses a memory based cache these days. Unless your
>> >traffic is non-cacheable you should be seeing some things stored there
>> >without any configuration.

>On Wed, May 26, 2021 at 10:18 AM Matus UHLAR - fantomas <uhlar at fantomas.sk>
>wrote:
>> The main problem is that most of web content it HTTPS, which means it's
>> hardly cacheable outside of web browsers.
>>
>> with https, proxy only sees stream of encrypted data:
>> the "s" in https means "secure" so no third party sees your data.
>>
>> caching it requires decrypting of the connection, which means doing
>> man-in-the-mittle attack.  It requires private certififacion authority
>> installed on squid and in the browser, and for some domains using CAA
>> browsers will still complain, or you'll have to fake DNS CAA records, which
>> is harder with when using DNSSES, DoT or DoH.

On 26.05.21 11:25, Odhiambo Washington wrote:
>In the light of the foregoing, what is the standard way of deploying Squid
>these days?
>Is the use of the ssl_bump becoming standard or no one needs any caching
>within Squid these days so that Squid
>has become a tool for filtering and access control only?

I guess it's the latter.

I personally think in cases of e.g.  public documents where the only privacy
issue is that you know who accesses what content, simpler version of
security could be enough: confirmation of authenticity (the content was not
modified). Such content could be cacheable. 

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Quantum mechanics: The dreams stuff is made of.


From odhiambo at gmail.com  Wed May 26 08:32:24 2021
From: odhiambo at gmail.com (Odhiambo Washington)
Date: Wed, 26 May 2021 11:32:24 +0300
Subject: [squid-users] Caching configuration for Squid on Windows
In-Reply-To: <278aa9e9-486a-06ee-7c31-49ca4642413e@treenet.co.nz>
References: <CAAdA2WNAPL4ABxdzhd4BVyAPWoEQ49Q0WP_DYh76qNCr76E8ug@mail.gmail.com>
 <278aa9e9-486a-06ee-7c31-49ca4642413e@treenet.co.nz>
Message-ID: <CAAdA2WOvU+2xzG2ZV-fHQ6DKcUGGr7=vPMc=x3Yf4qEpJ8Mxhw@mail.gmail.com>

On Wed, May 26, 2021 at 3:58 AM Amos Jeffries <squid3 at treenet.co.nz> wrote:

> On 22/05/21 2:06 am, Odhiambo Washington wrote:
> > Hello everyone,
> >
> > I installed this on my Windows 10 but gave up when I could not make it
> > to cache anything.
> >
>
> Squid by default uses a memory based cache these days. Unless your
> traffic is non-cacheable you should be seeing some things stored there
> without any configuration.
>
>
> > What is the correct format of the above config on Windows?
> >
> > cache_dir aufs c:\Squid\cachedir 3000 16 256
> >
>
> As far as I know that directory path should be written as:
>
>   /c/Squid/cachedir
>
>
> The '/cygdir' prefix from examples tutorials is part of CygWin
> environment configuration.
>


So I tried that and...


C:\Squid\var\cache\squid> C:\Squid\bin\squid.exe -z
2021/05/26 11:29:43| FATAL: Bungled /etc/squid/squid.conf line 64:
cache_dir aufs /C/Squid/var/cache/squid
2021/05/26 11:29:43| Squid Cache (Version 4.14): Terminated abnormally.
CPU Usage: 0.108 seconds = 0.046 user + 0.062 sys
Maximum Resident Size: 703488 KB
Page faults with physical i/o: 2852



-- 
Best regards,
Odhiambo WASHINGTON,
Nairobi,KE
+254 7 3200 0004/+254 7 2274 3223
"Oh, the cruft.", egrep -v "^$|^.*#" :-)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210526/698f5f9b/attachment.htm>

From odhiambo at gmail.com  Wed May 26 08:33:59 2021
From: odhiambo at gmail.com (Odhiambo Washington)
Date: Wed, 26 May 2021 11:33:59 +0300
Subject: [squid-users] Caching configuration for Squid on Windows
In-Reply-To: <20210526083213.GB2767@fantomas.sk>
References: <CAAdA2WNAPL4ABxdzhd4BVyAPWoEQ49Q0WP_DYh76qNCr76E8ug@mail.gmail.com>
 <278aa9e9-486a-06ee-7c31-49ca4642413e@treenet.co.nz>
 <20210526071802.GA2767@fantomas.sk>
 <CAAdA2WNPNTQKhBST71K_UuvUsdmPsNk5X_U+mcEPSANecOeSpA@mail.gmail.com>
 <20210526083213.GB2767@fantomas.sk>
Message-ID: <CAAdA2WMRkrH59YfW-qBvbbtPqpOuJttAqO1dqQhcnHnwXp85ZA@mail.gmail.com>

On Wed, May 26, 2021 at 11:32 AM Matus UHLAR - fantomas <uhlar at fantomas.sk>
wrote:

> >> >On 22/05/21 2:06 am, Odhiambo Washington wrote:
> >> >>I installed this on my Windows 10 but gave up when I could not make
> >> >>it to cache anything.
> >>
> >> On 26.05.21 12:57, Amos Jeffries wrote:
> >> >Squid by default uses a memory based cache these days. Unless your
> >> >traffic is non-cacheable you should be seeing some things stored there
> >> >without any configuration.
>
> >On Wed, May 26, 2021 at 10:18 AM Matus UHLAR - fantomas <
> uhlar at fantomas.sk>
> >wrote:
> >> The main problem is that most of web content it HTTPS, which means it's
> >> hardly cacheable outside of web browsers.
> >>
> >> with https, proxy only sees stream of encrypted data:
> >> the "s" in https means "secure" so no third party sees your data.
> >>
> >> caching it requires decrypting of the connection, which means doing
> >> man-in-the-mittle attack.  It requires private certififacion authority
> >> installed on squid and in the browser, and for some domains using CAA
> >> browsers will still complain, or you'll have to fake DNS CAA records,
> which
> >> is harder with when using DNSSES, DoT or DoH.
>
> On 26.05.21 11:25, Odhiambo Washington wrote:
> >In the light of the foregoing, what is the standard way of deploying Squid
> >these days?
> >Is the use of the ssl_bump becoming standard or no one needs any caching
> >within Squid these days so that Squid
> >has become a tool for filtering and access control only?
>
> I guess it's the latter.
>
> I personally think in cases of e.g.  public documents where the only
> privacy
> issue is that you know who accesses what content, simpler version of
> security could be enough: confirmation of authenticity (the content was not
> modified). Such content could be cacheable.


Thank you for clarifying this.
So ideally, outbound access control and reverse proxying :)


-- 
Best regards,
Odhiambo WASHINGTON,
Nairobi,KE
+254 7 3200 0004/+254 7 2274 3223
"Oh, the cruft.", egrep -v "^$|^.*#" :-)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210526/32b62f97/attachment.htm>

From evan at pierce.co.za  Wed May 26 08:56:37 2021
From: evan at pierce.co.za (Evan Pierce)
Date: Wed, 26 May 2021 08:56:37 +0000
Subject: [squid-users] Caching configuration for Squid on Windows
In-Reply-To: <CAAdA2WMRkrH59YfW-qBvbbtPqpOuJttAqO1dqQhcnHnwXp85ZA@mail.gmail.com>
References: <CAAdA2WNAPL4ABxdzhd4BVyAPWoEQ49Q0WP_DYh76qNCr76E8ug@mail.gmail.com>
 <278aa9e9-486a-06ee-7c31-49ca4642413e@treenet.co.nz>
 <20210526071802.GA2767@fantomas.sk>
 <CAAdA2WNPNTQKhBST71K_UuvUsdmPsNk5X_U+mcEPSANecOeSpA@mail.gmail.com>
 <20210526083213.GB2767@fantomas.sk>
 <CAAdA2WMRkrH59YfW-qBvbbtPqpOuJttAqO1dqQhcnHnwXp85ZA@mail.gmail.com>
Message-ID: <D1C697F2-C674-4CF0-ADE2-0C19C1230BEA@pierce.co.za>

Hi

We can do Thursday at 12:30 after our SAM meeting



From: squid-users <squid-users-bounces at lists.squid-cache.org> on behalf of Odhiambo Washington <odhiambo at gmail.com>
Date: Wednesday, 26 May 2021 at 10:36
To: "squid-users at lists.squid-cache.org" <squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] Caching configuration for Squid on Windows



On Wed, May 26, 2021 at 11:32 AM Matus UHLAR - fantomas <uhlar at fantomas.sk<mailto:uhlar at fantomas.sk>> wrote:
>> >On 22/05/21 2:06 am, Odhiambo Washington wrote:
>> >>I installed this on my Windows 10 but gave up when I could not make
>> >>it to cache anything.
>>
>> On 26.05.21 12:57, Amos Jeffries wrote:
>> >Squid by default uses a memory based cache these days. Unless your
>> >traffic is non-cacheable you should be seeing some things stored there
>> >without any configuration.

>On Wed, May 26, 2021 at 10:18 AM Matus UHLAR - fantomas <uhlar at fantomas.sk<mailto:uhlar at fantomas.sk>>
>wrote:
>> The main problem is that most of web content it HTTPS, which means it's
>> hardly cacheable outside of web browsers.
>>
>> with https, proxy only sees stream of encrypted data:
>> the "s" in https means "secure" so no third party sees your data.
>>
>> caching it requires decrypting of the connection, which means doing
>> man-in-the-mittle attack.  It requires private certififacion authority
>> installed on squid and in the browser, and for some domains using CAA
>> browsers will still complain, or you'll have to fake DNS CAA records, which
>> is harder with when using DNSSES, DoT or DoH.

On 26.05.21 11:25, Odhiambo Washington wrote:
>In the light of the foregoing, what is the standard way of deploying Squid
>these days?
>Is the use of the ssl_bump becoming standard or no one needs any caching
>within Squid these days so that Squid
>has become a tool for filtering and access control only?

I guess it's the latter.

I personally think in cases of e.g.  public documents where the only privacy
issue is that you know who accesses what content, simpler version of
security could be enough: confirmation of authenticity (the content was not
modified). Such content could be cacheable.

Thank you for clarifying this.
So ideally, outbound access control and reverse proxying :)


--
Best regards,
Odhiambo WASHINGTON,
Nairobi,KE
+254 7 3200 0004/+254 7 2274 3223
"Oh, the cruft.", egrep -v "^$|^.*#" :-)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210526/eb234a42/attachment.htm>

From robertkwild at gmail.com  Wed May 26 14:11:48 2021
From: robertkwild at gmail.com (robert k Wild)
Date: Wed, 26 May 2021 15:11:48 +0100
Subject: [squid-users] blocking mime types works for adobe, not for teams
Message-ID: <CAGU_Ci+4GOy-a1xq=4M0+i-8pb1YzydbT6uTB8EPu+GLeAvMQg@mail.gmail.com>

hi all,

i have in my squid config this

#deny MIME types
acl mimetype rep_mime_type "/usr/local/squid/etc/mimedeny.txt"
http_reply_access deny mimetype

mimedeny.txt

application/octet-stream
application/x-msi
application/zip
application/x-7z-compressed
application/vnd.ms-cab-compressed

it works as it blocks adobe reader download, but the url has an exe at the
end so maybe this is why

https://admdownload.adobe.com/bin/live/readerdc_uk_d_crd_install.exe

but it doesnt block ms teams from downloading

https://go.microsoft.com/fwlink/p/?LinkID=869426&clcid=0x809&culture=en-gb&country=GB&lm=deeplink&lmsrc=groupChatMarketingPageWeb&cmpid=directDownloadWin64

it just doesnt intercept the download at all and gives me the option to
"save file" its an exe

do you think this is because its a direct download link?

thanks,
rob

-- 
Regards,

Robert K Wild.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210526/4476dddc/attachment.htm>

From rousskov at measurement-factory.com  Wed May 26 18:32:20 2021
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Wed, 26 May 2021 14:32:20 -0400
Subject: [squid-users] Caching configuration for Squid on Windows
In-Reply-To: <CAAdA2WNPNTQKhBST71K_UuvUsdmPsNk5X_U+mcEPSANecOeSpA@mail.gmail.com>
References: <CAAdA2WNAPL4ABxdzhd4BVyAPWoEQ49Q0WP_DYh76qNCr76E8ug@mail.gmail.com>
 <278aa9e9-486a-06ee-7c31-49ca4642413e@treenet.co.nz>
 <20210526071802.GA2767@fantomas.sk>
 <CAAdA2WNPNTQKhBST71K_UuvUsdmPsNk5X_U+mcEPSANecOeSpA@mail.gmail.com>
Message-ID: <4c3508ae-9a7a-82b6-f2fd-82098b014d13@measurement-factory.com>

On 5/26/21 4:25 AM, Odhiambo Washington wrote:
> 
> On Wed, May 26, 2021 at 10:18 AM Matus UHLAR wrote:
> 
>     >On 22/05/21 2:06 am, Odhiambo Washington wrote:
>     >>I installed this on my Windows 10 but gave up when I could not make
>     >>it to cache anything.
> 
>     On 26.05.21 12:57, Amos Jeffries wrote:
>     >Squid by default uses a memory based cache these days. Unless your
>     >traffic is non-cacheable you should be seeing some things stored there
>     >without any configuration.
> 
>     The main problem is that most of web content it HTTPS, which means it's
>     hardly cacheable outside of web browsers.
> 
>     with https, proxy only sees stream of encrypted data:
>     the "s" in https means "secure" so no third party sees your data.
> 
>     caching it requires decrypting of the connection, which means doing
>     man-in-the-mittle attack.? It requires private certififacion authority
>     installed on squid and in the browser, and for some domains using CAA
>     browsers will still complain, or you'll have to fake DNS CAA
>     records, which
>     is harder with when using DNSSES, DoT or DoH.

 ?
> In the light of the foregoing, what is the standard way of deploying
> Squid these days?
> Is the use of the ssl_bump becoming standard or no one needs any caching
> within Squid these days so that Squid
> has become a tool for filtering and access control only?
 ?

There is no one "standard way" to deploy such versatile software like
Squid: Some deployments bump as much as they can while caching nothing.
Some encrypt everything and cache a lot. There are forward/interception
proxies versus reverse proxies. SaaS proxies versus highly customized
corporate deployments versus in-home installations. Deployments that
contribute a lot to the Squid Project versus those that we have never
heard of. And everything in between.

In most cases, the "standard" does not really matter. Focus on _your_
needs and make sure they can be and are supported well.

Alex.


From robertkwild at gmail.com  Wed May 26 18:58:44 2021
From: robertkwild at gmail.com (robert k Wild)
Date: Wed, 26 May 2021 19:58:44 +0100
Subject: [squid-users] blocking mime types works for adobe, not for teams
In-Reply-To: <CAGU_Ci+4GOy-a1xq=4M0+i-8pb1YzydbT6uTB8EPu+GLeAvMQg@mail.gmail.com>
References: <CAGU_Ci+4GOy-a1xq=4M0+i-8pb1YzydbT6uTB8EPu+GLeAvMQg@mail.gmail.com>
Message-ID: <CAGU_CiL8hPtwgTSpRXVYcn6S-c+np=ApPVR7L_4nzN9cLdF=hw@mail.gmail.com>

found a really good website to check http headers and i found the mime type

https://gf.dev/http-headers-test

On Wed, 26 May 2021 at 15:11, robert k Wild <robertkwild at gmail.com> wrote:

> hi all,
>
> i have in my squid config this
>
> #deny MIME types
> acl mimetype rep_mime_type "/usr/local/squid/etc/mimedeny.txt"
> http_reply_access deny mimetype
>
> mimedeny.txt
>
> application/octet-stream
> application/x-msi
> application/zip
> application/x-7z-compressed
> application/vnd.ms-cab-compressed
>
> it works as it blocks adobe reader download, but the url has an exe at the
> end so maybe this is why
>
> https://admdownload.adobe.com/bin/live/readerdc_uk_d_crd_install.exe
>
> but it doesnt block ms teams from downloading
>
>
> https://go.microsoft.com/fwlink/p/?LinkID=869426&clcid=0x809&culture=en-gb&country=GB&lm=deeplink&lmsrc=groupChatMarketingPageWeb&cmpid=directDownloadWin64
>
> it just doesnt intercept the download at all and gives me the option to
> "save file" its an exe
>
> do you think this is because its a direct download link?
>
> thanks,
> rob
>
> --
> Regards,
>
> Robert K Wild.
>


-- 
Regards,

Robert K Wild.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210526/a7b77186/attachment.htm>

From squid3 at treenet.co.nz  Wed May 26 23:33:23 2021
From: squid3 at treenet.co.nz (squid3 at treenet.co.nz)
Date: Thu, 27 May 2021 11:33:23 +1200
Subject: [squid-users] blocking mime types works for adobe, not for teams
In-Reply-To: <CAGU_CiL8hPtwgTSpRXVYcn6S-c+np=ApPVR7L_4nzN9cLdF=hw@mail.gmail.com>
References: <CAGU_Ci+4GOy-a1xq=4M0+i-8pb1YzydbT6uTB8EPu+GLeAvMQg@mail.gmail.com>
 <CAGU_CiL8hPtwgTSpRXVYcn6S-c+np=ApPVR7L_4nzN9cLdF=hw@mail.gmail.com>
Message-ID: <56680174080e6e7c1ab0ecb7da5eb1f9@treenet.co.nz>

On 2021-05-27 06:58, robert k Wild wrote:
> found a really good website to check http headers and i found the mime
> type
> 
> https://gf.dev/http-headers-test
> 
> On Wed, 26 May 2021 at 15:11, robert k Wild wrote:
> 
>> hi all,
>> 
>> i have in my squid config this
>> 
>> #deny MIME types
>> acl mimetype rep_mime_type "/usr/local/squid/etc/mimedeny.txt"
>> http_reply_access deny mimetype
>> 
>> mimedeny.txt
>> 
>> application/octet-stream
>> application/x-msi
>> application/zip
>> application/x-7z-compressed
>> application/vnd.ms-cab-compressed
>> 
>> it works as it blocks adobe reader download, but the url has an exe
>> at the end so maybe this is why

No. Mime type is unrelated to any characters in the URL.


>> 
>> https://admdownload.adobe.com/bin/live/readerdc_uk_d_crd_install.exe
>> 

This response has "Content-Type: application/octet-stream" which is 
listed in your blocklist.


>> but it doesnt block ms teams from downloading
>> 
>> 
> https://go.microsoft.com/fwlink/p/?LinkID=869426&clcid=0x809&culture=en-gb&country=GB&lm=deeplink&lmsrc=groupChatMarketingPageWeb&cmpid=directDownloadWin64
>> 
>> it just doesnt intercept the download at all and gives me the option
>> to "save file" its an exe
>> 
>> do you think this is because its a direct download link?

No. It is because the mime type is still not in your blocklist.

The tool at <https://redbot.org/> tells me the download is hidden behind 
a number of redirections then eventually the actual resource comes up 
with a "Content-Type: application/x-msdownload" header.


HTH
Amos


From lbrtchx at gmail.com  Thu May 27 07:50:33 2021
From: lbrtchx at gmail.com (Albretch Mueller)
Date: Thu, 27 May 2021 03:50:33 -0400
Subject: [squid-users] manual proxy configuration ...
In-Reply-To: <-bz4tx9po45wq-rfeqxh450vfb-jk4dprfbigkgsijevaov9xw18tqj332ui0tt-6jgm167686jn7zxjk60ulbf36q5bn-xw1eg9fkvgz8-aw8mm8-f3yc46-xj7nicgamyus-lhf3k8e1hnqsb3qey6.1621981599992@email.android.com>
References: <CAFakBwg=yD3JWLfD0s+WsuaKmEzp-863WrE8QLpmkfY1P7c+dw@mail.gmail.com>
 <-bz4tx9po45wq-rfeqxh450vfb-jk4dprfbigkgsijevaov9xw18tqj332ui0tt-6jgm167686jn7zxjk60ulbf36q5bn-xw1eg9fkvgz8-aw8mm8-f3yc46-xj7nicgamyus-lhf3k8e1hnqsb3qey6.1621981599992@email.android.com>
Message-ID: <CAFakBwjb1KbJbh0JeQodfR8jeoZPVhQ4U2_O4Kx304amVnHTUQ@mail.gmail.com>

On 5/25/21, ?Amos Jeffries? <squid3 at treenet.co.nz> wrote:
> You enter the IP address or hostname of the squid machine into the browser
> "proxy settings" for manual configuration.

 Yeah, exactly! and how do you know the IP address or hostname? What
line in the conf file specifies that?

 lbrtchx


From uhlar at fantomas.sk  Thu May 27 07:55:48 2021
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Thu, 27 May 2021 09:55:48 +0200
Subject: [squid-users] manual proxy configuration ...
In-Reply-To: <CAFakBwjb1KbJbh0JeQodfR8jeoZPVhQ4U2_O4Kx304amVnHTUQ@mail.gmail.com>
References: <CAFakBwg=yD3JWLfD0s+WsuaKmEzp-863WrE8QLpmkfY1P7c+dw@mail.gmail.com>
 <-bz4tx9po45wq-rfeqxh450vfb-jk4dprfbigkgsijevaov9xw18tqj332ui0tt-6jgm167686jn7zxjk60ulbf36q5bn-xw1eg9fkvgz8-aw8mm8-f3yc46-xj7nicgamyus-lhf3k8e1hnqsb3qey6.1621981599992@email.android.com>
 <CAFakBwjb1KbJbh0JeQodfR8jeoZPVhQ4U2_O4Kx304amVnHTUQ@mail.gmail.com>
Message-ID: <20210527075548.GA11861@fantomas.sk>

>On 5/25/21, ?Amos Jeffries? <squid3 at treenet.co.nz> wrote:
>> You enter the IP address or hostname of the squid machine into the browser
>> "proxy settings" for manual configuration.

On 27.05.21 03:50, Albretch Mueller wrote:
> Yeah, exactly! and how do you know the IP address or hostname?

it's your or your organizations proxy - you are supposed to know that, not
us.

> What line in the conf file specifies that?

each browser has its own way of proxy settings.
Many of them support "system proxy settings".

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Eagles may soar, but weasels don't get sucked into jet engines.


From guy20034u at yahoo.com  Thu May 27 08:43:10 2021
From: guy20034u at yahoo.com (simon ben)
Date: Thu, 27 May 2021 08:43:10 +0000 (UTC)
Subject: [squid-users] changing squid explicit mode to transparent mode
References: <1041070972.362583.1622104990514.ref@mail.yahoo.com>
Message-ID: <1041070972.362583.1622104990514@mail.yahoo.com>

Dear All,

I have the below setup running perfectly for a couple of years?
Centos 8 X64squid-4.11-3

configured in explicit mode so all client machines have the proxy IP configured in their browser
Recently we have got a security cloud solution which requires the source IP of the client machine
Since I have to configure the squid in transparent mode so the client source IP is visible and as required for transparent mode config i need to change the gateway to my squid server IP .
1 ) Is there any way so that I retain the source client PC IP in the current setup ????
2 ) if only way possible is by reconfiguring? my current proxy to? transparent mode then if there is some way without changing the client pc Gateway?Right Now the default gateway of the client PC is our Core switch vlan ip address.

Really appreciate your advise and help

Regards
simon
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210527/a9815acc/attachment.htm>

From ngtech1ltd at gmail.com  Thu May 27 12:16:34 2021
From: ngtech1ltd at gmail.com (Eliezer Croitoru)
Date: Thu, 27 May 2021 15:16:34 +0300
Subject: [squid-users] allow request to cloudfront after 302 redirection.
In-Reply-To: <eedf9edf-5f88-e7cc-b5a5-f9fa2ec9d58c@measurement-factory.com>
References: <CAJtdwusCo2m=yrg6eBfw-fqR3YPN16CjAceZ-CxgXvz4h_6kwQ@mail.gmail.com>
 <00a2f0e6-0acb-0f8a-b867-74efe1fff59f@measurement-factory.com>
 <000001d75082$741961b0$5c4c2510$@gmail.com>
 <eedf9edf-5f88-e7cc-b5a5-f9fa2ec9d58c@measurement-factory.com>
Message-ID: <002201d752f2$2367afc0$6a370f40$@gmail.com>

Thanks Alex,

I assume you do remember that 301 is not the same as 302.
Depends on the status code ie 301/302 307/307 etc the ttl of the cached location would be decides.
The basic idea is to use either redis or memcached  on another key-value DB to persist the Location response.
(This key-value DB would only be a "cache" with a ttl)

For a 301 the basic assumption is that the Location header contains the static/permanent redirection.
For a 302 it's not a static, I think it's important to have the status code sent to the helper.

About the http_reply_access, I actually forgot it exists and indeed it makes more sense...

I am working on an example.
Eliezer

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Alex Rousskov
Sent: Monday, May 24, 2021 9:26 PM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] allow request to cloudfront after 302 redirection.

On 5/24/21 5:52 AM, Eliezer Croitoru wrote:

> Following up this thread I was wondering about an example how to do
> that with an external_acl helper. With ICAP I can do that easily to
> some degree. With an external_acl helper I am not sure what values to
> send.

AFAICT, the external ACL helper(s) should be sent the Location URI
values the helper(s) should cache (at response time) and the request URI
values the helper(s) should examine (at request time). More information
may be sent/cached, of course, depending on the exact decision logic.


> I would guess that the response code and response Location header
> might be the ones which should be passed to the helper?

I do not see the value in sending the response status code (because
Squid can check that itself), but the correct answer depends on the
exact decision logic.


> What do you think about the next acls, should do the trick?

> acl redirect http_status 301-308
> acl gitlab_package dstdomain package.gitlab.com

> external_acl_type openlocation children=15 %DST %SRC %<{Location} /usr/local/bin/location-openner.rb
> acl location_openner external openlocation
> http_access deny gitlab_package redirect location_openner
> http_access allow location_openner

The above sketch does not make sense to me because it uses response
information (e.g., %<h{Location}) in a request-time directive (i.e.
http_access). FWIW, I would expect something along these lines:

  http_access allow toPreviouslySeenLocation

  http_reply_access allow isRedirect storeSeenLocation
  http_reply_access allow all

... where toPreviouslySeenLocation and storeSeenLocation are external
ACLs (using one shared or two dedicated external ACL helpers).
storeSeenLocation always matches and is used for its side effect.


HTH,

Alex.


> -----Original Message-----
> From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Alex Rousskov
> Sent: Wednesday, April 21, 2021 8:49 PM
> To: squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] allow request to cloudfront after 302 redirection.
> 
> On 4/21/21 12:48 PM, Miroslaw Malinowski wrote:
>> Is it possible to create a whitelist that allows cloudfront 302
>> redirections, e.g. gitlab is using cloudfront as CDN and when we
>> whitelist package.gitlab.com the URL is redirected (302) to
>> https://d20rj4el6vkp4c.cloudfront.net/7/11/ubuntu/package_files/35938.deb?t=1619023239_a63698472b6bebeaee980e7c030632d97a29c15d
> 
> 
> Yes, it is possible to allow future requests to Location-listed URLs,
> but since we are talking about two (or more) independent HTTP
> transactions, on two (or more) TCP connections, you will need to store
> the allowed Location values (at least) somewhere, maintain that storage
> (e.g., remove stale entries), and (optionally) determine whether the
> request for an allowed cloudfront URL came from the same user agent as
> the gitlab request that was redirected to that URL.
> 
> Storing, maintenance, and checking of allowed Locations/etc. can be done
> using external ACLs and/or eCAP/ICAP adaptation services. It cannot be
> reliably done using built-in ACLs alone AFAICT.
> 
> 
> HTH,
> 
> Alex.
> 
> 
>> I could whitelist a whole .cloudfront.net <http://cloudfront.net> domain
>> or url_regex, but what I would like to achieve, I don't know if
>> possible, is a chain of events like:
>> If packages.gitlab.com <http://packages.gitlab.com> return 302 Location
>> .cloudfront, then allow
>> https://d20rj4el6vkp4c.cloudfront.net/7/11/ubuntu/package_files/35938.deb?t=1619023239_a63698472b6bebeaee980e7c030632d97a29c
>> <https://d20rj4el6vkp4c.cloudfront.net/7/11/ubuntu/package_files/35938.deb?t=1619023239_a63698472b6bebeaee980e7c030632d97a29c>
>> request.
>> I've been playing around with http_reply_access and rep_headers, but I
>> can only go as far as allow replay of the first request to
>> package.gitlab.com <http://package.gitlab.com>, but then a GET to
>> cloudfront is blocked anyway as it's not on our whitelist.
>> e.g.
>> 1619022938.916   423 172.16.230.237 NONE/200 0 CONNECT 54.153.54.194:443
>> <http://54.153.54.194:443> - ORIGINAL_DST/54.153.54.194
>> <http://54.153.54.194> -
>> 1619022939.074   153 172.16.230.237 TCP_MISS/302 758 GET
>> https://packages.gitlab.com/gitlab/gitlab-ee/packages/ubuntu/bionic/gitlab-ee_11.0.1-ee.0_amd64.deb/download.deb
>> <https://packages.gitlab.com/gitlab/gitlab-ee/packages/ubuntu/bionic/gitlab-ee_11.0.1-ee.0_amd64.deb/download.deb>
>> - ORIGINAL_DST/54.153.54.194 <http://54.153.54.194> text/html
>> 1619022939.108    20 172.16.230.237 NONE/200 0 CONNECT 52.84.90.34:443
>> <http://52.84.90.34:443> - ORIGINAL_DST/52.84.90.34 <http://52.84.90.34> -
>> 1619022939.114     2 172.16.230.237 TCP_DENIED/403 19053 GET
>> https://d20rj4el6vkp4c.cloudfront.net/7/11/ubuntu/package_files/35938.deb <https://d20rj4el6vkp4c.cloudfront.net/7/11/ubuntu/package_files/35938.deb>?
>> - HIER_NONE/- text/html
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 

_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From guy20034u at yahoo.com  Thu May 27 19:14:51 2021
From: guy20034u at yahoo.com (simon ben)
Date: Thu, 27 May 2021 19:14:51 +0000 (UTC)
Subject: [squid-users] How to forward squid access.log to a remote server
References: <206480343.487402.1622142891469.ref@mail.yahoo.com>
Message-ID: <206480343.487402.1622142891469@mail.yahoo.com>

Dear All,
I have the below working perfectly

Centos 8 X64squid-4.11-3
I need to forward the squid access.log to a remote Log ServerAppreciate if some can help and advise.

Thanks and regards
simon




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210527/8df60811/attachment.htm>

From odhiambo at gmail.com  Thu May 27 20:51:26 2021
From: odhiambo at gmail.com (Odhiambo Washington)
Date: Thu, 27 May 2021 23:51:26 +0300
Subject: [squid-users] How to forward squid access.log to a remote server
In-Reply-To: <206480343.487402.1622142891469@mail.yahoo.com>
References: <206480343.487402.1622142891469.ref@mail.yahoo.com>
 <206480343.487402.1622142891469@mail.yahoo.com>
Message-ID: <CAAdA2WO4BhbD_X3ND3t=qm_GR+syEs-mX=yqpQ8A_0O26KPFBQ@mail.gmail.com>

On Thu, May 27, 2021 at 10:15 PM simon ben <guy20034u at yahoo.com> wrote:

> Dear All,
>
> I have the below working perfectly
>
> Centos 8 X64
> squid-4.11-3
>
> I need to forward the squid access.log to a remote Log Server
> Appreciate if some can help and advise.
>
>
> Thanks and regards
> <http://lists.squid-cache.org/listinfo/squid-users>


Something like:

access_log syslog:local2 squid

Then from syslog, send local2 to a remote log server, no?

-- 
Best regards,
Odhiambo WASHINGTON,
Nairobi,KE
+254 7 3200 0004/+254 7 2274 3223
"Oh, the cruft.", egrep -v "^$|^.*#" :-)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210527/42d55ce6/attachment.htm>

From ambrose.li at gmail.com  Thu May 27 21:28:59 2021
From: ambrose.li at gmail.com (Ambrose Li)
Date: Thu, 27 May 2021 17:28:59 -0400
Subject: [squid-users] How to forward squid access.log to a remote server
In-Reply-To: <206480343.487402.1622142891469@mail.yahoo.com>
References: <206480343.487402.1622142891469.ref@mail.yahoo.com>
 <206480343.487402.1622142891469@mail.yahoo.com>
Message-ID: <20210527212859.GD13290@pingviini>

On Thu, May 27, 2021 at 07:14:51PM +0000, simon ben wrote:
> I have the below working perfectly
> 
> Centos 8 X64squid-4.11-3
> I need to forward the squid access.log to a remote Log ServerAppreciate if some can help and advise.

I'm not on squid4, but I believe you can use (for example)

access_log syslog:daemon.info squid

then can configure your local syslogd to forward the logs.


-- 
Ambrose Li <ambrose.li at gmail.com> | Time zone: GMT-4 (Eastern)
ambroseli.ca

?We need to put ourselves into positions where we are comfortable for
 being uncomfortable? ? Gaby Brink [AIGA Gain, 2012]



From squid3 at treenet.co.nz  Fri May 28 02:12:13 2021
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 28 May 2021 14:12:13 +1200
Subject: [squid-users] How to forward squid access.log to a remote server
In-Reply-To: <20210527212859.GD13290@pingviini>
References: <206480343.487402.1622142891469.ref@mail.yahoo.com>
 <206480343.487402.1622142891469@mail.yahoo.com>
 <20210527212859.GD13290@pingviini>
Message-ID: <39802a86-cc8d-62ea-8ca1-cfd2c7980eae@treenet.co.nz>

On 28/05/21 9:28 am, Ambrose Li wrote:
> On Thu, May 27, 2021 at 07:14:51PM +0000, simon ben wrote:
>> I have the below working perfectly
>>
>> Centos 8 X64squid-4.11-3
>> I need to forward the squid access.log to a remote Log ServerAppreciate if some can help and advise.
> 
> I'm not on squid4, but I believe you can use (for example)
> 
> access_log syslog:daemon.info squid
> 
> then can configure your local syslogd to forward the logs.
> 

Or any of the other logging modules available. TCP stream, UDP, daemon 
that records to any other protocol or API the remote server uses.
  <https://wiki.squid-cache.org/Features/LogModules>


Amos


From squid3 at treenet.co.nz  Fri May 28 02:21:10 2021
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 28 May 2021 14:21:10 +1200
Subject: [squid-users] changing squid explicit mode to transparent mode
In-Reply-To: <1041070972.362583.1622104990514@mail.yahoo.com>
References: <1041070972.362583.1622104990514.ref@mail.yahoo.com>
 <1041070972.362583.1622104990514@mail.yahoo.com>
Message-ID: <ac3fdd44-753f-3059-bad5-f39332c32ef4@treenet.co.nz>

On 27/05/21 8:43 pm, simon ben wrote:
> Dear All,
> 
> I have the below setup running perfectly for a couple of years
> 
> Centos 8 X64
> squid-4.11-3
> 
> configured in explicit mode so all client machines have the proxy IP 
> configured in their browser
> 
> Recently we have got a security cloud solution which requires the source 
> IP of the client machine
> 

Okay. Have you looked into the ways it will accept that IP address?

Does it actually require direct connections from each client?
   In that case you need to use TPROXY feature.

Otherwise,

You may be able to simply send a custom header containing the client's 
IP. "Forwarded:" is the standard header for that use, there are also 
many application-specific headers names around.


> Since I have to configure the squid in transparent mode so the client 
> source IP is visible and as required for transparent mode config i need 
> to change the gateway to my squid server IP .
> 
> 1 ) Is there any way so that I retain the source client PC IP in the 
> current setup ????

Please define "retain".


> 
> 2 ) if only way possible is by reconfiguring? my current proxy to  
> transparent mode then if there is some way without changing the client 
> pc Gateway
> Right Now the default gateway of the client PC is our Core switch vlan 
> ip address.
> 

Any commercial router should provide capabilities to *route* client 
packets to Squid machine and Squid's outbound to wherever they need to go.

Note that doing it this way can *double* or even triple the amount of 
traffic load that switch is handling when Squid is in the same subnet as 
the clients.


Amos


From lbrtchx at gmail.com  Fri May 28 17:42:32 2021
From: lbrtchx at gmail.com (Albretch Mueller)
Date: Fri, 28 May 2021 13:42:32 -0400
Subject: [squid-users] manual proxy configuration ...
In-Reply-To: <20210527075548.GA11861@fantomas.sk>
References: <CAFakBwg=yD3JWLfD0s+WsuaKmEzp-863WrE8QLpmkfY1P7c+dw@mail.gmail.com>
 <-bz4tx9po45wq-rfeqxh450vfb-jk4dprfbigkgsijevaov9xw18tqj332ui0tt-6jgm167686jn7zxjk60ulbf36q5bn-xw1eg9fkvgz8-aw8mm8-f3yc46-xj7nicgamyus-lhf3k8e1hnqsb3qey6.1621981599992@email.android.com>
 <CAFakBwjb1KbJbh0JeQodfR8jeoZPVhQ4U2_O4Kx304amVnHTUQ@mail.gmail.com>
 <20210527075548.GA11861@fantomas.sk>
Message-ID: <CAFakBwiEZjgS9u2Ueiev1kiKnk8Tk+U+N9uAAUOUEZQfXNmfwA@mail.gmail.com>

On 5/27/21, Matus UHLAR - fantomas <uhlar at fantomas.sk> wrote:
>>On 5/25/21, ?Amos Jeffries? <squid3 at treenet.co.nz> wrote:
>>> You enter the IP address or hostname of the squid machine into the
>>> browser
>>> "proxy settings" for manual configuration.
>
> On 27.05.21 03:50, Albretch Mueller wrote:
>> Yeah, exactly! and how do you know the IP address or hostname?
>
> it's your or your organizations proxy - you are supposed to know that, not
> us.

 I thought I was going to get droned for "not doing what I was
supposed to do" (tm)

>> What line in the conf file specifies that?
> each browser has its own way of proxy settings.
> Many of them support "system proxy settings".

 I am talking here about the squid conf file not the browser's and I
am asking because I have reasons to be believe something fishy to be
going on with the computer I expose to the Internet.

 lbrtchx


From lbrtchx at gmail.com  Fri May 28 17:44:14 2021
From: lbrtchx at gmail.com (Albretch Mueller)
Date: Fri, 28 May 2021 13:44:14 -0400
Subject: [squid-users] manual proxy configuration ...
In-Reply-To: <CAFakBwiEZjgS9u2Ueiev1kiKnk8Tk+U+N9uAAUOUEZQfXNmfwA@mail.gmail.com>
References: <CAFakBwg=yD3JWLfD0s+WsuaKmEzp-863WrE8QLpmkfY1P7c+dw@mail.gmail.com>
 <-bz4tx9po45wq-rfeqxh450vfb-jk4dprfbigkgsijevaov9xw18tqj332ui0tt-6jgm167686jn7zxjk60ulbf36q5bn-xw1eg9fkvgz8-aw8mm8-f3yc46-xj7nicgamyus-lhf3k8e1hnqsb3qey6.1621981599992@email.android.com>
 <CAFakBwjb1KbJbh0JeQodfR8jeoZPVhQ4U2_O4Kx304amVnHTUQ@mail.gmail.com>
 <20210527075548.GA11861@fantomas.sk>
 <CAFakBwiEZjgS9u2Ueiev1kiKnk8Tk+U+N9uAAUOUEZQfXNmfwA@mail.gmail.com>
Message-ID: <CAFakBwgSZoAejnW26U0vYO-QKc4WU_=6c_w3WLE7LW6ErSskGQ@mail.gmail.com>

> ... I have reasons to be believe something fishy to be going on with the computer I expose to the Internet.

 You could not write/paste in a value in the corresponding text box in
the browser's config settings

 lbrtchx


From lbrtchx at gmail.com  Fri May 28 22:14:24 2021
From: lbrtchx at gmail.com (Albretch Mueller)
Date: Fri, 28 May 2021 18:14:24 -0400
Subject: [squid-users] manual proxy configuration ...
In-Reply-To: <CAFakBwgSZoAejnW26U0vYO-QKc4WU_=6c_w3WLE7LW6ErSskGQ@mail.gmail.com>
References: <CAFakBwg=yD3JWLfD0s+WsuaKmEzp-863WrE8QLpmkfY1P7c+dw@mail.gmail.com>
 <-bz4tx9po45wq-rfeqxh450vfb-jk4dprfbigkgsijevaov9xw18tqj332ui0tt-6jgm167686jn7zxjk60ulbf36q5bn-xw1eg9fkvgz8-aw8mm8-f3yc46-xj7nicgamyus-lhf3k8e1hnqsb3qey6.1621981599992@email.android.com>
 <CAFakBwjb1KbJbh0JeQodfR8jeoZPVhQ4U2_O4Kx304amVnHTUQ@mail.gmail.com>
 <20210527075548.GA11861@fantomas.sk>
 <CAFakBwiEZjgS9u2Ueiev1kiKnk8Tk+U+N9uAAUOUEZQfXNmfwA@mail.gmail.com>
 <CAFakBwgSZoAejnW26U0vYO-QKc4WU_=6c_w3WLE7LW6ErSskGQ@mail.gmail.com>
Message-ID: <CAFakBwiHvd+RdkBJyhV4c0F=aiGw8B9xAHzDFD-RZdhzoYZ4xA@mail.gmail.com>

 As I expect and suspected my exposed box had been compromised. I used
a knoppix DVD they can't write to/effing alter  it for physical
reasons. Their efforts would be futile, senseless.

 If I get the time I will write up a nicer document, but since I do
believe in karma I want to help other people running into the same
problem

// __ download squid and check the md5 and sha1 hashsums

 http://www.squid-cache.org/Download/
 http://www.squid-cache.org/Versions/
 Stable Versions (right now):

 http://www.squid-cache.org/Versions/v4/
~
// __ untar and gunzip the sources

 ...
~
// __ compilation of sources based on

 https://wiki.squid-cache.org/SquidFaq/CompilingSquid

_PRFX="<wherever you want to install squid on a permanent drive>"

_VER="squid-4.15" # used as prefix for log files

cd "${_VER}"
pwd

_DT=$(date +%Y%m%d%H%M%S)
_LOG_FL="${_VER}_configure_${_DT}.log"
echo "// __ \$_LOG_FL: |${_LOG_FL}|"

time(
./configure --prefix="${_PRFX}" \
            --localstatedir="${_PRFX}/var" \
            --libexecdir="${prefix}/lib/squid3" \
            --datadir="${prefix}/share/squid3" \
            --sysconfdir="${_PRFX}/etc/squid3" \
            --with-default-user=proxy \
            --with-logdir="${_PRFX}/var/log/squid3" \
            --with-pidfile="${_PRFX}/var/run/squid3.pid" >>  "${_LOG_FL}" 2>&1
) 2>> "${_LOG_FL}"
echo "~" >> "${_LOG_FL}"


// __ running: make

_DT=$(date +%Y%m%d%H%M%S)
_LOG_FL="${_VER}_make_${_DT}.log"
echo "// __ \$_LOG_FL: |${_LOG_FL}|"

echo "// __ make -j1:" >> "${_LOG_FL}"
echo " " >> "${_LOG_FL}"
time(make -j1 >> "${_LOG_FL}" 2>&1) 2>> "${_LOG_FL}"
echo "~" >> "${_LOG_FL}"

tail -n 10 "${_LOG_FL}"

// __ running: sudo make install

_DT=$(date +%Y%m%d%H%M%S)
_LOG_FL="${_VER}_make_install_${_DT}.log"
echo "// __ \$_LOG_FL: |${_LOG_FL}|"

echo "// __ make install:" >> "${_LOG_FL}"
echo " " >> "${_LOG_FL}"
time(sudo make install >> "${_LOG_FL}" 2>&1) 2>> "${_LOG_FL}"
echo "~" >> "${_LOG_FL}"

tail -n 10 "${_LOG_FL}"
~
// __ reaching out to your install base

_SQUID3_HOME="/media/knoppix/squid3/4.15/"
PATH="${_SQUID3_HOME}/sbin:$PATH"

which squid

squid --version

$ which squid
/media/knoppix/squid3/4.15/sbin/squid

$ squid --version
Squid Cache: Version 4.15
Service Name: squid
configure options:  '--prefix=/media/knoppix/squid3/4.15'
'--localstatedir=/media/knoppix/squid3/4.15/var'
'--libexecdir=/lib/squid3' '--datadir=/share/squid3'
'--sysconfdir=/media/knoppix/squid3/4.15/etc/squid3'
'--with-default-user=proxy'
'--with-logdir=/media/knoppix/squid3/4.15/var/log/squid3'
'--with-pidfile=/media/knoppix/squid3/4.15/var/run/squid3.pid'

$ sudo squid

...


From squid3 at treenet.co.nz  Sat May 29 02:14:13 2021
From: squid3 at treenet.co.nz (squid3 at treenet.co.nz)
Date: Sat, 29 May 2021 14:14:13 +1200
Subject: [squid-users] manual proxy configuration ...
In-Reply-To: <CAFakBwiEZjgS9u2Ueiev1kiKnk8Tk+U+N9uAAUOUEZQfXNmfwA@mail.gmail.com>
References: <CAFakBwg=yD3JWLfD0s+WsuaKmEzp-863WrE8QLpmkfY1P7c+dw@mail.gmail.com>
 <-bz4tx9po45wq-rfeqxh450vfb-jk4dprfbigkgsijevaov9xw18tqj332ui0tt-6jgm167686jn7zxjk60ulbf36q5bn-xw1eg9fkvgz8-aw8mm8-f3yc46-xj7nicgamyus-lhf3k8e1hnqsb3qey6.1621981599992@email.android.com>
 <CAFakBwjb1KbJbh0JeQodfR8jeoZPVhQ4U2_O4Kx304amVnHTUQ@mail.gmail.com>
 <20210527075548.GA11861@fantomas.sk>
 <CAFakBwiEZjgS9u2Ueiev1kiKnk8Tk+U+N9uAAUOUEZQfXNmfwA@mail.gmail.com>
Message-ID: <75a489aa7216c5adab9e1baa5688d111@treenet.co.nz>

On 2021-05-29 05:42, Albretch Mueller wrote:
> On 5/27/21, Matus UHLAR - fantomas wrote:
>>> On 5/25/21, ?Amos Jeffries? wrote:
>>>> You enter the IP address or hostname of the squid machine into the
>>>> browser
>>>> "proxy settings" for manual configuration.
>> 
>> On 27.05.21 03:50, Albretch Mueller wrote:
>>> Yeah, exactly! and how do you know the IP address or hostname?
>> 
>> it's your or your organizations proxy - you are supposed to know that, 
>> not
>> us.
> 
>  I thought I was going to get droned for "not doing what I was
> supposed to do" (tm)
> 

Well. These are part of the basics needed to get a networked computer 
running.
You said you already had Squid running and in use. That makes us assume 
you know these basics already, but haven't mentioned them.


>>> What line in the conf file specifies that?
>> each browser has its own way of proxy settings.
>> Many of them support "system proxy settings".
> 
>  I am talking here about the squid conf file not the browser's and I


Squid is normally just configured with an "http_port 3128" or similar to 
receive traffic.

There *might* be an IP address there as well, or a hostname. But usually 
not. It is the network DHCP or machines network interface which 
determines the IP address Squid gets to use.



> am asking because I have reasons to be believe something fishy to be
> going on with the computer I expose to the Internet.


Aha. Finally an indication of what the real situation is. Its REALLY 
hard to help people who leave out important details all the time.


Amos


From lbrtchx at gmail.com  Sat May 29 09:45:07 2021
From: lbrtchx at gmail.com (Albretch Mueller)
Date: Sat, 29 May 2021 05:45:07 -0400
Subject: [squid-users] manual proxy configuration ...
In-Reply-To: <75a489aa7216c5adab9e1baa5688d111@treenet.co.nz>
References: <CAFakBwg=yD3JWLfD0s+WsuaKmEzp-863WrE8QLpmkfY1P7c+dw@mail.gmail.com>
 <-bz4tx9po45wq-rfeqxh450vfb-jk4dprfbigkgsijevaov9xw18tqj332ui0tt-6jgm167686jn7zxjk60ulbf36q5bn-xw1eg9fkvgz8-aw8mm8-f3yc46-xj7nicgamyus-lhf3k8e1hnqsb3qey6.1621981599992@email.android.com>
 <CAFakBwjb1KbJbh0JeQodfR8jeoZPVhQ4U2_O4Kx304amVnHTUQ@mail.gmail.com>
 <20210527075548.GA11861@fantomas.sk>
 <CAFakBwiEZjgS9u2Ueiev1kiKnk8Tk+U+N9uAAUOUEZQfXNmfwA@mail.gmail.com>
 <75a489aa7216c5adab9e1baa5688d111@treenet.co.nz>
Message-ID: <CAFakBwjGGeL-Dmys335+VB6WU3PKLEL02Em-M+iuHUqB4A9SgA@mail.gmail.com>

On 5/28/21, squid3 at treenet.co.nz <squid3 at treenet.co.nz> wrote:
>> am asking because I have reasons to be believe something fishy to be
>> going on with the computer I expose to the Internet.
>
>
> Aha. Finally an indication of what the real situation is. Its REALLY
> hard to help people who leave out important details all the time.

 I still can't understand what the big deal is. The port is defined on
the one liner which attribute name is "http_port"

 cat "/etc/squid/squid.conf" | grep http_port | grep --invert-match "^#"
http_port 3128

 The value 3128 you enter on your network browser settings

 what I need now is the name of the running listening service which
you can get via:

 netstat -tl

 but I couldn't get squid running apparently due to problems related
to using a prefix other than its default:

$ which squid
/media/knoppix/squid3/4.15/sbin/squid

$ squid start
2021/05/29 15:33:48| ERROR: unlinkd_program /lib/squid3/unlinkd: (2)
No such file or directory
2021/05/29 15:33:48| FATAL: unlinkd_program /lib/squid3/unlinkd: (2)
No such file or directory
2021/05/29 15:33:48| Squid Cache (Version 4.15): Terminated abnormally.
CPU Usage: 0.016 seconds = 0.010 user + 0.006 sys
Maximum Resident Size: 33696 KB
Page faults with physical i/o: 0
$

 how can I fix such problems?

 lbrtchx


From Antony.Stone at squid.open.source.it  Sat May 29 09:57:43 2021
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Sat, 29 May 2021 11:57:43 +0200
Subject: [squid-users] manual proxy configuration ...
In-Reply-To: <CAFakBwjGGeL-Dmys335+VB6WU3PKLEL02Em-M+iuHUqB4A9SgA@mail.gmail.com>
References: <CAFakBwg=yD3JWLfD0s+WsuaKmEzp-863WrE8QLpmkfY1P7c+dw@mail.gmail.com>
 <75a489aa7216c5adab9e1baa5688d111@treenet.co.nz>
 <CAFakBwjGGeL-Dmys335+VB6WU3PKLEL02Em-M+iuHUqB4A9SgA@mail.gmail.com>
Message-ID: <202105291157.43752.Antony.Stone@squid.open.source.it>

On Saturday 29 May 2021 at 11:45:07, Albretch Mueller wrote:

> cat "/etc/squid/squid.conf" | grep http_port | grep --invert-match "^#"
> http_port 3128

That could more briefly be done as "grep ^http_port /etc/squid/squid.conf"

> The value 3128 you enter on your network browser settings
> 
> what I need now is the name of the running listening service which
> you can get via:
> 
> netstat -tl

It's the same thing: 3128.

> but I couldn't get squid running apparently due to problems related
> to using a prefix other than its default:
> 
> $ which squid
> /media/knoppix/squid3/4.15/sbin/squid

>  how can I fix such problems?

I think this is a question for the Knoppix packagers; we don't know what they 
did to break Squid in this way.


Antony.

-- 
Numerous psychological studies over the years have demonstrated that the 
majority of people genuinely believe they are not like the majority of people.

                                                   Please reply to the list;
                                                         please *don't* CC me.


From uhlar at fantomas.sk  Sat May 29 10:23:08 2021
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Sat, 29 May 2021 12:23:08 +0200
Subject: [squid-users] manual proxy configuration ...
In-Reply-To: <CAFakBwjGGeL-Dmys335+VB6WU3PKLEL02Em-M+iuHUqB4A9SgA@mail.gmail.com>
References: <CAFakBwg=yD3JWLfD0s+WsuaKmEzp-863WrE8QLpmkfY1P7c+dw@mail.gmail.com>
 <-bz4tx9po45wq-rfeqxh450vfb-jk4dprfbigkgsijevaov9xw18tqj332ui0tt-6jgm167686jn7zxjk60ulbf36q5bn-xw1eg9fkvgz8-aw8mm8-f3yc46-xj7nicgamyus-lhf3k8e1hnqsb3qey6.1621981599992@email.android.com>
 <CAFakBwjb1KbJbh0JeQodfR8jeoZPVhQ4U2_O4Kx304amVnHTUQ@mail.gmail.com>
 <20210527075548.GA11861@fantomas.sk>
 <CAFakBwiEZjgS9u2Ueiev1kiKnk8Tk+U+N9uAAUOUEZQfXNmfwA@mail.gmail.com>
 <75a489aa7216c5adab9e1baa5688d111@treenet.co.nz>
 <CAFakBwjGGeL-Dmys335+VB6WU3PKLEL02Em-M+iuHUqB4A9SgA@mail.gmail.com>
Message-ID: <20210529102307.GA23704@fantomas.sk>

>>> am asking because I have reasons to be believe something fishy to be
>>> going on with the computer I expose to the Internet.

>On 5/28/21, squid3 at treenet.co.nz <squid3 at treenet.co.nz> wrote:
>> Aha. Finally an indication of what the real situation is. Its REALLY
>> hard to help people who leave out important details all the time.

On 29.05.21 05:45, Albretch Mueller wrote:
> I still can't understand what the big deal is. The port is defined on
>the one liner which attribute name is "http_port"
>
> cat "/etc/squid/squid.conf" | grep http_port | grep --invert-match "^#"
>http_port 3128

standard port for squid, makes squid listen on port 3128 of all available
interfaces.
If that's your local machine, localhost (3128) is one of those and if you
want to stop others from accessing it, you can configure

http_port localhost:3128


> The value 3128 you enter on your network browser settings

> what I need now is the name of the running listening service which
>you can get via:
>
> netstat -tl
>
> but I couldn't get squid running apparently due to problems related
>to using a prefix other than its default:
>
>$ which squid
>/media/knoppix/squid3/4.15/sbin/squid
>
>$ squid start
>2021/05/29 15:33:48| ERROR: unlinkd_program /lib/squid3/unlinkd: (2)
>No such file or directory
>2021/05/29 15:33:48| FATAL: unlinkd_program /lib/squid3/unlinkd: (2)
>No such file or directory
>2021/05/29 15:33:48| Squid Cache (Version 4.15): Terminated abnormally.
>CPU Usage: 0.016 seconds = 0.010 user + 0.006 sys
>Maximum Resident Size: 33696 KB
>Page faults with physical i/o: 0
>$
>
> how can I fix such problems?

it's possible that squid was compiled without unlinkd support. In such case,
you don't need that directive.

we can guess that unlinkd lives in /media/knoppix/squid3/4.15/sbin/unlinkd 
or somewhere under /media/knoppix/squid3/4.15 directory
 

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
- Holmes, what kind of school did you study to be a detective?
- Elementary, Watkins.  -- Daffy Duck & Porky Pig


From lbrtchx at gmail.com  Sat May 29 11:36:35 2021
From: lbrtchx at gmail.com (Albretch Mueller)
Date: Sat, 29 May 2021 07:36:35 -0400
Subject: [squid-users] manual proxy configuration ...
In-Reply-To: <20210529102307.GA23704@fantomas.sk>
References: <CAFakBwg=yD3JWLfD0s+WsuaKmEzp-863WrE8QLpmkfY1P7c+dw@mail.gmail.com>
 <-bz4tx9po45wq-rfeqxh450vfb-jk4dprfbigkgsijevaov9xw18tqj332ui0tt-6jgm167686jn7zxjk60ulbf36q5bn-xw1eg9fkvgz8-aw8mm8-f3yc46-xj7nicgamyus-lhf3k8e1hnqsb3qey6.1621981599992@email.android.com>
 <CAFakBwjb1KbJbh0JeQodfR8jeoZPVhQ4U2_O4Kx304amVnHTUQ@mail.gmail.com>
 <20210527075548.GA11861@fantomas.sk>
 <CAFakBwiEZjgS9u2Ueiev1kiKnk8Tk+U+N9uAAUOUEZQfXNmfwA@mail.gmail.com>
 <75a489aa7216c5adab9e1baa5688d111@treenet.co.nz>
 <CAFakBwjGGeL-Dmys335+VB6WU3PKLEL02Em-M+iuHUqB4A9SgA@mail.gmail.com>
 <20210529102307.GA23704@fantomas.sk>
Message-ID: <CAFakBwg1iC7MMfFWQF8qgOTg+OqbBt6CLo-owOOF0SH5sR6SWw@mail.gmail.com>

On 5/29/21, Antony Stone <Antony.Stone at squid.open.source.it> wrote:
> I think this is a question for the Knoppix packagers; we don't know what
> they
> did to break Squid in this way.

 OK, I will try all the steps again but first I will remove the
installed squid version that comes with knoppix

On 5/29/21, Matus UHLAR - fantomas <uhlar at fantomas.sk> wrote:
> standard port for squid, makes squid listen on port 3128 of all available
> interfaces.
> If that's your local machine, localhost (3128) is one of those and if you
> want to stop others from accessing it, you can configure
>
> http_port localhost:3128

 Thank you, I will try that.

> it's possible that squid was compiled without unlinkd support. In such case,
> you don't need that directive.
>
> we can guess that unlinkd lives in /media/knoppix/squid3/4.15/sbin/unlinkd
> or somewhere under /media/knoppix/squid3/4.15 directory

 from:

 https://www.oreilly.com/library/view/squid-the-definitive/0596001622/re58.html

 Name: unlinkd_program

 Synopsis: This is the pathname to the unlinkd program. By executing
the unlink operations in this external process, Squid?s performance
improves significantly. You can disable the external unlinker with the
?disable-unlinkd option to ./configure.

 Default: unlinkd_program $prefix/libexec/unlinkd
~
 but in my $prefix I don't see that folder:

$ pwd
/media/knoppix//squid3/4.15

$ ls -l
total 0
drwxrwxrwx 1 root root 0 May 29 03:16 bin
drwxrwxrwx 1 root root 0 May 29 03:14 etc
drwxrwxrwx 1 root root 0 May 29 03:16 sbin
drwxrwxrwx 1 root root 0 May 29 03:16 share
drwxrwxrwx 1 root root 0 May 29 03:16 var
$

 so what could the problem be? Why doesn't squid look into the path I
defined as prefix?

 lbrtchx


From alleinerwolf at gmail.com  Mon May 31 01:02:52 2021
From: alleinerwolf at gmail.com (Alex Irmel Oviedo Solis)
Date: Sun, 30 May 2021 20:02:52 -0500
Subject: [squid-users] Problems with whatsapp
Message-ID: <CAKZ77-8NSnvqjWAsEjzaiK5VLfwcS=aPJ8BDYyJiqeZO=0_Kmw@mail.gmail.com>

Good night, I'm having problems with a transparent squid proxy (with
squidGuard enabled). Whatsapp's web client doesn't work, I tried to add an
exclusion to SSL Bump following this manual
https://wiki.squid-cache.org/ConfigExamples/Chat/Whatsapp, but still not
working.

Are there any way to probe or debug if this exclusion is working?

-- 
*"Una alegr?a compartida se transforma en doble alegr?a; una pena
compartida, en media pena."*
--> http://www.alexove.me <http://www.alexove.me/>
--> Celular (Movistar): +51-959-625-001
--> Sigueme en Twitter: http://twitter.com/alexove_pe
--> Perfil: http://fedoraproject.org/wiki/user:alexove
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210530/4fd19b38/attachment.htm>

From ngtech1ltd at gmail.com  Mon May 31 03:18:58 2021
From: ngtech1ltd at gmail.com (NgTech LTD)
Date: Mon, 31 May 2021 06:18:58 +0300
Subject: [squid-users] Problems with whatsapp
In-Reply-To: <CAKZ77-8NSnvqjWAsEjzaiK5VLfwcS=aPJ8BDYyJiqeZO=0_Kmw@mail.gmail.com>
References: <CAKZ77-8NSnvqjWAsEjzaiK5VLfwcS=aPJ8BDYyJiqeZO=0_Kmw@mail.gmail.com>
Message-ID: <CABA8h=STimOZJD9+oj+tJCtaSNMuzjo1a8v4-8zvz=_yriq_kA@mail.gmail.com>

Hey,

can you please share your squid.conf (Excluded sensitive details) so we can
try to recommend a solution?

?????? ??? ??, 31 ???? 2021, 4:03, ??? Alex Irmel Oviedo Solis ?<
alleinerwolf at gmail.com>:

> Good night, I'm having problems with a transparent squid proxy (with
> squidGuard enabled). Whatsapp's web client doesn't work, I tried to add an
> exclusion to SSL Bump following this manual
> https://wiki.squid-cache.org/ConfigExamples/Chat/Whatsapp, but still not
> working.
>
> Are there any way to probe or debug if this exclusion is working?
>
> --
> *"Una alegr?a compartida se transforma en doble alegr?a; una pena
> compartida, en media pena."*
> --> http://www.alexove.me <http://www.alexove.me/>
> --> Celular (Movistar): +51-959-625-001
> --> Sigueme en Twitter: http://twitter.com/alexove_pe
> --> Perfil: http://fedoraproject.org/wiki/user:alexove
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210531/48841a5d/attachment.htm>

From alleinerwolf at gmail.com  Mon May 31 15:12:42 2021
From: alleinerwolf at gmail.com (Alex Irmel Oviedo Solis)
Date: Mon, 31 May 2021 10:12:42 -0500
Subject: [squid-users] Problems with whatsapp
In-Reply-To: <CABA8h=STimOZJD9+oj+tJCtaSNMuzjo1a8v4-8zvz=_yriq_kA@mail.gmail.com>
References: <CAKZ77-8NSnvqjWAsEjzaiK5VLfwcS=aPJ8BDYyJiqeZO=0_Kmw@mail.gmail.com>
 <CABA8h=STimOZJD9+oj+tJCtaSNMuzjo1a8v4-8zvz=_yriq_kA@mail.gmail.com>
Message-ID: <CAKZ77--zc3mCaVLMVqrgjbpZ8+FvmYM-WRZ=QALJgOJ8hhKjgg@mail.gmail.com>

Thanks,
# Begin of "/etc/squid/squid.conf"
acl localnet src 192.168.15.0/24

acl SSL_ports port 8443
acl SSL_ports port 443
acl SSL_ports port 563
acl SSL_ports port 22
acl SSL_ports port 21
acl SSL_ports port 8081
acl SSL_ports port 3478
acl SSL_ports port 563
acl SSL_ports port 8085
acl SSL_ports port 2083
acl SSL_ports port 2221
acl SSL_ports port 2222
acl SSL_ports port 950
acl SSL_ports port 10443
acl SSL_ports port 23389
acl SSL_ports port 5222
acl SSL_ports port 9090
acl SSL_ports port 7792
acl SSL_ports port 2222
acl SSL_ports port 8443
acl SSL_ports port 2223
acl SSL_ports port 90
acl SSL_ports port 19305

acl Safe_ports port 20
acl Safe_ports port 21
acl Safe_ports port 22
acl Safe_ports port 70
acl Safe_ports port 80
acl Safe_ports port 90
acl Safe_ports port 210
acl Safe_ports port 280
acl Safe_ports port 443
acl Safe_ports port 488
acl Safe_ports port 563
acl Safe_ports port 591
acl Safe_ports port 631
acl Safe_ports port 777
acl Safe_ports port 901
acl Safe_ports port 950
acl Safe_ports port 1025-65535

acl CONNECT method CONNECT

http_access deny !Safe_ports

http_access deny CONNECT !SSL_ports

http_access allow localhost manager
http_access deny manager

http_access allow localnet
http_access allow localhost

http_access deny all

http_port 3128 ssl-bump cert=/etc/squid/certs/squid-ca-cert-key.pem
generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
http_port 3129  intercept ssl-bump
cert=/etc/squid/certs/squid-ca-cert-key.pem generate-host-certificates=on
dynamic_cert_mem_cache_size=4MB
https_port 3130  intercept ssl-bump
cert=/etc/squid/certs/squid-ca-cert-key.pem generate-host-certificates=on
dynamic_cert_mem_cache_size=16MB

acl DiscoverSNIHost at_step SslBump1
acl NoSSLIntercept ssl::server_name_regex "/etc/squid/acl.url.nobump"

ssl_bump peek DiscoverSNIHost
ssl_bump splice NoSSLIntercept
ssl_bump bump all

tls_outgoing_options cafile=/etc/squid/ca-bundle.crt

sslproxy_foreign_intermediate_certs /etc/squid/certs/lets-encrypt-r3.pem
tls_outgoing_options cafile=/etc/squid/mozilla.pem

url_rewrite_program /usr/bin/squidGuard -c /etc/squid/squidGuard.conf
url_rewrite_children 64 startup=16 idle=4 concurrency=0
url_rewrite_bypass off

debug_options ALL,2

cache_dir ufs /var/spool/squid 100 16 256
coredump_dir /var/spool/squid
cache_mgr informatica at regioncusco.gob.pe

error_default_language es
dns_v4_first on

refresh_pattern ^ftp:           1440    20%     10080
refresh_pattern ^gopher:        1440    0%      1440
refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
refresh_pattern .               0       20%     4320
# End of "/etc/squid/squid.conf"

---

# Begin of "/etc/squid/acl.url.nobump"
.whatsapp\.net
(w[0-9]+[a-z]+)\.squid-cache\.org
(w[0-9]+[a-z]+)\.websocket\.org
(w[0-9]+[a-z]+)\.reniec\.gob\.pe
# End of "/etc/squid/acl.url.nobump"

El dom, 30 de may. de 2021 a la(s) 22:19, NgTech LTD (ngtech1ltd at gmail.com)
escribi?:

> Hey,
>
> can you please share your squid.conf (Excluded sensitive details) so we
> can try to recommend a solution?
>
> ?????? ??? ??, 31 ???? 2021, 4:03, ??? Alex Irmel Oviedo Solis ?<
> alleinerwolf at gmail.com>:
>
>> Good night, I'm having problems with a transparent squid proxy (with
>> squidGuard enabled). Whatsapp's web client doesn't work, I tried to add an
>> exclusion to SSL Bump following this manual
>> https://wiki.squid-cache.org/ConfigExamples/Chat/Whatsapp, but still not
>> working.
>>
>> Are there any way to probe or debug if this exclusion is working?
>>
>> --
>> *"Una alegr?a compartida se transforma en doble alegr?a; una pena
>> compartida, en media pena."*
>> --> http://www.alexove.me <http://www.alexove.me/>
>> --> Celular (Movistar): +51-959-625-001
>> --> Sigueme en Twitter: http://twitter.com/alexove_pe
>> --> Perfil: http://fedoraproject.org/wiki/user:alexove
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
>>
>

-- 
*"Una alegr?a compartida se transforma en doble alegr?a; una pena
compartida, en media pena."*
--> http://www.alexove.me <http://www.alexove.me/>
--> Celular (Movistar): +51-959-625-001
--> Sigueme en Twitter: http://twitter.com/alexove_pe
--> Perfil: http://fedoraproject.org/wiki/user:alexove
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210531/c045a333/attachment.htm>

