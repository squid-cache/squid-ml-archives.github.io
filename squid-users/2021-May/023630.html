<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users]  https_port not correctly sending ssl cert information?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%0A%20%3D%3Futf-8%3Fq%3Fhttps%3D5Fport_not_correctly_sending_ssl_c%3F%3D%0A%20%3D%3Futf-8%3Fq%3Fert_information%3D3F%3F%3D&In-Reply-To=%3Caaf9ba3f-221f-4a99-9e97-b9e2cfaa1b91%40www.fastmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023629.html">
   <LINK REL="Next"  HREF="023631.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users]  https_port not correctly sending ssl cert information?</H1>
    <B>Dan Steen</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%0A%20%3D%3Futf-8%3Fq%3Fhttps%3D5Fport_not_correctly_sending_ssl_c%3F%3D%0A%20%3D%3Futf-8%3Fq%3Fert_information%3D3F%3F%3D&In-Reply-To=%3Caaf9ba3f-221f-4a99-9e97-b9e2cfaa1b91%40www.fastmail.com%3E"
       TITLE="[squid-users]  https_port not correctly sending ssl cert information?">dan at mirageid.com
       </A><BR>
    <I>Wed May 12 01:23:49 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="023629.html">[squid-users] https_port not correctly sending ssl cert information?
</A></li>
        <LI>Next message (by thread): <A HREF="023631.html">[squid-users] https_port not correctly sending ssl cert information?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23630">[ date ]</a>
              <a href="thread.html#23630">[ thread ]</a>
              <a href="subject.html#23630">[ subject ]</a>
              <a href="author.html#23630">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Amos!

Thanks for the response!  I put my full config in that gist (<A HREF="https://gist.github.com/dansteen/c28343fd025c713bcfba8368ce2b728b">https://gist.github.com/dansteen/c28343fd025c713bcfba8368ce2b728b</A>) if that helps.  Is there something else that would be helpuful to see?  

Thanks!

On Tue, May 11, 2021, at 9:16 PM, &#8234;Amos Jeffries&#8236; wrote:
&gt;<i> The main issue you are having is that the old version had no TLS/1.3 support. The newer squid have some, but not enough for what you are doing.
</I>&gt;<i> 
</I>&gt;<i> Switching the build from GnuTLS to OpenSSL may work a little better. But without details of your config it is hard to be certain.
</I>&gt;<i> 
</I>&gt;<i> Amos
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> -------- Original message --------
</I>&gt;<i> From: Dan Steen &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">dan at mirageid.com</A>&gt;
</I>&gt;<i> Date: Wed, 12 May 2021, 10:06
</I>&gt;<i> To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> Subject: [squid-users] https_port not correctly sending ssl cert information?
</I>&gt;&gt;<i> Hi!,
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> I've recently been trying to update my version of squid from 4.0.20 to something more modern (4.13), but I'm having issues with my TLS enabled proxy not returning certificates correctly (it seems).   Specifically, when I try and run the following curl (url replaced to protect the innocent):
</I>&gt;&gt;<i>  
</I>&gt;&gt;<i> curl -vvI  --proxy <A HREF="https://test.example.com:5000">https://test.example.com:5000</A> &lt;<A HREF="https://vvnncqvnjkclsuu3ctvdp5k4ck72-uupfpbnf.mirageid.com:5000/">https://vvnncqvnjkclsuu3ctvdp5k4ck72-uupfpbnf.mirageid.com:5000/</A>&gt; <A HREF="https://google.com">https://google.com</A>
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> I get the following result:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> *   Trying 167.99.53.100:5000...
</I>&gt;&gt;<i> * Connected to test.example.com port 5000
</I>&gt;&gt;<i> * ALPN, offering http/1.1
</I>&gt;&gt;<i> * successfully set certificate verify locations:
</I>&gt;&gt;<i> *  CAfile: /etc/ssl/certs/ca-certificates.crt
</I>&gt;&gt;<i> *  CApath: none
</I>&gt;&gt;<i> * TLSv1.3 (OUT), TLS handshake, Client hello (1):
</I>&gt;&gt;<i> * TLSv1.3 (IN), TLS handshake, Server hello (2):
</I>&gt;&gt;<i> * TLSv1.3 (IN), TLS handshake, Encrypted Extensions (8):
</I>&gt;&gt;<i> * TLSv1.3 (IN), TLS handshake, Certificate (11):
</I>&gt;&gt;<i> * TLSv1.3 (OUT), TLS alert, unknown CA (560):
</I>&gt;&gt;<i> * SSL certificate problem: unable to get local issuer certificate
</I>&gt;&gt;<i> * Closing connection 0
</I>&gt;&gt;<i> curl: (60) SSL certificate problem: unable to get local issuer certificate
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> This is different then what I get for my old 4.0.20 server:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> * Connected to test.example.com port 3128 (#0)
</I>&gt;&gt;<i> * successfully set certificate verify locations:
</I>&gt;&gt;<i> *  CAfile: /etc/ssl/certs/ca-certificates.crt
</I>&gt;&gt;<i> *  CApath: none
</I>&gt;&gt;<i> * TLSv1.3 (OUT), TLS handshake, Client hello (1):
</I>&gt;&gt;<i> * TLSv1.3 (IN), TLS handshake, Server hello (2):
</I>&gt;&gt;<i> * TLSv1.2 (IN), TLS handshake, Certificate (11):
</I>&gt;&gt;<i> * TLSv1.2 (IN), TLS handshake, Server key exchange (12):
</I>&gt;&gt;<i> * TLSv1.2 (IN), TLS handshake, Server finished (14):
</I>&gt;&gt;<i> * TLSv1.2 (OUT), TLS handshake, Client key exchange (16):
</I>&gt;&gt;<i> * TLSv1.2 (OUT), TLS change cipher, Change cipher spec (1):
</I>&gt;&gt;<i> * TLSv1.2 (OUT), TLS handshake, Finished (20):
</I>&gt;&gt;<i> * TLSv1.2 (IN), TLS handshake, Finished (20):
</I>&gt;&gt;<i> * SSL connection using TLSv1.2 / ECDHE-RSA-AES256-GCM-SHA384
</I>&gt;&gt;<i> * Proxy certificate:
</I>&gt;&gt;<i> *  subject: CN=*.example.com
</I>&gt;&gt;<i> *  start date: Apr  5 21:02:06 2021 GMT
</I>&gt;&gt;<i> *  expire date: May  7 21:02:06 2022 GMT
</I>&gt;&gt;<i> *  issuer: C=BE; O=GlobalSign nv-sa; CN=AlphaSSL CA - SHA256 - G2
</I>&gt;&gt;<i> *  SSL certificate verify ok.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> But the config and certs are exactly the same!  I've pasted the config, output of squid -v, and cert information here:  <A HREF="https://gist.github.com/dansteen/c28343fd025c713bcfba8368ce2b728b">https://gist.github.com/dansteen/c28343fd025c713bcfba8368ce2b728b</A>
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> One difference between the two that I noticed is that the old version is compiled with --with-openssl and --enable-ssl and -enable-ssl-crtd, and the new version only has --with-gnutls.  Would that be the issue?  I appreciate the help!
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Thanks!
</I>&gt;&gt;<i> Dan Steen
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> &lt;mailto:squid-users%40lists.squid-cache.org&gt;
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> 
</I>
Dan Steen
Founder, CTO
*MirageID*
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">_dan at MirageID.com</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">esther at MirageID.com</A>&gt;_
443-204-9478
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20210511/ca1398bf/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20210511/ca1398bf/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="023629.html">[squid-users] https_port not correctly sending ssl cert information?
</A></li>
	<LI>Next message (by thread): <A HREF="023631.html">[squid-users] https_port not correctly sending ssl cert information?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23630">[ date ]</a>
              <a href="thread.html#23630">[ thread ]</a>
              <a href="subject.html#23630">[ subject ]</a>
              <a href="author.html#23630">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
