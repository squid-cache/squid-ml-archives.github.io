<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] SSL BUMP
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL%20BUMP&In-Reply-To=%3C60f6159611d811b152e8dccbd5663940%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023611.html">
   <LINK REL="Next"  HREF="023640.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] SSL BUMP</H1>
    <B>squid3 at treenet.co.nz</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL%20BUMP&In-Reply-To=%3C60f6159611d811b152e8dccbd5663940%40treenet.co.nz%3E"
       TITLE="[squid-users] SSL BUMP">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed May 12 12:46:48 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="023611.html">[squid-users] SSL BUMP
</A></li>
        <LI>Next message (by thread): <A HREF="023640.html">[squid-users] Re&#160;:Re:  SSL BUMP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23633">[ date ]</a>
              <a href="thread.html#23633">[ thread ]</a>
              <a href="subject.html#23633">[ subject ]</a>
              <a href="author.html#23633">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2021-05-10 22:26, Stephane Simon wrote:
&gt;<i> Hello,
</I>&gt;<i> 
</I>&gt;<i> I try to configure https  with ssl bump.
</I>&gt;<i> I use redhat 8.
</I>&gt;<i> 
</I>&gt;<i> i follow <A HREF="https://blog.microlinux.fr/squid-https-centos-7/">https://blog.microlinux.fr/squid-https-centos-7/</A>
</I>&gt;<i> when i restart squid, he doesn't cooperate and say:
</I>&gt;<i> 
</I>&gt;<i> &quot;FATAL: The usr/lib64/squid/security_file_certgen -s
</I>&gt;<i> /var/lib/squid/ssl_db -M 64MB helpers are crashing too rapidly, need
</I>&gt;<i> help!&quot;
</I>&gt;<i> 
</I>&gt;<i> i don't know how to fix this error..i dont know why i've this error ^^
</I>&gt;<i> 
</I>&gt;<i> Does someone have an idea please ?
</I>
The helper crashing is required by Squid to generate certificates for 
bumping.
Without it working perfectly Squid cannot handle any HTTPS traffic.


&gt;<i> 
</I>&gt;<i> http_port 3130
</I>&gt;<i> http_port 3128 intercept
</I>&gt;<i> https_port 3129 intercept ssl-bump \
</I>&gt;<i>   cert=/etc/squid/ssl_cert/certificat.pem \
</I>&gt;<i>   generate-host-certificates=on \
</I>&gt;<i>   dynamic_cert_mem_cache_size=64MB
</I>&gt;<i> 
</I>&gt;<i> #SSL certificate generation
</I>&gt;<i> sslcrtd_program usr/lib64/squid/security_file_certgen -s
</I>
The path should begin with '/usr/' not just 'usr/

&gt;<i> /var/lib/squid/ssl_db -M 64MB
</I>
Check that this /var path actually exists. That the low-privilege 
account the proxy uses has both read and write access to it.

Run the helper command to initialize the database before starting Squid. 
Do so using the low-privilege account Squid uses to ensure the database 
files have correct ownership.



&gt;<i> sslcrtd_children 32 startup=5 idle=1
</I>&gt;<i> 
</I>&gt;<i> # SSL-Bump
</I>&gt;<i> acl step1 at_step SslBump1
</I>&gt;<i> ssl_bump peek step1
</I>&gt;<i> ssl_bump bump all
</I>&gt;<i> 
</I>
Please be aware that this configuration is trying to forge server 
certificates without having any details about the real server 
certificate. When you are past the helper problem it is likely that this 
basic configuration will cause a number of TLS problems.

For bumping as much as possible this is a better config:

  acl step1 at_step SslBump1
  ssl_bump peek step1
  ssl_bump stare all
  ssl_bump bump all


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="023611.html">[squid-users] SSL BUMP
</A></li>
	<LI>Next message (by thread): <A HREF="023640.html">[squid-users] Re&#160;:Re:  SSL BUMP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23633">[ date ]</a>
              <a href="thread.html#23633">[ thread ]</a>
              <a href="subject.html#23633">[ subject ]</a>
              <a href="author.html#23633">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
