<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid self signed cert error on some websites
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20self%20signed%20cert%20error%20on%20some%20websites&In-Reply-To=%3C72fbb60c-9b1c-7ce7-ef21-00355defd139%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023655.html">
   <LINK REL="Next"  HREF="023657.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid self signed cert error on some websites</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20self%20signed%20cert%20error%20on%20some%20websites&In-Reply-To=%3C72fbb60c-9b1c-7ce7-ef21-00355defd139%40measurement-factory.com%3E"
       TITLE="[squid-users] squid self signed cert error on some websites">rousskov at measurement-factory.com
       </A><BR>
    <I>Wed May 19 20:05:30 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="023655.html">[squid-users] squid self signed cert error on some websites
</A></li>
        <LI>Next message (by thread): <A HREF="023657.html">[squid-users] squid self signed cert error on some websites
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23656">[ date ]</a>
              <a href="thread.html#23656">[ thread ]</a>
              <a href="subject.html#23656">[ subject ]</a>
              <a href="author.html#23656">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 5/19/21 3:44 PM, robert k Wild wrote:

&gt;<i> when i dont add it to the white list i cant view the website (obviously)
</I>&gt;<i> but can see the cert is provided by my squid (default company ltd)...i
</I>&gt;<i> was lazy creating it but cant view the cert
</I>&gt;<i> 
</I>&gt;<i> when i add it to the white list, i can view the website and the cert
</I>&gt;<i> info and its def from my squid cert (default company ltd) as i see the
</I>&gt;<i> valid dates ie before and after
</I>
The difference between those two certificates, if any, may be able to
explain the difference in browser behavior. It would also be useful to
compare those fake certificates with the real one.


&gt;<i> i think i need to relax the ciphers in my squid.conf as some other https
</I>&gt;<i> websites i get the error page and i dont get the cert error message
</I>&gt;<i> 
</I>&gt;<i> do you think relaxing the ciphers will work?
</I>
Sorry, I do not know. Obviously, you can trivially check this theory.

Alex.


&gt;<i> On Wed, 19 May 2021, 19:12 Alex Rousskov wrote:
</I>&gt;<i> 
</I>&gt;<i>     On 5/19/21 10:41 AM, robert k Wild wrote:
</I>&gt;<i>     &gt; ok i found out what the error is
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; its because in my squid.conf, i have a whitelist file
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; #HTTP_HTTPS whitelist websites
</I>&gt;<i>     &gt; acl whitelist ssl::server_name &quot;/usr/local/squid/etc/urlwhite.txt&quot;
</I>&gt;<i>     &gt; http_access allow activation whitelist
</I>&gt;<i>     &gt; http_access deny all
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; once i added the url to that file, it worked
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; but surely, instead of giving me an error saying
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; secure connection failed
</I>&gt;<i>     &gt; Error code: SEC_ERROR_BAD_SIGNATURE
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; it should be the default error ie
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; The following error was encountered while trying to retrieve the URL:
</I>&gt;<i>     &gt; <A HREF="https://blah.blah">https://blah.blah</A> &lt;<A HREF="https://blah.blah">https://blah.blah</A>&gt; &lt;<A HREF="https://blah.blah">https://blah.blah</A>
</I>&gt;<i>     &lt;<A HREF="https://blah.blah">https://blah.blah</A>&gt;&gt;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; &#160; &#160; Access Denied.
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; how can i change this please
</I>&gt;<i> 
</I>&gt;<i>     The answer depends on _why_ you get that SEC_ERROR_BAD_SIGNATURE error.
</I>&gt;<i> 
</I>&gt;<i>     If Squid does not have enough information to properly bump your client
</I>&gt;<i>     connection, then there may be no bumping-based solution at all (e.g.
</I>&gt;<i>     when the client is using certificate pinning), or you would have to bump
</I>&gt;<i>     at step2 when more information is available to Squid (to generate a
</I>&gt;<i>     better fake certificate).
</I>&gt;<i> 
</I>&gt;<i>     For the next step, try comparing the fake certificate that causes
</I>&gt;<i>     SEC_ERROR_BAD_SIGNATURE with the fake same-site certificate that works
</I>&gt;<i>     after you whitelist the problematic site. The browser should allow you
</I>&gt;<i>     to view both certificates. You can download them and use certificate
</I>&gt;<i>     printing tools like &quot;openssl x509 -noout -text -in ...&quot; to compare two
</I>&gt;<i>     certificate printouts.
</I>&gt;<i> 
</I>&gt;<i>     HTH,
</I>&gt;<i> 
</I>&gt;<i>     Alex.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     &gt; On Wed, 19 May 2021 at 13:54, robert k Wild wrote:
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;hi all,
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;i have squid 4.15
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;i have imported my self signed cert on firefox and now i can
</I>&gt;<i>     access
</I>&gt;<i>     &gt;&#160; &#160; &#160;https website (where as before i got a software is preventing this
</I>&gt;<i>     &gt;&#160; &#160; &#160;website from opening)
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;but on some websites i get an error saying
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;secure connection failed
</I>&gt;<i>     &gt;&#160; &#160; &#160;Error code: SEC_ERROR_BAD_SIGNATURE
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;i attach my ssl bump conf in my squid.conf file
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;#SSL Bump
</I>&gt;<i>     &gt;&#160; &#160; &#160;http_port 3128 ssl-bump
</I>&gt;<i>     cert=/usr/local/squid/etc/ssl_cert/myCA.pem
</I>&gt;<i>     &gt;&#160; &#160; &#160;generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
</I>&gt;<i>     &gt;&#160; &#160;
</I>&gt;<i>     &#160;cipher=HIGH:MEDIUM:RC4:3DES:!aNULL:!eNULL:!LOW:!MD5:!EXP:!PSK:!SRP:!DSS
</I>&gt;<i>     &gt;&#160; &#160; &#160;sslcrtd_program /usr/local/squid/libexec/security_file_certgen -s
</I>&gt;<i>     &gt;&#160; &#160; &#160;/var/lib/ssl_db -M 4MB
</I>&gt;<i>     &gt;&#160; &#160; &#160;acl step1 at_step SslBump1
</I>&gt;<i>     &gt;&#160; &#160; &#160;ssl_bump peek step1
</I>&gt;<i>     &gt;&#160; &#160; &#160;ssl_bump bump all
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;is there anything wrong you can see, i have tried to make a new CA
</I>&gt;<i>     &gt;&#160; &#160; &#160;but error still occures
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;thanks,
</I>&gt;<i>     &gt;&#160; &#160; &#160;rob
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;--
</I>&gt;<i>     &gt;&#160; &#160; &#160;Regards,
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;&#160; &#160; &#160;Robert K Wild.
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; --
</I>&gt;<i>     &gt; Regards,
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; Robert K Wild.
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; _______________________________________________
</I>&gt;<i>     &gt; squid-users mailing list
</I>&gt;<i>     &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i>     &gt; <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>     &lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>&gt;
</I>&gt;<i>     &gt;
</I>&gt;<i> 
</I>&gt;<i>     _______________________________________________
</I>&gt;<i>     squid-users mailing list
</I>&gt;<i>     <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i>     <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>     &lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>&gt;
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="023655.html">[squid-users] squid self signed cert error on some websites
</A></li>
	<LI>Next message (by thread): <A HREF="023657.html">[squid-users] squid self signed cert error on some websites
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23656">[ date ]</a>
              <a href="thread.html#23656">[ thread ]</a>
              <a href="subject.html#23656">[ subject ]</a>
              <a href="author.html#23656">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
