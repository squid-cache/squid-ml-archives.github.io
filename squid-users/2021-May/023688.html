<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] (possibly dynamic?) multiple port forwarding in the same internal Network ...
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%28possibly%20dynamic%3F%29%20multiple%20port%20forwarding%20in%0A%20the%20same%20internal%20Network%20...&In-Reply-To=%3CCAFakBwj20yAcDEti0cCE_KW991X2vQZ-S2AESTC9fmcs9miXnw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023686.html">
   <LINK REL="Next"  HREF="023690.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] (possibly dynamic?) multiple port forwarding in the same internal Network ...</H1>
    <B>Albretch Mueller</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%28possibly%20dynamic%3F%29%20multiple%20port%20forwarding%20in%0A%20the%20same%20internal%20Network%20...&In-Reply-To=%3CCAFakBwj20yAcDEti0cCE_KW991X2vQZ-S2AESTC9fmcs9miXnw%40mail.gmail.com%3E"
       TITLE="[squid-users] (possibly dynamic?) multiple port forwarding in the same internal Network ...">lbrtchx at gmail.com
       </A><BR>
    <I>Tue May 25 13:57:06 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="023686.html">[squid-users] (possibly dynamic?) multiple port forwarding in the same internal Network ...
</A></li>
        <LI>Next message (by thread): <A HREF="023690.html">[squid-users] (possibly dynamic?) multiple port forwarding in the same internal Network ...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23688">[ date ]</a>
              <a href="thread.html#23688">[ thread ]</a>
              <a href="subject.html#23688">[ subject ]</a>
              <a href="author.html#23688">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 5/25/21, Antony Stone &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">Antony.Stone at squid.open.source.it</A>&gt; wrote:
&gt;<i> On Tuesday 25 May 2021 at 14:36:09, Albretch Mueller wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> On 5/25/21, Antony Stone &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">Antony.Stone at squid.open.source.it</A>&gt; wrote:
</I>&gt;&gt;<i> &gt; On Tuesday 25 May 2021 at 07:51:21, Albretch Mueller wrote:
</I>&gt;&gt;<i> &gt;&gt;  As part of a teaching and learning (TaL)/school software, I need
</I>&gt;&gt;<i> &gt;&gt; squid:
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt;  a) to detect one of the connected computers in an internal network
</I>&gt;&gt;<i> &gt;&gt; comprising wirelessly connected and wired computers as the &quot;master&quot;
</I>&gt;&gt;<i> &gt;&gt; (operated by the teacher);
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; What information is available to Squid in order to &quot;detect&quot; that this is
</I>&gt;&gt;<i> &gt; the &quot;master&quot; machine?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I think a combination of cookies,
</I>&gt;<i>
</I>&gt;<i> What system generates / checks the cookies?
</I>
 OK, I am just guessing here in the direction I'd wish that
implementation would go, but  probably an intermidiate proxy or
another running instance internally running an ICAP server should be
used?

&gt;<i> What URL are the cookies associated with in the browser?
</I>
 OK, again ;-), here I clearly see your point, but the communication
associated with certain computers could be handled differently based
on other autenticating aspects. Also, say, teachers have their own
dedicated tablets, we know the time frames in which classes run in
each classroom...

&gt;&gt;<i> its mac address and, when both fail, authentication.
</I>&gt;<i>
</I>&gt;<i> Ah, some form of authentication, where the master user has to log in to
</I>&gt;<i> something, would certainly be effective.  It was just the way you used the
</I>&gt;<i> word
</I>&gt;<i> &quot;detect&quot; that made me think this should be some action on the part of Squid
</I>&gt;<i> independently of what the master machine user was doing.
</I>
 So, that issue we could see as checked.

&gt;&gt;<i> Wouldn't that be enough?, perhaps with an extra proxy server?
</I>&gt;<i>
</I>&gt;<i> Perhaps with an extra *web* server (for authentication), yes, but where
</I>&gt;<i> would
</I>&gt;<i> an extra proxy server point to?
</I>
 [teacher] |\                                                      /|
...........| .&gt;.[extra proxy server*2].&lt;.&gt;.[squid server + ICAP].&lt;. | Internet
[students] |/                                                      \|

 * [2] extra proxy server discriminating between communications
started by the teacher or server
 * extra ICAP server used to do some page content marshalling, e.g.:
if a youtube video is accessed, students would see only a page with
all the js crap removed and a link pointing to a local file with the
video (which, of course, could have been pre downloaded)

&gt;&gt;<i> My main problem is that I don't want for students boxes to be prompted for
</I>&gt;&gt;<i> or trying to initiate an authentication and I don't know of a fool proof
</I>&gt;&gt;<i> way
</I>&gt;&gt;<i> of achieving that.
</I>&gt;<i>
</I>&gt;<i> How about the teacher accesses a URL that the students don't know, or at
</I>&gt;<i> least
</I>&gt;<i> are not supposed to access, and it is that URL which prompts the teacher to
</I>&gt;<i> authenticate?
</I>
 You are not a teacher, right? ;-) or at least not a teacher in the
40's section of the South Bronx in NYC. I think it would be much
better if the teacher carries around something (probably, just her
face and/or fingerprints? which could be checked via biometrics, the
webcam on her tablet). In a school (kind of like in a prison) keeping
protected functional spaces vertically disentangled is very important.

&gt;&gt;<i> If possible, all students' business should let go through with squid
</I>&gt;&gt;<i> serving
</I>&gt;&gt;<i> as transparent proxy.
</I>&gt;<i>
</I>&gt;<i> That's just down to your networking configuration.
</I>
 Great!

&gt;&gt;<i> Probably squid could cache that request as local files to the extent
</I>&gt;&gt;<i> that it can and just redirect the requests of students' clients as
</I>&gt;&gt;<i> references to that file using an ICAP server somehow?
</I>&gt;<i>
</I>&gt;<i> So, the student asks for the Wikipedia article on Amethyst and finds that
</I>&gt;<i> their
</I>&gt;<i> browser shows them the web page the teacher is looking at instead?
</I>&gt;<i>
</I>&gt;<i> I think there's no way you're going to achieve this sort of thing with the
</I>&gt;<i> current popularity of SSL/TLS.
</I>
 No, I don't see things happening in that way. There are certain
moments during the class in which students can &quot;freely&quot; access the
Internet, but teacher should be able to direct the class. So her inet
request trumps  whatever the students may be attempting to do.

 Yes, it seems to be a bit facist, but I do believe we should offer
kids with a safe leaning environment while in school. They will have
enough time to watch all that crappy nonsense floating around outside
of the school for the rest of their lives.

&gt;&gt;<i> &gt;&gt;  b) when that master reach out to an outside URL, the response should
</I>&gt;&gt;<i> &gt;&gt; be replicated in that master's and all other internal computers; but
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; What do you mean by &quot;the response should be replicated in ... all other
</I>&gt;&gt;<i> &gt; internal computers&quot;?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  that the initial request by the teacher should be received as
</I>&gt;&gt;<i> response by all students
</I>&gt;<i>
</I>&gt;<i> Response to what?
</I>
 response to the initial teacher request

&gt;&gt;<i> &gt; Are you assuming that these computers are already running a browser,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Well, technically, I think we could assume that, why would that be
</I>&gt;&gt;<i> problematic? How bad would if be if they are not running a browser,
</I>&gt;&gt;<i> you could interrupt an initiated request, you could even shot down
</I>&gt;&gt;<i> your computer in the middle of a download or transaction without a
</I>&gt;&gt;<i> problem. Why would that be that difficult? or, was is it exactly I am
</I>&gt;&gt;<i> not getting right?
</I>&gt;<i>
</I>&gt;<i> I'm asking &quot;what application is going to receive this &quot;response&quot; sent by
</I>&gt;<i> Squid, and be expecting it so that it can process it and display it to the
</I>&gt;<i> user?&quot;
</I>&gt;<i>
</I>&gt;<i> You can't just send a chunk of HTML to a computer over the network and
</I>&gt;<i> expect
</I>&gt;<i> a browser window to suddenly appear and display it.
</I>
 It would not be a big deal for me/anyone with some moderate
programming experience, to code in minutes an application that:

 a) fields/intercepts a response to an initial request
 b) saves it to a local file (if it is a media file) and
 c) parses and marshalls the response page to include a link to that &#167;b file

&gt;<i> Aside from anything else, you have to get a TCP session going in the first
</I>&gt;<i> place.
</I>&gt;<i>
</I>
 Well, yes and that, like making sure or checking if a browser window
is open, would be an aspect that squid can't do for us, but it is
doable in some other ways.

&gt;&gt;<i> &gt; that they should suddenly get some (apparently) web server response via
</I>&gt;&gt;<i> &gt; Squid and display it, even though they did not make any request?
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; If so, I would say this is impossible - you can't get a computer to show
</I>&gt;&gt;<i> &gt; a response to a request it did not make.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Yes, this is what I meant, why is that so hard?
</I>&gt;<i>
</I>&gt;<i> a) the client (user's computer) did not open a TCP session to anything
</I>&gt;<i> (either
</I>&gt;<i> Squid, or a web server), so it's not going to accept TCP &quot;replies&quot;
</I>&gt;<i>
</I>&gt;<i> b) the client did not send an HTTP request to anything, so it's not going to
</I>&gt;<i> accept some HTML which simply turns up on its network port
</I>&gt;<i>
</I>&gt;&gt;<i> Again, my forte is not networking, but I could see how the requested file
</I>&gt;&gt;<i> could be cached and forwarded to all student boxes. Perhaps using an ICAP
</I>&gt;&gt;<i> server.
</I>&gt;<i>
</I>&gt;<i> You can modify a request sent from the client, or you can modify a response
</I>&gt;<i> sent back from a sever, but you cannot simply send a response to a machine
</I>&gt;<i> which did not make a request.
</I>
 As explained above you could channel some data to any computer with a
physical and addressable connection to a network, web/application
servers do that all the time.

 Or probably the idea of &quot;beating&quot;/&quot;polling&quot; requests from a browser
should be exploited?

&gt;&gt;<i> &gt;&gt;  c) responses to requests originating in the non master (&quot;slave&quot;?)
</I>&gt;&gt;<i> &gt;&gt; ends, return to their corresponding ends;
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; So, any computer other than the &quot;master&quot; simply makes requests and gets
</I>&gt;&gt;<i> &gt; standard responses as usual.  Fine.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Yes, once you know the request originated in the non master machine,
</I>&gt;&gt;<i> it would go back to the initiating client. Again, why would that be
</I>&gt;&gt;<i> that problematic?
</I>&gt;<i>
</I>&gt;<i> That is not problematic - it's fine.
</I>
 Great!

&gt;&gt;<i> &gt;&gt;  d) at times the master should be able to switch off that replicating
</I>&gt;&gt;<i> &gt;&gt; feature;
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; What times?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Teacher may decide to &quot;privately&quot; check out some information by
</I>&gt;&gt;<i> herself without it being displayed on all students' ends or even
</I>&gt;&gt;<i> concurrently open another &quot;private&quot; browser window.
</I>&gt;<i>
</I>&gt;<i> So, the Squid proxy needs somehow to be able to identify which session or
</I>&gt;<i> window the teacher is using, and react differently.  I suspect this is
</I>&gt;<i> probably
</I>&gt;<i> doable, but far from simple.
</I>
 Great! You see it is all falling into place little by little

 All that needs to be done then is qualifying/deal with the &quot;far from
simple&quot; aspects relating to it.

&gt;&gt;<i> &gt; How?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This is what I don't know but I think (probably somewhat naively) it
</I>&gt;&gt;<i> shouldn't be that hard. Again, session tracking via cookies or URL
</I>&gt;&gt;<i> rewriting, maybe?
</I>&gt;<i>
</I>&gt;<i> I think you are completely overlooking modern security practices here.
</I>&gt;<i>
</I>&gt;<i> a) many websites use SSL/TLS - you can't just intercept the requests or
</I>&gt;<i> responses and replace them with whatever you want
</I>&gt;<i>
</I>&gt;<i> b) most browsers and related applications will either not support, or
</I>&gt;<i> definitely warn about, cross-site scripting and foreign cookies
</I>
 Computers and browsers are in the classrooms are owned and it is OK
if students see all pages as plain text, non SSL/TLS ones.

 I may be missing something here, but in princip I think it is doable somehow.

&gt;&gt;<i> &gt; I really think you need to explain this &quot;replicating feature&quot; in more
</I>&gt;&gt;<i> &gt; detail (and preferably in network terms, from the point of view of the
</I>&gt;&gt;<i> &gt; software running on the master, and the software running on a
</I>&gt;&gt;<i> &gt; non-master.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I am not a networking guy but probably you could point out to me some
</I>&gt;&gt;<i> related documents explaining specifically the kinds of problematics
</I>&gt;&gt;<i> around these kinds of issues.
</I>&gt;<i>
</I>&gt;<i> Just look up &quot;TCP 3-way handshake&quot; and read any basic introduction to
</I>&gt;<i> &quot;client-
</I>&gt;<i> server connectivity&quot; for an understanding of how an HTTP request gets made
</I>&gt;<i> and
</I>&gt;<i> the response received.
</I>&gt;<i>
</I>&gt;<i> Without a request, the response will be ignored.
</I>
 Thank you I will look up &quot;TCP 3-way handshake&quot; and then see what is doable.

 I still think that if browsers create so many problems you could:

 a) reconfiger or remove/recompile the part of the browsers which
create such &quot;problems&quot;, other

 b) code and use, for example, JavaFX-based reach clients

&gt;&gt;<i> &gt; I think this request is (a) a *lot* more complicated than this, and
</I>&gt;&gt;<i> &gt; probably a lot more complicated than you think it is, and (b) in parts,
</I>&gt;&gt;<i> &gt; impossible.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I am squarely OK with &quot;lots of complication&quot; and as I said, you might
</I>&gt;&gt;<i> not be able to completely and directly implement all aspects using
</I>&gt;&gt;<i> squid, but what aspects of that integrated whole do you think are
</I>&gt;&gt;<i> impossible?
</I>&gt;<i>
</I>&gt;<i> Basic networking protocols, from what I understand of how you expect this to
</I>&gt;<i> work.
</I>
 Thank you very much Anthony/[squid users]. As I squeeze some time to
do it, I will start working little by little on the implementation of
such a stack. I thought something like that or pretty close to it
would be available out already. There definitely is a need for such a
thing.

 I will definitely keep bothering you as I stumble on hurdles along the way ;-)

 The first hurdle I have in sight is how to locally run squid with
more than one browser open on my own computer as a test environment.
This is something I think (again probably I am being a bit too
imaginative here) shouldn't be a problem. How do people who design and
troubleshoot browsers do such things?

 Thanks to all,

 lbrtchx

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="023686.html">[squid-users] (possibly dynamic?) multiple port forwarding in the same internal Network ...
</A></li>
	<LI>Next message (by thread): <A HREF="023690.html">[squid-users] (possibly dynamic?) multiple port forwarding in the same internal Network ...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23688">[ date ]</a>
              <a href="thread.html#23688">[ thread ]</a>
              <a href="subject.html#23688">[ subject ]</a>
              <a href="author.html#23688">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
