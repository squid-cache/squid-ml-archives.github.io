<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 5.2 Peer parent TCP connection to x.x.x.x/x failed
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%205.2%20Peer%20parent%20TCP%20connection%20to%20x.x.x.x/x%0A%20failed&In-Reply-To=%3C39f90c0d-1b53-5d28-3d21-608906384d3b%40articatech.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   
   <LINK REL="Next"  HREF="024212.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 5.2 Peer parent TCP connection to x.x.x.x/x failed</H1>
    <B>David Touzeau</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%205.2%20Peer%20parent%20TCP%20connection%20to%20x.x.x.x/x%0A%20failed&In-Reply-To=%3C39f90c0d-1b53-5d28-3d21-608906384d3b%40articatech.com%3E"
       TITLE="[squid-users] Squid 5.2 Peer parent TCP connection to x.x.x.x/x failed">david at articatech.com
       </A><BR>
    <I>Mon Nov  1 11:55:32 UTC 2021</I>
    <P><UL>
        
        <LI>Next message (by thread): <A HREF="024212.html">[squid-users] Squid 5.2 Peer parent TCP connection to x.x.x.x/x failed
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24211">[ date ]</a>
              <a href="thread.html#24211">[ thread ]</a>
              <a href="subject.html#24211">[ subject ]</a>
              <a href="author.html#24211">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Community,

We use child Squid proxies that connect to boxes that act as parents.
In version 4.x this configuration does not pose any problem.
In version 5.2, since, we have a lot of errors like :

01h 47mn kid1| TCP connection to 10.32.0.18/3150 failed
01h 47mn kid1| TCP connection to 10.32.0.17/3150 failed
01h 47mn kid1| TCP connection to 10.32.0.17/3150 failed
01h 47mn kid1| TCP connection to 10.32.0.17/3150 failed
01h 47mn kid1| TCP connection to 10.32.0.17/3150 failed
01h 47mn kid1| TCP connection to 10.32.0.17/3150 failed
01h 47mn kid1| TCP connection to 10.32.0.17/3150 failed

However we are sure that the parent proxies are available.
To make sure this is the case, we installed a local HaProxy that scales 
with the parent proxies

The Squid uses the loopback as a parent.

The same problem occurs:
06:19:47 kid1| TCP connection to 127.0.0.1/2320 failed
06:15:13 kid1| TCP connection to 127.0.0.1/2320 failed
06:14:41 kid1| TCP connection to 127.0.0.1/2320 failed
06:14:38 kid1| TCP connection to 127.0.0.1/2320 failed
06:13:15 kid1| TCP connection to 127.0.0.1/2320 failed
06:11:23 kid1| TCP connection to 127.0.0.1/2320 failed

But in no case the local HaProxy service was down

This makes us understand that the parent squid process randomly stalls 
when in fact there is no reason for this to happen.
There is a software problem rather than a network problem

It is possible that the configuration is wrong but we have tried many 
possibilities.

Here is our last configuration

cache_peer 127.0.0.1 parent 2320 0 name=Peer11 no-query default 
connect-timeout=3 connect-fail-limit=5 no-tproxy

maybe we forgot something?

Regards
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20211101/d9561a8b/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20211101/d9561a8b/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message (by thread): <A HREF="024212.html">[squid-users] Squid 5.2 Peer parent TCP connection to x.x.x.x/x failed
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24211">[ date ]</a>
              <a href="thread.html#24211">[ thread ]</a>
              <a href="subject.html#24211">[ subject ]</a>
              <a href="author.html#24211">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
