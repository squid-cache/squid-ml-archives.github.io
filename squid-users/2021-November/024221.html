<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] acl / format code evaluation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20acl%20/%20format%20code%20evaluation&In-Reply-To=%3CCANj0NTqFKEbtAzS9KN-9_jcg1aAVDHRtCFB%3DyLtcskiaSUT-zA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024220.html">
   <LINK REL="Next"  HREF="024222.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] acl / format code evaluation</H1>
    <B>Jason Spashett</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20acl%20/%20format%20code%20evaluation&In-Reply-To=%3CCANj0NTqFKEbtAzS9KN-9_jcg1aAVDHRtCFB%3DyLtcskiaSUT-zA%40mail.gmail.com%3E"
       TITLE="[squid-users] acl / format code evaluation">jason.spashett at menlosecurity.com
       </A><BR>
    <I>Thu Nov  4 15:14:26 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="024220.html">[squid-users] Squid upgrade failure support questions
</A></li>
        <LI>Next message (by thread): <A HREF="024222.html">[squid-users] acl / format code evaluation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24221">[ date ]</a>
              <a href="thread.html#24221">[ thread ]</a>
              <a href="subject.html#24221">[ subject ]</a>
              <a href="author.html#24221">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

I am using squid 5, and after reading the following I have attempted
to link the connect requests to the other requests within a TLS
tunnel.
<A HREF="http://lists.squid-cache.org/pipermail/squid-users/2021-April/023526.html">http://lists.squid-cache.org/pipermail/squid-users/2021-April/023526.html</A>

I added an extra log format code to squid 5, called %random, which
always returns a random string, in the hopes of using this to stamp
against log entries to tie them together.

The squid configuration follows, this seems to partially work in that
the requests in the tunnel have the same conn_id, but the connect
request itself has a different one, which leads me to to believe that
the format code is being evaluated twice in that case perhaps. I am
not sure why the in tunnel requests appear to work, but the id on the
connect request is different.

Note that I added %master_xaction to the log too, to see if that
worked, and it does, but it's not particularly practical on it's own
due to the problem of it not being unique enough.

Can anyone tell me why this isn't working, and or when the log format
codes get evaluated.


Squid configuration
-------------------
#
acl connection_id_acl annotate_client conn_id+=&quot;%master_xaction/%random&quot;
acl has_conn_id_acl note conn_id
acl set_conn_id_once_acl any-of has_conn_id_acl connection_id_acl
note &quot;&quot; &quot;&quot; set_conn_id_once_acl
#
logformat log time=&quot;%tl&quot; conn_id=%{conn_id}note request_type=%&gt;rm url=%&gt;ru

log output
----------
time=&quot;04/Nov/2021:14:54:19 +0000&quot; conn_id=2550/Fh0Lje1
request_type=CONNECT url=blog.jason.spashett.com:443
time=&quot;04/Nov/2021:14:54:19 +0000&quot; conn_id=2550/e5sVhqi
request_type=GET
url=<A HREF="https://blog.jason.spashett.com/minecraft-4k-ported-to-the-d-programming-language/">https://blog.jason.spashett.com/minecraft-4k-ported-to-the-d-programming-language/</A>
time=&quot;04/Nov/2021:14:54:20 +0000&quot; conn_id=2550/e5sVhqi
request_type=GET url=<A HREF="https://blog.jason.spashett.com/css/main.css">https://blog.jason.spashett.com/css/main.css</A>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="024220.html">[squid-users] Squid upgrade failure support questions
</A></li>
	<LI>Next message (by thread): <A HREF="024222.html">[squid-users] acl / format code evaluation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24221">[ date ]</a>
              <a href="thread.html#24221">[ thread ]</a>
              <a href="subject.html#24221">[ subject ]</a>
              <a href="author.html#24221">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
