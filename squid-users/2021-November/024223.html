<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] acl / format code evaluation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20acl%20/%20format%20code%20evaluation&In-Reply-To=%3CCANj0NTrGk-Tw_gnmDw51549hupW4sQ3K1f2TM-CXMVXHKOH_HA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024222.html">
   <LINK REL="Next"  HREF="024224.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] acl / format code evaluation</H1>
    <B>Jason Spashett</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20acl%20/%20format%20code%20evaluation&In-Reply-To=%3CCANj0NTrGk-Tw_gnmDw51549hupW4sQ3K1f2TM-CXMVXHKOH_HA%40mail.gmail.com%3E"
       TITLE="[squid-users] acl / format code evaluation">jason.spashett at menlosecurity.com
       </A><BR>
    <I>Fri Nov  5 09:57:02 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="024222.html">[squid-users] acl / format code evaluation
</A></li>
        <LI>Next message (by thread): <A HREF="024224.html">[squid-users] acl / format code evaluation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24223">[ date ]</a>
              <a href="thread.html#24223">[ thread ]</a>
              <a href="subject.html#24223">[ subject ]</a>
              <a href="author.html#24223">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Fri, 5 Nov 2021 at 09:03, Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; wrote:
...
&gt;<i> For your config snippet below
</I>&gt;<i>
</I>&gt;<i> That means usually;
</I>&gt;<i> - helper queries at several points processing each request/transaction,
</I>&gt;<i> - each time those ACLs of yours are *checked*,
</I>&gt;<i> - log outputs when each request finishes, and
</I>&gt;<i> - deny_info URL generation for redirection.
</I>...
&gt;<i> &gt; Squid configuration
</I>&gt;<i> &gt; -------------------
</I>&gt;<i> &gt; #
</I>&gt;<i> &gt; acl connection_id_acl annotate_client conn_id+=&quot;%master_xaction/%random&quot;
</I>&gt;<i> &gt; acl has_conn_id_acl note conn_id
</I>&gt;<i> &gt; acl set_conn_id_once_acl any-of has_conn_id_acl connection_id_acl
</I>&gt;<i> &gt; note &quot;&quot; &quot;&quot; set_conn_id_once_acl
</I>&gt;<i> &gt; #
</I>&gt;<i> &gt; logformat log time=&quot;%tl&quot; conn_id=%{conn_id}note request_type=%&gt;rm url=%&gt;ru
</I>...
&gt;<i> The problem you have is that the CONNECT request ceases to exist at the
</I>&gt;<i> point it is accepted to be decrypted. The TLS handshake takes time - so
</I>&gt;<i> the conn_id %random value you assigned to that CONNECT is long gone by
</I>&gt;<i> the time the decrypted requests are received. We have several bugs open
</I>&gt;<i> about this situation, but my fix has got stuck with QA rejections from
</I>&gt;<i> other team memmbers.
</I>...

Thanks Amos,

Is it not the case then, that connection_id_acl should be evaluated on connect,
once, and the resulting format code evaluated (expanded), and conn_id &quot;stamped&quot;
on the client connection at this time?

I appreciate that the connect request may dematerialise, but by this
time is there
not a note on the client connection with conn_id=&quot;some already-evaluated thing&quot;
which persists until the client connection closes?

What perhaps you mean is that the client connection object does change
on account of the connect
being intercepted, is that what is happening?

Regards,
Jason

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="024222.html">[squid-users] acl / format code evaluation
</A></li>
	<LI>Next message (by thread): <A HREF="024224.html">[squid-users] acl / format code evaluation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24223">[ date ]</a>
              <a href="thread.html#24223">[ thread ]</a>
              <a href="subject.html#24223">[ subject ]</a>
              <a href="author.html#24223">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
