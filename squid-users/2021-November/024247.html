<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Too many ERROR: Collapsed forwarding queue overflow for kid2 at 1024 items
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Too%20many%20ERROR%3A%20Collapsed%20forwarding%20queue%0A%20overflow%20for%20kid2%20at%201024%20items&In-Reply-To=%3C3f74400e-666b-a3a1-8ab2-5b8075e52bdf%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024246.html">
   <LINK REL="Next"  HREF="024249.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Too many ERROR: Collapsed forwarding queue overflow for kid2 at 1024 items</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Too%20many%20ERROR%3A%20Collapsed%20forwarding%20queue%0A%20overflow%20for%20kid2%20at%201024%20items&In-Reply-To=%3C3f74400e-666b-a3a1-8ab2-5b8075e52bdf%40measurement-factory.com%3E"
       TITLE="[squid-users] Too many ERROR: Collapsed forwarding queue overflow for kid2 at 1024 items">rousskov at measurement-factory.com
       </A><BR>
    <I>Mon Nov 15 16:16:56 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="024246.html">[squid-users] Too many ERROR: Collapsed forwarding queue overflow for kid2 at 1024 items
</A></li>
        <LI>Next message (by thread): <A HREF="024249.html">[squid-users] Too many ERROR: Collapsed forwarding queue overflow for kid2 at 1024 items
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24247">[ date ]</a>
              <a href="thread.html#24247">[ thread ]</a>
              <a href="subject.html#24247">[ subject ]</a>
              <a href="author.html#24247">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 11/15/21 7:43 AM, Lou&#269;ansk&#253; Luk&#225;&#353; wrote:

&gt;<i> 2021/11/14 10:13:30 kid2| assertion failed: Transients.cc:221: &quot;old == e&quot;
</I>&gt;<i> 2021/11/15 08:37:36 kid2| assertion failed: Transients.cc:221: &quot;old == e&quot;
</I>&gt;<i> 2021/11/15 11:54:14 kid1| assertion failed: Transients.cc:221: &quot;old == e&quot;
</I>&gt;<i> 2021/11/15 12:16:27 kid1| assertion failed: Transients.cc:221: &quot;old == e&quot;
</I>
I recommend ignoring queue overflows until the above assertions are
fixed because worker deaths cause queue overflows. Your Squid is buggy,
and those bugs essentially cause queue overflows.

The assertion itself is known as Bug 5134:
<A HREF="https://bugs.squid-cache.org/show_bug.cgi?id=5134">https://bugs.squid-cache.org/show_bug.cgi?id=5134</A>

That bug has a speculative fix (master/v6 commit 5210df4). Please try it
if you can.


HTH,

Alex.


&gt;<i> -----Original Message-----
</I>&gt;<i> From: Alex Rousskov [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>] 
</I>&gt;<i> Sent: Friday, November 12, 2021 5:24 PM
</I>&gt;<i> To: Lou&#269;ansk&#253; Luk&#225;&#353;; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> Subject: Re: [squid-users] Too many ERROR: Collapsed forwarding queue overflow for kid2 at 1024 items
</I>&gt;<i> 
</I>&gt;<i> On 11/11/21 10:19 AM, Lou&#269;ansk&#253; Luk&#225;&#353; wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> recently I'm facing too many ERROR: Collapsed forwarding queue 
</I>&gt;&gt;<i> overflow for kid2 at 1024 items lines in my Squid 5.2 log files.
</I>&gt;<i> 
</I>&gt;<i> We see those overflows when kids die. Do you see any FATAL messages, assertions, or similar deadly errors in cache.log?
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> Could someone elaborate how the queue is filled - what is clogging it?
</I>&gt;<i> 
</I>&gt;<i> The sender/writer sends messages faster than the recipient/reader is reading them, eventually exceeding the queue capacity (i.e. 1024 messages). These messages are about Store entries that may need synchronization across workers. Each message is very small.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> I don't mind too much if I have to turn collapsed forwarding off
</I>&gt;<i> 
</I>&gt;<i> Most likely, the problem is not tied to collapsed forwarding. These queues were used for collapsed forwarding when they were added, but they are used for regular traffic as well in modern SMP Squids. We need to change the queue names (and related code/message text) to reflect the expanded nature of these queues.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> HTH,
</I>&gt;<i> 
</I>&gt;<i> Alex.
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="024246.html">[squid-users] Too many ERROR: Collapsed forwarding queue overflow for kid2 at 1024 items
</A></li>
	<LI>Next message (by thread): <A HREF="024249.html">[squid-users] Too many ERROR: Collapsed forwarding queue overflow for kid2 at 1024 items
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24247">[ date ]</a>
              <a href="thread.html#24247">[ thread ]</a>
              <a href="subject.html#24247">[ subject ]</a>
              <a href="author.html#24247">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
