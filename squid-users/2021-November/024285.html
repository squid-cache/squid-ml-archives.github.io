<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 5.2: assertion failed: Controller.cc:930: &quot;!transients || e.hasTransients()&quot;
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%205.2%3A%20assertion%20failed%3A%20Controller.cc%3A930%3A%0A%20%22%21transients%20%7C%7C%20e.hasTransients%28%29%22&In-Reply-To=%3C4326149a-a1d4-3647-002a-e67ac237f56f%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024284.html">
   <LINK REL="Next"  HREF="024278.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 5.2: assertion failed: Controller.cc:930: &quot;!transients || e.hasTransients()&quot;</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%205.2%3A%20assertion%20failed%3A%20Controller.cc%3A930%3A%0A%20%22%21transients%20%7C%7C%20e.hasTransients%28%29%22&In-Reply-To=%3C4326149a-a1d4-3647-002a-e67ac237f56f%40measurement-factory.com%3E"
       TITLE="[squid-users] Squid 5.2: assertion failed: Controller.cc:930: &quot;!transients || e.hasTransients()&quot;">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Nov 23 14:28:14 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="024284.html">[squid-users] Squid 5.2: assertion failed: Controller.cc:930: &quot;!transients || e.hasTransients()&quot;
</A></li>
        <LI>Next message (by thread): <A HREF="024278.html">[squid-users] ipcacheParse No Address records in response to 'DNS address'
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24285">[ date ]</a>
              <a href="thread.html#24285">[ thread ]</a>
              <a href="subject.html#24285">[ subject ]</a>
              <a href="author.html#24285">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 11/23/21 6:39 AM, David Touzeau wrote:

&gt;<i> cache dir rock : objects larger than 32,000 bytes cannot be cached
</I>
Modern rock versions do not have that limitation. Relying on wiki pages
for documentation carries elevated risks, especially when reading old
pages, but introduction of large object support was documented at
<A HREF="https://wiki.squid-cache.org/Features/LargeRockStore">https://wiki.squid-cache.org/Features/LargeRockStore</A>

A better starting point may be cache_dir documentation in your
squid.conf.documented generated for your Squid version.


HTH,

Alex.



&gt;<i> Le 23/11/2021 &#224; 11:01, David Touzeau a &#233;crit&#160;:
</I>&gt;&gt;<i> Ok thanks, we will investigate in this way
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Le 22/11/2021 &#224; 19:33, Alex Rousskov a &#233;crit&#160;:
</I>&gt;&gt;&gt;<i> On 11/22/21 12:48 PM, David Touzeau wrote:
</I>&gt;&gt;&gt;&gt;<i> Here our SMP configuration:
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> workers 2
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> cache_dir rock /home/squid/cache/rock 0 min-size=0 max-size=131072 slot-size=32000
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> if ${process_number} = 1
</I>&gt;&gt;&gt;&gt;<i> memory_cache_mode always
</I>&gt;&gt;&gt;&gt;<i> cpu_affinity_map process_numbers=${process_number} cores=1
</I>&gt;&gt;&gt;&gt;<i> cache_dir&#160;&#160;&#160; aufs&#160;&#160;&#160; /home/squid/Caches/disk&#160;&#160;&#160; 50024&#160;&#160;&#160; 16&#160;&#160;&#160; 256 min-size=131072 max-size=3221225472
</I>&gt;&gt;&gt;&gt;<i> endif
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> if ${process_number} = 2
</I>&gt;&gt;&gt;&gt;<i> memory_cache_mode always
</I>&gt;&gt;&gt;&gt;<i> cpu_affinity_map process_numbers=${process_number} cores=2
</I>&gt;&gt;&gt;&gt;<i> endif
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> where is the false settings ?
</I>&gt;&gt;&gt;<i> I am limiting my answer to the problems in this email thread scope: aufs
</I>&gt;&gt;&gt;<i> cache_dirs are UFS-based cache_dirs. UFS-based cache_dirs are not
</I>&gt;&gt;&gt;<i> SMP-aware and are not supported in SMP configurations. Your choices include:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> * drop SMP (i.e. remove &quot;workers&quot; and ARA)
</I>&gt;&gt;&gt;<i> * drop aufs (i.e. remove &quot;cache_dir aufs&quot; and ARA)
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> ... where ARA is &quot;adjust the rest of the configuration accordingly&quot;.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> HTH,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Alex.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Le 22/11/2021 &#224; 18:18, Alex Rousskov a &#233;crit&#160;:
</I>&gt;&gt;&gt;&gt;&gt;<i> On 11/22/21 11:55 AM, David Touzeau wrote:
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> What does mean this error :
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> 2021/11/21 17:23:06 kid1| assertion failed: Controller.cc:930:
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> &quot;!transients || e.hasTransients()&quot;
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> We are unable to start the service it always crashes.
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> How can we can fix it ( purge cache , reboot )... ?
</I>&gt;&gt;&gt;&gt;&gt;<i> This is a Squid bug or misconfiguration. If you are using a UFS-based
</I>&gt;&gt;&gt;&gt;&gt;<i> cache_dir with multiple workers, then it is a misconfiguration. If you
</I>&gt;&gt;&gt;&gt;&gt;<i> want to use SMP disk caching, please use rock store instead.
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> HTH,
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> Alex.
</I>&gt;&gt;&gt;&gt;&gt;<i> P.S. This assertion has been reported several times, including for Squid
</I>&gt;&gt;&gt;&gt;&gt;<i> v4, but it was probably always due to a Squid misconfiguration. We need
</I>&gt;&gt;&gt;&gt;&gt;<i> to find a good way to explicitly reject such configurations instead of
</I>&gt;&gt;&gt;&gt;&gt;<i> asserting (while not rejecting similar unsupported configurations that
</I>&gt;&gt;&gt;&gt;&gt;<i> still &quot;work&quot; from their admins point of view).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="024284.html">[squid-users] Squid 5.2: assertion failed: Controller.cc:930: &quot;!transients || e.hasTransients()&quot;
</A></li>
	<LI>Next message (by thread): <A HREF="024278.html">[squid-users] ipcacheParse No Address records in response to 'DNS address'
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24285">[ date ]</a>
              <a href="thread.html#24285">[ thread ]</a>
              <a href="subject.html#24285">[ subject ]</a>
              <a href="author.html#24285">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
