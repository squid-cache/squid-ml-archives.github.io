<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Is this related? store.cc:1094: &quot;store_status == STORE_PENDING&quot; + TCP_MISS_ABORTED
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Is%20this%20related%3F%20store.cc%3A1094%3A%20%22store_status%20%3D%3D%0A%20STORE_PENDING%22%20%2B%20TCP_MISS_ABORTED&In-Reply-To=%3C16fec301-cf16-633f-88b3-91ffb6ddaec7%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024283.html">
   <LINK REL="Next"  HREF="024289.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Is this related? store.cc:1094: &quot;store_status == STORE_PENDING&quot; + TCP_MISS_ABORTED</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Is%20this%20related%3F%20store.cc%3A1094%3A%20%22store_status%20%3D%3D%0A%20STORE_PENDING%22%20%2B%20TCP_MISS_ABORTED&In-Reply-To=%3C16fec301-cf16-633f-88b3-91ffb6ddaec7%40measurement-factory.com%3E"
       TITLE="[squid-users] Is this related? store.cc:1094: &quot;store_status == STORE_PENDING&quot; + TCP_MISS_ABORTED">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Nov 23 14:58:49 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="024283.html">[squid-users] Is this related? store.cc:1094: &quot;store_status == STORE_PENDING&quot; + TCP_MISS_ABORTED
</A></li>
        <LI>Next message (by thread): <A HREF="024289.html">[squid-users] %notes in error pages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24286">[ date ]</a>
              <a href="thread.html#24286">[ thread ]</a>
              <a href="subject.html#24286">[ subject ]</a>
              <a href="author.html#24286">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 11/23/21 5:10 AM, Lou&#269;ansk&#253; Luk&#225;&#353; wrote:

&gt;<i> I've noticed that my squid asserted on store.cc line 1094 which I
</I>&gt;<i> read as a test to see if the store is in progress while the transfer
</I>&gt;<i> is being aborted.
</I>
I would not describe STORE_PENDING status as &quot;the store is in progress&quot;
because that status covers other StoreEntry states as well. I cannot be
sure without research, but I suspect that the code author was trying to
assert() that the StoreEntry has not been fully written/stored at the
time of the abort() method call. I do not like that assertion, but I
hesitate suggesting specific fixes without understanding the cause of
the problem in your use case.


&gt;<i> Is it possible that the store is too slow 
</I>
Yes, of course: Any storage can be too slow, for some definition of &quot;too
slow&quot;.


&gt;<i> and is still pending operation while there is request abort?
</I>
There is a significant difference between StoreEntry::abort() and a
premature closure of a client-to-Squid connection (i.e. what you
probably mean by &quot;request abort&quot;). That difference aside and roughly
speaking, yes, a client or server may abort the transaction at any time.
And there might be other reasons beyond Squid control for transaction
and StoreEntry aborts.


&gt;<i> This rock storage is 64GB in size, slot size 32kB, max-swap-rate 200,
</I>&gt;<i> swap-timeout 250. fio with randomread shows 587 IOPS (bs 32k, iodepth
</I>&gt;<i> 1), with rwmixread 75 read IOPS 490 write IOPS 167.
</I>
If the measured limit is 167 raw writes/s, then I would be concerned
that you are overloading your disks with 200 IOs/s max-swap-rate,
especially if your disk byte hit ratio is low (it usually is). You may
be able to tell whether the disks are overloaded by monitoring their
utilization percentage in &quot;iostats -dx&quot; or similar, especially if you
are using hard drives rather than SSDs.


&gt;<i> Is this related? Can I do anyzhing to avoid such asserts?
</I>
I can only repeat my earlier suggestion: File a bug report with &quot;bt
full&quot; backtrace from the assertion and keep the core file around for
analysis. If you can reproduce the assertion at will (e.g., by aborting
long downloads), then please post the reproducing instructions as well.
We can often fix the bugs we can reproduce much faster than other bugs.


HTH,

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="024283.html">[squid-users] Is this related? store.cc:1094: &quot;store_status == STORE_PENDING&quot; + TCP_MISS_ABORTED
</A></li>
	<LI>Next message (by thread): <A HREF="024289.html">[squid-users] %notes in error pages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24286">[ date ]</a>
              <a href="thread.html#24286">[ thread ]</a>
              <a href="subject.html#24286">[ subject ]</a>
              <a href="author.html#24286">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
