<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] [squid-announce] [ADVISORY] SQUID-2020:12 Out-Of-Bounds memory access in WCCPv2
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%5Bsquid-announce%5D%20%5BADVISORY%5D%20SQUID-2020%3A12%0A%20Out-Of-Bounds%20memory%20access%20in%20WCCPv2&In-Reply-To=%3Cac306466-7332-e402-7792-766b68b7641c%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024131.html">
   <LINK REL="Next"  HREF="024134.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] [squid-announce] [ADVISORY] SQUID-2020:12 Out-Of-Bounds memory access in WCCPv2</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%5Bsquid-announce%5D%20%5BADVISORY%5D%20SQUID-2020%3A12%0A%20Out-Of-Bounds%20memory%20access%20in%20WCCPv2&In-Reply-To=%3Cac306466-7332-e402-7792-766b68b7641c%40treenet.co.nz%3E"
       TITLE="[squid-users] [squid-announce] [ADVISORY] SQUID-2020:12 Out-Of-Bounds memory access in WCCPv2">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon Oct  4 01:34:07 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="024131.html">[squid-users] Sorry if this has been asked but I can't find an answer anywhere ...
</A></li>
        <LI>Next message (by thread): <A HREF="024134.html">[squid-users] [squid-announce] Squid 4.17 is available
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24133">[ date ]</a>
              <a href="thread.html#24133">[ thread ]</a>
              <a href="subject.html#24133">[ subject ]</a>
              <a href="author.html#24133">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>__________________________________________________________________

     Squid Proxy Cache Security Update Advisory SQUID-2020:12
__________________________________________________________________

Advisory ID:       | SQUID-2020:12
Date:              | Oct 03, 2021
Summary:           | Out-Of-Bounds memory access in WCCPv2
Affected versions: | Squid 2.6 -&gt; 2.7.STABLE9
                    | Squid 3.x -&gt; 3.5.28
                    | Squid 4.x -&gt; 4.16
                    | Squid 5.x -&gt; 5.1
Fixed in version:  | Squid 4.17 and 5.2
__________________________________________________________________

   &lt;<A HREF="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-28116">http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-28116</A>&gt;
   &lt;<A HREF="https://www.zerodayinitiative.com/advisories/ZDI-CAN-11610">https://www.zerodayinitiative.com/advisories/ZDI-CAN-11610</A>&gt;
__________________________________________________________________

Problem Description:

  Due to an out of bounds memory access Squid is vulnerable to an
  information leak vulnerability when processing WCCPv2 messages.

__________________________________________________________________

Severity:

  This problem allows a WCCPv2 sender to corrupt Squids list of
  known WCCP routers and divert client traffic to attacker
   controlled routers.

  This attack is limited to Squid proxy with WCCPv2 enabled and
  IP spoofing of a router IP address configured as trusted in
  squid.conf.

CVSS Score of 7.7
&lt;<A HREF="https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=AV:N/AC:H/PR:N/UI:N/S:C/C:H/I:H/A:N/E:X/RL:O/RC:C/CR:H/IR:H/AR:X/MAV:N/MAC:H/MPR:N/MUI:X/MS:U/MC:H/MI:H/MA:X&amp;version=3.1">https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=AV:N/AC:H/PR:N/UI:N/S:C/C:H/I:H/A:N/E:X/RL:O/RC:C/CR:H/IR:H/AR:X/MAV:N/MAC:H/MPR:N/MUI:X/MS:U/MC:H/MI:H/MA:X&amp;version=3.1</A>&gt;

__________________________________________________________________

Updated Packages:

This bug is fixed by Squid versions 4.17 and 5.2.

  In addition, patches addressing this problem for the stable
  releases can be found in our patch archives:

Squid 4:
  &lt;<A HREF="http://www.squid-cache.org/Versions/v4/changesets/SQUID-2020_12.patch">http://www.squid-cache.org/Versions/v4/changesets/SQUID-2020_12.patch</A>&gt;

Squid 5:
 
&lt;<A HREF="http://www.squid-cache.org/Versions/v5/changesets/squid-5-7a73a54cefff6bb83c03de219a73276e42d183d0.patch">http://www.squid-cache.org/Versions/v5/changesets/squid-5-7a73a54cefff6bb83c03de219a73276e42d183d0.patch</A>&gt;

  If you are using a prepackaged version of Squid then please
  refer to the package vendor for availability information on
  updated packages.

__________________________________________________________________

Determining if your version is vulnerable:

  All Squid built with --disable-wccpv2 are not vulnerable.

  All Squid-3.x up to and including 3.5.28 built with
  --enable-wccpv2 and configured with wccp2_router in squid.conf
  are vulnerable.

  All Squid-3.x up to and including 3.5.28 built without
  --disable-wccpv2 and configured with wccp2_router in squid.conf
  are vulnerable.

  All Squid-4.x up to and including 4.16 built with
  --enable-wccpv2 and configured with wccp2_router in squid.conf
  are vulnerable.

  All Squid-4.x up to and including 4.16 built without
  --disable-wccpv2 and configured with wccp2_router in squid.conf
  are vulnerable.

  All Squid-5.x up to and including 5.1 built with
  --enable-wccpv2 and configured with wccp2_router in squid.conf
  are vulnerable.

  All Squid-5.x up to and including 5.1 built without
  --disable-wccpv2 and configured with wccp2_router in squid.conf
  are vulnerable.

__________________________________________________________________

Workaround:

Either,

The following network security Best Practices will greatly
restrict the ability of any attacker utilizing this
vulnerability. They can be considered workarounds for this
issue:

  * Use Private IP address for control communications (eg WCCPv2)
    with routers.

  * Firewall restriction of UDP traffic on port 2048 and any
    other UDP ports used for WCCP(v2) control messages to only
    permit known devices to communicate with WCCP(v2).

    Note that ports used by clients and diverted by WCCP (eg 80
    or 443) are not relevant.

  * Ensure the network implements BCP 38 spoofing protection.
    Include protection against LAN traffic spoofing as much as
    possible.
    See also &lt;<A HREF="http://www.bcp38.info">http://www.bcp38.info</A>&gt; and 
&lt;<A HREF="https://tools.ietf.org/html/bcp38">https://tools.ietf.org/html/bcp38</A>&gt;.

Or,

  Build Squid with --disable-wccpv2

Or,

  Remove all lines for wccp2_* directives from squid.conf.
  The default configuration is not to enable WCCPv2.

__________________________________________________________________

Contact details for the Squid project:

  For installation / upgrade support on binary packaged versions
  of Squid: Your first point of contact should be your binary
  package vendor.

  If you install and build Squid from the original Squid sources
  then the &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt; mailing list is
  your primary support point. For subscription details see
  &lt;<A HREF="http://www.squid-cache.org/Support/mailing-lists.html">http://www.squid-cache.org/Support/mailing-lists.html</A>&gt;.

  For reporting of non-security bugs in the latest STABLE release
  the squid bugzilla database should be used
  &lt;<A HREF="http://bugs.squid-cache.org/">http://bugs.squid-cache.org/</A>&gt;.

  For reporting of security sensitive bugs send an email to the
  &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-bugs at lists.squid-cache.org</A>&gt; mailing list. It's a closed
  list (though anyone can post) and security related bug reports
  are treated in confidence until the impact has been established.

__________________________________________________________________

Credits:

  This vulnerability was discovered by Lyu working with Trend
  Micro Zero Day Initiative.

  Fixed by Amos Jeffries of Treehouse Networks Ltd.

__________________________________________________________________

Revision history:

  2020-08-17 10:43:36 UTC Initial Report
  2021-02-09 00:00:00 UTC Advisory Release by ZDI
  2021-10-03 00:00:00 UTC Packages Released

__________________________________________________________________
END
_______________________________________________
squid-announce mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-announce at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-announce">http://lists.squid-cache.org/listinfo/squid-announce</A>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="024131.html">[squid-users] Sorry if this has been asked but I can't find an answer anywhere ...
</A></li>
	<LI>Next message (by thread): <A HREF="024134.html">[squid-users] [squid-announce] Squid 4.17 is available
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24133">[ date ]</a>
              <a href="thread.html#24133">[ thread ]</a>
              <a href="subject.html#24133">[ subject ]</a>
              <a href="author.html#24133">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
