<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Kerberos authentication with multiple squids
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Kerberos%20authentication%20with%20multiple%20squids&In-Reply-To=%3Cskf9pr%24bam%241%40ciao.gmane.io%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024174.html">
   <LINK REL="Next"  HREF="024175.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Kerberos authentication with multiple squids</H1>
    <B>Markus Moeller</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Kerberos%20authentication%20with%20multiple%20squids&In-Reply-To=%3Cskf9pr%24bam%241%40ciao.gmane.io%3E"
       TITLE="[squid-users] Kerberos authentication with multiple squids">huaraz at moeller.plus.com
       </A><BR>
    <I>Sat Oct 16 19:39:31 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="024174.html">[squid-users] Kerberos authentication with multiple squids
</A></li>
        <LI>Next message (by thread): <A HREF="024175.html">[squid-users] Kerberos authentication with multiple squids
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24182">[ date ]</a>
              <a href="thread.html#24182">[ thread ]</a>
              <a href="subject.html#24182">[ subject ]</a>
              <a href="author.html#24182">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Amos,

   If you let me know where exactly I can add a few lines.

   One way to make this setup work would be to add proxy1 also to AD like 
proxy2 and then merge the keytab for proxy1 into the keytab of proxy2 using 
ktutil. The negotiate_kerberos_auth handle would require the -s 
GSS_C_NO_NAME option to select either key.

  A second option is to add a second service principal name to the proxy2 AD 
account and use -s GSS_C_NO_NAME.

Regards
Markus


&quot;Amos Jeffries&quot;  wrote in message 
news:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">95c70ccd-5c15-3395-2103-3025ef043ebd at treenet.co.nz...</A>


On 14/10/21 8:48 am, Markus Moeller wrote:
&gt;<i> The problem lies more in the way how Kerberos proxy authentication works. 
</I>&gt;<i> The client uses the proxy name to create a ticket and in this case it 
</I>&gt;<i> would be the name of the first proxy e.g. proxy1.internal.  The first 
</I>&gt;<i> proxy will pass it through to the authenticating proxy for authentication 
</I>&gt;<i> proxy2.internal. Now the client receiving a 407 thinks that proxy1 asked 
</I>&gt;<i> for authentication (not knowing it is only a passthrough) and will ask for 
</I>&gt;<i> a ticket for proxy1, which it can't get as proxy1 is not in AD.  Even if 
</I>&gt;<i> proxy1 would be in AD, the client would send a proxy1 ticket to proxy2 
</I>&gt;<i> which will be rejected.
</I>&gt;<i>
</I>&gt;<i> Markus
</I>&gt;<i> \
</I>
Aha. That make ssense.

Can we get the Kerberos auth wiki page updated with that info? this is
something that has come up a few times.


Cheers
Amos
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A> 



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="024174.html">[squid-users] Kerberos authentication with multiple squids
</A></li>
	<LI>Next message (by thread): <A HREF="024175.html">[squid-users] Kerberos authentication with multiple squids
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24182">[ date ]</a>
              <a href="thread.html#24182">[ thread ]</a>
              <a href="subject.html#24182">[ subject ]</a>
              <a href="author.html#24182">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
