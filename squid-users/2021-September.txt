From ben.goz87 at gmail.com  Thu Sep  2 10:43:33 2021
From: ben.goz87 at gmail.com (Ben Goz)
Date: Thu, 2 Sep 2021 13:43:33 +0300
Subject: [squid-users] Transparent proxy http 3xx status issues
Message-ID: <CADAqQfwuc_wkWD+a1Bm9QomhQe3Gn_x3CfAm6YrnEM598uSa9A@mail.gmail.com>

By the help of God.

I configured squid to be transparent proxy with ssl bump
I saw that when the users trying to access next.co.il or pinterest.com
They observed squid errors sometimes it's connection refused sometimes
connection timed out

But when I bypass squid proxy it's working fine.

I saw that next.co.il sends http 302 redirect messages
Maybe I'm missing some configuration that doesn't send back those
packets to the users?

Thanks,
Ben


From moberger at metanetworks.com  Thu Sep  2 12:07:08 2021
From: moberger at metanetworks.com (Moti Berger)
Date: Thu, 2 Sep 2021 15:07:08 +0300
Subject: [squid-users] New line in logformat
Message-ID: <CAGSk-41aLOng3ZUeVzArUz_bFDhPATF-anUgKyErhAc0ox0+ZQ@mail.gmail.com>

Hi

I want to send metrics to statsd, so I tried doing the following:

> logformat metrics_statsd
> my_service_latency:%{my_service}adapt::sum_trs|ms\nicap_total:%icap::tt|ms
>
access_log tcp://1.2.3.4:8125 logformat=metrics_statsd


In statsd daemon I see only the first (it supports multiple metrics
separated by \n -
https://github.com/statsd/statsd/blob/master/docs/server.md)
>From http://www.squid-cache.org/Doc/config/logformat/ I understand that
'\n' is what I need to use in order to get a new line, but it seems I get
two characters instead - '\' and 'n'.
What is the proper way to have a new line?

Thanks,
Moti
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210902/9f018939/attachment.htm>

From squid3 at treenet.co.nz  Thu Sep  2 13:20:30 2021
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 3 Sep 2021 01:20:30 +1200
Subject: [squid-users] Transparent proxy http 3xx status issues
In-Reply-To: <CADAqQfwuc_wkWD+a1Bm9QomhQe3Gn_x3CfAm6YrnEM598uSa9A@mail.gmail.com>
References: <CADAqQfwuc_wkWD+a1Bm9QomhQe3Gn_x3CfAm6YrnEM598uSa9A@mail.gmail.com>
Message-ID: <76f207fa-d070-7093-006b-7db033fc7e96@treenet.co.nz>

On 2/09/21 10:43 pm, Ben Goz wrote:
> By the help of God.
> 
> I configured squid to be transparent proxy with ssl bump
> I saw that when the users trying to access next.co.il or pinterest.com
> They observed squid errors sometimes it's connection refused sometimes
> connection timed out
> 
> But when I bypass squid proxy it's working fine.
> 
> I saw that next.co.il sends http 302 redirect messages
> Maybe I'm missing some configuration that doesn't send back those
> packets to the users?
> 

There are several things you could do, but which is correct depends on ...

Which version of Squid are you using?

By "transparent proxy" what configuration do you mean?

What message is Squid sending to that server when it gets a 302 redirect?


Amos


From uzee001 at yahoo.com  Thu Sep  2 13:28:49 2021
From: uzee001 at yahoo.com (U Zee)
Date: Thu, 2 Sep 2021 13:28:49 +0000 (UTC)
Subject: [squid-users] Fwd:  Getting a squid clients list
In-Reply-To: <960522696.1390939.1630421412728@mail.yahoo.com>
References: <28129445.847427.1630305303013.ref@mail.yahoo.com>
 <28129445.847427.1630305303013@mail.yahoo.com>
 <f30ef21e-9d2a-d48d-7e8a-e61bd200bf03@treenet.co.nz>
 <412730933.885899.1630318687240@mail.yahoo.com>
 <fa799223-0259-e839-4d17-17099db7fc93@treenet.co.nz>
 <2137930776.899158.1630323862982@mail.yahoo.com>
 <CABA8h=R2xJ38_8am92tDb-E6SiJ4pJm6Sn5-DqcxUA7HaJC+tQ@mail.gmail.com>
 <CABA8h=ROTEtUg=Kw_RV1uEXqfKYUpQh=AN9iqj00Cn0-Nhc5QQ@mail.gmail.com>
 <960522696.1390939.1630421412728@mail.yahoo.com>
Message-ID: <567906822.2214667.1630589329959@mail.yahoo.com>

 Can anyone help with running squidclient remotely and getting the list of clients, or any other way to get the list of clients?
Thanks very much
    On Tuesday, August 31, 2021, 05:50:12 PM GMT+3, U Zee <uzee001 at yahoo.com> wrote:  
 
  Thanks for the pointer?Eliezer. I installed it on an Ubuntu 20 machine and tried but it didn't seem to work:
 root at ub20-srv1:~# squidclient -h squid.mydomain.com mgr:client_listHTTP/1.0 403 ForbiddenServer: squid/2.6.STABLE13Date: Tue, 31 Aug 2021 14:45:09 GMTContent-Type: text/htmlContent-Length: 1115Expires: Tue, 31 Aug 2021 14:45:09 GMTX-Squid-Error: ERR_ACCESS_DENIED 0X-Cache: MISS from squid.mydomain.com?Via: 1.0 squid.mydomain.com:3128 (squid/2.6.STABLE13)Proxy-Connection: close
root at ub20-srv1:~# squidclient -h squid.mydomain.com? mgr:infoHTTP/1.0 403 ForbiddenServer: squid/2.6.STABLE13Date: Tue, 31 Aug 2021 14:46:33 GMTContent-Type: text/htmlContent-Length: 1101Expires: Tue, 31 Aug 2021 14:46:33 GMTX-Squid-Error: ERR_ACCESS_DENIED 0X-Cache: MISS from squid.mydomain.com?Via: 1.0 squid.mydomain.com:3128 (squid/2.6.STABLE13)Proxy-Connection: close
Although the proxy function seems to be working, but I cannot get the "mgr" function to work:
root at ub20-srv1:~# squidclient -h squid.mydomain.com?-v http://vmware.comRequest:GET http://vmware.com HTTP/1.0Host: vmware.comUser-Agent: squidclient/4.10Accept: */*Connection: close.
HTTP/1.0 301 Moved PermanentlyLocation: https://www.vmware.com/Content-Length: 0X-Cache: MISS from squid.mydomain.com?Via: 1.0 squid.mydomain.com:3128 (squid/2.6.STABLE13)Proxy-Connection: close




    On Monday, August 30, 2021, 02:56:29 PM GMT+3, NgTech LTD <ngtech1ltd at gmail.com> wrote:  
 
 
Hey Uzee,
You can use squidclient from another machine to access this machine.I do not remember how by heart but Amos might know if I am guessing right.
Eliezer
?????? ??? ??, 30 ????? 2021, 14:44, ??? U Zee ?<uzee001 at yahoo.com>:

 <sigh> I know and sadly installing it is not possible either. Without going into the details too much, its a machine with a legacy environment where yum and some other tools are broken and people who knew about the configs are long gone.
    On Monday, August 30, 2021, 01:29:47 PM GMT+3, Amos Jeffries <squid3 at treenet.co.nz> wrote:  
 
 On 30/08/21 10:18 pm, U Zee wrote:
> Thanks Amos. I don't think the clientdb features you mentioned are 
> enabled, I'm getting a command not found.
> Also I don't see anything configured for logging in squid.conf (I don't 
> know if there is any other place for it)
> 
> bash-3.00# ps -ef|grep squid
> root? ? ? 2467? ? ?1? 0? 2020 ?? ? ? ? 00:00:00 /usr/squid/sbin/squid
> nobody? ? 2471? 2467? 0? 2020 ?? ? ? ? 07:49:45 (squid)
> root? ? ?28018 20110? 0 13:12 pts/0? ? 00:00:00 grep squid
> 
> bash-3.00# /usr/squid/sbin/squid -v
> Squid Cache: Version 2.6.STABLE13
> configure options: '--prefix=/usr/squid' 'CC=gcc' 'CFLAGS=-O3 -g'
> 
> bash-3.00# squidclient mgr:client_list | grep "Address"
> bash: squidclient: command not found

That is the squidclient tool missing on your machine.

Amos
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users
  _______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users

_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users
    
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210902/6943bb58/attachment.htm>

From ben.goz87 at gmail.com  Thu Sep  2 13:32:58 2021
From: ben.goz87 at gmail.com (Ben Goz)
Date: Thu, 2 Sep 2021 16:32:58 +0300
Subject: [squid-users] Transparent proxy http 3xx status issues
In-Reply-To: <76f207fa-d070-7093-006b-7db033fc7e96@treenet.co.nz>
References: <CADAqQfwuc_wkWD+a1Bm9QomhQe3Gn_x3CfAm6YrnEM598uSa9A@mail.gmail.com>
 <76f207fa-d070-7093-006b-7db033fc7e96@treenet.co.nz>
Message-ID: <CADAqQfybKeGDtd6KDQG-ZxW+F9gzEM=wQyhGg=XH4gnJ3=m-qw@mail.gmail.com>

By the help of God.

I'm using squid 4.15

When I said transparent proxy I meant to say that I'm using tproxy
configuration with iptables redirection.

Squid returns http 503 and when bypassing squid I see http 302.

What do you think is the best way to overcome this problem?

Thanks,
Ben

??????? ??? ??, 2 ????? 2021 ?-16:25 ??? ?Amos Jeffries??
<?squid3 at treenet.co.nz??>:?
>
> On 2/09/21 10:43 pm, Ben Goz wrote:
> > By the help of God.
> >
> > I configured squid to be transparent proxy with ssl bump
> > I saw that when the users trying to access next.co.il or pinterest.com
> > They observed squid errors sometimes it's connection refused sometimes
> > connection timed out
> >
> > But when I bypass squid proxy it's working fine.
> >
> > I saw that next.co.il sends http 302 redirect messages
> > Maybe I'm missing some configuration that doesn't send back those
> > packets to the users?
> >
>
> There are several things you could do, but which is correct depends on ...
>
> Which version of Squid are you using?
>
> By "transparent proxy" what configuration do you mean?
>
> What message is Squid sending to that server when it gets a 302 redirect?
>
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users


From squid3 at treenet.co.nz  Thu Sep  2 13:44:42 2021
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 3 Sep 2021 01:44:42 +1200
Subject: [squid-users] New line in logformat
In-Reply-To: <CAGSk-41aLOng3ZUeVzArUz_bFDhPATF-anUgKyErhAc0ox0+ZQ@mail.gmail.com>
References: <CAGSk-41aLOng3ZUeVzArUz_bFDhPATF-anUgKyErhAc0ox0+ZQ@mail.gmail.com>
Message-ID: <4581b307-d01e-bfa8-ad5e-a10467545521@treenet.co.nz>

On 3/09/21 12:07 am, Moti Berger wrote:
> Hi
> 
> I want to send metrics to statsd, so I tried doing the following:
> 
>     logformat metrics_statsd
>     my_service_latency:%{my_service}adapt::sum_trs|ms\nicap_total:%icap::tt|ms
> 
>     access_log tcp://1.2.3.4:8125 <http://1.2.3.4:8125>
>     logformat=metrics_statsd 
> 
> 
> In statsd daemon I see only the first (it supports multiple metrics 
> separated by \n - 

Ouch.  You may be able to work around this with a logformat for each 
metric you want to send and a access_log line sending that metric.

Otherwise you are looking at a patch for either Squid or the statsd daemon.

I am happy to assist with a patch for Squid if you want to. Contact me 
directly for rates etc.

Amos


From squid3 at treenet.co.nz  Thu Sep  2 13:52:38 2021
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 3 Sep 2021 01:52:38 +1200
Subject: [squid-users] Fwd: Getting a squid clients list
In-Reply-To: <567906822.2214667.1630589329959@mail.yahoo.com>
References: <28129445.847427.1630305303013.ref@mail.yahoo.com>
 <28129445.847427.1630305303013@mail.yahoo.com>
 <f30ef21e-9d2a-d48d-7e8a-e61bd200bf03@treenet.co.nz>
 <412730933.885899.1630318687240@mail.yahoo.com>
 <fa799223-0259-e839-4d17-17099db7fc93@treenet.co.nz>
 <2137930776.899158.1630323862982@mail.yahoo.com>
 <CABA8h=R2xJ38_8am92tDb-E6SiJ4pJm6Sn5-DqcxUA7HaJC+tQ@mail.gmail.com>
 <CABA8h=ROTEtUg=Kw_RV1uEXqfKYUpQh=AN9iqj00Cn0-Nhc5QQ@mail.gmail.com>
 <960522696.1390939.1630421412728@mail.yahoo.com>
 <567906822.2214667.1630589329959@mail.yahoo.com>
Message-ID: <6fc3bd9d-c280-4d14-7c78-834c9cd92208@treenet.co.nz>

On 3/09/21 1:28 am, U Zee wrote:
> Can anyone help with running squidclient remotely and getting the list 
> of clients, or any other way to get the list of clients?
> 


You just need to adjust the squid.conf of the running Squid to allow 
management access to the machine you are fetching from.


Be aware:
   Make sure that you only use reconfigure and avoid a restart of the 
proxy after making these changes. A restart will erase some or all of 
the info you are looking to find.


With the CLIENT_IP being address of the machine you are going to do the 
fetch from these commands go at the top of squid.conf:

   acl mgr_client src CLIENT_IP
   http_access allow mgr_client
   cachemgr_passwd none client_list


... *reconfigure* (not restart) the proxy.

... run the squidclient fetch you want

.. undo or at least comment out the above settings and reconfigure.



Amos


> Thanks very much
> 
> On Tuesday, August 31, 2021, 05:50:12 PM GMT+3, U Zee 
> <uzee001 at yahoo.com> wrote:
> 
> 
> Thanks for the pointer Eliezer. I installed it on an Ubuntu 20 machine 
> and tried but it didn't seem to work:
> 
> root at ub20-srv1:~# squidclient -h squid.mydomain.com mgr:client_list
> HTTP/1.0 403 Forbidden
> Server: squid/2.6.STABLE13
> Date: Tue, 31 Aug 2021 14:45:09 GMT
> Content-Type: text/html
> Content-Length: 1115
> Expires: Tue, 31 Aug 2021 14:45:09 GMT
> X-Squid-Error: ERR_ACCESS_DENIED 0
> X-Cache: MISS from squid.mydomain.com
> Via: 1.0 squid.mydomain.com:3128 (squid/2.6.STABLE13)
> Proxy-Connection: close
> 
> root at ub20-srv1:~# squidclient -h squid.mydomain.com? mgr:info
> HTTP/1.0 403 Forbidden
> Server: squid/2.6.STABLE13
> Date: Tue, 31 Aug 2021 14:46:33 GMT
> Content-Type: text/html
> Content-Length: 1101
> Expires: Tue, 31 Aug 2021 14:46:33 GMT
> X-Squid-Error: ERR_ACCESS_DENIED 0
> X-Cache: MISS from squid.mydomain.com
> Via: 1.0 squid.mydomain.com:3128 (squid/2.6.STABLE13)
> Proxy-Connection: close
> 
> Although the proxy function seems to be working, but I cannot get the 
> "mgr" function to work:
> 
> root at ub20-srv1:~# squidclient -h squid.mydomain.com?-v http://vmware.com
> Request:
> GET http://vmware.com HTTP/1.0
> Host: vmware.com
> User-Agent: squidclient/4.10
> Accept: */*
> Connection: close
> .
> HTTP/1.0 301 Moved Permanently
> Location: https://www.vmware.com/
> Content-Length: 0
> X-Cache: MISS from squid.mydomain.com
> Via: 1.0 squid.mydomain.com:3128 (squid/2.6.STABLE13)
> Proxy-Connection: close
> 
> 
> 
> 
> 
> On Monday, August 30, 2021, 02:56:29 PM GMT+3, NgTech LTD 
> <ngtech1ltd at gmail.com> wrote:
> 
> 
> 
> Hey Uzee,
> 
> You can use squidclient from another machine to access this machine.
> I do not remember how by heart but Amos might know if I am guessing right.
> 
> Eliezer
> 
> ?????? ??? ??, 30 ????? 2021, 14:44, ??? U Zee ?<uzee001 at yahoo.com 
> <mailto:uzee001 at yahoo.com>>:
> 
>     <sigh> I know and sadly installing it is not possible either.
>     Without going into the details too much, its a machine with a legacy
>     environment where yum and some other tools are broken and people who
>     knew about the configs are long gone.
> 
>     On Monday, August 30, 2021, 01:29:47 PM GMT+3, Amos Jeffries
>     <squid3 at treenet.co.nz <mailto:squid3 at treenet.co.nz>> wrote:
> 
> 
>     On 30/08/21 10:18 pm, U Zee wrote:
>      > Thanks Amos. I don't think the clientdb features you mentioned are
>      > enabled, I'm getting a command not found.
>      > Also I don't see anything configured for logging in squid.conf (I
>     don't
>      > know if there is any other place for it)
>      >
>      > bash-3.00# ps -ef|grep squid
>      > root? ? ? 2467? ? ?1? 0? 2020 ?? ? ? ? 00:00:00 /usr/squid/sbin/squid
>      > nobody? ? 2471? 2467? 0? 2020 ?? ? ? ? 07:49:45 (squid)
>      > root? ? ?28018 20110? 0 13:12 pts/0? ? 00:00:00 grep squid
>      >
>      > bash-3.00# /usr/squid/sbin/squid -v
>      > Squid Cache: Version 2.6.STABLE13
>      > configure options: '--prefix=/usr/squid' 'CC=gcc' 'CFLAGS=-O3 -g'
>      >
>      > bash-3.00# squidclient mgr:client_list | grep "Address"
>      > bash: squidclient: command not found
> 
>     That is the squidclient tool missing on your machine.
> 
> 
>     Amos
>     _______________________________________________
>     squid-users mailing list
>     squid-users at lists.squid-cache.org
>     <mailto:squid-users at lists.squid-cache.org>
>     http://lists.squid-cache.org/listinfo/squid-users
>     <http://lists.squid-cache.org/listinfo/squid-users>
>     _______________________________________________
>     squid-users mailing list
>     squid-users at lists.squid-cache.org
>     <mailto:squid-users at lists.squid-cache.org>
>     http://lists.squid-cache.org/listinfo/squid-users
>     <http://lists.squid-cache.org/listinfo/squid-users>
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org>
> http://lists.squid-cache.org/listinfo/squid-users 
> <http://lists.squid-cache.org/listinfo/squid-users>
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 


From shadowpilot34 at gmail.com  Thu Sep  2 17:15:27 2021
From: shadowpilot34 at gmail.com (His Shadow)
Date: Thu, 2 Sep 2021 20:15:27 +0300
Subject: [squid-users] New line in logformat
In-Reply-To: <4581b307-d01e-bfa8-ad5e-a10467545521@treenet.co.nz>
References: <CAGSk-41aLOng3ZUeVzArUz_bFDhPATF-anUgKyErhAc0ox0+ZQ@mail.gmail.com>
 <4581b307-d01e-bfa8-ad5e-a10467545521@treenet.co.nz>
Message-ID: <CAK7W0xfc9Wa0sg8E5LYs6ax6r-91K4t3ypkaVFooGZxWSKT33A@mail.gmail.com>

I think it would be easier to just write a logfile daemon, than
patching squid. The protocol is very easy.
http://www.squid-cache.org/Doc/config/logfile_daemon/
You'd just ignore everything but lines starting with L.

??, 2 ????. 2021 ?. ? 16:49, Amos Jeffries <squid3 at treenet.co.nz>:
>
> On 3/09/21 12:07 am, Moti Berger wrote:
> > Hi
> >
> > I want to send metrics to statsd, so I tried doing the following:
> >
> >     logformat metrics_statsd
> >     my_service_latency:%{my_service}adapt::sum_trs|ms\nicap_total:%icap::tt|ms
> >
> >     access_log tcp://1.2.3.4:8125 <http://1.2.3.4:8125>
> >     logformat=metrics_statsd
> >
> >
> > In statsd daemon I see only the first (it supports multiple metrics
> > separated by \n -
>
> Ouch.  You may be able to work around this with a logformat for each
> metric you want to send and a access_log line sending that metric.
>
> Otherwise you are looking at a patch for either Squid or the statsd daemon.
>
> I am happy to assist with a patch for Squid if you want to. Contact me
> directly for rates etc.
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



-- 
HisShadow


From graham at gwharton.me.uk  Sat Sep  4 10:44:18 2021
From: graham at gwharton.me.uk (Graham Wharton)
Date: Sat, 4 Sep 2021 10:44:18 +0000
Subject: [squid-users] Configuring SSL Bump on CONNECT,
 but no SSL Bump on Transparent
Message-ID: <LO2P123MB600857B60EE5321B3DC97BD9A9D09@LO2P123MB6008.GBRP123.PROD.OUTLOOK.COM>

Hi all,

Squid 3.5.20

I am attempting to configure the following

Port 3128 = Accepts CONNECT requests with SSL Bump for all sites
Port 3129 = HTTP port for transparent proxy
Port 3130 = HTTPS port for transparent proxy - NO SSL Bump, all sites should always TUNNEL

Is the above config possible?

The relevant sections of my config are

#TANSPARENT
http_port 10.0.0.36:3129
https_port 10.0.0.36:3130

#CONNECT
http_port 10.0.0.36:3128 ssl-bump \
        cert=/etc/squid/ssl_cert/squid-ca-cert.pem \
        generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
sslcrtd_program /usr/lib64/squid/ssl_crtd -s /var/lib/ssl_db -M 4MB

#Permissions
http_access allow localnet
http_access allow localhost
http_access deny all

##Steps
acl step1 at_step SslBump1
acl step2 at_step SslBump2
acl step3 at_step SslBump3

#Bump Rules
ssl_bump peek step1
ssl_bump bump all
ssl_bump splice all

All appears to work correctly, apart from transparent connections for HTTPS. These are getting bumped.

According to the logs

2021/09/04 10:38:54.129 kid1| 5,2| TcpAcceptor.cc(218) doAccept: New connection on FD 30
2021/09/04 10:38:54.129 kid1| 5,2| TcpAcceptor.cc(293) acceptNext: connection on local=10.0.0.36:3130 remote=[::] FD 30 flags=41
2021/09/04 10:38:54.129 kid1| 33,2| client_side.cc(3920) httpsSslBumpAccessCheckDone: sslBump needed for local=142.250.187.196:443 remote=10.0.1.254:51928 FD 12 flags=33 method 3

Looking at the code, it would appear that because the destination is ALLOWED for the ssl_bump acl, the connection is automatically upgraded to ssl_bump by the httpsSslBumpAccessCheckDone function. But this isn't what I want. I want ssl_bump to be completely disabled on my transparent proxy, I only wan to bump connections for connections that have explicitly set their proxy.

Any suggestions on how to overcome this, apart from running two copies of squid.

Thanks in advance

Graham Wharton


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210904/143045b6/attachment.htm>

From graham at gwharton.me.uk  Sat Sep  4 11:47:33 2021
From: graham at gwharton.me.uk (Graham Wharton)
Date: Sat, 4 Sep 2021 11:47:33 +0000
Subject: [squid-users] Configuring SSL Bump on CONNECT,
 but no SSL Bump on Transparent
In-Reply-To: <LO2P123MB600857B60EE5321B3DC97BD9A9D09@LO2P123MB6008.GBRP123.PROD.OUTLOOK.COM>
References: <LO2P123MB600857B60EE5321B3DC97BD9A9D09@LO2P123MB6008.GBRP123.PROD.OUTLOOK.COM>
Message-ID: <LO2P123MB60089C758380A60CAE3BAD47A9D09@LO2P123MB6008.GBRP123.PROD.OUTLOOK.COM>

My apologies, that config snippet was not correct.

Besides I've managed to configure it using localport acl's to detect which port the request came in on and bump accordingly. Not sure if this is the best way.

Thanks for listening.

For info for anyone else interested

acl localnet src 10.0.0.0/8     # RFC1918 possible internal network
acl localnet src 172.16.0.0/12  # RFC1918 possible internal network
acl localnet src 192.168.0.0/16 # RFC1918 possible internal network
acl localnet src fc00::/7       # RFC 4193 local private network range
acl localnet src fe80::/10      # RFC 4291 link-local (directly plugged) machines
acl connectport localport 3128
http_port 10.0.0.36:3129 intercept
https_port 10.0.0.36:3130 intercept ssl-bump \
        cert=/etc/squid/ssl_cert/squid-ca-cert.pem \
        generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
http_port 10.0.0.36:3128 ssl-bump \
        cert=/etc/squid/ssl_cert/squid-ca-cert.pem \
        generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
sslcrtd_program /usr/lib64/squid/ssl_crtd -s /var/lib/ssl_db -M 4MB
http_access allow localnet
http_access allow localhost
http_access deny all
acl step1 at_step SslBump1
acl step2 at_step SslBump2
acl step3 at_step SslBump3
ssl_bump bump connectport
ssl_bump peek all
ssl_bump splice all

Cheers

Graham


From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Graham Wharton
Sent: 04 September 2021 11:44
To: squid-users at lists.squid-cache.org
Subject: [squid-users] Configuring SSL Bump on CONNECT, but no SSL Bump on Transparent

Hi all,

Squid 3.5.20

I am attempting to configure the following

Port 3128 = Accepts CONNECT requests with SSL Bump for all sites
Port 3129 = HTTP port for transparent proxy
Port 3130 = HTTPS port for transparent proxy - NO SSL Bump, all sites should always TUNNEL

Is the above config possible?

The relevant sections of my config are

#TANSPARENT
http_port 10.0.0.36:3129
https_port 10.0.0.36:3130

#CONNECT
http_port 10.0.0.36:3128 ssl-bump \
        cert=/etc/squid/ssl_cert/squid-ca-cert.pem \
        generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
sslcrtd_program /usr/lib64/squid/ssl_crtd -s /var/lib/ssl_db -M 4MB

#Permissions
http_access allow localnet
http_access allow localhost
http_access deny all

##Steps
acl step1 at_step SslBump1
acl step2 at_step SslBump2
acl step3 at_step SslBump3

#Bump Rules
ssl_bump peek step1
ssl_bump bump all
ssl_bump splice all

All appears to work correctly, apart from transparent connections for HTTPS. These are getting bumped.

According to the logs

2021/09/04 10:38:54.129 kid1| 5,2| TcpAcceptor.cc(218) doAccept: New connection on FD 30
2021/09/04 10:38:54.129 kid1| 5,2| TcpAcceptor.cc(293) acceptNext: connection on local=10.0.0.36:3130 remote=[::] FD 30 flags=41
2021/09/04 10:38:54.129 kid1| 33,2| client_side.cc(3920) httpsSslBumpAccessCheckDone: sslBump needed for local=142.250.187.196:443 remote=10.0.1.254:51928 FD 12 flags=33 method 3

Looking at the code, it would appear that because the destination is ALLOWED for the ssl_bump acl, the connection is automatically upgraded to ssl_bump by the httpsSslBumpAccessCheckDone function. But this isn't what I want. I want ssl_bump to be completely disabled on my transparent proxy, I only wan to bump connections for connections that have explicitly set their proxy.

Any suggestions on how to overcome this, apart from running two copies of squid.

Thanks in advance

Graham Wharton


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210904/c759e527/attachment.htm>

From rousskov at measurement-factory.com  Sat Sep  4 19:58:31 2021
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Sat, 4 Sep 2021 15:58:31 -0400
Subject: [squid-users] Configuring SSL Bump on CONNECT,
 but no SSL Bump on Transparent
In-Reply-To: <LO2P123MB60089C758380A60CAE3BAD47A9D09@LO2P123MB6008.GBRP123.PROD.OUTLOOK.COM>
References: <LO2P123MB600857B60EE5321B3DC97BD9A9D09@LO2P123MB6008.GBRP123.PROD.OUTLOOK.COM>
 <LO2P123MB60089C758380A60CAE3BAD47A9D09@LO2P123MB6008.GBRP123.PROD.OUTLOOK.COM>
Message-ID: <f4f894b6-290b-3043-dcc5-82dc668ab483@measurement-factory.com>

On 9/4/21 7:47 AM, Graham Wharton wrote:

> Besides I?ve managed to configure it using localport acl?s to detect
> which port the request came in on and bump accordingly. Not sure if this
> is the best way.

I do not remember what works in Squid v3, but, in general, the best way
is to name your ports and use the myportname ACL instead of trying to
match one of the many port numbers associated with transparent
connections, especially when Squid has a tendency to "swap" source and
destination addresses in that context.

Besides not running v3, I also would not try to bump at step1 -- there
is so little information for Squid to use during step1 that the client
is very unlikely to be happy about the Squid-generated certificate.

To bump at step2:

  ssl_bump peek step1
  ssl_bump bump shouldBeBumped
  ssl_bump splice all

or even step3:

  ssl_bump peek step1
  ssl_bump stare shouldBeBumped
  ssl_bump bump shouldBeBumped
  ssl_bump splice all

... where shouldBeBumped is your ACL that matches transactions that
should be bumped.


HTH,

Alex.


> ?
> 
> Thanks for listening.
> 
> ?
> 
> For info for anyone else interested
> 
> ?
> 
> acl localnet src 10.0.0.0/8???? # RFC1918 possible internal network
> 
> acl localnet src 172.16.0.0/12? # RFC1918 possible internal network
> 
> acl localnet src 192.168.0.0/16 # RFC1918 possible internal network
> 
> acl localnet src fc00::/7?????? # RFC 4193 local private network range
> 
> acl localnet src fe80::/10????? # RFC 4291 link-local (directly plugged)
> machines
> 
> acl connectport localport 3128
> 
> http_port 10.0.0.36:3129 intercept
> 
> https_port 10.0.0.36:3130 intercept ssl-bump \
> 
> ??????? cert=/etc/squid/ssl_cert/squid-ca-cert.pem \
> 
> ??????? generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
> 
> http_port 10.0.0.36:3128 ssl-bump \
> 
> ??????? cert=/etc/squid/ssl_cert/squid-ca-cert.pem \
> 
> ??????? generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
> 
> sslcrtd_program /usr/lib64/squid/ssl_crtd -s /var/lib/ssl_db -M 4MB
> 
> http_access allow localnet
> 
> http_access allow localhost
> 
> http_access deny all
> 
> acl step1 at_step SslBump1
> 
> acl step2 at_step SslBump2
> 
> acl step3 at_step SslBump3
> 
> ssl_bump bump connectport
> 
> ssl_bump peek all
> 
> ssl_bump splice all
> 
> ?
> 
> Cheers
> 
> ?
> 
> Graham
> 
> ?
> 
> ?
> 
> *From:*squid-users <squid-users-bounces at lists.squid-cache.org> *On
> Behalf Of *Graham Wharton
> *Sent:* 04 September 2021 11:44
> *To:* squid-users at lists.squid-cache.org
> *Subject:* [squid-users] Configuring SSL Bump on CONNECT, but no SSL
> Bump on Transparent
> 
> ?
> 
> Hi all,
> 
> ?
> 
> Squid 3.5.20
> 
> ?
> 
> I am attempting to configure the following
> 
> ?
> 
> Port 3128 = Accepts CONNECT requests with SSL Bump for all sites
> 
> Port 3129 = HTTP port for transparent proxy
> 
> Port 3130 = HTTPS port for transparent proxy ? NO SSL Bump, all sites
> should always TUNNEL
> 
> ?
> 
> Is the above config possible?
> 
> ?
> 
> The relevant sections of my config are
> 
> ?
> 
> #TANSPARENT
> 
> http_port 10.0.0.36:3129
> 
> https_port 10.0.0.36:3130
> 
> ?
> 
> #CONNECT
> 
> http_port 10.0.0.36:3128 ssl-bump \
> 
> ??????? cert=/etc/squid/ssl_cert/squid-ca-cert.pem \
> 
> ??????? generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
> 
> sslcrtd_program /usr/lib64/squid/ssl_crtd -s /var/lib/ssl_db -M 4MB
> 
> ?
> 
> #Permissions
> 
> http_access allow localnet
> 
> http_access allow localhost
> 
> http_access deny all
> 
> ?
> 
> ##Steps
> 
> acl step1 at_step SslBump1
> 
> acl step2 at_step SslBump2
> 
> acl step3 at_step SslBump3
> 
> ?
> 
> #Bump Rules
> 
> ssl_bump peek step1
> 
> ssl_bump bump all
> 
> ssl_bump splice all
> 
> ?
> 
> All appears to work correctly, apart from transparent connections for
> HTTPS. These are getting bumped.
> 
> ?
> 
> According to the logs
> 
> ?
> 
> 2021/09/04 10:38:54.129 kid1| 5,2| TcpAcceptor.cc(218) doAccept: New
> connection on FD 30
> 
> 2021/09/04 10:38:54.129 kid1| 5,2| TcpAcceptor.cc(293) acceptNext:
> connection on local=10.0.0.36:3130 remote=[::] FD 30 flags=41
> 
> 2021/09/04 10:38:54.129 kid1| 33,2| client_side.cc(3920)
> httpsSslBumpAccessCheckDone: sslBump needed for
> local=142.250.187.196:443 remote=10.0.1.254:51928 FD 12 flags=33 method 3
> 
> ?
> 
> Looking at the code, it would appear that because the destination is
> ALLOWED for the ssl_bump acl, the connection is automatically upgraded
> to ssl_bump by the httpsSslBumpAccessCheckDone function. But this isn?t
> what I want. I want ssl_bump to be completely disabled on my transparent
> proxy, I only wan to bump connections for connections that have
> explicitly set their proxy.
> 
> ?
> 
> Any suggestions on how to overcome this, apart from running two copies
> of squid.
> 
> ?
> 
> Thanks in advance
> 
> ?
> 
> Graham Wharton
> 
> ?
> 
> ?
> 
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 



From gtaylor at tnetconsulting.net  Sun Sep  5 05:54:48 2021
From: gtaylor at tnetconsulting.net (Grant Taylor)
Date: Sat, 4 Sep 2021 23:54:48 -0600
Subject: [squid-users] OT - myportname ACL
In-Reply-To: <f4f894b6-290b-3043-dcc5-82dc668ab483@measurement-factory.com>
References: <LO2P123MB600857B60EE5321B3DC97BD9A9D09@LO2P123MB6008.GBRP123.PROD.OUTLOOK.COM>
 <LO2P123MB60089C758380A60CAE3BAD47A9D09@LO2P123MB6008.GBRP123.PROD.OUTLOOK.COM>
 <f4f894b6-290b-3043-dcc5-82dc668ab483@measurement-factory.com>
Message-ID: <3cb3e42b-bca6-50c3-cfa2-6094dcd38671@spamtrap.tnetconsulting.net>

On 9/4/21 1:58 PM, Alex Rousskov wrote:
> the best way is to name your ports and use the myportname ACL instead 
> of trying to match one of the many port numbers associated with 
> transparent connections, especially when Squid has a tendency to 
> "swap" source and destination addresses in that context.

Please forgive my ignorance.  Will you please provide an example of what 
you mean by "use the myportname ACL"?  --  I'm relatively new to Squid 
(4.x) after having not used it for about 15 years.



-- 
Grant. . . .
unix || die

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4013 bytes
Desc: S/MIME Cryptographic Signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210904/aa9a3821/attachment.bin>

From uzee001 at yahoo.com  Sun Sep  5 08:59:43 2021
From: uzee001 at yahoo.com (U Zee)
Date: Sun, 5 Sep 2021 08:59:43 +0000 (UTC)
Subject: [squid-users] Fwd: Getting a squid clients list
In-Reply-To: <6fc3bd9d-c280-4d14-7c78-834c9cd92208@treenet.co.nz>
References: <28129445.847427.1630305303013.ref@mail.yahoo.com>
 <28129445.847427.1630305303013@mail.yahoo.com>
 <f30ef21e-9d2a-d48d-7e8a-e61bd200bf03@treenet.co.nz>
 <412730933.885899.1630318687240@mail.yahoo.com>
 <fa799223-0259-e839-4d17-17099db7fc93@treenet.co.nz>
 <2137930776.899158.1630323862982@mail.yahoo.com>
 <CABA8h=R2xJ38_8am92tDb-E6SiJ4pJm6Sn5-DqcxUA7HaJC+tQ@mail.gmail.com>
 <CABA8h=ROTEtUg=Kw_RV1uEXqfKYUpQh=AN9iqj00Cn0-Nhc5QQ@mail.gmail.com>
 <960522696.1390939.1630421412728@mail.yahoo.com>
 <567906822.2214667.1630589329959@mail.yahoo.com>
 <6fc3bd9d-c280-4d14-7c78-834c9cd92208@treenet.co.nz>
Message-ID: <515648037.3037994.1630832383170@mail.yahoo.com>

 Thanks so much Amos, really appreciate it. It also turns out that I did have the squidclient tool on my squid server, it just wasn't in the path :)?I ran:?squidclient mgr:client_list | grep "Address" and it gave me 28 IPs, then I also ran mgr:info and that too showed "Number of clients accessing cache:? 28" which confirmed it as well.However, if you have a couple of minutes, I wanted to clarify one thing regarding the total squid clients that I'm trying to find.Before I was able to run squidclient, I had run a 'netstat -an' and grep'ed for 3128 and ran this in a loop for 4-5 days to get all connections to the proxy. The list of clients resulting from that shows 62. My understanding of squidclient is that it captures all the information since squid was started, which in my case is July 2020, so the client_list from squidclient tool should have had everything that I found from my 4-5 days of netstat, no? What am I missing or not understanding correctly? And more importantly, which source (squidclient or netstat) should be trusted?
Thanks once again-uzee
    On Thursday, September 2, 2021, 04:57:05 PM GMT+3, Amos Jeffries <squid3 at treenet.co.nz> wrote:  
 
 On 3/09/21 1:28 am, U Zee wrote:
> Can anyone help with running squidclient remotely and getting the list 
> of clients, or any other way to get the list of clients?
> 


You just need to adjust the squid.conf of the running Squid to allow 
management access to the machine you are fetching from.


Be aware:
? Make sure that you only use reconfigure and avoid a restart of the 
proxy after making these changes. A restart will erase some or all of 
the info you are looking to find.


With the CLIENT_IP being address of the machine you are going to do the 
fetch from these commands go at the top of squid.conf:

? acl mgr_client src CLIENT_IP
? http_access allow mgr_client
? cachemgr_passwd none client_list


... *reconfigure* (not restart) the proxy.

... run the squidclient fetch you want

.. undo or at least comment out the above settings and reconfigure.



Amos


> Thanks very much
> 
> On Tuesday, August 31, 2021, 05:50:12 PM GMT+3, U Zee 
> <uzee001 at yahoo.com> wrote:
> 
> 
> Thanks for the pointer Eliezer. I installed it on an Ubuntu 20 machine 
> and tried but it didn't seem to work:
> 
> root at ub20-srv1:~# squidclient -h squid.mydomain.com mgr:client_list
> HTTP/1.0 403 Forbidden
> Server: squid/2.6.STABLE13
> Date: Tue, 31 Aug 2021 14:45:09 GMT
> Content-Type: text/html
> Content-Length: 1115
> Expires: Tue, 31 Aug 2021 14:45:09 GMT
> X-Squid-Error: ERR_ACCESS_DENIED 0
> X-Cache: MISS from squid.mydomain.com
> Via: 1.0 squid.mydomain.com:3128 (squid/2.6.STABLE13)
> Proxy-Connection: close
> 
> root at ub20-srv1:~# squidclient -h squid.mydomain.com? mgr:info
> HTTP/1.0 403 Forbidden
> Server: squid/2.6.STABLE13
> Date: Tue, 31 Aug 2021 14:46:33 GMT
> Content-Type: text/html
> Content-Length: 1101
> Expires: Tue, 31 Aug 2021 14:46:33 GMT
> X-Squid-Error: ERR_ACCESS_DENIED 0
> X-Cache: MISS from squid.mydomain.com
> Via: 1.0 squid.mydomain.com:3128 (squid/2.6.STABLE13)
> Proxy-Connection: close
> 
> Although the proxy function seems to be working, but I cannot get the 
> "mgr" function to work:
> 
> root at ub20-srv1:~# squidclient -h squid.mydomain.com?-v http://vmware.com
> Request:
> GET http://vmware.com HTTP/1.0
> Host: vmware.com
> User-Agent: squidclient/4.10
> Accept: */*
> Connection: close
> .
> HTTP/1.0 301 Moved Permanently
> Location: https://www.vmware.com/
> Content-Length: 0
> X-Cache: MISS from squid.mydomain.com
> Via: 1.0 squid.mydomain.com:3128 (squid/2.6.STABLE13)
> Proxy-Connection: close
> 
> 
> 
> 
> 
> On Monday, August 30, 2021, 02:56:29 PM GMT+3, NgTech LTD 
> <ngtech1ltd at gmail.com> wrote:
> 
> 
> 
> Hey Uzee,
> 
> You can use squidclient from another machine to access this machine.
> I do not remember how by heart but Amos might know if I am guessing right.
> 
> Eliezer
> 
> ?????? ??? ??, 30 ????? 2021, 14:44, ??? U Zee ?<uzee001 at yahoo.com 
> <mailto:uzee001 at yahoo.com>>:
> 
>? ? <sigh> I know and sadly installing it is not possible either.
>? ? Without going into the details too much, its a machine with a legacy
>? ? environment where yum and some other tools are broken and people who
>? ? knew about the configs are long gone.
> 
>? ? On Monday, August 30, 2021, 01:29:47 PM GMT+3, Amos Jeffries
>? ? <squid3 at treenet.co.nz <mailto:squid3 at treenet.co.nz>> wrote:
> 
> 
>? ? On 30/08/21 10:18 pm, U Zee wrote:
>? ? ? > Thanks Amos. I don't think the clientdb features you mentioned are
>? ? ? > enabled, I'm getting a command not found.
>? ? ? > Also I don't see anything configured for logging in squid.conf (I
>? ? don't
>? ? ? > know if there is any other place for it)
>? ? ? >
>? ? ? > bash-3.00# ps -ef|grep squid
>? ? ? > root? ? ? 2467? ? ?1? 0? 2020 ?? ? ? ? 00:00:00 /usr/squid/sbin/squid
>? ? ? > nobody? ? 2471? 2467? 0? 2020 ?? ? ? ? 07:49:45 (squid)
>? ? ? > root? ? ?28018 20110? 0 13:12 pts/0? ? 00:00:00 grep squid
>? ? ? >
>? ? ? > bash-3.00# /usr/squid/sbin/squid -v
>? ? ? > Squid Cache: Version 2.6.STABLE13
>? ? ? > configure options: '--prefix=/usr/squid' 'CC=gcc' 'CFLAGS=-O3 -g'
>? ? ? >
>? ? ? > bash-3.00# squidclient mgr:client_list | grep "Address"
>? ? ? > bash: squidclient: command not found
> 
>? ? That is the squidclient tool missing on your machine.
> 
> 
>? ? Amos
>? ? _______________________________________________
>? ? squid-users mailing list
>? ? squid-users at lists.squid-cache.org
>? ? <mailto:squid-users at lists.squid-cache.org>
>? ? http://lists.squid-cache.org/listinfo/squid-users
>? ? <http://lists.squid-cache.org/listinfo/squid-users>
>? ? _______________________________________________
>? ? squid-users mailing list
>? ? squid-users at lists.squid-cache.org
>? ? <mailto:squid-users at lists.squid-cache.org>
>? ? http://lists.squid-cache.org/listinfo/squid-users
>? ? <http://lists.squid-cache.org/listinfo/squid-users>
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org>
> http://lists.squid-cache.org/listinfo/squid-users 
> <http://lists.squid-cache.org/listinfo/squid-users>
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users
  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210905/082c6ff2/attachment.htm>

From moberger at metanetworks.com  Sun Sep  5 09:39:28 2021
From: moberger at metanetworks.com (Moti Berger)
Date: Sun, 5 Sep 2021 12:39:28 +0300
Subject: [squid-users] New line in logformat
In-Reply-To: <CAK7W0xfc9Wa0sg8E5LYs6ax6r-91K4t3ypkaVFooGZxWSKT33A@mail.gmail.com>
References: <CAGSk-41aLOng3ZUeVzArUz_bFDhPATF-anUgKyErhAc0ox0+ZQ@mail.gmail.com>
 <4581b307-d01e-bfa8-ad5e-a10467545521@treenet.co.nz>
 <CAK7W0xfc9Wa0sg8E5LYs6ax6r-91K4t3ypkaVFooGZxWSKT33A@mail.gmail.com>
Message-ID: <CAGSk-42x3y2gtTwQiYRrL0DBvaEGwWOcNp21SEA4TYx8DrYCAw@mail.gmail.com>

Is there a performance hit by using a logformat per metric? Let's say I
need 5-10 metrics.

On Thu, Sep 2, 2021 at 8:15 PM His Shadow <shadowpilot34 at gmail.com> wrote:

> I think it would be easier to just write a logfile daemon, than
> patching squid. The protocol is very easy.
> http://www.squid-cache.org/Doc/config/logfile_daemon/
> You'd just ignore everything but lines starting with L.
>
> ??, 2 ????. 2021 ?. ? 16:49, Amos Jeffries <squid3 at treenet.co.nz>:
> >
> > On 3/09/21 12:07 am, Moti Berger wrote:
> > > Hi
> > >
> > > I want to send metrics to statsd, so I tried doing the following:
> > >
> > >     logformat metrics_statsd
> > >
>  my_service_latency:%{my_service}adapt::sum_trs|ms\nicap_total:%icap::tt|ms
> > >
> > >     access_log tcp://1.2.3.4:8125 <http://1.2.3.4:8125>
> > >     logformat=metrics_statsd
> > >
> > >
> > > In statsd daemon I see only the first (it supports multiple metrics
> > > separated by \n -
> >
> > Ouch.  You may be able to work around this with a logformat for each
> > metric you want to send and a access_log line sending that metric.
> >
> > Otherwise you are looking at a patch for either Squid or the statsd
> daemon.
> >
> > I am happy to assist with a patch for Squid if you want to. Contact me
> > directly for rates etc.
> >
> > Amos
> > _______________________________________________
> > squid-users mailing list
> > squid-users at lists.squid-cache.org
> > http://lists.squid-cache.org/listinfo/squid-users
>
>
>
> --
> HisShadow
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210905/d8ed2026/attachment.htm>

From squid3 at treenet.co.nz  Sun Sep  5 11:39:43 2021
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sun, 5 Sep 2021 23:39:43 +1200
Subject: [squid-users] New line in logformat
In-Reply-To: <CAGSk-42x3y2gtTwQiYRrL0DBvaEGwWOcNp21SEA4TYx8DrYCAw@mail.gmail.com>
References: <CAGSk-41aLOng3ZUeVzArUz_bFDhPATF-anUgKyErhAc0ox0+ZQ@mail.gmail.com>
 <4581b307-d01e-bfa8-ad5e-a10467545521@treenet.co.nz>
 <CAK7W0xfc9Wa0sg8E5LYs6ax6r-91K4t3ypkaVFooGZxWSKT33A@mail.gmail.com>
 <CAGSk-42x3y2gtTwQiYRrL0DBvaEGwWOcNp21SEA4TYx8DrYCAw@mail.gmail.com>
Message-ID: <1fda1ba5-8cd9-5e78-c318-73f1e2ddc392@treenet.co.nz>

On 5/09/21 9:39 pm, Moti Berger wrote:
> Is there a performance hit by using a logformat per metric? Let's say I 
> need 5-10 metrics.
> 

There will be some of course. But I expect it to be trivial compared to 
the rest of the transaction processing.

Amos


From ngtech1ltd at gmail.com  Sun Sep  5 18:25:29 2021
From: ngtech1ltd at gmail.com (Eliezer Croitoru)
Date: Sun, 5 Sep 2021 21:25:29 +0300
Subject: [squid-users] Squid performance issues
In-Reply-To: <CABA8h=RLvnL_N=Y=-ytk64HQX_+=hbmw8bH90F4TJDk70FqtnA@mail.gmail.com>
References: <CA+0TdyrUS++kCdzN9imPDbj_22NXo3gtkH6qZYFWsc3B1RvJLQ@mail.gmail.com>
 <CABA8h=RLvnL_N=Y=-ytk64HQX_+=hbmw8bH90F4TJDk70FqtnA@mail.gmail.com>
Message-ID: <000001d7a283$68b978c0$3a2c6a40$@gmail.com>

From:

https://serverfault.com/a/717273/227456

 

2

The number of file descriptors is set in the systemd unit file. By default this is 16384, as you can see in /usr/lib/systemd/system/squid.service.

To override this, create a locally overriding /etc/systemd/system/squid.service which changes the amount of file descriptors. It should look something like this:

.include /usr/lib/systemd/system/squid.service

 

[Service]

LimitNOFILE=65536

Do not edit the default file /usr/lib/systemd/system/squid.service, as it will be restored whenever the package is updated. That is why we put it in a local file to override defaults.

After creating this file, tell systemd about it:

systemctl daemon-reload

and then restart squid.

systemctl restart squid

 

 

Eliezer

 

 

 

From: NgTech LTD <ngtech1ltd at gmail.com> 
Sent: Tuesday, August 31, 2021 6:11 PM
To: Marcio B. <marciobacci at gmail.com>
Cc: Squid Users <squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] Squid performance issues

 

Hey Marcio,

 

You will need to add a systemd service file that extends the current one with more FileDescriptors.

 

I cannot guide now I do hope to be able to write later.

 

If anyone is able to help faster go ahead.

 

Eliezer

 

 

?????? ??? ??, 31 ????? 2021, 18:05, ??? Marcio B. ?<marciobacci at gmail.com <mailto:marciobacci at gmail.com> >:

Hi,

I implemented a Squid server in version 4.6 on Debian and tested it for about 40 days. However I put it into production today and Internet browsing was extremely slow.

In /var/log/syslog I'm getting the following messages:

Aug 31 11:29:19 srvproxy squid[4041]: WARNING! Your cache is running out of filedescriptors

Aug 31 11:29:35 srvproxy squid[4041]: WARNING! Your cache is running out of filedescriptors

Aug 31 11:29:51 srvproxy squid[4041]: WARNING! Your cache is running out of filedescriptors


I searched the Internet, but I only found very old information and referring files that don't exist on my Squid Server.

The only thing I did was add the following value to the /etc/security/limits.conf file:

*-nofile 65535

however this did not solve.

Does anyone have any idea how I could solve this problem?

 

Regards,

 

M?rcio Bacci

_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> 
http://lists.squid-cache.org/listinfo/squid-users

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210905/803b30bb/attachment.htm>

From marciobacci at gmail.com  Mon Sep  6 01:49:43 2021
From: marciobacci at gmail.com (Marcio B.)
Date: Sun, 5 Sep 2021 22:49:43 -0300
Subject: [squid-users] Squid performance issues
In-Reply-To: <000001d7a283$68b978c0$3a2c6a40$@gmail.com>
References: <CA+0TdyrUS++kCdzN9imPDbj_22NXo3gtkH6qZYFWsc3B1RvJLQ@mail.gmail.com>
 <CABA8h=RLvnL_N=Y=-ytk64HQX_+=hbmw8bH90F4TJDk70FqtnA@mail.gmail.com>
 <000001d7a283$68b978c0$3a2c6a40$@gmail.com>
Message-ID: <CA+0TdyrkPfMTc2VfN+QwbM_KNpvN-VhLYq7jKReftmgR8b5d8g@mail.gmail.com>

Thanks!

Regards,

M?rcio Bacci

Em dom., 5 de set. de 2021 ?s 15:25, Eliezer Croitoru <ngtech1ltd at gmail.com>
escreveu:

> From:
>
> https://serverfault.com/a/717273/227456
>
>
>
> 2
>
> The number of file descriptors is set in the systemd unit file. By default
> this is 16384, as you can see in /usr/lib/systemd/system/squid.service.
>
> To override this, create a locally overriding
> /etc/systemd/system/squid.service which changes the amount of file
> descriptors. It should look something like this:
>
> .include /usr/lib/systemd/system/squid.service
>
>
>
> [Service]
>
> LimitNOFILE=65536
>
> Do not edit the default file /usr/lib/systemd/system/squid.service, as it
> will be restored whenever the package is updated. That is why we put it in
> a local file to override defaults.
>
> After creating this file, tell systemd about it:
>
> systemctl daemon-reload
>
> and then restart squid.
>
> systemctl restart squid
>
>
>
>
>
> Eliezer
>
>
>
>
>
>
>
> *From:* NgTech LTD <ngtech1ltd at gmail.com>
> *Sent:* Tuesday, August 31, 2021 6:11 PM
> *To:* Marcio B. <marciobacci at gmail.com>
> *Cc:* Squid Users <squid-users at lists.squid-cache.org>
> *Subject:* Re: [squid-users] Squid performance issues
>
>
>
> Hey Marcio,
>
>
>
> You will need to add a systemd service file that extends the current one
> with more FileDescriptors.
>
>
>
> I cannot guide now I do hope to be able to write later.
>
>
>
> If anyone is able to help faster go ahead.
>
>
>
> Eliezer
>
>
>
>
>
> ?????? ??? ??, 31 ????? 2021, 18:05, ??? Marcio B. ?<marciobacci at gmail.com
> >:
>
> Hi,
>
> I implemented a Squid server in version 4.6 on Debian and tested it for
> about 40 days. However I put it into production today and Internet browsing
> was extremely slow.
>
> In /var/log/syslog I'm getting the following messages:
>
> Aug 31 11:29:19 srvproxy squid[4041]: WARNING! Your cache is running out
> of filedescriptors
>
> Aug 31 11:29:35 srvproxy squid[4041]: WARNING! Your cache is running out
> of filedescriptors
>
> Aug 31 11:29:51 srvproxy squid[4041]: WARNING! Your cache is running out
> of filedescriptors
>
>
> I searched the Internet, but I only found very old information and
> referring files that don't exist on my Squid Server.
>
> The only thing I did was add the following value to the
> /etc/security/limits.conf file:
>
> *-nofile 65535
>
> however this did not solve.
>
> Does anyone have any idea how I could solve this problem?
>
>
>
> Regards,
>
>
>
> M?rcio Bacci
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210905/567c8388/attachment.htm>

From meike.stone at googlemail.com  Mon Sep  6 13:04:21 2021
From: meike.stone at googlemail.com (Meike Stone)
Date: Mon, 6 Sep 2021 15:04:21 +0200
Subject: [squid-users] compiling squid 5.1
Message-ID: <CAFNHiA_YSVSMeSZoxcUNX93WwG-Je9K73KqYJmyaRpEVpgFnyA@mail.gmail.com>

Hello dear list,

I try to compile the current version 5.1 on openSuSE Leap 15.2. After
compiling, it seems, that it like to run a few tests, but that fails
with following errors:

cp ../../src/tests/stub_debug.cc tests/stub_debug.cc
cp: cannot create regular file 'tests/stub_debug.cc': No such file or directory
make[3]: *** [Makefile:1489: tests/stub_debug.cc] Error 1
make[3]: Leaving directory '/home/ingo/Downloads/squid-5.1/tools/squidclient'
make[2]: *** [Makefile:1038: all-recursive] Error 1
make[2]: Leaving directory '/home/ingo/Downloads/squid-5.1/tools/squidclient'
make[1]: *** [Makefile:1176: all-recursive] Error 1
make[1]: Leaving directory '/home/ingo/Downloads/squid-5.1/tools'
make: *** [Makefile:590: all-recursive] Error 1

The file is found under:
~/squid-5.1 # find . -name stub_debug.cc
./src/tests/stub_debug.cc

Can someone guide me to solve the problem?

Thanks Meike
PS: @Squid-Cache Website maintainers: The link (provided on
http://www.squid-cache.org/Support/mailing-lists.html) to mailing list
search (http://www.squid-cache.org/cgi-bin/swish-query.cgi) is broken.


From belle at bazuin.nl  Mon Sep  6 14:43:27 2021
From: belle at bazuin.nl (=?windows-1252?Q?L.P.H._van_Belle?=)
Date: Mon, 6 Sep 2021 16:43:27 +0200
Subject: [squid-users] compiling squid 5.1
In-Reply-To: <CAFNHiA_YSVSMeSZoxcUNX93WwG-Je9K73KqYJmyaRpEVpgFnyA@mail.gmail.com>
References: <CAFNHiA_YSVSMeSZoxcUNX93WwG-Je9K73KqYJmyaRpEVpgFnyA@mail.gmail.com>
Message-ID: <vmime.6136290f.65cd.1aa885692dceb07f@ms249-lin-003.rotterdam.bazuin.nl>

Try this. 

For now, removing these build options works:

 --srcdir=. --disable-dependency-tracking

( Amos posted this on 5 augustus ) 
https://www.spinics.net/lists//squid/msg94409.html

Greetz, 

Louis
yeah, the same one.  ;-)  

> -----Oorspronkelijk bericht-----
> Van: squid-users 
> [mailto:squid-users-bounces at lists.squid-cache.org] Namens Meike Stone
> Verzonden: maandag 6 september 2021 15:04
> Aan: squid-users at lists.squid-cache.org
> Onderwerp: [squid-users] compiling squid 5.1
> 
> Hello dear list,
> 
> I try to compile the current version 5.1 on openSuSE Leap 15.2. After
> compiling, it seems, that it like to run a few tests, but that fails
> with following errors:
> 
> cp ../../src/tests/stub_debug.cc tests/stub_debug.cc
> cp: cannot create regular file 'tests/stub_debug.cc': No such 
> file or directory
> make[3]: *** [Makefile:1489: tests/stub_debug.cc] Error 1
> make[3]: Leaving directory 
> '/home/ingo/Downloads/squid-5.1/tools/squidclient'
> make[2]: *** [Makefile:1038: all-recursive] Error 1
> make[2]: Leaving directory 
> '/home/ingo/Downloads/squid-5.1/tools/squidclient'
> make[1]: *** [Makefile:1176: all-recursive] Error 1
> make[1]: Leaving directory '/home/ingo/Downloads/squid-5.1/tools'
> make: *** [Makefile:590: all-recursive] Error 1
> 
> The file is found under:
> ~/squid-5.1 # find . -name stub_debug.cc
> ./src/tests/stub_debug.cc
> 
> Can someone guide me to solve the problem?
> 
> Thanks Meike
> PS: @Squid-Cache Website maintainers: The link (provided on
> http://www.squid-cache.org/Support/mailing-lists.html) to mailing list
> search (http://www.squid-cache.org/cgi-bin/swish-query.cgi) is broken.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 
> 



From rousskov at measurement-factory.com  Mon Sep  6 19:28:43 2021
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Mon, 6 Sep 2021 15:28:43 -0400
Subject: [squid-users] OT - myportname ACL
In-Reply-To: <3cb3e42b-bca6-50c3-cfa2-6094dcd38671@spamtrap.tnetconsulting.net>
References: <LO2P123MB600857B60EE5321B3DC97BD9A9D09@LO2P123MB6008.GBRP123.PROD.OUTLOOK.COM>
 <LO2P123MB60089C758380A60CAE3BAD47A9D09@LO2P123MB6008.GBRP123.PROD.OUTLOOK.COM>
 <f4f894b6-290b-3043-dcc5-82dc668ab483@measurement-factory.com>
 <3cb3e42b-bca6-50c3-cfa2-6094dcd38671@spamtrap.tnetconsulting.net>
Message-ID: <d97b0b8e-cfc8-e280-3de1-217bbd573f3a@measurement-factory.com>

On 9/5/21 1:54 AM, Grant Taylor wrote:
> On 9/4/21 1:58 PM, Alex Rousskov wrote:
>> the best way is to name your ports and use the myportname ACL instead
>> of trying to match one of the many port numbers associated with
>> transparent connections, especially when Squid has a tendency to
>> "swap" source and destination addresses in that context.
> 
> Please forgive my ignorance.? Will you please provide an example of what
> you mean by "use the myportname ACL"?? --? I'm relatively new to Squid
> (4.x) after having not used it for about 15 years.


    http_port ... name=PortGettingGreenTraffic

    acl greenTraffic myportname PortGettingGreenTraffic

    whatever_directive ... greenTraffic

Alex.


From gtaylor at tnetconsulting.net  Mon Sep  6 20:26:55 2021
From: gtaylor at tnetconsulting.net (Grant Taylor)
Date: Mon, 6 Sep 2021 14:26:55 -0600
Subject: [squid-users] OT - myportname ACL
In-Reply-To: <d97b0b8e-cfc8-e280-3de1-217bbd573f3a@measurement-factory.com>
References: <LO2P123MB600857B60EE5321B3DC97BD9A9D09@LO2P123MB6008.GBRP123.PROD.OUTLOOK.COM>
 <LO2P123MB60089C758380A60CAE3BAD47A9D09@LO2P123MB6008.GBRP123.PROD.OUTLOOK.COM>
 <f4f894b6-290b-3043-dcc5-82dc668ab483@measurement-factory.com>
 <3cb3e42b-bca6-50c3-cfa2-6094dcd38671@spamtrap.tnetconsulting.net>
 <d97b0b8e-cfc8-e280-3de1-217bbd573f3a@measurement-factory.com>
Message-ID: <75111740-22a3-df1d-ff13-b213823df299@spamtrap.tnetconsulting.net>

On 9/6/21 1:28 PM, Alex Rousskov wrote:
>      http_port ... name=PortGettingGreenTraffic
> 
>      acl greenTraffic myportname PortGettingGreenTraffic
> 
>      whatever_directive ... greenTraffic

Interesting.  I'll have to do some reading ~> learning to understand 
better.  But I believe you have given me sufficient bread crumbs to chase.

Thank you. Alex.



-- 
Grant. . . .
unix || die

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4013 bytes
Desc: S/MIME Cryptographic Signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210906/5dcb97cd/attachment.bin>

From daniel.pisek at gmail.com  Tue Sep  7 07:55:56 2021
From: daniel.pisek at gmail.com (=?UTF-8?B?RGFuaWVsIFDDrcWhZWs=?=)
Date: Tue, 7 Sep 2021 09:55:56 +0200
Subject: [squid-users] a definition of two radius server in radius_config
Message-ID: <CAMA9gqMo=eeh2CORUboR=U1nMS_YkrRuUL-e9SBycwOi2y45cQ@mail.gmail.com>

Hi everyone,

I'd like to ask for quick help in this direct way because I haven't found
any info for that yet.
I'm implementing squid v4.16 and I'd like to set two radius servers in
radius_config file, so far without success.

I've tried something like this:

/etc/squid4/radius_config:





*server 10.3.1.15secret yLwfJERjD99pKmxzgfdserver 10.3.1.16secret
yLwfJERjD99pKmxz**gfd*

That doesn't work in case that second server is down. The server which is
defined the most down always makes authentication.

Do you have any idea how to achieve this?

thank you Daniel
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210907/df280bcc/attachment.htm>

From graham at gwharton.me.uk  Tue Sep  7 12:57:59 2021
From: graham at gwharton.me.uk (Graham Wharton)
Date: Tue, 7 Sep 2021 12:57:59 +0000
Subject: [squid-users] Squid inside docker
Message-ID: <LO2P123MB6008E5889F241F50577ADDBBA9D39@LO2P123MB6008.GBRP123.PROD.OUTLOOK.COM>

It would be great if something could be done to help squid running inside docker,

Particularly


  1.  Logging to stdout/stderr
  2.  bash-5.1# squid -k reconfigure

2021/09/07 13:55:50| FATAL: Bad PID file (/var/run/squid.pid) contains unreasonably small PID value: 1

exception location: Instance.cc(84) GetOtherPid

Graham Wharton
Lube Finder
Tel (UK) : 0800 955 0922
Tel (intl) : +44 1305 898033
https://www.lubefinder.com

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210907/74b70385/attachment.htm>

From rousskov at measurement-factory.com  Tue Sep  7 13:08:20 2021
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Tue, 7 Sep 2021 09:08:20 -0400
Subject: [squid-users] Squid inside docker
In-Reply-To: <LO2P123MB6008E5889F241F50577ADDBBA9D39@LO2P123MB6008.GBRP123.PROD.OUTLOOK.COM>
References: <LO2P123MB6008E5889F241F50577ADDBBA9D39@LO2P123MB6008.GBRP123.PROD.OUTLOOK.COM>
Message-ID: <8f140c13-edfc-131b-0802-dc4089e92269@measurement-factory.com>

On 9/7/21 8:57 AM, Graham Wharton wrote:
> It would be great if something could be done to help squid running
> inside docker, Particularly

>  1. Logging to stdout/stderr

stderr logging is already supported: "squid -d1 ...".

FWIW, there is also syslog which, when enabled, gets level-0/1 messages:
"squid -s ...".


>  2. bash-5.1# squid -k reconfigure
> 
> 2021/09/07 13:55:50| FATAL: Bad PID file (/var/run/squid.pid) contains
> unreasonably small PID value: 1

Already fixed in master/v6 (commit 3db00ca). The one-character fix is
trivial to port to any modern Squid version.


HTH,

Alex.


From meike.stone at googlemail.com  Wed Sep  8 09:08:39 2021
From: meike.stone at googlemail.com (Meike Stone)
Date: Wed, 8 Sep 2021 11:08:39 +0200
Subject: [squid-users] SOLVED - compiling squid 5.1
In-Reply-To: <CAFNHiA_YSVSMeSZoxcUNX93WwG-Je9K73KqYJmyaRpEVpgFnyA@mail.gmail.com>
References: <CAFNHiA_YSVSMeSZoxcUNX93WwG-Je9K73KqYJmyaRpEVpgFnyA@mail.gmail.com>
Message-ID: <CAFNHiA-9Ke+QW5UsRAUM=PXysGrcaq=_7C_+GdtYaM8wbfWKNA@mail.gmail.com>

>
> cp ../../src/tests/stub_debug.cc tests/stub_debug.cc
> cp: cannot create regular file 'tests/stub_debug.cc': No such file or directory
> make[3]: *** [Makefile:1489: tests/stub_debug.cc] Error 1
> make[3]: Leaving directory '/home/ingo/Downloads/squid-5.1/tools/squidclient'
> make[2]: *** [Makefile:1038: all-recursive] Error 1
> make[2]: Leaving directory '/home/ingo/Downloads/squid-5.1/tools/squidclient'
> make[1]: *** [Makefile:1176: all-recursive] Error 1
> make[1]: Leaving directory '/home/ingo/Downloads/squid-5.1/tools'
> make: *** [Makefile:590: all-recursive] Error 1
>
> The file is found under:
> ~/squid-5.1 # find . -name stub_debug.cc
> ./src/tests/stub_debug.cc

for every one, who has the same Problem:

untar the source and create following directories:

squid-5.1/tools/squidclient/tests
squid-5.1/tools/tests

HTH,
kindly regards, Meike


From squid3 at treenet.co.nz  Wed Sep  8 09:21:43 2021
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 8 Sep 2021 21:21:43 +1200
Subject: [squid-users] SOLVED - compiling squid 5.1
In-Reply-To: <CAFNHiA-9Ke+QW5UsRAUM=PXysGrcaq=_7C_+GdtYaM8wbfWKNA@mail.gmail.com>
References: <CAFNHiA_YSVSMeSZoxcUNX93WwG-Je9K73KqYJmyaRpEVpgFnyA@mail.gmail.com>
 <CAFNHiA-9Ke+QW5UsRAUM=PXysGrcaq=_7C_+GdtYaM8wbfWKNA@mail.gmail.com>
Message-ID: <eeef31e4-5528-fd92-411a-7ece02b45096@treenet.co.nz>

This hack only works if you are building manually from source code, in 
the same directory you expanded the sources. Which is not he case for 
anyone building with automated tools or CI systems.

The earlier provided ./configure parameter change works just as well 
without manual changes to the source code.

Amos


On 8/09/21 9:08 pm, Meike Stone wrote:
>>
>> cp ../../src/tests/stub_debug.cc tests/stub_debug.cc
>> cp: cannot create regular file 'tests/stub_debug.cc': No such file or directory
>> make[3]: *** [Makefile:1489: tests/stub_debug.cc] Error 1
>> make[3]: Leaving directory '/home/ingo/Downloads/squid-5.1/tools/squidclient'
>> make[2]: *** [Makefile:1038: all-recursive] Error 1
>> make[2]: Leaving directory '/home/ingo/Downloads/squid-5.1/tools/squidclient'
>> make[1]: *** [Makefile:1176: all-recursive] Error 1
>> make[1]: Leaving directory '/home/ingo/Downloads/squid-5.1/tools'
>> make: *** [Makefile:590: all-recursive] Error 1
>>
>> The file is found under:
>> ~/squid-5.1 # find . -name stub_debug.cc
>> ./src/tests/stub_debug.cc
> 
> for every one, who has the same Problem:
> 
> untar the source and create following directories:
> 
> squid-5.1/tools/squidclient/tests
> squid-5.1/tools/tests
> 
> HTH,
> kindly regards, Meike
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 


From graham at gwharton.me.uk  Wed Sep  8 12:06:01 2021
From: graham at gwharton.me.uk (Graham Wharton)
Date: Wed, 8 Sep 2021 12:06:01 +0000
Subject: [squid-users] Squid inside docker
In-Reply-To: <8f140c13-edfc-131b-0802-dc4089e92269@measurement-factory.com>
References: <LO2P123MB6008E5889F241F50577ADDBBA9D39@LO2P123MB6008.GBRP123.PROD.OUTLOOK.COM>
 <8f140c13-edfc-131b-0802-dc4089e92269@measurement-factory.com>
Message-ID: <LO2P123MB6008C973D5F9353C30CFC055A9D49@LO2P123MB6008.GBRP123.PROD.OUTLOOK.COM>

Are you aware of any options to direct the access log to stdout aswell as the cache log?

-----Original Message-----
From: Alex Rousskov <rousskov at measurement-factory.com> 
Sent: 07 September 2021 14:08
To: Graham Wharton <graham at gwharton.me.uk>; squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Squid inside docker

On 9/7/21 8:57 AM, Graham Wharton wrote:
> It would be great if something could be done to help squid running 
> inside docker, Particularly

>  1. Logging to stdout/stderr

stderr logging is already supported: "squid -d1 ...".

FWIW, there is also syslog which, when enabled, gets level-0/1 messages:
"squid -s ...".


>  2. bash-5.1# squid -k reconfigure
> 
> 2021/09/07 13:55:50| FATAL: Bad PID file (/var/run/squid.pid) contains 
> unreasonably small PID value: 1

Already fixed in master/v6 (commit 3db00ca). The one-character fix is trivial to port to any modern Squid version.


HTH,

Alex.


From rousskov at measurement-factory.com  Wed Sep  8 14:44:58 2021
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Wed, 8 Sep 2021 10:44:58 -0400
Subject: [squid-users] Squid inside docker
In-Reply-To: <LO2P123MB6008C973D5F9353C30CFC055A9D49@LO2P123MB6008.GBRP123.PROD.OUTLOOK.COM>
References: <LO2P123MB6008E5889F241F50577ADDBBA9D39@LO2P123MB6008.GBRP123.PROD.OUTLOOK.COM>
 <8f140c13-edfc-131b-0802-dc4089e92269@measurement-factory.com>
 <LO2P123MB6008C973D5F9353C30CFC055A9D49@LO2P123MB6008.GBRP123.PROD.OUTLOOK.COM>
Message-ID: <0613fc9f-401c-316c-1899-19062497f024@measurement-factory.com>

On 9/8/21 8:06 AM, Graham Wharton wrote:

> Are you aware of any options to direct the access log to stdout
> aswell as the cache log?

I suspect it is possible to hack it, but I think it is better to send
access log records to a dedicated TCP server (which can probably be as
simple as netcat) or syslog (which can also forward them to a remote
server) because cache_log format does not support isolating mixed-in
access_log records well.


HTH,

Alex.


> -----Original Message-----
> From: Alex Rousskov <rousskov at measurement-factory.com> 
> Sent: 07 September 2021 14:08
> To: Graham Wharton <graham at gwharton.me.uk>; squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] Squid inside docker
> 
> On 9/7/21 8:57 AM, Graham Wharton wrote:
>> It would be great if something could be done to help squid running 
>> inside docker, Particularly
> 
>>  1. Logging to stdout/stderr
> 
> stderr logging is already supported: "squid -d1 ...".
> 
> FWIW, there is also syslog which, when enabled, gets level-0/1 messages:
> "squid -s ...".
> 
> 
>>  2. bash-5.1# squid -k reconfigure
>>
>> 2021/09/07 13:55:50| FATAL: Bad PID file (/var/run/squid.pid) contains 
>> unreasonably small PID value: 1
> 
> Already fixed in master/v6 (commit 3db00ca). The one-character fix is trivial to port to any modern Squid version.
> 
> 
> HTH,
> 
> Alex.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 



From graham at gwharton.me.uk  Wed Sep  8 15:55:42 2021
From: graham at gwharton.me.uk (Graham Wharton)
Date: Wed, 8 Sep 2021 15:55:42 +0000
Subject: [squid-users] Squid inside docker
In-Reply-To: <0613fc9f-401c-316c-1899-19062497f024@measurement-factory.com>
References: <LO2P123MB6008E5889F241F50577ADDBBA9D39@LO2P123MB6008.GBRP123.PROD.OUTLOOK.COM>
 <8f140c13-edfc-131b-0802-dc4089e92269@measurement-factory.com>
 <LO2P123MB6008C973D5F9353C30CFC055A9D49@LO2P123MB6008.GBRP123.PROD.OUTLOOK.COM>
 <0613fc9f-401c-316c-1899-19062497f024@measurement-factory.com>
Message-ID: <LO2P123MB6008E519F9ABDFA70914B2BDA9D49@LO2P123MB6008.GBRP123.PROD.OUTLOOK.COM>

Hi all,

I made a little progress on this.

If you run squid as root, it forks and assumes the identity of the cache_effective_user. When it does this, it is denied access to stdout.

If you run squid as user squid (or whoever your cache_effective_user), it does not change user, and the squid user has full access to write to stdout, so 

access_log stdio:/dev/stdout
cache_log stdio:/dev/stdout

works fine if the process is started as user squid.

I do get the following in the logs on startup, so not sure what this refers to, or whether it is important

2021-09-08T16:49:15.056+01:00	2021/09/08 16:49:15| helperOpenServers: Starting 5/32 'security_file_certgen' processes
2021-09-08T16:49:15.057+01:00	2021/09/08 16:49:15| WARNING: no_suid: setuid(0): (1) Operation not permitted
2021-09-08T16:49:15.057+01:00	2021/09/08 16:49:15| WARNING: no_suid: setuid(0): (1) Operation not permitted
2021-09-08T16:49:15.059+01:00	2021/09/08 16:49:15| WARNING: no_suid: setuid(0): (1) Operation not permitted
2021-09-08T16:49:15.061+01:00	2021/09/08 16:49:15| WARNING: no_suid: setuid(0): (1) Operation not permitted
2021-09-08T16:49:15.065+01:00	2021/09/08 16:49:15| WARNING: no_suid: setuid(0): (1) Operation not permitted

But squid launches and runs just fine.

Hope this helps anyone in the same position.

Regards

Graham

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Alex Rousskov
Sent: 08 September 2021 15:45
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Squid inside docker

On 9/8/21 8:06 AM, Graham Wharton wrote:

> Are you aware of any options to direct the access log to stdout aswell 
> as the cache log?

I suspect it is possible to hack it, but I think it is better to send access log records to a dedicated TCP server (which can probably be as simple as netcat) or syslog (which can also forward them to a remote
server) because cache_log format does not support isolating mixed-in access_log records well.


HTH,

Alex.


> -----Original Message-----
> From: Alex Rousskov <rousskov at measurement-factory.com>
> Sent: 07 September 2021 14:08
> To: Graham Wharton <graham at gwharton.me.uk>; 
> squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] Squid inside docker
> 
> On 9/7/21 8:57 AM, Graham Wharton wrote:
>> It would be great if something could be done to help squid running 
>> inside docker, Particularly
> 
>>  1. Logging to stdout/stderr
> 
> stderr logging is already supported: "squid -d1 ...".
> 
> FWIW, there is also syslog which, when enabled, gets level-0/1 messages:
> "squid -s ...".
> 
> 
>>  2. bash-5.1# squid -k reconfigure
>>
>> 2021/09/07 13:55:50| FATAL: Bad PID file (/var/run/squid.pid) 
>> contains unreasonably small PID value: 1
> 
> Already fixed in master/v6 (commit 3db00ca). The one-character fix is trivial to port to any modern Squid version.
> 
> 
> HTH,
> 
> Alex.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 

_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users


From squid3 at treenet.co.nz  Wed Sep  8 19:28:09 2021
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 9 Sep 2021 07:28:09 +1200
Subject: [squid-users] Squid inside docker
In-Reply-To: <LO2P123MB6008E519F9ABDFA70914B2BDA9D49@LO2P123MB6008.GBRP123.PROD.OUTLOOK.COM>
References: <LO2P123MB6008E5889F241F50577ADDBBA9D39@LO2P123MB6008.GBRP123.PROD.OUTLOOK.COM>
 <8f140c13-edfc-131b-0802-dc4089e92269@measurement-factory.com>
 <LO2P123MB6008C973D5F9353C30CFC055A9D49@LO2P123MB6008.GBRP123.PROD.OUTLOOK.COM>
 <0613fc9f-401c-316c-1899-19062497f024@measurement-factory.com>
 <LO2P123MB6008E519F9ABDFA70914B2BDA9D49@LO2P123MB6008.GBRP123.PROD.OUTLOOK.COM>
Message-ID: <409d124a-73a7-d66e-b4f6-8e589500c200@treenet.co.nz>

On 9/09/21 3:55 am, Graham Wharton wrote:
> 
> If you run squid as user squid (or whoever your cache_effective_user), it does not change user, and the squid user has full access to write to stdout, so
> 
...
> 2021-09-08T16:49:15.065+01:00	2021/09/08 16:49:15| WARNING: no_suid: setuid(0): (1) Operation not permitted
> 

Squid cannot perform capability changes as root. As a result it may fail 
to drop some security capabilities.


Amos


From mehrdad.fatemi at gmail.com  Mon Sep 13 04:16:07 2021
From: mehrdad.fatemi at gmail.com (Mehrdad Fatemi)
Date: Mon, 13 Sep 2021 16:16:07 +1200
Subject: [squid-users] SSL Terminating Reverse Proxy with Referral Tracking
Message-ID: <CANDu8m2Hyn5PGV7=Mt6XRwsTAmd9onZHkgZQiHAho_moLBzYpw@mail.gmail.com>

Hi Everyone,
I'm looking for an elegant technology option to have telcos zero-rate all
of the traffic to a set of online destinations. Using an SSL terminating
reverse proxy could be a potential answer to this as we can focus on
zero-rating the proxy's downstream traffic with each ISP/Telco without
worrying about upstream servers.

There are two challenges to address here though:
1) Modern web applications on the upstream servers use many 3rd party and
X-a-a-S resources  (e.g. embedded media, libraries, etc) that we also want
to pass through the proxy to ensure they are zero-rated.

2) For a user to complete an end-to-end process they may get referred to
3rd party websites (like a payment gateway) that we only want to zero-rate
if the referral is from one of our designated upstream servers.

Any advice on whether and how Squid and other related technologies could
help is much appreciated.

Cheers
Mehrdad
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210913/b8bc01d5/attachment.htm>

From daniel.pisek at gmail.com  Mon Sep 13 13:18:58 2021
From: daniel.pisek at gmail.com (=?UTF-8?B?RGFuaWVsIFDDrcWhZWs=?=)
Date: Mon, 13 Sep 2021 15:18:58 +0200
Subject: [squid-users] How to define two radius servers in radius_config
Message-ID: <CAMA9gqNcVnvoLM+aunVzjXKE=iefWLC0o=30dH3b=_Zu4iemnQ@mail.gmail.com>

Hi,

I'm working on the setup implementation of squid 4.16 and I'd like to use
authentication of two radius servers in radius_config in case that one of
them is down.
How can I achieve this and how radius_config should look like?

Thank you for your help.

daniel
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210913/1f19eb4c/attachment.htm>

From belle at bazuin.nl  Tue Sep 14 09:22:45 2021
From: belle at bazuin.nl (=?windows-1252?Q?L.P.H._van_Belle?=)
Date: Tue, 14 Sep 2021 11:22:45 +0200
Subject: [squid-users] Compile/Rebuilding on debian bullseye (or buster)
Message-ID: <vmime.614069e5.43a6.3660c743bb9ffb5@ms249-lin-003.rotterdam.bazuin.nl>

Hai Amos, 

Im attempting to make a squid 5.1 build based on the bullseye squid/debian folder. 
( ps. Im building with sbuilder ) 

Now, this "normaly" worked since squid 3.2 for me, copy the debian folder, make minor adjustments if needed, 
Just with latest adjustments, well, i cant make it work. 

This was my last adjustmated.. 

  * Used build : squid-5.1-20210804-r1f9e52827 of 04 Aug 2021
  * Refreshed patches, removed patches already included.
  * d/control lower debhelper to 12 to allow building


Changed d/rules, added. -srcdir=. --disable-dependency-tracking 
Any suggestions what i can do here? 
If you want/need, i have the complete build log available. 

The confirgure part and error. 

configure: exit 1
dh_auto_configure: ./configure --build=x86_64-linux-gnu --prefix=/usr --includedir=\${prefix}/include --mandir=\${prefix}/share/man --infodir=\${prefix}/share/info --sysconfdir=/etc --localstatedir=/var --disable-silent-rules --libdir=\${prefix}/lib/x86_64-linux-gnu --runstatedir=/run --disable-maintainer-mode --disable-dependency-tracking "BUILDCXXFLAGS=-g -O2 -fdebug-prefix-map=/<<PKGBUILDDIR>>=. -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2 -Wl,-z,relro -Wl,-z,now " BUILDCXX=g\+\+ --with-build-environment=default "--enable-build-info=Debian linux" --datadir=/usr/share/squid --sysconfdir=/etc/squid --libexecdir=/usr/lib/squid --mandir=/usr/share/man --enable-inline --disable-arch-native --enable-async-io=8 --enable-storeio=ufs,aufs,diskd,rock --enable-removal-policies=lru,heap --enable-delay-pools --enable-cache-digests --enable-icap-client --enable-follow-x-forwarded-for --enable-au
 th-basic=DB,fake,getpwnam,LDAP,NCSA,NIS,PAM,POP3,RADIUS,SASL,SMB --enable-auth-digest=file,LDAP --enable-auth-negotiate=kerberos,wrapper --enable-auth-ntlm=fake,SMB_LM --enable-external-acl-helpers=file_userip,kerberos_ldap_group,LDAP_group,session,SQL_session,time_quota,unix_group,wbinfo_group --enable-security-cert-validators=fake --enable-storeid-rewrite-helpers=file --enable-url-rewrite-helpers=fake --enable-eui --enable-esi --enable-icmp --enable-zph-qos --enable-ecap --disable-translation --with-swapdir=/var/spool/squid --with-logdir=/var/log/squid --with-pidfile=/run/squid.pid --with-filedescriptors=65536 --with-large-files --with-default-user=proxy --srcdir=. --disable-dependency-tracking --enable-linux-netfilter --with-systemd --with-gnutls returned exit code 1
make[1]: *** [debian/rules:79: override_dh_auto_configure] Error 2
make[1]: Leaving directory '/<<PKGBUILDDIR>>'
make: *** [debian/rules:71: build] Error 2


And i tested also with my last settings from my backport to Debian buster and squid 4.16(ssl enabled) 

Resulting in : 
configure: Samba TrivialDB library support: no
configure: error: external acl helper time_quota ... found but cannot be built
make: *** [/usr/share/cdbs/1/class/autotools.mk:46: debian/stamp-autotools] Error 1
dpkg-buildpackage: error: debian/rules build subprocess returned exit status 2
--------------------------------------------------------------------------------


So im a bit stuck here..
And yes, a ./configure does configure it all without problems.. 

Any tips on this ? 

Greetz, 

Louis




From moberger at metanetworks.com  Tue Sep 14 19:04:02 2021
From: moberger at metanetworks.com (Moti Berger)
Date: Tue, 14 Sep 2021 22:04:02 +0300
Subject: [squid-users] logformat odd values
Message-ID: <CAGSk-41or=cMZg+VFr82D15UTaiE_SRSt=n2NOVMitz0LMEMmA@mail.gmail.com>

Hi

I have the followings in squid.conf:

> logformat metrics %icap::tt %adapt::all_trs %adapt::sum_trs
> %{service_req_a}adapt::sum_trs %{service_resp_a}adapt::sum_trs
> %{service_req_b}adapt::sum_trs %{service_resp_b}adapt::sum_trs
> access_log daemon:/var/log/squid/metrics.log metrics
>


> icap_service service_req_a reqmod_precache bypass=1 on-overload=wait
> routing=1 icap://a.y:12345/request
> icap_service service_req_b reqmod_precache bypass=1 on-overload=wait
> icap://b.y:10101/request
> adaptation_service_chain svcRequest service_req_a service_req_b
> adaptation_access svcRequest deny manager
> adaptation_access svcRequest allow all
> icap_service service_resp_a respmod_precache bypass=1 on-overload=wait
> routing=1 icap://a.y:12345/response
> icap_service service_resp_b respmod_precache bypass=1 on-overload=wait
> icap://b.y:10101/response
> adaptation_service_chain svcResponse service_resp_a service_resp_b
> adaptation_access svcResponse deny manager
> adaptation_access svcResponse allow all


 I see in metrics.log lines like this:

> 4 4,180 4,180 4 180 - -
>

Now I wonder how come the value of %icap:tt isn't at least as the sum of
all the numbers appear on %adapt::all_trs or %adapt::sum_trs (assuming no
failed transactions)?
If %icap:tt isn't at least the sum of all ICAPs processing time, what is?

Thanks,
Moti
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210914/fecae059/attachment.htm>

From squid3 at treenet.co.nz  Tue Sep 14 23:14:17 2021
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 15 Sep 2021 11:14:17 +1200
Subject: [squid-users] Compile/Rebuilding on debian bullseye (or buster)
In-Reply-To: <vmime.614069e5.43a6.3660c743bb9ffb5@ms249-lin-003.rotterdam.bazuin.nl>
References: <vmime.614069e5.43a6.3660c743bb9ffb5@ms249-lin-003.rotterdam.bazuin.nl>
Message-ID: <cc18df2f-4f63-c766-8536-b017e8c39332@treenet.co.nz>

On 14/09/21 9:22 pm, L.P.H. van Belle wrote:
> Hai Amos,
> 
> Im attempting to make a squid 5.1 build based on the bullseye squid/debian folder.
> ( ps. Im building with sbuilder )
> 
> Now, this "normaly" worked since squid 3.2 for me, copy the debian folder, make minor adjustments if needed,
> Just with latest adjustments, well, i cant make it work.
> 
> This was my last adjustmated..
> 
>    * Used build : squid-5.1-20210804-r1f9e52827 of 04 Aug 2021
>    * Refreshed patches, removed patches already included.
>    * d/control lower debhelper to 12 to allow building
> 
> 
> Changed d/rules, added. -srcdir=. --disable-dependency-tracking
> Any suggestions what i can do here?

I am a bit stuck here myself with this build style, that is part of why 
the package is not already updated. The Debian auto-build system adds 
those options and AFAICT does not provide an easy way to avoid.


> 
> And i tested also with my last settings from my backport to Debian buster and squid 4.16(ssl enabled)
> 
> Resulting in :
> configure: Samba TrivialDB library support: no
> configure: error: external acl helper time_quota ... found but cannot be built
> make: *** [/usr/share/cdbs/1/class/autotools.mk:46: debian/stamp-autotools] Error 1
> dpkg-buildpackage: error: debian/rules build subprocess returned exit status 2
> --------------------------------------------------------------------------------

Debian used to use the BerkeleyDB, so the normal Squid build 
dependencies pulls the library in for that.

If libdb-dev is no longer available you will need to install libtdb-dev 
package.

Also, (for now) if you are using the ext_time_quote_acl or 
ext_session_acl helpers you will need to manually purge their databases 
on install/upgrade.

Amos


From squid3 at treenet.co.nz  Tue Sep 14 23:34:43 2021
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 15 Sep 2021 11:34:43 +1200
Subject: [squid-users] logformat odd values
In-Reply-To: <CAGSk-41or=cMZg+VFr82D15UTaiE_SRSt=n2NOVMitz0LMEMmA@mail.gmail.com>
References: <CAGSk-41or=cMZg+VFr82D15UTaiE_SRSt=n2NOVMitz0LMEMmA@mail.gmail.com>
Message-ID: <94c91b27-5c86-6095-500a-b254b92e5f09@treenet.co.nz>

On 15/09/21 7:04 am, Moti Berger wrote:
> Hi
> 
> I have the followings in squid.conf:
> 
>     logformat metrics %icap::tt %adapt::all_trs %adapt::sum_trs
>     %{service_req_a}adapt::sum_trs %{service_resp_a}adapt::sum_trs
>     %{service_req_b}adapt::sum_trs %{service_resp_b}adapt::sum_trs
>     access_log daemon:/var/log/squid/metrics.log metrics
> 
>     icap_service service_req_a reqmod_precache bypass=1 on-overload=wait
>     routing=1 icap://a.y:12345/request
>     icap_service service_req_b reqmod_precache bypass=1 on-overload=wait
>     icap://b.y:10101/request
>     adaptation_service_chain svcRequest service_req_a?service_req_b
>     adaptation_access svcRequest deny manager
>     adaptation_access svcRequest allow all
>     icap_service service_resp_a respmod_precache bypass=1
>     on-overload=wait routing=1 icap://a.y:12345/response
>     icap_service service_resp_b respmod_precache bypass=1
>     on-overload=wait icap://b.y:10101/response
>     adaptation_service_chain svcResponse service_resp_a?service_resp_b
>     adaptation_access svcResponse deny manager
>     adaptation_access svcResponse allow all
> 
> 
>  ?I see in metrics.log lines like this:
> 
>     4 4,180 4,180 4 180 - -
> 
> 
> Now I wonder how come the value of %icap:tt isn't at least as the sum of 
> all the numbers appear on %adapt::all_trs or %adapt::sum_trs (assuming 
> no failed transactions)?


%icap:: codes are relevant to ICAP.

%adapt:: codes are relevant to all adaptation types: ICAP, eCAP, and (in 
theory, though often not really) redirector and URL re-writer helpers.

NP: failed transactions timers are included in all three metrics.


> If %icap:tt isn't at least the sum of all ICAPs processing time, what is?
> 

AFAIK you are right - it is supposed to be the sum of all processing 
time for ICAP related things.

It does seem to be a bit odd that only the first one ("4") is counted. 
Likely a bug IMO.


Amos


From squid3 at treenet.co.nz  Wed Sep 15 00:09:50 2021
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 15 Sep 2021 12:09:50 +1200
Subject: [squid-users] SSL Terminating Reverse Proxy with Referral
 Tracking
In-Reply-To: <CANDu8m2Hyn5PGV7=Mt6XRwsTAmd9onZHkgZQiHAho_moLBzYpw@mail.gmail.com>
References: <CANDu8m2Hyn5PGV7=Mt6XRwsTAmd9onZHkgZQiHAho_moLBzYpw@mail.gmail.com>
Message-ID: <c892b2e3-7613-625d-3092-dfe672126b64@treenet.co.nz>

On 13/09/21 4:16 pm, Mehrdad Fatemi wrote:
> Hi Everyone,
> I'm looking for an elegant technology option to have telcos zero-rate 
> all of the traffic to a set of online destinations.

Can you clarify what you mean exactly by "zero rate" ?

What does it have to do with actions the proxy is performing?


> Using an SSL 
> terminating reverse proxy could be a potential answer to this as we can 
> focus on zero-rating the proxy's downstream traffic with each ISP/Telco 
> without worrying about upstream servers.
> 
> There are two?challenges to address here though:
> 1) Modern web applications on the upstream servers use many 3rd party 
> and X-a-a-S resources? (e.g. embedded media, libraries, etc) that we 
> also want to pass through the proxy to ensure they are zero-rated.
> 

To be clear; "reverse proxy" is just an old term for CDN frontend. It 
requires public DNS records for the domains it services point all their 
traffic to the CDN/proxy.

I'm not sure you are talking about the same thing. Maybe you are needing 
an interception proxy or other QoS related systems.


In general;

a) If those upstream servers are doing XaaS fetches as their internal 
operations there is no relevance to the gateway. It simply passes 
traffic to upstream and they do their thing.

b) If those upstream servers are embedding URLs for clients to directly 
contact the XaaS services. Then your desire is not possible without 
redesigning the upstream service(s) such that they stop exposing their 
use of the XaaS. Which often also means redesigning the XaaS service 
itself too.


> 2) For a user to complete an end-to-end process they may get referred to 
> 3rd party websites (like a payment gateway) that we only want to 
> zero-rate if the referral is from one of our designated upstream servers.
> 

That is not possible for a reverse-proxy to do. It will never see the 
third-party traffic, as mentioned by (b) above.


Amos


From gtaylor at tnetconsulting.net  Wed Sep 15 01:12:07 2021
From: gtaylor at tnetconsulting.net (Grant Taylor)
Date: Tue, 14 Sep 2021 19:12:07 -0600
Subject: [squid-users] SSL Terminating Reverse Proxy with Referral
 Tracking
In-Reply-To: <CANDu8m2Hyn5PGV7=Mt6XRwsTAmd9onZHkgZQiHAho_moLBzYpw@mail.gmail.com>
References: <CANDu8m2Hyn5PGV7=Mt6XRwsTAmd9onZHkgZQiHAho_moLBzYpw@mail.gmail.com>
Message-ID: <2b1469f2-4107-4d8d-8b27-64c1843bd097@spamtrap.tnetconsulting.net>

On 9/12/21 10:16 PM, Mehrdad Fatemi wrote:
> Hi Everyone,

Hi,

TL;DR:  Proxy Auto Configuration

> I'm looking for an elegant technology option to have telcos zero-rate 
> all of the traffic to a set of online destinations.

I assume that "zero rating" means that specific destinations, e.g. the 
proxy server, are no-charge from the telco's customers point of view. 
If this is not what you are meaning, please correct me.

> Using an SSL terminating reverse proxy could be a potential answer 
> to this as we can focus on zero-rating the proxy's downstream traffic 
> with each ISP/Telco without worrying about upstream servers.

I have concerns about "SSL terminating".  It sounds to me like you are 
decidedly outside of the typical enterprise or home network scenario 
where you are wanting to terminate / intercept / bump-in-the-wire TLS 
connections.  As such, I have *SERIOUS* /concerns/ about the security 
implications of this.  --  But, I'm going to assume that you are well 
aware of the implications and are addressing them properly.  But I'd be 
remiss to not say something.  Moving on.

Aside:  I sat on this message for a few days while messing with my own 
TLS bump-in-the-wire /in/ /my/ /house/ on my /home/ network.  As such, 
I'm perfectly fine with TLS termination within environments that have 
the authority to do so.  ;-)  --  I sat on the message while working on 
my own Proxy Auto Configuration script to have multiple clients do what 
I want.

Further aside:  I'm *EXTREMELY* happy with Squid's support for TLS 
bump-in-the-wire for my use cases; allowing ancient clients to use Squid 
as an encryption gateway between SSL3 / TLSv1 / TLSv1.1 and TLSv1.2 / 
TLSv1.3.  The ability to filter various things like tracking pixels, and 
the caching is wonderful.  --  I can't quite wrap my head around why 
Squid improves performance on a GPON connection, but it does.  I would 
have thought that 1 Gbps connection would negate the need for local caching.

> There are two?challenges to address here though:
> 1) Modern web applications on the upstream servers use many 3rd party 
> and X-a-a-S resources? (e.g. embedded media, libraries, etc) that we 
> also want to pass through the proxy to ensure they are zero-rated.

That's going to be a game of Whack-a-Mole.

There's also the possibility that you will proxy ~> zero-rate some 
common library that many other sites that don't pass through your 
infrastructure will use.  So I suspect it's an impure WaM game at best.

> 2) For a user to complete an end-to-end process they may get referred to 
> 3rd party websites (like a payment gateway) that we only want to 
> zero-rate if the referral is from one of our designated upstream servers.

I suspect that trying to integrate conditional behavior based on account 
balance is going to be ... tricky, if not problematic.  I'd suggest 
worrying about that after the fact or at a later point in the process.

> Any advice on whether and how Squid and other related technologies could 
> help is much appreciated.

I feel like a judicious use of a Proxy Auto Configuration (PAC) file / 
script may be a good start.  It should be relatively easy for 
subscribers to configure their devices to utilize.  Then you can update 
the PAC file as the WaM game requires.  The PAC has the added advantage 
that you can direct proxy traffic to different proxy servers as necessary.

As for normal (forward) vs reverse proxy is concerned, it seems to me 
like your proxy will be acting as both, a reverse proxy / accelerator 
/and/ a /conditional/ forward proxy.  The conditionality is based on the 
result of the PAC file's FindProxyForURL() function.  You are in some 
ways acting as a reverse proxy / accelerator for specific sites.  You 
are also acting as a forward proxy for clients.  The behaviors just 
overlap in your use case.  The secret sauce is in the PAC file; what 
does and does not get sent to your proxy.

Seeing as how you are dealing with subscribers, you probably do not want 
the closely related / largely overlapping Web Proxy Auto Discovery 
(WPAD) functionality.  IMHO WPAD points to a PAC file.



-- 
Grant. . . .
unix || die

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4013 bytes
Desc: S/MIME Cryptographic Signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210914/6203a64f/attachment.bin>

From gtaylor at tnetconsulting.net  Wed Sep 15 01:16:39 2021
From: gtaylor at tnetconsulting.net (Grant Taylor)
Date: Tue, 14 Sep 2021 19:16:39 -0600
Subject: [squid-users] SSL Terminating Reverse Proxy with Referral
 Tracking
In-Reply-To: <2b1469f2-4107-4d8d-8b27-64c1843bd097@spamtrap.tnetconsulting.net>
References: <CANDu8m2Hyn5PGV7=Mt6XRwsTAmd9onZHkgZQiHAho_moLBzYpw@mail.gmail.com>
 <2b1469f2-4107-4d8d-8b27-64c1843bd097@spamtrap.tnetconsulting.net>
Message-ID: <a9bd0dfc-84b9-4fed-190a-68a17e8afe63@spamtrap.tnetconsulting.net>

On 9/14/21 7:12 PM, Grant Taylor wrote:
> I have concerns about "SSL terminating".? It sounds to me like you are 
> decidedly outside of the typical enterprise or home network scenario 
> where you are wanting to terminate / intercept / bump-in-the-wire TLS 
> connections.? As such, I have *SERIOUS* /concerns/ about the security 
> implications of this.? --? But, I'm going to assume that you are well 
> aware of the implications and are addressing them properly.? But I'd be 
> remiss to not say something.? Moving on.

I meant to add, I'm not convinced that you /need/ to do TLS termination.

Or said another way, I'm not convinced that simply proxying CONNECT 
requests isn't sufficient.

Do you actually /need/ to terminate the TLS?  Or is simply proxying the 
CONNECT request sufficient?  Can you stay out of the TLS stream, thereby 
avoiding any and all security concerns associated with TLS termination?

Proxies have been passing TLS traffic for decades without TLS termination.



-- 
Grant. . . .
unix || die

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4013 bytes
Desc: S/MIME Cryptographic Signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210914/f4820d65/attachment.bin>

From gtaylor at tnetconsulting.net  Wed Sep 15 01:21:33 2021
From: gtaylor at tnetconsulting.net (Grant Taylor)
Date: Tue, 14 Sep 2021 19:21:33 -0600
Subject: [squid-users] SSL Terminating Reverse Proxy with Referral
 Tracking
In-Reply-To: <c892b2e3-7613-625d-3092-dfe672126b64@treenet.co.nz>
References: <CANDu8m2Hyn5PGV7=Mt6XRwsTAmd9onZHkgZQiHAho_moLBzYpw@mail.gmail.com>
 <c892b2e3-7613-625d-3092-dfe672126b64@treenet.co.nz>
Message-ID: <dc9c49b8-504b-84b6-f9a3-2fcbfd4c8c7c@spamtrap.tnetconsulting.net>

On 9/14/21 6:09 PM, Amos Jeffries wrote:
> b) If those upstream servers are embedding URLs for clients to directly 
> contact the XaaS services. Then your desire is not possible without 
> redesigning the upstream service(s) such that they stop exposing their 
> use of the XaaS. Which often also means redesigning the XaaS service 
> itself too.

I don't know about Squid, but I do know that it's possible to manipulate 
traffic with Apache in a similar role.  I've done so a number of times 
using the mod_proxy and associated mod_proxy_html modules.  This allows 
Apache to re-write content as it's passing through the Apache proxy.

I wonder if Squid's ICAP support might allow something to modify traffic 
as it passes through the Squid proxy.

> That is not possible for a reverse-proxy to do. It will never see the 
> third-party traffic, as mentioned by (b) above.

Sure it is.  }:-)



-- 
Grant. . . .
unix || die

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4013 bytes
Desc: S/MIME Cryptographic Signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210914/d5032357/attachment.bin>

From squid3 at treenet.co.nz  Wed Sep 15 07:14:36 2021
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 15 Sep 2021 19:14:36 +1200
Subject: [squid-users] SSL Terminating Reverse Proxy with Referral
 Tracking
In-Reply-To: <dc9c49b8-504b-84b6-f9a3-2fcbfd4c8c7c@spamtrap.tnetconsulting.net>
References: <CANDu8m2Hyn5PGV7=Mt6XRwsTAmd9onZHkgZQiHAho_moLBzYpw@mail.gmail.com>
 <c892b2e3-7613-625d-3092-dfe672126b64@treenet.co.nz>
 <dc9c49b8-504b-84b6-f9a3-2fcbfd4c8c7c@spamtrap.tnetconsulting.net>
Message-ID: <bd81023a-4338-c771-65f9-ed5eca6ba0e3@treenet.co.nz>

On 15/09/21 1:21 pm, Grant Taylor wrote:
> On 9/14/21 6:09 PM, Amos Jeffries wrote:
>> b) If those upstream servers are embedding URLs for clients to 
>> directly contact the XaaS services. Then your desire is not possible 
>> without redesigning the upstream service(s) such that they stop 
>> exposing their use of the XaaS. Which often also means redesigning the 
>> XaaS service itself too.
> 
> I don't know about Squid, but I do know that it's possible to manipulate 
> traffic with Apache in a similar role.? I've done so a number of times 
> using the mod_proxy and associated mod_proxy_html modules.? This allows 
> Apache to re-write content as it's passing through the Apache proxy.
> 
> I wonder if Squid's ICAP support might allow something to modify traffic 
> as it passes through the Squid proxy.
> 

Squid also has ability to pass traffic to adaptors. That is quite a 
complicated system, the OP is looking for something elegant (aka simple).


>> That is not possible for a reverse-proxy to do. It will never see the 
>> third-party traffic, as mentioned by (b) above.
> 
> Sure it is.? }:-)
> 

I am talking here about traffic that does not go near a reverse-proxy.

Amos


From belle at bazuin.nl  Wed Sep 15 10:28:52 2021
From: belle at bazuin.nl (=?windows-1252?Q?L.P.H._van_Belle?=)
Date: Wed, 15 Sep 2021 12:28:52 +0200
Subject: [squid-users] Compile/Rebuilding on debian bullseye (or buster)
In-Reply-To: <cc18df2f-4f63-c766-8536-b017e8c39332@treenet.co.nz>
References: <vmime.614069e5.43a6.3660c743bb9ffb5@ms249-lin-003.rotterdam.bazuin.nl>
Message-ID: <vmime.6141cae4.2ada.6144343c44c14f24@ms249-lin-003.rotterdam.bazuin.nl>

Hai Amos, 

Thanks on the reply, ive missed the change from db to tdb, thanks on that. 

What i notice in the builds is, 

I see this one.. 

config.status: creating test-suite/Makefile

And then i see these, then it failes. 

cp ../../src/tests/stub_fd.cc tests/stub_fd.cc
cp: cannot create regular file 'tests/stub_fd.cc': No such file or directory
make[4]: *** [Makefile:1445: tests/stub_fd.cc] Error 1


Is it possible that the "tests" folder (keep in mind above uses the old /debian setup),
is changed to "test-suite"..  

Im not really that into the code but, it "looks" like there is a folder missing "tests"  
Based on above, if can disable all tests, it should build. 

Suggestion on disabling the tests? 


Greetz, 

Louis

 

> -----Oorspronkelijk bericht-----
> Van: squid-users 
> [mailto:squid-users-bounces at lists.squid-cache.org] Namens 
> Amos Jeffries
> Verzonden: woensdag 15 september 2021 1:14
> Aan: squid-users at lists.squid-cache.org
> Onderwerp: Re: [squid-users] Compile/Rebuilding on debian 
> bullseye (or buster)
> 
> On 14/09/21 9:22 pm, L.P.H. van Belle wrote:
> > Hai Amos,
> > 
> > Im attempting to make a squid 5.1 build based on the 
> bullseye squid/debian folder.
> > ( ps. Im building with sbuilder )
> > 
> > Now, this "normaly" worked since squid 3.2 for me, copy the 
> debian folder, make minor adjustments if needed,
> > Just with latest adjustments, well, i cant make it work.
> > 
> > This was my last adjustmated..
> > 
> >    * Used build : squid-5.1-20210804-r1f9e52827 of 04 Aug 2021
> >    * Refreshed patches, removed patches already included.
> >    * d/control lower debhelper to 12 to allow building
> > 
> > 
> > Changed d/rules, added. -srcdir=. --disable-dependency-tracking
> > Any suggestions what i can do here?
> 
> I am a bit stuck here myself with this build style, that is 
> part of why 
> the package is not already updated. The Debian auto-build system adds 
> those options and AFAICT does not provide an easy way to avoid.
> 
> 
> > 
> > And i tested also with my last settings from my backport to 
> Debian buster and squid 4.16(ssl enabled)
> > 
> > Resulting in :
> > configure: Samba TrivialDB library support: no
> > configure: error: external acl helper time_quota ... found 
> but cannot be built
> > make: *** [/usr/share/cdbs/1/class/autotools.mk:46: 
> debian/stamp-autotools] Error 1
> > dpkg-buildpackage: error: debian/rules build subprocess 
> returned exit status 2
> > 
> --------------------------------------------------------------
> ------------------
> 
> Debian used to use the BerkeleyDB, so the normal Squid build 
> dependencies pulls the library in for that.
> 
> If libdb-dev is no longer available you will need to install 
> libtdb-dev 
> package.
> 
> Also, (for now) if you are using the ext_time_quote_acl or 
> ext_session_acl helpers you will need to manually purge their 
> databases 
> on install/upgrade.
> 
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 
> 



From david at articatech.com  Wed Sep 15 10:40:04 2021
From: david at articatech.com (David Touzeau)
Date: Wed, 15 Sep 2021 12:40:04 +0200
Subject: [squid-users] squid 5.1/Debian WARNING: no_suid: setuid(0): (1)
 Operation not permitted
Message-ID: <308548d3-e30f-2cb1-352a-3fb4c5484c3e@articatech.com>

On Debian 10 64bits? with squid 5.1 we have thousand warning as this:

2021/09/15 08:00:18 kid1| WARNING: no_suid: setuid(0): (1) Operation not 
permitted
2021/09/15 08:00:18 kid2| WARNING: no_suid: setuid(0): (1) Operation not 
permitted
2021/09/15 08:00:18 kid1| WARNING: no_suid: setuid(0): (1) Operation not 
permitted
2021/09/15 08:00:18 kid2| WARNING: no_suid: setuid(0): (1) Operation not 
permitted
2021/09/15 08:00:18 kid1| WARNING: no_suid: setuid(0): (1) Operation not 
permitted
2021/09/15 08:00:18 kid2| WARNING: no_suid: setuid(0): (1) Operation not 
permitted
2021/09/15 08:00:18 kid1| WARNING: no_suid: setuid(0): (1) Operation not 
permitted

When squid try to load external acls binaries

add chmod 04755 in binaries? did not resolve the issue.

No issue with same configuration with squid 3.5x branch

Any tips ?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210915/cee306dd/attachment.htm>

From belle at bazuin.nl  Wed Sep 15 11:45:29 2021
From: belle at bazuin.nl (=?windows-1252?Q?L.P.H._van_Belle?=)
Date: Wed, 15 Sep 2021 13:45:29 +0200
Subject: [squid-users] squid 5.1/Debian WARNING: no_suid: setuid(0): (1)
 Operation not permitted
In-Reply-To: <308548d3-e30f-2cb1-352a-3fb4c5484c3e@articatech.com>
References: <308548d3-e30f-2cb1-352a-3fb4c5484c3e@articatech.com>
Message-ID: <vmime.6141dcd9.636.2cf633ef57cb8fe9@ms249-lin-003.rotterdam.bazuin.nl>

How do you build and start it, init.d/squid or systemd start squid

In case of last, what i suspect, I seen more if these messages on previous version.. 
But all my version dont show this on Debian 10. 
 
This is my latest startup for systemd 

# /lib/systemd/system/squid.service
## Copyright (C) 1996-2021 The Squid Software Foundation and contributors
##
## Squid software is distributed under GPLv2+ license and includes
## contributions from numerous individuals and organizations.
## Please see the COPYING and CONTRIBUTORS files for details.
##
 
[Unit]
Description=Squid Web Proxy Server
Documentation=man:squid(8)
After=network.target network-online.target nss-lookup.target
 
[Service]
Type=notify
PIDFile=/run/squid.pid
ExecStartPre=/usr/sbin/squid --foreground -z
ExecStart=/usr/sbin/squid --foreground -sYC
ExecReload=/bin/kill -HUP $MAINPID
KillMode=mixed
NotifyAccess=all
 
[Install]
WantedBy=multi-user.target


--- 
these are the settings from a debian (own) build setup with squid 4.16. ( with ssl enabled) 

squid -v
Squid Cache: Version 4.16
Service Name: squid
Debian linux
 
This binary uses OpenSSL 1.1.1d  10 Sep 2019. For legal restrictions on distribution see https://www.openssl.org/source/license.html
 
configure options:  '--build=x86_64-linux-gnu' '--prefix=/usr' '--includedir=${prefix}/include' '--mandir=${prefix}/share/man' '--infodir=${prefix}/share/info' '--sysconfdir=/etc' '--localstatedir=/var' '--libexecdir=${prefix}/lib/squid' '--srcdir=.' '--disable-maintainer-mode' '--disable-dependency-tracking' '--disable-silent-rules' 'BUILDCXXFLAGS=-g -O2 -fdebug-prefix-map=/build/squid-4.16=. -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2 -Wl,-z,relro -Wl,-z,now -Wl,--as-needed' 'BUILDCXX=x86_64-linux-gnu-g++' '--with-build-environment=default' '--enable-build-info=Debian linux' '--datadir=/usr/share/squid' '--sysconfdir=/etc/squid' '--libexecdir=/usr/lib/squid' '--mandir=/usr/share/man' '--enable-inline' '--disable-arch-native' '--enable-async-io=8' '--enable-storeio=ufs,aufs,diskd,rock' '--enable-removal-policies=lru,heap' '--enable-delay-pools' '--enable-cache-digests' '--enable-ica
 p-client' '--enable-follow-x-forwarded-for' '--enable-auth-basic=DB,fake,getpwnam,LDAP,NCSA,NIS,PAM,POP3,RADIUS,SASL,SMB' '--enable-auth-digest=file,LDAP' '--enable-auth-negotiate=kerberos,wrapper' '--enable-auth-ntlm=fake,SMB_LM' '--enable-external-acl-helpers=file_userip,kerberos_ldap_group,LDAP_group,session,SQL_session,time_quota,unix_group,wbinfo_group' '--enable-security-cert-validators=fake' '--enable-storeid-rewrite-helpers=file' '--enable-url-rewrite-helpers=fake' '--enable-eui' '--enable-esi' '--enable-icmp' '--enable-zph-qos' '--enable-ecap' '--disable-translation' '--with-swapdir=/var/spool/squid' '--with-logdir=/var/log/squid' '--with-pidfile=/var/run/squid.pid' '--with-filedescriptors=65536' '--with-large-files' '--with-default-user=proxy' '--with-gnutls' '--enable-ssl' '--enable-ssl-crtd' '--with-openssl' '--enable-linux-netfilter' 'build_alias=x86_64-linux-gnu' 'CC=x86_64-linux-gnu-gcc' 'CFLAGS=-g -O2 -fdebug-prefix-map=/buil
 d/squid-4.16=. -fstack-protector-strong -Wformat -Werror=format-security -Wall' 'LDFLAGS=-Wl,-z,relro -Wl,-z,now -Wl,--as-needed' 'CPPFLAGS=-Wdate-time -D_FORTIFY_SOURCE=2' 'CXX=x86_64-linux-gnu-g++' 'CXXFLAGS=-g -O2 -fdebug-prefix-map=/build/squid-4.16=. -fstack-protector-strong -Wformat -Werror=format-security'


look if you also see : '--with-default-user=proxy'  
and if its self compiled. 
sudo adduser --system proxy 
And when thats done verify the needed folders and there rights/ownerships. 
 
The "debian" folder if you want it have a look of what i use currently in production. 

https://apt.van-belle.nl/debian/pool/main/s/squid/squid_4.16-0.1ssl1buster1.debian.tar.xz <https://apt.van-belle.nl/debian/pool/main/s/squid/squid_4.16-0.1ssl1buster1.debian.tar.xz>  
 
As soon i can make debian packages of 5.1, im making a buster and bullseye version. 

I hope this helps you a bit. 

Greetz, 

Louis

 




________________________________

	Van: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] Namens David Touzeau
	Verzonden: woensdag 15 september 2021 12:40
	Aan: squid-users at lists.squid-cache.org
	Onderwerp: [squid-users] squid 5.1/Debian WARNING: no_suid: setuid(0): (1) Operation not permitted
	
	
	On Debian 10 64bits  with squid 5.1 we have thousand warning as this:
	
	2021/09/15 08:00:18 kid1| WARNING: no_suid: setuid(0): (1) Operation not permitted
	2021/09/15 08:00:18 kid2| WARNING: no_suid: setuid(0): (1) Operation not permitted
	2021/09/15 08:00:18 kid1| WARNING: no_suid: setuid(0): (1) Operation not permitted
	2021/09/15 08:00:18 kid2| WARNING: no_suid: setuid(0): (1) Operation not permitted
	2021/09/15 08:00:18 kid1| WARNING: no_suid: setuid(0): (1) Operation not permitted
	2021/09/15 08:00:18 kid2| WARNING: no_suid: setuid(0): (1) Operation not permitted
	2021/09/15 08:00:18 kid1| WARNING: no_suid: setuid(0): (1) Operation not permitted
	
	When squid try to load external acls binaries 
	
	add chmod 04755 in binaries  did not resolve the issue.
	
	No issue with same configuration with squid 3.5x branch
	
	Any tips ?
	




From david at articatech.com  Wed Sep 15 13:12:42 2021
From: david at articatech.com (David Touzeau)
Date: Wed, 15 Sep 2021 15:12:42 +0200
Subject: [squid-users] squid 5.1/Debian WARNING: no_suid: setuid(0): (1)
 Operation not permitted
In-Reply-To: <LO2P123MB2559CABA2B9C985CF74C0934A9DB9@LO2P123MB2559.GBRP123.PROD.OUTLOOK.COM>
References: <308548d3-e30f-2cb1-352a-3fb4c5484c3e@articatech.com>
 <LO2P123MB2559CABA2B9C985CF74C0934A9DB9@LO2P123MB2559.GBRP123.PROD.OUTLOOK.COM>
Message-ID: <2346dc37-27d7-4374-094c-d68712113c56@articatech.com>

Many thanks

It fix the issue !

Le 15/09/2021 ? 13:08, Graham Wharton a ?crit?:
> You see this when starting as non rootuser. Squid should be started as 
> root and then it changes identity to cache effective user as defined 
> in config when it forks.
>
> Graham Wharton
> Lube Finder
> Tel (UK) : 0800 955? 0922
> Tel (Intl) : +44 1305 898033
> https://www.lubefinder.com
> ------------------------------------------------------------------------
> *From:* squid-users <squid-users-bounces at lists.squid-cache.org> on 
> behalf of David Touzeau <david at articatech.com>
> *Sent:* Wednesday, September 15, 2021 11:40:04 AM
> *To:* squid-users at lists.squid-cache.org 
> <squid-users at lists.squid-cache.org>
> *Subject:* [squid-users] squid 5.1/Debian WARNING: no_suid: setuid(0): 
> (1) Operation not permitted
> On Debian 10 64bits? with squid 5.1 we have thousand warning as this:
>
> 2021/09/15 08:00:18 kid1| WARNING: no_suid: setuid(0): (1) Operation 
> not permitted
> 2021/09/15 08:00:18 kid2| WARNING: no_suid: setuid(0): (1) Operation 
> not permitted
> 2021/09/15 08:00:18 kid1| WARNING: no_suid: setuid(0): (1) Operation 
> not permitted
> 2021/09/15 08:00:18 kid2| WARNING: no_suid: setuid(0): (1) Operation 
> not permitted
> 2021/09/15 08:00:18 kid1| WARNING: no_suid: setuid(0): (1) Operation 
> not permitted
> 2021/09/15 08:00:18 kid2| WARNING: no_suid: setuid(0): (1) Operation 
> not permitted
> 2021/09/15 08:00:18 kid1| WARNING: no_suid: setuid(0): (1) Operation 
> not permitted
>
> When squid try to load external acls binaries
>
> add chmod 04755 in binaries? did not resolve the issue.
>
> No issue with same configuration with squid 3.5x branch
>
> Any tips ?

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210915/3ce46430/attachment.htm>

From ngtech1ltd at gmail.com  Wed Sep 15 13:27:30 2021
From: ngtech1ltd at gmail.com (Eliezer Croitoru)
Date: Wed, 15 Sep 2021 16:27:30 +0300
Subject: [squid-users] [squid-announce] Squid 4.16 is available
In-Reply-To: <860aceb6-9cb4-049f-e683-9d288a876f79@treenet.co.nz>
References: <860aceb6-9cb4-049f-e683-9d288a876f79@treenet.co.nz>
Message-ID: <000a01d7aa35$704cd0f0$50e672d0$@gmail.com>

Hey Amos and Alex,

I have tested the 4.16 version and it seems to work steady on basic loads.

Eliezer

-----Original Message-----
From: squid-announce <squid-announce-bounces at lists.squid-cache.org> On
Behalf Of Amos Jeffries
Sent: Thursday, July 22, 2021 7:24 AM
To: squid-announce at lists.squid-cache.org
Subject: [squid-announce] Squid 4.16 is available

The Squid HTTP Proxy team is very pleased to announce the availability
of the Squid-4.16 release!


This release is a bug fix release resolving several issues found in
the prior Squid releases.


The major changes to be aware of since 4.15:

  * Regression Fix: --with-valgrind-debug build

Squid-4.15 changes caused a build failure linking with valgrind
memory tracking tool. This release fixes that to allow memory
leak tracing again.


  * Bug 4528: ICAP transactions quit on async DNS lookups

Squid has never reliably been able to resolve hostnames configured
for ICAP services. They might work most of the time when added to
/etc/hosts, but not always - and would rarely work if relying on
remote DNS servers.

This release adds full support for DNS remote resolution of
service names in icap_service directive. Regardless of where the
hostname is resolved from it can now be expected to resolve and
also properly obey DNS TTL expiry for IP address changes.


  * Bug 5128: Translation: Fix '% i' typo in es/ERR_FORWARDING_DENIED

Spanish translation of the ERR_FORWARDING_DENIED template have
for some time omitted the URL which was having issues being fetched.
The template published with this release and current squid-langpack
downloads will now display the URL identically to other error pages.


   All users of Squid are encouraged to upgrade as soon as possible.


See the ChangeLog for the full list of changes in this and earlier
releases.

Please refer to the release notes at
http://www.squid-cache.org/Versions/v4/RELEASENOTES.html
when you are ready to make the switch to Squid-4

This new release can be downloaded from our HTTP or FTP servers

   http://www.squid-cache.org/Versions/v4/
   ftp://ftp.squid-cache.org/pub/squid/
   ftp://ftp.squid-cache.org/pub/archive/4/

or the mirrors. For a list of mirror sites see

   http://www.squid-cache.org/Download/http-mirrors.html
   http://www.squid-cache.org/Download/mirrors.html

If you encounter any issues with this release please file a bug report.
   http://bugs.squid-cache.org/


Amos Jeffries
_______________________________________________
squid-announce mailing list
squid-announce at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-announce



From squid3 at treenet.co.nz  Wed Sep 15 17:00:20 2021
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 16 Sep 2021 05:00:20 +1200
Subject: [squid-users] Compile/Rebuilding on debian bullseye (or buster)
In-Reply-To: <vmime.6141cae4.2ada.6144343c44c14f24@ms249-lin-003.rotterdam.bazuin.nl>
References: <vmime.614069e5.43a6.3660c743bb9ffb5@ms249-lin-003.rotterdam.bazuin.nl>
 <vmime.6141cae4.2ada.6144343c44c14f24@ms249-lin-003.rotterdam.bazuin.nl>
Message-ID: <149542ad-a232-3404-6c3c-93625d34791a@treenet.co.nz>

On 15/09/21 10:28 pm, L.P.H. van Belle wrote:
> Hai Amos,
> 
> Thanks on the reply, ive missed the change from db to tdb, thanks on that.
> 
> What i notice in the builds is,
> 
> I see this one..
> 
> config.status: creating test-suite/Makefile
> 
> And then i see these, then it failes.
> 
> cp ../../src/tes ts/stub_fd.cc tests/stub_fd.cc
>cp: cannot create regular file 'tests/stub_fd.cc': No such file or directory
> make[4]: *** [Makefile:1445: tests/stub_fd.cc] Error 1
> 
> 
> Is it possible that the "tests" folder (keep in mind above uses the old /debian setup),
> is changed to "test-suite"..
> 

No, the folders are not related.

The issue is that without dependency tracking make does not detect that 
tools/squidclient/tests/ directory needs to exist before stub_fd.cc is 
copied to build tools/squidclient/tests/stub_fd.o


> Im not really that into the code but, it "looks" like there is a folder missing "tests"
> Based on above, if can disable all tests, it should build.
> 
> Suggestion on disabling the tests?
> 

I have spent a while working on it today and have pushed an update to 
Debian packaging repo. Please pull a new copy of that latest. It should 
fix all the issues you have.

Amos


From rousskov at measurement-factory.com  Wed Sep 15 17:47:15 2021
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Wed, 15 Sep 2021 13:47:15 -0400
Subject: [squid-users] logformat odd values
In-Reply-To: <CAGSk-41or=cMZg+VFr82D15UTaiE_SRSt=n2NOVMitz0LMEMmA@mail.gmail.com>
References: <CAGSk-41or=cMZg+VFr82D15UTaiE_SRSt=n2NOVMitz0LMEMmA@mail.gmail.com>
Message-ID: <1db857b3-123e-a38a-347f-d4369b300eed@measurement-factory.com>

On 9/14/21 3:04 PM, Moti Berger wrote:

> I have the followings in squid.conf:
> 
>     logformat metrics %icap::tt %adapt::all_trs %adapt::sum_trs
>     %{service_req_a}adapt::sum_trs %{service_resp_a}adapt::sum_trs
>     %{service_req_b}adapt::sum_trs %{service_resp_b}adapt::sum_trs
>     access_log daemon:/var/log/squid/metrics.log metrics
> 
> ?
> 
>     icap_service service_req_a reqmod_precache bypass=1 on-overload=wait
>     routing=1 icap://a.y:12345/request
>     icap_service service_req_b reqmod_precache bypass=1 on-overload=wait
>     icap://b.y:10101/request
>     adaptation_service_chain svcRequest service_req_a?service_req_b
>     adaptation_access svcRequest deny manager
>     adaptation_access svcRequest allow all
>     icap_service service_resp_a respmod_precache bypass=1
>     on-overload=wait routing=1 icap://a.y:12345/response
>     icap_service service_resp_b respmod_precache bypass=1
>     on-overload=wait icap://b.y:10101/response
>     adaptation_service_chain svcResponse service_resp_a?service_resp_b
>     adaptation_access svcResponse deny manager
>     adaptation_access svcResponse allow all
> 
> 
> ?I see in metrics.log lines like this:
> 
>     4 4,180 4,180 4 180 - -
> 
> 
> Now I wonder how come the value of %icap:tt isn't at least as the sum of
> all the numbers appear on %adapt::all_trs or %adapt::sum_trs (assuming
> no failed transactions)?

There is probably a bug somewhere, but please note that %icap:tt may not
be the sum of individual transaction response times (in _some_ cases)
even after that bug is fixed because those individual transactions may
run _concurrently_ (i.e. partially overlap in time).


> If %icap:tt isn't at least the sum of all ICAPs processing time, what is?

Bugs notwithstanding, it is approximate time a master transaction spent
doing adaptation (including checking whether adaptation is necessary).
This stopwatch ticks when adaptation_access ACLs are checked and also
when at least one adaptation transaction associated with that master
transaction is in progress.

Please note that a master transaction can do a lot of different things
at once or in parallel. For example, it can communicate with an HTTP
client while communicating with an FTP server while communicating with
an eCAP REQMOD adaptation service while communicating with a DNS server
to decide whether to start communicating with an ICAP RESPMOD service.


HTH,

Alex.


From belle at bazuin.nl  Thu Sep 16 06:51:09 2021
From: belle at bazuin.nl (=?windows-1252?Q?L.P.H._van_Belle?=)
Date: Thu, 16 Sep 2021 08:51:09 +0200
Subject: [squid-users] Compile/Rebuilding on debian bullseye (or buster)
In-Reply-To: <149542ad-a232-3404-6c3c-93625d34791a@treenet.co.nz>
References: <vmime.6141cae4.2ada.6144343c44c14f24@ms249-lin-003.rotterdam.bazuin.nl>
Message-ID: <vmime.6142e95d.256a.e53738b8c6aaad@ms249-lin-003.rotterdam.bazuin.nl>

Good Morning. 


> > 
> 
> I have spent a while working on it today and have pushed an update to 
> Debian packaging repo. Please pull a new copy of that latest. 
> It should  fix all the issues you have.

Wow, Thank you very very much Amos.. 
Im on it now :-) ??

I'll post the results later today.

Greetz, 
Louis





From david at articatech.com  Thu Sep 16 10:09:38 2021
From: david at articatech.com (David Touzeau)
Date: Thu, 16 Sep 2021 12:09:38 +0200
Subject: [squid-users] squid 5.1: external_acl_type: Get public remote
 address
Message-ID: <12964961-64bd-4536-6e96-50c5fc1b48eb@articatech.com>

Hi comunity, Squid fans

I would like to use an external acl process for Geoip processing

i have tried to setup squid to send the remote peer address using %<a 
code but it always reply with a "-"

external_acl_type MyGeopip ttl=3600 negative_ttl=3600 children-startup=2 
children-idle=2 children-max=20 concurrency=1 ipv4 %un %SRC %SRCEUI48 
%>ha{X-Forwarded-For} %DST %ssl::>sni %USER_CERT_CN %note %<a? 
/lib/squid3/squid-geoip

acl MyGeopip_acl external MyGeopip
http_access deny !MyGeopip_acl

I was thinking that Squid call the helper before resolving the remote route.

So to force it, i have added a "fake" acl to force Squid to calculate 
the remote address.

acl fake_dst dst 127.0.0.2
http_access deny !fake_dst !MyGeopip_acl

But it failed too, the external_acl still receive the "-" instead of the 
remote public IP address of the server


Where is the mistake ?

Regards

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210916/b2bc9000/attachment.htm>

From meike.stone at googlemail.com  Thu Sep 16 13:38:32 2021
From: meike.stone at googlemail.com (Meike Stone)
Date: Thu, 16 Sep 2021 15:38:32 +0200
Subject: [squid-users] SOLVED - compiling squid 5.1
In-Reply-To: <eeef31e4-5528-fd92-411a-7ece02b45096@treenet.co.nz>
References: <CAFNHiA_YSVSMeSZoxcUNX93WwG-Je9K73KqYJmyaRpEVpgFnyA@mail.gmail.com>
 <CAFNHiA-9Ke+QW5UsRAUM=PXysGrcaq=_7C_+GdtYaM8wbfWKNA@mail.gmail.com>
 <eeef31e4-5528-fd92-411a-7ece02b45096@treenet.co.nz>
Message-ID: <CAFNHiA8wg-+u7kFyOpwYJnO0NMwTZULr=Vpi8zCGvVdeetv-Kw@mail.gmail.com>

Hello Amos,

thanks for answering!

Am Mi., 8. Sept. 2021 um 11:26 Uhr schrieb Amos Jeffries <squid3 at treenet.co.nz>:
>
> This hack only works if you are building manually from source code, in
> the same directory you expanded the sources. Which is not he case for
> anyone building with automated tools or CI systems.

that's the problem I'm facing right now :-O

> The earlier provided ./configure parameter change works just as well
> without manual changes to the source code.

Can you please guide me with this configure parameter?

Thanks in advance,
Meike


From squid3 at treenet.co.nz  Thu Sep 16 14:10:12 2021
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 17 Sep 2021 02:10:12 +1200
Subject: [squid-users] SOLVED - compiling squid 5.1
In-Reply-To: <CAFNHiA8wg-+u7kFyOpwYJnO0NMwTZULr=Vpi8zCGvVdeetv-Kw@mail.gmail.com>
References: <CAFNHiA_YSVSMeSZoxcUNX93WwG-Je9K73KqYJmyaRpEVpgFnyA@mail.gmail.com>
 <CAFNHiA-9Ke+QW5UsRAUM=PXysGrcaq=_7C_+GdtYaM8wbfWKNA@mail.gmail.com>
 <eeef31e4-5528-fd92-411a-7ece02b45096@treenet.co.nz>
 <CAFNHiA8wg-+u7kFyOpwYJnO0NMwTZULr=Vpi8zCGvVdeetv-Kw@mail.gmail.com>
Message-ID: <eefb94ed-c06f-b18a-64b5-09fa8e512ce6@treenet.co.nz>

On 17/09/21 1:38 am, Meike Stone wrote:
> Hello Amos,
> 
> thanks for answering!
> 
> Am Mi., 8. Sept. 2021 um 11:26 Uhr schrieb Amos Jeffries:
>>
>> This hack only works if you are building manually from source code, in
>> the same directory you expanded the sources. Which is not he case for
>> anyone building with automated tools or CI systems.
> 
> that's the problem I'm facing right now :-O
> 
>> The earlier provided ./configure parameter change works just as well
>> without manual changes to the source code.
> 
> Can you please guide me with this configure parameter?
> 

The problem is use of --disable-dependency-tracking


Amos


From squid3 at treenet.co.nz  Thu Sep 16 14:21:51 2021
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 17 Sep 2021 02:21:51 +1200
Subject: [squid-users] squid 5.1: external_acl_type: Get public remote
 address
In-Reply-To: <12964961-64bd-4536-6e96-50c5fc1b48eb@articatech.com>
References: <12964961-64bd-4536-6e96-50c5fc1b48eb@articatech.com>
Message-ID: <6803dd48-0513-61fa-9088-713244c27ea0@treenet.co.nz>

On 16/09/21 10:09 pm, David Touzeau wrote:
> Hi comunity, Squid fans
> 
> I would like to use an external acl process for Geoip processing
> 
> i have tried to setup squid to send the remote peer address using %<a 
> code but it always reply with a "-"
> 
> external_acl_type MyGeopip ttl=3600 negative_ttl=3600 children-startup=2 
> children-idle=2 children-max=20 concurrency=1 ipv4 %un %SRC %SRCEUI48 
> %>ha{X-Forwarded-For} %DST %ssl::>sni %USER_CERT_CN %note %<a  
> /lib/squid3/squid-geoip
> 
> acl MyGeopip_acl external MyGeopip
> http_access deny !MyGeopip_acl
> 
> I was thinking that Squid call the helper before resolving the remote route.
> 

The problem is there is no server/peer connection at all for a 
transaction that has only been received and not yet processed by Squid.


> So to force it, i have added a "fake" acl to force Squid to calculate 
> the remote address.
> 
> acl fake_dst dst 127.0.0.2
> http_access deny !fake_dst !MyGeopip_acl
> 
> But it failed too, the external_acl still receive the "-" instead of the 
> remote public IP address of the server
> 

Aye. There is still no server.

All this dst ACL changed was that Squid knows a group of IPs it *might* 
select from. The decision whether to use one of them (or somewhere 
entirely different) has not yet been made, so there is still no server.

The "%<a" displays the "last server or peer connection". It can change 
when automated retries are done, and is "-" at all points before any 
server contact.


Amos


From david at articatech.com  Thu Sep 16 14:42:05 2021
From: david at articatech.com (David Touzeau)
Date: Thu, 16 Sep 2021 16:42:05 +0200
Subject: [squid-users] squid 5.1: external_acl_type: Get public remote
 address
In-Reply-To: <6803dd48-0513-61fa-9088-713244c27ea0@treenet.co.nz>
References: <12964961-64bd-4536-6e96-50c5fc1b48eb@articatech.com>
 <6803dd48-0513-61fa-9088-713244c27ea0@treenet.co.nz>
Message-ID: <74ab3103-3a8d-7135-4aec-7ce5d228bee9@articatech.com>

Thanks Amos for quick answer.

Can you take away any hope of a workaround with Squid ?

This makes me plan having to develop a function that has to perform DNS 
resolution inside the helper with the performance consequences that this 
will impose.



Le 16/09/2021 ? 16:21, Amos Jeffries a ?crit?:
> On 16/09/21 10:09 pm, David Touzeau wrote:
>> Hi comunity, Squid fans
>>
>> I would like to use an external acl process for Geoip processing
>>
>> i have tried to setup squid to send the remote peer address using %<a 
>> code but it always reply with a "-"
>>
>> external_acl_type MyGeopip ttl=3600 negative_ttl=3600 
>> children-startup=2 children-idle=2 children-max=20 concurrency=1 ipv4 
>> %un %SRC %SRCEUI48 %>ha{X-Forwarded-For} %DST %ssl::>sni 
>> %USER_CERT_CN %note %<a /lib/squid3/squid-geoip
>>
>> acl MyGeopip_acl external MyGeopip
>> http_access deny !MyGeopip_acl
>>
>> I was thinking that Squid call the helper before resolving the remote 
>> route.
>>
>
> The problem is there is no server/peer connection at all for a 
> transaction that has only been received and not yet processed by Squid.
>
>
>> So to force it, i have added a "fake" acl to force Squid to calculate 
>> the remote address.
>>
>> acl fake_dst dst 127.0.0.2
>> http_access deny !fake_dst !MyGeopip_acl
>>
>> But it failed too, the external_acl still receive the "-" instead of 
>> the remote public IP address of the server
>>
>
> Aye. There is still no server.
>
> All this dst ACL changed was that Squid knows a group of IPs it 
> *might* select from. The decision whether to use one of them (or 
> somewhere entirely different) has not yet been made, so there is still 
> no server.
>
> The "%<a" displays the "last server or peer connection". It can change 
> when automated retries are done, and is "-" at all points before any 
> server contact.
>
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210916/07a98d70/attachment.htm>

From belle at bazuin.nl  Thu Sep 16 15:06:00 2021
From: belle at bazuin.nl (=?windows-1252?Q?L.P.H._van_Belle?=)
Date: Thu, 16 Sep 2021 17:06:00 +0200
Subject: [squid-users] Compile/Rebuilding on debian bullseye (or buster)
In-Reply-To: <vmime.6142e95d.256a.e53738b8c6aaad@ms249-lin-003.rotterdam.bazuin.nl>
References: <149542ad-a232-3404-6c3c-93625d34791a@treenet.co.nz>
Message-ID: <vmime.61435d58.7fd6.4efd7d68643436d8@ms249-lin-003.rotterdam.bazuin.nl>

Good Afernoon Amos, (and others offcourse), 

A small update on this. 
Short version, i can make bullseye package ready for production but not for buster (yet).

Long version.. 

If i pull in the debian salsa git, the build fails on bullseye. 
( thats more me, because i lack knowledge on git use ). 
So i took the "debian" folder from git and add it to the 
extracted 5.1 source from 4 aug. (squid-5.1-20210804-r1f9e52827) 
Then i can build the packages for debian bullseye. 

Lintian shows some messages but no show stoppers. 

Currently the salsa debian/changelog contains, 5.1-2 but since its not release yet, 
I'll change this to 0.1 in my package builds, but i think, when you update it into debian
You should have 5.1-1 (for unstable).

Now i try to build again buster.. And these keep failing on this part. ( see below ). 
What i dont get is, why are there below in the output "suddenly" files misses, thats one i dont get. 
I think is build standards or debhelper where this is coming from, i dont know (yet).. 

The only changes i made where these. :
  * Build from upstream release : squid-5.1-20210804-r1f9e52827
  * d/watch, changed http to https
  * d/control, changed build depend : debhelper 12.8 to 13
  * d/patches, added fix-typos.patch #(typos found by lintian)
  * changed versioning in d/changelog 5.1-2 back to 5.1-1

Note, debhelper the bullseye build worked, only we need 13 and up, 
i did lower it to 12 to allow building for buster. 

# fix-typos.patch included in this mail.

I'll revert the debhelper compat back to 13 and will do 
a new buster build attempt with debhelper 13 from buster-backports

(error part on buster, maybe someone can use it) 
make[1]: Entering directory '/<<PKGBUILDDIR>>'
dh_install -psquid -psquid-common -psquidclient -psquid-cgi -psquid-purge \
        --sourcedir=/<<PKGBUILDDIR>>/debian/tmp
dh_install: Cannot find (any matches for) "etc/squid/conf.d" (tried in /<<PKGBUILDDIR>>/debian/tmp, debian/tmp)

dh_install: squid missing files: etc/squid/conf.d
dh_install: Cannot find (any matches for) "etc/logrotate.d" (tried in /<<PKGBUILDDIR>>/debian/tmp, debian/tmp)

dh_install: squid missing files: etc/logrotate.d
dh_install: Cannot find (any matches for) "etc/resolvconf" (tried in /<<PKGBUILDDIR>>/debian/tmp, debian/tmp)

dh_install: squid missing files: etc/resolvconf
dh_install: Cannot find (any matches for) "etc/ufw" (tried in /<<PKGBUILDDIR>>/debian/tmp, debian/tmp)

dh_install: squid missing files: etc/ufw
dh_install: Cannot find (any matches for) "etc/apparmor.d/disable" (tried in /<<PKGBUILDDIR>>/debian/tmp, debian/tmp)

dh_install: squid missing files: etc/apparmor.d/disable
dh_install: Cannot find (any matches for) "etc/apparmor.d/force-complain" (tried in /<<PKGBUILDDIR>>/debian/tmp, debian/tmp)

dh_install: squid missing files: etc/apparmor.d/force-complain
dh_install: Cannot find (any matches for) "etc/apparmor.d/usr.sbin.squid" (tried in /<<PKGBUILDDIR>>/debian/tmp, debian/tmp)

dh_install: squid missing files: etc/apparmor.d/usr.sbin.squid
dh_install: Cannot find (any matches for) "usr/lib/cgi-bin/cachemgr.cgi" (tried in /<<PKGBUILDDIR>>/debian/tmp, debian/tmp)

dh_install: squid-cgi missing files: usr/lib/cgi-bin/cachemgr.cgi
dh_install: Cannot find (any matches for) "usr/bin/squid-purge" (tried in /<<PKGBUILDDIR>>/debian/tmp, debian/tmp)

dh_install: squid-purge missing files: usr/bin/squid-purge
dh_install: Cannot find (any matches for) "usr/share/man/man1/squid-purge.1" (tried in /<<PKGBUILDDIR>>/debian/tmp, debian/tmp)

dh_install: squid-purge missing files: usr/share/man/man1/squid-purge.1
dh_install: missing files, aborting
make[1]: *** [debian/rules:154: override_dh_install] Error 25
make[1]: Leaving directory '/<<PKGBUILDDIR>>'
make: *** [debian/rules:70: binary] Error 2
dpkg-buildpackage: error: fakeroot debian/rules binary subprocess returned exit status 2



So far,

Greetz, 

Louis

> -----Oorspronkelijk bericht-----
> Van: squid-users 
> [mailto:squid-users-bounces at lists.squid-cache.org] Namens 
> L.P.H. van Belle
> Verzonden: donderdag 16 september 2021 8:51
> Aan: squid-users at lists.squid-cache.org
> Onderwerp: Re: [squid-users] Compile/Rebuilding on debian 
> bullseye (or buster)
> 
> Good Morning. 
> 
> 
> > > 
> > 
> > I have spent a while working on it today and have pushed an 
> update to 
> > Debian packaging repo. Please pull a new copy of that latest. 
> > It should  fix all the issues you have.
> 
> Wow, Thank you very very much Amos.. 
> Im on it now :-) ??
> 
> I'll post the results later today.
> 
> Greetz, 
> Louis
> 
> 
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: fix-typos.patch
Type: application/octet-stream
Size: 5811 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210916/b5a0d339/attachment.obj>

From meike.stone at googlemail.com  Thu Sep 16 15:57:50 2021
From: meike.stone at googlemail.com (Meike Stone)
Date: Thu, 16 Sep 2021 17:57:50 +0200
Subject: [squid-users] SOLVED - compiling squid 5.1
In-Reply-To: <eefb94ed-c06f-b18a-64b5-09fa8e512ce6@treenet.co.nz>
References: <CAFNHiA_YSVSMeSZoxcUNX93WwG-Je9K73KqYJmyaRpEVpgFnyA@mail.gmail.com>
 <CAFNHiA-9Ke+QW5UsRAUM=PXysGrcaq=_7C_+GdtYaM8wbfWKNA@mail.gmail.com>
 <eeef31e4-5528-fd92-411a-7ece02b45096@treenet.co.nz>
 <CAFNHiA8wg-+u7kFyOpwYJnO0NMwTZULr=Vpi8zCGvVdeetv-Kw@mail.gmail.com>
 <eefb94ed-c06f-b18a-64b5-09fa8e512ce6@treenet.co.nz>
Message-ID: <CAFNHiA8GqZDGz6WwECXRfjQrHSKxxKPnO8Om-c9dfMyp-2CWkg@mail.gmail.com>

Am Do., 16. Sept. 2021 um 16:15 Uhr schrieb Amos Jeffries
<squid3 at treenet.co.nz>:
>
> On 17/09/21 1:38 am, Meike Stone wrote:
> > Hello Amos,
> >
> > thanks for answering!
> >
> > Am Mi., 8. Sept. 2021 um 11:26 Uhr schrieb Amos Jeffries:
> >>
> >> This hack only works if you are building manually from source code, in
> >> the same directory you expanded the sources. Which is not he case for
> >> anyone building with automated tools or CI systems.
> >
> > that's the problem I'm facing right now :-O
> >
> >> The earlier provided ./configure parameter change works just as well
> >> without manual changes to the source code.
> >
> > Can you please guide me with this configure parameter?
> >
>
> The problem is use of --disable-dependency-tracking

I use this option already.
I started from a clean untared directory from squid 5.1.
Here my configure options:
./configure --host=x86_64-suse-linux-gnu --build=x86_64-suse-linux-gnu \
         --program-prefix= \
         --disable-dependency-tracking \
         --prefix=/usr \
         --exec-prefix=/usr \
         --bindir=/usr/bin \
         --sbindir=/usr/sbin \
         --sysconfdir=/etc \
         --datadir=/usr/share \
         --includedir=/usr/include \
         --libdir=/usr/lib64 \
         --libexecdir=/usr/lib \
         --localstatedir=/var \
         --sharedstatedir=/var/lib \
         --mandir=/usr/share/man \
         --infodir=/usr/share/info \
         --disable-strict-error-checking \
         --sysconfdir=/etc/squid \
         --libexecdir=/usr/sbin \
         --datadir=/usr/share/squid \
         --sharedstatedir=/var/squid \
         --with-logdir=/var/log/squid \
         --with-pidfile=/run/squid.pid \
         --with-dl \
         --enable-disk-io \
         --enable-storeio \
         --enable-removal-policies=heap,lru \
         --enable-icmp \
         --enable-delay-pools \
         --enable-esi \
         --enable-icap-client \
         --enable-useragent-log \
         --enable-referer-log \
         --enable-kill-parent-hack \
         --enable-arp-acl \
         --enable-ssl-crtd \
         --with-openssl \
         --enable-forw-via-db \
         --enable-cache-digests \
         --enable-linux-netfilter \
         --with-large-files \
         --enable-underscores \
         --enable-auth \
         --enable-auth-basic="SMB_LM,DB,fake,getpwnam,LDAP,NCSA,NIS,PAM,POP3,RADIUS,SASL,SMB"
\
         --enable-auth-ntlm="SMB_LM,fake" \
         --enable-auth-negotiate \
         --enable-auth-digest \
         --enable-external-acl-helpers=LDAP_group,eDirectory_userip,file_userip,kerberos_ldap_group,session,unix_group,wbinfo_group
\
         --enable-stacktraces \
         --enable-x-accelerator-vary \
         --with-default-user=squid \
         --disable-ident-lookups \
         --enable-follow-x-forwarded-for \
         --disable-arch-native \
         --enable-security-cert-generators \
         --enable-security-cert-validators
with
make -d -O SAMBAPREFIX=/usr -j1
I get:
cp ../../src/SquidConfig.cc SquidConfig.cc
Putting child 0x55d56bed8400 (SquidConfig.cc) PID 28219 on the chain.
Live child 0x55d56bed8400 (SquidConfig.cc) PID 28219
Reaping winning child 0x55d56bed8400 PID 28219
Removing child 0x55d56bed8400 PID 28219 from chain.
         Successfully remade target file 'SquidConfig.cc'.
        Finished prerequisites of target file 'SquidConfig.o'.
       Must remake target 'SquidConfig.o'.
g++ -DHAVE_CONFIG_H -DDEFAULT_CONFIG_FILE=\"/etc/squid/squid.conf\"
-DDEFAULT_SQUID_DATA_DIR=\"/usr/share/squid\"
-DDEFAULT_SQUID_CONFIG_DIR=\"/etc/squid\"   -I../.. -I../../include
-I../../lib -I../../src -I../../include    -I/usr/include/libxml2 -Wall
-Wpointer-arith -Wwrite-strings -Wcomments -Wshadow -Woverloaded-virtual
-pipe -D_REENTRANT -I/usr/include/libxml2 -m64 -DOPENSSL_LOAD_CONF -g
-O2 -c -o SquidConfig.o SquidConfig.cc
Putting child 0x55d56bed8400 (SquidConfig.o) PID 28220 on the chain.
Live child 0x55d56bed8400 (SquidConfig.o) PID 28220
Reaping winning child 0x55d56bed8400 PID 28220
Removing child 0x55d56bed8400 PID 28220 from chain.
       Successfully remade target file 'SquidConfig.o'.
       Considering target file 'tests/stub_fd.o'.
        File 'tests/stub_fd.o' does not exist.
        Looking for an implicit rule for 'tests/stub_fd.o'.
        Trying pattern rule with stem 'stub_fd'.
        Trying implicit prerequisite 'tests/stub_fd.cc'.
        Found an implicit rule for 'tests/stub_fd.o'.
         Considering target file 'tests/stub_fd.cc'.
          File 'tests/stub_fd.cc' does not exist.
           Considering target file '../../src/tests/stub_fd.cc'.
            Looking for an implicit rule for '../../src/tests/stub_fd.cc'.
            Trying pattern rule with stem 'stub_fd.cc'.
            Trying implicit prerequisite '../../src/tests/stub_fd.cc,v'.
            Trying pattern rule with stem 'stub_fd.cc'.
            Trying implicit prerequisite '../../src/tests/RCS/stub_fd.cc,v'.
            Trying pattern rule with stem 'stub_fd.cc'.
            Trying implicit prerequisite '../../src/tests/RCS/stub_fd.cc'.
            Trying pattern rule with stem 'stub_fd.cc'.
            Trying implicit prerequisite '../../src/tests/s.stub_fd.cc'.
            Trying pattern rule with stem 'stub_fd.cc'.
            Trying implicit prerequisite
'../../src/tests/SCCS/s.stub_fd.cc'.
            No implicit rule found for '../../src/tests/stub_fd.cc'.
            Finished prerequisites of target file
'../../src/tests/stub_fd.cc'.
           No need to remake target '../../src/tests/stub_fd.cc'.
          Finished prerequisites of target file 'tests/stub_fd.cc'.
         Must remake target 'tests/stub_fd.cc'.
cp ../../src/tests/stub_fd.cc tests/stub_fd.cc
Putting child 0x55d56bedaf20 (tests/stub_fd.cc) PID 28223 on the chain.
Live child 0x55d56bedaf20 (tests/stub_fd.cc) PID 28223
cp: cannot create regular file 'tests/stub_fd.cc': No such file or directory
Reaping losing child 0x55d56bedaf20 PID 28223
make[3]: *** [Makefile:1446: tests/stub_fd.cc] Error 1
Removing child 0x55d56bedaf20 PID 28223 from chain.
make[3]: Leaving directory '/root/squid-5.1/src/icmp'
Reaping losing child 0x562fd125dd40 PID 3751
make[2]: *** [Makefile:6866: all-recursive] Error 1
Removing child 0x562fd125dd40 PID 3751 from chain.
make[2]: Leaving directory '/root/squid-5.1/src'
Reaping losing child 0x5615187d9070 PID 3750
make[1]: *** [Makefile:5855: all] Error 2
Removing child 0x5615187d9070 PID 3750 from chain.
make[1]: Leaving directory '/root/squid-5.1/src'
Reaping losing child 0x5644cbb08770 PID 31009
make: *** [Makefile:593: all-recursive] Error 1
Removing child 0x5644cbb08770 PID 31009 from chain.

Do you see what's wrong?
The goal is, to pack squid in an rpm on SuSEs buildservice, so that
there is a binary package available from squid 5.1 for everyone!

Thanks Meike


From squid3 at treenet.co.nz  Thu Sep 16 17:04:21 2021
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 17 Sep 2021 05:04:21 +1200
Subject: [squid-users] SOLVED - compiling squid 5.1
In-Reply-To: <CAFNHiA8GqZDGz6WwECXRfjQrHSKxxKPnO8Om-c9dfMyp-2CWkg@mail.gmail.com>
References: <CAFNHiA_YSVSMeSZoxcUNX93WwG-Je9K73KqYJmyaRpEVpgFnyA@mail.gmail.com>
 <CAFNHiA-9Ke+QW5UsRAUM=PXysGrcaq=_7C_+GdtYaM8wbfWKNA@mail.gmail.com>
 <eeef31e4-5528-fd92-411a-7ece02b45096@treenet.co.nz>
 <CAFNHiA8wg-+u7kFyOpwYJnO0NMwTZULr=Vpi8zCGvVdeetv-Kw@mail.gmail.com>
 <eefb94ed-c06f-b18a-64b5-09fa8e512ce6@treenet.co.nz>
 <CAFNHiA8GqZDGz6WwECXRfjQrHSKxxKPnO8Om-c9dfMyp-2CWkg@mail.gmail.com>
Message-ID: <869ac56a-b9bb-b467-b660-44278cb1ffaa@treenet.co.nz>

Interesting.

Okay, I'm currently using this patch for Debian to avoid having to 
depend on make at all. Seems like I'm going to have to bring it upstream 
for the 5.2 release.
<https://salsa.debian.org/squid-team/squid/-/raw/master/debian/patches/0004-Change-default-Makefiles-for-debian.patch?inline=false>


Amos


From squid3 at treenet.co.nz  Thu Sep 16 17:13:20 2021
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 17 Sep 2021 05:13:20 +1200
Subject: [squid-users] squid 5.1: external_acl_type: Get public remote
 address
In-Reply-To: <74ab3103-3a8d-7135-4aec-7ce5d228bee9@articatech.com>
References: <12964961-64bd-4536-6e96-50c5fc1b48eb@articatech.com>
 <6803dd48-0513-61fa-9088-713244c27ea0@treenet.co.nz>
 <74ab3103-3a8d-7135-4aec-7ce5d228bee9@articatech.com>
Message-ID: <deff363e-398f-bb7d-0211-fd762c6f8b4b@treenet.co.nz>

On 17/09/21 2:42 am, David Touzeau wrote:
> Thanks Amos for quick answer.
> 
> Can you take away any hope of a workaround with Squid ?
> 
> This makes me plan having to develop a function that has to perform DNS 
> resolution inside the helper with the performance consequences that this 
> will impose.
> 

I would be looking at a design where a helper classifies requests and 
using that later on when the server is known to match up the IP vs the 
classification. I'm struggling to think of a flow that works efficiently 
though.

Amos


From david at articatech.com  Thu Sep 16 17:30:41 2021
From: david at articatech.com (David Touzeau)
Date: Thu, 16 Sep 2021 19:30:41 +0200
Subject: [squid-users] squid 5.1: external_acl_type: Get public remote
 address
In-Reply-To: <deff363e-398f-bb7d-0211-fd762c6f8b4b@treenet.co.nz>
References: <12964961-64bd-4536-6e96-50c5fc1b48eb@articatech.com>
 <6803dd48-0513-61fa-9088-713244c27ea0@treenet.co.nz>
 <74ab3103-3a8d-7135-4aec-7ce5d228bee9@articatech.com>
 <deff363e-398f-bb7d-0211-fd762c6f8b4b@treenet.co.nz>
Message-ID: <095550e4-012d-b021-f57f-9894f898aa90@articatech.com>

Amos,

Thank you for your response and kindness,
I'm turning to create a DNS resolution dev and I'm giving up looking 
retreive this information through Squid.

Le 16/09/2021 ? 19:13, Amos Jeffries a ?crit?:
> On 17/09/21 2:42 am, David Touzeau wrote:
>> Thanks Amos for quick answer.
>>
>> Can you take away any hope of a workaround with Squid ?
>>
>> This makes me plan having to develop a function that has to perform 
>> DNS resolution inside the helper with the performance consequences 
>> that this will impose.
>>
>
> I would be looking at a design where a helper classifies requests and 
> using that later on when the server is known to match up the IP vs the 
> classification. I'm struggling to think of a flow that works 
> efficiently though.
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210916/9f826af5/attachment.htm>

From rousskov at measurement-factory.com  Thu Sep 16 17:43:05 2021
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Thu, 16 Sep 2021 13:43:05 -0400
Subject: [squid-users] squid 5.1: external_acl_type: Get public remote
 address
In-Reply-To: <095550e4-012d-b021-f57f-9894f898aa90@articatech.com>
References: <12964961-64bd-4536-6e96-50c5fc1b48eb@articatech.com>
 <6803dd48-0513-61fa-9088-713244c27ea0@treenet.co.nz>
 <74ab3103-3a8d-7135-4aec-7ce5d228bee9@articatech.com>
 <deff363e-398f-bb7d-0211-fd762c6f8b4b@treenet.co.nz>
 <095550e4-012d-b021-f57f-9894f898aa90@articatech.com>
Message-ID: <a384aa07-11ac-0801-9a5a-4d6addc8a886@measurement-factory.com>

On 9/16/21 1:30 PM, David Touzeau wrote:

> I'm turning to create a DNS resolution dev and I'm giving up looking
> retreive this information through Squid.

Please note that if you do your own DNS resolution, then Squid DNS
resolution results will probably mismatch your results in some cases.
There have been many complaints about associated problems from folks
that went this route...

I am not sure what you are trying to do with that a %<a-based external
ACL in Squid, so it is difficult to narrow down the solution search
scope, but Squid does support slow ACLs in certain directives used when
talking to origin servers or peers (after built-in DNS resolution and
destination selection) so perhaps there is a way to do what you want
without Squid modifications.

If there is not, it would not be difficult to add a post-resolution
directive that supports slow ACLs IMO, but, again, that requires more
knowledge of the use case -- there are several places where such a
directive can be added.


Cheers,

Alex.



> Le 16/09/2021 ? 19:13, Amos Jeffries a ?crit?:
>> On 17/09/21 2:42 am, David Touzeau wrote:
>>> Thanks Amos for quick answer.
>>>
>>> Can you take away any hope of a workaround with Squid ?
>>>
>>> This makes me plan having to develop a function that has to perform
>>> DNS resolution inside the helper with the performance consequences
>>> that this will impose.
>>>
>>
>> I would be looking at a design where a helper classifies requests and
>> using that later on when the server is known to match up the IP vs the
>> classification. I'm struggling to think of a flow that works
>> efficiently though.
>>
>> Amos
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
> 
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 



From david at articatech.com  Thu Sep 16 18:52:38 2021
From: david at articatech.com (David Touzeau)
Date: Thu, 16 Sep 2021 20:52:38 +0200
Subject: [squid-users] squid 5.1: external_acl_type: Get public remote
 address
In-Reply-To: <a384aa07-11ac-0801-9a5a-4d6addc8a886@measurement-factory.com>
References: <12964961-64bd-4536-6e96-50c5fc1b48eb@articatech.com>
 <6803dd48-0513-61fa-9088-713244c27ea0@treenet.co.nz>
 <74ab3103-3a8d-7135-4aec-7ce5d228bee9@articatech.com>
 <deff363e-398f-bb7d-0211-fd762c6f8b4b@treenet.co.nz>
 <095550e4-012d-b021-f57f-9894f898aa90@articatech.com>
 <a384aa07-11ac-0801-9a5a-4d6addc8a886@measurement-factory.com>
Message-ID: <627d47a2-5b08-21ef-0288-2e1338623fbc@articatech.com>

Thanks for the clarification and I agree with you completely.

a multipath and a round-robin DNS method will return different records 
between our DNS calculation and the final squid results

It is true that it would be possible to use an external_acl in the 
http_reply_access.

Do you think that adding it in this position I would be able to use 
squid's resolution results ?


Le 16/09/2021 ? 19:43, Alex Rousskov a ?crit?:
> On 9/16/21 1:30 PM, David Touzeau wrote:
>
>> I'm turning to create a DNS resolution dev and I'm giving up looking
>> retreive this information through Squid.
> Please note that if you do your own DNS resolution, then Squid DNS
> resolution results will probably mismatch your results in some cases.
> There have been many complaints about associated problems from folks
> that went this route...
>
> I am not sure what you are trying to do with that a %<a-based external
> ACL in Squid, so it is difficult to narrow down the solution search
> scope, but Squid does support slow ACLs in certain directives used when
> talking to origin servers or peers (after built-in DNS resolution and
> destination selection) so perhaps there is a way to do what you want
> without Squid modifications.
>
> If there is not, it would not be difficult to add a post-resolution
> directive that supports slow ACLs IMO, but, again, that requires more
> knowledge of the use case -- there are several places where such a
> directive can be added.
>
>
> Cheers,
>
> Alex.
>
>
>
>> Le 16/09/2021 ? 19:13, Amos Jeffries a ?crit?:
>>> On 17/09/21 2:42 am, David Touzeau wrote:
>>>> Thanks Amos for quick answer.
>>>>
>>>> Can you take away any hope of a workaround with Squid ?
>>>>
>>>> This makes me plan having to develop a function that has to perform
>>>> DNS resolution inside the helper with the performance consequences
>>>> that this will impose.
>>>>
>>> I would be looking at a design where a helper classifies requests and
>>> using that later on when the server is known to match up the IP vs the
>>> classification. I'm struggling to think of a flow that works
>>> efficiently though.
>>>
>>> Amos
>>> _______________________________________________
>>> squid-users mailing list
>>> squid-users at lists.squid-cache.org
>>> http://lists.squid-cache.org/listinfo/squid-users
>>
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
>>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210916/301f5f4d/attachment.htm>

From rousskov at measurement-factory.com  Thu Sep 16 19:03:37 2021
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Thu, 16 Sep 2021 15:03:37 -0400
Subject: [squid-users] squid 5.1: external_acl_type: Get public remote
 address
In-Reply-To: <627d47a2-5b08-21ef-0288-2e1338623fbc@articatech.com>
References: <12964961-64bd-4536-6e96-50c5fc1b48eb@articatech.com>
 <6803dd48-0513-61fa-9088-713244c27ea0@treenet.co.nz>
 <74ab3103-3a8d-7135-4aec-7ce5d228bee9@articatech.com>
 <deff363e-398f-bb7d-0211-fd762c6f8b4b@treenet.co.nz>
 <095550e4-012d-b021-f57f-9894f898aa90@articatech.com>
 <a384aa07-11ac-0801-9a5a-4d6addc8a886@measurement-factory.com>
 <627d47a2-5b08-21ef-0288-2e1338623fbc@articatech.com>
Message-ID: <f209f952-ad33-8a4c-21ca-fe6e020b21b8@measurement-factory.com>

On 9/16/21 2:52 PM, David Touzeau wrote:

> It is true that it would be possible to use an external_acl in the
> http_reply_access.
> 
> Do you think that adding it in this position I would be able to use
> squid's resolution results ?

Yes, bugs notwithstanding, an external ACL evaluated at
http_reply_access time should have access to %<a.

HTH,

Alex.


> Le 16/09/2021 ? 19:43, Alex Rousskov a ?crit?:
>> On 9/16/21 1:30 PM, David Touzeau wrote:
>>
>>> I'm turning to create a DNS resolution dev and I'm giving up looking
>>> retreive this information through Squid.
>> Please note that if you do your own DNS resolution, then Squid DNS
>> resolution results will probably mismatch your results in some cases.
>> There have been many complaints about associated problems from folks
>> that went this route...
>>
>> I am not sure what you are trying to do with that a %<a-based external
>> ACL in Squid, so it is difficult to narrow down the solution search
>> scope, but Squid does support slow ACLs in certain directives used when
>> talking to origin servers or peers (after built-in DNS resolution and
>> destination selection) so perhaps there is a way to do what you want
>> without Squid modifications.
>>
>> If there is not, it would not be difficult to add a post-resolution
>> directive that supports slow ACLs IMO, but, again, that requires more
>> knowledge of the use case -- there are several places where such a
>> directive can be added.
>>
>>
>> Cheers,
>>
>> Alex.
>>
>>
>>
>>> Le 16/09/2021 ? 19:13, Amos Jeffries a ?crit?:
>>>> On 17/09/21 2:42 am, David Touzeau wrote:
>>>>> Thanks Amos for quick answer.
>>>>>
>>>>> Can you take away any hope of a workaround with Squid ?
>>>>>
>>>>> This makes me plan having to develop a function that has to perform
>>>>> DNS resolution inside the helper with the performance consequences
>>>>> that this will impose.
>>>>>
>>>> I would be looking at a design where a helper classifies requests and
>>>> using that later on when the server is known to match up the IP vs the
>>>> classification. I'm struggling to think of a flow that works
>>>> efficiently though.
>>>>
>>>> Amos
>>>> _______________________________________________
>>>> squid-users mailing list
>>>> squid-users at lists.squid-cache.org
>>>> http://lists.squid-cache.org/listinfo/squid-users
>>> _______________________________________________
>>> squid-users mailing list
>>> squid-users at lists.squid-cache.org
>>> http://lists.squid-cache.org/listinfo/squid-users
>>>
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
> 



From david at articatech.com  Thu Sep 16 19:53:39 2021
From: david at articatech.com (David Touzeau)
Date: Thu, 16 Sep 2021 21:53:39 +0200
Subject: [squid-users] squid 5.1: external_acl_type: Get public remote
 address
In-Reply-To: <f209f952-ad33-8a4c-21ca-fe6e020b21b8@measurement-factory.com>
References: <12964961-64bd-4536-6e96-50c5fc1b48eb@articatech.com>
 <6803dd48-0513-61fa-9088-713244c27ea0@treenet.co.nz>
 <74ab3103-3a8d-7135-4aec-7ce5d228bee9@articatech.com>
 <deff363e-398f-bb7d-0211-fd762c6f8b4b@treenet.co.nz>
 <095550e4-012d-b021-f57f-9894f898aa90@articatech.com>
 <a384aa07-11ac-0801-9a5a-4d6addc8a886@measurement-factory.com>
 <627d47a2-5b08-21ef-0288-2e1338623fbc@articatech.com>
 <f209f952-ad33-8a4c-21ca-fe6e020b21b8@measurement-factory.com>
Message-ID: <ad0ecac8-a7e5-bfd5-8c97-7a1926d7fd35@articatech.com>

Thanks, i will try in this way

Le 16/09/2021 ? 21:03, Alex Rousskov a ?crit?:
> On 9/16/21 2:52 PM, David Touzeau wrote:
>
>> It is true that it would be possible to use an external_acl in the
>> http_reply_access.
>>
>> Do you think that adding it in this position I would be able to use
>> squid's resolution results ?
> Yes, bugs notwithstanding, an external ACL evaluated at
> http_reply_access time should have access to %<a.
>
> HTH,
>
> Alex.
>
>
>> Le 16/09/2021 ? 19:43, Alex Rousskov a ?crit?:
>>> On 9/16/21 1:30 PM, David Touzeau wrote:
>>>
>>>> I'm turning to create a DNS resolution dev and I'm giving up looking
>>>> retreive this information through Squid.
>>> Please note that if you do your own DNS resolution, then Squid DNS
>>> resolution results will probably mismatch your results in some cases.
>>> There have been many complaints about associated problems from folks
>>> that went this route...
>>>
>>> I am not sure what you are trying to do with that a %<a-based external
>>> ACL in Squid, so it is difficult to narrow down the solution search
>>> scope, but Squid does support slow ACLs in certain directives used when
>>> talking to origin servers or peers (after built-in DNS resolution and
>>> destination selection) so perhaps there is a way to do what you want
>>> without Squid modifications.
>>>
>>> If there is not, it would not be difficult to add a post-resolution
>>> directive that supports slow ACLs IMO, but, again, that requires more
>>> knowledge of the use case -- there are several places where such a
>>> directive can be added.
>>>
>>>
>>> Cheers,
>>>
>>> Alex.
>>>
>>>
>>>
>>>> Le 16/09/2021 ? 19:13, Amos Jeffries a ?crit?:
>>>>> On 17/09/21 2:42 am, David Touzeau wrote:
>>>>>> Thanks Amos for quick answer.
>>>>>>
>>>>>> Can you take away any hope of a workaround with Squid ?
>>>>>>
>>>>>> This makes me plan having to develop a function that has to perform
>>>>>> DNS resolution inside the helper with the performance consequences
>>>>>> that this will impose.
>>>>>>
>>>>> I would be looking at a design where a helper classifies requests and
>>>>> using that later on when the server is known to match up the IP vs the
>>>>> classification. I'm struggling to think of a flow that works
>>>>> efficiently though.
>>>>>
>>>>> Amos
>>>>> _______________________________________________
>>>>> squid-users mailing list
>>>>> squid-users at lists.squid-cache.org
>>>>> http://lists.squid-cache.org/listinfo/squid-users
>>>> _______________________________________________
>>>> squid-users mailing list
>>>> squid-users at lists.squid-cache.org
>>>> http://lists.squid-cache.org/listinfo/squid-users
>>>>
>>> _______________________________________________
>>> squid-users mailing list
>>> squid-users at lists.squid-cache.org
>>> http://lists.squid-cache.org/listinfo/squid-users

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210916/823c06e4/attachment.htm>

From philipp.gesang at intra2net.com  Fri Sep 17 11:51:43 2021
From: philipp.gesang at intra2net.com (Philipp Gesang)
Date: Fri, 17 Sep 2021 13:51:43 +0200
Subject: [squid-users] 5.1 in the Git repo
Message-ID: <YUSBTztgGo8tZ9yW@drift.m.i2n>

Dear Squid devs,

thanks for all the work you did to make 5.1 happen!

I?m working with the official repo linked on this wiki page:
https://wiki.squid-cache.org/DeveloperResources to update our
system to Squid 5.1. However, there doesn?t seem to be a tag
corresponding to that release, the latest one being SQUID_5_0_4.

Could you please clarify what commit the release tarball is based
off and/or push the missing tag?

Thank you,
Philipp
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 833 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210917/526e2c0b/attachment.sig>

From moberger at metanetworks.com  Fri Sep 17 14:35:24 2021
From: moberger at metanetworks.com (Moti Berger)
Date: Fri, 17 Sep 2021 17:35:24 +0300
Subject: [squid-users] logformat odd values
In-Reply-To: <1db857b3-123e-a38a-347f-d4369b300eed@measurement-factory.com>
References: <CAGSk-41or=cMZg+VFr82D15UTaiE_SRSt=n2NOVMitz0LMEMmA@mail.gmail.com>
 <1db857b3-123e-a38a-347f-d4369b300eed@measurement-factory.com>
Message-ID: <CAGSk-43XSk6gU3dGTExuxOvd63VKSU=fzjCpJxX4_rMZeJERxA@mail.gmail.com>

Hi

It's possible that in some cases they will run concurrently, however not in
my setup. The ICAPs are chained. If the chain doesn't guarantee it please
let me know since I rely on it.

Regarding what you said about things that can happen in parallel, I'm OK
with it since what I care the most is the extra time my ICAPs add to the
user latency and this is what I would like to measure.

Thanks

On Wed, Sep 15, 2021, 20:47 Alex Rousskov <rousskov at measurement-factory.com>
wrote:

> On 9/14/21 3:04 PM, Moti Berger wrote:
>
> > I have the followings in squid.conf:
> >
> >     logformat metrics %icap::tt %adapt::all_trs %adapt::sum_trs
> >     %{service_req_a}adapt::sum_trs %{service_resp_a}adapt::sum_trs
> >     %{service_req_b}adapt::sum_trs %{service_resp_b}adapt::sum_trs
> >     access_log daemon:/var/log/squid/metrics.log metrics
> >
> >
> >
> >     icap_service service_req_a reqmod_precache bypass=1 on-overload=wait
> >     routing=1 icap://a.y:12345/request
> >     icap_service service_req_b reqmod_precache bypass=1 on-overload=wait
> >     icap://b.y:10101/request
> >     adaptation_service_chain svcRequest service_req_a service_req_b
> >     adaptation_access svcRequest deny manager
> >     adaptation_access svcRequest allow all
> >     icap_service service_resp_a respmod_precache bypass=1
> >     on-overload=wait routing=1 icap://a.y:12345/response
> >     icap_service service_resp_b respmod_precache bypass=1
> >     on-overload=wait icap://b.y:10101/response
> >     adaptation_service_chain svcResponse service_resp_a service_resp_b
> >     adaptation_access svcResponse deny manager
> >     adaptation_access svcResponse allow all
> >
> >
> >  I see in metrics.log lines like this:
> >
> >     4 4,180 4,180 4 180 - -
> >
> >
> > Now I wonder how come the value of %icap:tt isn't at least as the sum of
> > all the numbers appear on %adapt::all_trs or %adapt::sum_trs (assuming
> > no failed transactions)?
>
> There is probably a bug somewhere, but please note that %icap:tt may not
> be the sum of individual transaction response times (in _some_ cases)
> even after that bug is fixed because those individual transactions may
> run _concurrently_ (i.e. partially overlap in time).
>
>
> > If %icap:tt isn't at least the sum of all ICAPs processing time, what is?
>
> Bugs notwithstanding, it is approximate time a master transaction spent
> doing adaptation (including checking whether adaptation is necessary).
> This stopwatch ticks when adaptation_access ACLs are checked and also
> when at least one adaptation transaction associated with that master
> transaction is in progress.
>
> Please note that a master transaction can do a lot of different things
> at once or in parallel. For example, it can communicate with an HTTP
> client while communicating with an FTP server while communicating with
> an eCAP REQMOD adaptation service while communicating with a DNS server
> to decide whether to start communicating with an ICAP RESPMOD service.
>
>
> HTH,
>
> Alex.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210917/ec91367e/attachment.htm>

From rousskov at measurement-factory.com  Fri Sep 17 14:56:21 2021
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Fri, 17 Sep 2021 10:56:21 -0400
Subject: [squid-users] logformat odd values
In-Reply-To: <CAGSk-43XSk6gU3dGTExuxOvd63VKSU=fzjCpJxX4_rMZeJERxA@mail.gmail.com>
References: <CAGSk-41or=cMZg+VFr82D15UTaiE_SRSt=n2NOVMitz0LMEMmA@mail.gmail.com>
 <1db857b3-123e-a38a-347f-d4369b300eed@measurement-factory.com>
 <CAGSk-43XSk6gU3dGTExuxOvd63VKSU=fzjCpJxX4_rMZeJERxA@mail.gmail.com>
Message-ID: <d85a66e2-6b00-43e2-0f61-d1f75853df29@measurement-factory.com>

On 9/17/21 10:35 AM, Moti Berger wrote:

> It's possible that in some cases they will run concurrently, however not
> in my setup. The ICAPs are chained. If the chain doesn't guarantee it
> please let me know since I rely on it.

Chaining adaptation services guarantees that they will _start_
sequentially, but does not guarantee that they will _run_ sequentially.
That guarantee can only come from the services themselves.

For example, imagine two chained REQMOD services handling a 1GB HTTP PUT
request. If the first service emits the adapted request headers (at
least), then Squid will start the second service and will send those
adapted request headers (and any adapted request body trickled after the
headers) to that second service. The two services, in that case, will
run concurrently.


> Regarding what you said about things that can happen in parallel, I'm OK
> with it since what I care the most is the extra time my ICAPs add to the
> user latency and this is what I would like to measure.

The desire to measure ICAP overheads is common and natural.
Unfortunately, bugs notwithstanding, %icap::tt measures the latency
added exclusively by adaptation if and only if the corresponding
adaptation transaction is tiny (e.g., one I/O to receive the entire
adapted HTTP message from the adaptation service). In most real world
scenarios involving larger HTTP messages, adaptation services will run
in parallel with Squid reading/writing from the HTTP client and/or
server because Squid uses adapted bytes as soon as it can.


HTH,

Alex.

> On Wed, Sep 15, 2021, 20:47 Alex Rousskov wrote:
> 
>     On 9/14/21 3:04 PM, Moti Berger wrote:
> 
>     > I have the followings in squid.conf:
>     >
>     >? ? ?logformat metrics %icap::tt %adapt::all_trs %adapt::sum_trs
>     >? ? ?%{service_req_a}adapt::sum_trs %{service_resp_a}adapt::sum_trs
>     >? ? ?%{service_req_b}adapt::sum_trs %{service_resp_b}adapt::sum_trs
>     >? ? ?access_log daemon:/var/log/squid/metrics.log metrics
>     >
>     > ?
>     >
>     >? ? ?icap_service service_req_a reqmod_precache bypass=1
>     on-overload=wait
>     >? ? ?routing=1 icap://a.y:12345/request
>     >? ? ?icap_service service_req_b reqmod_precache bypass=1
>     on-overload=wait
>     >? ? ?icap://b.y:10101/request
>     >? ? ?adaptation_service_chain svcRequest service_req_a?service_req_b
>     >? ? ?adaptation_access svcRequest deny manager
>     >? ? ?adaptation_access svcRequest allow all
>     >? ? ?icap_service service_resp_a respmod_precache bypass=1
>     >? ? ?on-overload=wait routing=1 icap://a.y:12345/response
>     >? ? ?icap_service service_resp_b respmod_precache bypass=1
>     >? ? ?on-overload=wait icap://b.y:10101/response
>     >? ? ?adaptation_service_chain svcResponse service_resp_a?service_resp_b
>     >? ? ?adaptation_access svcResponse deny manager
>     >? ? ?adaptation_access svcResponse allow all
>     >
>     >
>     > ?I see in metrics.log lines like this:
>     >
>     >? ? ?4 4,180 4,180 4 180 - -
>     >
>     >
>     > Now I wonder how come the value of %icap:tt isn't at least as the
>     sum of
>     > all the numbers appear on %adapt::all_trs or %adapt::sum_trs (assuming
>     > no failed transactions)?
> 
>     There is probably a bug somewhere, but please note that %icap:tt may not
>     be the sum of individual transaction response times (in _some_ cases)
>     even after that bug is fixed because those individual transactions may
>     run _concurrently_ (i.e. partially overlap in time).
> 
> 
>     > If %icap:tt isn't at least the sum of all ICAPs processing time,
>     what is?
> 
>     Bugs notwithstanding, it is approximate time a master transaction spent
>     doing adaptation (including checking whether adaptation is necessary).
>     This stopwatch ticks when adaptation_access ACLs are checked and also
>     when at least one adaptation transaction associated with that master
>     transaction is in progress.
> 
>     Please note that a master transaction can do a lot of different things
>     at once or in parallel. For example, it can communicate with an HTTP
>     client while communicating with an FTP server while communicating with
>     an eCAP REQMOD adaptation service while communicating with a DNS server
>     to decide whether to start communicating with an ICAP RESPMOD service.
> 
> 
>     HTH,
> 
>     Alex.
>     _______________________________________________
>     squid-users mailing list
>     squid-users at lists.squid-cache.org
>     <mailto:squid-users at lists.squid-cache.org>
>     http://lists.squid-cache.org/listinfo/squid-users
>     <http://lists.squid-cache.org/listinfo/squid-users>
> 



From andreas.weigel at securepoint.de  Fri Sep 17 19:29:35 2021
From: andreas.weigel at securepoint.de (Andreas Weigel)
Date: Fri, 17 Sep 2021 19:29:35 +0000
Subject: [squid-users] hostHeaderVerify with SNI in interception environments
Message-ID: <20210917192935.Horde.dWRzn4H6HtDwrLGUJhkedqZ@webmail.intern.securepoint.de>

Hi,

I noticed that squid behaves differently with regard to checking the  
SNI of a (fake-)Connect request depending on the sslbump step a  
"splice" is performed. This is more or less a follow-up on " Squid  
spliced TLS handshake failing with chrome/ium fallback for certain  
servers".

If splicing at step2, hostHeaderVerify will be called twice, once with  
the initial TCP-only CONNECT and then again at step2, with SNI  
information from the TLS handshake's ClientHello. In certain  
unfortunate environments with DNS-resolvers configured differently  
between squid and its clients, this can lead to false positive  
"SECURITY ALERT: Host header forgery detected on..." and subsequential  
connection termination; this is also explained at  
https://wiki.squid-cache.org/KnowledgeBase/HostHeaderForgery

If splicing at step3, however, hostHeaderVerify is not called again  
with the SNI, as the Connection is handled differently then (passed to  
FwdState and PeekingPeerConnector, as far as I can follow).

I was wondering if this could be considered a bug or if there is a  
rationale to change the behavior in the "peek at step2, splice at  
step3" scenario.

Kind regards,
Andreas



From rousskov at measurement-factory.com  Fri Sep 17 20:14:51 2021
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Fri, 17 Sep 2021 16:14:51 -0400
Subject: [squid-users] hostHeaderVerify with SNI in interception
 environments
In-Reply-To: <20210917192935.Horde.dWRzn4H6HtDwrLGUJhkedqZ@webmail.intern.securepoint.de>
References: <20210917192935.Horde.dWRzn4H6HtDwrLGUJhkedqZ@webmail.intern.securepoint.de>
Message-ID: <46207bc8-a7d2-1730-38a6-2a1ffede80f3@measurement-factory.com>

On 9/17/21 3:29 PM, Andreas Weigel wrote:

> If splicing at step3, however, hostHeaderVerify is not called again with
> the SNI

I assume that the above statement would still be true if I remove the
word "again" from it. This is how I interpreted it (i.e.
hostHeaderVerify() is called once with the IP address and never with SNI).

There are other ways to interpret that statement (e.g., hostHeaderVerify
was called with SNI once, but you expected it to be called with SNI twice).


> I was wondering if this could be considered a bug or if there is a
> rationale to change the behavior in the "peek at step2, splice at step3"
> scenario.

If my interpretation above is correct, then this sounds like a bug to
me: Squid/hostHeaderVerify() must validate every request target value
Squid intends to use for cache lookups and/or connecting. If the request
target changes from IP to SNI, then Squid must validate exactly twice.


HTH,

Alex.


From squid3 at treenet.co.nz  Fri Sep 17 23:10:27 2021
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 18 Sep 2021 11:10:27 +1200
Subject: [squid-users] hostHeaderVerify with SNI in interception
 environments
In-Reply-To: <46207bc8-a7d2-1730-38a6-2a1ffede80f3@measurement-factory.com>
References: <20210917192935.Horde.dWRzn4H6HtDwrLGUJhkedqZ@webmail.intern.securepoint.de>
 <46207bc8-a7d2-1730-38a6-2a1ffede80f3@measurement-factory.com>
Message-ID: <d695fd89-26bf-3831-ac95-4e837b1c99b6@treenet.co.nz>

On 18/09/21 8:14 am, Alex Rousskov wrote:
> On 9/17/21 3:29 PM, Andreas Weigel wrote:
> 
>> If splicing at step3, however, hostHeaderVerify is not called again with
>> the SNI
> 
> I assume that the above statement would still be true if I remove the
> word "again" from it. This is how I interpreted it (i.e.
> hostHeaderVerify() is called once with the IP address and never with SNI).
> 
> There are other ways to interpret that statement (e.g., hostHeaderVerify
> was called with SNI once, but you expected it to be called with SNI twice).
> 
> 
>> I was wondering if this could be considered a bug or if there is a
>> rationale to change the behavior in the "peek at step2, splice at step3"
>> scenario.
> 
> If my interpretation above is correct, then this sounds like a bug to
> me: Squid/hostHeaderVerify() must validate every request target value
> Squid intends to use for cache lookups and/or connecting. If the request
> target changes from IP to SNI, then Squid must validate exactly twice.
> 

AIUI, SSL-Bump step 3 does not need to verify because a) it uses the 
server connection setup at step 2, and b) the issue(s) checked for only 
apply to mismatch of names provided by clients vs dst-IP.


Amos


From rousskov at measurement-factory.com  Sat Sep 18 14:36:45 2021
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Sat, 18 Sep 2021 10:36:45 -0400
Subject: [squid-users] hostHeaderVerify with SNI in interception
 environments
In-Reply-To: <d695fd89-26bf-3831-ac95-4e837b1c99b6@treenet.co.nz>
References: <20210917192935.Horde.dWRzn4H6HtDwrLGUJhkedqZ@webmail.intern.securepoint.de>
 <46207bc8-a7d2-1730-38a6-2a1ffede80f3@measurement-factory.com>
 <d695fd89-26bf-3831-ac95-4e837b1c99b6@treenet.co.nz>
Message-ID: <887c8727-918a-e674-cd55-d22712ab7a63@measurement-factory.com>

On 9/17/21 7:10 PM, Amos Jeffries wrote:
> On 18/09/21 8:14 am, Alex Rousskov wrote:
>> On 9/17/21 3:29 PM, Andreas Weigel wrote:
>>
>>> If splicing at step3, however, hostHeaderVerify is not called again with
>>> the SNI
>>
>> I assume that the above statement would still be true if I remove the
>> word "again" from it. This is how I interpreted it (i.e.
>> hostHeaderVerify() is called once with the IP address and never with
>> SNI).
>>
>> There are other ways to interpret that statement (e.g., hostHeaderVerify
>> was called with SNI once, but you expected it to be called with SNI
>> twice).
>>
>>
>>> I was wondering if this could be considered a bug or if there is a
>>> rationale to change the behavior in the "peek at step2, splice at step3"
>>> scenario.
>>
>> If my interpretation above is correct, then this sounds like a bug to
>> me: Squid/hostHeaderVerify() must validate every request target value
>> Squid intends to use for cache lookups and/or connecting. If the request
>> target changes from IP to SNI, then Squid must validate exactly twice.


> SSL-Bump step 3 does not need to verify

That fact is unrelated to the concern being raised in this thread
AFAICT: The concern is _not_ whether Squid verifies the target of the
SNI-based CONNECT during step3. The concern is whether Squid verifies
the target of the SNI-based CONNECT at all.

Alex.


From rousskov at measurement-factory.com  Sat Sep 18 17:34:17 2021
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Sat, 18 Sep 2021 13:34:17 -0400
Subject: [squid-users] hostHeaderVerify with SNI in interception
 environments
In-Reply-To: <887c8727-918a-e674-cd55-d22712ab7a63@measurement-factory.com>
References: <20210917192935.Horde.dWRzn4H6HtDwrLGUJhkedqZ@webmail.intern.securepoint.de>
 <46207bc8-a7d2-1730-38a6-2a1ffede80f3@measurement-factory.com>
 <d695fd89-26bf-3831-ac95-4e837b1c99b6@treenet.co.nz>
 <887c8727-918a-e674-cd55-d22712ab7a63@measurement-factory.com>
Message-ID: <cd720727-672c-2a57-a620-12d05cb035ed@measurement-factory.com>

On 9/18/21 10:36 AM, Alex Rousskov wrote:
> On 9/17/21 7:10 PM, Amos Jeffries wrote:
>> On 18/09/21 8:14 am, Alex Rousskov wrote:
>>> On 9/17/21 3:29 PM, Andreas Weigel wrote:
>>>
>>>> If splicing at step3, however, hostHeaderVerify is not called again with
>>>> the SNI
>>>
>>> I assume that the above statement would still be true if I remove the
>>> word "again" from it. This is how I interpreted it (i.e.
>>> hostHeaderVerify() is called once with the IP address and never with
>>> SNI).
>>>
>>> There are other ways to interpret that statement (e.g., hostHeaderVerify
>>> was called with SNI once, but you expected it to be called with SNI
>>> twice).
>>>
>>>
>>>> I was wondering if this could be considered a bug or if there is a
>>>> rationale to change the behavior in the "peek at step2, splice at step3"
>>>> scenario.
>>>
>>> If my interpretation above is correct, then this sounds like a bug to
>>> me: Squid/hostHeaderVerify() must validate every request target value
>>> Squid intends to use for cache lookups and/or connecting. If the request
>>> target changes from IP to SNI, then Squid must validate exactly twice.
> 
> 
>> SSL-Bump step 3 does not need to verify
> 
> That fact is unrelated to the concern being raised in this thread
> AFAICT: The concern is _not_ whether Squid verifies the target of the
> SNI-based CONNECT during step3. The concern is whether Squid verifies
> the target of the SNI-based CONNECT at all.

... after a peek rule matched at step2, of course. We already know from
the original email on this thread that Squid verifies the target of the
SNI-based CONNECT after a splice rule matched at step2, as expected.

Alex.


From hsaltiel at gmail.com  Sun Sep 19 17:32:59 2021
From: hsaltiel at gmail.com (Hernan Saltiel)
Date: Sun, 19 Sep 2021 14:32:59 -0300
Subject: [squid-users] About Squid 4, AD, Kerberos and AD group auth.
Message-ID: <CAMXef5+4dDPQ2GhtJByKOE9KhHpV9HNpV11WUOaxjzc6=nd_4Q@mail.gmail.com>

Hi everybody,
    Maybe this is a newbie question, but I'm looking for some docs about
how to configure Squid 4 with AD authentication, and AD groups
authorization. I'm trying to use Debian 11 for this.
    Found tons of Squid 3 tutos, but no place to find for example
negotiate_kerberos_auth based tutos, or fully functional examples. Read the
negotiate_kerberos_auth man page, but it's not clear for me how to use it,
even reading the "Configuration" section of that man page, when in the need
to authorize some groups, and some not.
    If you know about this, and can point me out to some URL I'm not
seeing, I'll thank you.
    Best regards,

HeCSa.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210919/c0532f6e/attachment.htm>

From hsaltiel at gmail.com  Sun Sep 19 17:40:55 2021
From: hsaltiel at gmail.com (Hernan Saltiel)
Date: Sun, 19 Sep 2021 14:40:55 -0300
Subject: [squid-users] About Squid 4, AD,
 Kerberos and AD groups authorization
Message-ID: <CAMXef5+1x9svU_Cm4pnhSTk3QMHfR9CzHVv81GX+aL7GeAG=dw@mail.gmail.com>

Hi everybody,
    Maybe this is a newbie question, but I'm looking for some docs about
how to configure Squid 4 with AD authentication, and AD groups
authorization. I'm trying to use Debian 11 for this.
    Found tons of Squid 3 tutos, but no place to find for example
negotiate_kerberos_auth based tutos, or fully functional examples. Read the
negotiate_kerberos_auth man page, but it's not clear for me how to use it,
even reading the "Configuration" section of that man page, when in the need
to authorize some groups, and some not.
    If you know about this, and can point me out to some URL I'm not
seeing, I'll thank you.
    Best regards,

HeCSa.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210919/2bb88b29/attachment.htm>

From squid3 at treenet.co.nz  Mon Sep 20 06:04:59 2021
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Mon, 20 Sep 2021 18:04:59 +1200
Subject: [squid-users] About Squid 4, AD, Kerberos and AD group auth.
In-Reply-To: <CAMXef5+4dDPQ2GhtJByKOE9KhHpV9HNpV11WUOaxjzc6=nd_4Q@mail.gmail.com>
References: <CAMXef5+4dDPQ2GhtJByKOE9KhHpV9HNpV11WUOaxjzc6=nd_4Q@mail.gmail.com>
Message-ID: <d09be236-b4fc-40ce-c325-87abc29b2454@treenet.co.nz>

On 20/09/21 5:32 am, Hernan Saltiel wrote:
>  ??? If you know about this, and can point me out to some URL I'm not 
> seeing, I'll thank you.

Please see the FAQ written by that helpers author
<https://wiki.squid-cache.org/ConfigExamples/Authenticate/Kerberos>


Amos


From rafael.akchurin at diladele.com  Mon Sep 20 12:15:10 2021
From: rafael.akchurin at diladele.com (Rafael Akchurin)
Date: Mon, 20 Sep 2021 12:15:10 +0000
Subject: [squid-users] Ubuntu 20.04 LTS repository for Squid 5.1 (rebuilt
 from sources in Debian unstable)
Message-ID: <AM8PR04MB7745E28E576E35E16CAD6D478FA09@AM8PR04MB7745.eurprd04.prod.outlook.com>

Hello everyone,

Online repository with latest Squid 5.1 (rebuilt from sources in Debian unstable) for Ubuntu 20.04 LTS 64-bit is available at https://squid51.diladele.com/.
Github repo  https://github.com/diladele/squid-ubuntu/tree/squid-51/src/ubuntu20 contains the scripts we used to make this compilation.

Here are simple instructions how to use the repo. For more information see readme at https://github.com/diladele/squid-ubuntu .

# add diladele apt key
wget -qO - https://packages.diladele.com/diladele_pub.asc | sudo apt-key add -

# add new repo
echo "deb https://squid51.diladele.com/ubuntu/ focal main" \
    > /etc/apt/sources.list.d/squid51.diladele.com.list

# and install
apt-get update && apt-get install -y \
    squid-common \
    squid-openssl \
    squidclient \
    libecap3 libecap3-dev

Hope you will find this useful.

Best regards,
Rafael Akchurin
Diladele B.V.

--
The same Squid 5.1 will be part of upcoming Web Safety 7.7 planned for release in December, 2021.
Download the latest virtual appliance from https://www.diladele.com/download.html

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210920/291862ef/attachment.htm>

From belle at bazuin.nl  Mon Sep 20 13:03:40 2021
From: belle at bazuin.nl (=?windows-1252?Q?L.P.H._van_Belle?=)
Date: Mon, 20 Sep 2021 15:03:40 +0200
Subject: [squid-users] Squid 5.1 for Debian Bullseye (amd64/i386/sources)
Message-ID: <vmime.614886ac.3fc8.48fea6b44672736c@ms249-lin-003.rotterdam.bazuin.nl>

And i have the Debian Bullseye packages also online. 

My changelog compaired to the Debian Unstable. 

 squid (5.1-1.1bullseye1) bullseye; urgency=medium

   * Non-maintainer upload.
   * Used sources from squid-cache.org build : squid-5.1-20210804-r1f9e52827
   * Lowered previous version 5.1-2 back to 5.1-1
   * d/patches, added fix-typos.patch found by Lintian.
   * d/watch, change http to https
   * d/*.tmp-file to *.tmp-files, Linitian predicated warnings on tmp-file
   * d/rules switched lines 160-161, made the build more consistent.
     - lowered this line: dh_installsystemd -psquid-openssl --name=squid


Setting up my repo.
wget -O- https://apt.van-belle.nl/louis-van-belle.gpg-key.asc |\
    gpg --dearmor | sudo tee /etc/apt/trusted.gpg.d/louis-van-belle.gpg > /dev/null

# set your arch , options amd64 or i386

deb [arch=amd64 signed-by=/etc/apt/trusted.gpg.d/louis-van-belle.gpg] http://apt.van-belle.nl/debian/ bullseye-squid51 main" \
 | sudo tee -a /etc/apt/sources.list.d/van-belle.list


Enjoy people and thank you Amos for these fast changes.


Louis



From hsaltiel at gmail.com  Mon Sep 20 13:16:43 2021
From: hsaltiel at gmail.com (Hernan Saltiel)
Date: Mon, 20 Sep 2021 10:16:43 -0300
Subject: [squid-users] About Squid 4, AD, Kerberos and AD group auth.
In-Reply-To: <d09be236-b4fc-40ce-c325-87abc29b2454@treenet.co.nz>
References: <CAMXef5+4dDPQ2GhtJByKOE9KhHpV9HNpV11WUOaxjzc6=nd_4Q@mail.gmail.com>
 <d09be236-b4fc-40ce-c325-87abc29b2454@treenet.co.nz>
Message-ID: <CAMXef5LMRweefGMbKxRuK50PQJ=gMv=a-663NO6Lnc3ancKsdw@mail.gmail.com>

Hi Amos!
Thanks a lot for your response.
I already checked this page, it talks about using negotiate_kerberos_auth
when having Squid 3.2 or newer, but there is no place in the document with
an example about how to use it.
Then I went to the manpage for this command (negotiate_kerberos_auth man
page - squid | ManKier <https://www.mankier.com/8/negotiate_kerberos_auth>),
where I can see three lines talking about how to add this to squid.conf.
But I don't know if I do need to follow a procedure to configure winbind,
Samba, or any other thing, and how to configure squid.conf to work with
groups, and their permissions.
Is there any place with full examples on using that config?
Thanks again, and best regards,

HeCSa.



On Mon, Sep 20, 2021 at 3:10 AM Amos Jeffries <squid3 at treenet.co.nz> wrote:

> On 20/09/21 5:32 am, Hernan Saltiel wrote:
> >      If you know about this, and can point me out to some URL I'm not
> > seeing, I'll thank you.
>
> Please see the FAQ written by that helpers author
> <https://wiki.squid-cache.org/ConfigExamples/Authenticate/Kerberos>
>
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>


-- 
HeCSa
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210920/74888586/attachment.htm>

From squid3 at treenet.co.nz  Mon Sep 20 21:48:16 2021
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 21 Sep 2021 09:48:16 +1200
Subject: [squid-users] Squid 5.1 for Debian Bullseye (amd64/i386/sources)
In-Reply-To: <vmime.614886ac.3fc8.48fea6b44672736c@ms249-lin-003.rotterdam.bazuin.nl>
References: <vmime.614886ac.3fc8.48fea6b44672736c@ms249-lin-003.rotterdam.bazuin.nl>
Message-ID: <770095e8-f240-4bca-7b62-92292f9e1c00@treenet.co.nz>

On 21/09/21 1:03 am, L.P.H. van Belle wrote:
> And i have the Debian Bullseye packages also online.
> 
> My changelog compaired to the Debian Unstable.
> 
>   squid (5.1-1.1bullseye1) bullseye; urgency=medium
> 
>     * Non-maintainer upload.
>     * Used sources from squid-cache.org build : squid-5.1-20210804-r1f9e52827
>     * Lowered previous version 5.1-2 back to 5.1-1
>     * d/patches, added fix-typos.patch found by Lintian.
>     * d/watch, change http to https

What URI are you using here exactly?
  The www.squid-cache.org website does not provide https:// URLs.


>     * d/*.tmp-file to *.tmp-files, Linitian predicated warnings on tmp-file
>     * d/rules switched lines 160-161, made the build more consistent.
>       - lowered this line: dh_installsystemd -psquid-openssl --name=squid
> 

Would you be able to send me a copy of the diff/patch for these please? 
I will see how much can be pulled into Debian official fr the v5.2 packages.

Amos


From david at articatech.com  Mon Sep 20 23:49:06 2021
From: david at articatech.com (David Touzeau)
Date: Tue, 21 Sep 2021 01:49:06 +0200
Subject: [squid-users] squid 5.1: Kerberos: Unable to switch to basic auth
 with Edge - IE - Chrome
Message-ID: <2d11d365-a3ca-ce27-b1e0-0dbb78b3036f@articatech.com>

Hi all

i have setup Kerberos authentication with Windows 2019 domain using 
Squid 5.1 ( The Squid version did not fix the issue - Tested 4.x and 5.x)
In some cases, some computers are not joined to the domain and ween need 
to allow authenticate on Squid

To allow this,? Basic Authentication is defined in Squid? and we expect 
that browsers prompt a login to be authenticated and access to Internet

But the behavior is strange.

On a computer outside the windows domain:
Firefox is be able to be successfully authenticated to squid using basic 
auth.
Edge, Chrome and IE still try ujsing NTLM method and are allways 
rejected with a 407

When edge, chrome and IE try to establish a session, Squid claim

2021/09/21 01:17:27 kid1| ERROR: Negotiate Authentication validating 
user. Result: {result=BH, notes={message: received type 1 NTLM token; }}

This let us understanding that these 3 browsers try NTLM instead of a 
Basic Authentication.

I did not know why these browsers using NTLM as they did not connected 
to the Windows domain
Why squid never get the Basic Authentication credentials. ?

Did i miss something ?

Here it is my configuration.

auth_param negotiate program /lib/squid3/negotiate_kerberos_auth -r -s 
GSS_C_NO_NAME -k /etc/squid3/PROXY.keytab
auth_param negotiate children 20 startup=5 idle=1 concurrency=0 
queue-size=80 on-persistent-overload=ERR
auth_param negotiate keep_alive on

auth_param basic program /lib/squid3/basic_ldap_auth -v -R -b 
"DC=articatech,DC=int" -D "administrator at articatech.int" -W 
/etc/squid3/ldappass.txt -f sAMAccountName=%s -v 3 -h 192.168.90.10
auth_param basic children 3
auth_param basic realm Active Directory articatech.int
auth_param basic credentialsttl 7200 seconds
authenticate_ttl 3600 seconds
authenticate_ip_ttl 1 seconds
authenticate_cache_garbage_interval 3600 seconds

acl AUTHENTICATED proxy_auth REQUIRED

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210921/b2e2cee2/attachment.htm>

From squid3 at treenet.co.nz  Tue Sep 21 00:49:21 2021
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 21 Sep 2021 12:49:21 +1200
Subject: [squid-users] squid 5.1: Kerberos: Unable to switch to basic
 auth with Edge - IE - Chrome
In-Reply-To: <2d11d365-a3ca-ce27-b1e0-0dbb78b3036f@articatech.com>
References: <2d11d365-a3ca-ce27-b1e0-0dbb78b3036f@articatech.com>
Message-ID: <72649623-8ebb-08ea-9779-54caba08ab3d@treenet.co.nz>

On 21/09/21 11:49 am, David Touzeau wrote:
> 
> When edge, chrome and IE try to establish a session, Squid claim
> 
> 2021/09/21 01:17:27 kid1| ERROR: Negotiate Authentication validating 
> user. Result: {result=BH, notes={message: received type 1 NTLM token; }}
> 
> This let us understanding that these 3 browsers try NTLM instead of a 
> Basic Authentication.
> 
> I did not know why these browsers using NTLM as they did not connected 
> to the Windows domain

Unlike Kerberos, NTLM does not require the machine to be connected to a 
domain to have credentials. AFAIK the browser still has access to the 
localhost user credentials for use in NTLM. Or the machine may even be 
trying to use the Basic auth credentials as LM tokens with NTLM scheme.


> Why squid never get the Basic Authentication credentials. ?
> 

That is a Browser decision. All Squid can do is offer the schemes it 
supports and they have to choose which is used.

> Did i miss something ?

With Squid-5 you can use the auth_schemes directive to workaround issues 
like this.
  <http://www.squid-cache.org/Versions/v5/cfgman/auth_schemes.html>


Amos


From squid.org at bloms.de  Tue Sep 21 06:31:16 2021
From: squid.org at bloms.de (Dieter Bloms)
Date: Tue, 21 Sep 2021 08:31:16 +0200
Subject: [squid-users] got many messages after upgrade from 4.16 to 5.1:
 assertion failed: Transients.cc:221: "old == e"
Message-ID: <20210921063116.k25euqrhrh3cbxvx@bloms.de>

Hello,

I did an upgrade from squid 4.16 and got many messages like: assertion failed: Transients.cc:221: "old == e"
and it seems, that the childs crash and restart:

--snip--
2021/09/20 04:37:47 kid2| assertion failed: Transients.cc:221: "old == e"
    current master transaction: master368193
2021/09/20 04:37:49 kid2| Set Current Directory to /var/cache/squid
2021/09/20 04:37:49 kid2| Starting Squid Cache version 5.1 for x86_64-pc-linux-gnu...
2021/09/20 04:37:49 kid2| Service Name: squid
2021/09/20 04:37:49 kid2| Process ID 63991
2021/09/20 04:37:49 kid2| Process Roles: worker
2021/09/20 04:37:49 kid2| With 1048576 file descriptors available
--snip--

This proxy hasn't enabled sslbump and we don't use any cache directory.
We only cache in memory for performance reason.

Is this a known issue or shall I open a bugreport ?


-- 
regards

  Dieter

--
I do not get viruses because I do not use MS software.
If you use Outlook then please do not put my email address in your
address-book so that WHEN you get a virus it won't use my address in the
>From field.


From belle at bazuin.nl  Tue Sep 21 07:38:43 2021
From: belle at bazuin.nl (=?windows-1252?Q?L.P.H._van_Belle?=)
Date: Tue, 21 Sep 2021 09:38:43 +0200
Subject: [squid-users] squid 5.1: Kerberos: Unable to switch to basic
 auth with Edge - IE - Chrome
In-Reply-To: <2d11d365-a3ca-ce27-b1e0-0dbb78b3036f@articatech.com>
References: <2d11d365-a3ca-ce27-b1e0-0dbb78b3036f@articatech.com>
Message-ID: <vmime.61498c03.38c3.221b82153bf930b3@ms249-lin-003.rotterdam.bazuin.nl>



in your smb.conf add
    # Added to enforced NTLM 2, must be set on all Samba AD-DC's and the needed members. 
    # This is used in combination with ntlm_auth --allow-mschapv2 
    ntlm auth = mschapv2-and-ntlmv2-only

In squid use: 
auth_param negotiate program /usr/lib/squid/negotiate_wrapper_auth \
    --kerberos /usr/lib/squid/negotiate_kerberos_auth -k /etc/squid/krb5-squid-HTTP.keytab \
    -s HTTP/proxy.fq.dn.tld at MY.REALM.TLD \
    --ntlm /usr/bin/ntlm_auth --allow-mschapv2 --helper-protocol=gss-spnego --domain=ADDOM

 
If you connecting for ldap.. Dont use -h 192.168.90.10 
Uses -H ldaps://host.name.fq.dn 

Also push the root-CA off the domain to pc's with GPO for example 
And in that GPO you can set the parts you need to enable for the users/pcs to make it all work. 

But your close, your almost there.. 

On thing i have not looked at myself yet, ext_kerberos_ldap_group_acl 
https://fossies.org/linux/squid/src/acl/external/kerberos_ldap_group/ext_kerberos_ldap_group_acl.8 
Thats one i'll be using with squid 5.1, im still compiling everyting i need, but then im setting
It up, i'll document it and make and howto of it. 

Greetz, 

Louis



________________________________

	Van: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] Namens David Touzeau
	Verzonden: dinsdag 21 september 2021 1:49
	Aan: squid-users at lists.squid-cache.org
	Onderwerp: [squid-users] squid 5.1: Kerberos: Unable to switch to basic auth with Edge - IE - Chrome
	
	
	Hi all
	
	i have setup Kerberos authentication with Windows 2019 domain using Squid 5.1 ( The Squid version did not fix the issue - Tested 4.x and 5.x)
	In some cases, some computers are not joined to the domain and ween need to allow authenticate on Squid
	
	To allow this,  Basic Authentication is defined in Squid  and we expect that browsers prompt a login to be authenticated and access to Internet
	
	But the behavior is strange.
	
	On a computer outside the windows domain:
	Firefox is be able to be successfully authenticated to squid using basic auth.
	Edge, Chrome and IE still try ujsing NTLM method and are allways rejected with a 407
	
	When edge, chrome and IE try to establish a session, Squid claim 
	
	2021/09/21 01:17:27 kid1| ERROR: Negotiate Authentication validating user. Result: {result=BH, notes={message: received type 1 NTLM token; }}
	
	This let us understanding that these 3 browsers try NTLM instead of a Basic Authentication.
	
	I did not know why these browsers using NTLM as they did not connected to the Windows domain 
	Why squid never get the Basic Authentication credentials. ?
	
	Did i miss something ?
	
	Here it is my configuration.
	
	auth_param negotiate program /lib/squid3/negotiate_kerberos_auth -r -s GSS_C_NO_NAME -k /etc/squid3/PROXY.keytab
	auth_param negotiate children 20 startup=5 idle=1 concurrency=0 queue-size=80 on-persistent-overload=ERR
	auth_param negotiate keep_alive on
	
	auth_param basic program /lib/squid3/basic_ldap_auth -v -R -b "DC=articatech,DC=int" -D "administrator at articatech.int" <mailto:administrator at articatech.int>  -W /etc/squid3/ldappass.txt -f sAMAccountName=%s -v 3 -h 192.168.90.10
	auth_param basic children 3
	auth_param basic realm Active Directory articatech.int
	auth_param basic credentialsttl 7200 seconds
	authenticate_ttl 3600 seconds
	authenticate_ip_ttl 1 seconds
	authenticate_cache_garbage_interval 3600 seconds
	
	acl AUTHENTICATED proxy_auth REQUIRED
	
	




From david at articatech.com  Tue Sep 21 08:18:29 2021
From: david at articatech.com (David Touzeau)
Date: Tue, 21 Sep 2021 10:18:29 +0200
Subject: [squid-users] squid 5.1: Kerberos: Unable to switch to basic
 auth with Edge - IE - Chrome
In-Reply-To: <vmime.61498c03.38c3.221b82153bf930b3@ms249-lin-003.rotterdam.bazuin.nl>
References: <2d11d365-a3ca-ce27-b1e0-0dbb78b3036f@articatech.com>
 <vmime.61498c03.38c3.221b82153bf930b3@ms249-lin-003.rotterdam.bazuin.nl>
Message-ID: <cbc62d8e-784d-89f3-6583-c3a26c1860ac@articatech.com>

Thanks Louis for this tips but we did not want to use NTLM as it is an 
old way.
It requires a samba on the Squid Box

As Amos said, this is most a browser (that using Microsoft API ) issue

The best way is to make these browsers replicating the correct Firefox 
behavior.
Means swith to basic auth instead of trying this stupid NTLM method

Le 21/09/2021 ? 09:38, L.P.H. van Belle a ?crit?:
>
> in your smb.conf add
>      # Added to enforced NTLM 2, must be set on all Samba AD-DC's and the needed members.
>      # This is used in combination with ntlm_auth --allow-mschapv2
>      ntlm auth = mschapv2-and-ntlmv2-only
>
> In squid use:
> auth_param negotiate program /usr/lib/squid/negotiate_wrapper_auth \
>      --kerberos /usr/lib/squid/negotiate_kerberos_auth -k /etc/squid/krb5-squid-HTTP.keytab \
>      -s HTTP/proxy.fq.dn.tld at MY.REALM.TLD \
>      --ntlm /usr/bin/ntlm_auth --allow-mschapv2 --helper-protocol=gss-spnego --domain=ADDOM
>
>   
> If you connecting for ldap.. Dont use -h 192.168.90.10
> Uses -H ldaps://host.name.fq.dn
>
> Also push the root-CA off the domain to pc's with GPO for example
> And in that GPO you can set the parts you need to enable for the users/pcs to make it all work.
>
> But your close, your almost there..
>
> On thing i have not looked at myself yet, ext_kerberos_ldap_group_acl
> https://fossies.org/linux/squid/src/acl/external/kerberos_ldap_group/ext_kerberos_ldap_group_acl.8
> Thats one i'll be using with squid 5.1, im still compiling everyting i need, but then im setting
> It up, i'll document it and make and howto of it.
>
> Greetz,
>
> Louis
>
>
>
> ________________________________
>
> 	Van: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] Namens David Touzeau
> 	Verzonden: dinsdag 21 september 2021 1:49
> 	Aan: squid-users at lists.squid-cache.org
> 	Onderwerp: [squid-users] squid 5.1: Kerberos: Unable to switch to basic auth with Edge - IE - Chrome
> 	
> 	
> 	Hi all
> 	
> 	i have setup Kerberos authentication with Windows 2019 domain using Squid 5.1 ( The Squid version did not fix the issue - Tested 4.x and 5.x)
> 	In some cases, some computers are not joined to the domain and ween need to allow authenticate on Squid
> 	
> 	To allow this,  Basic Authentication is defined in Squid  and we expect that browsers prompt a login to be authenticated and access to Internet
> 	
> 	But the behavior is strange.
> 	
> 	On a computer outside the windows domain:
> 	Firefox is be able to be successfully authenticated to squid using basic auth.
> 	Edge, Chrome and IE still try ujsing NTLM method and are allways rejected with a 407
> 	
> 	When edge, chrome and IE try to establish a session, Squid claim
> 	
> 	2021/09/21 01:17:27 kid1| ERROR: Negotiate Authentication validating user. Result: {result=BH, notes={message: received type 1 NTLM token; }}
> 	
> 	This let us understanding that these 3 browsers try NTLM instead of a Basic Authentication.
> 	
> 	I did not know why these browsers using NTLM as they did not connected to the Windows domain
> 	Why squid never get the Basic Authentication credentials. ?
> 	
> 	Did i miss something ?
> 	
> 	Here it is my configuration.
> 	
> 	auth_param negotiate program /lib/squid3/negotiate_kerberos_auth -r -s GSS_C_NO_NAME -k /etc/squid3/PROXY.keytab
> 	auth_param negotiate children 20 startup=5 idle=1 concurrency=0 queue-size=80 on-persistent-overload=ERR
> 	auth_param negotiate keep_alive on
> 	
> 	auth_param basic program /lib/squid3/basic_ldap_auth -v -R -b "DC=articatech,DC=int" -D "administrator at articatech.int" <mailto:administrator at articatech.int>  -W /etc/squid3/ldappass.txt -f sAMAccountName=%s -v 3 -h 192.168.90.10
> 	auth_param basic children 3
> 	auth_param basic realm Active Directory articatech.int
> 	auth_param basic credentialsttl 7200 seconds
> 	authenticate_ttl 3600 seconds
> 	authenticate_ip_ttl 1 seconds
> 	authenticate_cache_garbage_interval 3600 seconds
> 	
> 	acl AUTHENTICATED proxy_auth REQUIRED
> 	
> 	
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210921/0ebc6634/attachment.htm>

From david at articatech.com  Tue Sep 21 08:21:37 2021
From: david at articatech.com (David Touzeau)
Date: Tue, 21 Sep 2021 10:21:37 +0200
Subject: [squid-users] squid 5.1: Kerberos: Unable to switch to basic
 auth with Edge - IE - Chrome
In-Reply-To: <72649623-8ebb-08ea-9779-54caba08ab3d@treenet.co.nz>
References: <2d11d365-a3ca-ce27-b1e0-0dbb78b3036f@articatech.com>
 <72649623-8ebb-08ea-9779-54caba08ab3d@treenet.co.nz>
Message-ID: <801a9d9a-91a8-6c83-9272-0aa7e1c39c55@articatech.com>

Thanks amos !!

I think auth_schemes can be a workaround.
I will try it !



Le 21/09/2021 ? 02:49, Amos Jeffries a ?crit?:
> On 21/09/21 11:49 am, David Touzeau wrote:
>>
>> When edge, chrome and IE try to establish a session, Squid claim
>>
>> 2021/09/21 01:17:27 kid1| ERROR: Negotiate Authentication validating 
>> user. Result: {result=BH, notes={message: received type 1 NTLM token; }}
>>
>> This let us understanding that these 3 browsers try NTLM instead of a 
>> Basic Authentication.
>>
>> I did not know why these browsers using NTLM as they did not 
>> connected to the Windows domain
>
> Unlike Kerberos, NTLM does not require the machine to be connected to 
> a domain to have credentials. AFAIK the browser still has access to 
> the localhost user credentials for use in NTLM. Or the machine may 
> even be trying to use the Basic auth credentials as LM tokens with 
> NTLM scheme.
>
>
>> Why squid never get the Basic Authentication credentials. ?
>>
>
> That is a Browser decision. All Squid can do is offer the schemes it 
> supports and they have to choose which is used.
>
>> Did i miss something ?
>
> With Squid-5 you can use the auth_schemes directive to workaround 
> issues like this.
> ?<http://www.squid-cache.org/Versions/v5/cfgman/auth_schemes.html>
>
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210921/38ef3c63/attachment.htm>

From belle at bazuin.nl  Tue Sep 21 09:17:55 2021
From: belle at bazuin.nl (=?windows-1252?Q?L.P.H._van_Belle?=)
Date: Tue, 21 Sep 2021 11:17:55 +0200
Subject: [squid-users] squid 5.1: Kerberos: Unable to switch to basic
 auth with Edge - IE - Chrome
In-Reply-To: <cbc62d8e-784d-89f3-6583-c3a26c1860ac@articatech.com>
References: <vmime.61498c03.38c3.221b82153bf930b3@ms249-lin-003.rotterdam.bazuin.nl>
Message-ID: <vmime.6149a343.30bd.4f60a4d551e59bf3@ms249-lin-003.rotterdam.bazuin.nl>

What i showed used kerberos, if that fails it used ntlm.. and you can add.. if that fails use LDAP (basic auth) ..?
This way, you support all of them. 

if you going only for kerberos, that make sure you setup your krb5.conf correctly.. 
A + PTR records, SPN/UPNs and yes, then you can run it fully without samba? ( if your not haveing PTR, set rdns = no in krb5.conf ) 

Also, if you dont want the NTLM part, just remove the line : 
--ntlm /usr/bin/ntlm_auth --allow-mschapv2 --helper-protocol=gss-spnego --domain=ADDOM


on firefox, did you set this In Firefox, you have to go to the about:config page and set the parameters
network.negotiate-auth.trusted-uris
network.automatic-ntlm-auth.trusted-uris

As far i can tell, what i see, is you didnt configure the browsers to use kerberos. 


Greetz,

Louis

?

?

Van: David Touzeau [mailto:david at articatech.com] 
Verzonden: dinsdag 21 september 2021 10:18
Aan: L.P.H. van Belle; squid-users at lists.squid-cache.org
Onderwerp: Re: [squid-users] squid 5.1: Kerberos: Unable to switch to basic auth with Edge - IE - Chrome



Thanks Louis for this tips but we did not want to use NTLM as it is an old way.
It requires a samba on the Squid Box 

As Amos said, this is most a browser (that using Microsoft API ) issue 

The best way is to make these browsers replicating the correct Firefox behavior. 
Means swith to basic auth instead of trying this stupid NTLM method

Le 21/09/2021 ? 09:38, L.P.H. van Belle a ?crit?:


in your smb.conf add # Added to enforced NTLM 2, must be set on all Samba AD-DC's and the needed members. # This is used in combination with ntlm_auth --allow-mschapv2 ntlm auth = mschapv2-and-ntlmv2-only In squid use: auth_param negotiate program /usr/lib/squid/negotiate_wrapper_auth \ --kerberos /usr/lib/squid/negotiate_kerberos_auth -k /etc/squid/krb5-squid-HTTP.keytab \ -s HTTP/proxy.fq.dn.tld at MY.REALM.TLD \ --ntlm /usr/bin/ntlm_auth --allow-mschapv2 --helper-protocol=gss-spnego --domain=ADDOM If you connecting for ldap.. Dont use -h 192.168.90.10 Uses -H ldaps://host.name.fq.dn Also push the root-CA off the domain to pc's with GPO for example And in that GPO you can set the parts you need to enable for the users/pcs to make it all work. But your close, your almost there.. On thing i have not looked at myself yet, ext_kerberos_ldap_group_acl https://fossies.org/linux/squid/src/acl/external/kerberos_ldap_group/ext_kerberos_ldap_group_acl.8 Thats one i'll be using with squid 5.1, im still compiling everyting i need, but then im setting It up, i'll document it and make and howto of it. Greetz, Louis ________________________________ Van: squid-users [ MailScanner heeft een e-mail met mogelijk een poging tot fraude gevonden van "lists.squid-cache.org" mailto:squid-users-bounces at lists.squid-cache.org] Namens David Touzeau Verzonden: dinsdag 21 september 2021 1:49 Aan: squid-users at lists.squid-cache.org Onderwerp: [squid-users] squid 5.1: Kerberos: Unable to switch to basic auth with Edge - IE - Chrome Hi all i have setup Kerberos authentication with Windows 2019 domain using Squid 5.1 ( The Squid version did not fix the issue - Tested 4.x and 5.x) In some cases, some computers are not joined to the domain and ween need to allow authenticate on Squid To allow this, Basic Authentication is defined in Squid and we expect that browsers prompt a login to be authenticated and access to Internet But the behavior is strange. On a computer outside the windows domain: Firefox is be able to be successfully authenticated to squid using basic auth. Edge, Chrome and IE still try ujsing NTLM method and are allways rejected with a 407 When edge, chrome and IE try to establish a session, Squid claim 2021/09/21 01:17:27 kid1| ERROR: Negotiate Authentication validating user. Result: {result=BH, notes={message: received type 1 NTLM token; }} This let us understanding that these 3 browsers try NTLM instead of a Basic Authentication. I did not know why these browsers using NTLM as they did not connected to the Windows domain Why squid never get the Basic Authentication credentials. ? Did i miss something ? Here it is my configuration. auth_param negotiate program /lib/squid3/negotiate_kerberos_auth -r -s GSS_C_NO_NAME -k /etc/squid3/PROXY.keytab auth_param negotiate children 20 startup=5 idle=1 concurrency=0 queue-size=80 on-persistent-overload=ERR auth_param negotiate keep_alive on auth_param basic program /lib/squid3/basic_ldap_auth -v -R -b "DC=articatech,DC=int" -D "administrator at articatech.int" <mailto:administrator at articatech.int> -W /etc/squid3/ldappass.txt -f sAMAccountName=%s -v 3 -h 192.168.90.10 auth_param basic children 3 auth_param basic realm Active Directory articatech.int auth_param basic credentialsttl 7200 seconds authenticate_ttl 3600 seconds authenticate_ip_ttl 1 seconds authenticate_cache_garbage_interval 3600 seconds acl AUTHENTICATED proxy_auth REQUIRED _______________________________________________ squid-users mailing list squid-users at lists.squid-cache.org http://lists.squid-cache.org/listinfo/squid-users 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210921/fdcf06eb/attachment.htm>

From rousskov at measurement-factory.com  Tue Sep 21 13:32:17 2021
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Tue, 21 Sep 2021 09:32:17 -0400
Subject: [squid-users] got many messages after upgrade from 4.16 to 5.1:
 assertion failed: Transients.cc:221: "old == e"
In-Reply-To: <20210921063116.k25euqrhrh3cbxvx@bloms.de>
References: <20210921063116.k25euqrhrh3cbxvx@bloms.de>
Message-ID: <7243ae80-efe8-6e8b-b4c7-d020d1792d59@measurement-factory.com>

On 9/21/21 2:31 AM, Dieter Bloms wrote:

> I did an upgrade from squid 4.16 and got many messages like: assertion failed: Transients.cc:221: "old == e"
> and it seems, that the childs crash and restart:
> 
> --snip--
> 2021/09/20 04:37:47 kid2| assertion failed: Transients.cc:221: "old == e"
>     current master transaction: master368193
> 2021/09/20 04:37:49 kid2| Set Current Directory to /var/cache/squid
> 2021/09/20 04:37:49 kid2| Starting Squid Cache version 5.1 for x86_64-pc-linux-gnu...

> This proxy hasn't enabled sslbump and we don't use any cache directory.
> We only cache in memory for performance reason.
> 
> Is this a known issue or shall I open a bugreport ?

It looks like you are suffering from bug 5134 which is awaiting more
information from those who can reproduce it (and a volunteer to fix it):
https://bugs.squid-cache.org/show_bug.cgi?id=5134

Alex.


From andreas.weigel at securepoint.de  Tue Sep 21 14:14:00 2021
From: andreas.weigel at securepoint.de (Andreas Weigel)
Date: Tue, 21 Sep 2021 14:14:00 +0000
Subject: [squid-users] hostHeaderVerify with SNI in interception
 environments
In-Reply-To: <cd720727-672c-2a57-a620-12d05cb035ed@measurement-factory.com>
References: <20210917192935.Horde.dWRzn4H6HtDwrLGUJhkedqZ@webmail.intern.securepoint.de>
 <46207bc8-a7d2-1730-38a6-2a1ffede80f3@measurement-factory.com>
 <d695fd89-26bf-3831-ac95-4e837b1c99b6@treenet.co.nz>
 <887c8727-918a-e674-cd55-d22712ab7a63@measurement-factory.com>
 <cd720727-672c-2a57-a620-12d05cb035ed@measurement-factory.com>
Message-ID: <20210921141400.Horde.mjpKn3EZKoY1AM4vj3NGsT3@webmail.intern.securepoint.de>

Hi,

sorry for the late response and the ambiguity in the initial post.

> That fact is unrelated to the concern being raised in this thread
> AFAICT: The concern is _not_ whether Squid verifies the target of the
> SNI-based CONNECT during step3. The concern is whether Squid verifies
> the target of the SNI-based CONNECT at all.

Exactly. If splicing in step2, the SNI is validated (DNS lookup,  
comparing results with IP from client request). In that configuration,  
hostHeaderVerify is called twice, once at step1 (without any hosts,  
always passes) and once at step2 (with SNI, if present).

If peeking in step2 and splicing in step3, the SNI is *not* validated  
in step2 -- hostHeaderVerify is only called once without any hostname  
at step1 in that case and that always passes.

Andreas



From belle at bazuin.nl  Tue Sep 21 15:05:27 2021
From: belle at bazuin.nl (=?windows-1252?Q?L.P.H._van_Belle?=)
Date: Tue, 21 Sep 2021 17:05:27 +0200
Subject: [squid-users] Squid 5.1 for Debian Bullseye (amd64/i386/sources)
In-Reply-To: <770095e8-f240-4bca-7b62-92292f9e1c00@treenet.co.nz>
References: <vmime.614886ac.3fc8.48fea6b44672736c@ms249-lin-003.rotterdam.bazuin.nl>
Message-ID: <vmime.6149f4b7.5226.5457270125c1b2a7@ms249-lin-003.rotterdam.bazuin.nl>

 

> -----Oorspronkelijk bericht-----
> Van: squid-users 
> [mailto:squid-users-bounces at lists.squid-cache.org] Namens 
> Amos Jeffries
> Verzonden: maandag 20 september 2021 23:48
> Aan: squid-users at lists.squid-cache.org
> Onderwerp: Re: [squid-users] Squid 5.1 for Debian Bullseye 
> (amd64/i386/sources)
> 
> On 21/09/21 1:03 am, L.P.H. van Belle wrote:
> > And i have the Debian Bullseye packages also online.
> > 
> > My changelog compaired to the Debian Unstable.
> > 
> >   squid (5.1-1.1bullseye1) bullseye; urgency=medium
> > 
> >     * Non-maintainer upload.
> >     * Used sources from squid-cache.org build : 
> squid-5.1-20210804-r1f9e52827
> >     * Lowered previous version 5.1-2 back to 5.1-1
> >     * d/patches, added fix-typos.patch found by Lintian.
> >     * d/watch, change http to https
> 
> What URI are you using here exactly?
>   The www.squid-cache.org website does not provide https:// URLs.

Ai, thats an "assumption" there was https .. (oeps).. 
And it does have it but gives : *.spd.co.il :-/ 
I'll revert that on next update. 

> 
> 
> >     * d/*.tmp-file to *.tmp-files, Linitian predicated 
> warnings on tmp-file
> >     * d/rules switched lines 160-161, made the build more 
> consistent.
> >       - lowered this line: dh_installsystemd 
> -psquid-openssl --name=squid
> > 
> 
> Would you be able to send me a copy of the diff/patch for 
> these please? 
> I will see how much can be pulled into Debian official fr the 
> v5.2 packages.

Sure, i'll do that tomorrow. 


Greetz, 

Louis



From rousskov at measurement-factory.com  Tue Sep 21 15:27:16 2021
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Tue, 21 Sep 2021 11:27:16 -0400
Subject: [squid-users] hostHeaderVerify with SNI in interception
 environments
In-Reply-To: <20210921141400.Horde.mjpKn3EZKoY1AM4vj3NGsT3@webmail.intern.securepoint.de>
References: <20210917192935.Horde.dWRzn4H6HtDwrLGUJhkedqZ@webmail.intern.securepoint.de>
 <46207bc8-a7d2-1730-38a6-2a1ffede80f3@measurement-factory.com>
 <d695fd89-26bf-3831-ac95-4e837b1c99b6@treenet.co.nz>
 <887c8727-918a-e674-cd55-d22712ab7a63@measurement-factory.com>
 <cd720727-672c-2a57-a620-12d05cb035ed@measurement-factory.com>
 <20210921141400.Horde.mjpKn3EZKoY1AM4vj3NGsT3@webmail.intern.securepoint.de>
Message-ID: <c7647d34-7b71-e88a-1b3c-722125bdfa9b@measurement-factory.com>

On 9/21/21 10:14 AM, Andreas Weigel wrote:
> Hi,
> 
> sorry for the late response and the ambiguity in the initial post.
> 
>> That fact is unrelated to the concern being raised in this thread
>> AFAICT: The concern is _not_ whether Squid verifies the target of the
>> SNI-based CONNECT during step3. The concern is whether Squid verifies
>> the target of the SNI-based CONNECT at all.
> 
> Exactly. If splicing in step2, the SNI is validated (DNS lookup,
> comparing results with IP from client request). In that configuration,
> hostHeaderVerify is called twice, once at step1 (without any hosts,
> always passes) and once at step2 (with SNI, if present).
> 
> If peeking in step2 and splicing in step3, the SNI is *not* validated in
> step2 -- hostHeaderVerify is only called once without any hostname at
> step1 in that case and that always passes.

Glad we are on the same page. FWIW, Factory is (slowly) working on an
SslBump refactoring project that may address this bug. I do not have a
patch against official sources for you to try, but you can keep track of
our progress at https://github.com/measurement-factory/squid/pull/108


Cheers,

Alex.


From andreas.weigel at securepoint.de  Tue Sep 21 18:19:25 2021
From: andreas.weigel at securepoint.de (Andreas Weigel)
Date: Tue, 21 Sep 2021 18:19:25 +0000
Subject: [squid-users] hostHeaderVerify with SNI in interception
 environments
In-Reply-To: <c7647d34-7b71-e88a-1b3c-722125bdfa9b@measurement-factory.com>
References: <20210917192935.Horde.dWRzn4H6HtDwrLGUJhkedqZ@webmail.intern.securepoint.de>
 <46207bc8-a7d2-1730-38a6-2a1ffede80f3@measurement-factory.com>
 <d695fd89-26bf-3831-ac95-4e837b1c99b6@treenet.co.nz>
 <887c8727-918a-e674-cd55-d22712ab7a63@measurement-factory.com>
 <cd720727-672c-2a57-a620-12d05cb035ed@measurement-factory.com>
 <20210921141400.Horde.mjpKn3EZKoY1AM4vj3NGsT3@webmail.intern.securepoint.de>
 <c7647d34-7b71-e88a-1b3c-722125bdfa9b@measurement-factory.com>
Message-ID: <20210921181925.Horde.POpI1EpCeLgZqEDoz4QNyIW@webmail.intern.securepoint.de>

Hi again,

> FWIW, Factory is (slowly) working on an SslBump refactoring project  
> that may address this bug.

Thanks, I'll keep an eye on that.

Andreas

Zitat von Alex Rousskov <rousskov at measurement-factory.com>:

> On 9/21/21 10:14 AM, Andreas Weigel wrote:
>> Hi,
>>
>> sorry for the late response and the ambiguity in the initial post.
>>
>>> That fact is unrelated to the concern being raised in this thread
>>> AFAICT: The concern is _not_ whether Squid verifies the target of the
>>> SNI-based CONNECT during step3. The concern is whether Squid verifies
>>> the target of the SNI-based CONNECT at all.
>>
>> Exactly. If splicing in step2, the SNI is validated (DNS lookup,
>> comparing results with IP from client request). In that configuration,
>> hostHeaderVerify is called twice, once at step1 (without any hosts,
>> always passes) and once at step2 (with SNI, if present).
>>
>> If peeking in step2 and splicing in step3, the SNI is *not* validated in
>> step2 -- hostHeaderVerify is only called once without any hostname at
>> step1 in that case and that always passes.
>
> Glad we are on the same page. FWIW, Factory is (slowly) working on an
> SslBump refactoring project that may address this bug. I do not have a
> patch against official sources for you to try, but you can keep track of
> our progress at https://github.com/measurement-factory/squid/pull/108
>
>
> Cheers,
>
> Alex.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users





From roeeklinger60 at gmail.com  Wed Sep 22 12:44:13 2021
From: roeeklinger60 at gmail.com (roee klinger)
Date: Wed, 22 Sep 2021 15:44:13 +0300
Subject: [squid-users] Redirecting URLs on HTTPS traffic
Message-ID: <CAGCa14p1j22Ht46-5Tf6-fPEOnC-byx+JW71+UBqUR-D+uDnRA@mail.gmail.com>

Hello,

I have an internal network in our office where we want to redirect every
google search to a Duckduckgo search instead, I already have a script
written that knows how to take the Google URL and convert it to Duckduckgo.

I am reading about how to implement it on Squid, however everything I can
find is only referring to HTTP traffic, not HTTPS.

Is that possible to do using HTTPS?

Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210922/d3bdca80/attachment.htm>

From gtaylor at tnetconsulting.net  Wed Sep 22 16:04:58 2021
From: gtaylor at tnetconsulting.net (Grant Taylor)
Date: Wed, 22 Sep 2021 10:04:58 -0600
Subject: [squid-users] Redirecting URLs on HTTPS traffic
In-Reply-To: <CAGCa14p1j22Ht46-5Tf6-fPEOnC-byx+JW71+UBqUR-D+uDnRA@mail.gmail.com>
References: <CAGCa14p1j22Ht46-5Tf6-fPEOnC-byx+JW71+UBqUR-D+uDnRA@mail.gmail.com>
Message-ID: <35a45ed4-edbf-d054-37ab-e8c1a240f266@spamtrap.tnetconsulting.net>

On 9/22/21 6:44 AM, roee klinger wrote:
> Hello,

Hi,

> I have an internal network in our office where we want to redirect every 
> google search to a Duckduckgo search instead, I already have a script 
> written that knows how to take the Google URL and convert it to Duckduckgo.
> 
> I am reading about how to implement it on Squid, however everything I 
> can find is only referring?to HTTP traffic, not HTTPS.
> 
> Is that possible to do using HTTPS?

I've not done what you are asking about.  However, based on the 
following, I do believe that it is possible to do what you are asking about.

1)  I've read about a couple different options to do redirection:
     a)  Redirection via Squid directives in squid.conf.
     b)  Use ICAP to modify the traffic.
2)  TLS bump-in-the-wire to get into the HTTPS stream and apply #1.
     I've got this working -- quite well -- at home.

#2 is probably your biggest hurtle.  I don't think it's /hard/, but 
there are nuances to it.
  - How you do the TLS BitW; peek vs snoop, when you do it.
  - The security / legality implications of intercepting TLS connections.
  - The logistics in installing the Root CA's public key that Squid uses.

But I believe what you are wanting to do is imminently possible.



-- 
Grant. . . .
unix || die

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4013 bytes
Desc: S/MIME Cryptographic Signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210922/64275a54/attachment.bin>

From robertkwild at gmail.com  Thu Sep 23 12:53:00 2021
From: robertkwild at gmail.com (robert k Wild)
Date: Thu, 23 Sep 2021 13:53:00 +0100
Subject: [squid-users] net err cert validity too long - chrome/safari
Message-ID: <CAGU_Ci+dy9+BAm6aoOSxinfnJjAw3c2z+LuTab5Mdp5qe1_HNA@mail.gmail.com>

hi all,

i get this error on chrome and safari, when i access the same website on
firefox i get the proxy error page as i havnt whitelisted this site, when i
whitelist it, i can get on the website on all three diff browsers and when
i take it off the whitelist exactly the same before

i have googled and its because my cert is too long age, i made it 999 days
and i find out now it should be longer than 397 days

is this correct?

thanks,
rob

-- 
Regards,

Robert K Wild.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210923/c234e6a8/attachment.htm>

From belle at bazuin.nl  Thu Sep 23 13:49:56 2021
From: belle at bazuin.nl (=?windows-1252?Q?L.P.H._van_Belle?=)
Date: Thu, 23 Sep 2021 15:49:56 +0200
Subject: [squid-users] net err cert validity too long - chrome/safari
In-Reply-To: <CAGU_Ci+dy9+BAm6aoOSxinfnJjAw3c2z+LuTab5Mdp5qe1_HNA@mail.gmail.com>
References: <CAGU_Ci+dy9+BAm6aoOSxinfnJjAw3c2z+LuTab5Mdp5qe1_HNA@mail.gmail.com>
Message-ID: <vmime.614c8604.1d0.53f4921c5da46c44@ms249-lin-003.rotterdam.bazuin.nl>

sadly yes.. 

https://chromium.googlesource.com/chromium/src/+/HEAD/net/docs/certificate_lifetimes.md


Van: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] Namens robert k Wild
Verzonden: donderdag 23 september 2021 14:53
Aan: squid-users at lists.squid-cache.org
Onderwerp: [squid-users] net err cert validity too long - chrome/safari



hi all,


i get this error on chrome and safari, when i access the same website on firefox i get the proxy error page as i havnt whitelisted this site, when i whitelist it, i can get on the website on all three diff browsers and when i take it off the whitelist exactly the same before


i have googled and its because my cert is too long age, i made it 999 days and i find out now it should be longer than 397 days


is this correct?


thanks,
rob


-- 
Regards, 

Robert K Wild.




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210923/06febc5c/attachment.htm>

From rousskov at measurement-factory.com  Thu Sep 23 14:46:41 2021
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Thu, 23 Sep 2021 10:46:41 -0400
Subject: [squid-users] net err cert validity too long - chrome/safari
In-Reply-To: <vmime.614c8604.1d0.53f4921c5da46c44@ms249-lin-003.rotterdam.bazuin.nl>
References: <CAGU_Ci+dy9+BAm6aoOSxinfnJjAw3c2z+LuTab5Mdp5qe1_HNA@mail.gmail.com>
 <vmime.614c8604.1d0.53f4921c5da46c44@ms249-lin-003.rotterdam.bazuin.nl>
Message-ID: <19f84a7e-2a86-745e-9d63-ebe472d0eed4@measurement-factory.com>

On 9/23/21 9:49 AM, L.P.H. van Belle wrote:
> sadly yes..
> https://chromium.googlesource.com/chromium/src/+/HEAD/net/docs/certificate_lifetimes.md

AFAICT, the above article says that Chrome only applies the 398-day
restriction to certificates signed by CAs that are trusted in a
_default_ installation of Chrome (i.e. the so called "publicly trusted
CAs"). Rob's custom CA is not one of those publicly trusted CAs.

Evidently, either the 398-day restriction is now applied to more
situations than those described in the article OR Rob has circumvented
Crhome's idea of "publicly trusted CAs".

Alex.

>     ------------------------------------------------------------------------
>     *Van:* squid-users
>     [mailto:squid-users-bounces at lists.squid-cache.org] *Namens *robert k
>     Wild
>     *Verzonden:* donderdag 23 september 2021 14:53
>     *Aan:* squid-users at lists.squid-cache.org
>     *Onderwerp:* [squid-users] net err cert validity too long -
>     chrome/safari
> 
>     hi all,
> 
>     i get this error on chrome and safari, when i access the same
>     website on firefox i get the proxy error page as i havnt whitelisted
>     this site, when i whitelist it, i can get on the website on all
>     three diff browsers and when i take it off the whitelist exactly the
>     same before
> 
>     i have googled and its because my cert is too long age, i made it
>     999 days and i find out now it should be longer than 397 days
> 
>     is this correct?
> 
>     thanks,
>     rob
> 
>     -- 
>     Regards,
> 
>     Robert K Wild.
> 
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 



From robertkwild at gmail.com  Thu Sep 23 16:35:29 2021
From: robertkwild at gmail.com (robert k Wild)
Date: Thu, 23 Sep 2021 17:35:29 +0100
Subject: [squid-users] net err cert validity too long - chrome/safari
In-Reply-To: <19f84a7e-2a86-745e-9d63-ebe472d0eed4@measurement-factory.com>
References: <CAGU_Ci+dy9+BAm6aoOSxinfnJjAw3c2z+LuTab5Mdp5qe1_HNA@mail.gmail.com>
 <vmime.614c8604.1d0.53f4921c5da46c44@ms249-lin-003.rotterdam.bazuin.nl>
 <19f84a7e-2a86-745e-9d63-ebe472d0eed4@measurement-factory.com>
Message-ID: <CAGU_Ci+UHHPYNpMRwE624fmK8e5haPaGXC-Gs22FLYCbO4KLRA@mail.gmail.com>

Thanks Alex ?

On Thu, 23 Sep 2021, 15:46 Alex Rousskov, <rousskov at measurement-factory.com>
wrote:

> On 9/23/21 9:49 AM, L.P.H. van Belle wrote:
> > sadly yes..
> >
> https://chromium.googlesource.com/chromium/src/+/HEAD/net/docs/certificate_lifetimes.md
>
> AFAICT, the above article says that Chrome only applies the 398-day
> restriction to certificates signed by CAs that are trusted in a
> _default_ installation of Chrome (i.e. the so called "publicly trusted
> CAs"). Rob's custom CA is not one of those publicly trusted CAs.
>
> Evidently, either the 398-day restriction is now applied to more
> situations than those described in the article OR Rob has circumvented
> Crhome's idea of "publicly trusted CAs".
>
> Alex.
>
> >
>  ------------------------------------------------------------------------
> >     *Van:* squid-users
> >     [mailto:squid-users-bounces at lists.squid-cache.org] *Namens *robert k
> >     Wild
> >     *Verzonden:* donderdag 23 september 2021 14:53
> >     *Aan:* squid-users at lists.squid-cache.org
> >     *Onderwerp:* [squid-users] net err cert validity too long -
> >     chrome/safari
> >
> >     hi all,
> >
> >     i get this error on chrome and safari, when i access the same
> >     website on firefox i get the proxy error page as i havnt whitelisted
> >     this site, when i whitelist it, i can get on the website on all
> >     three diff browsers and when i take it off the whitelist exactly the
> >     same before
> >
> >     i have googled and its because my cert is too long age, i made it
> >     999 days and i find out now it should be longer than 397 days
> >
> >     is this correct?
> >
> >     thanks,
> >     rob
> >
> >     --
> >     Regards,
> >
> >     Robert K Wild.
> >
> >
> > _______________________________________________
> > squid-users mailing list
> > squid-users at lists.squid-cache.org
> > http://lists.squid-cache.org/listinfo/squid-users
> >
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210923/33ea72c7/attachment.htm>

From myates61 at gmail.com  Fri Sep 24 21:09:52 2021
From: myates61 at gmail.com (Mike Yates)
Date: Fri, 24 Sep 2021 17:09:52 -0400
Subject: [squid-users] Sorry if this has been asked but I can't find an
 answer anywhere ...
Message-ID: <009101d7b188$84ee3030$8eca9090$@gmail.com>

I have a bunch of internal machines that do not have internet access and any one of them is sending api post requests to another system on prem and having no issues ?. 

 

Example would be  <https://fred.mydomain.com/api/event> https://fred.mydomain.com/api/event

 

Now the problem becomes the fred server is being moved to the cloud so the same  <https://fred.mydomain.com/api/event> https://fred.mydomain.com/api/event is still valid but none of my internal server can see fred and I don?t have access to the backend servers to change their api calls.

 

I have looked at various ways to configure this in squid and I?m afraid I?m a little lost on how my conf file should look..

 

Any suggestions would be very very welcome ..

 

Thanks in advance .. 

 

Mike 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210924/825e0d4d/attachment.htm>

From rousskov at measurement-factory.com  Fri Sep 24 21:18:31 2021
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Fri, 24 Sep 2021 17:18:31 -0400
Subject: [squid-users] Sorry if this has been asked but I can't find an
 answer anywhere ...
In-Reply-To: <009101d7b188$84ee3030$8eca9090$@gmail.com>
References: <009101d7b188$84ee3030$8eca9090$@gmail.com>
Message-ID: <ef4b516c-4412-8355-16ca-c303c83ab368@measurement-factory.com>

On 9/24/21 5:09 PM, Mike Yates wrote:
> I have a bunch of internal machines that do not have internet access and
> any one of them is sending api post requests to another system on prem
> and having no issues ?.
> 
> ?
> 
> Example would be https://fred.mydomain.com/api/event
> 
> ?
> 
> Now the problem becomes the fred server is being moved to the cloud so
> the same https://fred.mydomain.com/api/event is still valid but none of my
> internal server can see fred and I don?t have access to the backend
> servers to change their api calls.

AFAICT from your summary, "moved to cloud" here means that the API
protocol stays the same, the API server domain name stays the same, the
API URL path stays the same, but the IP address of that domain name will
change. Please clarify if that conclusion is wrong.

If it is correct, then it is not clear how the change of an IP address
would affect those making API requests using the domain name, and what
role Squid is playing here.

Alex.


From myates61 at gmail.com  Fri Sep 24 21:26:01 2021
From: myates61 at gmail.com (Mike Yates)
Date: Fri, 24 Sep 2021 17:26:01 -0400
Subject: [squid-users] Sorry if this has been asked but I can't find an
 answer anywhere ...
In-Reply-To: <ef4b516c-4412-8355-16ca-c303c83ab368@measurement-factory.com>
References: <009101d7b188$84ee3030$8eca9090$@gmail.com>
 <ef4b516c-4412-8355-16ca-c303c83ab368@measurement-factory.com>
Message-ID: <CAPqnvd=4QfFrGOK_uUidwgMbOfvhSCVnqCR2Yn0y4SepZguhHw@mail.gmail.com>

Ok so let's say the new server outside the dmz has a different name. I need
a squid server configuration that will just forward the api calls to an
external address.  So my internal servers will still point to Fred ( which
is now a squid server and has access to the outside world) and will then
forward the requests to the new server I have in the cloud.  Long story
short I just need a pass through squid server.

On Fri, Sep 24, 2021, 17:18 Alex Rousskov <rousskov at measurement-factory.com>
wrote:

> On 9/24/21 5:09 PM, Mike Yates wrote:
> > I have a bunch of internal machines that do not have internet access and
> > any one of them is sending api post requests to another system on prem
> > and having no issues ?.
> >
> >
> >
> > Example would be https://fred.mydomain.com/api/event
> >
> >
> >
> > Now the problem becomes the fred server is being moved to the cloud so
> > the same https://fred.mydomain.com/api/event is still valid but none of
> my
> > internal server can see fred and I don?t have access to the backend
> > servers to change their api calls.
>
> AFAICT from your summary, "moved to cloud" here means that the API
> protocol stays the same, the API server domain name stays the same, the
> API URL path stays the same, but the IP address of that domain name will
> change. Please clarify if that conclusion is wrong.
>
> If it is correct, then it is not clear how the change of an IP address
> would affect those making API requests using the domain name, and what
> role Squid is playing here.
>
> Alex.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210924/b9e8b96a/attachment.htm>

From gtaylor at tnetconsulting.net  Fri Sep 24 21:27:02 2021
From: gtaylor at tnetconsulting.net (Grant Taylor)
Date: Fri, 24 Sep 2021 15:27:02 -0600
Subject: [squid-users] Sorry if this has been asked but I can't find an
 answer anywhere ...
In-Reply-To: <ef4b516c-4412-8355-16ca-c303c83ab368@measurement-factory.com>
References: <009101d7b188$84ee3030$8eca9090$@gmail.com>
 <ef4b516c-4412-8355-16ca-c303c83ab368@measurement-factory.com>
Message-ID: <ac434610-7f5a-25c7-9c27-1aca17444be7@spamtrap.tnetconsulting.net>

On 9/24/21 3:18 PM, Alex Rousskov wrote:
> If it is correct, then it is not clear how the change of an IP address 
> would affect those making API requests using the domain name, and 
> what role Squid is playing here.

To build on Alex's good question, are the API client's sending the API 
calls /through/ Squid?  Or are they configured to bypass Squid?

The mechanism the client's use seems extremely germane here.  E.g. if 
the client's are configured to bypass the proxy for fred.mydomain.com. 
Or if client's use Squid and Squid has been configured to access 
fred.mydomain.com on behalf of clients, and how.

We need more information to be able to say anything meaningful, much 
less helpful.



-- 
Grant. . . .
unix || die

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4013 bytes
Desc: S/MIME Cryptographic Signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210924/a6058709/attachment.bin>

From gtaylor at tnetconsulting.net  Fri Sep 24 21:59:08 2021
From: gtaylor at tnetconsulting.net (Grant Taylor)
Date: Fri, 24 Sep 2021 15:59:08 -0600
Subject: [squid-users] Sorry if this has been asked but I can't find an
 answer anywhere ...
In-Reply-To: <CAPqnvd=4QfFrGOK_uUidwgMbOfvhSCVnqCR2Yn0y4SepZguhHw@mail.gmail.com>
References: <009101d7b188$84ee3030$8eca9090$@gmail.com>
 <ef4b516c-4412-8355-16ca-c303c83ab368@measurement-factory.com>
 <CAPqnvd=4QfFrGOK_uUidwgMbOfvhSCVnqCR2Yn0y4SepZguhHw@mail.gmail.com>
Message-ID: <75c7f5a2-da8e-77d0-6ee2-6db4e69c45da@spamtrap.tnetconsulting.net>

On 9/24/21 3:26 PM, Mike Yates wrote:
> Ok so let's say the new server outside the dmz has a different name.

Are you going to re-configure the clients to use the new / different 
name?  Or do you need to re-configure either the intermediate Squid or 
the target; Fred, also running squid, to translate from the old API 
hostname to the new / different hostname?

> I need a squid server configuration that will just forward the api 
> calls to an external address.  So my internal servers will still point 
> to Fred ( which is now a squid server and has access to the outside 
> world) and will then forward the requests to the new server I have in 
> the cloud.

Are there two Squid servers in play now that Fred is running Squid?

Is there a proxy server, Squid or otherwise, between clients and Fred? 
Or is Fred the Squid server that you were referencing in your emails?

> Long story short I just need a pass through squid server.

I suspect you might need to do more than simply pass the requests 
through.  It sounds to me like you need to translates requests for 
https://fred.mydomain.com/api/event to https://dmz.mydomain.com/api/event.

It seems to me like you are going to want to configure Squid on Fred to 
act as a Reverse Proxy (Accelerator).

Link - Reverse Proxy Mode
  - https://wiki.squid-cache.org/SquidFaq/ReverseProxy



-- 
Grant. . . .
unix || die

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4013 bytes
Desc: S/MIME Cryptographic Signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210924/13195f2f/attachment.bin>

From rousskov at measurement-factory.com  Fri Sep 24 22:01:45 2021
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Fri, 24 Sep 2021 18:01:45 -0400
Subject: [squid-users] Sorry if this has been asked but I can't find an
 answer anywhere ...
In-Reply-To: <CAPqnvd=4QfFrGOK_uUidwgMbOfvhSCVnqCR2Yn0y4SepZguhHw@mail.gmail.com>
References: <009101d7b188$84ee3030$8eca9090$@gmail.com>
 <ef4b516c-4412-8355-16ca-c303c83ab368@measurement-factory.com>
 <CAPqnvd=4QfFrGOK_uUidwgMbOfvhSCVnqCR2Yn0y4SepZguhHw@mail.gmail.com>
Message-ID: <c86d051d-f556-50e1-863f-a151b90133f2@measurement-factory.com>

On 9/24/21 5:26 PM, Mike Yates wrote:
> Ok so let's say the new server outside the dmz has a different name. I
> need a squid server configuration that will just forward the api calls
> to an external address.? So my internal servers will still point to Fred
> ( which is now a squid server and has access to the outside world) and
> will then forward the requests to the new server I have in the cloud.?
> Long story short I just need a pass through squid server.? ?

Will those internal servers trust the certificate you configure Squid
with? In your example, you used "https://...". That usually means the
internal servers are going to validate the server certificate. Can you
make them trust the Squid certificate? Or does the API communication
have to be signed by a fred.mydomain.com certificate that you do not
control?

The other pending question is whether those internal servers are
configured to use a proxy (see the previous email on this thread) or
always talk directly to (what they think is) the API service?

Alex.


> On Fri, Sep 24, 2021, 17:18 Alex Rousskov wrote:
> 
>     On 9/24/21 5:09 PM, Mike Yates wrote:
>     > I have a bunch of internal machines that do not have internet
>     access and
>     > any one of them is sending api post requests to another system on prem
>     > and having no issues ?.
>     >
>     > ?
>     >
>     > Example would be https://fred.mydomain.com/api/event
>     <https://fred.mydomain.com/api/event>
>     >
>     > ?
>     >
>     > Now the problem becomes the fred server is being moved to the cloud so
>     > the same https://fred.mydomain.com/api/event
>     <https://fred.mydomain.com/api/event> is still valid but none of my
>     > internal server can see fred and I don?t have access to the backend
>     > servers to change their api calls.
> 
>     AFAICT from your summary, "moved to cloud" here means that the API
>     protocol stays the same, the API server domain name stays the same, the
>     API URL path stays the same, but the IP address of that domain name will
>     change. Please clarify if that conclusion is wrong.
> 
>     If it is correct, then it is not clear how the change of an IP address
>     would affect those making API requests using the domain name, and what
>     role Squid is playing here.
> 
>     Alex.
> 



From myates61 at gmail.com  Sat Sep 25 09:23:56 2021
From: myates61 at gmail.com (Mike Yates)
Date: Sat, 25 Sep 2021 05:23:56 -0400
Subject: [squid-users] Sorry if this has been asked but I can't find an
 answer anywhere ...
In-Reply-To: <c86d051d-f556-50e1-863f-a151b90133f2@measurement-factory.com>
References: <009101d7b188$84ee3030$8eca9090$@gmail.com>
 <ef4b516c-4412-8355-16ca-c303c83ab368@measurement-factory.com>
 <CAPqnvd=4QfFrGOK_uUidwgMbOfvhSCVnqCR2Yn0y4SepZguhHw@mail.gmail.com>
 <c86d051d-f556-50e1-863f-a151b90133f2@measurement-factory.com>
Message-ID: <CAPqnvdmp=M=BvgRT8bvD9J+QmFHEyDzuq0N+_BHued-OZ216FQ@mail.gmail.com>

There are no certificates to worry about, the api is expecting a token to
be included in the payload of the call.   So all squid needs to do is
accept the post from the internal server and pass that post to the external
servers url including the payload.

I hope that helps.

On Fri, Sep 24, 2021, 18:01 Alex Rousskov <rousskov at measurement-factory.com>
wrote:

> On 9/24/21 5:26 PM, Mike Yates wrote:
> > Ok so let's say the new server outside the dmz has a different name. I
> > need a squid server configuration that will just forward the api calls
> > to an external address.  So my internal servers will still point to Fred
> > ( which is now a squid server and has access to the outside world) and
> > will then forward the requests to the new server I have in the cloud.
> > Long story short I just need a pass through squid server.
>
> Will those internal servers trust the certificate you configure Squid
> with? In your example, you used "https://...". That usually means the
> internal servers are going to validate the server certificate. Can you
> make them trust the Squid certificate? Or does the API communication
> have to be signed by a fred.mydomain.com certificate that you do not
> control?
>
> The other pending question is whether those internal servers are
> configured to use a proxy (see the previous email on this thread) or
> always talk directly to (what they think is) the API service?
>
> Alex.
>
>
> > On Fri, Sep 24, 2021, 17:18 Alex Rousskov wrote:
> >
> >     On 9/24/21 5:09 PM, Mike Yates wrote:
> >     > I have a bunch of internal machines that do not have internet
> >     access and
> >     > any one of them is sending api post requests to another system on
> prem
> >     > and having no issues ?.
> >     >
> >     >
> >     >
> >     > Example would be https://fred.mydomain.com/api/event
> >     <https://fred.mydomain.com/api/event>
> >     >
> >     >
> >     >
> >     > Now the problem becomes the fred server is being moved to the
> cloud so
> >     > the same https://fred.mydomain.com/api/event
> >     <https://fred.mydomain.com/api/event> is still valid but none of my
> >     > internal server can see fred and I don?t have access to the backend
> >     > servers to change their api calls.
> >
> >     AFAICT from your summary, "moved to cloud" here means that the API
> >     protocol stays the same, the API server domain name stays the same,
> the
> >     API URL path stays the same, but the IP address of that domain name
> will
> >     change. Please clarify if that conclusion is wrong.
> >
> >     If it is correct, then it is not clear how the change of an IP
> address
> >     would affect those making API requests using the domain name, and
> what
> >     role Squid is playing here.
> >
> >     Alex.
> >
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210925/500011ee/attachment.htm>

From rousskov at measurement-factory.com  Sat Sep 25 15:55:55 2021
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Sat, 25 Sep 2021 11:55:55 -0400
Subject: [squid-users] Sorry if this has been asked but I can't find an
 answer anywhere ...
In-Reply-To: <CAPqnvdmp=M=BvgRT8bvD9J+QmFHEyDzuq0N+_BHued-OZ216FQ@mail.gmail.com>
References: <009101d7b188$84ee3030$8eca9090$@gmail.com>
 <ef4b516c-4412-8355-16ca-c303c83ab368@measurement-factory.com>
 <CAPqnvd=4QfFrGOK_uUidwgMbOfvhSCVnqCR2Yn0y4SepZguhHw@mail.gmail.com>
 <c86d051d-f556-50e1-863f-a151b90133f2@measurement-factory.com>
 <CAPqnvdmp=M=BvgRT8bvD9J+QmFHEyDzuq0N+_BHued-OZ216FQ@mail.gmail.com>
Message-ID: <fdcbb748-9b5e-43b7-dd68-2e747f96098c@measurement-factory.com>

On 9/25/21 5:23 AM, Mike Yates wrote:
> There are no certificates to worry about, the api is expecting a token
> to be included in the payload of the call.? ?So all squid needs to do is
> accept the post from the internal server and pass that post to the
> external servers url including the payload.??

> I hope that helps.??

Not yet. Forget about payload for a second. Our problems are still at a
much higher level: In your examples, you used https://... URLs. Do
internal servers make HTTPS requests (i.e. HTTP requests over SSL/TLS
connections)? If yes, then why are you saying that there are no
certificates to worry about? TLS connections normally involve
certificate validation!..

Perhaps those internal servers make plain HTTP requests, and you used
"https://..." URLs in your examples by accident?

BTW, if you do not know the answers to some of the questions, please
just say so -- there is nothing wrong with that. If you can share a
small packet capture of a single request/response (in libpcap format),
that may reduce the number of questions we have to ask.

Alex.


> On Fri, Sep 24, 2021, 18:01 Alex Rousskov wrote:
> 
>     On 9/24/21 5:26 PM, Mike Yates wrote:
>     > Ok so let's say the new server outside the dmz has a different name. I
>     > need a squid server configuration that will just forward the api calls
>     > to an external address.? So my internal servers will still point
>     to Fred
>     > ( which is now a squid server and has access to the outside world) and
>     > will then forward the requests to the new server I have in the cloud.?
>     > Long story short I just need a pass through squid server.? ?
> 
>     Will those internal servers trust the certificate you configure Squid
>     with? In your example, you used "https://...". That usually means the
>     internal servers are going to validate the server certificate. Can you
>     make them trust the Squid certificate? Or does the API communication
>     have to be signed by a fred.mydomain.com <http://fred.mydomain.com>
>     certificate that you do not
>     control?
> 
>     The other pending question is whether those internal servers are
>     configured to use a proxy (see the previous email on this thread) or
>     always talk directly to (what they think is) the API service?
> 
>     Alex.
> 
> 
>     > On Fri, Sep 24, 2021, 17:18 Alex Rousskov wrote:
>     >
>     >? ? ?On 9/24/21 5:09 PM, Mike Yates wrote:
>     >? ? ?> I have a bunch of internal machines that do not have internet
>     >? ? ?access and
>     >? ? ?> any one of them is sending api post requests to another
>     system on prem
>     >? ? ?> and having no issues ?.
>     >? ? ?>
>     >? ? ?> ?
>     >? ? ?>
>     >? ? ?> Example would be https://fred.mydomain.com/api/event
>     <https://fred.mydomain.com/api/event>
>     >? ? ?<https://fred.mydomain.com/api/event
>     <https://fred.mydomain.com/api/event>>
>     >? ? ?>
>     >? ? ?> ?
>     >? ? ?>
>     >? ? ?> Now the problem becomes the fred server is being moved to
>     the cloud so
>     >? ? ?> the same https://fred.mydomain.com/api/event
>     <https://fred.mydomain.com/api/event>
>     >? ? ?<https://fred.mydomain.com/api/event
>     <https://fred.mydomain.com/api/event>> is still valid but none of my
>     >? ? ?> internal server can see fred and I don?t have access to the
>     backend
>     >? ? ?> servers to change their api calls.
>     >
>     >? ? ?AFAICT from your summary, "moved to cloud" here means that the API
>     >? ? ?protocol stays the same, the API server domain name stays the
>     same, the
>     >? ? ?API URL path stays the same, but the IP address of that domain
>     name will
>     >? ? ?change. Please clarify if that conclusion is wrong.
>     >
>     >? ? ?If it is correct, then it is not clear how the change of an IP
>     address
>     >? ? ?would affect those making API requests using the domain name,
>     and what
>     >? ? ?role Squid is playing here.
>     >
>     >? ? ?Alex.
>     >
> 



From ngtech1ltd at gmail.com  Sun Sep 26 06:09:29 2021
From: ngtech1ltd at gmail.com (Eliezer Croitoru)
Date: Sun, 26 Sep 2021 09:09:29 +0300
Subject: [squid-users] About Squid 4, AD, Kerberos and AD group auth.
In-Reply-To: <CAMXef5LMRweefGMbKxRuK50PQJ=gMv=a-663NO6Lnc3ancKsdw@mail.gmail.com>
References: <CAMXef5+4dDPQ2GhtJByKOE9KhHpV9HNpV11WUOaxjzc6=nd_4Q@mail.gmail.com>
 <d09be236-b4fc-40ce-c325-87abc29b2454@treenet.co.nz>
 <CAMXef5LMRweefGMbKxRuK50PQJ=gMv=a-663NO6Lnc3ancKsdw@mail.gmail.com>
Message-ID: <007601d7b29d$1217d3c0$36477b40$@gmail.com>

Hey,

 

Have you tried these instructions:

https://support.kaspersky.com/KWTS/6.1/en-US/166336.htm

 

Eliezer

 

From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Hernan Saltiel
Sent: Monday, September 20, 2021 16:17
To: Amos Jeffries <squid3 at treenet.co.nz>
Cc: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] About Squid 4, AD, Kerberos and AD group auth.

 

Hi Amos!

Thanks a lot for your response.

I already checked this page, it talks about using negotiate_kerberos_auth when having Squid 3.2 or newer, but there is no place in the document with an example about how to use it. 

Then I went to the manpage for this command (negotiate_kerberos_auth man page - squid | ManKier <https://www.mankier.com/8/negotiate_kerberos_auth> ), where I can see three lines talking about how to add this to squid.conf. But I don't know if I do need to follow a procedure to configure winbind, Samba, or any other thing, and how to configure squid.conf to work with groups, and their permissions. 

Is there any place with full examples on using that config?

Thanks again, and best regards,

 

HeCSa.

 

 

 

On Mon, Sep 20, 2021 at 3:10 AM Amos Jeffries <squid3 at treenet.co.nz <mailto:squid3 at treenet.co.nz> > wrote:

On 20/09/21 5:32 am, Hernan Saltiel wrote:
>      If you know about this, and can point me out to some URL I'm not 
> seeing, I'll thank you.

Please see the FAQ written by that helpers author
<https://wiki.squid-cache.org/ConfigExamples/Authenticate/Kerberos>


Amos
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> 
http://lists.squid-cache.org/listinfo/squid-users




 

-- 

HeCSa

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210926/7abb028d/attachment.htm>

From hsaltiel at gmail.com  Sun Sep 26 12:15:33 2021
From: hsaltiel at gmail.com (Hernan Saltiel)
Date: Sun, 26 Sep 2021 09:15:33 -0300
Subject: [squid-users] About Squid 4, AD, Kerberos and AD group auth.
In-Reply-To: <007601d7b29d$1217d3c0$36477b40$@gmail.com>
References: <CAMXef5+4dDPQ2GhtJByKOE9KhHpV9HNpV11WUOaxjzc6=nd_4Q@mail.gmail.com>
 <d09be236-b4fc-40ce-c325-87abc29b2454@treenet.co.nz>
 <CAMXef5LMRweefGMbKxRuK50PQJ=gMv=a-663NO6Lnc3ancKsdw@mail.gmail.com>
 <007601d7b29d$1217d3c0$36477b40$@gmail.com>
Message-ID: <CAMXef5+dmoqRzOghSxUyiuQ+hqvxgiPUOJcWGRubiRsWF8MruA@mail.gmail.com>

Hi Eli?zer,

I tried this article, sent to me by Jos? Rodriguez, and after just a few
adjustments, worked like a charm:
https://www.sysadminsdecuba.com/2019/10/intergracion-de-squid-kerberos-con-samba4-como-addc/

Thanks a lot and best regards,

HeCSa.



On Sun, Sep 26, 2021, 03:09 Eliezer Croitoru <ngtech1ltd at gmail.com> wrote:

> Hey,
>
>
>
> Have you tried these instructions:
>
> https://support.kaspersky.com/KWTS/6.1/en-US/166336.htm
>
>
>
> Eliezer
>
>
>
> *From:* squid-users <squid-users-bounces at lists.squid-cache.org> *On
> Behalf Of *Hernan Saltiel
> *Sent:* Monday, September 20, 2021 16:17
> *To:* Amos Jeffries <squid3 at treenet.co.nz>
> *Cc:* squid-users at lists.squid-cache.org
> *Subject:* Re: [squid-users] About Squid 4, AD, Kerberos and AD group
> auth.
>
>
>
> Hi Amos!
>
> Thanks a lot for your response.
>
> I already checked this page, it talks about using negotiate_kerberos_auth
> when having Squid 3.2 or newer, but there is no place in the document with
> an example about how to use it.
>
> Then I went to the manpage for this command (negotiate_kerberos_auth man
> page - squid | ManKier <https://www.mankier.com/8/negotiate_kerberos_auth>),
> where I can see three lines talking about how to add this to squid.conf.
> But I don't know if I do need to follow a procedure to configure winbind,
> Samba, or any other thing, and how to configure squid.conf to work with
> groups, and their permissions.
>
> Is there any place with full examples on using that config?
>
> Thanks again, and best regards,
>
>
>
> HeCSa.
>
>
>
>
>
>
>
> On Mon, Sep 20, 2021 at 3:10 AM Amos Jeffries <squid3 at treenet.co.nz>
> wrote:
>
> On 20/09/21 5:32 am, Hernan Saltiel wrote:
> >      If you know about this, and can point me out to some URL I'm not
> > seeing, I'll thank you.
>
> Please see the FAQ written by that helpers author
> <https://wiki.squid-cache.org/ConfigExamples/Authenticate/Kerberos>
>
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
>
>
>
> --
>
> HeCSa
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210926/3b029a92/attachment.htm>

From ngtech1ltd at gmail.com  Mon Sep 27 11:13:30 2021
From: ngtech1ltd at gmail.com (Eliezer Croitoru)
Date: Mon, 27 Sep 2021 14:13:30 +0300
Subject: [squid-users] About Squid 4, AD, Kerberos and AD group auth.
In-Reply-To: <CAMXef5+dmoqRzOghSxUyiuQ+hqvxgiPUOJcWGRubiRsWF8MruA@mail.gmail.com>
References: <CAMXef5+4dDPQ2GhtJByKOE9KhHpV9HNpV11WUOaxjzc6=nd_4Q@mail.gmail.com>
 <d09be236-b4fc-40ce-c325-87abc29b2454@treenet.co.nz>
 <CAMXef5LMRweefGMbKxRuK50PQJ=gMv=a-663NO6Lnc3ancKsdw@mail.gmail.com>
 <007601d7b29d$1217d3c0$36477b40$@gmail.com>
 <CAMXef5+dmoqRzOghSxUyiuQ+hqvxgiPUOJcWGRubiRsWF8MruA@mail.gmail.com>
Message-ID: <009601d7b390$b4c54a50$1e4fdef0$@gmail.com>

Thanks,

 

I am looking for an English guide.

I am not to familiar with the language of the guide in the link.

 

Eliezer

 

From: Hernan Saltiel <hsaltiel at gmail.com> 
Sent: Sunday, September 26, 2021 15:16
To: Eliezer Croitoru <ngtech1ltd at gmail.com>
Cc: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] About Squid 4, AD, Kerberos and AD group auth.

 

Hi Eli?zer,

 

I tried this article, sent to me by Jos? Rodriguez, and after just a few adjustments, worked like a charm: https://www.sysadminsdecuba.com/2019/10/intergracion-de-squid-kerberos-con-samba4-como-addc/

 

Thanks a lot and best regards,

 

HeCSa.

 

 

 

On Sun, Sep 26, 2021, 03:09 Eliezer Croitoru <ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> > wrote:

Hey,

 

Have you tried these instructions:

https://support.kaspersky.com/KWTS/6.1/en-US/166336.htm

 

Eliezer

 

From: squid-users <squid-users-bounces at lists.squid-cache.org <mailto:squid-users-bounces at lists.squid-cache.org> > On Behalf Of Hernan Saltiel
Sent: Monday, September 20, 2021 16:17
To: Amos Jeffries <squid3 at treenet.co.nz <mailto:squid3 at treenet.co.nz> >
Cc: squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> 
Subject: Re: [squid-users] About Squid 4, AD, Kerberos and AD group auth.

 

Hi Amos!

Thanks a lot for your response.

I already checked this page, it talks about using negotiate_kerberos_auth when having Squid 3.2 or newer, but there is no place in the document with an example about how to use it. 

Then I went to the manpage for this command (negotiate_kerberos_auth man page - squid | ManKier <https://www.mankier.com/8/negotiate_kerberos_auth> ), where I can see three lines talking about how to add this to squid.conf. But I don't know if I do need to follow a procedure to configure winbind, Samba, or any other thing, and how to configure squid.conf to work with groups, and their permissions. 

Is there any place with full examples on using that config?

Thanks again, and best regards,

 

HeCSa.

 

 

 

On Mon, Sep 20, 2021 at 3:10 AM Amos Jeffries <squid3 at treenet.co.nz <mailto:squid3 at treenet.co.nz> > wrote:

On 20/09/21 5:32 am, Hernan Saltiel wrote:
>      If you know about this, and can point me out to some URL I'm not 
> seeing, I'll thank you.

Please see the FAQ written by that helpers author
<https://wiki.squid-cache.org/ConfigExamples/Authenticate/Kerberos>


Amos
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> 
http://lists.squid-cache.org/listinfo/squid-users




 

-- 

HeCSa

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210927/d3f948c5/attachment.htm>

From myates61 at gmail.com  Mon Sep 27 12:44:16 2021
From: myates61 at gmail.com (Mike Yates)
Date: Mon, 27 Sep 2021 08:44:16 -0400
Subject: [squid-users] Sorry if this has been asked but I can't find an
 answer anywhere ...
In-Reply-To: <fdcbb748-9b5e-43b7-dd68-2e747f96098c@measurement-factory.com>
References: <009101d7b188$84ee3030$8eca9090$@gmail.com>
 <ef4b516c-4412-8355-16ca-c303c83ab368@measurement-factory.com>
 <CAPqnvd=4QfFrGOK_uUidwgMbOfvhSCVnqCR2Yn0y4SepZguhHw@mail.gmail.com>
 <c86d051d-f556-50e1-863f-a151b90133f2@measurement-factory.com>
 <CAPqnvdmp=M=BvgRT8bvD9J+QmFHEyDzuq0N+_BHued-OZ216FQ@mail.gmail.com>
 <fdcbb748-9b5e-43b7-dd68-2e747f96098c@measurement-factory.com>
Message-ID: <CAPqnvdk0aXr98aEpbZxmOnhND=DMfHOQ47zP2rJ8H_sA2nvNQA@mail.gmail.com>

Sorry Alex but if using postman I just post to the internal URL with no
certificates and everything works fine. All I'm trying to do is post to the
squid server that will then redirect the post to the external url.  Its
that simple ..

On Sat, Sep 25, 2021 at 11:55 AM Alex Rousskov <
rousskov at measurement-factory.com> wrote:

> On 9/25/21 5:23 AM, Mike Yates wrote:
> > There are no certificates to worry about, the api is expecting a token
> > to be included in the payload of the call.   So all squid needs to do is
> > accept the post from the internal server and pass that post to the
> > external servers url including the payload.
>
> > I hope that helps.
>
> Not yet. Forget about payload for a second. Our problems are still at a
> much higher level: In your examples, you used https://... URLs. Do
> internal servers make HTTPS requests (i.e. HTTP requests over SSL/TLS
> connections)? If yes, then why are you saying that there are no
> certificates to worry about? TLS connections normally involve
> certificate validation!..
>
> Perhaps those internal servers make plain HTTP requests, and you used
> "https://..." URLs in your examples by accident?
>
> BTW, if you do not know the answers to some of the questions, please
> just say so -- there is nothing wrong with that. If you can share a
> small packet capture of a single request/response (in libpcap format),
> that may reduce the number of questions we have to ask.
>
> Alex.
>
>
> > On Fri, Sep 24, 2021, 18:01 Alex Rousskov wrote:
> >
> >     On 9/24/21 5:26 PM, Mike Yates wrote:
> >     > Ok so let's say the new server outside the dmz has a different
> name. I
> >     > need a squid server configuration that will just forward the api
> calls
> >     > to an external address.  So my internal servers will still point
> >     to Fred
> >     > ( which is now a squid server and has access to the outside world)
> and
> >     > will then forward the requests to the new server I have in the
> cloud.
> >     > Long story short I just need a pass through squid server.
> >
> >     Will those internal servers trust the certificate you configure Squid
> >     with? In your example, you used "https://...". That usually means
> the
> >     internal servers are going to validate the server certificate. Can
> you
> >     make them trust the Squid certificate? Or does the API communication
> >     have to be signed by a fred.mydomain.com <http://fred.mydomain.com>
> >     certificate that you do not
> >     control?
> >
> >     The other pending question is whether those internal servers are
> >     configured to use a proxy (see the previous email on this thread) or
> >     always talk directly to (what they think is) the API service?
> >
> >     Alex.
> >
> >
> >     > On Fri, Sep 24, 2021, 17:18 Alex Rousskov wrote:
> >     >
> >     >     On 9/24/21 5:09 PM, Mike Yates wrote:
> >     >     > I have a bunch of internal machines that do not have internet
> >     >     access and
> >     >     > any one of them is sending api post requests to another
> >     system on prem
> >     >     > and having no issues ?.
> >     >     >
> >     >     >
> >     >     >
> >     >     > Example would be https://fred.mydomain.com/api/event
> >     <https://fred.mydomain.com/api/event>
> >     >     <https://fred.mydomain.com/api/event
> >     <https://fred.mydomain.com/api/event>>
> >     >     >
> >     >     >
> >     >     >
> >     >     > Now the problem becomes the fred server is being moved to
> >     the cloud so
> >     >     > the same https://fred.mydomain.com/api/event
> >     <https://fred.mydomain.com/api/event>
> >     >     <https://fred.mydomain.com/api/event
> >     <https://fred.mydomain.com/api/event>> is still valid but none of my
> >     >     > internal server can see fred and I don?t have access to the
> >     backend
> >     >     > servers to change their api calls.
> >     >
> >     >     AFAICT from your summary, "moved to cloud" here means that the
> API
> >     >     protocol stays the same, the API server domain name stays the
> >     same, the
> >     >     API URL path stays the same, but the IP address of that domain
> >     name will
> >     >     change. Please clarify if that conclusion is wrong.
> >     >
> >     >     If it is correct, then it is not clear how the change of an IP
> >     address
> >     >     would affect those making API requests using the domain name,
> >     and what
> >     >     role Squid is playing here.
> >     >
> >     >     Alex.
> >     >
> >
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210927/23d79f7a/attachment.htm>

From myates61 at gmail.com  Mon Sep 27 12:52:34 2021
From: myates61 at gmail.com (Mike Yates)
Date: Mon, 27 Sep 2021 08:52:34 -0400
Subject: [squid-users] Sorry if this has been asked but I can't find an
 answer anywhere ...
In-Reply-To: <75c7f5a2-da8e-77d0-6ee2-6db4e69c45da@spamtrap.tnetconsulting.net>
References: <009101d7b188$84ee3030$8eca9090$@gmail.com>
 <ef4b516c-4412-8355-16ca-c303c83ab368@measurement-factory.com>
 <CAPqnvd=4QfFrGOK_uUidwgMbOfvhSCVnqCR2Yn0y4SepZguhHw@mail.gmail.com>
 <75c7f5a2-da8e-77d0-6ee2-6db4e69c45da@spamtrap.tnetconsulting.net>
Message-ID: <CAPqnvd=LDAzwC0CTJs=QAjexoo_L9pYRBkfoy0oAyRSixLtg8w@mail.gmail.com>

Hi Grant,

So my idea is to install a single squid server and redirect the internal
servers to that url instead of the original one. Squid will then redirect
the post to the correct external server asi it is installed on a server
that has external access  I hope this is possible

On Fri, Sep 24, 2021 at 5:59 PM Grant Taylor <gtaylor at tnetconsulting.net>
wrote:

> On 9/24/21 3:26 PM, Mike Yates wrote:
> > Ok so let's say the new server outside the dmz has a different name.
>
> Are you going to re-configure the clients to use the new / different
> name?  Or do you need to re-configure either the intermediate Squid or
> the target; Fred, also running squid, to translate from the old API
> hostname to the new / different hostname?
>
> > I need a squid server configuration that will just forward the api
> > calls to an external address.  So my internal servers will still point
> > to Fred ( which is now a squid server and has access to the outside
> > world) and will then forward the requests to the new server I have in
> > the cloud.
>
> Are there two Squid servers in play now that Fred is running Squid?
>
> Is there a proxy server, Squid or otherwise, between clients and Fred?
> Or is Fred the Squid server that you were referencing in your emails?
>
> > Long story short I just need a pass through squid server.
>
> I suspect you might need to do more than simply pass the requests
> through.  It sounds to me like you need to translates requests for
> https://fred.mydomain.com/api/event to https://dmz.mydomain.com/api/event.
>
> It seems to me like you are going to want to configure Squid on Fred to
> act as a Reverse Proxy (Accelerator).
>
> Link - Reverse Proxy Mode
>   - https://wiki.squid-cache.org/SquidFaq/ReverseProxy
>
>
>
> --
> Grant. . . .
> unix || die
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210927/be210518/attachment.htm>

From rousskov at measurement-factory.com  Mon Sep 27 13:23:31 2021
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Mon, 27 Sep 2021 09:23:31 -0400
Subject: [squid-users] Sorry if this has been asked but I can't find an
 answer anywhere ...
In-Reply-To: <CAPqnvdk0aXr98aEpbZxmOnhND=DMfHOQ47zP2rJ8H_sA2nvNQA@mail.gmail.com>
References: <009101d7b188$84ee3030$8eca9090$@gmail.com>
 <ef4b516c-4412-8355-16ca-c303c83ab368@measurement-factory.com>
 <CAPqnvd=4QfFrGOK_uUidwgMbOfvhSCVnqCR2Yn0y4SepZguhHw@mail.gmail.com>
 <c86d051d-f556-50e1-863f-a151b90133f2@measurement-factory.com>
 <CAPqnvdmp=M=BvgRT8bvD9J+QmFHEyDzuq0N+_BHued-OZ216FQ@mail.gmail.com>
 <fdcbb748-9b5e-43b7-dd68-2e747f96098c@measurement-factory.com>
 <CAPqnvdk0aXr98aEpbZxmOnhND=DMfHOQ47zP2rJ8H_sA2nvNQA@mail.gmail.com>
Message-ID: <0b2dfedd-d9b7-ae8b-b77b-ed06445cd48b@measurement-factory.com>

On 9/27/21 8:44 AM, Mike Yates wrote:

> Sorry Alex but if using postman I just post to the internal URL with no
> certificates and everything works fine. All I'm trying to do is post to
> the squid server that will then redirect the post to the external url.?
> Its that simple .. 

Unfortunately, since I am not familiar with postman, I cannot convert
the pending questions about protocols the server software uses into
questions about your postman configuration. Hopefully, somebody else on
the list can do that for you. We also need to make sure that what you do
in postman matches what your servers are actually doing (as far as
communication protocols are concerned) -- the API server may support
several protocols, and it is possible, at least in theory, that postman
tests use a different set of communication protocols compared to the
actual servers you need to handle.

Without answers to those pending (or similar) questions and without
traffic samples, it is very difficult to guess what is actually going on
in your environment. And without that knowledge, it is not clear how to
configure Squid to do what you want.

I know your environment sounds simple to you, but since you want more
than an "It is simple, just use Squid" answer, we need protocol-level
details to give specific advice.

Alex.

> On Sat, Sep 25, 2021 at 11:55 AM Alex Rousskov wrote:
> 
>     On 9/25/21 5:23 AM, Mike Yates wrote:
>     > There are no certificates to worry about, the api is expecting a token
>     > to be included in the payload of the call.? ?So all squid needs to
>     do is
>     > accept the post from the internal server and pass that post to the
>     > external servers url including the payload.??
> 
>     > I hope that helps.??
> 
>     Not yet. Forget about payload for a second. Our problems are still at a
>     much higher level: In your examples, you used https://... URLs. Do
>     internal servers make HTTPS requests (i.e. HTTP requests over SSL/TLS
>     connections)? If yes, then why are you saying that there are no
>     certificates to worry about? TLS connections normally involve
>     certificate validation!..
> 
>     Perhaps those internal servers make plain HTTP requests, and you used
>     "https://..." URLs in your examples by accident?
> 
>     BTW, if you do not know the answers to some of the questions, please
>     just say so -- there is nothing wrong with that. If you can share a
>     small packet capture of a single request/response (in libpcap format),
>     that may reduce the number of questions we have to ask.
> 
>     Alex.
> 
> 
>     > On Fri, Sep 24, 2021, 18:01 Alex Rousskov wrote:
>     >
>     >? ? ?On 9/24/21 5:26 PM, Mike Yates wrote:
>     >? ? ?> Ok so let's say the new server outside the dmz has a
>     different name. I
>     >? ? ?> need a squid server configuration that will just forward the
>     api calls
>     >? ? ?> to an external address.? So my internal servers will still point
>     >? ? ?to Fred
>     >? ? ?> ( which is now a squid server and has access to the outside
>     world) and
>     >? ? ?> will then forward the requests to the new server I have in
>     the cloud.?
>     >? ? ?> Long story short I just need a pass through squid server.? ?
>     >
>     >? ? ?Will those internal servers trust the certificate you
>     configure Squid
>     >? ? ?with? In your example, you used "https://...". That usually
>     means the
>     >? ? ?internal servers are going to validate the server certificate.
>     Can you
>     >? ? ?make them trust the Squid certificate? Or does the API
>     communication
>     >? ? ?have to be signed by a fred.mydomain.com
>     <http://fred.mydomain.com> <http://fred.mydomain.com
>     <http://fred.mydomain.com>>
>     >? ? ?certificate that you do not
>     >? ? ?control?
>     >
>     >? ? ?The other pending question is whether those internal servers are
>     >? ? ?configured to use a proxy (see the previous email on this
>     thread) or
>     >? ? ?always talk directly to (what they think is) the API service?
>     >
>     >? ? ?Alex.
>     >
>     >
>     >? ? ?> On Fri, Sep 24, 2021, 17:18 Alex Rousskov wrote:
>     >? ? ?>
>     >? ? ?>? ? ?On 9/24/21 5:09 PM, Mike Yates wrote:
>     >? ? ?>? ? ?> I have a bunch of internal machines that do not have
>     internet
>     >? ? ?>? ? ?access and
>     >? ? ?>? ? ?> any one of them is sending api post requests to another
>     >? ? ?system on prem
>     >? ? ?>? ? ?> and having no issues ?.
>     >? ? ?>? ? ?>
>     >? ? ?>? ? ?> ?
>     >? ? ?>? ? ?>
>     >? ? ?>? ? ?> Example would be https://fred.mydomain.com/api/event
>     <https://fred.mydomain.com/api/event>
>     >? ? ?<https://fred.mydomain.com/api/event
>     <https://fred.mydomain.com/api/event>>
>     >? ? ?>? ? ?<https://fred.mydomain.com/api/event
>     <https://fred.mydomain.com/api/event>
>     >? ? ?<https://fred.mydomain.com/api/event
>     <https://fred.mydomain.com/api/event>>>
>     >? ? ?>? ? ?>
>     >? ? ?>? ? ?> ?
>     >? ? ?>? ? ?>
>     >? ? ?>? ? ?> Now the problem becomes the fred server is being moved to
>     >? ? ?the cloud so
>     >? ? ?>? ? ?> the same https://fred.mydomain.com/api/event
>     <https://fred.mydomain.com/api/event>
>     >? ? ?<https://fred.mydomain.com/api/event
>     <https://fred.mydomain.com/api/event>>
>     >? ? ?>? ? ?<https://fred.mydomain.com/api/event
>     <https://fred.mydomain.com/api/event>
>     >? ? ?<https://fred.mydomain.com/api/event
>     <https://fred.mydomain.com/api/event>>> is still valid but none of my
>     >? ? ?>? ? ?> internal server can see fred and I don?t have access
>     to the
>     >? ? ?backend
>     >? ? ?>? ? ?> servers to change their api calls.
>     >? ? ?>
>     >? ? ?>? ? ?AFAICT from your summary, "moved to cloud" here means
>     that the API
>     >? ? ?>? ? ?protocol stays the same, the API server domain name
>     stays the
>     >? ? ?same, the
>     >? ? ?>? ? ?API URL path stays the same, but the IP address of that
>     domain
>     >? ? ?name will
>     >? ? ?>? ? ?change. Please clarify if that conclusion is wrong.
>     >? ? ?>
>     >? ? ?>? ? ?If it is correct, then it is not clear how the change of
>     an IP
>     >? ? ?address
>     >? ? ?>? ? ?would affect those making API requests using the domain
>     name,
>     >? ? ?and what
>     >? ? ?>? ? ?role Squid is playing here.
>     >? ? ?>
>     >? ? ?>? ? ?Alex.
>     >? ? ?>
>     >
> 



From myates61 at gmail.com  Mon Sep 27 13:32:07 2021
From: myates61 at gmail.com (Mike Yates)
Date: Mon, 27 Sep 2021 09:32:07 -0400
Subject: [squid-users] Sorry if this has been asked but I can't find an
 answer anywhere ...
In-Reply-To: <0b2dfedd-d9b7-ae8b-b77b-ed06445cd48b@measurement-factory.com>
References: <009101d7b188$84ee3030$8eca9090$@gmail.com>
 <ef4b516c-4412-8355-16ca-c303c83ab368@measurement-factory.com>
 <CAPqnvd=4QfFrGOK_uUidwgMbOfvhSCVnqCR2Yn0y4SepZguhHw@mail.gmail.com>
 <c86d051d-f556-50e1-863f-a151b90133f2@measurement-factory.com>
 <CAPqnvdmp=M=BvgRT8bvD9J+QmFHEyDzuq0N+_BHued-OZ216FQ@mail.gmail.com>
 <fdcbb748-9b5e-43b7-dd68-2e747f96098c@measurement-factory.com>
 <CAPqnvdk0aXr98aEpbZxmOnhND=DMfHOQ47zP2rJ8H_sA2nvNQA@mail.gmail.com>
 <0b2dfedd-d9b7-ae8b-b77b-ed06445cd48b@measurement-factory.com>
Message-ID: <CAPqnvd==HMiJFfvuBWcp2G303SJ4RHhYRybLFz2Yit9pCkKqYQ@mail.gmail.com>

  Thanks Alex,

Let me ask this then ....

I just want squid to redirect any requests (http for instance) to a
specific external url so for instance http://mysuidserver:80 to
http://externalserver:80 ...

Does that help ....

I'm just sure what is the minimal conf file I would need to achieve this
...

On Mon, Sep 27, 2021 at 9:23 AM Alex Rousskov <
rousskov at measurement-factory.com> wrote:

> On 9/27/21 8:44 AM, Mike Yates wrote:
>
> > Sorry Alex but if using postman I just post to the internal URL with no
> > certificates and everything works fine. All I'm trying to do is post to
> > the squid server that will then redirect the post to the external url.
> > Its that simple ..
>
> Unfortunately, since I am not familiar with postman, I cannot convert
> the pending questions about protocols the server software uses into
> questions about your postman configuration. Hopefully, somebody else on
> the list can do that for you. We also need to make sure that what you do
> in postman matches what your servers are actually doing (as far as
> communication protocols are concerned) -- the API server may support
> several protocols, and it is possible, at least in theory, that postman
> tests use a different set of communication protocols compared to the
> actual servers you need to handle.
>
> Without answers to those pending (or similar) questions and without
> traffic samples, it is very difficult to guess what is actually going on
> in your environment. And without that knowledge, it is not clear how to
> configure Squid to do what you want.
>
> I know your environment sounds simple to you, but since you want more
> than an "It is simple, just use Squid" answer, we need protocol-level
> details to give specific advice.
>
> Alex.
>
> > On Sat, Sep 25, 2021 at 11:55 AM Alex Rousskov wrote:
> >
> >     On 9/25/21 5:23 AM, Mike Yates wrote:
> >     > There are no certificates to worry about, the api is expecting a
> token
> >     > to be included in the payload of the call.   So all squid needs to
> >     do is
> >     > accept the post from the internal server and pass that post to the
> >     > external servers url including the payload.
> >
> >     > I hope that helps.
> >
> >     Not yet. Forget about payload for a second. Our problems are still
> at a
> >     much higher level: In your examples, you used https://... URLs. Do
> >     internal servers make HTTPS requests (i.e. HTTP requests over SSL/TLS
> >     connections)? If yes, then why are you saying that there are no
> >     certificates to worry about? TLS connections normally involve
> >     certificate validation!..
> >
> >     Perhaps those internal servers make plain HTTP requests, and you used
> >     "https://..." URLs in your examples by accident?
> >
> >     BTW, if you do not know the answers to some of the questions, please
> >     just say so -- there is nothing wrong with that. If you can share a
> >     small packet capture of a single request/response (in libpcap
> format),
> >     that may reduce the number of questions we have to ask.
> >
> >     Alex.
> >
> >
> >     > On Fri, Sep 24, 2021, 18:01 Alex Rousskov wrote:
> >     >
> >     >     On 9/24/21 5:26 PM, Mike Yates wrote:
> >     >     > Ok so let's say the new server outside the dmz has a
> >     different name. I
> >     >     > need a squid server configuration that will just forward the
> >     api calls
> >     >     > to an external address.  So my internal servers will still
> point
> >     >     to Fred
> >     >     > ( which is now a squid server and has access to the outside
> >     world) and
> >     >     > will then forward the requests to the new server I have in
> >     the cloud.
> >     >     > Long story short I just need a pass through squid server.
> >     >
> >     >     Will those internal servers trust the certificate you
> >     configure Squid
> >     >     with? In your example, you used "https://...". That usually
> >     means the
> >     >     internal servers are going to validate the server certificate.
> >     Can you
> >     >     make them trust the Squid certificate? Or does the API
> >     communication
> >     >     have to be signed by a fred.mydomain.com
> >     <http://fred.mydomain.com> <http://fred.mydomain.com
> >     <http://fred.mydomain.com>>
> >     >     certificate that you do not
> >     >     control?
> >     >
> >     >     The other pending question is whether those internal servers
> are
> >     >     configured to use a proxy (see the previous email on this
> >     thread) or
> >     >     always talk directly to (what they think is) the API service?
> >     >
> >     >     Alex.
> >     >
> >     >
> >     >     > On Fri, Sep 24, 2021, 17:18 Alex Rousskov wrote:
> >     >     >
> >     >     >     On 9/24/21 5:09 PM, Mike Yates wrote:
> >     >     >     > I have a bunch of internal machines that do not have
> >     internet
> >     >     >     access and
> >     >     >     > any one of them is sending api post requests to another
> >     >     system on prem
> >     >     >     > and having no issues ?.
> >     >     >     >
> >     >     >     >
> >     >     >     >
> >     >     >     > Example would be https://fred.mydomain.com/api/event
> >     <https://fred.mydomain.com/api/event>
> >     >     <https://fred.mydomain.com/api/event
> >     <https://fred.mydomain.com/api/event>>
> >     >     >     <https://fred.mydomain.com/api/event
> >     <https://fred.mydomain.com/api/event>
> >     >     <https://fred.mydomain.com/api/event
> >     <https://fred.mydomain.com/api/event>>>
> >     >     >     >
> >     >     >     >
> >     >     >     >
> >     >     >     > Now the problem becomes the fred server is being moved
> to
> >     >     the cloud so
> >     >     >     > the same https://fred.mydomain.com/api/event
> >     <https://fred.mydomain.com/api/event>
> >     >     <https://fred.mydomain.com/api/event
> >     <https://fred.mydomain.com/api/event>>
> >     >     >     <https://fred.mydomain.com/api/event
> >     <https://fred.mydomain.com/api/event>
> >     >     <https://fred.mydomain.com/api/event
> >     <https://fred.mydomain.com/api/event>>> is still valid but none of
> my
> >     >     >     > internal server can see fred and I don?t have access
> >     to the
> >     >     backend
> >     >     >     > servers to change their api calls.
> >     >     >
> >     >     >     AFAICT from your summary, "moved to cloud" here means
> >     that the API
> >     >     >     protocol stays the same, the API server domain name
> >     stays the
> >     >     same, the
> >     >     >     API URL path stays the same, but the IP address of that
> >     domain
> >     >     name will
> >     >     >     change. Please clarify if that conclusion is wrong.
> >     >     >
> >     >     >     If it is correct, then it is not clear how the change of
> >     an IP
> >     >     address
> >     >     >     would affect those making API requests using the domain
> >     name,
> >     >     and what
> >     >     >     role Squid is playing here.
> >     >     >
> >     >     >     Alex.
> >     >     >
> >     >
> >
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210927/92cb301e/attachment.htm>

From gtaylor at tnetconsulting.net  Mon Sep 27 20:36:56 2021
From: gtaylor at tnetconsulting.net (Grant Taylor)
Date: Mon, 27 Sep 2021 14:36:56 -0600
Subject: [squid-users] Sorry if this has been asked but I can't find an
 answer anywhere ...
In-Reply-To: <CAPqnvd==HMiJFfvuBWcp2G303SJ4RHhYRybLFz2Yit9pCkKqYQ@mail.gmail.com>
References: <009101d7b188$84ee3030$8eca9090$@gmail.com>
 <ef4b516c-4412-8355-16ca-c303c83ab368@measurement-factory.com>
 <CAPqnvd=4QfFrGOK_uUidwgMbOfvhSCVnqCR2Yn0y4SepZguhHw@mail.gmail.com>
 <c86d051d-f556-50e1-863f-a151b90133f2@measurement-factory.com>
 <CAPqnvdmp=M=BvgRT8bvD9J+QmFHEyDzuq0N+_BHued-OZ216FQ@mail.gmail.com>
 <fdcbb748-9b5e-43b7-dd68-2e747f96098c@measurement-factory.com>
 <CAPqnvdk0aXr98aEpbZxmOnhND=DMfHOQ47zP2rJ8H_sA2nvNQA@mail.gmail.com>
 <0b2dfedd-d9b7-ae8b-b77b-ed06445cd48b@measurement-factory.com>
 <CAPqnvd==HMiJFfvuBWcp2G303SJ4RHhYRybLFz2Yit9pCkKqYQ@mail.gmail.com>
Message-ID: <d8736568-926a-5f04-35a4-5f22c495d845@spamtrap.tnetconsulting.net>

On 9/27/21 7:32 AM, Mike Yates wrote:
> Let me ask this then ....
> 
> I just want squid to redirect any requests (http for instance) to 
> a specific external url so for instance http://mysuidserver:80 to 
> http://externalserver:80 ...

What does "redirect" mean in this context?

Is it an HTTP 301 / 302 / 307 / 308 redirect?

Is it a JavaScript window.location.href change?

Is it some sort of game with TCP connections?

Is it an HTTP proxy that receives requests to one name and proxies 
requests to another name?

"redirect" is vague and difficult to answer.  All of the above, and 
more, options have significantly different solutions.  What's more is 
that each has their own requirements.

> Does that help ....

Unfortunately not much.

> I'm just sure what is the minimal conf file I would need to achieve 
> this ...

You need to better define what you are wanting to do.

As stated in another message, I suspect, but do not know for sure, that 
you want Squid to HTTP proxy requests for one name to be sent to a 
different name.

The kicker is that Squid can do this (at least) a couple of different ways;
1)  Simply initiate TCP connections to the new name and assume that the 
new server knows how to deal with the old name, because the queries will 
still be using the old name.
2)  Intercept the connections to the old name and initiate queries for 
the new name at the new destination.

TLS has implications on both of these methods and serious complications.

I strongly suspect what you want to do can be done.  But you still 
haven't told us enough about how things happen on a protocol level to 
provide a useful answer.

The best that I can give at the moment is the following, as I think it's 
integral to what I think you are wanting to do.

Link - Reverse Proxy Mode
  - https://wiki.squid-cache.org/SquidFaq/ReverseProxy



-- 
Grant. . . .
unix || die

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4013 bytes
Desc: S/MIME Cryptographic Signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210927/e78a6883/attachment.bin>

From gtaylor at tnetconsulting.net  Mon Sep 27 20:48:57 2021
From: gtaylor at tnetconsulting.net (Grant Taylor)
Date: Mon, 27 Sep 2021 14:48:57 -0600
Subject: [squid-users] Sorry if this has been asked but I can't find an
 answer anywhere ...
In-Reply-To: <CAPqnvd=LDAzwC0CTJs=QAjexoo_L9pYRBkfoy0oAyRSixLtg8w@mail.gmail.com>
References: <009101d7b188$84ee3030$8eca9090$@gmail.com>
 <ef4b516c-4412-8355-16ca-c303c83ab368@measurement-factory.com>
 <CAPqnvd=4QfFrGOK_uUidwgMbOfvhSCVnqCR2Yn0y4SepZguhHw@mail.gmail.com>
 <75c7f5a2-da8e-77d0-6ee2-6db4e69c45da@spamtrap.tnetconsulting.net>
 <CAPqnvd=LDAzwC0CTJs=QAjexoo_L9pYRBkfoy0oAyRSixLtg8w@mail.gmail.com>
Message-ID: <ee399406-7cb1-40bc-e324-a633d88f35a6@spamtrap.tnetconsulting.net>

On 9/27/21 6:52 AM, Mike Yates wrote:
> So my idea is to install a single squid server and redirect the internal 
> servers to that url instead of the original?one.

Your use of "redirect" sounds like you will be re-configuring the 
clients to connect to the squid server.

Will you be configuring the clients to know that they are using a proxy 
server?  Or will you be using some sort of transparent and / or reverse 
proxy?

> Squid will then redirect the post to the correct external server asi 
> it is installed on a server that has external access  I hope this 
> is possible

What does "redirect" mean in this context?

It sounds like you mean a reverse proxy.  --  Which is what I've given 
you links to documentation for.

Reading between the lines, the client's won't have access to the 
Internet.  So, something like a 301 / 302 / 307 / 308 HTTP redirect 
won't do much good by themselves.

You need to clearly articulate the following:

1)  Are the clients configured to knowingly use a proxy?
      - The communications protocol they use is slightly different.
2)  What hostname are the client's connecting to?
3)  What protocol(s) are the client's using to connect to said hostname?
4)  Is TLS being used on any part of the connection?
5)  What hostname is Squid supposed to connect to?
6)  Will any part of the API URL change /other/ /than/ the hostname?

These six questions have subtle but distinct interaction with each other.



-- 
Grant. . . .
unix || die

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4013 bytes
Desc: S/MIME Cryptographic Signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210927/0788ec96/attachment.bin>

From flauenroth at protonmail.com  Tue Sep 28 14:49:08 2021
From: flauenroth at protonmail.com (flauenroth)
Date: Tue, 28 Sep 2021 14:49:08 +0000
Subject: [squid-users] Squidguard replacement for squid if needed
Message-ID: <DJswamhXN47jRBZ76aT8Qfsz1Zc4EtcLwy41KIU4ISMHNWLe80K53nEH6kscLcxRXgCsE6x3XO6EgP6tRkGUwEA5KvVdp4XJ2e-Aq9A11cs=@protonmail.com>

Heya list,

since I get no helpful responses from other sources, I try it here. 

I have a squid proxy set up and running. It works but when it comes to squidguard well, let's say I am done with it. It's not maintained anymore, I need hacks to get the results I'd like to get and it's more work than good. 

So I went on the web to look up some replacement for squidguard. 

urlfilterdb is getting mentioned a lot as a replacement for squidguard anyone got some good experiences with it?
>From the looks on the site it fulfills my needs but before I convince my boss to replace all the "old stuff" I rather know what I am talking about. 


Have a nice week
_______________________________
Always exit with 42 to return the answer.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: publickey - flauenroth at protonmail.com - 0xD727BBC1.asc
Type: application/pgp-keys
Size: 1829 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210928/4957e27b/attachment.key>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 509 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210928/4957e27b/attachment.sig>

From mkool at urlfilterdb.com  Tue Sep 28 15:22:20 2021
From: mkool at urlfilterdb.com (mkool at urlfilterdb.com)
Date: Tue, 28 Sep 2021 16:22:20 +0100
Subject: [squid-users] Squidguard replacement for squid if needed
In-Reply-To: <DJswamhXN47jRBZ76aT8Qfsz1Zc4EtcLwy41KIU4ISMHNWLe80K53nEH6kscLcxRXgCsE6x3XO6EgP6tRkGUwEA5KvVdp4XJ2e-Aq9A11cs=@protonmail.com>
References: <DJswamhXN47jRBZ76aT8Qfsz1Zc4EtcLwy41KIU4ISMHNWLe80K53nEH6kscLcxRXgCsE6x3XO6EgP6tRkGUwEA5KvVdp4XJ2e-Aq9A11cs=@protonmail.com>
Message-ID: <12e9f25a-9604-752f-bd1c-96afb779d52e@urlfilterdb.com>

author of ufdbGuard here.

The EPEL package of ufdbGuard is broken, so if you use ufdbGuard on CentOS/RHEL you need to download the package form sourceforge or www.urlfilterdb.com and exclude it from the EPEL repository.

Marcus


On 28/09/2021 15:49, flauenroth wrote:
> Heya list,
>
> since I get no helpful responses from other sources, I try it here.
>
> I have a squid proxy set up and running. It works but when it comes to squidguard well, let's say I am done with it. It's not maintained anymore, I need hacks to get the results I'd like to get and it's more work than good.
>
> So I went on the web to look up some replacement for squidguard.
>
> urlfilterdb is getting mentioned a lot as a replacement for squidguard anyone got some good experiences with it?
> >From the looks on the site it fulfills my needs but before I convince my boss to replace all the "old stuff" I rather know what I am talking about. 
>
>
> Have a nice week
> _______________________________
> Always exit with 42 to return the answer.
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210928/7a96e454/attachment.htm>

From flauenroth at protonmail.com  Wed Sep 29 07:46:36 2021
From: flauenroth at protonmail.com (flauenroth)
Date: Wed, 29 Sep 2021 07:46:36 +0000
Subject: [squid-users] Squidguard replacement for squid if needed
In-Reply-To: <12e9f25a-9604-752f-bd1c-96afb779d52e@urlfilterdb.com>
References: <DJswamhXN47jRBZ76aT8Qfsz1Zc4EtcLwy41KIU4ISMHNWLe80K53nEH6kscLcxRXgCsE6x3XO6EgP6tRkGUwEA5KvVdp4XJ2e-Aq9A11cs=@protonmail.com>
 <12e9f25a-9604-752f-bd1c-96afb779d52e@urlfilterdb.com>
Message-ID: <TCSGGDUy1Q8x_Rvs3EKKOnZvn0BBZy1soF8SmDTzSFBzKZkTthw0cgZYvPUqmv1jVO4a9xkBGWfYcfsYhq_6CENw_1t7Wkt1t2rge3QhOVY=@protonmail.com>

Thanks for the quick input and the hint.
We don't use CentOS at work but I am using it on my workstation so that was a nice hint.
The more I read abut ufdbGuard the more I am angry on myself for struggling with the squidguard extension for so long. Should have done it from scratch in the first place with my own research instead of "blindly" recycling the old squid proxy.
_______________________________
Always exit with 42 to return the answer.

??????? Original Message ???????

On Tuesday, September 28th, 2021 at 5:22 PM, <mkool at urlfilterdb.com> wrote:

> author of ufdbGuard here.
> 

> The EPEL package of ufdbGuard is broken, so if you use ufdbGuard on CentOS/RHEL you need to download the package form sourceforge or www.urlfilterdb.com and exclude it from the EPEL repository.
> 

> Marcus
> 

> On 28/09/2021 15:49, flauenroth wrote:
> 

> > Heya list,
> > 

> > since I get no helpful responses from other sources, I try it here.
> > 

> > I have a squid proxy set up and running. It works but when it comes to squidguard well, let's say I am done with it. It's not maintained anymore, I need hacks to get the results I'd like to get and it's more work than good.
> > 

> > So I went on the web to look up some replacement for squidguard.
> > 

> > urlfilterdb is getting mentioned a lot as a replacement for squidguard anyone got some good experiences with it?
> > >From the looks on the site it fulfills my needs but before I convince my boss to replace all the "old stuff" I rather know what I am talking about.
> > 

> > 

> > Have a nice week
> > _______________________________
> > Always exit with 42 to return the answer.
> > 

> > _______________________________________________
> > squid-users mailing list
> > squid-users at lists.squid-cache.org
> > http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210929/48bd23ee/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: publickey - flauenroth at protonmail.com - 0xD727BBC1.asc
Type: application/pgp-keys
Size: 1829 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210929/48bd23ee/attachment.key>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 509 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210929/48bd23ee/attachment.sig>

From robertkwild at gmail.com  Wed Sep 29 12:46:31 2021
From: robertkwild at gmail.com (robert k Wild)
Date: Wed, 29 Sep 2021 13:46:31 +0100
Subject: [squid-users] cicap lines in squid.conf
Message-ID: <CAGU_CiKrQf=1H=OXHj6kWu-+KeP9iGR_Uxh2-LWejAqaYNR8mg@mail.gmail.com>

hi all,

going by this link

https://wiki.squid-cache.org/ConfigExamples/ContentAdaptation/C-ICAP

theres two icap configuration options, what one should i use as atm i have
this in my squid.conf

#ICAP
icap_enable on
adaptation_uses_indirect_client on
icap_send_client_ip on
icap_send_client_username on
icap_client_username_header X-Authenticated-User
icap_service service_req reqmod_precache bypass=0 icap://
127.0.0.1:1344/squidclamav
adaptation_access service_req allow all
icap_service service_resp respmod_precache bypass=0 icap://
127.0.0.1:1344/squidclamav
adaptation_access service_resp allow all

thanks,
rob

-- 
Regards,

Robert K Wild.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210929/ba5267fe/attachment.htm>

From flauenroth at protonmail.com  Wed Sep 29 13:42:34 2021
From: flauenroth at protonmail.com (flauenroth)
Date: Wed, 29 Sep 2021 13:42:34 +0000
Subject: [squid-users] Squidguard replacement for squid if needed
In-Reply-To: <TCSGGDUy1Q8x_Rvs3EKKOnZvn0BBZy1soF8SmDTzSFBzKZkTthw0cgZYvPUqmv1jVO4a9xkBGWfYcfsYhq_6CENw_1t7Wkt1t2rge3QhOVY=@protonmail.com>
References: <DJswamhXN47jRBZ76aT8Qfsz1Zc4EtcLwy41KIU4ISMHNWLe80K53nEH6kscLcxRXgCsE6x3XO6EgP6tRkGUwEA5KvVdp4XJ2e-Aq9A11cs=@protonmail.com>
 <12e9f25a-9604-752f-bd1c-96afb779d52e@urlfilterdb.com>
 <TCSGGDUy1Q8x_Rvs3EKKOnZvn0BBZy1soF8SmDTzSFBzKZkTthw0cgZYvPUqmv1jVO4a9xkBGWfYcfsYhq_6CENw_1t7Wkt1t2rge3QhOVY=@protonmail.com>
Message-ID: <QV4fJnl5_RAbC_46OE6i5kgMz0_ez2SDpvGrpk8iGdCsynfbkbqDpAea3yr3GKTqCUMonQXgHYXfie6SPZW8NTFvwPBLjLKpZ3r-TQyBLCw=@protonmail.com>

Ok, it seems this whole squid proxy thing went down the FUBAR route faster than I could redirect to dev/null.
Apparently Debian/Ubunutu does not support openSSL anymore and uses GnuTLS whatever that thing is. Once again I feel savaged by "systemd". I knew, when I started the new job that it will be harsh but I did not expect it to be that different.
Coming from a UNIX backround using Linux and than Ubuntu Server 20.04LTS is well, an experience so to say.

Long story short, my best bet is to compile squid by myself and go from there right?
If I end up modifying my source port I am fine with that too, not the first time I had to "hack" my own stuff together. Sorry for the rant, just needed to get that out in the void. And if someone has experiences with my "issue" I gladly appreciate any input.
Have a nice day and my apologies for being not too positive about this whole thing.

_______________________________
Always exit with 42 to return the answer.

??????? Original Message ???????

On Wednesday, September 29th, 2021 at 9:46 AM, flauenroth <flauenroth at protonmail.com> wrote:

> Thanks for the quick input and the hint.
> We don't use CentOS at work but I am using it on my workstation so that was a nice hint.
> The more I read abut ufdbGuard the more I am angry on myself for struggling with the squidguard extension for so long. Should have done it from scratch in the first place with my own research instead of "blindly" recycling the old squid proxy.
> _______________________________
> Always exit with 42 to return the answer.
> 

> ??????? Original Message ???????
> 

> On Tuesday, September 28th, 2021 at 5:22 PM, <mkool at urlfilterdb.com> wrote:
> 

> > author of ufdbGuard here.
> > 

> > The EPEL package of ufdbGuard is broken, so if you use ufdbGuard on CentOS/RHEL you need to download the package form sourceforge or www.urlfilterdb.com and exclude it from the EPEL repository.
> > 

> > Marcus
> > 

> > On 28/09/2021 15:49, flauenroth wrote:
> > 

> > > Heya list,
> > > 

> > > since I get no helpful responses from other sources, I try it here.
> > > 

> > > I have a squid proxy set up and running. It works but when it comes to squidguard well, let's say I am done with it. It's not maintained anymore, I need hacks to get the results I'd like to get and it's more work than good.
> > > 

> > > So I went on the web to look up some replacement for squidguard.
> > > 

> > > urlfilterdb is getting mentioned a lot as a replacement for squidguard anyone got some good experiences with it?
> > > >From the looks on the site it fulfills my needs but before I convince my boss to replace all the "old stuff" I rather know what I am talking about.
> > > 

> > > 

> > > Have a nice week
> > > _______________________________
> > > Always exit with 42 to return the answer.
> > > 

> > > _______________________________________________
> > > squid-users mailing list
> > > squid-users at lists.squid-cache.org
> > > http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210929/a8987031/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: publickey - flauenroth at protonmail.com - 0xD727BBC1.asc
Type: application/pgp-keys
Size: 1829 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210929/a8987031/attachment.key>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 509 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210929/a8987031/attachment.sig>

From rousskov at measurement-factory.com  Wed Sep 29 13:49:29 2021
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Wed, 29 Sep 2021 09:49:29 -0400
Subject: [squid-users] cicap lines in squid.conf
In-Reply-To: <CAGU_CiKrQf=1H=OXHj6kWu-+KeP9iGR_Uxh2-LWejAqaYNR8mg@mail.gmail.com>
References: <CAGU_CiKrQf=1H=OXHj6kWu-+KeP9iGR_Uxh2-LWejAqaYNR8mg@mail.gmail.com>
Message-ID: <2a26934d-7a6e-2941-2fd2-db4ed3d49b49@measurement-factory.com>

On 9/29/21 8:46 AM, robert k Wild wrote:
> hi all,
> 
> going by this link
> 
> https://wiki.squid-cache.org/ConfigExamples/ContentAdaptation/C-ICAP
> 
> theres two icap configuration options, what one should i use

The answer depends on what you are using c-icap for:

* If you want to adapt (including inspect) HTTP requests, then use a
reqmod_precache vectoring point.

* If you want to adapt (including inspect) HTTP responses, then use a
respmod_precache vectoring point.

* If you want to adapt (including inspect) all HTTP messages, then use
both vectoring points.


HTH,

Alex.


> as atm i have this in my squid.conf
> 
> #ICAP
> icap_enable on
> adaptation_uses_indirect_client on
> icap_send_client_ip on
> icap_send_client_username on
> icap_client_username_header X-Authenticated-User
> icap_service service_req reqmod_precache bypass=0 icap://127.0.0.1:1344/squidclamav 
> adaptation_access service_req allow all
> icap_service service_resp respmod_precache bypass=0 icap://127.0.0.1:1344/squidclamav
> adaptation_access service_resp allow all



From cedric.poullot at capgemini.com  Wed Sep 29 15:44:48 2021
From: cedric.poullot at capgemini.com (POULLOT, Cedric)
Date: Wed, 29 Sep 2021 15:44:48 +0000
Subject: [squid-users] windows authentification
Message-ID: <AM7PR02MB64190C46C5C04ACF7AD5B59883A99@AM7PR02MB6419.eurprd02.prod.outlook.com>

Hi everyone,
I'm using Squid 4.14 for windows and I've tried the ldap authentification by using :

Basic_ldap_auth.exe
Basic_ncsa.auth.exe
Digest_ldap_auth.exe
Ext_ldap_auth.exe

When I start my squid service for windows, I  get the following cache.log

2021/09/29 16:40:57| Created PID file (/var/run/squid.pid)
2021/09/29 16:40:57| Set Current Directory to /var/cache/squid
2021/09/29 16:40:57| Starting Squid Cache version 4.14 for x86_64-unknown-cygwin...
2021/09/29 16:40:57| Service Name: squid
2021/09/29 16:40:57| Process ID 1792
2021/09/29 16:40:57| Process Roles: master worker
2021/09/29 16:40:57| With 3200 file descriptors available
2021/09/29 16:40:57| Initializing IP Cache...
2021/09/29 16:40:57| DNS Socket created at [::], FD 4
2021/09/29 16:40:57| DNS Socket created at 0.0.0.0, FD 9
2021/09/29 16:40:57| Adding nameserver 192.168.64.23 from squid.conf
2021/09/29 16:40:57| helperOpenServers: Starting 0/5 'basic_ldap_auth.exe' processes
2021/09/29 16:40:57| helperStatefulOpenServers: No 'basic_ldap_auth.exe' processes needed.
2021/09/29 16:40:57| helperOpenServers: Starting 0/5 'basic_ldap_auth.exe' processes
2021/09/29 16:40:57| helperStatefulOpenServers: No 'basic_ldap_auth.exe' processes needed.
2021/09/29 16:40:57| ERROR: loading file '/usr/share/squid/errors/templates/ERR_PROTOCOL_UNKNOWN': (2) No such file or directory
2021/09/29 16:40:57| WARNING: failed to find or read error text file ERR_PROTOCOL_UNKNOWN
2021/09/29 16:40:57| Logfile: opening log daemon:/var/log/squid/access.log
2021/09/29 16:40:57| Logfile Daemon: opening log /var/log/squid/access.log
2021/09/29 16:40:57| WARNING: no_suid: setuid(0): (22) Invalid argument
2021/09/29 16:40:57| Store logging disabled
2021/09/29 16:40:57| Swap maxSize 0 + 262144 KB, estimated 20164 objects
2021/09/29 16:40:57| Target number of buckets: 1008
2021/09/29 16:40:57| Using 8192 Store buckets
2021/09/29 16:40:57| Max Mem  size: 262144 KB
2021/09/29 16:40:57| Max Swap size: 0 KB
2021/09/29 16:40:57| Using Least Load store dir selection
2021/09/29 16:40:57| Set Current Directory to /var/cache/squid
2021/09/29 16:40:57| Finished loading MIME types and icons.
2021/09/29 16:40:57| HTCP Disabled.
2021/09/29 16:40:57| Squid plugin modules loaded: 0
2021/09/29 16:40:57| Adaptation support is off.
2021/09/29 16:40:57| Accepting reverse-proxy HTTP Socket connections at local=[::]:3129 remote=[::] FD 12 flags=9
2021/09/29 16:40:58| storeLateRelease: released 0 objects

Do you know what type of authentification works on windows,
And how to configure squid to use it ?

Thanks,
Regards,
Ced
This message contains information that may be privileged or confidential and is the property of the Capgemini Group. It is intended only for the person to whom it is addressed. If you are not the intended recipient, you are not authorized to read, print, retain, copy, disseminate, distribute, or use this message or any part thereof. If you receive this message in error, please notify the sender immediately and delete all copies of this message.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210929/65d5dc10/attachment.htm>

From pponakanti at roblox.com  Thu Sep 30 06:49:55 2021
From: pponakanti at roblox.com (Praveen Ponakanti)
Date: Wed, 29 Sep 2021 23:49:55 -0700
Subject: [squid-users] Running SMP workers on multi-core systems
Message-ID: <CACabJxMpcV+ixKRm9Z7EGfE9NEWN50N2g16_5vkje8oj7A6tGw@mail.gmail.com>

Hi,

I am trying to use the squid cache as an outbound HTTP/S proxy service for
our production network and would like to scale up the request per sec by
running it on multi-core systems.

I have searched up the archives and config docs, but couldn't find anything
more recent than the below on setting up SMP workers.
https://wiki.squid-cache.org/ConfigExamples/SmpCarpCluster
https://wiki.squid-cache.org/ConfigExamples/MultiCpuSystem

* Can someone please let me know if the config examples in those docs still
apply to the latest version 5.1.

* Do we still need the combination of squid, frontend, backend.conf files,
or is it enabled simply with the "workers" line in the main config file?

* When I attempt to run the squid server with "workers 4" in the
squid.conf, I get the following error (one for each kid) and the main
process does not bind to the "http_port 3128". I see several UDP ports
opened up for each kid process.

2021/09/29 00:44:10 kid5| commBind Cannot bind socket FD 11 to [::]:
(2) No such file or directory

* Does anyone have recommendations on the maximum number of workers to use
on a 64 core host (assuming no other CPU intensive apps are running on the
same host). Caching is not a must for our initial deployment, so we are
fine disabling caching.

Thanks
Praveen
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210929/3899dcce/attachment.htm>

From uhlar at fantomas.sk  Thu Sep 30 10:38:02 2021
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Thu, 30 Sep 2021 12:38:02 +0200
Subject: [squid-users] Squidguard replacement for squid if needed
In-Reply-To: <QV4fJnl5_RAbC_46OE6i5kgMz0_ez2SDpvGrpk8iGdCsynfbkbqDpAea3yr3GKTqCUMonQXgHYXfie6SPZW8NTFvwPBLjLKpZ3r-TQyBLCw=@protonmail.com>
References: <DJswamhXN47jRBZ76aT8Qfsz1Zc4EtcLwy41KIU4ISMHNWLe80K53nEH6kscLcxRXgCsE6x3XO6EgP6tRkGUwEA5KvVdp4XJ2e-Aq9A11cs=@protonmail.com>
 <12e9f25a-9604-752f-bd1c-96afb779d52e@urlfilterdb.com>
 <TCSGGDUy1Q8x_Rvs3EKKOnZvn0BBZy1soF8SmDTzSFBzKZkTthw0cgZYvPUqmv1jVO4a9xkBGWfYcfsYhq_6CENw_1t7Wkt1t2rge3QhOVY=@protonmail.com>
 <QV4fJnl5_RAbC_46OE6i5kgMz0_ez2SDpvGrpk8iGdCsynfbkbqDpAea3yr3GKTqCUMonQXgHYXfie6SPZW8NTFvwPBLjLKpZ3r-TQyBLCw=@protonmail.com>
Message-ID: <20210930103802.GA25794@fantomas.sk>

On 29.09.21 13:42, flauenroth wrote:
>Apparently Debian/Ubunutu does not support openSSL anymore and uses GnuTLS
> whatever that thing is.  Once again I feel savaged by "systemd".  I knew,
> when I started the new job that it will be harsh but I did not expect it
> to be that different.

funny, because a month ago debian 11 came out containing squid-gnutls and
squid-openssl variants.

>Coming from a UNIX backround using Linux and than Ubuntu Server 20.04LTS is
> well, an experience so to say.

>Long story short, my best bet is to compile squid by myself and go from
> there right?

try squid-openssl first.
-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Atheism is a non-prophet organization.


From rousskov at measurement-factory.com  Thu Sep 30 13:30:20 2021
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Thu, 30 Sep 2021 09:30:20 -0400
Subject: [squid-users] Running SMP workers on multi-core systems
In-Reply-To: <CACabJxMpcV+ixKRm9Z7EGfE9NEWN50N2g16_5vkje8oj7A6tGw@mail.gmail.com>
References: <CACabJxMpcV+ixKRm9Z7EGfE9NEWN50N2g16_5vkje8oj7A6tGw@mail.gmail.com>
Message-ID: <15d7139c-154f-f0eb-c486-b346b63a68fd@measurement-factory.com>

On 9/30/21 2:49 AM, Praveen Ponakanti wrote:

> I am trying?to use the squid cache as an outbound HTTP/S proxy service
> for our production network and would like to scale up the request per
> sec by running it on multi-core systems.?

> I have searched up the archives and config docs, but couldn't?find
> anything more recent than the below on setting?up SMP workers.?
> https://wiki.squid-cache.org/ConfigExamples/SmpCarpCluster
> https://wiki.squid-cache.org/ConfigExamples/MultiCpuSystem

The two old exotic configurations above are not what you should be
starting with when thinking about SMP support in modern Squids. The best
starting points I know about are

* https://wiki.squid-cache.org/Features/SmpScale
* http://www.squid-cache.org/Doc/config/workers/
* http://www.squid-cache.org/Doc/config/cpu_affinity_map/
* http(s)_port worker-queues option

That Feature wiki page does not get many updates these days; if there is
a conflict between information sources, the directive documentation in
your squid.conf.documented may have more recent information.


> * Can someone please let me know if the config examples in those docs
> still apply to the latest version 5.1.

I bet those use cases themselves do not apply well to your situation.


> * Do we still need the combination of squid, frontend, backend.conf
> files, or is it enabled simply with the "workers" line in the main
> config file??

The workers directive does not require multiple Squid instances (with
multiple configuration files, etc.).


> * When I attempt to run the squid server with "workers 4" in the
> squid.conf, I get the following error (one for each kid) and the main
> process does not bind to the "http_port 3128". I see several UDP ports
> opened up for each kid process.

> 2021/09/29 00:44:10 kid5| commBind Cannot bind socket FD 11 to [::]: (2) No such file or directory

Unfortunately, I cannot tell exactly what went wrong based on that
low-level message alone, but it could be a variant of [1]. If you cannot
figure it out after checking [1] suggestions, consider sharing "squid
-X" startup cache.log for analysis. There is

[1]
https://wiki.squid-cache.org/Features/SmpScale#Cannot_bind_socket_FD_NN_to_.5B::.5D:_.2813.29_Permission_denied

The UDP ports you are seeing are probably for the internal DNS resolver
which is not SMP-aware.


> * Does anyone have recommendations on the maximum number of workers to
> use on a 64 core host (assuming no other CPU intensive apps are running
> on the same host). Caching is not a must for our initial deployment, so
> we are fine disabling caching.

28-30. See the following wiki section for the corresponding rules of
thumb:
https://wiki.squid-cache.org/Features/SmpScale#How_to_configure_SMP_Squid_for_top_performance.3F


HTH,

Alex.


From flauenroth at protonmail.com  Thu Sep 30 15:18:26 2021
From: flauenroth at protonmail.com (flauenroth)
Date: Thu, 30 Sep 2021 15:18:26 +0000
Subject: [squid-users] Squidguard replacement for squid if needed
In-Reply-To: <mailman.3.1633003201.2382497.squid-users@lists.squid-cache.org>
References: <mailman.3.1633003201.2382497.squid-users@lists.squid-cache.org>
Message-ID: <x8yTNBWl9blsnSED7-kH5e9bRO1NsoF6N3-Q5rTPBufW6smQ6x23epKOsQX57h2r9tnHraQUCBG3qlRCi9o-PviEEbNJMy4OvXnUxYJAIeo=@protonmail.com>

Thanks for the heads up Mathus.
By now I ended slapping Squid on the pfsense and go from there.
Less hassle, a system I am familiar with and so far everything works fine in my lab. 

I will look up the new build for sure and if I can get this Ubuntu 20.04 LTS Server 

up and running with Squid and ufdbguard to work and filter, I will happily give that a shot. 



_______________________________
Always exit with 42 to return the answer.

??????? Original Message ???????

On Thursday, September 30th, 2021 at 2:00 PM, <squid-users-request at lists.squid-cache.org> wrote:

> Send squid-users mailing list submissions to
> 

> squid-users at lists.squid-cache.org
> 

> To subscribe or unsubscribe via the World Wide Web, visit
> 

> http://lists.squid-cache.org/listinfo/squid-users
> 

> or, via email, send a message with subject or body 'help' to
> 

> squid-users-request at lists.squid-cache.org
> 

> You can reach the person managing the list at
> 

> squid-users-owner at lists.squid-cache.org
> 

> When replying, please edit your Subject line so it is more specific
> 

> than "Re: Contents of squid-users digest..."
> 

> Today's Topics:
> 

> 1.  Running SMP workers on multi-core systems (Praveen Ponakanti)
> 2.  Re: Squidguard replacement for squid if needed
>     

>     (Matus UHLAR - fantomas)
>     

> 

> Message: 1
> 

> Date: Wed, 29 Sep 2021 23:49:55 -0700
> 

> From: Praveen Ponakanti pponakanti at roblox.com
> 

> To: squid-users at lists.squid-cache.org
> 

> Subject: [squid-users] Running SMP workers on multi-core systems
> 

> Message-ID:
> 

> CACabJxMpcV+ixKRm9Z7EGfE9NEWN50N2g16_5vkje8oj7A6tGw at mail.gmail.com
> 

> Content-Type: text/plain; charset="utf-8"
> 

> Hi,
> 

> I am trying to use the squid cache as an outbound HTTP/S proxy service for
> 

> our production network and would like to scale up the request per sec by
> 

> running it on multi-core systems.
> 

> I have searched up the archives and config docs, but couldn't find anything
> 

> more recent than the below on setting up SMP workers.
> 

> https://wiki.squid-cache.org/ConfigExamples/SmpCarpCluster
> 

> https://wiki.squid-cache.org/ConfigExamples/MultiCpuSystem
> 

> -   Can someone please let me know if the config examples in those docs still
>     

>     apply to the latest version 5.1.
> -   Do we still need the combination of squid, frontend, backend.conf files,
>     

>     or is it enabled simply with the "workers" line in the main config file?
> -   When I attempt to run the squid server with "workers 4" in the
>     

>     squid.conf, I get the following error (one for each kid) and the main
>     

>     process does not bind to the "http_port 3128". I see several UDP ports
>     

>     opened up for each kid process.
>     

>     2021/09/29 00:44:10 kid5| commBind Cannot bind socket FD 11 to [::]:
>     

>     (2) No such file or directory
> -   Does anyone have recommendations on the maximum number of workers to use
>     

>     on a 64 core host (assuming no other CPU intensive apps are running on the
>     

>     same host). Caching is not a must for our initial deployment, so we are
>     

>     fine disabling caching.
>     

>     Thanks
>     

>     Praveen
>     

>     -------------- next part --------------
>     

>     An HTML attachment was scrubbed...
>     

>     URL: http://lists.squid-cache.org/pipermail/squid-users/attachments/20210929/3899dcce/attachment-0001.htm
> 

> Message: 2
> 

> Date: Thu, 30 Sep 2021 12:38:02 +0200
> 

> From: Matus UHLAR - fantomas uhlar at fantomas.sk
> 

> To: squid-users at lists.squid-cache.org
> 

> Subject: Re: [squid-users] Squidguard replacement for squid if needed
> 

> Message-ID: 20210930103802.GA25794 at fantomas.sk
> 

> Content-Type: text/plain; charset=us-ascii; format=flowed
> 

> On 29.09.21 13:42, flauenroth wrote:
> 

> > Apparently Debian/Ubunutu does not support openSSL anymore and uses GnuTLS
> > 

> > whatever that thing is. Once again I feel savaged by "systemd". I knew,
> > 

> > when I started the new job that it will be harsh but I did not expect it
> > 

> > to be that different.
> 

> funny, because a month ago debian 11 came out containing squid-gnutls and
> 

> squid-openssl variants.
> 

> > Coming from a UNIX backround using Linux and than Ubuntu Server 20.04LTS is
> > 

> > well, an experience so to say.
> 

> > Long story short, my best bet is to compile squid by myself and go from
> > 

> > there right?
> 

> try squid-openssl first.
> --------------------------
> 

> Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
> 

> Warning: I wish NOT to receive e-mail advertising to this address.
> 

> Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
> 

> Atheism is a non-prophet organization.
> 

> 

> -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> 

> Subject: Digest Footer
> 

> squid-users mailing list
> 

> squid-users at lists.squid-cache.org
> 

> http://lists.squid-cache.org/listinfo/squid-users
> 

> 

> ----------------------------------------------------------------------------------------------------------------
> 

> End of squid-users Digest, Vol 85, Issue 39
-------------- next part --------------
A non-text attachment was scrubbed...
Name: publickey - flauenroth at protonmail.com - 0xD727BBC1.asc
Type: application/pgp-keys
Size: 1829 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210930/0689164b/attachment.key>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 509 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210930/0689164b/attachment.sig>

From robertkwild at gmail.com  Thu Sep 30 15:45:45 2021
From: robertkwild at gmail.com (robert k Wild)
Date: Thu, 30 Sep 2021 16:45:45 +0100
Subject: [squid-users] cicap lines in squid.conf
In-Reply-To: <CAGU_CiKrQf=1H=OXHj6kWu-+KeP9iGR_Uxh2-LWejAqaYNR8mg@mail.gmail.com>
References: <CAGU_CiKrQf=1H=OXHj6kWu-+KeP9iGR_Uxh2-LWejAqaYNR8mg@mail.gmail.com>
Message-ID: <CAGU_CiLHHUc+yxSSnxsHOB13_KvoA6hX6O=u2WoMNpkLjf-mOg@mail.gmail.com>

in the end did this work, the reason why i thought it wasnt is because i
went on the eicar test website and downloaded the txt fle and i could see
it on the website

reason was it was because it was cached and must have saved it in memory as
"cache_dir" i have disabled, once i rebooted the squid server and tried to
download the txt file again i got the squid virus page

i did have to update my clamav service via yum as when i run "freshclam" it
errored saying running an old version but once i updated all was good

On Wed, 29 Sept 2021 at 13:46, robert k Wild <robertkwild at gmail.com> wrote:

> hi all,
>
> going by this link
>
> https://wiki.squid-cache.org/ConfigExamples/ContentAdaptation/C-ICAP
>
> theres two icap configuration options, what one should i use as atm i have
> this in my squid.conf
>
> #ICAP
> icap_enable on
> adaptation_uses_indirect_client on
> icap_send_client_ip on
> icap_send_client_username on
> icap_client_username_header X-Authenticated-User
> icap_service service_req reqmod_precache bypass=0 icap://
> 127.0.0.1:1344/squidclamav
> adaptation_access service_req allow all
> icap_service service_resp respmod_precache bypass=0 icap://
> 127.0.0.1:1344/squidclamav
> adaptation_access service_resp allow all
>
> thanks,
> rob
>
> --
> Regards,
>
> Robert K Wild.
>


-- 
Regards,

Robert K Wild.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20210930/4540db69/attachment.htm>

