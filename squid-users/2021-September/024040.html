<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] SSL Terminating Reverse Proxy with Referral Tracking
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL%20Terminating%20Reverse%20Proxy%20with%20Referral%0A%20Tracking&In-Reply-To=%3C2b1469f2-4107-4d8d-8b27-64c1843bd097%40spamtrap.tnetconsulting.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024043.html">
   <LINK REL="Next"  HREF="024041.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] SSL Terminating Reverse Proxy with Referral Tracking</H1>
    <B>Grant Taylor</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL%20Terminating%20Reverse%20Proxy%20with%20Referral%0A%20Tracking&In-Reply-To=%3C2b1469f2-4107-4d8d-8b27-64c1843bd097%40spamtrap.tnetconsulting.net%3E"
       TITLE="[squid-users] SSL Terminating Reverse Proxy with Referral Tracking">gtaylor at tnetconsulting.net
       </A><BR>
    <I>Wed Sep 15 01:12:07 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="024043.html">[squid-users] SSL Terminating Reverse Proxy with Referral Tracking
</A></li>
        <LI>Next message (by thread): <A HREF="024041.html">[squid-users] SSL Terminating Reverse Proxy with Referral Tracking
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24040">[ date ]</a>
              <a href="thread.html#24040">[ thread ]</a>
              <a href="subject.html#24040">[ subject ]</a>
              <a href="author.html#24040">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 9/12/21 10:16 PM, Mehrdad Fatemi wrote:
&gt;<i> Hi Everyone,
</I>
Hi,

TL;DR:  Proxy Auto Configuration

&gt;<i> I'm looking for an elegant technology option to have telcos zero-rate 
</I>&gt;<i> all of the traffic to a set of online destinations.
</I>
I assume that &quot;zero rating&quot; means that specific destinations, e.g. the 
proxy server, are no-charge from the telco's customers point of view. 
If this is not what you are meaning, please correct me.

&gt;<i> Using an SSL terminating reverse proxy could be a potential answer 
</I>&gt;<i> to this as we can focus on zero-rating the proxy's downstream traffic 
</I>&gt;<i> with each ISP/Telco without worrying about upstream servers.
</I>
I have concerns about &quot;SSL terminating&quot;.  It sounds to me like you are 
decidedly outside of the typical enterprise or home network scenario 
where you are wanting to terminate / intercept / bump-in-the-wire TLS 
connections.  As such, I have *SERIOUS* /concerns/ about the security 
implications of this.  --  But, I'm going to assume that you are well 
aware of the implications and are addressing them properly.  But I'd be 
remiss to not say something.  Moving on.

Aside:  I sat on this message for a few days while messing with my own 
TLS bump-in-the-wire /in/ /my/ /house/ on my /home/ network.  As such, 
I'm perfectly fine with TLS termination within environments that have 
the authority to do so.  ;-)  --  I sat on the message while working on 
my own Proxy Auto Configuration script to have multiple clients do what 
I want.

Further aside:  I'm *EXTREMELY* happy with Squid's support for TLS 
bump-in-the-wire for my use cases; allowing ancient clients to use Squid 
as an encryption gateway between SSL3 / TLSv1 / TLSv1.1 and TLSv1.2 / 
TLSv1.3.  The ability to filter various things like tracking pixels, and 
the caching is wonderful.  --  I can't quite wrap my head around why 
Squid improves performance on a GPON connection, but it does.  I would 
have thought that 1 Gbps connection would negate the need for local caching.

&gt;<i> There are two&#160;challenges to address here though:
</I>&gt;<i> 1) Modern web applications on the upstream servers use many 3rd party 
</I>&gt;<i> and X-a-a-S resources&#160; (e.g. embedded media, libraries, etc) that we 
</I>&gt;<i> also want to pass through the proxy to ensure they are zero-rated.
</I>
That's going to be a game of Whack-a-Mole.

There's also the possibility that you will proxy ~&gt; zero-rate some 
common library that many other sites that don't pass through your 
infrastructure will use.  So I suspect it's an impure WaM game at best.

&gt;<i> 2) For a user to complete an end-to-end process they may get referred to 
</I>&gt;<i> 3rd party websites (like a payment gateway) that we only want to 
</I>&gt;<i> zero-rate if the referral is from one of our designated upstream servers.
</I>
I suspect that trying to integrate conditional behavior based on account 
balance is going to be ... tricky, if not problematic.  I'd suggest 
worrying about that after the fact or at a later point in the process.

&gt;<i> Any advice on whether and how Squid and other related technologies could 
</I>&gt;<i> help is much appreciated.
</I>
I feel like a judicious use of a Proxy Auto Configuration (PAC) file / 
script may be a good start.  It should be relatively easy for 
subscribers to configure their devices to utilize.  Then you can update 
the PAC file as the WaM game requires.  The PAC has the added advantage 
that you can direct proxy traffic to different proxy servers as necessary.

As for normal (forward) vs reverse proxy is concerned, it seems to me 
like your proxy will be acting as both, a reverse proxy / accelerator 
/and/ a /conditional/ forward proxy.  The conditionality is based on the 
result of the PAC file's FindProxyForURL() function.  You are in some 
ways acting as a reverse proxy / accelerator for specific sites.  You 
are also acting as a forward proxy for clients.  The behaviors just 
overlap in your use case.  The secret sauce is in the PAC file; what 
does and does not get sent to your proxy.

Seeing as how you are dealing with subscribers, you probably do not want 
the closely related / largely overlapping Web Proxy Auto Discovery 
(WPAD) functionality.  IMHO WPAD points to a PAC file.



-- 
Grant. . . .
unix || die

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4013 bytes
Desc: S/MIME Cryptographic Signature
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20210914/6203a64f/attachment.bin">http://lists.squid-cache.org/pipermail/squid-users/attachments/20210914/6203a64f/attachment.bin</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="024043.html">[squid-users] SSL Terminating Reverse Proxy with Referral Tracking
</A></li>
	<LI>Next message (by thread): <A HREF="024041.html">[squid-users] SSL Terminating Reverse Proxy with Referral Tracking
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24040">[ date ]</a>
              <a href="thread.html#24040">[ thread ]</a>
              <a href="subject.html#24040">[ subject ]</a>
              <a href="author.html#24040">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
