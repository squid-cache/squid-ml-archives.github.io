<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] logformat odd values
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20logformat%20odd%20values&In-Reply-To=%3C1db857b3-123e-a38a-347f-d4369b300eed%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024038.html">
   <LINK REL="Next"  HREF="024067.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] logformat odd values</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20logformat%20odd%20values&In-Reply-To=%3C1db857b3-123e-a38a-347f-d4369b300eed%40measurement-factory.com%3E"
       TITLE="[squid-users] logformat odd values">rousskov at measurement-factory.com
       </A><BR>
    <I>Wed Sep 15 17:47:15 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="024038.html">[squid-users] logformat odd values
</A></li>
        <LI>Next message (by thread): <A HREF="024067.html">[squid-users] logformat odd values
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24050">[ date ]</a>
              <a href="thread.html#24050">[ thread ]</a>
              <a href="subject.html#24050">[ subject ]</a>
              <a href="author.html#24050">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 9/14/21 3:04 PM, Moti Berger wrote:

&gt;<i> I have the followings in squid.conf:
</I>&gt;<i> 
</I>&gt;<i>     logformat metrics %icap::tt %adapt::all_trs %adapt::sum_trs
</I>&gt;<i>     %{service_req_a}adapt::sum_trs %{service_resp_a}adapt::sum_trs
</I>&gt;<i>     %{service_req_b}adapt::sum_trs %{service_resp_b}adapt::sum_trs
</I>&gt;<i>     access_log daemon:/var/log/squid/metrics.log metrics
</I>&gt;<i> 
</I>&gt;<i> &#160;
</I>&gt;<i> 
</I>&gt;<i>     icap_service service_req_a reqmod_precache bypass=1 on-overload=wait
</I>&gt;<i>     routing=1 <A HREF="icap://a.y:12345/request">icap://a.y:12345/request</A>
</I>&gt;<i>     icap_service service_req_b reqmod_precache bypass=1 on-overload=wait
</I>&gt;<i>     <A HREF="icap://b.y:10101/request">icap://b.y:10101/request</A>
</I>&gt;<i>     adaptation_service_chain svcRequest service_req_a&#160;service_req_b
</I>&gt;<i>     adaptation_access svcRequest deny manager
</I>&gt;<i>     adaptation_access svcRequest allow all
</I>&gt;<i>     icap_service service_resp_a respmod_precache bypass=1
</I>&gt;<i>     on-overload=wait routing=1 <A HREF="icap://a.y:12345/response">icap://a.y:12345/response</A>
</I>&gt;<i>     icap_service service_resp_b respmod_precache bypass=1
</I>&gt;<i>     on-overload=wait <A HREF="icap://b.y:10101/response">icap://b.y:10101/response</A>
</I>&gt;<i>     adaptation_service_chain svcResponse service_resp_a&#160;service_resp_b
</I>&gt;<i>     adaptation_access svcResponse deny manager
</I>&gt;<i>     adaptation_access svcResponse allow all
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> &#160;I see in metrics.log lines like this:
</I>&gt;<i> 
</I>&gt;<i>     4 4,180 4,180 4 180 - -
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Now I wonder how come the value of %icap:tt isn't at least as the sum of
</I>&gt;<i> all the numbers appear on %adapt::all_trs or %adapt::sum_trs (assuming
</I>&gt;<i> no failed transactions)?
</I>
There is probably a bug somewhere, but please note that %icap:tt may not
be the sum of individual transaction response times (in _some_ cases)
even after that bug is fixed because those individual transactions may
run _concurrently_ (i.e. partially overlap in time).


&gt;<i> If %icap:tt isn't at least the sum of all ICAPs processing time, what is?
</I>
Bugs notwithstanding, it is approximate time a master transaction spent
doing adaptation (including checking whether adaptation is necessary).
This stopwatch ticks when adaptation_access ACLs are checked and also
when at least one adaptation transaction associated with that master
transaction is in progress.

Please note that a master transaction can do a lot of different things
at once or in parallel. For example, it can communicate with an HTTP
client while communicating with an FTP server while communicating with
an eCAP REQMOD adaptation service while communicating with a DNS server
to decide whether to start communicating with an ICAP RESPMOD service.


HTH,

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="024038.html">[squid-users] logformat odd values
</A></li>
	<LI>Next message (by thread): <A HREF="024067.html">[squid-users] logformat odd values
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24050">[ date ]</a>
              <a href="thread.html#24050">[ thread ]</a>
              <a href="subject.html#24050">[ subject ]</a>
              <a href="author.html#24050">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
