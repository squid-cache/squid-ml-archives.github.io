<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] hostHeaderVerify with SNI in interception environments
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20hostHeaderVerify%20with%20SNI%20in%20interception%0A%20environments&In-Reply-To=%3Cd695fd89-26bf-3831-ac95-4e837b1c99b6%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024070.html">
   <LINK REL="Next"  HREF="024072.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] hostHeaderVerify with SNI in interception environments</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20hostHeaderVerify%20with%20SNI%20in%20interception%0A%20environments&In-Reply-To=%3Cd695fd89-26bf-3831-ac95-4e837b1c99b6%40treenet.co.nz%3E"
       TITLE="[squid-users] hostHeaderVerify with SNI in interception environments">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Sep 17 23:10:27 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="024070.html">[squid-users] hostHeaderVerify with SNI in interception environments
</A></li>
        <LI>Next message (by thread): <A HREF="024072.html">[squid-users] hostHeaderVerify with SNI in interception environments
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24071">[ date ]</a>
              <a href="thread.html#24071">[ thread ]</a>
              <a href="subject.html#24071">[ subject ]</a>
              <a href="author.html#24071">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 18/09/21 8:14 am, Alex Rousskov wrote:
&gt;<i> On 9/17/21 3:29 PM, Andreas Weigel wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> If splicing at step3, however, hostHeaderVerify is not called again with
</I>&gt;&gt;<i> the SNI
</I>&gt;<i> 
</I>&gt;<i> I assume that the above statement would still be true if I remove the
</I>&gt;<i> word &quot;again&quot; from it. This is how I interpreted it (i.e.
</I>&gt;<i> hostHeaderVerify() is called once with the IP address and never with SNI).
</I>&gt;<i> 
</I>&gt;<i> There are other ways to interpret that statement (e.g., hostHeaderVerify
</I>&gt;<i> was called with SNI once, but you expected it to be called with SNI twice).
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> I was wondering if this could be considered a bug or if there is a
</I>&gt;&gt;<i> rationale to change the behavior in the &quot;peek at step2, splice at step3&quot;
</I>&gt;&gt;<i> scenario.
</I>&gt;<i> 
</I>&gt;<i> If my interpretation above is correct, then this sounds like a bug to
</I>&gt;<i> me: Squid/hostHeaderVerify() must validate every request target value
</I>&gt;<i> Squid intends to use for cache lookups and/or connecting. If the request
</I>&gt;<i> target changes from IP to SNI, then Squid must validate exactly twice.
</I>&gt;<i> 
</I>
AIUI, SSL-Bump step 3 does not need to verify because a) it uses the 
server connection setup at step 2, and b) the issue(s) checked for only 
apply to mismatch of names provided by clients vs dst-IP.


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="024070.html">[squid-users] hostHeaderVerify with SNI in interception environments
</A></li>
	<LI>Next message (by thread): <A HREF="024072.html">[squid-users] hostHeaderVerify with SNI in interception environments
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24071">[ date ]</a>
              <a href="thread.html#24071">[ thread ]</a>
              <a href="subject.html#24071">[ subject ]</a>
              <a href="author.html#24071">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
