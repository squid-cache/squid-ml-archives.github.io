<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid 5.1: Kerberos: Unable to switch to basic auth with Edge - IE - Chrome
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%205.1%3A%20Kerberos%3A%20Unable%20to%20switch%20to%20basic%0A%20auth%20with%20Edge%20-%20IE%20-%20Chrome&In-Reply-To=%3Cvmime.6149a343.30bd.4f60a4d551e59bf3%40ms249-lin-003.rotterdam.bazuin.nl%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024085.html">
   <LINK REL="Next"  HREF="024083.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid 5.1: Kerberos: Unable to switch to basic auth with Edge - IE - Chrome</H1>
    <B>L.P.H. van Belle</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%205.1%3A%20Kerberos%3A%20Unable%20to%20switch%20to%20basic%0A%20auth%20with%20Edge%20-%20IE%20-%20Chrome&In-Reply-To=%3Cvmime.6149a343.30bd.4f60a4d551e59bf3%40ms249-lin-003.rotterdam.bazuin.nl%3E"
       TITLE="[squid-users] squid 5.1: Kerberos: Unable to switch to basic auth with Edge - IE - Chrome">belle at bazuin.nl
       </A><BR>
    <I>Tue Sep 21 09:17:55 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="024085.html">[squid-users] squid 5.1: Kerberos: Unable to switch to basic auth with Edge - IE - Chrome
</A></li>
        <LI>Next message (by thread): <A HREF="024083.html">[squid-users] got many messages after upgrade from 4.16 to 5.1: assertion failed: Transients.cc:221: &quot;old == e&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24087">[ date ]</a>
              <a href="thread.html#24087">[ thread ]</a>
              <a href="subject.html#24087">[ subject ]</a>
              <a href="author.html#24087">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>What i showed used kerberos, if that fails it used ntlm.. and you can add.. if that fails use LDAP (basic auth) ..&#160;
This way, you support all of them. 

if you going only for kerberos, that make sure you setup your krb5.conf correctly.. 
A + PTR records, SPN/UPNs and yes, then you can run it fully without samba&#160; ( if your not haveing PTR, set rdns = no in krb5.conf ) 

Also, if you dont want the NTLM part, just remove the line : 
--ntlm /usr/bin/ntlm_auth --allow-mschapv2 --helper-protocol=gss-spnego --domain=ADDOM


on firefox, did you set this In Firefox, you have to go to the about:config page and set the parameters
network.negotiate-auth.trusted-uris
network.automatic-ntlm-auth.trusted-uris

As far i can tell, what i see, is you didnt configure the browsers to use kerberos. 


Greetz,

Louis

&#160;

&#160;

Van: David Touzeau [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">david at articatech.com</A>] 
Verzonden: dinsdag 21 september 2021 10:18
Aan: L.P.H. van Belle; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Onderwerp: Re: [squid-users] squid 5.1: Kerberos: Unable to switch to basic auth with Edge - IE - Chrome



Thanks Louis for this tips but we did not want to use NTLM as it is an old way.
It requires a samba on the Squid Box 

As Amos said, this is most a browser (that using Microsoft API ) issue 

The best way is to make these browsers replicating the correct Firefox behavior. 
Means swith to basic auth instead of trying this stupid NTLM method

Le 21/09/2021 &#224; 09:38, L.P.H. van Belle a &#233;crit&#160;:


in your smb.conf add # Added to enforced NTLM 2, must be set on all Samba AD-DC's and the needed members. # This is used in combination with ntlm_auth --allow-mschapv2 ntlm auth = mschapv2-and-ntlmv2-only In squid use: auth_param negotiate program /usr/lib/squid/negotiate_wrapper_auth \ --kerberos /usr/lib/squid/negotiate_kerberos_auth -k /etc/squid/krb5-squid-HTTP.keytab \ -s HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy.fq.dn.tld at MY.REALM.TLD</A> \ --ntlm /usr/bin/ntlm_auth --allow-mschapv2 --helper-protocol=gss-spnego --domain=ADDOM If you connecting for ldap.. Dont use -h 192.168.90.10 Uses -H <A HREF="ldaps://host.name.fq.dn">ldaps://host.name.fq.dn</A> Also push the root-CA off the domain to pc's with GPO for example And in that GPO you can set the parts you need to enable for the users/pcs to make it all work. But your close, your almost there.. On thing i have not looked at myself yet, ext_kerberos_ldap_group_acl <A HREF="https://fossies.org/linux/squid/src/acl/external/kerberos_ldap_group/ext_kerberos_ldap_group_acl.8">https://fossies.org/linux/squid/src/acl/external/kerberos_ldap_group/ext_kerberos_ldap_group_acl.8</A> Thats one i'll be using with squid 5.1, im still compiling everyting i need, but then im setting It up, i'll document it and make and howto of it. Greetz, Louis ________________________________ Van: squid-users [ MailScanner heeft een e-mail met mogelijk een poging tot fraude gevonden van &quot;lists.squid-cache.org&quot; mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] Namens David Touzeau Verzonden: dinsdag 21 september 2021 1:49 Aan: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> Onderwerp: [squid-users] squid 5.1: Kerberos: Unable to switch to basic auth with Edge - IE - Chrome Hi all i have setup Kerberos authentication with Windows 2019 domain using Squid 5.1 ( The Squid version did not fix the issue - Tested 4.x and 5.x) In some cases, some computers are not joined to the domain and ween need to allow authenticate on Squid To allow this, Basic Authentication is defined in Squid and we expect that browsers prompt a login to be authenticated and access to Internet But the behavior is strange. On a computer outside the windows domain: Firefox is be able to be successfully authenticated to squid using basic auth. Edge, Chrome and IE still try ujsing NTLM method and are allways rejected with a 407 When edge, chrome and IE try to establish a session, Squid claim 2021/09/21 01:17:27 kid1| ERROR: Negotiate Authentication validating user. Result: {result=BH, notes={message: received type 1 NTLM token; }} This let us understanding that these 3 browsers try NTLM instead of a Basic Authentication. I did not know why these browsers using NTLM as they did not connected to the Windows domain Why squid never get the Basic Authentication credentials. ? Did i miss something ? Here it is my configuration. auth_param negotiate program /lib/squid3/negotiate_kerberos_auth -r -s GSS_C_NO_NAME -k /etc/squid3/PROXY.keytab auth_param negotiate children 20 startup=5 idle=1 concurrency=0 queue-size=80 on-persistent-overload=ERR auth_param negotiate keep_alive on auth_param basic program /lib/squid3/basic_ldap_auth -v -R -b &quot;DC=articatech,DC=int&quot; -D &quot;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">administrator at articatech.int</A>&quot; &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">administrator at articatech.int</A>&gt; -W /etc/squid3/ldappass.txt -f sAMAccountName=%s -v 3 -h 192.168.90.10 auth_param basic children 3 auth_param basic realm Active Directory articatech.int auth_param basic credentialsttl 7200 seconds authenticate_ttl 3600 seconds authenticate_ip_ttl 1 seconds authenticate_cache_garbage_interval 3600 seconds acl AUTHENTICATED proxy_auth REQUIRED _______________________________________________ squid-users mailing list <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20210921/fdcf06eb/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20210921/fdcf06eb/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="024085.html">[squid-users] squid 5.1: Kerberos: Unable to switch to basic auth with Edge - IE - Chrome
</A></li>
	<LI>Next message (by thread): <A HREF="024083.html">[squid-users] got many messages after upgrade from 4.16 to 5.1: assertion failed: Transients.cc:221: &quot;old == e&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24087">[ date ]</a>
              <a href="thread.html#24087">[ thread ]</a>
              <a href="subject.html#24087">[ subject ]</a>
              <a href="author.html#24087">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
