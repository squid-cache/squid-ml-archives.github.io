From squid3 at treenet.co.nz  Fri Apr  1 08:46:44 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 1 Apr 2022 21:46:44 +1300
Subject: [squid-users] Squid 3-5 CPU optimization and best practise .
In-Reply-To: <DBBPR09MB45239A6457A6672047FC3EB4F7E19@DBBPR09MB4523.eurprd09.prod.outlook.com>
References: <DBBPR09MB452385D62C7E1DABEC86DD26F7E19@DBBPR09MB4523.eurprd09.prod.outlook.com>
 <5bec2f16-d14f-6d81-6cba-53fada94e012@measurement-factory.com>
 <DBBPR09MB45239A6457A6672047FC3EB4F7E19@DBBPR09MB4523.eurprd09.prod.outlook.com>
Message-ID: <0455291c-e65a-ee8b-7cc8-261d350c6ee1@treenet.co.nz>

FYI; CPU in Squid is primarily consumed by two things:


1) parsing and processing HTTP message headers.

The only thing you can do about this is detect and reject unwanted 
traffic as early as possible.

Your OS firewall is obviously the early line of defense. Preventing 
unwanted network ranges from reaching Squid listening ports saves Squid 
from spending CPU cycles looking up details about those unwanted clients.

Then for clients who are potentially valid the default http_access rules 
reject dangerous traffic quickly and efficiently. Make sure any custom 
http_access rules are listed *after* those ones. Then see (2).



2) processing access controls (ACL checks).

To optimize this needs attention to what order ACLs are tested in versus 
how complex they are to process.

How many CPU cycles are consumed managing any resources they or other 
processes they trigger is also important.

If you want a free optimization review please post your full squid.conf 
(just without the documentation comments and empty lines). Then we can 
point out any performance tricks you may not yet be using.




Beyond those two you are getting into "advanced admin" levels of 
performance optimization. Where YMMV, Alex has mentioned. Every network 
is different so none of us can say a specific thing to do that will be 
better for you.

HTH
Amos


From jason.spashett at menlosecurity.com  Fri Apr  1 15:37:26 2022
From: jason.spashett at menlosecurity.com (Jason Spashett)
Date: Fri, 1 Apr 2022 16:37:26 +0100
Subject: [squid-users] ACL evaluation from ICAP response header
Message-ID: <CANj0NTrUuuaAw6B+5dKaPSODNp2v+zY3BgFkBTcqsXMEuVqQ4w@mail.gmail.com>

Hello,

I was wondering if there is a way to evaluate an ACL from some response
from an ICAP server. I have tried returning an ICAP response header in
reqmod, but it doesn't seem possible to get at the header using the note
ACL.

I've not tried adding an HTTP header in ICAP, that may work perhaps, but it
doesn't seem a good option in any case.

- Jason
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220401/d46c731c/attachment.htm>

From rousskov at measurement-factory.com  Fri Apr  1 18:32:57 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Fri, 1 Apr 2022 14:32:57 -0400
Subject: [squid-users] ACL evaluation from ICAP response header
In-Reply-To: <CANj0NTrUuuaAw6B+5dKaPSODNp2v+zY3BgFkBTcqsXMEuVqQ4w@mail.gmail.com>
References: <CANj0NTrUuuaAw6B+5dKaPSODNp2v+zY3BgFkBTcqsXMEuVqQ4w@mail.gmail.com>
Message-ID: <8a7fb015-b30a-1f49-12ad-6cefa5881c48@measurement-factory.com>

On 4/1/22 11:37, Jason Spashett wrote:

> I was wondering if there is a way to evaluate?an ACL from some response 
> from an ICAP server. I have tried returning an ICAP response header in 
> reqmod, but it doesn't seem possible to get at the header using the note 
> ACL.


Squid does not support converting ICAP (meta)headers into annotations. 
It is a known to-do item. Squid claimed to support converting eCAP 
meta-headers into annotations, but my recent experiments showed that it 
was not happening either. I have a fix for eCAP and am working on making 
it official. A similar change/enhancement will need to be done for ICAP.

Meanwhile, you may be able to, in some cases, work around the lack of 
support by passing "%adapt::<last_h{metaheader-name-here}" to an 
external ACL helper (or to a built-in ACL that supports logformat %codes).


HTH,

Alex.


From pvs at cdot.in  Thu Apr  7 04:15:02 2022
From: pvs at cdot.in (pvs)
Date: Thu, 7 Apr 2022 09:45:02 +0530
Subject: [squid-users] Fine tuning of Squid and OS configuration for
 handling more loads
Message-ID: <751004bb-9b9e-a44f-312f-10b9678c2e26@cdot.in>

Hello,

We have setup a new squid proxy? 5.2 running on Ubuntu 20.4? to provide 
internet access to more than 500 users without ACLs/blacklists

For 2 days it worked fine except occassional 'Connection Timedout'

On the 3rd day morning all of a sudden squid process stopped, after 
restarting it worked 10 minutes and again stopped, this process repeated 
and finally we removed this squid from production network.

We tried to analyze the syslog file, squid access/cache log files, not 
got any concrete clues.

Any clues/ideas where i can look for additional info for the squid 
process all of a sudden dying.

Your help is greatly appreciated and thanks in advance


-- 
Regards,

??. ?????? ????		P. Vishnu Sankar
??? ????                Team Leader-Network Operations
??-???                  C-DOT
?????????????? ???? ???? I    Electronics City Phase I
????? ??? ????????          Hosur Road Bengaluru ? 560100
???  Ph                91 80 25119466
------------------------------------------------------
Disclaimer :
This email and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are addressed.
If you are not the intended recipient you are notified that disclosing, copying, distributing or taking any action in reliance on the contents of this information is strictly prohibited.
The sender does not accept liability for any errors or omissions in the contents of this message, which arise as a result.



From 0xff1f at gmail.com  Thu Apr  7 04:35:50 2022
From: 0xff1f at gmail.com (Ahmad Alzaeem)
Date: Thu, 7 Apr 2022 04:35:50 +0000
Subject: [squid-users] Squid 3-5 CPU optimization and best practise .
Message-ID: <DBBPR09MB452306E4155600E734716A8FF7E69@DBBPR09MB4523.eurprd09.prod.outlook.com>



Hello Amos ,

Config file is based on IP auth and user/pass auth .
But I want to minimize the CPU hit of my config file as much as possible .

Version : Squid 5.3

###############################################################################################

squid.conf

acl RDP-Domain-controller src 77.90.230.0/24 77.90.228.0/24 77.90.225.0/24 77.90.210.0/24 77.90.193.0/24 77.90.145.0/24 77.90.112.0/24 88.21.95.0/24 88.21.94.0/24 88.21.76.0/24 88.21.75.0/24 88.21.72.0/24 88.21.36.0/24 88.21.34.0/24 88.21.199.0/24 88.21.193.0/24 88.21.192.0/24 88.21.137.0/24 88.21.135.0/24 88.21.132.0/24 88.21.131.0/24 88.21.129.0/24 88.21.128.0/24 88.21.126.0/24 88.21.121.0/24 88.21.120.0/24 88.108.9.0/24 88.108.45.0/24
http_access allow RDP-Domain-controller

acl googleaccess dstdomain .google.com .google.ad .google.ae .google.com.af .google.com.ag .google.com.ai .google.al .google.am .google.co.ao .google.com.ar .google.as .google.at .google.com.au .google.az .google.ba .google.com.bd .google.be .google.bf .google.bg .google.com.bh .google.bi .google.bj .google.com.bn .google.com.bo .google.com.br .google.bs .google.bt .google.co.bw .google.by .google.com.bz .google.ca .google.cd .google.cf .google.cg .google.ch .google.ci .google.co.ck .google.cl .google.cm .google.cn .google.com.co .google.co.cr .google.com.cu .google.cv .google.com.cy .google.cz .google.de .google.dj .google.dk .google.dm .google.com.do .google.dz


acl FTP proto FTP
http_access deny FTP
http_access deny manager
#################################
acl URN proto URN
http_access deny URN
###########################
#############################################################
visible_hostname squid
###################################
# Lockdown Procedures
auth_param basic program /lib/squid/basic_ncsa_auth /etc/squid/squid_user
acl ncsa_users proxy_auth REQUIRED
auth_param basic children 50
auth_param basic realm login squid Login
http_access deny ncsa_users googleaccess
http_access allow ncsa_users
auth_param basic casesensitive on
#########################################
cache_effective_user squid
cache_effective_group squid
##############
server_persistent_connections off
client_persistent_connections off
cache deny all
###############################################
http_port  66.4.223.238:45000 name=45000
http_port  66.4.223.238:45001 name=45001
http_port  66.4.223.238:45002 name=45002
http_port  66.4.223.238:45003 name=45003
#########
acl user45000 myportname 45000
acl user45001 myportname 45001
acl user45002 myportname 45002
acl user45003 myportname 45003
#############
tcp_outgoing_address 2a0f:3fc6:f1f1:459e:ba16:10cc:3d9f:6d8f user45000
tcp_outgoing_address 2a0f:3fc6:f1f1:459e:ca27:f465:986e:6dfc user45001
tcp_outgoing_address 2a0f:3fc6:f1f1:459e:27de:fec7:49fc:3113 user45002
tcp_outgoing_address 2a0f:3fc6:f1f1:459e:698a:d044:d39e:ffe7 user45003
tcp_outgoing_address 2a0f:3fc6:f1f1:459e:bc96:9e75:6653:76ac user45004






From: squid-users <squid-users-bounces at lists.squid-cache.org> on behalf of Amos Jeffries <squid3 at treenet.co.nz>
Date: Friday, April 1, 2022 at 1:51 AM
To: squid-users at lists.squid-cache.org <squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] Squid 3-5 CPU optimization and best practise .
FYI; CPU in Squid is primarily consumed by two things:


1) parsing and processing HTTP message headers.

The only thing you can do about this is detect and reject unwanted
traffic as early as possible.

Your OS firewall is obviously the early line of defense. Preventing
unwanted network ranges from reaching Squid listening ports saves Squid
from spending CPU cycles looking up details about those unwanted clients.

Then for clients who are potentially valid the default http_access rules
reject dangerous traffic quickly and efficiently. Make sure any custom
http_access rules are listed *after* those ones. Then see (2).



2) processing access controls (ACL checks).

To optimize this needs attention to what order ACLs are tested in versus
how complex they are to process.

How many CPU cycles are consumed managing any resources they or other
processes they trigger is also important.

If you want a free optimization review please post your full squid.conf
(just without the documentation comments and empty lines). Then we can
point out any performance tricks you may not yet be using.




Beyond those two you are getting into "advanced admin" levels of
performance optimization. Where YMMV, Alex has mentioned. Every network
is different so none of us can say a specific thing to do that will be
better for you.

HTH
Amos
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220407/4f4c7210/attachment.htm>

From musamamehboob at gmail.com  Thu Apr  7 13:36:22 2022
From: musamamehboob at gmail.com (Usama Mehboob)
Date: Thu, 7 Apr 2022 09:36:22 -0400
Subject: [squid-users] Squid process crashed
Message-ID: <CAPjjjyhZ+dVjbnVMJ5rjCy8vuYiOFfjpVY-qV7TXgYjNkaV_LA@mail.gmail.com>

I have squid 5.3 running on amazon linux 2 and it was running fine for some
weeks until it suddenly stopped working yesterday on our production server
and caused outage. I have set it to auto-restart for now. But if someone
could review my squid.conf file and see if there is something wrong?
This is the error I saw
===
2022/04/06 00:45:31| FATAL: xcalloc: Unable to allocate 1 blocks of 68431
bytes!
current master transaction: master27687315
2022/04/06 00:45:31| Squid Cache (Version 5.3): Terminated abnormally.
current master transaction: master27687315
===
squid.conf
---
[ec2-user at ip-172-24-9-143 ~]$ sudo cat /usr/local/squid/etc/squid.conf
#
# Recommended minimum configuration:
#

# Example rule allowing access from your local networks.
# Adapt to list your (internal) IP networks from where browsing
# should be allowed
acl localnet src 0.0.0.1-0.255.255.255 # RFC 1122 "this" network (LAN)
acl localnet src 10.0.0.0/8 # RFC 1918 local private network (LAN)
acl localnet src 100.64.0.0/10 # RFC 6598 shared address space (CGN)
acl localnet src 169.254.0.0/16 # RFC 3927 link-local (directly plugged)
machines
acl localnet src 172.16.0.0/12 # RFC 1918 local private network (LAN)
acl localnet src 192.168.0.0/16 # RFC 1918 local private network (LAN)
acl localnet src fc00::/7       # RFC 4193 local private network range
acl localnet src fe80::/10       # RFC 4291 link-local (directly plugged)
machines

acl SSL_ports port 443
acl Safe_ports port 80 # http
acl Safe_ports port 21 # ftp
acl Safe_ports port 443 # https
acl Safe_ports port 70 # gopher
acl Safe_ports port 210 # wais
acl Safe_ports port 1025-65535 # unregistered ports
acl Safe_ports port 280 # http-mgmt
acl Safe_ports port 488 # gss-http
acl Safe_ports port 591 # filemaker
acl Safe_ports port 777 # multiling http

server_idle_pconn_timeout 60 minute
connect_timeout 60 minute
read_timeout 60 minute
write_timeout 60 minute
request_timeout 60 minute

#
# Recommended minimum Access Permission configuration:
#
# Deny requests to certain unsafe ports
http_access deny !Safe_ports

# Deny CONNECT to other than secure SSL ports
http_access deny CONNECT !SSL_ports

# Only allow cachemgr access from localhost
#http_access allow localhost manager
http_access deny manager

# We strongly recommend the following be uncommented to protect innocent
# web applications running on the proxy server who think the only
# one who can access services on "localhost" is a local user
#http_access deny to_localhost

#
# INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
#

# Filter HTTPS requests based on the whitelist
acl allowed_https_sites ssl::server_name .pypi.org .pythonhosted.org .
tfhub.dev .gstatic.com .googleapis.com
acl allowed_https_sites ssl::server_name .veevasourcedev.com .
veevasource.com .google.com
acl allowed_https_sites ssl::server_name .amazonaws.com

# Example rule allowing access from your local networks.
# Adapt localnet in the ACL section to list your (internal) IP networks
# from where browsing should be allowed
#http_access allow localnet
#http_access allow localhost

# And finally deny all other access to this proxy
#http_access deny all

# Squid normally listens to port 3128
http_port 3128
https_port 3130 intercept ssl-bump cert=/usr/local/squid/ssl_cert/myCA.pem
generate-host-certificates=on dynamic_cert_mem_cache_size=256MB
http_access allow SSL_ports
sslcrtd_program /usr/local/squid/libexec/security_file_certgen -s
/usr/local/squid/var/lib/ssl_db -M 256MB
#sslcrtd_children 3 startup=1 idle=1
#tls_outgoing_options options=NO_SSLv3

acl step1 at_step SslBump1
acl step2 at_step SslBump2
acl step3 at_step SslBump3
##ssl_bump peek step1 all
ssl_bump peek step1
ssl_bump peek step2 allowed_https_sites
##ssl_bump splice step3 allowed_https_sites
ssl_bump splice step3 allowed_https_sites
#ssl_bump bump all
ssl_bump terminate step2 all
#ssl_bump bump all
#http_access allow allowed_https_sites
http_access deny all

# Uncomment and adjust the following to add a disk cache directory.
#cache_dir ufs /usr/local/squid/var/cache/squid 100 16 256

# Leave coredumps in the first cache dir
coredump_dir /usr/local/squid/var/cache/squid

#
# Add any of your own refresh_pattern entries above these.
#
refresh_pattern ^ftp: 1440 20% 10080
refresh_pattern ^gopher: 1440 0% 1440
refresh_pattern -i (/cgi-bin/|\?) 0 0% 0
refresh_pattern . 0 20% 4320

logformat custom  %tg rep_time==%1tr %>a %Ss/%03>Hs %<st %[un %Sh/%<a %mt
-- %ssl::bump_mode %ssl::>sni server==> %ssl::<cert_subject
err=%ssl::<cert_errors %ssl::<negotiated_version
%ssl::<received_supported_version %ssl::<received_hello_version
%ssl::<negotiated_version
access_log  /usr/local/squid/var/logs/access.log custom
debug_options ALL, 2, rotate=1
forwarded_for delete
via off
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220407/6df053d3/attachment.htm>

From rousskov at measurement-factory.com  Fri Apr  8 13:39:45 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Fri, 8 Apr 2022 09:39:45 -0400
Subject: [squid-users] Fine tuning of Squid and OS configuration for
 handling more loads
In-Reply-To: <751004bb-9b9e-a44f-312f-10b9678c2e26@cdot.in>
References: <751004bb-9b9e-a44f-312f-10b9678c2e26@cdot.in>
Message-ID: <dd3c0c0a-1190-7210-f177-79be2b3294af@measurement-factory.com>

On 4/8/22 05:56, pvs wrote:

 > sudo /usr/squid/5.2/sbin/squid -f /etc/squid/squid.conf

Next time, try starting Squid from the console/terminal using the 
following command:

     sudo /usr/squid/5.2/sbin/squid -Nd1 -f /etc/squid/squid.conf

This is _not_ the right way to start Squid in production, but it is a 
good way to test whether you can get some error messages on the console 
after Squid dies during this _test_ run.


 > I wanted to share cache.log file, but the size is too big.

You can always share a link to a (compressed) log file or at least 
copy-paste the last ~100 lines written just _before Squid exited_. The 
exiting lines, if any, would be printed above the Squid startup lines 
similar to these:

 > 2022/04/07 18:43:38.457| Created PID file (.../squid.pid)
 > 2022/04/07 18:43:38.459| Set Current Directory to /usr/local/squid/var
 > 2022/04/07 18:43:38.459| Starting Squid Cache version ...

The other information you have provided was useful but not sufficient.


Please keep this conversation on the squid-users list instead of 
responding to me personally.


Thank you,

Alex.


 > On 07-04-2022 19:09, Alex Rousskov wrote:
 >> On 4/7/22 00:15, pvs wrote:
 >>
 >>> On the 3rd day morning all of a sudden squid process stopped, after
 >>> restarting it worked 10 minutes and again stopped, this process
 >>> repeated and finally we removed this squid from production network.
 >>
 >>> We tried to analyze the syslog file, squid access/cache log files,
 >>> not got any concrete clues.
 >>>
 >>> Any clues/ideas where i can look for additional info for the squid
 >>> process all of a sudden dying.
 >>
 >> How do you start Squid?
 >>
 >> How many "sbin/squid" or equivalent processes are running when
 >> everything is working OK?
 >>
 >> You may want to share "ps aux | fgrep squid" or similar output after
 >> starting Squid the usual way.
 >>
 >>
 >> If Squid knows that it is dying, then cache.log usually has a record
 >> of the cause of death. Squid will often known that it is dying, but
 >> there are exceptions. Squid will know less if you start it with a -C
 >> command line option.
 >>
 >> If Squid does not know that it is dying, then whatever scripts/system
 >> you used to start Squid may have a record of it. Usually, those
 >> messages go into syslog.
 >>
 >> I know you said you looked in cache.log and syslog, but perhaps there
 >> are some clues there that you consider unimportant. If anything is
 >> logged at the time of death, consider sharing those records.
 >>
 >>
 >> If there are really no traces anywhere, then you are doing something
 >> very unusual, but you should still be able to triage the issue if you
 >> start Squid by hand from the terminal (add "-d1" if you are not using
 >> that option already) and watch the console output at the time of
 >> death. You will also be able to collect the exit code of the top-level
 >> squid process this way -- another potential clue.
 >>
 >>
 >> HTH,
 >>
 >> Alex.
 >
 > --
 > Regards,
 >
 > ??. ?????? ????		P. Vishnu Sankar
 > ??? ????                Team Leader-Network Operations
 > ??-???                  C-DOT
 > ?????????????? ???? ???? I    Electronics City Phase I
 > ????? ??? ????????          Hosur Road Bengaluru ? 560100
 > ???  Ph                91 80 25119466
 > ------------------------------------------------------


From pvs at cdot.in  Mon Apr 11 11:26:18 2022
From: pvs at cdot.in (pvs)
Date: Mon, 11 Apr 2022 16:56:18 +0530
Subject: [squid-users] Fine tuning of Squid and OS configuration for
 handling more loads
In-Reply-To: <dd3c0c0a-1190-7210-f177-79be2b3294af@measurement-factory.com>
References: <751004bb-9b9e-a44f-312f-10b9678c2e26@cdot.in>
 <dd3c0c0a-1190-7210-f177-79be2b3294af@measurement-factory.com>
Message-ID: <74d4a17d-22d1-7cf4-1e6a-5f20b8d685b0@cdot.in>

Hi Alex,

cache.log file is attached with contents narrowed down to the time just 
before squid process oscillating (going up and down), ultimately dying.


Regards,

Vishnu


On 08-04-2022 19:09, Alex Rousskov wrote:
> On 4/8/22 05:56, pvs wrote:
>
> > sudo /usr/squid/5.2/sbin/squid -f /etc/squid/squid.conf
>
> Next time, try starting Squid from the console/terminal using the 
> following command:
>
> ??? sudo /usr/squid/5.2/sbin/squid -Nd1 -f /etc/squid/squid.conf
>
> This is _not_ the right way to start Squid in production, but it is a 
> good way to test whether you can get some error messages on the 
> console after Squid dies during this _test_ run.
>
>
> > I wanted to share cache.log file, but the size is too big.
>
> You can always share a link to a (compressed) log file or at least 
> copy-paste the last ~100 lines written just _before Squid exited_. The 
> exiting lines, if any, would be printed above the Squid startup lines 
> similar to these:
>
> > 2022/04/07 18:43:38.457| Created PID file (.../squid.pid)
> > 2022/04/07 18:43:38.459| Set Current Directory to /usr/local/squid/var
> > 2022/04/07 18:43:38.459| Starting Squid Cache version ...
>
> The other information you have provided was useful but not sufficient.
>
>
> Please keep this conversation on the squid-users list instead of 
> responding to me personally.
>
>
> Thank you,
>
> Alex.
>
>
> > On 07-04-2022 19:09, Alex Rousskov wrote:
> >> On 4/7/22 00:15, pvs wrote:
> >>
> >>> On the 3rd day morning all of a sudden squid process stopped, after
> >>> restarting it worked 10 minutes and again stopped, this process
> >>> repeated and finally we removed this squid from production network.
> >>
> >>> We tried to analyze the syslog file, squid access/cache log files,
> >>> not got any concrete clues.
> >>>
> >>> Any clues/ideas where i can look for additional info for the squid
> >>> process all of a sudden dying.
> >>
> >> How do you start Squid?
> >>
> >> How many "sbin/squid" or equivalent processes are running when
> >> everything is working OK?
> >>
> >> You may want to share "ps aux | fgrep squid" or similar output after
> >> starting Squid the usual way.
> >>
> >>
> >> If Squid knows that it is dying, then cache.log usually has a record
> >> of the cause of death. Squid will often known that it is dying, but
> >> there are exceptions. Squid will know less if you start it with a -C
> >> command line option.
> >>
> >> If Squid does not know that it is dying, then whatever scripts/system
> >> you used to start Squid may have a record of it. Usually, those
> >> messages go into syslog.
> >>
> >> I know you said you looked in cache.log and syslog, but perhaps there
> >> are some clues there that you consider unimportant. If anything is
> >> logged at the time of death, consider sharing those records.
> >>
> >>
> >> If there are really no traces anywhere, then you are doing something
> >> very unusual, but you should still be able to triage the issue if you
> >> start Squid by hand from the terminal (add "-d1" if you are not using
> >> that option already) and watch the console output at the time of
> >> death. You will also be able to collect the exit code of the top-level
> >> squid process this way -- another potential clue.
> >>
> >>
> >> HTH,
> >>
> >> Alex.
> >
> > --
> > Regards,
> >
> > ??. ?????? ??????????? P. Vishnu Sankar
> > ??? ??????????????????? Team Leader-Network Operations
> > ??-???????????????????? C-DOT
> > ?????????????? ???? ???? I??? Electronics City Phase I
> > ????? ??? ????????????????? Hosur Road Bengaluru ? 560100
> > ???? Ph??????????????? 91 80 25119466
> > ------------------------------------------------------

-- 
Regards,

??. ?????? ????		P. Vishnu Sankar
??? ????                Team Leader-Network Operations
??-???                  C-DOT
?????????????? ???? ???? I    Electronics City Phase I
????? ??? ????????          Hosur Road Bengaluru ? 560100
???  Ph                91 80 25119466
------------------------------------------------------
Disclaimer :
This email and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are addressed.
If you are not the intended recipient you are notified that disclosing, copying, distributing or taking any action in reliance on the contents of this information is strictly prohibited.
The sender does not accept liability for any errors or omissions in the contents of this message, which arise as a result.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: cache-log.rar
Type: application/octet-stream
Size: 37345 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220411/15732cc8/attachment.obj>

From rousskov at measurement-factory.com  Tue Apr 12 14:27:31 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Tue, 12 Apr 2022 10:27:31 -0400
Subject: [squid-users] Fine tuning of Squid and OS configuration for
 handling more loads
In-Reply-To: <74d4a17d-22d1-7cf4-1e6a-5f20b8d685b0@cdot.in>
References: <751004bb-9b9e-a44f-312f-10b9678c2e26@cdot.in>
 <dd3c0c0a-1190-7210-f177-79be2b3294af@measurement-factory.com>
 <74d4a17d-22d1-7cf4-1e6a-5f20b8d685b0@cdot.in>
Message-ID: <36a188ba-d6f3-cd74-2d54-c526ca7952e1@measurement-factory.com>

On 4/11/22 07:26, pvs wrote:

> cache.log file is attached with contents narrowed down to the time just 
> before squid process oscillating (going up and down), ultimately dying.

Your Squid v5.2 is probably suffering from bug #5055:
https://bugs.squid-cache.org/show_bug.cgi?id=5055

Upgrade your Squid to v5.4.1 or later.

> We tried to analyze the syslog file, squid access/cache log files,
> not got any concrete clues.

FWIW, look for messages mentioning words "FATAL":

> 2022/03/02 09:05:42 kid1| FATAL: check failed: opening()

>     exception location: tunnel.cc(1300) noteDestinationsEnd



HTH,

Alex.


From ngtech1ltd at gmail.com  Tue Apr 12 22:30:46 2022
From: ngtech1ltd at gmail.com (Eliezer Croitoru)
Date: Wed, 13 Apr 2022 01:30:46 +0300
Subject: [squid-users] Squid-Cache VS PHP, put some things in perspective
Message-ID: <000001d84ebc$f51ee350$df5ca9f0$@gmail.com>

Hey Everybody,

 

Since I know Squid-Cache I remember hearing over and over to not use PHP
however it's a great language.

I had the pleasure of hearing a talk from the creator of PHP and it gave me
couple answers to my doubts and
I wanted to say couple good words about PHP.

 

First the talk is available at the next link:

https://youtu.be/wCZ5TJCBWMg

 

Title: 25 Years of PHP (by the Creator of PHP)

Description: PHP has been around for almost as long as the Web. 25 years!

Join me for a fun look at the highlights (and lowlights) of this crazy trip.
But I will also be trying to convince you to upgrade your PHP version. 

The performance alone should be enough, if not, I have a few other tricks up
my sleeve to try to win you over.

Performance optimization, static analysis, zero-cost profiling, dead code
elimination and escape analysis are just some of the concepts that will be
covered.

 

EVENT:

 

phpday 2019 | Verona, May 10-11th | phpday.it

 

SPEAKER:

 

Rasmus Lerdorf

 

PUBLICATION PERMISSIONS:

 

Original video was published with the Creative Commons license.

## END OF SECTION

 

PHP is a good language if not one of the best languages ever made.

And I can see daily how it gives many parts of the internet and the world to
just work and make the world a better place.
(There are. bad uses for anything good..)

I have been using Squid-Cache for the last 14 ~ years for many things and I
am really not a programmer.

I actually didn't even like to code and I have seen uses of PHP which amazed
me all these years.

For theses who want to run a squid helper with PHP you just need to
understand that PHP was not built for this purpose.

I assume that the availability of PHP helpers examples and the simplicity of
the language technical resources might be the cause of this.

 

I want to run a test of a PHP helper with PHP 7.4 and PHP 8.0 , they both
contains couple amazing improvements but needs to be tested.

The next Skelton:

https://gist.githubusercontent.com/elico/5d1cc6dceebbe7ae8f6cedf158396905/ra
w/1655125419b5063477723f9f1687167afd003665/fake-helper.php

 

Is a fake PHP helper for the tests.

I really recommend on other languages and other ways to implement a helper
solution but if we will be able to test this it's possible
that the conclusions will be more then satisfying to prove if the language
issues were fixed.

 

I need an idea for a testing helper and was thinking about a basic session
helper.

 

I my last take of a session helper what I did was to write the next:

https://wiki.squid-cache.org/EliezerCroitoru/SessionHelper

https://wiki.squid-cache.org/EliezerCroitoru/SessionHelper/Conf

https://wiki.squid-cache.org/EliezerCroitoru/SessionHelper/PhpLoginExample

https://wiki.squid-cache.org/EliezerCroitoru/SessionHelper/Python

https://wiki.squid-cache.org/EliezerCroitoru/SessionHelper/SplashPageTemplat
e

 

And I have also seen that there are couple examples for the:

readline_callback_handler_install

 

function in PHP which might result in a solution for the problem.

 

I am looking for adventurous Squid Users which wants to help me test if PHP
7.4+ still possess the same old 5.x STDIN bugs.

 

Thanks,

Eliezer

 

----

Eliezer Croitoru

NgTech, Tech Support

Mobile: +972-5-28704261

Email:  <mailto:ngtech1ltd at gmail.com> ngtech1ltd at gmail.com

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220413/66aa670c/attachment.htm>

From pvs at cdot.in  Wed Apr 13 16:23:06 2022
From: pvs at cdot.in (pvs)
Date: Wed, 13 Apr 2022 21:53:06 +0530
Subject: [squid-users] Fine tuning of Squid and OS configuration for
 handling more loads
In-Reply-To: <36a188ba-d6f3-cd74-2d54-c526ca7952e1@measurement-factory.com>
References: <751004bb-9b9e-a44f-312f-10b9678c2e26@cdot.in>
 <dd3c0c0a-1190-7210-f177-79be2b3294af@measurement-factory.com>
 <74d4a17d-22d1-7cf4-1e6a-5f20b8d685b0@cdot.in>
 <36a188ba-d6f3-cd74-2d54-c526ca7952e1@measurement-factory.com>
Message-ID: <359a672c-eaf6-c37d-092a-1edad96fa7b3@cdot.in>

Thanks Alex.

We will upgrade the squid and see if the problem recurs



O 12-04-2022 19:57, Alex Rousskov wrote:
> On 4/11/22 07:26, pvs wrote:
>
>> cache.log file is attached with contents narrowed down to the time 
>> just before squid process oscillating (going up and down), ultimately 
>> dying.
>
> Your Squid v5.2 is probably suffering from bug #5055:
> https://bugs.squid-cache.org/show_bug.cgi?id=5055
>
> Upgrade your Squid to v5.4.1 or later.
>
>> We tried to analyze the syslog file, squid access/cache log files,
>> not got any concrete clues.
>
> FWIW, look for messages mentioning words "FATAL":
>
>> 2022/03/02 09:05:42 kid1| FATAL: check failed: opening()
>
>> ??? exception location: tunnel.cc(1300) noteDestinationsEnd
>
>
>
> HTH,
>
> Alex.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-- 
Regards,

??. ?????? ????		P. Vishnu Sankar
??? ????                Team Leader-Network Operations
??-???                  C-DOT
?????????????? ???? ???? I    Electronics City Phase I
????? ??? ????????          Hosur Road Bengaluru ? 560100
???  Ph                91 80 25119466
------------------------------------------------------
Disclaimer :
This email and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are addressed.
If you are not the intended recipient you are notified that disclosing, copying, distributing or taking any action in reliance on the contents of this information is strictly prohibited.
The sender does not accept liability for any errors or omissions in the contents of this message, which arise as a result.



From ngtech1ltd at gmail.com  Wed Apr 13 20:24:21 2022
From: ngtech1ltd at gmail.com (Eliezer Croitoru)
Date: Wed, 13 Apr 2022 23:24:21 +0300
Subject: [squid-users] Fine tuning of Squid and OS configuration for
 handling more loads
In-Reply-To: <359a672c-eaf6-c37d-092a-1edad96fa7b3@cdot.in>
References: <751004bb-9b9e-a44f-312f-10b9678c2e26@cdot.in>
 <dd3c0c0a-1190-7210-f177-79be2b3294af@measurement-factory.com>
 <74d4a17d-22d1-7cf4-1e6a-5f20b8d685b0@cdot.in>
 <36a188ba-d6f3-cd74-2d54-c526ca7952e1@measurement-factory.com>
 <359a672c-eaf6-c37d-092a-1edad96fa7b3@cdot.in>
Message-ID: <000001d84f74$7681d350$638579f0$@gmail.com>

Can you please verify if the next is a workaround to your issue:
cache_mem 16 MB
cache deny all

Thanks,
Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of pvs
Sent: Wednesday, April 13, 2022 19:23
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Fine tuning of Squid and OS configuration for handling more loads

Thanks Alex.

We will upgrade the squid and see if the problem recurs



O 12-04-2022 19:57, Alex Rousskov wrote:
> On 4/11/22 07:26, pvs wrote:
>
>> cache.log file is attached with contents narrowed down to the time 
>> just before squid process oscillating (going up and down), ultimately 
>> dying.
>
> Your Squid v5.2 is probably suffering from bug #5055:
> https://bugs.squid-cache.org/show_bug.cgi?id=5055
>
> Upgrade your Squid to v5.4.1 or later.
>
>> We tried to analyze the syslog file, squid access/cache log files,
>> not got any concrete clues.
>
> FWIW, look for messages mentioning words "FATAL":
>
>> 2022/03/02 09:05:42 kid1| FATAL: check failed: opening()
>
>>     exception location: tunnel.cc(1300) noteDestinationsEnd
>
>
>
> HTH,
>
> Alex.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-- 
Regards,

??. ?????? ????		P. Vishnu Sankar
??? ????                Team Leader-Network Operations
??-???                  C-DOT
?????????????? ???? ???? I    Electronics City Phase I
????? ??? ????????          Hosur Road Bengaluru ? 560100
???  Ph                91 80 25119466
------------------------------------------------------
Disclaimer :
This email and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are addressed.
If you are not the intended recipient you are notified that disclosing, copying, distributing or taking any action in reliance on the contents of this information is strictly prohibited.
The sender does not accept liability for any errors or omissions in the contents of this message, which arise as a result.

_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From rousskov at measurement-factory.com  Wed Apr 13 20:32:03 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Wed, 13 Apr 2022 16:32:03 -0400
Subject: [squid-users] Fine tuning of Squid and OS configuration for
 handling more loads
In-Reply-To: <000001d84f74$7681d350$638579f0$@gmail.com>
References: <751004bb-9b9e-a44f-312f-10b9678c2e26@cdot.in>
 <dd3c0c0a-1190-7210-f177-79be2b3294af@measurement-factory.com>
 <74d4a17d-22d1-7cf4-1e6a-5f20b8d685b0@cdot.in>
 <36a188ba-d6f3-cd74-2d54-c526ca7952e1@measurement-factory.com>
 <359a672c-eaf6-c37d-092a-1edad96fa7b3@cdot.in>
 <000001d84f74$7681d350$638579f0$@gmail.com>
Message-ID: <233975c2-21f6-a7d4-f9d3-f77e8c0f630b@measurement-factory.com>

On 4/13/22 16:24, Eliezer Croitoru wrote:
> Can you please verify if the next is a workaround to your issue:
> cache_mem 16 MB
> cache deny all

Just to avoid misunderstanding, bug #5055 and virtually any other bug 
that manifests itself in FATAL messages from noteDestinationsEnd code is 
unrelated to HTTP caching and is unlikely to be mitigated by changing 
the cache memory size and/or denying HTTP caching.

Alex.


> -----Original Message-----
> From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of pvs
> Sent: Wednesday, April 13, 2022 19:23
> To: squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] Fine tuning of Squid and OS configuration for handling more loads
> 
> Thanks Alex.
> 
> We will upgrade the squid and see if the problem recurs
> 
> 
> 
> O 12-04-2022 19:57, Alex Rousskov wrote:
>> On 4/11/22 07:26, pvs wrote:
>>
>>> cache.log file is attached with contents narrowed down to the time
>>> just before squid process oscillating (going up and down), ultimately
>>> dying.
>>
>> Your Squid v5.2 is probably suffering from bug #5055:
>> https://bugs.squid-cache.org/show_bug.cgi?id=5055
>>
>> Upgrade your Squid to v5.4.1 or later.
>>
>>> We tried to analyze the syslog file, squid access/cache log files,
>>> not got any concrete clues.
>>
>> FWIW, look for messages mentioning words "FATAL":
>>
>>> 2022/03/02 09:05:42 kid1| FATAL: check failed: opening()
>>
>>>      exception location: tunnel.cc(1300) noteDestinationsEnd
>>
>>
>>
>> HTH,
>>
>> Alex.
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
> 



From ngtech1ltd at gmail.com  Wed Apr 13 21:01:40 2022
From: ngtech1ltd at gmail.com (Eliezer Croitoru)
Date: Thu, 14 Apr 2022 00:01:40 +0300
Subject: [squid-users] Fine tuning of Squid and OS configuration for
 handling more loads
In-Reply-To: <233975c2-21f6-a7d4-f9d3-f77e8c0f630b@measurement-factory.com>
References: <751004bb-9b9e-a44f-312f-10b9678c2e26@cdot.in>
 <dd3c0c0a-1190-7210-f177-79be2b3294af@measurement-factory.com>
 <74d4a17d-22d1-7cf4-1e6a-5f20b8d685b0@cdot.in>
 <36a188ba-d6f3-cd74-2d54-c526ca7952e1@measurement-factory.com>
 <359a672c-eaf6-c37d-092a-1edad96fa7b3@cdot.in>
 <000001d84f74$7681d350$638579f0$@gmail.com>
 <233975c2-21f6-a7d4-f9d3-f77e8c0f630b@measurement-factory.com>
Message-ID: <000301d84f79$acaa2ae0$05fe80a0$@gmail.com>

Thanks Alex for catching this!

I was sending the wrong response.
This response was related to bug report:
http://bugs.squid-cache.org/show_bug.cgi?id=4117

Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of
Alex Rousskov
Sent: Wednesday, April 13, 2022 23:32
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Fine tuning of Squid and OS configuration for
handling more loads

On 4/13/22 16:24, Eliezer Croitoru wrote:
> Can you please verify if the next is a workaround to your issue:
> cache_mem 16 MB
> cache deny all

Just to avoid misunderstanding, bug #5055 and virtually any other bug 
that manifests itself in FATAL messages from noteDestinationsEnd code is 
unrelated to HTTP caching and is unlikely to be mitigated by changing 
the cache memory size and/or denying HTTP caching.

Alex.


> -----Original Message-----
> From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of
pvs
> Sent: Wednesday, April 13, 2022 19:23
> To: squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] Fine tuning of Squid and OS configuration for
handling more loads
> 
> Thanks Alex.
> 
> We will upgrade the squid and see if the problem recurs
> 
> 
> 
> O 12-04-2022 19:57, Alex Rousskov wrote:
>> On 4/11/22 07:26, pvs wrote:
>>
>>> cache.log file is attached with contents narrowed down to the time
>>> just before squid process oscillating (going up and down), ultimately
>>> dying.
>>
>> Your Squid v5.2 is probably suffering from bug #5055:
>> https://bugs.squid-cache.org/show_bug.cgi?id=5055
>>
>> Upgrade your Squid to v5.4.1 or later.
>>
>>> We tried to analyze the syslog file, squid access/cache log files,
>>> not got any concrete clues.
>>
>> FWIW, look for messages mentioning words "FATAL":
>>
>>> 2022/03/02 09:05:42 kid1| FATAL: check failed: opening()
>>
>>>      exception location: tunnel.cc(1300) noteDestinationsEnd
>>
>>
>>
>> HTH,
>>
>> Alex.
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
> 

_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From xeron.oskom at gmail.com  Wed Apr 13 22:34:10 2022
From: xeron.oskom at gmail.com (Ivan Larionov)
Date: Wed, 13 Apr 2022 15:34:10 -0700
Subject: [squid-users] squid compilation error in Docker
Message-ID: <CAHvB88xLnc9a0tEqQ6ZuQn0LtoXketTPd1y33xRaW7Q3Nt0=KA@mail.gmail.com>

Hi.

I have no issues building squid normally, but when I try to do exactly the
same steps in docker I'm getting the following errors:

https://gist.github.com/xeron/5530fe9aa1f5bdcb6a72c6edd6476467

Example from that log:

cache_cf.o: In function `configFreeMemory()':
/root/build/src/cache_cf.cc:2982: undefined reference to
`Adaptation::Icap::TheConfig'

I can't figure out what exactly is wrong. Doesn't look like any
dependencies are missing.

Here's my build script:

      yum install -y autoconf automake file gcc72 gcc72-c++ libtool
libtool-ltdl-devel pkgconfig diffutils \
        libxml2-devel libcap-devel openssl-devel

      autoreconf -ivf

      ./configure --program-prefix= --prefix=/usr --exec-prefix=/usr \
        --bindir=/usr/sbin --sbindir=/usr/sbin --sysconfdir=/etc/squid \
        --libdir=/usr/lib --libexecdir=/usr/lib/squid \
        --includedir=/usr/include --datadir=/usr/share/squid \
        --sharedstatedir=/usr/com --localstatedir=/var \
        --mandir=/usr/share/man --infodir=/usr/share/info \
        --enable-epoll --enable-removal-policies=heap,lru \
        --enable-storeio=aufs,rock \
        --enable-delay-pools --with-pthreads --enable-cache-digests \
        --with-large-files --with-filedescriptors=65536 \
        --enable-htcp

      make -j$(nproc) install DESTDIR=$PWD/_destroot

Any ideas?

-- 
With best regards, Ivan Larionov.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220413/a3ea8f3f/attachment.htm>

From ngtech1ltd at gmail.com  Wed Apr 13 23:36:10 2022
From: ngtech1ltd at gmail.com (Eliezer Croitoru)
Date: Thu, 14 Apr 2022 02:36:10 +0300
Subject: [squid-users] squid compilation error in Docker
In-Reply-To: <CAHvB88xLnc9a0tEqQ6ZuQn0LtoXketTPd1y33xRaW7Q3Nt0=KA@mail.gmail.com>
References: <CAHvB88xLnc9a0tEqQ6ZuQn0LtoXketTPd1y33xRaW7Q3Nt0=KA@mail.gmail.com>
Message-ID: <000c01d84f8f$42698980$c73c9c80$@gmail.com>

For CentOS 7 use the next:

RUN yum install -y epel-release \

   &&  yum clean all \

   &&  yum update -y \

   &&  yum install -y gcc gcc-c++ libtool libtool-ltdl make cmake \

               git pkgconfig sudo automake autoconf yum-utils rpm-build \

   &&  yum install -y libxml2 expat-devel openssl-devel libcap ccache \

               libtool-ltdl-devel cppunit cppunit-devel bzr git autoconf \

               automake libtool gcc-c++ perl-Pod-MinimumVersion bzip2 ed \

                make openldap-devel pam-devel db4-devel libxml2-devel \

               libcap-devel screen vim nettle-devel redhat-lsb-core \

               autoconf-archive libtdb-devel libtdb redhat-rpm-config rpm-build rpm-devel \

   &&  yum install -y perl-libwww-perl ruby ruby-devel \

   &&  yum clean all

 

RUN yum update -y \

   &&  yum install -y systemd-units openldap-devel pam-devel \

               openssl-devel krb5-devel db4-devel expat-devel \

               libxml2-devel libcap-devel libtool libtool-ltdl-devel \

               redhat-rpm-config libdb-devel libnetfilter_conntrack-devel \

               gnutls-devel rpmdevtools wget \

   &&  yum clean all

 

 

For CentOS 8 Stream:

RUN dnf install -y epel-release dnf-plugins-core \
   &&  dnf config-manager --set-enabled powertools \
   &&  dnf clean all \
   &&  dnf update -y \
   &&  dnf install -y gcc gcc-c++ libtool libtool-ltdl make cmake \
               git pkgconfig sudo automake autoconf yum-utils rpm-build \
   &&  dnf install -y libxml2 expat-devel openssl-devel libcap ccache \
               libtool-ltdl-devel git autoconf \
               automake libtool gcc-c++ bzip2 ed \
               make openldap-devel pam-devel libxml2-devel \
               libcap-devel screen vim nettle-devel redhat-lsb-core \
               libtdb-devel libtdb redhat-rpm-config rpm-build rpm-devel \
               libnetfilter_conntrack-devel \
   &&  dnf install -y perl-libwww-perl ruby ruby-devel \
   &&  dnf clean all
 
RUN dnf update -y \
   &&  dnf install -y systemd-units openldap-devel pam-devel \
               openssl-devel krb5-devel expat-devel \
               libxml2-devel libcap-devel libtool libtool-ltdl-devel \
               redhat-rpm-config libdb-devel \
               gnutls-devel rpmdevtools wget \
   &&  dnf clean all

 

 

----

Eliezer Croitoru

NgTech, Tech Support

Mobile: +972-5-28704261

Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> 

 

From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Ivan Larionov
Sent: Thursday, April 14, 2022 01:34
To: squid-users at lists.squid-cache.org
Subject: [squid-users] squid compilation error in Docker

 

Hi.

 

I have no issues building squid normally, but when I try to do exactly the same steps in docker I'm getting the following errors:

 

https://gist.github.com/xeron/5530fe9aa1f5bdcb6a72c6edd6476467

 

Example from that log:

 

cache_cf.o: In function `configFreeMemory()':

/root/build/src/cache_cf.cc:2982: undefined reference to `Adaptation::Icap::TheConfig'

 

I can't figure out what exactly is wrong. Doesn't look like any dependencies are missing.


 

Here's my build script:

 

      yum install -y autoconf automake file gcc72 gcc72-c++ libtool libtool-ltdl-devel pkgconfig diffutils \
        libxml2-devel libcap-devel openssl-devel

      autoreconf -ivf

      ./configure --program-prefix= --prefix=/usr --exec-prefix=/usr \
        --bindir=/usr/sbin --sbindir=/usr/sbin --sysconfdir=/etc/squid \
        --libdir=/usr/lib --libexecdir=/usr/lib/squid \
        --includedir=/usr/include --datadir=/usr/share/squid \
        --sharedstatedir=/usr/com --localstatedir=/var \
        --mandir=/usr/share/man --infodir=/usr/share/info \
        --enable-epoll --enable-removal-policies=heap,lru \
        --enable-storeio=aufs,rock \
        --enable-delay-pools --with-pthreads --enable-cache-digests \
        --with-large-files --with-filedescriptors=65536 \
        --enable-htcp

      make -j$(nproc) install DESTDIR=$PWD/_destroot

 

Any ideas?

 

-- 

With best regards, Ivan Larionov.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220414/8a328f3e/attachment.htm>

From xeron.oskom at gmail.com  Thu Apr 14 00:07:11 2022
From: xeron.oskom at gmail.com (Ivan Larionov)
Date: Wed, 13 Apr 2022 17:07:11 -0700
Subject: [squid-users] squid compilation error in Docker
In-Reply-To: <000c01d84f8f$42698980$c73c9c80$@gmail.com>
References: <CAHvB88xLnc9a0tEqQ6ZuQn0LtoXketTPd1y33xRaW7Q3Nt0=KA@mail.gmail.com>
 <000c01d84f8f$42698980$c73c9c80$@gmail.com>
Message-ID: <CAHvB88yg3LhvAs6KdZV=QDeHbZoKFre3V1EpTCe7OSmUEs-oBw@mail.gmail.com>

Yes this worked. Thanks Eliezer.

This means some of these dependencies are required but not caught by the
configure script.

I'll try to figure out which specific one was the culprit.

On Wed, Apr 13, 2022 at 4:36 PM Eliezer Croitoru <ngtech1ltd at gmail.com>
wrote:

> For CentOS 7 use the next:
>
> RUN yum install -y epel-release \
>
>    &&  yum clean all \
>
>    &&  yum update -y \
>
>    &&  yum install -y gcc gcc-c++ libtool libtool-ltdl make cmake \
>
>                git pkgconfig sudo automake autoconf yum-utils rpm-build \
>
>    &&  yum install -y libxml2 expat-devel openssl-devel libcap ccache \
>
>                libtool-ltdl-devel cppunit cppunit-devel bzr git autoconf \
>
>                automake libtool gcc-c++ perl-Pod-MinimumVersion bzip2 ed \
>
>                 make openldap-devel pam-devel db4-devel libxml2-devel \
>
>                libcap-devel screen vim nettle-devel redhat-lsb-core \
>
>                autoconf-archive libtdb-devel libtdb redhat-rpm-config
> rpm-build rpm-devel \
>
>    &&  yum install -y perl-libwww-perl ruby ruby-devel \
>
>    &&  yum clean all
>
>
>
> RUN yum update -y \
>
>    &&  yum install -y systemd-units openldap-devel pam-devel \
>
>                openssl-devel krb5-devel db4-devel expat-devel \
>
>                libxml2-devel libcap-devel libtool libtool-ltdl-devel \
>
>                redhat-rpm-config libdb-devel libnetfilter_conntrack-devel \
>
>                gnutls-devel rpmdevtools wget \
>
>    &&  yum clean all
>
>
>
>
>
> For CentOS 8 Stream:
>
> RUN dnf install -y epel-release dnf-plugins-core \
>
>    &&  dnf config-manager --set-enabled powertools \
>
>    &&  dnf clean all \
>
>    &&  dnf update -y \
>
>    &&  dnf install -y gcc gcc-c++ libtool libtool-ltdl make cmake \
>
>                git pkgconfig sudo automake autoconf yum-utils rpm-build \
>
>    &&  dnf install -y libxml2 expat-devel openssl-devel libcap ccache \
>
>                libtool-ltdl-devel git autoconf \
>
>                automake libtool gcc-c++ bzip2 ed \
>
>                make openldap-devel pam-devel libxml2-devel \
>
>                libcap-devel screen vim nettle-devel redhat-lsb-core \
>
>                libtdb-devel libtdb redhat-rpm-config rpm-build rpm-devel \
>
>                libnetfilter_conntrack-devel \
>
>    &&  dnf install -y perl-libwww-perl ruby ruby-devel \
>
>    &&  dnf clean all
>
>
>
> RUN dnf update -y \
>
>    &&  dnf install -y systemd-units openldap-devel pam-devel \
>
>                openssl-devel krb5-devel expat-devel \
>
>                libxml2-devel libcap-devel libtool libtool-ltdl-devel \
>
>                redhat-rpm-config libdb-devel \
>
>                gnutls-devel rpmdevtools wget \
>
>    &&  dnf clean all
>
>
>
>
>
> ----
>
> Eliezer Croitoru
>
> NgTech, Tech Support
>
> Mobile: +972-5-28704261
>
> Email: ngtech1ltd at gmail.com
>
>
>
> *From:* squid-users <squid-users-bounces at lists.squid-cache.org> *On
> Behalf Of *Ivan Larionov
> *Sent:* Thursday, April 14, 2022 01:34
> *To:* squid-users at lists.squid-cache.org
> *Subject:* [squid-users] squid compilation error in Docker
>
>
>
> Hi.
>
>
>
> I have no issues building squid normally, but when I try to do exactly the
> same steps in docker I'm getting the following errors:
>
>
>
> https://gist.github.com/xeron/5530fe9aa1f5bdcb6a72c6edd6476467
>
>
>
> Example from that log:
>
>
>
> cache_cf.o: In function `configFreeMemory()':
>
> /root/build/src/cache_cf.cc:2982: undefined reference to
> `Adaptation::Icap::TheConfig'
>
>
>
> I can't figure out what exactly is wrong. Doesn't look like any
> dependencies are missing.
>
>
>
> Here's my build script:
>
>
>
>       yum install -y autoconf automake file gcc72 gcc72-c++ libtool
> libtool-ltdl-devel pkgconfig diffutils \
>         libxml2-devel libcap-devel openssl-devel
>
>       autoreconf -ivf
>
>       ./configure --program-prefix= --prefix=/usr --exec-prefix=/usr \
>         --bindir=/usr/sbin --sbindir=/usr/sbin --sysconfdir=/etc/squid \
>         --libdir=/usr/lib --libexecdir=/usr/lib/squid \
>         --includedir=/usr/include --datadir=/usr/share/squid \
>         --sharedstatedir=/usr/com --localstatedir=/var \
>         --mandir=/usr/share/man --infodir=/usr/share/info \
>         --enable-epoll --enable-removal-policies=heap,lru \
>         --enable-storeio=aufs,rock \
>         --enable-delay-pools --with-pthreads --enable-cache-digests \
>         --with-large-files --with-filedescriptors=65536 \
>         --enable-htcp
>
>       make -j$(nproc) install DESTDIR=$PWD/_destroot
>
>
>
> Any ideas?
>
>
>
> --
>
> With best regards, Ivan Larionov.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>


-- 
With best regards, Ivan Larionov.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220413/3e383bec/attachment.htm>

From rousskov at measurement-factory.com  Thu Apr 14 02:19:43 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Wed, 13 Apr 2022 22:19:43 -0400
Subject: [squid-users] squid compilation error in Docker
In-Reply-To: <CAHvB88yg3LhvAs6KdZV=QDeHbZoKFre3V1EpTCe7OSmUEs-oBw@mail.gmail.com>
References: <CAHvB88xLnc9a0tEqQ6ZuQn0LtoXketTPd1y33xRaW7Q3Nt0=KA@mail.gmail.com>
 <000c01d84f8f$42698980$c73c9c80$@gmail.com>
 <CAHvB88yg3LhvAs6KdZV=QDeHbZoKFre3V1EpTCe7OSmUEs-oBw@mail.gmail.com>
Message-ID: <5b63e001-d8c6-aa65-6f37-a6c39e39f4e3@measurement-factory.com>

On 4/13/22 20:07, Ivan Larionov wrote:
> Yes this worked. Thanks?Eliezer.
> 
> This means some of these dependencies are required but not caught by the 
> configure script.
> 
> I'll try to figure out which specific one was the culprit.

And maybe find the earlier error in the make log? The errors you shared 
did not look like a direct effect of some missing package, more like a 
side effect of something that went wrong earlier...


Thank you both,

Alex.


> On Wed, Apr 13, 2022 at 4:36 PM Eliezer Croitoru wrote:
> 
>     For CentOS 7 use the next:____
> 
>     RUN yum install -y epel-release \____
> 
>      ?? &&? yum clean all \____
> 
>      ?? &&? yum update -y \____
> 
>      ?? &&? yum install -y gcc gcc-c++ libtool libtool-ltdl make cmake \____
> 
>      ?????????????? git pkgconfig sudo automake autoconf yum-utils
>     rpm-build \____
> 
>      ?? &&? yum install -y libxml2 expat-devel openssl-devel libcap
>     ccache \____
> 
>      ?????????????? libtool-ltdl-devel cppunit cppunit-devel bzr git
>     autoconf \____
> 
>      ?????????????? automake libtool gcc-c++ perl-Pod-MinimumVersion
>     bzip2 ed \____
> 
>      ??????? ??????? make openldap-devel pam-devel db4-devel
>     libxml2-devel \____
> 
>      ?????????????? libcap-devel screen vim nettle-devel redhat-lsb-core
>     \____
> 
>      ?????????????? autoconf-archive libtdb-devel libtdb
>     redhat-rpm-config rpm-build rpm-devel \____
> 
>      ?? &&? yum install -y perl-libwww-perl ruby ruby-devel \____
> 
>      ?? && ?yum clean all____
> 
>     __ __
> 
>     RUN yum update -y \____
> 
>      ?? &&? yum install -y systemd-units openldap-devel pam-devel \____
> 
>      ?????????????? openssl-devel krb5-devel db4-devel expat-devel \____
> 
>      ?????????????? libxml2-devel libcap-devel libtool
>     libtool-ltdl-devel \____
> 
>      ?????????????? redhat-rpm-config libdb-devel
>     libnetfilter_conntrack-devel \____
> 
>      ?????????????? gnutls-devel rpmdevtools wget \____
> 
>      ?? &&? yum clean all____
> 
>     __ __
> 
>     __ __
> 
>     For CentOS 8 Stream:____
> 
>     RUN dnf install -y epel-release dnf-plugins-core \____
> 
>      ?? &&? dnf config-manager --set-enabled powertools \____
> 
>      ?? &&? dnf clean all \____
> 
>      ?? &&? dnf update -y \____
> 
>      ?? &&? dnf install -y gcc gcc-c++ libtool libtool-ltdl make cmake \____
> 
>      ?????????????? git pkgconfig sudo automake autoconf yum-utils rpm-build \____
> 
>      ?? &&? dnf install -y libxml2 expat-devel openssl-devel libcap ccache \____
> 
>      ?????????????? libtool-ltdl-devel git autoconf \____
> 
>      ?????????????? automake libtool gcc-c++ bzip2 ed \____
> 
>      ?????????????? make openldap-devel pam-devel libxml2-devel \____
> 
>      ?????????????? libcap-devel screen vim nettle-devel redhat-lsb-core \____
> 
>      ?????????????? libtdb-devel libtdb redhat-rpm-config rpm-build rpm-devel \____
> 
>      ?????????????? libnetfilter_conntrack-devel \____
> 
>      ?? &&? dnf install -y perl-libwww-perl ruby ruby-devel \____
> 
>      ?? &&? dnf clean all____
> 
>     __  __
> 
>     RUN dnf update -y \____
> 
>      ?? &&? dnf install -y systemd-units openldap-devel pam-devel \____
> 
>      ?????????????? openssl-devel krb5-devel expat-devel \____
> 
>      ?????????????? libxml2-devel libcap-devel libtool libtool-ltdl-devel \____
> 
>      ?????????????? redhat-rpm-config libdb-devel \____
> 
>      ?????????????? gnutls-devel rpmdevtools wget \____
> 
>      ?? &&? dnf clean all____
> 
>     __ __
> 
>     __ __
> 
>     ----____
> 
>     Eliezer Croitoru____
> 
>     NgTech, Tech Support____
> 
>     Mobile: +972-5-28704261____
> 
>     Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com>____
> 
>     __ __
> 
>     *From:* squid-users <squid-users-bounces at lists.squid-cache.org
>     <mailto:squid-users-bounces at lists.squid-cache.org>> *On Behalf Of
>     *Ivan Larionov
>     *Sent:* Thursday, April 14, 2022 01:34
>     *To:* squid-users at lists.squid-cache.org
>     <mailto:squid-users at lists.squid-cache.org>
>     *Subject:* [squid-users] squid compilation error in Docker____
> 
>     __ __
> 
>     Hi.____
> 
>     __ __
> 
>     I have no issues building squid normally, but when I try to do
>     exactly the same steps in docker I'm getting the following errors:____
> 
>     __ __
> 
>     https://gist.github.com/xeron/5530fe9aa1f5bdcb6a72c6edd6476467
>     <https://gist.github.com/xeron/5530fe9aa1f5bdcb6a72c6edd6476467>____
> 
>     __ __
> 
>     Example from that log:____
> 
>     __ __
> 
>     cache_cf.o: In function `configFreeMemory()':____
> 
>     /root/build/src/cache_cf.cc:2982: undefined reference to
>     `Adaptation::Icap::TheConfig'____
> 
>     __ __
> 
>     I can't figure out what exactly is wrong. Doesn't look like any
>     dependencies are missing.
>     ____
> 
>     __ __
> 
>     Here's my build script:____
> 
>     __ __
> 
>      ? ? ? yum install -y autoconf automake file gcc72 gcc72-c++ libtool
>     libtool-ltdl-devel pkgconfig diffutils \
>      ? ? ? ? libxml2-devel libcap-devel openssl-devel
> 
>      ? ? ? autoreconf -ivf
> 
>      ? ? ? ./configure --program-prefix= --prefix=/usr --exec-prefix=/usr \
>      ? ? ? ? --bindir=/usr/sbin --sbindir=/usr/sbin
>     --sysconfdir=/etc/squid \
>      ? ? ? ? --libdir=/usr/lib --libexecdir=/usr/lib/squid \
>      ? ? ? ? --includedir=/usr/include --datadir=/usr/share/squid \
>      ? ? ? ? --sharedstatedir=/usr/com --localstatedir=/var \
>      ? ? ? ? --mandir=/usr/share/man --infodir=/usr/share/info \
>      ? ? ? ? --enable-epoll --enable-removal-policies=heap,lru \
>      ? ? ? ? --enable-storeio=aufs,rock \
>      ? ? ? ? --enable-delay-pools --with-pthreads --enable-cache-digests \
>      ? ? ? ? --with-large-files --with-filedescriptors=65536 \
>      ? ? ? ? --enable-htcp
> 
>      ? ? ? make -j$(nproc) install DESTDIR=$PWD/_destroot____
> 
>     __ __
> 
>     Any ideas?____
> 
>     __ __
> 
>     -- ____
> 
>     With best regards, Ivan Larionov.____
> 
>     _______________________________________________
>     squid-users mailing list
>     squid-users at lists.squid-cache.org
>     <mailto:squid-users at lists.squid-cache.org>
>     http://lists.squid-cache.org/listinfo/squid-users
>     <http://lists.squid-cache.org/listinfo/squid-users>
> 
> 
> 
> -- 
> With best regards, Ivan Larionov.
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



From xeron.oskom at gmail.com  Thu Apr 14 02:59:40 2022
From: xeron.oskom at gmail.com (Ivan Larionov)
Date: Wed, 13 Apr 2022 19:59:40 -0700
Subject: [squid-users] squid compilation error in Docker
In-Reply-To: <5b63e001-d8c6-aa65-6f37-a6c39e39f4e3@measurement-factory.com>
References: <CAHvB88xLnc9a0tEqQ6ZuQn0LtoXketTPd1y33xRaW7Q3Nt0=KA@mail.gmail.com>
 <000c01d84f8f$42698980$c73c9c80$@gmail.com>
 <CAHvB88yg3LhvAs6KdZV=QDeHbZoKFre3V1EpTCe7OSmUEs-oBw@mail.gmail.com>
 <5b63e001-d8c6-aa65-6f37-a6c39e39f4e3@measurement-factory.com>
Message-ID: <CAHvB88w2GABY0qKRCAvUa4Xg3+WS3kVDxBU-hsPuS_z50+xeag@mail.gmail.com>

There were no errors earlier.

Seems like installing openldap-devel fixes the issue.

There were other dependencies installed together with it, not sure if they
also affected the build or not. I assume the ldap one is the main reason:

cracklib
cracklib-dicts
libpwquality
pam
cpio
dbus-libs
libudev
libblkid
libmount
libnih
upstart
libuser
sysvinit
xz
libutempter
util-linux
net-tools
procps
ethtool
mingetty
psmisc
iptables
iproute
kmod-libs
kmod
hwdata
udev
findutils
iputils
initscripts
cyrus-sasl
cyrus-sasl-devel
openldap-devel

Basically this was enough for the build to succeed:

yum install -y gcc gcc-c++ libtool libtool-ltdl-devel make pkgconfig
automake autoconf wget diffutils file openldap-devel

but just removing openldap-devel from that line results in errors I posted.

On Wed, Apr 13, 2022 at 7:19 PM Alex Rousskov <
rousskov at measurement-factory.com> wrote:

> On 4/13/22 20:07, Ivan Larionov wrote:
> > Yes this worked. Thanks Eliezer.
> >
> > This means some of these dependencies are required but not caught by the
> > configure script.
> >
> > I'll try to figure out which specific one was the culprit.
>
> And maybe find the earlier error in the make log? The errors you shared
> did not look like a direct effect of some missing package, more like a
> side effect of something that went wrong earlier...
>
>
> Thank you both,
>
> Alex.
>
>
> > On Wed, Apr 13, 2022 at 4:36 PM Eliezer Croitoru wrote:
> >
> >     For CentOS 7 use the next:____
> >
> >     RUN yum install -y epel-release \____
> >
> >         &&  yum clean all \____
> >
> >         &&  yum update -y \____
> >
> >         &&  yum install -y gcc gcc-c++ libtool libtool-ltdl make cmake
> \____
> >
> >                     git pkgconfig sudo automake autoconf yum-utils
> >     rpm-build \____
> >
> >         &&  yum install -y libxml2 expat-devel openssl-devel libcap
> >     ccache \____
> >
> >                     libtool-ltdl-devel cppunit cppunit-devel bzr git
> >     autoconf \____
> >
> >                     automake libtool gcc-c++ perl-Pod-MinimumVersion
> >     bzip2 ed \____
> >
> >                      make openldap-devel pam-devel db4-devel
> >     libxml2-devel \____
> >
> >                     libcap-devel screen vim nettle-devel redhat-lsb-core
> >     \____
> >
> >                     autoconf-archive libtdb-devel libtdb
> >     redhat-rpm-config rpm-build rpm-devel \____
> >
> >         &&  yum install -y perl-libwww-perl ruby ruby-devel \____
> >
> >         &&  yum clean all____
> >
> >     __ __
> >
> >     RUN yum update -y \____
> >
> >         &&  yum install -y systemd-units openldap-devel pam-devel \____
> >
> >                     openssl-devel krb5-devel db4-devel expat-devel \____
> >
> >                     libxml2-devel libcap-devel libtool
> >     libtool-ltdl-devel \____
> >
> >                     redhat-rpm-config libdb-devel
> >     libnetfilter_conntrack-devel \____
> >
> >                     gnutls-devel rpmdevtools wget \____
> >
> >         &&  yum clean all____
> >
> >     __ __
> >
> >     __ __
> >
> >     For CentOS 8 Stream:____
> >
> >     RUN dnf install -y epel-release dnf-plugins-core \____
> >
> >         &&  dnf config-manager --set-enabled powertools \____
> >
> >         &&  dnf clean all \____
> >
> >         &&  dnf update -y \____
> >
> >         &&  dnf install -y gcc gcc-c++ libtool libtool-ltdl make cmake
> \____
> >
> >                     git pkgconfig sudo automake autoconf yum-utils
> rpm-build \____
> >
> >         &&  dnf install -y libxml2 expat-devel openssl-devel libcap
> ccache \____
> >
> >                     libtool-ltdl-devel git autoconf \____
> >
> >                     automake libtool gcc-c++ bzip2 ed \____
> >
> >                     make openldap-devel pam-devel libxml2-devel \____
> >
> >                     libcap-devel screen vim nettle-devel redhat-lsb-core
> \____
> >
> >                     libtdb-devel libtdb redhat-rpm-config rpm-build
> rpm-devel \____
> >
> >                     libnetfilter_conntrack-devel \____
> >
> >         &&  dnf install -y perl-libwww-perl ruby ruby-devel \____
> >
> >         &&  dnf clean all____
> >
> >     __  __
> >
> >     RUN dnf update -y \____
> >
> >         &&  dnf install -y systemd-units openldap-devel pam-devel \____
> >
> >                     openssl-devel krb5-devel expat-devel \____
> >
> >                     libxml2-devel libcap-devel libtool
> libtool-ltdl-devel \____
> >
> >                     redhat-rpm-config libdb-devel \____
> >
> >                     gnutls-devel rpmdevtools wget \____
> >
> >         &&  dnf clean all____
> >
> >     __ __
> >
> >     __ __
> >
> >     ----____
> >
> >     Eliezer Croitoru____
> >
> >     NgTech, Tech Support____
> >
> >     Mobile: +972-5-28704261____
> >
> >     Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com>____
> >
> >     __ __
> >
> >     *From:* squid-users <squid-users-bounces at lists.squid-cache.org
> >     <mailto:squid-users-bounces at lists.squid-cache.org>> *On Behalf Of
> >     *Ivan Larionov
> >     *Sent:* Thursday, April 14, 2022 01:34
> >     *To:* squid-users at lists.squid-cache.org
> >     <mailto:squid-users at lists.squid-cache.org>
> >     *Subject:* [squid-users] squid compilation error in Docker____
> >
> >     __ __
> >
> >     Hi.____
> >
> >     __ __
> >
> >     I have no issues building squid normally, but when I try to do
> >     exactly the same steps in docker I'm getting the following
> errors:____
> >
> >     __ __
> >
> >     https://gist.github.com/xeron/5530fe9aa1f5bdcb6a72c6edd6476467
> >     <https://gist.github.com/xeron/5530fe9aa1f5bdcb6a72c6edd6476467>____
> >
> >     __ __
> >
> >     Example from that log:____
> >
> >     __ __
> >
> >     cache_cf.o: In function `configFreeMemory()':____
> >
> >     /root/build/src/cache_cf.cc:2982: undefined reference to
> >     `Adaptation::Icap::TheConfig'____
> >
> >     __ __
> >
> >     I can't figure out what exactly is wrong. Doesn't look like any
> >     dependencies are missing.
> >     ____
> >
> >     __ __
> >
> >     Here's my build script:____
> >
> >     __ __
> >
> >            yum install -y autoconf automake file gcc72 gcc72-c++ libtool
> >     libtool-ltdl-devel pkgconfig diffutils \
> >              libxml2-devel libcap-devel openssl-devel
> >
> >            autoreconf -ivf
> >
> >            ./configure --program-prefix= --prefix=/usr
> --exec-prefix=/usr \
> >              --bindir=/usr/sbin --sbindir=/usr/sbin
> >     --sysconfdir=/etc/squid \
> >              --libdir=/usr/lib --libexecdir=/usr/lib/squid \
> >              --includedir=/usr/include --datadir=/usr/share/squid \
> >              --sharedstatedir=/usr/com --localstatedir=/var \
> >              --mandir=/usr/share/man --infodir=/usr/share/info \
> >              --enable-epoll --enable-removal-policies=heap,lru \
> >              --enable-storeio=aufs,rock \
> >              --enable-delay-pools --with-pthreads --enable-cache-digests
> \
> >              --with-large-files --with-filedescriptors=65536 \
> >              --enable-htcp
> >
> >            make -j$(nproc) install DESTDIR=$PWD/_destroot____
> >
> >     __ __
> >
> >     Any ideas?____
> >
> >     __ __
> >
> >     -- ____
> >
> >     With best regards, Ivan Larionov.____
> >
> >     _______________________________________________
> >     squid-users mailing list
> >     squid-users at lists.squid-cache.org
> >     <mailto:squid-users at lists.squid-cache.org>
> >     http://lists.squid-cache.org/listinfo/squid-users
> >     <http://lists.squid-cache.org/listinfo/squid-users>
> >
> >
> >
> > --
> > With best regards, Ivan Larionov.
> >
> > _______________________________________________
> > squid-users mailing list
> > squid-users at lists.squid-cache.org
> > http://lists.squid-cache.org/listinfo/squid-users
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>


-- 
With best regards, Ivan Larionov.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220413/5d0aa11b/attachment.htm>

From squid3 at treenet.co.nz  Thu Apr 14 04:18:27 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 14 Apr 2022 16:18:27 +1200
Subject: [squid-users] Squid-Cache VS PHP, put some things in perspective
In-Reply-To: <000001d84ebc$f51ee350$df5ca9f0$@gmail.com>
References: <000001d84ebc$f51ee350$df5ca9f0$@gmail.com>
Message-ID: <106122f8-2ed6-a87f-6142-80565e0ba490@treenet.co.nz>

On 13/04/22 10:30, Eliezer Croitoru wrote:
> 
> I am looking for adventurous Squid Users which wants to help me test if 
> PHP 7.4+ still possess the same old 5.x STDIN bugs.
> 


Hi Eliezer, Thanks for taking on a re-investingation.


FTR, the old problem was not stdin itself. The issue was that PHP was 
designed with the fundamental assumption that it was used for scripts 
with very short execution times. Implying that all resources used would 
be freed quickly.

This assumption resulted in scripts (like helpers) which need to run for 
very long times having terrible memory and resource consumption side 
effects. Naturally that effect alone compounds badly when Squid attempts 
to run dozens or hundreds of helpers at once.

Later versions (PHP-3/4/5) that I tested had various attempts at 
internal Zend engine controls to limit the memory problems. Based on the 
same assumption though, so they chose to terminate helpers early. Which 
still causes Squid issues. PHP config settings for that Zend timeout 
were unreliable.


AFAIK, That is where we are with knowledge of PHP vs helper usage. 
PHP-6+ have not had any serious testing to check if the language updates 
have improved either resource usage or the Zend timeout/abort behaviour.


HTH
Amos


From squid3 at treenet.co.nz  Thu Apr 14 04:33:28 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 14 Apr 2022 16:33:28 +1200
Subject: [squid-users] squid compilation error in Docker
In-Reply-To: <CAHvB88w2GABY0qKRCAvUa4Xg3+WS3kVDxBU-hsPuS_z50+xeag@mail.gmail.com>
References: <CAHvB88xLnc9a0tEqQ6ZuQn0LtoXketTPd1y33xRaW7Q3Nt0=KA@mail.gmail.com>
 <000c01d84f8f$42698980$c73c9c80$@gmail.com>
 <CAHvB88yg3LhvAs6KdZV=QDeHbZoKFre3V1EpTCe7OSmUEs-oBw@mail.gmail.com>
 <5b63e001-d8c6-aa65-6f37-a6c39e39f4e3@measurement-factory.com>
 <CAHvB88w2GABY0qKRCAvUa4Xg3+WS3kVDxBU-hsPuS_z50+xeag@mail.gmail.com>
Message-ID: <ffd213de-3bc0-f65f-7030-dd45ac757f55@treenet.co.nz>

On 14/04/22 14:59, Ivan Larionov wrote:
> There were no errors earlier.
> 
> Seems like installing?openldap-devel fixes the issue.
> 
> There were other dependencies installed together with it, not sure if 
> they also affected the build or not.


I suspect one or more of those other components is indeed the source of 
the change. Some of them are very low-level OS functionality updates (eg 
/proc and filesystem  utilities).

FWIW, The gist you posted looks suspiciously like reports we used to see 
when BSD people were having issues with the linker not receiving all the 
arguments passed to it. I would focus on the ones which interact with OS 
filesystem or the autotools / compiler/ linker.


HTH
Amos


From squid3 at treenet.co.nz  Thu Apr 14 11:21:54 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 14 Apr 2022 23:21:54 +1200
Subject: [squid-users] [squid-announce] Squid 5.5 is available
Message-ID: <99223551-4be2-ddd3-9a19-93e32420e920@treenet.co.nz>

The Squid HTTP Proxy team is very pleased to announce the
availability of the Squid-5.5 release!


This release is a bug fix release resolving several issues
found in the prior Squid-5 releases and confirming stability
of major functionality changes added in 5.4.1 beta release.


The major changes to be aware of:

  * Bug 5177: clientca certificates sent to https_port clients

A bug in the OpenSSL library has been causing CA certificates
in the Squid tls-clientca= (and previously clientca=) option
be added to the chain of intermediate CA's sent with TLS
server certificate.

This release makes use of an OpenSSL context mode which has
been made available with libssl 1.x to resolve that problem.

Your proxy configuration can be quickly checked for relevance
with the following command:

   squid -k parse 2>&1 | grep clientca

Admin using (tls-)clientca= option should ensure that file
only contains CA to validate the TLS certificates presented
by clients.

To be sent in the TLS handshake Intermediate CA certificates
relevant to the TLS server certificate should be listed in
the file(s) loaded by tls-cert=, tls-cafile= or tls-capath=
options.


  * Bug 5090: Must(!request->pinnedConnection()) violation

This bug is most often seen when ICAP RESPMOD is used, but is
not related to ICAP at all. Visible bug symptoms, if any, may
include:

   FATAL: check failed: !request->pinnedConnection()
   exception location: FwdState.cc(1124) connectStart

   FATAL: check failed: transportWait
   exception location: FwdState.cc(675) noteDestinationsEnd

The bug was actually incorrect handling of servers or peers
whose selection takes unusually long times.


  * Kid restart leads to persistent queue overflows, delays/timeouts

This bug appears in cache.log as any of the following messages:

   WARNING: communication with ... may be too slow or disrupted...
   WARNING: abandoning ... I/Os
   ERROR: worker I/O push queue for ... overflow...
   ERROR: Collapsed forwarding queue overflow...

When one of the SMP worker processes ('kid') crashes or otherwise
exits without cleaning up the SMP memory it was using, the worker
process started to replace it has to automatically recover from
memory corruption. Previous Squid releases did not recover well
from at least the above listed types of corruption.

This release greatly strengthens the recovery process making
Squid much more robust after a worker crash.


  * Bug 5192: esi_parser default is incorrect

This bug appears when Squid is built with both libexpat and
libxml2 available. Updates in Squid-4 unintentionally altered
the default selected to libexpat. This release returns the
default to libxml2 as documented in squid.conf.


   All users of Squid-5 are encouraged to upgrade as soon as
   possible.

   Users of Squid-4 holding back due to earlier release issues
   are encouraged to test this version for upgrade.


See the ChangeLog for the full list of changes in this and
earlier releases.

Please refer to the release notes at
http://www.squid-cache.org/Versions/v5/RELEASENOTES.html
when you are ready to make the switch to Squid-5

This new release can be downloaded from our HTTP or FTP servers

   http://www.squid-cache.org/Versions/v5/
   ftp://ftp.squid-cache.org/pub/squid/
   ftp://ftp.squid-cache.org/pub/archive/5/

or the mirrors. For a list of mirror sites see

   http://www.squid-cache.org/Download/http-mirrors.html
   http://www.squid-cache.org/Download/mirrors.html

If you encounter any issues with this release please file a bug
report.
   https://bugs.squid-cache.org/


Amos Jeffries
_______________________________________________
squid-announce mailing list
squid-announce at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-announce


From ngtech1ltd at gmail.com  Sun Apr 17 23:54:12 2022
From: ngtech1ltd at gmail.com (Eliezer Croitoru)
Date: Mon, 18 Apr 2022 02:54:12 +0300
Subject: [squid-users] Squid-Cache VS PHP, put some things in perspective
In-Reply-To: <106122f8-2ed6-a87f-6142-80565e0ba490@treenet.co.nz>
References: <000001d84ebc$f51ee350$df5ca9f0$@gmail.com>
 <106122f8-2ed6-a87f-6142-80565e0ba490@treenet.co.nz>
Message-ID: <000001d852b6$712204d0$53660e70$@gmail.com>

OK so I have created a vagrant simple proxy:
https://github.com/elico/squid-php-helper-tests

It works with REDIS and can be tunned for production use.
It's based on Oracle Enterprise Linux 8 and seems to do the job.
Anyone is interested in trying to help testing if PHP is still leaking?

Thanks,
Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of
Amos Jeffries
Sent: Thursday, April 14, 2022 07:18
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Squid-Cache VS PHP, put some things in
perspective

On 13/04/22 10:30, Eliezer Croitoru wrote:
> 
> I am looking for adventurous Squid Users which wants to help me test if 
> PHP 7.4+ still possess the same old 5.x STDIN bugs.
> 


Hi Eliezer, Thanks for taking on a re-investingation.


FTR, the old problem was not stdin itself. The issue was that PHP was 
designed with the fundamental assumption that it was used for scripts 
with very short execution times. Implying that all resources used would 
be freed quickly.

This assumption resulted in scripts (like helpers) which need to run for 
very long times having terrible memory and resource consumption side 
effects. Naturally that effect alone compounds badly when Squid attempts 
to run dozens or hundreds of helpers at once.

Later versions (PHP-3/4/5) that I tested had various attempts at 
internal Zend engine controls to limit the memory problems. Based on the 
same assumption though, so they chose to terminate helpers early. Which 
still causes Squid issues. PHP config settings for that Zend timeout 
were unreliable.


AFAIK, That is where we are with knowledge of PHP vs helper usage. 
PHP-6+ have not had any serious testing to check if the language updates 
have improved either resource usage or the Zend timeout/abort behaviour.


HTH
Amos
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From rafael.akchurin at diladele.com  Tue Apr 19 09:26:39 2022
From: rafael.akchurin at diladele.com (Rafael Akchurin)
Date: Tue, 19 Apr 2022 09:26:39 +0000
Subject: [squid-users] Ubuntu 20.04 LTS repository for Squid 5.5 (rebuilt
 from sources in Debian unstable)
Message-ID: <AM8PR04MB7745959019D766D243CC94BD8FF29@AM8PR04MB7745.eurprd04.prod.outlook.com>

Hello everyone,

Online repository with latest Squid 5.5 (rebuilt from sources in Debian unstable) for Ubuntu 20.04 LTS 64-bit is available at https://squid55.diladele.com/.
Github repo https://github.com/diladele/squid-ubuntu/tree/master/src/ubuntu20 contains the scripts we used to make this compilation.

Here are simple instructions how to use the repo. For more information see readme at https://github.com/diladele/squid-ubuntu .

# add diladele apt key
wget -qO - https://packages.diladele.com/diladele_pub.asc | sudo apt-key add -

# add new repo
echo "deb https://squid55.diladele.com/ubuntu/ focal main" \
    > /etc/apt/sources.list.d/squid55.diladele.com.list

# and install
apt-get update && apt-get install -y \
    squid-common \
    squid-openssl \
    squidclient \
    libecap3 libecap3-dev

Hope you will find this useful.

Best regards,
Rafael Akchurin
Diladele B.V.

--
The same Squid 5.5 will be part of upcoming Web Safety 8.1 planned for release in summer of 2022.
Download the latest virtual appliance of Web Safety from https://www.diladele.com/download.html



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220419/a6960e6b/attachment.htm>

From zaheer at google.com  Tue Apr 19 20:12:22 2022
From: zaheer at google.com (Zaheer Shaikh)
Date: Tue, 19 Apr 2022 13:12:22 -0700
Subject: [squid-users] (no subject)
Message-ID: <CANT5KD5UReYNtQFSiyk732pmwyFUMSWGMd=N-T3EvC+SeXCmmA@mail.gmail.com>

We have setup squid proxy for outbound connection from one our SAP servers
to few services on internet.
While basic auth (username and password) works perfectly with this setup,
we are struggling to get it working with cert based authentication.

Certs are in p12 format.

 This is what our squid config looks like


acl sap src 0.0.0.0/0

acl whitelist dstdomain "/etc/squid/sites.whitelist.txt"



acl safeports port 443 # https

acl safeports port 80 # http


acl CONNECT method CONNECT


http_access allow safeports sap whitelist

http_access deny !safeports

http_access deny CONNECT !safeports

http_access deny all


http_port 3128



 Any pointers are highly appreciated.



Zaheer Shaikh | Corp Eng SRE, Google   | zaheer at google.com |
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220419/efd9f778/attachment.htm>

From rousskov at measurement-factory.com  Tue Apr 19 20:48:30 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Tue, 19 Apr 2022 16:48:30 -0400
Subject: [squid-users] (no subject)
In-Reply-To: <CANT5KD5UReYNtQFSiyk732pmwyFUMSWGMd=N-T3EvC+SeXCmmA@mail.gmail.com>
References: <CANT5KD5UReYNtQFSiyk732pmwyFUMSWGMd=N-T3EvC+SeXCmmA@mail.gmail.com>
Message-ID: <4cebea36-184d-8e82-213a-42040636ade2@measurement-factory.com>

On 4/19/22 16:12, Zaheer Shaikh wrote:
> we are struggling?to get it working with cert based authentication.

> Certs are in p12 format.

You may need to convert the port certificate and its key to PEM format:
https://stackoverflow.com/a/15144560


> http_port 3128

Client certificate authentication works over TLS. Your Squid must listen 
on https_port and your clients must connect using TLS. For example:

https_port 3443 \

     tls-cert=/this/port/server/cert/key/and/bundle.pem \

     clientca=/CA/certificates/to/check/clients.pem

The tls-cert bundle should contain the private certificate key for the 
Squid listening port, the public certificate for that port, and any 
necessary intermediate CA certificates that signed that public certificate.


HTH,

Alex.


From zaheer at google.com  Wed Apr 20 02:46:10 2022
From: zaheer at google.com (Zaheer Shaikh)
Date: Tue, 19 Apr 2022 19:46:10 -0700
Subject: [squid-users] Need help with cert based authentication
In-Reply-To: <CANT5KD5UReYNtQFSiyk732pmwyFUMSWGMd=N-T3EvC+SeXCmmA@mail.gmail.com>
References: <CANT5KD5UReYNtQFSiyk732pmwyFUMSWGMd=N-T3EvC+SeXCmmA@mail.gmail.com>
Message-ID: <CANT5KD7f0Rq0c0S39_Ku4StA3O07c7eg5w560D073_XWKisKzg@mail.gmail.com>

> We have setup squid proxy for outbound connection from one our SAP servers
> to few services on internet.
> While basic auth (username and password) works perfectly with this setup,
> we are struggling to get it working with cert based authentication.
>
> Certs are in p12 format.
>
>  This is what our squid config looks like
>
>
> acl sap src 0.0.0.0/0
>
> acl whitelist dstdomain "/etc/squid/sites.whitelist.txt"
>
>
>
> acl safeports port 443 # https
>
> acl safeports port 80 # http
>
>
> acl CONNECT method CONNECT
>
>
> http_access allow safeports sap whitelist
>
> http_access deny !safeports
>
> http_access deny CONNECT !safeports
>
> http_access deny all
>
>
> http_port 3128
>
>
>
>  Any pointers are highly appreciated.
>
>
>
> Zaheer Shaikh | Corp Eng SRE, Google   | zaheer at google.com |
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220419/c8d73fbb/attachment.htm>

From Joseph.Garbacik at netapp.com  Wed Apr 20 12:24:17 2022
From: Joseph.Garbacik at netapp.com (Garbacik, Joe)
Date: Wed, 20 Apr 2022 12:24:17 +0000
Subject: [squid-users] Cache Peer Connection
Message-ID: <84B14DED-52EC-4DB3-8929-98345B3AF518@netapp.com>

When squid connects to an upstream cache peer, does it create a new tcp session between the peers for each request from a client on the original squid server or does it maintain the session between the peers for a period of time to allow other requests via the established session?




From squid3 at treenet.co.nz  Wed Apr 20 13:06:23 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 21 Apr 2022 01:06:23 +1200
Subject: [squid-users] Cache Peer Connection
In-Reply-To: <84B14DED-52EC-4DB3-8929-98345B3AF518@netapp.com>
References: <84B14DED-52EC-4DB3-8929-98345B3AF518@netapp.com>
Message-ID: <93d731ef-b66c-1271-6abe-d4a5f5b45bb6@treenet.co.nz>

On 21/04/22 00:24, Garbacik, Joe wrote:
> When squid connects to an upstream cache peer, does it create a new
> tcp session between the peers for each request from a client on the
> original squid server or does it maintain the session between the
> peers for a period of time to allow other requests via the
> established session?
> 


FYI; TCP has connections, not sessions. There is a subtle difference but 
very important in that it limits what can be done by other protocols 
using TCP as a transport.


The answer to your questions depend on a lot of things...

Squid supports HTTP persistence and pipeline to both clients and peers 
independently by default. For details on how those work see
  <https://datatracker.ietf.org/doc/html/rfc7230#section-6.3>
  <https://datatracker.ietf.org/doc/html/rfc7230#section-6.3.2>

Specifically, use of the features requires that;
  * the peer also supports them, and
  * your squid.conf has not disabled them, and
  * your squid.conf has not enabled features that require them to be 
disabled, and
  * the traffic has not forbidden them, and
  * the the messages going through allow them.


Amos


From rousskov at measurement-factory.com  Wed Apr 20 15:16:11 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Wed, 20 Apr 2022 11:16:11 -0400
Subject: [squid-users] Cache Peer Connection
In-Reply-To: <93d731ef-b66c-1271-6abe-d4a5f5b45bb6@treenet.co.nz>
References: <84B14DED-52EC-4DB3-8929-98345B3AF518@netapp.com>
 <93d731ef-b66c-1271-6abe-d4a5f5b45bb6@treenet.co.nz>
Message-ID: <419f4e47-3328-e8e2-9423-75bdfe9370dc@measurement-factory.com>

On 4/20/22 09:06, Amos Jeffries wrote:
> On 21/04/22 00:24, Garbacik, Joe wrote:
>> When squid connects to an upstream cache peer, does it create a new
>> tcp session between the peers for each request from a client on the
>> original squid server or does it maintain the session between the
>> peers for a period of time to allow other requests via the
>> established session?

> The answer to your questions depend on a lot of things...
> 
> Squid supports HTTP persistence and pipeline to both clients and peers 
> independently by default. For details on how those work see
>  ?https://datatracker.ietf.org/doc/html/rfc7230#section-6.3
>  ?https://datatracker.ietf.org/doc/html/rfc7230#section-6.3.2

Clarification: Squid does _not_ support HTTP request pipelining on 
Squid-to-server connections -- at most one concurrent HTTP request may 
be using a given Squid-to-server connection. By default, Squid also does 
not pipeline HTTP requests on client-to-Squid connections (the 
pipeline_prefetch directive controls that behavior).


> Specifically, use of the features requires that;
>  ?* the peer also supports them, and
>  ?* your squid.conf has not disabled them, and
>  ?* your squid.conf has not enabled features that require them to be 
> disabled, and
>  ?* the traffic has not forbidden them, and
>  ?* the the messages going through allow them.



In summary, yes, Squid will reuse an idle persistent HTTP connection to 
an origin server or cache_peer in order to forward a request received 
from another client _if_ various factors (see Amos' list) do not 
prohibit such reuse (and persistency itself).


HTH,

Alex.


From zaheer at google.com  Wed Apr 20 20:05:09 2022
From: zaheer at google.com (Zaheer Shaikh)
Date: Wed, 20 Apr 2022 13:05:09 -0700
Subject: [squid-users] (no subject)
Message-ID: <CANT5KD6L0VbTVf-EiES5n+GA0Cx5+6G1CsAeNTtA6+Rykj8C3Q@mail.gmail.com>

Thank you Alex, let me try setting up https.
Is a private key needed for tls-cert bundle? We have the public crt and
intermediate CA.


Zaheer Shaikh | Corp Eng SRE, Google   | zaheer at google.com | +1 650 537
5020
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220420/ff617398/attachment.htm>

From rousskov at measurement-factory.com  Thu Apr 21 01:34:56 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Wed, 20 Apr 2022 21:34:56 -0400
Subject: [squid-users] (no subject)
In-Reply-To: <CANT5KD6L0VbTVf-EiES5n+GA0Cx5+6G1CsAeNTtA6+Rykj8C3Q@mail.gmail.com>
References: <CANT5KD6L0VbTVf-EiES5n+GA0Cx5+6G1CsAeNTtA6+Rykj8C3Q@mail.gmail.com>
Message-ID: <58bb0e67-b8ca-d7da-b0a9-c1d1f6260cc7@measurement-factory.com>

On 4/20/22 16:05, Zaheer Shaikh wrote:
> let me try setting up https.
> Is a private key needed for tls-cert bundle? 

Yes, it is needed, either in the tls-cert bundle or in the tls-key=file. 
See https_port documentation for details.

You are setting up an HTTPS forward proxy (as far as this https_port is 
concerned). For a TLS client to trust such a proxy, the proxy must 
identify itself (and sign traffic) with a trusted (by the client) 
certificate. Doing so naturally requires the proxy to possess the 
matching private certificate key. This aspect is similar to how an HTTPS 
server identifies itself to TLS clients.


HTH,

Alex.


From brunopsitech at gmail.com  Fri Apr 22 12:17:04 2022
From: brunopsitech at gmail.com (Bruno de Oliveira Bastos)
Date: Fri, 22 Apr 2022 09:17:04 -0300
Subject: [squid-users] Squid auth IP as username together
Message-ID: <CAMRuTBAD5OcpCXFFN-qNvVry51X-j5GSCcwK9KJ-35BSbAWY_g@mail.gmail.com>

I have a proxy that uses Active Directory authentication, it's working
normally, but I have a problem, some desktop apps don't have support to
mark proxy, so it doesn't authenticate with the username, it ends up going
straight through the IP release. My need is to link this IP released from
the application to the name of the user who is logged into the machine at
this moment, so that in the squidanalyzer report or any other I can have
the accesses linked to the person's name and not to the IP. Does anyone
have any idea how to do this operation?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220422/ccd9383c/attachment.htm>

From ngtech1ltd at gmail.com  Sun Apr 24 22:06:20 2022
From: ngtech1ltd at gmail.com (Eliezer Croitoru)
Date: Mon, 25 Apr 2022 01:06:20 +0300
Subject: [squid-users] Squid-Cache VS PHP, put some things in perspective
In-Reply-To: <106122f8-2ed6-a87f-6142-80565e0ba490@treenet.co.nz>
References: <000001d84ebc$f51ee350$df5ca9f0$@gmail.com>
 <106122f8-2ed6-a87f-6142-80565e0ba490@treenet.co.nz>
Message-ID: <000f01d85827$8818b8c0$984a2a40$@gmail.com>

Hey Amos,

I am testing the session helper now for quite some time and it seems that
there is not memory leak and the helpers seems to run pretty stable for the
last days.
I will continue to run the test since it doesn't cause any issues for my
proxy at all, not in performance and not in any helpers crashes.

Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of
Amos Jeffries
Sent: Thursday, April 14, 2022 07:18
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Squid-Cache VS PHP, put some things in
perspective

On 13/04/22 10:30, Eliezer Croitoru wrote:
> 
> I am looking for adventurous Squid Users which wants to help me test if 
> PHP 7.4+ still possess the same old 5.x STDIN bugs.
> 


Hi Eliezer, Thanks for taking on a re-investingation.


FTR, the old problem was not stdin itself. The issue was that PHP was 
designed with the fundamental assumption that it was used for scripts 
with very short execution times. Implying that all resources used would 
be freed quickly.

This assumption resulted in scripts (like helpers) which need to run for 
very long times having terrible memory and resource consumption side 
effects. Naturally that effect alone compounds badly when Squid attempts 
to run dozens or hundreds of helpers at once.

Later versions (PHP-3/4/5) that I tested had various attempts at 
internal Zend engine controls to limit the memory problems. Based on the 
same assumption though, so they chose to terminate helpers early. Which 
still causes Squid issues. PHP config settings for that Zend timeout 
were unreliable.


AFAIK, That is where we are with knowledge of PHP vs helper usage. 
PHP-6+ have not had any serious testing to check if the language updates 
have improved either resource usage or the Zend timeout/abort behaviour.


HTH
Amos
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From belle at bazuin.nl  Mon Apr 25 09:05:22 2022
From: belle at bazuin.nl (=?windows-1252?Q?L.P.H._van_Belle?=)
Date: Mon, 25 Apr 2022 11:05:22 +0200
Subject: [squid-users] [squid-announce] Squid 5.5 is available
In-Reply-To: <99223551-4be2-ddd3-9a19-93e32420e920@treenet.co.nz>
References: <99223551-4be2-ddd3-9a19-93e32420e920@treenet.co.nz>
Message-ID: <vmime.62666452.7d66.7c7523e2ee86472@ms249-lin-003.rotterdam.bazuin.nl>

Hai Amos, 

Small question on this release. I saw in the changelog.  

2.4 TrivialDB Support
This release deprecates use of BerkleyDB in favour of TrivialDB. 

I also saw in https://packages.debian.org/bookworm/squid 
dep: libtdb1 (>= 1.2.7+git20101214)

Now im wondering, does it still apply to use libldb1 or are there plans to move to libldb2. 

Just asking because of some changes in de builds of samba and the related packages, like ldb. 

Greetz, 

Louis


> -----Oorspronkelijk bericht-----
> Van: squid-users Namens Amos Jeffries
> Verzonden: donderdag 14 april 2022 13:22
> Aan: squid-announce at lists.squid-cache.org
> Onderwerp: [squid-users] [squid-announce] Squid 5.5 is available
> 
> The Squid HTTP Proxy team is very pleased to announce the
> availability of the Squid-5.5 release!
> 
> 
> This release is a bug fix release resolving several issues
> found in the prior Squid-5 releases and confirming stability
> of major functionality changes added in 5.4.1 beta release.
> 
> 
> The major changes to be aware of:
> 
>   * Bug 5177: clientca certificates sent to https_port clients
> 
> A bug in the OpenSSL library has been causing CA certificates
> in the Squid tls-clientca= (and previously clientca=) option
> be added to the chain of intermediate CA's sent with TLS
> server certificate.
> 
> This release makes use of an OpenSSL context mode which has
> been made available with libssl 1.x to resolve that problem.
> 
> Your proxy configuration can be quickly checked for relevance
> with the following command:
> 
>    squid -k parse 2>&1 | grep clientca
> 
> Admin using (tls-)clientca= option should ensure that file
> only contains CA to validate the TLS certificates presented
> by clients.
> 
> To be sent in the TLS handshake Intermediate CA certificates
> relevant to the TLS server certificate should be listed in
> the file(s) loaded by tls-cert=, tls-cafile= or tls-capath=
> options.
> 
> 
>   * Bug 5090: Must(!request->pinnedConnection()) violation
> 
> This bug is most often seen when ICAP RESPMOD is used, but is
> not related to ICAP at all. Visible bug symptoms, if any, may
> include:
> 
>    FATAL: check failed: !request->pinnedConnection()
>    exception location: FwdState.cc(1124) connectStart
> 
>    FATAL: check failed: transportWait
>    exception location: FwdState.cc(675) noteDestinationsEnd
> 
> The bug was actually incorrect handling of servers or peers
> whose selection takes unusually long times.
> 
> 
>   * Kid restart leads to persistent queue overflows, delays/timeouts
> 
> This bug appears in cache.log as any of the following messages:
> 
>    WARNING: communication with ... may be too slow or disrupted...
>    WARNING: abandoning ... I/Os
>    ERROR: worker I/O push queue for ... overflow...
>    ERROR: Collapsed forwarding queue overflow...
> 
> When one of the SMP worker processes ('kid') crashes or otherwise
> exits without cleaning up the SMP memory it was using, the worker
> process started to replace it has to automatically recover from
> memory corruption. Previous Squid releases did not recover well
> from at least the above listed types of corruption.
> 
> This release greatly strengthens the recovery process making
> Squid much more robust after a worker crash.
> 
> 
>   * Bug 5192: esi_parser default is incorrect
> 
> This bug appears when Squid is built with both libexpat and
> libxml2 available. Updates in Squid-4 unintentionally altered
> the default selected to libexpat. This release returns the
> default to libxml2 as documented in squid.conf.
> 
> 
>    All users of Squid-5 are encouraged to upgrade as soon as
>    possible.
> 
>    Users of Squid-4 holding back due to earlier release issues
>    are encouraged to test this version for upgrade.
> 
> 
> See the ChangeLog for the full list of changes in this and
> earlier releases.
> 
> Please refer to the release notes at
> http://www.squid-cache.org/Versions/v5/RELEASENOTES.html
> when you are ready to make the switch to Squid-5
> 
> This new release can be downloaded from our HTTP or FTP servers
> 
>    http://www.squid-cache.org/Versions/v5/
>    ftp://ftp.squid-cache.org/pub/squid/
>    ftp://ftp.squid-cache.org/pub/archive/5/
> 
> or the mirrors. For a list of mirror sites see
> 
>    http://www.squid-cache.org/Download/http-mirrors.html
>    http://www.squid-cache.org/Download/mirrors.html
> 
> If you encounter any issues with this release please file a bug
> report.
>    https://bugs.squid-cache.org/
> 
> 
> Amos Jeffries
> _______________________________________________
> squid-announce mailing list
> squid-announce at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-announce
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users




From doctor at doctor.nl2k.ab.ca  Mon Apr 25 13:28:39 2022
From: doctor at doctor.nl2k.ab.ca (The Doctor)
Date: Mon, 25 Apr 2022 07:28:39 -0600
Subject: [squid-users] [squid-announce] Squid 5.5 is available
In-Reply-To: <vmime.62666452.7d66.7c7523e2ee86472@ms249-lin-003.rotterdam.bazuin.nl>
References: <99223551-4be2-ddd3-9a19-93e32420e920@treenet.co.nz>
 <vmime.62666452.7d66.7c7523e2ee86472@ms249-lin-003.rotterdam.bazuin.nl>
Message-ID: <YmaiBxh31kmyjVOi@doctor.nl2k.ab.ca>

When will Squid be openssl 3 compliant?

-- 
Member - Liberal International This is doctor@@nl2k.ab.ca Ici doctor@@nl2k.ab.ca
Yahweh, Queen & country!Never Satan President Republic!Beware AntiChrist rising!
Look at Psalms 14 and 53 on Atheism https://www.empire.kred/ROOTNK?t=94a1f39b  
God will not fix the vessel which insists it isn't broken. -unknown Beware https://mindspring.com


From dwd at fnal.gov  Mon Apr 25 18:41:47 2022
From: dwd at fnal.gov (Dave Dykstra)
Date: Mon, 25 Apr 2022 18:41:47 +0000
Subject: [squid-users] Is Squid 5.5 considered stable?
Message-ID: <Ymbra/BB+b3+1K5B@fnal.gov>

On Thu, Apr 14, 2022 at 11:21:54PM +1200, Amos Jeffries wrote:
> Subject: [squid-announce] Squid 5.5 is available
...
>   Users of Squid-4 holding back due to earlier release issues
>   are encouraged to test this version for upgrade.

This doesn't seem to me to be a resounding endorsement.  Are there any
other known significant issues with squid-5.5 not present in squid-4.x?
For example, are the memory leaks fixed?  That isn't clear to me.

Dave

From xeron.oskom at gmail.com  Mon Apr 25 19:41:00 2022
From: xeron.oskom at gmail.com (Ivan Larionov)
Date: Mon, 25 Apr 2022 12:41:00 -0700
Subject: [squid-users] squid compilation error in Docker
In-Reply-To: <ffd213de-3bc0-f65f-7030-dd45ac757f55@treenet.co.nz>
References: <CAHvB88xLnc9a0tEqQ6ZuQn0LtoXketTPd1y33xRaW7Q3Nt0=KA@mail.gmail.com>
 <000c01d84f8f$42698980$c73c9c80$@gmail.com>
 <CAHvB88yg3LhvAs6KdZV=QDeHbZoKFre3V1EpTCe7OSmUEs-oBw@mail.gmail.com>
 <5b63e001-d8c6-aa65-6f37-a6c39e39f4e3@measurement-factory.com>
 <CAHvB88w2GABY0qKRCAvUa4Xg3+WS3kVDxBU-hsPuS_z50+xeag@mail.gmail.com>
 <ffd213de-3bc0-f65f-7030-dd45ac757f55@treenet.co.nz>
Message-ID: <CAHvB88x+=Qh6k2zqARx1AtE6RbvY+Dn=vU3uar9ph+vTdJxTfg@mail.gmail.com>

Seems like "findutils" is the package which fixes the build.

Binsaries in this package:

# rpm -ql findutils | grep bin
/bin/find
/usr/bin/find
/usr/bin/oldfind
/usr/bin/xargs

If build depends on some of these then configure script should probably
check that they're available.

On Wed, Apr 13, 2022 at 9:38 PM Amos Jeffries <squid3 at treenet.co.nz> wrote:

> On 14/04/22 14:59, Ivan Larionov wrote:
> > There were no errors earlier.
> >
> > Seems like installing openldap-devel fixes the issue.
> >
> > There were other dependencies installed together with it, not sure if
> > they also affected the build or not.
>
>
> I suspect one or more of those other components is indeed the source of
> the change. Some of them are very low-level OS functionality updates (eg
> /proc and filesystem  utilities).
>
> FWIW, The gist you posted looks suspiciously like reports we used to see
> when BSD people were having issues with the linker not receiving all the
> arguments passed to it. I would focus on the ones which interact with OS
> filesystem or the autotools / compiler/ linker.
>
>
> HTH
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>


-- 
With best regards, Ivan Larionov.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220425/86c2e46d/attachment.htm>

From rousskov at measurement-factory.com  Mon Apr 25 20:07:59 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Mon, 25 Apr 2022 16:07:59 -0400
Subject: [squid-users] squid compilation error in Docker
In-Reply-To: <CAHvB88x+=Qh6k2zqARx1AtE6RbvY+Dn=vU3uar9ph+vTdJxTfg@mail.gmail.com>
References: <CAHvB88xLnc9a0tEqQ6ZuQn0LtoXketTPd1y33xRaW7Q3Nt0=KA@mail.gmail.com>
 <000c01d84f8f$42698980$c73c9c80$@gmail.com>
 <CAHvB88yg3LhvAs6KdZV=QDeHbZoKFre3V1EpTCe7OSmUEs-oBw@mail.gmail.com>
 <5b63e001-d8c6-aa65-6f37-a6c39e39f4e3@measurement-factory.com>
 <CAHvB88w2GABY0qKRCAvUa4Xg3+WS3kVDxBU-hsPuS_z50+xeag@mail.gmail.com>
 <ffd213de-3bc0-f65f-7030-dd45ac757f55@treenet.co.nz>
 <CAHvB88x+=Qh6k2zqARx1AtE6RbvY+Dn=vU3uar9ph+vTdJxTfg@mail.gmail.com>
Message-ID: <3b7c2d58-f3f5-c582-ce3d-592e2087c31b@measurement-factory.com>

On 4/25/22 15:41, Ivan Larionov wrote:
> Seems like "findutils" is the package which fixes the build.
> 
> Binsaries in this package:
> 
> # rpm -ql findutils | grep bin
> /bin/find
> /usr/bin/find
> /usr/bin/oldfind
> /usr/bin/xargs
> 
> If build depends on some of these?then configure script should probably 
> check that they're available.


... and/or properly fail when their execution/use fails. I do not know 
whether this find/xargs dependency is inside Squid or inside something 
that Squid is using though, but I could not quickly find any direct uses 
by Squid sources (that would fail the build).


Alex.


> On Wed, Apr 13, 2022 at 9:38 PM Amos Jeffries wrote:
> 
>     On 14/04/22 14:59, Ivan Larionov wrote:
>      > There were no errors earlier.
>      >
>      > Seems like installing?openldap-devel fixes the issue.
>      >
>      > There were other dependencies installed together with it, not
>     sure if
>      > they also affected the build or not.
> 
> 
>     I suspect one or more of those other components is indeed the source of
>     the change. Some of them are very low-level OS functionality updates
>     (eg
>     /proc and filesystem? utilities).
> 
>     FWIW, The gist you posted looks suspiciously like reports we used to
>     see
>     when BSD people were having issues with the linker not receiving all
>     the
>     arguments passed to it. I would focus on the ones which interact
>     with OS
>     filesystem or the autotools / compiler/ linker.
> 
> 
>     HTH
>     Amos
>     _______________________________________________
>     squid-users mailing list
>     squid-users at lists.squid-cache.org
>     <mailto:squid-users at lists.squid-cache.org>
>     http://lists.squid-cache.org/listinfo/squid-users
>     <http://lists.squid-cache.org/listinfo/squid-users>
> 
> 
> 
> -- 
> With best regards, Ivan Larionov.
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



From ngtech1ltd at gmail.com  Mon Apr 25 20:26:24 2022
From: ngtech1ltd at gmail.com (NgTech LTD)
Date: Mon, 25 Apr 2022 23:26:24 +0300
Subject: [squid-users] Is Squid 5.5 considered stable?
In-Reply-To: <Ymbra/BB+b3+1K5B@fnal.gov>
References: <Ymbra/BB+b3+1K5B@fnal.gov>
Message-ID: <CABA8h=Tp_iLXieKw45rw9rtzG2sRvTuKw7FdOvZNobS0LxZV1A@mail.gmail.com>

Hey,

I have been using 5.5 in production since its out but yet to find a
specific issue with it.
My setup is small so I cannot say too much.
If some admins can share their cache manager with the project we can try to
identify specific abnormal memory leaks.
I have been working on a script that will dump and convert the cache
manager pages to json.

Eliezer

?????? ??? ??, 25 ????? 2022, 21:41, ??? Dave Dykstra ?<dwd at fnal.gov>:

> On Thu, Apr 14, 2022 at 11:21:54PM +1200, Amos Jeffries wrote:
> > Subject: [squid-announce] Squid 5.5 is available
> ...
> >   Users of Squid-4 holding back due to earlier release issues
> >   are encouraged to test this version for upgrade.
>
> This doesn't seem to me to be a resounding endorsement.  Are there any
> other known significant issues with squid-5.5 not present in squid-4.x?
> For example, are the memory leaks fixed?  That isn't clear to me.
>
> Dave
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220425/9d128f85/attachment.htm>

From xeron.oskom at gmail.com  Tue Apr 26 20:23:47 2022
From: xeron.oskom at gmail.com (Ivan Larionov)
Date: Tue, 26 Apr 2022 13:23:47 -0700
Subject: [squid-users] squid compilation error in Docker
In-Reply-To: <3b7c2d58-f3f5-c582-ce3d-592e2087c31b@measurement-factory.com>
References: <CAHvB88xLnc9a0tEqQ6ZuQn0LtoXketTPd1y33xRaW7Q3Nt0=KA@mail.gmail.com>
 <000c01d84f8f$42698980$c73c9c80$@gmail.com>
 <CAHvB88yg3LhvAs6KdZV=QDeHbZoKFre3V1EpTCe7OSmUEs-oBw@mail.gmail.com>
 <5b63e001-d8c6-aa65-6f37-a6c39e39f4e3@measurement-factory.com>
 <CAHvB88w2GABY0qKRCAvUa4Xg3+WS3kVDxBU-hsPuS_z50+xeag@mail.gmail.com>
 <ffd213de-3bc0-f65f-7030-dd45ac757f55@treenet.co.nz>
 <CAHvB88x+=Qh6k2zqARx1AtE6RbvY+Dn=vU3uar9ph+vTdJxTfg@mail.gmail.com>
 <3b7c2d58-f3f5-c582-ce3d-592e2087c31b@measurement-factory.com>
Message-ID: <CAHvB88zkS_PvNru8Bft8Zw+bvFP7rRWg6GvhCHgo-6mOAhqZtg@mail.gmail.com>

I think based on the compilation log that it's not used by squid directly
but by libtool. I went through the whole log again and found the following
errors which I missed originally:

"libtool: line 4251: find: command not found"

On Mon, Apr 25, 2022 at 1:08 PM Alex Rousskov <
rousskov at measurement-factory.com> wrote:

> On 4/25/22 15:41, Ivan Larionov wrote:
> > Seems like "findutils" is the package which fixes the build.
> >
> > Binsaries in this package:
> >
> > # rpm -ql findutils | grep bin
> > /bin/find
> > /usr/bin/find
> > /usr/bin/oldfind
> > /usr/bin/xargs
> >
> > If build depends on some of these then configure script should probably
> > check that they're available.
>
>
> ... and/or properly fail when their execution/use fails. I do not know
> whether this find/xargs dependency is inside Squid or inside something
> that Squid is using though, but I could not quickly find any direct uses
> by Squid sources (that would fail the build).
>
>
> Alex.
>
>
> > On Wed, Apr 13, 2022 at 9:38 PM Amos Jeffries wrote:
> >
> >     On 14/04/22 14:59, Ivan Larionov wrote:
> >      > There were no errors earlier.
> >      >
> >      > Seems like installing openldap-devel fixes the issue.
> >      >
> >      > There were other dependencies installed together with it, not
> >     sure if
> >      > they also affected the build or not.
> >
> >
> >     I suspect one or more of those other components is indeed the source
> of
> >     the change. Some of them are very low-level OS functionality updates
> >     (eg
> >     /proc and filesystem  utilities).
> >
> >     FWIW, The gist you posted looks suspiciously like reports we used to
> >     see
> >     when BSD people were having issues with the linker not receiving all
> >     the
> >     arguments passed to it. I would focus on the ones which interact
> >     with OS
> >     filesystem or the autotools / compiler/ linker.
> >
> >
> >     HTH
> >     Amos
> >     _______________________________________________
> >     squid-users mailing list
> >     squid-users at lists.squid-cache.org
> >     <mailto:squid-users at lists.squid-cache.org>
> >     http://lists.squid-cache.org/listinfo/squid-users
> >     <http://lists.squid-cache.org/listinfo/squid-users>
> >
> >
> >
> > --
> > With best regards, Ivan Larionov.
> >
> > _______________________________________________
> > squid-users mailing list
> > squid-users at lists.squid-cache.org
> > http://lists.squid-cache.org/listinfo/squid-users
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>


-- 
With best regards, Ivan Larionov.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220426/b1452748/attachment.htm>

From renato.camarao at gmail.com  Tue Apr 26 20:58:47 2022
From: renato.camarao at gmail.com (Renato C. Pacheco)
Date: Tue, 26 Apr 2022 17:58:47 -0300
Subject: [squid-users] HTTPS is not working while doing authentication bypass
Message-ID: <CAOsH0iTByj+6-SP5zQEyfq=JpXDz0KiCLgQ534G_ohZFm+bLsQ@mail.gmail.com>

Hello!

I'm facing an issue regarding bypass authentication in some domains. I was
following the official wiki here
<https://wiki.squid-cache.org/ConfigExamples/Authenticate/Bypass> and it
worked, but every HTTPS request (CONNECT method) that belongs to the
exception that I've made receives a SSL error
(ssl_error_rx_record_too_long). Below, the squid.conf content, squid
version and telemetry content.

# squid -v
Squid Cache: Version 4.6
Service Name: squid
Debian linux
configure options:  '--build=x86_64-linux-gnu' '--prefix=/usr'
'--includedir=${prefix}/include' '--mandir=${prefix}/share/man'
'--infodir=${prefix}/share/info
' '--sysconfdir=/etc' '--localstatedir=/var'
'--libexecdir=${prefix}/lib/squid' '--srcdir=.' '--disable-maintainer-mode'
'--disable-dependency-tracking' '--di
sable-silent-rules' 'BUILDCXXFLAGS=-g -O2
-fdebug-prefix-map=/build/squid-4.6=. -fstack-protector-strong -Wformat
-Werror=format-security -Wdate-time -D_FORTI
FY_SOURCE=2 -Wl,-z,relro -Wl,-z,now -Wl,--as-needed -latomic'
'BUILDCXX=x86_64-linux-gnu-g++' '--with-build-environment=default'
'--enable-build-info=Debian l
inux' '--datadir=/usr/share/squid' '--sysconfdir=/etc/squid'
'--libexecdir=/usr/lib/squid' '--mandir=/usr/share/man' '--enable-inline'
'--disable-arch-native'
'--enable-async-io=8' '--enable-storeio=ufs,aufs,diskd,rock'
'--enable-removal-policies=lru,heap' '--enable-delay-pools'
'--enable-cache-digests' '--enable-i
cap-client' '--enable-follow-x-forwarded-for'
'--enable-auth-basic=DB,fake,getpwnam,LDAP,NCSA,NIS,PAM,POP3,RADIUS,SASL,SMB'
'--enable-auth-digest=file,LDAP' '
--enable-auth-negotiate=kerberos,wrapper' '--enable-auth-ntlm=fake,SMB_LM'
'--enable-external-acl-helpers=file_userip,kerberos_ldap_group,LDAP_group,session,S
QL_session,time_quota,unix_group,wbinfo_group'
'--enable-security-cert-validators=fake'
'--enable-storeid-rewrite-helpers=file' '--enable-url-rewrite-helpers=
fake' '--enable-eui' '--enable-esi' '--enable-icmp' '--enable-zph-qos'
'--enable-ecap' '--disable-translation' '--with-swapdir=/var/spool/squid'
'--with-logdi
r=/var/log/squid' '--with-pidfile=/var/run/squid.pid'
'--with-filedescriptors=65536' '--with-large-files'
'--with-default-user=proxy' '--with-gnutls' '--enabl
e-linux-netfilter' 'build_alias=x86_64-linux-gnu' 'CC=x86_64-linux-gnu-gcc'
'CFLAGS=-g -O2 -fdebug-prefix-map=/build/squid-4.6=.
-fstack-protector-strong -Wfo
rmat -Werror=format-security -Wall' 'LDFLAGS=-Wl,-z,relro -Wl,-z,now
-Wl,--as-needed -latomic' 'CPPFLAGS=-Wdate-time -D_FORTIFY_SOURCE=2'
'CXX=x86_64-linux-gn
u-g++' 'CXXFLAGS=-g -O2 -fdebug-prefix-map=/build/squid-4.6=.
-fstack-protector-strong -Wformat -Werror=format-security'

# cat /etc/squid/squid.conf

auth_param ntlm program /usr/bin/ntlm_auth
--helper-protocol=squid-2.5-ntlmssp --domain=DOMAIN
auth_param ntlm children 500
auth_param ntlm keep_alive on

auth_param basic program /usr/lib/squid/basic_ldap_auth -b
ou=users,dc=mydomain,dc=com,dc=br -h 10.100.0.1 -p 389 -s sub -v 3 -f
"uid=%s"
auth_param basic children 1000
auth_param basic realm Proxy Server ldap
auth_param basic credentialsttl 2 hours
auth_param basic casesensitive off


acl CONNECT method CONNECT
acl password proxy_auth REQUIRED


acl telemetry dstdomain "/etc/squid/exceptions/telemetry"
acl http proto http
acl port_443 port 443
acl port_80 port 80
http_access allow CONNECT port_443 telemetry
http_access allow http port_80 telemetry

http_access allow http port_80 password
http_access allow CONNECT port_443 password
http_access deny all

http_port 3128

acl hasRequest has request
access_log syslog:local4.warning squid hasRequest

visible_hostname proxy.mydomain.com.br

error_directory /usr/share/squid/errors/pt-br

cache_peer 127.0.0.1 parent 8080 0 login=*:password no-digest
no-netdb-exchange
always_direct deny all
never_direct allow all
max_filedesc 65535

# cat /etc/squid/exceptions/telemetry
.data.microsoft.com
.telemetry.microsoft.com

Below, the test accessing https://watson.telemetry.microsoft.com with curl:

$ curl --proxy http://myserver:3128 -vk
https://watson.telemetry.microsoft.com/
*   Trying 10.100.1.13:3128...
* TCP_NODELAY set
* Connected to myserver (10.100.1.13) port 3128 (#0)
* allocate connect buffer!
* Establish HTTP proxy tunnel to watson.telemetry.microsoft.com:443
> CONNECT watson.telemetry.microsoft.com:443 HTTP/1.1
> Host: watson.telemetry.microsoft.com:443
> User-Agent: curl/7.68.0
> Proxy-Connection: Keep-Alive
>
< HTTP/1.1 200 Connection established
<
* Proxy replied 200 to CONNECT request
* CONNECT phase completed!
* ALPN, offering h2
* ALPN, offering http/1.1
* successfully set certificate verify locations:
*   CAfile: /etc/ssl/certs/ca-certificates.crt
 CApath: /etc/ssl/certs
* TLSv1.3 (OUT), TLS handshake, Client hello (1):
* CONNECT phase completed!
* CONNECT phase completed!
* error:1408F10B:SSL routines:ssl3_get_record:wrong version number
* Closing connection 0
curl: (35) error:1408F10B:SSL routines:ssl3_get_record:wrong version number

With browser (Chrome):

[image: image.png]


Thanks,
--
Renato Carneiro Pacheco
Security Analyst

http://br.linkedin.com/in/renatocarneirop
http://www.facebook.com/renatocarneirop

*"N?o acredite no que eu digo, pois ? a minha experi?ncia e n?o a sua.
Experimente, indague e busque." - *Osho Rajneesh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220426/cf3a475b/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image.png
Type: image/png
Size: 46153 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220426/cf3a475b/attachment.png>

From rousskov at measurement-factory.com  Tue Apr 26 22:03:10 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Tue, 26 Apr 2022 18:03:10 -0400
Subject: [squid-users] HTTPS is not working while doing authentication
 bypass
In-Reply-To: <CAOsH0iTByj+6-SP5zQEyfq=JpXDz0KiCLgQ534G_ohZFm+bLsQ@mail.gmail.com>
References: <CAOsH0iTByj+6-SP5zQEyfq=JpXDz0KiCLgQ534G_ohZFm+bLsQ@mail.gmail.com>
Message-ID: <c6e052ac-8c74-a701-ec9d-1eb0b8c8f0ff@measurement-factory.com>

On 4/26/22 16:58, Renato C. Pacheco wrote:
> every HTTPS request?(CONNECT method) that belongs to the 
> exception that I've made receives a SSL error 
> (ssl_error_rx_record_too_long).

Often, that means that Squid is sending a plain text HTTP error to the 
TLS client.


> Squid Cache: Version 4.6

You should upgrade.


> cache_peer 127.0.0.1 parent 8080 0 login=*:password no-digest 

Since your Squid does not speak TLS, it probably just forwards a plain 
text (error?) response from this cache peer to your TLS client. Squid 
access.log can tell you whether Squid went to the cache peer or direct, 
and you may be able to see what is going on using a packet capture.


HTH,

Alex.


From mca2rahulbit at gmail.com  Wed Apr 27 06:44:23 2022
From: mca2rahulbit at gmail.com (rahul gupta)
Date: Wed, 27 Apr 2022 14:44:23 +0800
Subject: [squid-users] How to enable health check or get 200 return ?
Message-ID: <CAA50s+Ci4X8DWOudLuHSAqwK3fm=qtNuPXDRFge0JKYDYJCWsg@mail.gmail.com>

Hi Team,

I am new to the Squid community, can someone please help/guide me?

Need to know, How to enable health check or get 200 return from squid? it
returns 400, when associating a target in AWS NLB, it only accepts from
200-399 and also not allowed to override?

Any help would be appreciated. thanks.

Regards
Rahul
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220427/2aaaaaf9/attachment.htm>

From ronriver at gmail.com  Wed Apr 27 08:57:49 2022
From: ronriver at gmail.com (#! ./)
Date: Wed, 27 Apr 2022 18:57:49 +1000
Subject: [squid-users] How to enable health check or get 200 return ?
In-Reply-To: <CAA50s+Ci4X8DWOudLuHSAqwK3fm=qtNuPXDRFge0JKYDYJCWsg@mail.gmail.com>
References: <CAA50s+Ci4X8DWOudLuHSAqwK3fm=qtNuPXDRFge0JKYDYJCWsg@mail.gmail.com>
Message-ID: <CAL7p3dK89GO0i8_3-oBaZqfodTtPswV-KKcauGASX_dhAnyyUQ@mail.gmail.com>

Hi Rahul,

On Wed, 27 Apr 2022 at 4:44 pm, rahul gupta <mca2rahulbit at gmail.com> wrote:

> Hi Team,
>
> I am new to the Squid community, can someone please help/guide me?
>
> Need to know, How to enable health check or get 200 return from squid? it
> returns 400,
>

It sounds like you are using an HTTP healthcheck in the NLB which issues a
GET / request on the instance and returns an HTTP 400.

when associating a target in AWS NLB, it only accepts from 200-399 and also
> not allowed to override?
>

I don't think there's a way to override the expected HTTP status code in
the NLB. Using an ALB in front of squid will not solve this problem as well.

I suggest using a TCP healthcheck in your NLB's target group.

HTH.

Best regards, ron

Any help would be appreciated. thanks.
>
> Regards
> Rahul
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220427/79671425/attachment.htm>

From squid3 at treenet.co.nz  Thu Apr 28 01:32:18 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 28 Apr 2022 13:32:18 +1200
Subject: [squid-users] [squid-announce] Squid 5.5 is available
In-Reply-To: <vmime.62666452.7d66.7c7523e2ee86472@ms249-lin-003.rotterdam.bazuin.nl>
References: <99223551-4be2-ddd3-9a19-93e32420e920@treenet.co.nz>
 <vmime.62666452.7d66.7c7523e2ee86472@ms249-lin-003.rotterdam.bazuin.nl>
Message-ID: <0989641c-8f2e-9c30-a732-27bcc90be2ca@treenet.co.nz>

On 25/04/22 21:05, L.P.H. van Belle wrote:
> Hai Amos,
> 
> Small question on this release. I saw in the changelog.
> 
> 2.4 TrivialDB Support
> This release deprecates use of BerkleyDB in favour of TrivialDB.
> 
> I also saw in https://packages.debian.org/bookworm/squid
> dep: libtdb1 (>= 1.2.7+git20101214)
> 
> Now im wondering, does it still apply to use libldb1 or are there plans to move to libldb2.
> 

I'm not sure what you mean by "ldb". I assume that is a typo of "libdb"?


Most OS distributors have moved to TrivialDB as an open-source 
replacement for BerkleyDB. Squid has been updated to support the OS 
provided library.

As for plans, there are none that I am aware of. As with all things 
future support depends on what people want to contribute towards.


Amos


From squid3 at treenet.co.nz  Thu Apr 28 01:34:29 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 28 Apr 2022 13:34:29 +1200
Subject: [squid-users] [squid-announce] Squid 5.5 is available
In-Reply-To: <YmaiBxh31kmyjVOi@doctor.nl2k.ab.ca>
References: <99223551-4be2-ddd3-9a19-93e32420e920@treenet.co.nz>
 <vmime.62666452.7d66.7c7523e2ee86472@ms249-lin-003.rotterdam.bazuin.nl>
 <YmaiBxh31kmyjVOi@doctor.nl2k.ab.ca>
Message-ID: <dbcaa643-f2bd-f48c-a6a6-f36a5fdccb3b@treenet.co.nz>

On 26/04/22 01:28, The Doctor wrote:
> When will Squid be openssl 3 compliant?
> 

When the upgrade support gets finished. We have RSA certificates 
working, but there are issues related to the API for using 
Elliptic-Curve ciphers.

Amos


From squid3 at treenet.co.nz  Thu Apr 28 02:14:34 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 28 Apr 2022 14:14:34 +1200
Subject: [squid-users] Is Squid 5.5 considered stable?
In-Reply-To: <Ymbra/BB+b3+1K5B@fnal.gov>
References: <Ymbra/BB+b3+1K5B@fnal.gov>
Message-ID: <36461a9a-c119-42da-7caf-28e41c74f5fe@treenet.co.nz>

On 26/04/22 06:41, Dave Dykstra wrote:
> On Thu, Apr 14, 2022 at 11:21:54PM +1200, Amos Jeffries wrote:
>> Subject: [squid-announce] Squid 5.5 is available
> ...
>>    Users of Squid-4 holding back due to earlier release issues
>>    are encouraged to test this version for upgrade.
> 
> This doesn't seem to me to be a resounding endorsement.

Exactly so. I am endorsing a cautious attempt to upgrade (for now).


>  Are there any
> other known significant issues with squid-5.5 not present in squid-4.x?

With that disclaimer "not present in squid-4" I can say yes.

My uncertainty is about as-yet unknown issues. All the fixes introduced 
by 5.4.1 appear to be stable and working.


> For example, are the memory leaks fixed?  That isn't clear to me.
> 

As for leaks; we have fixed several. At least one remains in v5+, I am 
unsure at this point whether it affects everyone or just specific 
configurations.

There are quite a few bugs to be worked out still, but they appear to be 
low-impact or restricted to very specific configurations.


Amos


From belle at bazuin.nl  Thu Apr 28 08:56:26 2022
From: belle at bazuin.nl (=?windows-1252?Q?L.P.H._van_Belle?=)
Date: Thu, 28 Apr 2022 10:56:26 +0200
Subject: [squid-users] [squid-announce] Squid 5.5 is available
In-Reply-To: <0989641c-8f2e-9c30-a732-27bcc90be2ca@treenet.co.nz>
References: <vmime.62666452.7d66.7c7523e2ee86472@ms249-lin-003.rotterdam.bazuin.nl>
Message-ID: <vmime.626a56ba.68c9.41ce83165d00195a@ms249-lin-003.rotterdam.bazuin.nl>

Hai Amos, 

What i saw was the following and im just wondering if that?s still correct and.. ahh. 
Sorry, I now see I had a brain fart..  sorry for the noise. 
I mixed the libldb2 with libtdb1 

Please ignore my e-mail.  

ps. 
Running 5.4.1 also some time, no problems detected so far. 

Greetz,

Louis

> -----Oorspronkelijk bericht-----
> Van: squid-users Namens Amos Jeffries
> Verzonden: donderdag 28 april 2022 3:32
> Aan: squid-users at lists.squid-cache.org
> Onderwerp: Re: [squid-users] [squid-announce] Squid 5.5 is available
> 
> On 25/04/22 21:05, L.P.H. van Belle wrote:
> > Hai Amos,
> >
> > Small question on this release. I saw in the changelog.
> >
> > 2.4 TrivialDB Support
> > This release deprecates use of BerkleyDB in favour of TrivialDB.
> >
> > I also saw in https://packages.debian.org/bookworm/squid
> > dep: libtdb1 (>= 1.2.7+git20101214)
> >
> > Now im wondering, does it still apply to use libldb1 or are there plans to
> move to libldb2.
> >
> 
> I'm not sure what you mean by "ldb". I assume that is a typo of "libdb"?
> 
> 
> Most OS distributors have moved to TrivialDB as an open-source
> replacement for BerkleyDB. Squid has been updated to support the OS
> provided library.
> 
> As for plans, there are none that I am aware of. As with all things
> future support depends on what people want to contribute towards.
> 
> 
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users




From ngtech1ltd at gmail.com  Sat Apr 30 22:46:39 2022
From: ngtech1ltd at gmail.com (Eliezer Croitoru)
Date: Sun, 1 May 2022 01:46:39 +0300
Subject: [squid-users] squid compilation error in Docker
In-Reply-To: <CAHvB88zkS_PvNru8Bft8Zw+bvFP7rRWg6GvhCHgo-6mOAhqZtg@mail.gmail.com>
References: <CAHvB88xLnc9a0tEqQ6ZuQn0LtoXketTPd1y33xRaW7Q3Nt0=KA@mail.gmail.com>
 <000c01d84f8f$42698980$c73c9c80$@gmail.com>
 <CAHvB88yg3LhvAs6KdZV=QDeHbZoKFre3V1EpTCe7OSmUEs-oBw@mail.gmail.com>
 <5b63e001-d8c6-aa65-6f37-a6c39e39f4e3@measurement-factory.com>
 <CAHvB88w2GABY0qKRCAvUa4Xg3+WS3kVDxBU-hsPuS_z50+xeag@mail.gmail.com>
 <ffd213de-3bc0-f65f-7030-dd45ac757f55@treenet.co.nz>
 <CAHvB88x+=Qh6k2zqARx1AtE6RbvY+Dn=vU3uar9ph+vTdJxTfg@mail.gmail.com>
 <3b7c2d58-f3f5-c582-ce3d-592e2087c31b@measurement-factory.com>
 <CAHvB88zkS_PvNru8Bft8Zw+bvFP7rRWg6GvhCHgo-6mOAhqZtg@mail.gmail.com>
Message-ID: <000c01d85ce4$28814910$7983db30$@gmail.com>

I assume that the findutils is not a dependency of libtool since the required utilities can be supplied from couple sources.

One of them is busybox but I assumed that RedHat or CentOS will make it a requirement.

 

A good catch!

 

Thanks,

Eliezer

 

----

Eliezer Croitoru

NgTech, Tech Support

Mobile: +972-5-28704261

Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> 

 

From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Ivan Larionov
Sent: Tuesday, April 26, 2022 23:24
To: Alex Rousskov <rousskov at measurement-factory.com>
Cc: Squid Users <squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] squid compilation error in Docker

 

I think based on the compilation log that it's not used by squid directly but by libtool. I went through the whole log again and found the following errors which I missed originally:

 

"libtool: line 4251: find: command not found"

 

On Mon, Apr 25, 2022 at 1:08 PM Alex Rousskov <rousskov at measurement-factory.com <mailto:rousskov at measurement-factory.com> > wrote:

On 4/25/22 15:41, Ivan Larionov wrote:
> Seems like "findutils" is the package which fixes the build.
> 
> Binsaries in this package:
> 
> # rpm -ql findutils | grep bin
> /bin/find
> /usr/bin/find
> /usr/bin/oldfind
> /usr/bin/xargs
> 
> If build depends on some of these then configure script should probably 
> check that they're available.


... and/or properly fail when their execution/use fails. I do not know 
whether this find/xargs dependency is inside Squid or inside something 
that Squid is using though, but I could not quickly find any direct uses 
by Squid sources (that would fail the build).


Alex.


> On Wed, Apr 13, 2022 at 9:38 PM Amos Jeffries wrote:
> 
>     On 14/04/22 14:59, Ivan Larionov wrote:
>      > There were no errors earlier.
>      >
>      > Seems like installing openldap-devel fixes the issue.
>      >
>      > There were other dependencies installed together with it, not
>     sure if
>      > they also affected the build or not.
> 
> 
>     I suspect one or more of those other components is indeed the source of
>     the change. Some of them are very low-level OS functionality updates
>     (eg
>     /proc and filesystem  utilities).
> 
>     FWIW, The gist you posted looks suspiciously like reports we used to
>     see
>     when BSD people were having issues with the linker not receiving all
>     the
>     arguments passed to it. I would focus on the ones which interact
>     with OS
>     filesystem or the autotools / compiler/ linker.
> 
> 
>     HTH
>     Amos
>     _______________________________________________
>     squid-users mailing list
>     squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> 
>     <mailto:squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> >
>     http://lists.squid-cache.org/listinfo/squid-users
>     <http://lists.squid-cache.org/listinfo/squid-users>
> 
> 
> 
> -- 
> With best regards, Ivan Larionov.
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> 
> http://lists.squid-cache.org/listinfo/squid-users

_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> 
http://lists.squid-cache.org/listinfo/squid-users




 

-- 

With best regards, Ivan Larionov.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220501/87400380/attachment.htm>

