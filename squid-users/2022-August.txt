From nabil1385 at gmail.com  Tue Aug  2 08:22:23 2022
From: nabil1385 at gmail.com (Frank Ansari)
Date: Tue, 2 Aug 2022 10:22:23 +0200
Subject: [squid-users] xcalloc error when installing squid in container on
 CentOS 9 host
Message-ID: <CAPg1V3XbDGGB1OBmM7uyW2g5Z_RzpKDy4FdhXeMAQnzN35rnZA@mail.gmail.com>

Hi,

I have found a weird issue with CentOS 9.

So far I had squid running on a CentOS 8 system within an Alpine Linux
Container and this has worked.

Now I installed CentOS 9 and also latest Alpine Linux with squid 5.5.

Squid refuses to start and when I run "squid -z" I get this error:

[root at 324ae7d5e4db /]# 2022/08/01 08:01:47| FATAL: xcalloc: Unable to
allocate 1073741816 blocks of 432 bytes!

2022/08/01 08:01:47| Squid Cache (Version 5.5): Terminated abnormally.
CPU Usage: 0.002 seconds = 0.000 user + 0.002 sys
Maximum Resident Size: 31744 KB
Page faults with physical i/o: 0

My question: has anybody the same issue? Why is squid asking for 432 GB?

This seems to have nothing to do with my squid.conf. Whatever I change
there has no effect at all.

The CentOS 9 VM is running on Proxmox and has 4 GB RAM.

I also tried to install Debian 11 and Ubuntu 20 and 22 containers and
similar errors.

My last try was to install a CentOS 9 conatiner on the CentOS 9 host and
also this gives the same error.

I have now installed squid 5.5 directly on the OS but I still curios why it
refuses to run in any kind of container.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220802/0f86a2dd/attachment.htm>

From gkinkie at gmail.com  Tue Aug  2 08:28:03 2022
From: gkinkie at gmail.com (Francesco Chemolli)
Date: Tue, 2 Aug 2022 09:28:03 +0100
Subject: [squid-users] xcalloc error when installing squid in container
 on CentOS 9 host
In-Reply-To: <CAPg1V3XbDGGB1OBmM7uyW2g5Z_RzpKDy4FdhXeMAQnzN35rnZA@mail.gmail.com>
References: <CAPg1V3XbDGGB1OBmM7uyW2g5Z_RzpKDy4FdhXeMAQnzN35rnZA@mail.gmail.com>
Message-ID: <CA+Y8hcNOyy8voc=PNCd49XkC89iL9oHRCn=godG1ZKGtnRNNPA@mail.gmail.com>

Hi Frank,
  could you share what does your configuration look like (minus any
confidential bits)? And I assume you're running the version of squid
packaged by the distros?


On Tue, Aug 2, 2022 at 9:22 AM Frank Ansari <nabil1385 at gmail.com> wrote:

> Hi,
>
> I have found a weird issue with CentOS 9.
>
> So far I had squid running on a CentOS 8 system within an Alpine Linux
> Container and this has worked.
>
> Now I installed CentOS 9 and also latest Alpine Linux with squid 5.5.
>
> Squid refuses to start and when I run "squid -z" I get this error:
>
> [root at 324ae7d5e4db /]# 2022/08/01 08:01:47| FATAL: xcalloc: Unable to
> allocate 1073741816 blocks of 432 bytes!
>
> 2022/08/01 08:01:47| Squid Cache (Version 5.5): Terminated abnormally.
> CPU Usage: 0.002 seconds = 0.000 user + 0.002 sys
> Maximum Resident Size: 31744 KB
> Page faults with physical i/o: 0
>
> My question: has anybody the same issue? Why is squid asking for 432 GB?
>
> This seems to have nothing to do with my squid.conf. Whatever I change
> there has no effect at all.
>
> The CentOS 9 VM is running on Proxmox and has 4 GB RAM.
>
> I also tried to install Debian 11 and Ubuntu 20 and 22 containers and
> similar errors.
>
> My last try was to install a CentOS 9 conatiner on the CentOS 9 host and
> also this gives the same error.
>
> I have now installed squid 5.5 directly on the OS but I still curios why
> it refuses to run in any kind of container.
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>


-- 
    Francesco
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220802/80cbf3f9/attachment.htm>

From robertkwild at gmail.com  Tue Aug  2 11:50:33 2022
From: robertkwild at gmail.com (robert k Wild)
Date: Tue, 2 Aug 2022 12:50:33 +0100
Subject: [squid-users] regex for normal websites
In-Reply-To: <008601d8a251$a482dd00$ed889700$@gmail.com>
References: <CAGU_CiJimq7-co9QCVT1+-NF8Y_V4pECVRiow_eOhh=rfXHK6g@mail.gmail.com>
 <YuEN+aHq7/a1DVVh@fantomas.sk>
 <CAGU_CiJb9rfGdwLVoR0n8VE+vuJFtQwGu3v2HvGBW3i+uBQbGA@mail.gmail.com>
 <008601d8a251$a482dd00$ed889700$@gmail.com>
Message-ID: <CAGU_CiJ7yG_MejWPTn4Ax6prcsP8fhJ6G9WDL4+9NwBfmoOEkQ@mail.gmail.com>

thanks Eliezer

so it should be

adobe\.com

not

.adobe.\com or

^.*adobe.com

as the ^.* could include

blahadobe.com



On Thu, 28 Jul 2022 at 08:14, <ngtech1ltd at gmail.com> wrote:

> Hey Robert,
>
>
>
> The docs at http://www.squid-cache.org/Doc/config/acl/  states:
>
>
>
>         acl aclname ssl::server_name_regex [-i] \.foo\.com ...
>
>           # regex matches server name obtained from various sources [fast]
>
>
>
> Which and I do not know exactly what it means but it will not work with a
> helper in most cases.
>
> I have found the in the git the next sources:
>
>
> https://github.com/squid-cache/squid/blob/bf95c10aa95bf8e56d9d8d1545cb5a3aafab0d2c/doc/release-notes/release-3.5.sgml#L414
>
>
>
>                 New types ssl::server_name  and ssl::server_name_regex
>
>                    to match server name from various sources (CONNECT
> authority name,
>
>                    TLS SNI domain, or X.509 certificate Subject Name).
>
>
>
> Which means that there is a set of checks which the acl does and not just
> a domain name.
>
> It?s also even possible that the domain name is not know in the CONNECT
> state of the connection.
>
> If I remember correctly there is a possibility for browsers to use the
> same exact connection for multiple domains but
> I have not seen this yet in production.
>
> With Squid once you bump the connection to HTTP/1.x you can make 100% sure
> the features of the Host header request.
>
>
>
> At Servername.cc ie:
>
>
> https://github.com/squid-cache/squid/blob/aee3523a768aff4d1e6c1195c4a401b4ef5688a0/src/acl/ServerName.cc#L81
>
>
>
> There is a specific logic of what is done and what is matched but I am not
> sure what would be used in the case of:
>
> *.adobe.com
>
>
>
> Certificate SAN.
>
>
>
> Specifically This part of the Common Names ie SAN:
>
>
> https://github.com/squid-cache/squid/blob/aee3523a768aff4d1e6c1195c4a401b4ef5688a0/src/acl/ServerName.cc#L105
>
>
>
> which to my understanding points to:
>
>
> https://github.com/squid-cache/squid/blob/d146da3bfe7083381ae7ab38640cbfd0d2542374/src/ssl/support.cc#L195
>
>
>
> doesn?t make any sense to me.( didn?t tried that much to understand)
>
>
>
> If someone might be able to make sense of things in a synchronic fashion
> it would help.
>
> (I do not see any debugs usage there or any helping comment )
>
>
>
> Thanks,
>
> Eliezer
>
>
>
> ----
>
> Eliezer Croitoru
>
> NgTech, Tech Support
>
> Mobile: +972-5-28704261
>
> Email: ngtech1ltd at gmail.com
>
> Web: https://ngtech.co.il/
>
> My-Tube: https://tube.ngtech.co.il/
>
>
>
> *From:* squid-users <squid-users-bounces at lists.squid-cache.org> *On
> Behalf Of *robert k Wild
> *Sent:* Wednesday, 27 July 2022 13:52
> *To:* Squid Users <squid-users at lists.squid-cache.org>
> *Subject:* Re: [squid-users] regex for normal websites
>
>
>
> that's the weird thing, when i try this in  "ssl::server_name_regex"
>
> .adobe.com
>
>
>
> it doesnt work
>
>
>
> you mean escape ie the \ character
>
>
>
>
>
>
>
>
>
>
>
> On Wed, 27 Jul 2022 at 11:05, Matus UHLAR - fantomas <uhlar at fantomas.sk>
> wrote:
>
> On 27.07.22 10:54, robert k Wild wrote:
> >think i got it right but just want to double check with you guys
> >
> >so in my "ssl::server_name" i had
> >.adobe.com
> >
> >that worked but i want to mix normal website and regex websites together
> so
> >i just have one list for all
>
> didn't the above work?  AFAIK it should, IIRC domain matching in squid
> matches "domain.com" if you check for ".domain.com".
>
> >i now have this for "ssl::server_name_regex"
> >^.*adobe.com$
> >
> >it works, so im guessing its right
>
> the dot should be escaped
>
>
> --
> Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
> Warning: I wish NOT to receive e-mail advertising to this address.
> Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
> BSE = Mad Cow Desease ... BSA = Mad Software Producents Desease
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
>
>
>
> --
>
> Regards,
>
> Robert K Wild.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>


-- 
Regards,

Robert K Wild.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220802/3540bd05/attachment.htm>

From ngtech1ltd at gmail.com  Tue Aug  2 12:05:02 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Tue, 2 Aug 2022 15:05:02 +0300
Subject: [squid-users] regex for normal websites
In-Reply-To: <CAGU_CiJ7yG_MejWPTn4Ax6prcsP8fhJ6G9WDL4+9NwBfmoOEkQ@mail.gmail.com>
References: <CAGU_CiJimq7-co9QCVT1+-NF8Y_V4pECVRiow_eOhh=rfXHK6g@mail.gmail.com>
 <YuEN+aHq7/a1DVVh@fantomas.sk>
 <CAGU_CiJb9rfGdwLVoR0n8VE+vuJFtQwGu3v2HvGBW3i+uBQbGA@mail.gmail.com>
 <008601d8a251$a482dd00$ed889700$@gmail.com>
 <CAGU_CiJ7yG_MejWPTn4Ax6prcsP8fhJ6G9WDL4+9NwBfmoOEkQ@mail.gmail.com>
Message-ID: <003801d8a668$190139f0$4b03add0$@gmail.com>

I believe it should have been:
^adobe\.com$
^.*\.adobe\.com$
^\*\.adobe\.com$
 
But I don?t know the code to this depth.
If I would have written the match I think it would have been something a bit different.
*	A match for SNI
*	A joker match for SAN ie *.adobe.com SAN should catch both www.www.adobe.com <http://www.www.adobe.com> 
 
But for some reason it?s not like that, I assume the browsers and the libraries doesn?t implement it for an unknown reason.
 
If Alex or anyone else from Factory knows the details of the ACL they can answer more then me.
 
Thanks,
Eliezer
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> 
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/
 
From: robert k Wild <robertkwild at gmail.com> 
Sent: Tuesday, 2 August 2022 14:51
To: Eliezer Croitoru <ngtech1ltd at gmail.com>
Cc: Squid Users <squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] regex for normal websites
 
thanks Eliezer
 
so it should be
 
adobe\.com
 
not
 
.adobe.\com or
 
^.*adobe.com <http://adobe.com> 
 
as the ^.* could include
 
blahadobe.com <http://blahadobe.com> 
 
 
 
On Thu, 28 Jul 2022 at 08:14, <ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> > wrote:
Hey Robert,
 
The docs at http://www.squid-cache.org/Doc/config/acl/  states:
 
        acl aclname ssl::server_name_regex [-i] \.foo\.com ...
          # regex matches server name obtained from various sources [fast]
 
Which and I do not know exactly what it means but it will not work with a helper in most cases.
I have found the in the git the next sources:
https://github.com/squid-cache/squid/blob/bf95c10aa95bf8e56d9d8d1545cb5a3aafab0d2c/doc/release-notes/release-3.5.sgml#L414
 
                New types ssl::server_name  and ssl::server_name_regex
                   to match server name from various sources (CONNECT authority name,
                   TLS SNI domain, or X.509 certificate Subject Name).
 
Which means that there is a set of checks which the acl does and not just a domain name.
It?s also even possible that the domain name is not know in the CONNECT state of the connection.
If I remember correctly there is a possibility for browsers to use the same exact connection for multiple domains but
I have not seen this yet in production.
With Squid once you bump the connection to HTTP/1.x you can make 100% sure the features of the Host header request.
 
At Servername.cc ie:
https://github.com/squid-cache/squid/blob/aee3523a768aff4d1e6c1195c4a401b4ef5688a0/src/acl/ServerName.cc#L81 
 
There is a specific logic of what is done and what is matched but I am not sure what would be used in the case of:
*.adobe.com <http://adobe.com> 
 
Certificate SAN.
 
Specifically This part of the Common Names ie SAN:
https://github.com/squid-cache/squid/blob/aee3523a768aff4d1e6c1195c4a401b4ef5688a0/src/acl/ServerName.cc#L105
 
which to my understanding points to:
https://github.com/squid-cache/squid/blob/d146da3bfe7083381ae7ab38640cbfd0d2542374/src/ssl/support.cc#L195
 
doesn?t make any sense to me.( didn?t tried that much to understand)
 
If someone might be able to make sense of things in a synchronic fashion it would help.
(I do not see any debugs usage there or any helping comment )
 
Thanks,
Eliezer
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> 
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/
 
From: squid-users <squid-users-bounces at lists.squid-cache.org <mailto:squid-users-bounces at lists.squid-cache.org> > On Behalf Of robert k Wild
Sent: Wednesday, 27 July 2022 13:52
To: Squid Users <squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> >
Subject: Re: [squid-users] regex for normal websites
 
that's the weird thing, when i try this in  "ssl::server_name_regex"
.adobe.com <http://adobe.com> 
 
it doesnt work
 
you mean escape ie the \ character
 
 
 
 
 
On Wed, 27 Jul 2022 at 11:05, Matus UHLAR - fantomas <uhlar at fantomas.sk <mailto:uhlar at fantomas.sk> > wrote:
On 27.07.22 10:54, robert k Wild wrote:
>think i got it right but just want to double check with you guys
>
>so in my "ssl::server_name" i had
>.adobe.com <http://adobe.com> 
>
>that worked but i want to mix normal website and regex websites together so
>i just have one list for all

didn't the above work?  AFAIK it should, IIRC domain matching in squid 
matches "domain.com <http://domain.com> " if you check for ".domain.com <http://domain.com> ".

>i now have this for "ssl::server_name_regex"
>^.*adobe.com <http://adobe.com> $
>
>it works, so im guessing its right

the dot should be escaped


-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk <mailto:uhlar at fantomas.sk>  ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
BSE = Mad Cow Desease ... BSA = Mad Software Producents Desease
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> 
http://lists.squid-cache.org/listinfo/squid-users


 
-- 
Regards, 

Robert K Wild.
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> 
http://lists.squid-cache.org/listinfo/squid-users


-- 
Regards, 

Robert K Wild.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220802/1b261564/attachment.htm>

From robertkwild at gmail.com  Tue Aug  2 12:14:58 2022
From: robertkwild at gmail.com (robert k Wild)
Date: Tue, 2 Aug 2022 13:14:58 +0100
Subject: [squid-users] regex for normal websites
In-Reply-To: <003801d8a668$190139f0$4b03add0$@gmail.com>
References: <CAGU_CiJimq7-co9QCVT1+-NF8Y_V4pECVRiow_eOhh=rfXHK6g@mail.gmail.com>
 <YuEN+aHq7/a1DVVh@fantomas.sk>
 <CAGU_CiJb9rfGdwLVoR0n8VE+vuJFtQwGu3v2HvGBW3i+uBQbGA@mail.gmail.com>
 <008601d8a251$a482dd00$ed889700$@gmail.com>
 <CAGU_CiJ7yG_MejWPTn4Ax6prcsP8fhJ6G9WDL4+9NwBfmoOEkQ@mail.gmail.com>
 <003801d8a668$190139f0$4b03add0$@gmail.com>
Message-ID: <CAGU_CiL1g4u4mOFfrKqOF=G+tOFfzNTJcx6FuSD2sf93+7z-qw@mail.gmail.com>

ok i have tested and this works

adobe\.com$

i found it weird this didnt work

\.adobe\.com

just curious thats all

On Tue, 2 Aug 2022 at 13:05, <ngtech1ltd at gmail.com> wrote:

> I believe it should have been:
>
> ^adobe\.com$
>
> ^.*\.adobe\.com$
>
> ^\*\.adobe\.com$
>
>
>
> But I don?t know the code to this depth.
>
> If I would have written the match I think it would have been something a
> bit different.
>
>    - A match for SNI
>    - A joker match for SAN ie *.adobe.com SAN should catch both
>    www.www.adobe.com
>
>
>
> But for some reason it?s not like that, I assume the browsers and the
> libraries doesn?t implement it for an unknown reason.
>
>
>
> If Alex or anyone else from Factory knows the details of the ACL they can
> answer more then me.
>
>
>
> Thanks,
>
> Eliezer
>
>
>
> ----
>
> Eliezer Croitoru
>
> NgTech, Tech Support
>
> Mobile: +972-5-28704261
>
> Email: ngtech1ltd at gmail.com
>
> Web: https://ngtech.co.il/
>
> My-Tube: https://tube.ngtech.co.il/
>
>
>
> *From:* robert k Wild <robertkwild at gmail.com>
> *Sent:* Tuesday, 2 August 2022 14:51
> *To:* Eliezer Croitoru <ngtech1ltd at gmail.com>
> *Cc:* Squid Users <squid-users at lists.squid-cache.org>
> *Subject:* Re: [squid-users] regex for normal websites
>
>
>
> thanks Eliezer
>
>
>
> so it should be
>
>
>
> adobe\.com
>
>
>
> not
>
>
>
> .adobe.\com or
>
>
>
> ^.*adobe.com
>
>
>
> as the ^.* could include
>
>
>
> blahadobe.com
>
>
>
>
>
>
>
> On Thu, 28 Jul 2022 at 08:14, <ngtech1ltd at gmail.com> wrote:
>
> Hey Robert,
>
>
>
> The docs at http://www.squid-cache.org/Doc/config/acl/  states:
>
>
>
>         acl aclname ssl::server_name_regex [-i] \.foo\.com ...
>
>           # regex matches server name obtained from various sources [fast]
>
>
>
> Which and I do not know exactly what it means but it will not work with a
> helper in most cases.
>
> I have found the in the git the next sources:
>
>
> https://github.com/squid-cache/squid/blob/bf95c10aa95bf8e56d9d8d1545cb5a3aafab0d2c/doc/release-notes/release-3.5.sgml#L414
>
>
>
>                 New types ssl::server_name  and ssl::server_name_regex
>
>                    to match server name from various sources (CONNECT
> authority name,
>
>                    TLS SNI domain, or X.509 certificate Subject Name).
>
>
>
> Which means that there is a set of checks which the acl does and not just
> a domain name.
>
> It?s also even possible that the domain name is not know in the CONNECT
> state of the connection.
>
> If I remember correctly there is a possibility for browsers to use the
> same exact connection for multiple domains but
> I have not seen this yet in production.
>
> With Squid once you bump the connection to HTTP/1.x you can make 100% sure
> the features of the Host header request.
>
>
>
> At Servername.cc ie:
>
>
> https://github.com/squid-cache/squid/blob/aee3523a768aff4d1e6c1195c4a401b4ef5688a0/src/acl/ServerName.cc#L81
>
>
>
> There is a specific logic of what is done and what is matched but I am not
> sure what would be used in the case of:
>
> *.adobe.com
>
>
>
> Certificate SAN.
>
>
>
> Specifically This part of the Common Names ie SAN:
>
>
> https://github.com/squid-cache/squid/blob/aee3523a768aff4d1e6c1195c4a401b4ef5688a0/src/acl/ServerName.cc#L105
>
>
>
> which to my understanding points to:
>
>
> https://github.com/squid-cache/squid/blob/d146da3bfe7083381ae7ab38640cbfd0d2542374/src/ssl/support.cc#L195
>
>
>
> doesn?t make any sense to me.( didn?t tried that much to understand)
>
>
>
> If someone might be able to make sense of things in a synchronic fashion
> it would help.
>
> (I do not see any debugs usage there or any helping comment )
>
>
>
> Thanks,
>
> Eliezer
>
>
>
> ----
>
> Eliezer Croitoru
>
> NgTech, Tech Support
>
> Mobile: +972-5-28704261
>
> Email: ngtech1ltd at gmail.com
>
> Web: https://ngtech.co.il/
>
> My-Tube: https://tube.ngtech.co.il/
>
>
>
> *From:* squid-users <squid-users-bounces at lists.squid-cache.org> *On
> Behalf Of *robert k Wild
> *Sent:* Wednesday, 27 July 2022 13:52
> *To:* Squid Users <squid-users at lists.squid-cache.org>
> *Subject:* Re: [squid-users] regex for normal websites
>
>
>
> that's the weird thing, when i try this in  "ssl::server_name_regex"
>
> .adobe.com
>
>
>
> it doesnt work
>
>
>
> you mean escape ie the \ character
>
>
>
>
>
>
>
>
>
>
>
> On Wed, 27 Jul 2022 at 11:05, Matus UHLAR - fantomas <uhlar at fantomas.sk>
> wrote:
>
> On 27.07.22 10:54, robert k Wild wrote:
> >think i got it right but just want to double check with you guys
> >
> >so in my "ssl::server_name" i had
> >.adobe.com
> >
> >that worked but i want to mix normal website and regex websites together
> so
> >i just have one list for all
>
> didn't the above work?  AFAIK it should, IIRC domain matching in squid
> matches "domain.com" if you check for ".domain.com".
>
> >i now have this for "ssl::server_name_regex"
> >^.*adobe.com$
> >
> >it works, so im guessing its right
>
> the dot should be escaped
>
>
> --
> Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
> Warning: I wish NOT to receive e-mail advertising to this address.
> Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
> BSE = Mad Cow Desease ... BSA = Mad Software Producents Desease
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
>
>
>
> --
>
> Regards,
>
> Robert K Wild.
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
>
>
> --
>
> Regards,
>
> Robert K Wild.
>


-- 
Regards,

Robert K Wild.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220802/dad93d94/attachment.htm>

From ngtech1ltd at gmail.com  Tue Aug  2 12:17:27 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Tue, 2 Aug 2022 15:17:27 +0300
Subject: [squid-users] xcalloc error when installing squid in container
 on CentOS 9 host
In-Reply-To: <CA+Y8hcNOyy8voc=PNCd49XkC89iL9oHRCn=godG1ZKGtnRNNPA@mail.gmail.com>
References: <CAPg1V3XbDGGB1OBmM7uyW2g5Z_RzpKDy4FdhXeMAQnzN35rnZA@mail.gmail.com>
 <CA+Y8hcNOyy8voc=PNCd49XkC89iL9oHRCn=godG1ZKGtnRNNPA@mail.gmail.com>
Message-ID: <003d01d8a669$d58faf10$80af0d30$@gmail.com>

I will try to publish a CentOS 9 version later on to make sure it will work on a VM.
 
Thanks,
Eliezer
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> 
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/
 
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Francesco Chemolli
Sent: Tuesday, 2 August 2022 11:28
To: Frank Ansari <nabil1385 at gmail.com>
Cc: Squid Users <squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] xcalloc error when installing squid in container on CentOS 9 host
 
Hi Frank,
  could you share what does your configuration look like (minus any confidential bits)? And I assume you're running the version of squid packaged by the distros?
 
 
On Tue, Aug 2, 2022 at 9:22 AM Frank Ansari <nabil1385 at gmail.com <mailto:nabil1385 at gmail.com> > wrote:
Hi,
 
I have found a weird issue with CentOS 9.
 
So far I had squid running on a CentOS 8 system within an Alpine Linux Container and this has worked.
 
Now I installed CentOS 9 and also latest Alpine Linux with squid 5.5.
 
Squid refuses to start and when I run "squid -z" I get this error:
 
[root at 324ae7d5e4db /]# 2022/08/01 08:01:47| FATAL: xcalloc: Unable to allocate 1073741816 blocks of 432 bytes!

2022/08/01 08:01:47| Squid Cache (Version 5.5): Terminated abnormally. 
CPU Usage: 0.002 seconds = 0.000 user + 0.002 sys
Maximum Resident Size: 31744 KB
Page faults with physical i/o: 0
 
My question: has anybody the same issue? Why is squid asking for 432 GB?
 
This seems to have nothing to do with my squid.conf. Whatever I change there has no effect at all.
 
The CentOS 9 VM is running on Proxmox and has 4 GB RAM.
 
I also tried to install Debian 11 and Ubuntu 20 and 22 containers and similar errors.
 
My last try was to install a CentOS 9 conatiner on the CentOS 9 host and also this gives the same error.
 
I have now installed squid 5.5 directly on the OS but I still curios why it refuses to run in any kind of container.
 
 
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> 
http://lists.squid-cache.org/listinfo/squid-users


 
-- 
    Francesco
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220802/d64ffaf5/attachment.htm>

From uhlar at fantomas.sk  Tue Aug  2 12:18:10 2022
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Tue, 2 Aug 2022 14:18:10 +0200
Subject: [squid-users] regex for normal websites
In-Reply-To: <003801d8a668$190139f0$4b03add0$@gmail.com>
References: <CAGU_CiJimq7-co9QCVT1+-NF8Y_V4pECVRiow_eOhh=rfXHK6g@mail.gmail.com>
 <YuEN+aHq7/a1DVVh@fantomas.sk>
 <CAGU_CiJb9rfGdwLVoR0n8VE+vuJFtQwGu3v2HvGBW3i+uBQbGA@mail.gmail.com>
 <008601d8a251$a482dd00$ed889700$@gmail.com>
 <CAGU_CiJ7yG_MejWPTn4Ax6prcsP8fhJ6G9WDL4+9NwBfmoOEkQ@mail.gmail.com>
 <003801d8a668$190139f0$4b03add0$@gmail.com>
Message-ID: <YukWAgEsIvl3w/IJ@fantomas.sk>

On 02.08.22 15:05, ngtech1ltd at gmail.com wrote:
>I believe it should have been:
>^adobe\.com$
>^.*\.adobe\.com$

\.adobe\.com$ does the same and is more efficient

>^\*\.adobe\.com$

this is for literal "*.adobe.com" (noboty puts * into web browser), but it's 
covered by previous variand.


-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Spam = (S)tupid (P)eople's (A)dvertising (M)ethod


From Antony.Stone at squid.open.source.it  Tue Aug  2 12:18:05 2022
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Tue, 2 Aug 2022 14:18:05 +0200
Subject: [squid-users] regex for normal websites
In-Reply-To: <CAGU_CiL1g4u4mOFfrKqOF=G+tOFfzNTJcx6FuSD2sf93+7z-qw@mail.gmail.com>
References: <CAGU_CiJimq7-co9QCVT1+-NF8Y_V4pECVRiow_eOhh=rfXHK6g@mail.gmail.com>
 <003801d8a668$190139f0$4b03add0$@gmail.com>
 <CAGU_CiL1g4u4mOFfrKqOF=G+tOFfzNTJcx6FuSD2sf93+7z-qw@mail.gmail.com>
Message-ID: <202208021418.05293.Antony.Stone@squid.open.source.it>

On Tuesday 02 August 2022 at 14:14:58, robert k Wild wrote:

> ok i have tested and this works
> 
> adobe\.com$
> 
> i found it weird this didnt work
> 
> \.adobe\.com
> 
> just curious thats all

Please define "works" and "didn't work" - I've pretty much lost track of 
exactly what you want to match here :(


Antony.

> On Tue, 2 Aug 2022 at 13:05, <ngtech1ltd at gmail.com> wrote:
> > I believe it should have been:
> > 
> > ^adobe\.com$
> > 
> > ^.*\.adobe\.com$
> > 
> > ^\*\.adobe\.com$
> > 
> > 
> > 
> > But I don?t know the code to this depth.
> > 
> > If I would have written the match I think it would have been something a
> > bit different.
> > 
> >    - A match for SNI
> >    - A joker match for SAN ie *.adobe.com SAN should catch both
> >    www.www.adobe.com
> > 
> > But for some reason it?s not like that, I assume the browsers and the
> > libraries doesn?t implement it for an unknown reason.
> > 
> > 
> > 
> > If Alex or anyone else from Factory knows the details of the ACL they can
> > answer more then me.
> > 
> > 
> > 
> > Thanks,
> > 
> > Eliezer
> > 
> > 
> > 
> > ----
> > 
> > Eliezer Croitoru
> > 
> > NgTech, Tech Support
> > 
> > Mobile: +972-5-28704261
> > 
> > Email: ngtech1ltd at gmail.com
> > 
> > Web: https://ngtech.co.il/
> > 
> > My-Tube: https://tube.ngtech.co.il/
> > 
> > 
> > 
> > *From:* robert k Wild <robertkwild at gmail.com>
> > *Sent:* Tuesday, 2 August 2022 14:51
> > *To:* Eliezer Croitoru <ngtech1ltd at gmail.com>
> > *Cc:* Squid Users <squid-users at lists.squid-cache.org>
> > *Subject:* Re: [squid-users] regex for normal websites
> > 
> > 
> > 
> > thanks Eliezer
> > 
> > 
> > 
> > so it should be
> > 
> > 
> > 
> > adobe\.com
> > 
> > 
> > 
> > not
> > 
> > 
> > 
> > .adobe.\com or
> > 
> > 
> > 
> > ^.*adobe.com
> > 
> > 
> > 
> > as the ^.* could include
> > 
> > 
> > 
> > blahadobe.com
> > 
> > 
> > 
> > 
> > 
> > 
> > 
> > On Thu, 28 Jul 2022 at 08:14, <ngtech1ltd at gmail.com> wrote:
> > 
> > Hey Robert,
> > 
> > The docs at http://www.squid-cache.org/Doc/config/acl/  states:
> >         acl aclname ssl::server_name_regex [-i] \.foo\.com ...
> >         
> >           # regex matches server name obtained from various sources
> >           [fast]
> > 
> > Which and I do not know exactly what it means but it will not work with a
> > helper in most cases.
> > 
> > I have found the in the git the next sources:
> > 
> > 
> > https://github.com/squid-cache/squid/blob/bf95c10aa95bf8e56d9d8d1545cb5a3
> > aafab0d2c/doc/release-notes/release-3.5.sgml#L414
> > 
> >                 New types ssl::server_name  and ssl::server_name_regex
> >                 
> >                    to match server name from various sources (CONNECT
> > 
> > authority name,
> > 
> >                    TLS SNI domain, or X.509 certificate Subject Name).
> > 
> > Which means that there is a set of checks which the acl does and not just
> > a domain name.
> > 
> > It?s also even possible that the domain name is not know in the CONNECT
> > state of the connection.
> > 
> > If I remember correctly there is a possibility for browsers to use the
> > same exact connection for multiple domains but
> > I have not seen this yet in production.
> > 
> > With Squid once you bump the connection to HTTP/1.x you can make 100%
> > sure the features of the Host header request.
> > 
> > 
> > 
> > At Servername.cc ie:
> > 
> > 
> > https://github.com/squid-cache/squid/blob/aee3523a768aff4d1e6c1195c4a401b
> > 4ef5688a0/src/acl/ServerName.cc#L81
> > 
> > 
> > 
> > There is a specific logic of what is done and what is matched but I am
> > not sure what would be used in the case of:
> > 
> > *.adobe.com
> > 
> > 
> > 
> > Certificate SAN.
> > 
> > 
> > 
> > Specifically This part of the Common Names ie SAN:
> > 
> > 
> > https://github.com/squid-cache/squid/blob/aee3523a768aff4d1e6c1195c4a401b
> > 4ef5688a0/src/acl/ServerName.cc#L105
> > 
> > 
> > 
> > which to my understanding points to:
> > 
> > 
> > https://github.com/squid-cache/squid/blob/d146da3bfe7083381ae7ab38640cbfd
> > 0d2542374/src/ssl/support.cc#L195
> > 
> > 
> > 
> > doesn?t make any sense to me.( didn?t tried that much to understand)
> > 
> > 
> > 
> > If someone might be able to make sense of things in a synchronic fashion
> > it would help.
> > 
> > (I do not see any debugs usage there or any helping comment )
> > 
> > 
> > 
> > Thanks,
> > 
> > Eliezer
> > 
> > 
> > 
> > ----
> > 
> > Eliezer Croitoru
> > 
> > NgTech, Tech Support
> > 
> > Mobile: +972-5-28704261
> > 
> > Email: ngtech1ltd at gmail.com
> > 
> > Web: https://ngtech.co.il/
> > 
> > My-Tube: https://tube.ngtech.co.il/
> > 
> > 
> > 
> > *From:* squid-users <squid-users-bounces at lists.squid-cache.org> *On
> > Behalf Of *robert k Wild
> > *Sent:* Wednesday, 27 July 2022 13:52
> > *To:* Squid Users <squid-users at lists.squid-cache.org>
> > *Subject:* Re: [squid-users] regex for normal websites
> > 
> > 
> > 
> > that's the weird thing, when i try this in  "ssl::server_name_regex"
> > 
> > .adobe.com
> > 
> > 
> > 
> > it doesnt work
> > 
> > 
> > 
> > you mean escape ie the \ character
> > 
> > 
> > 
> > 
> > 
> > 
> > 
> > 
> > 
> > 
> > 
> > On Wed, 27 Jul 2022 at 11:05, Matus UHLAR - fantomas <uhlar at fantomas.sk>
> > wrote:
> > 
> > On 27.07.22 10:54, robert k Wild wrote:
> > >think i got it right but just want to double check with you guys
> > >
> > >so in my "ssl::server_name" i had
> > >.adobe.com
> > >
> > >that worked but i want to mix normal website and regex websites together
> > 
> > so
> > 
> > >i just have one list for all
> > 
> > didn't the above work?  AFAIK it should, IIRC domain matching in squid
> > matches "domain.com" if you check for ".domain.com".
> > 
> > >i now have this for "ssl::server_name_regex"
> > >^.*adobe.com$
> > >
> > >it works, so im guessing its right
> > 
> > the dot should be escaped
> > 
> > 
> > --
> > Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
> > Warning: I wish NOT to receive e-mail advertising to this address.
> > Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
> > BSE = Mad Cow Desease ... BSA = Mad Software Producents Desease
> > _______________________________________________
> > squid-users mailing list
> > squid-users at lists.squid-cache.org
> > http://lists.squid-cache.org/listinfo/squid-users
> > 
> > 
> > 
> > 
> > --
> > 
> > Regards,
> > 
> > Robert K Wild.
> > 
> > _______________________________________________
> > squid-users mailing list
> > squid-users at lists.squid-cache.org
> > http://lists.squid-cache.org/listinfo/squid-users
> > 
> > 
> > 
> > --
> > 
> > Regards,
> > 
> > Robert K Wild.


From ngtech1ltd at gmail.com  Tue Aug  2 12:32:47 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Tue, 2 Aug 2022 15:32:47 +0300
Subject: [squid-users] regex for normal websites
In-Reply-To: <YukWAgEsIvl3w/IJ@fantomas.sk>
References: <CAGU_CiJimq7-co9QCVT1+-NF8Y_V4pECVRiow_eOhh=rfXHK6g@mail.gmail.com>
 <YuEN+aHq7/a1DVVh@fantomas.sk>
 <CAGU_CiJb9rfGdwLVoR0n8VE+vuJFtQwGu3v2HvGBW3i+uBQbGA@mail.gmail.com>
 <008601d8a251$a482dd00$ed889700$@gmail.com>
 <CAGU_CiJ7yG_MejWPTn4Ax6prcsP8fhJ6G9WDL4+9NwBfmoOEkQ@mail.gmail.com>
 <003801d8a668$190139f0$4b03add0$@gmail.com> <YukWAgEsIvl3w/IJ@fantomas.sk>
Message-ID: <004401d8a66b$f95e2dc0$ec1a8940$@gmail.com>

Hey Matus,

The question is not matching the browser only by what the client asks for but also for..
The request a the lower levels.
The ACLS check (as I mentioned in the code snippets) also the certificate "Subject Alternative Name".
Due to and based on this, it's relevant for couple use cases.
For example, if I want to splice a star domain SAN but not a literal one.
There is a difference between regex and dstdomain by definition and indeed it's not documented enough to my taste.

Thanks,
Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Matus UHLAR - fantomas
Sent: Tuesday, 2 August 2022 15:18
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] regex for normal websites

On 02.08.22 15:05, ngtech1ltd at gmail.com wrote:
>I believe it should have been:
>^adobe\.com$
>^.*\.adobe\.com$

\.adobe\.com$ does the same and is more efficient

>^\*\.adobe\.com$

this is for literal "*.adobe.com" (noboty puts * into web browser), but it's 
covered by previous variand.


-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Spam = (S)tupid (P)eople's (A)dvertising (M)ethod
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From uhlar at fantomas.sk  Tue Aug  2 13:54:10 2022
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Tue, 2 Aug 2022 15:54:10 +0200
Subject: [squid-users] filedescriptors on debian/systemd
Message-ID: <YuksgqpS2bJjdfaV@fantomas.sk>

Hello,

I have encountered Debian bug 934208:

2022/07/28 16:40:53 kid1| With 1024 file descriptors available
2022/07/29 06:50:18 kid1| WARNING! Your cache is running out of filedescriptors

according to the bug report:

"Under systemd the default is not to have any limitation at all."

which seems not to be true, but:

Unfortunately there are still some bugs that needs to be straightened
out upstream for Squid to use the --with-filedescriptors value when
there is *no* specific upper limit provided by the OS.


limits when I log in (ssh or console) are 1024(soft) and 1048576 (hard) and 
yet squid starts with 1024 FDs.

I have configured:

# cat /etc/systemd/system/squid.service.d/override.conf
[Service]
LimitNOFILE=65536

and after reloading systemd:

# systemctl daemon-reload

and restart squid it seems to work properly:

2022/08/02 15:52:28 kid1| With 65536 file descriptors available


does anyone encounter this bug?
How do you fix it?

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
The early bird may get the worm, but the second mouse gets the cheese.


From ngtech1ltd at gmail.com  Tue Aug  2 14:21:22 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Tue, 2 Aug 2022 17:21:22 +0300
Subject: [squid-users] filedescriptors on debian/systemd
In-Reply-To: <YuksgqpS2bJjdfaV@fantomas.sk>
References: <YuksgqpS2bJjdfaV@fantomas.sk>
Message-ID: <004a01d8a67b$25431090$6fc931b0$@gmail.com>

Hey,

What's the bug exactly?
The design of systemd is to enforce the FD limit.
This is coming from the init 0 level of the design and due to this,
squid cannot "patch" the kernel at runtime like any other process.
The OS and systemd do not give any API to allow a request for"more FD".
I assume that these days it makes sense for a request from the kernel or
systemd to implement such a feature but I don't know if anyone have worked on this.

Thanks,
Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Matus UHLAR - fantomas
Sent: Tuesday, 2 August 2022 16:54
To: squid-users at lists.squid-cache.org
Subject: [squid-users] filedescriptors on debian/systemd

Hello,

I have encountered Debian bug 934208:

2022/07/28 16:40:53 kid1| With 1024 file descriptors available
2022/07/29 06:50:18 kid1| WARNING! Your cache is running out of filedescriptors

according to the bug report:

"Under systemd the default is not to have any limitation at all."

which seems not to be true, but:

Unfortunately there are still some bugs that needs to be straightened
out upstream for Squid to use the --with-filedescriptors value when
there is *no* specific upper limit provided by the OS.


limits when I log in (ssh or console) are 1024(soft) and 1048576 (hard) and 
yet squid starts with 1024 FDs.

I have configured:

# cat /etc/systemd/system/squid.service.d/override.conf
[Service]
LimitNOFILE=65536

and after reloading systemd:

# systemctl daemon-reload

and restart squid it seems to work properly:

2022/08/02 15:52:28 kid1| With 65536 file descriptors available


does anyone encounter this bug?
How do you fix it?

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
The early bird may get the worm, but the second mouse gets the cheese.
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From ngtech1ltd at gmail.com  Tue Aug  2 14:27:02 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Tue, 2 Aug 2022 17:27:02 +0300
Subject: [squid-users] regex for normal websites
In-Reply-To: <CAGU_CiL1g4u4mOFfrKqOF=G+tOFfzNTJcx6FuSD2sf93+7z-qw@mail.gmail.com>
References: <CAGU_CiJimq7-co9QCVT1+-NF8Y_V4pECVRiow_eOhh=rfXHK6g@mail.gmail.com>
 <YuEN+aHq7/a1DVVh@fantomas.sk>
 <CAGU_CiJb9rfGdwLVoR0n8VE+vuJFtQwGu3v2HvGBW3i+uBQbGA@mail.gmail.com>
 <008601d8a251$a482dd00$ed889700$@gmail.com>
 <CAGU_CiJ7yG_MejWPTn4Ax6prcsP8fhJ6G9WDL4+9NwBfmoOEkQ@mail.gmail.com>
 <003801d8a668$190139f0$4b03add0$@gmail.com>
 <CAGU_CiL1g4u4mOFfrKqOF=G+tOFfzNTJcx6FuSD2sf93+7z-qw@mail.gmail.com>
Message-ID: <004f01d8a67b$ef6e4880$ce4ad980$@gmail.com>

Hey Robert,
 
I will test this with latest squid and my Apps helper and will verify.
 
Thanks,
Eliezer
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> 
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/
 
From: robert k Wild <robertkwild at gmail.com> 
Sent: Tuesday, 2 August 2022 15:15
To: Eliezer Croitoru <ngtech1ltd at gmail.com>
Cc: Squid Users <squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] regex for normal websites
 
ok i have tested and this works
 
adobe\.com$
 
i found it weird this didnt work
 
\.adobe\.com
 
just curious thats all
 
On Tue, 2 Aug 2022 at 13:05, <ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> > wrote:
I believe it should have been:
^adobe\.com$
^.*\.adobe\.com$
^\*\.adobe\.com$
 
But I don?t know the code to this depth.
If I would have written the match I think it would have been something a bit different.
*	A match for SNI
*	A joker match for SAN ie *.adobe.com <http://adobe.com>  SAN should catch both www.www.adobe.com <http://www.www.adobe.com> 
 
But for some reason it?s not like that, I assume the browsers and the libraries doesn?t implement it for an unknown reason.
 
If Alex or anyone else from Factory knows the details of the ACL they can answer more then me.
 
Thanks,
Eliezer
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> 
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/
 
From: robert k Wild <robertkwild at gmail.com <mailto:robertkwild at gmail.com> > 
Sent: Tuesday, 2 August 2022 14:51
To: Eliezer Croitoru <ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> >
Cc: Squid Users <squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> >
Subject: Re: [squid-users] regex for normal websites
 
thanks Eliezer
 
so it should be
 
adobe\.com
 
not
 
.adobe.\com or
 
^.*adobe.com <http://adobe.com> 
 
as the ^.* could include
 
blahadobe.com <http://blahadobe.com> 
 
 
 
On Thu, 28 Jul 2022 at 08:14, <ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> > wrote:
Hey Robert,
 
The docs at http://www.squid-cache.org/Doc/config/acl/  states:
 
        acl aclname ssl::server_name_regex [-i] \.foo\.com ...
          # regex matches server name obtained from various sources [fast]
 
Which and I do not know exactly what it means but it will not work with a helper in most cases.
I have found the in the git the next sources:
https://github.com/squid-cache/squid/blob/bf95c10aa95bf8e56d9d8d1545cb5a3aafab0d2c/doc/release-notes/release-3.5.sgml#L414
 
                New types ssl::server_name  and ssl::server_name_regex
                   to match server name from various sources (CONNECT authority name,
                   TLS SNI domain, or X.509 certificate Subject Name).
 
Which means that there is a set of checks which the acl does and not just a domain name.
It?s also even possible that the domain name is not know in the CONNECT state of the connection.
If I remember correctly there is a possibility for browsers to use the same exact connection for multiple domains but
I have not seen this yet in production.
With Squid once you bump the connection to HTTP/1.x you can make 100% sure the features of the Host header request.
 
At Servername.cc ie:
https://github.com/squid-cache/squid/blob/aee3523a768aff4d1e6c1195c4a401b4ef5688a0/src/acl/ServerName.cc#L81 
 
There is a specific logic of what is done and what is matched but I am not sure what would be used in the case of:
*.adobe.com <http://adobe.com> 
 
Certificate SAN.
 
Specifically This part of the Common Names ie SAN:
https://github.com/squid-cache/squid/blob/aee3523a768aff4d1e6c1195c4a401b4ef5688a0/src/acl/ServerName.cc#L105
 
which to my understanding points to:
https://github.com/squid-cache/squid/blob/d146da3bfe7083381ae7ab38640cbfd0d2542374/src/ssl/support.cc#L195
 
doesn?t make any sense to me.( didn?t tried that much to understand)
 
If someone might be able to make sense of things in a synchronic fashion it would help.
(I do not see any debugs usage there or any helping comment )
 
Thanks,
Eliezer
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> 
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/
 
From: squid-users <squid-users-bounces at lists.squid-cache.org <mailto:squid-users-bounces at lists.squid-cache.org> > On Behalf Of robert k Wild
Sent: Wednesday, 27 July 2022 13:52
To: Squid Users <squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> >
Subject: Re: [squid-users] regex for normal websites
 
that's the weird thing, when i try this in  "ssl::server_name_regex"
.adobe.com <http://adobe.com> 
 
it doesnt work
 
you mean escape ie the \ character
 
 
 
 
 
On Wed, 27 Jul 2022 at 11:05, Matus UHLAR - fantomas <uhlar at fantomas.sk <mailto:uhlar at fantomas.sk> > wrote:
On 27.07.22 10:54, robert k Wild wrote:
>think i got it right but just want to double check with you guys
>
>so in my "ssl::server_name" i had
>.adobe.com <http://adobe.com> 
>
>that worked but i want to mix normal website and regex websites together so
>i just have one list for all

didn't the above work?  AFAIK it should, IIRC domain matching in squid 
matches "domain.com <http://domain.com> " if you check for ".domain.com <http://domain.com> ".

>i now have this for "ssl::server_name_regex"
>^.*adobe.com <http://adobe.com> $
>
>it works, so im guessing its right

the dot should be escaped


-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk <mailto:uhlar at fantomas.sk>  ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
BSE = Mad Cow Desease ... BSA = Mad Software Producents Desease
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> 
http://lists.squid-cache.org/listinfo/squid-users


 
-- 
Regards, 

Robert K Wild.
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> 
http://lists.squid-cache.org/listinfo/squid-users


-- 
Regards, 

Robert K Wild.


 
-- 
Regards, 

Robert K Wild.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220802/ae725a81/attachment.htm>

From robertkwild at gmail.com  Tue Aug  2 15:23:51 2022
From: robertkwild at gmail.com (robert k Wild)
Date: Tue, 2 Aug 2022 16:23:51 +0100
Subject: [squid-users] regex for normal websites
In-Reply-To: <004f01d8a67b$ef6e4880$ce4ad980$@gmail.com>
References: <CAGU_CiJimq7-co9QCVT1+-NF8Y_V4pECVRiow_eOhh=rfXHK6g@mail.gmail.com>
 <YuEN+aHq7/a1DVVh@fantomas.sk>
 <CAGU_CiJb9rfGdwLVoR0n8VE+vuJFtQwGu3v2HvGBW3i+uBQbGA@mail.gmail.com>
 <008601d8a251$a482dd00$ed889700$@gmail.com>
 <CAGU_CiJ7yG_MejWPTn4Ax6prcsP8fhJ6G9WDL4+9NwBfmoOEkQ@mail.gmail.com>
 <003801d8a668$190139f0$4b03add0$@gmail.com>
 <CAGU_CiL1g4u4mOFfrKqOF=G+tOFfzNTJcx6FuSD2sf93+7z-qw@mail.gmail.com>
 <004f01d8a67b$ef6e4880$ce4ad980$@gmail.com>
Message-ID: <CAGU_CiJ9n1c8FjVxOMtaqERTScyGBBWa_Y-z+k3dL3ooppfZPw@mail.gmail.com>

mmm... so i just want to know and really sorry for the dumb question, so

adobe\.com$

works but then again if a website was eg

hackadobe\.com$

that would work as well probably, so i want to do something like this

\.adobe\.com$

ie put a dot . infront of adobe so

www.adobe.com or
account.adobe.com

would work but then

hackadobe\.com$

would no longer work




On Tue, 2 Aug 2022 at 15:27, <ngtech1ltd at gmail.com> wrote:

> Hey Robert,
>
>
>
> I will test this with latest squid and my Apps helper and will verify.
>
>
>
> Thanks,
>
> Eliezer
>
>
>
> ----
>
> Eliezer Croitoru
>
> NgTech, Tech Support
>
> Mobile: +972-5-28704261
>
> Email: ngtech1ltd at gmail.com
>
> Web: https://ngtech.co.il/
>
> My-Tube: https://tube.ngtech.co.il/
>
>
>
> *From:* robert k Wild <robertkwild at gmail.com>
> *Sent:* Tuesday, 2 August 2022 15:15
> *To:* Eliezer Croitoru <ngtech1ltd at gmail.com>
> *Cc:* Squid Users <squid-users at lists.squid-cache.org>
> *Subject:* Re: [squid-users] regex for normal websites
>
>
>
> ok i have tested and this works
>
>
>
> adobe\.com$
>
>
>
> i found it weird this didnt work
>
>
>
> \.adobe\.com
>
>
>
> just curious thats all
>
>
>
> On Tue, 2 Aug 2022 at 13:05, <ngtech1ltd at gmail.com> wrote:
>
> I believe it should have been:
>
> ^adobe\.com$
>
> ^.*\.adobe\.com$
>
> ^\*\.adobe\.com$
>
>
>
> But I don?t know the code to this depth.
>
> If I would have written the match I think it would have been something a
> bit different.
>
>    - A match for SNI
>    - A joker match for SAN ie *.adobe.com SAN should catch both
>    www.www.adobe.com
>
>
>
> But for some reason it?s not like that, I assume the browsers and the
> libraries doesn?t implement it for an unknown reason.
>
>
>
> If Alex or anyone else from Factory knows the details of the ACL they can
> answer more then me.
>
>
>
> Thanks,
>
> Eliezer
>
>
>
> ----
>
> Eliezer Croitoru
>
> NgTech, Tech Support
>
> Mobile: +972-5-28704261
>
> Email: ngtech1ltd at gmail.com
>
> Web: https://ngtech.co.il/
>
> My-Tube: https://tube.ngtech.co.il/
>
>
>
> *From:* robert k Wild <robertkwild at gmail.com>
> *Sent:* Tuesday, 2 August 2022 14:51
> *To:* Eliezer Croitoru <ngtech1ltd at gmail.com>
> *Cc:* Squid Users <squid-users at lists.squid-cache.org>
> *Subject:* Re: [squid-users] regex for normal websites
>
>
>
> thanks Eliezer
>
>
>
> so it should be
>
>
>
> adobe\.com
>
>
>
> not
>
>
>
> .adobe.\com or
>
>
>
> ^.*adobe.com
>
>
>
> as the ^.* could include
>
>
>
> blahadobe.com
>
>
>
>
>
>
>
> On Thu, 28 Jul 2022 at 08:14, <ngtech1ltd at gmail.com> wrote:
>
> Hey Robert,
>
>
>
> The docs at http://www.squid-cache.org/Doc/config/acl/  states:
>
>
>
>         acl aclname ssl::server_name_regex [-i] \.foo\.com ...
>
>           # regex matches server name obtained from various sources [fast]
>
>
>
> Which and I do not know exactly what it means but it will not work with a
> helper in most cases.
>
> I have found the in the git the next sources:
>
>
> https://github.com/squid-cache/squid/blob/bf95c10aa95bf8e56d9d8d1545cb5a3aafab0d2c/doc/release-notes/release-3.5.sgml#L414
>
>
>
>                 New types ssl::server_name  and ssl::server_name_regex
>
>                    to match server name from various sources (CONNECT
> authority name,
>
>                    TLS SNI domain, or X.509 certificate Subject Name).
>
>
>
> Which means that there is a set of checks which the acl does and not just
> a domain name.
>
> It?s also even possible that the domain name is not know in the CONNECT
> state of the connection.
>
> If I remember correctly there is a possibility for browsers to use the
> same exact connection for multiple domains but
> I have not seen this yet in production.
>
> With Squid once you bump the connection to HTTP/1.x you can make 100% sure
> the features of the Host header request.
>
>
>
> At Servername.cc ie:
>
>
> https://github.com/squid-cache/squid/blob/aee3523a768aff4d1e6c1195c4a401b4ef5688a0/src/acl/ServerName.cc#L81
>
>
>
> There is a specific logic of what is done and what is matched but I am not
> sure what would be used in the case of:
>
> *.adobe.com
>
>
>
> Certificate SAN.
>
>
>
> Specifically This part of the Common Names ie SAN:
>
>
> https://github.com/squid-cache/squid/blob/aee3523a768aff4d1e6c1195c4a401b4ef5688a0/src/acl/ServerName.cc#L105
>
>
>
> which to my understanding points to:
>
>
> https://github.com/squid-cache/squid/blob/d146da3bfe7083381ae7ab38640cbfd0d2542374/src/ssl/support.cc#L195
>
>
>
> doesn?t make any sense to me.( didn?t tried that much to understand)
>
>
>
> If someone might be able to make sense of things in a synchronic fashion
> it would help.
>
> (I do not see any debugs usage there or any helping comment )
>
>
>
> Thanks,
>
> Eliezer
>
>
>
> ----
>
> Eliezer Croitoru
>
> NgTech, Tech Support
>
> Mobile: +972-5-28704261
>
> Email: ngtech1ltd at gmail.com
>
> Web: https://ngtech.co.il/
>
> My-Tube: https://tube.ngtech.co.il/
>
>
>
> *From:* squid-users <squid-users-bounces at lists.squid-cache.org> *On
> Behalf Of *robert k Wild
> *Sent:* Wednesday, 27 July 2022 13:52
> *To:* Squid Users <squid-users at lists.squid-cache.org>
> *Subject:* Re: [squid-users] regex for normal websites
>
>
>
> that's the weird thing, when i try this in  "ssl::server_name_regex"
>
> .adobe.com
>
>
>
> it doesnt work
>
>
>
> you mean escape ie the \ character
>
>
>
>
>
>
>
>
>
>
>
> On Wed, 27 Jul 2022 at 11:05, Matus UHLAR - fantomas <uhlar at fantomas.sk>
> wrote:
>
> On 27.07.22 10:54, robert k Wild wrote:
> >think i got it right but just want to double check with you guys
> >
> >so in my "ssl::server_name" i had
> >.adobe.com
> >
> >that worked but i want to mix normal website and regex websites together
> so
> >i just have one list for all
>
> didn't the above work?  AFAIK it should, IIRC domain matching in squid
> matches "domain.com" if you check for ".domain.com".
>
> >i now have this for "ssl::server_name_regex"
> >^.*adobe.com$
> >
> >it works, so im guessing its right
>
> the dot should be escaped
>
>
> --
> Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
> Warning: I wish NOT to receive e-mail advertising to this address.
> Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
> BSE = Mad Cow Desease ... BSA = Mad Software Producents Desease
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
>
>
>
> --
>
> Regards,
>
> Robert K Wild.
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
>
>
> --
>
> Regards,
>
> Robert K Wild.
>
>
>
>
> --
>
> Regards,
>
> Robert K Wild.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>


-- 
Regards,

Robert K Wild.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220802/38a36559/attachment.htm>

From Antony.Stone at squid.open.source.it  Tue Aug  2 15:32:14 2022
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Tue, 2 Aug 2022 17:32:14 +0200
Subject: [squid-users] regex for normal websites
In-Reply-To: <CAGU_CiJ9n1c8FjVxOMtaqERTScyGBBWa_Y-z+k3dL3ooppfZPw@mail.gmail.com>
References: <CAGU_CiJimq7-co9QCVT1+-NF8Y_V4pECVRiow_eOhh=rfXHK6g@mail.gmail.com>
 <004f01d8a67b$ef6e4880$ce4ad980$@gmail.com>
 <CAGU_CiJ9n1c8FjVxOMtaqERTScyGBBWa_Y-z+k3dL3ooppfZPw@mail.gmail.com>
Message-ID: <202208021732.14822.Antony.Stone@squid.open.source.it>

On Tuesday 02 August 2022 at 17:23:51, robert k Wild wrote:

> mmm... so i just want to know and really sorry for the dumb question, so
> 
> adobe\.com$
> 
> works but then again if a website was eg
> 
> hackadobe\.com$
> 
> that would work as well probably, so i want to do something like this
> 
> \.adobe\.com$
> 
> ie put a dot . infront of adobe so
> 
> www.adobe.com or
> account.adobe.com
> 
> would work but then
> 
> hackadobe\.com$
> 
> would no longer work

... and neither would plain "adobe.com", missing the leading dot.


Antony.

-- 
All generalisations are inaccurate.

                                                   Please reply to the list;
                                                         please *don't* CC me.


From robertkwild at gmail.com  Tue Aug  2 15:41:04 2022
From: robertkwild at gmail.com (robert k Wild)
Date: Tue, 2 Aug 2022 16:41:04 +0100
Subject: [squid-users] regex for normal websites
In-Reply-To: <202208021732.14822.Antony.Stone@squid.open.source.it>
References: <CAGU_CiJimq7-co9QCVT1+-NF8Y_V4pECVRiow_eOhh=rfXHK6g@mail.gmail.com>
 <004f01d8a67b$ef6e4880$ce4ad980$@gmail.com>
 <CAGU_CiJ9n1c8FjVxOMtaqERTScyGBBWa_Y-z+k3dL3ooppfZPw@mail.gmail.com>
 <202208021732.14822.Antony.Stone@squid.open.source.it>
Message-ID: <CAGU_Ci+8JNHWRS3Nx_OA1hCHtypj5-jW14T6QET_N=0QpO_CYA@mail.gmail.com>

thats incorrect as

adobe\.com$ works but

.adobe\.com$ or
\.adobe\.com$

doesnt work so i just want to know why

On Tue, 2 Aug 2022 at 16:32, Antony Stone <Antony.Stone at squid.open.source.it>
wrote:

> On Tuesday 02 August 2022 at 17:23:51, robert k Wild wrote:
>
> > mmm... so i just want to know and really sorry for the dumb question, so
> >
> > adobe\.com$
> >
> > works but then again if a website was eg
> >
> > hackadobe\.com$
> >
> > that would work as well probably, so i want to do something like this
> >
> > \.adobe\.com$
> >
> > ie put a dot . infront of adobe so
> >
> > www.adobe.com or
> > account.adobe.com
> >
> > would work but then
> >
> > hackadobe\.com$
> >
> > would no longer work
>
> ... and neither would plain "adobe.com", missing the leading dot.
>
>
> Antony.
>
> --
> All generalisations are inaccurate.
>
>                                                    Please reply to the
> list;
>                                                          please *don't* CC
> me.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>


-- 
Regards,

Robert K Wild.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220802/524daade/attachment.htm>

From robertkwild at gmail.com  Tue Aug  2 15:43:04 2022
From: robertkwild at gmail.com (robert k Wild)
Date: Tue, 2 Aug 2022 16:43:04 +0100
Subject: [squid-users] regex for normal websites
In-Reply-To: <005901d8a686$5f933120$1eb99360$@gmail.com>
References: <CAGU_CiJimq7-co9QCVT1+-NF8Y_V4pECVRiow_eOhh=rfXHK6g@mail.gmail.com>
 <YuEN+aHq7/a1DVVh@fantomas.sk>
 <CAGU_CiJb9rfGdwLVoR0n8VE+vuJFtQwGu3v2HvGBW3i+uBQbGA@mail.gmail.com>
 <008601d8a251$a482dd00$ed889700$@gmail.com>
 <CAGU_CiJ7yG_MejWPTn4Ax6prcsP8fhJ6G9WDL4+9NwBfmoOEkQ@mail.gmail.com>
 <003801d8a668$190139f0$4b03add0$@gmail.com>
 <CAGU_CiL1g4u4mOFfrKqOF=G+tOFfzNTJcx6FuSD2sf93+7z-qw@mail.gmail.com>
 <004f01d8a67b$ef6e4880$ce4ad980$@gmail.com>
 <CAGU_CiJ9n1c8FjVxOMtaqERTScyGBBWa_Y-z+k3dL3ooppfZPw@mail.gmail.com>
 <005901d8a686$5f933120$1eb99360$@gmail.com>
Message-ID: <CAGU_CiJa3ODvZWS-nuurnrszS5V-Og-Mud=6_w87wwC5YKFtrg@mail.gmail.com>

no problem  Eliezer

im just doing few test of my own on this to see why

On Tue, 2 Aug 2022 at 16:41, <ngtech1ltd at gmail.com> wrote:

> Hey Robert,
>
>
>
> It?s not a dumb question.
>
> It?s a really fine question.
>
> I want to answer to your question but I have couple obligations.
>
> If you are willing to wait couple days I will probably be much free and
> will be able to sit and understand what the answer and then to answer
> properly.
>
>
>
> For a great question deserves a great answer.
>
>
>
> Yours,
>
> Eliezer
>
>
>
> ----
>
> Eliezer Croitoru
>
> NgTech, Tech Support
>
> Mobile: +972-5-28704261
>
> Email: ngtech1ltd at gmail.com
>
> Web: https://ngtech.co.il/
>
> My-Tube: https://tube.ngtech.co.il/
>
>
>
> *From:* robert k Wild <robertkwild at gmail.com>
> *Sent:* Tuesday, 2 August 2022 18:24
> *To:* Eliezer Croitoru <ngtech1ltd at gmail.com>
> *Cc:* Squid Users <squid-users at lists.squid-cache.org>
> *Subject:* Re: [squid-users] regex for normal websites
>
>
>
> mmm... so i just want to know and really sorry for the dumb question, so
>
>
>
> adobe\.com$
>
>
>
> works but then again if a website was eg
>
>
>
> hackadobe\.com$
>
>
>
> that would work as well probably, so i want to do something like this
>
>
>
> \.adobe\.com$
>
>
>
> ie put a dot . infront of adobe so
>
>
>
> www.adobe.com or
>
> account.adobe.com
>
>
>
> would work but then
>
>
>
> hackadobe\.com$
>
>
>
> would no longer work
>
>
>
>
>
>
>
>
>
> On Tue, 2 Aug 2022 at 15:27, <ngtech1ltd at gmail.com> wrote:
>
> Hey Robert,
>
>
>
> I will test this with latest squid and my Apps helper and will verify.
>
>
>
> Thanks,
>
> Eliezer
>
>
>
> ----
>
> Eliezer Croitoru
>
> NgTech, Tech Support
>
> Mobile: +972-5-28704261
>
> Email: ngtech1ltd at gmail.com
>
> Web: https://ngtech.co.il/
>
> My-Tube: https://tube.ngtech.co.il/
>
>
>
> *From:* robert k Wild <robertkwild at gmail.com>
> *Sent:* Tuesday, 2 August 2022 15:15
> *To:* Eliezer Croitoru <ngtech1ltd at gmail.com>
> *Cc:* Squid Users <squid-users at lists.squid-cache.org>
> *Subject:* Re: [squid-users] regex for normal websites
>
>
>
> ok i have tested and this works
>
>
>
> adobe\.com$
>
>
>
> i found it weird this didnt work
>
>
>
> \.adobe\.com
>
>
>
> just curious thats all
>
>
>
> On Tue, 2 Aug 2022 at 13:05, <ngtech1ltd at gmail.com> wrote:
>
> I believe it should have been:
>
> ^adobe\.com$
>
> ^.*\.adobe\.com$
>
> ^\*\.adobe\.com$
>
>
>
> But I don?t know the code to this depth.
>
> If I would have written the match I think it would have been something a
> bit different.
>
>    - A match for SNI
>    - A joker match for SAN ie *.adobe.com SAN should catch both
>    www.www.adobe.com
>
>
>
> But for some reason it?s not like that, I assume the browsers and the
> libraries doesn?t implement it for an unknown reason.
>
>
>
> If Alex or anyone else from Factory knows the details of the ACL they can
> answer more then me.
>
>
>
> Thanks,
>
> Eliezer
>
>
>
> ----
>
> Eliezer Croitoru
>
> NgTech, Tech Support
>
> Mobile: +972-5-28704261
>
> Email: ngtech1ltd at gmail.com
>
> Web: https://ngtech.co.il/
>
> My-Tube: https://tube.ngtech.co.il/
>
>
>
> *From:* robert k Wild <robertkwild at gmail.com>
> *Sent:* Tuesday, 2 August 2022 14:51
> *To:* Eliezer Croitoru <ngtech1ltd at gmail.com>
> *Cc:* Squid Users <squid-users at lists.squid-cache.org>
> *Subject:* Re: [squid-users] regex for normal websites
>
>
>
> thanks Eliezer
>
>
>
> so it should be
>
>
>
> adobe\.com
>
>
>
> not
>
>
>
> .adobe.\com or
>
>
>
> ^.*adobe.com
>
>
>
> as the ^.* could include
>
>
>
> blahadobe.com
>
>
>
>
>
>
>
> On Thu, 28 Jul 2022 at 08:14, <ngtech1ltd at gmail.com> wrote:
>
> Hey Robert,
>
>
>
> The docs at http://www.squid-cache.org/Doc/config/acl/  states:
>
>
>
>         acl aclname ssl::server_name_regex [-i] \.foo\.com ...
>
>           # regex matches server name obtained from various sources [fast]
>
>
>
> Which and I do not know exactly what it means but it will not work with a
> helper in most cases.
>
> I have found the in the git the next sources:
>
>
> https://github.com/squid-cache/squid/blob/bf95c10aa95bf8e56d9d8d1545cb5a3aafab0d2c/doc/release-notes/release-3.5.sgml#L414
>
>
>
>                 New types ssl::server_name  and ssl::server_name_regex
>
>                    to match server name from various sources (CONNECT
> authority name,
>
>                    TLS SNI domain, or X.509 certificate Subject Name).
>
>
>
> Which means that there is a set of checks which the acl does and not just
> a domain name.
>
> It?s also even possible that the domain name is not know in the CONNECT
> state of the connection.
>
> If I remember correctly there is a possibility for browsers to use the
> same exact connection for multiple domains but
> I have not seen this yet in production.
>
> With Squid once you bump the connection to HTTP/1.x you can make 100% sure
> the features of the Host header request.
>
>
>
> At Servername.cc ie:
>
>
> https://github.com/squid-cache/squid/blob/aee3523a768aff4d1e6c1195c4a401b4ef5688a0/src/acl/ServerName.cc#L81
>
>
>
> There is a specific logic of what is done and what is matched but I am not
> sure what would be used in the case of:
>
> *.adobe.com
>
>
>
> Certificate SAN.
>
>
>
> Specifically This part of the Common Names ie SAN:
>
>
> https://github.com/squid-cache/squid/blob/aee3523a768aff4d1e6c1195c4a401b4ef5688a0/src/acl/ServerName.cc#L105
>
>
>
> which to my understanding points to:
>
>
> https://github.com/squid-cache/squid/blob/d146da3bfe7083381ae7ab38640cbfd0d2542374/src/ssl/support.cc#L195
>
>
>
> doesn?t make any sense to me.( didn?t tried that much to understand)
>
>
>
> If someone might be able to make sense of things in a synchronic fashion
> it would help.
>
> (I do not see any debugs usage there or any helping comment )
>
>
>
> Thanks,
>
> Eliezer
>
>
>
> ----
>
> Eliezer Croitoru
>
> NgTech, Tech Support
>
> Mobile: +972-5-28704261
>
> Email: ngtech1ltd at gmail.com
>
> Web: https://ngtech.co.il/
>
> My-Tube: https://tube.ngtech.co.il/
>
>
>
> *From:* squid-users <squid-users-bounces at lists.squid-cache.org> *On
> Behalf Of *robert k Wild
> *Sent:* Wednesday, 27 July 2022 13:52
> *To:* Squid Users <squid-users at lists.squid-cache.org>
> *Subject:* Re: [squid-users] regex for normal websites
>
>
>
> that's the weird thing, when i try this in  "ssl::server_name_regex"
>
> .adobe.com
>
>
>
> it doesnt work
>
>
>
> you mean escape ie the \ character
>
>
>
>
>
>
>
>
>
>
>
> On Wed, 27 Jul 2022 at 11:05, Matus UHLAR - fantomas <uhlar at fantomas.sk>
> wrote:
>
> On 27.07.22 10:54, robert k Wild wrote:
> >think i got it right but just want to double check with you guys
> >
> >so in my "ssl::server_name" i had
> >.adobe.com
> >
> >that worked but i want to mix normal website and regex websites together
> so
> >i just have one list for all
>
> didn't the above work?  AFAIK it should, IIRC domain matching in squid
> matches "domain.com" if you check for ".domain.com".
>
> >i now have this for "ssl::server_name_regex"
> >^.*adobe.com$
> >
> >it works, so im guessing its right
>
> the dot should be escaped
>
>
> --
> Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
> Warning: I wish NOT to receive e-mail advertising to this address.
> Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
> BSE = Mad Cow Desease ... BSA = Mad Software Producents Desease
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
>
>
>
> --
>
> Regards,
>
> Robert K Wild.
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
>
>
> --
>
> Regards,
>
> Robert K Wild.
>
>
>
>
> --
>
> Regards,
>
> Robert K Wild.
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
>
>
>
> --
>
> Regards,
>
> Robert K Wild.
>


-- 
Regards,

Robert K Wild.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220802/062c9780/attachment.htm>

From uhlar at fantomas.sk  Tue Aug  2 16:21:14 2022
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Tue, 2 Aug 2022 18:21:14 +0200
Subject: [squid-users] regex for normal websites
In-Reply-To: <CAGU_Ci+8JNHWRS3Nx_OA1hCHtypj5-jW14T6QET_N=0QpO_CYA@mail.gmail.com>
References: <CAGU_CiJimq7-co9QCVT1+-NF8Y_V4pECVRiow_eOhh=rfXHK6g@mail.gmail.com>
 <004f01d8a67b$ef6e4880$ce4ad980$@gmail.com>
 <CAGU_CiJ9n1c8FjVxOMtaqERTScyGBBWa_Y-z+k3dL3ooppfZPw@mail.gmail.com>
 <202208021732.14822.Antony.Stone@squid.open.source.it>
 <CAGU_Ci+8JNHWRS3Nx_OA1hCHtypj5-jW14T6QET_N=0QpO_CYA@mail.gmail.com>
Message-ID: <YulO+tFla+o8gTiV@fantomas.sk>

On 02.08.22 16:41, robert k Wild wrote:
>thats incorrect as
>
>adobe\.com$ works but

it works for hackadobe.com too.

>.adobe\.com$ or
>\.adobe\.com$
>
>doesnt work so i just want to know why

these two don't match adobe.com.
the first marched hadobe.com, the seconda matches anything .adobe.com

so, again you must use:

^adobe\.com$
\.adobe\.com$

first will match "adobe.com", the second will match its subdomains.

again, from what I remember, using "dstdomain"  .adobe.com should match 
both (haven't tried), and I was hoping it should apply for ssl::servername 
(or how is that names).


>On Tue, 2 Aug 2022 at 16:32, Antony Stone <Antony.Stone at squid.open.source.it>
>wrote:
>
>> On Tuesday 02 August 2022 at 17:23:51, robert k Wild wrote:
>>
>> > mmm... so i just want to know and really sorry for the dumb question, so
>> >
>> > adobe\.com$
>> >
>> > works but then again if a website was eg
>> >
>> > hackadobe\.com$
>> >
>> > that would work as well probably, so i want to do something like this
>> >
>> > \.adobe\.com$
>> >
>> > ie put a dot . infront of adobe so
>> >
>> > www.adobe.com or
>> > account.adobe.com
>> >
>> > would work but then
>> >
>> > hackadobe\.com$
>> >
>> > would no longer work
>>
>> ... and neither would plain "adobe.com", missing the leading dot.

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
I don't have lysdexia. The Dog wouldn't allow that.


From uhlar at fantomas.sk  Tue Aug  2 16:23:38 2022
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Tue, 2 Aug 2022 18:23:38 +0200
Subject: [squid-users] filedescriptors on debian/systemd
In-Reply-To: <004a01d8a67b$25431090$6fc931b0$@gmail.com>
References: <YuksgqpS2bJjdfaV@fantomas.sk>
 <004a01d8a67b$25431090$6fc931b0$@gmail.com>
Message-ID: <YulPiicK1TqlA1p7@fantomas.sk>

On 02.08.22 17:21, ngtech1ltd at gmail.com wrote:
>What's the bug exactly?

only 1k of fildescriptors by default. Even if hard limit is 1M (at least for 
login)

debian sysvinit script has hack that sets 64k fd limit, systemd unit file 
doesn't have this hack.

>The design of systemd is to enforce the FD limit.
>This is coming from the init 0 level of the design and due to this,
>squid cannot "patch" the kernel at runtime like any other process.
>The OS and systemd do not give any API to allow a request for"more FD".
>I assume that these days it makes sense for a request from the kernel or
>systemd to implement such a feature but I don't know if anyone have worked on this.

afaik that process can raise its soft limit up to hard limit level.

squid seems not to do this and debian 11 systemd unit files has no setting 
of limit at all.


>-----Original Message-----
>From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Matus UHLAR - fantomas
>Sent: Tuesday, 2 August 2022 16:54
>To: squid-users at lists.squid-cache.org
>Subject: [squid-users] filedescriptors on debian/systemd
>
>Hello,
>
>I have encountered Debian bug 934208:
>
>2022/07/28 16:40:53 kid1| With 1024 file descriptors available
>2022/07/29 06:50:18 kid1| WARNING! Your cache is running out of filedescriptors
>
>according to the bug report:
>
>"Under systemd the default is not to have any limitation at all."
>
>which seems not to be true, but:
>
>Unfortunately there are still some bugs that needs to be straightened
>out upstream for Squid to use the --with-filedescriptors value when
>there is *no* specific upper limit provided by the OS.
>
>
>limits when I log in (ssh or console) are 1024(soft) and 1048576 (hard) and
>yet squid starts with 1024 FDs.
>
>I have configured:
>
># cat /etc/systemd/system/squid.service.d/override.conf
>[Service]
>LimitNOFILE=65536
>
>and after reloading systemd:
>
># systemctl daemon-reload
>
>and restart squid it seems to work properly:
>
>2022/08/02 15:52:28 kid1| With 65536 file descriptors available
>
>
>does anyone encounter this bug?
>How do you fix it?

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
The 3 biggets disasters: Hiroshima 45, Tschernobyl 86, Windows 95


From robertkwild at gmail.com  Tue Aug  2 17:01:15 2022
From: robertkwild at gmail.com (robert k Wild)
Date: Tue, 2 Aug 2022 18:01:15 +0100
Subject: [squid-users] regex for normal websites
In-Reply-To: <YulO+tFla+o8gTiV@fantomas.sk>
References: <CAGU_CiJimq7-co9QCVT1+-NF8Y_V4pECVRiow_eOhh=rfXHK6g@mail.gmail.com>
 <004f01d8a67b$ef6e4880$ce4ad980$@gmail.com>
 <CAGU_CiJ9n1c8FjVxOMtaqERTScyGBBWa_Y-z+k3dL3ooppfZPw@mail.gmail.com>
 <202208021732.14822.Antony.Stone@squid.open.source.it>
 <CAGU_Ci+8JNHWRS3Nx_OA1hCHtypj5-jW14T6QET_N=0QpO_CYA@mail.gmail.com>
 <YulO+tFla+o8gTiV@fantomas.sk>
Message-ID: <CAGU_CiJvc3DrwS-GLd5-2WwBo7V-K0E9muk3SbaXQG=hD=q=rA@mail.gmail.com>

Mmm, maybe I should try

dstdom_regex

Instead of

ssl::server_name_regex

But when you using ssl bump in your squid.conf, isn't it best to use

ssl::server_name_regex


On Tue, 2 Aug 2022, 17:21 Matus UHLAR - fantomas, <uhlar at fantomas.sk> wrote:

> On 02.08.22 16:41, robert k Wild wrote:
> >thats incorrect as
> >
> >adobe\.com$ works but
>
> it works for hackadobe.com too.
>
> >.adobe\.com$ or
> >\.adobe\.com$
> >
> >doesnt work so i just want to know why
>
> these two don't match adobe.com.
> the first marched hadobe.com, the seconda matches anything .adobe.com
>
> so, again you must use:
>
> ^adobe\.com$
> \.adobe\.com$
>
> first will match "adobe.com", the second will match its subdomains.
>
> again, from what I remember, using "dstdomain"  .adobe.com should match
> both (haven't tried), and I was hoping it should apply for ssl::servername
> (or how is that names).
>
>
> >On Tue, 2 Aug 2022 at 16:32, Antony Stone <
> Antony.Stone at squid.open.source.it>
> >wrote:
> >
> >> On Tuesday 02 August 2022 at 17:23:51, robert k Wild wrote:
> >>
> >> > mmm... so i just want to know and really sorry for the dumb question,
> so
> >> >
> >> > adobe\.com$
> >> >
> >> > works but then again if a website was eg
> >> >
> >> > hackadobe\.com$
> >> >
> >> > that would work as well probably, so i want to do something like this
> >> >
> >> > \.adobe\.com$
> >> >
> >> > ie put a dot . infront of adobe so
> >> >
> >> > www.adobe.com or
> >> > account.adobe.com
> >> >
> >> > would work but then
> >> >
> >> > hackadobe\.com$
> >> >
> >> > would no longer work
> >>
> >> ... and neither would plain "adobe.com", missing the leading dot.
>
> --
> Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
> Warning: I wish NOT to receive e-mail advertising to this address.
> Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
> I don't have lysdexia. The Dog wouldn't allow that.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220802/0b05baa3/attachment.htm>

From rousskov at measurement-factory.com  Tue Aug  2 17:18:17 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Tue, 2 Aug 2022 13:18:17 -0400
Subject: [squid-users] xcalloc error when installing squid in container
 on CentOS 9 host
In-Reply-To: <CAPg1V3XbDGGB1OBmM7uyW2g5Z_RzpKDy4FdhXeMAQnzN35rnZA@mail.gmail.com>
References: <CAPg1V3XbDGGB1OBmM7uyW2g5Z_RzpKDy4FdhXeMAQnzN35rnZA@mail.gmail.com>
Message-ID: <404816d3-f2be-87bf-b408-9e6a9d475bd4@measurement-factory.com>

On 8/2/22 04:22, Frank Ansari wrote:
> Hi,
> 
> I have found a weird issue with CentOS 9.
> 
> So far I had squid running on a CentOS 8 system within an Alpine Linux 
> Container and this has worked.
> 
> Now I installed CentOS 9 and also latest Alpine Linux with squid 5.5.
> 
> Squid refuses to start and when I run "squid -z" I get this error:
> 
> [root at 324ae7d5e4db /]# 2022/08/01 08:01:47| FATAL: xcalloc: Unable to 
> allocate 1073741816 blocks of 432 bytes!

Sounds like https://bugs.launchpad.net/ubuntu-docker-images/+bug/1978272

You may need to set max_filedescriptors or otherwise reconfigure your OS 
so that Squid does not try to allocate 1073741816 432-byte descriptor 
structures based on your current OS settings.

I do not know whether that allocation is a Squid bug (e.g., Squid is 
misinterpreting some negative "no limit" number as a positive 1073741816 
number).

Alex.


> 2022/08/01 08:01:47| Squid Cache (Version 5.5): Terminated abnormally.
> CPU Usage: 0.002 seconds = 0.000 user + 0.002 sys
> Maximum Resident Size: 31744 KB
> Page faults with physical i/o: 0
> 
> My question: has anybody the same issue? Why is squid asking for 432 GB?
> 
> This seems to have nothing to do with my squid.conf. Whatever I change 
> there has no effect at all.
> 
> The CentOS 9 VM is running on Proxmox and has 4 GB RAM.
> 
> I also tried to install Debian 11 and Ubuntu 20 and 22 containers and 
> similar errors.
> 
> My last try was to install a CentOS 9 conatiner on the CentOS 9 host and 
> also this gives the same error.
> 
> I have now installed squid 5.5 directly on the OS but I still curios why 
> it refuses to run in any kind of container.
> 
> 
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



From squid3 at treenet.co.nz  Wed Aug  3 02:09:57 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 3 Aug 2022 14:09:57 +1200
Subject: [squid-users] regex for normal websites
In-Reply-To: <CAGU_CiJvc3DrwS-GLd5-2WwBo7V-K0E9muk3SbaXQG=hD=q=rA@mail.gmail.com>
References: <CAGU_CiJimq7-co9QCVT1+-NF8Y_V4pECVRiow_eOhh=rfXHK6g@mail.gmail.com>
 <004f01d8a67b$ef6e4880$ce4ad980$@gmail.com>
 <CAGU_CiJ9n1c8FjVxOMtaqERTScyGBBWa_Y-z+k3dL3ooppfZPw@mail.gmail.com>
 <202208021732.14822.Antony.Stone@squid.open.source.it>
 <CAGU_Ci+8JNHWRS3Nx_OA1hCHtypj5-jW14T6QET_N=0QpO_CYA@mail.gmail.com>
 <YulO+tFla+o8gTiV@fantomas.sk>
 <CAGU_CiJvc3DrwS-GLd5-2WwBo7V-K0E9muk3SbaXQG=hD=q=rA@mail.gmail.com>
Message-ID: <116f7892-ae23-b146-c3d2-b313befcd635@treenet.co.nz>

On 3/08/22 05:01, robert k Wild wrote:
> Mmm, maybe I should try
> 
> dstdom_regex
> 
> Instead of
> 
> ssl::server_name_regex
> 
> But when you using ssl bump in your squid.conf, isn't it best to use
> 
> ssl::server_name_regex
> 

Typically yes, or ssl::server_name.


FYI, the two ACL types do exactly the same matching algorithm. They 
differ only in what detail from the traffic they match against:

  * dstdomain matches:
    - the domain found in HTTP request-target (aka URL or URI), or
    - the reverse-DNS hostname for a raw-IP found in HTTP request-target 
(aka URL or URI).

  * ssl::server_name matches whichever is available from (in order of 
preference):
    - the request-target URL domain from decrypted HTTP(S) message, or
    - the host name from SSL server certificate AltSubject, or
    - the host name from TLS SNI message, or
    - the domain from request-target URI of CONNECT request.

... in that order of preference for both.



HTH
Amos


From squid3 at treenet.co.nz  Wed Aug  3 02:12:28 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 3 Aug 2022 14:12:28 +1200
Subject: [squid-users] regex for normal websites
In-Reply-To: <CAGU_CiJvc3DrwS-GLd5-2WwBo7V-K0E9muk3SbaXQG=hD=q=rA@mail.gmail.com>
References: <CAGU_CiJimq7-co9QCVT1+-NF8Y_V4pECVRiow_eOhh=rfXHK6g@mail.gmail.com>
 <004f01d8a67b$ef6e4880$ce4ad980$@gmail.com>
 <CAGU_CiJ9n1c8FjVxOMtaqERTScyGBBWa_Y-z+k3dL3ooppfZPw@mail.gmail.com>
 <202208021732.14822.Antony.Stone@squid.open.source.it>
 <CAGU_Ci+8JNHWRS3Nx_OA1hCHtypj5-jW14T6QET_N=0QpO_CYA@mail.gmail.com>
 <YulO+tFla+o8gTiV@fantomas.sk>
 <CAGU_CiJvc3DrwS-GLd5-2WwBo7V-K0E9muk3SbaXQG=hD=q=rA@mail.gmail.com>
Message-ID: <6566b26b-41c4-6069-fa0b-084cae57011b@treenet.co.nz>


IMO, what you are looking for is actually this ACL definition:

  acl adobe ssl::server_name .adobe.com

or its regex equivalent,

  acl adobe ssl::server_name_regex (^|\.)adobe\.com$



HTH
Amos


From squid3 at treenet.co.nz  Wed Aug  3 02:31:00 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 3 Aug 2022 14:31:00 +1200
Subject: [squid-users] filedescriptors on debian/systemd
In-Reply-To: <YuksgqpS2bJjdfaV@fantomas.sk>
References: <YuksgqpS2bJjdfaV@fantomas.sk>
Message-ID: <41e10066-9035-9d50-3c00-2273937a8452@treenet.co.nz>

On 3/08/22 01:54, Matus UHLAR - fantomas wrote:
> Hello,
> 
> I have encountered Debian bug 934208:
> 
> 2022/07/28 16:40:53 kid1| With 1024 file descriptors available
> 2022/07/29 06:50:18 kid1| WARNING! Your cache is running out of 
> filedescriptors
> 
> according to the bug report:
> 
> "Under systemd the default is not to have any limitation at all."
> 

To clarify, what that means is that *systemd* does not impose any limit 
by default. Squid when it cannot find a limit sets 1024 as default.



Under systemd the "correct" way to set such a limit is for the admin to 
decide on a limit and configure it. You can do this is two ways:

  1) set the systemd local config like you did:

> 
> # cat /etc/systemd/system/squid.service.d/override.conf
> [Service]
> LimitNOFILE=65536
> 
> and after reloading systemd:
> 
> # systemctl daemon-reload
> 

or, 2)

   set max_filedescriptors in squid.conf


HTH
Amos


From ngtech1ltd at gmail.com  Wed Aug  3 05:17:21 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Wed, 3 Aug 2022 08:17:21 +0300
Subject: [squid-users] filedescriptors on debian/systemd
In-Reply-To: <41e10066-9035-9d50-3c00-2273937a8452@treenet.co.nz>
References: <YuksgqpS2bJjdfaV@fantomas.sk>
 <41e10066-9035-9d50-3c00-2273937a8452@treenet.co.nz>
Message-ID: <007501d8a6f8$50058970$f0109c50$@gmail.com>

Hey Amos,

I was under the impression that Systemd does impose a basic limit but I can test it to verify my doubts.
>From my point of view and testing until now systemd does impose a basic global limit.

Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Amos Jeffries
Sent: Wednesday, 3 August 2022 5:31
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] filedescriptors on debian/systemd

On 3/08/22 01:54, Matus UHLAR - fantomas wrote:
> Hello,
> 
> I have encountered Debian bug 934208:
> 
> 2022/07/28 16:40:53 kid1| With 1024 file descriptors available
> 2022/07/29 06:50:18 kid1| WARNING! Your cache is running out of 
> filedescriptors
> 
> according to the bug report:
> 
> "Under systemd the default is not to have any limitation at all."
> 

To clarify, what that means is that *systemd* does not impose any limit 
by default. Squid when it cannot find a limit sets 1024 as default.



Under systemd the "correct" way to set such a limit is for the admin to 
decide on a limit and configure it. You can do this is two ways:

  1) set the systemd local config like you did:

> 
> # cat /etc/systemd/system/squid.service.d/override.conf
> [Service]
> LimitNOFILE=65536
> 
> and after reloading systemd:
> 
> # systemctl daemon-reload
> 

or, 2)

   set max_filedescriptors in squid.conf


HTH
Amos
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From ngtech1ltd at gmail.com  Wed Aug  3 05:20:21 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Wed, 3 Aug 2022 08:20:21 +0300
Subject: [squid-users] regex for normal websites
In-Reply-To: <116f7892-ae23-b146-c3d2-b313befcd635@treenet.co.nz>
References: <CAGU_CiJimq7-co9QCVT1+-NF8Y_V4pECVRiow_eOhh=rfXHK6g@mail.gmail.com>
 <004f01d8a67b$ef6e4880$ce4ad980$@gmail.com>
 <CAGU_CiJ9n1c8FjVxOMtaqERTScyGBBWa_Y-z+k3dL3ooppfZPw@mail.gmail.com>
 <202208021732.14822.Antony.Stone@squid.open.source.it>
 <CAGU_Ci+8JNHWRS3Nx_OA1hCHtypj5-jW14T6QET_N=0QpO_CYA@mail.gmail.com>
 <YulO+tFla+o8gTiV@fantomas.sk>
 <CAGU_CiJvc3DrwS-GLd5-2WwBo7V-K0E9muk3SbaXQG=hD=q=rA@mail.gmail.com>
 <116f7892-ae23-b146-c3d2-b313befcd635@treenet.co.nz>
Message-ID: <007601d8a6f8$baf10ed0$30d32c70$@gmail.com>

Hey Amos,

And just to be clear:

ssl::server_name_regex has the same path as ssl::server_name ?
I have not read the code yet but it seems pretty obviates to me.

Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Amos Jeffries
Sent: Wednesday, 3 August 2022 5:10
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] regex for normal websites

On 3/08/22 05:01, robert k Wild wrote:
> Mmm, maybe I should try
> 
> dstdom_regex
> 
> Instead of
> 
> ssl::server_name_regex
> 
> But when you using ssl bump in your squid.conf, isn't it best to use
> 
> ssl::server_name_regex
> 

Typically yes, or ssl::server_name.


FYI, the two ACL types do exactly the same matching algorithm. They 
differ only in what detail from the traffic they match against:

  * dstdomain matches:
    - the domain found in HTTP request-target (aka URL or URI), or
    - the reverse-DNS hostname for a raw-IP found in HTTP request-target 
(aka URL or URI).

  * ssl::server_name matches whichever is available from (in order of 
preference):
    - the request-target URL domain from decrypted HTTP(S) message, or
    - the host name from SSL server certificate AltSubject, or
    - the host name from TLS SNI message, or
    - the domain from request-target URI of CONNECT request.

... in that order of preference for both.



HTH
Amos
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From uhlar at fantomas.sk  Wed Aug  3 08:35:36 2022
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Wed, 3 Aug 2022 10:35:36 +0200
Subject: [squid-users] regex for normal websites
In-Reply-To: <6566b26b-41c4-6069-fa0b-084cae57011b@treenet.co.nz>
References: <CAGU_CiJimq7-co9QCVT1+-NF8Y_V4pECVRiow_eOhh=rfXHK6g@mail.gmail.com>
 <004f01d8a67b$ef6e4880$ce4ad980$@gmail.com>
 <CAGU_CiJ9n1c8FjVxOMtaqERTScyGBBWa_Y-z+k3dL3ooppfZPw@mail.gmail.com>
 <202208021732.14822.Antony.Stone@squid.open.source.it>
 <CAGU_Ci+8JNHWRS3Nx_OA1hCHtypj5-jW14T6QET_N=0QpO_CYA@mail.gmail.com>
 <YulO+tFla+o8gTiV@fantomas.sk>
 <CAGU_CiJvc3DrwS-GLd5-2WwBo7V-K0E9muk3SbaXQG=hD=q=rA@mail.gmail.com>
 <6566b26b-41c4-6069-fa0b-084cae57011b@treenet.co.nz>
Message-ID: <YuozWB5vtwseuh36@fantomas.sk>

On 03.08.22 14:12, Amos Jeffries wrote:
>IMO, what you are looking for is actually this ACL definition:
>
> acl adobe ssl::server_name .adobe.com
>
>or its regex equivalent,
>
> acl adobe ssl::server_name_regex (^|\.)adobe\.com$

this is what I was searching for. Squid FAQ says:

https://wiki.squid-cache.org/SquidFaq/SquidAcl#Squid_doesn.27t_match_my_subdomains

www.example.com matches the exact host www.example.com, while .example.com 
matches the entire domain example.com (including example.com alone)


but I wasn't sure if this matching also applies to ssl::server_name.

thanks
-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
I don't have lysdexia. The Dog wouldn't allow that.


From squid3 at treenet.co.nz  Wed Aug  3 10:46:39 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 3 Aug 2022 22:46:39 +1200
Subject: [squid-users] filedescriptors on debian/systemd
In-Reply-To: <007501d8a6f8$50058970$f0109c50$@gmail.com>
References: <YuksgqpS2bJjdfaV@fantomas.sk>
 <41e10066-9035-9d50-3c00-2273937a8452@treenet.co.nz>
 <007501d8a6f8$50058970$f0109c50$@gmail.com>
Message-ID: <5d04b4dd-d9fd-3ee8-047f-b78a01b94d64@treenet.co.nz>

On 3/08/22 17:17, ngtech1ltd wrote:
> Hey Amos,
> 
> I was under the impression that Systemd does impose a basic limit but I can test it to verify my doubts.
>  From my point of view and testing until now systemd does impose a basic global limit.
> 

Squid looks up the limit on startup. With systemd that lookup reports no 
limit existing. So Squid sets it to our hard-coded default minimum of 1024 .


Amos


From robertkwild at gmail.com  Wed Aug  3 11:52:24 2022
From: robertkwild at gmail.com (robert k Wild)
Date: Wed, 3 Aug 2022 12:52:24 +0100
Subject: [squid-users] regex for normal websites
In-Reply-To: <YuozWB5vtwseuh36@fantomas.sk>
References: <CAGU_CiJimq7-co9QCVT1+-NF8Y_V4pECVRiow_eOhh=rfXHK6g@mail.gmail.com>
 <004f01d8a67b$ef6e4880$ce4ad980$@gmail.com>
 <CAGU_CiJ9n1c8FjVxOMtaqERTScyGBBWa_Y-z+k3dL3ooppfZPw@mail.gmail.com>
 <202208021732.14822.Antony.Stone@squid.open.source.it>
 <CAGU_Ci+8JNHWRS3Nx_OA1hCHtypj5-jW14T6QET_N=0QpO_CYA@mail.gmail.com>
 <YulO+tFla+o8gTiV@fantomas.sk>
 <CAGU_CiJvc3DrwS-GLd5-2WwBo7V-K0E9muk3SbaXQG=hD=q=rA@mail.gmail.com>
 <6566b26b-41c4-6069-fa0b-084cae57011b@treenet.co.nz>
 <YuozWB5vtwseuh36@fantomas.sk>
Message-ID: <CAGU_Ci+W186g5CeSs85GBYBpL1hLdKS6T63MS4bJot27hwG=LQ@mail.gmail.com>

thanks Amos for this greatly appreciated

On Wed, 3 Aug 2022 at 09:35, Matus UHLAR - fantomas <uhlar at fantomas.sk>
wrote:

> On 03.08.22 14:12, Amos Jeffries wrote:
> >IMO, what you are looking for is actually this ACL definition:
> >
> > acl adobe ssl::server_name .adobe.com
> >
> >or its regex equivalent,
> >
> > acl adobe ssl::server_name_regex (^|\.)adobe\.com$
>
> this is what I was searching for. Squid FAQ says:
>
>
> https://wiki.squid-cache.org/SquidFaq/SquidAcl#Squid_doesn.27t_match_my_subdomains
>
> www.example.com matches the exact host www.example.com, while .example.com
> matches the entire domain example.com (including example.com alone)
>
>
> but I wasn't sure if this matching also applies to ssl::server_name.
>
> thanks
> --
> Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
> Warning: I wish NOT to receive e-mail advertising to this address.
> Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
> I don't have lysdexia. The Dog wouldn't allow that.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>


-- 
Regards,

Robert K Wild.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220803/a96037e8/attachment.htm>

From uhlar at fantomas.sk  Wed Aug  3 12:55:25 2022
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Wed, 3 Aug 2022 14:55:25 +0200
Subject: [squid-users] filedescriptors on debian/systemd
In-Reply-To: <007501d8a6f8$50058970$f0109c50$@gmail.com>
References: <YuksgqpS2bJjdfaV@fantomas.sk>
 <41e10066-9035-9d50-3c00-2273937a8452@treenet.co.nz>
 <007501d8a6f8$50058970$f0109c50$@gmail.com>
Message-ID: <YupwPX6rGd23ZOmh@fantomas.sk>

On 03.08.22 08:17, ngtech1ltd at gmail.com wrote:
>I was under the impression that Systemd does impose a basic limit but I can test it to verify my doubts.
>From my point of view and testing until now systemd does impose a basic global limit.

this matches my observations - after logging into system, I see 1k soft and 
1M hard limit.

I have replaced squid binary with script that prints and replaces files 
limit and this is the result:

# cat /usr/sbin/squid
#!/bin/sh
ulimit -n -S > /tmp/limit.$$
ulimit -n -H >> /tmp/limit.$$
ulimit -n -S 2048
ulimit -n -S >>/tmp/limit.$$
ulimit -n -H >> /tmp/limit.$$
exec /usr/sbin/squid.real "$@"

# cat limit.1490
1024
524288
2048
524288

before:
2022/08/03 14:33:11 kid1| With 1024 file descriptors available

after:
2022/08/03 14:44:04 kid1| With 2048 file descriptors available


>-----Original Message-----
>From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Amos Jeffries
>Sent: Wednesday, 3 August 2022 5:31
>To: squid-users at lists.squid-cache.org
>Subject: Re: [squid-users] filedescriptors on debian/systemd
>
>On 3/08/22 01:54, Matus UHLAR - fantomas wrote:
>> I have encountered Debian bug 934208:
>>
>> 2022/07/28 16:40:53 kid1| With 1024 file descriptors available
>> 2022/07/29 06:50:18 kid1| WARNING! Your cache is running out of
>> filedescriptors
>>
>> according to the bug report:
>>
>> "Under systemd the default is not to have any limitation at all."

>To clarify, what that means is that *systemd* does not impose any limit
>by default.

as wee see above, it does.

> Squid when it cannot find a limit sets 1024 as default.

This may be the default if squid can't find a limit, but in this case the 
soft limit is set.

>Under systemd the "correct" way to set such a limit is for the admin to
>decide on a limit and configure it. You can do this is two ways:

I believe setting sane default (>1024) in squid itself or a systemd unit 
file is a better option.
Especially when sysvinit script sets such default.

>  1) set the systemd local config like you did:
>
>>
>> # cat /etc/systemd/system/squid.service.d/override.conf
>> [Service]
>> LimitNOFILE=65536
>>
>> and after reloading systemd:
>>
>> # systemctl daemon-reload
>>
>
>or, 2)
>
>   set max_filedescriptors in squid.conf


-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Support bacteria - they're the only culture some people have.


From marcelorodrigo at graminsta.com.br  Wed Aug  3 14:12:34 2022
From: marcelorodrigo at graminsta.com.br (marcelorodrigo at graminsta.com.br)
Date: Wed, 03 Aug 2022 11:12:34 -0300
Subject: [squid-users] Trying to recompile squid 4.13 with ./configure
 CXXFLAGS="-DMAXTCPLISTENPORTS=256"
Message-ID: <0198da0d56414a39bfeaf15fc21ab46e@graminsta.com.br>

Hi,

I am trying to recompile squid 4.13 using ./configure 
CXXFLAGS="-DMAXTCPLISTENPORTS=256".
It runs the recompile but the CXXFLAGS= does not even appears in the 
squid -v.

Is there a way to include this feature in the squid instalation?

Tks.
Marcelo.


From rousskov at measurement-factory.com  Wed Aug  3 20:03:33 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Wed, 3 Aug 2022 16:03:33 -0400
Subject: [squid-users] Trying to recompile squid 4.13 with ./configure
 CXXFLAGS="-DMAXTCPLISTENPORTS=256"
In-Reply-To: <0198da0d56414a39bfeaf15fc21ab46e@graminsta.com.br>
References: <0198da0d56414a39bfeaf15fc21ab46e@graminsta.com.br>
Message-ID: <280caa49-b03c-30a1-0eb0-d4f98605fe1b@measurement-factory.com>

On 8/3/22 10:12, marcelorodrigo at graminsta.com.br wrote:
> Hi,
> 
> I am trying to recompile squid 4.13 using ./configure 
> CXXFLAGS="-DMAXTCPLISTENPORTS=256".
> It runs the recompile but the CXXFLAGS= does not even appears in the 
> squid -v.

I do see CXXFLAGS in "squid -v", but I have not tested official v4 code. 
AFAICT, the latest v4 does claim to support -DMAXTCPLISTENPORTS=...

Please note that ./configure does not "recompile". If you have not run 
"make" after ./configure, then please do that. I would also run "make 
clean" before ./configure to make sure everything that may rely on 
MAXTCPLISTENPORTS is rebuilt during subsequent "make". There are known 
problems in build dependency tracking...

If you are still having problems after the above, then look in 
src/Makefile. Does it have your MAXTCPLISTENPORTS=256 text somewhere? If 
yes, do you see -DMAXTCPLISTENPORTS=256 on the compiler command line 
when a C++ compiler compiles, say, src/main.cc (after you run "touch 
src/main.cc && make -C src main.o" or equivalent)?


HTH,

Alex.


From marcelorodrigo at graminsta.com.br  Wed Aug  3 22:16:53 2022
From: marcelorodrigo at graminsta.com.br (marcelorodrigo at graminsta.com.br)
Date: Wed, 03 Aug 2022 19:16:53 -0300
Subject: [squid-users] Trying to recompile squid 4.13 with ./configure
 CXXFLAGS="-DMAXTCPLISTENPORTS=256"
In-Reply-To: <0198da0d56414a39bfeaf15fc21ab46e@graminsta.com.br>
References: <0198da0d56414a39bfeaf15fc21ab46e@graminsta.com.br>
Message-ID: <54a883a8d8cccab67e625d8f1d9d8f25@graminsta.com.br>

Some important information.

I am trying to recompile using:

./configure CXXFLAGS="-DMAXTCPLISTENPORTS=10000 -g -O2 -fPIE 
-fstack-protector-strong -Wformat -Werror=format-security" 
--build="x86_64-linux-gnu" --prefix="/usr" 
--includedir="${prefix}/include" --mandir="${prefix}/share/man" 
--infodir="${prefix}/share/info" --sysconfdir="/etc" 
--localstatedir="/var" --libexecdir="${prefix}/lib/squid3" --srcdir="." 
--disable-maintainer-mode --disable-dependency-tracking 
--disable-silent-rules BUILDCXXFLAGS="-g -O2 -fPIE 
-fstack-protector-strong -Wformat -Werror=format-security 
-Wl,-Bsymbolic-functions -fPIE -pie -Wl,-z,relro -Wl,-z,now" 
--datadir="/usr/share/squid" --sysconfdir="/etc/squid" 
--libexecdir="/usr/lib/squid" --mandir="/usr/share/man" --enable-inline 
--disable-arch-native --enable-async-io="8" 
--enable-storeio="ufs,aufs,diskd,rock" 
--enable-removal-policies="lru,heap" --enable-delay-pools 
--enable-cache-digests --enable-icap-client 
--enable-follow-x-forwarded-for 
--enable-auth-basic="DB,fake,getpwnam,LDAP,NCSA,NIS,PAM,POP3,RADIUS,SASL,SMB" 
--enable-auth-digest="file,LDAP" 
--enable-auth-negotiate="kerberos,wrapper" 
--enable-auth-ntlm="fake,smb_lm" 
--enable-external-acl-helpers="file_userip,kerberos_ldap_group,LDAP_group,session,SQL_session,unix_group,wbinfo_group" 
--enable-url-rewrite-helpers="fake" --enable-eui --enable-esi 
--enable-icmp --enable-zph-qos --enable-ecap --disable-translation 
--with-swapdir="/var/spool/squid" --with-logdir="/var/log/squid" 
--with-pidfile="/var/run/squid.pid" --with-filedescriptors="65536" 
--with-large-files --with-default-user="proxy" 
--enable-build-info="Ubuntu linux" --enable-linux-netfilter 
build_alias="x86_64-linux-gnu" CFLAGS="-g -O2 -fPIE 
-fstack-protector-strong -Wformat -Werror=format-security -Wall" 
LDFLAGS="-Wl,-Bsymbolic-functions -fPIE -pie -Wl,-z,relro -Wl,-z,now" 
CPPFLAGS="-Wdate-time -D_FORTIFY_SOURCE=2" --with-openssl 
--enable-ssl-crtd

Then make and make install from /build/squid/squid-4.13/ folder, but 
nothin seems to change when squid -v is used.

I also tryied do recompile with this example:

./configure --build="x86_64-linux-gnu" --prefix="/usr" 
--includedir="${prefix}/include" --mandir="${prefix}/share/man" 
--infodir="${prefix}/share/info" --sysconfdir="/etc" 
--localstatedir="/var" --libexecdir="${prefix}/lib/squid3" --srcdir="." 
--disable-maintainer-mode --disable-dependency-tracking 
--disable-silent-rules BUILDCXXFLAGS="-g -O2 -fPIE 
-fstack-protector-strong -Wformat -Werror=format-security 
-Wl,-Bsymbolic-functions -fPIE -pie -Wl,-z,relro -Wl,-z,now" 
--datadir="/usr/share/squid" --sysconfdir="/etc/squid" 
--libexecdir="/usr/lib/squid" --mandir="/usr/share/man" --enable-inline 
--disable-arch-native --enable-async-io="8" 
--enable-storeio="ufs,aufs,diskd,rock" 
--enable-removal-policies="lru,heap" --enable-delay-pools 
--enable-cache-digests --enable-icap-client 
--enable-follow-x-forwarded-for 
--enable-auth-basic="DB,fake,getpwnam,LDAP,NCSA,NIS,PAM,POP3,RADIUS,SASL,SMB" 
--enable-auth-digest="file,LDAP" 
--enable-auth-negotiate="kerberos,wrapper" 
--enable-auth-ntlm="fake,smb_lm" 
--enable-external-acl-helpers="file_userip,kerberos_ldap_group,LDAP_group,session,SQL_session,unix_group,wbinfo_group" 
--enable-url-rewrite-helpers="fake" --enable-eui --enable-esi 
--enable-icmp --enable-zph-qos --enable-ecap --disable-translation 
--with-swapdir="/var/spool/squid" --with-logdir="/var/log/squid" 
--with-pidfile="/var/run/squid.pid" --with-filedescriptors="65536" 
--with-large-files --with-default-user="proxy" 
--enable-build-info="Ubuntu linux" --enable-linux-netfilter 
build_alias="x86_64-linux-gnu" CFLAGS="-g -O2 -fPIE 
-fstack-protector-strong -Wformat -Werror=format-security -Wall" 
LDFLAGS="-Wl,-Bsymbolic-functions -fPIE -pie -Wl,-z,relro -Wl,-z,now" 
CPPFLAGS="-Wdate-time -D_FORTIFY_SOURCE=2" 
CXXFLAGS="-DMAXTCPLISTENPORTS=450 -g -O2 -fPIE -fstack-protector-strong 
-Wformat -Werror=format-security"

I used several virtualserver sessions and clones, but the 
CXXFLAGS="-DMAXTCPLISTENPORTS=" dont appears in the squid -v

What is wrong in this rebuilding?


On 2022-08-03 11:12, marcelorodrigo at graminsta.com.br wrote:
> Hi,
> 
> I am trying to recompile squid 4.13 using ./configure
> CXXFLAGS="-DMAXTCPLISTENPORTS=256".
> It runs the recompile but the CXXFLAGS= does not even appears in the 
> squid -v.
> 
> Is there a way to include this feature in the squid instalation?
> 
> Tks.
> Marcelo.


From squid3 at treenet.co.nz  Thu Aug  4 08:36:28 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 4 Aug 2022 20:36:28 +1200
Subject: [squid-users] Trying to recompile squid 4.13 with ./configure
 CXXFLAGS="-DMAXTCPLISTENPORTS=256"
In-Reply-To: <54a883a8d8cccab67e625d8f1d9d8f25@graminsta.com.br>
References: <0198da0d56414a39bfeaf15fc21ab46e@graminsta.com.br>
 <54a883a8d8cccab67e625d8f1d9d8f25@graminsta.com.br>
Message-ID: <f093db84-dbd4-17cd-1bc6-db7e84e92726@treenet.co.nz>

On 4/08/22 10:16, marcelorodrigo wrote:
> Some important information.
> 
...
> Then make and make install from /build/squid/squid-4.13/ folder, but 
> nothin seems to change when squid -v is used.

Please build with this command:
   make && ./src/squid -v

... to be sure the -v info is coming from the built binary.

If that shows differently from "squid -v" there is an issue with the 
install location.

Cheers
Amos


From ngtech1ltd at gmail.com  Thu Aug  4 08:59:38 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Thu, 4 Aug 2022 11:59:38 +0300
Subject: [squid-users] regex for normal websites
In-Reply-To: <CAGU_Ci+W186g5CeSs85GBYBpL1hLdKS6T63MS4bJot27hwG=LQ@mail.gmail.com>
References: <CAGU_CiJimq7-co9QCVT1+-NF8Y_V4pECVRiow_eOhh=rfXHK6g@mail.gmail.com>
 <004f01d8a67b$ef6e4880$ce4ad980$@gmail.com>
 <CAGU_CiJ9n1c8FjVxOMtaqERTScyGBBWa_Y-z+k3dL3ooppfZPw@mail.gmail.com>
 <202208021732.14822.Antony.Stone@squid.open.source.it>
 <CAGU_Ci+8JNHWRS3Nx_OA1hCHtypj5-jW14T6QET_N=0QpO_CYA@mail.gmail.com>
 <YulO+tFla+o8gTiV@fantomas.sk>
 <CAGU_CiJvc3DrwS-GLd5-2WwBo7V-K0E9muk3SbaXQG=hD=q=rA@mail.gmail.com>
 <6566b26b-41c4-6069-fa0b-084cae57011b@treenet.co.nz>
 <YuozWB5vtwseuh36@fantomas.sk>
 <CAGU_Ci+W186g5CeSs85GBYBpL1hLdKS6T63MS4bJot27hwG=LQ@mail.gmail.com>
Message-ID: <000701d8a7e0$87d5fa90$9781efb0$@gmail.com>

Hey Robert,
 
I recorded this video for you:
https://cloud1.ngtech.co.il/static/squid-data/regex-for-robert.mp4
 
This is what I did when I reviewed the question.
I hope it will help you and others use this tool:
https://rubular.com/
 
and squid.
 
If you have any question regarding REGEX here we are welcoming every question.
 
All The Bests and Hope This Helps,
Eliezer
 
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> 
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/
 
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of robert k Wild
Sent: Wednesday, 3 August 2022 14:52
To: Squid Users <squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] regex for normal websites
 
thanks Amos for this greatly appreciated
 
On Wed, 3 Aug 2022 at 09:35, Matus UHLAR - fantomas <uhlar at fantomas.sk <mailto:uhlar at fantomas.sk> > wrote:
On 03.08.22 14:12, Amos Jeffries wrote:
>IMO, what you are looking for is actually this ACL definition:
>
> acl adobe ssl::server_name .adobe.com <http://adobe.com> 
>
>or its regex equivalent,
>
> acl adobe ssl::server_name_regex (^|\.)adobe\.com$

this is what I was searching for. Squid FAQ says:

https://wiki.squid-cache.org/SquidFaq/SquidAcl#Squid_doesn.27t_match_my_subdomains

www.example.com <http://www.example.com>  matches the exact host www.example.com <http://www.example.com> , while .example.com <http://example.com>  
matches the entire domain example.com <http://example.com>  (including example.com <http://example.com>  alone)


but I wasn't sure if this matching also applies to ssl::server_name.

thanks
-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk <mailto:uhlar at fantomas.sk>  ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
I don't have lysdexia. The Dog wouldn't allow that.
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> 
http://lists.squid-cache.org/listinfo/squid-users


-- 
Regards, 

Robert K Wild.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220804/97f61285/attachment.htm>

From abarnett at belofx.com  Thu Aug  4 11:27:51 2022
From: abarnett at belofx.com (Adam Barnett)
Date: Thu, 4 Aug 2022 12:27:51 +0100
Subject: [squid-users] Squid and Epic Games HCapctca
Message-ID: <CAP9Tep55nVJDAcrTPJxsoKJnwk4bs2eTbuo-s7CwDCgzpQwBqA@mail.gmail.com>

Hi All,

I am trying to get squid to allow me to login to Epicgames.com with my epic
login, i get to the login page and get the hcaptca images and everytime i
get "invalid response"

i looked at the headers and the only error that i can see is "The
cache information is missing from the entry"

My config looks like so

workers 2

```
# Leave coredumps in the first cache dir
coredump_dir /var/spool/squid

http_port 3128 ssl-bump  dynamic_cert_mem_cache_size=16MB
 generate-host-certificates=on cert=/etc/squid/certs/squid-ca-cert-key.pem

sslcrtd_program /usr/lib64/squid/security_file_certgen -s
/var/spool/squid/ssl -M 16MB
dns_nameservers 10.5.1.2 8.8.8.8
visible_hostname foo-proxy-1
forwarded_for truncate
via off

# Send to file
access_log daemon:/var/log/squid/access.log



acl CONNECT method CONNECT
acl local src 10.0.0.0/8
always_direct allow all
request_header_add X-GoogApps-Allowed-Domains "foo.com" all

memory_replacement_policy heap GDSF
maximum_object_size 100 KB
maximum_object_size 1 MB

cache allow all
cache_mem 256 MB
cache_dir rock /var/spool/squid 1024
memory_pools off
cache_swap_low 90
client_persistent_connections on


http_access allow localhost manager
http_access deny manager

# SquidGaurd
url_rewrite_program /usr/bin/squidGuard
```

Any suggestions?

Thanks

Adam Barnett
Senior SysAdmin beloFX

  abarnett at belofx.com
<https://514584150-atari-embeds.googleusercontent.com/embeds/16cb204cf3a9d4d223a0a3fd8b0eec5d/inner-frame-minified.html?jsh=m%3B%2F_%2Fscs%2Fabc-static%2F_%2Fjs%2Fk%3Dgapi.lb.en.dzXZWX9QTbE.O%2Fd%3D1%2Frs%3DAHpOoo_epIQDPHdjFr3MLkazUi2Jmy50dQ%2Fm%3D__features__>
  www.belofx.com
  LinkedIn <http://www.linkedin.com/company/belofx>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220804/a18ace08/attachment.htm>

From ngtech1ltd at gmail.com  Thu Aug  4 15:25:38 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Thu, 4 Aug 2022 18:25:38 +0300
Subject: [squid-users] Squid and Epic Games HCapctca
In-Reply-To: <CAP9Tep55nVJDAcrTPJxsoKJnwk4bs2eTbuo-s7CwDCgzpQwBqA@mail.gmail.com>
References: <CAP9Tep55nVJDAcrTPJxsoKJnwk4bs2eTbuo-s7CwDCgzpQwBqA@mail.gmail.com>
Message-ID: <002001d8a816$744167e0$5cc437a0$@gmail.com>

Hey Adam,

I don?t remember where exactly epic games is hosted but, it should be spliced.
If you need an app definition I can try to grab one from my local squid.

Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: mailto:ngtech1ltd at gmail.com
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/

From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Adam Barnett
Sent: Thursday, 4 August 2022 14:28
To: squid-users at lists.squid-cache.org
Subject: [squid-users] Squid and Epic Games HCapctca

Hi All, 

I am trying to get squid to allow me to login to Epicgames.com with my epic login, i get to the login page and get the hcaptca images and everytime i get "invalid response" 

i looked at the headers and the only error that i can see is "The cache information is missing from the entry" 

My config looks like so 

workers 2

```
# Leave coredumps in the first cache dir
coredump_dir /var/spool/squid

http_port 3128 ssl-bump  dynamic_cert_mem_cache_size=16MB  generate-host-certificates=on cert=/etc/squid/certs/squid-ca-cert-key.pem

sslcrtd_program /usr/lib64/squid/security_file_certgen -s /var/spool/squid/ssl -M 16MB
dns_nameservers 10.5.1.2 8.8.8.8
visible_hostname foo-proxy-1
forwarded_for truncate
via off

# Send to file
access_log daemon:/var/log/squid/access.log



acl CONNECT method CONNECT
acl local src http://10.0.0.0/8
always_direct allow all
request_header_add X-GoogApps-Allowed-Domains "http://foo.com" all

memory_replacement_policy heap GDSF
maximum_object_size 100 KB
maximum_object_size 1 MB

cache allow all
cache_mem 256 MB
cache_dir rock /var/spool/squid 1024
memory_pools off
cache_swap_low 90
client_persistent_connections on


http_access allow localhost manager
http_access deny manager

# SquidGaurd
url_rewrite_program /usr/bin/squidGuard
```

Any suggestions? 

Thanks

Adam Barnett
Senior SysAdmin beloFX



 
https://514584150-atari-embeds.googleusercontent.com/embeds/16cb204cf3a9d4d223a0a3fd8b0eec5d/inner-frame-minified.html?jsh=m%3B%2F_%2Fscs%2Fabc-static%2F_%2Fjs%2Fk%3Dgapi.lb.en.dzXZWX9QTbE.O%2Fd%3D1%2Frs%3DAHpOoo_epIQDPHdjFr3MLkazUi2Jmy50dQ%2Fm%3D__features__


 
http://www.belofx.com/


 
http://www.linkedin.com/company/belofx








From ngtech1ltd at gmail.com  Thu Aug  4 21:18:21 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Fri, 5 Aug 2022 00:18:21 +0300
Subject: [squid-users] Squid and Epic Games HCapctca
In-Reply-To: <CAP9Tep55nVJDAcrTPJxsoKJnwk4bs2eTbuo-s7CwDCgzpQwBqA@mail.gmail.com>
References: <CAP9Tep55nVJDAcrTPJxsoKJnwk4bs2eTbuo-s7CwDCgzpQwBqA@mail.gmail.com>
Message-ID: <004501d8a847$ba5051c0$2ef0f540$@gmail.com>

Hey Adam,
 
I recorded a video for you on how I do it at:
https://cloud1.ngtech.co.il/static/squid-data/splice-epic-games.mp4
 
So basically the relevant domains are:
 
epicgames-download1.akamaized.net
.epicgames.com
.unrealengine.com
 
And you can peek at robert k Wild mail: ?regex for normal websites?
 
And it contains the relevant technical details.
If for any reason you need a more detailed answer let me know.
 
Yours,
Eliezer 
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> 
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/
 
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Adam Barnett
Sent: Thursday, 4 August 2022 14:28
To: squid-users at lists.squid-cache.org
Subject: [squid-users] Squid and Epic Games HCapctca
 
Hi All, 
 
I am trying to get squid to allow me to login to Epicgames.com with my epic login, i get to the login page and get the hcaptca images and everytime i get "invalid response" 
 
i looked at the headers and the only error that i can see is "The cache information is missing from the entry" 
 
My config looks like so 

workers 2

```
# Leave coredumps in the first cache dir
coredump_dir /var/spool/squid

http_port 3128 ssl-bump  dynamic_cert_mem_cache_size=16MB  generate-host-certificates=on cert=/etc/squid/certs/squid-ca-cert-key.pem

sslcrtd_program /usr/lib64/squid/security_file_certgen -s /var/spool/squid/ssl -M 16MB
dns_nameservers 10.5.1.2 8.8.8.8
visible_hostname foo-proxy-1
forwarded_for truncate
via off

# Send to file
access_log daemon:/var/log/squid/access.log



acl CONNECT method CONNECT
acl local src 10.0.0.0/8 <http://10.0.0.0/8> 
always_direct allow all
request_header_add X-GoogApps-Allowed-Domains "foo.com <http://foo.com> " all

memory_replacement_policy heap GDSF
maximum_object_size 100 KB
maximum_object_size 1 MB

cache allow all
cache_mem 256 MB
cache_dir rock /var/spool/squid 1024
memory_pools off
cache_swap_low 90
client_persistent_connections on


http_access allow localhost manager
http_access deny manager

# SquidGaurd
url_rewrite_program /usr/bin/squidGuard
```

Any suggestions? 
 
Thanks
	



Adam Barnett
Senior SysAdmin beloFX
	

	


  <https://cdn.gifo.wisestamp.com/s/rich-field-email-1/F1C13B/22/trans.png> 
 
 <https://514584150-atari-embeds.googleusercontent.com/embeds/16cb204cf3a9d4d223a0a3fd8b0eec5d/inner-frame-minified.html?jsh=m%3B%2F_%2Fscs%2Fabc-static%2F_%2Fjs%2Fk%3Dgapi.lb.en.dzXZWX9QTbE.O%2Fd%3D1%2Frs%3DAHpOoo_epIQDPHdjFr3MLkazUi2Jmy50dQ%2Fm%3D__features__> abarnett at belofx.com


  <https://cdn.gifo.wisestamp.com/s/rich-field-website-1/F1C13B/22/trans.png> 
 
 <http://www.belofx.com/> www.belofx.com


  <https://cdn.gifo.wisestamp.com/s/rich-field-website-3/F1C13B/22/trans.png> 
 
 <http://www.linkedin.com/company/belofx> LinkedIn
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220805/68116428/attachment.htm>

From abarnett at belofx.com  Thu Aug  4 21:26:06 2022
From: abarnett at belofx.com (Adam Barnett)
Date: Thu, 4 Aug 2022 22:26:06 +0100
Subject: [squid-users] Squid and Epic Games HCapctca
In-Reply-To: <004501d8a847$ba5051c0$2ef0f540$@gmail.com>
References: <CAP9Tep55nVJDAcrTPJxsoKJnwk4bs2eTbuo-s7CwDCgzpQwBqA@mail.gmail.com>
 <004501d8a847$ba5051c0$2ef0f540$@gmail.com>
Message-ID: <CAP9Tep7KBCvc4OqcOXOQZX8Whxu1j0z-Bev_WGwW60ZGOPN7Aw@mail.gmail.com>

???? ???
It looks like you are using a database and then building the config from
that? any cahnce you can send me the snippet of the config instead of the
DB bits? ?

Thanks again

Adam

On Thu, 4 Aug 2022 at 22:18, <ngtech1ltd at gmail.com> wrote:

> Hey Adam,
>
>
>
> I recorded a video for you on how I do it at:
>
> https://cloud1.ngtech.co.il/static/squid-data/splice-epic-games.mp4
>
>
>
> So basically the relevant domains are:
>
>
>
> epicgames-download1.akamaized.net
>
> .epicgames.com
>
> .unrealengine.com
>
>
>
> And you can peek at robert k Wild mail: ?regex for normal websites?
>
>
>
> And it contains the relevant technical details.
>
> If for any reason you need a more detailed answer let me know.
>
>
>
> Yours,
>
> Eliezer
>
>
>
> ----
>
> Eliezer Croitoru
>
> NgTech, Tech Support
>
> Mobile: +972-5-28704261
>
> Email: ngtech1ltd at gmail.com
>
> Web: https://ngtech.co.il/
>
> My-Tube: https://tube.ngtech.co.il/
>
>
>
> *From:* squid-users <squid-users-bounces at lists.squid-cache.org> *On
> Behalf Of *Adam Barnett
> *Sent:* Thursday, 4 August 2022 14:28
> *To:* squid-users at lists.squid-cache.org
> *Subject:* [squid-users] Squid and Epic Games HCapctca
>
>
>
> Hi All,
>
>
>
> I am trying to get squid to allow me to login to Epicgames.com with my
> epic login, i get to the login page and get the hcaptca images and
> everytime i get "invalid response"
>
>
>
> i looked at the headers and the only error that i can see is "The
> cache information is missing from the entry"
>
>
>
> My config looks like so
>
> workers 2
>
> ```
> # Leave coredumps in the first cache dir
> coredump_dir /var/spool/squid
>
> http_port 3128 ssl-bump  dynamic_cert_mem_cache_size=16MB
>  generate-host-certificates=on cert=/etc/squid/certs/squid-ca-cert-key.pem
>
> sslcrtd_program /usr/lib64/squid/security_file_certgen -s
> /var/spool/squid/ssl -M 16MB
> dns_nameservers 10.5.1.2 8.8.8.8
> visible_hostname foo-proxy-1
> forwarded_for truncate
> via off
>
> # Send to file
> access_log daemon:/var/log/squid/access.log
>
>
>
> acl CONNECT method CONNECT
> acl local src 10.0.0.0/8
> always_direct allow all
> request_header_add X-GoogApps-Allowed-Domains "foo.com" all
>
> memory_replacement_policy heap GDSF
> maximum_object_size 100 KB
> maximum_object_size 1 MB
>
> cache allow all
> cache_mem 256 MB
> cache_dir rock /var/spool/squid 1024
> memory_pools off
> cache_swap_low 90
> client_persistent_connections on
>
>
> http_access allow localhost manager
> http_access deny manager
>
> # SquidGaurd
> url_rewrite_program /usr/bin/squidGuard
> ```
>
> Any suggestions?
>
>
>
> Thanks
>
> Adam Barnett
> Senior SysAdmin beloFX
>
>
>
> abarnett at belofx.com
> <https://514584150-atari-embeds.googleusercontent.com/embeds/16cb204cf3a9d4d223a0a3fd8b0eec5d/inner-frame-minified.html?jsh=m%3B%2F_%2Fscs%2Fabc-static%2F_%2Fjs%2Fk%3Dgapi.lb.en.dzXZWX9QTbE.O%2Fd%3D1%2Frs%3DAHpOoo_epIQDPHdjFr3MLkazUi2Jmy50dQ%2Fm%3D__features__>
>
>
>
> www.belofx.com
>
>
>
> LinkedIn <http://www.linkedin.com/company/belofx>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220804/dc4dbd60/attachment.htm>

From ngtech1ltd at gmail.com  Thu Aug  4 21:41:52 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Fri, 5 Aug 2022 00:41:52 +0300
Subject: [squid-users] Squid and Epic Games HCapctca
In-Reply-To: <CAP9Tep7KBCvc4OqcOXOQZX8Whxu1j0z-Bev_WGwW60ZGOPN7Aw@mail.gmail.com>
References: <CAP9Tep55nVJDAcrTPJxsoKJnwk4bs2eTbuo-s7CwDCgzpQwBqA@mail.gmail.com>
 <004501d8a847$ba5051c0$2ef0f540$@gmail.com>
 <CAP9Tep7KBCvc4OqcOXOQZX8Whxu1j0z-Bev_WGwW60ZGOPN7Aw@mail.gmail.com>
Message-ID: <004c01d8a84b$0332e3f0$0998abd0$@gmail.com>

You are welcome.
 
I wrote an app that does everything for me so I just need to dump the database into a:
ssl::server_name directive
 
it?s basically:
## START
acl NoBump_server_name ssl::server_name "/etc/squid/no-ssl-bump-server-name.list"
 
acl tls_to_splice any-of inspect_only NoBump_src NoBump_server_name NoBump_server_regex_by_urls_domain NoBump_server_regex
 
ssl_bump peek app_matcher_helper
ssl_bump peek tls_s1_connect
 
ssl_bump bump app_matcher_helper
ssl_bump bump app_reader_helper
ssl_bump bump deny_note
 
ssl_bump splice app_matcher_helper
ssl_bump splice tls_to_splice
 
ssl_bump stare app_matcher_helper
ssl_bump stare tls_s2_client_hello
 
ssl_bump bump app_matcher_helper
ssl_bump bump tls_to_bump
## END
 
If you want I can upload a snippet of the whole setup dump with hope you could make use of it.
 
Eliezer
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> 
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/
 
From: Adam Barnett <abarnett at belofx.com> 
Sent: Friday, 5 August 2022 0:26
To: ngtech1ltd at gmail.com
Cc: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Squid and Epic Games HCapctca
 
???? ???
It looks like you are using a database and then building the config from that? any cahnce you can send me the snippet of the config instead of the DB bits? ? 
 
Thanks again 
 
Adam 
 
On Thu, 4 Aug 2022 at 22:18, <ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> > wrote:
Hey Adam,
 
I recorded a video for you on how I do it at:
https://cloud1.ngtech.co.il/static/squid-data/splice-epic-games.mp4
 
So basically the relevant domains are:
 
epicgames-download1.akamaized.net <http://epicgames-download1.akamaized.net> 
.epicgames.com <http://epicgames.com> 
.unrealengine.com <http://unrealengine.com> 
 
And you can peek at robert k Wild mail: ?regex for normal websites?
 
And it contains the relevant technical details.
If for any reason you need a more detailed answer let me know.
 
Yours,
Eliezer 
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> 
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/
 
From: squid-users <squid-users-bounces at lists.squid-cache.org <mailto:squid-users-bounces at lists.squid-cache.org> > On Behalf Of Adam Barnett
Sent: Thursday, 4 August 2022 14:28
To: squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> 
Subject: [squid-users] Squid and Epic Games HCapctca
 
Hi All, 
 
I am trying to get squid to allow me to login to Epicgames.com with my epic login, i get to the login page and get the hcaptca images and everytime i get "invalid response" 
 
i looked at the headers and the only error that i can see is "The cache information is missing from the entry" 
 
My config looks like so 

workers 2

```
# Leave coredumps in the first cache dir
coredump_dir /var/spool/squid

http_port 3128 ssl-bump  dynamic_cert_mem_cache_size=16MB  generate-host-certificates=on cert=/etc/squid/certs/squid-ca-cert-key.pem

sslcrtd_program /usr/lib64/squid/security_file_certgen -s /var/spool/squid/ssl -M 16MB
dns_nameservers 10.5.1.2 8.8.8.8
visible_hostname foo-proxy-1
forwarded_for truncate
via off

# Send to file
access_log daemon:/var/log/squid/access.log



acl CONNECT method CONNECT
acl local src 10.0.0.0/8 <http://10.0.0.0/8> 
always_direct allow all
request_header_add X-GoogApps-Allowed-Domains "foo.com <http://foo.com> " all

memory_replacement_policy heap GDSF
maximum_object_size 100 KB
maximum_object_size 1 MB

cache allow all
cache_mem 256 MB
cache_dir rock /var/spool/squid 1024
memory_pools off
cache_swap_low 90
client_persistent_connections on


http_access allow localhost manager
http_access deny manager

# SquidGaurd
url_rewrite_program /usr/bin/squidGuard
```

Any suggestions? 
 
Thanks
	



Adam Barnett
Senior SysAdmin beloFX
	

	


  <https://cdn.gifo.wisestamp.com/s/rich-field-email-1/F1C13B/22/trans.png> 
 
 <https://514584150-atari-embeds.googleusercontent.com/embeds/16cb204cf3a9d4d223a0a3fd8b0eec5d/inner-frame-minified.html?jsh=m%3B%2F_%2Fscs%2Fabc-static%2F_%2Fjs%2Fk%3Dgapi.lb.en.dzXZWX9QTbE.O%2Fd%3D1%2Frs%3DAHpOoo_epIQDPHdjFr3MLkazUi2Jmy50dQ%2Fm%3D__features__> abarnett at belofx.com


  <https://cdn.gifo.wisestamp.com/s/rich-field-website-1/F1C13B/22/trans.png> 
 
 <http://www.belofx.com/> www.belofx.com


  <https://cdn.gifo.wisestamp.com/s/rich-field-website-3/F1C13B/22/trans.png> 
 
 <http://www.linkedin.com/company/belofx> LinkedIn
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220805/541e0b71/attachment.htm>

From abarnett at belofx.com  Thu Aug  4 21:43:36 2022
From: abarnett at belofx.com (Adam Barnett)
Date: Thu, 4 Aug 2022 22:43:36 +0100
Subject: [squid-users] Squid and Epic Games HCapctca
In-Reply-To: <004c01d8a84b$0332e3f0$0998abd0$@gmail.com>
References: <CAP9Tep55nVJDAcrTPJxsoKJnwk4bs2eTbuo-s7CwDCgzpQwBqA@mail.gmail.com>
 <004501d8a847$ba5051c0$2ef0f540$@gmail.com>
 <CAP9Tep7KBCvc4OqcOXOQZX8Whxu1j0z-Bev_WGwW60ZGOPN7Aw@mail.gmail.com>
 <004c01d8a84b$0332e3f0$0998abd0$@gmail.com>
Message-ID: <CAP9Tep4pbvbC_OZSvB+qXDVuZZffZ0rH5KVo4ZSNoXcU1nncDg@mail.gmail.com>

Sure, the more the beter, ive been banging my head against the wall for a
while on this

Adam

On Thu, 4 Aug 2022 at 22:41, <ngtech1ltd at gmail.com> wrote:

> You are welcome.
>
>
>
> I wrote an app that does everything for me so I just need to dump the
> database into a:
>
> ssl::server_name directive
>
>
>
> it?s basically:
>
> ## START
>
> acl NoBump_server_name ssl::server_name "/etc/squid/no-ssl-bump-server-
> name.list"
>
>
>
> acl tls_to_splice any-of inspect_only NoBump_src NoBump_server_name
> NoBump_server_regex_by_urls_domain NoBump_server_regex
>
>
>
> ssl_bump peek app_matcher_helper
>
> ssl_bump peek tls_s1_connect
>
>
>
> ssl_bump bump app_matcher_helper
>
> ssl_bump bump app_reader_helper
>
> ssl_bump bump deny_note
>
>
>
> ssl_bump splice app_matcher_helper
>
> ssl_bump splice tls_to_splice
>
>
>
> ssl_bump stare app_matcher_helper
>
> ssl_bump stare tls_s2_client_hello
>
>
>
> ssl_bump bump app_matcher_helper
>
> ssl_bump bump tls_to_bump
>
> ## END
>
>
>
> If you want I can upload a snippet of the whole setup dump with hope you
> could make use of it.
>
>
>
> Eliezer
>
>
>
> ----
>
> Eliezer Croitoru
>
> NgTech, Tech Support
>
> Mobile: +972-5-28704261
>
> Email: ngtech1ltd at gmail.com
>
> Web: https://ngtech.co.il/
>
> My-Tube: https://tube.ngtech.co.il/
>
>
>
> *From:* Adam Barnett <abarnett at belofx.com>
> *Sent:* Friday, 5 August 2022 0:26
> *To:* ngtech1ltd at gmail.com
> *Cc:* squid-users at lists.squid-cache.org
> *Subject:* Re: [squid-users] Squid and Epic Games HCapctca
>
>
>
> ???? ???
> It looks like you are using a database and then building the config from
> that? any cahnce you can send me the snippet of the config instead of the
> DB bits? ?
>
>
>
> Thanks again
>
>
>
> Adam
>
>
>
> On Thu, 4 Aug 2022 at 22:18, <ngtech1ltd at gmail.com> wrote:
>
> Hey Adam,
>
>
>
> I recorded a video for you on how I do it at:
>
> https://cloud1.ngtech.co.il/static/squid-data/splice-epic-games.mp4
>
>
>
> So basically the relevant domains are:
>
>
>
> epicgames-download1.akamaized.net
>
> .epicgames.com
>
> .unrealengine.com
>
>
>
> And you can peek at robert k Wild mail: ?regex for normal websites?
>
>
>
> And it contains the relevant technical details.
>
> If for any reason you need a more detailed answer let me know.
>
>
>
> Yours,
>
> Eliezer
>
>
>
> ----
>
> Eliezer Croitoru
>
> NgTech, Tech Support
>
> Mobile: +972-5-28704261
>
> Email: ngtech1ltd at gmail.com
>
> Web: https://ngtech.co.il/
>
> My-Tube: https://tube.ngtech.co.il/
>
>
>
> *From:* squid-users <squid-users-bounces at lists.squid-cache.org> *On
> Behalf Of *Adam Barnett
> *Sent:* Thursday, 4 August 2022 14:28
> *To:* squid-users at lists.squid-cache.org
> *Subject:* [squid-users] Squid and Epic Games HCapctca
>
>
>
> Hi All,
>
>
>
> I am trying to get squid to allow me to login to Epicgames.com with my
> epic login, i get to the login page and get the hcaptca images and
> everytime i get "invalid response"
>
>
>
> i looked at the headers and the only error that i can see is "The
> cache information is missing from the entry"
>
>
>
> My config looks like so
>
> workers 2
>
> ```
> # Leave coredumps in the first cache dir
> coredump_dir /var/spool/squid
>
> http_port 3128 ssl-bump  dynamic_cert_mem_cache_size=16MB
>  generate-host-certificates=on cert=/etc/squid/certs/squid-ca-cert-key.pem
>
> sslcrtd_program /usr/lib64/squid/security_file_certgen -s
> /var/spool/squid/ssl -M 16MB
> dns_nameservers 10.5.1.2 8.8.8.8
> visible_hostname foo-proxy-1
> forwarded_for truncate
> via off
>
> # Send to file
> access_log daemon:/var/log/squid/access.log
>
>
>
> acl CONNECT method CONNECT
> acl local src 10.0.0.0/8
> always_direct allow all
> request_header_add X-GoogApps-Allowed-Domains "foo.com" all
>
> memory_replacement_policy heap GDSF
> maximum_object_size 100 KB
> maximum_object_size 1 MB
>
> cache allow all
> cache_mem 256 MB
> cache_dir rock /var/spool/squid 1024
> memory_pools off
> cache_swap_low 90
> client_persistent_connections on
>
>
> http_access allow localhost manager
> http_access deny manager
>
> # SquidGaurd
> url_rewrite_program /usr/bin/squidGuard
> ```
>
> Any suggestions?
>
>
>
> Thanks
>
> Adam Barnett
> Senior SysAdmin beloFX
>
>
>
> abarnett at belofx.com
> <https://514584150-atari-embeds.googleusercontent.com/embeds/16cb204cf3a9d4d223a0a3fd8b0eec5d/inner-frame-minified.html?jsh=m%3B%2F_%2Fscs%2Fabc-static%2F_%2Fjs%2Fk%3Dgapi.lb.en.dzXZWX9QTbE.O%2Fd%3D1%2Frs%3DAHpOoo_epIQDPHdjFr3MLkazUi2Jmy50dQ%2Fm%3D__features__>
>
>
>
> www.belofx.com
>
>
>
> LinkedIn <http://www.linkedin.com/company/belofx>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220804/20933374/attachment.htm>

From ngtech1ltd at gmail.com  Thu Aug  4 21:58:48 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Fri, 5 Aug 2022 00:58:48 +0300
Subject: [squid-users] Squid and Epic Games HCapctca
In-Reply-To: <CAP9Tep4pbvbC_OZSvB+qXDVuZZffZ0rH5KVo4ZSNoXcU1nncDg@mail.gmail.com>
References: <CAP9Tep55nVJDAcrTPJxsoKJnwk4bs2eTbuo-s7CwDCgzpQwBqA@mail.gmail.com>
 <004501d8a847$ba5051c0$2ef0f540$@gmail.com>
 <CAP9Tep7KBCvc4OqcOXOQZX8Whxu1j0z-Bev_WGwW60ZGOPN7Aw@mail.gmail.com>
 <004c01d8a84b$0332e3f0$0998abd0$@gmail.com>
 <CAP9Tep4pbvbC_OZSvB+qXDVuZZffZ0rH5KVo4ZSNoXcU1nncDg@mail.gmail.com>
Message-ID: <005301d8a84d$60dd1780$22974680$@gmail.com>

Please don?t bang your head? everybody is here for you.
Sometimes it takes time to respond but you will get your answers.
 
https://www.ngtech.co.il/squid/support-save/support-save-2022-08-05_00-51-47.tar.gz
 
Is not the fastest connection and it has a blacklist in the DB dump so for now it?s a production system but works good enough for me.
I hope it?s not too much information in the support save file.
 
Let me know if it makes more sense for you.
Also I am happy that you have asked this question since now others can enjoy from the answer ?
 
Eliezer
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> 
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/
 
From: Adam Barnett <abarnett at belofx.com> 
Sent: Friday, 5 August 2022 0:44
To: ngtech1ltd at gmail.com
Cc: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Squid and Epic Games HCapctca
 
Sure, the more the beter, ive been banging my head against the wall for a while on this
 
Adam 
 
On Thu, 4 Aug 2022 at 22:41, <ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> > wrote:
You are welcome.
 
I wrote an app that does everything for me so I just need to dump the database into a:
ssl::server_name directive
 
it?s basically:
## START
acl NoBump_server_name ssl::server_name "/etc/squid/no-ssl-bump-server-name.list"
 
acl tls_to_splice any-of inspect_only NoBump_src NoBump_server_name NoBump_server_regex_by_urls_domain NoBump_server_regex
 
ssl_bump peek app_matcher_helper
ssl_bump peek tls_s1_connect
 
ssl_bump bump app_matcher_helper
ssl_bump bump app_reader_helper
ssl_bump bump deny_note
 
ssl_bump splice app_matcher_helper
ssl_bump splice tls_to_splice
 
ssl_bump stare app_matcher_helper
ssl_bump stare tls_s2_client_hello
 
ssl_bump bump app_matcher_helper
ssl_bump bump tls_to_bump
## END
 
If you want I can upload a snippet of the whole setup dump with hope you could make use of it.
 
Eliezer
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> 
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/
 
From: Adam Barnett <abarnett at belofx.com <mailto:abarnett at belofx.com> > 
Sent: Friday, 5 August 2022 0:26
To: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> 
Cc: squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> 
Subject: Re: [squid-users] Squid and Epic Games HCapctca
 
???? ???
It looks like you are using a database and then building the config from that? any cahnce you can send me the snippet of the config instead of the DB bits? ? 
 
Thanks again 
 
Adam 
 
On Thu, 4 Aug 2022 at 22:18, <ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> > wrote:
Hey Adam,
 
I recorded a video for you on how I do it at:
https://cloud1.ngtech.co.il/static/squid-data/splice-epic-games.mp4
 
So basically the relevant domains are:
 
epicgames-download1.akamaized.net <http://epicgames-download1.akamaized.net> 
.epicgames.com <http://epicgames.com> 
.unrealengine.com <http://unrealengine.com> 
 
And you can peek at robert k Wild mail: ?regex for normal websites?
 
And it contains the relevant technical details.
If for any reason you need a more detailed answer let me know.
 
Yours,
Eliezer 
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> 
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/
 
From: squid-users <squid-users-bounces at lists.squid-cache.org <mailto:squid-users-bounces at lists.squid-cache.org> > On Behalf Of Adam Barnett
Sent: Thursday, 4 August 2022 14:28
To: squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> 
Subject: [squid-users] Squid and Epic Games HCapctca
 
Hi All, 
 
I am trying to get squid to allow me to login to Epicgames.com with my epic login, i get to the login page and get the hcaptca images and everytime i get "invalid response" 
 
i looked at the headers and the only error that i can see is "The cache information is missing from the entry" 
 
My config looks like so 

workers 2

```
# Leave coredumps in the first cache dir
coredump_dir /var/spool/squid

http_port 3128 ssl-bump  dynamic_cert_mem_cache_size=16MB  generate-host-certificates=on cert=/etc/squid/certs/squid-ca-cert-key.pem

sslcrtd_program /usr/lib64/squid/security_file_certgen -s /var/spool/squid/ssl -M 16MB
dns_nameservers 10.5.1.2 8.8.8.8
visible_hostname foo-proxy-1
forwarded_for truncate
via off

# Send to file
access_log daemon:/var/log/squid/access.log



acl CONNECT method CONNECT
acl local src 10.0.0.0/8 <http://10.0.0.0/8> 
always_direct allow all
request_header_add X-GoogApps-Allowed-Domains "foo.com <http://foo.com> " all

memory_replacement_policy heap GDSF
maximum_object_size 100 KB
maximum_object_size 1 MB

cache allow all
cache_mem 256 MB
cache_dir rock /var/spool/squid 1024
memory_pools off
cache_swap_low 90
client_persistent_connections on


http_access allow localhost manager
http_access deny manager

# SquidGaurd
url_rewrite_program /usr/bin/squidGuard
```

Any suggestions? 
 
Thanks
	



Adam Barnett
Senior SysAdmin beloFX
	

	


  <https://cdn.gifo.wisestamp.com/s/rich-field-email-1/F1C13B/22/trans.png> 
 
 <https://514584150-atari-embeds.googleusercontent.com/embeds/16cb204cf3a9d4d223a0a3fd8b0eec5d/inner-frame-minified.html?jsh=m%3B%2F_%2Fscs%2Fabc-static%2F_%2Fjs%2Fk%3Dgapi.lb.en.dzXZWX9QTbE.O%2Fd%3D1%2Frs%3DAHpOoo_epIQDPHdjFr3MLkazUi2Jmy50dQ%2Fm%3D__features__> abarnett at belofx.com


  <https://cdn.gifo.wisestamp.com/s/rich-field-website-1/F1C13B/22/trans.png> 
 
 <http://www.belofx.com/> www.belofx.com


  <https://cdn.gifo.wisestamp.com/s/rich-field-website-3/F1C13B/22/trans.png> 
 
 <http://www.linkedin.com/company/belofx> LinkedIn
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220805/28c5a474/attachment.htm>

From abarnett at belofx.com  Fri Aug  5 09:10:42 2022
From: abarnett at belofx.com (Adam Barnett)
Date: Fri, 5 Aug 2022 10:10:42 +0100
Subject: [squid-users] Squid and Epic Games HCapctca
In-Reply-To: <005301d8a84d$60dd1780$22974680$@gmail.com>
References: <CAP9Tep55nVJDAcrTPJxsoKJnwk4bs2eTbuo-s7CwDCgzpQwBqA@mail.gmail.com>
 <004501d8a847$ba5051c0$2ef0f540$@gmail.com>
 <CAP9Tep7KBCvc4OqcOXOQZX8Whxu1j0z-Bev_WGwW60ZGOPN7Aw@mail.gmail.com>
 <004c01d8a84b$0332e3f0$0998abd0$@gmail.com>
 <CAP9Tep4pbvbC_OZSvB+qXDVuZZffZ0rH5KVo4ZSNoXcU1nncDg@mail.gmail.com>
 <005301d8a84d$60dd1780$22974680$@gmail.com>
Message-ID: <CAP9Tep6xgTRd2sBrNju72mVWQtMY4xa==0e2DSzZGtHrbVpe9A@mail.gmail.com>

Hi

Thanks for the config, but maybe i am doing something wrong, here is my
config

```
workers 2

# Leave coredumps in the first cache dir
coredump_dir /var/spool/squid

http_port 3128 ssl-bump dynamic_cert_mem_cache_size=16MB
 generate-host-certificates=on cert=/etc/squid/certs/squid-ca-cert-key.pem
sslcrtd_program /usr/lib64/squid/security_file_certgen -s
/var/spool/squid/ssl -M 16MB
tls_outgoing_options options=NO_SSLv3,SINGLE_DH_USE
dns_nameservers 10.5.1.2 8.8.8.8
visible_hostname can-proxy-1
forwarded_for delete
via off
host_verify_strict off
dns_v4_first on
client_dst_passthru on
read_ahead_gap 64 MB
shutdown_lifetime 10 seconds


# Send to file
access_log daemon:/var/log/squid/access.log


acl CONNECT method CONNECT

acl CONNECT method CONNECT
acl local src 10.0.0.0/8
always_direct allow all
request_header_add X-GoogApps-Allowed-Domains "belofx.com" all

memory_replacement_policy heap GDSF
maximum_object_size 100 KB
maximum_object_size 1 MB

cache allow all
cache_mem 256 MB
cache_dir rock /var/spool/squid 1024
memory_pools off
cache_swap_low 90
client_persistent_connections off



http_access allow localhost manager
http_access deny manager

# SquidGaurd
url_rewrite_program /usr/bin/squidGuard


acl fetched_certificate transaction_initiator certificate-fetching

acl step1 at_step SslBump1
acl step2 at_step SslBump2
acl step3 at_step SslBump3

acl tls_s1_connect at_step SslBump1
acl tls_s2_client_hello at_step SslBump2
acl tls_s3_server_hello at_step SslBump3


http_access allow fetched_certificate
acl bump_note note bump 1
acl splice_note note splice 1


acl dst_quixel url_regex epicgames.com
http_access allow local dst_quixel

ssl_bump splice dst_shotgrid dst_misc_urls_pac dst_keybase dst_quixel
dst_adobe_cc dst_maxon dst_msupdates maxon_ip
ssl_bump bump dst_quixel
ssl_bump peek dst_quixel
ssl_bump stare dst_quixel
strip_query_terms off



always_direct allow all
sslproxy_cert_error allow all
sslproxy_flags DONT_VERIFY_PEER

# Block everythng else
http_access deny all
```
Thanks

On Thu, 4 Aug 2022 at 22:58, <ngtech1ltd at gmail.com> wrote:

> Please don?t bang your head? everybody is here for you.
>
> Sometimes it takes time to respond but you will get your answers.
>
>
>
>
> https://www.ngtech.co.il/squid/support-save/support-save-2022-08-05_00-51-47.tar.gz
>
>
>
> Is not the fastest connection and it has a blacklist in the DB dump so for
> now it?s a production system but works good enough for me.
>
> I hope it?s not too much information in the support save file.
>
>
>
> Let me know if it makes more sense for you.
>
> Also I am happy that you have asked this question since now others can
> enjoy from the answer ?
>
>
>
> Eliezer
>
>
>
> ----
>
> Eliezer Croitoru
>
> NgTech, Tech Support
>
> Mobile: +972-5-28704261
>
> Email: ngtech1ltd at gmail.com
>
> Web: https://ngtech.co.il/
>
> My-Tube: https://tube.ngtech.co.il/
>
>
>
> *From:* Adam Barnett <abarnett at belofx.com>
> *Sent:* Friday, 5 August 2022 0:44
> *To:* ngtech1ltd at gmail.com
> *Cc:* squid-users at lists.squid-cache.org
> *Subject:* Re: [squid-users] Squid and Epic Games HCapctca
>
>
>
> Sure, the more the beter, ive been banging my head against the wall for a
> while on this
>
>
>
> Adam
>
>
>
> On Thu, 4 Aug 2022 at 22:41, <ngtech1ltd at gmail.com> wrote:
>
> You are welcome.
>
>
>
> I wrote an app that does everything for me so I just need to dump the
> database into a:
>
> ssl::server_name directive
>
>
>
> it?s basically:
>
> ## START
>
> acl NoBump_server_name ssl::server_name "/etc/squid/no-ssl-bump-server-
> name.list"
>
>
>
> acl tls_to_splice any-of inspect_only NoBump_src NoBump_server_name
> NoBump_server_regex_by_urls_domain NoBump_server_regex
>
>
>
> ssl_bump peek app_matcher_helper
>
> ssl_bump peek tls_s1_connect
>
>
>
> ssl_bump bump app_matcher_helper
>
> ssl_bump bump app_reader_helper
>
> ssl_bump bump deny_note
>
>
>
> ssl_bump splice app_matcher_helper
>
> ssl_bump splice tls_to_splice
>
>
>
> ssl_bump stare app_matcher_helper
>
> ssl_bump stare tls_s2_client_hello
>
>
>
> ssl_bump bump app_matcher_helper
>
> ssl_bump bump tls_to_bump
>
> ## END
>
>
>
> If you want I can upload a snippet of the whole setup dump with hope you
> could make use of it.
>
>
>
> Eliezer
>
>
>
> ----
>
> Eliezer Croitoru
>
> NgTech, Tech Support
>
> Mobile: +972-5-28704261
>
> Email: ngtech1ltd at gmail.com
>
> Web: https://ngtech.co.il/
>
> My-Tube: https://tube.ngtech.co.il/
>
>
>
> *From:* Adam Barnett <abarnett at belofx.com>
> *Sent:* Friday, 5 August 2022 0:26
> *To:* ngtech1ltd at gmail.com
> *Cc:* squid-users at lists.squid-cache.org
> *Subject:* Re: [squid-users] Squid and Epic Games HCapctca
>
>
>
> ???? ???
> It looks like you are using a database and then building the config from
> that? any cahnce you can send me the snippet of the config instead of the
> DB bits? ?
>
>
>
> Thanks again
>
>
>
> Adam
>
>
>
> On Thu, 4 Aug 2022 at 22:18, <ngtech1ltd at gmail.com> wrote:
>
> Hey Adam,
>
>
>
> I recorded a video for you on how I do it at:
>
> https://cloud1.ngtech.co.il/static/squid-data/splice-epic-games.mp4
>
>
>
> So basically the relevant domains are:
>
>
>
> epicgames-download1.akamaized.net
>
> .epicgames.com
>
> .unrealengine.com
>
>
>
> And you can peek at robert k Wild mail: ?regex for normal websites?
>
>
>
> And it contains the relevant technical details.
>
> If for any reason you need a more detailed answer let me know.
>
>
>
> Yours,
>
> Eliezer
>
>
>
> ----
>
> Eliezer Croitoru
>
> NgTech, Tech Support
>
> Mobile: +972-5-28704261
>
> Email: ngtech1ltd at gmail.com
>
> Web: https://ngtech.co.il/
>
> My-Tube: https://tube.ngtech.co.il/
>
>
>
> *From:* squid-users <squid-users-bounces at lists.squid-cache.org> *On
> Behalf Of *Adam Barnett
> *Sent:* Thursday, 4 August 2022 14:28
> *To:* squid-users at lists.squid-cache.org
> *Subject:* [squid-users] Squid and Epic Games HCapctca
>
>
>
> Hi All,
>
>
>
> I am trying to get squid to allow me to login to Epicgames.com with my
> epic login, i get to the login page and get the hcaptca images and
> everytime i get "invalid response"
>
>
>
> i looked at the headers and the only error that i can see is "The
> cache information is missing from the entry"
>
>
>
> My config looks like so
>
> workers 2
>
> ```
> # Leave coredumps in the first cache dir
> coredump_dir /var/spool/squid
>
> http_port 3128 ssl-bump  dynamic_cert_mem_cache_size=16MB
>  generate-host-certificates=on cert=/etc/squid/certs/squid-ca-cert-key.pem
>
> sslcrtd_program /usr/lib64/squid/security_file_certgen -s
> /var/spool/squid/ssl -M 16MB
> dns_nameservers 10.5.1.2 8.8.8.8
> visible_hostname foo-proxy-1
> forwarded_for truncate
> via off
>
> # Send to file
> access_log daemon:/var/log/squid/access.log
>
>
>
> acl CONNECT method CONNECT
> acl local src 10.0.0.0/8
> always_direct allow all
> request_header_add X-GoogApps-Allowed-Domains "foo.com" all
>
> memory_replacement_policy heap GDSF
> maximum_object_size 100 KB
> maximum_object_size 1 MB
>
> cache allow all
> cache_mem 256 MB
> cache_dir rock /var/spool/squid 1024
> memory_pools off
> cache_swap_low 90
> client_persistent_connections on
>
>
> http_access allow localhost manager
> http_access deny manager
>
> # SquidGaurd
> url_rewrite_program /usr/bin/squidGuard
> ```
>
> Any suggestions?
>
>
>
> Thanks
>
> Adam Barnett
> Senior SysAdmin beloFX
>
>
>
> abarnett at belofx.com
> <https://514584150-atari-embeds.googleusercontent.com/embeds/16cb204cf3a9d4d223a0a3fd8b0eec5d/inner-frame-minified.html?jsh=m%3B%2F_%2Fscs%2Fabc-static%2F_%2Fjs%2Fk%3Dgapi.lb.en.dzXZWX9QTbE.O%2Fd%3D1%2Frs%3DAHpOoo_epIQDPHdjFr3MLkazUi2Jmy50dQ%2Fm%3D__features__>
>
>
>
> www.belofx.com
>
>
>
> LinkedIn <http://www.linkedin.com/company/belofx>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220805/43be5591/attachment.htm>

From robertkwild at gmail.com  Fri Aug  5 10:23:44 2022
From: robertkwild at gmail.com (robert k Wild)
Date: Fri, 5 Aug 2022 11:23:44 +0100
Subject: [squid-users] regex for normal websites
In-Reply-To: <000701d8a7e0$87d5fa90$9781efb0$@gmail.com>
References: <CAGU_CiJimq7-co9QCVT1+-NF8Y_V4pECVRiow_eOhh=rfXHK6g@mail.gmail.com>
 <004f01d8a67b$ef6e4880$ce4ad980$@gmail.com>
 <CAGU_CiJ9n1c8FjVxOMtaqERTScyGBBWa_Y-z+k3dL3ooppfZPw@mail.gmail.com>
 <202208021732.14822.Antony.Stone@squid.open.source.it>
 <CAGU_Ci+8JNHWRS3Nx_OA1hCHtypj5-jW14T6QET_N=0QpO_CYA@mail.gmail.com>
 <YulO+tFla+o8gTiV@fantomas.sk>
 <CAGU_CiJvc3DrwS-GLd5-2WwBo7V-K0E9muk3SbaXQG=hD=q=rA@mail.gmail.com>
 <6566b26b-41c4-6069-fa0b-084cae57011b@treenet.co.nz>
 <YuozWB5vtwseuh36@fantomas.sk>
 <CAGU_Ci+W186g5CeSs85GBYBpL1hLdKS6T63MS4bJot27hwG=LQ@mail.gmail.com>
 <000701d8a7e0$87d5fa90$9781efb0$@gmail.com>
Message-ID: <CAGU_CiJazpy_HRd5r_j=CR-hUEDP-bTA-qNyNDYs73Sbzwj-gQ@mail.gmail.com>

wow thanks Eliezer so much for that video, that website looks awesome, ive
bookmarked it already

On Thu, 4 Aug 2022 at 09:59, <ngtech1ltd at gmail.com> wrote:

> Hey Robert,
>
>
>
> I recorded this video for you:
>
> https://cloud1.ngtech.co.il/static/squid-data/regex-for-robert.mp4
>
>
>
> This is what I did when I reviewed the question.
>
> I hope it will help you and others use this tool:
>
> https://rubular.com/
>
>
>
> and squid.
>
>
>
> If you have any question regarding REGEX here we are welcoming every
> question.
>
>
>
> All The Bests and Hope This Helps,
>
> Eliezer
>
>
>
>
>
> ----
>
> Eliezer Croitoru
>
> NgTech, Tech Support
>
> Mobile: +972-5-28704261
>
> Email: ngtech1ltd at gmail.com
>
> Web: https://ngtech.co.il/
>
> My-Tube: https://tube.ngtech.co.il/
>
>
>
> *From:* squid-users <squid-users-bounces at lists.squid-cache.org> *On
> Behalf Of *robert k Wild
> *Sent:* Wednesday, 3 August 2022 14:52
> *To:* Squid Users <squid-users at lists.squid-cache.org>
> *Subject:* Re: [squid-users] regex for normal websites
>
>
>
> thanks Amos for this greatly appreciated
>
>
>
> On Wed, 3 Aug 2022 at 09:35, Matus UHLAR - fantomas <uhlar at fantomas.sk>
> wrote:
>
> On 03.08.22 14:12, Amos Jeffries wrote:
> >IMO, what you are looking for is actually this ACL definition:
> >
> > acl adobe ssl::server_name .adobe.com
> >
> >or its regex equivalent,
> >
> > acl adobe ssl::server_name_regex (^|\.)adobe\.com$
>
> this is what I was searching for. Squid FAQ says:
>
>
> https://wiki.squid-cache.org/SquidFaq/SquidAcl#Squid_doesn.27t_match_my_subdomains
>
> www.example.com matches the exact host www.example.com, while .example.com
> matches the entire domain example.com (including example.com alone)
>
>
> but I wasn't sure if this matching also applies to ssl::server_name.
>
> thanks
> --
> Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
> Warning: I wish NOT to receive e-mail advertising to this address.
> Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
> I don't have lysdexia. The Dog wouldn't allow that.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
>
>
> --
>
> Regards,
>
> Robert K Wild.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>


-- 
Regards,

Robert K Wild.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220805/2dc1f830/attachment.htm>

From ngtech1ltd at gmail.com  Fri Aug  5 11:35:23 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Fri, 5 Aug 2022 14:35:23 +0300
Subject: [squid-users] regex for normal websites
In-Reply-To: <CAGU_CiJazpy_HRd5r_j=CR-hUEDP-bTA-qNyNDYs73Sbzwj-gQ@mail.gmail.com>
References: <CAGU_CiJimq7-co9QCVT1+-NF8Y_V4pECVRiow_eOhh=rfXHK6g@mail.gmail.com>
 <004f01d8a67b$ef6e4880$ce4ad980$@gmail.com>
 <CAGU_CiJ9n1c8FjVxOMtaqERTScyGBBWa_Y-z+k3dL3ooppfZPw@mail.gmail.com>
 <202208021732.14822.Antony.Stone@squid.open.source.it>
 <CAGU_Ci+8JNHWRS3Nx_OA1hCHtypj5-jW14T6QET_N=0QpO_CYA@mail.gmail.com>
 <YulO+tFla+o8gTiV@fantomas.sk>
 <CAGU_CiJvc3DrwS-GLd5-2WwBo7V-K0E9muk3SbaXQG=hD=q=rA@mail.gmail.com>
 <6566b26b-41c4-6069-fa0b-084cae57011b@treenet.co.nz>
 <YuozWB5vtwseuh36@fantomas.sk>
 <CAGU_Ci+W186g5CeSs85GBYBpL1hLdKS6T63MS4bJot27hwG=LQ@mail.gmail.com>
 <000701d8a7e0$87d5fa90$9781efb0$@gmail.com>
 <CAGU_CiJazpy_HRd5r_j=CR-hUEDP-bTA-qNyNDYs73Sbzwj-gQ@mail.gmail.com>
Message-ID: <006801d8a8bf$74832000$5d896000$@gmail.com>

OK Robert,
 
I have seen the issue you were having and indeed it?s because cloudflare understands that there is some kind of MITM in the path.
It?s good but there should be a way to allow such MITM from cloudflare side.
I believe that the cloudflare client should have the ability to allow or disallow MITM such as squid to allow caching on the path.
However in this specific case EpicGames like Microsoft transfer their actual updates over http and allow caching so it?s OK.
 
The next squid.conf is working but I have not tested it with squidGuard on.
I can test it with squidGuard next week:
## START
workers 2
 
visible_hostname can-proxy-1
forwarded_for delete
via off
host_verify_strict off
client_dst_passthru on
read_ahead_gap 64 MB
shutdown_lifetime 10 seconds
 
acl fetched_certificate transaction_initiator certificate-fetching
 
acl deny_note note verdict deny
 
acl NoBump_server_name ssl::server_name "/etc/squid/no-ssl-bump-server-name.list"
acl dst_quixel ssl::server_name .epicgames.com epicgames-download1.akamaized.net .unrealengine.com
acl dst_quixel_dstdomain dstdomain .epicgames.com epicgames-download1.akamaized.net .unrealengine.com
 
acl Bump_server_name ssl::server_name "/etc/squid/ssl-bump-server-name.list"
 
acl fetched_certificate transaction_initiator certificate-fetching
 
acl step1 at_step SslBump1
acl step2 at_step SslBump2
acl step3 at_step SslBump3
 
acl tls_s1_connect at_step SslBump1
acl tls_s2_client_hello at_step SslBump2
acl tls_s3_server_hello at_step SslBump3
 
acl tls_to_splice any-of NoBump_server_name
acl tls_to_bump any-of Bump_server_name
 
acl localnet src 0.0.0.1-0.255.255.255  # RFC 1122 "this" network (LAN)
acl localnet src 10.0.0.0/8             # RFC 1918 local private network (LAN)
acl localnet src 100.64.0.0/10          # RFC 6598 shared address space (CGN)
acl localnet src 169.254.0.0/16         # RFC 3927 link-local (directly plugged) machines
acl localnet src 172.16.0.0/12          # RFC 1918 local private network (LAN)
acl localnet src 192.168.0.0/16         # RFC 1918 local private network (LAN)
acl localnet src fc00::/7               # RFC 4193 local private network range
acl localnet src fe80::/10              # RFC 4291 link-local (directly plugged) machines
 
acl SSL_ports port 443
acl Safe_ports port 80          # http
acl Safe_ports port 21          # ftp
acl Safe_ports port 443         # https
acl Safe_ports port 70          # gopher
acl Safe_ports port 210         # wais
acl Safe_ports port 1025-65535  # unregistered ports
acl Safe_ports port 280         # http-mgmt
acl Safe_ports port 488         # gss-http
acl Safe_ports port 591         # filemaker
acl Safe_ports port 777         # multiling http
 
http_access deny !Safe_ports
 
http_access deny CONNECT !SSL_ports
 
http_access allow localhost manager
http_access deny manager
 
http_access allow fetched_certificate
http_access allow localnet dst_quixel_dstdomain
 
http_access allow localnet
http_access allow localhost
 
http_access deny all
 
http_port 3128 ssl-bump dynamic_cert_mem_cache_size=16MB generate-host-certificates=on cert=/etc/squid/certs/squid-ca-cert-key.pem
sslcrtd_program /usr/lib64/squid/security_file_certgen -s /var/spool/squid/ssl -M 16MB
tls_outgoing_options options=NO_SSLv3,SINGLE_DH_USE
 
ssl_bump peek tls_s1_connect
 
ssl_bump bump deny_note
 
ssl_bump splice dst_quixel
ssl_bump splice tls_to_splice
 
ssl_bump stare tls_s2_client_hello
 
ssl_bump bump tls_to_bump
 
strip_query_terms off
 
coredump_dir /var/spool/squid
 
refresh_pattern ^ftp:           1440    20%     10080
refresh_pattern ^gopher:        1440    0%      1440
refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
refresh_pattern .               0       20%     4320
## END
 
Let me know if it gives enough details for you to understand how to implement this.
By the way, a great proxy config you?v got there.
 
Demo of the diff:
https://cloud1.ngtech.co.il/static/squid-data/splice-epic-games-1.mp4
 
And a support-save of the setup:
https://cloud1.ngtech.co.il/static/squid-data/support-save-2022-08-05_14-16-59.tar.gz
 
I have used latest ngtech squid5.6 rpms from my repo.
 
Let me know if you need more assistance with your setup.
 
Yours,
Eliezer
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> 
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/
 
From: robert k Wild <robertkwild at gmail.com> 
Sent: Friday, 5 August 2022 13:24
To: Eliezer Croitoru <ngtech1ltd at gmail.com>
Cc: Squid Users <squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] regex for normal websites
 
wow thanks Eliezer so much for that video, that website looks awesome, ive bookmarked it already
 
On Thu, 4 Aug 2022 at 09:59, <ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> > wrote:
Hey Robert,
 
I recorded this video for you:
https://cloud1.ngtech.co.il/static/squid-data/regex-for-robert.mp4
 
This is what I did when I reviewed the question.
I hope it will help you and others use this tool:
https://rubular.com/
 
and squid.
 
If you have any question regarding REGEX here we are welcoming every question.
 
All The Bests and Hope This Helps,
Eliezer
 
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> 
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/
 
From: squid-users <squid-users-bounces at lists.squid-cache.org <mailto:squid-users-bounces at lists.squid-cache.org> > On Behalf Of robert k Wild
Sent: Wednesday, 3 August 2022 14:52
To: Squid Users <squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> >
Subject: Re: [squid-users] regex for normal websites
 
thanks Amos for this greatly appreciated
 
On Wed, 3 Aug 2022 at 09:35, Matus UHLAR - fantomas <uhlar at fantomas.sk <mailto:uhlar at fantomas.sk> > wrote:
On 03.08.22 14:12, Amos Jeffries wrote:
>IMO, what you are looking for is actually this ACL definition:
>
> acl adobe ssl::server_name .adobe.com <http://adobe.com> 
>
>or its regex equivalent,
>
> acl adobe ssl::server_name_regex (^|\.)adobe\.com$

this is what I was searching for. Squid FAQ says:

https://wiki.squid-cache.org/SquidFaq/SquidAcl#Squid_doesn.27t_match_my_subdomains

www.example.com <http://www.example.com>  matches the exact host www.example.com <http://www.example.com> , while .example.com <http://example.com>  
matches the entire domain example.com <http://example.com>  (including example.com <http://example.com>  alone)


but I wasn't sure if this matching also applies to ssl::server_name.

thanks
-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk <mailto:uhlar at fantomas.sk>  ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
I don't have lysdexia. The Dog wouldn't allow that.
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> 
http://lists.squid-cache.org/listinfo/squid-users


-- 
Regards, 

Robert K Wild.
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> 
http://lists.squid-cache.org/listinfo/squid-users


-- 
Regards, 

Robert K Wild.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220805/3e576266/attachment.htm>

From ngtech1ltd at gmail.com  Fri Aug  5 14:26:31 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Fri, 5 Aug 2022 17:26:31 +0300
Subject: [squid-users] Trying to recompile squid 4.13 with ./configure
 CXXFLAGS="-DMAXTCPLISTENPORTS=256"
In-Reply-To: <54a883a8d8cccab67e625d8f1d9d8f25@graminsta.com.br>
References: <0198da0d56414a39bfeaf15fc21ab46e@graminsta.com.br>
 <54a883a8d8cccab67e625d8f1d9d8f25@graminsta.com.br>
Message-ID: <007b01d8a8d7$5c50bde0$14f239a0$@gmail.com>

Hey Marcelo,

What OS are you using? Debian? Ubuntu?
The `which squid` command will show you where squid binary of squid -v is being take/used from.
And also, just wondering why 4.13? and not 4.17?

Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of marcelorodrigo at graminsta.com.br
Sent: Thursday, 4 August 2022 1:17
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Trying to recompile squid 4.13 with ./configure CXXFLAGS="-DMAXTCPLISTENPORTS=256"

Some important information.

I am trying to recompile using:

./configure CXXFLAGS="-DMAXTCPLISTENPORTS=10000 -g -O2 -fPIE 
-fstack-protector-strong -Wformat -Werror=format-security" 
--build="x86_64-linux-gnu" --prefix="/usr" 
--includedir="${prefix}/include" --mandir="${prefix}/share/man" 
--infodir="${prefix}/share/info" --sysconfdir="/etc" 
--localstatedir="/var" --libexecdir="${prefix}/lib/squid3" --srcdir="." 
--disable-maintainer-mode --disable-dependency-tracking 
--disable-silent-rules BUILDCXXFLAGS="-g -O2 -fPIE 
-fstack-protector-strong -Wformat -Werror=format-security 
-Wl,-Bsymbolic-functions -fPIE -pie -Wl,-z,relro -Wl,-z,now" 
--datadir="/usr/share/squid" --sysconfdir="/etc/squid" 
--libexecdir="/usr/lib/squid" --mandir="/usr/share/man" --enable-inline 
--disable-arch-native --enable-async-io="8" 
--enable-storeio="ufs,aufs,diskd,rock" 
--enable-removal-policies="lru,heap" --enable-delay-pools 
--enable-cache-digests --enable-icap-client 
--enable-follow-x-forwarded-for 
--enable-auth-basic="DB,fake,getpwnam,LDAP,NCSA,NIS,PAM,POP3,RADIUS,SASL,SMB" 
--enable-auth-digest="file,LDAP" 
--enable-auth-negotiate="kerberos,wrapper" 
--enable-auth-ntlm="fake,smb_lm" 
--enable-external-acl-helpers="file_userip,kerberos_ldap_group,LDAP_group,session,SQL_session,unix_group,wbinfo_group" 
--enable-url-rewrite-helpers="fake" --enable-eui --enable-esi 
--enable-icmp --enable-zph-qos --enable-ecap --disable-translation 
--with-swapdir="/var/spool/squid" --with-logdir="/var/log/squid" 
--with-pidfile="/var/run/squid.pid" --with-filedescriptors="65536" 
--with-large-files --with-default-user="proxy" 
--enable-build-info="Ubuntu linux" --enable-linux-netfilter 
build_alias="x86_64-linux-gnu" CFLAGS="-g -O2 -fPIE 
-fstack-protector-strong -Wformat -Werror=format-security -Wall" 
LDFLAGS="-Wl,-Bsymbolic-functions -fPIE -pie -Wl,-z,relro -Wl,-z,now" 
CPPFLAGS="-Wdate-time -D_FORTIFY_SOURCE=2" --with-openssl 
--enable-ssl-crtd

Then make and make install from /build/squid/squid-4.13/ folder, but 
nothin seems to change when squid -v is used.

I also tryied do recompile with this example:

./configure --build="x86_64-linux-gnu" --prefix="/usr" 
--includedir="${prefix}/include" --mandir="${prefix}/share/man" 
--infodir="${prefix}/share/info" --sysconfdir="/etc" 
--localstatedir="/var" --libexecdir="${prefix}/lib/squid3" --srcdir="." 
--disable-maintainer-mode --disable-dependency-tracking 
--disable-silent-rules BUILDCXXFLAGS="-g -O2 -fPIE 
-fstack-protector-strong -Wformat -Werror=format-security 
-Wl,-Bsymbolic-functions -fPIE -pie -Wl,-z,relro -Wl,-z,now" 
--datadir="/usr/share/squid" --sysconfdir="/etc/squid" 
--libexecdir="/usr/lib/squid" --mandir="/usr/share/man" --enable-inline 
--disable-arch-native --enable-async-io="8" 
--enable-storeio="ufs,aufs,diskd,rock" 
--enable-removal-policies="lru,heap" --enable-delay-pools 
--enable-cache-digests --enable-icap-client 
--enable-follow-x-forwarded-for 
--enable-auth-basic="DB,fake,getpwnam,LDAP,NCSA,NIS,PAM,POP3,RADIUS,SASL,SMB" 
--enable-auth-digest="file,LDAP" 
--enable-auth-negotiate="kerberos,wrapper" 
--enable-auth-ntlm="fake,smb_lm" 
--enable-external-acl-helpers="file_userip,kerberos_ldap_group,LDAP_group,session,SQL_session,unix_group,wbinfo_group" 
--enable-url-rewrite-helpers="fake" --enable-eui --enable-esi 
--enable-icmp --enable-zph-qos --enable-ecap --disable-translation 
--with-swapdir="/var/spool/squid" --with-logdir="/var/log/squid" 
--with-pidfile="/var/run/squid.pid" --with-filedescriptors="65536" 
--with-large-files --with-default-user="proxy" 
--enable-build-info="Ubuntu linux" --enable-linux-netfilter 
build_alias="x86_64-linux-gnu" CFLAGS="-g -O2 -fPIE 
-fstack-protector-strong -Wformat -Werror=format-security -Wall" 
LDFLAGS="-Wl,-Bsymbolic-functions -fPIE -pie -Wl,-z,relro -Wl,-z,now" 
CPPFLAGS="-Wdate-time -D_FORTIFY_SOURCE=2" 
CXXFLAGS="-DMAXTCPLISTENPORTS=450 -g -O2 -fPIE -fstack-protector-strong 
-Wformat -Werror=format-security"

I used several virtualserver sessions and clones, but the 
CXXFLAGS="-DMAXTCPLISTENPORTS=" dont appears in the squid -v

What is wrong in this rebuilding?


On 2022-08-03 11:12, marcelorodrigo at graminsta.com.br wrote:
> Hi,
> 
> I am trying to recompile squid 4.13 using ./configure
> CXXFLAGS="-DMAXTCPLISTENPORTS=256".
> It runs the recompile but the CXXFLAGS= does not even appears in the 
> squid -v.
> 
> Is there a way to include this feature in the squid instalation?
> 
> Tks.
> Marcelo.
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From rousskov at measurement-factory.com  Fri Aug  5 14:57:02 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Fri, 5 Aug 2022 10:57:02 -0400
Subject: [squid-users] Squid and Epic Games HCapctca
In-Reply-To: <CAP9Tep6xgTRd2sBrNju72mVWQtMY4xa==0e2DSzZGtHrbVpe9A@mail.gmail.com>
References: <CAP9Tep55nVJDAcrTPJxsoKJnwk4bs2eTbuo-s7CwDCgzpQwBqA@mail.gmail.com>
 <004501d8a847$ba5051c0$2ef0f540$@gmail.com>
 <CAP9Tep7KBCvc4OqcOXOQZX8Whxu1j0z-Bev_WGwW60ZGOPN7Aw@mail.gmail.com>
 <004c01d8a84b$0332e3f0$0998abd0$@gmail.com>
 <CAP9Tep4pbvbC_OZSvB+qXDVuZZffZ0rH5KVo4ZSNoXcU1nncDg@mail.gmail.com>
 <005301d8a84d$60dd1780$22974680$@gmail.com>
 <CAP9Tep6xgTRd2sBrNju72mVWQtMY4xa==0e2DSzZGtHrbVpe9A@mail.gmail.com>
Message-ID: <075bbc18-b0f5-a037-d904-6b62ef72888f@measurement-factory.com>

On 8/5/22 05:10, Adam Barnett wrote:
> maybe i am doing something?wrong, here is my config

> ssl_bump splice ...
> ssl_bump bump dst_quixel
> ssl_bump peek dst_quixel
> ssl_bump stare dst_quixel


The combination of the last three ssl_bump rules does not make sense 
because Squid will never reach those peek and stare rules. The bump rule 
can be applied during any SslBump step, so Squid will not see any 
same-ACL ssl_bump directives below it -- the first matching rule (that 
can be applied during the current step) wins.

I do not know what logic you are trying to express with those rules, but 
the above configuration does not express that (or any) logic well. I 
hope Eliezer can guide you towards a reasonable solution here.


HTH,

Alex.



> 
> On Thu, 4 Aug 2022 at 22:58, <ngtech1ltd at gmail.com 
> <mailto:ngtech1ltd at gmail.com>> wrote:
> 
>     Please don?t bang your head? everybody is here for you.____
> 
>     Sometimes it takes time to respond but you will get your answers.____
> 
>     __ __
> 
>     https://www.ngtech.co.il/squid/support-save/support-save-2022-08-05_00-51-47.tar.gz
>     <https://www.ngtech.co.il/squid/support-save/support-save-2022-08-05_00-51-47.tar.gz>____
> 
>     __ __
> 
>     Is not the fastest connection and it has a blacklist in the DB dump
>     so for now it?s a production system but works good enough for me.____
> 
>     I hope it?s not too much information in the support save file.____
> 
>     __ __
> 
>     Let me know if it makes more sense for you.____
> 
>     AlsoI am happy that you have asked this question since now others
>     can enjoy from the answer ?____
> 
>     __ __
> 
>     Eliezer____
> 
>     __ __
> 
>     ----____
> 
>     Eliezer Croitoru____
> 
>     NgTech, Tech Support____
> 
>     Mobile: +972-5-28704261____
> 
>     Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com>____
> 
>     Web: https://ngtech.co.il/ <https://ngtech.co.il/>____
> 
>     My-Tube: https://tube.ngtech.co.il/ <https://tube.ngtech.co.il/>____
> 
>     __ __
> 
>     *From:*Adam Barnett <abarnett at belofx.com <mailto:abarnett at belofx.com>>
>     *Sent:* Friday, 5 August 2022 0:44
>     *To:* ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com>
>     *Cc:* squid-users at lists.squid-cache.org
>     <mailto:squid-users at lists.squid-cache.org>
>     *Subject:* Re: [squid-users] Squid and Epic Games HCapctca____
> 
>     __ __
> 
>     Sure, the more the beter, ive been banging my head against?the wall
>     for a while on this____
> 
>     __ __
> 
>     Adam ____
> 
>     __ __
> 
>     On Thu, 4 Aug 2022 at 22:41, <ngtech1ltd at gmail.com
>     <mailto:ngtech1ltd at gmail.com>> wrote:____
> 
>         You are welcome.____
> 
>         ____
> 
>         I wrote an app that does everything for me so I just need to
>         dump the database into a:____
> 
>         ssl::server_namedirective____
> 
>         ____
> 
>         it?s basically:____
> 
>         ## START____
> 
>         aclNoBump_server_name ssl::server_name
>         "/etc/squid/no-ssl-bump-server-name.list"____
> 
>         ____
> 
>         acltls_to_splice any-of inspect_only NoBump_src
>         NoBump_server_name NoBump_server_regex_by_urls_domain
>         NoBump_server_regex____
> 
>         ____
> 
>         ssl_bumppeek app_matcher_helper____
> 
>         ssl_bumppeek tls_s1_connect____
> 
>         ____
> 
>         ssl_bumpbump app_matcher_helper____
> 
>         ssl_bumpbump app_reader_helper____
> 
>         ssl_bumpbump deny_note____
> 
>         ____
> 
>         ssl_bumpsplice app_matcher_helper____
> 
>         ssl_bumpsplice tls_to_splice____
> 
>         ____
> 
>         ssl_bumpstare app_matcher_helper____
> 
>         ssl_bumpstare tls_s2_client_hello____
> 
>         ____
> 
>         ssl_bumpbump app_matcher_helper____
> 
>         ssl_bumpbump tls_to_bump____
> 
>         ## END____
> 
>         ____
> 
>         If you want I can upload a snippet of the whole setup dump with
>         hope you could make use of it.____
> 
>         ____
> 
>         Eliezer____
> 
>         ____
> 
>         ----____
> 
>         Eliezer Croitoru____
> 
>         NgTech, Tech Support____
> 
>         Mobile: +972-5-28704261____
> 
>         Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com>____
> 
>         Web: https://ngtech.co.il/ <https://ngtech.co.il/>____
> 
>         My-Tube: https://tube.ngtech.co.il/ <https://tube.ngtech.co.il/>____
> 
>         ____
> 
>         *From:*Adam Barnett <abarnett at belofx.com
>         <mailto:abarnett at belofx.com>>
>         *Sent:* Friday, 5 August 2022 0:26
>         *To:* ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com>
>         *Cc:* squid-users at lists.squid-cache.org
>         <mailto:squid-users at lists.squid-cache.org>
>         *Subject:* Re: [squid-users] Squid and Epic Games HCapctca____
> 
>         ____
> 
>         ???? ???
>         It looks like you are using a database and then building the
>         config from that? any cahnce?you can send me the snippet?of the
>         config instead of the DB bits? ? ____
> 
>         ____
> 
>         Thanks again ____
> 
>         ____
> 
>         Adam ____
> 
>         ____
> 
>         On Thu, 4 Aug 2022 at 22:18, <ngtech1ltd at gmail.com
>         <mailto:ngtech1ltd at gmail.com>> wrote:____
> 
>             Hey Adam,____
> 
>             ____
> 
>             I recorded a video for you on how I do it at:____
> 
>             https://cloud1.ngtech.co.il/static/squid-data/splice-epic-games.mp4
>             <https://cloud1.ngtech.co.il/static/squid-data/splice-epic-games.mp4>____
> 
>             ____
> 
>             So basically the relevant domains are:____
> 
>             ____
> 
>             epicgames-download1.akamaized.net
>             <http://epicgames-download1.akamaized.net>____
> 
>             .epicgames.com <http://epicgames.com>____
> 
>             .unrealengine.com <http://unrealengine.com>____
> 
>             ____
> 
>             And you can peek at robert k Wild mail: ?regex for normal
>             websites?____
> 
>             ____
> 
>             And it contains the relevant technical details.____
> 
>             If for any reason you need a more detailed answer let me
>             know.____
> 
>             ____
> 
>             Yours,____
> 
>             Eliezer ____
> 
>             ____
> 
>             ----____
> 
>             Eliezer Croitoru____
> 
>             NgTech, Tech Support____
> 
>             Mobile: +972-5-28704261____
> 
>             Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com>____
> 
>             Web: https://ngtech.co.il/ <https://ngtech.co.il/>____
> 
>             My-Tube: https://tube.ngtech.co.il/
>             <https://tube.ngtech.co.il/>____
> 
>             ____
> 
>             *From:*squid-users
>             <squid-users-bounces at lists.squid-cache.org
>             <mailto:squid-users-bounces at lists.squid-cache.org>> *On
>             Behalf Of *Adam Barnett
>             *Sent:* Thursday, 4 August 2022 14:28
>             *To:* squid-users at lists.squid-cache.org
>             <mailto:squid-users at lists.squid-cache.org>
>             *Subject:* [squid-users] Squid and Epic Games HCapctca____
> 
>             ____
> 
>             Hi All, ____
> 
>             ____
> 
>             I am trying to get squid to allow me to login to
>             Epicgames.com with my epic login, i get to the login page
>             and get the hcaptca?images and everytime i get "invalid
>             response" ____
> 
>             ____
> 
>             i looked at the headers and the only error that i can see is
>             "The cache?information?is missing from the entry" ____
> 
>             ____
> 
>             My config looks like so
> 
>             workers 2
> 
>             ```
>             # Leave coredumps in the first cache dir
>             coredump_dir /var/spool/squid
> 
>             http_port 3128 ssl-bump ?dynamic_cert_mem_cache_size=16MB
>              ?generate-host-certificates=on
>             cert=/etc/squid/certs/squid-ca-cert-key.pem
> 
>             sslcrtd_program /usr/lib64/squid/security_file_certgen -s
>             /var/spool/squid/ssl -M 16MB
>             dns_nameservers 10.5.1.2 8.8.8.8
>             visible_hostname foo-proxy-1
>             forwarded_for truncate
>             via off
> 
>             # Send to file
>             access_log daemon:/var/log/squid/access.log
> 
> 
> 
>             acl CONNECT method CONNECT
>             acl local src 10.0.0.0/8 <http://10.0.0.0/8>
>             always_direct allow all
>             request_header_add X-GoogApps-Allowed-Domains "foo.com
>             <http://foo.com>" all
> 
>             memory_replacement_policy heap GDSF
>             maximum_object_size 100 KB
>             maximum_object_size 1 MB
> 
>             cache allow all
>             cache_mem 256 MB
>             cache_dir rock /var/spool/squid 1024
>             memory_pools off
>             cache_swap_low 90
>             client_persistent_connections on
> 
> 
>             http_access allow localhost manager
>             http_access deny manager
> 
>             # SquidGaurd
>             url_rewrite_program /usr/bin/squidGuard
>             ```
> 
>             Any suggestions? ____
> 
>             ____
> 
>             Thanks____
> 
>             Adam Barnett
>             Senior SysAdmin beloFX____
> 
>             **____
> 
>             	
> 
>             ____
> 
>             	
> 
>             abarnett at belofx.com
>             <https://514584150-atari-embeds.googleusercontent.com/embeds/16cb204cf3a9d4d223a0a3fd8b0eec5d/inner-frame-minified.html?jsh=m%3B%2F_%2Fscs%2Fabc-static%2F_%2Fjs%2Fk%3Dgapi.lb.en.dzXZWX9QTbE.O%2Fd%3D1%2Frs%3DAHpOoo_epIQDPHdjFr3MLkazUi2Jmy50dQ%2Fm%3D__features__>____
> 
>             **____
> 
>             	
> 
>             ____
> 
>             	
> 
>             www.belofx.com <http://www.belofx.com/>____
> 
>             **____
> 
>             	
> 
>             ____
> 
>             	
> 
>             LinkedIn <http://www.linkedin.com/company/belofx>____
> 
>             ____
> 
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



From marcelorodrigo at graminsta.com.br  Sat Aug  6 17:03:47 2022
From: marcelorodrigo at graminsta.com.br (marcelorodrigo at graminsta.com.br)
Date: Sat, 06 Aug 2022 14:03:47 -0300
Subject: [squid-users] Trying to recompile squid 4.13
In-Reply-To: <mailman.1.1659787202.1945723.squid-users@lists.squid-cache.org>
References: <mailman.1.1659787202.1945723.squid-users@lists.squid-cache.org>
Message-ID: <687aac1508b25f4cdf6afaf5d8b3f478@graminsta.com.br>

Hey Eliezer and Alex,

Thanks for the answers.

The "make clean" command, this magic word "clean" have solved the issue.
It was 2 hopeless days searching the entire google for an answer.
Its very difficult to deal with squid with so missing and outdated 
documentation.

I appreciate all effort you and other guys do for squid, keeping squid 
alive and quicking ;)

As for me, seems like I will be using it for many years ahead.
The next chalenge is to implement ssl bumping with pear caching. Any 
sugestion about detailed documentation of it?

I would like to understand also why squid gets so slow when handling 
more than 128 IPs.
I am a proxy provider and it would be great to use less VPS. Its so 
expensive and hard working to manage all those VPSs.
Even with a good server with lots of CPU and RAM squid keeps slow. It 
dont use more resources to speed up. Is it a sw architeture limitation?

Its a shame that does not exist a team or even a guy that sells squid 
services/support now a days to implement squid features.

I just spent considerable money with squid/web services integration to 
deliver and manage users and proxies better.

Maybe would be better to open new threads about some of these topics 
above.
Anyway, I really miss tech guys squid experienced to talk and 
brainstorming.
Even with my almost 30 years working with IT infrastructure its hard to 
deal with squid alone.

Thanks again.

Marcelo
Wzp +55 11 968543878





On 2022-08-06 09:00, squid-users-request at lists.squid-cache.org wrote:
> Send squid-users mailing list submissions to
> 	squid-users at lists.squid-cache.org
> 
> To subscribe or unsubscribe via the World Wide Web, visit
> 	http://lists.squid-cache.org/listinfo/squid-users
> or, via email, send a message with subject or body 'help' to
> 	squid-users-request at lists.squid-cache.org
> 
> You can reach the person managing the list at
> 	squid-users-owner at lists.squid-cache.org
> 
> When replying, please edit your Subject line so it is more specific
> than "Re: Contents of squid-users digest..."
> 
> 
> Today's Topics:
> 
>    1. Re: Trying to recompile squid 4.13 with ./configure
>       CXXFLAGS="-DMAXTCPLISTENPORTS=256" (ngtech1ltd at gmail.com)
>    2. Re: Squid and Epic Games HCapctca (Alex Rousskov)
> 
> 
> ----------------------------------------------------------------------
> 
> Message: 1
> Date: Fri, 5 Aug 2022 17:26:31 +0300
> From: <ngtech1ltd at gmail.com>
> To: <squid-users at lists.squid-cache.org>
> Subject: Re: [squid-users] Trying to recompile squid 4.13 with
> 	./configure CXXFLAGS="-DMAXTCPLISTENPORTS=256"
> Message-ID: <007b01d8a8d7$5c50bde0$14f239a0$@gmail.com>
> Content-Type: text/plain;	charset="utf-8"
> 
> Hey Marcelo,
> 
> What OS are you using? Debian? Ubuntu?
> The `which squid` command will show you where squid binary of squid -v
> is being take/used from.
> And also, just wondering why 4.13? and not 4.17?
> 
> Eliezer
> 
> ----
> Eliezer Croitoru
> NgTech, Tech Support
> Mobile: +972-5-28704261
> Email: ngtech1ltd at gmail.com
> Web: https://ngtech.co.il/
> My-Tube: https://tube.ngtech.co.il/
> 
> -----Original Message-----
> From: squid-users <squid-users-bounces at lists.squid-cache.org> On
> Behalf Of marcelorodrigo at graminsta.com.br
> Sent: Thursday, 4 August 2022 1:17
> To: squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] Trying to recompile squid 4.13 with
> ./configure CXXFLAGS="-DMAXTCPLISTENPORTS=256"
> 
> Some important information.
> 
> I am trying to recompile using:
> 
> ./configure CXXFLAGS="-DMAXTCPLISTENPORTS=10000 -g -O2 -fPIE
> -fstack-protector-strong -Wformat -Werror=format-security"
> --build="x86_64-linux-gnu" --prefix="/usr"
> --includedir="${prefix}/include" --mandir="${prefix}/share/man"
> --infodir="${prefix}/share/info" --sysconfdir="/etc"
> --localstatedir="/var" --libexecdir="${prefix}/lib/squid3" --srcdir="."
> --disable-maintainer-mode --disable-dependency-tracking
> --disable-silent-rules BUILDCXXFLAGS="-g -O2 -fPIE
> -fstack-protector-strong -Wformat -Werror=format-security
> -Wl,-Bsymbolic-functions -fPIE -pie -Wl,-z,relro -Wl,-z,now"
> --datadir="/usr/share/squid" --sysconfdir="/etc/squid"
> --libexecdir="/usr/lib/squid" --mandir="/usr/share/man" --enable-inline
> --disable-arch-native --enable-async-io="8"
> --enable-storeio="ufs,aufs,diskd,rock"
> --enable-removal-policies="lru,heap" --enable-delay-pools
> --enable-cache-digests --enable-icap-client
> --enable-follow-x-forwarded-for
> --enable-auth-basic="DB,fake,getpwnam,LDAP,NCSA,NIS,PAM,POP3,RADIUS,SASL,SMB"
> --enable-auth-digest="file,LDAP"
> --enable-auth-negotiate="kerberos,wrapper"
> --enable-auth-ntlm="fake,smb_lm"
> --enable-external-acl-helpers="file_userip,kerberos_ldap_group,LDAP_group,session,SQL_session,unix_group,wbinfo_group"
> --enable-url-rewrite-helpers="fake" --enable-eui --enable-esi
> --enable-icmp --enable-zph-qos --enable-ecap --disable-translation
> --with-swapdir="/var/spool/squid" --with-logdir="/var/log/squid"
> --with-pidfile="/var/run/squid.pid" --with-filedescriptors="65536"
> --with-large-files --with-default-user="proxy"
> --enable-build-info="Ubuntu linux" --enable-linux-netfilter
> build_alias="x86_64-linux-gnu" CFLAGS="-g -O2 -fPIE
> -fstack-protector-strong -Wformat -Werror=format-security -Wall"
> LDFLAGS="-Wl,-Bsymbolic-functions -fPIE -pie -Wl,-z,relro -Wl,-z,now"
> CPPFLAGS="-Wdate-time -D_FORTIFY_SOURCE=2" --with-openssl
> --enable-ssl-crtd
> 
> Then make and make install from /build/squid/squid-4.13/ folder, but
> nothin seems to change when squid -v is used.
> 
> I also tryied do recompile with this example:
> 
> ./configure --build="x86_64-linux-gnu" --prefix="/usr"
> --includedir="${prefix}/include" --mandir="${prefix}/share/man"
> --infodir="${prefix}/share/info" --sysconfdir="/etc"
> --localstatedir="/var" --libexecdir="${prefix}/lib/squid3" --srcdir="."
> --disable-maintainer-mode --disable-dependency-tracking
> --disable-silent-rules BUILDCXXFLAGS="-g -O2 -fPIE
> -fstack-protector-strong -Wformat -Werror=format-security
> -Wl,-Bsymbolic-functions -fPIE -pie -Wl,-z,relro -Wl,-z,now"
> --datadir="/usr/share/squid" --sysconfdir="/etc/squid"
> --libexecdir="/usr/lib/squid" --mandir="/usr/share/man" --enable-inline
> --disable-arch-native --enable-async-io="8"
> --enable-storeio="ufs,aufs,diskd,rock"
> --enable-removal-policies="lru,heap" --enable-delay-pools
> --enable-cache-digests --enable-icap-client
> --enable-follow-x-forwarded-for
> --enable-auth-basic="DB,fake,getpwnam,LDAP,NCSA,NIS,PAM,POP3,RADIUS,SASL,SMB"
> --enable-auth-digest="file,LDAP"
> --enable-auth-negotiate="kerberos,wrapper"
> --enable-auth-ntlm="fake,smb_lm"
> --enable-external-acl-helpers="file_userip,kerberos_ldap_group,LDAP_group,session,SQL_session,unix_group,wbinfo_group"
> --enable-url-rewrite-helpers="fake" --enable-eui --enable-esi
> --enable-icmp --enable-zph-qos --enable-ecap --disable-translation
> --with-swapdir="/var/spool/squid" --with-logdir="/var/log/squid"
> --with-pidfile="/var/run/squid.pid" --with-filedescriptors="65536"
> --with-large-files --with-default-user="proxy"
> --enable-build-info="Ubuntu linux" --enable-linux-netfilter
> build_alias="x86_64-linux-gnu" CFLAGS="-g -O2 -fPIE
> -fstack-protector-strong -Wformat -Werror=format-security -Wall"
> LDFLAGS="-Wl,-Bsymbolic-functions -fPIE -pie -Wl,-z,relro -Wl,-z,now"
> CPPFLAGS="-Wdate-time -D_FORTIFY_SOURCE=2"
> CXXFLAGS="-DMAXTCPLISTENPORTS=450 -g -O2 -fPIE -fstack-protector-strong
> -Wformat -Werror=format-security"
> 
> I used several virtualserver sessions and clones, but the
> CXXFLAGS="-DMAXTCPLISTENPORTS=" dont appears in the squid -v
> 
> What is wrong in this rebuilding?
> 
> 
> On 2022-08-03 11:12, marcelorodrigo at graminsta.com.br wrote:
>> Hi,
>> 
>> I am trying to recompile squid 4.13 using ./configure
>> CXXFLAGS="-DMAXTCPLISTENPORTS=256".
>> It runs the recompile but the CXXFLAGS= does not even appears in the
>> squid -v.
>> 
>> Is there a way to include this feature in the squid instalation?
>> 
>> Tks.
>> Marcelo.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 
> 
> 
> ------------------------------
> 
> Message: 2
> Date: Fri, 5 Aug 2022 10:57:02 -0400
> From: Alex Rousskov <rousskov at measurement-factory.com>
> To: squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] Squid and Epic Games HCapctca
> Message-ID:
> 	<075bbc18-b0f5-a037-d904-6b62ef72888f at measurement-factory.com>
> Content-Type: text/plain; charset=UTF-8; format=flowed
> 
> On 8/5/22 05:10, Adam Barnett wrote:
>> maybe i am doing something?wrong, here is my config
> 
>> ssl_bump splice ...
>> ssl_bump bump dst_quixel
>> ssl_bump peek dst_quixel
>> ssl_bump stare dst_quixel
> 
> 
> The combination of the last three ssl_bump rules does not make sense
> because Squid will never reach those peek and stare rules. The bump 
> rule
> can be applied during any SslBump step, so Squid will not see any
> same-ACL ssl_bump directives below it -- the first matching rule (that
> can be applied during the current step) wins.
> 
> I do not know what logic you are trying to express with those rules, 
> but
> the above configuration does not express that (or any) logic well. I
> hope Eliezer can guide you towards a reasonable solution here.
> 
> 
> HTH,
> 
> Alex.
> 
> 
> 
>> 
>> On Thu, 4 Aug 2022 at 22:58, <ngtech1ltd at gmail.com
>> <mailto:ngtech1ltd at gmail.com>> wrote:
>> 
>>     Please don?t bang your head? everybody is here for you.____
>> 
>>     Sometimes it takes time to respond but you will get your 
>> answers.____
>> 
>>     __ __
>> 
>>     
>> https://www.ngtech.co.il/squid/support-save/support-save-2022-08-05_00-51-47.tar.gz
>>     
>> <https://www.ngtech.co.il/squid/support-save/support-save-2022-08-05_00-51-47.tar.gz>____
>> 
>>     __ __
>> 
>>     Is not the fastest connection and it has a blacklist in the DB 
>> dump
>>     so for now it?s a production system but works good enough for 
>> me.____
>> 
>>     I hope it?s not too much information in the support save file.____
>> 
>>     __ __
>> 
>>     Let me know if it makes more sense for you.____
>> 
>>     AlsoI am happy that you have asked this question since now others
>>     can enjoy from the answer ?____
>> 
>>     __ __
>> 
>>     Eliezer____
>> 
>>     __ __
>> 
>>     ----____
>> 
>>     Eliezer Croitoru____
>> 
>>     NgTech, Tech Support____
>> 
>>     Mobile: +972-5-28704261____
>> 
>>     Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com>____
>> 
>>     Web: https://ngtech.co.il/ <https://ngtech.co.il/>____
>> 
>>     My-Tube: https://tube.ngtech.co.il/ 
>> <https://tube.ngtech.co.il/>____
>> 
>>     __ __
>> 
>>     *From:*Adam Barnett <abarnett at belofx.com 
>> <mailto:abarnett at belofx.com>>
>>     *Sent:* Friday, 5 August 2022 0:44
>>     *To:* ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com>
>>     *Cc:* squid-users at lists.squid-cache.org
>>     <mailto:squid-users at lists.squid-cache.org>
>>     *Subject:* Re: [squid-users] Squid and Epic Games HCapctca____
>> 
>>     __ __
>> 
>>     Sure, the more the beter, ive been banging my head against?the 
>> wall
>>     for a while on this____
>> 
>>     __ __
>> 
>>     Adam ____
>> 
>>     __ __
>> 
>>     On Thu, 4 Aug 2022 at 22:41, <ngtech1ltd at gmail.com
>>     <mailto:ngtech1ltd at gmail.com>> wrote:____
>> 
>>         You are welcome.____
>> 
>>         ____
>> 
>>         I wrote an app that does everything for me so I just need to
>>         dump the database into a:____
>> 
>>         ssl::server_namedirective____
>> 
>>         ____
>> 
>>         it?s basically:____
>> 
>>         ## START____
>> 
>>         aclNoBump_server_name ssl::server_name
>>         "/etc/squid/no-ssl-bump-server-name.list"____
>> 
>>         ____
>> 
>>         acltls_to_splice any-of inspect_only NoBump_src
>>         NoBump_server_name NoBump_server_regex_by_urls_domain
>>         NoBump_server_regex____
>> 
>>         ____
>> 
>>         ssl_bumppeek app_matcher_helper____
>> 
>>         ssl_bumppeek tls_s1_connect____
>> 
>>         ____
>> 
>>         ssl_bumpbump app_matcher_helper____
>> 
>>         ssl_bumpbump app_reader_helper____
>> 
>>         ssl_bumpbump deny_note____
>> 
>>         ____
>> 
>>         ssl_bumpsplice app_matcher_helper____
>> 
>>         ssl_bumpsplice tls_to_splice____
>> 
>>         ____
>> 
>>         ssl_bumpstare app_matcher_helper____
>> 
>>         ssl_bumpstare tls_s2_client_hello____
>> 
>>         ____
>> 
>>         ssl_bumpbump app_matcher_helper____
>> 
>>         ssl_bumpbump tls_to_bump____
>> 
>>         ## END____
>> 
>>         ____
>> 
>>         If you want I can upload a snippet of the whole setup dump 
>> with
>>         hope you could make use of it.____
>> 
>>         ____
>> 
>>         Eliezer____
>> 
>>         ____
>> 
>>         ----____
>> 
>>         Eliezer Croitoru____
>> 
>>         NgTech, Tech Support____
>> 
>>         Mobile: +972-5-28704261____
>> 
>>         Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com>____
>> 
>>         Web: https://ngtech.co.il/ <https://ngtech.co.il/>____
>> 
>>         My-Tube: https://tube.ngtech.co.il/ 
>> <https://tube.ngtech.co.il/>____
>> 
>>         ____
>> 
>>         *From:*Adam Barnett <abarnett at belofx.com
>>         <mailto:abarnett at belofx.com>>
>>         *Sent:* Friday, 5 August 2022 0:26
>>         *To:* ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com>
>>         *Cc:* squid-users at lists.squid-cache.org
>>         <mailto:squid-users at lists.squid-cache.org>
>>         *Subject:* Re: [squid-users] Squid and Epic Games HCapctca____
>> 
>>         ____
>> 
>>         ???? ???
>>         It looks like you are using a database and then building the
>>         config from that? any cahnce?you can send me the snippet?of 
>> the
>>         config instead of the DB bits? ? ____
>> 
>>         ____
>> 
>>         Thanks again ____
>> 
>>         ____
>> 
>>         Adam ____
>> 
>>         ____
>> 
>>         On Thu, 4 Aug 2022 at 22:18, <ngtech1ltd at gmail.com
>>         <mailto:ngtech1ltd at gmail.com>> wrote:____
>> 
>>             Hey Adam,____
>> 
>>             ____
>> 
>>             I recorded a video for you on how I do it at:____
>> 
>>             
>> https://cloud1.ngtech.co.il/static/squid-data/splice-epic-games.mp4
>>             
>> <https://cloud1.ngtech.co.il/static/squid-data/splice-epic-games.mp4>____
>> 
>>             ____
>> 
>>             So basically the relevant domains are:____
>> 
>>             ____
>> 
>>             epicgames-download1.akamaized.net
>>             <http://epicgames-download1.akamaized.net>____
>> 
>>             .epicgames.com <http://epicgames.com>____
>> 
>>             .unrealengine.com <http://unrealengine.com>____
>> 
>>             ____
>> 
>>             And you can peek at robert k Wild mail: ?regex for normal
>>             websites?____
>> 
>>             ____
>> 
>>             And it contains the relevant technical details.____
>> 
>>             If for any reason you need a more detailed answer let me
>>             know.____
>> 
>>             ____
>> 
>>             Yours,____
>> 
>>             Eliezer ____
>> 
>>             ____
>> 
>>             ----____
>> 
>>             Eliezer Croitoru____
>> 
>>             NgTech, Tech Support____
>> 
>>             Mobile: +972-5-28704261____
>> 
>>             Email: ngtech1ltd at gmail.com 
>> <mailto:ngtech1ltd at gmail.com>____
>> 
>>             Web: https://ngtech.co.il/ <https://ngtech.co.il/>____
>> 
>>             My-Tube: https://tube.ngtech.co.il/
>>             <https://tube.ngtech.co.il/>____
>> 
>>             ____
>> 
>>             *From:*squid-users
>>             <squid-users-bounces at lists.squid-cache.org
>>             <mailto:squid-users-bounces at lists.squid-cache.org>> *On
>>             Behalf Of *Adam Barnett
>>             *Sent:* Thursday, 4 August 2022 14:28
>>             *To:* squid-users at lists.squid-cache.org
>>             <mailto:squid-users at lists.squid-cache.org>
>>             *Subject:* [squid-users] Squid and Epic Games HCapctca____
>> 
>>             ____
>> 
>>             Hi All, ____
>> 
>>             ____
>> 
>>             I am trying to get squid to allow me to login to
>>             Epicgames.com with my epic login, i get to the login page
>>             and get the hcaptca?images and everytime i get "invalid
>>             response" ____
>> 
>>             ____
>> 
>>             i looked at the headers and the only error that i can see 
>> is
>>             "The cache?information?is missing from the entry" ____
>> 
>>             ____
>> 
>>             My config looks like so
>> 
>>             workers 2
>> 
>>             ```
>>             # Leave coredumps in the first cache dir
>>             coredump_dir /var/spool/squid
>> 
>>             http_port 3128 ssl-bump ?dynamic_cert_mem_cache_size=16MB
>>              ?generate-host-certificates=on
>>             cert=/etc/squid/certs/squid-ca-cert-key.pem
>> 
>>             sslcrtd_program /usr/lib64/squid/security_file_certgen -s
>>             /var/spool/squid/ssl -M 16MB
>>             dns_nameservers 10.5.1.2 8.8.8.8
>>             visible_hostname foo-proxy-1
>>             forwarded_for truncate
>>             via off
>> 
>>             # Send to file
>>             access_log daemon:/var/log/squid/access.log
>> 
>> 
>> 
>>             acl CONNECT method CONNECT
>>             acl local src 10.0.0.0/8 <http://10.0.0.0/8>
>>             always_direct allow all
>>             request_header_add X-GoogApps-Allowed-Domains "foo.com
>>             <http://foo.com>" all
>> 
>>             memory_replacement_policy heap GDSF
>>             maximum_object_size 100 KB
>>             maximum_object_size 1 MB
>> 
>>             cache allow all
>>             cache_mem 256 MB
>>             cache_dir rock /var/spool/squid 1024
>>             memory_pools off
>>             cache_swap_low 90
>>             client_persistent_connections on
>> 
>> 
>>             http_access allow localhost manager
>>             http_access deny manager
>> 
>>             # SquidGaurd
>>             url_rewrite_program /usr/bin/squidGuard
>>             ```
>> 
>>             Any suggestions? ____
>> 
>>             ____
>> 
>>             Thanks____
>> 
>>             Adam Barnett
>>             Senior SysAdmin beloFX____
>> 
>>             **____
>> 
>> 
>> 
>>             ____
>> 
>> 
>> 
>>             abarnett at belofx.com
>>             
>> <https://514584150-atari-embeds.googleusercontent.com/embeds/16cb204cf3a9d4d223a0a3fd8b0eec5d/inner-frame-minified.html?jsh=m%3B%2F_%2Fscs%2Fabc-static%2F_%2Fjs%2Fk%3Dgapi.lb.en.dzXZWX9QTbE.O%2Fd%3D1%2Frs%3DAHpOoo_epIQDPHdjFr3MLkazUi2Jmy50dQ%2Fm%3D__features__>____
>> 
>>             **____
>> 
>> 
>> 
>>             ____
>> 
>> 
>> 
>>             www.belofx.com <http://www.belofx.com/>____
>> 
>>             **____
>> 
>> 
>> 
>>             ____
>> 
>> 
>> 
>>             LinkedIn <http://www.linkedin.com/company/belofx>____
>> 
>>             ____
>> 
>> 
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
> 
> 
> 
> ------------------------------
> 
> Subject: Digest Footer
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 
> 
> ------------------------------
> 
> End of squid-users Digest, Vol 96, Issue 18
> *******************************************


From rousskov at measurement-factory.com  Sat Aug  6 22:42:20 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Sat, 6 Aug 2022 18:42:20 -0400
Subject: [squid-users] Trying to recompile squid 4.13
In-Reply-To: <687aac1508b25f4cdf6afaf5d8b3f478@graminsta.com.br>
References: <mailman.1.1659787202.1945723.squid-users@lists.squid-cache.org>
 <687aac1508b25f4cdf6afaf5d8b3f478@graminsta.com.br>
Message-ID: <c849904c-d055-f6dc-7fe7-5af0ddb81085@measurement-factory.com>

On 8/6/22 13:03, marcelorodrigo at graminsta.com.br wrote:

> The next chalenge is to implement ssl bumping with pear caching. Any 
> sugestion about detailed documentation of it?

It is a very difficult topic. The best documentation that I know about 
(and it is not very good) is squid.conf.documented and
https://wiki.squid-cache.org/Features/SslPeekAndSplice


> I would like to understand also why squid gets so slow when handling 
> more than 128 IPs.

I bet that whatever it is that slows your Squid down, it is not the 
number of listening ports (i.e. what I presume you call "IPs"): AFAIK, 
when handling traffic, Squid does not iterate over listening ports so 
the number of listening ports should not affect Squid runtime 
performance much.


> Its a shame that does not exist a team or even a guy that sells squid 
> services/support now a days to implement squid features.

FWIW, several companies and individuals offer paid Squid support. 
Unfortunately, the Squid Project effectively stopped maintaining the 
list of those support shops, and Google is unable to find the right 
pages in my quick test, but they are out there.


> Even with my almost 30 years working with IT infrastructure its hard to 
> deal with squid alone.

I agree!


Good luck,

Alex.


From ngtech1ltd at gmail.com  Sun Aug  7 15:16:42 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Sun, 7 Aug 2022 18:16:42 +0300
Subject: [squid-users] SQL DB squid.conf backend,
 who was it that asked about it?
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAG15AYh8TcJOh7jZfP/beGvCgAAAEAAAADlzCvHLla9OjTtHf3duDHIBAAAAAA==@gmail.com>

Hey Everybody,
 
I don?t remember who was it but I was asked about using a SQL DB backend for squid.conf.
If the question is still in place I can try to help and give an example how it?s being done and also
how to implement such a feature.
 
Eliezer
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email:  <mailto:ngtech1ltd at gmail.com> ngtech1ltd at gmail.com
Web:  <https://ngtech.co.il/> https://ngtech.co.il/
My-Tube:  <https://tube.ngtech.co.il/> https://tube.ngtech.co.il/
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220807/90f58aae/attachment.htm>

From squid3 at treenet.co.nz  Mon Aug  8 10:55:43 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Mon, 8 Aug 2022 22:55:43 +1200
Subject: [squid-users] SQL DB squid.conf backend,
 who was it that asked about it?
In-Reply-To: <!&!AAAAAAAAAAAYAAAAAAAAAG15AYh8TcJOh7jZfP/beGvCgAAAEAAAADlzCvHLla9OjTtHf3duDHIBAAAAAA==@gmail.com>
References: <!&!AAAAAAAAAAAYAAAAAAAAAG15AYh8TcJOh7jZfP/beGvCgAAAEAAAADlzCvHLla9OjTtHf3duDHIBAAAAAA==@gmail.com>
Message-ID: <20bf98c6-6a22-f303-928e-29bffbf9fd93@treenet.co.nz>

On 8/08/22 03:16, ngtech1ltd wrote:
> Hey Everybody,
> 
> I don?t remember who was it but I was asked about using a SQL DB backend 
> for squid.conf.


FWIW, "Marcello" asked on 10 July. He seems to have moved on to external 
ACL development (guessing from later thread topics).


Cheers
Amos


From 0xff1f at gmail.com  Mon Aug  8 16:13:25 2022
From: 0xff1f at gmail.com (Ahmad Alzaeem)
Date: Mon, 8 Aug 2022 16:13:25 +0000
Subject: [squid-users] force squid to kill current connection after
 reconfigure
Message-ID: <DBBPR09MB45239B10FABB85338355B26EF7639@DBBPR09MB4523.eurprd09.prod.outlook.com>


Hello Team ,
Sometimes we need to change the tcp_outgoing addresses acl .
We edit it and reconfigure squid , but the current connection still work on the old ips of tcp_outgoing until the browser is completely closed and reopened .
Is there a way we can kill old sessions/connections in the old  tcp_outgoing after applying reconfigure ?

Tried with server_persistent_connections off , but did not make a change .

Thanks



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220808/d0ed9b4b/attachment.htm>

From rousskov at measurement-factory.com  Mon Aug  8 17:22:41 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Mon, 8 Aug 2022 13:22:41 -0400
Subject: [squid-users] force squid to kill current connection after
 reconfigure
In-Reply-To: <DBBPR09MB45239B10FABB85338355B26EF7639@DBBPR09MB4523.eurprd09.prod.outlook.com>
References: <DBBPR09MB45239B10FABB85338355B26EF7639@DBBPR09MB4523.eurprd09.prod.outlook.com>
Message-ID: <315f05d4-0cd6-b324-abd6-441231c9c024@measurement-factory.com>

On 8/8/22 12:13, Ahmad Alzaeem wrote:

> Sometimes we need to change the tcp_outgoing addresses acl .
> 
> We edit it and reconfigure squid , but the current connection still work 
> on the old ips of tcp_outgoing

The tcp_outgoing_address directive is applied to each forwarding attempt 
(that needs to select a connection), not each network I/O:

* A current forwarding attempt should continue to use the old outgoing 
addresses that was selected for it.

* A future forwarding attempt that uses a Squid-server connection 
_pinned_ to the client-Squid connection should continue to use the old 
outgoing addresses that was selected for that pinned connection. This 
happens, for example, in many SslBump configurations.

* Other future forwarding attempts should obey new tcp_outgoing_address 
directives. For example, they should not reuse persistent connections 
that do not match new tcp_outgoing_address directives.

If you observe something that contradicts the above, please detail your 
observations.


> Is there a way we can kill old sessions/connections in the old 
>  ?tcp_outgoing after applying reconfigure ?

Squid does not have a feature like this, but there are external tools 
that can kill unwanted TCP connections. For example:
https://stackoverflow.com/a/55616004


HTH,

Alex.


From mohammed.khallaf at gmail.com  Tue Aug  9 19:28:55 2022
From: mohammed.khallaf at gmail.com (M K)
Date: Tue, 9 Aug 2022 21:28:55 +0200
Subject: [squid-users] Squid 4.8+ intercept
In-Reply-To: <CAFMSmTvEFMASCsodsZ43zdY_tEaKMJu2s_c8bCAKuyVd1i9yFg@mail.gmail.com>
References: <CAFMSmTvEFMASCsodsZ43zdY_tEaKMJu2s_c8bCAKuyVd1i9yFg@mail.gmail.com>
Message-ID: <CAFMSmTuUK_9UApWc76L91GDRm-tK-E+b=oLrUzF5Fitr-PZy3Q@mail.gmail.com>

Hello,

I have a setup like this one:

| Client | =====> | Router | =====> Internet
                     ||
                     \/
                  | Squid |

...the router is a Mikrotik router capable of all things NAT/Redirect and
whatnot. Squid server has only one network interface.
Using the router:
- I tried routing traffic to squid server IP.
- I tried destination-NATing from client to server IP, with origin server
IP-and-port natted to squid IP-and-port, and with origin server IP-only
natted to squid-IP.

I have been struggling for 2 days to setup a working Squid 4.8 or higher
interception.
Test server is running Ubuntu 18.4.3 and Squid 4.8.
Documentation is either too much trim or extremely outdated.
Any help would be very much appreciated.

All best,
K
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220809/15f2fded/attachment.htm>

From rafael.akchurin at diladele.com  Tue Aug  9 20:54:05 2022
From: rafael.akchurin at diladele.com (Rafael Akchurin)
Date: Tue, 9 Aug 2022 20:54:05 +0000
Subject: [squid-users] Squid 4.8+ intercept
In-Reply-To: <CAFMSmTuUK_9UApWc76L91GDRm-tK-E+b=oLrUzF5Fitr-PZy3Q@mail.gmail.com>
References: <CAFMSmTvEFMASCsodsZ43zdY_tEaKMJu2s_c8bCAKuyVd1i9yFg@mail.gmail.com>
 <CAFMSmTuUK_9UApWc76L91GDRm-tK-E+b=oLrUzF5Fitr-PZy3Q@mail.gmail.com>
Message-ID: <F4FBD3F8-12F1-4769-BAC5-44A3135A807D@diladele.com>

Hello K,

We use https://docs.diladele.com/tutorials/mikrotik_transparent_squid/index.html

Best regards,
Rafael

Op 9 aug. 2022 om 21:29 heeft M K <mohammed.khallaf at gmail.com> het volgende geschreven:

?
Hello,

I have a setup like this one:

| Client | =====> | Router | =====> Internet
                     ||
                     \/
                  | Squid |

...the router is a Mikrotik router capable of all things NAT/Redirect and whatnot. Squid server has only one network interface.
Using the router:
- I tried routing traffic to squid server IP.
- I tried destination-NATing from client to server IP, with origin server IP-and-port natted to squid IP-and-port, and with origin server IP-only natted to squid-IP.

I have been struggling for 2 days to setup a working Squid 4.8 or higher interception.
Test server is running Ubuntu 18.4.3 and Squid 4.8.
Documentation is either too much trim or extremely outdated.
Any help would be very much appreciated.

All best,
K
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220809/5eb28a83/attachment.htm>

From uhlar at fantomas.sk  Wed Aug 10 07:51:03 2022
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Wed, 10 Aug 2022 09:51:03 +0200
Subject: [squid-users] Squid 4.8+ intercept
In-Reply-To: <CAFMSmTuUK_9UApWc76L91GDRm-tK-E+b=oLrUzF5Fitr-PZy3Q@mail.gmail.com>
References: <CAFMSmTvEFMASCsodsZ43zdY_tEaKMJu2s_c8bCAKuyVd1i9yFg@mail.gmail.com>
 <CAFMSmTuUK_9UApWc76L91GDRm-tK-E+b=oLrUzF5Fitr-PZy3Q@mail.gmail.com>
Message-ID: <YvNjZ900rQNYvXnn@fantomas.sk>

On 09.08.22 21:28, M K wrote:
>I have a setup like this one:
>
>| Client | =====> | Router | =====> Internet
>                     ||
>                     \/
>                  | Squid |
>
>...the router is a Mikrotik router capable of all things NAT/Redirect and
>whatnot. Squid server has only one network interface.
>Using the router:
>- I tried routing traffic to squid server IP.
>- I tried destination-NATing from client to server IP, with origin server
>IP-and-port natted to squid IP-and-port, and with origin server IP-only
>natted to squid-IP.

https://wiki.squid-cache.org/SquidFaq/InterceptionProxy#Requirements_and_methods_for_Interception_Caching

NOTE: NAT configuration will only work when used on the squid box.  This is 
required to perform intercept accurately and securely.  To intercept from a 
gateway machine and direct traffic at a separate squid box use policy 
routing.

>I have been struggling for 2 days to setup a working Squid 4.8 or higher
>interception.
>Test server is running Ubuntu 18.4.3 and Squid 4.8.
>Documentation is either too much trim or extremely outdated.
>Any help would be very much appreciated.

policy routing:

https://wiki.squid-cache.org/ConfigExamples/Intercept/IptablesPolicyRoute

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
The only substitute for good manners is fast reflexes.


From ngtech1ltd at gmail.com  Wed Aug 10 08:08:32 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Wed, 10 Aug 2022 11:08:32 +0300
Subject: [squid-users] Squid 4.8+ intercept
In-Reply-To: <CAFMSmTuUK_9UApWc76L91GDRm-tK-E+b=oLrUzF5Fitr-PZy3Q@mail.gmail.com>
References: <CAFMSmTvEFMASCsodsZ43zdY_tEaKMJu2s_c8bCAKuyVd1i9yFg@mail.gmail.com>
 <CAFMSmTuUK_9UApWc76L91GDRm-tK-E+b=oLrUzF5Fitr-PZy3Q@mail.gmail.com>
Message-ID: <000401d8ac90$62fcea80$28f6bf80$@gmail.com>

Hey K,
 
I am not sure about the network topology.
Preferably the Squid should reside on another network then the clients if it?s intercepting the traffic.
Also, I assume it?s not a TPROXY setup so it should be pretty simple and straight forward.
 
I understand why are you asking this question.
Also take into account that Mikrotik is now on 7.4 firmware and it?s recommended to use this one.
If you are using any other version let me know so I can try to make sense on the differences.
I will try to give a DEMO for such a setup and how to make it work.
 
Eliezer
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email:  <mailto:ngtech1ltd at gmail.com> ngtech1ltd at gmail.com
Web:  <https://ngtech.co.il/> https://ngtech.co.il/
My-Tube:  <https://tube.ngtech.co.il/> https://tube.ngtech.co.il/
 
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of M K
Sent: Tuesday, 9 August 2022 22:29
To: squid-users at lists.squid-cache.org
Subject: [squid-users] Squid 4.8+ intercept
 
Hello,
 
I have a setup like this one:

| Client | =====> | Router | =====> Internet
                     ||
                     \/
                  | Squid |
 
...the router is a Mikrotik router capable of all things NAT/Redirect and whatnot. Squid server has only one network interface.
Using the router:
- I tried routing traffic to squid server IP.
- I tried destination-NATing from client to server IP, with origin server IP-and-port natted to squid IP-and-port, and with origin server IP-only natted to squid-IP.
 
I have been struggling for 2 days to setup a working Squid 4.8 or higher interception.
Test server is running Ubuntu 18.4.3 and Squid 4.8.
Documentation is either too much trim or extremely outdated.
Any help would be very much appreciated.
 
All best,
K
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220810/09c7a8da/attachment.htm>

From ngtech1ltd at gmail.com  Wed Aug 10 08:10:01 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Wed, 10 Aug 2022 11:10:01 +0300
Subject: [squid-users] Squid 4.8+ intercept
In-Reply-To: <F4FBD3F8-12F1-4769-BAC5-44A3135A807D@diladele.com>
References: <CAFMSmTvEFMASCsodsZ43zdY_tEaKMJu2s_c8bCAKuyVd1i9yFg@mail.gmail.com>
 <CAFMSmTuUK_9UApWc76L91GDRm-tK-E+b=oLrUzF5Fitr-PZy3Q@mail.gmail.com>
 <F4FBD3F8-12F1-4769-BAC5-44A3135A807D@diladele.com>
Message-ID: <000901d8ac90$978a9720$c69fc560$@gmail.com>

Hey Rafael,
 
This document covers on the V6 branch of Mikrotik and the stable is 7.4.
If you do have the resources to publish a V7 document upgrade it would help others.
 
Eliezer
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> 
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/
 
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Rafael Akchurin
Sent: Tuesday, 9 August 2022 23:54
To: M K <mohammed.khallaf at gmail.com>
Cc: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Squid 4.8+ intercept
 
Hello K, 
 
We use https://docs.diladele.com/tutorials/mikrotik_transparent_squid/index.html
Best regards, 
Rafael



Op 9 aug. 2022 om 21:29 heeft M K <mohammed.khallaf at gmail.com <mailto:mohammed.khallaf at gmail.com> > het volgende geschreven:
? 
Hello, 
 
I have a setup like this one:

| Client | =====> | Router | =====> Internet
                     ||
                     \/
                  | Squid |
 
...the router is a Mikrotik router capable of all things NAT/Redirect and whatnot. Squid server has only one network interface.
Using the router:
- I tried routing traffic to squid server IP.
- I tried destination-NATing from client to server IP, with origin server IP-and-port natted to squid IP-and-port, and with origin server IP-only natted to squid-IP.
 
I have been struggling for 2 days to setup a working Squid 4.8 or higher interception.
Test server is running Ubuntu 18.4.3 and Squid 4.8.
Documentation is either too much trim or extremely outdated.
Any help would be very much appreciated.
 
All best,
K
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> 
http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220810/a2438d1c/attachment.htm>

From rafael.akchurin at diladele.com  Wed Aug 10 08:23:27 2022
From: rafael.akchurin at diladele.com (Rafael Akchurin)
Date: Wed, 10 Aug 2022 08:23:27 +0000
Subject: [squid-users] Squid 4.8+ intercept
In-Reply-To: <000901d8ac90$978a9720$c69fc560$@gmail.com>
References: <CAFMSmTvEFMASCsodsZ43zdY_tEaKMJu2s_c8bCAKuyVd1i9yFg@mail.gmail.com>
 <CAFMSmTuUK_9UApWc76L91GDRm-tK-E+b=oLrUzF5Fitr-PZy3Q@mail.gmail.com>
 <F4FBD3F8-12F1-4769-BAC5-44A3135A807D@diladele.com>
 <000901d8ac90$978a9720$c69fc560$@gmail.com>
Message-ID: <AM8PR04MB7745D0A1B5D34A620791E1FD8F659@AM8PR04MB7745.eurprd04.prod.outlook.com>

Thanks ? will do when preparing web safety 8.2 (October/November 2022)  ? added https://github.com/diladele/websafety/issues/1869

Best regards,
rafael

From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of ngtech1ltd at gmail.com
Sent: Wednesday, August 10, 2022 10:10 AM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Squid 4.8+ intercept

Hey Rafael,

This document covers on the V6 branch of Mikrotik and the stable is 7.4.
If you do have the resources to publish a V7 document upgrade it would help others.

Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com<mailto:ngtech1ltd at gmail.com>
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/

From: squid-users <squid-users-bounces at lists.squid-cache.org<mailto:squid-users-bounces at lists.squid-cache.org>> On Behalf Of Rafael Akchurin
Sent: Tuesday, 9 August 2022 23:54
To: M K <mohammed.khallaf at gmail.com<mailto:mohammed.khallaf at gmail.com>>
Cc: squid-users at lists.squid-cache.org<mailto:squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] Squid 4.8+ intercept

Hello K,

We use https://docs.diladele.com/tutorials/mikrotik_transparent_squid/index.html
Best regards,
Rafael


Op 9 aug. 2022 om 21:29 heeft M K <mohammed.khallaf at gmail.com<mailto:mohammed.khallaf at gmail.com>> het volgende geschreven:
?
Hello,

I have a setup like this one:

| Client | =====> | Router | =====> Internet
                     ||
                     \/
                  | Squid |

...the router is a Mikrotik router capable of all things NAT/Redirect and whatnot. Squid server has only one network interface.
Using the router:
- I tried routing traffic to squid server IP.
- I tried destination-NATing from client to server IP, with origin server IP-and-port natted to squid IP-and-port, and with origin server IP-only natted to squid-IP.

I have been struggling for 2 days to setup a working Squid 4.8 or higher interception.
Test server is running Ubuntu 18.4.3 and Squid 4.8.
Documentation is either too much trim or extremely outdated.
Any help would be very much appreciated.

All best,
K
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org<mailto:squid-users at lists.squid-cache.org>
http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220810/a66989dc/attachment.htm>

From ngtech1ltd at gmail.com  Wed Aug 10 09:47:18 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Wed, 10 Aug 2022 12:47:18 +0300
Subject: [squid-users] Squid 4.8+ intercept
In-Reply-To: <CAFMSmTuUK_9UApWc76L91GDRm-tK-E+b=oLrUzF5Fitr-PZy3Q@mail.gmail.com>
References: <CAFMSmTvEFMASCsodsZ43zdY_tEaKMJu2s_c8bCAKuyVd1i9yFg@mail.gmail.com>
 <CAFMSmTuUK_9UApWc76L91GDRm-tK-E+b=oLrUzF5Fitr-PZy3Q@mail.gmail.com>
Message-ID: <002001d8ac9e$2ea4eb80$8beec280$@gmail.com>

Hey K,
 
Here a video example on how to implement what you probably want:
https://cloud1.ngtech.co.il/static/squid-data/mikrotik-v7-intercept.mp4
 
If the proxy sits in the same network that the clients sit it won?t work.
 
Eliezer
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email:  <mailto:ngtech1ltd at gmail.com> ngtech1ltd at gmail.com
Web:  <https://ngtech.co.il/> https://ngtech.co.il/
My-Tube:  <https://tube.ngtech.co.il/> https://tube.ngtech.co.il/
 
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of M K
Sent: Tuesday, 9 August 2022 22:29
To: squid-users at lists.squid-cache.org
Subject: [squid-users] Squid 4.8+ intercept
 
Hello,
 
I have a setup like this one:

| Client | =====> | Router | =====> Internet
                     ||
                     \/
                  | Squid |
 
...the router is a Mikrotik router capable of all things NAT/Redirect and whatnot. Squid server has only one network interface.
Using the router:
- I tried routing traffic to squid server IP.
- I tried destination-NATing from client to server IP, with origin server IP-and-port natted to squid IP-and-port, and with origin server IP-only natted to squid-IP.
 
I have been struggling for 2 days to setup a working Squid 4.8 or higher interception.
Test server is running Ubuntu 18.4.3 and Squid 4.8.
Documentation is either too much trim or extremely outdated.
Any help would be very much appreciated.
 
All best,
K
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220810/8c0ecd1d/attachment.htm>

From marcelorodrigo at graminsta.com.br  Wed Aug 10 16:25:44 2022
From: marcelorodrigo at graminsta.com.br (marcelorodrigo at graminsta.com.br)
Date: Wed, 10 Aug 2022 13:25:44 -0300
Subject: [squid-users] SQL DB squid.conf backend,
 who was it that asked about it?
In-Reply-To: <mailman.1.1659960001.2937467.squid-users@lists.squid-cache.org>
References: <mailman.1.1659960001.2937467.squid-users@lists.squid-cache.org>
Message-ID: <1cc6cf3115c7b8961f99d9fc740fbd37@graminsta.com.br>

Hi Amos,

It was me indeed.
We have developed a squid based php application to create VPSs and 
deliver proxies via web panel.
It is still in development, but fase 1 is working already running SQL 
user management, create VPSs and squid.conf auto configuration.
We are heading to fase 2 to use cache pears and IPv4/IPv6 routing 
depends on source.

Squid.conf got so complex at this point that its getting very hard to 
implement fase 2.

Lack of deep squid knowledge is still our weak spot.

Thanks for asking.

Marcelo.


On 2022-08-08 09:00, squid-users-request at lists.squid-cache.org wrote:
> Send squid-users mailing list submissions to
> 	squid-users at lists.squid-cache.org
> 
> To subscribe or unsubscribe via the World Wide Web, visit
> 	http://lists.squid-cache.org/listinfo/squid-users
> or, via email, send a message with subject or body 'help' to
> 	squid-users-request at lists.squid-cache.org
> 
> You can reach the person managing the list at
> 	squid-users-owner at lists.squid-cache.org
> 
> When replying, please edit your Subject line so it is more specific
> than "Re: Contents of squid-users digest..."
> 
> 
> Today's Topics:
> 
>    1. Re: SQL DB squid.conf backend, who was it that asked about
>       it? (Amos Jeffries)
> 
> 
> ----------------------------------------------------------------------
> 
> Message: 1
> Date: Mon, 8 Aug 2022 22:55:43 +1200
> From: Amos Jeffries <squid3 at treenet.co.nz>
> To: squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] SQL DB squid.conf backend, who was it that
> 	asked about it?
> Message-ID: <20bf98c6-6a22-f303-928e-29bffbf9fd93 at treenet.co.nz>
> Content-Type: text/plain; charset=UTF-8; format=flowed
> 
> On 8/08/22 03:16, ngtech1ltd wrote:
>> Hey Everybody,
>> 
>> I don?t remember who was it but I was asked about using a SQL DB 
>> backend
>> for squid.conf.
> 
> 
> FWIW, "Marcello" asked on 10 July. He seems to have moved on to 
> external
> ACL development (guessing from later thread topics).
> 
> 
> Cheers
> Amos
> 
> 
> ------------------------------
> 
> Subject: Digest Footer
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 
> 
> ------------------------------
> 
> End of squid-users Digest, Vol 96, Issue 21
> *******************************************


From osy at turing.llc  Thu Aug 11 02:43:35 2022
From: osy at turing.llc (osy)
Date: Wed, 10 Aug 2022 19:43:35 -0700
Subject: [squid-users] Problem caching range requests with range_offset_limit
Message-ID: <CA+E+eSCSC_ReYmeJR1O7vNaVu5ix65NdQgL18Kd9EqYb8AWqdg@mail.gmail.com>

I am trying to cache Azure objects. I have SSL bump and the following config:

maximum_object_size 1000 MB
acl azure_storage dstdomain .blob.core.windows.net
range_offset_limit -1 azure_storage

My expectation is that when a request is made with the Range header,
that Squid will request the object starting from the beginning, return
the data when it reaches the range, then keep the connection open and
keep requesting data until the end. However, I observe the last part
isn't true: the connection to the server is closed after the proxy
client closes the connection.

2022/08/10 18:55:23.152| 5,3| Read.cc(92) ReadNow:
local=127.0.0.1:3128 remote=127.0.0.1:57075 FD 21 flags=1, size 3644,
retval 0, errno 0
2022/08/10 18:55:23.152| 33,5| Server.cc(147) doClientRead:
local=127.0.0.1:3128 remote=127.0.0.1:57075 FD 21 flags=1 closed?
2022/08/10 18:55:23.152| 33,3| client_side.cc(1418)
connFinishedWithConn: local=127.0.0.1:3128 remote=127.0.0.1:57075 FD
21 flags=1 aborted (half_closed_clients disabled)
2022/08/10 18:55:23.152| 33,3| Pipeline.cc(56) terminateAll: Pipeline
0x149704e80 notify(0) 0x13a817600*3
2022/08/10 18:55:23.152| 90,3| store_client.cc(651) storeUnregister:
storeUnregister: called for 'F43F6204305C4808C2A393C7CC905C16'
2022/08/10 18:55:23.153| 90,3| store_client.cc(764)
CheckQuickAbortIsReasonable: entry=e:d5 at 0=w1p2V/0x6000038f6d80*6
2022/08/10 18:55:23.153| 90,3| store_client.cc(755)
storePendingNClients: storePendingNClients: returning 0
2022/08/10 18:55:23.153| 90,3| store_client.cc(788)
CheckQuickAbortIsReasonable: mem=0x14a14bcb0
2022/08/10 18:55:23.153| 90,3| store_client.cc(817)
CheckQuickAbortIsReasonable: quick-abort? NO admin configured range
replies to full-download
2022/08/10 18:55:23.153| 33,3| Pipeline.cc(69) popMe: Pipeline
0x149704e80 drop 0x13a817600*3
2022/08/10 18:55:23.153| 33,3| client_side_request.cc(270)
~ClientHttpRequest: httpRequestFree: [url here]

I also tried setting "half_closed_clients on" but that just defers the
error to a write later on. Any advice would be appreciated, thanks!


From rousskov at measurement-factory.com  Thu Aug 11 03:06:33 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Wed, 10 Aug 2022 23:06:33 -0400
Subject: [squid-users] Problem caching range requests with
 range_offset_limit
In-Reply-To: <CA+E+eSCSC_ReYmeJR1O7vNaVu5ix65NdQgL18Kd9EqYb8AWqdg@mail.gmail.com>
References: <CA+E+eSCSC_ReYmeJR1O7vNaVu5ix65NdQgL18Kd9EqYb8AWqdg@mail.gmail.com>
Message-ID: <c9ceb26b-cf6c-ea30-ea73-ab774e573351@measurement-factory.com>

On 8/10/22 22:43, osy wrote:
> I am trying to cache Azure objects. I have SSL bump and the following config:
> 
> maximum_object_size 1000 MB
> acl azure_storage dstdomain .blob.core.windows.net
> range_offset_limit -1 azure_storage
> 
> My expectation is that when a request is made with the Range header,
> that Squid will request the object starting from the beginning, return
> the data when it reaches the range, then keep the connection open and
> keep requesting data until the end.

N.B. In the above "keep the connection" should refer to the 
Squid-to-origin connection, not the user_agent-to-Squid connection.


> However, I observe the last part
> isn't true: the connection to the server is closed after the proxy
> client closes the connection.
> 
> 2022/08/10 18:55:23.152| 5,3| Read.cc(92) ReadNow:
> local=127.0.0.1:3128 remote=127.0.0.1:57075 FD 21 flags=1, size 3644,
> retval 0, errno 0
> 2022/08/10 18:55:23.152| 33,5| Server.cc(147) doClientRead:
> local=127.0.0.1:3128 remote=127.0.0.1:57075 FD 21 flags=1 closed?
> 2022/08/10 18:55:23.152| 33,3| client_side.cc(1418)
> connFinishedWithConn: local=127.0.0.1:3128 remote=127.0.0.1:57075 FD
> 21 flags=1 aborted (half_closed_clients disabled)
> 2022/08/10 18:55:23.152| 33,3| Pipeline.cc(56) terminateAll: Pipeline
> 0x149704e80 notify(0) 0x13a817600*3
> 2022/08/10 18:55:23.152| 90,3| store_client.cc(651) storeUnregister:
> storeUnregister: called for 'F43F6204305C4808C2A393C7CC905C16'
> 2022/08/10 18:55:23.153| 90,3| store_client.cc(764)
> CheckQuickAbortIsReasonable: entry=e:d5 at 0=w1p2V/0x6000038f6d80*6
> 2022/08/10 18:55:23.153| 90,3| store_client.cc(755)
> storePendingNClients: storePendingNClients: returning 0
> 2022/08/10 18:55:23.153| 90,3| store_client.cc(788)
> CheckQuickAbortIsReasonable: mem=0x14a14bcb0
> 2022/08/10 18:55:23.153| 90,3| store_client.cc(817)
> CheckQuickAbortIsReasonable: quick-abort? NO admin configured range
> replies to full-download
> 2022/08/10 18:55:23.153| 33,3| Pipeline.cc(69) popMe: Pipeline
> 0x149704e80 drop 0x13a817600*3
> 2022/08/10 18:55:23.153| 33,3| client_side_request.cc(270)
> ~ClientHttpRequest: httpRequestFree: [url here]

Just to avoid any misunderstanding, the above debugging quote does _not_ 
show the connection to the origin server being closed. There are many 
things called "servers" and "clients" in this context. The "Server.cc" 
above is a Squid task parsing requests from user agents and responding 
with a replies. It is nearly unrelated to the origin server.

The above trace does not necessarily contradict your configuration and 
expectations AFAICT. It shows that the user agent closed the connection 
to Squid, but Squid may have decided to keep going with downloading the 
response from the origin server ("quick-abort? NO"). Something else 
could have gone wrong with that download later (or even earlier), of 
course, but the trace does not show that AFAICT.


HTH,

Alex.



> I also tried setting "half_closed_clients on" but that just defers the
> error to a write later on. Any advice would be appreciated, thanks!
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



From gtaylor at tnetconsulting.net  Thu Aug 11 03:47:32 2022
From: gtaylor at tnetconsulting.net (Grant Taylor)
Date: Wed, 10 Aug 2022 21:47:32 -0600
Subject: [squid-users] Squid 4.8+ intercept
In-Reply-To: <002001d8ac9e$2ea4eb80$8beec280$@gmail.com>
References: <CAFMSmTvEFMASCsodsZ43zdY_tEaKMJu2s_c8bCAKuyVd1i9yFg@mail.gmail.com>
 <CAFMSmTuUK_9UApWc76L91GDRm-tK-E+b=oLrUzF5Fitr-PZy3Q@mail.gmail.com>
 <002001d8ac9e$2ea4eb80$8beec280$@gmail.com>
Message-ID: <ea8f3486-f341-6b05-31a1-2a7c49ae6c9b@spamtrap.tnetconsulting.net>

On 8/10/22 3:47 AM, ngtech1ltd at gmail.com wrote:
> If the proxy sits in the same network that the clients sit it won?t work.

Why not?

Is this because of -- what I call -- the TCP triangle problem?  - 
Meaning that Squid sees the source as the client and replies directly?

If that's the case, you can cheat by SNATing the traffic that's going to 
Squid such that Squid sees the router as the source of the traffic. 
Thus Squid replies to the router which unDNATs it and sends it back to 
the original / real client.

Aside:  Isn't this what WCCP was originally meant to address?  Is WCCP a 
non-starter any more?  Even with TLS bump / monkey in the middle?



-- 
Grant. . . .
unix || die

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4017 bytes
Desc: S/MIME Cryptographic Signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220810/c9b8ea4d/attachment.bin>

From wadegibson06 at gmail.com  Thu Aug 11 15:52:51 2022
From: wadegibson06 at gmail.com (Wade Gibson)
Date: Thu, 11 Aug 2022 16:52:51 +0100
Subject: [squid-users] Unsubscribe me please
Message-ID: <CADjerZE1RTKS+ivWQ5qwWBVAsjsj_7szU8atdphRYxMNo10O4w@mail.gmail.com>


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220811/a17eda4c/attachment.htm>

From leolistas at solutti.com.br  Thu Aug 11 16:00:14 2022
From: leolistas at solutti.com.br (Leonardo Rodrigues)
Date: Thu, 11 Aug 2022 13:00:14 -0300
Subject: [squid-users] SQL DB squid.conf backend,
 who was it that asked about it?
In-Reply-To: <1cc6cf3115c7b8961f99d9fc740fbd37@graminsta.com.br>
References: <mailman.1.1659960001.2937467.squid-users@lists.squid-cache.org>
 <1cc6cf3115c7b8961f99d9fc740fbd37@graminsta.com.br>
Message-ID: <34b2d405-2a82-de42-6691-baef0c16f3b3@solutti.com.br>


 ??? Hi Marcelo,

 ??? Is this going to be released as free and open-source software, or 
it's a closed project? If 1st answer, then I might be able to help! 
While I wouldn't call myself an squid expert, I have to admit I have 
some knowledge on it. And i'm also from Brazil, noticed your .com.br 
email address!


Em 10/08/2022 13:25, marcelorodrigo at graminsta.com.br escreveu:
> Hi Amos,
>
> It was me indeed.
> We have developed a squid based php application to create VPSs and 
> deliver proxies via web panel.
> It is still in development, but fase 1 is working already running SQL 
> user management, create VPSs and squid.conf auto configuration.
> We are heading to fase 2 to use cache pears and IPv4/IPv6 routing 
> depends on source.
>
> Squid.conf got so complex at this point that its getting very hard to 
> implement fase 2.
>
> Lack of deep squid knowledge is still our weak spot.

-- 


	Atenciosamente / Sincerily,
	Leonardo Rodrigues
	Solutti Tecnologia
	http://www.solutti.com.br


From jhoward at tetrascience.com  Thu Aug 11 20:00:12 2022
From: jhoward at tetrascience.com (Joel Howard)
Date: Thu, 11 Aug 2022 16:00:12 -0400
Subject: [squid-users] Squid as Reverse Proxy with Parent Proxy,
 http inbound and https outbound
Message-ID: <CADuf9gJDuZ7qrUZwiaDYNxuHdwga0Awx8RkVrM3QHP4rNsSF+g@mail.gmail.com>

Hi all,

I'm trying to use Squid (3.5.27, in a docker container) as a non-caching
reverse proxy with http inbound and https outbound, to support an
application that requires a proxy for internet access but does not allow
proxy configuration (and I do not have access to the application's host
machine). Ideally the squid proxy itself would not have a tls cert, since
inbound traffic would be http, and I would like to add headers.

What keeps stopping me is that I also need to support a parent forward
proxy, which itself may support http or https inbound.

I've tried the various examples here
<https://wiki.squid-cache.org/SquidFaq/ReverseProxy>, but I'm struggling to
"flip" the proxy direction - receive the request as a reverse proxy,
configure the outbound request appropriately, and then send it on *via* the
parent proxy. I'm not sure if cache_peers can be "chained" like this, or if
they can't, how I can configure the single cache_peer so that proxied https
works correctly.

This is my first foray into complex proxy configuration, so I'm not sure
whether I'm close or completely off base. Can provide more details or try
any suggestions.

Thanks!

-- 

*Joel Howard*
Software Technical Lead
jhoward at tetrascience.com | (330) 209-5779

[image: Logo Description automatically generated]
<http://www.tetrascience.com>

<https://www.linkedin.com/company/tetrascience>
<https://twitter.com/TetraScience>
<https://www.youtube.com/channel/UCxAIGW2oF5jgJ062pax98UQ>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220811/15cf15f6/attachment.htm>

From ngtech1ltd at gmail.com  Thu Aug 11 20:19:34 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Thu, 11 Aug 2022 23:19:34 +0300
Subject: [squid-users] Squid 4.8+ intercept
In-Reply-To: <ea8f3486-f341-6b05-31a1-2a7c49ae6c9b@spamtrap.tnetconsulting.net>
References: <CAFMSmTvEFMASCsodsZ43zdY_tEaKMJu2s_c8bCAKuyVd1i9yFg@mail.gmail.com>
 <CAFMSmTuUK_9UApWc76L91GDRm-tK-E+b=oLrUzF5Fitr-PZy3Q@mail.gmail.com>
 <002001d8ac9e$2ea4eb80$8beec280$@gmail.com>
 <ea8f3486-f341-6b05-31a1-2a7c49ae6c9b@spamtrap.tnetconsulting.net>
Message-ID: <002d01d8adbf$ac8c8a40$05a59ec0$@gmail.com>

Hey Grant,

The issue is very simple, if squid and the clients sits on the same subnet( not the same network segment)
then squid will send the traffic back directly to the client.
WCCP is not related to the network level of things and will not resolve this exact same issue in most similar use cases.
(there are which can but this is not the use case)

You should never SNAT traffic from local network to the proxy since you will cause some issue with this.
What you might want to do is to give the proxy a special subnet against the mikrotik and to use policy based routing
to forward the clients traffic to the proxy.

If you can plug the proxy to another port on the Mikrotik device and give it a special subnet it much more preferable.

I believe that WCCP is not an option for Mikrotik so unless you have a specific device that supports WCCP, don't bother thinking about it.
Also, in the same breath I can tell you that most commercial services that implement MITM have not been using and are not using WCCP.
There are much smarter ways these days then basic WCCP to make sure that the traffic will be passed to the right proxy.

Also just take a minute and think: what WCCP gives exactly that a Mikrotik admin cannot do?
A Mikrotik can be automated in such a way that WCCP would be inferior to what Mikrotik can offer.
(To my knowledge)

Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Grant Taylor
Sent: Thursday, 11 August 2022 6:48
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Squid 4.8+ intercept

On 8/10/22 3:47 AM, ngtech1ltd at gmail.com wrote:
> If the proxy sits in the same network that the clients sit it won?t work.

Why not?

Is this because of -- what I call -- the TCP triangle problem?  - 
Meaning that Squid sees the source as the client and replies directly?

If that's the case, you can cheat by SNATing the traffic that's going to 
Squid such that Squid sees the router as the source of the traffic. 
Thus Squid replies to the router which unDNATs it and sends it back to 
the original / real client.

Aside:  Isn't this what WCCP was originally meant to address?  Is WCCP a 
non-starter any more?  Even with TLS bump / monkey in the middle?



-- 
Grant. . . .
unix || die




From rousskov at measurement-factory.com  Thu Aug 11 20:28:12 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Thu, 11 Aug 2022 16:28:12 -0400
Subject: [squid-users] Squid as Reverse Proxy with Parent Proxy,
 http inbound and https outbound
In-Reply-To: <CADuf9gJDuZ7qrUZwiaDYNxuHdwga0Awx8RkVrM3QHP4rNsSF+g@mail.gmail.com>
References: <CADuf9gJDuZ7qrUZwiaDYNxuHdwga0Awx8RkVrM3QHP4rNsSF+g@mail.gmail.com>
Message-ID: <f1a4883f-6fd6-0a41-a19d-69e4b40e37c8@measurement-factory.com>

On 8/11/22 16:00, Joel Howard wrote:

> I'm trying to use Squid (3.5.27, in a docker container) 

My response below should cover Squid v3 in principle, but there may be 
important caveats that I am forgetting about that apply to that 
unsupported and ancient version. You should not use that version.


> as a non-caching 
> reverse proxy with http inbound and https outbound, to support an 
> application that requires a proxy for internet access but does not allow 
> proxy configuration (and I do not have access to the application's host 
> machine). Ideally the squid proxy itself would not have a tls cert, 
> since inbound traffic would be http, and I would like to add headers.

Are you trying to configure Squid to convert a received "GET 
http://example.com/" request into a "GET https://example.com" request 
sent from Squid (to the parent proxy)?


> What keeps stopping me is that I also need to support a parent forward 
> proxy, which itself may support http or https inbound.

Does the parent forward proxy accept plain text TCP connections or TLS 
connections? What port does the parent proxy listens on? Can you telnet 
or otherwise probe it to figure out whether it expects TLS? Most proxies 
expect plain text TCP connections, but there are HTTPS proxies that 
expect TLS.


> I've tried the various examples here 
> <https://wiki.squid-cache.org/SquidFaq/ReverseProxy>, but I'm struggling 
> to "flip" the proxy direction - receive the request as a reverse proxy, 
> configure the outbound request appropriately, and then send it on *via* 
> the parent proxy. I'm not sure if cache_peers can be "chained" like 
> this, or if they can't, how I can configure the single cache_peer so 
> that proxied https works correctly.

I have not tested this, but I would expect the reverse/forward "flip" 
itself to work more-or-less automatically -- Squid should do what is 
necessary on its own IIRC. I suspect your problem is elsewhere.

Perhaps you should try to make everything work for plain text HTTP 
traffic first? Outside of a docker?

Please share your http_port and cache_peer configuration and the 
errors/problems they currently cause.


Cheers,

Alex.


From abarnett at belofx.com  Thu Aug 11 20:41:05 2022
From: abarnett at belofx.com (Adam Barnett)
Date: Thu, 11 Aug 2022 21:41:05 +0100
Subject: [squid-users] Squid and Epic Games HCapctca
In-Reply-To: <075bbc18-b0f5-a037-d904-6b62ef72888f@measurement-factory.com>
References: <CAP9Tep55nVJDAcrTPJxsoKJnwk4bs2eTbuo-s7CwDCgzpQwBqA@mail.gmail.com>
 <004501d8a847$ba5051c0$2ef0f540$@gmail.com>
 <CAP9Tep7KBCvc4OqcOXOQZX8Whxu1j0z-Bev_WGwW60ZGOPN7Aw@mail.gmail.com>
 <004c01d8a84b$0332e3f0$0998abd0$@gmail.com>
 <CAP9Tep4pbvbC_OZSvB+qXDVuZZffZ0rH5KVo4ZSNoXcU1nncDg@mail.gmail.com>
 <005301d8a84d$60dd1780$22974680$@gmail.com>
 <CAP9Tep6xgTRd2sBrNju72mVWQtMY4xa==0e2DSzZGtHrbVpe9A@mail.gmail.com>
 <075bbc18-b0f5-a037-d904-6b62ef72888f@measurement-factory.com>
Message-ID: <CAP9Tep5WJT3HN=DSenMhzsOFCg7UtXVf2YfgTtj2uQk-F_tStw@mail.gmail.com>

I have finally managed to get hold of someone from Epic Games and they took
a look over their secret logs and said that it looks like squid is
dropping/closing the connection too soon

Any suggestions on what i can change to keep the connection open or from
dropping

Thanks

On Fri, 5 Aug 2022 at 15:57, Alex Rousskov <rousskov at measurement-factory.com>
wrote:

> On 8/5/22 05:10, Adam Barnett wrote:
> > maybe i am doing something wrong, here is my config
>
> > ssl_bump splice ...
> > ssl_bump bump dst_quixel
> > ssl_bump peek dst_quixel
> > ssl_bump stare dst_quixel
>
>
> The combination of the last three ssl_bump rules does not make sense
> because Squid will never reach those peek and stare rules. The bump rule
> can be applied during any SslBump step, so Squid will not see any
> same-ACL ssl_bump directives below it -- the first matching rule (that
> can be applied during the current step) wins.
>
> I do not know what logic you are trying to express with those rules, but
> the above configuration does not express that (or any) logic well. I
> hope Eliezer can guide you towards a reasonable solution here.
>
>
> HTH,
>
> Alex.
>
>
>
> >
> > On Thu, 4 Aug 2022 at 22:58, <ngtech1ltd at gmail.com
> > <mailto:ngtech1ltd at gmail.com>> wrote:
> >
> >     Please don?t bang your head? everybody is here for you.____
> >
> >     Sometimes it takes time to respond but you will get your answers.____
> >
> >     __ __
> >
> >
> https://www.ngtech.co.il/squid/support-save/support-save-2022-08-05_00-51-47.tar.gz
> >     <
> https://www.ngtech.co.il/squid/support-save/support-save-2022-08-05_00-51-47.tar.gz
> >____
> >
> >     __ __
> >
> >     Is not the fastest connection and it has a blacklist in the DB dump
> >     so for now it?s a production system but works good enough for me.____
> >
> >     I hope it?s not too much information in the support save file.____
> >
> >     __ __
> >
> >     Let me know if it makes more sense for you.____
> >
> >     AlsoI am happy that you have asked this question since now others
> >     can enjoy from the answer ?____
> >
> >     __ __
> >
> >     Eliezer____
> >
> >     __ __
> >
> >     ----____
> >
> >     Eliezer Croitoru____
> >
> >     NgTech, Tech Support____
> >
> >     Mobile: +972-5-28704261____
> >
> >     Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com>____
> >
> >     Web: https://ngtech.co.il/ <https://ngtech.co.il/>____
> >
> >     My-Tube: https://tube.ngtech.co.il/ <https://tube.ngtech.co.il/>____
> >
> >     __ __
> >
> >     *From:*Adam Barnett <abarnett at belofx.com <mailto:abarnett at belofx.com
> >>
> >     *Sent:* Friday, 5 August 2022 0:44
> >     *To:* ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com>
> >     *Cc:* squid-users at lists.squid-cache.org
> >     <mailto:squid-users at lists.squid-cache.org>
> >     *Subject:* Re: [squid-users] Squid and Epic Games HCapctca____
> >
> >     __ __
> >
> >     Sure, the more the beter, ive been banging my head against the wall
> >     for a while on this____
> >
> >     __ __
> >
> >     Adam ____
> >
> >     __ __
> >
> >     On Thu, 4 Aug 2022 at 22:41, <ngtech1ltd at gmail.com
> >     <mailto:ngtech1ltd at gmail.com>> wrote:____
> >
> >         You are welcome.____
> >
> >         ____
> >
> >         I wrote an app that does everything for me so I just need to
> >         dump the database into a:____
> >
> >         ssl::server_namedirective____
> >
> >         ____
> >
> >         it?s basically:____
> >
> >         ## START____
> >
> >         aclNoBump_server_name ssl::server_name
> >         "/etc/squid/no-ssl-bump-server-name.list"____
> >
> >         ____
> >
> >         acltls_to_splice any-of inspect_only NoBump_src
> >         NoBump_server_name NoBump_server_regex_by_urls_domain
> >         NoBump_server_regex____
> >
> >         ____
> >
> >         ssl_bumppeek app_matcher_helper____
> >
> >         ssl_bumppeek tls_s1_connect____
> >
> >         ____
> >
> >         ssl_bumpbump app_matcher_helper____
> >
> >         ssl_bumpbump app_reader_helper____
> >
> >         ssl_bumpbump deny_note____
> >
> >         ____
> >
> >         ssl_bumpsplice app_matcher_helper____
> >
> >         ssl_bumpsplice tls_to_splice____
> >
> >         ____
> >
> >         ssl_bumpstare app_matcher_helper____
> >
> >         ssl_bumpstare tls_s2_client_hello____
> >
> >         ____
> >
> >         ssl_bumpbump app_matcher_helper____
> >
> >         ssl_bumpbump tls_to_bump____
> >
> >         ## END____
> >
> >         ____
> >
> >         If you want I can upload a snippet of the whole setup dump with
> >         hope you could make use of it.____
> >
> >         ____
> >
> >         Eliezer____
> >
> >         ____
> >
> >         ----____
> >
> >         Eliezer Croitoru____
> >
> >         NgTech, Tech Support____
> >
> >         Mobile: +972-5-28704261____
> >
> >         Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com>____
> >
> >         Web: https://ngtech.co.il/ <https://ngtech.co.il/>____
> >
> >         My-Tube: https://tube.ngtech.co.il/ <https://tube.ngtech.co.il/
> >____
> >
> >         ____
> >
> >         *From:*Adam Barnett <abarnett at belofx.com
> >         <mailto:abarnett at belofx.com>>
> >         *Sent:* Friday, 5 August 2022 0:26
> >         *To:* ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com>
> >         *Cc:* squid-users at lists.squid-cache.org
> >         <mailto:squid-users at lists.squid-cache.org>
> >         *Subject:* Re: [squid-users] Squid and Epic Games HCapctca____
> >
> >         ____
> >
> >         ???? ???
> >         It looks like you are using a database and then building the
> >         config from that? any cahnce you can send me the snippet of the
> >         config instead of the DB bits? ? ____
> >
> >         ____
> >
> >         Thanks again ____
> >
> >         ____
> >
> >         Adam ____
> >
> >         ____
> >
> >         On Thu, 4 Aug 2022 at 22:18, <ngtech1ltd at gmail.com
> >         <mailto:ngtech1ltd at gmail.com>> wrote:____
> >
> >             Hey Adam,____
> >
> >             ____
> >
> >             I recorded a video for you on how I do it at:____
> >
> >
> https://cloud1.ngtech.co.il/static/squid-data/splice-epic-games.mp4
> >             <
> https://cloud1.ngtech.co.il/static/squid-data/splice-epic-games.mp4>____
> >
> >             ____
> >
> >             So basically the relevant domains are:____
> >
> >             ____
> >
> >             epicgames-download1.akamaized.net
> >             <http://epicgames-download1.akamaized.net>____
> >
> >             .epicgames.com <http://epicgames.com>____
> >
> >             .unrealengine.com <http://unrealengine.com>____
> >
> >             ____
> >
> >             And you can peek at robert k Wild mail: ?regex for normal
> >             websites?____
> >
> >             ____
> >
> >             And it contains the relevant technical details.____
> >
> >             If for any reason you need a more detailed answer let me
> >             know.____
> >
> >             ____
> >
> >             Yours,____
> >
> >             Eliezer ____
> >
> >             ____
> >
> >             ----____
> >
> >             Eliezer Croitoru____
> >
> >             NgTech, Tech Support____
> >
> >             Mobile: +972-5-28704261____
> >
> >             Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com
> >____
> >
> >             Web: https://ngtech.co.il/ <https://ngtech.co.il/>____
> >
> >             My-Tube: https://tube.ngtech.co.il/
> >             <https://tube.ngtech.co.il/>____
> >
> >             ____
> >
> >             *From:*squid-users
> >             <squid-users-bounces at lists.squid-cache.org
> >             <mailto:squid-users-bounces at lists.squid-cache.org>> *On
> >             Behalf Of *Adam Barnett
> >             *Sent:* Thursday, 4 August 2022 14:28
> >             *To:* squid-users at lists.squid-cache.org
> >             <mailto:squid-users at lists.squid-cache.org>
> >             *Subject:* [squid-users] Squid and Epic Games HCapctca____
> >
> >             ____
> >
> >             Hi All, ____
> >
> >             ____
> >
> >             I am trying to get squid to allow me to login to
> >             Epicgames.com with my epic login, i get to the login page
> >             and get the hcaptca images and everytime i get "invalid
> >             response" ____
> >
> >             ____
> >
> >             i looked at the headers and the only error that i can see is
> >             "The cache information is missing from the entry" ____
> >
> >             ____
> >
> >             My config looks like so
> >
> >             workers 2
> >
> >             ```
> >             # Leave coredumps in the first cache dir
> >             coredump_dir /var/spool/squid
> >
> >             http_port 3128 ssl-bump  dynamic_cert_mem_cache_size=16MB
> >               generate-host-certificates=on
> >             cert=/etc/squid/certs/squid-ca-cert-key.pem
> >
> >             sslcrtd_program /usr/lib64/squid/security_file_certgen -s
> >             /var/spool/squid/ssl -M 16MB
> >             dns_nameservers 10.5.1.2 8.8.8.8
> >             visible_hostname foo-proxy-1
> >             forwarded_for truncate
> >             via off
> >
> >             # Send to file
> >             access_log daemon:/var/log/squid/access.log
> >
> >
> >
> >             acl CONNECT method CONNECT
> >             acl local src 10.0.0.0/8 <http://10.0.0.0/8>
> >             always_direct allow all
> >             request_header_add X-GoogApps-Allowed-Domains "foo.com
> >             <http://foo.com>" all
> >
> >             memory_replacement_policy heap GDSF
> >             maximum_object_size 100 KB
> >             maximum_object_size 1 MB
> >
> >             cache allow all
> >             cache_mem 256 MB
> >             cache_dir rock /var/spool/squid 1024
> >             memory_pools off
> >             cache_swap_low 90
> >             client_persistent_connections on
> >
> >
> >             http_access allow localhost manager
> >             http_access deny manager
> >
> >             # SquidGaurd
> >             url_rewrite_program /usr/bin/squidGuard
> >             ```
> >
> >             Any suggestions? ____
> >
> >             ____
> >
> >             Thanks____
> >
> >             Adam Barnett
> >             Senior SysAdmin beloFX____
> >
> >             **____
> >
> >
> >
> >             ____
> >
> >
> >
> >             abarnett at belofx.com
> >             <
> https://514584150-atari-embeds.googleusercontent.com/embeds/16cb204cf3a9d4d223a0a3fd8b0eec5d/inner-frame-minified.html?jsh=m%3B%2F_%2Fscs%2Fabc-static%2F_%2Fjs%2Fk%3Dgapi.lb.en.dzXZWX9QTbE.O%2Fd%3D1%2Frs%3DAHpOoo_epIQDPHdjFr3MLkazUi2Jmy50dQ%2Fm%3D__features__
> >____
> >
> >             **____
> >
> >
> >
> >             ____
> >
> >
> >
> >             www.belofx.com <http://www.belofx.com/>____
> >
> >             **____
> >
> >
> >
> >             ____
> >
> >
> >
> >             LinkedIn <http://www.linkedin.com/company/belofx>____
> >
> >             ____
> >
> >
> > _______________________________________________
> > squid-users mailing list
> > squid-users at lists.squid-cache.org
> > http://lists.squid-cache.org/listinfo/squid-users
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220811/a87989d1/attachment.htm>

From gtaylor at tnetconsulting.net  Thu Aug 11 21:21:47 2022
From: gtaylor at tnetconsulting.net (Grant Taylor)
Date: Thu, 11 Aug 2022 15:21:47 -0600
Subject: [squid-users] Squid 4.8+ intercept
In-Reply-To: <002d01d8adbf$ac8c8a40$05a59ec0$@gmail.com>
References: <CAFMSmTvEFMASCsodsZ43zdY_tEaKMJu2s_c8bCAKuyVd1i9yFg@mail.gmail.com>
 <CAFMSmTuUK_9UApWc76L91GDRm-tK-E+b=oLrUzF5Fitr-PZy3Q@mail.gmail.com>
 <002001d8ac9e$2ea4eb80$8beec280$@gmail.com>
 <ea8f3486-f341-6b05-31a1-2a7c49ae6c9b@spamtrap.tnetconsulting.net>
 <002d01d8adbf$ac8c8a40$05a59ec0$@gmail.com>
Message-ID: <2d361a2d-21b6-fe07-c742-fc7ae2f86f1a@spamtrap.tnetconsulting.net>

On 8/11/22 2:19 PM, ngtech1ltd at gmail.com wrote:
> Hey Grant,

Hi Eliezer,

> The issue is very simple, if squid and the clients sits on the same 
> subnet( not the same network segment) then squid will send the traffic 
> back directly to the client.

So you're talking about -- what I call -- the TCP triangle problem, 
which can be worked around a number of different ways.

> WCCP is not related to the network level of things and will not 
> resolve this exact same issue in most similar use cases.

I question the veracity of that statement.

Not the least of which is that WCCP uses GRE as an L2 transport between 
the router and Squid and that Squid sees the packets as the router saw 
them.  What's more is that replies are sent back from Squid via the 
router through said GRE tunnel.  --  This very much seems like network 
level, both layers 2 and 3, to me.

> You should never SNAT traffic from local network to the proxy since 
> you will cause some issue with this.

Please elaborate on what issues will be caused.

The only issue that I'm aware of is the fact that traffic will appear to 
be from the router, not the original client.  But, depending on how 
things are being used, the lack of real source IP may be perfectly fine. 
  The only thing that I'm aware of where the lack of a real source IP is 
when you are doing things specific to source IP.

Said another way, I'm not aware of any problems with SNATing if none of 
your configuration is dependent on the source IP.

> What you might want to do is to give the proxy a special subnet 
> against the mikrotik and to use policy based routing to forward the 
> clients traffic to the proxy.
> 
> If you can plug the proxy to another port on the Mikrotik device and 
> give it a special subnet it much more preferable.

Preference does not equate to viability.

> I believe that WCCP is not an option for Mikrotik so unless you have 
> a specific device that supports WCCP, don't bother thinking about it.

ACK

> Also, in the same breath I can tell you that most commercial services 
> that implement MITM have not been using and are not using WCCP.

In my opinion, what someone else is doing or not doing has extremely 
little influence on what I do or don't do.

> There are much smarter ways these days then basic WCCP to make sure 
> that the traffic will be passed to the right proxy.

Please elaborate on such ways, other than PBR.

> Also just take a minute and think: what WCCP gives exactly that a 
> Mikrotik admin cannot do?

For starters, my understanding is that WCCP can get the traffic to the 
proxy, in any subnet local or remote, without altering the source / 
destination IP address.

> A Mikrotik can be automated in such a way that WCCP would be inferior 
> to what Mikrotik can offer.  (To my knowledge)

Please elaborate.

I don't see what automation has to do with this discussion.



-- 
Grant. . . .
unix || die

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4017 bytes
Desc: S/MIME Cryptographic Signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220811/152edc2d/attachment.bin>

From abarnett at belofx.com  Thu Aug 11 21:22:07 2022
From: abarnett at belofx.com (Adam Barnett)
Date: Thu, 11 Aug 2022 22:22:07 +0100
Subject: [squid-users] Squid and Epic Games HCapctca
In-Reply-To: <CAP9Tep5WJT3HN=DSenMhzsOFCg7UtXVf2YfgTtj2uQk-F_tStw@mail.gmail.com>
References: <CAP9Tep55nVJDAcrTPJxsoKJnwk4bs2eTbuo-s7CwDCgzpQwBqA@mail.gmail.com>
 <004501d8a847$ba5051c0$2ef0f540$@gmail.com>
 <CAP9Tep7KBCvc4OqcOXOQZX8Whxu1j0z-Bev_WGwW60ZGOPN7Aw@mail.gmail.com>
 <004c01d8a84b$0332e3f0$0998abd0$@gmail.com>
 <CAP9Tep4pbvbC_OZSvB+qXDVuZZffZ0rH5KVo4ZSNoXcU1nncDg@mail.gmail.com>
 <005301d8a84d$60dd1780$22974680$@gmail.com>
 <CAP9Tep6xgTRd2sBrNju72mVWQtMY4xa==0e2DSzZGtHrbVpe9A@mail.gmail.com>
 <075bbc18-b0f5-a037-d904-6b62ef72888f@measurement-factory.com>
 <CAP9Tep5WJT3HN=DSenMhzsOFCg7UtXVf2YfgTtj2uQk-F_tStw@mail.gmail.com>
Message-ID: <CAP9Tep6McDDemXj11NmhQLJJ-qmc19RP-C=ZAB2UNp2CPwRQAQ@mail.gmail.com>

Sorry to bombard, but the plot thickens. it all works find on linux chrome
( centos 7) but windows 10/2022 server chrome you get the error

i did not think anything in squid is os specific



On Thu, 11 Aug 2022 at 21:41, Adam Barnett <abarnett at belofx.com> wrote:

> I have finally managed to get hold of someone from Epic Games and they
> took a look over their secret logs and said that it looks like squid is
> dropping/closing the connection too soon
>
> Any suggestions on what i can change to keep the connection open or from
> dropping
>
> Thanks
>
> On Fri, 5 Aug 2022 at 15:57, Alex Rousskov <
> rousskov at measurement-factory.com> wrote:
>
>> On 8/5/22 05:10, Adam Barnett wrote:
>> > maybe i am doing something wrong, here is my config
>>
>> > ssl_bump splice ...
>> > ssl_bump bump dst_quixel
>> > ssl_bump peek dst_quixel
>> > ssl_bump stare dst_quixel
>>
>>
>> The combination of the last three ssl_bump rules does not make sense
>> because Squid will never reach those peek and stare rules. The bump rule
>> can be applied during any SslBump step, so Squid will not see any
>> same-ACL ssl_bump directives below it -- the first matching rule (that
>> can be applied during the current step) wins.
>>
>> I do not know what logic you are trying to express with those rules, but
>> the above configuration does not express that (or any) logic well. I
>> hope Eliezer can guide you towards a reasonable solution here.
>>
>>
>> HTH,
>>
>> Alex.
>>
>>
>>
>> >
>> > On Thu, 4 Aug 2022 at 22:58, <ngtech1ltd at gmail.com
>> > <mailto:ngtech1ltd at gmail.com>> wrote:
>> >
>> >     Please don?t bang your head? everybody is here for you.____
>> >
>> >     Sometimes it takes time to respond but you will get your
>> answers.____
>> >
>> >     __ __
>> >
>> >
>> https://www.ngtech.co.il/squid/support-save/support-save-2022-08-05_00-51-47.tar.gz
>> >     <
>> https://www.ngtech.co.il/squid/support-save/support-save-2022-08-05_00-51-47.tar.gz
>> >____
>> >
>> >     __ __
>> >
>> >     Is not the fastest connection and it has a blacklist in the DB dump
>> >     so for now it?s a production system but works good enough for
>> me.____
>> >
>> >     I hope it?s not too much information in the support save file.____
>> >
>> >     __ __
>> >
>> >     Let me know if it makes more sense for you.____
>> >
>> >     AlsoI am happy that you have asked this question since now others
>> >     can enjoy from the answer ?____
>> >
>> >     __ __
>> >
>> >     Eliezer____
>> >
>> >     __ __
>> >
>> >     ----____
>> >
>> >     Eliezer Croitoru____
>> >
>> >     NgTech, Tech Support____
>> >
>> >     Mobile: +972-5-28704261____
>> >
>> >     Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com>____
>> >
>> >     Web: https://ngtech.co.il/ <https://ngtech.co.il/>____
>> >
>> >     My-Tube: https://tube.ngtech.co.il/ <https://tube.ngtech.co.il/
>> >____
>> >
>> >     __ __
>> >
>> >     *From:*Adam Barnett <abarnett at belofx.com <mailto:
>> abarnett at belofx.com>>
>> >     *Sent:* Friday, 5 August 2022 0:44
>> >     *To:* ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com>
>> >     *Cc:* squid-users at lists.squid-cache.org
>> >     <mailto:squid-users at lists.squid-cache.org>
>> >     *Subject:* Re: [squid-users] Squid and Epic Games HCapctca____
>> >
>> >     __ __
>> >
>> >     Sure, the more the beter, ive been banging my head against the wall
>> >     for a while on this____
>> >
>> >     __ __
>> >
>> >     Adam ____
>> >
>> >     __ __
>> >
>> >     On Thu, 4 Aug 2022 at 22:41, <ngtech1ltd at gmail.com
>> >     <mailto:ngtech1ltd at gmail.com>> wrote:____
>> >
>> >         You are welcome.____
>> >
>> >         ____
>> >
>> >         I wrote an app that does everything for me so I just need to
>> >         dump the database into a:____
>> >
>> >         ssl::server_namedirective____
>> >
>> >         ____
>> >
>> >         it?s basically:____
>> >
>> >         ## START____
>> >
>> >         aclNoBump_server_name ssl::server_name
>> >         "/etc/squid/no-ssl-bump-server-name.list"____
>> >
>> >         ____
>> >
>> >         acltls_to_splice any-of inspect_only NoBump_src
>> >         NoBump_server_name NoBump_server_regex_by_urls_domain
>> >         NoBump_server_regex____
>> >
>> >         ____
>> >
>> >         ssl_bumppeek app_matcher_helper____
>> >
>> >         ssl_bumppeek tls_s1_connect____
>> >
>> >         ____
>> >
>> >         ssl_bumpbump app_matcher_helper____
>> >
>> >         ssl_bumpbump app_reader_helper____
>> >
>> >         ssl_bumpbump deny_note____
>> >
>> >         ____
>> >
>> >         ssl_bumpsplice app_matcher_helper____
>> >
>> >         ssl_bumpsplice tls_to_splice____
>> >
>> >         ____
>> >
>> >         ssl_bumpstare app_matcher_helper____
>> >
>> >         ssl_bumpstare tls_s2_client_hello____
>> >
>> >         ____
>> >
>> >         ssl_bumpbump app_matcher_helper____
>> >
>> >         ssl_bumpbump tls_to_bump____
>> >
>> >         ## END____
>> >
>> >         ____
>> >
>> >         If you want I can upload a snippet of the whole setup dump with
>> >         hope you could make use of it.____
>> >
>> >         ____
>> >
>> >         Eliezer____
>> >
>> >         ____
>> >
>> >         ----____
>> >
>> >         Eliezer Croitoru____
>> >
>> >         NgTech, Tech Support____
>> >
>> >         Mobile: +972-5-28704261____
>> >
>> >         Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com>____
>> >
>> >         Web: https://ngtech.co.il/ <https://ngtech.co.il/>____
>> >
>> >         My-Tube: https://tube.ngtech.co.il/ <https://tube.ngtech.co.il/
>> >____
>> >
>> >         ____
>> >
>> >         *From:*Adam Barnett <abarnett at belofx.com
>> >         <mailto:abarnett at belofx.com>>
>> >         *Sent:* Friday, 5 August 2022 0:26
>> >         *To:* ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com>
>> >         *Cc:* squid-users at lists.squid-cache.org
>> >         <mailto:squid-users at lists.squid-cache.org>
>> >         *Subject:* Re: [squid-users] Squid and Epic Games HCapctca____
>> >
>> >         ____
>> >
>> >         ???? ???
>> >         It looks like you are using a database and then building the
>> >         config from that? any cahnce you can send me the snippet of the
>> >         config instead of the DB bits? ? ____
>> >
>> >         ____
>> >
>> >         Thanks again ____
>> >
>> >         ____
>> >
>> >         Adam ____
>> >
>> >         ____
>> >
>> >         On Thu, 4 Aug 2022 at 22:18, <ngtech1ltd at gmail.com
>> >         <mailto:ngtech1ltd at gmail.com>> wrote:____
>> >
>> >             Hey Adam,____
>> >
>> >             ____
>> >
>> >             I recorded a video for you on how I do it at:____
>> >
>> >
>> https://cloud1.ngtech.co.il/static/squid-data/splice-epic-games.mp4
>> >             <
>> https://cloud1.ngtech.co.il/static/squid-data/splice-epic-games.mp4>____
>> >
>> >             ____
>> >
>> >             So basically the relevant domains are:____
>> >
>> >             ____
>> >
>> >             epicgames-download1.akamaized.net
>> >             <http://epicgames-download1.akamaized.net>____
>> >
>> >             .epicgames.com <http://epicgames.com>____
>> >
>> >             .unrealengine.com <http://unrealengine.com>____
>> >
>> >             ____
>> >
>> >             And you can peek at robert k Wild mail: ?regex for normal
>> >             websites?____
>> >
>> >             ____
>> >
>> >             And it contains the relevant technical details.____
>> >
>> >             If for any reason you need a more detailed answer let me
>> >             know.____
>> >
>> >             ____
>> >
>> >             Yours,____
>> >
>> >             Eliezer ____
>> >
>> >             ____
>> >
>> >             ----____
>> >
>> >             Eliezer Croitoru____
>> >
>> >             NgTech, Tech Support____
>> >
>> >             Mobile: +972-5-28704261____
>> >
>> >             Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com
>> >____
>> >
>> >             Web: https://ngtech.co.il/ <https://ngtech.co.il/>____
>> >
>> >             My-Tube: https://tube.ngtech.co.il/
>> >             <https://tube.ngtech.co.il/>____
>> >
>> >             ____
>> >
>> >             *From:*squid-users
>> >             <squid-users-bounces at lists.squid-cache.org
>> >             <mailto:squid-users-bounces at lists.squid-cache.org>> *On
>> >             Behalf Of *Adam Barnett
>> >             *Sent:* Thursday, 4 August 2022 14:28
>> >             *To:* squid-users at lists.squid-cache.org
>> >             <mailto:squid-users at lists.squid-cache.org>
>> >             *Subject:* [squid-users] Squid and Epic Games HCapctca____
>> >
>> >             ____
>> >
>> >             Hi All, ____
>> >
>> >             ____
>> >
>> >             I am trying to get squid to allow me to login to
>> >             Epicgames.com with my epic login, i get to the login page
>> >             and get the hcaptca images and everytime i get "invalid
>> >             response" ____
>> >
>> >             ____
>> >
>> >             i looked at the headers and the only error that i can see is
>> >             "The cache information is missing from the entry" ____
>> >
>> >             ____
>> >
>> >             My config looks like so
>> >
>> >             workers 2
>> >
>> >             ```
>> >             # Leave coredumps in the first cache dir
>> >             coredump_dir /var/spool/squid
>> >
>> >             http_port 3128 ssl-bump  dynamic_cert_mem_cache_size=16MB
>> >               generate-host-certificates=on
>> >             cert=/etc/squid/certs/squid-ca-cert-key.pem
>> >
>> >             sslcrtd_program /usr/lib64/squid/security_file_certgen -s
>> >             /var/spool/squid/ssl -M 16MB
>> >             dns_nameservers 10.5.1.2 8.8.8.8
>> >             visible_hostname foo-proxy-1
>> >             forwarded_for truncate
>> >             via off
>> >
>> >             # Send to file
>> >             access_log daemon:/var/log/squid/access.log
>> >
>> >
>> >
>> >             acl CONNECT method CONNECT
>> >             acl local src 10.0.0.0/8 <http://10.0.0.0/8>
>> >             always_direct allow all
>> >             request_header_add X-GoogApps-Allowed-Domains "foo.com
>> >             <http://foo.com>" all
>> >
>> >             memory_replacement_policy heap GDSF
>> >             maximum_object_size 100 KB
>> >             maximum_object_size 1 MB
>> >
>> >             cache allow all
>> >             cache_mem 256 MB
>> >             cache_dir rock /var/spool/squid 1024
>> >             memory_pools off
>> >             cache_swap_low 90
>> >             client_persistent_connections on
>> >
>> >
>> >             http_access allow localhost manager
>> >             http_access deny manager
>> >
>> >             # SquidGaurd
>> >             url_rewrite_program /usr/bin/squidGuard
>> >             ```
>> >
>> >             Any suggestions? ____
>> >
>> >             ____
>> >
>> >             Thanks____
>> >
>> >             Adam Barnett
>> >             Senior SysAdmin beloFX____
>> >
>> >             **____
>> >
>> >
>> >
>> >             ____
>> >
>> >
>> >
>> >             abarnett at belofx.com
>> >             <
>> https://514584150-atari-embeds.googleusercontent.com/embeds/16cb204cf3a9d4d223a0a3fd8b0eec5d/inner-frame-minified.html?jsh=m%3B%2F_%2Fscs%2Fabc-static%2F_%2Fjs%2Fk%3Dgapi.lb.en.dzXZWX9QTbE.O%2Fd%3D1%2Frs%3DAHpOoo_epIQDPHdjFr3MLkazUi2Jmy50dQ%2Fm%3D__features__
>> >____
>> >
>> >             **____
>> >
>> >
>> >
>> >             ____
>> >
>> >
>> >
>> >             www.belofx.com <http://www.belofx.com/>____
>> >
>> >             **____
>> >
>> >
>> >
>> >             ____
>> >
>> >
>> >
>> >             LinkedIn <http://www.linkedin.com/company/belofx>____
>> >
>> >             ____
>> >
>> >
>> > _______________________________________________
>> > squid-users mailing list
>> > squid-users at lists.squid-cache.org
>> > http://lists.squid-cache.org/listinfo/squid-users
>>
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220811/37c6f921/attachment.htm>

From jhoward at tetrascience.com  Fri Aug 12 04:28:07 2022
From: jhoward at tetrascience.com (Joel Howard)
Date: Fri, 12 Aug 2022 00:28:07 -0400
Subject: [squid-users] Squid as Reverse Proxy with Parent Proxy,
 http inbound and https outbound
In-Reply-To: <mailman.693.1660249694.1112.squid-users@lists.squid-cache.org>
References: <mailman.693.1660249694.1112.squid-users@lists.squid-cache.org>
Message-ID: <CADuf9g+mbzyX1Za-_jG8qWYGxSp1Kept5Mnbx13bahFuVUth+Q@mail.gmail.com>

Hey Alex,

Thanks for the quick and detailed response! I inherited this service
recently - would you recommend upgrading to 5? My configs are fairly
simple, so upgrade should be easy.

Here's my desired flow - let "reverse" and "parent" represent the IPs of
those proxies, and "target" represent the target API hostname.

Application sends GET (POST, PUT, etc) http://reverse/some/path
(Note: Application doesn't know target, and couldn't reach it if it did.)

Reverse adds headers to the request
Reverse sends the request to https://target/some/path, using parent as a
forward proxy.

The parent proxy in my test case accepts TCP, although if possible I would
like to support parent TLS proxies as well - this reverse proxy is deployed
in different environments where the parent proxy may differ.

I set this up outside of a docker and without trying to force ssl. The
config below was my first attempt - it works *if* the reverse proxy has
direct internet access, but just hangs otherwise; my understanding is that
requests that use the first cache_peer do not use the second to proxy.

# Reverse proxy to google.com
http_port 80 accel vhost defaultsite=www.google.com
cache_peer google.com parent 80 0 no-query originserver forceddomain=
www.google.com name=target
request_header_add Joel Joel

# Simplified acl
http_access allow all
cache_peer_access target allow all

# Parent proxy
cache_peer 10.60.4.178 parent 3128 0 no-query default
acl all src 0.0.0.0/0.0.0.0
never_direct allow all

This was my second attempt, using forceddomain to replace the host header
but sending the request directly to the parent proxy. This results in the
parent receiving GET /, which it does not understand (it expects GET
target/somepath).

# Reverse proxy directly to forward proxy google.com
http_port 80 accel vhost defaultsite=www.google.com
cache_peer 10.60.4.178 parent 3128 0 no-query originserver forceddomain=
www.google.com name=parent
request_header_add Joel Joel

# Misc
cache deny all
shutdown_lifetime 1 seconds

I suspect this would need a url rewriter to force the url to target - I'm
failing to get any of the example rewriters working (maybe due to the old
squid version?) so I haven't been able to test that yet. But I suspect it
will fail for HTTPS, because the rewritten URL will be sent as GET
target/something to the parent proxy, instead of CONNECT target/something -
I still think I'm missing something to get my squid to use the forward *as
a proxy* while itself functioning in reverse.

I'll rewrite these for squid 5 and try to get URL rewriting working. In the
meantime, could you let me know if either of these two general approaches
is remotely correct and if so, what I can do to get further with them?

Thanks so much! If you happen to be on StackOverflow, I've asked the
question with a bounty there
<https://stackoverflow.com/questions/73286678/reverse-proxy-with-http-inbound-https-outbound-and-parent-proxy/73293978?noredirect=1#comment129465312_73293978>
as well (although less squid-specific).
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220812/b1fcdb09/attachment.htm>

From ngtech1ltd at gmail.com  Fri Aug 12 08:14:10 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Fri, 12 Aug 2022 11:14:10 +0300
Subject: [squid-users] Squid as Reverse Proxy with Parent Proxy,
 http inbound and https outbound
In-Reply-To: <CADuf9g+mbzyX1Za-_jG8qWYGxSp1Kept5Mnbx13bahFuVUth+Q@mail.gmail.com>
References: <mailman.693.1660249694.1112.squid-users@lists.squid-cache.org>
 <CADuf9g+mbzyX1Za-_jG8qWYGxSp1Kept5Mnbx13bahFuVUth+Q@mail.gmail.com>
Message-ID: <000501d8ae23$80d0b700$82722500$@gmail.com>

Hey Joel,
 
I don?t know if squid would be able to do what you want/need but I know that nginx can do some part of what you want.
 
Eliezer
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> 
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/
 
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Joel Howard
Sent: Friday, 12 August 2022 7:28
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Squid as Reverse Proxy with Parent Proxy, http inbound and https outbound
 
Hey Alex,
 
Thanks for the quick and detailed response! I inherited this service recently - would you recommend upgrading to 5? My configs are fairly simple, so upgrade should be easy.
 
Here's my desired flow - let "reverse" and "parent" represent the IPs of those proxies, and "target" represent the target API hostname.

Application sends GET (POST, PUT, etc) http://reverse/some/path
(Note: Application doesn't know target, and couldn't reach it if it did.)

Reverse adds headers to the request
Reverse sends the request to https://target/some/path, using parent as a forward proxy.
 
The parent proxy in my test case accepts TCP, although if possible I would like to support parent TLS proxies as well - this reverse proxy is deployed in different environments where the parent proxy may differ.

I set this up outside of a docker and without trying to force ssl. The config below was my first attempt - it works if the reverse proxy has direct internet access, but just hangs otherwise; my understanding is that requests that use the first cache_peer do not use the second to proxy.
 
# Reverse proxy to google.com <http://google.com> 
http_port 80 accel vhost defaultsite=www.google.com <http://www.google.com> 
cache_peer google.com <http://google.com>  parent 80 0 no-query originserver forceddomain=www.google.com <http://www.google.com>  name=target
request_header_add Joel Joel

# Simplified acl
http_access allow all
cache_peer_access target allow all

# Parent proxy
cache_peer 10.60.4.178 parent 3128 0 no-query default
acl all src 0.0.0.0/0.0.0.0 <http://0.0.0.0/0.0.0.0> 
never_direct allow all

This was my second attempt, using forceddomain to replace the host header but sending the request directly to the parent proxy. This results in the parent receiving GET /, which it does not understand (it expects GET target/somepath).
 
# Reverse proxy directly to forward proxy google.com <http://google.com> 
http_port 80 accel vhost defaultsite=www.google.com <http://www.google.com> 
cache_peer 10.60.4.178 parent 3128 0 no-query originserver forceddomain=www.google.com <http://www.google.com>  name=parent
request_header_add Joel Joel

# Misc
cache deny all
shutdown_lifetime 1 seconds
 
I suspect this would need a url rewriter to force the url to target - I'm failing to get any of the example rewriters working (maybe due to the old squid version?) so I haven't been able to test that yet. But I suspect it will fail for HTTPS, because the rewritten URL will be sent as GET target/something to the parent proxy, instead of CONNECT target/something - I still think I'm missing something to get my squid to use the forward as a proxy while itself functioning in reverse.
 
I'll rewrite these for squid 5 and try to get URL rewriting working. In the meantime, could you let me know if either of these two general approaches is remotely correct and if so, what I can do to get further with them?

Thanks so much! If you happen to be on StackOverflow, I've asked the question with a bounty there <https://stackoverflow.com/questions/73286678/reverse-proxy-with-http-inbound-https-outbound-and-parent-proxy/73293978?noredirect=1#comment129465312_73293978>  as well (although less squid-specific).
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220812/086e038a/attachment.htm>

From rousskov at measurement-factory.com  Fri Aug 12 15:18:32 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Fri, 12 Aug 2022 11:18:32 -0400
Subject: [squid-users] Squid as Reverse Proxy with Parent Proxy,
 http inbound and https outbound
In-Reply-To: <CADuf9g+mbzyX1Za-_jG8qWYGxSp1Kept5Mnbx13bahFuVUth+Q@mail.gmail.com>
References: <mailman.693.1660249694.1112.squid-users@lists.squid-cache.org>
 <CADuf9g+mbzyX1Za-_jG8qWYGxSp1Kept5Mnbx13bahFuVUth+Q@mail.gmail.com>
Message-ID: <663b73e9-0bef-b58b-3d0e-fdc4beeeb8dd@measurement-factory.com>

On 8/12/22 00:28, Joel Howard wrote:

> Thanks for the quick and detailed response! I inherited this service 
> recently - would you recommend upgrading to 5? My configs are fairly 
> simple, so upgrade?should be easy.

I recommend not using v3. I do not have enough information about your 
environment to _recommend_ a specific version to upgrade to. By default, 
you should be upgrading to v5.


> Here's my desired flow - let "reverse" and "parent" represent the IPs of 
> those proxies, and "target" represent the target API hostname.
> 
> Application sends GET (POST, PUT, etc) http://reverse/some/path 

Nitpick: That is not exactly what the application sends if reverse is a 
reverse proxy. The application will send "GET /some/path" (with 
"reverse" in the Host header).


> Reverse adds headers to the request
> Reverse sends the request to https://target/some/path 
> using?parent as a forward proxy.

I am not sure, but I suspect you will need a URL rewriter to change the 
URL scheme from "http" to "https".

> I set this up outside of a docker and without trying to force ssl. The 
> config below was my first attempt

Why are there suddenly two cache_peers in your configuration? Can you 
simplify, at least for now, and have just one?

And why are there no [parent] proxies in your configuration? If you want 
Squid to use a parent proxy, then you need a cache_peer option _without_ 
the originserver flag. That flag coverts Squid treatment of an HTTP 
agent at the specified cache_peer address from a [forward] proxy [that 
you want] to an origin server.

I would start with the following sketch:

     http_port 80 accel
     cache_peer 10.60.4.178 parent 3128 0 no-query no-digest
     http_access ...

And then, after the above is adjusted and working as expected, add 
request URL rewriting to try to change the URL scheme to https.

HTH,

Alex.


> # Reverse proxy to google.com <http://google.com>
> http_port 80 accel vhost defaultsite=www.google.com <http://www.google.com>
> cache_peer google.com <http://google.com> parent 80 0 no-query 
> originserver forceddomain=www.google.com <http://www.google.com> name=target
> request_header_add Joel Joel
> 
> # Simplified acl
> http_access allow all
> cache_peer_access target allow all
> 
> # Parent proxy
> cache_peer 10.60.4.178 parent 3128 0 no-query default
> acl all src 0.0.0.0/0.0.0.0 <http://0.0.0.0/0.0.0.0>
> never_direct allow all
> 
> This was my second attempt, using forceddomain to replace the host 
> header but sending the request directly to the parent proxy. This 
> results in the parent receiving GET /, which it does not understand (it 
> expects GET target/somepath).
> 
> # Reverse proxy directly to forward proxy google.com <http://google.com>
> http_port 80 accel vhost defaultsite=www.google.com <http://www.google.com>
> cache_peer 10.60.4.178 parent 3128 0 no-query originserver 
> forceddomain=www.google.com <http://www.google.com> name=parent
> request_header_add Joel Joel
> 
> # Misc
> cache deny all
> shutdown_lifetime 1 seconds
> 
> I suspect this would need a url rewriter to force the url to target - 
> I'm failing to get any of the example rewriters working (maybe due to 
> the old squid version?) so I haven't been able to test that yet. But I 
> suspect it will fail for HTTPS, because the rewritten URL will be sent 
> as GET target/something to the parent proxy, instead of CONNECT 
> target/something - I still think I'm missing something to get my squid 
> to use the forward /as a proxy/?while itself functioning in reverse.
> 
> I'll rewrite these for squid 5 and try to get URL rewriting working. In 
> the meantime, could you let me know if either of these two general 
> approaches is remotely correct and if so, what I can do to get further 
> with them?
> 
> Thanks so much! If you happen to be on StackOverflow, I've asked the 
> question with a bounty there 
> <https://stackoverflow.com/questions/73286678/reverse-proxy-with-http-inbound-https-outbound-and-parent-proxy/73293978?noredirect=1#comment129465312_73293978> 
> as well (although less squid-specific).
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



From jhoward at tetrascience.com  Fri Aug 12 21:13:26 2022
From: jhoward at tetrascience.com (Joel Howard)
Date: Fri, 12 Aug 2022 17:13:26 -0400
Subject: [squid-users] Squid as Reverse Proxy with Parent Proxy,
 http inbound and https outbound
Message-ID: <CADuf9g+ukTYR3eXqFpASxckc6_JaT5A6pBx32f_BTQQi64i+qw@mail.gmail.com>

Gotcha - I'll upgrade to 5 shortly, but I don't think that's affecting my
confusion.

Thanks for your nitpick, I think it's actually part of the key. I followed
your suggestion, trying the parent cache_peer just on http, with the
following squid.conf.

http_port 80 accel
cache_peer 10.60.4.178 parent 3128 0 no-query no-digest name=forward
request_header_add Joel Joel

# Simplified acl
http_access allow all
cache_peer_access forward allow all

# Misc
shutdown_lifetime 1 seconds
debug_options ALL,6

I upped the log level and followed how squid transformed the request, and
saw it change

GET / to
GET its-own-hostname/

based on the Host header on the incoming request, as you pointed out.

The first problem is, the parent proxy doesn't know how to resolve that
host - it rejects the request with "Invalid URL". I need the reverse proxy
to rewrite both the host header and url to their correct target values for
the parent proxy.

I tested this via telnet to the parent proxy (since I'm still struggling to
get squid url rewriting working, will try that more later). When I sent

GET http://target-hostname/ HTTP/1.1
User-Agent: curl/7.68.0
Accept: */*
Host: target-hostname
Via: 1.1 ip-10-60-4-103 (squid/3.5.27)
Surrogate-Capability: ip-10-60-4-103="Surrogate/1.0 ESI/1.0"
X-Forwarded-For: 10.40.0.194
Cache-Control: max-age=259200
Connection: keep-alive
Joel: Joel

it works, but if I try https I get "Unsupported Request Method and
Protocol" (it so happens that the parent proxy is also a squid in this
case). I think this is expected, as the request above (https from proxy to
proxy, on behalf of http client) should have been a CONNECT followed by the
GET once the tunnel was established.

So: is squid capable of receiving the GET / to itself, sending a CONNECT
/target-hostname to the parent proxy, negotiating that connection and then
returning the result to the client? Obviously when it's functioning as a
forward proxy it can *receive* CONNECTs and handle them, but this is the
"flip" I'm still struggling with.

Thanks so much for your time, I'm learning this as I go and you've been
very helpful.

-- 

*Joel Howard*
Software Technical Lead
jhoward at tetrascience.com | (330) 209-5779

[image: Logo Description automatically generated]
<http://www.tetrascience.com>

<https://www.linkedin.com/company/tetrascience>
<https://twitter.com/TetraScience>
<https://www.youtube.com/channel/UCxAIGW2oF5jgJ062pax98UQ>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220812/d4e2f9c6/attachment.htm>

From osy at turing.llc  Sat Aug 13 01:13:44 2022
From: osy at turing.llc (osy)
Date: Fri, 12 Aug 2022 18:13:44 -0700
Subject: [squid-users] Problem caching range requests with
 range_offset_limit
In-Reply-To: <CA+E+eSCSC_ReYmeJR1O7vNaVu5ix65NdQgL18Kd9EqYb8AWqdg@mail.gmail.com>
References: <CA+E+eSCSC_ReYmeJR1O7vNaVu5ix65NdQgL18Kd9EqYb8AWqdg@mail.gmail.com>
Message-ID: <CA+E+eSANEFJ+yccjb+_jmM4_KdAYWPSe66ke_8MCUpJvgwYS1A@mail.gmail.com>

I was able to fix the issue by patching Squid to keep the client
connection open until the full object is fetched. My changes are
detailed in https://gist.github.com/osy/30c5c96d7575efd1d2a2db5e3def0815

On Wed, Aug 10, 2022 at 7:43 PM osy <osy at turing.llc> wrote:
>
> I am trying to cache Azure objects. I have SSL bump and the following config:
>
> maximum_object_size 1000 MB
> acl azure_storage dstdomain .blob.core.windows.net
> range_offset_limit -1 azure_storage
>
> My expectation is that when a request is made with the Range header,
> that Squid will request the object starting from the beginning, return
> the data when it reaches the range, then keep the connection open and
> keep requesting data until the end. However, I observe the last part
> isn't true: the connection to the server is closed after the proxy
> client closes the connection.
>
> 2022/08/10 18:55:23.152| 5,3| Read.cc(92) ReadNow:
> local=127.0.0.1:3128 remote=127.0.0.1:57075 FD 21 flags=1, size 3644,
> retval 0, errno 0
> 2022/08/10 18:55:23.152| 33,5| Server.cc(147) doClientRead:
> local=127.0.0.1:3128 remote=127.0.0.1:57075 FD 21 flags=1 closed?
> 2022/08/10 18:55:23.152| 33,3| client_side.cc(1418)
> connFinishedWithConn: local=127.0.0.1:3128 remote=127.0.0.1:57075 FD
> 21 flags=1 aborted (half_closed_clients disabled)
> 2022/08/10 18:55:23.152| 33,3| Pipeline.cc(56) terminateAll: Pipeline
> 0x149704e80 notify(0) 0x13a817600*3
> 2022/08/10 18:55:23.152| 90,3| store_client.cc(651) storeUnregister:
> storeUnregister: called for 'F43F6204305C4808C2A393C7CC905C16'
> 2022/08/10 18:55:23.153| 90,3| store_client.cc(764)
> CheckQuickAbortIsReasonable: entry=e:d5 at 0=w1p2V/0x6000038f6d80*6
> 2022/08/10 18:55:23.153| 90,3| store_client.cc(755)
> storePendingNClients: storePendingNClients: returning 0
> 2022/08/10 18:55:23.153| 90,3| store_client.cc(788)
> CheckQuickAbortIsReasonable: mem=0x14a14bcb0
> 2022/08/10 18:55:23.153| 90,3| store_client.cc(817)
> CheckQuickAbortIsReasonable: quick-abort? NO admin configured range
> replies to full-download
> 2022/08/10 18:55:23.153| 33,3| Pipeline.cc(69) popMe: Pipeline
> 0x149704e80 drop 0x13a817600*3
> 2022/08/10 18:55:23.153| 33,3| client_side_request.cc(270)
> ~ClientHttpRequest: httpRequestFree: [url here]
>
> I also tried setting "half_closed_clients on" but that just defers the
> error to a write later on. Any advice would be appreciated, thanks!


From mohammed.khallaf at gmail.com  Sat Aug 13 07:58:46 2022
From: mohammed.khallaf at gmail.com (M K)
Date: Sat, 13 Aug 2022 09:58:46 +0200
Subject: [squid-users] Squid 4.8+ intercept
In-Reply-To: <000401d8ac90$62fcea80$28f6bf80$@gmail.com>
References: <CAFMSmTvEFMASCsodsZ43zdY_tEaKMJu2s_c8bCAKuyVd1i9yFg@mail.gmail.com>
 <CAFMSmTuUK_9UApWc76L91GDRm-tK-E+b=oLrUzF5Fitr-PZy3Q@mail.gmail.com>
 <000401d8ac90$62fcea80$28f6bf80$@gmail.com>
Message-ID: <CAFMSmTt71mFhpanDVtKG0Gg6UA74ZAgpnBx5B__01K1Tmu5QLg@mail.gmail.com>

Thank  you for your quick reply. The text-drawing actually changed with
different font; the squid server is effectively connected to MikroTik
router, not the same physical link as the client.

The MikroTik router sits between the client and squid server.

That said, I can confirm that the MikroTik router is effectively able to
route/DNat client packets going to ports 80 and 443 to squid server.
Depending on router rules be it route or dnat, the client browser
effectively displays the error page of squid, or goes into a very long
delay then failure.

I will retry and let you know.

K

On Wed, Aug 10, 2022, 10:08 <ngtech1ltd at gmail.com> wrote:

> Hey K,
>
>
>
> I am not sure about the network topology.
>
> Preferably the Squid should reside on another network then the clients if
> it?s intercepting the traffic.
>
> Also, I assume it?s not a TPROXY setup so it should be pretty simple and
> straight forward.
>
>
>
> I understand why are you asking this question.
>
> Also take into account that Mikrotik is now on 7.4 firmware and it?s
> recommended to use this one.
>
> If you are using any other version let me know so I can try to make sense
> on the differences.
>
> I will try to give a DEMO for such a setup and how to make it work.
>
>
>
> Eliezer
>
>
>
> ----
>
> Eliezer Croitoru
>
> NgTech, Tech Support
>
> Mobile: +972-5-28704261
>
> Email: ngtech1ltd at gmail.com
>
> Web: https://ngtech.co.il/
>
> My-Tube: https://tube.ngtech.co.il/
>
>
>
> *From:* squid-users <squid-users-bounces at lists.squid-cache.org> *On
> Behalf Of *M K
> *Sent:* Tuesday, 9 August 2022 22:29
> *To:* squid-users at lists.squid-cache.org
> *Subject:* [squid-users] Squid 4.8+ intercept
>
>
>
> Hello,
>
>
>
> I have a setup like this one:
>
>
> | Client | =====> | Router | =====> Internet
>                      ||
>                      \/
>                   | Squid |
>
>
>
> ...the router is a Mikrotik router capable of all things NAT/Redirect and
> whatnot. Squid server has only one network interface.
>
> Using the router:
>
> - I tried routing traffic to squid server IP.
>
> - I tried destination-NATing from client to server IP, with origin server
> IP-and-port natted to squid IP-and-port, and with origin server IP-only
> natted to squid-IP.
>
>
>
> I have been struggling for 2 days to setup a working Squid 4.8 or higher
> interception.
>
> Test server is running Ubuntu 18.4.3 and Squid 4.8.
>
> Documentation is either too much trim or extremely outdated.
>
> Any help would be very much appreciated.
>
>
>
> All best,
>
> K
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220813/931a94d2/attachment.htm>

From ngtech1ltd at gmail.com  Sat Aug 13 17:57:57 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Sat, 13 Aug 2022 20:57:57 +0300
Subject: [squid-users] Squid 4.8+ intercept
In-Reply-To: <CAFMSmTt71mFhpanDVtKG0Gg6UA74ZAgpnBx5B__01K1Tmu5QLg@mail.gmail.com>
References: <CAFMSmTvEFMASCsodsZ43zdY_tEaKMJu2s_c8bCAKuyVd1i9yFg@mail.gmail.com>
 <CAFMSmTuUK_9UApWc76L91GDRm-tK-E+b=oLrUzF5Fitr-PZy3Q@mail.gmail.com>
 <000401d8ac90$62fcea80$28f6bf80$@gmail.com>
 <CAFMSmTt71mFhpanDVtKG0Gg6UA74ZAgpnBx5B__01K1Tmu5QLg@mail.gmail.com>
Message-ID: <001401d8af3e$392663c0$ab732b40$@gmail.com>

Hey K,
 
What RouterOS version are you using?
Also, what rules have you applied?
If there is a very long delay and then a failure you should verify that the rules you wrote are proper to your environment.
You should route packets based on connection marks and mark only new connections from LAN IP addresses and only on the LAN interface.
As I showed in the demo video it?s very simple to implement.
 
Let me know if you are still having issues.
 
Eliezer
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> 
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/
 
From: M K <mohammed.khallaf at gmail.com> 
Sent: Saturday, 13 August 2022 10:59
To: ngtech1ltd at gmail.com
Cc: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Squid 4.8+ intercept
 
Thank  you for your quick reply. The text-drawing actually changed with different font; the squid server is effectively connected to MikroTik router, not the same physical link as the client.
 
The MikroTik router sits between the client and squid server.
 
That said, I can confirm that the MikroTik router is effectively able to route/DNat client packets going to ports 80 and 443 to squid server. Depending on router rules be it route or dnat, the client browser effectively displays the error page of squid, or goes into a very long delay then failure.
 
I will retry and let you know.
 
K
On Wed, Aug 10, 2022, 10:08 <ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> > wrote:
Hey K,
 
I am not sure about the network topology.
Preferably the Squid should reside on another network then the clients if it?s intercepting the traffic.
Also, I assume it?s not a TPROXY setup so it should be pretty simple and straight forward.
 
I understand why are you asking this question.
Also take into account that Mikrotik is now on 7.4 firmware and it?s recommended to use this one.
If you are using any other version let me know so I can try to make sense on the differences.
I will try to give a DEMO for such a setup and how to make it work.
 
Eliezer
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> 
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/
 
From: squid-users <squid-users-bounces at lists.squid-cache.org <mailto:squid-users-bounces at lists.squid-cache.org> > On Behalf Of M K
Sent: Tuesday, 9 August 2022 22:29
To: squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> 
Subject: [squid-users] Squid 4.8+ intercept
 
Hello,
 
I have a setup like this one:

| Client | =====> | Router | =====> Internet
                     ||
                     \/
                  | Squid |
 
...the router is a Mikrotik router capable of all things NAT/Redirect and whatnot. Squid server has only one network interface.
Using the router:
- I tried routing traffic to squid server IP.
- I tried destination-NATing from client to server IP, with origin server IP-and-port natted to squid IP-and-port, and with origin server IP-only natted to squid-IP.
 
I have been struggling for 2 days to setup a working Squid 4.8 or higher interception.
Test server is running Ubuntu 18.4.3 and Squid 4.8.
Documentation is either too much trim or extremely outdated.
Any help would be very much appreciated.
 
All best,
K
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220813/54a6cf99/attachment.htm>

From squid3 at treenet.co.nz  Mon Aug 15 02:54:57 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Mon, 15 Aug 2022 14:54:57 +1200
Subject: [squid-users] Unsubscribe me please
In-Reply-To: <CADjerZE1RTKS+ivWQ5qwWBVAsjsj_7szU8atdphRYxMNo10O4w@mail.gmail.com>
References: <CADjerZE1RTKS+ivWQ5qwWBVAsjsj_7szU8atdphRYxMNo10O4w@mail.gmail.com>
Message-ID: <44549d4f-032e-7fbc-22cc-bfd7662f9b79@treenet.co.nz>


Only you can unsubscribe your email.

Use the web link you can find at the bottom of every list message...

On 12/08/2022 3:52 am, Wade Gibson wrote:
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

... at the bottom of that page is the unsubscribe form.

HTH
Amos


From marcelorodrigo at graminsta.com.br  Tue Aug 16 01:49:50 2022
From: marcelorodrigo at graminsta.com.br (Marcelo)
Date: Mon, 15 Aug 2022 22:49:50 -0300
Subject: [squid-users] Capture incoming information from one squid to
 another.
Message-ID: <002401d8b112$7acb9680$7062c380$@graminsta.com.br>

Hi,

 

How can I transfer connection information from one squid server to another?

 

Example:

 

An user connects to Squid One (Squid One IP 192.1.1.1) through port 4000
using usr/pw credentials.

Squid One authenticates it via SQL DB. This part is already working fine.

Squid One verifies if destination website is in dst domain list.

If yes Squid One routes it to Route A. End of story.

 

If no Squid One routes it to Squid Two.

But Squid One must inform Squid Two who is the user and witch port he asked
to connect.

 

Why? Because Squid Two must use this info as if the user itself is
connecting to Squid Two.
Why, again? Because Squid Two will use this info to route this user to the
correct route. This part is also done.

 

My doubt is, is there a way to make Squid Two "thinks" that user is
connecting direct to Squid Two, so that, Squid Two can use user/port
information to route this poor little guy.

 

It's a bit hard to explain it through email.

 

Best Regards.

 

Marcelo.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220815/bd511381/attachment.htm>

From marcelorodrigo at graminsta.com.br  Tue Aug 16 02:06:41 2022
From: marcelorodrigo at graminsta.com.br (Marcelo)
Date: Mon, 15 Aug 2022 23:06:41 -0300
Subject: [squid-users] Anyone able to sell me some squid consulting?
 (advanced routing+cache peering)
Message-ID: <003101d8b114$d5189550$7f49bff0$@graminsta.com.br>

Is there any available experienced Squid Specialist who is able to implement
complex filtering/routing+cache peers+SSLBump?

 

I can do the hard work, but I really need some directions from a squid
actualized guy to check my squid strategy and tell me some "how to do
this/that" stuff.

 

Thanks in advance.

 

Marcelo.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220815/44a72f75/attachment.htm>

From rentorbuy at yahoo.com  Tue Aug 16 07:52:07 2022
From: rentorbuy at yahoo.com (Vieri)
Date: Tue, 16 Aug 2022 07:52:07 +0000 (UTC)
Subject: [squid-users] forwarding TPROXY squid and multi-ISP
References: <1748202460.2345291.1660636327635.ref@mail.yahoo.com>
Message-ID: <1748202460.2345291.1660636327635@mail.yahoo.com>

Hi,

I'm using squid as a forward transparent proxy with something like this:

https_port 3130 tproxy ssl-bump [etc.]

The Squid service is running on a Linux FW which is the LAN's default gateway.
The host uses TPROXY such as:

25873 5262K TPROXY???? tcp? --? *????? *?????? 0.0.0.0/0??????????? 0.0.0.0/0??????????? TPROXY redirect 0.0.0.0:3130 mark 0x200/0x200

This router has multiple physical and logical interfaces with a default route via 172.16.0.2. The latter IP address is assigned to another Linux host acting as gateway to Internet.

Now, the Squid firewalling router also has a network interface connected to a different Internet provider (say, ISP2). Some LAN hosts are required to use that provider instead of the Internet gateway I mentioned before (via 172.16.0.2).
If I do NOT apply TPROXY to these hosts (ie. if they by-pass squid) then they can access the alternate WAN provider after I apply some simple routing rules (eg. "from HOST_IP_ADDR lookup ISP2").
The rest of the hosts with TPROXIED traffic through Squid can also correctly access Internet via 172.16.0.2.

The only scenario that's failing is if I want to force LAN traffic through Squid for those hosts that need to access Internet via ISP2.
I'm guessing that it may be because the Squid process is fetching data via 172.16.0.2 *always*.

How can I fix this? What are my options?
Is it possible to properly configure the same Squid system for this, or is it necessary to set up another Squid system via ISP2?

Regards


From mogi at oce.co.jp  Wed Aug 17 13:07:18 2022
From: mogi at oce.co.jp (=?iso-2022-jp?B?GyRCTFBMWhsoQiAgGyRCTklKPxsoQg==?=)
Date: Wed, 17 Aug 2022 13:07:18 +0000
Subject: [squid-users] Questions about trouble
Message-ID: <F5980DA22E60974FA0C0741D61F572C3AF5FDFCB@OREVMMBX02.oce.co.jp>

Dear Sir or Madam

Please let me know if there is any unknown problem.
I am using squid for windows 4.
Suddenly the squid service stopped.
When I checked the cache file, an error message was output.
Could you please confirm it?

2022/08/17 09:25:02| oldAccept  FD 11, [::] [ job1]: (105) No buffer space available
2022/08/17 09:25:03| comm_openex socket failure: (105) No buffer space available
2022/08/17 09:25:03| comm_openex socket failure: (105) No buffer space available

Yours sincerely

Ryohei Mogi

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220817/9c7843ce/attachment.htm>

From yaemish at gmail.com  Wed Aug 17 15:11:34 2022
From: yaemish at gmail.com (Chris XMT)
Date: Wed, 17 Aug 2022 11:11:34 -0400
Subject: [squid-users] Forward proxy with certificates
Message-ID: <CAOTryr+bJDJrihRhgOmhCSJBocxT80wN3hLOY-3vN+LGg+NQtw@mail.gmail.com>

My company implemented a new proxy (Zscaler) that requires the use of SSL
certificates.  I have "black boxes" that allow me to configure a proxy, but
not to add these needed certificates.  This prevents these linux systems
from making HTTPS requests.

I built a RHEL system with Squid running.  This system has the corporate
certs needed to make HTTPS connection; I can confirm that it can do so via
a curl command.  I've spent countless hours trying to make a basic
configuration that allows this RHEL system to forward the traffic from the
"black boxes" to their destination.  I would just assume to allow traffic
from anywhere and any system to be forwarded.

Can anyone offer a basic configuration file that will pass all traffic?

Thank you
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220817/90ae36b0/attachment.htm>

From rousskov at measurement-factory.com  Wed Aug 17 17:32:47 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Wed, 17 Aug 2022 13:32:47 -0400
Subject: [squid-users] Forward proxy with certificates
In-Reply-To: <CAOTryr+bJDJrihRhgOmhCSJBocxT80wN3hLOY-3vN+LGg+NQtw@mail.gmail.com>
References: <CAOTryr+bJDJrihRhgOmhCSJBocxT80wN3hLOY-3vN+LGg+NQtw@mail.gmail.com>
Message-ID: <8a358c95-a675-d2ff-9377-fb2550c7c11e@measurement-factory.com>

On 8/17/22 11:11, Chris XMT wrote:
> My company implemented a new proxy (Zscaler) that requires the use of 
> SSL certificates.? I have "black boxes" that allow me to configure a 
> proxy, but not to add these needed certificates.? This prevents these 
> linux systems from making HTTPS requests.

When using Squid, do you configure "black boxes" to use Squid's 
http_port or Squid's https_port? If it is the latter, make sure that 
those "black boxes" support HTTPS forward proxies. Many clients do not!


> I built a RHEL system with Squid running.? This system has the corporate 
> certs needed to make HTTPS connection; I can confirm that it can do so 
> via a curl command.? I've spent countless hours trying to make a basic 
> configuration that allows this RHEL system to forward the traffic from 
> the "black boxes" to their destination.? I would just assume to allow 
> traffic from anywhere and any system to be forwarded.

For Squid to forward requests to an HTTPS proxy, you need to configure 
the corresponding "cache_peer" with "parent", "tls" (or "ssl") and 
"sslcert" options. You may also need to disable direct forwarding with 
"never_direct allow all" if all traffic should go through that 
cache_peer. Have you done that?

http://www.squid-cache.org/Doc/config/cache_peer/

What errors/problems do you see in cache.log and access.log?

> Can anyone offer a basic configuration file that will pass all traffic?

Using something like "http_access allow all" will allow all valid 
requests into Squid, but result in an open proxy setup that is often 
vulnerable to abuse. Most likely, that is _not_ what you want, and your 
primary problem may lie outside Squid access controls.


HTH,

Alex.


From rousskov at measurement-factory.com  Wed Aug 17 18:01:28 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Wed, 17 Aug 2022 14:01:28 -0400
Subject: [squid-users] Capture incoming information from one squid to
 another.
In-Reply-To: <002401d8b112$7acb9680$7062c380$@graminsta.com.br>
References: <002401d8b112$7acb9680$7062c380$@graminsta.com.br>
Message-ID: <540b3572-6ce0-11ab-3fa0-544f651d4670@measurement-factory.com>

On 8/15/22 21:49, Marcelo wrote:

> How can I transfer connection information from one squid server to another?

Use cache_peer login=PASSTHRU or login=PASS. Other login=... options may 
also be of interest. See cache_peer documentation in your 
squid.conf.documented for details and caveats.


HTH,

Alex.


> Example:
> 
> An user connects to Squid One (Squid One IP 192.1.1.1) through port 4000 
> using usr/pw credentials.
> 
> Squid One authenticates it via SQL DB. This part is already working fine.
> 
> Squid One verifies if destination website is in dst domain list.
> 
> If yes Squid One routes it to Route A. End of story.
> 
> If no Squid One routes it to Squid Two.
> 
> But Squid One must inform Squid Two who is the user and witch port he 
> asked to connect.
> 
> Why? Because Squid Two must use this info as if the user itself is 
> connecting to Squid Two.
> Why, again? Because Squid Two will use this info to route this user to 
> the correct route. This part is also done.
> 
> My doubt is, is there a way to make Squid Two ?thinks? that user is 
> connecting direct to Squid Two, so that, Squid Two can use user/port 
> information to route this poor little guy.
> 
> It?s a bit hard to explain it through email.
> 
> Best Regards.
> 
> Marcelo.
> 
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



From mohammed.khallaf at gmail.com  Thu Aug 18 03:08:35 2022
From: mohammed.khallaf at gmail.com (M K)
Date: Thu, 18 Aug 2022 05:08:35 +0200
Subject: [squid-users] Squid 4.8+ intercept
In-Reply-To: <F4FBD3F8-12F1-4769-BAC5-44A3135A807D@diladele.com>
References: <CAFMSmTvEFMASCsodsZ43zdY_tEaKMJu2s_c8bCAKuyVd1i9yFg@mail.gmail.com>
 <CAFMSmTuUK_9UApWc76L91GDRm-tK-E+b=oLrUzF5Fitr-PZy3Q@mail.gmail.com>
 <F4FBD3F8-12F1-4769-BAC5-44A3135A807D@diladele.com>
Message-ID: <CAFMSmTvypP-Z+iiZiO=0CEB68d0sMn6f9FkmKNtsHxPg-EdfVw@mail.gmail.com>

Hello Rafael,

Thank you for your reply. The key problem in my case is that I'm using
a complex NAT/Mangle setup, with too many decisions to be made. When I
finally succeeded, I was able to pin-point the glitch in my setup:
"Ensure NAT Rule is Applied to WAN Interface Only" in your excellent
guide.

Since I'm unable to do that in my setup, I used a better and more safe
approach: just create a nat rule that will ACCEPT traffic from
intercepted clients with no further action, and place it well enough
higher in the nat rule-chain so it basically skips regular nat.

Thank you for the excellent guide.

All best,
K


On Tue, Aug 9, 2022 at 10:54 PM Rafael Akchurin
<rafael.akchurin at diladele.com> wrote:
>
> Hello K,
>
> We use https://docs.diladele.com/tutorials/mikrotik_transparent_squid/index.html
>
> Best regards,
> Rafael
>
> Op 9 aug. 2022 om 21:29 heeft M K <mohammed.khallaf at gmail.com> het volgende geschreven:
>
> ?
> Hello,
>
> I have a setup like this one:
>
> | Client | =====> | Router | =====> Internet
>                      ||
>                      \/
>                   | Squid |
>
> ...the router is a Mikrotik router capable of all things NAT/Redirect and whatnot. Squid server has only one network interface.
> Using the router:
> - I tried routing traffic to squid server IP.
> - I tried destination-NATing from client to server IP, with origin server IP-and-port natted to squid IP-and-port, and with origin server IP-only natted to squid-IP.
>
> I have been struggling for 2 days to setup a working Squid 4.8 or higher interception.
> Test server is running Ubuntu 18.4.3 and Squid 4.8.
> Documentation is either too much trim or extremely outdated.
> Any help would be very much appreciated.
>
> All best,
> K
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users


From mohammed.khallaf at gmail.com  Thu Aug 18 03:20:09 2022
From: mohammed.khallaf at gmail.com (M K)
Date: Thu, 18 Aug 2022 05:20:09 +0200
Subject: [squid-users] Squid 4.8+ intercept
In-Reply-To: <001401d8af3e$392663c0$ab732b40$@gmail.com>
References: <CAFMSmTvEFMASCsodsZ43zdY_tEaKMJu2s_c8bCAKuyVd1i9yFg@mail.gmail.com>
 <CAFMSmTuUK_9UApWc76L91GDRm-tK-E+b=oLrUzF5Fitr-PZy3Q@mail.gmail.com>
 <000401d8ac90$62fcea80$28f6bf80$@gmail.com>
 <CAFMSmTt71mFhpanDVtKG0Gg6UA74ZAgpnBx5B__01K1Tmu5QLg@mail.gmail.com>
 <001401d8af3e$392663c0$ab732b40$@gmail.com>
Message-ID: <CAFMSmTua4_eQ4iyY-zwCSkqYk+E1Rjd0CtzvxYi7vP_ty=pQAg@mail.gmail.com>

Hello Eliezer,

I finally got my setup to work; turned out to be intercepted clients
running into default nat, while my test squid server did not allow
them access, not even through iptables!

Now, I have one last bit to handle, which you did not cover in your
video. I'm using 3 ports for squid like Rafael's guide: one for normal
CONNECT, one for intercepted plain HTTP on 80, and one for intercepted
HTTPs on 443.

The setup works awesome for TLS addresses (i.e https://), but browser
redirection from Plain to TLS, say from http://cnn.com to
https://cnn.com, fails to happen. It just waits then time out.
What could be done to make it happen?

All best,
K


On Sat, Aug 13, 2022 at 7:57 PM <ngtech1ltd at gmail.com> wrote:
>
> Hey K,
>
>
>
> What RouterOS version are you using?
>
> Also, what rules have you applied?
>
> If there is a very long delay and then a failure you should verify that the rules you wrote are proper to your environment.
>
> You should route packets based on connection marks and mark only new connections from LAN IP addresses and only on the LAN interface.
>
> As I showed in the demo video it?s very simple to implement.
>
>
>
> Let me know if you are still having issues.
>
>
>
> Eliezer
>
>
>
> ----
>
> Eliezer Croitoru
>
> NgTech, Tech Support
>
> Mobile: +972-5-28704261
>
> Email: ngtech1ltd at gmail.com
>
> Web: https://ngtech.co.il/
>
> My-Tube: https://tube.ngtech.co.il/
>
>
>
> From: M K <mohammed.khallaf at gmail.com>
> Sent: Saturday, 13 August 2022 10:59
> To: ngtech1ltd at gmail.com
> Cc: squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] Squid 4.8+ intercept
>
>
>
> Thank  you for your quick reply. The text-drawing actually changed with different font; the squid server is effectively connected to MikroTik router, not the same physical link as the client.
>
>
>
> The MikroTik router sits between the client and squid server.
>
>
>
> That said, I can confirm that the MikroTik router is effectively able to route/DNat client packets going to ports 80 and 443 to squid server. Depending on router rules be it route or dnat, the client browser effectively displays the error page of squid, or goes into a very long delay then failure.
>
>
>
> I will retry and let you know.
>
>
>
> K
>
> On Wed, Aug 10, 2022, 10:08 <ngtech1ltd at gmail.com> wrote:
>
> Hey K,
>
>
>
> I am not sure about the network topology.
>
> Preferably the Squid should reside on another network then the clients if it?s intercepting the traffic.
>
> Also, I assume it?s not a TPROXY setup so it should be pretty simple and straight forward.
>
>
>
> I understand why are you asking this question.
>
> Also take into account that Mikrotik is now on 7.4 firmware and it?s recommended to use this one.
>
> If you are using any other version let me know so I can try to make sense on the differences.
>
> I will try to give a DEMO for such a setup and how to make it work.
>
>
>
> Eliezer
>
>
>
> ----
>
> Eliezer Croitoru
>
> NgTech, Tech Support
>
> Mobile: +972-5-28704261
>
> Email: ngtech1ltd at gmail.com
>
> Web: https://ngtech.co.il/
>
> My-Tube: https://tube.ngtech.co.il/
>
>
>
> From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of M K
> Sent: Tuesday, 9 August 2022 22:29
> To: squid-users at lists.squid-cache.org
> Subject: [squid-users] Squid 4.8+ intercept
>
>
>
> Hello,
>
>
>
> I have a setup like this one:
>
>
> | Client | =====> | Router | =====> Internet
>                      ||
>                      \/
>                   | Squid |
>
>
>
> ...the router is a Mikrotik router capable of all things NAT/Redirect and whatnot. Squid server has only one network interface.
>
> Using the router:
>
> - I tried routing traffic to squid server IP.
>
> - I tried destination-NATing from client to server IP, with origin server IP-and-port natted to squid IP-and-port, and with origin server IP-only natted to squid-IP.
>
>
>
> I have been struggling for 2 days to setup a working Squid 4.8 or higher interception.
>
> Test server is running Ubuntu 18.4.3 and Squid 4.8.
>
> Documentation is either too much trim or extremely outdated.
>
> Any help would be very much appreciated.
>
>
>
> All best,
>
> K


From ngtech1ltd at gmail.com  Thu Aug 18 14:05:29 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Thu, 18 Aug 2022 17:05:29 +0300
Subject: [squid-users] Squid 4.8+ intercept
In-Reply-To: <CAFMSmTua4_eQ4iyY-zwCSkqYk+E1Rjd0CtzvxYi7vP_ty=pQAg@mail.gmail.com>
References: <CAFMSmTvEFMASCsodsZ43zdY_tEaKMJu2s_c8bCAKuyVd1i9yFg@mail.gmail.com>
 <CAFMSmTuUK_9UApWc76L91GDRm-tK-E+b=oLrUzF5Fitr-PZy3Q@mail.gmail.com>
 <000401d8ac90$62fcea80$28f6bf80$@gmail.com>
 <CAFMSmTt71mFhpanDVtKG0Gg6UA74ZAgpnBx5B__01K1Tmu5QLg@mail.gmail.com>
 <001401d8af3e$392663c0$ab732b40$@gmail.com>
 <CAFMSmTua4_eQ4iyY-zwCSkqYk+E1Rjd0CtzvxYi7vP_ty=pQAg@mail.gmail.com>
Message-ID: <000001d8b30b$93a95570$bafc0050$@gmail.com>

Hey K,

I need your Mikrotik and squid.conf and iptables to understand what the issue might be.
You will need to describe your setup in a way I can relate to it.
There is not much of a difference between port 80 to 443 just that the port need to have ssl-bump settings If you are using it.
The CONNECT port is a simple forward proxy and it seems your setup is not as simple as you describe.
If you do have NAT then you need this to be only on specific interfaces in the Mikrotik and the Squid server.

In my case the basic setup works for a very long time now so I cannot imagine what's wrong in your case.

Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/

-----Original Message-----
From: M K <mohammed.khallaf at gmail.com> 
Sent: Thursday, 18 August 2022 6:20
To: ngtech1ltd at gmail.com
Cc: squid-users at lists.squid-cache.org; Rafael Akchurin <rafael.akchurin at diladele.com>
Subject: Re: [squid-users] Squid 4.8+ intercept

Hello Eliezer,

I finally got my setup to work; turned out to be intercepted clients
running into default nat, while my test squid server did not allow
them access, not even through iptables!

Now, I have one last bit to handle, which you did not cover in your
video. I'm using 3 ports for squid like Rafael's guide: one for normal
CONNECT, one for intercepted plain HTTP on 80, and one for intercepted
HTTPs on 443.

The setup works awesome for TLS addresses (i.e https://), but browser
redirection from Plain to TLS, say from http://cnn.com to
https://cnn.com, fails to happen. It just waits then time out.
What could be done to make it happen?

All best,
K


On Sat, Aug 13, 2022 at 7:57 PM <ngtech1ltd at gmail.com> wrote:
>
> Hey K,
>
>
>
> What RouterOS version are you using?
>
> Also, what rules have you applied?
>
> If there is a very long delay and then a failure you should verify that the rules you wrote are proper to your environment.
>
> You should route packets based on connection marks and mark only new connections from LAN IP addresses and only on the LAN interface.
>
> As I showed in the demo video it?s very simple to implement.
>
>
>
> Let me know if you are still having issues.
>
>
>
> Eliezer
>
>
>
> ----
>
> Eliezer Croitoru
>
> NgTech, Tech Support
>
> Mobile: +972-5-28704261
>
> Email: ngtech1ltd at gmail.com
>
> Web: https://ngtech.co.il/
>
> My-Tube: https://tube.ngtech.co.il/
>
>
>
> From: M K <mohammed.khallaf at gmail.com>
> Sent: Saturday, 13 August 2022 10:59
> To: ngtech1ltd at gmail.com
> Cc: squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] Squid 4.8+ intercept
>
>
>
> Thank  you for your quick reply. The text-drawing actually changed with different font; the squid server is effectively connected to MikroTik router, not the same physical link as the client.
>
>
>
> The MikroTik router sits between the client and squid server.
>
>
>
> That said, I can confirm that the MikroTik router is effectively able to route/DNat client packets going to ports 80 and 443 to squid server. Depending on router rules be it route or dnat, the client browser effectively displays the error page of squid, or goes into a very long delay then failure.
>
>
>
> I will retry and let you know.
>
>
>
> K
>
> On Wed, Aug 10, 2022, 10:08 <ngtech1ltd at gmail.com> wrote:
>
> Hey K,
>
>
>
> I am not sure about the network topology.
>
> Preferably the Squid should reside on another network then the clients if it?s intercepting the traffic.
>
> Also, I assume it?s not a TPROXY setup so it should be pretty simple and straight forward.
>
>
>
> I understand why are you asking this question.
>
> Also take into account that Mikrotik is now on 7.4 firmware and it?s recommended to use this one.
>
> If you are using any other version let me know so I can try to make sense on the differences.
>
> I will try to give a DEMO for such a setup and how to make it work.
>
>
>
> Eliezer
>
>
>
> ----
>
> Eliezer Croitoru
>
> NgTech, Tech Support
>
> Mobile: +972-5-28704261
>
> Email: ngtech1ltd at gmail.com
>
> Web: https://ngtech.co.il/
>
> My-Tube: https://tube.ngtech.co.il/
>
>
>
> From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of M K
> Sent: Tuesday, 9 August 2022 22:29
> To: squid-users at lists.squid-cache.org
> Subject: [squid-users] Squid 4.8+ intercept
>
>
>
> Hello,
>
>
>
> I have a setup like this one:
>
>
> | Client | =====> | Router | =====> Internet
>                      ||
>                      \/
>                   | Squid |
>
>
>
> ...the router is a Mikrotik router capable of all things NAT/Redirect and whatnot. Squid server has only one network interface.
>
> Using the router:
>
> - I tried routing traffic to squid server IP.
>
> - I tried destination-NATing from client to server IP, with origin server IP-and-port natted to squid IP-and-port, and with origin server IP-only natted to squid-IP.
>
>
>
> I have been struggling for 2 days to setup a working Squid 4.8 or higher interception.
>
> Test server is running Ubuntu 18.4.3 and Squid 4.8.
>
> Documentation is either too much trim or extremely outdated.
>
> Any help would be very much appreciated.
>
>
>
> All best,
>
> K



From squid3 at treenet.co.nz  Fri Aug 19 11:12:42 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 19 Aug 2022 23:12:42 +1200
Subject: [squid-users] Questions about trouble
In-Reply-To: <F5980DA22E60974FA0C0741D61F572C3AF5FDFCB@OREVMMBX02.oce.co.jp>
References: <F5980DA22E60974FA0C0741D61F572C3AF5FDFCB@OREVMMBX02.oce.co.jp>
Message-ID: <4d1bead5-c138-da38-aee4-a3d40f1d8480@treenet.co.nz>

On 18/08/22 01:07, ?? ?? wrote:
> Dear Sir or Madam
> 
> Please let me know if there is any unknown problem.
> 
> I am using squid for windows 4.
> 
> Suddenly the squid service stopped.
> 
> When I checked the cache file, an error message was output.
> 
> Could you please confirm it?
> 
> 2022/08/17 09:25:02| oldAccept? FD 11, [::] [ job1]: (105) No buffer 
> space available
> 
> 2022/08/17 09:25:03| comm_openex socket failure: (105) No buffer space 
> available
> 
> 2022/08/17 09:25:03| comm_openex socket failure: (105) No buffer space 
> available
> 

This is an odd one. I think it means your Network stack in the OS has 
run out of memory.


HTH
Amos


From squid3 at treenet.co.nz  Fri Aug 19 11:38:03 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 19 Aug 2022 23:38:03 +1200
Subject: [squid-users] forwarding TPROXY squid and multi-ISP
In-Reply-To: <1748202460.2345291.1660636327635@mail.yahoo.com>
References: <1748202460.2345291.1660636327635.ref@mail.yahoo.com>
 <1748202460.2345291.1660636327635@mail.yahoo.com>
Message-ID: <5f9c805b-8b76-124b-76f7-230907de0ac4@treenet.co.nz>

On 16/08/22 19:52, Vieri wrote:
> The only scenario that's failing is if I want to force LAN traffic through Squid for those hosts that need to access Internet via ISP2.

How exactly is it failing?


> I'm guessing that it may be because the Squid process is fetching data via 172.16.0.2 *always*.
> 
> How can I fix this? What are my options?
> Is it possible to properly configure the same Squid system for this, or is it necessary to set up another Squid system via ISP2?
> 

There is no technical reason this setup should not work.

Amos


From marcelorodrigo at graminsta.com.br  Fri Aug 19 23:20:56 2022
From: marcelorodrigo at graminsta.com.br (Marcelo)
Date: Fri, 19 Aug 2022 20:20:56 -0300
Subject: [squid-users] Capture incoming information from one squid
Message-ID: <003001d8b422$5da0d9e0$18e28da0$@graminsta.com.br>

Thanks Alex,

1- Is it possible to provide me with an example of squid.conf of both parent
and child squids?

I am having very basic doubts about cache_peer and its very hard to find
complete squid.confs over the internet.

2- cache-peer really routes the connection to the second squid server or
just look for a hit in a second server's cache?
I need the second server to not just authenticate the user, but to know from
which port the user got in the first squid server in order to forward this
user through different routes based on this incoming port number.

I want to use the first squid, just as a dst.domain filter for it to decide
based on the dst.domain list, if the user will be forward to a local route,
or if this user are going to be sent to the second squid server, which,
based on the original incoming port, can decide through which
tcp_outgoing_address he will going out.

Thanks for all the helping.

Marcelo.




On 8/15/22 21:49, Marcelo wrote:

> How can I transfer connection information from one squid server to
another?

Use cache_peer login=PASSTHRU or login=PASS. Other login=... options may
also be of interest. See cache_peer documentation in your
squid.conf.documented for details and caveats.


HTH,


Alex.


> Example:
> 
> An user connects to Squid One (Squid One IP 192.1.1.1) through port 
> 4000 using usr/pw credentials.
> 
> Squid One authenticates it via SQL DB. This part is already working fine.
> 
> Squid One verifies if destination website is in dst domain list.
> 
> If yes Squid One routes it to Route A. End of story.
> 
> If no Squid One routes it to Squid Two.
> 
> But Squid One must inform Squid Two who is the user and witch port he 
> asked to connect.
> 
> Why? Because Squid Two must use this info as if the user itself is 
> connecting to Squid Two.
> Why, again? Because Squid Two will use this info to route this user to 
> the correct route. This part is also done.
> 
> My doubt is, is there a way to make Squid Two ?thinks? that user is 
> connecting direct to Squid Two, so that, Squid Two can use user/port 
> information to route this poor little guy.
> 
> It?s a bit hard to explain it through email.
> 
> Best Regards.
> 
> Marcelo.
> 
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



------------------------------

Message: 5
Date: Thu, 18 Aug 2022 05:08:35 +0200
From: M K <mohammed.khallaf at gmail.com>
To: Rafael Akchurin <rafael.akchurin at diladele.com>
Cc: "squid-users at lists.squid-cache.org"
	<squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] Squid 4.8+ intercept
Message-ID:
	<CAFMSmTvypP-Z+iiZiO=0CEB68d0sMn6f9FkmKNtsHxPg-EdfVw at mail.gmail.com>
Content-Type: text/plain; charset="UTF-8"

Hello Rafael,

Thank you for your reply. The key problem in my case is that I'm using a
complex NAT/Mangle setup, with too many decisions to be made. When I finally
succeeded, I was able to pin-point the glitch in my setup:
"Ensure NAT Rule is Applied to WAN Interface Only" in your excellent guide.

Since I'm unable to do that in my setup, I used a better and more safe
approach: just create a nat rule that will ACCEPT traffic from intercepted
clients with no further action, and place it well enough higher in the nat
rule-chain so it basically skips regular nat.

Thank you for the excellent guide.

All best,
K


On Tue, Aug 9, 2022 at 10:54 PM Rafael Akchurin
<rafael.akchurin at diladele.com> wrote:
>
> Hello K,
>
> We use 
> https://docs.diladele.com/tutorials/mikrotik_transparent_squid/index.h
> tml
>
> Best regards,
> Rafael
>
> Op 9 aug. 2022 om 21:29 heeft M K <mohammed.khallaf at gmail.com> het
volgende geschreven:
>
> ?
> Hello,
>
> I have a setup like this one:
>
> | Client | =====> | Router | =====> Internet
>                      ||
>                      \/
>                   | Squid |
>
> ...the router is a Mikrotik router capable of all things NAT/Redirect and
whatnot. Squid server has only one network interface.
> Using the router:
> - I tried routing traffic to squid server IP.
> - I tried destination-NATing from client to server IP, with origin server
IP-and-port natted to squid IP-and-port, and with origin server IP-only
natted to squid-IP.
>
> I have been struggling for 2 days to setup a working Squid 4.8 or higher
interception.
> Test server is running Ubuntu 18.4.3 and Squid 4.8.
> Documentation is either too much trim or extremely outdated.
> Any help would be very much appreciated.
>
> All best,
> K
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users


------------------------------

Message: 6
Date: Thu, 18 Aug 2022 05:20:09 +0200
From: M K <mohammed.khallaf at gmail.com>
To: ngtech1ltd at gmail.com
Cc: squid-users at lists.squid-cache.org,  Rafael Akchurin
	<rafael.akchurin at diladele.com>
Subject: Re: [squid-users] Squid 4.8+ intercept
Message-ID:
	<CAFMSmTua4_eQ4iyY-zwCSkqYk+E1Rjd0CtzvxYi7vP_ty=pQAg at mail.gmail.com>
Content-Type: text/plain; charset="UTF-8"

Hello Eliezer,

I finally got my setup to work; turned out to be intercepted clients running
into default nat, while my test squid server did not allow them access, not
even through iptables!

Now, I have one last bit to handle, which you did not cover in your video.
I'm using 3 ports for squid like Rafael's guide: one for normal CONNECT, one
for intercepted plain HTTP on 80, and one for intercepted HTTPs on 443.

The setup works awesome for TLS addresses (i.e https://), but browser
redirection from Plain to TLS, say from http://cnn.com to https://cnn.com,
fails to happen. It just waits then time out.
What could be done to make it happen?

All best,
K


On Sat, Aug 13, 2022 at 7:57 PM <ngtech1ltd at gmail.com> wrote:
>
> Hey K,
>
>
>
> What RouterOS version are you using?
>
> Also, what rules have you applied?
>
> If there is a very long delay and then a failure you should verify that
the rules you wrote are proper to your environment.
>
> You should route packets based on connection marks and mark only new
connections from LAN IP addresses and only on the LAN interface.
>
> As I showed in the demo video it?s very simple to implement.
>
>
>
> Let me know if you are still having issues.
>
>
>
> Eliezer
>
>
>
> ----
>
> Eliezer Croitoru
>
> NgTech, Tech Support
>
> Mobile: +972-5-28704261
>
> Email: ngtech1ltd at gmail.com
>
> Web: https://ngtech.co.il/
>
> My-Tube: https://tube.ngtech.co.il/
>
>
>
> From: M K <mohammed.khallaf at gmail.com>
> Sent: Saturday, 13 August 2022 10:59
> To: ngtech1ltd at gmail.com
> Cc: squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] Squid 4.8+ intercept
>
>
>
> Thank  you for your quick reply. The text-drawing actually changed with
different font; the squid server is effectively connected to MikroTik
router, not the same physical link as the client.
>
>
>
> The MikroTik router sits between the client and squid server.
>
>
>
> That said, I can confirm that the MikroTik router is effectively able to
route/DNat client packets going to ports 80 and 443 to squid server.
Depending on router rules be it route or dnat, the client browser
effectively displays the error page of squid, or goes into a very long delay
then failure.
>
>
>
> I will retry and let you know.
>
>
>
> K
>
> On Wed, Aug 10, 2022, 10:08 <ngtech1ltd at gmail.com> wrote:
>
> Hey K,
>
>
>
> I am not sure about the network topology.
>
> Preferably the Squid should reside on another network then the clients if
it?s intercepting the traffic.
>
> Also, I assume it?s not a TPROXY setup so it should be pretty simple and
straight forward.
>
>
>
> I understand why are you asking this question.
>
> Also take into account that Mikrotik is now on 7.4 firmware and it?s
recommended to use this one.
>
> If you are using any other version let me know so I can try to make sense
on the differences.
>
> I will try to give a DEMO for such a setup and how to make it work.
>
>
>
> Eliezer
>
>
>
> ----
>
> Eliezer Croitoru
>
> NgTech, Tech Support
>
> Mobile: +972-5-28704261
>
> Email: ngtech1ltd at gmail.com
>
> Web: https://ngtech.co.il/
>
> My-Tube: https://tube.ngtech.co.il/
>
>
>
> From: squid-users <squid-users-bounces at lists.squid-cache.org> On 
> Behalf Of M K
> Sent: Tuesday, 9 August 2022 22:29
> To: squid-users at lists.squid-cache.org
> Subject: [squid-users] Squid 4.8+ intercept
>
>
>
> Hello,
>
>
>
> I have a setup like this one:
>
>
> | Client | =====> | Router | =====> Internet
>                      ||
>                      \/
>                   | Squid |
>
>
>
> ...the router is a Mikrotik router capable of all things NAT/Redirect and
whatnot. Squid server has only one network interface.
>
> Using the router:
>
> - I tried routing traffic to squid server IP.
>
> - I tried destination-NATing from client to server IP, with origin server
IP-and-port natted to squid IP-and-port, and with origin server IP-only
natted to squid-IP.
>
>
>
> I have been struggling for 2 days to setup a working Squid 4.8 or higher
interception.
>
> Test server is running Ubuntu 18.4.3 and Squid 4.8.
>
> Documentation is either too much trim or extremely outdated.
>
> Any help would be very much appreciated.
>
>
>
> All best,
>
> K


------------------------------

Subject: Digest Footer

_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users


------------------------------

End of squid-users Digest, Vol 96, Issue 35
*******************************************



From squid3 at treenet.co.nz  Sat Aug 20 10:57:47 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 20 Aug 2022 22:57:47 +1200
Subject: [squid-users] Capture incoming information from one squid
In-Reply-To: <003001d8b422$5da0d9e0$18e28da0$@graminsta.com.br>
References: <003001d8b422$5da0d9e0$18e28da0$@graminsta.com.br>
Message-ID: <3e733d49-6108-98d8-7ab5-cae4c2afe6e3@treenet.co.nz>

On 20/08/22 11:20, Marcelo wrote:
> Thanks Alex,
> 
> 1- Is it possible to provide me with an example of squid.conf of both parent
> and child squids?
> 
> I am having very basic doubts about cache_peer and its very hard to find
> complete squid.confs over the internet.
> 

FWIW, *complete* squid.conf are usually useless because every network is 
different. What you actually want is the *pieces* that do what you need.


> 2- cache-peer really routes the connection to the second squid server or
> just look for a hit in a second server's cache?
> I need the second server to not just authenticate the user, but to know from
> which port the user got in the first squid server in order to forward this
> user through different routes based on this incoming port number.


cache_peer directive is just the settings for *how* to connect to a 
particular server. What URL format to use, whether to use TLS/SSL or 
not, any non-80/443 port to connect to, what/how to pass login 
credentials, etc.

cache_peer_access determines what traffic can (or must) be sent on a TCP 
connection setup with a cache_peer's settings.


To pass unusual data like the original client info you should add a 
Forwarded header with the relevant details.


So, in your frontend proxy you have:

   # Special parent proxy for some traffic
   cache_peer ... name=X

   # which traffic to send to the special parent
   acl specials dstdomain ...

   never_direct allow specials
   cache_peer_access X allow specials
   cache_peer_access X deny all

   # markup the traffic with Forwarded details
   forwarded_for transparent
   request_header_add Forwarded "for=%>a;by=_%lp" specials


In your backend Squid this ACL below matches the Forwarded header 
received there. Use it as necessary to decide your traffic handling:

   # match when frontend marked port X as receiving
   acl portX req_header Forwarded ;by=_X(,|$)



HTH
Amos


From ngtech1ltd at gmail.com  Sun Aug 21 02:00:32 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Sun, 21 Aug 2022 05:00:32 +0300
Subject: [squid-users] forwarding TPROXY squid and multi-ISP
In-Reply-To: <1748202460.2345291.1660636327635@mail.yahoo.com>
References: <1748202460.2345291.1660636327635.ref@mail.yahoo.com>
 <1748202460.2345291.1660636327635@mail.yahoo.com>
Message-ID: <002101d8b501$cc80af90$65820eb0$@gmail.com>

Hey Vieri,

I am missing couple pieces to understand and maybe re-produce the issue.
What Linux and Squid version are you using?

A tproxy setup is using the OS network stack for selecting the proper source and destination addresses.
I have not implemented such a setup for a very long time but it's possible that you will need a simple REDIRECT iptables/nftables rule
for specific LAN traffic.

I'm not sure how would you apply the policies but what I understand is that you are in a TPROXY mess.
A TPROXY setup should have a static routing rules and usually cannot use multiple ISPs on the SQUID box
(assuming each of the ISPs provides a different IPv4 address)
I can see the point in such a setup but to make sure it works I will need more information.

It's probably possible to use 2 ISPs if you have some kind of routing and iptables rules in place.

I am missing too much technical details to give you a way how to implement such a setup.

Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Vieri
Sent: Tuesday, 16 August 2022 10:52
To: squid-users at lists.squid-cache.org
Subject: [squid-users] forwarding TPROXY squid and multi-ISP

Hi,

I'm using squid as a forward transparent proxy with something like this:

https_port 3130 tproxy ssl-bump [etc.]

The Squid service is running on a Linux FW which is the LAN's default gateway.
The host uses TPROXY such as:

25873 5262K TPROXY     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            TPROXY redirect 0.0.0.0:3130 mark 0x200/0x200

This router has multiple physical and logical interfaces with a default route via 172.16.0.2. The latter IP address is assigned to another Linux host acting as gateway to Internet.

Now, the Squid firewalling router also has a network interface connected to a different Internet provider (say, ISP2). Some LAN hosts are required to use that provider instead of the Internet gateway I mentioned before (via 172.16.0.2).
If I do NOT apply TPROXY to these hosts (ie. if they by-pass squid) then they can access the alternate WAN provider after I apply some simple routing rules (eg. "from HOST_IP_ADDR lookup ISP2").
The rest of the hosts with TPROXIED traffic through Squid can also correctly access Internet via 172.16.0.2.

The only scenario that's failing is if I want to force LAN traffic through Squid for those hosts that need to access Internet via ISP2.
I'm guessing that it may be because the Squid process is fetching data via 172.16.0.2 *always*.

How can I fix this? What are my options?
Is it possible to properly configure the same Squid system for this, or is it necessary to set up another Squid system via ISP2?

Regards
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From ngtech1ltd at gmail.com  Sun Aug 21 02:04:22 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Sun, 21 Aug 2022 05:04:22 +0300
Subject: [squid-users] Anyone able to sell me some squid consulting?
 (advanced routing+cache peering)
In-Reply-To: <003101d8b114$d5189550$7f49bff0$@graminsta.com.br>
References: <003101d8b114$d5189550$7f49bff0$@graminsta.com.br>
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAG15AYh8TcJOh7jZfP/beGvCgAAAEAAAAM3cpANhpDNDnE990maQquoBAAAAAA==@gmail.com>

Hey Marcelo,
 
I am not sure how and what exactly you want to implement with squid but you must understand that there are specific things you cannot do with squid.
Let say you will have 3-4 squid instances and you will have couple users.
To test your solution you we will need:
*	Squids
*	Simple Target WEB server
*	Couple users
*	Couple acls (probably with an external_acl helper
 
And I believe it would be a pretty simple setup once you will lay in the list your ?spec?.
 
Eliezer
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email:  <mailto:ngtech1ltd at gmail.com> ngtech1ltd at gmail.com
Web:  <https://ngtech.co.il/> https://ngtech.co.il/
My-Tube:  <https://tube.ngtech.co.il/> https://tube.ngtech.co.il/
 
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Marcelo
Sent: Tuesday, 16 August 2022 5:07
To: squid-users at lists.squid-cache.org
Subject: [squid-users] Anyone able to sell me some squid consulting? (advanced routing+cache peering)
 
Is there any available experienced Squid Specialist who is able to implement complex filtering/routing+cache peers+SSLBump?
 
I can do the hard work, but I really need some directions from a squid actualized guy to check my squid strategy and tell me some ?how to do this/that? stuff.
 
Thanks in advance.
 
Marcelo.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220821/1f1012ba/attachment.htm>

From ngtech1ltd at gmail.com  Tue Aug 23 17:31:30 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Tue, 23 Aug 2022 20:31:30 +0300
Subject: [squid-users] SquidGuard.org is not responding
Message-ID: <000001d8b716$2efdfb30$8cf9f190$@gmail.com>

Hey,
 
If anyone knows the www.squidguard.org <http://www.squidguard.org>  domain and hosting owner, can you verify if they know that
the domain/server is not responding?
 
Eliezer
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email:  <mailto:ngtech1ltd at gmail.com> ngtech1ltd at gmail.com
Web:  <https://ngtech.co.il/> https://ngtech.co.il/
My-Tube:  <https://tube.ngtech.co.il/> https://tube.ngtech.co.il/
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220823/db2e6239/attachment.htm>

From anton.kornexl at miex.cc  Wed Aug 24 07:08:03 2022
From: anton.kornexl at miex.cc (anton.kornexl)
Date: Wed, 24 Aug 2022 09:08:03 +0200
Subject: [squid-users] SquidGuard.org is not responding
In-Reply-To: <000001d8b716$2efdfb30$8cf9f190$@gmail.com>
Message-ID: <mailman.9.1736411469.1101126.squid-users@lists.squid-cache.org>

Hello?many years ago IT Security Beratung Christiane Kronberg managed squidguard.org. She was also the owner of shalla.de (the home of the blacklist shallalist).Since many years the list shallalist was not maintained.Shalla.de is also not responding.yoursAnton Kornexl
-------- Urspr?ngliche Nachricht --------Von: ngtech1ltd at gmail.com Datum: 23.08.22  19:31  (GMT+01:00) An: squid-users at lists.squid-cache.org Betreff: [squid-users] SquidGuard.org is not responding Hey,?If anyone knows the www.squidguard.org domain and hosting owner, can you verify if they know thatthe domain/server is not responding??Eliezer?----Eliezer CroitoruNgTech, Tech SupportMobile: +972-5-28704261Email: ngtech1ltd at gmail.comWeb: https://ngtech.co.il/My-Tube: https://tube.ngtech.co.il/?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220824/b4cd09e8/attachment.htm>

From marcelorodrigo at graminsta.com.br  Wed Aug 24 21:02:31 2022
From: marcelorodrigo at graminsta.com.br (Marcelo)
Date: Wed, 24 Aug 2022 18:02:31 -0300
Subject: [squid-users] Capture incoming information from one squid
 (Marcelo)
Message-ID: <000601d8b7fc$d54c0400$7fe40c00$@graminsta.com.br>

Thanks a lot Amos!
It was just perfect!

With your examples I did manage to implement almost all I need.

A last thing to implement this already.

Is it possible to change the below port for the same port that user
connected to this child squid?
This way I would not have to use header to send information to the parent
squid. Which would means to change all the incoming port route policy I
already have in place and in production in several VPSs.

Something like "transmit" the incoming port wherever it is, to this port
field below using some wildcard.

cache_peer 200.7.118.226 parent *4370* 0 no-query name=peerREDIRECT
login=PASSTHRU

Thanks a lot again!
Marcelo.



Message: 2
Date: Sat, 20 Aug 2022 22:57:47 +1200
From: Amos Jeffries <squid3 at treenet.co.nz>
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Capture incoming information from one squid
Message-ID: <3e733d49-6108-98d8-7ab5-cae4c2afe6e3 at treenet.co.nz>
Content-Type: text/plain; charset=UTF-8; format=flowed

On 20/08/22 11:20, Marcelo wrote:

> 1- Is it possible to provide me with an example of squid.conf of both 
> parent and child squids?
> 
> I am having very basic doubts about cache_peer and its very hard to 
> find complete squid.confs over the internet.
> 

FWIW, *complete* squid.conf are usually useless because every network is
different. What you actually want is the *pieces* that do what you need.


> 2- cache-peer really routes the connection to the second squid server or
> just look for a hit in a second server's cache?
> I need the second server to not just authenticate the user, but to know
from
> which port the user got in the first squid server in order to forward this
> user through different routes based on this incoming port number.


cache_peer directive is just the settings for *how* to connect to a 
particular server. What URL format to use, whether to use TLS/SSL or 
not, any non-80/443 port to connect to, what/how to pass login 
credentials, etc.

cache_peer_access determines what traffic can (or must) be sent on a TCP 
connection setup with a cache_peer's settings.


To pass unusual data like the original client info you should add a 
Forwarded header with the relevant details.


So, in your frontend proxy you have:

   # Special parent proxy for some traffic
   cache_peer ... name=X

   # which traffic to send to the special parent
   acl specials dstdomain ...

   never_direct allow specials
   cache_peer_access X allow specials
   cache_peer_access X deny all

   # markup the traffic with Forwarded details
   forwarded_for transparent
   request_header_add Forwarded "for=%>a;by=_%lp" specials


In your backend Squid this ACL below matches the Forwarded header 
received there. Use it as necessary to decide your traffic handling:

   # match when frontend marked port X as receiving
   acl portX req_header Forwarded ;by=_X(,|$)



HTH
Amos


------------------------------

Subject: Digest Footer

_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users


------------------------------

End of squid-users Digest, Vol 96, Issue 37
*******************************************



From squid3 at treenet.co.nz  Thu Aug 25 07:26:29 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 25 Aug 2022 19:26:29 +1200
Subject: [squid-users] Capture incoming information from one squid
 (Marcelo)
In-Reply-To: <000601d8b7fc$d54c0400$7fe40c00$@graminsta.com.br>
References: <000601d8b7fc$d54c0400$7fe40c00$@graminsta.com.br>
Message-ID: <380f4a54-9ebd-bcb6-006c-56e1f53b1e71@treenet.co.nz>

On 25/08/22 09:02, Marcelo wrote:
> Thanks a lot Amos!
> It was just perfect!
> 
> With your examples I did manage to implement almost all I need.
> 
> A last thing to implement this already.
> 
> Is it possible to change the below port for the same port that user
> connected to this child squid?
> This way I would not have to use header to send information to the parent
> squid. Which would means to change all the incoming port route policy I
> already have in place and in production in several VPSs.
> 

Not in the way you are asking/thinking. For that same reason the below 
will not work for intercepted traffic.

However. **IF** your frontend is receiving traffic as an explicit proxy 
you can pair pair each http(s)_port directive there with a matching 
cache_peer directive. The cache_peer_access rules then need adjusting to 
deny traffic from the non-paired http(s)_port from using it.


Amos


From justinmschw at gmail.com  Fri Aug 26 18:02:40 2022
From: justinmschw at gmail.com (Justin Michael Schwartzbeck)
Date: Fri, 26 Aug 2022 13:02:40 -0500
Subject: [squid-users] Programmatically fetch the latest stable version of
 squid
Message-ID: <CAGEc96k7=Eo57DDf3YuN_X_gDK6Pd7U6hsLnbOzgO5ttRpPa5Q@mail.gmail.com>

Hello,

I want to create a build system that automatically fetches the latest
stable version of squid, and builds a container with it. I know I can
manually browse to the download page. But I was hoping there could be some
way to link it, i.e. /stable/squid-latest.tar.gz or perhaps a static list
that I could pull and scan.

Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220826/23fab32f/attachment.htm>

From squid3 at treenet.co.nz  Fri Aug 26 22:16:19 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 27 Aug 2022 10:16:19 +1200
Subject: [squid-users] Programmatically fetch the latest stable version
 of squid
In-Reply-To: <CAGEc96k7=Eo57DDf3YuN_X_gDK6Pd7U6hsLnbOzgO5ttRpPa5Q@mail.gmail.com>
References: <CAGEc96k7=Eo57DDf3YuN_X_gDK6Pd7U6hsLnbOzgO5ttRpPa5Q@mail.gmail.com>
Message-ID: <a28805ee-11ae-4243-4f93-e98cbe689075@treenet.co.nz>

On 27/08/22 06:02, Justin Michael Schwartzbeck wrote:
> Hello,
> 
> I want to create a build system that automatically fetches the latest 
> stable version of squid, and builds a container with it. I know I can 
> manually browse to the download page. But I was hoping there could be 
> some way to link it, i.e. /stable/squid-latest.tar.gz or perhaps a 
> static list that I could pull and scan.
> 

If you are not patching the Squid code before build, you may find it 
easier/better to use the "stable" version of Squid for whatever OS you 
are building into the container.


If source code is required, we provide RSYNC and FTP access in addition 
to the web download pages.

The rsync provides the very latest code for each released version of 
Squid. These are updated daily from the "snapshot" tarballs.
 
<https://wiki.squid-cache.org/DeveloperResources#Bootstrapped_sources_via_rsync>


The ftp mirrors have a section available on some of the mirrors.
(It is indicated by the user-folder icons). There you can find only the 
latest 2 official release tarballs of each series. Just parse the FTP 
directory listing and you have the latest formal (aka "stable") release 
files.
  <http://www.squid-cache.org/Download/ftp-mirrors.html>


Cheers
Amos


From ngtech1ltd at gmail.com  Sun Aug 28 01:06:01 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Sun, 28 Aug 2022 04:06:01 +0300
Subject: [squid-users] Programmatically fetch the latest stable version
 of squid
In-Reply-To: <a28805ee-11ae-4243-4f93-e98cbe689075@treenet.co.nz>
References: <CAGEc96k7=Eo57DDf3YuN_X_gDK6Pd7U6hsLnbOzgO5ttRpPa5Q@mail.gmail.com>
 <a28805ee-11ae-4243-4f93-e98cbe689075@treenet.co.nz>
Message-ID: <002001d8ba7a$57aa3aa0$06feafe0$@gmail.com>

Hey Amos,

The page really need an update and also if it's something that we can rely on then..
we need something a bit more "working".

The only working http mirrors are:
http://mirror.marwan.ma/squid/archive/
http://mirror.marwan.ma/squid/software/
http://squid.mirror.globo.tech/archive/
http://squid.mirror.globo.tech/squid/

I have not tested the FTP ones since these are not practical for the 2022 era to what I understand.

Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Amos Jeffries
Sent: Saturday, 27 August 2022 1:16
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Programmatically fetch the latest stable version of squid

On 27/08/22 06:02, Justin Michael Schwartzbeck wrote:
> Hello,
> 
> I want to create a build system that automatically fetches the latest 
> stable version of squid, and builds a container with it. I know I can 
> manually browse to the download page. But I was hoping there could be 
> some way to link it, i.e. /stable/squid-latest.tar.gz or perhaps a 
> static list that I could pull and scan.
> 

If you are not patching the Squid code before build, you may find it 
easier/better to use the "stable" version of Squid for whatever OS you 
are building into the container.


If source code is required, we provide RSYNC and FTP access in addition 
to the web download pages.

The rsync provides the very latest code for each released version of 
Squid. These are updated daily from the "snapshot" tarballs.
 
<https://wiki.squid-cache.org/DeveloperResources#Bootstrapped_sources_via_rsync>


The ftp mirrors have a section available on some of the mirrors.
(It is indicated by the user-folder icons). There you can find only the 
latest 2 official release tarballs of each series. Just parse the FTP 
directory listing and you have the latest formal (aka "stable") release 
files.
  <http://www.squid-cache.org/Download/ftp-mirrors.html>


Cheers
Amos
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From ngtech1ltd at gmail.com  Sun Aug 28 01:06:53 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Sun, 28 Aug 2022 04:06:53 +0300
Subject: [squid-users] Programmatically fetch the latest stable version
 of squid
In-Reply-To: <CAGEc96k7=Eo57DDf3YuN_X_gDK6Pd7U6hsLnbOzgO5ttRpPa5Q@mail.gmail.com>
References: <CAGEc96k7=Eo57DDf3YuN_X_gDK6Pd7U6hsLnbOzgO5ttRpPa5Q@mail.gmail.com>
Message-ID: <002101d8ba7a$7651fa10$62f5ee30$@gmail.com>

Hey Justin,
 
Would json file be fine?
 
Eliezer
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email:  <mailto:ngtech1ltd at gmail.com> ngtech1ltd at gmail.com
Web:  <https://ngtech.co.il/> https://ngtech.co.il/
My-Tube:  <https://tube.ngtech.co.il/> https://tube.ngtech.co.il/
 
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Justin Michael Schwartzbeck
Sent: Friday, 26 August 2022 21:03
To: squid-users at lists.squid-cache.org
Subject: [squid-users] Programmatically fetch the latest stable version of squid
 
Hello,
 
I want to create a build system that automatically fetches the latest stable version of squid, and builds a container with it. I know I can manually browse to the download page. But I was hoping there could be some way to link it, i.e. /stable/squid-latest.tar.gz or perhaps a static list that I could pull and scan.
 
Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220828/0f026ee3/attachment.htm>

From ngtech1ltd at gmail.com  Sun Aug 28 01:35:14 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Sun, 28 Aug 2022 04:35:14 +0300
Subject: [squid-users] Programmatically fetch the latest stable version
 of squid
In-Reply-To: <CAGEc96k7=Eo57DDf3YuN_X_gDK6Pd7U6hsLnbOzgO5ttRpPa5Q@mail.gmail.com>
References: <CAGEc96k7=Eo57DDf3YuN_X_gDK6Pd7U6hsLnbOzgO5ttRpPa5Q@mail.gmail.com>
Message-ID: <002601d8ba7e$6d015880$47040980$@gmail.com>

I believe this should do:
https://raw.githubusercontent.com/elico/squid-latest/main/latest.json

Maybe it would be possible to update a git repository using a git web hook on the project.
If the Squid-Cache project will have some defined way of tagging versions in the git repository it would pretty simple to do.
>From my point view both the FTP and the RSYNC might be good and once I will have an official link to the FTP in HTTP format it would be pretty simple as:

curl -s http://mirror.marwan.ma/squid/software/|egrep -o "squid\-[0-9\.]+tar\.(xz|gz|bz2)" |tail -1

or:
https://github.com/elico/squid-latest/blob/main/get-latest-from-ftp.sh

ie:
#!/usr/bin/env bash

FTP_HTTP_MIRROR="http://mirror.marwan.ma/squid/software/"

LATEST_FILE=$(curl -s "${FTP_HTTP_MIRROR}" | egrep -o "squid\-[0-9\.]+tar\.(xz|gz|bz2)" | tail -1)

echo "${FTP_HTTP_MIRROR}${LATEST_FILE}"
##END

Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: mailto:ngtech1ltd at gmail.com
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/

From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Justin Michael Schwartzbeck
Sent: Friday, 26 August 2022 21:03
To: squid-users at lists.squid-cache.org
Subject: [squid-users] Programmatically fetch the latest stable version of squid

Hello,

I want to create a build system that automatically fetches the latest stable version of squid, and builds a container with it. I know I can manually browse to the download page. But I was hoping there could be some way to link it, i.e. /stable/squid-latest.tar.gz or perhaps a static list that I could pull and scan.

Thanks



From squid3 at treenet.co.nz  Sun Aug 28 15:10:06 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Mon, 29 Aug 2022 03:10:06 +1200
Subject: [squid-users] Programmatically fetch the latest stable version
 of squid
In-Reply-To: <002001d8ba7a$57aa3aa0$06feafe0$@gmail.com>
References: <CAGEc96k7=Eo57DDf3YuN_X_gDK6Pd7U6hsLnbOzgO5ttRpPa5Q@mail.gmail.com>
 <a28805ee-11ae-4243-4f93-e98cbe689075@treenet.co.nz>
 <002001d8ba7a$57aa3aa0$06feafe0$@gmail.com>
Message-ID: <b8580a95-5c3d-93e6-3b45-2bb89d41b1e7@treenet.co.nz>

On 28/08/22 13:06, ngtech1ltd wrote:
> Hey Amos,
> 
> The page really need an update and also if it's something that we can rely on then..
> we need something a bit more "working".
> 
> The only working http mirrors are:

The FTP mirrors are unfortunately often hidden behind regional or 
country specific restrictions. The page links are checked frequently to 
contain only the currently working ones from a much larger set we have 
registered.


Amos


From marcelorodrigo at graminsta.com.br  Mon Aug 29 06:06:51 2022
From: marcelorodrigo at graminsta.com.br (Marcelo)
Date: Mon, 29 Aug 2022 03:06:51 -0300
Subject: [squid-users] How to enable squid to use more server resources when
 using 500+ http_ports?
Message-ID: <000801d8bb6d$8cbff790$a63fe6b0$@graminsta.com.br>

Hello,

 

I have a server with large resources ( RAM, CPU, etc) running Ubuntu 20.04.

 

When I put squid 4.13 to manage more than 500 http_ports, it performs very
slowly.

Question is, how can I setup Squid or Ubuntu to use more hw resources in
order to perform better?

Or does it a matter of software architecture limitation?

 

Perform well with at least 500 http_ports would be very nice so we can use
smaller numbers of VPSs.

Its hard to manage so many of it.
It would be a dream to have like 10k http_ports in a single server.

 

If it is not possible, is there any planning about do it in a future?

 

Tks
Marcelo.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220829/80a32826/attachment.htm>

From davidtiagoff at gmail.com  Mon Aug 29 10:17:42 2022
From: davidtiagoff at gmail.com (David Ferreira)
Date: Mon, 29 Aug 2022 11:17:42 +0100
Subject: [squid-users] Squid 5.2 TCP_MISS_ABORTED/100 erros when uploading
Message-ID: <CAEJ1g5Kc0fdE82U+ede-wEfiyLRErxTPo2_BtpR1BzWY=72zig@mail.gmail.com>

hi,

First time using mailing lists, sorry about anything.

I have some squid's running on rocky linux 8 with verion 4.15, recently
been testing squid version 5.2(stable version that comes with Rocky 9)to
upgrade the current ones and most of the configs/acls seem to work fine.

Unfortualy theres an application that we use that everytime it tries to
upload files it fails on squid 5.2, on 4.15 is works completly fine, so far
ive test on squid 5.2 and 5.5 and it's the same behavior, im testing this
with default configurations and it always works on 4.15, access log only
shows this:

Squid 4.15:
26/Aug/2022:15:36:08 +0100    273 172.19.222.132 TCP_MISS/200 745 POST
http://websiteurl/index.php - HIER_DIRECT/websitedomain text/xml

Squid 5.2:
25/Aug/2022:15:10:00 +0100    139 172.19.222.132 TCP_MISS_ABORTED/100 0
POST http://websiteurl/index.php - HIER_DIRECT/websitedomain -

anyone has an ideia of what may be happening here?, been searching about
http errors 100 and so far i did not find anything that points me to the
problem.

On the application side the error it shows when it tries to upload is:
"
Error storing the document on the server
Detail HTTP error 100
Send failure: Connection was aborted (55)
"

Thanks in advance,

David
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220829/ec7b7dca/attachment.htm>

From squid3 at treenet.co.nz  Mon Aug 29 12:26:36 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 30 Aug 2022 00:26:36 +1200
Subject: [squid-users] Squid 5.2 TCP_MISS_ABORTED/100 erros when
 uploading
In-Reply-To: <CAEJ1g5Kc0fdE82U+ede-wEfiyLRErxTPo2_BtpR1BzWY=72zig@mail.gmail.com>
References: <CAEJ1g5Kc0fdE82U+ede-wEfiyLRErxTPo2_BtpR1BzWY=72zig@mail.gmail.com>
Message-ID: <4b9cf33a-4d35-1f09-6f5c-35f0a2c5ab78@treenet.co.nz>

On 29/08/22 22:17, David Ferreira wrote:
> hi,
> 
> First time using mailing lists, sorry about anything.
> 

Welcome, and thanks for using Squid.

Do not worry about mistakes. Helping with that type of thing is what 
this list is here for whether expert or beginner.



> 
> Squid 4.15:
> 26/Aug/2022:15:36:08 +0100 ???273 172.19.222.132TCP_MISS/200 745 POST 
> http://websiteurl/index.php <http://websiteurl/index.php> - 
> HIER_DIRECT/websitedomain text/xml
> 
> Squid 5.2:
> 25/Aug/2022:15:10:00 +0100 ???139 172.19.222.132 TCP_MISS_ABORTED/100 0 
> POST http://websiteurl <http://websiteurl>/index.php - 
> HIER_DIRECT/websitedomain -
> 
> anyone has an ideia of what may be happening here?, been searching about 
> http errors 100 and so far i did not find anything that points me to the 
> problem.
> 
> On the application side the error it shows when it tries to upload is:
> "
> Error storing the document on the server
> Detail HTTP error 100
> Send failure: Connection was aborted (55)
> "
> 

This is very odd.

  * The "ABORTED" tag hints strongly that the client closed the 
connection here.


  * Status code "100 Continue" is a normal part of HTTP/1.1.

There is something wrong with the client application to be reporting 
that as an error code at all. Likely that bug is what triggered the abort.

  * The difference in result between Squid v4 and v5 is also extremely 
odd. I do not think handling of status 100 had any significant changes 
since the Squid-3 days.


Can you show us your config for both versions?
  Omit lines that are commented out to reduce the sizes.
  Take care to obscure private details while keeping it clear that 
detail A and B are different (eg don't use same symbol X for replacing 
both).


Also FME, where can I/we find details of the Rocky Squid packages?


Cheers
Amos


From rousskov at measurement-factory.com  Mon Aug 29 12:52:50 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Mon, 29 Aug 2022 08:52:50 -0400
Subject: [squid-users] Squid 5.2 TCP_MISS_ABORTED/100 erros when
 uploading
In-Reply-To: <CAEJ1g5Kc0fdE82U+ede-wEfiyLRErxTPo2_BtpR1BzWY=72zig@mail.gmail.com>
References: <CAEJ1g5Kc0fdE82U+ede-wEfiyLRErxTPo2_BtpR1BzWY=72zig@mail.gmail.com>
Message-ID: <654ad586-ff1a-35ff-5fb6-08272c5d8f0f@measurement-factory.com>

On 8/29/22 06:17, David Ferreira wrote:

> I have some squid's running on rocky linux 8 with verion 4.15, recently 
> been testing squid version 5.2(stable version that comes with Rocky 9)to 
> upgrade the current ones and most of the configs/acls seem to work fine.
> 
> Unfortualy theres an application that we use that everytime it tries to 
> upload files it fails on squid 5.2, on 4.15 is works completly fine, so 
> far ive test on squid 5.2 and 5.5 and it's the same behavior, im testing 
> this with default configurations and it always works on 4.15, access log 
> only shows this:
> 
> Squid 4.15:
> 26/Aug/2022:15:36:08 +0100 ???273 172.19.222.132TCP_MISS/200 745 POST http://websiteurl/index.php - HIER_DIRECT/websitedomain text/xml
> 
> Squid 5.2:
> 25/Aug/2022:15:10:00 +0100 ???139 172.19.222.132 TCP_MISS_ABORTED/100 0 POST http://websiteurl HIER_DIRECT/websitedomain -
> 
> anyone has an ideia of what may be happening here?, been searching about 
> http errors 100 and so far i did not find anything that points me to the 
> problem.
> 
> On the application side the error it shows when it tries to upload is:
> "
> Error storing the document on the server
> Detail HTTP error 100
> Send failure: Connection was aborted (55)
> "

Squid v5.2 has many serious bugs. I would not use it in production. 
Build the latest Squid v5 from sources if you have to.


If the latest Squid v5 shows the same problem then this is probably a 
client application or Squid bug/misconfiguration. There were quite a few 
changes in HTTP 1xx control message handling since Squid v4, and one of 
those changes is probably affecting your client. For example, either 
Squid v4 does not deliver that 100 control message to the client at all 
or it is delivering a slightly different 100 control message that your 
client is happy with.
  If you share what HTTP messages are exchanged between client and Squid 
and between Squid and the origin server, in both successful and failing 
use cases, we may be able to tell you more. I would use tcpdump, 
wireshark, or a similar tool to collect HTTP traffic since these are 
non-TLS transactions.


HTH,

Alex.


From squid3 at treenet.co.nz  Mon Aug 29 12:49:16 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 30 Aug 2022 00:49:16 +1200
Subject: [squid-users] How to enable squid to use more server resources
 when using 500+ http_ports?
In-Reply-To: <000801d8bb6d$8cbff790$a63fe6b0$@graminsta.com.br>
References: <000801d8bb6d$8cbff790$a63fe6b0$@graminsta.com.br>
Message-ID: <ef1432d3-c8d6-f3d5-7e7f-737fc44d74fd@treenet.co.nz>

TL;DR this behaviour is expected when expanding beyond the default limit 
on http_port lines permitted in squid.conf. YMMV as to how much you can 
expand, but it will appear at some point.



On 29/08/22 18:06, Marcelo wrote:
> Hello,
> 
> I have a server with large resources ( RAM, CPU, etc) running Ubuntu 20.04.
> 
> When I put squid 4.13 to manage more than 500 http_ports, it performs 
> very slowly.
> 
> Question is, how can I setup Squid or Ubuntu to use more hw resources in 
> order to perform better?

If the behaviour only occurs once you expand the listening ports the 
solution is to reduce the number of listening ports and spread over more 
Squid (on more hardware/machines).


The hard coded default is small for three reasons that I am aware of:

  1) these ports need checking frequently even when no I/O is expected 
to happen. So they are checked every 10ms in addition to the regular I/O 
traffic.

  2) it was set long ago when hardware was more restricted. So YMMV and 
testing like you are doing is recommended when touching it.

  3) most Squid users do not need anywhere even close to the limit set. 
So we are not inclined to change the default value - instead we allow 
custom builds to set themselves if necessary.


That said the speed situation you are experiencing may be more related 
to how many new connections (and thus new HTTP messages to process) can 
be opened per second with X listening ports vs X+Y listening ports. 
Squid does have capacity limits at many points of the traffic processing.


> 
> Or does it a matter of software architecture limitation?
> 
> Perform well with at least 500 http_ports would be very nice so we can 
> use smaller numbers of VPSs.
> 

On a good modern machine this is know to be within the realms of 
reasonable, but it does impact the overall performance per (1) above.


> Its hard to manage so many of it.

Indeed. Another reason not to.

That said the "include" directive and a folder of per-port config files 
was created exactly to help with this type of management problem. 
Automated management of a set of per-port config files can easily be 
setup with popular network management tools and/or scripts.


> It would be a dream to have like 10k http_ports in a single server.

Very unlikely to be doable. Each port used this way reduces the number 
of ports available for client and server transactional traffic.


> 
> If it is not possible, is there any planning about do it in a future?
> 

Not specifically. Due to reason (3) above.


Amos


From rousskov at measurement-factory.com  Mon Aug 29 13:05:06 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Mon, 29 Aug 2022 09:05:06 -0400
Subject: [squid-users] How to enable squid to use more server resources
 when using 500+ http_ports?
In-Reply-To: <000801d8bb6d$8cbff790$a63fe6b0$@graminsta.com.br>
References: <000801d8bb6d$8cbff790$a63fe6b0$@graminsta.com.br>
Message-ID: <91d50e0c-360c-c235-7202-41810c20ace2@measurement-factory.com>

On 8/29/22 02:06, Marcelo wrote:

> I have a server with large resources ( RAM, CPU, etc) running Ubuntu 20.04.
> 
> When I put squid 4.13 to manage more than 500 http_ports, it performs 
> very slowly.
> 
> Question is, how can I setup Squid or Ubuntu to use more hw resources in 
> order to perform better?

To make Squid perform better you need to identify and address the 
current bottleneck. You are implying that the current bottleneck is tied 
to the number of http_ports. If that is true, it is probably possible to 
optimize Squid to handle the large number of listening ports better. 
What makes you think that the number of http_ports is the culprit?

What CPU usage do you see for each Squid kid process during high load? 
What percentage of RAM is used during those times?

FWIW, as you already know from past squid-users emails, I am not aware 
of any linear scans of http_ports in modern Squids that could 
significantly affect runtime performance. That does not mean such linear 
scans do not exist, of course. However, I bet the real problem is elsewhere.


HTH,

Alex.


> Or does it a matter of software architecture limitation?
> 
> Perform well with at least 500 http_ports would be very nice so we can 
> use smaller numbers of VPSs.
> 
> Its hard to manage so many of it.
> It would be a dream to have like 10k http_ports in a single server.
> 
> If it is not possible, is there any planning about do it in a future?
> 
> Tks
> Marcelo.
> 
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



From davidtiagoff at gmail.com  Mon Aug 29 13:31:03 2022
From: davidtiagoff at gmail.com (David Ferreira)
Date: Mon, 29 Aug 2022 14:31:03 +0100
Subject: [squid-users] Squid 5.2 TCP_MISS_ABORTED/100 erros when
 uploading
In-Reply-To: <4b9cf33a-4d35-1f09-6f5c-35f0a2c5ab78@treenet.co.nz>
References: <CAEJ1g5Kc0fdE82U+ede-wEfiyLRErxTPo2_BtpR1BzWY=72zig@mail.gmail.com>
 <4b9cf33a-4d35-1f09-6f5c-35f0a2c5ab78@treenet.co.nz>
Message-ID: <CAEJ1g5KbMxwiT-XQxR-8cQuPMQH4kMYJn8uZKZ9M7by3j3eKdw@mail.gmail.com>

Hi Amos,

Thank you for the reply,

here's my squid.conf, by default our client's(localnet) do not have
internet access and only match windows services acl's unless they are in
authorizednet.conf, in this case that's the only match acl for the clients
using this application, i also removed some of the includes i have, it's
mostly random src to random dstdomain, the clients in question do not match
this acl's at all.

---
squid 4.15 squid.conf:
---

logformat timereadable %tl %6tr %>a %Ss/%03Hs %<st %rm %ru %un %Sh/%<A %mt
access_log daemon:/var/log/squid/access.log timereadable

acl localnet src 10.0.0.0/8     # RFC1918 possible internal network
acl localnet src 172.16.0.0/12  # RFC1918 possible internal network
acl localnet src 192.168.0.0/16 # RFC1918 possible internal network
acl localnet src fc00::/7       # RFC 4193 local private network range
acl localnet src fe80::/10      # RFC 4291 link-local (directly plugged)
machines

include /etc/squid/acls/authorizednet.conf

acl SSL_ports port 443
acl SSL_ports port 8080
acl Safe_ports port 80          # http
acl Safe_ports port 21          # ftp
acl Safe_ports port 443         # https
acl Safe_ports port 70          # gopher
acl Safe_ports port 210         # wais
acl Safe_ports port 1025-65535  # unregistered ports
acl Safe_ports port 280         # http-mgmt
acl Safe_ports port 488         # gss-http
acl Safe_ports port 591         # filemaker
acl Safe_ports port 777         # multiling http
acl FTP_ports port 21 1025-65535
acl CONNECT method CONNECT

###BlockLists
include /etc/squid/acls/blocklists-remotes.conf
###Microsoft ATP
include /etc/squid/acls/atp.conf
###Windows Activation
include /etc/squid/acls/wactivate.conf
###No Windows Update
include /etc/squid/acls/nowupdate.conf
###Windows Update
include /etc/squid/acls/wupdate.conf

http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports

http_access allow localhost manager
http_access deny manager

http_access allow authorizednet
http_access allow localhost

http_access deny all

http_port 3128

cache_dir ufs /var/spool/squid 50000 16 256

coredump_dir /var/spool/squid

refresh_pattern ^ftp:           1440    20%     10080
refresh_pattern ^gopher:        1440    0%      1440
refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
refresh_pattern .               0       20%     4320
max_filedesc 65535

maximum_object_size 10000 MB
range_offset_limit 10000 MB windowsupdate
quick_abort_min -1

refresh_pattern -i
microsoft.com/.*\.(cab|exe|ms[i|u|f]|[ap]sf|wm[v|a]|dat|zip) 4320 80% 43200
reload-into-ims
refresh_pattern -i
windowsupdate.com/.*\.(cab|exe|ms[i|u|f]|[ap]sf|wm[v|a]|dat|zip) 4320 80%
43200 reload-into-ims
refresh_pattern -i
windows.com/.*\.(cab|exe|ms[i|u|f]|[ap]sf|wm[v|a]|dat|zip) 4320 80% 43200
reload-into-ims

---
And here's squid 5.2 squid.conf, it's pretty much the same:
---

logformat timereadable %tl %6tr %>a %Ss/%03Hs %<st %rm %ru %un %Sh/%<A %mt
access_log daemon:/var/log/squid/access.log timereadable
debug_options ALL,1 33,2 28,9

acl localnet src 0.0.0.1-0.255.255.255  # RFC 1122 "this" network (LAN)
acl localnet src 10.0.0.0/8             # RFC 1918 local private network
(LAN)
acl localnet src 100.64.0.0/10          # RFC 6598 shared address space
(CGN)
acl localnet src 169.254.0.0/16         # RFC 3927 link-local (directly
plugged) machines
acl localnet src 172.16.0.0/12          # RFC 1918 local private network
(LAN)
acl localnet src 192.168.0.0/16         # RFC 1918 local private network
(LAN)
acl localnet src fc00::/7               # RFC 4193 local private network
range
acl localnet src fe80::/10              # RFC 4291 link-local (directly
plugged) machines

include /etc/squid/acls/authorizednet.conf

acl SSL_ports port 443
acl SSL_ports port 8080
acl Safe_ports port 80          # http
acl Safe_ports port 21          # ftp
acl Safe_ports port 443         # https
acl Safe_ports port 70          # gopher
acl Safe_ports port 210         # wais
acl Safe_ports port 1025-65535  # unregistered ports
acl Safe_ports port 280         # http-mgmt
acl Safe_ports port 488         # gss-http
acl Safe_ports port 591         # filemaker
acl Safe_ports port 777         # multiling http
acl FTP_ports port 21 1025-65535

###BlockLists
include /etc/squid/acls/blocklists-remotes.conf
###Microsoft ATP
include /etc/squid/acls/atp.conf
###Windows Activation
include /etc/squid/acls/wactivate.conf
###No Windows Update
include /etc/squid/acls/nowupdate.conf
###Windows Update
include /etc/squid/acls/wupdate.conf

http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports

http_access allow localhost manager
http_access deny manager

http_access allow authorizednet
http_access allow localhost

http_access deny all

http_port 3128

cache_dir ufs /var/spool/squid 50000 16 256

coredump_dir /var/spool/squid

refresh_pattern ^ftp:           1440    20%     10080
refresh_pattern ^gopher:        1440    0%      1440
refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
refresh_pattern .               0       20%     4320

maximum_object_size 10000 MB
range_offset_limit 10000 MB windowsupdate
quick_abort_min -1

refresh_pattern -i
microsoft.com/.*\.(cab|exe|ms[i|u|f]|[ap]sf|wm[v|a]|dat|zip) 4320 80% 43200
reload-into-ims
refresh_pattern -i
windowsupdate.com/.*\.(cab|exe|ms[i|u|f]|[ap]sf|wm[v|a]|dat|zip) 4320 80%
43200 reload-into-ims
refresh_pattern -i
windows.com/.*\.(cab|exe|ms[i|u|f]|[ap]sf|wm[v|a]|dat|zip) 4320 80% 43200
reload-into-ims


As for squid rocky linux packages information, here is the links:
Rocky 8 :
https://almalinux.pkgs.org/8/almalinux-appstream-x86_64/squid-4.15-3.module_el8.6.0+3010+383bc947.1.x86_64.rpm.html
Rocky 9 :
https://almalinux.pkgs.org/9/almalinux-appstream-x86_64/squid-5.2-1.el9_0.1.x86_64.rpm.html

Thank you!


On Mon, 29 Aug 2022 at 13:36, Amos Jeffries <squid3 at treenet.co.nz> wrote:

> On 29/08/22 22:17, David Ferreira wrote:
> > hi,
> >
> > First time using mailing lists, sorry about anything.
> >
>
> Welcome, and thanks for using Squid.
>
> Do not worry about mistakes. Helping with that type of thing is what
> this list is here for whether expert or beginner.
>
>
>
> >
> > Squid 4.15:
> > 26/Aug/2022:15:36:08 +0100    273 172.19.222.132TCP_MISS/200 745 POST
> > http://websiteurl/index.php <http://websiteurl/index.php> -
> > HIER_DIRECT/websitedomain text/xml
> >
> > Squid 5.2:
> > 25/Aug/2022:15:10:00 +0100    139 172.19.222.132 TCP_MISS_ABORTED/100 0
> > POST http://websiteurl <http://websiteurl>/index.php -
> > HIER_DIRECT/websitedomain -
> >
> > anyone has an ideia of what may be happening here?, been searching about
> > http errors 100 and so far i did not find anything that points me to the
> > problem.
> >
> > On the application side the error it shows when it tries to upload is:
> > "
> > Error storing the document on the server
> > Detail HTTP error 100
> > Send failure: Connection was aborted (55)
> > "
> >
>
> This is very odd.
>
>   * The "ABORTED" tag hints strongly that the client closed the
> connection here.
>
>
>   * Status code "100 Continue" is a normal part of HTTP/1.1.
>
> There is something wrong with the client application to be reporting
> that as an error code at all. Likely that bug is what triggered the abort.
>
>   * The difference in result between Squid v4 and v5 is also extremely
> odd. I do not think handling of status 100 had any significant changes
> since the Squid-3 days.
>
>
> Can you show us your config for both versions?
>   Omit lines that are commented out to reduce the sizes.
>   Take care to obscure private details while keeping it clear that
> detail A and B are different (eg don't use same symbol X for replacing
> both).
>
>
> Also FME, where can I/we find details of the Rocky Squid packages?
>
>
> Cheers
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>


-- 
Com os melhores cumprimentos,

David Ferreira
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220829/c844365c/attachment.htm>

From squid3 at treenet.co.nz  Mon Aug 29 13:49:50 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 30 Aug 2022 01:49:50 +1200
Subject: [squid-users] Squid 5.2 TCP_MISS_ABORTED/100 erros when
 uploading
In-Reply-To: <CAEJ1g5KbMxwiT-XQxR-8cQuPMQH4kMYJn8uZKZ9M7by3j3eKdw@mail.gmail.com>
References: <CAEJ1g5Kc0fdE82U+ede-wEfiyLRErxTPo2_BtpR1BzWY=72zig@mail.gmail.com>
 <4b9cf33a-4d35-1f09-6f5c-35f0a2c5ab78@treenet.co.nz>
 <CAEJ1g5KbMxwiT-XQxR-8cQuPMQH4kMYJn8uZKZ9M7by3j3eKdw@mail.gmail.com>
Message-ID: <048c6057-bac9-f3f8-baaa-ca3f89884131@treenet.co.nz>

On 30/08/22 01:31, David Ferreira wrote:
> Hi Amos,
> 
> Thank you for the reply,
> 
> here's my squid.conf, by default our client's(localnet) do not have 
> internet access and only match windows services acl's unless they are in 
> authorizednet.conf, in this case that's the only match acl for the 
> clients using this application, i also removed some of the includes i 
> have, it's mostly random src to random dstdomain, the clients in 
> question do not match this acl's at all.
> 

Thanks. I do not see anything in those configurations.

Are there any directives in the included files whose name mentions 
"response_" or "reply_" ?

You could do a full check quickly with:
   squid -k parse 2>&1 | grep "Processing" | grep -E "response_|reply_"

If there is any difference between the two versions that is something to 
look at closer for the reasons outlined by Alex already.

The traffic details asked for by Alex already are the next step I would 
move on to checking.


Cheers
Amos


From davidtiagoff at gmail.com  Mon Aug 29 14:13:00 2022
From: davidtiagoff at gmail.com (David Ferreira)
Date: Mon, 29 Aug 2022 15:13:00 +0100
Subject: [squid-users] Squid 5.2 TCP_MISS_ABORTED/100 erros when
 uploading
In-Reply-To: <048c6057-bac9-f3f8-baaa-ca3f89884131@treenet.co.nz>
References: <CAEJ1g5Kc0fdE82U+ede-wEfiyLRErxTPo2_BtpR1BzWY=72zig@mail.gmail.com>
 <4b9cf33a-4d35-1f09-6f5c-35f0a2c5ab78@treenet.co.nz>
 <CAEJ1g5KbMxwiT-XQxR-8cQuPMQH4kMYJn8uZKZ9M7by3j3eKdw@mail.gmail.com>
 <048c6057-bac9-f3f8-baaa-ca3f89884131@treenet.co.nz>
Message-ID: <CAEJ1g5JKFBzDkjYVkY4PydCr0YJNj8B7vtVFVx5NZJmMo3-5zQ@mail.gmail.com>

Running squid parse does not show anything in both squid's, im gonna try to
tcpdump the trafic in both enviroments and build a squid v5 to test it out
like sugested by alex, will post the results after.

thank you again.

On Mon, 29 Aug 2022 at 15:00, Amos Jeffries <squid3 at treenet.co.nz> wrote:

> On 30/08/22 01:31, David Ferreira wrote:
> > Hi Amos,
> >
> > Thank you for the reply,
> >
> > here's my squid.conf, by default our client's(localnet) do not have
> > internet access and only match windows services acl's unless they are in
> > authorizednet.conf, in this case that's the only match acl for the
> > clients using this application, i also removed some of the includes i
> > have, it's mostly random src to random dstdomain, the clients in
> > question do not match this acl's at all.
> >
>
> Thanks. I do not see anything in those configurations.
>
> Are there any directives in the included files whose name mentions
> "response_" or "reply_" ?
>
> You could do a full check quickly with:
>    squid -k parse 2>&1 | grep "Processing" | grep -E "response_|reply_"
>
> If there is any difference between the two versions that is something to
> look at closer for the reasons outlined by Alex already.
>
> The traffic details asked for by Alex already are the next step I would
> move on to checking.
>
>
> Cheers
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>


-- 
Com os melhores cumprimentos,

David Ferreira
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220829/408e1fbc/attachment.htm>

From mohammed.khallaf at gmail.com  Mon Aug 29 15:35:43 2022
From: mohammed.khallaf at gmail.com (M K)
Date: Mon, 29 Aug 2022 17:35:43 +0200
Subject: [squid-users] Squid 4.8+ intercept
In-Reply-To: <000001d8b30b$93a95570$bafc0050$@gmail.com>
References: <CAFMSmTvEFMASCsodsZ43zdY_tEaKMJu2s_c8bCAKuyVd1i9yFg@mail.gmail.com>
 <CAFMSmTuUK_9UApWc76L91GDRm-tK-E+b=oLrUzF5Fitr-PZy3Q@mail.gmail.com>
 <000401d8ac90$62fcea80$28f6bf80$@gmail.com>
 <CAFMSmTt71mFhpanDVtKG0Gg6UA74ZAgpnBx5B__01K1Tmu5QLg@mail.gmail.com>
 <001401d8af3e$392663c0$ab732b40$@gmail.com>
 <CAFMSmTua4_eQ4iyY-zwCSkqYk+E1Rjd0CtzvxYi7vP_ty=pQAg@mail.gmail.com>
 <000001d8b30b$93a95570$bafc0050$@gmail.com>
Message-ID: <CAFMSmTs8r0rTAQt-G__7fOrBQfw2430S+Cm-dH9B22q6OVmACA@mail.gmail.com>

iptables PREROUTING:
Chain PREROUTING (policy ACCEPT)
target     prot opt source               destination
ACCEPT     all  --  anywhere             anywhere             ADDRTYPE
match dst-type LOCAL
REDIRECT   tcp  --  anywhere             anywhere             tcp
dpt:http redir ports 3130
REDIRECT   tcp  --  anywhere             anywhere             tcp
dpt:https redir ports 3130
-------------------------
Mikrotik mangle:
add action=route chain=prerouting dst-port=80 passthrough=no
protocol=tcp route-dst={squid} src-address={client}
add action=route chain=prerouting connection-state="" dst-port=443
passthrough=no protocol=tcp route-dst={squid} src-address={client}
-------------------------
full squid.conf:
acl client src x.x.x.x/x

http_access allow client
http_access deny all

http_port 3128
https_port 3130 intercept ssl-bump cert=/xxx/xxx/xxx.pem
generate-host-certificates=on dynamic_cert_mem_cache_size=999MB

acl tls_connect at_step SslBump1
ssl_bump peek tls_connect
ssl_bump splice all
---------------------------
Firefox behavior...
HTTPS: ALL OK!

HTTP (http://google.com):

The connection was reset

The connection to the server was reset while the page was loading.

    The site could be temporarily unavailable or too busy. Try again
in a few moments.
    If you are unable to load any pages, check your computer?s network
connection.
    If your computer or network is protected by a firewall or proxy,
make sure that Firefox is permitted to access the Web.
---------------------------
Squid log:

HTTPS:
----------
1661786874.087   5981 {client} TCP_TUNNEL/200 152 CONNECT
js-sec.indexww.com:443 - ORIGINAL_DST/92.123.33.225 -
1661786874.087   5855 {client} TCP_TUNNEL/200 152 CONNECT
js-sec.indexww.com:443 - ORIGINAL_DST/92.123.33.225 -
1661786877.448  10391 {client} TCP_TUNNEL/200 1254 CONNECT
prg.smartadserver.com:443 - ORIGINAL_DST/185.86.138.32 -
1661786878.480      4 {client} NONE/200 0 CONNECT 64.74.236.255:443 -
HIER_NONE/- -
1661786886.125   7644 {client} TCP_TUNNEL/200 3850 CONNECT
mcdp-chidc2.outbrain.com:443 - ORIGINAL_DST/64.74.236.255 -
1661786886.916      5 {client} NONE/200 0 CONNECT 54.192.111.67:443 -
HIER_NONE/- -
1661786887.070      3 {client} NONE/200 0 CONNECT 34.98.75.36:443 -
HIER_NONE/- -
1661786887.275      0 {client} NONE_ABORTED/200 0 CONNECT
88.221.111.34:80 - HIER_NONE/- -
1661786887.548      4 {client} NONE/200 0 CONNECT 54.192.111.44:443 -
HIER_NONE/- -
1661786888.550 147502 {client} TCP_TUNNEL/200 8554 CONNECT
cdn.cnn.com:443 - ORIGINAL_DST/2.23.52.55 -
1661786888.718      1 {client} NONE/200 0 CONNECT 185.86.138.32:443 -
HIER_NONE/- -
1661786889.510 143920 {client} TCP_TUNNEL/200 9655 CONNECT
aax-eu.amazon-adsystem.com:443 - ORIGINAL_DST/52.95.125.22 -
1661786889.510 116428 {client} TCP_TUNNEL/200 6386 CONNECT
segment-data-us-east.zqtk.net:443 - ORIGINAL_DST/52.72.26.11 -
1661786889.609      6 {client} NONE/200 0 CONNECT 92.123.33.225:443 -
HIER_NONE/- -
1661786890.379 149287 {client} TCP_TUNNEL/200 444896 CONNECT
lightning.cnn.com:443 - ORIGINAL_DST/2.23.52.55 -
1661786892.987      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786892.992      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786892.998      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.003      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.009      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.014      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.019      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.024      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.029      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.034      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.044      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.048      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.053      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.057      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.062      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.067      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.072      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.078      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.082      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.087      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.093      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.098      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.102      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.107      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.112      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.116      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.120      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.125      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.129      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.134      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.140      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.144      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.148      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.152      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.156      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.160      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.165      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.170      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.174      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.178      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.184      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.188      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.192      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.196      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.200      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.204      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.208      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.213      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.217      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.221      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.227      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.231      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.236      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.240      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.243      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.247      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.251      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.255      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.260      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.264      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786894.773   5163 {client} TCP_TUNNEL/200 152 CONNECT
js-sec.indexww.com:443 - ORIGINAL_DST/92.123.33.225 -
1661786899.041  10322 {client} TCP_TUNNEL/200 1254 CONNECT
prg.smartadserver.com:443 - ORIGINAL_DST/185.86.138.32 -
1661786899.111 125320 {client} TCP_TUNNEL/200 27104 CONNECT
images.outbrainimg.com:443 - ORIGINAL_DST/92.123.32.26 -
1661786899.314 152898 {client} TCP_TUNNEL/200 285438 CONNECT
widgets.outbrain.com:443 - ORIGINAL_DST/92.123.34.112 -
1661786899.484  98933 {client} TCP_TUNNEL/200 6583 CONNECT
s.amazon-adsystem.com:443 - ORIGINAL_DST/209.54.182.161 -
1661786902.387      3 {client} NONE/200 0 CONNECT 64.74.236.255:443 -
HIER_NONE/- -
1661786903.220      3 {client} NONE/200 0 CONNECT 142.251.37.170:443 -
HIER_NONE/- -
1661786903.361      3 {client} NONE/200 0 CONNECT 92.123.33.225:443 -
HIER_NONE/- -
1661786903.390    169 {client} TCP_TUNNEL/200 1868 CONNECT
safebrowsing.googleapis.com:443 - ORIGINAL_DST/142.251.37.170 -
1661786903.430      2 {client} NONE/200 0 CONNECT 3.217.56.194:443 -
HIER_NONE/- -
1661786903.462      1 {client} NONE/200 0 CONNECT 178.32.210.226:443 -
HIER_NONE/- -
1661786904.650 104106 {client} TCP_TUNNEL/200 4310 CONNECT
pixel-eu.rubiconproject.com:443 - ORIGINAL_DST/69.173.144.165 -
1661786905.983      3 {client} NONE/200 0 CONNECT 64.202.112.127:443 -
HIER_NONE/- -
1661786905.992   2561 {client} TCP_TUNNEL/200 5831 CONNECT
logx.optimizely.com:443 - ORIGINAL_DST/3.217.56.194 -
1661786906.105    121 {client} TCP_TUNNEL/200 0 CONNECT
tr.outbrain.com:443 - ORIGINAL_DST/64.202.112.127 -
1661786906.354      2 {client} NONE/200 0 CONNECT 2.23.52.55:443 - HIER_NONE/- -
1661786906.358      1 {client} NONE/200 0 CONNECT 2.23.52.55:443 - HIER_NONE/- -
1661786906.364      1 {client} NONE/200 0 CONNECT 92.123.34.112:443 -
HIER_NONE/- -
1661786906.620      1 {client} NONE/200 0 CONNECT 146.75.56.64:443 -
HIER_NONE/- -
1661786906.767      3 {client} NONE/200 0 CONNECT 3.217.56.194:443 -
HIER_NONE/- -
1661786907.001      2 {client} NONE/200 0 CONNECT 151.101.1.195:443 -
HIER_NONE/- -
1661786907.494      2 {client} NONE/200 0 CONNECT 54.93.141.29:443 -
HIER_NONE/- -
1661786907.596      2 {client} NONE/200 0 CONNECT 142.251.37.48:443 -
HIER_NONE/- -
1661786907.777      2 {client} NONE/200 0 CONNECT 92.122.218.83:443 -
HIER_NONE/- -
1661786907.913      2 {client} NONE/200 0 CONNECT 54.231.203.49:443 -
HIER_NONE/- -
1661786907.914      4 {client} NONE/200 0 CONNECT 54.231.203.49:443 -
HIER_NONE/- -
1661786907.916      6 {client} NONE/200 0 CONNECT 54.231.203.49:443 -
HIER_NONE/- -
1661786907.919      7 {client} NONE/200 0 CONNECT 18.161.111.80:443 -
HIER_NONE/- -
1661786908.008      1 {client} NONE/200 0 CONNECT 91.228.74.208:443 -
HIER_NONE/- -
1661786908.012      5 {client} NONE/200 0 CONNECT 64.202.112.127:443 -
HIER_NONE/- -
1661786908.135      0 {client} NONE_ABORTED/200 0 CONNECT
216.58.212.99:80 - HIER_NONE/- -
1661786908.305      3 {client} NONE/200 0 CONNECT 92.123.34.112:443 -
HIER_NONE/- -
1661786908.393   5031 {client} TCP_TUNNEL/200 152 CONNECT
js-sec.indexww.com:443 - ORIGINAL_DST/92.123.33.225 -
1661786908.393 172182 {client} TCP_TUNNEL/200 8323 CONNECT
www.google.com:443 - ORIGINAL_DST/142.250.200.196 -
1661786908.561      0 {client} NONE_ABORTED/200 0 CONNECT
18.161.108.38:80 - HIER_NONE/- -
1661786908.562      0 {client} NONE_ABORTED/200 0 CONNECT
18.161.108.38:80 - HIER_NONE/- -
1661786908.562      0 {client} NONE_ABORTED/200 0 CONNECT
18.161.108.38:80 - HIER_NONE/- -
1661786909.615      2 {client} NONE/200 0 CONNECT 104.108.78.219:443 -
HIER_NONE/- -
1661786909.620      2 {client} NONE/200 0 CONNECT 54.147.61.21:443 -
HIER_NONE/- -
1661786909.685      3 {client} NONE/200 0 CONNECT 13.36.218.177:443 -
HIER_NONE/- -
1661786910.704      5 {client} NONE/200 0 CONNECT 3.229.71.121:443 -
HIER_NONE/- -
1661786910.820      1 {client} NONE/200 0 CONNECT 94.237.48.66:443 -
HIER_NONE/- -
1661786910.981    161 {client} TCP_TUNNEL/200 5583 CONNECT
v8-emea.sdk.beemray.com:443 - ORIGINAL_DST/94.237.48.66 -
1661786910.985      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786910.993      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786910.999      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.003      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.012      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.020      2 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.024      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.030      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.034      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.040      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.151      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.156      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.162      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.167      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.172      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.177      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.182      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.187      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.192      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.197      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.204      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.208      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.212      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.215      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.219      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.223      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.227      1 {client} NONE/200 0 CONNECT 52.72.26.11:443 -
HIER_NONE/- -
1661786911.229      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.233      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.237      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.242      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.250      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.254      1 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.258      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.262      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.267      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.272      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.392   5027 {client} TCP_TUNNEL/200 152 CONNECT
amplify.outbrain.com:443 - ORIGINAL_DST/92.123.34.112 -
1661786911.398      2 {client} NONE/200 0 CONNECT 52.95.126.160:443 -
HIER_NONE/- -
1661786911.526      5 {client} NONE/200 0 CONNECT 34.246.41.28:443 -
HIER_NONE/- -
1661786911.530      1 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786912.393 170550 {client} TCP_TUNNEL/200 18491 CONNECT
get.s-onetag.com:443 - ORIGINAL_DST/18.161.111.16 -
1661786912.393 170968 {client} TCP_TUNNEL/200 5658 CONNECT
cdn.jsdelivr.net:443 - ORIGINAL_DST/104.16.88.20 -
1661786912.622      3 {client} NONE/200 0 CONNECT 172.217.18.33:443 -
HIER_NONE/- -
1661786912.733   5239 {client} TCP_TUNNEL/200 6889 CONNECT
mms.cnn.com:443 - ORIGINAL_DST/54.93.141.29 -
1661786912.772    150 {client} TCP_TUNNEL/200 5179 CONNECT
4669ca4556421dd764fce36af596f212.safeframe.googlesyndication.com:443 -
ORIGINAL_DST/172.217.18.33 -
1661786913.104 112542 {client} TCP_TUNNEL/200 4310 CONNECT
pixel.rubiconproject.com:443 - ORIGINAL_DST/69.173.144.138 -
1661786913.383      2 {client} NONE/200 0 CONNECT 54.93.141.29:443 -
HIER_NONE/- -
1661786913.394   5475 {client} TCP_TUNNEL/200 371 CONNECT
cdn.boomtrain.com:443 - ORIGINAL_DST/18.161.111.80 -
1661786913.395 170794 {client} TCP_TUNNEL/200 16461 CONNECT
signal-beacon.s-onetag.com:443 - ORIGINAL_DST/54.192.111.35 -
1661786913.395 170901 {client} TCP_TUNNEL/200 7241 CONNECT
onetag-geo.s-onetag.com:443 - ORIGINAL_DST/18.161.97.41 -
1661786913.396 173362 {client} TCP_TUNNEL/200 8454 CONNECT
www.cnn.com:443 - ORIGINAL_DST/146.75.59.5 -
1661786913.464      2 {client} NONE/200 0 CONNECT 18.193.134.248:443 -
HIER_NONE/- -
1661786913.859  10397 {client} TCP_TUNNEL/200 5083 CONNECT
prg.smartadserver.com:443 - ORIGINAL_DST/178.32.210.226 -
1661786914.884   6971 {client} TCP_TUNNEL/200 131386 CONNECT
advsync.s3.amazonaws.com:443 - ORIGINAL_DST/54.231.203.49 -
1661786915.017   7103 {client} TCP_TUNNEL/200 130794 CONNECT
advsync.s3.amazonaws.com:443 - ORIGINAL_DST/54.231.203.49 -
1661786915.025   7108 {client} TCP_TUNNEL/200 132142 CONNECT
advsync.s3.amazonaws.com:443 - ORIGINAL_DST/54.231.203.49 -
1661786915.396 174730 {client} TCP_TUNNEL/200 102282 CONNECT
cdn.cookielaw.org:443 - ORIGINAL_DST/104.16.148.64 -
1661786915.523   7511 {client} TCP_TUNNEL/200 3798 CONNECT
tr.outbrain.com:443 - ORIGINAL_DST/64.202.112.127 -
1661786916.252      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786916.257      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786916.262      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786916.266      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786916.271      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786916.275      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786916.280      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786916.286      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786916.290      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786916.294      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786916.302      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786916.307      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786916.311      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786916.315      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786916.319      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786916.324      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786916.328      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786916.333      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786916.337      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786916.341      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786916.397 116628 {client} TCP_TUNNEL/200 15014 CONNECT
eus.rubiconproject.com:443 - ORIGINAL_DST/104.125.24.254 -
1661786916.397 170897 {client} TCP_TUNNEL/200 6473 CONNECT
www.ugdturner.com:443 - ORIGINAL_DST/34.237.36.10 -
1661786916.398 170966 {client} TCP_TUNNEL/200 4198 CONNECT
warnermediagroup-com.videoplayerhub.com:443 - ORIGINAL_DST/104.26.9.50
-
1661786917.171  14783 {client} TCP_TUNNEL/200 4492 CONNECT
mcdp-chidc2.outbrain.com:443 - ORIGINAL_DST/64.74.236.255 -
1661786917.399 170571 {client} TCP_TUNNEL/200 6635 CONNECT
securepubads.g.doubleclick.net:443 - ORIGINAL_DST/142.251.37.162 -
1661786917.400 170992 {client} TCP_TUNNEL/200 13115 CONNECT
static.adsafeprotected.com:443 - ORIGINAL_DST/54.192.111.91 -
1661786918.630   5165 {client} TCP_TUNNEL/200 570 CONNECT
www.summerhamster.com:443 - ORIGINAL_DST/18.193.134.248 -
1661786918.718   5335 {client} TCP_TUNNEL/200 8722 CONNECT
mms.cnn.com:443 - ORIGINAL_DST/54.93.141.29 -
1661786919.561 120339 {client} TCP_TUNNEL/200 4961 CONNECT
secure-assets.rubiconproject.com:443 - ORIGINAL_DST/2.17.80.55 -
1661786920.402 173997 {client} TCP_TUNNEL/200 38769 CONNECT
static.chartbeat.com:443 - ORIGINAL_DST/18.161.105.235 -
1661786920.669 174219 {client} TCP_TUNNEL/200 81160 CONNECT
ads.pubmatic.com:443 - ORIGINAL_DST/92.123.33.150 -
1661786921.369 145142 {client} TCP_TUNNEL/200 521393 CONNECT
player.aniview.com:443 - ORIGINAL_DST/92.123.34.136 -

HTTP:
--------
1661786959.922      4 {client} NONE/200 0 CONNECT 142.250.200.196:443
- HIER_NONE/- -
1661786959.987     64 {client} TCP_TUNNEL/200 0 CONNECT
www.google.com:443 - ORIGINAL_DST/142.250.200.196 -
1661786960.061      4 {client} NONE/200 0 CONNECT 142.250.200.196:443
- HIER_NONE/- -
1661786960.177      0 {client} NONE_ABORTED/200 0 CONNECT
216.58.212.99:80 - HIER_NONE/- -
1661786968.308      4 {client} NONE_ABORTED/200 0 CONNECT
151.101.3.5:80 - HIER_NONE/- -
1661786968.317      1 {client} NONE_ABORTED/200 0 CONNECT
151.101.3.5:80 - HIER_NONE/- -
1661786968.337      1 {client} NONE_ABORTED/200 0 CONNECT
151.101.3.5:80 - HIER_NONE/- -
1661786968.344      0 {client} NONE_ABORTED/200 0 CONNECT
151.101.3.5:80 - HIER_NONE/- -
1661786968.348      0 {client} NONE_ABORTED/200 0 CONNECT
151.101.3.5:80 - HIER_NONE/- -
1661786968.352      0 {client} NONE_ABORTED/200 0 CONNECT
151.101.3.5:80 - HIER_NONE/- -
1661786968.360      0 {client} NONE_ABORTED/200 0 CONNECT
151.101.3.5:80 - HIER_NONE/- -
1661786968.364      0 {client} NONE_ABORTED/200 0 CONNECT
151.101.3.5:80 - HIER_NONE/- -
1661786968.367      0 {client} NONE_ABORTED/200 0 CONNECT
151.101.3.5:80 - HIER_NONE/- -
1661786968.371      0 {client} NONE_ABORTED/200 0 CONNECT
151.101.3.5:80 - HIER_NONE/- -
1661786971.049      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.053      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.057      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.060      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.064      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.068      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.072      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.076      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.080      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.084      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.093      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.098      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.102      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.105      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.110      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.113      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.117      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.121      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.125      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.128      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.134      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.138      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.142      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.146      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.150      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.154      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.158      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.162      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.166      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.171      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.179      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.183      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.186      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.191      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.194      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.199      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.202      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.206      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.210      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.214      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.220      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.224      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.228      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.231      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.235      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.239      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.244      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.248      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.252      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.256      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.262      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.266      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.270      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.273      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.277      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.281      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.285      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.289      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.292      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.296      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786975.433      0 {client} NONE_ABORTED/200 0 CONNECT
151.101.3.5:80 - HIER_NONE/- -
1661786975.447      0 {client} NONE_ABORTED/200 0 CONNECT
151.101.3.5:80 - HIER_NONE/- -
1661786975.453      0 {client} NONE_ABORTED/200 0 CONNECT
151.101.3.5:80 - HIER_NONE/- -
1661786975.460      0 {client} NONE_ABORTED/200 0 CONNECT
151.101.3.5:80 - HIER_NONE/- -
1661786975.464      0 {client} NONE_ABORTED/200 0 CONNECT
151.101.3.5:80 - HIER_NONE/- -
1661786975.471      3 {client} NONE_ABORTED/200 0 CONNECT
151.101.3.5:80 - HIER_NONE/- -
1661786975.475      0 {client} NONE_ABORTED/200 0 CONNECT
151.101.3.5:80 - HIER_NONE/- -
1661786975.480      0 {client} NONE_ABORTED/200 0 CONNECT
151.101.3.5:80 - HIER_NONE/- -
1661786975.486      0 {client} NONE_ABORTED/200 0 CONNECT
151.101.3.5:80 - HIER_NONE/- -
1661786975.491      0 {client} NONE_ABORTED/200 0 CONNECT
151.101.3.5:80 - HIER_NONE/- -
1661786987.518      0 {client} NONE_ABORTED/200 0 CONNECT
172.217.18.238:80 - HIER_NONE/- -
1661786987.527      8 {client} NONE_ABORTED/200 0 CONNECT
172.217.18.238:80 - HIER_NONE/- -
1661786987.531      0 {client} NONE_ABORTED/200 0 CONNECT
172.217.18.238:80 - HIER_NONE/- -
1661786987.540      0 {client} NONE_ABORTED/200 0 CONNECT
172.217.18.238:80 - HIER_NONE/- -
1661786987.544      0 {client} NONE_ABORTED/200 0 CONNECT
172.217.18.238:80 - HIER_NONE/- -
1661786987.548      0 {client} NONE_ABORTED/200 0 CONNECT
172.217.18.238:80 - HIER_NONE/- -
1661786987.557      0 {client} NONE_ABORTED/200 0 CONNECT
172.217.18.238:80 - HIER_NONE/- -
1661786987.562      0 {client} NONE_ABORTED/200 0 CONNECT
172.217.18.238:80 - HIER_NONE/- -
1661786987.566      0 {client} NONE_ABORTED/200 0 CONNECT
172.217.18.238:80 - HIER_NONE/- -
1661786987.571      0 {client} NONE_ABORTED/200 0 CONNECT
172.217.18.238:80 - HIER_NONE/- -

On Thu, Aug 18, 2022 at 4:05 PM <ngtech1ltd at gmail.com> wrote:
>
> Hey K,
>
> I need your Mikrotik and squid.conf and iptables to understand what the issue might be.
> You will need to describe your setup in a way I can relate to it.
> There is not much of a difference between port 80 to 443 just that the port need to have ssl-bump settings If you are using it.
> The CONNECT port is a simple forward proxy and it seems your setup is not as simple as you describe.
> If you do have NAT then you need this to be only on specific interfaces in the Mikrotik and the Squid server.
>
> In my case the basic setup works for a very long time now so I cannot imagine what's wrong in your case.
>
> Eliezer
>
> ----
> Eliezer Croitoru
> NgTech, Tech Support
> Mobile: +972-5-28704261
> Email: ngtech1ltd at gmail.com
> Web: https://ngtech.co.il/
> My-Tube: https://tube.ngtech.co.il/
>
> -----Original Message-----
> From: M K <mohammed.khallaf at gmail.com>
> Sent: Thursday, 18 August 2022 6:20
> To: ngtech1ltd at gmail.com
> Cc: squid-users at lists.squid-cache.org; Rafael Akchurin <rafael.akchurin at diladele.com>
> Subject: Re: [squid-users] Squid 4.8+ intercept
>
> Hello Eliezer,
>
> I finally got my setup to work; turned out to be intercepted clients
> running into default nat, while my test squid server did not allow
> them access, not even through iptables!
>
> Now, I have one last bit to handle, which you did not cover in your
> video. I'm using 3 ports for squid like Rafael's guide: one for normal
> CONNECT, one for intercepted plain HTTP on 80, and one for intercepted
> HTTPs on 443.
>
> The setup works awesome for TLS addresses (i.e https://), but browser
> redirection from Plain to TLS, say from http://cnn.com to
> https://cnn.com, fails to happen. It just waits then time out.
> What could be done to make it happen?
>
> All best,
> K
>
>
> On Sat, Aug 13, 2022 at 7:57 PM <ngtech1ltd at gmail.com> wrote:
> >
> > Hey K,
> >
> >
> >
> > What RouterOS version are you using?
> >
> > Also, what rules have you applied?
> >
> > If there is a very long delay and then a failure you should verify that the rules you wrote are proper to your environment.
> >
> > You should route packets based on connection marks and mark only new connections from LAN IP addresses and only on the LAN interface.
> >
> > As I showed in the demo video it?s very simple to implement.
> >
> >
> >
> > Let me know if you are still having issues.
> >
> >
> >
> > Eliezer
> >
> >
> >
> > ----
> >
> > Eliezer Croitoru
> >
> > NgTech, Tech Support
> >
> > Mobile: +972-5-28704261
> >
> > Email: ngtech1ltd at gmail.com
> >
> > Web: https://ngtech.co.il/
> >
> > My-Tube: https://tube.ngtech.co.il/
> >
> >
> >
> > From: M K <mohammed.khallaf at gmail.com>
> > Sent: Saturday, 13 August 2022 10:59
> > To: ngtech1ltd at gmail.com
> > Cc: squid-users at lists.squid-cache.org
> > Subject: Re: [squid-users] Squid 4.8+ intercept
> >
> >
> >
> > Thank  you for your quick reply. The text-drawing actually changed with different font; the squid server is effectively connected to MikroTik router, not the same physical link as the client.
> >
> >
> >
> > The MikroTik router sits between the client and squid server.
> >
> >
> >
> > That said, I can confirm that the MikroTik router is effectively able to route/DNat client packets going to ports 80 and 443 to squid server. Depending on router rules be it route or dnat, the client browser effectively displays the error page of squid, or goes into a very long delay then failure.
> >
> >
> >
> > I will retry and let you know.
> >
> >
> >
> > K
> >
> > On Wed, Aug 10, 2022, 10:08 <ngtech1ltd at gmail.com> wrote:
> >
> > Hey K,
> >
> >
> >
> > I am not sure about the network topology.
> >
> > Preferably the Squid should reside on another network then the clients if it?s intercepting the traffic.
> >
> > Also, I assume it?s not a TPROXY setup so it should be pretty simple and straight forward.
> >
> >
> >
> > I understand why are you asking this question.
> >
> > Also take into account that Mikrotik is now on 7.4 firmware and it?s recommended to use this one.
> >
> > If you are using any other version let me know so I can try to make sense on the differences.
> >
> > I will try to give a DEMO for such a setup and how to make it work.
> >
> >
> >
> > Eliezer
> >
> >
> >
> > ----
> >
> > Eliezer Croitoru
> >
> > NgTech, Tech Support
> >
> > Mobile: +972-5-28704261
> >
> > Email: ngtech1ltd at gmail.com
> >
> > Web: https://ngtech.co.il/
> >
> > My-Tube: https://tube.ngtech.co.il/
> >
> >
> >
> > From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of M K
> > Sent: Tuesday, 9 August 2022 22:29
> > To: squid-users at lists.squid-cache.org
> > Subject: [squid-users] Squid 4.8+ intercept
> >
> >
> >
> > Hello,
> >
> >
> >
> > I have a setup like this one:
> >
> >
> > | Client | =====> | Router | =====> Internet
> >                      ||
> >                      \/
> >                   | Squid |
> >
> >
> >
> > ...the router is a Mikrotik router capable of all things NAT/Redirect and whatnot. Squid server has only one network interface.
> >
> > Using the router:
> >
> > - I tried routing traffic to squid server IP.
> >
> > - I tried destination-NATing from client to server IP, with origin server IP-and-port natted to squid IP-and-port, and with origin server IP-only natted to squid-IP.
> >
> >
> >
> > I have been struggling for 2 days to setup a working Squid 4.8 or higher interception.
> >
> > Test server is running Ubuntu 18.4.3 and Squid 4.8.
> >
> > Documentation is either too much trim or extremely outdated.
> >
> > Any help would be very much appreciated.
> >
> >
> >
> > All best,
> >
> > K
>


From rousskov at measurement-factory.com  Mon Aug 29 17:18:24 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Mon, 29 Aug 2022 13:18:24 -0400
Subject: [squid-users] Squid 5.2 TCP_MISS_ABORTED/100 erros when
 uploading
In-Reply-To: <CAEJ1g5LYjh1ARKJXbQKm4GzBE5dZxqZLym3+g=MKkxpvOcq37w@mail.gmail.com>
References: <CAEJ1g5Kc0fdE82U+ede-wEfiyLRErxTPo2_BtpR1BzWY=72zig@mail.gmail.com>
 <654ad586-ff1a-35ff-5fb6-08272c5d8f0f@measurement-factory.com>
 <CAEJ1g5LYjh1ARKJXbQKm4GzBE5dZxqZLym3+g=MKkxpvOcq37w@mail.gmail.com>
Message-ID: <012e08ac-bf9d-2123-9f3f-8e9a1134e51a@measurement-factory.com>

On 8/29/22 12:17, David Ferreira wrote:

> I tried to capture the http trafic with the following tcpdump:
> 
> tcpdump -i any -nn port 80|grep -i http

I am not cool enough to easily grok this kind of output. Please share (a 
link to) the packet capture file instead (tcpdump -s0 -w filename ...).

Thank you,

Alex.


> Notes:
> - 1.2.3.4 is the webserver ip
> - 10.185.23.202 is the squid machine outbound interface
> 
> Here's the results:
> 
> Squid 4.15(Working one):
> 
> tcpdump -i any -nn port 80 |grep -i http
> dropped privs to tcpdump
> tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
> listening on any, link-type LINUX_SLL (Linux cooked v1), capture size 
> 262144 bytes
> 
> 17:06:29.784338 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [P.], seq 
> 1:626, ack 1, win 229, options [nop,nop,TS val 2986079115 ecr 
> 3365651782], length 625: HTTP: POST /webserver/index.php HTTP/1.1
> 17:06:29.820186 IP 1.2.3.4.80 > 10.185.23.202.37490: Flags [P.], seq 
> 1:26, ack 626, win 110, options [nop,nop,TS val 3365651818 ecr 
> 2986079115], length 25: HTTP: HTTP/1.1 100 Continue
> 17:06:29.820796 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 626:3522, ack 26, win 229, options [nop,nop,TS val 2986079151 ecr 
> 3365651818], length 2896: HTTP
> 17:06:29.820801 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [P.], seq 
> 3522:4722, ack 26, win 229, options [nop,nop,TS val 2986079151 ecr 
> 3365651818], length 1200: HTTP
> 17:06:29.820827 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [P.], seq 
> 4722:5006, ack 26, win 229, options [nop,nop,TS val 2986079151 ecr 
> 3365651818], length 284: HTTP
> 17:06:29.820880 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 5006:7902, ack 26, win 229, options [nop,nop,TS val 2986079151 ecr 
> 3365651818], length 2896: HTTP
> 17:06:29.820889 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [P.], seq 
> 7902:9102, ack 26, win 229, options [nop,nop,TS val 2986079151 ecr 
> 3365651818], length 1200: HTTP
> 17:06:29.820909 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [P.], seq 
> 9102:9386, ack 26, win 229, options [nop,nop,TS val 2986079151 ecr 
> 3365651818], length 284: HTTP
> 17:06:29.821001 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 9386:12282, ack 26, win 229, options [nop,nop,TS val 2986079151 ecr 
> 3365651818], length 2896: HTTP
> 17:06:29.856418 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 12282:15178, ack 26, win 229, options [nop,nop,TS val 2986079187 ecr 
> 3365651854], length 2896: HTTP
> 17:06:29.856437 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 15178:18074, ack 26, win 229, options [nop,nop,TS val 2986079187 ecr 
> 3365651854], length 2896: HTTP
> 17:06:29.856490 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 18074:20970, ack 26, win 229, options [nop,nop,TS val 2986079187 ecr 
> 3365651854], length 2896: HTTP
> 17:06:29.856495 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 20970:23866, ack 26, win 229, options [nop,nop,TS val 2986079187 ecr 
> 3365651854], length 2896: HTTP
> 17:06:29.856516 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 23866:25314, ack 26, win 229, options [nop,nop,TS val 2986079187 ecr 
> 3365651854], length 1448: HTTP
> 17:06:29.856521 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 25314:28210, ack 26, win 229, options [nop,nop,TS val 2986079187 ecr 
> 3365651854], length 2896: HTTP
> 17:06:29.856525 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 28210:31106, ack 26, win 229, options [nop,nop,TS val 2986079187 ecr 
> 3365651854], length 2896: HTTP
> 17:06:29.856607 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 31106:34002, ack 26, win 229, options [nop,nop,TS val 2986079187 ecr 
> 3365651854], length 2896: HTTP
> 17:06:29.856612 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 34002:36898, ack 26, win 229, options [nop,nop,TS val 2986079187 ecr 
> 3365651854], length 2896: HTTP
> 17:06:29.856634 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 36898:38346, ack 26, win 229, options [nop,nop,TS val 2986079187 ecr 
> 3365651854], length 1448: HTTP
> 17:06:29.856640 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 38346:41242, ack 26, win 229, options [nop,nop,TS val 2986079187 ecr 
> 3365651854], length 2896: HTTP
> 17:06:29.892036 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 41242:44138, ack 26, win 229, options [nop,nop,TS val 2986079222 ecr 
> 3365651890], length 2896: HTTP
> 17:06:29.892051 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 44138:47034, ack 26, win 229, options [nop,nop,TS val 2986079222 ecr 
> 3365651890], length 2896: HTTP
> 17:06:29.892123 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 47034:49930, ack 26, win 229, options [nop,nop,TS val 2986079222 ecr 
> 3365651890], length 2896: HTTP
> 17:06:29.892128 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 49930:52826, ack 26, win 229, options [nop,nop,TS val 2986079222 ecr 
> 3365651890], length 2896: HTTP
> 17:06:29.892150 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 52826:55722, ack 26, win 229, options [nop,nop,TS val 2986079222 ecr 
> 3365651890], length 2896: HTTP
> 17:06:29.892155 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 55722:58618, ack 26, win 229, options [nop,nop,TS val 2986079222 ecr 
> 3365651890], length 2896: HTTP
> 17:06:29.892181 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 58618:61514, ack 26, win 229, options [nop,nop,TS val 2986079222 ecr 
> 3365651890], length 2896: HTTP
> 17:06:29.892190 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 61514:64410, ack 26, win 229, options [nop,nop,TS val 2986079222 ecr 
> 3365651890], length 2896: HTTP
> 17:06:29.892243 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 64410:67306, ack 26, win 229, options [nop,nop,TS val 2986079222 ecr 
> 3365651890], length 2896: HTTP
> 17:06:29.892247 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 67306:68754, ack 26, win 229, options [nop,nop,TS val 2986079222 ecr 
> 3365651890], length 1448: HTTP
> 17:06:29.892252 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 68754:71650, ack 26, win 229, options [nop,nop,TS val 2986079222 ecr 
> 3365651890], length 2896: HTTP
> 17:06:29.892266 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 71650:74546, ack 26, win 229, options [nop,nop,TS val 2986079222 ecr 
> 3365651890], length 2896: HTTP
> 17:06:29.892286 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 74546:77442, ack 26, win 229, options [nop,nop,TS val 2986079223 ecr 
> 3365651890], length 2896: HTTP
> 17:06:29.892291 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 77442:80338, ack 26, win 229, options [nop,nop,TS val 2986079223 ecr 
> 3365651890], length 2896: HTTP
> 17:06:29.892310 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 80338:83234, ack 26, win 229, options [nop,nop,TS val 2986079223 ecr 
> 3365651890], length 2896: HTTP
> 17:06:29.892314 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 83234:86130, ack 26, win 229, options [nop,nop,TS val 2986079223 ecr 
> 3365651890], length 2896: HTTP
> 17:06:29.892334 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 86130:89026, ack 26, win 229, options [nop,nop,TS val 2986079223 ecr 
> 3365651890], length 2896: HTTP
> 17:06:29.892338 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 89026:91922, ack 26, win 229, options [nop,nop,TS val 2986079223 ecr 
> 3365651890], length 2896: HTTP
> 17:06:29.892358 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 91922:94818, ack 26, win 229, options [nop,nop,TS val 2986079223 ecr 
> 3365651890], length 2896: HTTP
> 17:06:29.892362 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 94818:97714, ack 26, win 229, options [nop,nop,TS val 2986079223 ecr 
> 3365651890], length 2896: HTTP
> 17:06:29.892381 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 97714:99162, ack 26, win 229, options [nop,nop,TS val 2986079223 ecr 
> 3365651890], length 1448: HTTP
> 17:06:29.927666 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 99162:102058, ack 26, win 229, options [nop,nop,TS val 2986079258 ecr 
> 3365651925], length 2896: HTTP
> 17:06:29.927675 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 102058:104954, ack 26, win 229, options [nop,nop,TS val 2986079258 ecr 
> 3365651925], length 2896: HTTP
> 17:06:29.927706 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 104954:107850, ack 26, win 229, options [nop,nop,TS val 2986079258 ecr 
> 3365651925], length 2896: HTTP
> 17:06:29.927772 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 107850:110746, ack 26, win 229, options [nop,nop,TS val 2986079258 ecr 
> 3365651925], length 2896: HTTP
> 17:06:29.927777 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 110746:113642, ack 26, win 229, options [nop,nop,TS val 2986079258 ecr 
> 3365651925], length 2896: HTTP
> 17:06:29.927797 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 113642:116538, ack 26, win 229, options [nop,nop,TS val 2986079258 ecr 
> 3365651926], length 2896: HTTP
> 17:06:29.927801 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 116538:119434, ack 26, win 229, options [nop,nop,TS val 2986079258 ecr 
> 3365651926], length 2896: HTTP
> 17:06:29.927820 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 119434:122330, ack 26, win 229, options [nop,nop,TS val 2986079258 ecr 
> 3365651926], length 2896: HTTP
> 17:06:29.927824 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 122330:125226, ack 26, win 229, options [nop,nop,TS val 2986079258 ecr 
> 3365651926], length 2896: HTTP
> 17:06:29.927844 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 125226:128122, ack 26, win 229, options [nop,nop,TS val 2986079258 ecr 
> 3365651926], length 2896: HTTP
> 17:06:29.927848 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 128122:131018, ack 26, win 229, options [nop,nop,TS val 2986079258 ecr 
> 3365651926], length 2896: HTTP
> 17:06:29.927876 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 131018:133914, ack 26, win 229, options [nop,nop,TS val 2986079258 ecr 
> 3365651926], length 2896: HTTP
> 17:06:29.927886 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 133914:136810, ack 26, win 229, options [nop,nop,TS val 2986079258 ecr 
> 3365651926], length 2896: HTTP
> 17:06:29.927902 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 136810:139706, ack 26, win 229, options [nop,nop,TS val 2986079258 ecr 
> 3365651926], length 2896: HTTP
> 17:06:29.927907 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 139706:144050, ack 26, win 229, options [nop,nop,TS val 2986079258 ecr 
> 3365651926], length 4344: HTTP
> 17:06:29.927925 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 144050:148394, ack 26, win 229, options [nop,nop,TS val 2986079258 ecr 
> 3365651926], length 4344: HTTP
> 17:06:29.927945 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 148394:152738, ack 26, win 229, options [nop,nop,TS val 2986079258 ecr 
> 3365651926], length 4344: HTTP
> 17:06:29.927949 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 152738:157082, ack 26, win 229, options [nop,nop,TS val 2986079258 ecr 
> 3365651926], length 4344: HTTP
> 17:06:29.927970 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 157082:161426, ack 26, win 229, options [nop,nop,TS val 2986079258 ecr 
> 3365651926], length 4344: HTTP
> 17:06:29.927975 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 161426:165770, ack 26, win 229, options [nop,nop,TS val 2986079258 ecr 
> 3365651926], length 4344: HTTP
> 17:06:29.927993 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 165770:170114, ack 26, win 229, options [nop,nop,TS val 2986079258 ecr 
> 3365651926], length 4344: HTTP
> 17:06:29.928018 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 170114:174458, ack 26, win 229, options [nop,nop,TS val 2986079258 ecr 
> 3365651926], length 4344: HTTP
> 17:06:29.928023 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 174458:180250, ack 26, win 229, options [nop,nop,TS val 2986079258 ecr 
> 3365651926], length 5792: HTTP
> 17:06:29.928027 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 180250:186042, ack 26, win 229, options [nop,nop,TS val 2986079258 ecr 
> 3365651926], length 5792: HTTP
> 17:06:29.928065 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 186042:191834, ack 26, win 229, options [nop,nop,TS val 2986079258 ecr 
> 3365651926], length 5792: HTTP
> 17:06:29.928069 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 191834:197626, ack 26, win 229, options [nop,nop,TS val 2986079258 ecr 
> 3365651926], length 5792: HTTP
> 17:06:29.928090 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 197626:203418, ack 26, win 229, options [nop,nop,TS val 2986079258 ecr 
> 3365651926], length 5792: HTTP
> 17:06:29.928095 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 203418:209210, ack 26, win 229, options [nop,nop,TS val 2986079258 ecr 
> 3365651926], length 5792: HTTP
> 17:06:29.928115 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 209210:215002, ack 26, win 229, options [nop,nop,TS val 2986079258 ecr 
> 3365651926], length 5792: HTTP
> 17:06:29.963296 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 215002:220794, ack 26, win 229, options [nop,nop,TS val 2986079294 ecr 
> 3365651961], length 5792: HTTP
> 17:06:29.963393 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 220794:226586, ack 26, win 229, options [nop,nop,TS val 2986079294 ecr 
> 3365651961], length 5792: HTTP
> 17:06:29.963399 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 226586:232378, ack 26, win 229, options [nop,nop,TS val 2986079294 ecr 
> 3365651961], length 5792: HTTP
> 17:06:29.963517 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 232378:238170, ack 26, win 229, options [nop,nop,TS val 2986079294 ecr 
> 3365651961], length 5792: HTTP
> 17:06:29.963532 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 238170:245410, ack 26, win 229, options [nop,nop,TS val 2986079294 ecr 
> 3365651961], length 7240: HTTP
> 17:06:29.963540 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 245410:252650, ack 26, win 229, options [nop,nop,TS val 2986079294 ecr 
> 3365651961], length 7240: HTTP
> 17:06:29.963880 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 252650:259890, ack 26, win 229, options [nop,nop,TS val 2986079294 ecr 
> 3365651961], length 7240: HTTP
> 17:06:29.963892 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 259890:267130, ack 26, win 229, options [nop,nop,TS val 2986079294 ecr 
> 3365651961], length 7240: HTTP
> 17:06:29.963942 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 267130:274370, ack 26, win 229, options [nop,nop,TS val 2986079294 ecr 
> 3365651962], length 7240: HTTP
> 17:06:29.963947 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 274370:280162, ack 26, win 229, options [nop,nop,TS val 2986079294 ecr 
> 3365651962], length 5792: HTTP
> 17:06:29.963955 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 280162:291746, ack 26, win 229, options [nop,nop,TS val 2986079294 ecr 
> 3365651962], length 11584: HTTP
> 17:06:29.963989 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 291746:303330, ack 26, win 229, options [nop,nop,TS val 2986079294 ecr 
> 3365651962], length 11584: HTTP
> 17:06:29.963999 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 303330:314914, ack 26, win 229, options [nop,nop,TS val 2986079294 ecr 
> 3365651962], length 11584: HTTP
> 17:06:29.964021 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 314914:326498, ack 26, win 229, options [nop,nop,TS val 2986079294 ecr 
> 3365651962], length 11584: HTTP
> 17:06:29.964035 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 326498:338082, ack 26, win 229, options [nop,nop,TS val 2986079294 ecr 
> 3365651962], length 11584: HTTP
> 17:06:29.964060 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 338082:345322, ack 26, win 229, options [nop,nop,TS val 2986079294 ecr 
> 3365651962], length 7240: HTTP
> 17:06:29.964067 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 345322:356906, ack 26, win 229, options [nop,nop,TS val 2986079294 ecr 
> 3365651962], length 11584: HTTP
> 17:06:29.964075 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 356906:368490, ack 26, win 229, options [nop,nop,TS val 2986079294 ecr 
> 3365651962], length 11584: HTTP
> 17:06:29.964110 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 368490:380074, ack 26, win 229, options [nop,nop,TS val 2986079294 ecr 
> 3365651962], length 11584: HTTP
> 17:06:29.964118 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 380074:391658, ack 26, win 229, options [nop,nop,TS val 2986079294 ecr 
> 3365651962], length 11584: HTTP
> 17:06:29.964139 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 391658:403242, ack 26, win 229, options [nop,nop,TS val 2986079294 ecr 
> 3365651962], length 11584: HTTP
> 17:06:29.964155 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 403242:410482, ack 26, win 229, options [nop,nop,TS val 2986079294 ecr 
> 3365651962], length 7240: HTTP
> 17:06:29.964161 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 410482:422066, ack 26, win 229, options [nop,nop,TS val 2986079294 ecr 
> 3365651962], length 11584: HTTP
> 17:06:29.964181 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 422066:433650, ack 26, win 229, options [nop,nop,TS val 2986079294 ecr 
> 3365651962], length 11584: HTTP
> 17:06:29.998905 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 433650:443786, ack 26, win 229, options [nop,nop,TS val 2986079329 ecr 
> 3365651997], length 10136: HTTP
> 17:06:29.999021 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 443786:455370, ack 26, win 229, options [nop,nop,TS val 2986079329 ecr 
> 3365651997], length 11584: HTTP
> 17:06:29.999031 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 455370:466954, ack 26, win 229, options [nop,nop,TS val 2986079329 ecr 
> 3365651997], length 11584: HTTP
> 17:06:29.999056 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 466954:475642, ack 26, win 229, options [nop,nop,TS val 2986079329 ecr 
> 3365651997], length 8688: HTTP
> 17:06:29.999137 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 475642:487226, ack 26, win 229, options [nop,nop,TS val 2986079329 ecr 
> 3365651997], length 11584: HTTP
> 17:06:29.999264 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 487226:500258, ack 26, win 229, options [nop,nop,TS val 2986079329 ecr 
> 3365651997], length 13032: HTTP
> 17:06:29.999272 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 500258:513290, ack 26, win 229, options [nop,nop,TS val 2986079329 ecr 
> 3365651997], length 13032: HTTP
> 17:06:29.999396 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 513290:521978, ack 26, win 229, options [nop,nop,TS val 2986079330 ecr 
> 3365651997], length 8688: HTTP
> 17:06:29.999507 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 521978:535010, ack 26, win 229, options [nop,nop,TS val 2986079330 ecr 
> 3365651997], length 13032: HTTP
> 17:06:29.999518 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 535010:540802, ack 26, win 229, options [nop,nop,TS val 2986079330 ecr 
> 3365651997], length 5792: HTTP
> 17:06:29.999631 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 540802:555282, ack 26, win 229, options [nop,nop,TS val 2986079330 ecr 
> 3365651997], length 14480: HTTP
> 17:06:29.999648 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 555282:569762, ack 26, win 229, options [nop,nop,TS val 2986079330 ecr 
> 3365651997], length 14480: HTTP
> 17:06:29.999656 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 569762:585690, ack 26, win 229, options [nop,nop,TS val 2986079330 ecr 
> 3365651997], length 15928: HTTP
> 17:06:29.999743 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 585690:601618, ack 26, win 229, options [nop,nop,TS val 2986079330 ecr 
> 3365651997], length 15928: HTTP
> 17:06:29.999752 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 601618:605962, ack 26, win 229, options [nop,nop,TS val 2986079330 ecr 
> 3365651997], length 4344: HTTP
> 17:06:29.999758 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 605962:621890, ack 26, win 229, options [nop,nop,TS val 2986079330 ecr 
> 3365651997], length 15928: HTTP
> 17:06:29.999780 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 621890:639266, ack 26, win 229, options [nop,nop,TS val 2986079330 ecr 
> 3365651997], length 17376: HTTP
> 17:06:29.999791 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 639266:656642, ack 26, win 229, options [nop,nop,TS val 2986079330 ecr 
> 3365651997], length 17376: HTTP
> 17:06:29.999874 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 656642:671122, ack 26, win 229, options [nop,nop,TS val 2986079330 ecr 
> 3365651998], length 14480: HTTP
> 17:06:29.999882 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 671122:689946, ack 26, win 229, options [nop,nop,TS val 2986079330 ecr 
> 3365651998], length 18824: HTTP
> 17:06:29.999889 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 689946:708770, ack 26, win 229, options [nop,nop,TS val 2986079330 ecr 
> 3365651998], length 18824: HTTP
> 17:06:29.999979 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 708770:727594, ack 26, win 229, options [nop,nop,TS val 2986079330 ecr 
> 3365651998], length 18824: HTTP
> 17:06:29.999989 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 727594:736282, ack 26, win 229, options [nop,nop,TS val 2986079330 ecr 
> 3365651998], length 8688: HTTP
> 17:06:30.000016 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 736282:758002, ack 26, win 229, options [nop,nop,TS val 2986079330 ecr 
> 3365651998], length 21720: HTTP
> 17:06:30.000027 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 758002:779722, ack 26, win 229, options [nop,nop,TS val 2986079330 ecr 
> 3365651998], length 21720: HTTP
> 17:06:30.000106 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 779722:801442, ack 26, win 229, options [nop,nop,TS val 2986079330 ecr 
> 3365651998], length 21720: HTTP
> 17:06:30.000224 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 801442:824610, ack 26, win 229, options [nop,nop,TS val 2986079330 ecr 
> 3365651998], length 23168: HTTP
> 17:06:30.000234 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 824610:847778, ack 26, win 229, options [nop,nop,TS val 2986079330 ecr 
> 3365651998], length 23168: HTTP
> 17:06:30.000263 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 847778:866602, ack 26, win 229, options [nop,nop,TS val 2986079330 ecr 
> 3365651998], length 18824: HTTP
> 17:06:30.000302 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 866602:883978, ack 26, win 229, options [nop,nop,TS val 2986079331 ecr 
> 3365651998], length 17376: HTTP
> 17:06:30.034540 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 883978:892666, ack 26, win 229, options [nop,nop,TS val 2986079365 ecr 
> 3365652032], length 8688: HTTP
> 17:06:30.034772 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 892666:917282, ack 26, win 229, options [nop,nop,TS val 2986079365 ecr 
> 3365652032], length 24616: HTTP
> 17:06:30.034790 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 917282:931762, ack 26, win 229, options [nop,nop,TS val 2986079365 ecr 
> 3365652032], length 14480: HTTP
> 17:06:30.034803 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 931762:957826, ack 26, win 229, options [nop,nop,TS val 2986079365 ecr 
> 3365652032], length 26064: HTTP
> 17:06:30.034835 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 957826:983890, ack 26, win 229, options [nop,nop,TS val 2986079365 ecr 
> 3365652033], length 26064: HTTP
> 17:06:30.034882 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 983890:996922, ack 26, win 229, options [nop,nop,TS val 2986079365 ecr 
> 3365652033], length 13032: HTTP
> 17:06:30.035003 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 996922:1024434, ack 26, win 229, options [nop,nop,TS val 2986079365 ecr 
> 3365652033], length 27512: HTTP
> 17:06:30.035033 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 1024434:1053394, ack 26, win 229, options [nop,nop,TS val 2986079365 ecr 
> 3365652033], length 28960: HTTP
> 17:06:30.035122 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 1053394:1062082, ack 26, win 229, options [nop,nop,TS val 2986079365 ecr 
> 3365652033], length 8688: HTTP
> 17:06:30.035243 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 1062082:1091042, ack 26, win 229, options [nop,nop,TS val 2986079365 ecr 
> 3365652033], length 28960: HTTP
> 17:06:30.035296 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 1091042:1095386, ack 26, win 229, options [nop,nop,TS val 2986079366 ecr 
> 3365652033], length 4344: HTTP
> 17:06:30.035373 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 1095386:1125794, ack 26, win 229, options [nop,nop,TS val 2986079366 ecr 
> 3365652033], length 30408: HTTP
> 17:06:30.035395 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 1125794:1127242, ack 26, win 229, options [nop,nop,TS val 2986079366 ecr 
> 3365652033], length 1448: HTTP
> 17:06:30.035409 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 1127242:1159098, ack 26, win 229, options [nop,nop,TS val 2986079366 ecr 
> 3365652033], length 31856: HTTP
> 17:06:30.035489 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 1159098:1190954, ack 26, win 229, options [nop,nop,TS val 2986079366 ecr 
> 3365652033], length 31856: HTTP
> 17:06:30.035496 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 1190954:1192402, ack 26, win 229, options [nop,nop,TS val 2986079366 ecr 
> 3365652033], length 1448: HTTP
> 17:06:30.035524 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 1192402:1225706, ack 26, win 229, options [nop,nop,TS val 2986079366 ecr 
> 3365652033], length 33304: HTTP
> 17:06:30.035608 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 1225706:1257562, ack 26, win 229, options [nop,nop,TS val 2986079366 ecr 
> 3365652033], length 31856: HTTP
> 17:06:30.035731 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 1257562:1292314, ack 26, win 229, options [nop,nop,TS val 2986079366 ecr 
> 3365652033], length 34752: HTTP
> 17:06:30.035744 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 1292314:1322722, ack 26, win 229, options [nop,nop,TS val 2986079366 ecr 
> 3365652033], length 30408: HTTP
> 17:06:30.035860 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 1322722:1360370, ack 26, win 229, options [nop,nop,TS val 2986079366 ecr 
> 3365652034], length 37648: HTTP
> 17:06:30.035875 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 1360370:1387882, ack 26, win 229, options [nop,nop,TS val 2986079366 ecr 
> 3365652034], length 27512: HTTP
> 17:06:30.036092 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 1387882:1426978, ack 26, win 229, options [nop,nop,TS val 2986079366 ecr 
> 3365652034], length 39096: HTTP
> 17:06:30.036112 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 1426978:1453042, ack 26, win 229, options [nop,nop,TS val 2986079366 ecr 
> 3365652034], length 26064: HTTP
> 17:06:30.036210 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 1453042:1493586, ack 26, win 229, options [nop,nop,TS val 2986079366 ecr 
> 3365652034], length 40544: HTTP
> 17:06:30.036226 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 1493586:1518202, ack 26, win 229, options [nop,nop,TS val 2986079366 ecr 
> 3365652034], length 24616: HTTP
> 17:06:30.036298 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 1518202:1544266, ack 26, win 229, options [nop,nop,TS val 2986079367 ecr 
> 3365652034], length 26064: HTTP
> 17:06:30.036348 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 1544266:1583362, ack 26, win 229, options [nop,nop,TS val 2986079367 ecr 
> 3365652034], length 39096: HTTP
> 17:06:30.036451 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 1583362:1628250, ack 26, win 229, options [nop,nop,TS val 2986079367 ecr 
> 3365652034], length 44888: HTTP
> 17:06:30.036500 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 1628250:1648522, ack 26, win 229, options [nop,nop,TS val 2986079367 ecr 
> 3365652034], length 20272: HTTP
> 17:06:30.036567 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 1648522:1693410, ack 26, win 229, options [nop,nop,TS val 2986079367 ecr 
> 3365652034], length 44888: HTTP
> 17:06:30.036584 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 1693410:1713682, ack 26, win 229, options [nop,nop,TS val 2986079367 ecr 
> 3365652034], length 20272: HTTP
> 17:06:30.036698 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 1713682:1761466, ack 26, win 229, options [nop,nop,TS val 2986079367 ecr 
> 3365652034], length 47784: HTTP
> 17:06:30.036748 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 1761466:1778842, ack 26, win 229, options [nop,nop,TS val 2986079367 ecr 
> 3365652034], length 17376: HTTP
> 17:06:30.036754 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 1778842:1784634, ack 26, win 229, options [nop,nop,TS val 2986079367 ecr 
> 3365652034], length 5792: HTTP
> 17:06:30.070180 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 1784634:1802010, ack 26, win 229, options [nop,nop,TS val 2986079400 ecr 
> 3365652068], length 17376: HTTP
> 17:06:30.070368 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 1802010:1813594, ack 26, win 229, options [nop,nop,TS val 2986079401 ecr 
> 3365652068], length 11584: HTTP
> 17:06:30.070497 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 1813594:1844002, ack 26, win 229, options [nop,nop,TS val 2986079401 ecr 
> 3365652068], length 30408: HTTP
> 17:06:30.070635 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 1844002:1896130, ack 26, win 229, options [nop,nop,TS val 2986079401 ecr 
> 3365652068], length 52128: HTTP
> 17:06:30.070673 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 1896130:1909162, ack 26, win 229, options [nop,nop,TS val 2986079401 ecr 
> 3365652068], length 13032: HTTP
> 17:06:30.070748 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 1909162:1962738, ack 26, win 229, options [nop,nop,TS val 2986079401 ecr 
> 3365652068], length 53576: HTTP
> 17:06:30.070851 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 1962738:1974322, ack 26, win 229, options [nop,nop,TS val 2986079401 ecr 
> 3365652069], length 11584: HTTP
> 17:06:30.070875 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 1974322:2029346, ack 26, win 229, options [nop,nop,TS val 2986079401 ecr 
> 3365652069], length 55024: HTTP
> 17:06:30.070969 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 2029346:2039482, ack 26, win 229, options [nop,nop,TS val 2986079401 ecr 
> 3365652069], length 10136: HTTP
> 17:06:30.071153 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 2039482:2095954, ack 26, win 229, options [nop,nop,TS val 2986079401 ecr 
> 3365652069], length 56472: HTTP
> 17:06:30.071175 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 2095954:2104642, ack 26, win 229, options [nop,nop,TS val 2986079401 ecr 
> 3365652069], length 8688: HTTP
> 17:06:30.071248 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 2104642:2162562, ack 26, win 229, options [nop,nop,TS val 2986079401 ecr 
> 3365652069], length 57920: HTTP
> 17:06:30.071261 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 2162562:2169802, ack 26, win 229, options [nop,nop,TS val 2986079401 ecr 
> 3365652069], length 7240: HTTP
> 17:06:30.071306 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 2169802:2195866, ack 26, win 229, options [nop,nop,TS val 2986079402 ecr 
> 3365652069], length 26064: HTTP
> 17:06:30.071354 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 2195866:2234962, ack 26, win 229, options [nop,nop,TS val 2986079402 ecr 
> 3365652069], length 39096: HTTP
> 17:06:30.071604 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 2234962:2297226, ack 26, win 229, options [nop,nop,TS val 2986079402 ecr 
> 3365652069], length 62264: HTTP
> 17:06:30.071624 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 2297226:2300122, ack 26, win 229, options [nop,nop,TS val 2986079402 ecr 
> 3365652069], length 2896: HTTP
> 17:06:30.071713 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 2300122:2363834, ack 26, win 229, options [nop,nop,TS val 2986079402 ecr 
> 3365652069], length 63712: HTTP
> 17:06:30.071724 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 2363834:2365282, ack 26, win 229, options [nop,nop,TS val 2986079402 ecr 
> 3365652069], length 1448: HTTP
> 17:06:30.071823 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 2365282:2430442, ack 26, win 229, options [nop,nop,TS val 2986079402 ecr 
> 3365652070], length 65160: HTTP
> 17:06:30.071950 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 2430442:2495602, ack 26, win 229, options [nop,nop,TS val 2986079402 ecr 
> 3365652070], length 65160: HTTP
> 17:06:30.072180 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 2495602:2560762, ack 26, win 229, options [nop,nop,TS val 2986079402 ecr 
> 3365652070], length 65160: HTTP
> 17:06:30.072310 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 2560762:2604202, ack 26, win 229, options [nop,nop,TS val 2986079403 ecr 
> 3365652070], length 43440: HTTP
> 17:06:30.072326 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 2604202:2625922, ack 26, win 229, options [nop,nop,TS val 2986079403 ecr 
> 3365652070], length 21720: HTTP
> 17:06:30.072424 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 2625922:2691082, ack 26, win 229, options [nop,nop,TS val 2986079403 ecr 
> 3365652070], length 65160: HTTP
> 17:06:30.072666 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 2691082:2756242, ack 26, win 229, options [nop,nop,TS val 2986079403 ecr 
> 3365652070], length 65160: HTTP
> 17:06:30.072797 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 2756242:2821402, ack 26, win 229, options [nop,nop,TS val 2986079403 ecr 
> 3365652070], length 65160: HTTP
> 17:06:30.072926 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 2821402:2886562, ack 26, win 229, options [nop,nop,TS val 2986079403 ecr 
> 3365652071], length 65160: HTTP
> 17:06:30.073023 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 2886562:2951722, ack 26, win 229, options [nop,nop,TS val 2986079403 ecr 
> 3365652071], length 65160: HTTP
> 17:06:30.073262 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 2951722:3016882, ack 26, win 229, options [nop,nop,TS val 2986079403 ecr 
> 3365652071], length 65160: HTTP
> 17:06:30.073379 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 3016882:3061770, ack 26, win 229, options [nop,nop,TS val 2986079404 ecr 
> 3365652071], length 44888: HTTP
> 17:06:30.073390 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 3061770:3082042, ack 26, win 229, options [nop,nop,TS val 2986079404 ecr 
> 3365652071], length 20272: HTTP
> 17:06:30.073504 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 3082042:3147202, ack 26, win 229, options [nop,nop,TS val 2986079404 ecr 
> 3365652071], length 65160: HTTP
> 17:06:30.073629 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 3147202:3212362, ack 26, win 229, options [nop,nop,TS val 2986079404 ecr 
> 3365652071], length 65160: HTTP
> 17:06:30.073751 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 3212362:3277522, ack 26, win 229, options [nop,nop,TS val 2986079404 ecr 
> 3365652071], length 65160: HTTP
> 17:06:30.073872 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 3277522:3342682, ack 26, win 229, options [nop,nop,TS val 2986079404 ecr 
> 3365652072], length 65160: HTTP
> 17:06:30.074054 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 3342682:3407842, ack 26, win 229, options [nop,nop,TS val 2986079404 ecr 
> 3365652072], length 65160: HTTP
> 17:06:30.074107 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 3407842:3473002, ack 26, win 229, options [nop,nop,TS val 2986079404 ecr 
> 3365652072], length 65160: HTTP
> 17:06:30.074226 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 3473002:3538162, ack 26, win 229, options [nop,nop,TS val 2986079404 ecr 
> 3365652072], length 65160: HTTP
> 17:06:30.074333 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 3538162:3556986, ack 26, win 229, options [nop,nop,TS val 2986079405 ecr 
> 3365652072], length 18824: HTTP
> 17:06:30.074347 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 3556986:3585946, ack 26, win 229, options [nop,nop,TS val 2986079405 ecr 
> 3365652072], length 28960: HTTP
> 17:06:30.105764 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 3585946:3591738, ack 26, win 229, options [nop,nop,TS val 2986079436 ecr 
> 3365652104], length 5792: HTTP
> 17:06:30.105873 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 3591738:3603322, ack 26, win 229, options [nop,nop,TS val 2986079436 ecr 
> 3365652104], length 11584: HTTP
> 17:06:30.106239 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 3603322:3668482, ack 26, win 229, options [nop,nop,TS val 2986079436 ecr 
> 3365652104], length 65160: HTTP
> 17:06:30.106363 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 3668482:3719162, ack 26, win 229, options [nop,nop,TS val 2986079437 ecr 
> 3365652104], length 50680: HTTP
> 17:06:30.106375 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 3719162:3733642, ack 26, win 229, options [nop,nop,TS val 2986079437 ecr 
> 3365652104], length 14480: HTTP
> 17:06:30.106487 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 3733642:3798802, ack 26, win 229, options [nop,nop,TS val 2986079437 ecr 
> 3365652104], length 65160: HTTP
> 17:06:30.106608 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 3798802:3863962, ack 26, win 229, options [nop,nop,TS val 2986079437 ecr 
> 3365652104], length 65160: HTTP
> 17:06:30.106737 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 3863962:3929122, ack 26, win 229, options [nop,nop,TS val 2986079437 ecr 
> 3365652104], length 65160: HTTP
> 17:06:30.106856 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 3929122:3994282, ack 26, win 229, options [nop,nop,TS val 2986079437 ecr 
> 3365652105], length 65160: HTTP
> 17:06:30.107092 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 3994282:4059442, ack 26, win 229, options [nop,nop,TS val 2986079437 ecr 
> 3365652105], length 65160: HTTP
> 17:06:30.107204 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 4059442:4124602, ack 26, win 229, options [nop,nop,TS val 2986079437 ecr 
> 3365652105], length 65160: HTTP
> 17:06:30.107319 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 4124602:4156458, ack 26, win 229, options [nop,nop,TS val 2986079438 ecr 
> 3365652105], length 31856: HTTP
> 17:06:30.107336 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 4156458:4189762, ack 26, win 229, options [nop,nop,TS val 2986079438 ecr 
> 3365652105], length 33304: HTTP
> 17:06:30.107449 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [.], seq 
> 4189762:4254922, ack 26, win 229, options [nop,nop,TS val 2986079438 ecr 
> 3365652105], length 65160: HTTP
> 17:06:30.107671 IP 10.185.23.202.37490 > 1.2.3.4.80: Flags [P.], seq 
> 4254922:4269395, ack 26, win 229, options [nop,nop,TS val 2986079438 ecr 
> 3365652105], length 14473: HTTP
> 17:06:30.956704 IP 1.2.3.4.80 > 10.185.23.202.37490: Flags [.], seq 
> 26:1474, ack 4269395, win 9881, options [nop,nop,TS val 3365652954 ecr 
> 2986079438], length 1448: HTTP: HTTP/1.1 200 OK
> 
> Squid 5.2:
> 
> tcpdump -i any -nn port 80 |grep -i http
> tcpdump: data link type LINUX_SLL2
> dropped privs to tcpdump
> tcpdump: verbose output suppressed, use -v[v]... for full protocol decode
> listening on any, link-type LINUX_SLL2 (Linux cooked v2), snapshot 
> length 262144 bytes
> 
> 16:37:18.523520 ens224 Out IP 10.185.23.202.56572 > 1.2.3.4.80: Flags 
> [P.], seq 1:625, ack 1, win 502, options [nop,nop,TS val 670563552 ecr 
> 3363900519], length 624: HTTP: POST /webserver/index.php HTTP/1.1
> 16:37:18.559373 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.56572: Flags 
> [P.], seq 1:26, ack 625, win 110, options [nop,nop,TS val 3363900556 ecr 
> 670563552], length 25: HTTP: HTTP/1.1 100 Continue
> 16:37:18.560439 ens224 Out IP 10.185.23.202.56572 > 1.2.3.4.80: Flags 
> [P.], seq 625:3521, ack 26, win 502, options [nop,nop,TS val 670563589 
> ecr 3363900556], length 2896: HTTP
> 16:37:18.560474 ens224 Out IP 10.185.23.202.56572 > 1.2.3.4.80: Flags 
> [P.], seq 3521:6417, ack 26, win 502, options [nop,nop,TS val 670563589 
> ecr 3363900556], length 2896: HTTP
> 16:37:18.560482 ens224 Out IP 10.185.23.202.56572 > 1.2.3.4.80: Flags 
> [P.], seq 6417:7640, ack 26, win 502, options [nop,nop,TS val 670563589 
> ecr 3363900556], length 1223: HTTP
> 16:37:18.560516 ens224 Out IP 10.185.23.202.56572 > 1.2.3.4.80: Flags 
> [P.], seq 7640:10536, ack 26, win 502, options [nop,nop,TS val 670563589 
> ecr 3363900556], length 2896: HTTP
> 16:37:18.560524 ens224 Out IP 10.185.23.202.56572 > 1.2.3.4.80: Flags 
> [P.], seq 10536:13432, ack 26, win 502, options [nop,nop,TS val 
> 670563589 ecr 3363900556], length 2896: HTTP
> 16:37:18.560552 ens224 Out IP 10.185.23.202.56572 > 1.2.3.4.80: Flags 
> [.], seq 13432:14880, ack 26, win 502, options [nop,nop,TS val 670563589 
> ecr 3363900556], length 1448: HTTP
> 16:37:18.596062 ens224 Out IP 10.185.23.202.56572 > 1.2.3.4.80: Flags 
> [P.], seq 14880:17776, ack 26, win 502, options [nop,nop,TS val 
> 670563624 ecr 3363900592], length 2896: HTTP
> 16:37:18.596084 ens224 Out IP 10.185.23.202.56572 > 1.2.3.4.80: Flags 
> [P.], seq 17776:20672, ack 26, win 502, options [nop,nop,TS val 
> 670563624 ecr 3363900592], length 2896: HTTP
> 16:37:18.596154 ens224 Out IP 10.185.23.202.56572 > 1.2.3.4.80: Flags 
> [P.], seq 20672:23568, ack 26, win 502, options [nop,nop,TS val 
> 670563624 ecr 3363900593], length 2896: HTTP
> 16:37:18.596159 ens224 Out IP 10.185.23.202.56572 > 1.2.3.4.80: Flags 
> [P.], seq 23568:26464, ack 26, win 502, options [nop,nop,TS val 
> 670563624 ecr 3363900593], length 2896: HTTP
> 16:37:18.596264 ens224 Out IP 10.185.23.202.56572 > 1.2.3.4.80: Flags 
> [.], seq 26464:27912, ack 26, win 502, options [nop,nop,TS val 670563624 
> ecr 3363900593], length 1448: HTTP
> 16:37:18.596271 ens224 Out IP 10.185.23.202.56572 > 1.2.3.4.80: Flags 
> [P.], seq 27912:30808, ack 26, win 502, options [nop,nop,TS val 
> 670563624 ecr 3363900593], length 2896: HTTP
> 16:37:18.596275 ens224 Out IP 10.185.23.202.56572 > 1.2.3.4.80: Flags 
> [P.], seq 30808:33704, ack 26, win 502, options [nop,nop,TS val 
> 670563624 ecr 3363900593], length 2896: HTTP
> 16:37:18.596321 ens224 Out IP 10.185.23.202.56572 > 1.2.3.4.80: Flags 
> [P.], seq 33704:36600, ack 26, win 502, options [nop,nop,TS val 
> 670563624 ecr 3363900593], length 2896: HTTP
> 16:37:18.596333 ens224 Out IP 10.185.23.202.56572 > 1.2.3.4.80: Flags 
> [P.], seq 36600:39496, ack 26, win 502, options [nop,nop,TS val 
> 670563624 ecr 3363900593], length 2896: HTTP
> 16:37:18.596349 ens224 Out IP 10.185.23.202.56572 > 1.2.3.4.80: Flags 
> [.], seq 39496:40944, ack 26, win 502, options [nop,nop,TS val 670563625 
> ecr 3363900593], length 1448: HTTP
> 16:37:18.631831 ens224 Out IP 10.185.23.202.56572 > 1.2.3.4.80: Flags 
> [P.], seq 40944:43840, ack 26, win 502, options [nop,nop,TS val 
> 670563660 ecr 3363900628], length 2896: HTTP
> 16:37:18.631848 ens224 Out IP 10.185.23.202.56572 > 1.2.3.4.80: Flags 
> [P.], seq 43840:46736, ack 26, win 502, options [nop,nop,TS val 
> 670563660 ecr 3363900628], length 2896: HTTP
> 16:37:18.631930 ens224 Out IP 10.185.23.202.56572 > 1.2.3.4.80: Flags 
> [P.], seq 46736:49632, ack 26, win 502, options [nop,nop,TS val 
> 670563660 ecr 3363900628], length 2896: HTTP
> 16:37:18.631950 ens224 Out IP 10.185.23.202.56572 > 1.2.3.4.80: Flags 
> [P.], seq 49632:52528, ack 26, win 502, options [nop,nop,TS val 
> 670563660 ecr 3363900628], length 2896: HTTP
> 16:37:18.631964 ens224 Out IP 10.185.23.202.56572 > 1.2.3.4.80: Flags 
> [P.], seq 52528:55424, ack 26, win 502, options [nop,nop,TS val 
> 670563660 ecr 3363900628], length 2896: HTTP
> 16:37:18.631976 ens224 Out IP 10.185.23.202.56572 > 1.2.3.4.80: Flags 
> [P.], seq 55424:58320, ack 26, win 502, options [nop,nop,TS val 
> 670563660 ecr 3363900628], length 2896: HTTP
> 16:37:18.632006 ens224 Out IP 10.185.23.202.56572 > 1.2.3.4.80: Flags 
> [.], seq 58320:59768, ack 26, win 502, options [nop,nop,TS val 670563660 
> ecr 3363900628], length 1448: HTTP
> 16:37:18.632012 ens224 Out IP 10.185.23.202.56572 > 1.2.3.4.80: Flags 
> [P.], seq 59768:62664, ack 26, win 502, options [nop,nop,TS val 
> 670563660 ecr 3363900628], length 2896: HTTP
> 16:37:18.632015 ens224 Out IP 10.185.23.202.56572 > 1.2.3.4.80: Flags 
> [P.], seq 62664:65560, ack 26, win 502, options [nop,nop,TS val 
> 670563660 ecr 3363900628], length 2896: HTTP
> 16:37:18.632042 ens224 Out IP 10.185.23.202.56572 > 1.2.3.4.80: Flags 
> [P.], seq 65560:68456, ack 26, win 502, options [nop,nop,TS val 
> 670563660 ecr 3363900628], length 2896: HTTP
> 16:37:18.632050 ens224 Out IP 10.185.23.202.56572 > 1.2.3.4.80: Flags 
> [P.], seq 68456:71352, ack 26, win 502, options [nop,nop,TS val 
> 670563660 ecr 3363900628], length 2896: HTTP
> 16:37:18.632072 ens224 Out IP 10.185.23.202.56572 > 1.2.3.4.80: Flags 
> [P.], seq 71352:74248, ack 26, win 502, options [nop,nop,TS val 
> 670563660 ecr 3363900628], length 2896: HTTP
> 16:37:18.632078 ens224 Out IP 10.185.23.202.56572 > 1.2.3.4.80: Flags 
> [P.], seq 74248:77144, ack 26, win 502, options [nop,nop,TS val 
> 670563660 ecr 3363900628], length 2896: HTTP
> 16:37:18.632098 ens224 Out IP 10.185.23.202.56572 > 1.2.3.4.80: Flags 
> [P.], seq 77144:80040, ack 26, win 502, options [nop,nop,TS val 
> 670563660 ecr 3363900628], length 2896: HTTP
> 16:37:18.632105 ens224 Out IP 10.185.23.202.56572 > 1.2.3.4.80: Flags 
> [P.], seq 80040:82936, ack 26, win 502, options [nop,nop,TS val 
> 670563660 ecr 3363900628], length 2896: HTTP
> 16:37:18.632126 ens224 Out IP 10.185.23.202.56572 > 1.2.3.4.80: Flags 
> [P.], seq 82936:85832, ack 26, win 502, options [nop,nop,TS val 
> 670563660 ecr 3363900628], length 2896: HTTP
> 16:37:18.632133 ens224 Out IP 10.185.23.202.56572 > 1.2.3.4.80: Flags 
> [P.], seq 85832:88728, ack 26, win 502, options [nop,nop,TS val 
> 670563660 ecr 3363900628], length 2896: HTTP
> 16:37:18.632153 ens224 Out IP 10.185.23.202.56572 > 1.2.3.4.80: Flags 
> [P.], seq 88728:91624, ack 26, win 502, options [nop,nop,TS val 
> 670563660 ecr 3363900628], length 2896: HTTP
> 16:37:18.667587 ens224 Out IP 10.185.23.202.56572 > 1.2.3.4.80: Flags 
> [P.], seq 91624:94520, ack 26, win 502, options [nop,nop,TS val 
> 670563696 ecr 3363900664], length 2896: HTTP
> 16:37:18.667605 ens224 Out IP 10.185.23.202.56572 > 1.2.3.4.80: Flags 
> [P.], seq 94520:97416, ack 26, win 502, options [nop,nop,TS val 
> 670563696 ecr 3363900664], length 2896: HTTP
> 16:37:18.667681 ens224 Out IP 10.185.23.202.56572 > 1.2.3.4.80: Flags 
> [P.], seq 97416:100312, ack 26, win 502, options [nop,nop,TS val 
> 670563696 ecr 3363900664], length 2896: HTTP
> 16:37:18.667692 ens224 Out IP 10.185.23.202.56572 > 1.2.3.4.80: Flags 
> [P.], seq 100312:103208, ack 26, win 502, options [nop,nop,TS val 
> 670563696 ecr 3363900664], length 2896: HTTP
> 16:37:18.667716 ens224 Out IP 10.185.23.202.56572 > 1.2.3.4.80: Flags 
> [P.], seq 103208:106104, ack 26, win 502, options [nop,nop,TS val 
> 670563696 ecr 3363900664], length 2896: HTTP
> 16:37:18.667722 ens224 Out IP 10.185.23.202.56572 > 1.2.3.4.80: Flags 
> [P.], seq 106104:110448, ack 26, win 502, options [nop,nop,TS val 
> 670563696 ecr 3363900664], length 4344: HTTP
> 16:37:18.667741 ens224 Out IP 10.185.23.202.56572 > 1.2.3.4.80: Flags 
> [P.], seq 110448:111896, ack 26, win 502, options [nop,nop,TS val 
> 670563696 ecr 3363900664], length 1448: HTTP
> 16:37:18.667748 ens224 Out IP 10.185.23.202.56572 > 1.2.3.4.80: Flags 
> [FP.], seq 111896:114340, ack 26, win 502, options [nop,nop,TS val 
> 670563696 ecr 3363900664], length 2444: HTTP
> 16:37:18.703502 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.56572: Flags 
> [P.], seq 26:81, ack 114341, win 557, options [nop,nop,TS val 3363900700 
> ecr 670563696], length 55: HTTP: HTTP/1.1 503 Service Unavailable.
> 16:37:24.675580 ens224 Out IP 10.185.23.202.49786 > 1.2.3.4.80: Flags 
> [P.], seq 1:620, ack 1, win 502, options [nop,nop,TS val 670569704 ecr 
> 3363906672], length 619: HTTP: POST /webserver/index.php HTTP/1.1
> 16:37:24.711626 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [P.], seq 1:26, ack 620, win 110, options [nop,nop,TS val 3363906708 ecr 
> 670569704], length 25: HTTP: HTTP/1.1 100 Continue
> 16:37:24.712318 ens224 Out IP 10.185.23.202.49786 > 1.2.3.4.80: Flags 
> [P.], seq 620:1740, ack 26, win 502, options [nop,nop,TS val 670569740 
> ecr 3363906708], length 1120: HTTP
> 16:37:24.939742 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 26:1474, ack 1740, win 119, options [nop,nop,TS val 3363906936 
> ecr 670569740], length 1448: HTTP: HTTP/1.1 200 OK
> 16:37:24.939852 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 1474:2922, ack 1740, win 119, options [nop,nop,TS val 
> 3363906936 ecr 670569740], length 1448: HTTP
> 16:37:24.939861 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 2922:4370, ack 1740, win 119, options [nop,nop,TS val 
> 3363906936 ecr 670569740], length 1448: HTTP
> 16:37:24.939875 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 4370:5818, ack 1740, win 119, options [nop,nop,TS val 
> 3363906936 ecr 670569740], length 1448: HTTP
> 16:37:24.939885 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 5818:7266, ack 1740, win 119, options [nop,nop,TS val 
> 3363906936 ecr 670569740], length 1448: HTTP
> 16:37:24.939895 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 7266:8714, ack 1740, win 119, options [nop,nop,TS val 
> 3363906936 ecr 670569740], length 1448: HTTP
> 16:37:24.939963 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 8714:10162, ack 1740, win 119, options [nop,nop,TS val 
> 3363906936 ecr 670569740], length 1448: HTTP
> 16:37:24.939972 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 10162:11610, ack 1740, win 119, options [nop,nop,TS val 
> 3363906936 ecr 670569740], length 1448: HTTP
> 16:37:24.939981 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 11610:13058, ack 1740, win 119, options [nop,nop,TS val 
> 3363906936 ecr 670569740], length 1448: HTTP
> 16:37:24.939990 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 13058:14506, ack 1740, win 119, options [nop,nop,TS val 
> 3363906936 ecr 670569740], length 1448: HTTP
> 16:37:24.975855 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 14506:15954, ack 1740, win 119, options [nop,nop,TS val 
> 3363906972 ecr 670569968], length 1448: HTTP
> 16:37:24.975899 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 15954:17402, ack 1740, win 119, options [nop,nop,TS val 
> 3363906972 ecr 670569968], length 1448: HTTP
> 16:37:24.975943 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 17402:18850, ack 1740, win 119, options [nop,nop,TS val 
> 3363906972 ecr 670569968], length 1448: HTTP
> 16:37:24.975946 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 18850:20298, ack 1740, win 119, options [nop,nop,TS val 
> 3363906972 ecr 670569968], length 1448: HTTP
> 16:37:24.975948 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 20298:21746, ack 1740, win 119, options [nop,nop,TS val 
> 3363906972 ecr 670569968], length 1448: HTTP
> 16:37:24.975949 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 21746:23194, ack 1740, win 119, options [nop,nop,TS val 
> 3363906972 ecr 670569968], length 1448: HTTP
> 16:37:24.976058 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 23194:24642, ack 1740, win 119, options [nop,nop,TS val 
> 3363906972 ecr 670569968], length 1448: HTTP
> 16:37:24.976063 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 24642:26090, ack 1740, win 119, options [nop,nop,TS val 
> 3363906972 ecr 670569968], length 1448: HTTP
> 16:37:24.976069 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 26090:27538, ack 1740, win 119, options [nop,nop,TS val 
> 3363906972 ecr 670569968], length 1448: HTTP
> 16:37:24.976072 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 27538:28986, ack 1740, win 119, options [nop,nop,TS val 
> 3363906972 ecr 670569968], length 1448: HTTP
> 16:37:24.976172 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 28986:30434, ack 1740, win 119, options [nop,nop,TS val 
> 3363906972 ecr 670569968], length 1448: HTTP
> 16:37:24.976190 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 30434:31882, ack 1740, win 119, options [nop,nop,TS val 
> 3363906972 ecr 670569968], length 1448: HTTP
> 16:37:24.976292 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 31882:33330, ack 1740, win 119, options [nop,nop,TS val 
> 3363906973 ecr 670569968], length 1448: HTTP
> 16:37:24.976301 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 33330:34778, ack 1740, win 119, options [nop,nop,TS val 
> 3363906973 ecr 670569968], length 1448: HTTP
> 16:37:24.976304 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 34778:36226, ack 1740, win 119, options [nop,nop,TS val 
> 3363906973 ecr 670569968], length 1448: HTTP
> 16:37:24.976306 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 36226:37674, ack 1740, win 119, options [nop,nop,TS val 
> 3363906973 ecr 670569968], length 1448: HTTP
> 16:37:24.976308 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 37674:39122, ack 1740, win 119, options [nop,nop,TS val 
> 3363906973 ecr 670569968], length 1448: HTTP
> 16:37:24.976412 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 39122:40570, ack 1740, win 119, options [nop,nop,TS val 
> 3363906973 ecr 670569968], length 1448: HTTP
> 16:37:24.976418 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [P.], seq 40570:42018, ack 1740, win 119, options [nop,nop,TS val 
> 3363906973 ecr 670569968], length 1448: HTTP
> 16:37:24.976421 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 42018:43466, ack 1740, win 119, options [nop,nop,TS val 
> 3363906973 ecr 670569968], length 1448: HTTP
> 16:37:25.011828 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 43466:44914, ack 1740, win 119, options [nop,nop,TS val 
> 3363907008 ecr 670570004], length 1448: HTTP
> 16:37:25.011864 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 44914:46362, ack 1740, win 119, options [nop,nop,TS val 
> 3363907008 ecr 670570004], length 1448: HTTP
> 16:37:25.011908 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 46362:47810, ack 1740, win 119, options [nop,nop,TS val 
> 3363907008 ecr 670570004], length 1448: HTTP
> 16:37:25.011911 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 47810:49258, ack 1740, win 119, options [nop,nop,TS val 
> 3363907008 ecr 670570004], length 1448: HTTP
> 16:37:25.012052 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 49258:50706, ack 1740, win 119, options [nop,nop,TS val 
> 3363907008 ecr 670570004], length 1448: HTTP
> 16:37:25.012069 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 50706:52154, ack 1740, win 119, options [nop,nop,TS val 
> 3363907008 ecr 670570004], length 1448: HTTP
> 16:37:25.012080 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 52154:53602, ack 1740, win 119, options [nop,nop,TS val 
> 3363907008 ecr 670570004], length 1448: HTTP
> 16:37:25.012091 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 53602:55050, ack 1740, win 119, options [nop,nop,TS val 
> 3363907008 ecr 670570004], length 1448: HTTP
> 16:37:25.012153 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 55050:56498, ack 1740, win 119, options [nop,nop,TS val 
> 3363907008 ecr 670570004], length 1448: HTTP
> 16:37:25.012164 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 56498:57946, ack 1740, win 119, options [nop,nop,TS val 
> 3363907008 ecr 670570004], length 1448: HTTP
> 16:37:25.012180 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 57946:59394, ack 1740, win 119, options [nop,nop,TS val 
> 3363907009 ecr 670570004], length 1448: HTTP
> 16:37:25.012189 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 59394:60842, ack 1740, win 119, options [nop,nop,TS val 
> 3363907009 ecr 670570004], length 1448: HTTP
> 16:37:25.012262 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 60842:62290, ack 1740, win 119, options [nop,nop,TS val 
> 3363907009 ecr 670570004], length 1448: HTTP
> 16:37:25.012275 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [P.], seq 62290:63738, ack 1740, win 119, options [nop,nop,TS val 
> 3363907009 ecr 670570004], length 1448: HTTP
> 16:37:25.012386 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 63738:65186, ack 1740, win 119, options [nop,nop,TS val 
> 3363907009 ecr 670570005], length 1448: HTTP
> 16:37:25.012403 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 65186:66634, ack 1740, win 119, options [nop,nop,TS val 
> 3363907009 ecr 670570005], length 1448: HTTP
> 16:37:25.012412 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 66634:68082, ack 1740, win 119, options [nop,nop,TS val 
> 3363907009 ecr 670570005], length 1448: HTTP
> 16:37:25.012421 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 68082:69530, ack 1740, win 119, options [nop,nop,TS val 
> 3363907009 ecr 670570005], length 1448: HTTP
> 16:37:25.012504 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 69530:70978, ack 1740, win 119, options [nop,nop,TS val 
> 3363907009 ecr 670570005], length 1448: HTTP
> 16:37:25.012519 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 70978:72426, ack 1740, win 119, options [nop,nop,TS val 
> 3363907009 ecr 670570005], length 1448: HTTP
> 16:37:25.012528 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 72426:73874, ack 1740, win 119, options [nop,nop,TS val 
> 3363907009 ecr 670570005], length 1448: HTTP
> 16:37:25.012538 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 73874:75322, ack 1740, win 119, options [nop,nop,TS val 
> 3363907009 ecr 670570005], length 1448: HTTP
> 16:37:25.012625 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 75322:76770, ack 1740, win 119, options [nop,nop,TS val 
> 3363907009 ecr 670570005], length 1448: HTTP
> 16:37:25.012639 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 76770:78218, ack 1740, win 119, options [nop,nop,TS val 
> 3363907009 ecr 670570005], length 1448: HTTP
> 16:37:25.012749 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 78218:79666, ack 1740, win 119, options [nop,nop,TS val 
> 3363907009 ecr 670570005], length 1448: HTTP
> 16:37:25.012763 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 79666:81114, ack 1740, win 119, options [nop,nop,TS val 
> 3363907009 ecr 670570005], length 1448: HTTP
> 16:37:25.012774 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 81114:82562, ack 1740, win 119, options [nop,nop,TS val 
> 3363907009 ecr 670570005], length 1448: HTTP
> 16:37:25.012783 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 82562:84010, ack 1740, win 119, options [nop,nop,TS val 
> 3363907009 ecr 670570005], length 1448: HTTP
> 16:37:25.012868 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 84010:85458, ack 1740, win 119, options [nop,nop,TS val 
> 3363907009 ecr 670570005], length 1448: HTTP
> 16:37:25.012881 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 85458:86906, ack 1740, win 119, options [nop,nop,TS val 
> 3363907009 ecr 670570005], length 1448: HTTP
> 16:37:25.012890 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 86906:88354, ack 1740, win 119, options [nop,nop,TS val 
> 3363907009 ecr 670570005], length 1448: HTTP
> 16:37:25.012901 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 88354:89802, ack 1740, win 119, options [nop,nop,TS val 
> 3363907009 ecr 670570005], length 1448: HTTP
> 16:37:25.012989 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 89802:91250, ack 1740, win 119, options [nop,nop,TS val 
> 3363907009 ecr 670570005], length 1448: HTTP
> 16:37:25.013003 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 91250:92698, ack 1740, win 119, options [nop,nop,TS val 
> 3363907009 ecr 670570005], length 1448: HTTP
> 16:37:25.013013 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 92698:94146, ack 1740, win 119, options [nop,nop,TS val 
> 3363907009 ecr 670570005], length 1448: HTTP
> 16:37:25.013022 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 94146:95594, ack 1740, win 119, options [nop,nop,TS val 
> 3363907009 ecr 670570005], length 1448: HTTP
> 16:37:25.013109 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 95594:97042, ack 1740, win 119, options [nop,nop,TS val 
> 3363907009 ecr 670570005], length 1448: HTTP
> 16:37:25.013122 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [P.], seq 97042:98490, ack 1740, win 119, options [nop,nop,TS val 
> 3363907009 ecr 670570005], length 1448: HTTP
> 16:37:25.013132 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 98490:99938, ack 1740, win 119, options [nop,nop,TS val 
> 3363907009 ecr 670570005], length 1448: HTTP
> 16:37:25.013140 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 99938:101386, ack 1740, win 119, options [nop,nop,TS val 
> 3363907009 ecr 670570005], length 1448: HTTP
> 16:37:25.048047 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 101386:102834, ack 1740, win 119, options [nop,nop,TS val 
> 3363907044 ecr 670570040], length 1448: HTTP
> 16:37:25.048154 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 102834:104282, ack 1740, win 119, options [nop,nop,TS val 
> 3363907044 ecr 670570040], length 1448: HTTP
> 16:37:25.048163 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 104282:105730, ack 1740, win 119, options [nop,nop,TS val 
> 3363907044 ecr 670570040], length 1448: HTTP
> 16:37:25.048171 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 105730:107178, ack 1740, win 119, options [nop,nop,TS val 
> 3363907044 ecr 670570040], length 1448: HTTP
> 16:37:25.048178 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 107178:108626, ack 1740, win 119, options [nop,nop,TS val 
> 3363907045 ecr 670570040], length 1448: HTTP
> 16:37:25.048184 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 108626:110074, ack 1740, win 119, options [nop,nop,TS val 
> 3363907045 ecr 670570040], length 1448: HTTP
> 16:37:25.048298 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 110074:111522, ack 1740, win 119, options [nop,nop,TS val 
> 3363907045 ecr 670570040], length 1448: HTTP
> 16:37:25.048306 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 111522:112970, ack 1740, win 119, options [nop,nop,TS val 
> 3363907045 ecr 670570040], length 1448: HTTP
> 16:37:25.048310 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 112970:114418, ack 1740, win 119, options [nop,nop,TS val 
> 3363907045 ecr 670570040], length 1448: HTTP
> 16:37:25.048318 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 114418:115866, ack 1740, win 119, options [nop,nop,TS val 
> 3363907045 ecr 670570040], length 1448: HTTP
> 16:37:25.048389 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 115866:117314, ack 1740, win 119, options [nop,nop,TS val 
> 3363907045 ecr 670570040], length 1448: HTTP
> 16:37:25.048405 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 117314:118762, ack 1740, win 119, options [nop,nop,TS val 
> 3363907045 ecr 670570040], length 1448: HTTP
> 16:37:25.048515 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 118762:120210, ack 1740, win 119, options [nop,nop,TS val 
> 3363907045 ecr 670570040], length 1448: HTTP
> 16:37:25.048525 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 120210:121658, ack 1740, win 119, options [nop,nop,TS val 
> 3363907045 ecr 670570040], length 1448: HTTP
> 16:37:25.048532 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 121658:123106, ack 1740, win 119, options [nop,nop,TS val 
> 3363907045 ecr 670570041], length 1448: HTTP
> 16:37:25.048536 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 123106:124554, ack 1740, win 119, options [nop,nop,TS val 
> 3363907045 ecr 670570041], length 1448: HTTP
> 16:37:25.048537 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 124554:126002, ack 1740, win 119, options [nop,nop,TS val 
> 3363907045 ecr 670570041], length 1448: HTTP
> 16:37:25.048632 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 126002:127450, ack 1740, win 119, options [nop,nop,TS val 
> 3363907045 ecr 670570041], length 1448: HTTP
> 16:37:25.048642 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 127450:128898, ack 1740, win 119, options [nop,nop,TS val 
> 3363907045 ecr 670570041], length 1448: HTTP
> 16:37:25.048649 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 128898:130346, ack 1740, win 119, options [nop,nop,TS val 
> 3363907045 ecr 670570041], length 1448: HTTP
> 16:37:25.048655 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 130346:131794, ack 1740, win 119, options [nop,nop,TS val 
> 3363907045 ecr 670570041], length 1448: HTTP
> 16:37:25.048661 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 131794:133242, ack 1740, win 119, options [nop,nop,TS val 
> 3363907045 ecr 670570041], length 1448: HTTP
> 16:37:25.048664 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 133242:134690, ack 1740, win 119, options [nop,nop,TS val 
> 3363907045 ecr 670570041], length 1448: HTTP
> 16:37:25.048749 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 134690:136138, ack 1740, win 119, options [nop,nop,TS val 
> 3363907045 ecr 670570041], length 1448: HTTP
> 16:37:25.048760 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 136138:137586, ack 1740, win 119, options [nop,nop,TS val 
> 3363907045 ecr 670570041], length 1448: HTTP
> 16:37:25.048767 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 137586:139034, ack 1740, win 119, options [nop,nop,TS val 
> 3363907045 ecr 670570041], length 1448: HTTP
> 16:37:25.048911 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [P.], seq 139034:140482, ack 1740, win 119, options [nop,nop,TS val 
> 3363907045 ecr 670570041], length 1448: HTTP
> 16:37:25.048920 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 140482:141930, ack 1740, win 119, options [nop,nop,TS val 
> 3363907045 ecr 670570041], length 1448: HTTP
> 16:37:25.048951 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 141930:143378, ack 1740, win 119, options [nop,nop,TS val 
> 3363907045 ecr 670570041], length 1448: HTTP
> 16:37:25.048960 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 143378:144826, ack 1740, win 119, options [nop,nop,TS val 
> 3363907045 ecr 670570041], length 1448: HTTP
> 16:37:25.048993 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [P.], seq 144826:146274, ack 1740, win 119, options [nop,nop,TS val 
> 3363907045 ecr 670570041], length 1448: HTTP
> 16:37:25.048999 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 146274:147722, ack 1740, win 119, options [nop,nop,TS val 
> 3363907045 ecr 670570041], length 1448: HTTP
> 16:37:25.049004 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 147722:149170, ack 1740, win 119, options [nop,nop,TS val 
> 3363907045 ecr 670570041], length 1448: HTTP
> 16:37:25.049010 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 149170:150618, ack 1740, win 119, options [nop,nop,TS val 
> 3363907045 ecr 670570041], length 1448: HTTP
> 16:37:25.049016 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 150618:152066, ack 1740, win 119, options [nop,nop,TS val 
> 3363907045 ecr 670570041], length 1448: HTTP
> 16:37:25.049018 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 152066:153514, ack 1740, win 119, options [nop,nop,TS val 
> 3363907045 ecr 670570041], length 1448: HTTP
> 16:37:25.049020 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 153514:154962, ack 1740, win 119, options [nop,nop,TS val 
> 3363907045 ecr 670570041], length 1448: HTTP
> 16:37:25.049021 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 154962:156410, ack 1740, win 119, options [nop,nop,TS val 
> 3363907045 ecr 670570041], length 1448: HTTP
> 16:37:25.049127 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 156410:157858, ack 1740, win 119, options [nop,nop,TS val 
> 3363907045 ecr 670570041], length 1448: HTTP
> 16:37:25.049137 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 157858:159306, ack 1740, win 119, options [nop,nop,TS val 
> 3363907045 ecr 670570041], length 1448: HTTP
> 16:37:25.049144 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 159306:160754, ack 1740, win 119, options [nop,nop,TS val 
> 3363907045 ecr 670570041], length 1448: HTTP
> 16:37:25.049150 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 160754:162202, ack 1740, win 119, options [nop,nop,TS val 
> 3363907045 ecr 670570041], length 1448: HTTP
> 16:37:25.049152 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 162202:163650, ack 1740, win 119, options [nop,nop,TS val 
> 3363907045 ecr 670570041], length 1448: HTTP
> 16:37:25.049155 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 163650:165098, ack 1740, win 119, options [nop,nop,TS val 
> 3363907045 ecr 670570041], length 1448: HTTP
> 16:37:25.049239 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 165098:166546, ack 1740, win 119, options [nop,nop,TS val 
> 3363907046 ecr 670570041], length 1448: HTTP
> 16:37:25.049249 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 166546:167994, ack 1740, win 119, options [nop,nop,TS val 
> 3363907046 ecr 670570041], length 1448: HTTP
> 16:37:25.049255 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 167994:169442, ack 1740, win 119, options [nop,nop,TS val 
> 3363907046 ecr 670570041], length 1448: HTTP
> 16:37:25.049258 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 169442:170890, ack 1740, win 119, options [nop,nop,TS val 
> 3363907046 ecr 670570041], length 1448: HTTP
> 16:37:25.049259 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 170890:172338, ack 1740, win 119, options [nop,nop,TS val 
> 3363907046 ecr 670570041], length 1448: HTTP
> 16:37:25.049261 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 172338:173786, ack 1740, win 119, options [nop,nop,TS val 
> 3363907046 ecr 670570041], length 1448: HTTP
> 16:37:25.049355 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 173786:175234, ack 1740, win 119, options [nop,nop,TS val 
> 3363907046 ecr 670570041], length 1448: HTTP
> 16:37:25.049365 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 175234:176682, ack 1740, win 119, options [nop,nop,TS val 
> 3363907046 ecr 670570041], length 1448: HTTP
> 16:37:25.049373 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 176682:178130, ack 1740, win 119, options [nop,nop,TS val 
> 3363907046 ecr 670570041], length 1448: HTTP
> 16:37:25.049377 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 178130:179578, ack 1740, win 119, options [nop,nop,TS val 
> 3363907046 ecr 670570041], length 1448: HTTP
> 16:37:25.049378 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 179578:181026, ack 1740, win 119, options [nop,nop,TS val 
> 3363907046 ecr 670570041], length 1448: HTTP
> 16:37:25.049473 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 181026:182474, ack 1740, win 119, options [nop,nop,TS val 
> 3363907046 ecr 670570041], length 1448: HTTP
> 16:37:25.049478 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 182474:183922, ack 1740, win 119, options [nop,nop,TS val 
> 3363907046 ecr 670570041], length 1448: HTTP
> 16:37:25.049480 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 183922:185370, ack 1740, win 119, options [nop,nop,TS val 
> 3363907046 ecr 670570041], length 1448: HTTP
> 16:37:25.049482 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 185370:186818, ack 1740, win 119, options [nop,nop,TS val 
> 3363907046 ecr 670570041], length 1448: HTTP
> 16:37:25.049594 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 186818:188266, ack 1740, win 119, options [nop,nop,TS val 
> 3363907046 ecr 670570041], length 1448: HTTP
> 16:37:25.049601 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 188266:189714, ack 1740, win 119, options [nop,nop,TS val 
> 3363907046 ecr 670570041], length 1448: HTTP
> 16:37:25.049605 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 189714:191162, ack 1740, win 119, options [nop,nop,TS val 
> 3363907046 ecr 670570041], length 1448: HTTP
> 16:37:25.049607 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 191162:192610, ack 1740, win 119, options [nop,nop,TS val 
> 3363907046 ecr 670570041], length 1448: HTTP
> 16:37:25.049609 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 192610:194058, ack 1740, win 119, options [nop,nop,TS val 
> 3363907046 ecr 670570041], length 1448: HTTP
> 16:37:25.049611 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 194058:195506, ack 1740, win 119, options [nop,nop,TS val 
> 3363907046 ecr 670570041], length 1448: HTTP
> 16:37:25.049724 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 195506:196954, ack 1740, win 119, options [nop,nop,TS val 
> 3363907046 ecr 670570041], length 1448: HTTP
> 16:37:25.049727 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 196954:198402, ack 1740, win 119, options [nop,nop,TS val 
> 3363907046 ecr 670570041], length 1448: HTTP
> 16:37:25.049729 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [P.], seq 198402:199850, ack 1740, win 119, options [nop,nop,TS val 
> 3363907046 ecr 670570041], length 1448: HTTP
> 16:37:25.049731 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 199850:201298, ack 1740, win 119, options [nop,nop,TS val 
> 3363907046 ecr 670570041], length 1448: HTTP
> 16:37:25.049734 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 201298:202746, ack 1740, win 119, options [nop,nop,TS val 
> 3363907046 ecr 670570041], length 1448: HTTP
> 16:37:25.049736 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 202746:204194, ack 1740, win 119, options [nop,nop,TS val 
> 3363907046 ecr 670570041], length 1448: HTTP
> 16:37:25.049840 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 204194:205642, ack 1740, win 119, options [nop,nop,TS val 
> 3363907046 ecr 670570041], length 1448: HTTP
> 16:37:25.049845 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 205642:207090, ack 1740, win 119, options [nop,nop,TS val 
> 3363907046 ecr 670570041], length 1448: HTTP
> 16:37:25.049847 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 207090:208538, ack 1740, win 119, options [nop,nop,TS val 
> 3363907046 ecr 670570041], length 1448: HTTP
> 16:37:25.049850 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 208538:209986, ack 1740, win 119, options [nop,nop,TS val 
> 3363907046 ecr 670570041], length 1448: HTTP
> 16:37:25.049851 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 209986:211434, ack 1740, win 119, options [nop,nop,TS val 
> 3363907046 ecr 670570041], length 1448: HTTP
> 16:37:25.049959 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 211434:212882, ack 1740, win 119, options [nop,nop,TS val 
> 3363907046 ecr 670570041], length 1448: HTTP
> 16:37:25.049969 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 212882:214330, ack 1740, win 119, options [nop,nop,TS val 
> 3363907046 ecr 670570041], length 1448: HTTP
> 16:37:25.049971 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 214330:215778, ack 1740, win 119, options [nop,nop,TS val 
> 3363907046 ecr 670570041], length 1448: HTTP
> 16:37:25.049974 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 215778:217226, ack 1740, win 119, options [nop,nop,TS val 
> 3363907046 ecr 670570041], length 1448: HTTP
> 16:37:25.083957 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 217226:218674, ack 1740, win 119, options [nop,nop,TS val 
> 3363907080 ecr 670570076], length 1448: HTTP
> 16:37:25.084068 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 218674:220122, ack 1740, win 119, options [nop,nop,TS val 
> 3363907080 ecr 670570076], length 1448: HTTP
> 16:37:25.087156 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 220122:221570, ack 1740, win 119, options [nop,nop,TS val 
> 3363907081 ecr 670570076], length 1448: HTTP
> 16:37:25.087170 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 221570:223018, ack 1740, win 119, options [nop,nop,TS val 
> 3363907081 ecr 670570076], length 1448: HTTP
> 16:37:25.087174 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 223018:224466, ack 1740, win 119, options [nop,nop,TS val 
> 3363907081 ecr 670570076], length 1448: HTTP
> 16:37:25.087177 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 224466:225914, ack 1740, win 119, options [nop,nop,TS val 
> 3363907081 ecr 670570076], length 1448: HTTP
> 16:37:25.087179 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 225914:227362, ack 1740, win 119, options [nop,nop,TS val 
> 3363907081 ecr 670570076], length 1448: HTTP
> 16:37:25.087181 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 227362:228810, ack 1740, win 119, options [nop,nop,TS val 
> 3363907081 ecr 670570076], length 1448: HTTP
> 16:37:25.087183 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 228810:230258, ack 1740, win 119, options [nop,nop,TS val 
> 3363907081 ecr 670570076], length 1448: HTTP
> 16:37:25.087190 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 230258:231706, ack 1740, win 119, options [nop,nop,TS val 
> 3363907081 ecr 670570076], length 1448: HTTP
> 16:37:25.087193 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 231706:233154, ack 1740, win 119, options [nop,nop,TS val 
> 3363907081 ecr 670570076], length 1448: HTTP
> 16:37:25.087195 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 233154:234602, ack 1740, win 119, options [nop,nop,TS val 
> 3363907081 ecr 670570076], length 1448: HTTP
> 16:37:25.087197 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 234602:236050, ack 1740, win 119, options [nop,nop,TS val 
> 3363907081 ecr 670570076], length 1448: HTTP
> 16:37:25.087199 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 236050:237498, ack 1740, win 119, options [nop,nop,TS val 
> 3363907081 ecr 670570076], length 1448: HTTP
> 16:37:25.087202 ens224 In ?IP 1.2.3.4.80 > 10.185.23.202.49786: Flags 
> [.], seq 237498:238946, ack 1740, win 119, options [nop,nop,TS val 
> 3363907081 ecr 670570076], length 1448: HTTP
> 
> ---
> Im not that familiar with tcpdump, if there's a better way to capture 
> please say so, im also gonna build a squid v5 to test it out.
> 
> Again, thanks for your time
> 
> 
> On Mon, 29 Aug 2022 at 13:52, Alex Rousskov 
> <rousskov at measurement-factory.com 
> <mailto:rousskov at measurement-factory.com>> wrote:
> 
>     On 8/29/22 06:17, David Ferreira wrote:
> 
>      > I have some squid's running on rocky linux 8 with verion 4.15,
>     recently
>      > been testing squid version 5.2(stable version that comes with
>     Rocky 9)to
>      > upgrade the current ones and most of the configs/acls seem to
>     work fine.
>      >
>      > Unfortualy theres an application that we use that everytime it
>     tries to
>      > upload files it fails on squid 5.2, on 4.15 is works completly
>     fine, so
>      > far ive test on squid 5.2 and 5.5 and it's the same behavior, im
>     testing
>      > this with default configurations and it always works on 4.15,
>     access log
>      > only shows this:
>      >
>      > Squid 4.15:
>      > 26/Aug/2022:15:36:08 +0100 ???273 172.19.222.132TCP_MISS/200 745
>     POST http://websiteurl/index.php <http://websiteurl/index.php> -
>     HIER_DIRECT/websitedomain text/xml
>      >
>      > Squid 5.2:
>      > 25/Aug/2022:15:10:00 +0100 ???139 172.19.222.132
>     TCP_MISS_ABORTED/100 0 POST http://websiteurl <http://websiteurl>
>     HIER_DIRECT/websitedomain -
>      >
>      > anyone has an ideia of what may be happening here?, been
>     searching about
>      > http errors 100 and so far i did not find anything that points me
>     to the
>      > problem.
>      >
>      > On the application side the error it shows when it tries to
>     upload is:
>      > "
>      > Error storing the document on the server
>      > Detail HTTP error 100
>      > Send failure: Connection was aborted (55)
>      > "
> 
>     Squid v5.2 has many serious bugs. I would not use it in production.
>     Build the latest Squid v5 from sources if you have to.
> 
> 
>     If the latest Squid v5 shows the same problem then this is probably a
>     client application or Squid bug/misconfiguration. There were quite a
>     few
>     changes in HTTP 1xx control message handling since Squid v4, and one of
>     those changes is probably affecting your client. For example, either
>     Squid v4 does not deliver that 100 control message to the client at all
>     or it is delivering a slightly different 100 control message that your
>     client is happy with.
>      ? If you share what HTTP messages are exchanged between client and
>     Squid
>     and between Squid and the origin server, in both successful and failing
>     use cases, we may be able to tell you more. I would use tcpdump,
>     wireshark, or a similar tool to collect HTTP traffic since these are
>     non-TLS transactions.
> 
> 
>     HTH,
> 
>     Alex.
>     _______________________________________________
>     squid-users mailing list
>     squid-users at lists.squid-cache.org
>     <mailto:squid-users at lists.squid-cache.org>
>     http://lists.squid-cache.org/listinfo/squid-users
>     <http://lists.squid-cache.org/listinfo/squid-users>
> 
> 
> 
> -- 
> Com os melhores cumprimentos,
> 
> David Ferreira



From ngtech1ltd at gmail.com  Mon Aug 29 17:29:01 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Mon, 29 Aug 2022 20:29:01 +0300
Subject: [squid-users] Squid 4.8+ intercept
In-Reply-To: <CAFMSmTs8r0rTAQt-G__7fOrBQfw2430S+Cm-dH9B22q6OVmACA@mail.gmail.com>
References: <CAFMSmTvEFMASCsodsZ43zdY_tEaKMJu2s_c8bCAKuyVd1i9yFg@mail.gmail.com>
 <CAFMSmTuUK_9UApWc76L91GDRm-tK-E+b=oLrUzF5Fitr-PZy3Q@mail.gmail.com>
 <000401d8ac90$62fcea80$28f6bf80$@gmail.com>
 <CAFMSmTt71mFhpanDVtKG0Gg6UA74ZAgpnBx5B__01K1Tmu5QLg@mail.gmail.com>
 <001401d8af3e$392663c0$ab732b40$@gmail.com>
 <CAFMSmTua4_eQ4iyY-zwCSkqYk+E1Rjd0CtzvxYi7vP_ty=pQAg@mail.gmail.com>
 <000001d8b30b$93a95570$bafc0050$@gmail.com>
 <CAFMSmTs8r0rTAQt-G__7fOrBQfw2430S+Cm-dH9B22q6OVmACA@mail.gmail.com>
Message-ID: <002b01d8bbcc$d4cbd400$7e637c00$@gmail.com>

Hey MK,

Can you send me the Mikrotik Supout.rif so I would be able to understand a bit more the Mikrotik level of things?
Also I will need the output of iptables-save instead of the rules you have sent.
You should also change the source of the REDIRECT rule only to the relevant clients and not anywhere since it will probably create a loop.

Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/

-----Original Message-----
From: M K <mohammed.khallaf at gmail.com> 
Sent: Monday, 29 August 2022 18:36
To: ngtech1ltd at gmail.com
Cc: squid-users at lists.squid-cache.org; Rafael Akchurin <rafael.akchurin at diladele.com>
Subject: Re: [squid-users] Squid 4.8+ intercept

iptables PREROUTING:
Chain PREROUTING (policy ACCEPT)
target     prot opt source               destination
ACCEPT     all  --  anywhere             anywhere             ADDRTYPE
match dst-type LOCAL
REDIRECT   tcp  --  anywhere             anywhere             tcp
dpt:http redir ports 3130
REDIRECT   tcp  --  anywhere             anywhere             tcp
dpt:https redir ports 3130
-------------------------
Mikrotik mangle:
add action=route chain=prerouting dst-port=80 passthrough=no
protocol=tcp route-dst={squid} src-address={client}
add action=route chain=prerouting connection-state="" dst-port=443
passthrough=no protocol=tcp route-dst={squid} src-address={client}
-------------------------
full squid.conf:
acl client src x.x.x.x/x

http_access allow client
http_access deny all

http_port 3128
https_port 3130 intercept ssl-bump cert=/xxx/xxx/xxx.pem
generate-host-certificates=on dynamic_cert_mem_cache_size=999MB

acl tls_connect at_step SslBump1
ssl_bump peek tls_connect
ssl_bump splice all
---------------------------
Firefox behavior...
HTTPS: ALL OK!

HTTP (http://google.com):

The connection was reset

The connection to the server was reset while the page was loading.

    The site could be temporarily unavailable or too busy. Try again
in a few moments.
    If you are unable to load any pages, check your computer?s network
connection.
    If your computer or network is protected by a firewall or proxy,
make sure that Firefox is permitted to access the Web.
---------------------------
Squid log:

HTTPS:
----------
1661786874.087   5981 {client} TCP_TUNNEL/200 152 CONNECT
js-sec.indexww.com:443 - ORIGINAL_DST/92.123.33.225 -
1661786874.087   5855 {client} TCP_TUNNEL/200 152 CONNECT
js-sec.indexww.com:443 - ORIGINAL_DST/92.123.33.225 -
1661786877.448  10391 {client} TCP_TUNNEL/200 1254 CONNECT
prg.smartadserver.com:443 - ORIGINAL_DST/185.86.138.32 -
1661786878.480      4 {client} NONE/200 0 CONNECT 64.74.236.255:443 -
HIER_NONE/- -
1661786886.125   7644 {client} TCP_TUNNEL/200 3850 CONNECT
mcdp-chidc2.outbrain.com:443 - ORIGINAL_DST/64.74.236.255 -
1661786886.916      5 {client} NONE/200 0 CONNECT 54.192.111.67:443 -
HIER_NONE/- -
1661786887.070      3 {client} NONE/200 0 CONNECT 34.98.75.36:443 -
HIER_NONE/- -
1661786887.275      0 {client} NONE_ABORTED/200 0 CONNECT
88.221.111.34:80 - HIER_NONE/- -
1661786887.548      4 {client} NONE/200 0 CONNECT 54.192.111.44:443 -
HIER_NONE/- -
1661786888.550 147502 {client} TCP_TUNNEL/200 8554 CONNECT
cdn.cnn.com:443 - ORIGINAL_DST/2.23.52.55 -
1661786888.718      1 {client} NONE/200 0 CONNECT 185.86.138.32:443 -
HIER_NONE/- -
1661786889.510 143920 {client} TCP_TUNNEL/200 9655 CONNECT
aax-eu.amazon-adsystem.com:443 - ORIGINAL_DST/52.95.125.22 -
1661786889.510 116428 {client} TCP_TUNNEL/200 6386 CONNECT
segment-data-us-east.zqtk.net:443 - ORIGINAL_DST/52.72.26.11 -
1661786889.609      6 {client} NONE/200 0 CONNECT 92.123.33.225:443 -
HIER_NONE/- -
1661786890.379 149287 {client} TCP_TUNNEL/200 444896 CONNECT
lightning.cnn.com:443 - ORIGINAL_DST/2.23.52.55 -
1661786892.987      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786892.992      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786892.998      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.003      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.009      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.014      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.019      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.024      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.029      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.034      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.044      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.048      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.053      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.057      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.062      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.067      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.072      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.078      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.082      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.087      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.093      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.098      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.102      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.107      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.112      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.116      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.120      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.125      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.129      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.134      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.140      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.144      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.148      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.152      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.156      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.160      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.165      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.170      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.174      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.178      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.184      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.188      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.192      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.196      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.200      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.204      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.208      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.213      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.217      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.221      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.227      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.231      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.236      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.240      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.243      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.247      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.251      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.255      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.260      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786893.264      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786894.773   5163 {client} TCP_TUNNEL/200 152 CONNECT
js-sec.indexww.com:443 - ORIGINAL_DST/92.123.33.225 -
1661786899.041  10322 {client} TCP_TUNNEL/200 1254 CONNECT
prg.smartadserver.com:443 - ORIGINAL_DST/185.86.138.32 -
1661786899.111 125320 {client} TCP_TUNNEL/200 27104 CONNECT
images.outbrainimg.com:443 - ORIGINAL_DST/92.123.32.26 -
1661786899.314 152898 {client} TCP_TUNNEL/200 285438 CONNECT
widgets.outbrain.com:443 - ORIGINAL_DST/92.123.34.112 -
1661786899.484  98933 {client} TCP_TUNNEL/200 6583 CONNECT
s.amazon-adsystem.com:443 - ORIGINAL_DST/209.54.182.161 -
1661786902.387      3 {client} NONE/200 0 CONNECT 64.74.236.255:443 -
HIER_NONE/- -
1661786903.220      3 {client} NONE/200 0 CONNECT 142.251.37.170:443 -
HIER_NONE/- -
1661786903.361      3 {client} NONE/200 0 CONNECT 92.123.33.225:443 -
HIER_NONE/- -
1661786903.390    169 {client} TCP_TUNNEL/200 1868 CONNECT
safebrowsing.googleapis.com:443 - ORIGINAL_DST/142.251.37.170 -
1661786903.430      2 {client} NONE/200 0 CONNECT 3.217.56.194:443 -
HIER_NONE/- -
1661786903.462      1 {client} NONE/200 0 CONNECT 178.32.210.226:443 -
HIER_NONE/- -
1661786904.650 104106 {client} TCP_TUNNEL/200 4310 CONNECT
pixel-eu.rubiconproject.com:443 - ORIGINAL_DST/69.173.144.165 -
1661786905.983      3 {client} NONE/200 0 CONNECT 64.202.112.127:443 -
HIER_NONE/- -
1661786905.992   2561 {client} TCP_TUNNEL/200 5831 CONNECT
logx.optimizely.com:443 - ORIGINAL_DST/3.217.56.194 -
1661786906.105    121 {client} TCP_TUNNEL/200 0 CONNECT
tr.outbrain.com:443 - ORIGINAL_DST/64.202.112.127 -
1661786906.354      2 {client} NONE/200 0 CONNECT 2.23.52.55:443 - HIER_NONE/- -
1661786906.358      1 {client} NONE/200 0 CONNECT 2.23.52.55:443 - HIER_NONE/- -
1661786906.364      1 {client} NONE/200 0 CONNECT 92.123.34.112:443 -
HIER_NONE/- -
1661786906.620      1 {client} NONE/200 0 CONNECT 146.75.56.64:443 -
HIER_NONE/- -
1661786906.767      3 {client} NONE/200 0 CONNECT 3.217.56.194:443 -
HIER_NONE/- -
1661786907.001      2 {client} NONE/200 0 CONNECT 151.101.1.195:443 -
HIER_NONE/- -
1661786907.494      2 {client} NONE/200 0 CONNECT 54.93.141.29:443 -
HIER_NONE/- -
1661786907.596      2 {client} NONE/200 0 CONNECT 142.251.37.48:443 -
HIER_NONE/- -
1661786907.777      2 {client} NONE/200 0 CONNECT 92.122.218.83:443 -
HIER_NONE/- -
1661786907.913      2 {client} NONE/200 0 CONNECT 54.231.203.49:443 -
HIER_NONE/- -
1661786907.914      4 {client} NONE/200 0 CONNECT 54.231.203.49:443 -
HIER_NONE/- -
1661786907.916      6 {client} NONE/200 0 CONNECT 54.231.203.49:443 -
HIER_NONE/- -
1661786907.919      7 {client} NONE/200 0 CONNECT 18.161.111.80:443 -
HIER_NONE/- -
1661786908.008      1 {client} NONE/200 0 CONNECT 91.228.74.208:443 -
HIER_NONE/- -
1661786908.012      5 {client} NONE/200 0 CONNECT 64.202.112.127:443 -
HIER_NONE/- -
1661786908.135      0 {client} NONE_ABORTED/200 0 CONNECT
216.58.212.99:80 - HIER_NONE/- -
1661786908.305      3 {client} NONE/200 0 CONNECT 92.123.34.112:443 -
HIER_NONE/- -
1661786908.393   5031 {client} TCP_TUNNEL/200 152 CONNECT
js-sec.indexww.com:443 - ORIGINAL_DST/92.123.33.225 -
1661786908.393 172182 {client} TCP_TUNNEL/200 8323 CONNECT
www.google.com:443 - ORIGINAL_DST/142.250.200.196 -
1661786908.561      0 {client} NONE_ABORTED/200 0 CONNECT
18.161.108.38:80 - HIER_NONE/- -
1661786908.562      0 {client} NONE_ABORTED/200 0 CONNECT
18.161.108.38:80 - HIER_NONE/- -
1661786908.562      0 {client} NONE_ABORTED/200 0 CONNECT
18.161.108.38:80 - HIER_NONE/- -
1661786909.615      2 {client} NONE/200 0 CONNECT 104.108.78.219:443 -
HIER_NONE/- -
1661786909.620      2 {client} NONE/200 0 CONNECT 54.147.61.21:443 -
HIER_NONE/- -
1661786909.685      3 {client} NONE/200 0 CONNECT 13.36.218.177:443 -
HIER_NONE/- -
1661786910.704      5 {client} NONE/200 0 CONNECT 3.229.71.121:443 -
HIER_NONE/- -
1661786910.820      1 {client} NONE/200 0 CONNECT 94.237.48.66:443 -
HIER_NONE/- -
1661786910.981    161 {client} TCP_TUNNEL/200 5583 CONNECT
v8-emea.sdk.beemray.com:443 - ORIGINAL_DST/94.237.48.66 -
1661786910.985      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786910.993      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786910.999      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.003      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.012      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.020      2 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.024      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.030      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.034      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.040      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.151      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.156      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.162      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.167      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.172      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.177      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.182      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.187      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.192      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.197      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.204      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.208      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.212      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.215      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.219      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.223      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.227      1 {client} NONE/200 0 CONNECT 52.72.26.11:443 -
HIER_NONE/- -
1661786911.229      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.233      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.237      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.242      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.250      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.254      1 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.258      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.262      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.267      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.272      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786911.392   5027 {client} TCP_TUNNEL/200 152 CONNECT
amplify.outbrain.com:443 - ORIGINAL_DST/92.123.34.112 -
1661786911.398      2 {client} NONE/200 0 CONNECT 52.95.126.160:443 -
HIER_NONE/- -
1661786911.526      5 {client} NONE/200 0 CONNECT 34.246.41.28:443 -
HIER_NONE/- -
1661786911.530      1 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786912.393 170550 {client} TCP_TUNNEL/200 18491 CONNECT
get.s-onetag.com:443 - ORIGINAL_DST/18.161.111.16 -
1661786912.393 170968 {client} TCP_TUNNEL/200 5658 CONNECT
cdn.jsdelivr.net:443 - ORIGINAL_DST/104.16.88.20 -
1661786912.622      3 {client} NONE/200 0 CONNECT 172.217.18.33:443 -
HIER_NONE/- -
1661786912.733   5239 {client} TCP_TUNNEL/200 6889 CONNECT
mms.cnn.com:443 - ORIGINAL_DST/54.93.141.29 -
1661786912.772    150 {client} TCP_TUNNEL/200 5179 CONNECT
4669ca4556421dd764fce36af596f212.safeframe.googlesyndication.com:443 -
ORIGINAL_DST/172.217.18.33 -
1661786913.104 112542 {client} TCP_TUNNEL/200 4310 CONNECT
pixel.rubiconproject.com:443 - ORIGINAL_DST/69.173.144.138 -
1661786913.383      2 {client} NONE/200 0 CONNECT 54.93.141.29:443 -
HIER_NONE/- -
1661786913.394   5475 {client} TCP_TUNNEL/200 371 CONNECT
cdn.boomtrain.com:443 - ORIGINAL_DST/18.161.111.80 -
1661786913.395 170794 {client} TCP_TUNNEL/200 16461 CONNECT
signal-beacon.s-onetag.com:443 - ORIGINAL_DST/54.192.111.35 -
1661786913.395 170901 {client} TCP_TUNNEL/200 7241 CONNECT
onetag-geo.s-onetag.com:443 - ORIGINAL_DST/18.161.97.41 -
1661786913.396 173362 {client} TCP_TUNNEL/200 8454 CONNECT
www.cnn.com:443 - ORIGINAL_DST/146.75.59.5 -
1661786913.464      2 {client} NONE/200 0 CONNECT 18.193.134.248:443 -
HIER_NONE/- -
1661786913.859  10397 {client} TCP_TUNNEL/200 5083 CONNECT
prg.smartadserver.com:443 - ORIGINAL_DST/178.32.210.226 -
1661786914.884   6971 {client} TCP_TUNNEL/200 131386 CONNECT
advsync.s3.amazonaws.com:443 - ORIGINAL_DST/54.231.203.49 -
1661786915.017   7103 {client} TCP_TUNNEL/200 130794 CONNECT
advsync.s3.amazonaws.com:443 - ORIGINAL_DST/54.231.203.49 -
1661786915.025   7108 {client} TCP_TUNNEL/200 132142 CONNECT
advsync.s3.amazonaws.com:443 - ORIGINAL_DST/54.231.203.49 -
1661786915.396 174730 {client} TCP_TUNNEL/200 102282 CONNECT
cdn.cookielaw.org:443 - ORIGINAL_DST/104.16.148.64 -
1661786915.523   7511 {client} TCP_TUNNEL/200 3798 CONNECT
tr.outbrain.com:443 - ORIGINAL_DST/64.202.112.127 -
1661786916.252      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786916.257      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786916.262      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786916.266      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786916.271      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786916.275      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786916.280      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786916.286      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786916.290      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786916.294      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786916.302      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786916.307      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786916.311      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786916.315      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786916.319      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786916.324      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786916.328      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786916.333      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786916.337      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786916.341      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786916.397 116628 {client} TCP_TUNNEL/200 15014 CONNECT
eus.rubiconproject.com:443 - ORIGINAL_DST/104.125.24.254 -
1661786916.397 170897 {client} TCP_TUNNEL/200 6473 CONNECT
www.ugdturner.com:443 - ORIGINAL_DST/34.237.36.10 -
1661786916.398 170966 {client} TCP_TUNNEL/200 4198 CONNECT
warnermediagroup-com.videoplayerhub.com:443 - ORIGINAL_DST/104.26.9.50
-
1661786917.171  14783 {client} TCP_TUNNEL/200 4492 CONNECT
mcdp-chidc2.outbrain.com:443 - ORIGINAL_DST/64.74.236.255 -
1661786917.399 170571 {client} TCP_TUNNEL/200 6635 CONNECT
securepubads.g.doubleclick.net:443 - ORIGINAL_DST/142.251.37.162 -
1661786917.400 170992 {client} TCP_TUNNEL/200 13115 CONNECT
static.adsafeprotected.com:443 - ORIGINAL_DST/54.192.111.91 -
1661786918.630   5165 {client} TCP_TUNNEL/200 570 CONNECT
www.summerhamster.com:443 - ORIGINAL_DST/18.193.134.248 -
1661786918.718   5335 {client} TCP_TUNNEL/200 8722 CONNECT
mms.cnn.com:443 - ORIGINAL_DST/54.93.141.29 -
1661786919.561 120339 {client} TCP_TUNNEL/200 4961 CONNECT
secure-assets.rubiconproject.com:443 - ORIGINAL_DST/2.17.80.55 -
1661786920.402 173997 {client} TCP_TUNNEL/200 38769 CONNECT
static.chartbeat.com:443 - ORIGINAL_DST/18.161.105.235 -
1661786920.669 174219 {client} TCP_TUNNEL/200 81160 CONNECT
ads.pubmatic.com:443 - ORIGINAL_DST/92.123.33.150 -
1661786921.369 145142 {client} TCP_TUNNEL/200 521393 CONNECT
player.aniview.com:443 - ORIGINAL_DST/92.123.34.136 -

HTTP:
--------
1661786959.922      4 {client} NONE/200 0 CONNECT 142.250.200.196:443
- HIER_NONE/- -
1661786959.987     64 {client} TCP_TUNNEL/200 0 CONNECT
www.google.com:443 - ORIGINAL_DST/142.250.200.196 -
1661786960.061      4 {client} NONE/200 0 CONNECT 142.250.200.196:443
- HIER_NONE/- -
1661786960.177      0 {client} NONE_ABORTED/200 0 CONNECT
216.58.212.99:80 - HIER_NONE/- -
1661786968.308      4 {client} NONE_ABORTED/200 0 CONNECT
151.101.3.5:80 - HIER_NONE/- -
1661786968.317      1 {client} NONE_ABORTED/200 0 CONNECT
151.101.3.5:80 - HIER_NONE/- -
1661786968.337      1 {client} NONE_ABORTED/200 0 CONNECT
151.101.3.5:80 - HIER_NONE/- -
1661786968.344      0 {client} NONE_ABORTED/200 0 CONNECT
151.101.3.5:80 - HIER_NONE/- -
1661786968.348      0 {client} NONE_ABORTED/200 0 CONNECT
151.101.3.5:80 - HIER_NONE/- -
1661786968.352      0 {client} NONE_ABORTED/200 0 CONNECT
151.101.3.5:80 - HIER_NONE/- -
1661786968.360      0 {client} NONE_ABORTED/200 0 CONNECT
151.101.3.5:80 - HIER_NONE/- -
1661786968.364      0 {client} NONE_ABORTED/200 0 CONNECT
151.101.3.5:80 - HIER_NONE/- -
1661786968.367      0 {client} NONE_ABORTED/200 0 CONNECT
151.101.3.5:80 - HIER_NONE/- -
1661786968.371      0 {client} NONE_ABORTED/200 0 CONNECT
151.101.3.5:80 - HIER_NONE/- -
1661786971.049      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.053      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.057      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.060      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.064      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.068      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.072      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.076      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.080      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.084      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.093      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.098      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.102      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.105      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.110      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.113      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.117      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.121      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.125      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.128      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.134      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.138      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.142      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.146      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.150      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.154      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.158      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.162      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.166      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.171      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.179      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.183      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.186      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.191      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.194      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.199      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.202      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.206      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.210      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.214      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.220      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.224      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.228      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.231      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.235      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.239      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.244      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.248      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.252      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.256      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.262      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.266      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.270      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.273      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.277      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.281      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.285      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.289      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.292      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786971.296      0 {client} NONE_ABORTED/200 0 CONNECT
34.107.221.82:80 - HIER_NONE/- -
1661786975.433      0 {client} NONE_ABORTED/200 0 CONNECT
151.101.3.5:80 - HIER_NONE/- -
1661786975.447      0 {client} NONE_ABORTED/200 0 CONNECT
151.101.3.5:80 - HIER_NONE/- -
1661786975.453      0 {client} NONE_ABORTED/200 0 CONNECT
151.101.3.5:80 - HIER_NONE/- -
1661786975.460      0 {client} NONE_ABORTED/200 0 CONNECT
151.101.3.5:80 - HIER_NONE/- -
1661786975.464      0 {client} NONE_ABORTED/200 0 CONNECT
151.101.3.5:80 - HIER_NONE/- -
1661786975.471      3 {client} NONE_ABORTED/200 0 CONNECT
151.101.3.5:80 - HIER_NONE/- -
1661786975.475      0 {client} NONE_ABORTED/200 0 CONNECT
151.101.3.5:80 - HIER_NONE/- -
1661786975.480      0 {client} NONE_ABORTED/200 0 CONNECT
151.101.3.5:80 - HIER_NONE/- -
1661786975.486      0 {client} NONE_ABORTED/200 0 CONNECT
151.101.3.5:80 - HIER_NONE/- -
1661786975.491      0 {client} NONE_ABORTED/200 0 CONNECT
151.101.3.5:80 - HIER_NONE/- -
1661786987.518      0 {client} NONE_ABORTED/200 0 CONNECT
172.217.18.238:80 - HIER_NONE/- -
1661786987.527      8 {client} NONE_ABORTED/200 0 CONNECT
172.217.18.238:80 - HIER_NONE/- -
1661786987.531      0 {client} NONE_ABORTED/200 0 CONNECT
172.217.18.238:80 - HIER_NONE/- -
1661786987.540      0 {client} NONE_ABORTED/200 0 CONNECT
172.217.18.238:80 - HIER_NONE/- -
1661786987.544      0 {client} NONE_ABORTED/200 0 CONNECT
172.217.18.238:80 - HIER_NONE/- -
1661786987.548      0 {client} NONE_ABORTED/200 0 CONNECT
172.217.18.238:80 - HIER_NONE/- -
1661786987.557      0 {client} NONE_ABORTED/200 0 CONNECT
172.217.18.238:80 - HIER_NONE/- -
1661786987.562      0 {client} NONE_ABORTED/200 0 CONNECT
172.217.18.238:80 - HIER_NONE/- -
1661786987.566      0 {client} NONE_ABORTED/200 0 CONNECT
172.217.18.238:80 - HIER_NONE/- -
1661786987.571      0 {client} NONE_ABORTED/200 0 CONNECT
172.217.18.238:80 - HIER_NONE/- -

On Thu, Aug 18, 2022 at 4:05 PM <ngtech1ltd at gmail.com> wrote:
>
> Hey K,
>
> I need your Mikrotik and squid.conf and iptables to understand what the issue might be.
> You will need to describe your setup in a way I can relate to it.
> There is not much of a difference between port 80 to 443 just that the port need to have ssl-bump settings If you are using it.
> The CONNECT port is a simple forward proxy and it seems your setup is not as simple as you describe.
> If you do have NAT then you need this to be only on specific interfaces in the Mikrotik and the Squid server.
>
> In my case the basic setup works for a very long time now so I cannot imagine what's wrong in your case.
>
> Eliezer
>
> ----
> Eliezer Croitoru
> NgTech, Tech Support
> Mobile: +972-5-28704261
> Email: ngtech1ltd at gmail.com
> Web: https://ngtech.co.il/
> My-Tube: https://tube.ngtech.co.il/
>
> -----Original Message-----
> From: M K <mohammed.khallaf at gmail.com>
> Sent: Thursday, 18 August 2022 6:20
> To: ngtech1ltd at gmail.com
> Cc: squid-users at lists.squid-cache.org; Rafael Akchurin <rafael.akchurin at diladele.com>
> Subject: Re: [squid-users] Squid 4.8+ intercept
>
> Hello Eliezer,
>
> I finally got my setup to work; turned out to be intercepted clients
> running into default nat, while my test squid server did not allow
> them access, not even through iptables!
>
> Now, I have one last bit to handle, which you did not cover in your
> video. I'm using 3 ports for squid like Rafael's guide: one for normal
> CONNECT, one for intercepted plain HTTP on 80, and one for intercepted
> HTTPs on 443.
>
> The setup works awesome for TLS addresses (i.e https://), but browser
> redirection from Plain to TLS, say from http://cnn.com to
> https://cnn.com, fails to happen. It just waits then time out.
> What could be done to make it happen?
>
> All best,
> K
>
>
> On Sat, Aug 13, 2022 at 7:57 PM <ngtech1ltd at gmail.com> wrote:
> >
> > Hey K,
> >
> >
> >
> > What RouterOS version are you using?
> >
> > Also, what rules have you applied?
> >
> > If there is a very long delay and then a failure you should verify that the rules you wrote are proper to your environment.
> >
> > You should route packets based on connection marks and mark only new connections from LAN IP addresses and only on the LAN interface.
> >
> > As I showed in the demo video it?s very simple to implement.
> >
> >
> >
> > Let me know if you are still having issues.
> >
> >
> >
> > Eliezer
> >
> >
> >
> > ----
> >
> > Eliezer Croitoru
> >
> > NgTech, Tech Support
> >
> > Mobile: +972-5-28704261
> >
> > Email: ngtech1ltd at gmail.com
> >
> > Web: https://ngtech.co.il/
> >
> > My-Tube: https://tube.ngtech.co.il/
> >
> >
> >
> > From: M K <mohammed.khallaf at gmail.com>
> > Sent: Saturday, 13 August 2022 10:59
> > To: ngtech1ltd at gmail.com
> > Cc: squid-users at lists.squid-cache.org
> > Subject: Re: [squid-users] Squid 4.8+ intercept
> >
> >
> >
> > Thank  you for your quick reply. The text-drawing actually changed with different font; the squid server is effectively connected to MikroTik router, not the same physical link as the client.
> >
> >
> >
> > The MikroTik router sits between the client and squid server.
> >
> >
> >
> > That said, I can confirm that the MikroTik router is effectively able to route/DNat client packets going to ports 80 and 443 to squid server. Depending on router rules be it route or dnat, the client browser effectively displays the error page of squid, or goes into a very long delay then failure.
> >
> >
> >
> > I will retry and let you know.
> >
> >
> >
> > K
> >
> > On Wed, Aug 10, 2022, 10:08 <ngtech1ltd at gmail.com> wrote:
> >
> > Hey K,
> >
> >
> >
> > I am not sure about the network topology.
> >
> > Preferably the Squid should reside on another network then the clients if it?s intercepting the traffic.
> >
> > Also, I assume it?s not a TPROXY setup so it should be pretty simple and straight forward.
> >
> >
> >
> > I understand why are you asking this question.
> >
> > Also take into account that Mikrotik is now on 7.4 firmware and it?s recommended to use this one.
> >
> > If you are using any other version let me know so I can try to make sense on the differences.
> >
> > I will try to give a DEMO for such a setup and how to make it work.
> >
> >
> >
> > Eliezer
> >
> >
> >
> > ----
> >
> > Eliezer Croitoru
> >
> > NgTech, Tech Support
> >
> > Mobile: +972-5-28704261
> >
> > Email: ngtech1ltd at gmail.com
> >
> > Web: https://ngtech.co.il/
> >
> > My-Tube: https://tube.ngtech.co.il/
> >
> >
> >
> > From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of M K
> > Sent: Tuesday, 9 August 2022 22:29
> > To: squid-users at lists.squid-cache.org
> > Subject: [squid-users] Squid 4.8+ intercept
> >
> >
> >
> > Hello,
> >
> >
> >
> > I have a setup like this one:
> >
> >
> > | Client | =====> | Router | =====> Internet
> >                      ||
> >                      \/
> >                   | Squid |
> >
> >
> >
> > ...the router is a Mikrotik router capable of all things NAT/Redirect and whatnot. Squid server has only one network interface.
> >
> > Using the router:
> >
> > - I tried routing traffic to squid server IP.
> >
> > - I tried destination-NATing from client to server IP, with origin server IP-and-port natted to squid IP-and-port, and with origin server IP-only natted to squid-IP.
> >
> >
> >
> > I have been struggling for 2 days to setup a working Squid 4.8 or higher interception.
> >
> > Test server is running Ubuntu 18.4.3 and Squid 4.8.
> >
> > Documentation is either too much trim or extremely outdated.
> >
> > Any help would be very much appreciated.
> >
> >
> >
> > All best,
> >
> > K
>



From ngtech1ltd at gmail.com  Mon Aug 29 17:29:53 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Mon, 29 Aug 2022 20:29:53 +0300
Subject: [squid-users] How to enable squid to use more server resources
 when using 500+ http_ports?
In-Reply-To: <000801d8bb6d$8cbff790$a63fe6b0$@graminsta.com.br>
References: <000801d8bb6d$8cbff790$a63fe6b0$@graminsta.com.br>
Message-ID: <002c01d8bbcc$f382fcc0$da88f640$@gmail.com>

Hey Marcelo,
 
Have you been using workers by any chance?
 
Eliezer
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email:  <mailto:ngtech1ltd at gmail.com> ngtech1ltd at gmail.com
Web:  <https://ngtech.co.il/> https://ngtech.co.il/
My-Tube:  <https://tube.ngtech.co.il/> https://tube.ngtech.co.il/
 
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Marcelo
Sent: Monday, 29 August 2022 9:07
To: squid-users at lists.squid-cache.org
Subject: [squid-users] How to enable squid to use more server resources when using 500+ http_ports?
 
Hello,
 
I have a server with large resources ( RAM, CPU, etc) running Ubuntu 20.04.
 
When I put squid 4.13 to manage more than 500 http_ports, it performs very slowly.
Question is, how can I setup Squid or Ubuntu to use more hw resources in order to perform better?
Or does it a matter of software architecture limitation?
 
Perform well with at least 500 http_ports would be very nice so we can use smaller numbers of VPSs.
Its hard to manage so many of it.
It would be a dream to have like 10k http_ports in a single server.
 
If it is not possible, is there any planning about do it in a future?
 
Tks
Marcelo.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220829/83f284aa/attachment.htm>

From marcelorodrigo at graminsta.com.br  Mon Aug 29 18:24:55 2022
From: marcelorodrigo at graminsta.com.br (Marcelo)
Date: Mon, 29 Aug 2022 15:24:55 -0300
Subject: [squid-users] How to enable squid to use more server resources
 when
Message-ID: <002901d8bbd4$a67f4890$f37dd9b0$@graminsta.com.br>

Hi Eliezer,

What workers?

Marcelo.

-----Mensagem original-----
De: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] Em nome
de squid-users-request at lists.squid-cache.org
Enviada em: segunda-feira, 29 de agosto de 2022 14:30
Para: squid-users at lists.squid-cache.org
Assunto: squid-users Digest, Vol 96, Issue 50

Send squid-users mailing list submissions to
	squid-users at lists.squid-cache.org

To subscribe or unsubscribe via the World Wide Web, visit
	http://lists.squid-cache.org/listinfo/squid-users
or, via email, send a message with subject or body 'help' to
	squid-users-request at lists.squid-cache.org

You can reach the person managing the list at
	squid-users-owner at lists.squid-cache.org

When replying, please edit your Subject line so it is more specific than
"Re: Contents of squid-users digest..."


Today's Topics:

   1. Re: How to enable squid to use more server resources when
      using 500+ http_ports? (ngtech1ltd at gmail.com)


----------------------------------------------------------------------

Message: 1
Date: Mon, 29 Aug 2022 20:29:53 +0300
From: <ngtech1ltd at gmail.com>
To: <squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] How to enable squid to use more server
	resources when using 500+ http_ports?
Message-ID: <002c01d8bbcc$f382fcc0$da88f640$@gmail.com>
Content-Type: text/plain; charset="utf-8"

Hey Marcelo,
 
Have you been using workers by any chance?
 
Eliezer
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email:  <mailto:ngtech1ltd at gmail.com> ngtech1ltd at gmail.com
Web:  <https://ngtech.co.il/> https://ngtech.co.il/
My-Tube:  <https://tube.ngtech.co.il/> https://tube.ngtech.co.il/
 
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of
Marcelo
Sent: Monday, 29 August 2022 9:07
To: squid-users at lists.squid-cache.org
Subject: [squid-users] How to enable squid to use more server resources when
using 500+ http_ports?
 
Hello,
 
I have a server with large resources ( RAM, CPU, etc) running Ubuntu 20.04.
 
When I put squid 4.13 to manage more than 500 http_ports, it performs very
slowly.
Question is, how can I setup Squid or Ubuntu to use more hw resources in
order to perform better?
Or does it a matter of software architecture limitation?
 
Perform well with at least 500 http_ports would be very nice so we can use
smaller numbers of VPSs.
Its hard to manage so many of it.
It would be a dream to have like 10k http_ports in a single server.
 
If it is not possible, is there any planning about do it in a future?
 
Tks
Marcelo.
-------------- next part --------------
An HTML attachment was scrubbed...
URL:
<http://lists.squid-cache.org/pipermail/squid-users/attachments/20220829/83f
284aa/attachment.htm>

------------------------------

Subject: Digest Footer

_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users


------------------------------

End of squid-users Digest, Vol 96, Issue 50
*******************************************



From ngtech1ltd at gmail.com  Mon Aug 29 19:59:37 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Mon, 29 Aug 2022 22:59:37 +0300
Subject: [squid-users] How to enable squid to use more server resources
 when
In-Reply-To: <002901d8bbd4$a67f4890$f37dd9b0$@graminsta.com.br>
References: <002901d8bbd4$a67f4890$f37dd9b0$@graminsta.com.br>
Message-ID: <003b01d8bbe1$debcf1f0$9c36d5d0$@gmail.com>

http://www.squid-cache.org/Doc/config/workers/



----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Marcelo
Sent: Monday, 29 August 2022 21:25
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] How to enable squid to use more server resources when

Hi Eliezer,

What workers?

Marcelo.

-----Mensagem original-----
De: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] Em nome
de squid-users-request at lists.squid-cache.org
Enviada em: segunda-feira, 29 de agosto de 2022 14:30
Para: squid-users at lists.squid-cache.org
Assunto: squid-users Digest, Vol 96, Issue 50

Send squid-users mailing list submissions to
	squid-users at lists.squid-cache.org

To subscribe or unsubscribe via the World Wide Web, visit
	http://lists.squid-cache.org/listinfo/squid-users
or, via email, send a message with subject or body 'help' to
	squid-users-request at lists.squid-cache.org

You can reach the person managing the list at
	squid-users-owner at lists.squid-cache.org

When replying, please edit your Subject line so it is more specific than
"Re: Contents of squid-users digest..."


Today's Topics:

   1. Re: How to enable squid to use more server resources when
      using 500+ http_ports? (ngtech1ltd at gmail.com)


----------------------------------------------------------------------

Message: 1
Date: Mon, 29 Aug 2022 20:29:53 +0300
From: <ngtech1ltd at gmail.com>
To: <squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] How to enable squid to use more server
	resources when using 500+ http_ports?
Message-ID: <002c01d8bbcc$f382fcc0$da88f640$@gmail.com>
Content-Type: text/plain; charset="utf-8"

Hey Marcelo,
 
Have you been using workers by any chance?
 
Eliezer
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email:  <mailto:ngtech1ltd at gmail.com> ngtech1ltd at gmail.com
Web:  <https://ngtech.co.il/> https://ngtech.co.il/
My-Tube:  <https://tube.ngtech.co.il/> https://tube.ngtech.co.il/
 
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of
Marcelo
Sent: Monday, 29 August 2022 9:07
To: squid-users at lists.squid-cache.org
Subject: [squid-users] How to enable squid to use more server resources when
using 500+ http_ports?
 
Hello,
 
I have a server with large resources ( RAM, CPU, etc) running Ubuntu 20.04.
 
When I put squid 4.13 to manage more than 500 http_ports, it performs very
slowly.
Question is, how can I setup Squid or Ubuntu to use more hw resources in
order to perform better?
Or does it a matter of software architecture limitation?
 
Perform well with at least 500 http_ports would be very nice so we can use
smaller numbers of VPSs.
Its hard to manage so many of it.
It would be a dream to have like 10k http_ports in a single server.
 
If it is not possible, is there any planning about do it in a future?
 
Tks
Marcelo.
-------------- next part --------------
An HTML attachment was scrubbed...
URL:
<http://lists.squid-cache.org/pipermail/squid-users/attachments/20220829/83f
284aa/attachment.htm>

------------------------------

Subject: Digest Footer

_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users


------------------------------

End of squid-users Digest, Vol 96, Issue 50
*******************************************

_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From ngtech1ltd at gmail.com  Mon Aug 29 21:54:43 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Tue, 30 Aug 2022 00:54:43 +0300
Subject: [squid-users] Squid 5.2 TCP_MISS_ABORTED/100 erros when
 uploading
In-Reply-To: <CAEJ1g5KbMxwiT-XQxR-8cQuPMQH4kMYJn8uZKZ9M7by3j3eKdw@mail.gmail.com>
References: <CAEJ1g5Kc0fdE82U+ede-wEfiyLRErxTPo2_BtpR1BzWY=72zig@mail.gmail.com>
 <4b9cf33a-4d35-1f09-6f5c-35f0a2c5ab78@treenet.co.nz>
 <CAEJ1g5KbMxwiT-XQxR-8cQuPMQH4kMYJn8uZKZ9M7by3j3eKdw@mail.gmail.com>
Message-ID: <004601d8bbf1$f3a292e0$dae7b8a0$@gmail.com>

Hey David,

This should do the trick for you:
https://www.ngtech.co.il/repo/alma/8/x86_64/

@Amos, 5.6 is not ready for OpenSSL 3 and there for cannot be compiled on RHEL 9 and similar.

Eliezer

* A rocky version should be available later on at: https://www.ngtech.co.il/repo/rocky/8/x86_64/

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: mailto:ngtech1ltd at gmail.com
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/

From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of David Ferreira
Sent: Monday, 29 August 2022 16:31
To: Amos Jeffries <squid3 at treenet.co.nz>
Cc: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Squid 5.2 TCP_MISS_ABORTED/100 erros when uploading

Hi Amos,

Thank you for the reply,

here's my squid.conf, by default our client's(localnet) do not have internet access and only match windows services acl's unless they are in authorizednet.conf, in this case that's the only match acl for the clients using this application, i also removed some of the includes i have, it's mostly random src to random dstdomain, the clients in question do not match this acl's at all.

---
squid 4.15 squid.conf:
---

logformat timereadable %tl %6tr %>a %Ss/%03Hs %<st %rm %ru %un %Sh/%<A %mt
access_log daemon:/var/log/squid/access.log timereadable

acl localnet src http://10.0.0.0/8     # RFC1918 possible internal network
acl localnet src http://172.16.0.0/12  # RFC1918 possible internal network
acl localnet src http://192.168.0.0/16 # RFC1918 possible internal network
acl localnet src fc00::/7       # RFC 4193 local private network range
acl localnet src fe80::/10      # RFC 4291 link-local (directly plugged) machines

include /etc/squid/acls/authorizednet.conf

acl SSL_ports port 443
acl SSL_ports port 8080
acl Safe_ports port 80          # http
acl Safe_ports port 21          # ftp
acl Safe_ports port 443         # https
acl Safe_ports port 70          # gopher
acl Safe_ports port 210         # wais
acl Safe_ports port 1025-65535  # unregistered ports
acl Safe_ports port 280         # http-mgmt
acl Safe_ports port 488         # gss-http
acl Safe_ports port 591         # filemaker
acl Safe_ports port 777         # multiling http
acl FTP_ports port 21 1025-65535
acl CONNECT method CONNECT

###BlockLists
include /etc/squid/acls/blocklists-remotes.conf
###Microsoft ATP
include /etc/squid/acls/atp.conf
###Windows Activation
include /etc/squid/acls/wactivate.conf
###No Windows Update
include /etc/squid/acls/nowupdate.conf
###Windows Update
include /etc/squid/acls/wupdate.conf

http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports

http_access allow localhost manager
http_access deny manager

http_access allow authorizednet
http_access allow localhost

http_access deny all

http_port 3128

cache_dir ufs /var/spool/squid 50000 16 256

coredump_dir /var/spool/squid

refresh_pattern ^ftp:           1440    20%     10080
refresh_pattern ^gopher:        1440    0%      1440
refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
refresh_pattern .               0       20%     4320
max_filedesc 65535

maximum_object_size 10000 MB
range_offset_limit 10000 MB windowsupdate
quick_abort_min -1

refresh_pattern -i http://microsoft.com/.*\.(cab|exe|ms[i|u|f]|[ap]sf|wm[v|a]|dat|zip) 4320 80% 43200 reload-into-ims
refresh_pattern -i http://windowsupdate.com/.*\.(cab|exe|ms[i|u|f]|[ap]sf|wm[v|a]|dat|zip) 4320 80% 43200 reload-into-ims
refresh_pattern -i http://windows.com/.*\.(cab|exe|ms[i|u|f]|[ap]sf|wm[v|a]|dat|zip) 4320 80% 43200 reload-into-ims

---
And here's squid 5.2 squid.conf, it's pretty much the same:
---

logformat timereadable %tl %6tr %>a %Ss/%03Hs %<st %rm %ru %un %Sh/%<A %mt
access_log daemon:/var/log/squid/access.log timereadable 
debug_options ALL,1 33,2 28,9

acl localnet src 0.0.0.1-0.255.255.255  # RFC 1122 "this" network (LAN)
acl localnet src http://10.0.0.0/8             # RFC 1918 local private network (LAN)
acl localnet src http://100.64.0.0/10          # RFC 6598 shared address space (CGN)
acl localnet src http://169.254.0.0/16         # RFC 3927 link-local (directly plugged) machines
acl localnet src http://172.16.0.0/12          # RFC 1918 local private network (LAN)
acl localnet src http://192.168.0.0/16         # RFC 1918 local private network (LAN)
acl localnet src fc00::/7               # RFC 4193 local private network range
acl localnet src fe80::/10              # RFC 4291 link-local (directly plugged) machines

include /etc/squid/acls/authorizednet.conf

acl SSL_ports port 443
acl SSL_ports port 8080
acl Safe_ports port 80          # http
acl Safe_ports port 21          # ftp
acl Safe_ports port 443         # https
acl Safe_ports port 70          # gopher
acl Safe_ports port 210         # wais
acl Safe_ports port 1025-65535  # unregistered ports
acl Safe_ports port 280         # http-mgmt
acl Safe_ports port 488         # gss-http
acl Safe_ports port 591         # filemaker
acl Safe_ports port 777         # multiling http
acl FTP_ports port 21 1025-65535

###BlockLists
include /etc/squid/acls/blocklists-remotes.conf
###Microsoft ATP
include /etc/squid/acls/atp.conf
###Windows Activation
include /etc/squid/acls/wactivate.conf
###No Windows Update
include /etc/squid/acls/nowupdate.conf
###Windows Update
include /etc/squid/acls/wupdate.conf

http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports

http_access allow localhost manager
http_access deny manager

http_access allow authorizednet 
http_access allow localhost

http_access deny all

http_port 3128 

cache_dir ufs /var/spool/squid 50000 16 256

coredump_dir /var/spool/squid

refresh_pattern ^ftp:           1440    20%     10080
refresh_pattern ^gopher:        1440    0%      1440
refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
refresh_pattern .               0       20%     4320

maximum_object_size 10000 MB
range_offset_limit 10000 MB windowsupdate
quick_abort_min -1

refresh_pattern -i http://microsoft.com/.*\.(cab|exe|ms[i|u|f]|[ap]sf|wm[v|a]|dat|zip) 4320 80% 43200 reload-into-ims
refresh_pattern -i http://windowsupdate.com/.*\.(cab|exe|ms[i|u|f]|[ap]sf|wm[v|a]|dat|zip) 4320 80% 43200 reload-into-ims
refresh_pattern -i http://windows.com/.*\.(cab|exe|ms[i|u|f]|[ap]sf|wm[v|a]|dat|zip) 4320 80% 43200 reload-into-ims


As for squid rocky linux packages information, here is the links:
Rocky 8 : https://almalinux.pkgs.org/8/almalinux-appstream-x86_64/squid-4.15-3.module_el8.6.0+3010+383bc947.1.x86_64.rpm.html
Rocky 9 : https://almalinux.pkgs.org/9/almalinux-appstream-x86_64/squid-5.2-1.el9_0.1.x86_64.rpm.html

Thank you!


On Mon, 29 Aug 2022 at 13:36, Amos Jeffries <mailto:squid3 at treenet.co.nz> wrote:
On 29/08/22 22:17, David Ferreira wrote:
> hi,
> 
> First time using mailing lists, sorry about anything.
> 

Welcome, and thanks for using Squid.

Do not worry about mistakes. Helping with that type of thing is what 
this list is here for whether expert or beginner.



> 
> Squid 4.15:
> 26/Aug/2022:15:36:08 +0100    273 172.19.222.132TCP_MISS/200 745 POST 
> http://websiteurl/index.php <http://websiteurl/index.php> - 
> HIER_DIRECT/websitedomain text/xml
> 
> Squid 5.2:
> 25/Aug/2022:15:10:00 +0100    139 172.19.222.132 TCP_MISS_ABORTED/100 0 
> POST http://websiteurl <http://websiteurl>/index.php - 
> HIER_DIRECT/websitedomain -
> 
> anyone has an ideia of what may be happening here?, been searching about 
> http errors 100 and so far i did not find anything that points me to the 
> problem.
> 
> On the application side the error it shows when it tries to upload is:
> "
> Error storing the document on the server
> Detail HTTP error 100
> Send failure: Connection was aborted (55)
> "
> 

This is very odd.

  * The "ABORTED" tag hints strongly that the client closed the 
connection here.


  * Status code "100 Continue" is a normal part of HTTP/1.1.

There is something wrong with the client application to be reporting 
that as an error code at all. Likely that bug is what triggered the abort.

  * The difference in result between Squid v4 and v5 is also extremely 
odd. I do not think handling of status 100 had any significant changes 
since the Squid-3 days.


Can you show us your config for both versions?
  Omit lines that are commented out to reduce the sizes.
  Take care to obscure private details while keeping it clear that 
detail A and B are different (eg don't use same symbol X for replacing 
both).


Also FME, where can I/we find details of the Rocky Squid packages?


Cheers
Amos
_______________________________________________
squid-users mailing list
mailto:squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



-- 
Com os melhores cumprimentos,
David Ferreira



From mohammed.khallaf at gmail.com  Tue Aug 30 09:43:57 2022
From: mohammed.khallaf at gmail.com (M K)
Date: Tue, 30 Aug 2022 11:43:57 +0200
Subject: [squid-users] Squid 4.8+ intercept
In-Reply-To: <CAFMSmTs8r0rTAQt-G__7fOrBQfw2430S+Cm-dH9B22q6OVmACA@mail.gmail.com>
References: <CAFMSmTvEFMASCsodsZ43zdY_tEaKMJu2s_c8bCAKuyVd1i9yFg@mail.gmail.com>
 <CAFMSmTuUK_9UApWc76L91GDRm-tK-E+b=oLrUzF5Fitr-PZy3Q@mail.gmail.com>
 <000401d8ac90$62fcea80$28f6bf80$@gmail.com>
 <CAFMSmTt71mFhpanDVtKG0Gg6UA74ZAgpnBx5B__01K1Tmu5QLg@mail.gmail.com>
 <001401d8af3e$392663c0$ab732b40$@gmail.com>
 <CAFMSmTua4_eQ4iyY-zwCSkqYk+E1Rjd0CtzvxYi7vP_ty=pQAg@mail.gmail.com>
 <000001d8b30b$93a95570$bafc0050$@gmail.com>
 <CAFMSmTs8r0rTAQt-G__7fOrBQfw2430S+Cm-dH9B22q6OVmACA@mail.gmail.com>
Message-ID: <CAFMSmTsexmTcnJckOWnqY0mJnEZEN7hhAyX+LTQeBQWZOkYcLw@mail.gmail.com>

Solved!

I stated that I was using 3 ports...
"> Now, I have one last bit to handle, which you did not cover in your
> video. I'm using 3 ports for squid like Rafael's guide: one for normal
> CONNECT, one for intercepted plain HTTP on 80, and one for intercepted
> HTTPs on 443."

which is the correct setup, but I found that I did not actually apply
the idea to config! It works now...(redirect 80 to 3129 and 443 to
3130)

Chain PREROUTING (policy ACCEPT)
target     prot opt source               destination
REDIRECT   tcp  --  anywhere             anywhere             tcp
dpt:http redir ports 3129
REDIRECT   tcp  --  anywhere             anywhere             tcp
dpt:https redir ports 3130

and on squid.conf:

http_port 3128
http_port 3129 intercept
https_port 3130 intercept ssl-bump cert=/xxx/xxx/xxx.pem
generate-host-certificates=on dynamic_cert_mem_cache_size=999MB

Thank you so much for all your help and support.



On Mon, Aug 29, 2022 at 5:35 PM M K <mohammed.khallaf at gmail.com> wrote:
>
> iptables PREROUTING:
> Chain PREROUTING (policy ACCEPT)
> target     prot opt source               destination
> ACCEPT     all  --  anywhere             anywhere             ADDRTYPE
> match dst-type LOCAL
> REDIRECT   tcp  --  anywhere             anywhere             tcp
> dpt:http redir ports 3130
> REDIRECT   tcp  --  anywhere             anywhere             tcp
> dpt:https redir ports 3130
> -------------------------
> Mikrotik mangle:
> add action=route chain=prerouting dst-port=80 passthrough=no
> protocol=tcp route-dst={squid} src-address={client}
> add action=route chain=prerouting connection-state="" dst-port=443
> passthrough=no protocol=tcp route-dst={squid} src-address={client}
> -------------------------
> full squid.conf:
> acl client src x.x.x.x/x
>
> http_access allow client
> http_access deny all
>
> http_port 3128
> https_port 3130 intercept ssl-bump cert=/xxx/xxx/xxx.pem
> generate-host-certificates=on dynamic_cert_mem_cache_size=999MB
>
> acl tls_connect at_step SslBump1
> ssl_bump peek tls_connect
> ssl_bump splice all
> ---------------------------
> Firefox behavior...
> HTTPS: ALL OK!
>
> HTTP (http://google.com):
>
> The connection was reset
>
> The connection to the server was reset while the page was loading.
>
>     The site could be temporarily unavailable or too busy. Try again
> in a few moments.
>     If you are unable to load any pages, check your computer?s network
> connection.
>     If your computer or network is protected by a firewall or proxy,
> make sure that Firefox is permitted to access the Web.
> ---------------------------
> Squid log:
>
> HTTPS:
> ----------
> 1661786874.087   5981 {client} TCP_TUNNEL/200 152 CONNECT
> js-sec.indexww.com:443 - ORIGINAL_DST/92.123.33.225 -
> 1661786874.087   5855 {client} TCP_TUNNEL/200 152 CONNECT
> js-sec.indexww.com:443 - ORIGINAL_DST/92.123.33.225 -
> 1661786877.448  10391 {client} TCP_TUNNEL/200 1254 CONNECT
> prg.smartadserver.com:443 - ORIGINAL_DST/185.86.138.32 -
> 1661786878.480      4 {client} NONE/200 0 CONNECT 64.74.236.255:443 -
> HIER_NONE/- -
> 1661786886.125   7644 {client} TCP_TUNNEL/200 3850 CONNECT
> mcdp-chidc2.outbrain.com:443 - ORIGINAL_DST/64.74.236.255 -
> 1661786886.916      5 {client} NONE/200 0 CONNECT 54.192.111.67:443 -
> HIER_NONE/- -
> 1661786887.070      3 {client} NONE/200 0 CONNECT 34.98.75.36:443 -
> HIER_NONE/- -
> 1661786887.275      0 {client} NONE_ABORTED/200 0 CONNECT
> 88.221.111.34:80 - HIER_NONE/- -
> 1661786887.548      4 {client} NONE/200 0 CONNECT 54.192.111.44:443 -
> HIER_NONE/- -
> 1661786888.550 147502 {client} TCP_TUNNEL/200 8554 CONNECT
> cdn.cnn.com:443 - ORIGINAL_DST/2.23.52.55 -
> 1661786888.718      1 {client} NONE/200 0 CONNECT 185.86.138.32:443 -
> HIER_NONE/- -
> 1661786889.510 143920 {client} TCP_TUNNEL/200 9655 CONNECT
> aax-eu.amazon-adsystem.com:443 - ORIGINAL_DST/52.95.125.22 -
> 1661786889.510 116428 {client} TCP_TUNNEL/200 6386 CONNECT
> segment-data-us-east.zqtk.net:443 - ORIGINAL_DST/52.72.26.11 -
> 1661786889.609      6 {client} NONE/200 0 CONNECT 92.123.33.225:443 -
> HIER_NONE/- -
> 1661786890.379 149287 {client} TCP_TUNNEL/200 444896 CONNECT
> lightning.cnn.com:443 - ORIGINAL_DST/2.23.52.55 -
> 1661786892.987      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786892.992      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786892.998      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.003      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.009      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.014      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.019      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.024      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.029      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.034      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.044      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.048      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.053      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.057      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.062      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.067      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.072      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.078      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.082      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.087      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.093      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.098      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.102      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.107      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.112      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.116      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.120      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.125      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.129      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.134      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.140      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.144      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.148      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.152      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.156      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.160      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.165      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.170      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.174      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.178      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.184      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.188      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.192      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.196      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.200      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.204      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.208      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.213      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.217      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.221      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.227      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.231      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.236      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.240      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.243      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.247      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.251      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.255      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.260      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786893.264      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786894.773   5163 {client} TCP_TUNNEL/200 152 CONNECT
> js-sec.indexww.com:443 - ORIGINAL_DST/92.123.33.225 -
> 1661786899.041  10322 {client} TCP_TUNNEL/200 1254 CONNECT
> prg.smartadserver.com:443 - ORIGINAL_DST/185.86.138.32 -
> 1661786899.111 125320 {client} TCP_TUNNEL/200 27104 CONNECT
> images.outbrainimg.com:443 - ORIGINAL_DST/92.123.32.26 -
> 1661786899.314 152898 {client} TCP_TUNNEL/200 285438 CONNECT
> widgets.outbrain.com:443 - ORIGINAL_DST/92.123.34.112 -
> 1661786899.484  98933 {client} TCP_TUNNEL/200 6583 CONNECT
> s.amazon-adsystem.com:443 - ORIGINAL_DST/209.54.182.161 -
> 1661786902.387      3 {client} NONE/200 0 CONNECT 64.74.236.255:443 -
> HIER_NONE/- -
> 1661786903.220      3 {client} NONE/200 0 CONNECT 142.251.37.170:443 -
> HIER_NONE/- -
> 1661786903.361      3 {client} NONE/200 0 CONNECT 92.123.33.225:443 -
> HIER_NONE/- -
> 1661786903.390    169 {client} TCP_TUNNEL/200 1868 CONNECT
> safebrowsing.googleapis.com:443 - ORIGINAL_DST/142.251.37.170 -
> 1661786903.430      2 {client} NONE/200 0 CONNECT 3.217.56.194:443 -
> HIER_NONE/- -
> 1661786903.462      1 {client} NONE/200 0 CONNECT 178.32.210.226:443 -
> HIER_NONE/- -
> 1661786904.650 104106 {client} TCP_TUNNEL/200 4310 CONNECT
> pixel-eu.rubiconproject.com:443 - ORIGINAL_DST/69.173.144.165 -
> 1661786905.983      3 {client} NONE/200 0 CONNECT 64.202.112.127:443 -
> HIER_NONE/- -
> 1661786905.992   2561 {client} TCP_TUNNEL/200 5831 CONNECT
> logx.optimizely.com:443 - ORIGINAL_DST/3.217.56.194 -
> 1661786906.105    121 {client} TCP_TUNNEL/200 0 CONNECT
> tr.outbrain.com:443 - ORIGINAL_DST/64.202.112.127 -
> 1661786906.354      2 {client} NONE/200 0 CONNECT 2.23.52.55:443 - HIER_NONE/- -
> 1661786906.358      1 {client} NONE/200 0 CONNECT 2.23.52.55:443 - HIER_NONE/- -
> 1661786906.364      1 {client} NONE/200 0 CONNECT 92.123.34.112:443 -
> HIER_NONE/- -
> 1661786906.620      1 {client} NONE/200 0 CONNECT 146.75.56.64:443 -
> HIER_NONE/- -
> 1661786906.767      3 {client} NONE/200 0 CONNECT 3.217.56.194:443 -
> HIER_NONE/- -
> 1661786907.001      2 {client} NONE/200 0 CONNECT 151.101.1.195:443 -
> HIER_NONE/- -
> 1661786907.494      2 {client} NONE/200 0 CONNECT 54.93.141.29:443 -
> HIER_NONE/- -
> 1661786907.596      2 {client} NONE/200 0 CONNECT 142.251.37.48:443 -
> HIER_NONE/- -
> 1661786907.777      2 {client} NONE/200 0 CONNECT 92.122.218.83:443 -
> HIER_NONE/- -
> 1661786907.913      2 {client} NONE/200 0 CONNECT 54.231.203.49:443 -
> HIER_NONE/- -
> 1661786907.914      4 {client} NONE/200 0 CONNECT 54.231.203.49:443 -
> HIER_NONE/- -
> 1661786907.916      6 {client} NONE/200 0 CONNECT 54.231.203.49:443 -
> HIER_NONE/- -
> 1661786907.919      7 {client} NONE/200 0 CONNECT 18.161.111.80:443 -
> HIER_NONE/- -
> 1661786908.008      1 {client} NONE/200 0 CONNECT 91.228.74.208:443 -
> HIER_NONE/- -
> 1661786908.012      5 {client} NONE/200 0 CONNECT 64.202.112.127:443 -
> HIER_NONE/- -
> 1661786908.135      0 {client} NONE_ABORTED/200 0 CONNECT
> 216.58.212.99:80 - HIER_NONE/- -
> 1661786908.305      3 {client} NONE/200 0 CONNECT 92.123.34.112:443 -
> HIER_NONE/- -
> 1661786908.393   5031 {client} TCP_TUNNEL/200 152 CONNECT
> js-sec.indexww.com:443 - ORIGINAL_DST/92.123.33.225 -
> 1661786908.393 172182 {client} TCP_TUNNEL/200 8323 CONNECT
> www.google.com:443 - ORIGINAL_DST/142.250.200.196 -
> 1661786908.561      0 {client} NONE_ABORTED/200 0 CONNECT
> 18.161.108.38:80 - HIER_NONE/- -
> 1661786908.562      0 {client} NONE_ABORTED/200 0 CONNECT
> 18.161.108.38:80 - HIER_NONE/- -
> 1661786908.562      0 {client} NONE_ABORTED/200 0 CONNECT
> 18.161.108.38:80 - HIER_NONE/- -
> 1661786909.615      2 {client} NONE/200 0 CONNECT 104.108.78.219:443 -
> HIER_NONE/- -
> 1661786909.620      2 {client} NONE/200 0 CONNECT 54.147.61.21:443 -
> HIER_NONE/- -
> 1661786909.685      3 {client} NONE/200 0 CONNECT 13.36.218.177:443 -
> HIER_NONE/- -
> 1661786910.704      5 {client} NONE/200 0 CONNECT 3.229.71.121:443 -
> HIER_NONE/- -
> 1661786910.820      1 {client} NONE/200 0 CONNECT 94.237.48.66:443 -
> HIER_NONE/- -
> 1661786910.981    161 {client} TCP_TUNNEL/200 5583 CONNECT
> v8-emea.sdk.beemray.com:443 - ORIGINAL_DST/94.237.48.66 -
> 1661786910.985      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786910.993      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786910.999      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786911.003      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786911.012      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786911.020      2 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786911.024      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786911.030      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786911.034      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786911.040      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786911.151      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786911.156      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786911.162      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786911.167      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786911.172      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786911.177      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786911.182      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786911.187      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786911.192      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786911.197      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786911.204      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786911.208      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786911.212      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786911.215      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786911.219      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786911.223      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786911.227      1 {client} NONE/200 0 CONNECT 52.72.26.11:443 -
> HIER_NONE/- -
> 1661786911.229      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786911.233      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786911.237      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786911.242      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786911.250      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786911.254      1 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786911.258      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786911.262      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786911.267      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786911.272      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786911.392   5027 {client} TCP_TUNNEL/200 152 CONNECT
> amplify.outbrain.com:443 - ORIGINAL_DST/92.123.34.112 -
> 1661786911.398      2 {client} NONE/200 0 CONNECT 52.95.126.160:443 -
> HIER_NONE/- -
> 1661786911.526      5 {client} NONE/200 0 CONNECT 34.246.41.28:443 -
> HIER_NONE/- -
> 1661786911.530      1 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786912.393 170550 {client} TCP_TUNNEL/200 18491 CONNECT
> get.s-onetag.com:443 - ORIGINAL_DST/18.161.111.16 -
> 1661786912.393 170968 {client} TCP_TUNNEL/200 5658 CONNECT
> cdn.jsdelivr.net:443 - ORIGINAL_DST/104.16.88.20 -
> 1661786912.622      3 {client} NONE/200 0 CONNECT 172.217.18.33:443 -
> HIER_NONE/- -
> 1661786912.733   5239 {client} TCP_TUNNEL/200 6889 CONNECT
> mms.cnn.com:443 - ORIGINAL_DST/54.93.141.29 -
> 1661786912.772    150 {client} TCP_TUNNEL/200 5179 CONNECT
> 4669ca4556421dd764fce36af596f212.safeframe.googlesyndication.com:443 -
> ORIGINAL_DST/172.217.18.33 -
> 1661786913.104 112542 {client} TCP_TUNNEL/200 4310 CONNECT
> pixel.rubiconproject.com:443 - ORIGINAL_DST/69.173.144.138 -
> 1661786913.383      2 {client} NONE/200 0 CONNECT 54.93.141.29:443 -
> HIER_NONE/- -
> 1661786913.394   5475 {client} TCP_TUNNEL/200 371 CONNECT
> cdn.boomtrain.com:443 - ORIGINAL_DST/18.161.111.80 -
> 1661786913.395 170794 {client} TCP_TUNNEL/200 16461 CONNECT
> signal-beacon.s-onetag.com:443 - ORIGINAL_DST/54.192.111.35 -
> 1661786913.395 170901 {client} TCP_TUNNEL/200 7241 CONNECT
> onetag-geo.s-onetag.com:443 - ORIGINAL_DST/18.161.97.41 -
> 1661786913.396 173362 {client} TCP_TUNNEL/200 8454 CONNECT
> www.cnn.com:443 - ORIGINAL_DST/146.75.59.5 -
> 1661786913.464      2 {client} NONE/200 0 CONNECT 18.193.134.248:443 -
> HIER_NONE/- -
> 1661786913.859  10397 {client} TCP_TUNNEL/200 5083 CONNECT
> prg.smartadserver.com:443 - ORIGINAL_DST/178.32.210.226 -
> 1661786914.884   6971 {client} TCP_TUNNEL/200 131386 CONNECT
> advsync.s3.amazonaws.com:443 - ORIGINAL_DST/54.231.203.49 -
> 1661786915.017   7103 {client} TCP_TUNNEL/200 130794 CONNECT
> advsync.s3.amazonaws.com:443 - ORIGINAL_DST/54.231.203.49 -
> 1661786915.025   7108 {client} TCP_TUNNEL/200 132142 CONNECT
> advsync.s3.amazonaws.com:443 - ORIGINAL_DST/54.231.203.49 -
> 1661786915.396 174730 {client} TCP_TUNNEL/200 102282 CONNECT
> cdn.cookielaw.org:443 - ORIGINAL_DST/104.16.148.64 -
> 1661786915.523   7511 {client} TCP_TUNNEL/200 3798 CONNECT
> tr.outbrain.com:443 - ORIGINAL_DST/64.202.112.127 -
> 1661786916.252      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786916.257      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786916.262      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786916.266      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786916.271      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786916.275      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786916.280      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786916.286      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786916.290      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786916.294      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786916.302      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786916.307      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786916.311      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786916.315      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786916.319      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786916.324      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786916.328      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786916.333      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786916.337      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786916.341      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786916.397 116628 {client} TCP_TUNNEL/200 15014 CONNECT
> eus.rubiconproject.com:443 - ORIGINAL_DST/104.125.24.254 -
> 1661786916.397 170897 {client} TCP_TUNNEL/200 6473 CONNECT
> www.ugdturner.com:443 - ORIGINAL_DST/34.237.36.10 -
> 1661786916.398 170966 {client} TCP_TUNNEL/200 4198 CONNECT
> warnermediagroup-com.videoplayerhub.com:443 - ORIGINAL_DST/104.26.9.50
> -
> 1661786917.171  14783 {client} TCP_TUNNEL/200 4492 CONNECT
> mcdp-chidc2.outbrain.com:443 - ORIGINAL_DST/64.74.236.255 -
> 1661786917.399 170571 {client} TCP_TUNNEL/200 6635 CONNECT
> securepubads.g.doubleclick.net:443 - ORIGINAL_DST/142.251.37.162 -
> 1661786917.400 170992 {client} TCP_TUNNEL/200 13115 CONNECT
> static.adsafeprotected.com:443 - ORIGINAL_DST/54.192.111.91 -
> 1661786918.630   5165 {client} TCP_TUNNEL/200 570 CONNECT
> www.summerhamster.com:443 - ORIGINAL_DST/18.193.134.248 -
> 1661786918.718   5335 {client} TCP_TUNNEL/200 8722 CONNECT
> mms.cnn.com:443 - ORIGINAL_DST/54.93.141.29 -
> 1661786919.561 120339 {client} TCP_TUNNEL/200 4961 CONNECT
> secure-assets.rubiconproject.com:443 - ORIGINAL_DST/2.17.80.55 -
> 1661786920.402 173997 {client} TCP_TUNNEL/200 38769 CONNECT
> static.chartbeat.com:443 - ORIGINAL_DST/18.161.105.235 -
> 1661786920.669 174219 {client} TCP_TUNNEL/200 81160 CONNECT
> ads.pubmatic.com:443 - ORIGINAL_DST/92.123.33.150 -
> 1661786921.369 145142 {client} TCP_TUNNEL/200 521393 CONNECT
> player.aniview.com:443 - ORIGINAL_DST/92.123.34.136 -
>
> HTTP:
> --------
> 1661786959.922      4 {client} NONE/200 0 CONNECT 142.250.200.196:443
> - HIER_NONE/- -
> 1661786959.987     64 {client} TCP_TUNNEL/200 0 CONNECT
> www.google.com:443 - ORIGINAL_DST/142.250.200.196 -
> 1661786960.061      4 {client} NONE/200 0 CONNECT 142.250.200.196:443
> - HIER_NONE/- -
> 1661786960.177      0 {client} NONE_ABORTED/200 0 CONNECT
> 216.58.212.99:80 - HIER_NONE/- -
> 1661786968.308      4 {client} NONE_ABORTED/200 0 CONNECT
> 151.101.3.5:80 - HIER_NONE/- -
> 1661786968.317      1 {client} NONE_ABORTED/200 0 CONNECT
> 151.101.3.5:80 - HIER_NONE/- -
> 1661786968.337      1 {client} NONE_ABORTED/200 0 CONNECT
> 151.101.3.5:80 - HIER_NONE/- -
> 1661786968.344      0 {client} NONE_ABORTED/200 0 CONNECT
> 151.101.3.5:80 - HIER_NONE/- -
> 1661786968.348      0 {client} NONE_ABORTED/200 0 CONNECT
> 151.101.3.5:80 - HIER_NONE/- -
> 1661786968.352      0 {client} NONE_ABORTED/200 0 CONNECT
> 151.101.3.5:80 - HIER_NONE/- -
> 1661786968.360      0 {client} NONE_ABORTED/200 0 CONNECT
> 151.101.3.5:80 - HIER_NONE/- -
> 1661786968.364      0 {client} NONE_ABORTED/200 0 CONNECT
> 151.101.3.5:80 - HIER_NONE/- -
> 1661786968.367      0 {client} NONE_ABORTED/200 0 CONNECT
> 151.101.3.5:80 - HIER_NONE/- -
> 1661786968.371      0 {client} NONE_ABORTED/200 0 CONNECT
> 151.101.3.5:80 - HIER_NONE/- -
> 1661786971.049      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.053      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.057      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.060      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.064      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.068      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.072      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.076      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.080      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.084      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.093      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.098      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.102      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.105      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.110      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.113      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.117      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.121      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.125      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.128      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.134      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.138      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.142      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.146      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.150      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.154      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.158      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.162      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.166      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.171      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.179      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.183      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.186      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.191      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.194      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.199      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.202      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.206      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.210      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.214      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.220      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.224      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.228      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.231      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.235      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.239      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.244      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.248      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.252      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.256      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.262      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.266      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.270      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.273      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.277      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.281      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.285      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.289      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.292      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786971.296      0 {client} NONE_ABORTED/200 0 CONNECT
> 34.107.221.82:80 - HIER_NONE/- -
> 1661786975.433      0 {client} NONE_ABORTED/200 0 CONNECT
> 151.101.3.5:80 - HIER_NONE/- -
> 1661786975.447      0 {client} NONE_ABORTED/200 0 CONNECT
> 151.101.3.5:80 - HIER_NONE/- -
> 1661786975.453      0 {client} NONE_ABORTED/200 0 CONNECT
> 151.101.3.5:80 - HIER_NONE/- -
> 1661786975.460      0 {client} NONE_ABORTED/200 0 CONNECT
> 151.101.3.5:80 - HIER_NONE/- -
> 1661786975.464      0 {client} NONE_ABORTED/200 0 CONNECT
> 151.101.3.5:80 - HIER_NONE/- -
> 1661786975.471      3 {client} NONE_ABORTED/200 0 CONNECT
> 151.101.3.5:80 - HIER_NONE/- -
> 1661786975.475      0 {client} NONE_ABORTED/200 0 CONNECT
> 151.101.3.5:80 - HIER_NONE/- -
> 1661786975.480      0 {client} NONE_ABORTED/200 0 CONNECT
> 151.101.3.5:80 - HIER_NONE/- -
> 1661786975.486      0 {client} NONE_ABORTED/200 0 CONNECT
> 151.101.3.5:80 - HIER_NONE/- -
> 1661786975.491      0 {client} NONE_ABORTED/200 0 CONNECT
> 151.101.3.5:80 - HIER_NONE/- -
> 1661786987.518      0 {client} NONE_ABORTED/200 0 CONNECT
> 172.217.18.238:80 - HIER_NONE/- -
> 1661786987.527      8 {client} NONE_ABORTED/200 0 CONNECT
> 172.217.18.238:80 - HIER_NONE/- -
> 1661786987.531      0 {client} NONE_ABORTED/200 0 CONNECT
> 172.217.18.238:80 - HIER_NONE/- -
> 1661786987.540      0 {client} NONE_ABORTED/200 0 CONNECT
> 172.217.18.238:80 - HIER_NONE/- -
> 1661786987.544      0 {client} NONE_ABORTED/200 0 CONNECT
> 172.217.18.238:80 - HIER_NONE/- -
> 1661786987.548      0 {client} NONE_ABORTED/200 0 CONNECT
> 172.217.18.238:80 - HIER_NONE/- -
> 1661786987.557      0 {client} NONE_ABORTED/200 0 CONNECT
> 172.217.18.238:80 - HIER_NONE/- -
> 1661786987.562      0 {client} NONE_ABORTED/200 0 CONNECT
> 172.217.18.238:80 - HIER_NONE/- -
> 1661786987.566      0 {client} NONE_ABORTED/200 0 CONNECT
> 172.217.18.238:80 - HIER_NONE/- -
> 1661786987.571      0 {client} NONE_ABORTED/200 0 CONNECT
> 172.217.18.238:80 - HIER_NONE/- -
>
> On Thu, Aug 18, 2022 at 4:05 PM <ngtech1ltd at gmail.com> wrote:
> >
> > Hey K,
> >
> > I need your Mikrotik and squid.conf and iptables to understand what the issue might be.
> > You will need to describe your setup in a way I can relate to it.
> > There is not much of a difference between port 80 to 443 just that the port need to have ssl-bump settings If you are using it.
> > The CONNECT port is a simple forward proxy and it seems your setup is not as simple as you describe.
> > If you do have NAT then you need this to be only on specific interfaces in the Mikrotik and the Squid server.
> >
> > In my case the basic setup works for a very long time now so I cannot imagine what's wrong in your case.
> >
> > Eliezer
> >
> > ----
> > Eliezer Croitoru
> > NgTech, Tech Support
> > Mobile: +972-5-28704261
> > Email: ngtech1ltd at gmail.com
> > Web: https://ngtech.co.il/
> > My-Tube: https://tube.ngtech.co.il/
> >
> > -----Original Message-----
> > From: M K <mohammed.khallaf at gmail.com>
> > Sent: Thursday, 18 August 2022 6:20
> > To: ngtech1ltd at gmail.com
> > Cc: squid-users at lists.squid-cache.org; Rafael Akchurin <rafael.akchurin at diladele.com>
> > Subject: Re: [squid-users] Squid 4.8+ intercept
> >
> > Hello Eliezer,
> >
> > I finally got my setup to work; turned out to be intercepted clients
> > running into default nat, while my test squid server did not allow
> > them access, not even through iptables!
> >
> > Now, I have one last bit to handle, which you did not cover in your
> > video. I'm using 3 ports for squid like Rafael's guide: one for normal
> > CONNECT, one for intercepted plain HTTP on 80, and one for intercepted
> > HTTPs on 443.
> >
> > The setup works awesome for TLS addresses (i.e https://), but browser
> > redirection from Plain to TLS, say from http://cnn.com to
> > https://cnn.com, fails to happen. It just waits then time out.
> > What could be done to make it happen?
> >
> > All best,
> > K
> >
> >
> > On Sat, Aug 13, 2022 at 7:57 PM <ngtech1ltd at gmail.com> wrote:
> > >
> > > Hey K,
> > >
> > >
> > >
> > > What RouterOS version are you using?
> > >
> > > Also, what rules have you applied?
> > >
> > > If there is a very long delay and then a failure you should verify that the rules you wrote are proper to your environment.
> > >
> > > You should route packets based on connection marks and mark only new connections from LAN IP addresses and only on the LAN interface.
> > >
> > > As I showed in the demo video it?s very simple to implement.
> > >
> > >
> > >
> > > Let me know if you are still having issues.
> > >
> > >
> > >
> > > Eliezer
> > >
> > >
> > >
> > > ----
> > >
> > > Eliezer Croitoru
> > >
> > > NgTech, Tech Support
> > >
> > > Mobile: +972-5-28704261
> > >
> > > Email: ngtech1ltd at gmail.com
> > >
> > > Web: https://ngtech.co.il/
> > >
> > > My-Tube: https://tube.ngtech.co.il/
> > >
> > >
> > >
> > > From: M K <mohammed.khallaf at gmail.com>
> > > Sent: Saturday, 13 August 2022 10:59
> > > To: ngtech1ltd at gmail.com
> > > Cc: squid-users at lists.squid-cache.org
> > > Subject: Re: [squid-users] Squid 4.8+ intercept
> > >
> > >
> > >
> > > Thank  you for your quick reply. The text-drawing actually changed with different font; the squid server is effectively connected to MikroTik router, not the same physical link as the client.
> > >
> > >
> > >
> > > The MikroTik router sits between the client and squid server.
> > >
> > >
> > >
> > > That said, I can confirm that the MikroTik router is effectively able to route/DNat client packets going to ports 80 and 443 to squid server. Depending on router rules be it route or dnat, the client browser effectively displays the error page of squid, or goes into a very long delay then failure.
> > >
> > >
> > >
> > > I will retry and let you know.
> > >
> > >
> > >
> > > K
> > >
> > > On Wed, Aug 10, 2022, 10:08 <ngtech1ltd at gmail.com> wrote:
> > >
> > > Hey K,
> > >
> > >
> > >
> > > I am not sure about the network topology.
> > >
> > > Preferably the Squid should reside on another network then the clients if it?s intercepting the traffic.
> > >
> > > Also, I assume it?s not a TPROXY setup so it should be pretty simple and straight forward.
> > >
> > >
> > >
> > > I understand why are you asking this question.
> > >
> > > Also take into account that Mikrotik is now on 7.4 firmware and it?s recommended to use this one.
> > >
> > > If you are using any other version let me know so I can try to make sense on the differences.
> > >
> > > I will try to give a DEMO for such a setup and how to make it work.
> > >
> > >
> > >
> > > Eliezer
> > >
> > >
> > >
> > > ----
> > >
> > > Eliezer Croitoru
> > >
> > > NgTech, Tech Support
> > >
> > > Mobile: +972-5-28704261
> > >
> > > Email: ngtech1ltd at gmail.com
> > >
> > > Web: https://ngtech.co.il/
> > >
> > > My-Tube: https://tube.ngtech.co.il/
> > >
> > >
> > >
> > > From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of M K
> > > Sent: Tuesday, 9 August 2022 22:29
> > > To: squid-users at lists.squid-cache.org
> > > Subject: [squid-users] Squid 4.8+ intercept
> > >
> > >
> > >
> > > Hello,
> > >
> > >
> > >
> > > I have a setup like this one:
> > >
> > >
> > > | Client | =====> | Router | =====> Internet
> > >                      ||
> > >                      \/
> > >                   | Squid |
> > >
> > >
> > >
> > > ...the router is a Mikrotik router capable of all things NAT/Redirect and whatnot. Squid server has only one network interface.
> > >
> > > Using the router:
> > >
> > > - I tried routing traffic to squid server IP.
> > >
> > > - I tried destination-NATing from client to server IP, with origin server IP-and-port natted to squid IP-and-port, and with origin server IP-only natted to squid-IP.
> > >
> > >
> > >
> > > I have been struggling for 2 days to setup a working Squid 4.8 or higher interception.
> > >
> > > Test server is running Ubuntu 18.4.3 and Squid 4.8.
> > >
> > > Documentation is either too much trim or extremely outdated.
> > >
> > > Any help would be very much appreciated.
> > >
> > >
> > >
> > > All best,
> > >
> > > K
> >


From davidtiagoff at gmail.com  Tue Aug 30 11:34:59 2022
From: davidtiagoff at gmail.com (David Ferreira)
Date: Tue, 30 Aug 2022 12:34:59 +0100
Subject: [squid-users] Squid 5.2 TCP_MISS_ABORTED/100 erros when
 uploading
In-Reply-To: <012e08ac-bf9d-2123-9f3f-8e9a1134e51a@measurement-factory.com>
References: <CAEJ1g5Kc0fdE82U+ede-wEfiyLRErxTPo2_BtpR1BzWY=72zig@mail.gmail.com>
 <654ad586-ff1a-35ff-5fb6-08272c5d8f0f@measurement-factory.com>
 <CAEJ1g5LYjh1ARKJXbQKm4GzBE5dZxqZLym3+g=MKkxpvOcq37w@mail.gmail.com>
 <012e08ac-bf9d-2123-9f3f-8e9a1134e51a@measurement-factory.com>
Message-ID: <CAEJ1g5LjsEyQWBOUtO9ki_zcsDFOShUh+rENBgahkBWGy7D87g@mail.gmail.com>

(forgot to reply all)
Hi alex,

I did a new capture like you said, since there's only a few http messages
in gonna post them here:

Squid 5.2:
dump -i ens224 -nn port 80 -s0 -w squid52output

POST /webserver/index.php HTTP/1.1
Accept-Encoding: deflate, gzip
Cookie: tickets[InDesign]=9ce90349BDxzBw6TeaGM1sYvG6dDlABl0NqbswO9;
tickets[]=716c37c9qD4eeMFPHZvbfAa8S7VMmLh3Skkgrb31;
AWSELB=0D3B27870CA3C45CF463C76E69DC284A499EFD0DF6EE047B11D31BB6D9B01943D41E6D72FB8A97227A031F20EAAC9364FE0968EA5AAEE1102734343F2F0133CD3A0C6A4A0C
Accept: */*
SOAPAction: "urn:#SaveObjects"
Content-Type: multipart/form-data; boundary=----------------7d123
Content-Length: 4277021
Expect: 100-continue
Host: webserverhost
Via: 1.1 squid5.2host (squid/5.2)
X-Forwarded-For: 172.19.222.132
Cache-Control: max-age=259200
Connection: keep-alive

HTTP/1.1 100 Continue

HTTP/1.1 503 Service Unavailable.
Content-length:0

POST /webserver/index.php HTTP/1.1
Accept-Encoding: deflate, gzip
Cookie: tickets[InDesign]=9ce90349BDxzBw6TeaGM1sYvG6dDlABl0NqbswO9;
tickets[]=716c37c9qD4eeMFPHZvbfAa8S7VMmLh3Skkgrb31;
AWSELB=0D3B27870CA3C45CF463C76E69DC284A499EFD0DF6EE047B11D31BB6D9B01943D41E6D72FB8A97227A031F20EAAC9364FE0968EA5AAEE1102734343F2F0133CD3A0C6A4A0C
Accept: */*
SOAPAction: "urn:#GetDialog"
Content-Type: multipart/form-data; boundary=----------------7d123
Content-Length: 1120
Expect: 100-continue
Host: webserverhost
Via: 1.1 squid5.2host (squid/5.2)
X-Forwarded-For: 172.19.222.132
Cache-Control: max-age=259200
Connection: keep-alive

HTTP/1.1 100 Continue

------
Squid 4.15:

dump -i ens224 -nn port 80 -s0 -w squid4.15output

POST /webserver/index.php HTTP/1.1
Accept-Encoding: deflate, gzip
Cookie: tickets[InDesign]=1ae95903t3jY2HDSgfvoEsfpsibbkf9mlNZ4eDjA;
tickets[]=716c37c9qD4eeMFPHZvbfAa8S7VMmLh3Skkgrb31;
AWSELB=0D3B27870CA3C45CF463C76E69DC284A499EFD0DF6EE047B11D31BB6D9B01943D41E6D72FB8A97227A031F20EAAC9364FE0968EA5AAEE1102734343F2F0133CD3A0C6A4A0C
Accept: */*
SOAPAction: "urn:#SaveObjects"
Content-Type: multipart/form-data; boundary=----------------7d123
Content-Length: 4272865
Expect: 100-continue
Host: webserverhost
Via: 1.1 squid4.15host (squid/4.15)
X-Forwarded-For: 172.19.222.132
Cache-Control: max-age=259200
Connection: keep-alive

HTTP/1.1 100 Continue

POST /webserver/index.php HTTP/1.1
Accept-Encoding: deflate, gzip
Cookie: tickets[InDesign]=1ae95903t3jY2HDSgfvoEsfpsibbkf9mlNZ4eDjA;
tickets[]=716c37c9qD4eeMFPHZvbfAa8S7VMmLh3Skkgrb31;
AWSELB=0D3B27870CA3C45CF463C76E69DC284A499EFD0DF6EE047B11D31BB6D9B01943D41E6D72FB8A97227A031F20EAAC9364FE0968EA5AAEE1102734343F2F0133CD3A0C6A4A0C
Accept: */*
SOAPAction: "urn:#UnlockObjects"
Content-Type: multipart/form-data; boundary=----------------7d123
Content-Length: 644
Host: webserverhost
Via: 1.1 squid4.15host (squid/4.15)
X-Forwarded-For: 172.19.222.132
Cache-Control: max-age=259200
Connection: keep-alive


HTTP/1.1 200 OK
Content-Type: text/xml; charset=utf-8
Date: Tue, 30 Aug 2022 10:52:05 GMT
Server: Apache/2.4.6 (CentOS) PHP/7.1.26
Set-Cookie: tickets[InDesign]=1ae95903t3jY2HDSgfvoEsfpsibbkf9mlNZ4eDjA;
expires=Wed, 31-Aug-2022 10:52:05 GMT; Max-Age=86400; path=/webserver;
HttpOnly
X-Powered-By: PHP/7.1.26
Content-Length: 266
Connection: keep-alive

Again thank you for you time.
David

On Mon, 29 Aug 2022 at 18:18, Alex Rousskov <
rousskov at measurement-factory.com> wrote:

> On 8/29/22 12:17, David Ferreira wrote:
>
> > I tried to capture the http trafic with the following tcpdump:
> >
> > tcpdump -i any -nn port 80|grep -i http
>
> I am not cool enough to easily grok this kind of output. Please share (a
> link to) the packet capture file instead (tcpdump -s0 -w filename ...).
>
> Thank you,
>
> Alex.
>
>
> > Notes:
> > - 1.2.3.4 is the webserver ip
> > - 10.185.23.202 is the squid machine outbound interface
> >
> > Here's the results:
> >
> > Squid 4.15(Working one):
> >
> > ---
> > Im not that familiar with tcpdump, if there's a better way to capture
> > please say so, im also gonna build a squid v5 to test it out.
> >
> > Again, thanks for your time
> >
> >
> > On Mon, 29 Aug 2022 at 13:52, Alex Rousskov
> > <rousskov at measurement-factory.com
> > <mailto:rousskov at measurement-factory.com>> wrote:
> >
> >     On 8/29/22 06:17, David Ferreira wrote:
> >
> >      > I have some squid's running on rocky linux 8 with verion 4.15,
> >     recently
> >      > been testing squid version 5.2(stable version that comes with
> >     Rocky 9)to
> >      > upgrade the current ones and most of the configs/acls seem to
> >     work fine.
> >      >
> >      > Unfortualy theres an application that we use that everytime it
> >     tries to
> >      > upload files it fails on squid 5.2, on 4.15 is works completly
> >     fine, so
> >      > far ive test on squid 5.2 and 5.5 and it's the same behavior, im
> >     testing
> >      > this with default configurations and it always works on 4.15,
> >     access log
> >      > only shows this:
> >      >
> >      > Squid 4.15:
> >      > 26/Aug/2022:15:36:08 +0100    273 172.19.222.132TCP_MISS/200 745
> >     POST http://websiteurl/index.php <http://websiteurl/index.php> -
> >     HIER_DIRECT/websitedomain text/xml
> >      >
> >      > Squid 5.2:
> >      > 25/Aug/2022:15:10:00 +0100    139 172.19.222.132
> >     TCP_MISS_ABORTED/100 0 POST http://websiteurl <http://websiteurl>
> >     HIER_DIRECT/websitedomain -
> >      >
> >      > anyone has an ideia of what may be happening here?, been
> >     searching about
> >      > http errors 100 and so far i did not find anything that points me
> >     to the
> >      > problem.
> >      >
> >      > On the application side the error it shows when it tries to
> >     upload is:
> >      > "
> >      > Error storing the document on the server
> >      > Detail HTTP error 100
> >      > Send failure: Connection was aborted (55)
> >      > "
> >
> >     Squid v5.2 has many serious bugs. I would not use it in production.
> >     Build the latest Squid v5 from sources if you have to.
> >
> >
> >     If the latest Squid v5 shows the same problem then this is probably a
> >     client application or Squid bug/misconfiguration. There were quite a
> >     few
> >     changes in HTTP 1xx control message handling since Squid v4, and one
> of
> >     those changes is probably affecting your client. For example, either
> >     Squid v4 does not deliver that 100 control message to the client at
> all
> >     or it is delivering a slightly different 100 control message that
> your
> >     client is happy with.
> >        If you share what HTTP messages are exchanged between client and
> >     Squid
> >     and between Squid and the origin server, in both successful and
> failing
> >     use cases, we may be able to tell you more. I would use tcpdump,
> >     wireshark, or a similar tool to collect HTTP traffic since these are
> >     non-TLS transactions.
> >
> >
> >     HTH,
> >
> >     Alex.
> >     _______________________________________________
> >     squid-users mailing list
> >     squid-users at lists.squid-cache.org
> >     <mailto:squid-users at lists.squid-cache.org>
> >     http://lists.squid-cache.org/listinfo/squid-users
> >     <http://lists.squid-cache.org/listinfo/squid-users>
> >
> >
> >
> > --
> > Com os melhores cumprimentos,
> >
> > David Ferreira
>
>

-- 
Com os melhores cumprimentos,

David Ferreira
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220830/2b9593c5/attachment.htm>

From rousskov at measurement-factory.com  Tue Aug 30 14:18:15 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Tue, 30 Aug 2022 10:18:15 -0400
Subject: [squid-users] Squid 5.2 TCP_MISS_ABORTED/100 erros when
 uploading
In-Reply-To: <CAEJ1g5LjsEyQWBOUtO9ki_zcsDFOShUh+rENBgahkBWGy7D87g@mail.gmail.com>
References: <CAEJ1g5Kc0fdE82U+ede-wEfiyLRErxTPo2_BtpR1BzWY=72zig@mail.gmail.com>
 <654ad586-ff1a-35ff-5fb6-08272c5d8f0f@measurement-factory.com>
 <CAEJ1g5LYjh1ARKJXbQKm4GzBE5dZxqZLym3+g=MKkxpvOcq37w@mail.gmail.com>
 <012e08ac-bf9d-2123-9f3f-8e9a1134e51a@measurement-factory.com>
 <CAEJ1g5LjsEyQWBOUtO9ki_zcsDFOShUh+rENBgahkBWGy7D87g@mail.gmail.com>
Message-ID: <79fba46f-474d-9c94-7389-d139a0ea38b2@measurement-factory.com>

On 8/30/22 07:34, David Ferreira wrote:

> I did a new capture like you said, since there's only a few http 
> messages in gonna post them here:

Perhaps others will be able to spot the answer in your narration of the 
captured packets, but I am missing critical details like timestamps and 
connection IDs to interpret this correctly. For example, I cannot tell 
who sends the "HTTP/1.1 503 Service Unavailable" response -- Squid or 
the origin server -- and _when_. Also, there may be critical low-level 
details like unusual whitespace characters or missing delimiters that 
cannot be easily relayed when one copy-pastes high-level details.

Needless to say, all those details may not help reveal the answer 
either, but there is a chance that they will help. If you can share (a 
link to) the actual packet capture containing these messages (i.e. the 
files saved by tcpdump), please do so. Compress the file if needed. Feel 
free to do that privately if you prefer.

I regret that this triage requires so many iterations.

Alex.


> Squid 5.2:
> dump -i ens224 -nn port 80 -s0 -w squid52output
> 
> POST /webserver/index.php HTTP/1.1
> Accept-Encoding: deflate, gzip
> Cookie: tickets[InDesign]=9ce90349BDxzBw6TeaGM1sYvG6dDlABl0NqbswO9; 
> tickets[]=716c37c9qD4eeMFPHZvbfAa8S7VMmLh3Skkgrb31; 
> AWSELB=0D3B27870CA3C45CF463C76E69DC284A499EFD0DF6EE047B11D31BB6D9B01943D41E6D72FB8A97227A031F20EAAC9364FE0968EA5AAEE1102734343F2F0133CD3A0C6A4A0C
> Accept: */*
> SOAPAction: "urn:#SaveObjects"
> Content-Type: multipart/form-data; boundary=----------------7d123
> Content-Length: 4277021
> Expect: 100-continue
> Host: webserverhost
> Via: 1.1 squid5.2host (squid/5.2)
> X-Forwarded-For: 172.19.222.132
> Cache-Control: max-age=259200
> Connection: keep-alive
> 
> HTTP/1.1 100 Continue
> 
> HTTP/1.1 503 Service Unavailable.
> Content-length:0
> 
> POST /webserver/index.php HTTP/1.1
> Accept-Encoding: deflate, gzip
> Cookie: tickets[InDesign]=9ce90349BDxzBw6TeaGM1sYvG6dDlABl0NqbswO9; 
> tickets[]=716c37c9qD4eeMFPHZvbfAa8S7VMmLh3Skkgrb31; 
> AWSELB=0D3B27870CA3C45CF463C76E69DC284A499EFD0DF6EE047B11D31BB6D9B01943D41E6D72FB8A97227A031F20EAAC9364FE0968EA5AAEE1102734343F2F0133CD3A0C6A4A0C
> Accept: */*
> SOAPAction: "urn:#GetDialog"
> Content-Type: multipart/form-data; boundary=----------------7d123
> Content-Length: 1120
> Expect: 100-continue
> Host: webserverhost
> Via: 1.1 squid5.2host (squid/5.2)
> X-Forwarded-For: 172.19.222.132
> Cache-Control: max-age=259200
> Connection: keep-alive
> 
> HTTP/1.1 100 Continue
> 
> ------
> Squid 4.15:
> 
> dump -i ens224 -nn port 80 -s0 -w squid4.15output
> 
> POST /webserver/index.php HTTP/1.1
> Accept-Encoding: deflate, gzip
> Cookie: tickets[InDesign]=1ae95903t3jY2HDSgfvoEsfpsibbkf9mlNZ4eDjA; 
> tickets[]=716c37c9qD4eeMFPHZvbfAa8S7VMmLh3Skkgrb31; 
> AWSELB=0D3B27870CA3C45CF463C76E69DC284A499EFD0DF6EE047B11D31BB6D9B01943D41E6D72FB8A97227A031F20EAAC9364FE0968EA5AAEE1102734343F2F0133CD3A0C6A4A0C
> Accept: */*
> SOAPAction: "urn:#SaveObjects"
> Content-Type: multipart/form-data; boundary=----------------7d123
> Content-Length: 4272865
> Expect: 100-continue
> Host: webserverhost
> Via: 1.1 squid4.15host (squid/4.15)
> X-Forwarded-For: 172.19.222.132
> Cache-Control: max-age=259200
> Connection: keep-alive
> 
> HTTP/1.1 100 Continue
> 
> POST /webserver/index.php HTTP/1.1
> Accept-Encoding: deflate, gzip
> Cookie: tickets[InDesign]=1ae95903t3jY2HDSgfvoEsfpsibbkf9mlNZ4eDjA; 
> tickets[]=716c37c9qD4eeMFPHZvbfAa8S7VMmLh3Skkgrb31; 
> AWSELB=0D3B27870CA3C45CF463C76E69DC284A499EFD0DF6EE047B11D31BB6D9B01943D41E6D72FB8A97227A031F20EAAC9364FE0968EA5AAEE1102734343F2F0133CD3A0C6A4A0C
> Accept: */*
> SOAPAction: "urn:#UnlockObjects"
> Content-Type: multipart/form-data; boundary=----------------7d123
> Content-Length: 644
> Host: webserverhost
> Via: 1.1 squid4.15host (squid/4.15)
> X-Forwarded-For: 172.19.222.132
> Cache-Control: max-age=259200
> Connection: keep-alive
> 
> 
> HTTP/1.1 200 OK
> Content-Type: text/xml; charset=utf-8
> Date: Tue, 30 Aug 2022 10:52:05 GMT
> Server: Apache/2.4.6 (CentOS) PHP/7.1.26
> Set-Cookie: tickets[InDesign]=1ae95903t3jY2HDSgfvoEsfpsibbkf9mlNZ4eDjA; 
> expires=Wed, 31-Aug-2022 10:52:05 GMT; Max-Age=86400; path=/webserver; 
> HttpOnly
> X-Powered-By: PHP/7.1.26
> Content-Length: 266
> Connection: keep-alive
> 
> Again thank you for you time.
> David
> 
> On Mon, 29 Aug 2022 at 18:18, Alex Rousskov 
> <rousskov at measurement-factory.com 
> <mailto:rousskov at measurement-factory.com>> wrote:
> 
>     On 8/29/22 12:17, David Ferreira wrote:
> 
>      > I tried to capture the http trafic with the following tcpdump:
>      >
>      > tcpdump -i any -nn port 80|grep -i http
> 
>     I am not cool enough to easily grok this kind of output. Please
>     share (a
>     link to) the packet capture file instead (tcpdump -s0 -w filename ...).
> 
>     Thank you,
> 
>     Alex.
> 
> 
>      > Notes:
>      > - 1.2.3.4 is the webserver ip
>      > - 10.185.23.202 is the squid machine outbound interface
>      >
>      > Here's the results:
>      >
>      > Squid 4.15(Working one):
>      >
>      > ---
>      > Im not that familiar with tcpdump, if there's a better way to
>     capture
>      > please say so, im also gonna build a squid v5 to test it out.
>      >
>      > Again, thanks for your time
>      >
>      >
>      > On Mon, 29 Aug 2022 at 13:52, Alex Rousskov
>      > <rousskov at measurement-factory.com
>     <mailto:rousskov at measurement-factory.com>
>      > <mailto:rousskov at measurement-factory.com
>     <mailto:rousskov at measurement-factory.com>>> wrote:
>      >
>      >? ? ?On 8/29/22 06:17, David Ferreira wrote:
>      >
>      >? ? ? > I have some squid's running on rocky linux 8 with verion 4.15,
>      >? ? ?recently
>      >? ? ? > been testing squid version 5.2(stable version that comes with
>      >? ? ?Rocky 9)to
>      >? ? ? > upgrade the current ones and most of the configs/acls seem to
>      >? ? ?work fine.
>      >? ? ? >
>      >? ? ? > Unfortualy theres an application that we use that everytime it
>      >? ? ?tries to
>      >? ? ? > upload files it fails on squid 5.2, on 4.15 is works completly
>      >? ? ?fine, so
>      >? ? ? > far ive test on squid 5.2 and 5.5 and it's the same
>     behavior, im
>      >? ? ?testing
>      >? ? ? > this with default configurations and it always works on 4.15,
>      >? ? ?access log
>      >? ? ? > only shows this:
>      >? ? ? >
>      >? ? ? > Squid 4.15:
>      >? ? ? > 26/Aug/2022:15:36:08 +0100 ???273
>     172.19.222.132TCP_MISS/200 745
>      >? ? ?POST http://websiteurl/index.php
>     <http://websiteurl/index.php> <http://websiteurl/index.php
>     <http://websiteurl/index.php>> -
>      >? ? ?HIER_DIRECT/websitedomain text/xml
>      >? ? ? >
>      >? ? ? > Squid 5.2:
>      >? ? ? > 25/Aug/2022:15:10:00 +0100 ???139 172.19.222.132
>      >? ? ?TCP_MISS_ABORTED/100 0 POST http://websiteurl
>     <http://websiteurl> <http://websiteurl <http://websiteurl>>
>      >? ? ?HIER_DIRECT/websitedomain -
>      >? ? ? >
>      >? ? ? > anyone has an ideia of what may be happening here?, been
>      >? ? ?searching about
>      >? ? ? > http errors 100 and so far i did not find anything that
>     points me
>      >? ? ?to the
>      >? ? ? > problem.
>      >? ? ? >
>      >? ? ? > On the application side the error it shows when it tries to
>      >? ? ?upload is:
>      >? ? ? > "
>      >? ? ? > Error storing the document on the server
>      >? ? ? > Detail HTTP error 100
>      >? ? ? > Send failure: Connection was aborted (55)
>      >? ? ? > "
>      >
>      >? ? ?Squid v5.2 has many serious bugs. I would not use it in
>     production.
>      >? ? ?Build the latest Squid v5 from sources if you have to.
>      >
>      >
>      >? ? ?If the latest Squid v5 shows the same problem then this is
>     probably a
>      >? ? ?client application or Squid bug/misconfiguration. There were
>     quite a
>      >? ? ?few
>      >? ? ?changes in HTTP 1xx control message handling since Squid v4,
>     and one of
>      >? ? ?those changes is probably affecting your client. For example,
>     either
>      >? ? ?Squid v4 does not deliver that 100 control message to the
>     client at all
>      >? ? ?or it is delivering a slightly different 100 control message
>     that your
>      >? ? ?client is happy with.
>      >? ? ? ? If you share what HTTP messages are exchanged between
>     client and
>      >? ? ?Squid
>      >? ? ?and between Squid and the origin server, in both successful
>     and failing
>      >? ? ?use cases, we may be able to tell you more. I would use tcpdump,
>      >? ? ?wireshark, or a similar tool to collect HTTP traffic since
>     these are
>      >? ? ?non-TLS transactions.
>      >
>      >
>      >? ? ?HTH,
>      >
>      >? ? ?Alex.
>      >? ? ?_______________________________________________
>      >? ? ?squid-users mailing list
>      > squid-users at lists.squid-cache.org
>     <mailto:squid-users at lists.squid-cache.org>
>      >? ? ?<mailto:squid-users at lists.squid-cache.org
>     <mailto:squid-users at lists.squid-cache.org>>
>      > http://lists.squid-cache.org/listinfo/squid-users
>     <http://lists.squid-cache.org/listinfo/squid-users>
>      >? ? ?<http://lists.squid-cache.org/listinfo/squid-users
>     <http://lists.squid-cache.org/listinfo/squid-users>>
>      >
>      >
>      >
>      > --
>      > Com os melhores cumprimentos,
>      >
>      > David Ferreira
> 
> 
> 
> -- 
> Com os melhores cumprimentos,
> 
> David Ferreira



From yaemish at gmail.com  Tue Aug 30 17:32:21 2022
From: yaemish at gmail.com (Chris XMT)
Date: Tue, 30 Aug 2022 13:32:21 -0400
Subject: [squid-users] Capture incoming information from one squid to
 another.
In-Reply-To: <540b3572-6ce0-11ab-3fa0-544f651d4670@measurement-factory.com>
References: <002401d8b112$7acb9680$7062c380$@graminsta.com.br>
 <540b3572-6ce0-11ab-3fa0-544f651d4670@measurement-factory.com>
Message-ID: <CAOTryrJTqTsJJk-EkhEe50AViia1qVEdqgO9VtEZcqFv1fHvNw@mail.gmail.com>

I'm still not having any luck.  I'd like to just leave it open and I
understand that it could be abused.  My "CURL" results are;

curl -v --proxy http://SQUID_SERVER:3128 <http://squid_server:3128/> -I
http://www.example.com

* About to connect() to proxy SQUID_SERVER port 3128 (#0)

*   Trying xxx.xxx.xxx.xxx...

* Connected to SQUID_SERVER (xxx.xxx.xxx.xxx) port 3128 (#0)

> HEAD http://www.example.com/ HTTP/1.1

> User-Agent: curl/7.29.0

> Host: www.example.com

> Accept: */*

> Proxy-Connection: Keep-Alive

>

* Empty reply from server

* Connection #0 to host SQUID_SERVER left intact

curl: (52) Empty reply from server


This is my configuration;

dns_v4_first on

never_direct allow all

sslproxy_cert_error allow all



http_port 3128 intercept

acl all src all

http_access allow all



acl Safe_ports port 443

acl Safe_ports port 80          # http

http_access deny !Safe_ports



acl http proto http

acl port_80 port 80

acl port_443 port 443

acl CONNECT method CONNECT


debug_options ALL,1 33,2 28,9

On Wed, Aug 17, 2022 at 2:01 PM Alex Rousskov <
rousskov at measurement-factory.com> wrote:

> On 8/15/22 21:49, Marcelo wrote:
>
> > How can I transfer connection information from one squid server to
> another?
>
> Use cache_peer login=PASSTHRU or login=PASS. Other login=... options may
> also be of interest. See cache_peer documentation in your
> squid.conf.documented for details and caveats.
>
>
> HTH,
>
> Alex.
>
>
> > Example:
> >
> > An user connects to Squid One (Squid One IP 192.1.1.1) through port 4000
> > using usr/pw credentials.
> >
> > Squid One authenticates it via SQL DB. This part is already working fine.
> >
> > Squid One verifies if destination website is in dst domain list.
> >
> > If yes Squid One routes it to Route A. End of story.
> >
> > If no Squid One routes it to Squid Two.
> >
> > But Squid One must inform Squid Two who is the user and witch port he
> > asked to connect.
> >
> > Why? Because Squid Two must use this info as if the user itself is
> > connecting to Squid Two.
> > Why, again? Because Squid Two will use this info to route this user to
> > the correct route. This part is also done.
> >
> > My doubt is, is there a way to make Squid Two ?thinks? that user is
> > connecting direct to Squid Two, so that, Squid Two can use user/port
> > information to route this poor little guy.
> >
> > It?s a bit hard to explain it through email.
> >
> > Best Regards.
> >
> > Marcelo.
> >
> >
> > _______________________________________________
> > squid-users mailing list
> > squid-users at lists.squid-cache.org
> > http://lists.squid-cache.org/listinfo/squid-users
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220830/f6595eaa/attachment.htm>

From rousskov at measurement-factory.com  Tue Aug 30 21:00:53 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Tue, 30 Aug 2022 17:00:53 -0400
Subject: [squid-users] Capture incoming information from one squid to
 another.
In-Reply-To: <CAOTryrJTqTsJJk-EkhEe50AViia1qVEdqgO9VtEZcqFv1fHvNw@mail.gmail.com>
References: <002401d8b112$7acb9680$7062c380$@graminsta.com.br>
 <540b3572-6ce0-11ab-3fa0-544f651d4670@measurement-factory.com>
 <CAOTryrJTqTsJJk-EkhEe50AViia1qVEdqgO9VtEZcqFv1fHvNw@mail.gmail.com>
Message-ID: <7df39acf-8a56-889f-2050-0aab5ad2ca7d@measurement-factory.com>

Chris,

     Your [open proxy] configuration prohibits Squid from going direct 
("never_direct allow all") but does not configure any cache_peers as an 
alternative. Thus, Squid cannot forward any requests. Either remove 
never_direct or add cache_peer(s). I recommend the former as a simpler 
starting point.

Also, AFAICT, you are using direct curl-to-Squid TCP connections while 
testing an http_port configured for _intercepted_ traffic. Perhaps that 
explains why Squid does not even respond with an error page, but I am 
not sure.


HTH,

Alex.


On 8/30/22 13:32, Chris XMT wrote:
> I'm still not having any luck.? I'd like to just leave it open and I 
> understand that it could be abused.? My "CURL" results are;
> 
> curl -v --proxy http://SQUID_SERVER:3128 -I http://www.example.com
> 
> * About to connect() to proxy SQUID_SERVER port 3128 (#0)____
> 
> *?? Trying xxx.xxx.xxx.xxx...____
> 
> * Connected to SQUID_SERVER (xxx.xxx.xxx.xxx) port 3128 (#0)____
> 
>  > HEAD http://www.example.com/ <http://www.example.com/>?HTTP/1.1____
> 
>  > User-Agent: curl/7.29.0____
> 
>  > Host: www.example.com <http://www.example.com/>____
> 
>  > Accept: */*____
> 
>  > Proxy-Connection: Keep-Alive____
> 
>  >__ __
> 
> * Empty reply from server____
> 
> * Connection #0 to host SQUID_SERVER left intact____
> 
> curl: (52) Empty reply from server
> 
> 
> 
> This is my configuration;
> 
> dns_v4_first on
> 
> __
> 
> never_direct allow all
> 
> __
> 
> sslproxy_cert_error allow all____
> 
> __
> 
> http_port 3128 intercept____
> 
> acl all src all____
> 
> http_access allow all
> 
> __
> 
> __
> 
> acl Safe_ports port 443____
> 
> acl Safe_ports port 80????????? # http____
> 
> http_access deny !Safe_ports____
> 
> __ __
> 
> acl http proto http____
> 
> acl port_80 port 80____
> 
> acl port_443 port 443____
> 
> acl CONNECT method CONNECT____
> 
> __
> 
> debug_options ALL,1 33,2 28,9
> 
> 
> On Wed, Aug 17, 2022 at 2:01 PM Alex Rousskov 
> <rousskov at measurement-factory.com 
> <mailto:rousskov at measurement-factory.com>> wrote:
> 
>     On 8/15/22 21:49, Marcelo wrote:
> 
>      > How can I transfer connection information from one squid server
>     to another?
> 
>     Use cache_peer login=PASSTHRU or login=PASS. Other login=... options
>     may
>     also be of interest. See cache_peer documentation in your
>     squid.conf.documented for details and caveats.
> 
> 
>     HTH,
> 
>     Alex.
> 
> 
>      > Example:
>      >
>      > An user connects to Squid One (Squid One IP 192.1.1.1) through
>     port 4000
>      > using usr/pw credentials.
>      >
>      > Squid One authenticates it via SQL DB. This part is already
>     working fine.
>      >
>      > Squid One verifies if destination website is in dst domain list.
>      >
>      > If yes Squid One routes it to Route A. End of story.
>      >
>      > If no Squid One routes it to Squid Two.
>      >
>      > But Squid One must inform Squid Two who is the user and witch
>     port he
>      > asked to connect.
>      >
>      > Why? Because Squid Two must use this info as if the user itself is
>      > connecting to Squid Two.
>      > Why, again? Because Squid Two will use this info to route this
>     user to
>      > the correct route. This part is also done.
>      >
>      > My doubt is, is there a way to make Squid Two ?thinks? that user is
>      > connecting direct to Squid Two, so that, Squid Two can use user/port
>      > information to route this poor little guy.
>      >
>      > It?s a bit hard to explain it through email.
>      >
>      > Best Regards.
>      >
>      > Marcelo.
>      >
>      >
>      > _______________________________________________
>      > squid-users mailing list
>      > squid-users at lists.squid-cache.org
>     <mailto:squid-users at lists.squid-cache.org>
>      > http://lists.squid-cache.org/listinfo/squid-users
>     <http://lists.squid-cache.org/listinfo/squid-users>
> 
>     _______________________________________________
>     squid-users mailing list
>     squid-users at lists.squid-cache.org
>     <mailto:squid-users at lists.squid-cache.org>
>     http://lists.squid-cache.org/listinfo/squid-users
>     <http://lists.squid-cache.org/listinfo/squid-users>
> 



