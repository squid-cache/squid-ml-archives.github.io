<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] regex for normal websites
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20regex%20for%20normal%20websites&In-Reply-To=%3C202208021418.05293.Antony.Stone%40squid.open.source.it%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025040.html">
   <LINK REL="Next"  HREF="025047.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] regex for normal websites</H1>
    <B>Antony Stone</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20regex%20for%20normal%20websites&In-Reply-To=%3C202208021418.05293.Antony.Stone%40squid.open.source.it%3E"
       TITLE="[squid-users] regex for normal websites">Antony.Stone at squid.open.source.it
       </A><BR>
    <I>Tue Aug  2 12:18:05 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025040.html">[squid-users] regex for normal websites
</A></li>
        <LI>Next message (by thread): <A HREF="025047.html">[squid-users] regex for normal websites
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25043">[ date ]</a>
              <a href="thread.html#25043">[ thread ]</a>
              <a href="subject.html#25043">[ subject ]</a>
              <a href="author.html#25043">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tuesday 02 August 2022 at 14:14:58, robert k Wild wrote:

&gt;<i> ok i have tested and this works
</I>&gt;<i> 
</I>&gt;<i> adobe\.com$
</I>&gt;<i> 
</I>&gt;<i> i found it weird this didnt work
</I>&gt;<i> 
</I>&gt;<i> \.adobe\.com
</I>&gt;<i> 
</I>&gt;<i> just curious thats all
</I>
Please define &quot;works&quot; and &quot;didn't work&quot; - I've pretty much lost track of 
exactly what you want to match here :(


Antony.

&gt;<i> On Tue, 2 Aug 2022 at 13:05, &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt; I believe it should have been:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; ^adobe\.com$
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; ^.*\.adobe\.com$
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; ^\*\.adobe\.com$
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; But I don&#8217;t know the code to this depth.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; If I would have written the match I think it would have been something a
</I>&gt;<i> &gt; bit different.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt;    - A match for SNI
</I>&gt;<i> &gt;    - A joker match for SAN ie *.adobe.com SAN should catch both
</I>&gt;<i> &gt;    www.www.adobe.com
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; But for some reason it&#8217;s not like that, I assume the browsers and the
</I>&gt;<i> &gt; libraries doesn&#8217;t implement it for an unknown reason.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; If Alex or anyone else from Factory knows the details of the ACL they can
</I>&gt;<i> &gt; answer more then me.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Thanks,
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Eliezer
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; ----
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Eliezer Croitoru
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; NgTech, Tech Support
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Mobile: +972-5-28704261
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A>
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Web: <A HREF="https://ngtech.co.il/">https://ngtech.co.il/</A>
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; My-Tube: <A HREF="https://tube.ngtech.co.il/">https://tube.ngtech.co.il/</A>
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; *From:* robert k Wild &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">robertkwild at gmail.com</A>&gt;
</I>&gt;<i> &gt; *Sent:* Tuesday, 2 August 2022 14:51
</I>&gt;<i> &gt; *To:* Eliezer Croitoru &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A>&gt;
</I>&gt;<i> &gt; *Cc:* Squid Users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i> &gt; *Subject:* Re: [squid-users] regex for normal websites
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; thanks Eliezer
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; so it should be
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; adobe\.com
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; not
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; .adobe.\com or
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; ^.*adobe.com
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; as the ^.* could include
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; blahadobe.com
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; On Thu, 28 Jul 2022 at 08:14, &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Hey Robert,
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; The docs at <A HREF="http://www.squid-cache.org/Doc/config/acl/">http://www.squid-cache.org/Doc/config/acl/</A>  states:
</I>&gt;<i> &gt;         acl aclname ssl::server_name_regex [-i] \.foo\.com ...
</I>&gt;<i> &gt;         
</I>&gt;<i> &gt;           # regex matches server name obtained from various sources
</I>&gt;<i> &gt;           [fast]
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Which and I do not know exactly what it means but it will not work with a
</I>&gt;<i> &gt; helper in most cases.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; I have found the in the git the next sources:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; <A HREF="https://github.com/squid-cache/squid/blob/bf95c10aa95bf8e56d9d8d1545cb5a3">https://github.com/squid-cache/squid/blob/bf95c10aa95bf8e56d9d8d1545cb5a3</A>
</I>&gt;<i> &gt; aafab0d2c/doc/release-notes/release-3.5.sgml#L414
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt;                 New types ssl::server_name  and ssl::server_name_regex
</I>&gt;<i> &gt;                 
</I>&gt;<i> &gt;                    to match server name from various sources (CONNECT
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; authority name,
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt;                    TLS SNI domain, or X.509 certificate Subject Name).
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Which means that there is a set of checks which the acl does and not just
</I>&gt;<i> &gt; a domain name.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; It&#8217;s also even possible that the domain name is not know in the CONNECT
</I>&gt;<i> &gt; state of the connection.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; If I remember correctly there is a possibility for browsers to use the
</I>&gt;<i> &gt; same exact connection for multiple domains but
</I>&gt;<i> &gt; I have not seen this yet in production.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; With Squid once you bump the connection to HTTP/1.x you can make 100%
</I>&gt;<i> &gt; sure the features of the Host header request.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; At Servername.cc ie:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; <A HREF="https://github.com/squid-cache/squid/blob/aee3523a768aff4d1e6c1195c4a401b">https://github.com/squid-cache/squid/blob/aee3523a768aff4d1e6c1195c4a401b</A>
</I>&gt;<i> &gt; 4ef5688a0/src/acl/ServerName.cc#L81
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; There is a specific logic of what is done and what is matched but I am
</I>&gt;<i> &gt; not sure what would be used in the case of:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; *.adobe.com
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Certificate SAN.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Specifically This part of the Common Names ie SAN:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; <A HREF="https://github.com/squid-cache/squid/blob/aee3523a768aff4d1e6c1195c4a401b">https://github.com/squid-cache/squid/blob/aee3523a768aff4d1e6c1195c4a401b</A>
</I>&gt;<i> &gt; 4ef5688a0/src/acl/ServerName.cc#L105
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; which to my understanding points to:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; <A HREF="https://github.com/squid-cache/squid/blob/d146da3bfe7083381ae7ab38640cbfd">https://github.com/squid-cache/squid/blob/d146da3bfe7083381ae7ab38640cbfd</A>
</I>&gt;<i> &gt; 0d2542374/src/ssl/support.cc#L195
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; doesn&#8217;t make any sense to me.( didn&#8217;t tried that much to understand)
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; If someone might be able to make sense of things in a synchronic fashion
</I>&gt;<i> &gt; it would help.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; (I do not see any debugs usage there or any helping comment )
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Thanks,
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Eliezer
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; ----
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Eliezer Croitoru
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; NgTech, Tech Support
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Mobile: +972-5-28704261
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A>
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Web: <A HREF="https://ngtech.co.il/">https://ngtech.co.il/</A>
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; My-Tube: <A HREF="https://tube.ngtech.co.il/">https://tube.ngtech.co.il/</A>
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; *From:* squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; *On
</I>&gt;<i> &gt; Behalf Of *robert k Wild
</I>&gt;<i> &gt; *Sent:* Wednesday, 27 July 2022 13:52
</I>&gt;<i> &gt; *To:* Squid Users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i> &gt; *Subject:* Re: [squid-users] regex for normal websites
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; that's the weird thing, when i try this in  &quot;ssl::server_name_regex&quot;
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; .adobe.com
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; it doesnt work
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; you mean escape ie the \ character
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; On Wed, 27 Jul 2022 at 11:05, Matus UHLAR - fantomas &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">uhlar at fantomas.sk</A>&gt;
</I>&gt;<i> &gt; wrote:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; On 27.07.22 10:54, robert k Wild wrote:
</I>&gt;<i> &gt; &gt;think i got it right but just want to double check with you guys
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;so in my &quot;ssl::server_name&quot; i had
</I>&gt;<i> &gt; &gt;.adobe.com
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;that worked but i want to mix normal website and regex websites together
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; so
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; &gt;i just have one list for all
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; didn't the above work?  AFAIK it should, IIRC domain matching in squid
</I>&gt;<i> &gt; matches &quot;domain.com&quot; if you check for &quot;.domain.com&quot;.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; &gt;i now have this for &quot;ssl::server_name_regex&quot;
</I>&gt;<i> &gt; &gt;^.*adobe.com$
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;it works, so im guessing its right
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; the dot should be escaped
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; --
</I>&gt;<i> &gt; Matus UHLAR - fantomas, <A HREF="https://lists.squid-cache.org/listinfo/squid-users">uhlar at fantomas.sk</A> ; <A HREF="http://www.fantomas.sk/">http://www.fantomas.sk/</A>
</I>&gt;<i> &gt; Warning: I wish NOT to receive e-mail advertising to this address.
</I>&gt;<i> &gt; Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
</I>&gt;<i> &gt; BSE = Mad Cow Desease ... BSA = Mad Software Producents Desease
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; squid-users mailing list
</I>&gt;<i> &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> &gt; <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; --
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Regards,
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Robert K Wild.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; squid-users mailing list
</I>&gt;<i> &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> &gt; <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; --
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Regards,
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Robert K Wild.
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025040.html">[squid-users] regex for normal websites
</A></li>
	<LI>Next message (by thread): <A HREF="025047.html">[squid-users] regex for normal websites
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25043">[ date ]</a>
              <a href="thread.html#25043">[ thread ]</a>
              <a href="subject.html#25043">[ subject ]</a>
              <a href="author.html#25043">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
