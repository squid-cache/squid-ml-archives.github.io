<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Problem caching range requests with range_offset_limit
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Problem%20caching%20range%20requests%20with%20range_offset_limit&In-Reply-To=%3CCA%2BE%2BeSCSC_ReYmeJR1O7vNaVu5ix65NdQgL18Kd9EqYb8AWqdg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025105.html">
   <LINK REL="Next"  HREF="025097.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Problem caching range requests with range_offset_limit</H1>
    <B>osy</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Problem%20caching%20range%20requests%20with%20range_offset_limit&In-Reply-To=%3CCA%2BE%2BeSCSC_ReYmeJR1O7vNaVu5ix65NdQgL18Kd9EqYb8AWqdg%40mail.gmail.com%3E"
       TITLE="[squid-users] Problem caching range requests with range_offset_limit">osy at turing.llc
       </A><BR>
    <I>Thu Aug 11 02:43:35 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025105.html">[squid-users] Squid 4.8+ intercept
</A></li>
        <LI>Next message (by thread): <A HREF="025097.html">[squid-users] Problem caching range requests with range_offset_limit
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25096">[ date ]</a>
              <a href="thread.html#25096">[ thread ]</a>
              <a href="subject.html#25096">[ subject ]</a>
              <a href="author.html#25096">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I am trying to cache Azure objects. I have SSL bump and the following config:

maximum_object_size 1000 MB
acl azure_storage dstdomain .blob.core.windows.net
range_offset_limit -1 azure_storage

My expectation is that when a request is made with the Range header,
that Squid will request the object starting from the beginning, return
the data when it reaches the range, then keep the connection open and
keep requesting data until the end. However, I observe the last part
isn't true: the connection to the server is closed after the proxy
client closes the connection.

2022/08/10 18:55:23.152| 5,3| Read.cc(92) ReadNow:
local=127.0.0.1:3128 remote=127.0.0.1:57075 FD 21 flags=1, size 3644,
retval 0, errno 0
2022/08/10 18:55:23.152| 33,5| Server.cc(147) doClientRead:
local=127.0.0.1:3128 remote=127.0.0.1:57075 FD 21 flags=1 closed?
2022/08/10 18:55:23.152| 33,3| client_side.cc(1418)
connFinishedWithConn: local=127.0.0.1:3128 remote=127.0.0.1:57075 FD
21 flags=1 aborted (half_closed_clients disabled)
2022/08/10 18:55:23.152| 33,3| Pipeline.cc(56) terminateAll: Pipeline
0x149704e80 notify(0) 0x13a817600*3
2022/08/10 18:55:23.152| 90,3| store_client.cc(651) storeUnregister:
storeUnregister: called for 'F43F6204305C4808C2A393C7CC905C16'
2022/08/10 18:55:23.153| 90,3| store_client.cc(764)
CheckQuickAbortIsReasonable: entry=e:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">d5 at 0</A>=w1p2V/0x6000038f6d80*6
2022/08/10 18:55:23.153| 90,3| store_client.cc(755)
storePendingNClients: storePendingNClients: returning 0
2022/08/10 18:55:23.153| 90,3| store_client.cc(788)
CheckQuickAbortIsReasonable: mem=0x14a14bcb0
2022/08/10 18:55:23.153| 90,3| store_client.cc(817)
CheckQuickAbortIsReasonable: quick-abort? NO admin configured range
replies to full-download
2022/08/10 18:55:23.153| 33,3| Pipeline.cc(69) popMe: Pipeline
0x149704e80 drop 0x13a817600*3
2022/08/10 18:55:23.153| 33,3| client_side_request.cc(270)
~ClientHttpRequest: httpRequestFree: [url here]

I also tried setting &quot;half_closed_clients on&quot; but that just defers the
error to a write later on. Any advice would be appreciated, thanks!

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025105.html">[squid-users] Squid 4.8+ intercept
</A></li>
	<LI>Next message (by thread): <A HREF="025097.html">[squid-users] Problem caching range requests with range_offset_limit
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25096">[ date ]</a>
              <a href="thread.html#25096">[ thread ]</a>
              <a href="subject.html#25096">[ subject ]</a>
              <a href="author.html#25096">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
