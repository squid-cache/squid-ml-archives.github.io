<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 4.8+ intercept
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%204.8%2B%20intercept&In-Reply-To=%3C002d01d8adbf%24ac8c8a40%2405a59ec0%24%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025098.html">
   <LINK REL="Next"  HREF="025105.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 4.8+ intercept</H1>
    <B>ngtech1ltd at gmail.com</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%204.8%2B%20intercept&In-Reply-To=%3C002d01d8adbf%24ac8c8a40%2405a59ec0%24%40gmail.com%3E"
       TITLE="[squid-users] Squid 4.8+ intercept">ngtech1ltd at gmail.com
       </A><BR>
    <I>Thu Aug 11 20:19:34 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025098.html">[squid-users] Squid 4.8+ intercept
</A></li>
        <LI>Next message (by thread): <A HREF="025105.html">[squid-users] Squid 4.8+ intercept
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25102">[ date ]</a>
              <a href="thread.html#25102">[ thread ]</a>
              <a href="subject.html#25102">[ subject ]</a>
              <a href="author.html#25102">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey Grant,

The issue is very simple, if squid and the clients sits on the same subnet( not the same network segment)
then squid will send the traffic back directly to the client.
WCCP is not related to the network level of things and will not resolve this exact same issue in most similar use cases.
(there are which can but this is not the use case)

You should never SNAT traffic from local network to the proxy since you will cause some issue with this.
What you might want to do is to give the proxy a special subnet against the mikrotik and to use policy based routing
to forward the clients traffic to the proxy.

If you can plug the proxy to another port on the Mikrotik device and give it a special subnet it much more preferable.

I believe that WCCP is not an option for Mikrotik so unless you have a specific device that supports WCCP, don't bother thinking about it.
Also, in the same breath I can tell you that most commercial services that implement MITM have not been using and are not using WCCP.
There are much smarter ways these days then basic WCCP to make sure that the traffic will be passed to the right proxy.

Also just take a minute and think: what WCCP gives exactly that a Mikrotik admin cannot do?
A Mikrotik can be automated in such a way that WCCP would be inferior to what Mikrotik can offer.
(To my knowledge)

Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A>
Web: <A HREF="https://ngtech.co.il/">https://ngtech.co.il/</A>
My-Tube: <A HREF="https://tube.ngtech.co.il/">https://tube.ngtech.co.il/</A>

-----Original Message-----
From: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; On Behalf Of Grant Taylor
Sent: Thursday, 11 August 2022 6:48
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] Squid 4.8+ intercept

On 8/10/22 3:47 AM, <A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A> wrote:
&gt;<i> If the proxy sits in the same network that the clients sit it won&#8217;t work.
</I>
Why not?

Is this because of -- what I call -- the TCP triangle problem?  - 
Meaning that Squid sees the source as the client and replies directly?

If that's the case, you can cheat by SNATing the traffic that's going to 
Squid such that Squid sees the router as the source of the traffic. 
Thus Squid replies to the router which unDNATs it and sends it back to 
the original / real client.

Aside:  Isn't this what WCCP was originally meant to address?  Is WCCP a 
non-starter any more?  Even with TLS bump / monkey in the middle?



-- 
Grant. . . .
unix || die



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025098.html">[squid-users] Squid 4.8+ intercept
</A></li>
	<LI>Next message (by thread): <A HREF="025105.html">[squid-users] Squid 4.8+ intercept
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25102">[ date ]</a>
              <a href="thread.html#25102">[ thread ]</a>
              <a href="subject.html#25102">[ subject ]</a>
              <a href="author.html#25102">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
