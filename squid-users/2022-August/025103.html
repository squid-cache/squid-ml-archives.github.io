<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid as Reverse Proxy with Parent Proxy, http inbound and https outbound
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20as%20Reverse%20Proxy%20with%20Parent%20Proxy%2C%0A%20http%20inbound%20and%20https%20outbound&In-Reply-To=%3Cf1a4883f-6fd6-0a41-a19d-69e4b40e37c8%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025101.html">
   <LINK REL="Next"  HREF="025107.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid as Reverse Proxy with Parent Proxy, http inbound and https outbound</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20as%20Reverse%20Proxy%20with%20Parent%20Proxy%2C%0A%20http%20inbound%20and%20https%20outbound&In-Reply-To=%3Cf1a4883f-6fd6-0a41-a19d-69e4b40e37c8%40measurement-factory.com%3E"
       TITLE="[squid-users] Squid as Reverse Proxy with Parent Proxy, http inbound and https outbound">rousskov at measurement-factory.com
       </A><BR>
    <I>Thu Aug 11 20:28:12 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025101.html">[squid-users] Squid as Reverse Proxy with Parent Proxy, http inbound and https outbound
</A></li>
        <LI>Next message (by thread): <A HREF="025107.html">[squid-users] Squid as Reverse Proxy with Parent Proxy, http inbound and https outbound
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25103">[ date ]</a>
              <a href="thread.html#25103">[ thread ]</a>
              <a href="subject.html#25103">[ subject ]</a>
              <a href="author.html#25103">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 8/11/22 16:00, Joel Howard wrote:

&gt;<i> I'm trying to use Squid (3.5.27, in a docker container) 
</I>
My response below should cover Squid v3 in principle, but there may be 
important caveats that I am forgetting about that apply to that 
unsupported and ancient version. You should not use that version.


&gt;<i> as a non-caching 
</I>&gt;<i> reverse proxy with http inbound and https outbound, to support an 
</I>&gt;<i> application that requires a proxy for internet access but does not allow 
</I>&gt;<i> proxy configuration (and I do not have access to the application's host 
</I>&gt;<i> machine). Ideally the squid proxy itself would not have a tls cert, 
</I>&gt;<i> since inbound traffic would be http, and I would like to add headers.
</I>
Are you trying to configure Squid to convert a received &quot;GET 
<A HREF="http://example.com/">http://example.com/</A>&quot; request into a &quot;GET <A HREF="https://example.com">https://example.com</A>&quot; request 
sent from Squid (to the parent proxy)?


&gt;<i> What keeps stopping me is that I also need to support a parent forward 
</I>&gt;<i> proxy, which itself may support http or https inbound.
</I>
Does the parent forward proxy accept plain text TCP connections or TLS 
connections? What port does the parent proxy listens on? Can you telnet 
or otherwise probe it to figure out whether it expects TLS? Most proxies 
expect plain text TCP connections, but there are HTTPS proxies that 
expect TLS.


&gt;<i> I've tried the various examples here 
</I>&gt;<i> &lt;<A HREF="https://wiki.squid-cache.org/SquidFaq/ReverseProxy">https://wiki.squid-cache.org/SquidFaq/ReverseProxy</A>&gt;, but I'm struggling 
</I>&gt;<i> to &quot;flip&quot; the proxy direction - receive the request as a reverse proxy, 
</I>&gt;<i> configure the outbound request appropriately, and then send it on *via* 
</I>&gt;<i> the parent proxy. I'm not sure if cache_peers can be &quot;chained&quot; like 
</I>&gt;<i> this, or if they can't, how I can configure the single cache_peer so 
</I>&gt;<i> that proxied https works correctly.
</I>
I have not tested this, but I would expect the reverse/forward &quot;flip&quot; 
itself to work more-or-less automatically -- Squid should do what is 
necessary on its own IIRC. I suspect your problem is elsewhere.

Perhaps you should try to make everything work for plain text HTTP 
traffic first? Outside of a docker?

Please share your http_port and cache_peer configuration and the 
errors/problems they currently cause.


Cheers,

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025101.html">[squid-users] Squid as Reverse Proxy with Parent Proxy, http inbound and https outbound
</A></li>
	<LI>Next message (by thread): <A HREF="025107.html">[squid-users] Squid as Reverse Proxy with Parent Proxy, http inbound and https outbound
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25103">[ date ]</a>
              <a href="thread.html#25103">[ thread ]</a>
              <a href="subject.html#25103">[ subject ]</a>
              <a href="author.html#25103">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
