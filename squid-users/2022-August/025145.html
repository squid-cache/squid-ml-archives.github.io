<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] How to enable squid to use more server resources when using 500+ http_ports?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20How%20to%20enable%20squid%20to%20use%20more%20server%20resources%0A%20when%20using%20500%2B%20http_ports%3F&In-Reply-To=%3Cef1432d3-c8d6-f3d5-7e7f-737fc44d74fd%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025141.html">
   <LINK REL="Next"  HREF="025146.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] How to enable squid to use more server resources when using 500+ http_ports?</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20How%20to%20enable%20squid%20to%20use%20more%20server%20resources%0A%20when%20using%20500%2B%20http_ports%3F&In-Reply-To=%3Cef1432d3-c8d6-f3d5-7e7f-737fc44d74fd%40treenet.co.nz%3E"
       TITLE="[squid-users] How to enable squid to use more server resources when using 500+ http_ports?">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon Aug 29 12:49:16 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025141.html">[squid-users] How to enable squid to use more server resources when using 500+ http_ports?
</A></li>
        <LI>Next message (by thread): <A HREF="025146.html">[squid-users] How to enable squid to use more server resources when using 500+ http_ports?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25145">[ date ]</a>
              <a href="thread.html#25145">[ thread ]</a>
              <a href="subject.html#25145">[ subject ]</a>
              <a href="author.html#25145">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>TL;DR this behaviour is expected when expanding beyond the default limit 
on http_port lines permitted in squid.conf. YMMV as to how much you can 
expand, but it will appear at some point.



On 29/08/22 18:06, Marcelo wrote:
&gt;<i> Hello,
</I>&gt;<i> 
</I>&gt;<i> I have a server with large resources ( RAM, CPU, etc) running Ubuntu 20.04.
</I>&gt;<i> 
</I>&gt;<i> When I put squid 4.13 to manage more than 500 http_ports, it performs 
</I>&gt;<i> very slowly.
</I>&gt;<i> 
</I>&gt;<i> Question is, how can I setup Squid or Ubuntu to use more hw resources in 
</I>&gt;<i> order to perform better?
</I>
If the behaviour only occurs once you expand the listening ports the 
solution is to reduce the number of listening ports and spread over more 
Squid (on more hardware/machines).


The hard coded default is small for three reasons that I am aware of:

  1) these ports need checking frequently even when no I/O is expected 
to happen. So they are checked every 10ms in addition to the regular I/O 
traffic.

  2) it was set long ago when hardware was more restricted. So YMMV and 
testing like you are doing is recommended when touching it.

  3) most Squid users do not need anywhere even close to the limit set. 
So we are not inclined to change the default value - instead we allow 
custom builds to set themselves if necessary.


That said the speed situation you are experiencing may be more related 
to how many new connections (and thus new HTTP messages to process) can 
be opened per second with X listening ports vs X+Y listening ports. 
Squid does have capacity limits at many points of the traffic processing.


&gt;<i> 
</I>&gt;<i> Or does it a matter of software architecture limitation?
</I>&gt;<i> 
</I>&gt;<i> Perform well with at least 500 http_ports would be very nice so we can 
</I>&gt;<i> use smaller numbers of VPSs.
</I>&gt;<i> 
</I>
On a good modern machine this is know to be within the realms of 
reasonable, but it does impact the overall performance per (1) above.


&gt;<i> Its hard to manage so many of it.
</I>
Indeed. Another reason not to.

That said the &quot;include&quot; directive and a folder of per-port config files 
was created exactly to help with this type of management problem. 
Automated management of a set of per-port config files can easily be 
setup with popular network management tools and/or scripts.


&gt;<i> It would be a dream to have like 10k http_ports in a single server.
</I>
Very unlikely to be doable. Each port used this way reduces the number 
of ports available for client and server transactional traffic.


&gt;<i> 
</I>&gt;<i> If it is not possible, is there any planning about do it in a future?
</I>&gt;<i> 
</I>
Not specifically. Due to reason (3) above.


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025141.html">[squid-users] How to enable squid to use more server resources when using 500+ http_ports?
</A></li>
	<LI>Next message (by thread): <A HREF="025146.html">[squid-users] How to enable squid to use more server resources when using 500+ http_ports?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25145">[ date ]</a>
              <a href="thread.html#25145">[ thread ]</a>
              <a href="subject.html#25145">[ subject ]</a>
              <a href="author.html#25145">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
