<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 5.2 TCP_MISS_ABORTED/100 erros when uploading
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%205.2%20TCP_MISS_ABORTED/100%20erros%20when%0A%20uploading&In-Reply-To=%3CCAEJ1g5LjsEyQWBOUtO9ki_zcsDFOShUh%2BrENBgahkBWGy7D87g%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025151.html">
   <LINK REL="Next"  HREF="025159.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 5.2 TCP_MISS_ABORTED/100 erros when uploading</H1>
    <B>David Ferreira</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%205.2%20TCP_MISS_ABORTED/100%20erros%20when%0A%20uploading&In-Reply-To=%3CCAEJ1g5LjsEyQWBOUtO9ki_zcsDFOShUh%2BrENBgahkBWGy7D87g%40mail.gmail.com%3E"
       TITLE="[squid-users] Squid 5.2 TCP_MISS_ABORTED/100 erros when uploading">davidtiagoff at gmail.com
       </A><BR>
    <I>Tue Aug 30 11:34:59 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025151.html">[squid-users] Squid 5.2 TCP_MISS_ABORTED/100 erros when uploading
</A></li>
        <LI>Next message (by thread): <A HREF="025159.html">[squid-users] Squid 5.2 TCP_MISS_ABORTED/100 erros when uploading
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25158">[ date ]</a>
              <a href="thread.html#25158">[ thread ]</a>
              <a href="subject.html#25158">[ subject ]</a>
              <a href="author.html#25158">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>(forgot to reply all)
Hi alex,

I did a new capture like you said, since there's only a few http messages
in gonna post them here:

Squid 5.2:
dump -i ens224 -nn port 80 -s0 -w squid52output

POST /webserver/index.php HTTP/1.1
Accept-Encoding: deflate, gzip
Cookie: tickets[InDesign]=9ce90349BDxzBw6TeaGM1sYvG6dDlABl0NqbswO9;
tickets[]=716c37c9qD4eeMFPHZvbfAa8S7VMmLh3Skkgrb31;
AWSELB=0D3B27870CA3C45CF463C76E69DC284A499EFD0DF6EE047B11D31BB6D9B01943D41E6D72FB8A97227A031F20EAAC9364FE0968EA5AAEE1102734343F2F0133CD3A0C6A4A0C
Accept: */*
SOAPAction: &quot;urn:#SaveObjects&quot;
Content-Type: multipart/form-data; boundary=----------------7d123
Content-Length: 4277021
Expect: 100-continue
Host: webserverhost
Via: 1.1 squid5.2host (squid/5.2)
X-Forwarded-For: 172.19.222.132
Cache-Control: max-age=259200
Connection: keep-alive

HTTP/1.1 100 Continue

HTTP/1.1 503 Service Unavailable.
Content-length:0

POST /webserver/index.php HTTP/1.1
Accept-Encoding: deflate, gzip
Cookie: tickets[InDesign]=9ce90349BDxzBw6TeaGM1sYvG6dDlABl0NqbswO9;
tickets[]=716c37c9qD4eeMFPHZvbfAa8S7VMmLh3Skkgrb31;
AWSELB=0D3B27870CA3C45CF463C76E69DC284A499EFD0DF6EE047B11D31BB6D9B01943D41E6D72FB8A97227A031F20EAAC9364FE0968EA5AAEE1102734343F2F0133CD3A0C6A4A0C
Accept: */*
SOAPAction: &quot;urn:#GetDialog&quot;
Content-Type: multipart/form-data; boundary=----------------7d123
Content-Length: 1120
Expect: 100-continue
Host: webserverhost
Via: 1.1 squid5.2host (squid/5.2)
X-Forwarded-For: 172.19.222.132
Cache-Control: max-age=259200
Connection: keep-alive

HTTP/1.1 100 Continue

------
Squid 4.15:

dump -i ens224 -nn port 80 -s0 -w squid4.15output

POST /webserver/index.php HTTP/1.1
Accept-Encoding: deflate, gzip
Cookie: tickets[InDesign]=1ae95903t3jY2HDSgfvoEsfpsibbkf9mlNZ4eDjA;
tickets[]=716c37c9qD4eeMFPHZvbfAa8S7VMmLh3Skkgrb31;
AWSELB=0D3B27870CA3C45CF463C76E69DC284A499EFD0DF6EE047B11D31BB6D9B01943D41E6D72FB8A97227A031F20EAAC9364FE0968EA5AAEE1102734343F2F0133CD3A0C6A4A0C
Accept: */*
SOAPAction: &quot;urn:#SaveObjects&quot;
Content-Type: multipart/form-data; boundary=----------------7d123
Content-Length: 4272865
Expect: 100-continue
Host: webserverhost
Via: 1.1 squid4.15host (squid/4.15)
X-Forwarded-For: 172.19.222.132
Cache-Control: max-age=259200
Connection: keep-alive

HTTP/1.1 100 Continue

POST /webserver/index.php HTTP/1.1
Accept-Encoding: deflate, gzip
Cookie: tickets[InDesign]=1ae95903t3jY2HDSgfvoEsfpsibbkf9mlNZ4eDjA;
tickets[]=716c37c9qD4eeMFPHZvbfAa8S7VMmLh3Skkgrb31;
AWSELB=0D3B27870CA3C45CF463C76E69DC284A499EFD0DF6EE047B11D31BB6D9B01943D41E6D72FB8A97227A031F20EAAC9364FE0968EA5AAEE1102734343F2F0133CD3A0C6A4A0C
Accept: */*
SOAPAction: &quot;urn:#UnlockObjects&quot;
Content-Type: multipart/form-data; boundary=----------------7d123
Content-Length: 644
Host: webserverhost
Via: 1.1 squid4.15host (squid/4.15)
X-Forwarded-For: 172.19.222.132
Cache-Control: max-age=259200
Connection: keep-alive


HTTP/1.1 200 OK
Content-Type: text/xml; charset=utf-8
Date: Tue, 30 Aug 2022 10:52:05 GMT
Server: Apache/2.4.6 (CentOS) PHP/7.1.26
Set-Cookie: tickets[InDesign]=1ae95903t3jY2HDSgfvoEsfpsibbkf9mlNZ4eDjA;
expires=Wed, 31-Aug-2022 10:52:05 GMT; Max-Age=86400; path=/webserver;
HttpOnly
X-Powered-By: PHP/7.1.26
Content-Length: 266
Connection: keep-alive

Again thank you for you time.
David

On Mon, 29 Aug 2022 at 18:18, Alex Rousskov &lt;
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt; wrote:

&gt;<i> On 8/29/22 12:17, David Ferreira wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; I tried to capture the http trafic with the following tcpdump:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; tcpdump -i any -nn port 80|grep -i http
</I>&gt;<i>
</I>&gt;<i> I am not cool enough to easily grok this kind of output. Please share (a
</I>&gt;<i> link to) the packet capture file instead (tcpdump -s0 -w filename ...).
</I>&gt;<i>
</I>&gt;<i> Thank you,
</I>&gt;<i>
</I>&gt;<i> Alex.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; Notes:
</I>&gt;<i> &gt; - 1.2.3.4 is the webserver ip
</I>&gt;<i> &gt; - 10.185.23.202 is the squid machine outbound interface
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Here's the results:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Squid 4.15(Working one):
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ---
</I>&gt;<i> &gt; Im not that familiar with tcpdump, if there's a better way to capture
</I>&gt;<i> &gt; please say so, im also gonna build a squid v5 to test it out.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Again, thanks for your time
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On Mon, 29 Aug 2022 at 13:52, Alex Rousskov
</I>&gt;<i> &gt; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>
</I>&gt;<i> &gt; &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt;&gt; wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     On 8/29/22 06:17, David Ferreira wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;      &gt; I have some squid's running on rocky linux 8 with verion 4.15,
</I>&gt;<i> &gt;     recently
</I>&gt;<i> &gt;      &gt; been testing squid version 5.2(stable version that comes with
</I>&gt;<i> &gt;     Rocky 9)to
</I>&gt;<i> &gt;      &gt; upgrade the current ones and most of the configs/acls seem to
</I>&gt;<i> &gt;     work fine.
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt; Unfortualy theres an application that we use that everytime it
</I>&gt;<i> &gt;     tries to
</I>&gt;<i> &gt;      &gt; upload files it fails on squid 5.2, on 4.15 is works completly
</I>&gt;<i> &gt;     fine, so
</I>&gt;<i> &gt;      &gt; far ive test on squid 5.2 and 5.5 and it's the same behavior, im
</I>&gt;<i> &gt;     testing
</I>&gt;<i> &gt;      &gt; this with default configurations and it always works on 4.15,
</I>&gt;<i> &gt;     access log
</I>&gt;<i> &gt;      &gt; only shows this:
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt; Squid 4.15:
</I>&gt;<i> &gt;      &gt; 26/Aug/2022:15:36:08 +0100    273 172.19.222.132TCP_MISS/200 745
</I>&gt;<i> &gt;     POST <A HREF="http://websiteurl/index.php">http://websiteurl/index.php</A> &lt;<A HREF="http://websiteurl/index.php">http://websiteurl/index.php</A>&gt; -
</I>&gt;<i> &gt;     HIER_DIRECT/websitedomain text/xml
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt; Squid 5.2:
</I>&gt;<i> &gt;      &gt; 25/Aug/2022:15:10:00 +0100    139 172.19.222.132
</I>&gt;<i> &gt;     TCP_MISS_ABORTED/100 0 POST <A HREF="http://websiteurl">http://websiteurl</A> &lt;<A HREF="http://websiteurl">http://websiteurl</A>&gt;
</I>&gt;<i> &gt;     HIER_DIRECT/websitedomain -
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt; anyone has an ideia of what may be happening here?, been
</I>&gt;<i> &gt;     searching about
</I>&gt;<i> &gt;      &gt; http errors 100 and so far i did not find anything that points me
</I>&gt;<i> &gt;     to the
</I>&gt;<i> &gt;      &gt; problem.
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt; On the application side the error it shows when it tries to
</I>&gt;<i> &gt;     upload is:
</I>&gt;<i> &gt;      &gt; &quot;
</I>&gt;<i> &gt;      &gt; Error storing the document on the server
</I>&gt;<i> &gt;      &gt; Detail HTTP error 100
</I>&gt;<i> &gt;      &gt; Send failure: Connection was aborted (55)
</I>&gt;<i> &gt;      &gt; &quot;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     Squid v5.2 has many serious bugs. I would not use it in production.
</I>&gt;<i> &gt;     Build the latest Squid v5 from sources if you have to.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     If the latest Squid v5 shows the same problem then this is probably a
</I>&gt;<i> &gt;     client application or Squid bug/misconfiguration. There were quite a
</I>&gt;<i> &gt;     few
</I>&gt;<i> &gt;     changes in HTTP 1xx control message handling since Squid v4, and one
</I>&gt;<i> of
</I>&gt;<i> &gt;     those changes is probably affecting your client. For example, either
</I>&gt;<i> &gt;     Squid v4 does not deliver that 100 control message to the client at
</I>&gt;<i> all
</I>&gt;<i> &gt;     or it is delivering a slightly different 100 control message that
</I>&gt;<i> your
</I>&gt;<i> &gt;     client is happy with.
</I>&gt;<i> &gt;        If you share what HTTP messages are exchanged between client and
</I>&gt;<i> &gt;     Squid
</I>&gt;<i> &gt;     and between Squid and the origin server, in both successful and
</I>&gt;<i> failing
</I>&gt;<i> &gt;     use cases, we may be able to tell you more. I would use tcpdump,
</I>&gt;<i> &gt;     wireshark, or a similar tool to collect HTTP traffic since these are
</I>&gt;<i> &gt;     non-TLS transactions.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     HTH,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     Alex.
</I>&gt;<i> &gt;     _______________________________________________
</I>&gt;<i> &gt;     squid-users mailing list
</I>&gt;<i> &gt;     <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> &gt;     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i> &gt;     <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> &gt;     &lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>&gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; --
</I>&gt;<i> &gt; Com os melhores cumprimentos,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; David Ferreira
</I>&gt;<i>
</I>&gt;<i>
</I>
-- 
Com os melhores cumprimentos,

David Ferreira
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20220830/2b9593c5/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20220830/2b9593c5/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025151.html">[squid-users] Squid 5.2 TCP_MISS_ABORTED/100 erros when uploading
</A></li>
	<LI>Next message (by thread): <A HREF="025159.html">[squid-users] Squid 5.2 TCP_MISS_ABORTED/100 erros when uploading
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25158">[ date ]</a>
              <a href="thread.html#25158">[ thread ]</a>
              <a href="subject.html#25158">[ subject ]</a>
              <a href="author.html#25158">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
