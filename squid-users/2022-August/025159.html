<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 5.2 TCP_MISS_ABORTED/100 erros when uploading
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%205.2%20TCP_MISS_ABORTED/100%20erros%20when%0A%20uploading&In-Reply-To=%3C79fba46f-474d-9c94-7389-d139a0ea38b2%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025158.html">
   <LINK REL="Next"  HREF="025154.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 5.2 TCP_MISS_ABORTED/100 erros when uploading</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%205.2%20TCP_MISS_ABORTED/100%20erros%20when%0A%20uploading&In-Reply-To=%3C79fba46f-474d-9c94-7389-d139a0ea38b2%40measurement-factory.com%3E"
       TITLE="[squid-users] Squid 5.2 TCP_MISS_ABORTED/100 erros when uploading">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Aug 30 14:18:15 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025158.html">[squid-users] Squid 5.2 TCP_MISS_ABORTED/100 erros when uploading
</A></li>
        <LI>Next message (by thread): <A HREF="025154.html">[squid-users] How to enable squid to use more server resources when
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25159">[ date ]</a>
              <a href="thread.html#25159">[ thread ]</a>
              <a href="subject.html#25159">[ subject ]</a>
              <a href="author.html#25159">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 8/30/22 07:34, David Ferreira wrote:

&gt;<i> I did a new capture like you said, since there's only a few http 
</I>&gt;<i> messages in gonna post them here:
</I>
Perhaps others will be able to spot the answer in your narration of the 
captured packets, but I am missing critical details like timestamps and 
connection IDs to interpret this correctly. For example, I cannot tell 
who sends the &quot;HTTP/1.1 503 Service Unavailable&quot; response -- Squid or 
the origin server -- and _when_. Also, there may be critical low-level 
details like unusual whitespace characters or missing delimiters that 
cannot be easily relayed when one copy-pastes high-level details.

Needless to say, all those details may not help reveal the answer 
either, but there is a chance that they will help. If you can share (a 
link to) the actual packet capture containing these messages (i.e. the 
files saved by tcpdump), please do so. Compress the file if needed. Feel 
free to do that privately if you prefer.

I regret that this triage requires so many iterations.

Alex.


&gt;<i> Squid 5.2:
</I>&gt;<i> dump -i ens224 -nn port 80 -s0 -w squid52output
</I>&gt;<i> 
</I>&gt;<i> POST /webserver/index.php HTTP/1.1
</I>&gt;<i> Accept-Encoding: deflate, gzip
</I>&gt;<i> Cookie: tickets[InDesign]=9ce90349BDxzBw6TeaGM1sYvG6dDlABl0NqbswO9; 
</I>&gt;<i> tickets[]=716c37c9qD4eeMFPHZvbfAa8S7VMmLh3Skkgrb31; 
</I>&gt;<i> AWSELB=0D3B27870CA3C45CF463C76E69DC284A499EFD0DF6EE047B11D31BB6D9B01943D41E6D72FB8A97227A031F20EAAC9364FE0968EA5AAEE1102734343F2F0133CD3A0C6A4A0C
</I>&gt;<i> Accept: */*
</I>&gt;<i> SOAPAction: &quot;urn:#SaveObjects&quot;
</I>&gt;<i> Content-Type: multipart/form-data; boundary=----------------7d123
</I>&gt;<i> Content-Length: 4277021
</I>&gt;<i> Expect: 100-continue
</I>&gt;<i> Host: webserverhost
</I>&gt;<i> Via: 1.1 squid5.2host (squid/5.2)
</I>&gt;<i> X-Forwarded-For: 172.19.222.132
</I>&gt;<i> Cache-Control: max-age=259200
</I>&gt;<i> Connection: keep-alive
</I>&gt;<i> 
</I>&gt;<i> HTTP/1.1 100 Continue
</I>&gt;<i> 
</I>&gt;<i> HTTP/1.1 503 Service Unavailable.
</I>&gt;<i> Content-length:0
</I>&gt;<i> 
</I>&gt;<i> POST /webserver/index.php HTTP/1.1
</I>&gt;<i> Accept-Encoding: deflate, gzip
</I>&gt;<i> Cookie: tickets[InDesign]=9ce90349BDxzBw6TeaGM1sYvG6dDlABl0NqbswO9; 
</I>&gt;<i> tickets[]=716c37c9qD4eeMFPHZvbfAa8S7VMmLh3Skkgrb31; 
</I>&gt;<i> AWSELB=0D3B27870CA3C45CF463C76E69DC284A499EFD0DF6EE047B11D31BB6D9B01943D41E6D72FB8A97227A031F20EAAC9364FE0968EA5AAEE1102734343F2F0133CD3A0C6A4A0C
</I>&gt;<i> Accept: */*
</I>&gt;<i> SOAPAction: &quot;urn:#GetDialog&quot;
</I>&gt;<i> Content-Type: multipart/form-data; boundary=----------------7d123
</I>&gt;<i> Content-Length: 1120
</I>&gt;<i> Expect: 100-continue
</I>&gt;<i> Host: webserverhost
</I>&gt;<i> Via: 1.1 squid5.2host (squid/5.2)
</I>&gt;<i> X-Forwarded-For: 172.19.222.132
</I>&gt;<i> Cache-Control: max-age=259200
</I>&gt;<i> Connection: keep-alive
</I>&gt;<i> 
</I>&gt;<i> HTTP/1.1 100 Continue
</I>&gt;<i> 
</I>&gt;<i> ------
</I>&gt;<i> Squid 4.15:
</I>&gt;<i> 
</I>&gt;<i> dump -i ens224 -nn port 80 -s0 -w squid4.15output
</I>&gt;<i> 
</I>&gt;<i> POST /webserver/index.php HTTP/1.1
</I>&gt;<i> Accept-Encoding: deflate, gzip
</I>&gt;<i> Cookie: tickets[InDesign]=1ae95903t3jY2HDSgfvoEsfpsibbkf9mlNZ4eDjA; 
</I>&gt;<i> tickets[]=716c37c9qD4eeMFPHZvbfAa8S7VMmLh3Skkgrb31; 
</I>&gt;<i> AWSELB=0D3B27870CA3C45CF463C76E69DC284A499EFD0DF6EE047B11D31BB6D9B01943D41E6D72FB8A97227A031F20EAAC9364FE0968EA5AAEE1102734343F2F0133CD3A0C6A4A0C
</I>&gt;<i> Accept: */*
</I>&gt;<i> SOAPAction: &quot;urn:#SaveObjects&quot;
</I>&gt;<i> Content-Type: multipart/form-data; boundary=----------------7d123
</I>&gt;<i> Content-Length: 4272865
</I>&gt;<i> Expect: 100-continue
</I>&gt;<i> Host: webserverhost
</I>&gt;<i> Via: 1.1 squid4.15host (squid/4.15)
</I>&gt;<i> X-Forwarded-For: 172.19.222.132
</I>&gt;<i> Cache-Control: max-age=259200
</I>&gt;<i> Connection: keep-alive
</I>&gt;<i> 
</I>&gt;<i> HTTP/1.1 100 Continue
</I>&gt;<i> 
</I>&gt;<i> POST /webserver/index.php HTTP/1.1
</I>&gt;<i> Accept-Encoding: deflate, gzip
</I>&gt;<i> Cookie: tickets[InDesign]=1ae95903t3jY2HDSgfvoEsfpsibbkf9mlNZ4eDjA; 
</I>&gt;<i> tickets[]=716c37c9qD4eeMFPHZvbfAa8S7VMmLh3Skkgrb31; 
</I>&gt;<i> AWSELB=0D3B27870CA3C45CF463C76E69DC284A499EFD0DF6EE047B11D31BB6D9B01943D41E6D72FB8A97227A031F20EAAC9364FE0968EA5AAEE1102734343F2F0133CD3A0C6A4A0C
</I>&gt;<i> Accept: */*
</I>&gt;<i> SOAPAction: &quot;urn:#UnlockObjects&quot;
</I>&gt;<i> Content-Type: multipart/form-data; boundary=----------------7d123
</I>&gt;<i> Content-Length: 644
</I>&gt;<i> Host: webserverhost
</I>&gt;<i> Via: 1.1 squid4.15host (squid/4.15)
</I>&gt;<i> X-Forwarded-For: 172.19.222.132
</I>&gt;<i> Cache-Control: max-age=259200
</I>&gt;<i> Connection: keep-alive
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> HTTP/1.1 200 OK
</I>&gt;<i> Content-Type: text/xml; charset=utf-8
</I>&gt;<i> Date: Tue, 30 Aug 2022 10:52:05 GMT
</I>&gt;<i> Server: Apache/2.4.6 (CentOS) PHP/7.1.26
</I>&gt;<i> Set-Cookie: tickets[InDesign]=1ae95903t3jY2HDSgfvoEsfpsibbkf9mlNZ4eDjA; 
</I>&gt;<i> expires=Wed, 31-Aug-2022 10:52:05 GMT; Max-Age=86400; path=/webserver; 
</I>&gt;<i> HttpOnly
</I>&gt;<i> X-Powered-By: PHP/7.1.26
</I>&gt;<i> Content-Length: 266
</I>&gt;<i> Connection: keep-alive
</I>&gt;<i> 
</I>&gt;<i> Again thank you for you time.
</I>&gt;<i> David
</I>&gt;<i> 
</I>&gt;<i> On Mon, 29 Aug 2022 at 18:18, Alex Rousskov 
</I>&gt;<i> &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A> 
</I>&gt;<i> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt;&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i>     On 8/29/22 12:17, David Ferreira wrote:
</I>&gt;<i> 
</I>&gt;<i>      &gt; I tried to capture the http trafic with the following tcpdump:
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; tcpdump -i any -nn port 80|grep -i http
</I>&gt;<i> 
</I>&gt;<i>     I am not cool enough to easily grok this kind of output. Please
</I>&gt;<i>     share (a
</I>&gt;<i>     link to) the packet capture file instead (tcpdump -s0 -w filename ...).
</I>&gt;<i> 
</I>&gt;<i>     Thank you,
</I>&gt;<i> 
</I>&gt;<i>     Alex.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>      &gt; Notes:
</I>&gt;<i>      &gt; - 1.2.3.4 is the webserver ip
</I>&gt;<i>      &gt; - 10.185.23.202 is the squid machine outbound interface
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; Here's the results:
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; Squid 4.15(Working one):
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; ---
</I>&gt;<i>      &gt; Im not that familiar with tcpdump, if there's a better way to
</I>&gt;<i>     capture
</I>&gt;<i>      &gt; please say so, im also gonna build a squid v5 to test it out.
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; Again, thanks for your time
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; On Mon, 29 Aug 2022 at 13:52, Alex Rousskov
</I>&gt;<i>      &gt; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt;
</I>&gt;<i>      &gt; &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt;&gt;&gt; wrote:
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160;On 8/29/22 06:17, David Ferreira wrote:
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; I have some squid's running on rocky linux 8 with verion 4.15,
</I>&gt;<i>      &gt;&#160; &#160; &#160;recently
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; been testing squid version 5.2(stable version that comes with
</I>&gt;<i>      &gt;&#160; &#160; &#160;Rocky 9)to
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; upgrade the current ones and most of the configs/acls seem to
</I>&gt;<i>      &gt;&#160; &#160; &#160;work fine.
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; Unfortualy theres an application that we use that everytime it
</I>&gt;<i>      &gt;&#160; &#160; &#160;tries to
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; upload files it fails on squid 5.2, on 4.15 is works completly
</I>&gt;<i>      &gt;&#160; &#160; &#160;fine, so
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; far ive test on squid 5.2 and 5.5 and it's the same
</I>&gt;<i>     behavior, im
</I>&gt;<i>      &gt;&#160; &#160; &#160;testing
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; this with default configurations and it always works on 4.15,
</I>&gt;<i>      &gt;&#160; &#160; &#160;access log
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; only shows this:
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; Squid 4.15:
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; 26/Aug/2022:15:36:08 +0100 &#160;&#160;&#160;273
</I>&gt;<i>     172.19.222.132TCP_MISS/200 745
</I>&gt;<i>      &gt;&#160; &#160; &#160;POST <A HREF="http://websiteurl/index.php">http://websiteurl/index.php</A>
</I>&gt;<i>     &lt;<A HREF="http://websiteurl/index.php">http://websiteurl/index.php</A>&gt; &lt;<A HREF="http://websiteurl/index.php">http://websiteurl/index.php</A>
</I>&gt;<i>     &lt;<A HREF="http://websiteurl/index.php">http://websiteurl/index.php</A>&gt;&gt; -
</I>&gt;<i>      &gt;&#160; &#160; &#160;HIER_DIRECT/websitedomain text/xml
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; Squid 5.2:
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; 25/Aug/2022:15:10:00 +0100 &#160;&#160;&#160;139 172.19.222.132
</I>&gt;<i>      &gt;&#160; &#160; &#160;TCP_MISS_ABORTED/100 0 POST <A HREF="http://websiteurl">http://websiteurl</A>
</I>&gt;<i>     &lt;<A HREF="http://websiteurl">http://websiteurl</A>&gt; &lt;<A HREF="http://websiteurl">http://websiteurl</A> &lt;<A HREF="http://websiteurl">http://websiteurl</A>&gt;&gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160;HIER_DIRECT/websitedomain -
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; anyone has an ideia of what may be happening here?, been
</I>&gt;<i>      &gt;&#160; &#160; &#160;searching about
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; http errors 100 and so far i did not find anything that
</I>&gt;<i>     points me
</I>&gt;<i>      &gt;&#160; &#160; &#160;to the
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; problem.
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; On the application side the error it shows when it tries to
</I>&gt;<i>      &gt;&#160; &#160; &#160;upload is:
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; &quot;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; Error storing the document on the server
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; Detail HTTP error 100
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; Send failure: Connection was aborted (55)
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; &quot;
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160;Squid v5.2 has many serious bugs. I would not use it in
</I>&gt;<i>     production.
</I>&gt;<i>      &gt;&#160; &#160; &#160;Build the latest Squid v5 from sources if you have to.
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160;If the latest Squid v5 shows the same problem then this is
</I>&gt;<i>     probably a
</I>&gt;<i>      &gt;&#160; &#160; &#160;client application or Squid bug/misconfiguration. There were
</I>&gt;<i>     quite a
</I>&gt;<i>      &gt;&#160; &#160; &#160;few
</I>&gt;<i>      &gt;&#160; &#160; &#160;changes in HTTP 1xx control message handling since Squid v4,
</I>&gt;<i>     and one of
</I>&gt;<i>      &gt;&#160; &#160; &#160;those changes is probably affecting your client. For example,
</I>&gt;<i>     either
</I>&gt;<i>      &gt;&#160; &#160; &#160;Squid v4 does not deliver that 100 control message to the
</I>&gt;<i>     client at all
</I>&gt;<i>      &gt;&#160; &#160; &#160;or it is delivering a slightly different 100 control message
</I>&gt;<i>     that your
</I>&gt;<i>      &gt;&#160; &#160; &#160;client is happy with.
</I>&gt;<i>      &gt;&#160; &#160; &#160; &#160; If you share what HTTP messages are exchanged between
</I>&gt;<i>     client and
</I>&gt;<i>      &gt;&#160; &#160; &#160;Squid
</I>&gt;<i>      &gt;&#160; &#160; &#160;and between Squid and the origin server, in both successful
</I>&gt;<i>     and failing
</I>&gt;<i>      &gt;&#160; &#160; &#160;use cases, we may be able to tell you more. I would use tcpdump,
</I>&gt;<i>      &gt;&#160; &#160; &#160;wireshark, or a similar tool to collect HTTP traffic since
</I>&gt;<i>     these are
</I>&gt;<i>      &gt;&#160; &#160; &#160;non-TLS transactions.
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160;HTH,
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160;Alex.
</I>&gt;<i>      &gt;&#160; &#160; &#160;_______________________________________________
</I>&gt;<i>      &gt;&#160; &#160; &#160;squid-users mailing list
</I>&gt;<i>      &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160;&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;&gt;
</I>&gt;<i>      &gt; <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>     &lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>&gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160;&lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>     &lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>&gt;&gt;
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; --
</I>&gt;<i>      &gt; Com os melhores cumprimentos,
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; David Ferreira
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> -- 
</I>&gt;<i> Com os melhores cumprimentos,
</I>&gt;<i> 
</I>&gt;<i> David Ferreira
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025158.html">[squid-users] Squid 5.2 TCP_MISS_ABORTED/100 erros when uploading
</A></li>
	<LI>Next message (by thread): <A HREF="025154.html">[squid-users] How to enable squid to use more server resources when
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25159">[ date ]</a>
              <a href="thread.html#25159">[ thread ]</a>
              <a href="subject.html#25159">[ subject ]</a>
              <a href="author.html#25159">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
