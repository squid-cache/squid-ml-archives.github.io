<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] req_header acl with ssl_bump
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20req_header%20acl%20with%20ssl_bump&In-Reply-To=%3CDS7PR06MB6789F1C1721EA84314FF5F89E91A9%40DS7PR06MB6789.namprd06.prod.outlook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025501.html">
   <LINK REL="Next"  HREF="025503.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] req_header acl with ssl_bump</H1>
    <B>Toler, Matt</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20req_header%20acl%20with%20ssl_bump&In-Reply-To=%3CDS7PR06MB6789F1C1721EA84314FF5F89E91A9%40DS7PR06MB6789.namprd06.prod.outlook.com%3E"
       TITLE="[squid-users] req_header acl with ssl_bump">Matt.Toler at netapp.com
       </A><BR>
    <I>Wed Dec  7 21:26:11 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025501.html">[squid-users] No buffer space available
</A></li>
        <LI>Next message (by thread): <A HREF="025503.html">[squid-users] req_header acl with ssl_bump
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25502">[ date ]</a>
              <a href="thread.html#25502">[ thread ]</a>
              <a href="subject.html#25502">[ subject ]</a>
              <a href="author.html#25502">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

We are attempting to leverage headers to isolate access to external sites with squid 4.14. The Loadbalencer is injecting headers and squid is simply verifying them:

acl ACL_HDR_1 req_header Repo_Svr_VerifiedHdr True
acl REPO_DST_ALLOW dstdomain &quot;/etc/squid/acls.d/hosts.acl&quot;
http_access allow                           PROXY-SRC REPO_DST_ALLOW ACL_HDR_1

We are currently decrypting this traffic and it's working well.

Now we have a requirement to skip ssl decrypt for only certain destinations. My thought was to simply create a separate ACL where skipping ssl decrypt is required and add the header ACL to the end of the ssl_bump directive like so:

acl Repo_Skip_HDR req_header Repo_Svr_VerifiedHdr True
acl Repo_SkipSslDecrypt dstdomain &quot;/etc/squid/acls.d/hosts.acl&quot;
ssl_bump none Repo_SkipSslDecrypt  Repo_Skip_HDR

This parsed successfully but did not have the desired effect. The squid is still inspecting the traffic even with the header present as we can see in the logs. Making things a little more complex, the ssl_bump directive seems to have a global effect and also imply &quot;http_access allow&quot; making it difficult isolate access. To get around this I thought to simply skip ssl decrypt for the traffic with verified headers:

acl Repo_Skip_HDR req_header Repo_Svr_VerifiedHdr True
ssl_bump none Repo_Skip_HDR

Unfortunately even this isn't working, again the config checks out and runs happily, we see the header in the logs, but squid still tries to inspect the traffic.

Any thoughts on why ssl_bump would ignore the header ACL or other suggestions to isolate traffic when being required to skip ssl decrypt would be greatly appreciated.

Thanks in advance.

Regards,
Matt Toler










-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20221207/544a5a51/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20221207/544a5a51/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025501.html">[squid-users] No buffer space available
</A></li>
	<LI>Next message (by thread): <A HREF="025503.html">[squid-users] req_header acl with ssl_bump
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25502">[ date ]</a>
              <a href="thread.html#25502">[ thread ]</a>
              <a href="subject.html#25502">[ subject ]</a>
              <a href="author.html#25502">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
