<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] How to fix the error error:transaction-end-before-headers in access log
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20How%20to%20fix%20the%20error%0A%20error%3Atransaction-end-before-headers%20in%20access%20log&In-Reply-To=%3C000101d818c7%24e97ea7e0%24bc7bf7a0%24%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024483.html">
   <LINK REL="Next"  HREF="024476.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] How to fix the error error:transaction-end-before-headers in access log</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20How%20to%20fix%20the%20error%0A%20error%3Atransaction-end-before-headers%20in%20access%20log&In-Reply-To=%3C000101d818c7%24e97ea7e0%24bc7bf7a0%24%40gmail.com%3E"
       TITLE="[squid-users] How to fix the error error:transaction-end-before-headers in access log">ngtech1ltd at gmail.com
       </A><BR>
    <I>Thu Feb  3 06:33:08 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="024483.html">[squid-users] [ext] Re: Absolute upper limit for filedescriptors in squid-6?
</A></li>
        <LI>Next message (by thread): <A HREF="024476.html">[squid-users] Base64 encoding of X-Authenticated-User Request Header
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24470">[ date ]</a>
              <a href="thread.html#24470">[ thread ]</a>
              <a href="subject.html#24470">[ subject ]</a>
              <a href="author.html#24470">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey,

In the case of health checks it's possible to write these in a way that will not result with this error line.
In case we would have the L4 balancer vendor we might be able to suggest on the right way to health check squid.

A nice example in haproxy can be seen at:
<A HREF="https://www.serverlab.ca/tutorials/linux/network-services/how-to-configure-haproxy-health-checks/">https://www.serverlab.ca/tutorials/linux/network-services/how-to-configure-haproxy-health-checks/</A>

The next line should be good enough to understand:
	option httpchk HEAD /squid-internal-static/icons/SN.png HTTP/1.1\r\nHost:\ proxy-host-or-ip\r\n

Another option is:
	option httpchk HEAD /squid-internal-mgr/menu HTTP/1.1\r\nHost:\ proxy-host-or-ip\r\n

Which will require couple manager ACLs to make sure only the LB will have access to the internal mgr pages.

Hope This Helps,
Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A>

-----Original Message-----
From: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; On Behalf Of Alex Rousskov
Sent: Thursday, January 20, 2022 19:40
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] How to fix the error error:transaction-end-before-headers in access log

On 1/20/22 2:42 AM, Matus UHLAR - fantomas wrote:
&gt;<i> On 20.01.22 07:04, Hg Mi wrote:
</I>&gt;&gt;<i> We currently using squid 4.13 on ubuntu 18.04,  the following error
</I>&gt;&gt;<i> generates really frequently in the access.log.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> error:transaction-end-before-headers
</I>&gt;<i> 
</I>&gt;<i> it means that either client or server closed connection before
</I>
In most cases, this means the client opened a TCP connection to a Squid
listening port and then closed it without sending the HTTP headers. To
figure out who is at fault, you need to figure out who is making these
connections to Squid and why they are closing them without sending HTTP
headers (if that is what they are actually doing).

Bugs notwithstanding, server closures should not lead to
transaction-end-before-headers records.

&gt;&gt;<i> Is this a bug in squid4?  or it was misconfigured in my environment?
</I>&gt;<i> 
</I>&gt;<i> most likely your environment. don't you have any content filter in front of
</I>&gt;<i> your proxy?
</I>
... or anything that would &quot;probe&quot; or &quot;health check&quot; Squid http_port or
https_port at TCP level.


HTH,

Alex.
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="024483.html">[squid-users] [ext] Re: Absolute upper limit for filedescriptors in squid-6?
</A></li>
	<LI>Next message (by thread): <A HREF="024476.html">[squid-users] Base64 encoding of X-Authenticated-User Request Header
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24470">[ date ]</a>
              <a href="thread.html#24470">[ thread ]</a>
              <a href="subject.html#24470">[ subject ]</a>
              <a href="author.html#24470">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
