<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] external helper development
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20external%20helper%20development&In-Reply-To=%3C000401d8198d%245c30e120%241492a360%24%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024472.html">
   <LINK REL="Next"  HREF="024478.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] external helper development</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20external%20helper%20development&In-Reply-To=%3C000401d8198d%245c30e120%241492a360%24%40gmail.com%3E"
       TITLE="[squid-users] external helper development">ngtech1ltd at gmail.com
       </A><BR>
    <I>Fri Feb  4 06:06:31 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="024472.html">[squid-users] external helper development
</A></li>
        <LI>Next message (by thread): <A HREF="024478.html">[squid-users] external helper development
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24473">[ date ]</a>
              <a href="thread.html#24473">[ thread ]</a>
              <a href="subject.html#24473">[ subject ]</a>
              <a href="author.html#24473">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey David,

 

First, PHP is a good language however it doesn&#8217;t handle well STDIN/STDOUT helpers and crashes more then once without any warnings.

It&#8217;s documented in the PHP docs (Don&#8217;t remember exactly where).

Regarding PHP compared to PHP being faster, it&#8217;s pretty simple to test and validate if the cost of the crash is better than the speed.

What python and PHP code have used in your tests? (I would be happy to try and test it..).

You can see this session helper written in python:

<A HREF="https://wiki.squid-cache.org/EliezerCroitoru/SessionHelper/Python">https://wiki.squid-cache.org/EliezerCroitoru/SessionHelper/Python</A>

 

And about the cache of each helpers, the cost of a cache on a single helper is not much in terms of memory comparing to some network access.

Again it&#8217;s possible to test and verify this on a loaded system to get results. The delay itself can be seen from squid side in the cache manager statistics.

 

You can also try to compare the next ruby helper:

<A HREF="https://wiki.squid-cache.org/EliezerCroitoru/SessionHelper">https://wiki.squid-cache.org/EliezerCroitoru/SessionHelper</A>

 

About a shared &#8220;base&#8221; which allows helpers to avoid computation of the query&#8230;. It&#8217;s a good argument, however it depends what is the cost of
pulling from the cache compared to calculating the answer.

A very simple string comparison or regex matching would probably be faster than reaching a shared storage in many cases.

 

Also take into account the &#8220;concurrency&#8221; support from the helper side.

A helper that supports parallel processing of requests/lines can do better then many single helpers in more than once use case.

In any case I would suggest to enable requests concurrency from squid side since the STDIN buffer will emulate some level of concurrency
by itself and will allow squid to keep going forward faster.

 

Just to mention that SquidGuard have used a single helper cache for a very long time, ie every single SquidGuard helper has it&#8217;s own copy of the whole

configuration and database files in memory.

 

And again, if you do have any option to implement a server service model and that the helpers will contact this main service you will be able to implement
much faster internal in-memory cache compared to a redis/memcahe/other external daemon(need to be tested).

 

A good example for this is ufdbguard which has helpers that are clients of the main service which does the whole heavy lifting and also holds 
one copy of the DB.

 

I have implemented SquidBlocker this way and have seen that it out-performs any other service I have tried until now.

 

Eliezer

 

----

Eliezer Croitoru

NgTech, Tech Support

Mobile: +972-5-28704261

Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A>&gt; 

 

From: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; On Behalf Of David Touzeau
Sent: Thursday, February 3, 2022 14:24
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] external helper development

 

Hi Elizer

You are right in a way but when squid loads multiple helpers, each helper will use its own cache.
Using a shared &quot;base&quot; allows helpers to avoid having to compute a query already found by another helper who already has the answer.

Concerning PHP what we find strange is that with our tests, a simple loop and an &quot;echo OK&quot;, php goes faster: 1.5x than python.

Le 03/02/2022 &#224; 07:09, Eliezer Croitoru a &#233;crit :

Hey Andre,
 
Every language has a &quot;cost&quot; for it's qualities.
For example, Golang is a very nice language that offers a relatively simple way for concurrency support and cross hardware compilation/compatibility.
One cost in Golang is that the binary is in the size of an OS/Kernel.
In python you must write everything in a specific position and indentation and threading is not simple to implement for a novice.
However when you see what was written in Python you can see that most of OpenStack api's and systems are written in.. python and it means something.
I like very much ruby but it doesn't support threading by nature but supports &quot;concurrency&quot;.
Squid doesn't implement threading but implements &quot;concurrency&quot;.
 
Don't touch PHP as a helper!!! (+1 to Alex)
 
Also take into account that Redis or Memcached is less preferred in many cases if the library doesn't re-use the existing connection for multiple queries.
Squid also implements caching for helpers answers so it's possible to implement the helper and ACL's in such a way that squid caching will
help you to lower the access to the external API and or redis/memcahced/DB.
I also have good experience with some libraries which implements cache that I have used inside a helper with a limited size for &quot;level 1&quot; cache.
It's possible that if you will implement both the helper and server side of the solution like ufdbguard you would be able to optimize the system
to take very high load.
 
I hope the above will help you.
Eliezer
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A>&gt; 
 
-----Original Message-----
From: squid-users  &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; On Behalf Of Andr&#233; Bolinhas
Sent: Wednesday, February 2, 2022 00:09
To: 'Alex Rousskov'  &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt;; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt; 
Subject: Re: [squid-users] external helper development
 
Hi
Thanks for the reply.
I will take a look on Rust as you recommend.
Also, between Python and Go and is the best for multithreading and concurrency?
Rust supports multithreading and concurrency?
Best regards
 
-----Mensagem original-----
De: squid-users  &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; Em Nome De Alex Rousskov
Enviada: 1 de fevereiro de 2022 22:01
Para: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt; 
Assunto: Re: [squid-users] external helper development
 
On 2/1/22 16:47, Andr&#233; Bolinhas wrote:

Hi
 
I&#8217;m building an external helper to get the categorization of an 
website, I know how to build it, but I need you option about the best 
language for the job in terms of performance, bottlenecks, I/O blocking..
 
The helper will work like this.
 
1&#186;  will check the hot memory for faster response (memcache or redis)
 
2&#186; If the result not exist in hot memory then will check an external 
api to fetch the categorie and saved it in hot memory.
 
In what language do you recommend develop such helper? PHP, Python, Go..

 
If this helper is for long-term production use, and you are willing to learn new things, then use Rust[1]. Otherwise, use whatever language you are the most comfortable with already (except PHP), especially if that language has good libraries/wrappers for the external APIs you will need to use.
 
Alex.
[1] <A HREF="https://www.rust-lang.org/">https://www.rust-lang.org/</A>
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt; 
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
 
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt; 
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
 
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt; 
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20220204/f16bd717/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20220204/f16bd717/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="024472.html">[squid-users] external helper development
</A></li>
	<LI>Next message (by thread): <A HREF="024478.html">[squid-users] external helper development
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24473">[ date ]</a>
              <a href="thread.html#24473">[ thread ]</a>
              <a href="subject.html#24473">[ subject ]</a>
              <a href="author.html#24473">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
