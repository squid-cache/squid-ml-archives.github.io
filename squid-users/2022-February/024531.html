<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid plugin sponsor
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20plugin%20sponsor&In-Reply-To=%3C1689437a-5611-1c64-9828-4e0d052cd1da%40articatech.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024530.html">
   <LINK REL="Next"  HREF="024503.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid plugin sponsor</H1>
    <B>David Touzeau</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20plugin%20sponsor&In-Reply-To=%3C1689437a-5611-1c64-9828-4e0d052cd1da%40articatech.com%3E"
       TITLE="[squid-users] Squid plugin sponsor">david at articatech.com
       </A><BR>
    <I>Tue Feb 15 00:48:37 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="024530.html">[squid-users] Squid plugin sponsor
</A></li>
        <LI>Next message (by thread): <A HREF="024503.html">[squid-users] Vulnerabilities with squid 4.15
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24531">[ date ]</a>
              <a href="thread.html#24531">[ thread ]</a>
              <a href="subject.html#24531">[ subject ]</a>
              <a href="author.html#24531">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Eliezer,

First of all, thank you for twisting your brain at our request.
I know your skills and your time is very valuable.

HotSpot+Cookies can be interesting but it has a constraint that 
kerberos/NTLM SSO fixes:

1)&#160; Redirecting connections to a HotSpot requires Squid to be able to 
forward the redirection.
When using SSL sites without MAN-IN-THE-MIDDLE, we fall into structural 
issues.

2)&#160; Even if this problem can be circumvented, it is necessary for the 
user to identify himself on the Splash Screen to understand who he is.
While this user is already identified with his Windows session.


Forget about NTLMv2 which does not provide the &quot;Fake&quot; anymore
The advantage of fake_ntlm is that when Squid performs its 407, 
naturally the browser sends its windows session username whether it is 
connected to an Active Directory or not.

This is what we want to catch in the end.

The HotSpot way is a half-solution. It circumvents the limit of 
identification but adds new network constraints you mention.

The dream is a plugin that forces Squid to generate a 407, asks to 
browsers &quot;Give me your user account whatever it is&quot; and allows access in 
any case to place the user=xxx switch for the next processing.

It almost looks like the &quot;ident&quot; method
<A HREF="http://www.squid-cache.org/Misc/ident.html">http://www.squid-cache.org/Misc/ident.html</A>
Without having to install a piece of software and a listening port on 
all the computers in the network

Le 14/02/2022 &#224; 19:50, Eliezer Croitoru a &#233;crit&#160;:
&gt;<i>
</I>&gt;<i> Hey David,
</I>&gt;<i>
</I>&gt;<i> Transparent authentication using Kerberos can only be used with a 
</I>&gt;<i> directory service.
</I>&gt;<i>
</I>&gt;<i> There are couple ways to authenticate&#8230;
</I>&gt;<i>
</I>&gt;<i> You can use an &#8220;automatic&#8221; hotspot website that will use cookies to 
</I>&gt;<i> authenticate the client once in a very long time.
</I>&gt;<i>
</I>&gt;<i> If the client request is not recognized or the client is not 
</I>&gt;<i> recognized for any reason it&#8217;s reasonable to redirect him into a 
</I>&gt;<i> captive portal.
</I>&gt;<i>
</I>&gt;<i> I can try to work on a demo but I need to know more details about the 
</I>&gt;<i> network structure and to verify what is possible and not.
</I>&gt;<i>
</I>&gt;<i> Every device ie Switch and router or AP etc should be mentioned to 
</I>&gt;<i> understand the scenario.
</I>&gt;<i>
</I>&gt;<i> While you assume it&#8217;s a chimera I still believe it&#8217;s just a three 
</I>&gt;<i> heads Kerberos which&#8230; was proved to exists&#8230; in the movies and in the 
</I>&gt;<i> virtual world.
</I>&gt;<i>
</I>&gt;<i> Eliezer
</I>&gt;<i>
</I>&gt;<i> ----
</I>&gt;<i>
</I>&gt;<i> Eliezer Croitoru
</I>&gt;<i>
</I>&gt;<i> NgTech, Tech Support
</I>&gt;<i>
</I>&gt;<i> Mobile: +972-5-28704261
</I>&gt;<i>
</I>&gt;<i> Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A>
</I>&gt;<i>
</I>&gt;<i> *From:*David Touzeau &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">david at articatech.com</A>&gt;
</I>&gt;<i> *Sent:* Monday, February 14, 2022 03:21
</I>&gt;<i> *To:* Eliezer Croitoru &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A>&gt;
</I>&gt;<i> *Cc:* <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> *Subject:* Re: [squid-users] Squid plugin sponsor
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thank you for your answer Elizer for all these details, but I've done 
</I>&gt;<i> some research to avoid soliciting the community for simple questions.
</I>&gt;<i>
</I>&gt;<i> The objective is to not ask anything to the user and not to break his 
</I>&gt;<i> navigation with a session request.
</I>&gt;<i> To summarize, An SSO identification like kerberos with the following 
</I>&gt;<i> constraints:
</I>&gt;<i>
</I>&gt;<i>  1. unknown Mac addresses
</I>&gt;<i>  2. DHCP IP with a short lease
</I>&gt;<i>  3. No Active Directory connection.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> The network is in VLAN (Mac addr masked) and in DHCP with a short lease.
</I>&gt;<i> Even the notion of hotspot is complicated when you can't focus on a 
</I>&gt;<i> network attribute.
</I>&gt;<i> I try to find a way directly in the HTTP protocol.
</I>&gt;<i> This is the reason why a fake could be a solution.
</I>&gt;<i>
</I>&gt;<i> But I think I'm trying to catch a chimera and we'll have to redesign 
</I>&gt;<i> the network architecture.
</I>&gt;<i>
</I>&gt;<i> regards
</I>&gt;<i>
</I>&gt;<i> Le 12/02/2022 &#224; 06:27, Eliezer Croitoru a &#233;crit&#160;:
</I>&gt;<i>
</I>&gt;<i>     Hey David,
</I>&gt;<i>
</I>&gt;<i>     The general name of this concept is SSO service.
</I>&gt;<i>
</I>&gt;<i>     It can have single or multiple backends.
</I>&gt;<i>
</I>&gt;<i>     The main question is how to implement the solution in the optimal
</I>&gt;<i>     way possible.
</I>&gt;<i>     (taking into account money, coding complexity and other humane parts)
</I>&gt;<i>
</I>&gt;<i>     You will need to authenticate the client against the main AUTH
</I>&gt;<i>     service.
</I>&gt;<i>
</I>&gt;<i>     There is a definitive way or statistical way to implement this
</I>&gt;<i>     solution.
</I>&gt;<i>
</I>&gt;<i>     With AD or Kerberos it&#8217;s possible to implement the solution in
</I>&gt;<i>     such a way that windows will
</I>&gt;<i>     &#8220;transparently&#8221; authenticate to the proxy service.
</I>&gt;<i>
</I>&gt;<i>     However you must understand that all of this requires an
</I>&gt;<i>     infrastructure that will provide every piece of the setup.
</I>&gt;<i>
</I>&gt;<i>     If your setup doesn&#8217;t contains RDP like servers then it&#8217;s possible
</I>&gt;<i>     that you can authenticate a user with an IP compared
</I>&gt;<i>     to pinning every connection to a specific user.
</I>&gt;<i>
</I>&gt;<i>     Also, the &#8220;cost&#8221; of non-transparent authentication is that the
</I>&gt;<i>     user will be required to enter (manually or automatically)
</I>&gt;<i>     the username and the password.
</I>&gt;<i>
</I>&gt;<i>     An HotSpot like setup is called &#8220;Captive Portal&#8221; and it&#8217;s a very
</I>&gt;<i>     simple setup to implement with active directory.
</I>&gt;<i>
</I>&gt;<i>     It&#8217;s also possible to implement a transparent authentication for
</I>&gt;<i>     such a setup based on session tokens.
</I>&gt;<i>
</I>&gt;<i>     You actually don&#8217;t need to create a &#8220;fake&#8221; helper for such a setup
</I>&gt;<i>     but you can create one that is based on Linux.
</I>&gt;<i>
</I>&gt;<i>     It&#8217;s an &#8220;Advanced&#8221; topic but if you do ask me it&#8217;s possible that
</I>&gt;<i>     you can take this in steps.
</I>&gt;<i>
</I>&gt;<i>     The first step would be to use a session helper that will
</I>&gt;<i>     authenticate the user and will identify the user
</I>&gt;<i>     based on it&#8217;s IP address.
</I>&gt;<i>
</I>&gt;<i>     If it&#8217;s a wireless setup you can use a radius based authentication
</I>&gt;<i>     ( can also be implemented on a wired setup).
</I>&gt;<i>
</I>&gt;<i>     Once you will authenticate the client transparently or in another
</I>&gt;<i>     way you can limit the usage of the username to
</I>&gt;<i>     a specific client and with that comes a guaranteed situation that
</I>&gt;<i>     a username will not be used from two sources.
</I>&gt;<i>
</I>&gt;<i>     I don&#8217;t know about your experience but the usage of a captive
</I>&gt;<i>     portal is very common In such situations.
</I>&gt;<i>
</I>&gt;<i>     The other option is to create an agent in the client side that
</I>&gt;<i>     will identify the user against the proxy/auth service
</I>&gt;<i>     and it will create a situation which an authorization will be
</I>&gt;<i>     acquired based on some degree of authentication.
</I>&gt;<i>
</I>&gt;<i>     In most SSO environments it&#8217;s possible that per
</I>&gt;<i>     request/domain/other there is a transparent validation.
</I>&gt;<i>
</I>&gt;<i>     In all the above scenarios which requires authentication the right
</I>&gt;<i>     way to do it would be to use the proxy as
</I>&gt;<i>     a configured proxy compared to transparent.
</I>&gt;<i>
</I>&gt;<i>     I believe that one thing to consider is that once you authenticate
</I>&gt;<i>     against a RADIUS service you would just
</I>&gt;<i>     minimize the user interaction.
</I>&gt;<i>
</I>&gt;<i>     The main point from what I understand is to actually minimize the
</I>&gt;<i>     authentication steps of the client.
</I>&gt;<i>
</I>&gt;<i>     My suggestion for you is to first try and asses the complexity of
</I>&gt;<i>     a session helper, raidus and captive portal.
</I>&gt;<i>
</I>&gt;<i>     These are steps that you will need to do in order to asses the
</I>&gt;<i>     necessity of transparent SSO.
</I>&gt;<i>
</I>&gt;<i>     Also take your time to compare how a captive portal is configured
</I>&gt;<i>     in the next general products:
</I>&gt;<i>
</I>&gt;<i>      1. Palo Alto
</I>&gt;<i>      2. FortiGate
</I>&gt;<i>      3. Untangle
</I>&gt;<i>      4. Others
</I>&gt;<i>
</I>&gt;<i>     From the documentation you would see the different ways and
</I>&gt;<i>     &#8220;grades&#8221; that they implement the solutions.
</I>&gt;<i>
</I>&gt;<i>     Once you know what the market offers and their equivalent costs
</I>&gt;<i>     you will probably understand what
</I>&gt;<i>     you want and what you can afford to invest in the development
</I>&gt;<i>     process of each part of setup.
</I>&gt;<i>
</I>&gt;<i>     All The Bests,
</I>&gt;<i>
</I>&gt;<i>     Eliezer
</I>&gt;<i>
</I>&gt;<i>     ----
</I>&gt;<i>
</I>&gt;<i>     Eliezer Croitoru
</I>&gt;<i>
</I>&gt;<i>     NgTech, Tech Support
</I>&gt;<i>
</I>&gt;<i>     Mobile: +972-5-28704261
</I>&gt;<i>
</I>&gt;<i>     Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A>
</I>&gt;<i>
</I>&gt;<i>     *From:*squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt;
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; *On Behalf Of
</I>&gt;<i>     *David Touzeau
</I>&gt;<i>     *Sent:* Friday, February 11, 2022 17:03
</I>&gt;<i>     *To:* <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i>     *Subject:* Re: [squid-users] Squid plugin sponsor
</I>&gt;<i>
</I>&gt;<i>     Hello
</I>&gt;<i>
</I>&gt;<i>     Thank you but this is not the objective and this is the reason for
</I>&gt;<i>     needing the &quot;fake&quot;.
</I>&gt;<i>     Access to Kerberos or NTLM ports of the AD, is not possible. An
</I>&gt;<i>     LDAP server would be present with accounts replication.
</I>&gt;<i>     The idea is to do a silent authentication without joining the AD
</I>&gt;<i>     We did not need the double user/password credential, only the user
</I>&gt;<i>     sent by the browser is required
</I>&gt;<i>
</I>&gt;<i>     If the user has an Active Directory session then his account is
</I>&gt;<i>     automatically sent without him having to take any action.
</I>&gt;<i>     If the user is in a workgroup then the account sent will not be in
</I>&gt;<i>     the LDAP database and will be rejected.
</I>&gt;<i>     I don't need to argue about the security value of this method. It
</I>&gt;<i>     saves us from setting up a gas factory to make a kind of HotSpot
</I>&gt;<i>
</I>&gt;<i>     Le 11/02/2022 &#224; 05:55, Dieter Bloms a &#233;crit&#160;:
</I>&gt;<i>
</I>&gt;<i>         Hello David,
</I>&gt;<i>
</I>&gt;<i>           
</I>&gt;<i>
</I>&gt;<i>         for me it looks like you want to use kerberos authentication.
</I>&gt;<i>
</I>&gt;<i>         With kerberos authentication the user don't have to authenticate against
</I>&gt;<i>
</I>&gt;<i>         the proxy. The authentication is done in the background.
</I>&gt;<i>
</I>&gt;<i>           
</I>&gt;<i>
</I>&gt;<i>         Mayb this link will help:
</I>&gt;<i>
</I>&gt;<i>           
</I>&gt;<i>
</I>&gt;<i>         <A HREF="https://wiki.squid-cache.org/ConfigExamples/Authenticate/Kerberos">https://wiki.squid-cache.org/ConfigExamples/Authenticate/Kerberos</A>
</I>&gt;<i>
</I>&gt;<i>           
</I>&gt;<i>
</I>&gt;<i>         On Thu, Feb 10, David Touzeau wrote:
</I>&gt;<i>
</I>&gt;<i>           
</I>&gt;<i>
</I>&gt;<i>             Hi
</I>&gt;<i>
</I>&gt;<i>               
</I>&gt;<i>
</I>&gt;<i>             What we are looking for is to retrieve a &quot;user&quot; token without having to ask
</I>&gt;<i>
</I>&gt;<i>             anything from the user.
</I>&gt;<i>
</I>&gt;<i>             That's why we're looking at Active Directory credentials.
</I>&gt;<i>
</I>&gt;<i>             Once the user account is retrieved, a helper would be in charge of checking
</I>&gt;<i>
</I>&gt;<i>             if the user exists in the LDAP database.
</I>&gt;<i>
</I>&gt;<i>             This is to avoid any connection to an Active Directory
</I>&gt;<i>
</I>&gt;<i>             Maybe this is impossible
</I>&gt;<i>
</I>&gt;<i>               
</I>&gt;<i>
</I>&gt;<i>               
</I>&gt;<i>
</I>&gt;<i>             Le 10/02/2022 &#224; 05:03, Amos Jeffries a &#233;crit&#160;:
</I>&gt;<i>
</I>&gt;<i>                 On 10/02/22 01:43, David Touzeau wrote:
</I>&gt;<i>
</I>&gt;<i>                     Hi
</I>&gt;<i>
</I>&gt;<i>                       
</I>&gt;<i>
</I>&gt;<i>                     I would like to sponsor the improvement of ntlm_fake_auth to support
</I>&gt;<i>
</I>&gt;<i>                     new protocols
</I>&gt;<i>
</I>&gt;<i>                   
</I>&gt;<i>
</I>&gt;<i>                 ntlm_* helpers are specific to NTLM authentication. All LanManager (LM)
</I>&gt;<i>
</I>&gt;<i>                 protocols should already be supported as well as currently possible.
</I>&gt;<i>
</I>&gt;<i>                 NTLM is formally discontinued by MS and *very* inefficient.
</I>&gt;<i>
</I>&gt;<i>                   
</I>&gt;<i>
</I>&gt;<i>                 NP: NTLMv2 with encryption does not *work* because that encryption step
</I>&gt;<i>
</I>&gt;<i>                 requires secret keys the proxy is not able to know.
</I>&gt;<i>
</I>&gt;<i>                   
</I>&gt;<i>
</I>&gt;<i>                     or go further produce a new negotiate_kerberos_auth_fake
</I>&gt;<i>
</I>&gt;<i>                       
</I>&gt;<i>
</I>&gt;<i>                   
</I>&gt;<i>
</I>&gt;<i>                 With current Squid this helper only needs to produce an &quot;OK&quot; response
</I>&gt;<i>
</I>&gt;<i>                 regardless of the input. The basic_auth_fake does that.
</I>&gt;<i>
</I>&gt;<i>                   
</I>&gt;<i>
</I>&gt;<i>                 Amos
</I>&gt;<i>
</I>&gt;<i>                 _______________________________________________
</I>&gt;<i>
</I>&gt;<i>                 squid-users mailing list
</I>&gt;<i>
</I>&gt;<i>                 <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i>
</I>&gt;<i>                 <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>&gt;<i>           
</I>&gt;<i>
</I>&gt;<i>             _______________________________________________
</I>&gt;<i>
</I>&gt;<i>             squid-users mailing list
</I>&gt;<i>
</I>&gt;<i>             <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i>
</I>&gt;<i>             <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>&gt;<i>           
</I>&gt;<i>
</I>&gt;<i>           
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20220215/e5a97f60/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20220215/e5a97f60/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="024530.html">[squid-users] Squid plugin sponsor
</A></li>
	<LI>Next message (by thread): <A HREF="024503.html">[squid-users] Vulnerabilities with squid 4.15
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24531">[ date ]</a>
              <a href="thread.html#24531">[ thread ]</a>
              <a href="subject.html#24531">[ subject ]</a>
              <a href="author.html#24531">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
