<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid-5.4 blocking on ipv6 outage
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid-5.4%20blocking%20on%20ipv6%20outage&In-Reply-To=%3C4f905581-9dee-fbd1-a1b1-84f1df4e5792%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024535.html">
   <LINK REL="Next"  HREF="024539.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid-5.4 blocking on ipv6 outage</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid-5.4%20blocking%20on%20ipv6%20outage&In-Reply-To=%3C4f905581-9dee-fbd1-a1b1-84f1df4e5792%40measurement-factory.com%3E"
       TITLE="[squid-users] squid-5.4 blocking on ipv6 outage">rousskov at measurement-factory.com
       </A><BR>
    <I>Mon Feb 21 14:16:50 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="024535.html">[squid-users] squid-5.4 blocking on ipv6 outage
</A></li>
        <LI>Next message (by thread): <A HREF="024539.html">[squid-users] squid-5.4 blocking on ipv6 outage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24537">[ date ]</a>
              <a href="thread.html#24537">[ thread ]</a>
              <a href="subject.html#24537">[ subject ]</a>
              <a href="author.html#24537">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2/20/22 20:43, Jason Haar wrote:

&gt;<i> I've noticed that the Internet ipv6 is not quite as reliable as ipv4, in 
</I>&gt;<i> that squid&#160;reports it cannot connect to web servers with an ipv6 error 
</I>&gt;<i> when the web server is still available over ipv4.
</I>&gt;<i> 
</I>&gt;<i> eg right now one of our Internet-based web apps (which has 2 ipv6 and 2 
</I>&gt;<i> ipv4 IP addresses mapped to it's DNS name) is not responding over ipv6 
</I>&gt;<i> for some reason (I dunno - not involved myself) - but is working fine 
</I>&gt;<i> over ipv4. Squid-5.4 is erroring out - saying that it cannot connect to 
</I>&gt;<i> the first ipv6 address with a &quot;no route to host&quot; error. But if I use 
</I>&gt;<i> good-ol' telnet to the DNS name, telnet shows it trying-and-failing 
</I>&gt;<i> against both ipv6 addresses and then succeeds against the ipv4. ie it 
</I>&gt;<i> works and squid doesn't. BTW the same squid server is currently fine 
</I>&gt;<i> with ipv6 clients talking to it and it talking over ipv6 to Internet 
</I>&gt;<i> hosts like google.com &lt;<A HREF="http://google.com">http://google.com</A>&gt; - ie this is an ipv6 outage on 
</I>&gt;<i> one Internet host where it's ipv4 is still working.
</I>&gt;<i> 
</I>&gt;<i> This doesn't seem like a negative_dns_ttl setting issue, it seems like 
</I>&gt;<i> squid&#160;just tries one address on a multiple-IP DNS record and stops 
</I>&gt;<i> trying? I even got tcpdump up and can see that when I do a 
</I>&gt;<i> &quot;shift-reload&quot; on the webpage, squid only sends a few SYN packets to the 
</I>&gt;<i> same non-working IPv6 address - it doesn't even try the other 3 IPs?
</I>&gt;<i> 
</I>&gt;<i> I also checked squidcachemgr.cgi and the DNS record isn't even cached in 
</I>&gt;<i> &quot;FQDN Cache Stats and Contents&quot;, which I guess is consistent with it's 
</I>&gt;<i> opinion that it's not working.
</I>&gt;<i> 
</I>&gt;<i> Any ideas what's going on there? thanks!
</I>
Squid is supposed to send both A and AAAA DNS queries for the uncached 
domain and then try the first IP it can DNS-resolve and TCP-connect to. 
If that winning destination does not work at HTTP level, then Squid may, 
in some cases, try other destinations. There are lots of variables and 
nuances related to the associated Happy Eyeballs and reforwarding 
algorithms. It is impossible to say for sure what is going on in your 
specific case without more information.

Your best bet may be to share an ALL,9 cache.log that reproduces the 
problem using a single isolated test transaction:

<A HREF="https://wiki.squid-cache.org/SquidFaq/BugReporting#Debugging_a_single_transaction">https://wiki.squid-cache.org/SquidFaq/BugReporting#Debugging_a_single_transaction</A>


HTH,

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="024535.html">[squid-users] squid-5.4 blocking on ipv6 outage
</A></li>
	<LI>Next message (by thread): <A HREF="024539.html">[squid-users] squid-5.4 blocking on ipv6 outage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24537">[ date ]</a>
              <a href="thread.html#24537">[ thread ]</a>
              <a href="subject.html#24537">[ subject ]</a>
              <a href="author.html#24537">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
