<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Trying to set up SSL cache - solved!
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Trying%20to%20set%20up%20SSL%20cache%20-%20solved%21&In-Reply-To=%3C20220224122435.257ddc228d11dff7cd21285c%40killthe.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024586.html">
   <LINK REL="Next"  HREF="024561.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Trying to set up SSL cache - solved!</H1>
    <B>Dave Blanchard</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Trying%20to%20set%20up%20SSL%20cache%20-%20solved%21&In-Reply-To=%3C20220224122435.257ddc228d11dff7cd21285c%40killthe.net%3E"
       TITLE="[squid-users] Trying to set up SSL cache - solved!">dave at killthe.net
       </A><BR>
    <I>Thu Feb 24 18:24:35 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="024586.html">[squid-users] Trying to set up SSL cache - solved!
</A></li>
        <LI>Next message (by thread): <A HREF="024561.html">[squid-users] Trying to set up SSL cache - solved! - correction
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24560">[ date ]</a>
              <a href="thread.html#24560">[ thread ]</a>
              <a href="subject.html#24560">[ subject ]</a>
              <a href="author.html#24560">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, 24 Feb 2022 11:08:48 -0500
Alex Rousskov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt; wrote:

&gt;<i> On 2/23/22 22:09, Dave Blanchard wrote:
</I>&gt;<i> &gt; OK--I solved the problem by removing the &quot;ssl_bump bump all&quot; line.
</I>&gt;<i> &gt; Works fine now.
</I>&gt;<i> 
</I>&gt;<i> &gt; Damn, this proxy is a TOTAL PAIN IN THE ASS!! to configure. It seems
</I>&gt;<i> &gt; like 90% of the tutorials out there are junk, largely because things
</I>&gt;<i> &gt; keep changing from version to version, obsoleting them.
</I>&gt;<i> 
</I>&gt;<i> This email thread is a good example. The original ssl_bump config shared 
</I>&gt;<i> in the beginning of the thread did not make sense at all. Squid bugs 
</I>&gt;<i> notwithstanding, the implied second config (the one with &quot;ssl_bump bump 
</I>&gt;<i> all&quot; line removed) should not cache any HTTPS transactions either. 
</I>&gt;<i> However, folks will read this thread, copy the original config, maybe 
</I>&gt;<i> remove the &quot;bump&quot; line, and expect things to &quot;work&quot; because the 
</I>&gt;<i> &quot;problem&quot; was &quot;solved&quot; for somebody else.
</I>&gt;<i> 
</I>
Sorry, it was irresponsible of me to forget to mention that I changed the 'peek' line to 'stare', and added in another line. The final config, not counting the other default config items which were left unchanged, is as follows:

http_port 3128 ssl-bump \
               generate-host-certificates=on \
               dynamic_cert_mem_cache_size=32MB \
               cert=/path/to/cert.pem \
               key=/path/to/cert.pem

sslcrtd_program /usr/libexec/security_file_certgen -s /path/to/ssl_database -M 32MB

ssl_bump client-first all
ssl_bump stare all
ssl_bump splice localhost

(Note for any other confused noobs reading this: this configuration apparently requires Squid to be compiled with --with openssl and --with-ssl-crtd options on the 'configure' command line; or at least it did in older versions, and presumably still does.)

This final config works perfectly to cache SSL items, and has greatly increased the utility of my slow connection.

&gt;<i> 
</I>&gt;<i> &gt; Please add more concrete examples to the Wiki reference pages!
</I>&gt;<i> 
</I>&gt;<i> IMHO, SslBump is too nuanced/complex to be able to reuse simple 
</I>&gt;<i> configurations without understanding their meaning. We should improve 
</I>&gt;<i> documentation a lot, but it takes a village to do that, and &quot;more 
</I>&gt;<i> examples&quot; is hardly the answer.
</I>&gt;<i> 
</I>&gt;<i> Alex.
</I>
Although I am sure the reference material is extremely valuable, as a non-expert I found it frustrating, as there almost NO concrete examples on each reference page, which SHOW the given config option being used in real world configurations. This is a common problem to a lot of 'man' pages in the Linux world for example which have page after page of information that is essentially useless unless one is already an expert, or extremely tedious to parse through, because it does not give concrete examples. 

On other sections of the wiki there are more explanatory texts showing various how-to scenarios, but again, I couldn't find a single one that showed this exact configuration here and briefly explained why/how it works, step by step according to what Squid is doing at each step. I ended up finding the key parts of the above config on a third party tutorial page (&quot;How I saved countless gigabytes of data with Squid caching&quot; or something like that), while deleting several lines from that config which were apparently unneeded/outdated. Actually I thought I had read somewhere that the 'client-first' line is itself outdated, but Squid doesn't complain about it, so maybe not. Anyhow, it works. 

I don't understand exactly *how* it works, because I don't have time to study all the internal workings of Squid at this time; just needed to quickly get a proxy up and running to solve this problem and move on to other work. As it was, I had like two dozen browser tabs open reading different things, only to slowly and painfully piece together what turns out to be a very simple config.

-- 
Dave Blanchard &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">dave at killthe.net</A>&gt;

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="024586.html">[squid-users] Trying to set up SSL cache - solved!
</A></li>
	<LI>Next message (by thread): <A HREF="024561.html">[squid-users] Trying to set up SSL cache - solved! - correction
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24560">[ date ]</a>
              <a href="thread.html#24560">[ thread ]</a>
              <a href="subject.html#24560">[ subject ]</a>
              <a href="author.html#24560">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
