<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Getting SSL Connection Errors
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Getting%20SSL%20Connection%20Errors&In-Reply-To=%3C006f01d82a04%24b678b770%24236a2650%24%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024565.html">
   <LINK REL="Next"  HREF="024570.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Getting SSL Connection Errors</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Getting%20SSL%20Connection%20Errors&In-Reply-To=%3C006f01d82a04%24b678b770%24236a2650%24%40gmail.com%3E"
       TITLE="[squid-users] Getting SSL Connection Errors">ngtech1ltd at gmail.com
       </A><BR>
    <I>Fri Feb 25 05:01:12 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="024565.html">[squid-users] Getting SSL Connection Errors
</A></li>
        <LI>Next message (by thread): <A HREF="024570.html">[squid-users] Random trouble with image downloads
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24569">[ date ]</a>
              <a href="thread.html#24569">[ thread ]</a>
              <a href="subject.html#24569">[ subject ]</a>
              <a href="author.html#24569">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey Usama,

 

There are more missing details on the system.

If you provide the OS and squid details I might be able to provide a script that will pull most of the relevant details on the system.

I don&#8217;t know about this specific issue yet and it seems like there is a SSL related issue and it might not be even related to Squid.

(@Alex Or @Chrisots might know better then me)

 

All The Bests,

 

----

Eliezer Croitoru

NgTech, Tech Support

Mobile: +972-5-28704261

Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A>&gt; 

 

From: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; On Behalf Of Usama Mehboob
Sent: Thursday, February 24, 2022 23:45
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: [squid-users] Getting SSL Connection Errors

 

Hi I have a squid running on a linux box ( about 16GB ram and 4 cpu ) -- it runs fine for the most part but when I am launching multiple jobs that are connecting with salesforce BulkAPI, sometimes connections are dropped. its not predictable and happens only when there is so much load on squid. Can anyone shed some light on this? what can I do? is it a file descriptor issue?

I see only these error messages from the cache logs
```
PeerConnector.cc(639) handleNegotiateError: Error (error:04091068:rsa routines:INT_RSA_VERIFY:bad signature) but, hold write on SSL connection on FD 109
```

----------------Config file ----------------
visible_hostname squid 

#
# Recommended minimum configuration:
#

# Example rule allowing access from your local networks.
# Adapt to list your (internal) IP networks from where browsing
# should be allowed
acl localnet src 10.0.0.0/8 &lt;<A HREF="http://10.0.0.0/8">http://10.0.0.0/8</A>&gt;  # RFC1918 possible internal network
acl localnet src 172.16.0.0/12 &lt;<A HREF="http://172.16.0.0/12">http://172.16.0.0/12</A>&gt;  # RFC1918 possible internal network
acl localnet src 192.168.0.0/16 &lt;<A HREF="http://192.168.0.0/16">http://192.168.0.0/16</A>&gt;  # RFC1918 possible internal network
acl localnet src fc00::/7       # RFC 4193 local private network range
acl localnet src fe80::/10      # RFC 4291 link-local (directly plugged) machines

acl SSL_ports port 443
acl Safe_ports port 80 # http
###acl Safe_ports port 21 # ftp testing after blocking itp
acl Safe_ports port 443 # https
acl Safe_ports port 70 # gopher
acl Safe_ports port 210 # wais
acl Safe_ports port 1025-65535 # unregistered ports
acl Safe_ports port 280 # http-mgmt
acl Safe_ports port 488 # gss-http
acl Safe_ports port 591 # filemaker
acl Safe_ports port 777 # multiling http
acl CONNECT method CONNECT

#
# Recommended minimum Access Permission configuration:
#
# Deny requests to certain unsafe ports
http_access deny !Safe_ports

# Deny CONNECT to other than secure SSL ports
http_access deny CONNECT !SSL_ports
#http_access allow CONNECT SSL_ports

# Only allow cachemgr access from localhost
http_access allow localhost manager
http_access deny manager

# We strongly recommend the following be uncommented to protect innocent
# web applications running on the proxy server who think the only
# one who can access services on &quot;localhost&quot; is a local user
#http_access deny to_localhost

#
# INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
#

# Example rule allowing access from your local networks.
# Adapt localnet in the ACL section to list your (internal) IP networks
# from where browsing should be allowed

# And finally deny all other access to this proxy

# Squid normally listens to port 3128
#http_port 3128
http_port 3129 intercept
https_port 3130 cert=/etc/squid/ssl/squid.pem ssl-bump intercept 
http_access allow SSL_ports #-- this allows every https website
acl step1 at_step SslBump1 
acl step2 at_step SslBump2 
acl step3 at_step SslBump3 
ssl_bump peek step1 all 

# Deny requests to proxy instance metadata 
acl instance_metadata dst 169.254.169.254 
http_access deny instance_metadata 

# Filter HTTP Only requests based on the whitelist 
#acl allowed_http_only dstdomain .veevasourcedev.com &lt;<A HREF="http://veevasourcedev.com">http://veevasourcedev.com</A>&gt;  .google.com &lt;<A HREF="http://google.com">http://google.com</A>&gt;  .pypi.org &lt;<A HREF="http://pypi.org">http://pypi.org</A>&gt;  .youtube.com &lt;<A HREF="http://youtube.com">http://youtube.com</A>&gt; 
#acl allowed_http_only dstdomain .amazonaws.com &lt;<A HREF="http://amazonaws.com">http://amazonaws.com</A>&gt; 
#acl allowed_http_only dstdomain .veevanetwork.com &lt;<A HREF="http://veevanetwork.com">http://veevanetwork.com</A>&gt;  .veevacrm.com &lt;<A HREF="http://veevacrm.com">http://veevacrm.com</A>&gt;  .veevacrmdi.com &lt;<A HREF="http://veevacrmdi.com">http://veevacrmdi.com</A>&gt;  .veeva.com &lt;<A HREF="http://veeva.com">http://veeva.com</A>&gt;  .veevavault.com &lt;<A HREF="http://veevavault.com">http://veevavault.com</A>&gt;  .vaultdev.com &lt;<A HREF="http://vaultdev.com">http://vaultdev.com</A>&gt;  .veevacrmqa.com &lt;<A HREF="http://veevacrmqa.com">http://veevacrmqa.com</A>&gt; 
#acl allowed_http_only dstdomain .documentforce.com &lt;<A HREF="http://documentforce.com">http://documentforce.com</A>&gt;   .sforce.com &lt;<A HREF="http://sforce.com">http://sforce.com</A>&gt;  .force.com &lt;<A HREF="http://force.com">http://force.com</A>&gt;  .forceusercontent.com &lt;<A HREF="http://forceusercontent.com">http://forceusercontent.com</A>&gt;  .force-user-content.com &lt;<A HREF="http://force-user-content.com">http://force-user-content.com</A>&gt;  .lightning.com &lt;<A HREF="http://lightning.com">http://lightning.com</A>&gt;  .salesforce.com &lt;<A HREF="http://salesforce.com">http://salesforce.com</A>&gt;  .salesforceliveagent.com &lt;<A HREF="http://salesforceliveagent.com">http://salesforceliveagent.com</A>&gt;  .salesforce-communities.com &lt;<A HREF="http://salesforce-communities.com">http://salesforce-communities.com</A>&gt;  .salesforce-experience.com &lt;<A HREF="http://salesforce-experience.com">http://salesforce-experience.com</A>&gt;  .salesforce-hub.com &lt;<A HREF="http://salesforce-hub.com">http://salesforce-hub.com</A>&gt;  .salesforce-scrt.com &lt;<A HREF="http://salesforce-scrt.com">http://salesforce-scrt.com</A>&gt;  .salesforce-sites.com &lt;<A HREF="http://salesforce-sites.com">http://salesforce-sites.com</A>&gt;  .site.com &lt;<A HREF="http://site.com">http://site.com</A>&gt;  .sfdcopens.com &lt;<A HREF="http://sfdcopens.com">http://sfdcopens.com</A>&gt;  .sfdc.sh .trailblazer.me &lt;<A HREF="http://trailblazer.me">http://trailblazer.me</A>&gt;  .trailhead.com &lt;<A HREF="http://trailhead.com">http://trailhead.com</A>&gt;  .visualforce.com &lt;<A HREF="http://visualforce.com">http://visualforce.com</A>&gt; 


# Filter HTTPS requests based on the whitelist 
acl allowed_https_sites ssl::server_name .pypi.org &lt;<A HREF="http://pypi.org">http://pypi.org</A>&gt;  .pythonhosted.org &lt;<A HREF="http://pythonhosted.org">http://pythonhosted.org</A>&gt;  .tfhub.dev &lt;<A HREF="http://tfhub.dev">http://tfhub.dev</A>&gt;  .gstatic.com &lt;<A HREF="http://gstatic.com">http://gstatic.com</A>&gt;  .googleapis.com &lt;<A HREF="http://googleapis.com">http://googleapis.com</A>&gt; 
acl allowed_https_sites ssl::server_name .amazonaws.com &lt;<A HREF="http://amazonaws.com">http://amazonaws.com</A>&gt; 
acl allowed_https_sites ssl::server_name .documentforce.com &lt;<A HREF="http://documentforce.com">http://documentforce.com</A>&gt;   .sforce.com &lt;<A HREF="http://sforce.com">http://sforce.com</A>&gt;  .force.com &lt;<A HREF="http://force.com">http://force.com</A>&gt;  .forceusercontent.com &lt;<A HREF="http://forceusercontent.com">http://forceusercontent.com</A>&gt;  .force-user-content.com &lt;<A HREF="http://force-user-content.com">http://force-user-content.com</A>&gt;  .lightning.com &lt;<A HREF="http://lightning.com">http://lightning.com</A>&gt;  .salesforce.com &lt;<A HREF="http://salesforce.com">http://salesforce.com</A>&gt;  .salesforceliveagent.com &lt;<A HREF="http://salesforceliveagent.com">http://salesforceliveagent.com</A>&gt;  .salesforce-communities.com &lt;<A HREF="http://salesforce-communities.com">http://salesforce-communities.com</A>&gt;  .salesforce-experience.com &lt;<A HREF="http://salesforce-experience.com">http://salesforce-experience.com</A>&gt;  .salesforce-hub.com &lt;<A HREF="http://salesforce-hub.com">http://salesforce-hub.com</A>&gt;  .salesforce-scrt.com &lt;<A HREF="http://salesforce-scrt.com">http://salesforce-scrt.com</A>&gt;  .salesforce-sites.com &lt;<A HREF="http://salesforce-sites.com">http://salesforce-sites.com</A>&gt;  .site.com &lt;<A HREF="http://site.com">http://site.com</A>&gt;  .sfdcopens.com &lt;<A HREF="http://sfdcopens.com">http://sfdcopens.com</A>&gt;  .sfdc.sh .trailblazer.me &lt;<A HREF="http://trailblazer.me">http://trailblazer.me</A>&gt;  .trailhead.com &lt;<A HREF="http://trailhead.com">http://trailhead.com</A>&gt;  .visualforce.com &lt;<A HREF="http://visualforce.com">http://visualforce.com</A>&gt; 
ssl_bump peek step2 allowed_https_sites 
ssl_bump splice step3 allowed_https_sites 
ssl_bump terminate step2 all


connect_timeout 60 minute
read_timeout 60 minute
write_timeout 60 minute
request_timeout 60 minute

## http filtering ###
#http_access allow localnet allowed_http_only
#http_access allow localhost allowed_http_only
http_access allow localnet allowed_https_sites
http_access allow localhost allowed_https_sites
# And finally deny all other access to this proxy
http_access deny all

# Uncomment and adjust the following to add a disk cache directory.
#cache_dir ufs /var/spool/squid 100 16 256

# Leave coredumps in the first cache dir
coredump_dir /var/spool/squid

#
# Add any of your own refresh_pattern entries above these.
#
refresh_pattern ^ftp: 1440 20% 10080
refresh_pattern ^gopher: 1440 0% 1440
refresh_pattern -i (/cgi-bin/|\?) 0 0% 0
refresh_pattern . 0 20% 4320



thanks

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20220225/9f94f144/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20220225/9f94f144/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="024565.html">[squid-users] Getting SSL Connection Errors
</A></li>
	<LI>Next message (by thread): <A HREF="024570.html">[squid-users] Random trouble with image downloads
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24569">[ date ]</a>
              <a href="thread.html#24569">[ thread ]</a>
              <a href="subject.html#24569">[ subject ]</a>
              <a href="author.html#24569">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
