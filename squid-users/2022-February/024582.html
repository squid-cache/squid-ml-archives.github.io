<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid Question regarding tcp handshake
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20Question%20regarding%20tcp%20handshake&In-Reply-To=%3Cd172f6c4-4c42-b827-61da-d01904b4a76c%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024574.html">
   <LINK REL="Next"  HREF="024565.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid Question regarding tcp handshake</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20Question%20regarding%20tcp%20handshake&In-Reply-To=%3Cd172f6c4-4c42-b827-61da-d01904b4a76c%40measurement-factory.com%3E"
       TITLE="[squid-users] Squid Question regarding tcp handshake">rousskov at measurement-factory.com
       </A><BR>
    <I>Fri Feb 25 16:18:45 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="024574.html">[squid-users] Squid Question regarding tcp handshake
</A></li>
        <LI>Next message (by thread): <A HREF="024565.html">[squid-users] Getting SSL Connection Errors
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24582">[ date ]</a>
              <a href="thread.html#24582">[ thread ]</a>
              <a href="subject.html#24582">[ subject ]</a>
              <a href="author.html#24582">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2/24/22 10:03, Felipe Polanco wrote:

&gt;<i> Does squid first complete the tcp handshake on its users and then a 
</I>&gt;<i> second handshake on the destination IP 
</I>
Yes, kind of. Keep in mind that Squid pretty much does not know anything 
about TCP handshakes, SYN packets, etc. Nearly all TCP-level work is 
done by the kernel and system libraries. Squid uses TCP socket I/O.

Also, there may be no corresponding Squid-server connection at all 
(e.g., errors and cache hits) or, as Amos has already noted, multiple 
Squid-server connections (e.g., trying different IP addresses associated 
with the same DNS name in HTTP request target).


&gt;<i> or as soon as it receives the TCP 
</I>&gt;<i> SYN flag it does the same with the destination.
</I>
No, Squid does not known anything about the SYN flag. Squid does not act 
on the incoming TCP connection until a successful accept(2) system call 
announces/gives that connection to Squid. That system call extracts an 
already established (i.e. post-handshake) TCP connection from the 
queue(s) of TCP connections maintained by the kernel. The TCP handshake 
completes before Squid gets control back from accept() and, in the vast 
majority of cases, before Squid even calls accept().


HTH,

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="024574.html">[squid-users] Squid Question regarding tcp handshake
</A></li>
	<LI>Next message (by thread): <A HREF="024565.html">[squid-users] Getting SSL Connection Errors
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24582">[ date ]</a>
              <a href="thread.html#24582">[ thread ]</a>
              <a href="subject.html#24582">[ subject ]</a>
              <a href="author.html#24582">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
