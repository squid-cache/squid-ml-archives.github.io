<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Need Urgent Help the CPU load shows 99% for the squid process
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Need%20Urgent%20Help%20the%20CPU%20load%20shows%2099%25%20for%20the%0A%20squid%20process&In-Reply-To=%3Cbeb06c58-f3c0-31df-75cd-2fcd16bab107%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024367.html">
   <LINK REL="Next"  HREF="024369.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Need Urgent Help the CPU load shows 99% for the squid process</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Need%20Urgent%20Help%20the%20CPU%20load%20shows%2099%25%20for%20the%0A%20squid%20process&In-Reply-To=%3Cbeb06c58-f3c0-31df-75cd-2fcd16bab107%40measurement-factory.com%3E"
       TITLE="[squid-users] Need Urgent Help the CPU load shows 99% for the squid process">rousskov at measurement-factory.com
       </A><BR>
    <I>Mon Jan  3 16:44:03 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="024367.html">[squid-users] Need Urgent Help the CPU load shows 99% for the squid process
</A></li>
        <LI>Next message (by thread): <A HREF="024369.html">[squid-users] MITM the MITM
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24368">[ date ]</a>
              <a href="thread.html#24368">[ thread ]</a>
              <a href="subject.html#24368">[ subject ]</a>
              <a href="author.html#24368">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 1/3/22 1:45 AM, Punyasloka Arya wrote:

&gt;<i> I need a quick help regarding the squid process occupying 100% CPU
</I>&gt;<i> showing on the top and becomes slow.
</I>&gt;<i> 
</I>&gt;<i> After starting the squid after 2 to 3 hours it is happening.
</I>&gt;<i> After stopping the squid process it becomes normal.
</I>
Your Squid is overloaded (getting too much traffic), misconfigured
(e.g., forwarding loop or insufficient number of descriptors for the
given load), or hitting a bug. Lots of bugs have been fixed since Squid
v3.3 was released, including bugs that could lead to 100% CPU
utilization. Squid v3 has not been officially supported for years.

Your best long-term option is to upgrade, but that may take some
time/effort because your base version is so old.

If you want to troubleshoot this without going through the upgrade, try
figuring out which out of the three cases above you are dealing with.
Here are some hints:

* Grep cache.log for any assertions, errors, warnings, or repeated
messages (other than &quot;running out of filedescriptors&quot; which you already
shared).

* Check whether Squid receives the expected amount of traffic (you may
be able to do that by counting lines in access.log and/or watching
network interface stats).

* Check how many file descriptors Squid actually has. There should be a
message about that in the beginning of cache.log. For example:
2021/12/28 11:58:08| With 1024 file descriptors available

* Think of what has _changed_ in Squid environment since Squid was
running successfully (assuming it was).

* If Squid stops processing new requests, then check whether Squid is
stuck in a loop (using gdb or a similar tool).


HTH,

Alex.




&gt;<i> Squid installed version
</I>&gt;<i> 
</I>&gt;<i> [<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid at wcb</A> ~]$&#160; /usr/squid/3.1/sbin/squid -version
</I>&gt;<i> Squid Cache: Version 3.3.3
</I>&gt;<i> configure options:&#160; '--prefix=/usr/squid/3.1/'
</I>&gt;<i> '--enable-storeio=ufs,aufs,diskd'&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
</I>&gt;<i> '--enable-removal-policies=heap,lru' '--enable-delay-pools'
</I>&gt;<i> '--enable-useragent-log' '--enable-referer-log' '--enable-icmp'
</I>&gt;<i> '--enable-cachemgr-hostname=wc.cdotb.ernet.in'
</I>&gt;<i> '--enable-follow-x-forwarded-for' '--disable-ident-lookups'
</I>&gt;<i> '--enable-auth-basic=PAM,NCSA,LDAP' '--sysconfdir=/etc/squid/'
</I>&gt;<i> '--with-default-user=squid' '--with-logdir=/var/log/squid'
</I>&gt;<i> '--with-pidfile=/var/run/squid.pid' '--with-filedescriptors=16384'
</I>&gt;<i> '--with-swapdir=/cache/squid' '--enable-ltdl-convenience'
</I>&gt;<i> 
</I>&gt;<i> HARDWARE&#160;&#160;&#160;&#160;&#160;&#160; : Fujitsu Celsius Xeon Workstation Intel(R) Xeon(R) CPU
</I>&gt;<i> E5-2690 0 @ 2.90GHz 16CPU 8-Core
</I>&gt;<i> HARDDISK&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; : 500GB
</I>&gt;<i> RAM&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; :24 GB
</I>&gt;<i> OS&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; : CentOS 6.10(final)
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> The output of the command&#160; after load is 99% in the CPU
</I>&gt;<i> 
</I>&gt;<i> [<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at wcb</A> squid]#&#160; tail -n 100000 /var/log/squid/cache.log | grep -i
</I>&gt;<i> descript
</I>&gt;<i> 
</I>&gt;<i> 2022/01/02 11:49:32 kid1| WARNING! Your cache is running out of
</I>&gt;<i> filedescriptors
</I>&gt;<i> 2022/01/02 11:49:48 kid1| WARNING! Your cache is running out of
</I>&gt;<i> filedescriptors
</I>&gt;<i> 2022/01/02 11:50:04 kid1| WARNING! Your cache is running out of
</I>&gt;<i> filedescriptors
</I>&gt;<i> 2022/01/02 11:50:20 kid1| WARNING! Your cache is running out of
</I>&gt;<i> filedescriptors
</I>&gt;<i> 
</I>&gt;<i> Please suggest anything else i should check or missing.
</I>&gt;<i> 
</I>&gt;<i> From
</I>&gt;<i> Punyasloka Arya
</I>&gt;<i> 
</I>&gt;<i> From
</I>&gt;<i> Punya
</I>&gt;<i> PUNYASLOKA ARYA &#160; &#160; &#160; &#160; &#160; &#160;&#2346;&#2369;&#2339;&#2381;&#2351;&#2358;&#2381;&#2354;&#2379;&#2325; &#2310;&#2352;&#2381;&#2351;&#2366;
</I>&gt;<i> Staffno:3880,Netops,TS(B)
</I>&gt;<i> Senior Research Engineer &#160; &#2357;&#2352;&#2367;&#2359;&#2381;&#2336; &#2309;&#2344;&#2369;&#2360;&#2306;&#2343;&#2366;&#2344; &#2309;&#2349;&#2367;&#2351;&#2306;&#2340;&#2366;
</I>&gt;<i> C-DOT &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#2360;&#2368;-&#2337;&#2377;&#2335; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;
</I>&gt;<i> Electronics City,Phase-1 &#160; &#2311;&#2354;&#2376;&#2325;&#2381;&#2335;&#2381;&#2352;&#2377;&#2344;&#2367;&#2325;&#2381;&#2360; &#2360;&#2367;&#2335;&#2368; &#2347;&#2375;&#2332;&#2364; I &#160; &#160; &#160; &#160;
</I>&gt;<i> Hosur Road,Bangalore &#160; &#160; &#160; &#2361;&#2379;&#2360;&#2370;&#2352; &#2352;&#2379;&#2337;, &#2348;&#2375;&#2306;&#2327;&#2354;&#2370;&#2352;&#2369;
</I>&gt;<i> 560100 &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; 560100
</I>&gt;<i> ### Please consider the environment and print this email only if necessary
</I>&gt;<i> .
</I>&gt;<i> Go Green ###
</I>&gt;<i> 
</I>&gt;<i> Disclaimer :
</I>&gt;<i> This email and any files transmitted with it are confidential and intended
</I>&gt;<i> solely for the use of the individual or entity to whom they are addressed.
</I>&gt;<i> If you are not the intended recipient you are notified that disclosing,
</I>&gt;<i> copying, distributing or taking any action in reliance on the contents of
</I>&gt;<i> this
</I>&gt;<i> information is strictly prohibited. The sender does not accept liability
</I>&gt;<i> for any errors or omissions in the contents of this message, which arise
</I>&gt;<i> as
</I>&gt;<i> a
</I>&gt;<i> result.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="024367.html">[squid-users] Need Urgent Help the CPU load shows 99% for the squid process
</A></li>
	<LI>Next message (by thread): <A HREF="024369.html">[squid-users] MITM the MITM
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24368">[ date ]</a>
              <a href="thread.html#24368">[ thread ]</a>
              <a href="subject.html#24368">[ subject ]</a>
              <a href="author.html#24368">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
