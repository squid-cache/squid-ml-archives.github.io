<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid 5.3 frequent crash
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%205.3%20frequent%20crash&In-Reply-To=%3C07c5174b-ea6f-e5e3-80e3-1f3f4508d16d%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024389.html">
   <LINK REL="Next"  HREF="024410.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid 5.3 frequent crash</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%205.3%20frequent%20crash&In-Reply-To=%3C07c5174b-ea6f-e5e3-80e3-1f3f4508d16d%40treenet.co.nz%3E"
       TITLE="[squid-users] squid 5.3 frequent crash">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Jan 18 07:51:18 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="024389.html">[squid-users] squid 5.3 frequent crash
</A></li>
        <LI>Next message (by thread): <A HREF="024410.html">[squid-users] squid 5.3 frequent crash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24408">[ date ]</a>
              <a href="thread.html#24408">[ thread ]</a>
              <a href="subject.html#24408">[ subject ]</a>
              <a href="author.html#24408">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 8/01/22 05:02, Alex Rousskov wrote:
&gt;<i> On 1/7/22 9:34 AM, Amos Jeffries wrote:
</I>&gt;&gt;<i> On 7/01/22 06:00, Alex Rousskov wrote:
</I>&gt;&gt;&gt;<i> On 1/6/22 6:53 AM, Majed Zouhairy wrote:
</I>&gt;&gt;&gt;&gt;<i> after upgrading today to 5.3 i'm getting:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> 2022/01/06 14:27:18 kid1| FATAL: check failed: opening()
</I>&gt;&gt;&gt;&gt;<i>  &#160;&#160;&#160;&#160; exception location: FwdState.cc(628) noteDestinationsEnd
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> what is the cause?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> This is most likely bug 5055 fixed in August 2021:
</I>&gt;&gt;&gt;<i> <A HREF="https://bugs.squid-cache.org/show_bug.cgi?id=5055">https://bugs.squid-cache.org/show_bug.cgi?id=5055</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> In many environments, Squid v5 is unusable without that bug fix. I do
</I>&gt;&gt;&gt;<i> not know whether the v5 maintainer plans to officially backport the fix
</I>&gt;&gt;&gt;<i> from master/v6 to v5, but we would be happy to assist with that.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> The commit message documents that the bug fix is a small part of the
</I>&gt;&gt;<i> changes made.
</I>&gt;<i> 
</I>&gt;<i> I am unable to separate many of the bug fixes from most other changes in
</I>&gt;<i> that commit. I am a fan of surgical fixes, but, sometimes, significant
</I>&gt;<i> code changes are required to address a set of bugs. One could, of
</I>&gt;<i> course, ignore most of the bugs fixed by the official commit and just
</I>&gt;<i> make sure that v5 does not violate the opening() MUST that triggered
</I>&gt;<i> this thread, but I see no point in doing that -- we will end up chasing
</I>&gt;<i> one known bug after another, sometimes in circles, and often via painful
</I>&gt;<i> triage.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> Others include altering the fundamental AsyncJob API behaviour -
</I>&gt;&gt;<i> affecting every feature in Squid at their most fundamental levels.
</I>&gt;<i> 
</I>&gt;<i> I disagree with the above summary.
</I>&gt;<i> 
</I>
This is not an opinion. The patch &quot;part 2&quot; makes logic changes to 
AsyncJob - specifically destructors and swanSong. That touches 
*everything* Squid does. The other parts touch I/O in similarly deep 
ways and we have a history of unexpected weird side effects with I/O 
refactorings.


&gt;<i> 
</I>&gt;&gt;<i> That amount of change is not going into a &quot;stable&quot; release of
</I>&gt;&gt;<i> Squid.
</I>&gt;<i> 
</I>&gt;<i> FWIW, IMHO, Squid v5 is much better with those changes than it is
</I>&gt;<i> without them. Once tested, the changes do not violate any fundamental
</I>&gt;<i> stability principles that I know of. However, I think it is best to let
</I>&gt;<i> the maintainer (i.e. you) make v5 admission decisions. I am just
</I>&gt;<i> providing feedback to facilitate informed decisions.
</I>

I do not disagree with the improvement existing. Just that it does not 
fit the criteria for backport into a stable/production release.

I am seriously considering using our exceptional beta release process 
for these changes once v5.4 bug fixes are out.


&gt;<i> 
</I>&gt;&gt;<i> I will consider patches for just the bug 5055 issue though.
</I>&gt;<i> 
</I>&gt;<i> To avoid misunderstanding, (the backport of) the official set of fixes
</I>&gt;<i> is what I am offering for your consideration. If others can address all
</I>&gt;<i> those bugs using smaller patches, great! Otherwise, I recommend
</I>&gt;<i> backporting the comprehensive fix and am happy to assist with that.
</I>&gt;<i> 
</I>
I will take you up on this.

FYI; I am clearing the backports queue over the next few days, and again 
just before 1st Feb. With stable v5.4 release scheduled for 6th Feb.

IMO the best code to base your backport PR on would be the v5 HEAD after 
1st Feb when I post the &quot;prep for 5.4&quot; or similar QA for review. With 
intention of a v5.4.1 beta release a few days later on 10th-12th 
containing only the big change.

That gives us 6 weeks for validation before v5.5 release decisions are 
made. I seriously *hope* that is enough testing not to be hit later with 
another one of these.


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="024389.html">[squid-users] squid 5.3 frequent crash
</A></li>
	<LI>Next message (by thread): <A HREF="024410.html">[squid-users] squid 5.3 frequent crash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24408">[ date ]</a>
              <a href="thread.html#24408">[ thread ]</a>
              <a href="subject.html#24408">[ subject ]</a>
              <a href="author.html#24408">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
