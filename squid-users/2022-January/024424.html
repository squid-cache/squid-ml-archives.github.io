<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] tls_key_log Configuration
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20tls_key_log%20Configuration&In-Reply-To=%3Cb0f9dd53-1da4-9edf-b217-cac03664ec83%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024423.html">
   <LINK REL="Next"  HREF="024425.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] tls_key_log Configuration</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20tls_key_log%20Configuration&In-Reply-To=%3Cb0f9dd53-1da4-9edf-b217-cac03664ec83%40measurement-factory.com%3E"
       TITLE="[squid-users] tls_key_log Configuration">rousskov at measurement-factory.com
       </A><BR>
    <I>Sun Jan 23 17:40:11 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="024423.html">[squid-users] tls_key_log Configuration
</A></li>
        <LI>Next message (by thread): <A HREF="024425.html">[squid-users] 4.17 and 5.3 SSL BUMP issue: SSL_ERROR_RX_RECORD_TOO_LONG
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24424">[ date ]</a>
              <a href="thread.html#24424">[ thread ]</a>
              <a href="subject.html#24424">[ subject ]</a>
              <a href="author.html#24424">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 1/23/22 11:10 AM, toma leopold wrote:
&gt;<i> I know squid 6.0 is not out yet but I wanted to try the tls_key_log
</I>&gt;<i> feature.&#160;
</I>&gt;<i> 
</I>&gt;<i> Using:
</I>&gt;<i> 
</I>&gt;<i> tls_key_log stdio:/logfile
</I>&gt;<i> 
</I>&gt;<i> only works partially.
</I>&gt;<i> From client to proxy only TLS 1.2 is negotiated but I get the secret
</I>&gt;<i> values and the random number.
</I>&gt;<i> For proxy to server connections I get the random number from the proxy
</I>&gt;<i> in the log but no secrets. TLS 1.3 is used for this connection.
</I>&gt;<i> Any ideas what could be the issue?
</I>
Squid does not support logging of TLS v1.3 secrets yet.

When tls_key_log was initially implemented, Squid did not support the
OpenSSL version that could extract TLS v1.3 connection secrets - OpenSSL
v1.1.1. There is even a corresponding TODO in the code: &quot;Support
SSL_CTX_set_keylog_callback() available since OpenSSL v1.1.1&quot;.

IIRC, Squid supports that OpenSSL version now. Thus, support for logging
TLS v1.3 connection secrets can and should be added. When deciding on
the tls_key_log output format, we tried to anticipate TLS v1.3 needs, so
I hope that adding that support will not require serious format changes.

This whole issue is complicated by the fact that it would be much easier
to just rely on the new OpenSSL SSL_CTX_set_keylog_callback() API for
_all_ TLS secret extraction, but we cannot do that for as long as we
have to support earlier OpenSSL versions that lack that API. One of the
reasons we did not push for TLS v1.3 logging during the initial
tls_key_log implementation is my hope that (by the time we start working
on that additional support) Squid master/v6 would no longer have to
support earlier OpenSSL versions.


HTH,

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="024423.html">[squid-users] tls_key_log Configuration
</A></li>
	<LI>Next message (by thread): <A HREF="024425.html">[squid-users] 4.17 and 5.3 SSL BUMP issue: SSL_ERROR_RX_RECORD_TOO_LONG
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24424">[ date ]</a>
              <a href="thread.html#24424">[ thread ]</a>
              <a href="subject.html#24424">[ subject ]</a>
              <a href="author.html#24424">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
