<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Tune Squid proxy to handle 90k connection
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Tune%20Squid%20proxy%20to%20handle%2090k%20connection&In-Reply-To=%3C%21%26%21AAAAAAAAAAAuAAAAAAAAAJJD97gEMN5Ch2HBNn/5W3IBAMO2jhD3dRHOtM0AqgC7tuYAAAAAAA4AABAAAAD3FXIJWgsSQLJz3KxHKB5yAQAAAAA%3D%40articatech.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024422.html">
   <LINK REL="Next"  HREF="024454.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Tune Squid proxy to handle 90k connection</H1>
    <B>Andr&#233; Bolinhas</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Tune%20Squid%20proxy%20to%20handle%2090k%20connection&In-Reply-To=%3C%21%26%21AAAAAAAAAAAuAAAAAAAAAJJD97gEMN5Ch2HBNn/5W3IBAMO2jhD3dRHOtM0AqgC7tuYAAAAAAA4AABAAAAD3FXIJWgsSQLJz3KxHKB5yAQAAAAA%3D%40articatech.com%3E"
       TITLE="[squid-users] Tune Squid proxy to handle 90k connection">andre.bolinhas at articatech.com
       </A><BR>
    <I>Tue Jan 25 16:42:38 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="024422.html">[squid-users] Tune Squid proxy to handle 90k connection
</A></li>
        <LI>Next message (by thread): <A HREF="024454.html">[squid-users] Tune Squid proxy to handle 90k connection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24437">[ date ]</a>
              <a href="thread.html#24437">[ thread ]</a>
              <a href="subject.html#24437">[ subject ]</a>
              <a href="author.html#24437">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Any tip about my last comment?

-----Mensagem original-----
De: Andr&#233; Bolinhas &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">andre.bolinhas at articatech.com</A>&gt; 
Enviada: 21 de janeiro de 2022 16:36
Para: 'Amos Jeffries' &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Assunto: RE: [squid-users] Tune Squid proxy to handle 90k connection

Thanks Amos
Yes, you are right, I will put a second box with HaProxy in front to balance the traffic.
About the sockets I can't double it because is a physical machine, do you think disable hyperthreading from bios will help, because we have other services inside the box that works in multi-threading, like unbound DNS?

Just more a few questions:
1&#186; The server have 92Gb of Ram, do you think that is needed that adding swap will help squid performance?
2&#186; Right now we are using squid 4.17 did you recommend upgrade or downgrade to any specific version?
3&#186; We need categorization, for this we are using an external helper to achieve it, do you recommend use this approach with ACL or move to some kind of ufdbguard service?

Best regards
-----Mensagem original-----
De: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; Em Nome De Amos Jeffries
Enviada: 21 de janeiro de 2022 16:05
Para: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Assunto: Re: [squid-users] Tune Squid proxy to handle 90k connection

Sorry for the slow reply. Responses inline.


On 14/01/22 05:44, Andr&#233; Bolinhas wrote:
&gt;<i> Hi
</I>&gt;<i> ~80k request per second  10k users
</I>

Test this, but you may need a second machine to achieve the full 80k RPS.

Latest Squid do not have any details analysis, but older Squid-3.5 were only achieving &gt;15k RPS under lab conditions, more likely expect under 10k RPS/worker on real traffic.
  That means (IME) this machine is quite likely to hit its capacity somewhere under 70k RPS.


&gt;<i> CPU info:
</I>&gt;<i> CPU(s) 16
</I>&gt;<i> Threads per code 2
</I>&gt;<i> Cores per socket 8
</I>
With this CPU you will be able to run 7 workers. Setup affinity of one core per worker (the &quot;kidN&quot; processes of Squid). Leaving one core to the OS and additional processing needs - this matters at peak loading.

CPU &quot;threads&quot; tend not to be useful for Squid. Under high loads Squid workers will consume all available cycles on their core, not leaving any for the fancy &quot;thread&quot; core sharing features to pretend there is another core available. YMMV. One of the tests to try when tuning is to turn off the CPU hyperthreading and see what effect it has (if any).


&gt;<i> Sockets 1
</I>&gt;<i> Inter Xeron Silver 4208  @ 2.10GHz
</I>&gt;<i>
</I>
Okay. Doable, but for best performance you want as high GHz rating on the cores as your budget can afford. The amount of &quot;lag&quot; Squid adds to traffic and RPS performance/parallelism directly correlates with how fast the CPU core can run cycles.



HTH
Amos
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="024422.html">[squid-users] Tune Squid proxy to handle 90k connection
</A></li>
	<LI>Next message (by thread): <A HREF="024454.html">[squid-users] Tune Squid proxy to handle 90k connection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24437">[ date ]</a>
              <a href="thread.html#24437">[ thread ]</a>
              <a href="subject.html#24437">[ subject ]</a>
              <a href="author.html#24437">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
