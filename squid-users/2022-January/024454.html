<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Tune Squid proxy to handle 90k connection
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Tune%20Squid%20proxy%20to%20handle%2090k%20connection&In-Reply-To=%3CCABA8h%3DQBGofnCPuXqd5F_yF_M%3DmV_G7FVucRtZ7mWJAx_WbiFg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024437.html">
   <LINK REL="Next"  HREF="024456.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Tune Squid proxy to handle 90k connection</H1>
    <B>NgTech LTD</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Tune%20Squid%20proxy%20to%20handle%2090k%20connection&In-Reply-To=%3CCABA8h%3DQBGofnCPuXqd5F_yF_M%3DmV_G7FVucRtZ7mWJAx_WbiFg%40mail.gmail.com%3E"
       TITLE="[squid-users] Tune Squid proxy to handle 90k connection">ngtech1ltd at gmail.com
       </A><BR>
    <I>Mon Jan 31 04:58:36 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="024437.html">[squid-users] Tune Squid proxy to handle 90k connection
</A></li>
        <LI>Next message (by thread): <A HREF="024456.html">[squid-users] Tune Squid proxy to handle 90k connection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24454">[ date ]</a>
              <a href="thread.html#24454">[ thread ]</a>
              <a href="subject.html#24454">[ subject ]</a>
              <a href="author.html#24454">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I would recommend you to start with 0 caching.
However, for choosing the right solution you must give more details.
For example there is an IBM reasearch that prooved that for about 90k
connections you can use vm's ontop of such hardware with apache web server.
If you do have the set of the other requirements from the proxy else then
the 90k requests it would be wise to mention them.

Do you need any specific acls?
Do you need authentication?
etc..

For a simple forward proxy I would suggest to use a simpler solution and if
possible to not log anything as a starter point.
Any local disk i/o will slow down the machine.

About the url categorization, I do not have experience with ufdbguard on
such scale but it would be pretty heavy for any software to handle 90k
rps...
 It's doable to implement such setup but will require testing.
Will you use ssl bump in this setup?

If I will have all the technical and specs/requirements details I might be
able to suggest better then now.
Take into account that each squid worker can handle about 3k rps tops(with
my experience) and it's a juggling between two sides so... 3k is really
3k+3k+external_acls+dns...

I believe that in this case an example of configuration from the squid
developers might be usefull.

Eliezer


&#1489;&#1514;&#1488;&#1512;&#1497;&#1498; &#1497;&#1493;&#1501; &#1490;&#1523;, 25 &#1489;&#1497;&#1504;&#1493;&#1523; 2022, 18:42, &#1502;&#1488;&#1514; Andr&#233; Bolinhas &#8207;&lt;
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">andre.bolinhas at articatech.com</A>&gt;:

&gt;<i> Any tip about my last comment?
</I>&gt;<i>
</I>&gt;<i> -----Mensagem original-----
</I>&gt;<i> De: Andr&#233; Bolinhas &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">andre.bolinhas at articatech.com</A>&gt;
</I>&gt;<i> Enviada: 21 de janeiro de 2022 16:36
</I>&gt;<i> Para: 'Amos Jeffries' &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;;
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> Assunto: RE: [squid-users] Tune Squid proxy to handle 90k connection
</I>&gt;<i>
</I>&gt;<i> Thanks Amos
</I>&gt;<i> Yes, you are right, I will put a second box with HaProxy in front to
</I>&gt;<i> balance the traffic.
</I>&gt;<i> About the sockets I can't double it because is a physical machine, do you
</I>&gt;<i> think disable hyperthreading from bios will help, because we have other
</I>&gt;<i> services inside the box that works in multi-threading, like unbound DNS?
</I>&gt;<i>
</I>&gt;<i> Just more a few questions:
</I>&gt;<i> 1&#186; The server have 92Gb of Ram, do you think that is needed that adding
</I>&gt;<i> swap will help squid performance?
</I>&gt;<i> 2&#186; Right now we are using squid 4.17 did you recommend upgrade or
</I>&gt;<i> downgrade to any specific version?
</I>&gt;<i> 3&#186; We need categorization, for this we are using an external helper to
</I>&gt;<i> achieve it, do you recommend use this approach with ACL or move to some
</I>&gt;<i> kind of ufdbguard service?
</I>&gt;<i>
</I>&gt;<i> Best regards
</I>&gt;<i> -----Mensagem original-----
</I>&gt;<i> De: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; Em Nome De
</I>&gt;<i> Amos Jeffries
</I>&gt;<i> Enviada: 21 de janeiro de 2022 16:05
</I>&gt;<i> Para: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> Assunto: Re: [squid-users] Tune Squid proxy to handle 90k connection
</I>&gt;<i>
</I>&gt;<i> Sorry for the slow reply. Responses inline.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 14/01/22 05:44, Andr&#233; Bolinhas wrote:
</I>&gt;<i> &gt; Hi
</I>&gt;<i> &gt; ~80k request per second  10k users
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Test this, but you may need a second machine to achieve the full 80k RPS.
</I>&gt;<i>
</I>&gt;<i> Latest Squid do not have any details analysis, but older Squid-3.5 were
</I>&gt;<i> only achieving &gt;15k RPS under lab conditions, more likely expect under 10k
</I>&gt;<i> RPS/worker on real traffic.
</I>&gt;<i>   That means (IME) this machine is quite likely to hit its capacity
</I>&gt;<i> somewhere under 70k RPS.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; CPU info:
</I>&gt;<i> &gt; CPU(s) 16
</I>&gt;<i> &gt; Threads per code 2
</I>&gt;<i> &gt; Cores per socket 8
</I>&gt;<i>
</I>&gt;<i> With this CPU you will be able to run 7 workers. Setup affinity of one
</I>&gt;<i> core per worker (the &quot;kidN&quot; processes of Squid). Leaving one core to the OS
</I>&gt;<i> and additional processing needs - this matters at peak loading.
</I>&gt;<i>
</I>&gt;<i> CPU &quot;threads&quot; tend not to be useful for Squid. Under high loads Squid
</I>&gt;<i> workers will consume all available cycles on their core, not leaving any
</I>&gt;<i> for the fancy &quot;thread&quot; core sharing features to pretend there is another
</I>&gt;<i> core available. YMMV. One of the tests to try when tuning is to turn off
</I>&gt;<i> the CPU hyperthreading and see what effect it has (if any).
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; Sockets 1
</I>&gt;<i> &gt; Inter Xeron Silver 4208  @ 2.10GHz
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> Okay. Doable, but for best performance you want as high GHz rating on the
</I>&gt;<i> cores as your budget can afford. The amount of &quot;lag&quot; Squid adds to traffic
</I>&gt;<i> and RPS performance/parallelism directly correlates with how fast the CPU
</I>&gt;<i> core can run cycles.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> HTH
</I>&gt;<i> Amos
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20220131/1afac7f9/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20220131/1afac7f9/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="024437.html">[squid-users] Tune Squid proxy to handle 90k connection
</A></li>
	<LI>Next message (by thread): <A HREF="024456.html">[squid-users] Tune Squid proxy to handle 90k connection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24454">[ date ]</a>
              <a href="thread.html#24454">[ thread ]</a>
              <a href="subject.html#24454">[ subject ]</a>
              <a href="author.html#24454">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
