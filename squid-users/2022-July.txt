From squid at borrill.org.uk  Fri Jul  1 08:47:54 2022
From: squid at borrill.org.uk (Stephen Borrill)
Date: Fri, 1 Jul 2022 09:47:54 +0100
Subject: [squid-users] the free domains blacklists are gone..
In-Reply-To: <010001d88ca2$f2df9840$d89ec8c0$@gmail.com>
References: <010001d88ca2$f2df9840$d89ec8c0$@gmail.com>
Message-ID: <0604223a-d371-63ed-0979-75823f8cfeb3@borrill.org.uk>

On 30/06/2022 18:00, ngtech1ltd at gmail.com wrote:
> Hey,
> 
> I have tried to download blacklists from couple sites that was 
> publishing these in the past and all of them are gone.
> 
> The only free resource I have found was DNS blacklists.
> 
> I just wrote a dstdomain external helper that can work with a SQL DB and 
> it seems to run pretty nice.
> 
> Until now I have tried MySQL, Maraidb, MSSQL, PostgreSQL and all of them 
> works pretty nice.
> 
> There is an overhead in storing the data in a DB compared to a plain 
> text file but the benefits are worth it.
> 
> The only lists I have found are for Pihole for example at:
> 
> https://github.com/blocklistproject/Lists 
> <https://github.com/blocklistproject/Lists>
> 
> So now I just need to convert these to dstdomain format and it will work 
> with Squid pretty nice.
> 
> Any recommendations for free lists are welcome.

This still seems to be available:
http://dsi.ut-capitole.fr/blacklists/index_en.php

There are lists in there that have timestamps from a couple of days ago, 
so I think it is still maintained.



From Theo.BARRAGUE.ext at boursorama.fr  Fri Jul  1 14:22:40 2022
From: Theo.BARRAGUE.ext at boursorama.fr (=?iso-8859-1?Q?Th=E9o_BARRAGUE?=)
Date: Fri, 1 Jul 2022 14:22:40 +0000
Subject: [squid-users] How to "active" update NetDB informations ?
In-Reply-To: <PAYP264MB41278CAEAA7F68AD6716E5CBA3BD9@PAYP264MB4127.FRAP264.PROD.OUTLOOK.COM>
References: <PAYP264MB41278CAEAA7F68AD6716E5CBA3BD9@PAYP264MB4127.FRAP264.PROD.OUTLOOK.COM>
Message-ID: <PAYP264MB41274D00FD0F18562C841984A3BD9@PAYP264MB4127.FRAP264.PROD.OUTLOOK.COM>

Hello,

I'm facing to issue with squid : i want to use squid to route http traffic though the fastest path ( based on RTT ).

Before to explain my problem, this is my configuration where :

  *   client is a http client : curl, wget, firefox, ...
  *   squid is a squid instance with never_direct allow all option to prevent direct access but with squid a and squid b as parents peers and query_icmp on option
  *   squid a and squid b are squid instances that can make direct connections
  *   all squid instances are cacheless and built with --enable-icmp

[cid:d09aa68c-f986-4341-9d45-52c2a7a7a2d9]

Now, come issues. When squid send a request to squid a or squid b, two ICP packets are sent ( to squid a and squid b ) and the squid which do the direct connection send an icmp to origin server and squid instances update their netdb informations ( squid a or squid b "locally" from icmp answer and squid though ICP ).

If link a slows down, the RTT will increase and squid will send all requests to squid b because his RTT is low.
But, if link a come back and with a lower RTT than squid b, squid a will never know because no requests are made to him until RTT on squid b goes up ( upper than the "uppest" / "oldest" RTT of squid a ).

How to deal with this scenario ? Maybe my approach is bad or even worst, it's not possible with squid ?

I can curl regulary on squid a and squid b to keep RTT up to date but this solution is more a workaround from my point of view than a good solution.
I can also restart squid a and squid b every 5 minutes for example to flush netdb informations but same things as above, not a good solution.

Waiting to read you, i hope you have a solution for my case,
Th?o BARRAGUE
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220701/d07829bf/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: graphviz.png
Type: image/png
Size: 27112 bytes
Desc: graphviz.png
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220701/d07829bf/attachment.png>

From rousskov at measurement-factory.com  Fri Jul  1 17:00:30 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Fri, 1 Jul 2022 13:00:30 -0400
Subject: [squid-users] How to "active" update NetDB informations ?
In-Reply-To: <PAYP264MB41274D00FD0F18562C841984A3BD9@PAYP264MB4127.FRAP264.PROD.OUTLOOK.COM>
References: <PAYP264MB41278CAEAA7F68AD6716E5CBA3BD9@PAYP264MB4127.FRAP264.PROD.OUTLOOK.COM>
 <PAYP264MB41274D00FD0F18562C841984A3BD9@PAYP264MB4127.FRAP264.PROD.OUTLOOK.COM>
Message-ID: <8e029e1d-45c8-a683-36b6-f5a1bcfc1ffb@measurement-factory.com>

On 7/1/22 10:22, Th?o BARRAGUE wrote:

> I'm facing to issue with squid : i want to use squid to route http 
> traffic though the fastest path ( based on RTT ).
> 
> Before to explain my problem, this is my configuration where :
> 
>   * *client* is a http client : curl, wget, firefox, ...
>   * *squid* is a squid instance with /never_direct allow all/ option to
>     prevent direct access but with *squid a* and *squid b* as parents
>     peers and /query_icmp/ /on/?option
>   * *squid a* and *squid b* are squid instances that can make direct
>     connections
>   * all *squid *instances?are cacheless and built with /--enable-icmp/
> 
> Now, come issues. When *squid* send a request to *squid a* or *squid b*, 
> two ICP packets are sent ( to *squid a*?and *squid b*?) and the squid 
> which do the direct connection send an icmp to origin server and squid 
> instances update their netdb informations ( *squid a* or *squid b* 
> "locally" from icmp answer and *squid* though ICP ).

Correct.


> If *link a*?slows down, the RTT will increase and *squid*?will send all 
> requests to *squid b*?because his RTT is low.

Yes (by default).


> But, if *link a*?come back and with a lower RTT than *squid b*, *squid 
> a*?will never know because no requests are made to him until RTT on 
> *squid b*?goes up ( upper than the "uppest" / "oldest" RTT of *squid a*?).

Yes, if Squid A has no reason to go to a site, it will not update its 
ICMP RTT information for that site. Squid does not probe origin sites 
unless it needs to send a request to that site.


> How to deal with this scenario ?

Interesting question! AFAICT, you have several options to keep RTT 
information fresh, including:

* Force some client traffic through the slower path. See 
weighted-round-robin in squid.conf.documented. This will make your 
clients suffer for the sake of keeping NetDB fresh.

* Modify Squid sources so that a parent that receives an ICP query sends 
an ICMP request to the corresponding origin server (if the available 
NetDB information became stale). This requires development and will 
double ICMP traffic from your Squid farm (because each parent will send 
an ICMP request for every HTTP transaction for a site that needs a NetDB 
record update).

* Enable active background "probing" of (popular?) sites through each 
parent. This will increase both ICMP and HTTP traffic from your Squid farm.

Pick your poison...

I know that you called the last solution a "workaround rather than a 
good solution" but I do not know what you are trying to optimize, so I 
cannot agree or disagree with that judgement.


> I can also restart squid a and squid b every 5 minutes for example to
> flush netdb informations

I agree -- erasing fresh RTT information (in an actively used peer that 
has fresh NetDB) is not a good solution. If you go this route, then you 
may also need to disable the disk copy of NetDB ("netdb_filename none").


HTH,

Alex.


From gtaylor at tnetconsulting.net  Fri Jul  1 20:38:48 2022
From: gtaylor at tnetconsulting.net (Grant Taylor)
Date: Fri, 1 Jul 2022 14:38:48 -0600
Subject: [squid-users] How to "active" update NetDB informations ?
In-Reply-To: <PAYP264MB41274D00FD0F18562C841984A3BD9@PAYP264MB4127.FRAP264.PROD.OUTLOOK.COM>
References: <PAYP264MB41278CAEAA7F68AD6716E5CBA3BD9@PAYP264MB4127.FRAP264.PROD.OUTLOOK.COM>
 <PAYP264MB41274D00FD0F18562C841984A3BD9@PAYP264MB4127.FRAP264.PROD.OUTLOOK.COM>
Message-ID: <e1fb81b3-554f-0061-8c98-62876dad26d5@spamtrap.tnetconsulting.net>

On 7/1/22 8:22 AM, Th?o BARRAGUE wrote:
> If *link a*?slows down, the RTT will increase and *squid*?will send all 
> requests to *squid b*?because his RTT is low.
> But, if *link a*?come back and with a lower RTT than *squid b*, *squid 
> a*?will never know because no requests are made to him until RTT on 
> *squid b*?goes up ( upper than the "uppest" / "oldest" RTT of *squid a*?).
> 
> How to deal with this scenario ?

I have no idea if this will help you or not but this problem seems 
reminiscent of DNS servers (e.g. BIND/named) deal with multiple 
potential servers.

My loose understanding is that BIND/named will /artificially/ alter the 
cached RTT /explicitly/ to make sure that abnormally high / low values 
don't negatively impact things.  I think there are a couple of ways to 
do this:

1)  Artificially decrease the RTT incrementally or based on it's age 
(last seen) so that an originally high RTT value lowers enough that it 
becomes a candidate to be used again.  --  If it turns out that the RTT 
still really is high then the RTT will get updated back to it's high 
value and thus depreffed.

2)  Artificially increase the RTT incrementally, perhaps one point per 
test, so that the originally low RTT value raises enough that is higher 
than the other candidate, thus deprefed.

This turns into a balancing game, artificially adjust the RTT so that a 
system is (not) chosen thereby choosing the other system, which updates 
the values.

I think which method is used is probably based on what works best in the 
code.

But one of these should cause some small portion of traffic to go to the 
deprefed server explicitly to keep it's RTT up to date.



-- 
Grant. . . .
unix || die

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4017 bytes
Desc: S/MIME Cryptographic Signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220701/2c6ad551/attachment.bin>

From david at articatech.com  Sat Jul  2 10:22:12 2022
From: david at articatech.com (David Touzeau)
Date: Sat, 2 Jul 2022 12:22:12 +0200
Subject: [squid-users] the free domains blacklists are gone..
In-Reply-To: <010001d88ca2$f2df9840$d89ec8c0$@gmail.com>
References: <010001d88ca2$f2df9840$d89ec8c0$@gmail.com>
Message-ID: <3961d66a-c573-9cec-7bd8-0a9ab9783f55@articatech.com>


Hi Elieze,

Here a set of lists.....

https://github.com/KeyofBlueS/hBlock-Launcher/blob/master/list.txt
https://lists.noads.online/lists/compilation.txt
https://github.com/GlacierSheep/DomainBlockList/tree/5bfcb0c2eabed2f9c82f0bac260e1d88550b5789
https://github.com/maravento/blackweb/blob/master/blackweb.tar.gz
https://github.com/ShadowWhisperer/BlockLists/tree/master/Lists
https://github.com/jerryn70/GoodbyeAds
https://blocklist.site/
https://www.blocked.org.uk
https://blocklist-tools.developerdan.com/blocklists
https://blocklistproject.github.io/Lists/#lists
https://blokada.org/blocklists/ddgtrackerradar/standard/hosts.txt
https://github.com/LINBIT/csync2
https://github.com/StevenBlack/hosts/blob/master/data/KADhosts/hosts
https://github.com/stamparm/maltrail
https://raw.githubusercontent.com/notracking/hosts-blocklists/master/dnscrypt-proxy/dnscrypt-proxy.blacklist.txt
https://blocklist-tools.developerdan.com/entries/search?q=nettflix.website
https://github.com/Import-External-Sources/hosts-sources/tree/master/data
https://hosts.gameindustry.eu/abusive-adblocking/
https://www.bentasker.co.uk/adblock/autolist.txt
https://github.com/VenexGit/DeepGuard
https://firebog.net/


Le 30/06/2022 ? 19:00, ngtech1ltd at gmail.com a ?crit?:
>
> Hey,
>
> I have tried to download blacklists from couple sites that was 
> publishing these in the past and all of them are gone.
>
> The only free resource I have found was DNS blacklists.
>
> I just wrote a dstdomain external helper that can work with a SQL DB 
> and it seems to run pretty nice.
>
> Until now I have tried MySQL, Maraidb, MSSQL, PostgreSQL and all of 
> them works pretty nice.
>
> There is an overhead in storing the data in a DB compared to a plain 
> text file but the benefits are worth it.
>
> The only lists I have found are for Pihole for example at:
>
> https://github.com/blocklistproject/Lists
>
> So now I just need to convert these to dstdomain format and it will 
> work with Squid pretty nice.
>
> Any recommendations for free lists are welcome.
>
> Thanks,
>
> Eliezer
>
> ----
>
> Eliezer Croitoru
>
> NgTech, Tech Support
>
> Mobile: +972-5-28704261
>
> Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com>
>
> Web: https://ngtech.co.il/ <https://ngtech.co.il/>
>
> My-Tube: https://tube.ngtech.co.il/ <https://tube.ngtech.co.il/>
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
-- 
Technical Support
	
	
*David Touzeau*
Orgerus, Yvelines, France
*Artica Tech*

P:?+33 6 58 44 69 46
www: wiki.articatech.com <https://wiki.articatech.com>
www: articatech.net <http://articatech.net>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220702/a5f906cf/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: RbVfTsaUbbcWYSCo.jpg
Type: image/jpeg
Size: 6266 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220702/a5f906cf/attachment.jpg>

From hfasching at barracuda.com  Mon Jul  4 07:07:09 2022
From: hfasching at barracuda.com (Hannes Fasching)
Date: Mon, 4 Jul 2022 07:07:09 +0000
Subject: [squid-users] Reverse Proxy for Exchange server
Message-ID: <DM6PR10MB3740CB4B9734195CF0E88F1BB3BE9@DM6PR10MB3740.namprd10.prod.outlook.com>

Hi!
I have an issue with the accel mode in front of an exchange server. When you configure more than one authentication scheme including the basic scheme the authentication does not work - connection will be closed.
But when you configure the basic scheme only is starts working.
When you have configured more authentication schemes it looks like the exchange autodiscover tries which authentication scheme is the right one - gets back the HTTP Status 200 for basic scheme and for all others 401 and the last connection/session is not for basic scheme so it gets answered with 401 and squid is closing the server side and after detecting a "half closed" connection squid is also closing the client side.
Also the "cache_peer" parameter "connection-auth=on" changes nothing.

Thanks in advance for your answer

?Hannes Fasching













Get the 13 Email Threat Types eBook

https://www.barracuda.com/

This e-mail and any attachments to it contain confidential and proprietary material of Barracuda, its affiliates or agents, and is solely for the use of the intended recipient. Any review, use, disclosure, distribution or copying of this transmittal is prohibited except by or on behalf of the intended recipient. If you have received this transmittal in error, please notify the sender and destroy this e-mail and any attachments and all copies, whether electronic or printed.

________________________________

From ben.goz87 at gmail.com  Mon Jul  4 14:12:13 2022
From: ben.goz87 at gmail.com (Ben Goz)
Date: Mon, 4 Jul 2022 17:12:13 +0300
Subject: [squid-users] Squid white list
Message-ID: <CADAqQfxSfPL1Gk+nz3dMz-fWBcDDzwLSnCq3_8VQkMPCGb4O0Q@mail.gmail.com>

By the help of God.

Hi,
I want to use squid access list to implement white list of group of urls.
If I want to while list domain example.com and this website invokes http
requests to
domain example-a.com which is not included in my white list so squid denied
this request,
which could break to page from example.com.

What is the recommended way to solve this problem without manually
including all domains to white list?

Regards,
Ben
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220704/ba0349c0/attachment.htm>

From marcelorodrigo at graminsta.com.br  Thu Jul  7 23:13:41 2022
From: marcelorodrigo at graminsta.com.br (Marcelo)
Date: Thu, 7 Jul 2022 20:13:41 -0300
Subject: [squid-users] How to allow users authenticated to access only their
 own ports.
Message-ID: <001201d89257$33fc1c40$9bf454c0$@graminsta.com.br>

Hi everyone ;)

 

I have a little bit complex task at hand.

 

What I must do:

 

1-Allow an user to access squid only through specific port. This same user
can access 1 port or several ports, depending on how many routes he have.

2- Authenticated users can access only their own ports.

3- Every access is via IP:Port that brings the user to a different
tcp_outgoing_address

 

Example

An user must have 2 routes:

192.168.0.2:3001 this route brings this user to tcp_outgoing_address
200.2.2.11

192.168.0.2:3002 this route brings this user to tcp_outgoing_address
200.2.2.12

 

Yes, every port have to route to a different tcp outgoing address.

 

The closest I could get to a solution was using this:

http_port 192.168.0.2:3001 name=5

acl ip5 myportname 5

tcp_outgoing_address 200.2.2.11 ip5

 

This way, an user that enters via 192.168.0.2:3001 goes out via 200.2.2.11.

And its fine, but this way, every authenticated user can access all routes.

 

I have tried several ways to bind an username in this solution, but it is
not working.
Authentication was via basic_db_auth, but I "downgraded it" to
basic_ncsa_auth to simplify tests. Authentication is working fine.

 

My last try was using the setup below, but It made squid a little dizzy:

 

acl ip3 proxy_auth test myportname 3

http_access allow ip3

http_port 192.168.0.2:2000 name=3

tcp_outgoing_address 200.2.2.11 ip3

http_access deny ip3

 

acl ip4 proxy_auth test1 myportname 4

http_access allow ip4

http_port 192.168.0.2:2000 name=4

tcp_outgoing_address 200.2.2.12 ip4

http_access deny ip4

 

The problem is to bind specific incoming via ip:port to specific outgoing
ip:port using user authentication so users cant access each other routes.

 

Thanks for help.

 

Marcelo

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220707/8a386ecb/attachment.htm>

From marcelorodrigo at graminsta.com.br  Sat Jul  9 21:07:40 2022
From: marcelorodrigo at graminsta.com.br (Marcelo)
Date: Sat, 9 Jul 2022 18:07:40 -0300
Subject: [squid-users] Squid.conf in a DB Mysql
Message-ID: <000001d893d7$ef513d00$cdf3b700$@graminsta.com.br>

Hello,

 

Is it possible to use MySQL and PHP programming to put squid rules outside
of squid.conf?
I heard about it using external acl, but can find any documentation or good
example of it.

 

I would like to "transfer" parameters as ACLs, HTTP_ACCESS, HTTP_PORT, and
TCP_OUTGOING_ADDRESS from squid.conf to a DB+PHP solution.

 

Marcelo

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220709/88433a0c/attachment.htm>

From rousskov at measurement-factory.com  Sat Jul  9 22:08:00 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Sat, 9 Jul 2022 18:08:00 -0400
Subject: [squid-users] Squid.conf in a DB Mysql
In-Reply-To: <000001d893d7$ef513d00$cdf3b700$@graminsta.com.br>
References: <000001d893d7$ef513d00$cdf3b700$@graminsta.com.br>
Message-ID: <ab7e5524-14aa-d009-3449-62a114c6cb77@measurement-factory.com>

On 7/9/22 17:07, Marcelo wrote:

> Is it possible to use MySQL and PHP programming to put squid rules 
> outside of squid.conf?

Yes, for some definition of "put outside":

* One can use external ACL to make match/mismatch decisions (and supply 
metadata to Squid from) "outside" of the Squid process. Many Squid 
directives are controlled by ACLs, so one can control the corresponding 
Squid behavior from the "outside" by using external ACLs and/or 
annotations set by external ACLs. You can find examples of external ACL 
helpers/programs in src/acl/external/ directory. Your helper program can 
be written in most languages, but there are some (possibly stale) 
caveats at [1]. An external ACL is a _slow_ ACL; some Squid directives 
only support "fast" ACLs[2].

* One can generate squid.conf file (or portions of the configuration 
included into that file) from the information in a database (or from any 
other source of information), of course. You will need to reconfigure or 
restart (depending on what has changed and other factors) the Squid 
instance for Squid to notice such configuration changes.

[1] 
https://wiki.squid-cache.org/Features/AddonHelpers#What_language_are_helper_meant_to_be_written_in.3F

[2] http://wiki.squid-cache.org/SquidFaq/SquidAcl


HTH,

Alex.



> I heard about it using external acl, but can find any documentation or 
> good example of it.
> 
> I would like to ?transfer? parameters as ACLs, HTTP_ACCESS, HTTP_PORT, 
> and TCP_OUTGOING_ADDRESS from squid.conf to a DB+PHP solution.
> 
> Marcelo
> 
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



From ngtech1ltd at gmail.com  Sun Jul 10 01:25:23 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Sun, 10 Jul 2022 04:25:23 +0300
Subject: [squid-users] Squid.conf in a DB Mysql
In-Reply-To: <000001d893d7$ef513d00$cdf3b700$@graminsta.com.br>
References: <000001d893d7$ef513d00$cdf3b700$@graminsta.com.br>
Message-ID: <000001d893fb$ee3c4030$cab4c090$@gmail.com>

Hey Marcelo,
 
It?s possible to use a SQL DB (Mysql,MSSQL,Oracle,PostgreSQL?) and a programming language to put the rules outside of squid.conf.
It could be a combination of external acl helpers with DB backend and a configuration (squid.conf) generator based on a DB.
However, you first need to do some homework and make sure it will be good enough for your use case.
As Alex mentioned there are fast and slow ACLs but for your use case depends on your service size it?s possible 
you can use simple text files and simple external acl helpers.
 
To be able to answer your question in detail you need to prepare a technical spec that will try summarize your use case.
I am working on a series of Zoom meetings that I hope will start next week on Thursday evening IST.
I need to prepare the slides and environment for this meeting and it will be the first of: Squid 0 to hero
So the first meetings will not touch your use case specifically but I will discuss with the participants their aera so
we can talk and give demos for specific use cases somewhere in these meetings.
 
I will try to post about these meetings in the coming week with hope that you will be able to participate.
 
I believe that for your use case it?s better that you will not use PHP to write your helper despite to that fact that
the latest versions of PHP which I have tested are stable and won?t stop working even after a very very long run time
(what I was informed that should be tested in these PHP versions).
 
In my production environment I am using many RUBY helpers that eventually worth their memory consumption.
(Kinkie it took me a while to grasp that the memory usage differences between languages doesn?t worth considering)
 
I am working on couple examples but I am pretty sure it?s not your use case.
 
All The Bests,
Eliezer
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email:  <mailto:ngtech1ltd at gmail.com> ngtech1ltd at gmail.com
Web:  <https://ngtech.co.il/> https://ngtech.co.il/
My-Tube:  <https://tube.ngtech.co.il/> https://tube.ngtech.co.il/
 
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Marcelo
Sent: Sunday, 10 July 2022 0:08
To: squid-users at lists.squid-cache.org
Subject: [squid-users] Squid.conf in a DB Mysql
 
Hello,
 
Is it possible to use MySQL and PHP programming to put squid rules outside of squid.conf?
I heard about it using external acl, but can find any documentation or good example of it.
 
I would like to ?transfer? parameters as ACLs, HTTP_ACCESS, HTTP_PORT, and TCP_OUTGOING_ADDRESS from squid.conf to a DB+PHP solution.
 
 
Marcelo
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220710/ce7b8125/attachment.htm>

From ngtech1ltd at gmail.com  Sun Jul 10 22:23:31 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Mon, 11 Jul 2022 01:23:31 +0300
Subject: [squid-users] 0 2 RO - Squid-Cache Zoom Meetup
Message-ID: <001101d894ab$b0aebdf0$120c39d0$@gmail.com>

Hey Everybody,

https://www.ngtech.co.il/0-2-ro/index.php/2022/07/11/0-2-ro/

https://www.ngtech.co.il/0-2-ro/wp-content/uploads/2022/07/meeting-01-1024x576.png

Up-coming 0 2 RO Squid-Cache community meetup next week the 21/07/2022 at 20:30 IST. The meeting will be in Zoom and I hope that we can meet each other and understand what we can do together. The idea is to learn more about Squid-Cache as a one punch tool. It can do a lot of things and you we just need to learn from the experience of the elders. There is a eight layer in the OSI model and this is not something you can find in search engines but in each and every one of our souls. The Computers world is a very special cross-world place and we utilize the 7 OSI layers to get to the eight and I this meetup will give the platform for this layer for the Squid-Cache Community.
Put it in your calendar: 

https://www.ngtech.co.il/0-2-ro/wp-content/uploads/2022/07/0-2-ro-Squid-Cache-Community-meetup.ics

Please send me a response for the invite.

Thanks,
Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/




From ronny.preiss at gmail.com  Mon Jul 11 06:54:39 2022
From: ronny.preiss at gmail.com (Ronny Preiss)
Date: Mon, 11 Jul 2022 08:54:39 +0200
Subject: [squid-users] Sqid uses all RAM / killed by OOM
Message-ID: <CABMAtPLpoUrAXJv+JJvMbAe=N-b-brQeTTzq4OqDNc3Rf31GoQ@mail.gmail.com>

Hello all,

I have the following problem with squid 5.2 on ubuntu 22.04.
Squid consumes all ram and the entire SWAP. When swap and ram are
completely full, the OOM killer strikes and terminates the process.

We use three internal child proxy servers with keepalived and haproxy as
load balancers. From our ISP we use a parent upstream proxy for external
internet traffic.
As an operating system we have so far Ubuntu 20.04.4 with squid 4.1 in use.
This constellation works flawlessly.

Now I want to update the Server to Ubuntu 22.04 and squid 5.2. But with
Ubuntu 22.04 and squid 5.2 the above mentioned problem with the OOM Killer
occurs.
The new machine has only the OS and squid installed.

Who can help me with a solution?

With kind regards
Ronny

Attached the squid configuration and the VMWare specs.

### VM Specs ###
OS: Ubuntu 22.04 Server
CPU: 4x (Intel(R) Xeon(R) CPU E5-2690 v3 @ 2.60GHz)
RAM: 4 GB
VMWare: ESXi 7.0 U2

### CONFIG ###
acl 10.172.xxx.xxx/18 <http://10.172.128.0/18> src 10.172.xxx.xxx/18
<http://10.172.128.0/18>
acl 172.16.xxx.xxx/12 <http://172.16.0.0/12> src 172.16.xxx.xxx/12
<http://172.16.0.0/12>
acl 192.168.xxx.xxx/16 <http://192.168.0.0/16> src 192.168.xxx.xxx/16
<http://192.168.0.0/16>

acl Safe_ports port 80
acl Safe_ports port 21
acl Safe_ports port 443
acl Safe_ports port 70
acl Safe_ports port 210
acl Safe_ports port 1025-65535
acl Safe_ports port 280
acl Safe_ports port 488
acl Safe_ports port 591
acl Safe_ports port 777

http_access allow 10.172.xxx.xxx/18 <http://10.172.128.0/18> Safe_ports
http_access allow 172.16.xxx.xxx/12 <http://172.16.0.0/12> Safe_ports
http_access allow 192.168.xxx.xxx/16 <http://192.168.0.0/16> Safe_ports

http_access allow localhost manager
http_access allow localhost
http_access deny manager
http_access deny all

include /etc/squid/conf.d/*
http_port 10.172.xxx.xxx:3128 <http://10.172.128.34:3128>

cache_peer 10.210.xxx.xxx parent 8080 0
cache_dir ufs /var/spool/squid 3000 16 256
cache_effective_user proxy
cache_effective_group proxy

coredump_dir /var/spool/squid

refresh_pattern ^ftp:           1440    20%     10080
refresh_pattern ^gopher:        1440    0%      1440
refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
refresh_pattern \/(Packages|Sources)(|\.bz2|\.gz|\.xz)$ 0 0% 0 refresh-ims
refresh_pattern \/Release(|\.gpg)$ 0 0% 0 refresh-ims
refresh_pattern \/InRelease$ 0 0% 0 refresh-ims
refresh_pattern \/(Translation-.*)(|\.bz2|\.gz|\.xz)$ 0 0% 0 refresh-ims
refresh_pattern .               0       20%     4320

never_direct allow all
max_filedescriptors 40960
dns_nameservers 10.244.xxx.xxx

### DMESG ###

[256929.150801]
oom-kill:constraint=CONSTRAINT_NONE,nodemask=(null),cpuset=/,mems_allowed=0,global_oom,task_memcg=/system.slice/squid.service,task=squid,pid=26390,uid=13
[256929.150822] Out of memory: Killed process 26390 (squid)
total-vm:9691764kB, anon-rss:3657748kB, file-rss:2320kB, shmem-rss:0kB,
UID:13 pgtables:18932kB oom_score_adj:0
[256929.510641] oom_reaper: reaped process 26390 (squid), now anon-rss:0kB,
file-rss:0kB, shmem-rss:0kB
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220711/8cc0ada6/attachment.htm>

From ngtech1ltd at gmail.com  Mon Jul 11 11:30:58 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Mon, 11 Jul 2022 14:30:58 +0300
Subject: [squid-users] Sqid uses all RAM / killed by OOM
In-Reply-To: <CABMAtPLpoUrAXJv+JJvMbAe=N-b-brQeTTzq4OqDNc3Rf31GoQ@mail.gmail.com>
References: <CABMAtPLpoUrAXJv+JJvMbAe=N-b-brQeTTzq4OqDNc3Rf31GoQ@mail.gmail.com>
Message-ID: <000c01d89519$b244bd40$16ce37c0$@gmail.com>

Hey Ronny,
 
First to make the data more readable use a top snapshot to illustrate the memory usage.
Second, use Squid 5.6 and not 5.2
The issue is not necessarily  because of the Squid version but other things.
We should narrow down the issues as any other Squid issue.
First upgrade to 5.6 and then we need the top snapshot.
After that we need snapshots of cache-manager pages.
 
To dump snapshots of the cache manager pages you can use the next script:
https://gist.githubusercontent.com/elico/8790bdc835d8e9ecbc57e72fc31effc0/raw/60d140b0e772fa4f418779bfc27e4804a345ce23/dump-cache-mgr-to-file.sh
 
I am using it like this:
/usr/local/bin/dump-cache-mgr-to-file.sh 2>&1 | tee ?cachemg-data$(date +%Y-%m-%d_%H-%M-%S)?
 
Try to take couple dumps with 4.1 and 5.6 (if you want 5.2 also) and upload the snapshots to somewhere in a zip file.
Just take into account that these snapshots may contains confidential data so you are advised to review them and deduct specific
parts of them before making them public.
 
Just an advice,
A machine that should handle ?max_filedescriptors 40960? ie above 16k should have more RAM ie 8-16 GB as a starter.
 
All The Bests,
Eliezer
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> 
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/
 
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Ronny Preiss
Sent: Monday, 11 July 2022 9:55
To: squid-users at lists.squid-cache.org
Subject: [squid-users] Sqid uses all RAM / killed by OOM
 
Hello all,
 
I have the following problem with squid 5.2 on ubuntu 22.04.
Squid consumes all ram and the entire SWAP. When swap and ram are completely full, the OOM killer strikes and terminates the process.
 
We use three internal child proxy servers with keepalived and haproxy as load balancers. From our ISP we use a parent upstream proxy for external internet traffic.
As an operating system we have so far Ubuntu 20.04.4 with squid 4.1 in use. This constellation works flawlessly.
 
Now I want to update the Server to Ubuntu 22.04 and squid 5.2. But with Ubuntu 22.04 and squid 5.2 the above mentioned problem with the OOM Killer occurs.
The new machine has only the OS and squid installed.
 
Who can help me with a solution?
 
With kind regards
Ronny
 
Attached the squid configuration and the VMWare specs.
 
### VM Specs ###
OS: Ubuntu 22.04 Server
CPU: 4x (Intel(R) Xeon(R) CPU E5-2690 v3 @ 2.60GHz)
RAM: 4 GB
VMWare: ESXi 7.0 U2
 
### CONFIG ###
acl 10.172.xxx.xxx/18 <http://10.172.128.0/18>  src 10.172.xxx.xxx/18 <http://10.172.128.0/18> 
acl 172.16.xxx.xxx/12 <http://172.16.0.0/12>  src 172.16.xxx.xxx/12 <http://172.16.0.0/12> 
acl 192.168.xxx.xxx/16 <http://192.168.0.0/16>  src 192.168.xxx.xxx/16 <http://192.168.0.0/16> 
 
acl Safe_ports port 80
acl Safe_ports port 21
acl Safe_ports port 443
acl Safe_ports port 70
acl Safe_ports port 210
acl Safe_ports port 1025-65535
acl Safe_ports port 280
acl Safe_ports port 488
acl Safe_ports port 591
acl Safe_ports port 777
 
http_access allow 10.172.xxx.xxx/18 <http://10.172.128.0/18>  Safe_ports
http_access allow 172.16.xxx.xxx/12 <http://172.16.0.0/12>  Safe_ports
http_access allow 192.168.xxx.xxx/16 <http://192.168.0.0/16>  Safe_ports
 
http_access allow localhost manager
http_access allow localhost
http_access deny manager
http_access deny all
 
include /etc/squid/conf.d/*
http_port 10.172.xxx.xxx:3128 <http://10.172.128.34:3128> 
 
cache_peer 10.210.xxx.xxx parent 8080 0
cache_dir ufs /var/spool/squid 3000 16 256
cache_effective_user proxy
cache_effective_group proxy
 
coredump_dir /var/spool/squid
 
refresh_pattern ^ftp:           1440    20%     10080
refresh_pattern ^gopher:        1440    0%      1440
refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
refresh_pattern \/(Packages|Sources)(|\.bz2|\.gz|\.xz)$ 0 0% 0 refresh-ims
refresh_pattern \/Release(|\.gpg)$ 0 0% 0 refresh-ims
refresh_pattern \/InRelease$ 0 0% 0 refresh-ims
refresh_pattern \/(Translation-.*)(|\.bz2|\.gz|\.xz)$ 0 0% 0 refresh-ims
refresh_pattern .               0       20%     4320
 
never_direct allow all
max_filedescriptors 40960
dns_nameservers 10.244.xxx.xxx
 
### DMESG ###
 
[256929.150801] oom-kill:constraint=CONSTRAINT_NONE,nodemask=(null),cpuset=/,mems_allowed=0,global_oom,task_memcg=/system.slice/squid.service,task=squid,pid=26390,uid=13
[256929.150822] Out of memory: Killed process 26390 (squid) total-vm:9691764kB, anon-rss:3657748kB, file-rss:2320kB, shmem-rss:0kB, UID:13 pgtables:18932kB oom_score_adj:0
[256929.510641] oom_reaper: reaped process 26390 (squid), now anon-rss:0kB, file-rss:0kB, shmem-rss:0kB
 
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220711/d2d97e52/attachment.htm>

From 0xff1f at gmail.com  Mon Jul 11 13:38:05 2022
From: 0xff1f at gmail.com (Ahmad Alzaeem)
Date: Mon, 11 Jul 2022 13:38:05 +0000
Subject: [squid-users] squid 3.x on Centos8 not working
In-Reply-To: <DBBPR09MB4523CC08514A6EA08BCD3DC2F7B89@DBBPR09MB4523.eurprd09.prod.outlook.com>
References: <DBBPR09MB4523CC08514A6EA08BCD3DC2F7B89@DBBPR09MB4523.eurprd09.prod.outlook.com>
Message-ID: <DBBPR09MB4523AA2581623911DD6C3DCEF7879@DBBPR09MB4523.eurprd09.prod.outlook.com>

Hello Folks ,
Anyone in the Dev team to help me out?

Thanks

From: Ahmad Alzaeem <0xff1f at gmail.com>
Date: Tuesday, June 28, 2022 at 6:28 AM
To: squid-users at lists.squid-cache.org <squid-users at lists.squid-cache.org>
Subject: squid 3.x on Centos8 not working

Hello Folks ,

Trying to compile squid 3.x on Centos8 but have an errors below seems in SMBLIB .

Squid ver :
squid-3.5.28

GCC ver :

gcc -v
Using built-in specs.
COLLECT_GCC=gcc
COLLECT_LTO_WRAPPER=/usr/libexec/gcc/x86_64-redhat-linux/8/lto-wrapper
OFFLOAD_TARGET_NAMES=nvptx-none
OFFLOAD_TARGET_DEFAULT=1
Target: x86_64-redhat-linux
Configured with: ../configure --enable-bootstrap --enable-languages=c,c++,fortran,lto --prefix=/usr --mandir=/usr/share/man --infodir=/usr/share/info --with-bugurl=http://bugzilla.redhat.com/bugzilla --enable-shared --enable-threads=posix --enable-checking=release --enable-multilib --with-system-zlib --enable-__cxa_atexit --disable-libunwind-exceptions --enable-gnu-unique-object --enable-linker-build-id --with-gcc-major-version-only --with-linker-hash-style=gnu --enable-plugin --enable-initfini-array --with-isl --disable-libmpx --enable-offload-targets=nvptx-none --without-cuda-driver --enable-gnu-indirect-function --enable-cet --with-tune=generic --with-arch_32=x86-64 --build=x86_64-redhat-linux
Thread model: posix
gcc version 8.5.0 20210514 (Red Hat 8.5.0-4) (GCC)

we are using ./configure  with default flags  ,  and have the errors below :


make[2]: Entering directory '/root/squid-3.5.28/lib/rfcnb'
depbase=`echo rfcnb-io.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
/bin/sh ../../libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H   -I../.. -I../../include -I../../lib -I../../src -I../../include    -I../../lib  -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT rfcnb-io.lo -MD -MP -MF $depbase.Tpo -c -o rfcnb-io.lo rfcnb-io.c &&\
mv -f $depbase.Tpo $depbase.Plo
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT rfcnb-io.lo -MD -MP -MF .deps/rfcnb-io.Tpo -c rfcnb-io.c  -fPIC -DPIC -o .libs/rfcnb-io.o
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT rfcnb-io.lo -MD -MP -MF .deps/rfcnb-io.Tpo -c rfcnb-io.c -o rfcnb-io.o >/dev/null 2>&1
depbase=`echo rfcnb-util.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
/bin/sh ../../libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H   -I../.. -I../../include -I../../lib -I../../src -I../../include    -I../../lib  -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT rfcnb-util.lo -MD -MP -MF $depbase.Tpo -c -o rfcnb-util.lo rfcnb-util.c &&\
mv -f $depbase.Tpo $depbase.Plo
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT rfcnb-util.lo -MD -MP -MF .deps/rfcnb-util.Tpo -c rfcnb-util.c  -fPIC -DPIC -o .libs/rfcnb-util.o
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT rfcnb-util.lo -MD -MP -MF .deps/rfcnb-util.Tpo -c rfcnb-util.c -o rfcnb-util.o >/dev/null 2>&1
depbase=`echo session.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
/bin/sh ../../libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H   -I../.. -I../../include -I../../lib -I../../src -I../../include    -I../../lib  -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT session.lo -MD -MP -MF $depbase.Tpo -c -o session.lo session.c &&\
mv -f $depbase.Tpo $depbase.Plo
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT session.lo -MD -MP -MF .deps/session.Tpo -c session.c  -fPIC -DPIC -o .libs/session.o
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT session.lo -MD -MP -MF .deps/session.Tpo -c session.c -o session.o >/dev/null 2>&1
/bin/sh ../../libtool  --tag=CC   --mode=link gcc -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2  -g -o librfcnb.la  rfcnb-io.lo rfcnb-util.lo session.lo
libtool: link: /usr/bin/ar cru .libs/librfcnb.a .libs/rfcnb-io.o .libs/rfcnb-util.o .libs/session.o
libtool: link: ranlib .libs/librfcnb.a
libtool: link: ( cd ".libs" && rm -f "librfcnb.la" && ln -s "../librfcnb.la" "librfcnb.la" )
make[2]: Leaving directory '/root/squid-3.5.28/lib/rfcnb'
Making all in smblib
make[2]: Entering directory '/root/squid-3.5.28/lib/smblib'
depbase=`echo md4.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
/bin/sh ../../libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H   -I../.. -I../../include -I../../lib -I../../src -I../../include    -I../../lib  -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT md4.lo -MD -MP -MF $depbase.Tpo -c -o md4.lo md4.c &&\
mv -f $depbase.Tpo $depbase.Plo
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT md4.lo -MD -MP -MF .deps/md4.Tpo -c md4.c  -fPIC -DPIC -o .libs/md4.o
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT md4.lo -MD -MP -MF .deps/md4.Tpo -c md4.c -o md4.o >/dev/null 2>&1
depbase=`echo smblib.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
/bin/sh ../../libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H   -I../.. -I../../include -I../../lib -I../../src -I../../include    -I../../lib  -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT smblib.lo -MD -MP -MF $depbase.Tpo -c -o smblib.lo smblib.c &&\
mv -f $depbase.Tpo $depbase.Plo
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT smblib.lo -MD -MP -MF .deps/smblib.Tpo -c smblib.c  -fPIC -DPIC -o .libs/smblib.o
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT smblib.lo -MD -MP -MF .deps/smblib.Tpo -c smblib.c -o smblib.o >/dev/null 2>&1
depbase=`echo smblib-util.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
/bin/sh ../../libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H   -I../.. -I../../include -I../../lib -I../../src -I../../include    -I../../lib  -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT smblib-util.lo -MD -MP -MF $depbase.Tpo -c -o smblib-util.lo smblib-util.c &&\
mv -f $depbase.Tpo $depbase.Plo
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT smblib-util.lo -MD -MP -MF .deps/smblib-util.Tpo -c smblib-util.c  -fPIC -DPIC -o .libs/smblib-util.o
smblib-util.c: In function ?SMB_Negotiate?:
smblib-util.c:400:9: error: ?strncpy? output may be truncated copying 79 bytes from a string of length 79 [-Werror=stringop-truncation]
         strncpy(p, Con_Handle -> Svr_PDom, sizeof(Con_Handle -> Svr_PDom) - 1);
         ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
smblib-util.c:423:9: error: ?strncpy? output may be truncated copying 79 bytes from a string of length 79 [-Werror=stringop-truncation]
         strncpy(p, Con_Handle -> Svr_PDom, sizeof(Con_Handle -> Svr_PDom) - 1);
         ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
smblib-util.c: In function ?SMB_TreeConnect?:
smblib-util.c:537:5: error: ?strncpy? specified bound 129 equals destination size [-Werror=stringop-truncation]
     strncpy(tree -> path, path, sizeof(tree -> path));
     ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
smblib-util.c:538:5: error: ?strncpy? specified bound 20 equals destination size [-Werror=stringop-truncation]
     strncpy(tree -> device_type, device, sizeof(tree -> device_type));
     ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
cc1: all warnings being treated as errors
make[2]: *** [Makefile:776: smblib-util.lo] Error 1
make[2]: Leaving directory '/root/squid-3.5.28/lib/smblib'
make[1]: *** [Makefile:1043: all-recursive] Error 1
make[1]: Leaving directory '/root/squid-3.5.28/lib'
make: *** [Makefile:581: all-recursive] Error 1

Any help is welcome !
Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220711/51226b93/attachment.htm>

From rousskov at measurement-factory.com  Mon Jul 11 17:20:21 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Mon, 11 Jul 2022 13:20:21 -0400
Subject: [squid-users] squid 3.x on Centos8 not working
In-Reply-To: <DBBPR09MB4523AA2581623911DD6C3DCEF7879@DBBPR09MB4523.eurprd09.prod.outlook.com>
References: <DBBPR09MB4523CC08514A6EA08BCD3DC2F7B89@DBBPR09MB4523.eurprd09.prod.outlook.com>
 <DBBPR09MB4523AA2581623911DD6C3DCEF7879@DBBPR09MB4523.eurprd09.prod.outlook.com>
Message-ID: <8423f923-097a-eb37-ddb7-20687c857f72@measurement-factory.com>

On 7/11/22 09:38, Ahmad Alzaeem wrote:

> Anyone in the Dev team to help me out?

In most cases, folks should not be using Squid v3. It is not a supported 
Squid version.

You may be able to get your Squid to build by avoiding the -Werror 
compiler flag (e.g., by ./configuring Squid with 
--disable-strict-error-checking).


HTH,

Alex.



> *From: *Ahmad Alzaeem <0xff1f at gmail.com>
> *Date: *Tuesday, June 28, 2022 at 6:28 AM
> *To: *squid-users at lists.squid-cache.org <squid-users at lists.squid-cache.org>
> *Subject: *squid 3.x on Centos8 not working
> 
> Hello Folks ,
> 
> Trying to compile squid 3.x on Centos8 but have an errors below seems in 
> SMBLIB .
> 
> Squid ver :
> 
> squid-3.5.28
> 
> GCC ver :
> 
> gcc -v
> 
> Using built-in specs.
> 
> COLLECT_GCC=gcc
> 
> COLLECT_LTO_WRAPPER=/usr/libexec/gcc/x86_64-redhat-linux/8/lto-wrapper
> 
> OFFLOAD_TARGET_NAMES=nvptx-none
> 
> OFFLOAD_TARGET_DEFAULT=1
> 
> Target: x86_64-redhat-linux
> 
> Configured with: ../configure --enable-bootstrap 
> --enable-languages=c,c++,fortran,lto --prefix=/usr 
> --mandir=/usr/share/man --infodir=/usr/share/info 
> --with-bugurl=http://bugzilla.redhat.com/bugzilla --enable-shared 
> --enable-threads=posix --enable-checking=release --enable-multilib 
> --with-system-zlib --enable-__cxa_atexit --disable-libunwind-exceptions 
> --enable-gnu-unique-object --enable-linker-build-id 
> --with-gcc-major-version-only --with-linker-hash-style=gnu 
> --enable-plugin --enable-initfini-array --with-isl --disable-libmpx 
> --enable-offload-targets=nvptx-none --without-cuda-driver 
> --enable-gnu-indirect-function --enable-cet --with-tune=generic 
> --with-arch_32=x86-64 --build=x86_64-redhat-linux
> 
> Thread model: posix
> 
> gcc version 8.5.0 20210514 (Red Hat 8.5.0-4) (GCC)
> 
> we are using ./configure ?with default flags ?, ?and have the errors below :
> 
> make[2]: Entering directory '/root/squid-3.5.28/lib/rfcnb'
> 
> depbase=`echo rfcnb-io.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
> 
> /bin/sh ../../libtool? --tag=CC?? --mode=compile gcc -DHAVE_CONFIG_H   
> -I../.. -I../../include -I../../lib -I../../src -I../../include    
> -I../../lib? -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes 
> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT 
> -Wall -g -O2 -MT rfcnb-io.lo -MD -MP -MF $depbase.Tpo -c -o rfcnb-io.lo 
> rfcnb-io.c &&\
> 
> mv -f $depbase.Tpo $depbase.Plo
> 
> libtool: compile:? gcc -DHAVE_CONFIG_H -I../.. -I../../include 
> -I../../lib -I../../src -I../../include -I../../lib -Wall 
> -Wpointer-arith -Wwrite-strings -Wmissing-prototypes 
> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT 
> -Wall -g -O2 -MT rfcnb-io.lo -MD -MP -MF .deps/rfcnb-io.Tpo -c 
> rfcnb-io.c? -fPIC -DPIC -o .libs/rfcnb-io.o
> 
> libtool: compile:? gcc -DHAVE_CONFIG_H -I../.. -I../../include 
> -I../../lib -I../../src -I../../include -I../../lib -Wall 
> -Wpointer-arith -Wwrite-strings -Wmissing-prototypes 
> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT 
> -Wall -g -O2 -MT rfcnb-io.lo -MD -MP -MF .deps/rfcnb-io.Tpo -c 
> rfcnb-io.c -o rfcnb-io.o >/dev/null 2>&1
> 
> depbase=`echo rfcnb-util.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
> 
> /bin/sh ../../libtool? --tag=CC?? --mode=compile gcc -DHAVE_CONFIG_H   
> -I../.. -I../../include -I../../lib -I../../src -I../../include    
> -I../../lib? -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes 
> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT 
> -Wall -g -O2 -MT rfcnb-util.lo -MD -MP -MF $depbase.Tpo -c -o 
> rfcnb-util.lo rfcnb-util.c &&\
> 
> mv -f $depbase.Tpo $depbase.Plo
> 
> libtool: compile:? gcc -DHAVE_CONFIG_H -I../.. -I../../include 
> -I../../lib -I../../src -I../../include -I../../lib -Wall 
> -Wpointer-arith -Wwrite-strings -Wmissing-prototypes 
> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT 
> -Wall -g -O2 -MT rfcnb-util.lo -MD -MP -MF .deps/rfcnb-util.Tpo -c 
> rfcnb-util.c? -fPIC -DPIC -o .libs/rfcnb-util.o
> 
> libtool: compile:? gcc -DHAVE_CONFIG_H -I../.. -I../../include 
> -I../../lib -I../../src -I../../include -I../../lib -Wall 
> -Wpointer-arith -Wwrite-strings -Wmissing-prototypes 
> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT 
> -Wall -g -O2 -MT rfcnb-util.lo -MD -MP -MF .deps/rfcnb-util.Tpo -c 
> rfcnb-util.c -o rfcnb-util.o >/dev/null 2>&1
> 
> depbase=`echo session.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
> 
> /bin/sh ../../libtool? --tag=CC?? --mode=compile gcc -DHAVE_CONFIG_H   
> -I../.. -I../../include -I../../lib -I../../src -I../../include    
> -I../../lib? -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes 
> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT 
> -Wall -g -O2 -MT session.lo -MD -MP -MF $depbase.Tpo -c -o session.lo 
> session.c &&\
> 
> mv -f $depbase.Tpo $depbase.Plo
> 
> libtool: compile:? gcc -DHAVE_CONFIG_H -I../.. -I../../include 
> -I../../lib -I../../src -I../../include -I../../lib -Wall 
> -Wpointer-arith -Wwrite-strings -Wmissing-prototypes 
> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT 
> -Wall -g -O2 -MT session.lo -MD -MP -MF .deps/session.Tpo -c session.c  
> -fPIC -DPIC -o .libs/session.o
> 
> libtool: compile:? gcc -DHAVE_CONFIG_H -I../.. -I../../include 
> -I../../lib -I../../src -I../../include -I../../lib -Wall 
> -Wpointer-arith -Wwrite-strings -Wmissing-prototypes 
> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT 
> -Wall -g -O2 -MT session.lo -MD -MP -MF .deps/session.Tpo -c session.c 
> -o session.o >/dev/null 2>&1
> 
> /bin/sh ../../libtool? --tag=CC?? --mode=link gcc -Wall -Wpointer-arith 
> -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments 
> -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2? -g -o librfcnb.la 
> rfcnb-io.lo rfcnb-util.lo session.lo
> 
> libtool: link: /usr/bin/ar cru .libs/librfcnb.a .libs/rfcnb-io.o 
> .libs/rfcnb-util.o .libs/session.o
> 
> libtool: link: ranlib .libs/librfcnb.a
> 
> libtool: link: ( cd ".libs" && rm -f "librfcnb.la" && ln -s 
> "../librfcnb.la" "librfcnb.la" )
> 
> make[2]: Leaving directory '/root/squid-3.5.28/lib/rfcnb'
> 
> Making all in smblib
> 
> make[2]: Entering directory '/root/squid-3.5.28/lib/smblib'
> 
> depbase=`echo md4.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
> 
> /bin/sh ../../libtool? --tag=CC?? --mode=compile gcc -DHAVE_CONFIG_H   
> -I../.. -I../../include -I../../lib -I../../src -I../../include    
> -I../../lib? -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes 
> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT 
> -Wall -g -O2 -MT md4.lo -MD -MP -MF $depbase.Tpo -c -o md4.lo md4.c &&\
> 
> mv -f $depbase.Tpo $depbase.Plo
> 
> libtool: compile:? gcc -DHAVE_CONFIG_H -I../.. -I../../include 
> -I../../lib -I../../src -I../../include -I../../lib -Wall 
> -Wpointer-arith -Wwrite-strings -Wmissing-prototypes 
> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT 
> -Wall -g -O2 -MT md4.lo -MD -MP -MF .deps/md4.Tpo -c md4.c? -fPIC -DPIC 
> -o .libs/md4.o
> 
> libtool: compile:? gcc -DHAVE_CONFIG_H -I../.. -I../../include 
> -I../../lib -I../../src -I../../include -I../../lib -Wall 
> -Wpointer-arith -Wwrite-strings -Wmissing-prototypes 
> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT 
> -Wall -g -O2 -MT md4.lo -MD -MP -MF .deps/md4.Tpo -c md4.c -o md4.o 
>  >/dev/null 2>&1
> 
> depbase=`echo smblib.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
> 
> /bin/sh ../../libtool? --tag=CC?? --mode=compile gcc -DHAVE_CONFIG_H   
> -I../.. -I../../include -I../../lib -I../../src -I../../include    
> -I../../lib? -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes 
> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT 
> -Wall -g -O2 -MT smblib.lo -MD -MP -MF $depbase.Tpo -c -o smblib.lo 
> smblib.c &&\
> 
> mv -f $depbase.Tpo $depbase.Plo
> 
> libtool: compile:? gcc -DHAVE_CONFIG_H -I../.. -I../../include 
> -I../../lib -I../../src -I../../include -I../../lib -Wall 
> -Wpointer-arith -Wwrite-strings -Wmissing-prototypes 
> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT 
> -Wall -g -O2 -MT smblib.lo -MD -MP -MF .deps/smblib.Tpo -c smblib.c  
> -fPIC -DPIC -o .libs/smblib.o
> 
> libtool: compile:? gcc -DHAVE_CONFIG_H -I../.. -I../../include 
> -I../../lib -I../../src -I../../include -I../../lib -Wall 
> -Wpointer-arith -Wwrite-strings -Wmissing-prototypes 
> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT 
> -Wall -g -O2 -MT smblib.lo -MD -MP -MF .deps/smblib.Tpo -c smblib.c -o 
> smblib.o >/dev/null 2>&1
> 
> depbase=`echo smblib-util.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
> 
> /bin/sh ../../libtool? --tag=CC?? --mode=compile gcc -DHAVE_CONFIG_H   
> -I../.. -I../../include -I../../lib -I../../src -I../../include    
> -I../../lib? -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes 
> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT 
> -Wall -g -O2 -MT smblib-util.lo -MD -MP -MF $depbase.Tpo -c -o 
> smblib-util.lo smblib-util.c &&\
> 
> mv -f $depbase.Tpo $depbase.Plo
> 
> libtool: compile:? gcc -DHAVE_CONFIG_H -I../.. -I../../include 
> -I../../lib -I../../src -I../../include -I../../lib -Wall 
> -Wpointer-arith -Wwrite-strings -Wmissing-prototypes 
> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT 
> -Wall -g -O2 -MT smblib-util.lo -MD -MP -MF .deps/smblib-util.Tpo -c 
> smblib-util.c? -fPIC -DPIC -o .libs/smblib-util.o
> 
> smblib-util.c: In function ?SMB_Negotiate?:
> 
> smblib-util.c:400:9: error: ?strncpy? output may be truncated copying 79 
> bytes from a string of length 79 [-Werror=stringop-truncation]
> 
>  ???????? strncpy(p, Con_Handle -> Svr_PDom, sizeof(Con_Handle -> 
> Svr_PDom) - 1);
> 
>           
> ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
> 
> smblib-util.c:423:9: error: ?strncpy? output may be truncated copying 79 
> bytes from a string of length 79 [-Werror=stringop-truncation]
> 
>  ???????? strncpy(p, Con_Handle -> Svr_PDom, sizeof(Con_Handle -> 
> Svr_PDom) - 1);
> 
>       
>  ????^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
> 
> smblib-util.c: In function ?SMB_TreeConnect?:
> 
> smblib-util.c:537:5: error: ?strncpy? specified bound 129 equals 
> destination size [-Werror=stringop-truncation]
> 
>  ???? strncpy(tree -> path, path, sizeof(tree -> path));
> 
>  ???? ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
> 
> smblib-util.c:538:5: error: ?strncpy? specified bound 20 equals 
> destination size [-Werror=stringop-truncation]
> 
>  ???? strncpy(tree -> device_type, device, sizeof(tree -> device_type));
> 
>  ???? ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
> 
> cc1: all warnings being treated as errors
> 
> make[2]: *** [Makefile:776: smblib-util.lo] Error 1
> 
> make[2]: Leaving directory '/root/squid-3.5.28/lib/smblib'
> 
> make[1]: *** [Makefile:1043: all-recursive] Error 1
> 
> make[1]: Leaving directory '/root/squid-3.5.28/lib'
> 
> make: *** [Makefile:581: all-recursive] Error 1
> 
> Any help is welcome !
> 
> Thanks
> 
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



From 0xff1f at gmail.com  Mon Jul 11 17:30:56 2022
From: 0xff1f at gmail.com (Ahmad Alzaeem)
Date: Mon, 11 Jul 2022 17:30:56 +0000
Subject: [squid-users] squid 3.x on Centos8 not working
In-Reply-To: <8423f923-097a-eb37-ddb7-20687c857f72@measurement-factory.com>
References: <DBBPR09MB4523CC08514A6EA08BCD3DC2F7B89@DBBPR09MB4523.eurprd09.prod.outlook.com>
 <DBBPR09MB4523AA2581623911DD6C3DCEF7879@DBBPR09MB4523.eurprd09.prod.outlook.com>
 <8423f923-097a-eb37-ddb7-20687c857f72@measurement-factory.com>
Message-ID: <DBBPR09MB4523F6DC144F2C30260F755EF7879@DBBPR09MB4523.eurprd09.prod.outlook.com>

Hello Alex ,
Thank you for your reply,

I'm not sure if I need to use a lower version compiler on Centos8?


I got some  crypto or SSL errors :


I/usr/include/libxml2 -Wall -Wpointer-arith -Wwrite-strings -Wcomments -Wshadow -Woverloaded-virtual -pipe -D_REENTRANT -m64 -DMAXTCPLISTENPORTS=999999 -c PortCfg.cc  -fPIC -DPIC -o .libs/PortCfg.o
In file included from ../../include/util.h:37,
                 from ../../include/MemPool.h:31,
                 from ../../src/comm/Connection.h:18,
                 from ../../src/anyp/PortCfg.h:15,
                 from PortCfg.cc:10:
../../include/squidNew.h:21:53: warning: dynamic exception specifications are deprecated in C++11 [-Wdeprecated]
_squid_EXTERNNEW_ void *operator new(size_t size) throw (std::bad_alloc)
                                                     ^~~~~
../../include/squidNew.h:29:56: warning: dynamic exception specifications are deprecated in C++11 [-Wdeprecated]
_squid_EXTERNNEW_ void *operator new[] (size_t size) throw (std::bad_alloc)
                                                        ^~~~~
In file included from ../../src/anyp/PortCfg.h:18,
                 from PortCfg.cc:10:
../../src/ssl/gadgets.h:83:45: error: ?CRYPTO_LOCK_X509? was not declared in this scope
typedef LockingPointer<X509, X509_free_cpp, CRYPTO_LOCK_X509> X509_Pointer;
                                             ^~~~~~~~~~~~~~~~
../../src/ssl/gadgets.h:83:45: note: suggested alternative: ?CRYPTO_LOCK?
typedef LockingPointer<X509, X509_free_cpp, CRYPTO_LOCK_X509> X509_Pointer;
                                             ^~~~~~~~~~~~~~~~
                                             CRYPTO_LOCK
../../src/ssl/gadgets.h:83:61: error: template argument 3 is invalid
typedef LockingPointer<X509, X509_free_cpp, CRYPTO_LOCK_X509> X509_Pointer;
                                                             ^
../../src/ssl/gadgets.h:89:53: error: ?CRYPTO_LOCK_EVP_PKEY? was not declared in this scope
typedef LockingPointer<EVP_PKEY, EVP_PKEY_free_cpp, CRYPTO_LOCK_EVP_PKEY> EVP_PKEY_Pointer;
                                                     ^~~~~~~~~~~~~~~~~~~~
../../src/ssl/gadgets.h:89:53: note: suggested alternative: ?CRYPTO_LOCK?
typedef LockingPointer<EVP_PKEY, EVP_PKEY_free_cpp, CRYPTO_LOCK_EVP_PKEY> EVP_PKEY_Pointer;
                                                     ^~~~~~~~~~~~~~~~~~~~
                                                     CRYPTO_LOCK
../../src/ssl/gadgets.h:89:73: error: template argument 3 is invalid
typedef LockingPointer<EVP_PKEY, EVP_PKEY_free_cpp, CRYPTO_LOCK_EVP_PKEY> EVP_PKEY_Pointer;
                                                                         ^
../../src/ssl/gadgets.h:116:43: error: ?CRYPTO_LOCK_SSL? was not declared in this scope
typedef LockingPointer<SSL, SSL_free_cpp, CRYPTO_LOCK_SSL> SSL_Pointer;
                                           ^~~~~~~~~~~~~~~
../../src/ssl/gadgets.h:116:43: note: suggested alternative: ?CRYPTO_LOCK?
typedef LockingPointer<SSL, SSL_free_cpp, CRYPTO_LOCK_SSL> SSL_Pointer;
                                           ^~~~~~~~~~~~~~~
                                           CRYPTO_LOCK
../../src/ssl/gadgets.h:116:58: error: template argument 3 is invalid
typedef LockingPointer<SSL, SSL_free_cpp, CRYPTO_LOCK_SSL> SSL_Pointer;
                                                          ^
make[3]: *** [Makefile:803: PortCfg.lo] Error 1
make[3]: Leaving directory '/root/squid-3.5.25/src/anyp'
make[2]: *** [Makefile:7498: all-recursive] Error 1
make[2]: Leaving directory '/root/squid-3.5.25/src'
make[1]: *** [Makefile:6353: all] Error 2
make[1]: Leaving directory '/root/squid-3.5.25/src'
make: *** [Makefile:580: all-recursive] Error 1




Here is GCC info :

Using built-in specs.
COLLECT_GCC=gcc
COLLECT_LTO_WRAPPER=/usr/libexec/gcc/x86_64-redhat-linux/8/lto-wrapper
OFFLOAD_TARGET_NAMES=nvptx-none
OFFLOAD_TARGET_DEFAULT=1
Target: x86_64-redhat-linux
Configured with: ../configure --enable-bootstrap --enable-languages=c,c++,fortran,lto --prefix=/usr --mandir=/usr/share/man --infodir=/usr/share/info --with-bugurl=http://bugzilla.redhat.com/bugzilla --enable-shared --enable-threads=posix --enable-checking=release --enable-multilib --with-system-zlib --enable-__cxa_atexit --disable-libunwind-exceptions --enable-gnu-unique-object --enable-linker-build-id --with-gcc-major-version-only --with-linker-hash-style=gnu --enable-plugin --enable-initfini-array --with-isl --disable-libmpx --enable-offload-targets=nvptx-none --without-cuda-driver --enable-gnu-indirect-function --enable-cet --with-tune=generic --with-arch_32=x86-64 --build=x86_64-redhat-linux
Thread model: posix
gcc version 8.5.0 20210514 (Red Hat 8.5.0-4) (GCC)



Also found have openssl and openssl3 installed both on machine :


openssl version -a
OpenSSL 1.1.1k  FIPS 25 Mar 2021
built on: Fri Nov 12 17:53:47 2021 UTC
platform: linux-x86_64
options:  bn(64,64) md2(char) rc4(16x,int) des(int) idea(int) blowfish(ptr)
compiler: gcc -fPIC -pthread -m64 -Wa,--noexecstack -Wall -O3 -O2 -g -pipe -Wall -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -Wp,-D_GLIBCXX_ASSERTIONS -fexceptions -fstack-protector-strong -grecord-gcc-switches -specs=/usr/lib/rpm/redhat/redhat-hardened-cc1 -specs=/usr/lib/rpm/redhat/redhat-annobin-cc1 -m64 -mtune=generic -fasynchronous-unwind-tables -fstack-clash-protection -fcf-protection -Wa,--noexecstack -Wa,--generate-missing-build-notes=yes -specs=/usr/lib/rpm/redhat/redhat-hardened-ld -DOPENSSL_USE_NODELETE -DL_ENDIAN -DOPENSSL_PIC -DOPENSSL_CPUID_OBJ -DOPENSSL_IA32_SSE2 -DOPENSSL_BN_ASM_MONT -DOPENSSL_BN_ASM_MONT5 -DOPENSSL_BN_ASM_GF2m -DSHA1_ASM -DSHA256_ASM -DSHA512_ASM -DKECCAK1600_ASM -DRC4_ASM -DMD5_ASM -DAESNI_ASM -DVPAES_ASM -DGHASH_ASM -DECP_NISTZ256_ASM -DX25519_ASM -DPOLY1305_ASM -DZLIB -DNDEBUG -DPURIFY -DDEVRANDOM="\"/dev/urandom\"" -DSYSTEM_CIPHERS_FILE="/etc/crypto-policies/back-ends/openssl.config"
OPENSSLDIR: "/etc/pki/tls"
ENGINESDIR: "/usr/lib64/engines-1.1"
Seeding source: os-specific
engines:  rdrand dynamic



openssl3 version -a
OpenSSL 3.0.1 14 Dec 2021 (Library: OpenSSL 3.0.1 14 Dec 2021)
built on: Wed Mar 16 21:52:03 2022 UTC
platform: linux-x86_64
options:  bn(64,64)
compiler: gcc -fPIC -pthread -m64 -Wa,--noexecstack -Wall -O3 -O2 -g -pipe -Wall -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -Wp,-D_GLIBCXX_ASSERTIONS -fexceptions -fstack-protector-strong -grecord-gcc-switches -specs=/usr/lib/rpm/redhat/redhat-hardened-cc1 -specs=/usr/lib/rpm/redhat/redhat-annobin-cc1 -m64 -mtune=generic -fasynchronous-unwind-tables -fstack-clash-protection -fcf-protection -Wa,--noexecstack -Wa,--generate-missing-build-notes=yes -specs=/usr/lib/rpm/redhat/redhat-hardened-ld -DOPENSSL_USE_NODELETE -DL_ENDIAN -DOPENSSL_PIC -DOPENSSL_BUILDING_OPENSSL -DZLIB -DNDEBUG -DPURIFY -DDEVRANDOM="\"/dev/urandom\"" -DREDHAT_FIPS_VERSION="\"3.0.1-20220316\"" -DSYSTEM_CIPHERS_FILE="/etc/crypto-policies/back-ends/openssl.config"
OPENSSLDIR: "/etc/pki/tls"
ENGINESDIR: "/usr/lib64/engines-3"
MODULESDIR: "/usr/lib64/ossl-modules"
Seeding source: os-specific
CPUINFO: OPENSSL_ia32cap=0x7ffef3ffffebffff:0x21cbfbb



Thanks

From: squid-users <squid-users-bounces at lists.squid-cache.org> on behalf of Alex Rousskov <rousskov at measurement-factory.com>
Date: Monday, July 11, 2022 at 10:20 AM
To: squid-users at lists.squid-cache.org <squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] squid 3.x on Centos8 not working
On 7/11/22 09:38, Ahmad Alzaeem wrote:

> Anyone in the Dev team to help me out?

In most cases, folks should not be using Squid v3. It is not a supported
Squid version.

You may be able to get your Squid to build by avoiding the -Werror
compiler flag (e.g., by ./configuring Squid with
--disable-strict-error-checking).


HTH,

Alex.



> *From: *Ahmad Alzaeem <0xff1f at gmail.com>
> *Date: *Tuesday, June 28, 2022 at 6:28 AM
> *To: *squid-users at lists.squid-cache.org <squid-users at lists.squid-cache.org>
> *Subject: *squid 3.x on Centos8 not working
>
> Hello Folks ,
>
> Trying to compile squid 3.x on Centos8 but have an errors below seems in
> SMBLIB .
>
> Squid ver :
>
> squid-3.5.28
>
> GCC ver :
>
> gcc -v
>
> Using built-in specs.
>
> COLLECT_GCC=gcc
>
> COLLECT_LTO_WRAPPER=/usr/libexec/gcc/x86_64-redhat-linux/8/lto-wrapper
>
> OFFLOAD_TARGET_NAMES=nvptx-none
>
> OFFLOAD_TARGET_DEFAULT=1
>
> Target: x86_64-redhat-linux
>
> Configured with: ../configure --enable-bootstrap
> --enable-languages=c,c++,fortran,lto --prefix=/usr
> --mandir=/usr/share/man --infodir=/usr/share/info
> --with-bugurl=http://bugzilla.redhat.com/bugzilla --enable-shared
> --enable-threads=posix --enable-checking=release --enable-multilib
> --with-system-zlib --enable-__cxa_atexit --disable-libunwind-exceptions
> --enable-gnu-unique-object --enable-linker-build-id
> --with-gcc-major-version-only --with-linker-hash-style=gnu
> --enable-plugin --enable-initfini-array --with-isl --disable-libmpx
> --enable-offload-targets=nvptx-none --without-cuda-driver
> --enable-gnu-indirect-function --enable-cet --with-tune=generic
> --with-arch_32=x86-64 --build=x86_64-redhat-linux
>
> Thread model: posix
>
> gcc version 8.5.0 20210514 (Red Hat 8.5.0-4) (GCC)
>
> we are using ./configure  with default flags  ,  and have the errors below :
>
> make[2]: Entering directory '/root/squid-3.5.28/lib/rfcnb'
>
> depbase=`echo rfcnb-io.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
>
> /bin/sh ../../libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H
> -I../.. -I../../include -I../../lib -I../../src -I../../include
> -I../../lib  -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes
> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT
> -Wall -g -O2 -MT rfcnb-io.lo -MD -MP -MF $depbase.Tpo -c -o rfcnb-io.lo
> rfcnb-io.c &&\
>
> mv -f $depbase.Tpo $depbase.Plo
>
> libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include
> -I../../lib -I../../src -I../../include -I../../lib -Wall
> -Wpointer-arith -Wwrite-strings -Wmissing-prototypes
> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT
> -Wall -g -O2 -MT rfcnb-io.lo -MD -MP -MF .deps/rfcnb-io.Tpo -c
> rfcnb-io.c  -fPIC -DPIC -o .libs/rfcnb-io.o
>
> libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include
> -I../../lib -I../../src -I../../include -I../../lib -Wall
> -Wpointer-arith -Wwrite-strings -Wmissing-prototypes
> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT
> -Wall -g -O2 -MT rfcnb-io.lo -MD -MP -MF .deps/rfcnb-io.Tpo -c
> rfcnb-io.c -o rfcnb-io.o >/dev/null 2>&1
>
> depbase=`echo rfcnb-util.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
>
> /bin/sh ../../libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H
> -I../.. -I../../include -I../../lib -I../../src -I../../include
> -I../../lib  -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes
> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT
> -Wall -g -O2 -MT rfcnb-util.lo -MD -MP -MF $depbase.Tpo -c -o
> rfcnb-util.lo rfcnb-util.c &&\
>
> mv -f $depbase.Tpo $depbase.Plo
>
> libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include
> -I../../lib -I../../src -I../../include -I../../lib -Wall
> -Wpointer-arith -Wwrite-strings -Wmissing-prototypes
> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT
> -Wall -g -O2 -MT rfcnb-util.lo -MD -MP -MF .deps/rfcnb-util.Tpo -c
> rfcnb-util.c  -fPIC -DPIC -o .libs/rfcnb-util.o
>
> libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include
> -I../../lib -I../../src -I../../include -I../../lib -Wall
> -Wpointer-arith -Wwrite-strings -Wmissing-prototypes
> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT
> -Wall -g -O2 -MT rfcnb-util.lo -MD -MP -MF .deps/rfcnb-util.Tpo -c
> rfcnb-util.c -o rfcnb-util.o >/dev/null 2>&1
>
> depbase=`echo session.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
>
> /bin/sh ../../libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H
> -I../.. -I../../include -I../../lib -I../../src -I../../include
> -I../../lib  -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes
> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT
> -Wall -g -O2 -MT session.lo -MD -MP -MF $depbase.Tpo -c -o session.lo
> session.c &&\
>
> mv -f $depbase.Tpo $depbase.Plo
>
> libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include
> -I../../lib -I../../src -I../../include -I../../lib -Wall
> -Wpointer-arith -Wwrite-strings -Wmissing-prototypes
> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT
> -Wall -g -O2 -MT session.lo -MD -MP -MF .deps/session.Tpo -c session.c
> -fPIC -DPIC -o .libs/session.o
>
> libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include
> -I../../lib -I../../src -I../../include -I../../lib -Wall
> -Wpointer-arith -Wwrite-strings -Wmissing-prototypes
> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT
> -Wall -g -O2 -MT session.lo -MD -MP -MF .deps/session.Tpo -c session.c
> -o session.o >/dev/null 2>&1
>
> /bin/sh ../../libtool  --tag=CC   --mode=link gcc -Wall -Wpointer-arith
> -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments
> -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2  -g -o librfcnb.la
> rfcnb-io.lo rfcnb-util.lo session.lo
>
> libtool: link: /usr/bin/ar cru .libs/librfcnb.a .libs/rfcnb-io.o
> .libs/rfcnb-util.o .libs/session.o
>
> libtool: link: ranlib .libs/librfcnb.a
>
> libtool: link: ( cd ".libs" && rm -f "librfcnb.la" && ln -s
> "../librfcnb.la" "librfcnb.la" )
>
> make[2]: Leaving directory '/root/squid-3.5.28/lib/rfcnb'
>
> Making all in smblib
>
> make[2]: Entering directory '/root/squid-3.5.28/lib/smblib'
>
> depbase=`echo md4.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
>
> /bin/sh ../../libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H
> -I../.. -I../../include -I../../lib -I../../src -I../../include
> -I../../lib  -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes
> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT
> -Wall -g -O2 -MT md4.lo -MD -MP -MF $depbase.Tpo -c -o md4.lo md4.c &&\
>
> mv -f $depbase.Tpo $depbase.Plo
>
> libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include
> -I../../lib -I../../src -I../../include -I../../lib -Wall
> -Wpointer-arith -Wwrite-strings -Wmissing-prototypes
> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT
> -Wall -g -O2 -MT md4.lo -MD -MP -MF .deps/md4.Tpo -c md4.c  -fPIC -DPIC
> -o .libs/md4.o
>
> libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include
> -I../../lib -I../../src -I../../include -I../../lib -Wall
> -Wpointer-arith -Wwrite-strings -Wmissing-prototypes
> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT
> -Wall -g -O2 -MT md4.lo -MD -MP -MF .deps/md4.Tpo -c md4.c -o md4.o
>  >/dev/null 2>&1
>
> depbase=`echo smblib.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
>
> /bin/sh ../../libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H
> -I../.. -I../../include -I../../lib -I../../src -I../../include
> -I../../lib  -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes
> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT
> -Wall -g -O2 -MT smblib.lo -MD -MP -MF $depbase.Tpo -c -o smblib.lo
> smblib.c &&\
>
> mv -f $depbase.Tpo $depbase.Plo
>
> libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include
> -I../../lib -I../../src -I../../include -I../../lib -Wall
> -Wpointer-arith -Wwrite-strings -Wmissing-prototypes
> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT
> -Wall -g -O2 -MT smblib.lo -MD -MP -MF .deps/smblib.Tpo -c smblib.c
> -fPIC -DPIC -o .libs/smblib.o
>
> libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include
> -I../../lib -I../../src -I../../include -I../../lib -Wall
> -Wpointer-arith -Wwrite-strings -Wmissing-prototypes
> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT
> -Wall -g -O2 -MT smblib.lo -MD -MP -MF .deps/smblib.Tpo -c smblib.c -o
> smblib.o >/dev/null 2>&1
>
> depbase=`echo smblib-util.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
>
> /bin/sh ../../libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H
> -I../.. -I../../include -I../../lib -I../../src -I../../include
> -I../../lib  -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes
> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT
> -Wall -g -O2 -MT smblib-util.lo -MD -MP -MF $depbase.Tpo -c -o
> smblib-util.lo smblib-util.c &&\
>
> mv -f $depbase.Tpo $depbase.Plo
>
> libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include
> -I../../lib -I../../src -I../../include -I../../lib -Wall
> -Wpointer-arith -Wwrite-strings -Wmissing-prototypes
> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT
> -Wall -g -O2 -MT smblib-util.lo -MD -MP -MF .deps/smblib-util.Tpo -c
> smblib-util.c  -fPIC -DPIC -o .libs/smblib-util.o
>
> smblib-util.c: In function ?SMB_Negotiate?:
>
> smblib-util.c:400:9: error: ?strncpy? output may be truncated copying 79
> bytes from a string of length 79 [-Werror=stringop-truncation]
>
>           strncpy(p, Con_Handle -> Svr_PDom, sizeof(Con_Handle ->
> Svr_PDom) - 1);
>
>
> ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
>
> smblib-util.c:423:9: error: ?strncpy? output may be truncated copying 79
> bytes from a string of length 79 [-Werror=stringop-truncation]
>
>           strncpy(p, Con_Handle -> Svr_PDom, sizeof(Con_Handle ->
> Svr_PDom) - 1);
>
>
>      ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
>
> smblib-util.c: In function ?SMB_TreeConnect?:
>
> smblib-util.c:537:5: error: ?strncpy? specified bound 129 equals
> destination size [-Werror=stringop-truncation]
>
>       strncpy(tree -> path, path, sizeof(tree -> path));
>
>       ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
>
> smblib-util.c:538:5: error: ?strncpy? specified bound 20 equals
> destination size [-Werror=stringop-truncation]
>
>       strncpy(tree -> device_type, device, sizeof(tree -> device_type));
>
>       ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
>
> cc1: all warnings being treated as errors
>
> make[2]: *** [Makefile:776: smblib-util.lo] Error 1
>
> make[2]: Leaving directory '/root/squid-3.5.28/lib/smblib'
>
> make[1]: *** [Makefile:1043: all-recursive] Error 1
>
> make[1]: Leaving directory '/root/squid-3.5.28/lib'
>
> make: *** [Makefile:581: all-recursive] Error 1
>
> Any help is welcome !
>
> Thanks
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220711/74a8f34f/attachment.htm>

From rousskov at measurement-factory.com  Mon Jul 11 17:50:39 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Mon, 11 Jul 2022 13:50:39 -0400
Subject: [squid-users] squid 3.x on Centos8 not working
In-Reply-To: <DBBPR09MB4523F6DC144F2C30260F755EF7879@DBBPR09MB4523.eurprd09.prod.outlook.com>
References: <DBBPR09MB4523CC08514A6EA08BCD3DC2F7B89@DBBPR09MB4523.eurprd09.prod.outlook.com>
 <DBBPR09MB4523AA2581623911DD6C3DCEF7879@DBBPR09MB4523.eurprd09.prod.outlook.com>
 <8423f923-097a-eb37-ddb7-20687c857f72@measurement-factory.com>
 <DBBPR09MB4523F6DC144F2C30260F755EF7879@DBBPR09MB4523.eurprd09.prod.outlook.com>
Message-ID: <a456e5d8-f207-b098-ab97-92579d69d274@measurement-factory.com>

On 7/11/22 13:30, Ahmad Alzaeem wrote:

> I'm not sure if I need to use a lower version compiler on Centos8?

Most likely, you should use a higher version of Squid. Using a lower 
version of OpenSSL might also help, but that would be a step backwords.


> ../../src/ssl/gadgets.h:83:45: error: ?CRYPTO_LOCK_X509? was not 
> declared in this scope

Sounds like bug 4599 -- Squid v3 does not support OpenSSL v1.1:
https://bugs.squid-cache.org/show_bug.cgi?id=4599

Alex.


> 
> typedef LockingPointer<X509, X509_free_cpp, CRYPTO_LOCK_X509> X509_Pointer;
> 
>  ???????????????????????????????????????????? ^~~~~~~~~~~~~~~~
> 
> ../../src/ssl/gadgets.h:83:45: note: suggested alternative: ?CRYPTO_LOCK?
> 
> typedef LockingPointer<X509, X509_free_cpp, CRYPTO_LOCK_X509> X509_Pointer;
> 
>  ???????????????????????????????????????????? ^~~~~~~~~~~~~~~~
> 
>  ???????????????????????????????????????????? CRYPTO_LOCK
> 
> ../../src/ssl/gadgets.h:83:61: error: template argument 3 is invalid
> 
> typedef LockingPointer<X509, X509_free_cpp, CRYPTO_LOCK_X509> X509_Pointer;
> 
>  ???????????????????????????????????????????????????????????? ^
> 
> ../../src/ssl/gadgets.h:89:53: error: ?CRYPTO_LOCK_EVP_PKEY? was not 
> declared in this scope
> 
> typedef LockingPointer<EVP_PKEY, EVP_PKEY_free_cpp, 
> CRYPTO_LOCK_EVP_PKEY> EVP_PKEY_Pointer;
> 
>  ???????????????????????????????????????????????????? ^~~~~~~~~~~~~~~~~~~~
> 
> ../../src/ssl/gadgets.h:89:53: note: suggested alternative: ?CRYPTO_LOCK?
> 
> typedef LockingPointer<EVP_PKEY, EVP_PKEY_free_cpp, 
> CRYPTO_LOCK_EVP_PKEY> EVP_PKEY_Pointer;
> 
>  ???????????????????????????????????????????????????? ^~~~~~~~~~~~~~~~~~~~
> 
>  ???????????????????????????????????????????????????? CRYPTO_LOCK
> 
> ../../src/ssl/gadgets.h:89:73: error: template argument 3 is invalid
> 
> typedef LockingPointer<EVP_PKEY, EVP_PKEY_free_cpp, 
> CRYPTO_LOCK_EVP_PKEY> EVP_PKEY_Pointer;
> 
>  ???????????????????????????????????????????????????????????????????????? ^
> 
> ../../src/ssl/gadgets.h:116:43: error: ?CRYPTO_LOCK_SSL? was not 
> declared in this scope
> 
> typedef LockingPointer<SSL, SSL_free_cpp, CRYPTO_LOCK_SSL> SSL_Pointer;
> 
>  ?????????????????????????????????????????? ^~~~~~~~~~~~~~~
> 
> ../../src/ssl/gadgets.h:116:43: note: suggested alternative: ?CRYPTO_LOCK?
> 
> typedef LockingPointer<SSL, SSL_free_cpp, CRYPTO_LOCK_SSL> SSL_Pointer;
> 
>  ?????????????????????????????????????????? ^~~~~~~~~~~~~~~
> 
>  ?????????????????????????????????????????? CRYPTO_LOCK
> 
> ../../src/ssl/gadgets.h:116:58: error: template argument 3 is invalid
> 
> typedef LockingPointer<SSL, SSL_free_cpp, CRYPTO_LOCK_SSL> SSL_Pointer;
> 
>  ????????????????????????????????????????????????????????? ^
> 
> make[3]: *** [Makefile:803: PortCfg.lo] Error 1
> 
> make[3]: Leaving directory '/root/squid-3.5.25/src/anyp'
> 
> make[2]: *** [Makefile:7498: all-recursive] Error 1
> 
> make[2]: Leaving directory '/root/squid-3.5.25/src'
> 
> make[1]: *** [Makefile:6353: all] Error 2
> 
> make[1]: Leaving directory '/root/squid-3.5.25/src'
> 
> make: *** [Makefile:580: all-recursive] Error 1
> 
> Here is GCC info :
> 
> Using built-in specs.
> 
> COLLECT_GCC=gcc
> 
> COLLECT_LTO_WRAPPER=/usr/libexec/gcc/x86_64-redhat-linux/8/lto-wrapper
> 
> OFFLOAD_TARGET_NAMES=nvptx-none
> 
> OFFLOAD_TARGET_DEFAULT=1
> 
> Target: x86_64-redhat-linux
> 
> Configured with: ../configure --enable-bootstrap 
> --enable-languages=c,c++,fortran,lto --prefix=/usr 
> --mandir=/usr/share/man --infodir=/usr/share/info 
> --with-bugurl=http://bugzilla.redhat.com/bugzilla --enable-shared 
> --enable-threads=posix --enable-checking=release --enable-multilib 
> --with-system-zlib --enable-__cxa_atexit --disable-libunwind-exceptions 
> --enable-gnu-unique-object --enable-linker-build-id 
> --with-gcc-major-version-only --with-linker-hash-style=gnu 
> --enable-plugin --enable-initfini-array --with-isl --disable-libmpx 
> --enable-offload-targets=nvptx-none --without-cuda-driver 
> --enable-gnu-indirect-function --enable-cet --with-tune=generic 
> --with-arch_32=x86-64 --build=x86_64-redhat-linux
> 
> Thread model: posix
> 
> gcc version 8.5.0 20210514 (Red Hat 8.5.0-4) (GCC)
> 
> Also found have openssl and openssl3 installed both on machine :
> 
> 
> openssl version -a
> 
> OpenSSL 1.1.1k? FIPS 25 Mar 2021
> 
> built on: Fri Nov 12 17:53:47 2021 UTC
> 
> platform: linux-x86_64
> 
> options:? bn(64,64) md2(char) rc4(16x,int) des(int) idea(int) blowfish(ptr)
> 
> compiler: gcc -fPIC -pthread -m64 -Wa,--noexecstack -Wall -O3 -O2 -g 
> -pipe -Wall -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 
> -Wp,-D_GLIBCXX_ASSERTIONS -fexceptions -fstack-protector-strong 
> -grecord-gcc-switches -specs=/usr/lib/rpm/redhat/redhat-hardened-cc1 
> -specs=/usr/lib/rpm/redhat/redhat-annobin-cc1 -m64 -mtune=generic 
> -fasynchronous-unwind-tables -fstack-clash-protection -fcf-protection 
> -Wa,--noexecstack -Wa,--generate-missing-build-notes=yes 
> -specs=/usr/lib/rpm/redhat/redhat-hardened-ld -DOPENSSL_USE_NODELETE 
> -DL_ENDIAN -DOPENSSL_PIC -DOPENSSL_CPUID_OBJ -DOPENSSL_IA32_SSE2 
> -DOPENSSL_BN_ASM_MONT -DOPENSSL_BN_ASM_MONT5 -DOPENSSL_BN_ASM_GF2m 
> -DSHA1_ASM -DSHA256_ASM -DSHA512_ASM -DKECCAK1600_ASM -DRC4_ASM 
> -DMD5_ASM -DAESNI_ASM -DVPAES_ASM -DGHASH_ASM -DECP_NISTZ256_ASM 
> -DX25519_ASM -DPOLY1305_ASM -DZLIB -DNDEBUG -DPURIFY 
> -DDEVRANDOM="\"/dev/urandom\"" 
> -DSYSTEM_CIPHERS_FILE="/etc/crypto-policies/back-ends/openssl.config"
> 
> OPENSSLDIR: "/etc/pki/tls"
> 
> ENGINESDIR: "/usr/lib64/engines-1.1"
> 
> Seeding source: os-specific
> 
> engines:? rdrand dynamic
> 
> 
> 
> openssl3 version -a
> 
> OpenSSL 3.0.1 14 Dec 2021 (Library: OpenSSL 3.0.1 14 Dec 2021)
> 
> built on: Wed Mar 16 21:52:03 2022 UTC
> 
> platform: linux-x86_64
> 
> options:? bn(64,64)
> 
> compiler: gcc -fPIC -pthread -m64 -Wa,--noexecstack -Wall -O3 -O2 -g 
> -pipe -Wall -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 
> -Wp,-D_GLIBCXX_ASSERTIONS -fexceptions -fstack-protector-strong 
> -grecord-gcc-switches -specs=/usr/lib/rpm/redhat/redhat-hardened-cc1 
> -specs=/usr/lib/rpm/redhat/redhat-annobin-cc1 -m64 -mtune=generic 
> -fasynchronous-unwind-tables -fstack-clash-protection -fcf-protection 
> -Wa,--noexecstack -Wa,--generate-missing-build-notes=yes 
> -specs=/usr/lib/rpm/redhat/redhat-hardened-ld -DOPENSSL_USE_NODELETE 
> -DL_ENDIAN -DOPENSSL_PIC -DOPENSSL_BUILDING_OPENSSL -DZLIB -DNDEBUG 
> -DPURIFY -DDEVRANDOM="\"/dev/urandom\"" 
> -DREDHAT_FIPS_VERSION="\"3.0.1-20220316\"" 
> -DSYSTEM_CIPHERS_FILE="/etc/crypto-policies/back-ends/openssl.config"
> 
> OPENSSLDIR: "/etc/pki/tls"
> 
> ENGINESDIR: "/usr/lib64/engines-3"
> 
> MODULESDIR: "/usr/lib64/ossl-modules"
> 
> Seeding source: os-specific
> 
> CPUINFO: OPENSSL_ia32cap=0x7ffef3ffffebffff:0x21cbfbb
> 
> Thanks
> 
> *From: *squid-users <squid-users-bounces at lists.squid-cache.org> on 
> behalf of Alex Rousskov <rousskov at measurement-factory.com>
> *Date: *Monday, July 11, 2022 at 10:20 AM
> *To: *squid-users at lists.squid-cache.org <squid-users at lists.squid-cache.org>
> *Subject: *Re: [squid-users] squid 3.x on Centos8 not working
> 
> On 7/11/22 09:38, Ahmad Alzaeem wrote:
> 
>> Anyone in the Dev team to help me out?
> 
> In most cases, folks should not be using Squid v3. It is not a supported
> Squid version.
> 
> You may be able to get your Squid to build by avoiding the -Werror
> compiler flag (e.g., by ./configuring Squid with
> --disable-strict-error-checking).
> 
> 
> HTH,
> 
> Alex.
> 
> 
> 
>> *From: *Ahmad Alzaeem <0xff1f at gmail.com>
>> *Date: *Tuesday, June 28, 2022 at 6:28 AM
>> *To: *squid-users at lists.squid-cache.org <squid-users at lists.squid-cache.org>
>> *Subject: *squid 3.x on Centos8 not working
>> 
>> Hello Folks ,
>> 
>> Trying to compile squid 3.x on Centos8 but have an errors below seems in 
>> SMBLIB .
>> 
>> Squid ver :
>> 
>> squid-3.5.28
>> 
>> GCC ver :
>> 
>> gcc -v
>> 
>> Using built-in specs.
>> 
>> COLLECT_GCC=gcc
>> 
>> COLLECT_LTO_WRAPPER=/usr/libexec/gcc/x86_64-redhat-linux/8/lto-wrapper
>> 
>> OFFLOAD_TARGET_NAMES=nvptx-none
>> 
>> OFFLOAD_TARGET_DEFAULT=1
>> 
>> Target: x86_64-redhat-linux
>> 
>> Configured with: ../configure --enable-bootstrap 
>> --enable-languages=c,c++,fortran,lto --prefix=/usr 
>> --mandir=/usr/share/man --infodir=/usr/share/info 
>> --with-bugurl=http://bugzilla.redhat.com/bugzilla --enable-shared 
>> --enable-threads=posix --enable-checking=release --enable-multilib 
>> --with-system-zlib --enable-__cxa_atexit --disable-libunwind-exceptions 
>> --enable-gnu-unique-object --enable-linker-build-id 
>> --with-gcc-major-version-only --with-linker-hash-style=gnu 
>> --enable-plugin --enable-initfini-array --with-isl --disable-libmpx 
>> --enable-offload-targets=nvptx-none --without-cuda-driver 
>> --enable-gnu-indirect-function --enable-cet --with-tune=generic 
>> --with-arch_32=x86-64 --build=x86_64-redhat-linux
>> 
>> Thread model: posix
>> 
>> gcc version 8.5.0 20210514 (Red Hat 8.5.0-4) (GCC)
>> 
>> we are using ./configure ?with default flags ?, ?and have the errors below :
>> 
>> make[2]: Entering directory '/root/squid-3.5.28/lib/rfcnb'
>> 
>> depbase=`echo rfcnb-io.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
>> 
>> /bin/sh ../../libtool? --tag=CC?? --mode=compile gcc -DHAVE_CONFIG_H   
>> -I../.. -I../../include -I../../lib -I../../src -I../../include    
>> -I../../lib? -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes 
>> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT 
>> -Wall -g -O2 -MT rfcnb-io.lo -MD -MP -MF $depbase.Tpo -c -o rfcnb-io.lo 
>> rfcnb-io.c &&\
>> 
>> mv -f $depbase.Tpo $depbase.Plo
>> 
>> libtool: compile:? gcc -DHAVE_CONFIG_H -I../.. -I../../include 
>> -I../../lib -I../../src -I../../include -I../../lib -Wall 
>> -Wpointer-arith -Wwrite-strings -Wmissing-prototypes 
>> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT 
>> -Wall -g -O2 -MT rfcnb-io.lo -MD -MP -MF .deps/rfcnb-io.Tpo -c 
>> rfcnb-io.c? -fPIC -DPIC -o .libs/rfcnb-io.o
>> 
>> libtool: compile:? gcc -DHAVE_CONFIG_H -I../.. -I../../include 
>> -I../../lib -I../../src -I../../include -I../../lib -Wall 
>> -Wpointer-arith -Wwrite-strings -Wmissing-prototypes 
>> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT 
>> -Wall -g -O2 -MT rfcnb-io.lo -MD -MP -MF .deps/rfcnb-io.Tpo -c 
>> rfcnb-io.c -o rfcnb-io.o >/dev/null 2>&1
>> 
>> depbase=`echo rfcnb-util.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
>> 
>> /bin/sh ../../libtool? --tag=CC?? --mode=compile gcc -DHAVE_CONFIG_H   
>> -I../.. -I../../include -I../../lib -I../../src -I../../include    
>> -I../../lib? -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes 
>> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT 
>> -Wall -g -O2 -MT rfcnb-util.lo -MD -MP -MF $depbase.Tpo -c -o 
>> rfcnb-util.lo rfcnb-util.c &&\
>> 
>> mv -f $depbase.Tpo $depbase.Plo
>> 
>> libtool: compile:? gcc -DHAVE_CONFIG_H -I../.. -I../../include 
>> -I../../lib -I../../src -I../../include -I../../lib -Wall 
>> -Wpointer-arith -Wwrite-strings -Wmissing-prototypes 
>> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT 
>> -Wall -g -O2 -MT rfcnb-util.lo -MD -MP -MF .deps/rfcnb-util.Tpo -c 
>> rfcnb-util.c? -fPIC -DPIC -o .libs/rfcnb-util.o
>> 
>> libtool: compile:? gcc -DHAVE_CONFIG_H -I../.. -I../../include 
>> -I../../lib -I../../src -I../../include -I../../lib -Wall 
>> -Wpointer-arith -Wwrite-strings -Wmissing-prototypes 
>> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT 
>> -Wall -g -O2 -MT rfcnb-util.lo -MD -MP -MF .deps/rfcnb-util.Tpo -c 
>> rfcnb-util.c -o rfcnb-util.o >/dev/null 2>&1
>> 
>> depbase=`echo session.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
>> 
>> /bin/sh ../../libtool? --tag=CC?? --mode=compile gcc -DHAVE_CONFIG_H   
>> -I../.. -I../../include -I../../lib -I../../src -I../../include    
>> -I../../lib? -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes 
>> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT 
>> -Wall -g -O2 -MT session.lo -MD -MP -MF $depbase.Tpo -c -o session.lo 
>> session.c &&\
>> 
>> mv -f $depbase.Tpo $depbase.Plo
>> 
>> libtool: compile:? gcc -DHAVE_CONFIG_H -I../.. -I../../include 
>> -I../../lib -I../../src -I../../include -I../../lib -Wall 
>> -Wpointer-arith -Wwrite-strings -Wmissing-prototypes 
>> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT 
>> -Wall -g -O2 -MT session.lo -MD -MP -MF .deps/session.Tpo -c session.c  
>> -fPIC -DPIC -o .libs/session.o
>> 
>> libtool: compile:? gcc -DHAVE_CONFIG_H -I../.. -I../../include 
>> -I../../lib -I../../src -I../../include -I../../lib -Wall 
>> -Wpointer-arith -Wwrite-strings -Wmissing-prototypes 
>> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT 
>> -Wall -g -O2 -MT session.lo -MD -MP -MF .deps/session.Tpo -c session.c 
>> -o session.o >/dev/null 2>&1
>> 
>> /bin/sh ../../libtool? --tag=CC?? --mode=link gcc -Wall -Wpointer-arith 
>> -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments 
>> -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2? -g -o librfcnb.la 
>> rfcnb-io.lo rfcnb-util.lo session.lo
>> 
>> libtool: link: /usr/bin/ar cru .libs/librfcnb.a .libs/rfcnb-io.o 
>> .libs/rfcnb-util.o .libs/session.o
>> 
>> libtool: link: ranlib .libs/librfcnb.a
>> 
>> libtool: link: ( cd ".libs" && rm -f "librfcnb.la" && ln -s 
>> "../librfcnb.la" "librfcnb.la" )
>> 
>> make[2]: Leaving directory '/root/squid-3.5.28/lib/rfcnb'
>> 
>> Making all in smblib
>> 
>> make[2]: Entering directory '/root/squid-3.5.28/lib/smblib'
>> 
>> depbase=`echo md4.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
>> 
>> /bin/sh ../../libtool? --tag=CC?? --mode=compile gcc -DHAVE_CONFIG_H   
>> -I../.. -I../../include -I../../lib -I../../src -I../../include    
>> -I../../lib? -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes 
>> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT 
>> -Wall -g -O2 -MT md4.lo -MD -MP -MF $depbase.Tpo -c -o md4.lo md4.c &&\
>> 
>> mv -f $depbase.Tpo $depbase.Plo
>> 
>> libtool: compile:? gcc -DHAVE_CONFIG_H -I../.. -I../../include 
>> -I../../lib -I../../src -I../../include -I../../lib -Wall 
>> -Wpointer-arith -Wwrite-strings -Wmissing-prototypes 
>> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT 
>> -Wall -g -O2 -MT md4.lo -MD -MP -MF .deps/md4.Tpo -c md4.c? -fPIC -DPIC 
>> -o .libs/md4.o
>> 
>> libtool: compile:? gcc -DHAVE_CONFIG_H -I../.. -I../../include 
>> -I../../lib -I../../src -I../../include -I../../lib -Wall 
>> -Wpointer-arith -Wwrite-strings -Wmissing-prototypes 
>> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT 
>> -Wall -g -O2 -MT md4.lo -MD -MP -MF .deps/md4.Tpo -c md4.c -o md4.o 
>>? >/dev/null 2>&1
>> 
>> depbase=`echo smblib.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
>> 
>> /bin/sh ../../libtool? --tag=CC?? --mode=compile gcc -DHAVE_CONFIG_H   
>> -I../.. -I../../include -I../../lib -I../../src -I../../include    
>> -I../../lib? -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes 
>> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT 
>> -Wall -g -O2 -MT smblib.lo -MD -MP -MF $depbase.Tpo -c -o smblib.lo 
>> smblib.c &&\
>> 
>> mv -f $depbase.Tpo $depbase.Plo
>> 
>> libtool: compile:? gcc -DHAVE_CONFIG_H -I../.. -I../../include 
>> -I../../lib -I../../src -I../../include -I../../lib -Wall 
>> -Wpointer-arith -Wwrite-strings -Wmissing-prototypes 
>> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT 
>> -Wall -g -O2 -MT smblib.lo -MD -MP -MF .deps/smblib.Tpo -c smblib.c  
>> -fPIC -DPIC -o .libs/smblib.o
>> 
>> libtool: compile:? gcc -DHAVE_CONFIG_H -I../.. -I../../include 
>> -I../../lib -I../../src -I../../include -I../../lib -Wall 
>> -Wpointer-arith -Wwrite-strings -Wmissing-prototypes 
>> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT 
>> -Wall -g -O2 -MT smblib.lo -MD -MP -MF .deps/smblib.Tpo -c smblib.c -o 
>> smblib.o >/dev/null 2>&1
>> 
>> depbase=`echo smblib-util.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
>> 
>> /bin/sh ../../libtool? --tag=CC?? --mode=compile gcc -DHAVE_CONFIG_H   
>> -I../.. -I../../include -I../../lib -I../../src -I../../include    
>> -I../../lib? -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes 
>> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT 
>> -Wall -g -O2 -MT smblib-util.lo -MD -MP -MF $depbase.Tpo -c -o 
>> smblib-util.lo smblib-util.c &&\
>> 
>> mv -f $depbase.Tpo $depbase.Plo
>> 
>> libtool: compile:? gcc -DHAVE_CONFIG_H -I../.. -I../../include 
>> -I../../lib -I../../src -I../../include -I../../lib -Wall 
>> -Wpointer-arith -Wwrite-strings -Wmissing-prototypes 
>> -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT 
>> -Wall -g -O2 -MT smblib-util.lo -MD -MP -MF .deps/smblib-util.Tpo -c 
>> smblib-util.c? -fPIC -DPIC -o .libs/smblib-util.o
>> 
>> smblib-util.c: In function ?SMB_Negotiate?:
>> 
>> smblib-util.c:400:9: error: ?strncpy? output may be truncated copying 79 
>> bytes from a string of length 79 [-Werror=stringop-truncation]
>> 
>>? ???????? strncpy(p, Con_Handle -> Svr_PDom, sizeof(Con_Handle -> 
>> Svr_PDom) - 1);
>> 
>>           
>> ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
>> 
>> smblib-util.c:423:9: error: ?strncpy? output may be truncated copying 79 
>> bytes from a string of length 79 [-Werror=stringop-truncation]
>> 
>>? ???????? strncpy(p, Con_Handle -> Svr_PDom, sizeof(Con_Handle -> 
>> Svr_PDom) - 1);
>> 
>>       
>>? ????^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
>> 
>> smblib-util.c: In function ?SMB_TreeConnect?:
>> 
>> smblib-util.c:537:5: error: ?strncpy? specified bound 129 equals 
>> destination size [-Werror=stringop-truncation]
>> 
>>? ???? strncpy(tree -> path, path, sizeof(tree -> path));
>> 
>>? ???? ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
>> 
>> smblib-util.c:538:5: error: ?strncpy? specified bound 20 equals 
>> destination size [-Werror=stringop-truncation]
>> 
>>? ???? strncpy(tree -> device_type, device, sizeof(tree -> device_type));
>> 
>>? ???? ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
>> 
>> cc1: all warnings being treated as errors
>> 
>> make[2]: *** [Makefile:776: smblib-util.lo] Error 1
>> 
>> make[2]: Leaving directory '/root/squid-3.5.28/lib/smblib'
>> 
>> make[1]: *** [Makefile:1043: all-recursive] Error 1
>> 
>> make[1]: Leaving directory '/root/squid-3.5.28/lib'
>> 
>> make: *** [Makefile:581: all-recursive] Error 1
>> 
>> Any help is welcome !
>> 
>> Thanks
>> 
>> 
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users 
> <http://lists.squid-cache.org/listinfo/squid-users>
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users 
> <http://lists.squid-cache.org/listinfo/squid-users>
> 



From ngtech1ltd at gmail.com  Mon Jul 11 19:37:27 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Mon, 11 Jul 2022 22:37:27 +0300
Subject: [squid-users] squid 3.x on Centos8 not working
In-Reply-To: <DBBPR09MB4523CC08514A6EA08BCD3DC2F7B89@DBBPR09MB4523.eurprd09.prod.outlook.com>
References: <DBBPR09MB4523CC08514A6EA08BCD3DC2F7B89@DBBPR09MB4523.eurprd09.prod.outlook.com>
Message-ID: <004401d8955d$a7c98a50$f75c9ef0$@gmail.com>

Hey Ahmad,
 
What is preventing you from using 4.x or 5.x?
 
Eliezer
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email:  <mailto:ngtech1ltd at gmail.com> ngtech1ltd at gmail.com
Web:  <https://ngtech.co.il/> https://ngtech.co.il/
My-Tube:  <https://tube.ngtech.co.il/> https://tube.ngtech.co.il/
 
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Ahmad Alzaeem
Sent: Tuesday, 28 June 2022 16:29
To: squid-users at lists.squid-cache.org
Subject: [squid-users] squid 3.x on Centos8 not working
 
 
Hello Folks ,
 
Trying to compile squid 3.x on Centos8 but have an errors below seems in SMBLIB .
 
Squid ver :
squid-3.5.28
 
GCC ver :
 
gcc -v
Using built-in specs.
COLLECT_GCC=gcc
COLLECT_LTO_WRAPPER=/usr/libexec/gcc/x86_64-redhat-linux/8/lto-wrapper
OFFLOAD_TARGET_NAMES=nvptx-none
OFFLOAD_TARGET_DEFAULT=1
Target: x86_64-redhat-linux
Configured with: ../configure --enable-bootstrap --enable-languages=c,c++,fortran,lto --prefix=/usr --mandir=/usr/share/man --infodir=/usr/share/info --with-bugurl=http://bugzilla.redhat.com/bugzilla --enable-shared --enable-threads=posix --enable-checking=release --enable-multilib --with-system-zlib --enable-__cxa_atexit --disable-libunwind-exceptions --enable-gnu-unique-object --enable-linker-build-id --with-gcc-major-version-only --with-linker-hash-style=gnu --enable-plugin --enable-initfini-array --with-isl --disable-libmpx --enable-offload-targets=nvptx-none --without-cuda-driver --enable-gnu-indirect-function --enable-cet --with-tune=generic --with-arch_32=x86-64 --build=x86_64-redhat-linux
Thread model: posix
gcc version 8.5.0 20210514 (Red Hat 8.5.0-4) (GCC)
 
we are using ./configure  with default flags  ,  and have the errors below :
 
 
make[2]: Entering directory '/root/squid-3.5.28/lib/rfcnb'
depbase=`echo rfcnb-io.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
/bin/sh ../../libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H   -I../.. -I../../include -I../../lib -I../../src -I../../include    -I../../lib  -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT rfcnb-io.lo -MD -MP -MF $depbase.Tpo -c -o rfcnb-io.lo rfcnb-io.c &&\
mv -f $depbase.Tpo $depbase.Plo
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT rfcnb-io.lo -MD -MP -MF .deps/rfcnb-io.Tpo -c rfcnb-io.c  -fPIC -DPIC -o .libs/rfcnb-io.o
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT rfcnb-io.lo -MD -MP -MF .deps/rfcnb-io.Tpo -c rfcnb-io.c -o rfcnb-io.o >/dev/null 2>&1
depbase=`echo rfcnb-util.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
/bin/sh ../../libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H   -I../.. -I../../include -I../../lib -I../../src -I../../include    -I../../lib  -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT rfcnb-util.lo -MD -MP -MF $depbase.Tpo -c -o rfcnb-util.lo rfcnb-util.c &&\
mv -f $depbase.Tpo $depbase.Plo
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT rfcnb-util.lo -MD -MP -MF .deps/rfcnb-util.Tpo -c rfcnb-util.c  -fPIC -DPIC -o .libs/rfcnb-util.o
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT rfcnb-util.lo -MD -MP -MF .deps/rfcnb-util.Tpo -c rfcnb-util.c -o rfcnb-util.o >/dev/null 2>&1
depbase=`echo session.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
/bin/sh ../../libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H   -I../.. -I../../include -I../../lib -I../../src -I../../include    -I../../lib  -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT session.lo -MD -MP -MF $depbase.Tpo -c -o session.lo session.c &&\
mv -f $depbase.Tpo $depbase.Plo
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT session.lo -MD -MP -MF .deps/session.Tpo -c session.c  -fPIC -DPIC -o .libs/session.o
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT session.lo -MD -MP -MF .deps/session.Tpo -c session.c -o session.o >/dev/null 2>&1
/bin/sh ../../libtool  --tag=CC   --mode=link gcc -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2  -g -o librfcnb.la  rfcnb-io.lo rfcnb-util.lo session.lo  
libtool: link: /usr/bin/ar cru .libs/librfcnb.a .libs/rfcnb-io.o .libs/rfcnb-util.o .libs/session.o 
libtool: link: ranlib .libs/librfcnb.a
libtool: link: ( cd ".libs" && rm -f "librfcnb.la" && ln -s "../librfcnb.la" "librfcnb.la" )
make[2]: Leaving directory '/root/squid-3.5.28/lib/rfcnb'
Making all in smblib
make[2]: Entering directory '/root/squid-3.5.28/lib/smblib'
depbase=`echo md4.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
/bin/sh ../../libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H   -I../.. -I../../include -I../../lib -I../../src -I../../include    -I../../lib  -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT md4.lo -MD -MP -MF $depbase.Tpo -c -o md4.lo md4.c &&\
mv -f $depbase.Tpo $depbase.Plo
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT md4.lo -MD -MP -MF .deps/md4.Tpo -c md4.c  -fPIC -DPIC -o .libs/md4.o
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT md4.lo -MD -MP -MF .deps/md4.Tpo -c md4.c -o md4.o >/dev/null 2>&1
depbase=`echo smblib.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
/bin/sh ../../libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H   -I../.. -I../../include -I../../lib -I../../src -I../../include    -I../../lib  -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT smblib.lo -MD -MP -MF $depbase.Tpo -c -o smblib.lo smblib.c &&\
mv -f $depbase.Tpo $depbase.Plo
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT smblib.lo -MD -MP -MF .deps/smblib.Tpo -c smblib.c  -fPIC -DPIC -o .libs/smblib.o
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT smblib.lo -MD -MP -MF .deps/smblib.Tpo -c smblib.c -o smblib.o >/dev/null 2>&1
depbase=`echo smblib-util.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
/bin/sh ../../libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H   -I../.. -I../../include -I../../lib -I../../src -I../../include    -I../../lib  -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT smblib-util.lo -MD -MP -MF $depbase.Tpo -c -o smblib-util.lo smblib-util.c &&\
mv -f $depbase.Tpo $depbase.Plo
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT smblib-util.lo -MD -MP -MF .deps/smblib-util.Tpo -c smblib-util.c  -fPIC -DPIC -o .libs/smblib-util.o
smblib-util.c: In function ?SMB_Negotiate?:
smblib-util.c:400:9: error: ?strncpy? output may be truncated copying 79 bytes from a string of length 79 [-Werror=stringop-truncation]
         strncpy(p, Con_Handle -> Svr_PDom, sizeof(Con_Handle -> Svr_PDom) - 1);
         ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
smblib-util.c:423:9: error: ?strncpy? output may be truncated copying 79 bytes from a string of length 79 [-Werror=stringop-truncation]
         strncpy(p, Con_Handle -> Svr_PDom, sizeof(Con_Handle -> Svr_PDom) - 1);
         ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
smblib-util.c: In function ?SMB_TreeConnect?:
smblib-util.c:537:5: error: ?strncpy? specified bound 129 equals destination size [-Werror=stringop-truncation]
     strncpy(tree -> path, path, sizeof(tree -> path));
     ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
smblib-util.c:538:5: error: ?strncpy? specified bound 20 equals destination size [-Werror=stringop-truncation]
     strncpy(tree -> device_type, device, sizeof(tree -> device_type));
     ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
cc1: all warnings being treated as errors
make[2]: *** [Makefile:776: smblib-util.lo] Error 1
make[2]: Leaving directory '/root/squid-3.5.28/lib/smblib'
make[1]: *** [Makefile:1043: all-recursive] Error 1
make[1]: Leaving directory '/root/squid-3.5.28/lib'
make: *** [Makefile:581: all-recursive] Error 1
 
Any help is welcome !
Thanks 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220711/71b4ea14/attachment.htm>

From 0xff1f at gmail.com  Mon Jul 11 19:53:28 2022
From: 0xff1f at gmail.com (Ahmad Alzaeem)
Date: Mon, 11 Jul 2022 19:53:28 +0000
Subject: [squid-users] squid 3.x on Centos8 not working
In-Reply-To: <004401d8955d$a7c98a50$f75c9ef0$@gmail.com>
References: <DBBPR09MB4523CC08514A6EA08BCD3DC2F7B89@DBBPR09MB4523.eurprd09.prod.outlook.com>
 <004401d8955d$a7c98a50$f75c9ef0$@gmail.com>
Message-ID: <DBBPR09MB452330F3747C62DAE0F57A4BF7879@DBBPR09MB4523.eurprd09.prod.outlook.com>

None of squid4.x support delay pools .

Squid5.x is full of bugs with DNS IPV4/IPV6 Because of the eyeball feature.

Thanks


From: squid-users <squid-users-bounces at lists.squid-cache.org> on behalf of ngtech1ltd at gmail.com <ngtech1ltd at gmail.com>
Date: Monday, July 11, 2022 at 12:37 PM
To: squid-users at lists.squid-cache.org <squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] squid 3.x on Centos8 not working
Hey Ahmad,

What is preventing you from using 4.x or 5.x?

Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com<mailto:ngtech1ltd at gmail.com>
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/

From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Ahmad Alzaeem
Sent: Tuesday, 28 June 2022 16:29
To: squid-users at lists.squid-cache.org
Subject: [squid-users] squid 3.x on Centos8 not working


Hello Folks ,

Trying to compile squid 3.x on Centos8 but have an errors below seems in SMBLIB .

Squid ver :
squid-3.5.28

GCC ver :

gcc -v
Using built-in specs.
COLLECT_GCC=gcc
COLLECT_LTO_WRAPPER=/usr/libexec/gcc/x86_64-redhat-linux/8/lto-wrapper
OFFLOAD_TARGET_NAMES=nvptx-none
OFFLOAD_TARGET_DEFAULT=1
Target: x86_64-redhat-linux
Configured with: ../configure --enable-bootstrap --enable-languages=c,c++,fortran,lto --prefix=/usr --mandir=/usr/share/man --infodir=/usr/share/info --with-bugurl=http://bugzilla.redhat.com/bugzilla --enable-shared --enable-threads=posix --enable-checking=release --enable-multilib --with-system-zlib --enable-__cxa_atexit --disable-libunwind-exceptions --enable-gnu-unique-object --enable-linker-build-id --with-gcc-major-version-only --with-linker-hash-style=gnu --enable-plugin --enable-initfini-array --with-isl --disable-libmpx --enable-offload-targets=nvptx-none --without-cuda-driver --enable-gnu-indirect-function --enable-cet --with-tune=generic --with-arch_32=x86-64 --build=x86_64-redhat-linux
Thread model: posix
gcc version 8.5.0 20210514 (Red Hat 8.5.0-4) (GCC)

we are using ./configure  with default flags  ,  and have the errors below :


make[2]: Entering directory '/root/squid-3.5.28/lib/rfcnb'
depbase=`echo rfcnb-io.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
/bin/sh ../../libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H   -I../.. -I../../include -I../../lib -I../../src -I../../include    -I../../lib  -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT rfcnb-io.lo -MD -MP -MF $depbase.Tpo -c -o rfcnb-io.lo rfcnb-io.c &&\
mv -f $depbase.Tpo $depbase.Plo
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT rfcnb-io.lo -MD -MP -MF .deps/rfcnb-io.Tpo -c rfcnb-io.c  -fPIC -DPIC -o .libs/rfcnb-io.o
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT rfcnb-io.lo -MD -MP -MF .deps/rfcnb-io.Tpo -c rfcnb-io.c -o rfcnb-io.o >/dev/null 2>&1
depbase=`echo rfcnb-util.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
/bin/sh ../../libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H   -I../.. -I../../include -I../../lib -I../../src -I../../include    -I../../lib  -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT rfcnb-util.lo -MD -MP -MF $depbase.Tpo -c -o rfcnb-util.lo rfcnb-util.c &&\
mv -f $depbase.Tpo $depbase.Plo
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT rfcnb-util.lo -MD -MP -MF .deps/rfcnb-util.Tpo -c rfcnb-util.c  -fPIC -DPIC -o .libs/rfcnb-util.o
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT rfcnb-util.lo -MD -MP -MF .deps/rfcnb-util.Tpo -c rfcnb-util.c -o rfcnb-util.o >/dev/null 2>&1
depbase=`echo session.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
/bin/sh ../../libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H   -I../.. -I../../include -I../../lib -I../../src -I../../include    -I../../lib  -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT session.lo -MD -MP -MF $depbase.Tpo -c -o session.lo session.c &&\
mv -f $depbase.Tpo $depbase.Plo
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT session.lo -MD -MP -MF .deps/session.Tpo -c session.c  -fPIC -DPIC -o .libs/session.o
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT session.lo -MD -MP -MF .deps/session.Tpo -c session.c -o session.o >/dev/null 2>&1
/bin/sh ../../libtool  --tag=CC   --mode=link gcc -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2  -g -o librfcnb.la  rfcnb-io.lo rfcnb-util.lo session.lo
libtool: link: /usr/bin/ar cru .libs/librfcnb.a .libs/rfcnb-io.o .libs/rfcnb-util.o .libs/session.o
libtool: link: ranlib .libs/librfcnb.a
libtool: link: ( cd ".libs" && rm -f "librfcnb.la" && ln -s "../librfcnb.la" "librfcnb.la" )
make[2]: Leaving directory '/root/squid-3.5.28/lib/rfcnb'
Making all in smblib
make[2]: Entering directory '/root/squid-3.5.28/lib/smblib'
depbase=`echo md4.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
/bin/sh ../../libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H   -I../.. -I../../include -I../../lib -I../../src -I../../include    -I../../lib  -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT md4.lo -MD -MP -MF $depbase.Tpo -c -o md4.lo md4.c &&\
mv -f $depbase.Tpo $depbase.Plo
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT md4.lo -MD -MP -MF .deps/md4.Tpo -c md4.c  -fPIC -DPIC -o .libs/md4.o
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT md4.lo -MD -MP -MF .deps/md4.Tpo -c md4.c -o md4.o >/dev/null 2>&1
depbase=`echo smblib.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
/bin/sh ../../libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H   -I../.. -I../../include -I../../lib -I../../src -I../../include    -I../../lib  -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT smblib.lo -MD -MP -MF $depbase.Tpo -c -o smblib.lo smblib.c &&\
mv -f $depbase.Tpo $depbase.Plo
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT smblib.lo -MD -MP -MF .deps/smblib.Tpo -c smblib.c  -fPIC -DPIC -o .libs/smblib.o
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT smblib.lo -MD -MP -MF .deps/smblib.Tpo -c smblib.c -o smblib.o >/dev/null 2>&1
depbase=`echo smblib-util.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
/bin/sh ../../libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H   -I../.. -I../../include -I../../lib -I../../src -I../../include    -I../../lib  -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT smblib-util.lo -MD -MP -MF $depbase.Tpo -c -o smblib-util.lo smblib-util.c &&\
mv -f $depbase.Tpo $depbase.Plo
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT smblib-util.lo -MD -MP -MF .deps/smblib-util.Tpo -c smblib-util.c  -fPIC -DPIC -o .libs/smblib-util.o
smblib-util.c: In function ?SMB_Negotiate?:
smblib-util.c:400:9: error: ?strncpy? output may be truncated copying 79 bytes from a string of length 79 [-Werror=stringop-truncation]
         strncpy(p, Con_Handle -> Svr_PDom, sizeof(Con_Handle -> Svr_PDom) - 1);
         ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
smblib-util.c:423:9: error: ?strncpy? output may be truncated copying 79 bytes from a string of length 79 [-Werror=stringop-truncation]
         strncpy(p, Con_Handle -> Svr_PDom, sizeof(Con_Handle -> Svr_PDom) - 1);
         ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
smblib-util.c: In function ?SMB_TreeConnect?:
smblib-util.c:537:5: error: ?strncpy? specified bound 129 equals destination size [-Werror=stringop-truncation]
     strncpy(tree -> path, path, sizeof(tree -> path));
     ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
smblib-util.c:538:5: error: ?strncpy? specified bound 20 equals destination size [-Werror=stringop-truncation]
     strncpy(tree -> device_type, device, sizeof(tree -> device_type));
     ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
cc1: all warnings being treated as errors
make[2]: *** [Makefile:776: smblib-util.lo] Error 1
make[2]: Leaving directory '/root/squid-3.5.28/lib/smblib'
make[1]: *** [Makefile:1043: all-recursive] Error 1
make[1]: Leaving directory '/root/squid-3.5.28/lib'
make: *** [Makefile:581: all-recursive] Error 1

Any help is welcome !
Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220711/b425ce54/attachment.htm>

From ngtech1ltd at gmail.com  Mon Jul 11 20:55:31 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Mon, 11 Jul 2022 23:55:31 +0300
Subject: [squid-users] squid 3.x on Centos8 not working
In-Reply-To: <DBBPR09MB452330F3747C62DAE0F57A4BF7879@DBBPR09MB4523.eurprd09.prod.outlook.com>
References: <DBBPR09MB4523CC08514A6EA08BCD3DC2F7B89@DBBPR09MB4523.eurprd09.prod.outlook.com>
 <004401d8955d$a7c98a50$f75c9ef0$@gmail.com>
 <DBBPR09MB452330F3747C62DAE0F57A4BF7879@DBBPR09MB4523.eurprd09.prod.outlook.com>
Message-ID: <005301d89568$90103bb0$b030b310$@gmail.com>

Hey Ahmad,
 
I really don?t know what to say.
I am not using delay pools so I cannot say anything about that.
 
About DNS IPV4/IPV6 I am not sure what you are referring to.
Can you please refer me to the bug report on these?
It should be testable.
I have not seen anything about this in my environment until now so I am pretty confused.
 
Thanks,
Eliezer
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email:  <mailto:ngtech1ltd at gmail.com> ngtech1ltd at gmail.com
Web:  <https://ngtech.co.il/> https://ngtech.co.il/
My-Tube:  <https://tube.ngtech.co.il/> https://tube.ngtech.co.il/
 
From: Ahmad Alzaeem <0xff1f at gmail.com> 
Sent: Monday, 11 July 2022 22:53
To: ngtech1ltd at gmail.com; squid-users at lists.squid-cache.org
Subject: Re: [squid-users] squid 3.x on Centos8 not working
 
None of squid4.x support delay pools .
 
Squid5.x is full of bugs with DNS IPV4/IPV6 Because of the eyeball feature.
 
Thanks 
 
 
From: squid-users <squid-users-bounces at lists.squid-cache.org <mailto:squid-users-bounces at lists.squid-cache.org> > on behalf of ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com>  <ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> >
Date: Monday, July 11, 2022 at 12:37 PM
To: squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org>  <squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> >
Subject: Re: [squid-users] squid 3.x on Centos8 not working
Hey Ahmad,
 
What is preventing you from using 4.x or 5.x?
 
Eliezer
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email:  <mailto:ngtech1ltd at gmail.com> ngtech1ltd at gmail.com
Web:  <https://ngtech.co.il/> https://ngtech.co.il/
My-Tube:  <https://tube.ngtech.co.il/> https://tube.ngtech.co.il/
 
From: squid-users <squid-users-bounces at lists.squid-cache.org <mailto:squid-users-bounces at lists.squid-cache.org> > On Behalf Of Ahmad Alzaeem
Sent: Tuesday, 28 June 2022 16:29
To: squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> 
Subject: [squid-users] squid 3.x on Centos8 not working
 
 
Hello Folks ,
 
Trying to compile squid 3.x on Centos8 but have an errors below seems in SMBLIB .
 
Squid ver :
squid-3.5.28
 
GCC ver :
 
gcc -v
Using built-in specs.
COLLECT_GCC=gcc
COLLECT_LTO_WRAPPER=/usr/libexec/gcc/x86_64-redhat-linux/8/lto-wrapper
OFFLOAD_TARGET_NAMES=nvptx-none
OFFLOAD_TARGET_DEFAULT=1
Target: x86_64-redhat-linux
Configured with: ../configure --enable-bootstrap --enable-languages=c,c++,fortran,lto --prefix=/usr --mandir=/usr/share/man --infodir=/usr/share/info --with-bugurl=http://bugzilla.redhat.com/bugzilla --enable-shared --enable-threads=posix --enable-checking=release --enable-multilib --with-system-zlib --enable-__cxa_atexit --disable-libunwind-exceptions --enable-gnu-unique-object --enable-linker-build-id --with-gcc-major-version-only --with-linker-hash-style=gnu --enable-plugin --enable-initfini-array --with-isl --disable-libmpx --enable-offload-targets=nvptx-none --without-cuda-driver --enable-gnu-indirect-function --enable-cet --with-tune=generic --with-arch_32=x86-64 --build=x86_64-redhat-linux
Thread model: posix
gcc version 8.5.0 20210514 (Red Hat 8.5.0-4) (GCC)
 
we are using ./configure  with default flags  ,  and have the errors below :
 
 
make[2]: Entering directory '/root/squid-3.5.28/lib/rfcnb'
depbase=`echo rfcnb-io.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
/bin/sh ../../libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H   -I../.. -I../../include -I../../lib -I../../src -I../../include    -I../../lib  -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT rfcnb-io.lo -MD -MP -MF $depbase.Tpo -c -o rfcnb-io.lo rfcnb-io.c &&\
mv -f $depbase.Tpo $depbase.Plo
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT rfcnb-io.lo -MD -MP -MF .deps/rfcnb-io.Tpo -c rfcnb-io.c  -fPIC -DPIC -o .libs/rfcnb-io.o
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT rfcnb-io.lo -MD -MP -MF .deps/rfcnb-io.Tpo -c rfcnb-io.c -o rfcnb-io.o >/dev/null 2>&1
depbase=`echo rfcnb-util.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
/bin/sh ../../libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H   -I../.. -I../../include -I../../lib -I../../src -I../../include    -I../../lib  -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT rfcnb-util.lo -MD -MP -MF $depbase.Tpo -c -o rfcnb-util.lo rfcnb-util.c &&\
mv -f $depbase.Tpo $depbase.Plo
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT rfcnb-util.lo -MD -MP -MF .deps/rfcnb-util.Tpo -c rfcnb-util.c  -fPIC -DPIC -o .libs/rfcnb-util.o
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT rfcnb-util.lo -MD -MP -MF .deps/rfcnb-util.Tpo -c rfcnb-util.c -o rfcnb-util.o >/dev/null 2>&1
depbase=`echo session.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
/bin/sh ../../libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H   -I../.. -I../../include -I../../lib -I../../src -I../../include    -I../../lib  -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT session.lo -MD -MP -MF $depbase.Tpo -c -o session.lo session.c &&\
mv -f $depbase.Tpo $depbase.Plo
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT session.lo -MD -MP -MF .deps/session.Tpo -c session.c  -fPIC -DPIC -o .libs/session.o
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT session.lo -MD -MP -MF .deps/session.Tpo -c session.c -o session.o >/dev/null 2>&1
/bin/sh ../../libtool  --tag=CC   --mode=link gcc -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2  -g -o librfcnb.la  rfcnb-io.lo rfcnb-util.lo session.lo  
libtool: link: /usr/bin/ar cru .libs/librfcnb.a .libs/rfcnb-io.o .libs/rfcnb-util.o .libs/session.o 
libtool: link: ranlib .libs/librfcnb.a
libtool: link: ( cd ".libs" && rm -f "librfcnb.la" && ln -s "../librfcnb.la" "librfcnb.la" )
make[2]: Leaving directory '/root/squid-3.5.28/lib/rfcnb'
Making all in smblib
make[2]: Entering directory '/root/squid-3.5.28/lib/smblib'
depbase=`echo md4.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
/bin/sh ../../libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H   -I../.. -I../../include -I../../lib -I../../src -I../../include    -I../../lib  -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT md4.lo -MD -MP -MF $depbase.Tpo -c -o md4.lo md4.c &&\
mv -f $depbase.Tpo $depbase.Plo
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT md4.lo -MD -MP -MF .deps/md4.Tpo -c md4.c  -fPIC -DPIC -o .libs/md4.o
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT md4.lo -MD -MP -MF .deps/md4.Tpo -c md4.c -o md4.o >/dev/null 2>&1
depbase=`echo smblib.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
/bin/sh ../../libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H   -I../.. -I../../include -I../../lib -I../../src -I../../include    -I../../lib  -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT smblib.lo -MD -MP -MF $depbase.Tpo -c -o smblib.lo smblib.c &&\
mv -f $depbase.Tpo $depbase.Plo
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT smblib.lo -MD -MP -MF .deps/smblib.Tpo -c smblib.c  -fPIC -DPIC -o .libs/smblib.o
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT smblib.lo -MD -MP -MF .deps/smblib.Tpo -c smblib.c -o smblib.o >/dev/null 2>&1
depbase=`echo smblib-util.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
/bin/sh ../../libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H   -I../.. -I../../include -I../../lib -I../../src -I../../include    -I../../lib  -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT smblib-util.lo -MD -MP -MF $depbase.Tpo -c -o smblib-util.lo smblib-util.c &&\
mv -f $depbase.Tpo $depbase.Plo
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT smblib-util.lo -MD -MP -MF .deps/smblib-util.Tpo -c smblib-util.c  -fPIC -DPIC -o .libs/smblib-util.o
smblib-util.c: In function ?SMB_Negotiate?:
smblib-util.c:400:9: error: ?strncpy? output may be truncated copying 79 bytes from a string of length 79 [-Werror=stringop-truncation]
         strncpy(p, Con_Handle -> Svr_PDom, sizeof(Con_Handle -> Svr_PDom) - 1);
         ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
smblib-util.c:423:9: error: ?strncpy? output may be truncated copying 79 bytes from a string of length 79 [-Werror=stringop-truncation]
         strncpy(p, Con_Handle -> Svr_PDom, sizeof(Con_Handle -> Svr_PDom) - 1);
         ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
smblib-util.c: In function ?SMB_TreeConnect?:
smblib-util.c:537:5: error: ?strncpy? specified bound 129 equals destination size [-Werror=stringop-truncation]
     strncpy(tree -> path, path, sizeof(tree -> path));
     ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
smblib-util.c:538:5: error: ?strncpy? specified bound 20 equals destination size [-Werror=stringop-truncation]
     strncpy(tree -> device_type, device, sizeof(tree -> device_type));
     ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
cc1: all warnings being treated as errors
make[2]: *** [Makefile:776: smblib-util.lo] Error 1
make[2]: Leaving directory '/root/squid-3.5.28/lib/smblib'
make[1]: *** [Makefile:1043: all-recursive] Error 1
make[1]: Leaving directory '/root/squid-3.5.28/lib'
make: *** [Makefile:581: all-recursive] Error 1
 
Any help is welcome !
Thanks 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220711/0f35424f/attachment.htm>

From 0xff1f at gmail.com  Mon Jul 11 21:00:35 2022
From: 0xff1f at gmail.com (Ahmad Alzaeem)
Date: Mon, 11 Jul 2022 21:00:35 +0000
Subject: [squid-users] squid 3.x on Centos8 not working
In-Reply-To: <005301d89568$90103bb0$b030b310$@gmail.com>
References: <DBBPR09MB4523CC08514A6EA08BCD3DC2F7B89@DBBPR09MB4523.eurprd09.prod.outlook.com>
 <004401d8955d$a7c98a50$f75c9ef0$@gmail.com>
 <DBBPR09MB452330F3747C62DAE0F57A4BF7879@DBBPR09MB4523.eurprd09.prod.outlook.com>
 <005301d89568$90103bb0$b030b310$@gmail.com>
Message-ID: <DBBPR09MB452384C2B8040C699689AA30F7879@DBBPR09MB4523.eurprd09.prod.outlook.com>

Hello Eliezer,
I reported many times that squid 4. x does not support delay pools and never got a patch or fix.

Squid5 is buggy and not stable and keeps crashing and with DNS  resolution it's not stable.


Squid 4 is stable but does not support delay pools.
Squid 3.5.x is stable and supports delay pools

That?s the summary.



From: squid-users <squid-users-bounces at lists.squid-cache.org> on behalf of ngtech1ltd at gmail.com <ngtech1ltd at gmail.com>
Date: Monday, July 11, 2022 at 1:55 PM
To: squid-users at lists.squid-cache.org <squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] squid 3.x on Centos8 not working
Hey Ahmad,

I really don?t know what to say.
I am not using delay pools so I cannot say anything about that.

About DNS IPV4/IPV6 I am not sure what you are referring to.
Can you please refer me to the bug report on these?
It should be testable.
I have not seen anything about this in my environment until now so I am pretty confused.

Thanks,
Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com<mailto:ngtech1ltd at gmail.com>
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/

From: Ahmad Alzaeem <0xff1f at gmail.com>
Sent: Monday, 11 July 2022 22:53
To: ngtech1ltd at gmail.com; squid-users at lists.squid-cache.org
Subject: Re: [squid-users] squid 3.x on Centos8 not working

None of squid4.x support delay pools .

Squid5.x is full of bugs with DNS IPV4/IPV6 Because of the eyeball feature.

Thanks


From: squid-users <squid-users-bounces at lists.squid-cache.org<mailto:squid-users-bounces at lists.squid-cache.org>> on behalf of ngtech1ltd at gmail.com<mailto:ngtech1ltd at gmail.com> <ngtech1ltd at gmail.com<mailto:ngtech1ltd at gmail.com>>
Date: Monday, July 11, 2022 at 12:37 PM
To: squid-users at lists.squid-cache.org<mailto:squid-users at lists.squid-cache.org> <squid-users at lists.squid-cache.org<mailto:squid-users at lists.squid-cache.org>>
Subject: Re: [squid-users] squid 3.x on Centos8 not working
Hey Ahmad,

What is preventing you from using 4.x or 5.x?

Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com<mailto:ngtech1ltd at gmail.com>
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/

From: squid-users <squid-users-bounces at lists.squid-cache.org<mailto:squid-users-bounces at lists.squid-cache.org>> On Behalf Of Ahmad Alzaeem
Sent: Tuesday, 28 June 2022 16:29
To: squid-users at lists.squid-cache.org<mailto:squid-users at lists.squid-cache.org>
Subject: [squid-users] squid 3.x on Centos8 not working


Hello Folks ,

Trying to compile squid 3.x on Centos8 but have an errors below seems in SMBLIB .

Squid ver :
squid-3.5.28

GCC ver :

gcc -v
Using built-in specs.
COLLECT_GCC=gcc
COLLECT_LTO_WRAPPER=/usr/libexec/gcc/x86_64-redhat-linux/8/lto-wrapper
OFFLOAD_TARGET_NAMES=nvptx-none
OFFLOAD_TARGET_DEFAULT=1
Target: x86_64-redhat-linux
Configured with: ../configure --enable-bootstrap --enable-languages=c,c++,fortran,lto --prefix=/usr --mandir=/usr/share/man --infodir=/usr/share/info --with-bugurl=http://bugzilla.redhat.com/bugzilla --enable-shared --enable-threads=posix --enable-checking=release --enable-multilib --with-system-zlib --enable-__cxa_atexit --disable-libunwind-exceptions --enable-gnu-unique-object --enable-linker-build-id --with-gcc-major-version-only --with-linker-hash-style=gnu --enable-plugin --enable-initfini-array --with-isl --disable-libmpx --enable-offload-targets=nvptx-none --without-cuda-driver --enable-gnu-indirect-function --enable-cet --with-tune=generic --with-arch_32=x86-64 --build=x86_64-redhat-linux
Thread model: posix
gcc version 8.5.0 20210514 (Red Hat 8.5.0-4) (GCC)

we are using ./configure  with default flags  ,  and have the errors below :


make[2]: Entering directory '/root/squid-3.5.28/lib/rfcnb'
depbase=`echo rfcnb-io.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
/bin/sh ../../libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H   -I../.. -I../../include -I../../lib -I../../src -I../../include    -I../../lib  -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT rfcnb-io.lo -MD -MP -MF $depbase.Tpo -c -o rfcnb-io.lo rfcnb-io.c &&\
mv -f $depbase.Tpo $depbase.Plo
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT rfcnb-io.lo -MD -MP -MF .deps/rfcnb-io.Tpo -c rfcnb-io.c  -fPIC -DPIC -o .libs/rfcnb-io.o
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT rfcnb-io.lo -MD -MP -MF .deps/rfcnb-io.Tpo -c rfcnb-io.c -o rfcnb-io.o >/dev/null 2>&1
depbase=`echo rfcnb-util.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
/bin/sh ../../libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H   -I../.. -I../../include -I../../lib -I../../src -I../../include    -I../../lib  -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT rfcnb-util.lo -MD -MP -MF $depbase.Tpo -c -o rfcnb-util.lo rfcnb-util.c &&\
mv -f $depbase.Tpo $depbase.Plo
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT rfcnb-util.lo -MD -MP -MF .deps/rfcnb-util.Tpo -c rfcnb-util.c  -fPIC -DPIC -o .libs/rfcnb-util.o
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT rfcnb-util.lo -MD -MP -MF .deps/rfcnb-util.Tpo -c rfcnb-util.c -o rfcnb-util.o >/dev/null 2>&1
depbase=`echo session.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
/bin/sh ../../libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H   -I../.. -I../../include -I../../lib -I../../src -I../../include    -I../../lib  -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT session.lo -MD -MP -MF $depbase.Tpo -c -o session.lo session.c &&\
mv -f $depbase.Tpo $depbase.Plo
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT session.lo -MD -MP -MF .deps/session.Tpo -c session.c  -fPIC -DPIC -o .libs/session.o
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT session.lo -MD -MP -MF .deps/session.Tpo -c session.c -o session.o >/dev/null 2>&1
/bin/sh ../../libtool  --tag=CC   --mode=link gcc -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2  -g -o librfcnb.la  rfcnb-io.lo rfcnb-util.lo session.lo
libtool: link: /usr/bin/ar cru .libs/librfcnb.a .libs/rfcnb-io.o .libs/rfcnb-util.o .libs/session.o
libtool: link: ranlib .libs/librfcnb.a
libtool: link: ( cd ".libs" && rm -f "librfcnb.la" && ln -s "../librfcnb.la" "librfcnb.la" )
make[2]: Leaving directory '/root/squid-3.5.28/lib/rfcnb'
Making all in smblib
make[2]: Entering directory '/root/squid-3.5.28/lib/smblib'
depbase=`echo md4.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
/bin/sh ../../libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H   -I../.. -I../../include -I../../lib -I../../src -I../../include    -I../../lib  -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT md4.lo -MD -MP -MF $depbase.Tpo -c -o md4.lo md4.c &&\
mv -f $depbase.Tpo $depbase.Plo
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT md4.lo -MD -MP -MF .deps/md4.Tpo -c md4.c  -fPIC -DPIC -o .libs/md4.o
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT md4.lo -MD -MP -MF .deps/md4.Tpo -c md4.c -o md4.o >/dev/null 2>&1
depbase=`echo smblib.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
/bin/sh ../../libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H   -I../.. -I../../include -I../../lib -I../../src -I../../include    -I../../lib  -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT smblib.lo -MD -MP -MF $depbase.Tpo -c -o smblib.lo smblib.c &&\
mv -f $depbase.Tpo $depbase.Plo
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT smblib.lo -MD -MP -MF .deps/smblib.Tpo -c smblib.c  -fPIC -DPIC -o .libs/smblib.o
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT smblib.lo -MD -MP -MF .deps/smblib.Tpo -c smblib.c -o smblib.o >/dev/null 2>&1
depbase=`echo smblib-util.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
/bin/sh ../../libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H   -I../.. -I../../include -I../../lib -I../../src -I../../include    -I../../lib  -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT smblib-util.lo -MD -MP -MF $depbase.Tpo -c -o smblib-util.lo smblib-util.c &&\
mv -f $depbase.Tpo $depbase.Plo
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT smblib-util.lo -MD -MP -MF .deps/smblib-util.Tpo -c smblib-util.c  -fPIC -DPIC -o .libs/smblib-util.o
smblib-util.c: In function ?SMB_Negotiate?:
smblib-util.c:400:9: error: ?strncpy? output may be truncated copying 79 bytes from a string of length 79 [-Werror=stringop-truncation]
         strncpy(p, Con_Handle -> Svr_PDom, sizeof(Con_Handle -> Svr_PDom) - 1);
         ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
smblib-util.c:423:9: error: ?strncpy? output may be truncated copying 79 bytes from a string of length 79 [-Werror=stringop-truncation]
         strncpy(p, Con_Handle -> Svr_PDom, sizeof(Con_Handle -> Svr_PDom) - 1);
         ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
smblib-util.c: In function ?SMB_TreeConnect?:
smblib-util.c:537:5: error: ?strncpy? specified bound 129 equals destination size [-Werror=stringop-truncation]
     strncpy(tree -> path, path, sizeof(tree -> path));
     ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
smblib-util.c:538:5: error: ?strncpy? specified bound 20 equals destination size [-Werror=stringop-truncation]
     strncpy(tree -> device_type, device, sizeof(tree -> device_type));
     ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
cc1: all warnings being treated as errors
make[2]: *** [Makefile:776: smblib-util.lo] Error 1
make[2]: Leaving directory '/root/squid-3.5.28/lib/smblib'
make[1]: *** [Makefile:1043: all-recursive] Error 1
make[1]: Leaving directory '/root/squid-3.5.28/lib'
make: *** [Makefile:581: all-recursive] Error 1

Any help is welcome !
Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220711/45df6711/attachment.htm>

From ngtech1ltd at gmail.com  Wed Jul 13 02:52:08 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Wed, 13 Jul 2022 05:52:08 +0300
Subject: [squid-users] 0 2 RO - Squid-Cache Zoom Meetup
Message-ID: <009501d89663$8bc805a0$a35810e0$@gmail.com>

OK So the meeting will be up in the next zoom link:
https://us02web.zoom.us/j/83973796573?pwd=TTdjY1p1dFBVUDVta1Yxa3N6OEo0dz09

It's public but has restricted login so you will need to be admitted by me.
To prepare for the meetup it would be nice to know who will be participating in the meetup.
Please send me thumbs up that you are willing to participate.

Thanks,
Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/

-----Original Message-----
From: ngtech1ltd at gmail.com <ngtech1ltd at gmail.com> 
Sent: Monday, 11 July 2022 1:24
To: 'squid-users at lists.squid-cache.org' <squid-users at lists.squid-cache.org>
Subject: 0 2 RO - Squid-Cache Zoom Meetup

Hey Everybody,

https://www.ngtech.co.il/0-2-ro/index.php/2022/07/11/0-2-ro/

https://www.ngtech.co.il/0-2-ro/wp-content/uploads/2022/07/meeting-01-1024x576.png

Up-coming 0 2 RO Squid-Cache community meetup next week the 21/07/2022 at 20:30 IST. The meeting will be in Zoom and I hope that we can meet each other and understand what we can do together. The idea is to learn more about Squid-Cache as a one punch tool. It can do a lot of things and you we just need to learn from the experience of the elders. There is a eight layer in the OSI model and this is not something you can find in search engines but in each and every one of our souls. The Computers world is a very special cross-world place and we utilize the 7 OSI layers to get to the eight and I this meetup will give the platform for this layer for the Squid-Cache Community.
Put it in your calendar: 

https://www.ngtech.co.il/0-2-ro/wp-content/uploads/2022/07/0-2-ro-Squid-Cache-Community-meetup.ics

Please send me a response for the invite.

Thanks,
Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/




From ngtech1ltd at gmail.com  Wed Jul 13 18:44:12 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Wed, 13 Jul 2022 21:44:12 +0300
Subject: [squid-users] 0 2 RO - Squid-Cache Zoom Meetup
Message-ID: <00bb01d896e8$8c387940$a4a96bc0$@gmail.com>

IST = Israel Time Zone
Which now is UTC+3

IST != India Standard Time

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/

-----Original Message-----
From: ngtech1ltd at gmail.com <ngtech1ltd at gmail.com> 
Sent: Wednesday, 13 July 2022 5:52
To: 'squid-users at lists.squid-cache.org' <squid-users at lists.squid-cache.org>
Subject: RE: 0 2 RO - Squid-Cache Zoom Meetup

OK So the meeting will be up in the next zoom link:
https://us02web.zoom.us/j/83973796573?pwd=TTdjY1p1dFBVUDVta1Yxa3N6OEo0dz09

It's public but has restricted login so you will need to be admitted by me.
To prepare for the meetup it would be nice to know who will be participating in the meetup.
Please send me thumbs up that you are willing to participate.

Thanks,
Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/

-----Original Message-----
From: ngtech1ltd at gmail.com <ngtech1ltd at gmail.com> 
Sent: Monday, 11 July 2022 1:24
To: 'squid-users at lists.squid-cache.org' <squid-users at lists.squid-cache.org>
Subject: 0 2 RO - Squid-Cache Zoom Meetup

Hey Everybody,

https://www.ngtech.co.il/0-2-ro/index.php/2022/07/11/0-2-ro/

https://www.ngtech.co.il/0-2-ro/wp-content/uploads/2022/07/meeting-01-1024x576.png

Up-coming 0 2 RO Squid-Cache community meetup next week the 21/07/2022 at 20:30 IST. The meeting will be in Zoom and I hope that we can meet each other and understand what we can do together. The idea is to learn more about Squid-Cache as a one punch tool. It can do a lot of things and you we just need to learn from the experience of the elders. There is a eight layer in the OSI model and this is not something you can find in search engines but in each and every one of our souls. The Computers world is a very special cross-world place and we utilize the 7 OSI layers to get to the eight and I this meetup will give the platform for this layer for the Squid-Cache Community.
Put it in your calendar: 

https://www.ngtech.co.il/0-2-ro/wp-content/uploads/2022/07/0-2-ro-Squid-Cache-Community-meetup.ics

Please send me a response for the invite.

Thanks,
Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/




From squid3 at treenet.co.nz  Thu Jul 14 08:56:39 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 14 Jul 2022 20:56:39 +1200
Subject: [squid-users] MS-SQL with squid helpers
In-Reply-To: <000d01d8894f$ab3182c0$01948840$@gmail.com>
References: <000d01d8894f$ab3182c0$01948840$@gmail.com>
Message-ID: <6d75cd75-f8cc-bc62-7f10-5557f68d6e26@treenet.co.nz>

On 26/06/22 23:27, ngtech1ltd wrote:
> Hey Everybody,
> 
> I was wondering if someone wrote a set of helpers that works with MS-SQL 
> server database?
> 

(I see you went ahead with this already, just responding for anyone in 
future).

Squid ships with several DB helpers, for both authentication and 
external ACL lookups. They are based on Perl so any database which Perl 
provides a DB interface for can be used with those helpers.


Cheers
Amos


From squid3 at treenet.co.nz  Thu Jul 14 09:10:21 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 14 Jul 2022 21:10:21 +1200
Subject: [squid-users] Squid white list
In-Reply-To: <CADAqQfxSfPL1Gk+nz3dMz-fWBcDDzwLSnCq3_8VQkMPCGb4O0Q@mail.gmail.com>
References: <CADAqQfxSfPL1Gk+nz3dMz-fWBcDDzwLSnCq3_8VQkMPCGb4O0Q@mail.gmail.com>
Message-ID: <c982629a-648f-2d02-fa91-3c7ebe7e48b1@treenet.co.nz>

On 5/07/22 02:12, Ben Goz wrote:
> By the help of God.
> 
> Hi,
> I want to use squid access list to implement white list of group of urls.
> If I want to while list domain example.com <http://example.com> and this 
> website invokes http requests to
> domain example-a.com <http://example-a.com> which is not included in my 
> white list so squid denied this request,
> which could break to page from example.com <http://example.com>.
> 
> What is the recommended way to solve this problem without manually 
> including all domains to white list?
> 

So ... two different domain names (A and B) need to be added to a 
whitelist as separate entries. That does not sound like a problem to me, 
it is normal for any type of list to have an entry for each distinct 
thing listed.


If your problem is that there are *sub*-domains in a dstdomain/srcdomain 
list, use wildcard entries. That is done by omitting the subdomain 
label(s), leaving one entry starting a '.' like so:
   acl foo dstdomain .example.com

If your problem is actually that there is a pattern to domain names TLD 
portion then you might use regex. Almost all ACl types have a *_regex 
variant. Like so:
   acl foo dstdom_regex example(\-[a-z])?\.com$


Amos


From squid3 at treenet.co.nz  Thu Jul 14 10:15:56 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 14 Jul 2022 22:15:56 +1200
Subject: [squid-users] How to allow users authenticated to access only
 their own ports.
In-Reply-To: <001201d89257$33fc1c40$9bf454c0$@graminsta.com.br>
References: <001201d89257$33fc1c40$9bf454c0$@graminsta.com.br>
Message-ID: <19c59ee6-ec89-e814-569c-93486bca323a@treenet.co.nz>

On 8/07/22 11:13, Marcelo wrote:
> Hi everyone ;)
> 
> I have a little bit complex task at hand.
> 

This is not particularly complex and comes up relatively often.


> What I must do:
> 
> 1-Allow an user to access squid only through specific port. This same 
> user can access 1 port or several ports, depending on how many routes he 
> have.

Why do Squid listening ports need to be linked to routes? There is 
nothing special about listening ports.

If you have a business/contractual level thing indicating that certain 
clients IP ranges can access certain port(s) that is better dealt with 
at a firewall prohibiting other IP ranges reaching those ports. Letting 
the traffic reach Squid in that case is "too late".


> 
> 2- Authenticated users can access only their own ports.
> 

These are not separate items. They are achieved by the same config setup:

  http_port 3218
  acl port3128 myportname 3128

  # repeat above for each listening port

  # below lines only need to exist once

  auth_param ...
  acl login proxy_auth REQUIRED
  http_access deny !login

  external_acl_type checkUserPort \
     ttl=0 negative_ttl=0 cache=0 \
     %ul %rp \
     /path/to/ext_sql_session_acl ...

  acl userHasPort external checkUserPort
  http_access deny !userHasPort


In the DB the session helper checks you simply add entries for each 
"username portname" as the session ID column. Removing DB entries 
immediately stops all *new* traffic from that user account being 
accepted. You can adjust the TTL / cache options, but that will affect 
the speed of user traffic halting.


> 3- Every access is via IP:Port that brings the user to a different 
> tcp_outgoing_address
> 


Please be aware that the concept of an end-to-end route decided by one 
agent along the line is not compatible with modern networking protocols.

Firstly, you will need to disable HTTP persistence features entirely on 
outbound traffic. This erases all possibility of TCP-fast-open, HTTP 
connection sharing and multiplexing performance boosters for traffic 
going through your proxy. It will also make use of cache_peer extremely 
difficult.

   server_persistent_connections off


Next you have Squid tell the OS routing system what IP(s) each listening 
port is linked to:

   tcp_outgoing_address 192.168.0.1 port3128
   tcp_outgoing_address ::1 port3128

I would place them right after the port3128 line so it is easy to manage 
many entries and see what port+routes are linked.
   You could even place the repeated groups of 
http_access+acl+tcp_outgoing_address lines in a separate config file 
per-port to allow automated management with the include directive.


Please be aware that tcp_outgoing_address is at best a *hint* to the OS 
routing system about what IP address is preferred as outgoing. The 
routing system can itself re-assign IP related details (eg outgoing NAT 
or gateway traffic balancing).


So, if you can clarify what actual business need is leading to it being 
considered a requirement? very likely there are alternatives that will 
not break your traffic as much.




If you are interested here are some pointers on where the experiments 
went wrong ...

> Example
> 
> An user must have 2 routes:
> 
> 192.168.0.2:3001 this route brings this user to tcp_outgoing_address 
> 200.2.2.11
> 
> 192.168.0.2:3002 this route brings this user to tcp_outgoing_address 
> 200.2.2.12
> 
> Yes, every port have to route to a different tcp outgoing address.
> 
> The closest I could get to a solution was using this:
> 
> http_port 192.168.0.2:3001 name=5
> 
> acl ip5 myportname 5
> 
> tcp_outgoing_address 200.2.2.11 ip5
> 
> This way, an user that enters via 192.168.0.2:3001 goes out via 200.2.2.11.
> 

It *looks* like working. But only does if the user is accessing an IPv4 
service.

You need a second tcp_outgoing_address entry to provide routing to IPv6 
services. Otherwise IPv6 traffic will completely disobey your route 
assignment policy.


> And its fine, but this way, every authenticated user can access all routes.
> 
> I have tried several ways to bind an username in this solution, but it 
> is not working.
> Authentication was via basic_db_auth, but I ?downgraded it? to 
> basic_ncsa_auth to simplify tests. Authentication is working fine.
> 
> My last try was using the setup below, but It made squid a little dizzy:
> 
> acl ip3 proxy_auth test myportname 3
> 

The above will accept logins for these usernames:
   "test", "myportname", and "3"

Each "acl" line has a single type parameter (above "proxy_auth") and 
performs a boolean 'OR' condition matching values listed after the type.



> http_access allow ip3
> 

This allows the above mentioned usernames unlimited access. No criteria 
other than they had to login.


> http_port 192.168.0.2:2000 name=3
> 
> tcp_outgoing_address 200.2.2.11 ip3
> 

This assigns the *username* to that route. No connection to the port 
they arrived at.


> http_access deny ip3
> 

Never happens, "ip3" has already been allowed above.


Same issues for these ip4 rules

> acl ip4 proxy_auth test1 myportname 4
> http_access allow ip4
> http_port 192.168.0.2:2000 name=4
> tcp_outgoing_address 200.2.2.12 ip4
> http_access deny ip4
> 

Then finally, all attempts to login that are *not* matching "ip3" nor 
"ip4" are *ALLOWED* (oops).


HTH
Amos


From ben.goz87 at gmail.com  Thu Jul 14 11:16:14 2022
From: ben.goz87 at gmail.com (Ben Goz)
Date: Thu, 14 Jul 2022 14:16:14 +0300
Subject: [squid-users] Squid white list
In-Reply-To: <c982629a-648f-2d02-fa91-3c7ebe7e48b1@treenet.co.nz>
References: <CADAqQfxSfPL1Gk+nz3dMz-fWBcDDzwLSnCq3_8VQkMPCGb4O0Q@mail.gmail.com>
 <c982629a-648f-2d02-fa91-3c7ebe7e48b1@treenet.co.nz>
Message-ID: <4efad49a-b63a-50df-4043-884fa34f2f40@gmail.com>

By the help of God.

On 14/07/2022 12:10, Amos Jeffries wrote:
> On 5/07/22 02:12, Ben Goz wrote:
>> By the help of God.
>>
>> Hi,
>> I want to use squid access list to implement white list of group of 
>> urls.
>> If I want to while list domain example.com <http://example.com> and 
>> this website invokes http requests to
>> domain example-a.com <http://example-a.com> which is not included in 
>> my white list so squid denied this request,
>> which could break to page from example.com <http://example.com>.
>>
>> What is the recommended way to solve this problem without manually 
>> including all domains to white list?
>>
>
> So ... two different domain names (A and B) need to be added to a 
> whitelist as separate entries. That does not sound like a problem to 
> me, it is normal for any type of list to have an entry for each 
> distinct thing listed.
Can you please recommend on a programmatic way to list all links in case 
that domain A links media also from domain B but I added manually only 
domain A?
>
>
> If your problem is that there are *sub*-domains in a 
> dstdomain/srcdomain list, use wildcard entries. That is done by 
> omitting the subdomain label(s), leaving one entry starting a '.' like 
> so:
> ? acl foo dstdomain .example.com
>
> If your problem is actually that there is a pattern to domain names 
> TLD portion then you might use regex. Almost all ACl types have a 
> *_regex variant. Like so:
> ? acl foo dstdom_regex example(\-[a-z])?\.com$
>
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users


From ngtech1ltd at gmail.com  Thu Jul 14 11:45:17 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Thu, 14 Jul 2022 14:45:17 +0300
Subject: [squid-users] MS-SQL with squid helpers
In-Reply-To: <6d75cd75-f8cc-bc62-7f10-5557f68d6e26@treenet.co.nz>
References: <000d01d8894f$ab3182c0$01948840$@gmail.com>
 <6d75cd75-f8cc-bc62-7f10-5557f68d6e26@treenet.co.nz>
Message-ID: <000501d89777$31499d40$93dcd7c0$@gmail.com>

There is a new mssql driver for linux named:
free_tds

Which is superior to ODBC which perl mostly uses in the DBI library.
It's pretty simple to install free_tds and from my tests it seems like the better choice.
I will try to write an example for session helper using free_tds and ruby.
For me Ruby is the simplest to write, test and use with such simple and tiny projects.
It's not worth writing it in other languages unless there is server component to the service.
It's possible to write more robust server side code which supports threading and parallelism in other languages.
But for most use cases and my experience it's cheaper to use a bit more RAM and CPU compared to writing
a very good server side code.

Amos,
I have also tested MSSQL as a blacklist categories backend and it looks promising.
MySQL would be OK but MSSQL and Oracle takes much more load for specific use cases.

Working on the helper...

Lookup of for the next week Squid-Cache community meetup.

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Amos Jeffries
Sent: Thursday, 14 July 2022 11:57
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] MS-SQL with squid helpers

On 26/06/22 23:27, ngtech1ltd wrote:
> Hey Everybody,
> 
> I was wondering if someone wrote a set of helpers that works with MS-SQL 
> server database?
> 

(I see you went ahead with this already, just responding for anyone in 
future).

Squid ships with several DB helpers, for both authentication and 
external ACL lookups. They are based on Perl so any database which Perl 
provides a DB interface for can be used with those helpers.


Cheers
Amos
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From squid3 at treenet.co.nz  Thu Jul 14 12:38:25 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 15 Jul 2022 00:38:25 +1200
Subject: [squid-users] Squid white list
In-Reply-To: <4efad49a-b63a-50df-4043-884fa34f2f40@gmail.com>
References: <CADAqQfxSfPL1Gk+nz3dMz-fWBcDDzwLSnCq3_8VQkMPCGb4O0Q@mail.gmail.com>
 <c982629a-648f-2d02-fa91-3c7ebe7e48b1@treenet.co.nz>
 <4efad49a-b63a-50df-4043-884fa34f2f40@gmail.com>
Message-ID: <2fac3123-e47c-e7ef-e4c4-f95fbe3a944d@treenet.co.nz>

On 14/07/22 23:16, Ben Goz wrote:
> Can you please recommend on a programmatic way to list all links in case 
> that domain A links media also from domain B but I added manually only 
> domain A?
>>

For that you will need the list of domains to be in some dynamically 
generated database. Along with a content adaptation module (may or may 
not be available publicly) to parse and process all HTML going through 
the proxy that updates your database. Maybe also TLS decryption of 
traffic so it can be passed to the adapter.

You can in some situations check the Referer header URLs against your 
whitelist. But that is not available on TLS traffic, unpredictable 
whether Referer even arrives on non-TLS and can be easily forged by 
clients to bypass proxy rules.

HTH
Amos


From ngtech1ltd at gmail.com  Thu Jul 14 18:17:32 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Thu, 14 Jul 2022 21:17:32 +0300
Subject: [squid-users] MS-SQL with squid helpers
In-Reply-To: <6d75cd75-f8cc-bc62-7f10-5557f68d6e26@treenet.co.nz>
References: <000d01d8894f$ab3182c0$01948840$@gmail.com>
 <6d75cd75-f8cc-bc62-7f10-5557f68d6e26@treenet.co.nz>
Message-ID: <001501d897ad$fd51c300$f7f54900$@gmail.com>

While looking for some materials I have found the next MSSQL helper which used my repo ?

https://github.com/flysen/squid



----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Amos Jeffries
Sent: Thursday, 14 July 2022 11:57
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] MS-SQL with squid helpers

On 26/06/22 23:27, ngtech1ltd wrote:
> Hey Everybody,
> 
> I was wondering if someone wrote a set of helpers that works with MS-SQL 
> server database?
> 

(I see you went ahead with this already, just responding for anyone in 
future).

Squid ships with several DB helpers, for both authentication and 
external ACL lookups. They are based on Perl so any database which Perl 
provides a DB interface for can be used with those helpers.


Cheers
Amos
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From ngtech1ltd at gmail.com  Thu Jul 14 19:57:08 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Thu, 14 Jul 2022 22:57:08 +0300
Subject: [squid-users] MS-SQL with squid helpers
In-Reply-To: <6d75cd75-f8cc-bc62-7f10-5557f68d6e26@treenet.co.nz>
References: <000d01d8894f$ab3182c0$01948840$@gmail.com>
 <6d75cd75-f8cc-bc62-7f10-5557f68d6e26@treenet.co.nz>
Message-ID: <001601d897bb$e6ed4ea0$b4c7ebe0$@gmail.com>

So the first helper is the session helper login script example:
https://github.com/elico/squid-mssql-helpers



----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Amos Jeffries
Sent: Thursday, 14 July 2022 11:57
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] MS-SQL with squid helpers

On 26/06/22 23:27, ngtech1ltd wrote:
> Hey Everybody,
> 
> I was wondering if someone wrote a set of helpers that works with MS-SQL 
> server database?
> 

(I see you went ahead with this already, just responding for anyone in 
future).

Squid ships with several DB helpers, for both authentication and 
external ACL lookups. They are based on Perl so any database which Perl 
provides a DB interface for can be used with those helpers.


Cheers
Amos
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From samoht.dev at gmail.com  Fri Jul 15 12:18:43 2022
From: samoht.dev at gmail.com (Thomas Dev)
Date: Fri, 15 Jul 2022 14:18:43 +0200
Subject: [squid-users] Connection reset and assertion failed
Message-ID: <CAJ1yAf+8jcHE=RwLJiGsExS0q006Bow73hRtMu3nLbRMU58Dzg@mail.gmail.com>

Hi,

currently, we are suffering from aborted downloads while going over
squid. When I look into the ethernet traffic, I can see many TCP-rests
by squid and in close timely relation to those resets I see messages
like:

2022/07/15 12:04:24 kid1| assertion failed: tunnel.cc:1227:
"!waitingForConnectExchange"
    current master transaction: master1178

in cache.log.

Are these tcp-resets related to the failed assertion and can I do
something about it?

Thanks in advance.

Kind regards
Thomas


Server: physical Ubuntu 22.04 LTS

Squid Cache: Version 5.2
Service Name: squid
Ubuntu linux
configure options:  '--build=x86_64-linux-gnu' '--prefix=/usr'
'--includedir=${prefix}/include' '--mandir=${prefix}/share/man'
'--infodir=${prefix}/share/info' '--sysconfdir=/etc'
'--localstatedir=/var' '--disable-option-checking'
'--disable-silent-rules' '--libdir=${prefix}/lib/x86_64-linux-gnu'
'--runstatedir=/run' '--disable-maintainer-mode'
'--disable-dependency-tracking' 'BUILDCXXFLAGS=-g -O2
-ffile-prefix-map=/build/squid-DQ03Be/squid-5.2=. -flto=auto
-ffat-lto-objects -flto=auto -ffat-lto-objects
-fstack-protector-strong -Wformat -Werror=format-security -Wdate-time
-D_FORTIFY_SOURCE=2 -Wl,-Bsymbolic-functions -flto=auto
-ffat-lto-objects -flto=auto -Wl,-z,relro -Wl,-z,now ' 'BUILDCXX=g++'
'--with-build-environment=default' '--enable-build-info=Ubuntu linux'
'--datadir=/usr/share/squid' '--sysconfdir=/etc/squid'
'--libexecdir=/usr/lib/squid' '--mandir=/usr/share/man'
'--enable-inline' '--disable-arch-native' '--enable-async-io=8'
'--enable-storeio=ufs,aufs,diskd,rock'
'--enable-removal-policies=lru,heap' '--enable-delay-pools'
'--enable-cache-digests' '--enable-icap-client'
'--enable-follow-x-forwarded-for'
'--enable-auth-basic=DB,fake,getpwnam,LDAP,NCSA,PAM,POP3,RADIUS,SASL,SMB'
'--enable-auth-digest=file,LDAP'
'--enable-auth-negotiate=kerberos,wrapper'
'--enable-auth-ntlm=fake,SMB_LM'
'--enable-external-acl-helpers=file_userip,kerberos_ldap_group,LDAP_group,session,SQL_session,time_quota,unix_group,wbinfo_group'
'--enable-security-cert-validators=fake'
'--enable-storeid-rewrite-helpers=file'
'--enable-url-rewrite-helpers=fake' '--enable-eui' '--enable-esi'
'--enable-icmp' '--enable-zph-qos' '--enable-ecap'
'--disable-translation' '--with-swapdir=/var/spool/squid'
'--with-logdir=/var/log/squid' '--with-pidfile=/run/squid.pid'
'--with-filedescriptors=65536' '--with-large-files'
'--with-default-user=proxy' '--enable-linux-netfilter'
'--with-systemd' '--with-gnutls' 'build_alias=x86_64-linux-gnu'
'CFLAGS=-g -O2 -ffile-prefix-map=/build/squid-DQ03Be/squid-5.2=.
-flto=auto -ffat-lto-objects -flto=auto -ffat-lto-objects
-fstack-protector-strong -Wformat -Werror=format-security -Wall'
'LDFLAGS=-Wl,-Bsymbolic-functions -flto=auto -ffat-lto-objects
-flto=auto -Wl,-z,relro -Wl,-z,now ' 'CPPFLAGS=-Wdate-time
-D_FORTIFY_SOURCE=2' 'CXXFLAGS=-g -O2
-ffile-prefix-map=/build/squid-DQ03Be/squid-5.2=. -flto=auto
-ffat-lto-objects -flto=auto -ffat-lto-objects
-fstack-protector-strong -Wformat -Werror=format-security'


From Johnathan.Hasty at uncommonschools.org  Fri Jul 15 13:51:25 2022
From: Johnathan.Hasty at uncommonschools.org (Johnathan Hasty)
Date: Fri, 15 Jul 2022 13:51:25 +0000
Subject: [squid-users] Upstream Proxy
Message-ID: <MN2PR10MB4176DD2030DFE34D7C349F6CF78B9@MN2PR10MB4176.namprd10.prod.outlook.com>

Hello,

I've been trying to hand off credentials to our upstream proxy GoGuardian and have been facing many issues. GG is not very helpful and keeps pushing to use their Windows client, however if they support MDMs for mobile devices why wouldn't Squid work?

Has anyone gotten Squid to successfully hand off to GoGuardian as their upstream proxy?

Advanced ACLs:
cache_peer gateway.goguardian.com parent 443 0 no-query no-digest no-netdb-exchange connect-timeout=60 default tls login=NEGOTIATE:principal_name sslcapath=/usr/local/share/ca-certificates/
cache_peer_access gateway.goguardian.com allow all
never_direct allow all


Log snipit:
2022/06/30 15:22:49.198 kid1| 5,3| IoCallback.cc<https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fIoCallback.cc&c=E,1,tkT-dyHiVAqZoP7tVfxLk3RVYLyb_avXd27fXGqjJMTzNKPAGHmmvW9pXYcC425jST0ZYFFPwV4uHf3fKHuux40xkg9kXWTzOHPdGV5BNGbILyA,&typo=1&ancr_add=1>(112) finish: called for conn2126 local=10.56.1.3:59674<http://10.56.1.3:59674> remote=18.213.126.143:443<http://18.213.126.143:443> FIRSTUP_PARENT FD 24 flags=1 (0, 0)
2022/06/30 15:22:49.198 kid1| 93,3| AsyncCall.cc<https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fAsyncCall.cc&c=E,1,DRAaKArrkDvBn0UuKG4CO_yXvblIrZBSYHpMpA4H7oRhEraoEzGxMCRwZJpYUsTM63vFW1Co7R0A33jgXq0EZyS1JcelCRUFXLjE5tQ-siWuoU0bbvc,&typo=1&ancr_add=1>(96) ScheduleCall: IoCallback.cc<https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fIoCallback.cc&c=E,1,bCxz0FVR5jkr6lvnOvzW7e6G8tQBNRlVCCbel3ASQC74rRdj29Wxcj66G7Jit7W9Qdbz8catGFZxEEbA6bR1lmzxqhKOAxPRfaraHkB0Kq0,&typo=1&ancr_add=1>(131) will call Http::Tunneler::handleReadyRead(conn2126 local=10.56.1.3:59674<http://10.56.1.3:59674> remote=18.213.126.143:443<http://18.213.126.143:443> FIRSTUP_PARENT FD 24 flags=1, data=0x55849f4926c8) [call548666]
2022/06/30 15:22:49.198 kid1| 93,3| AsyncCallQueue.cc<https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fAsyncCallQueue.cc&c=E,1,Ne0y7JJW7fBc_1MyCR5zK2LlFshqIfjXRI-DDHdH5PeY44sZtFyGkRMXgYLpMqHYj17Z8PToa57tNyAfAp6EUkVwM3SHgK37ObzCJYBj&typo=1&ancr_add=1>(59) fireNext: entering Http::Tunneler::handleReadyRead(conn2126 local=10.56.1.3:59674<http://10.56.1.3:59674> remote=18.213.126.143:443<http://18.213.126.143:443> FIRSTUP_PARENT FD 24 flags=1, data=0x55849f4926c8)
2022/06/30 15:22:49.198 kid1| 93,3| AsyncCall.cc<https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fAsyncCall.cc&c=E,1,o0OzDC7879yEvRQoXyqb11XnNW2f6RJwmh1OP5vYSK4ukmnOFcBmRwtorjA94HFXF2MO38TdGcH68cNv4LkX122TcPK1Gwh5xQXTTnzhZCk0N4c,&typo=1&ancr_add=1>(41) make: make call Http::Tunneler::handleReadyRead [call548666]
2022/06/30 15:22:49.198 kid1| 93,3| AsyncJob.cc<https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fAsyncJob.cc&c=E,1,0XdqwD1hHo1N94DousFFhRiwV1YBiWmgmGgnmN3ivpK14dkV-pET6DcSkS2X_BoPOU0rcff0Z8GMOM6Se71G_crDtF1V4AWKNym2mjdbxuqKI47TC0GqeVQ,&typo=1&ancr_add=1>(123) callStart: Http::Tunneler status in: [state:w FD 24 job3836]
2022/06/30 15:22:49.198 kid1| 83,3| Session.cc<https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fSession.cc&c=E,1,5pwOO8oysGpMl2UW2Xm5P9KkR_3HsM1xcAdWaqJ5W67u3ht9dZCWWqKu-yt1JrDyn7NvUNMMfVsPhYQQ6rNYqmGGLwDuReUm7h6KmDVvRXk9hFQ,&typo=1&ancr_add=1>(36) tls_read_method: started for session=0x55849f86d970
2022/06/30 15:22:49.198 kid1| 5,3| Read.cc<https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fRead.cc&c=E,1,YRndcJz2bAhwR1PdmoQI8sRvkmjGdcO5EIyIIpp4iqwmuG7h-eaf-3lfNBR39-ZO7iGAxJ7K0S_cHbSgNtNlm0fjWnm8WFDq58f6THu4DI699rCS7t0,&typo=1&ancr_add=1>(93) ReadNow: conn2126 local=10.56.1.3:59674<http://10.56.1.3:59674> remote=18.213.126.143:443<http://18.213.126.143:443> FIRSTUP_PARENT FD 24 flags=1, size 65535, retval 172, errno 0
2022/06/30 15:22:49.198 kid1| 11,2| HttpTunneler.cc<https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fHttpTunneler.cc&c=E,1,7NW0kgZsy7tR63h5jeGLIfWqkf7MZMOiNKoehdSMu4P8C_Cyj5_2ApYRUA6cZWFOqSGAjikQJc_BpXOW4-kzssgabw7mHmj9JehJw69jCPqdH0f2XA,,&typo=1&ancr_add=1>(328) handleResponse: Tunnel Server conn2126 local=10.56.1.3:59674<http://10.56.1.3:59674> remote=18.213.126.143:443<http://18.213.126.143:443> FIRSTUP_PARENT FD 24 flags=1
2022/06/30 15:22:49.198 kid1| 11,2| HttpTunneler.cc<https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fHttpTunneler.cc&c=E,1,3NizLysV5Gx9r_j5gTGoxUw_3T9zdjGtQ-DV4EhtvlwXKEzULXHluYnJByOJiEPPnVnNQqchSO6-31x_mXrtC-9VAHF1Rvi3G4KI9KdJOjbjUelpts2rPuVSNQ,,&typo=1&ancr_add=1>(329) handleResponse: Tunnel Server RESPONSE:
---------
HTTP/1.1 407 Proxy Authentication Required
Proxy-Authenticate: Basic realm="Secure Browsing"
Date: Thu, 30 Jun 2022 15:22:49 GMT
Content-Length: 0
Connection: close

----------
2022/06/30 15:22:49.198 kid1| 83,3| HttpTunneler.cc<https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fHttpTunneler.cc&c=E,1,GviZgdhx9RYhEwKjYE8dVgxbEl8iol-igCMYAgae4yqcKPIFswYtt6EwZhF84hnL-ef9RpuZwEHsx85Xll9B5Gfbg7d2dHfIF34rKZsAxv6qOdMumpxPDQ,,&typo=1&ancr_add=1>(350) bailOnResponseError: unsupported CONNECT response status code [state:w FD 24 job3836]
2022/06/30 15:22:49.198 kid1| TCP connection to gateway.goguardian.com/443<https://linkprotect.cudasvc.com/url?a=http%3a%2f%2fgateway.goguardian.com%2f443&c=E,1,uAPXOfc9RgeMJ4nUQAbfSdcSO5Uq43sRY-gZmY85itIayxn-UVioUUW3XRszjHa-yYb6rECJlsja0UO3JoB46gLeuYZSjXkRbee8lCx9qDg8UMVty1UFtdYA&typo=1> failed
    current master transaction: master1228
2022/06/30 15:22:49.198 kid1| 15,2| neighbors.cc<https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fneighbors.cc&c=E,1,A9XtxL5DCKCd251CIXugkhx4aCzF9hXbpTke-TobSR1fyAJvDoqwTFq1cEcOoZJtiMbGKIRMTAdNo4BJFSkXvu8VJe16TUWacR3bLvbydug1knZSGkBYCZ0,&typo=1&ancr_add=1>(1284) peerConnectFailedSilent: TCP connection to gateway.goguardian.com/443<https://linkprotect.cudasvc.com/url?a=http%3a%2f%2fgateway.goguardian.com%2f443&c=E,1,dGVDR_a1JorHZeL7cCLZZYEKPcdKNP8q3xqZrI0znu3mp7ytE8irVnBC73FhdcWJ5M0-LWIn2Mn0GzYRz6V0M_GYqDtl_rvKTY_dWhrXIAFI1UpgdRqKz0hp&typo=1> dead
2022/06/30 15:22:49.198 kid1| 5,3| comm.cc<https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fcomm.cc&c=E,1,_FSTyaiA0rkYHZ4Z7eAL4TwtVx69LC8zbzD277h9yuyffbapL47ZpB_oWH20eRbFct1TQy0vmI_r1caTRPIqNuxhiZ7iYIATofZyGH8m1ZkJn-_Pj74,&typo=1&ancr_add=1>(597) commUnsetConnTimeout: Remove timeout for conn2126 local=10.56.1.3:59674<http://10.56.1.3:59674> remote=18.213.126.143:443<http://18.213.126.143:443> FIRSTUP_PARENT FD 24 flags=1
2022/06/30 15:22:49.198 kid1| 5,3| comm.cc<https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fcomm.cc&c=E,1,2X_UeJ7syPVMh46zfITvmAcOXeJskvfXEcgk8IyJC4YzRQfPu92bh2NzVodZ0n4ZRK7THXkr0YSUqM7xqyqJCvdnyd9FAu6HfF5w6S0BZI45WZI8zKdCZe8,&typo=1&ancr_add=1>(571) commSetConnTimeout: conn2126 local=10.56.1.3:59674<http://10.56.1.3:59674> remote=18.213.126.143:443<http://18.213.126.143:443> FIRSTUP_PARENT FD 24 flags=1 timeout -1
2022/06/30 15:22:49.198 kid1| 5,3| comm.cc<https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fcomm.cc&c=E,1,FfkOe7rgvl24KtYbMnfkVwBEdxcDHC1Qli-TWnd49Qh8gDEi83POkLUjbin88NBj9wz0eUa5EXJAjwxomX4QO4zLvkDabeKXKYlG6AdnYeWwBQX65a999EDQfHg,&typo=1&ancr_add=1>(877) _comm_close: start closing FD 24 by Connection.cc:108<https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fConnection.cc%3a108&c=E,1,WyC_uIlGcAERUMOzZEzNpvTD0VNtdyMCu8_98mxi45Tfb8tS1Sk-xPVV7uo29dppxC6E7neNtZYKqy1MhMyuLt8f0VUXYaTTfg2ke0mgXESQjraUm9zxRlRV&typo=1&ancr_add=1>
2022/06/30 15:22:49.198 kid1| 5,3| comm.cc<https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fcomm.cc&c=E,1,3Gy87egR90ZnusSy5exBZU0res4kBdHXTtCKE_jPDFJ67k-PY9AWyJYQlbMs93MRcEX4tmriDwIFkUn6n7F57YT-OWPTUDgMXKLJDMijoQr3ETZ_4qmLyO3mxoc,&typo=1&ancr_add=1>(558) commUnsetFdTimeout: Remove timeout for FD 24



Best Regards,
Johnathan

_______________________________________________________

Johnathan Hasty
Senior DevOps Engineer
Uncommon Schools
C: 989.366.1672

Uncommon Schools | Change History
Website<https://linkprotect.cudasvc.com/url?a=http%3a%2f%2fwww.uncommonschools.org%2f&c=E,1,cWhZ9NA37cAb3SSkIYkr5EbwjBXA_1ECEBWI1BpFOMixjdXiqIYF5NH_rpjuRqGzBt9Av6GCLPt7UYFH62vFjyLlBBvmIAwJtSORWZeE&typo=1> | Facebook<http://www.facebook.com/uncommonschools> | Twitter<http://www.twitter.com/uncommonschools> | LinkedIn<http://www.linkedin.com/company/124759?trk=tyah> | Apply Now<https://linkprotect.cudasvc.com/url?a=http%3a%2f%2fwww.uncommonschools.org%2fcareers&c=E,1,rgbpQND7NOQlb8Jv2r2mLOBnCdzuRSxPkW0uIyooMP2TwhUotzeHZQjvRKQyUr3gDLWXSyG1jhOH92Ub7jL9_5wTQc42_HkbPCyQS5oyArE,&typo=1>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220715/c95d2906/attachment.htm>

From rousskov at measurement-factory.com  Fri Jul 15 13:59:31 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Fri, 15 Jul 2022 09:59:31 -0400
Subject: [squid-users] Connection reset and assertion failed
In-Reply-To: <CAJ1yAf+8jcHE=RwLJiGsExS0q006Bow73hRtMu3nLbRMU58Dzg@mail.gmail.com>
References: <CAJ1yAf+8jcHE=RwLJiGsExS0q006Bow73hRtMu3nLbRMU58Dzg@mail.gmail.com>
Message-ID: <351c54f9-8e5a-0902-9e23-82453a816c99@measurement-factory.com>

On 7/15/22 08:18, Thomas Dev wrote:

> currently, we are suffering from aborted downloads while going over
> squid. When I look into the ethernet traffic, I can see many TCP-rests
> by squid and in close timely relation to those resets I see messages
> like:
> 
> 2022/07/15 12:04:24 kid1| assertion failed: tunnel.cc:1227:
> "!waitingForConnectExchange"
>      current master transaction: master1178
> 
> in cache.log.
> 
> Are these tcp-resets related to the failed assertion 

That would be my working theory.


> and can I do something about it?

I would start with an upgrade to Squid v5.6 or later. Squid v5.2 has a 
set of bugs that make it unusable in most production environments, and 
some of those bugs may manifest in assertions similar to yours. Squid 
v5.6 retained only one of those bugs (bug 5186 -- fixed in master/v6).


HTH,

Alex.


> Server: physical Ubuntu 22.04 LTS
> 
> Squid Cache: Version 5.2
> Service Name: squid
> Ubuntu linux
> configure options:  '--build=x86_64-linux-gnu' '--prefix=/usr'
> '--includedir=${prefix}/include' '--mandir=${prefix}/share/man'
> '--infodir=${prefix}/share/info' '--sysconfdir=/etc'
> '--localstatedir=/var' '--disable-option-checking'
> '--disable-silent-rules' '--libdir=${prefix}/lib/x86_64-linux-gnu'
> '--runstatedir=/run' '--disable-maintainer-mode'
> '--disable-dependency-tracking' 'BUILDCXXFLAGS=-g -O2
> -ffile-prefix-map=/build/squid-DQ03Be/squid-5.2=. -flto=auto
> -ffat-lto-objects -flto=auto -ffat-lto-objects
> -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time
> -D_FORTIFY_SOURCE=2 -Wl,-Bsymbolic-functions -flto=auto
> -ffat-lto-objects -flto=auto -Wl,-z,relro -Wl,-z,now ' 'BUILDCXX=g++'
> '--with-build-environment=default' '--enable-build-info=Ubuntu linux'
> '--datadir=/usr/share/squid' '--sysconfdir=/etc/squid'
> '--libexecdir=/usr/lib/squid' '--mandir=/usr/share/man'
> '--enable-inline' '--disable-arch-native' '--enable-async-io=8'
> '--enable-storeio=ufs,aufs,diskd,rock'
> '--enable-removal-policies=lru,heap' '--enable-delay-pools'
> '--enable-cache-digests' '--enable-icap-client'
> '--enable-follow-x-forwarded-for'
> '--enable-auth-basic=DB,fake,getpwnam,LDAP,NCSA,PAM,POP3,RADIUS,SASL,SMB'
> '--enable-auth-digest=file,LDAP'
> '--enable-auth-negotiate=kerberos,wrapper'
> '--enable-auth-ntlm=fake,SMB_LM'
> '--enable-external-acl-helpers=file_userip,kerberos_ldap_group,LDAP_group,session,SQL_session,time_quota,unix_group,wbinfo_group'
> '--enable-security-cert-validators=fake'
> '--enable-storeid-rewrite-helpers=file'
> '--enable-url-rewrite-helpers=fake' '--enable-eui' '--enable-esi'
> '--enable-icmp' '--enable-zph-qos' '--enable-ecap'
> '--disable-translation' '--with-swapdir=/var/spool/squid'
> '--with-logdir=/var/log/squid' '--with-pidfile=/run/squid.pid'
> '--with-filedescriptors=65536' '--with-large-files'
> '--with-default-user=proxy' '--enable-linux-netfilter'
> '--with-systemd' '--with-gnutls' 'build_alias=x86_64-linux-gnu'
> 'CFLAGS=-g -O2 -ffile-prefix-map=/build/squid-DQ03Be/squid-5.2=.
> -flto=auto -ffat-lto-objects -flto=auto -ffat-lto-objects
> -fstack-protector-strong -Wformat -Werror=format-security -Wall'
> 'LDFLAGS=-Wl,-Bsymbolic-functions -flto=auto -ffat-lto-objects
> -flto=auto -Wl,-z,relro -Wl,-z,now ' 'CPPFLAGS=-Wdate-time
> -D_FORTIFY_SOURCE=2' 'CXXFLAGS=-g -O2
> -ffile-prefix-map=/build/squid-DQ03Be/squid-5.2=. -flto=auto
> -ffat-lto-objects -flto=auto -ffat-lto-objects
> -fstack-protector-strong -Wformat -Werror=format-security'
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



From rousskov at measurement-factory.com  Fri Jul 15 14:14:00 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Fri, 15 Jul 2022 10:14:00 -0400
Subject: [squid-users] Upstream Proxy
In-Reply-To: <MN2PR10MB4176DD2030DFE34D7C349F6CF78B9@MN2PR10MB4176.namprd10.prod.outlook.com>
References: <MN2PR10MB4176DD2030DFE34D7C349F6CF78B9@MN2PR10MB4176.namprd10.prod.outlook.com>
Message-ID: <61072e0a-43e2-6388-d121-8e433092513a@measurement-factory.com>

On 7/15/22 09:51, Johnathan Hasty wrote:

> I?ve been trying to hand off credentials to our upstream proxy 
> GoGuardian and have been facing many issues.

What HTTP authentication method(s) or scheme(s) does your upstream proxy 
support or require?


> HTTP/1.1 407 Proxy Authentication Required
> Proxy-Authenticate: Basic realm="Secure Browsing"

This is not my area of expertise, but the above error message suggests 
that the proxy wants to do HTTP Basic authentication, but you are 
configuring Squid to use NEGOTIATE, so perhaps you should switch to 
Basic as the next step in your triage, just to get something working 
(cache_peer ... login=user:password)?

Sharing what CONNECT request headers Squid sends to the parent proxy may 
be useful as well, but do not use any secrets in your test traffic if 
you are going to share such details. If you still have that cache.log, 
look for "Tunnel Server REQUEST" associated with conn2126.


HTH,

Alex.


> Has anyone gotten Squid to successfully hand off to GoGuardian as their 
> upstream proxy?
> 
> Advanced ACLs:
> cache_peer gateway.goguardian.com parent 443 0 no-query no-digest 
> no-netdb-exchange connect-timeout=60 default tls 
> login=NEGOTIATE:principal_name sslcapath=/usr/local/share/ca-certificates/
> 
> cache_peer_access gateway.goguardian.com allow all
> 
> never_direct allow all
> 
> Log snipit:
> 2022/06/30 15:22:49.198 kid1| 5,3| IoCallback.cc 
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fIoCallback.cc&c=E,1,tkT-dyHiVAqZoP7tVfxLk3RVYLyb_avXd27fXGqjJMTzNKPAGHmmvW9pXYcC425jST0ZYFFPwV4uHf3fKHuux40xkg9kXWTzOHPdGV5BNGbILyA,&typo=1&ancr_add=1>(112) 
> finish: called for conn2126 local=10.56.1.3:59674 
> <http://10.56.1.3:59674> remote=18.213.126.143:443 
> <http://18.213.126.143:443> FIRSTUP_PARENT FD 24 flags=1 (0, 0)
> 
> 2022/06/30 15:22:49.198 kid1| 93,3| AsyncCall.cc 
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fAsyncCall.cc&c=E,1,DRAaKArrkDvBn0UuKG4CO_yXvblIrZBSYHpMpA4H7oRhEraoEzGxMCRwZJpYUsTM63vFW1Co7R0A33jgXq0EZyS1JcelCRUFXLjE5tQ-siWuoU0bbvc,&typo=1&ancr_add=1>(96) 
> ScheduleCall: IoCallback.cc 
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fIoCallback.cc&c=E,1,bCxz0FVR5jkr6lvnOvzW7e6G8tQBNRlVCCbel3ASQC74rRdj29Wxcj66G7Jit7W9Qdbz8catGFZxEEbA6bR1lmzxqhKOAxPRfaraHkB0Kq0,&typo=1&ancr_add=1>(131) 
> will call Http::Tunneler::handleReadyRead(conn2126 local=10.56.1.3:59674 
> <http://10.56.1.3:59674> remote=18.213.126.143:443 
> <http://18.213.126.143:443> FIRSTUP_PARENT FD 24 flags=1, 
> data=0x55849f4926c8) [call548666]
> 
> 2022/06/30 15:22:49.198 kid1| 93,3| AsyncCallQueue.cc 
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fAsyncCallQueue.cc&c=E,1,Ne0y7JJW7fBc_1MyCR5zK2LlFshqIfjXRI-DDHdH5PeY44sZtFyGkRMXgYLpMqHYj17Z8PToa57tNyAfAp6EUkVwM3SHgK37ObzCJYBj&typo=1&ancr_add=1>(59) 
> fireNext: entering Http::Tunneler::handleReadyRead(conn2126 
> local=10.56.1.3:59674 <http://10.56.1.3:59674> remote=18.213.126.143:443 
> <http://18.213.126.143:443> FIRSTUP_PARENT FD 24 flags=1, 
> data=0x55849f4926c8)
> 
> 2022/06/30 15:22:49.198 kid1| 93,3| AsyncCall.cc 
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fAsyncCall.cc&c=E,1,o0OzDC7879yEvRQoXyqb11XnNW2f6RJwmh1OP5vYSK4ukmnOFcBmRwtorjA94HFXF2MO38TdGcH68cNv4LkX122TcPK1Gwh5xQXTTnzhZCk0N4c,&typo=1&ancr_add=1>(41) 
> make: make call Http::Tunneler::handleReadyRead [call548666]
> 
> 2022/06/30 15:22:49.198 kid1| 93,3| AsyncJob.cc 
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fAsyncJob.cc&c=E,1,0XdqwD1hHo1N94DousFFhRiwV1YBiWmgmGgnmN3ivpK14dkV-pET6DcSkS2X_BoPOU0rcff0Z8GMOM6Se71G_crDtF1V4AWKNym2mjdbxuqKI47TC0GqeVQ,&typo=1&ancr_add=1>(123) 
> callStart: Http::Tunneler status in: [state:w FD 24 job3836]
> 
> 2022/06/30 15:22:49.198 kid1| 83,3| Session.cc 
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fSession.cc&c=E,1,5pwOO8oysGpMl2UW2Xm5P9KkR_3HsM1xcAdWaqJ5W67u3ht9dZCWWqKu-yt1JrDyn7NvUNMMfVsPhYQQ6rNYqmGGLwDuReUm7h6KmDVvRXk9hFQ,&typo=1&ancr_add=1>(36) 
> tls_read_method: started for session=0x55849f86d970
> 
> 2022/06/30 15:22:49.198 kid1| 5,3| Read.cc 
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fRead.cc&c=E,1,YRndcJz2bAhwR1PdmoQI8sRvkmjGdcO5EIyIIpp4iqwmuG7h-eaf-3lfNBR39-ZO7iGAxJ7K0S_cHbSgNtNlm0fjWnm8WFDq58f6THu4DI699rCS7t0,&typo=1&ancr_add=1>(93) 
> ReadNow: conn2126 local=10.56.1.3:59674 <http://10.56.1.3:59674> 
> remote=18.213.126.143:443 <http://18.213.126.143:443> FIRSTUP_PARENT FD 
> 24 flags=1, size 65535, retval 172, errno 0
> 
> 2022/06/30 15:22:49.198 kid1| 11,2| HttpTunneler.cc 
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fHttpTunneler.cc&c=E,1,7NW0kgZsy7tR63h5jeGLIfWqkf7MZMOiNKoehdSMu4P8C_Cyj5_2ApYRUA6cZWFOqSGAjikQJc_BpXOW4-kzssgabw7mHmj9JehJw69jCPqdH0f2XA,,&typo=1&ancr_add=1>(328) 
> handleResponse: Tunnel Server conn2126 local=10.56.1.3:59674 
> <http://10.56.1.3:59674> remote=18.213.126.143:443 
> <http://18.213.126.143:443> FIRSTUP_PARENT FD 24 flags=1
> 
> 2022/06/30 15:22:49.198 kid1| 11,2| HttpTunneler.cc 
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fHttpTunneler.cc&c=E,1,3NizLysV5Gx9r_j5gTGoxUw_3T9zdjGtQ-DV4EhtvlwXKEzULXHluYnJByOJiEPPnVnNQqchSO6-31x_mXrtC-9VAHF1Rvi3G4KI9KdJOjbjUelpts2rPuVSNQ,,&typo=1&ancr_add=1>(329) 
> handleResponse: Tunnel Server RESPONSE:
> 
> ---------
> 
> HTTP/1.1 407 Proxy Authentication Required
> 
> Proxy-Authenticate: Basic realm="Secure Browsing"
> 
> Date: Thu, 30 Jun 2022 15:22:49 GMT
> 
> Content-Length: 0
> 
> Connection: close
> 
> ----------
> 
> 2022/06/30 15:22:49.198 kid1| 83,3| HttpTunneler.cc 
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fHttpTunneler.cc&c=E,1,GviZgdhx9RYhEwKjYE8dVgxbEl8iol-igCMYAgae4yqcKPIFswYtt6EwZhF84hnL-ef9RpuZwEHsx85Xll9B5Gfbg7d2dHfIF34rKZsAxv6qOdMumpxPDQ,,&typo=1&ancr_add=1>(350) 
> bailOnResponseError: unsupported CONNECT response status code [state:w 
> FD 24 job3836]
> 
> 2022/06/30 15:22:49.198 kid1| TCP connection to 
> gateway.goguardian.com/443 
> <https://linkprotect.cudasvc.com/url?a=http%3a%2f%2fgateway.goguardian.com%2f443&c=E,1,uAPXOfc9RgeMJ4nUQAbfSdcSO5Uq43sRY-gZmY85itIayxn-UVioUUW3XRszjHa-yYb6rECJlsja0UO3JoB46gLeuYZSjXkRbee8lCx9qDg8UMVty1UFtdYA&typo=1> 
> failed
> 
>  ??? current master transaction: master1228
> 
> 2022/06/30 15:22:49.198 kid1| 15,2| neighbors.cc 
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fneighbors.cc&c=E,1,A9XtxL5DCKCd251CIXugkhx4aCzF9hXbpTke-TobSR1fyAJvDoqwTFq1cEcOoZJtiMbGKIRMTAdNo4BJFSkXvu8VJe16TUWacR3bLvbydug1knZSGkBYCZ0,&typo=1&ancr_add=1>(1284) 
> peerConnectFailedSilent: TCP connection to gateway.goguardian.com/443 
> <https://linkprotect.cudasvc.com/url?a=http%3a%2f%2fgateway.goguardian.com%2f443&c=E,1,dGVDR_a1JorHZeL7cCLZZYEKPcdKNP8q3xqZrI0znu3mp7ytE8irVnBC73FhdcWJ5M0-LWIn2Mn0GzYRz6V0M_GYqDtl_rvKTY_dWhrXIAFI1UpgdRqKz0hp&typo=1> 
> dead
> 
> 2022/06/30 15:22:49.198 kid1| 5,3| comm.cc 
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fcomm.cc&c=E,1,_FSTyaiA0rkYHZ4Z7eAL4TwtVx69LC8zbzD277h9yuyffbapL47ZpB_oWH20eRbFct1TQy0vmI_r1caTRPIqNuxhiZ7iYIATofZyGH8m1ZkJn-_Pj74,&typo=1&ancr_add=1>(597) 
> commUnsetConnTimeout: Remove timeout for conn2126 local=10.56.1.3:59674 
> <http://10.56.1.3:59674> remote=18.213.126.143:443 
> <http://18.213.126.143:443> FIRSTUP_PARENT FD 24 flags=1
> 
> 2022/06/30 15:22:49.198 kid1| 5,3| comm.cc 
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fcomm.cc&c=E,1,2X_UeJ7syPVMh46zfITvmAcOXeJskvfXEcgk8IyJC4YzRQfPu92bh2NzVodZ0n4ZRK7THXkr0YSUqM7xqyqJCvdnyd9FAu6HfF5w6S0BZI45WZI8zKdCZe8,&typo=1&ancr_add=1>(571) 
> commSetConnTimeout: conn2126 local=10.56.1.3:59674 
> <http://10.56.1.3:59674> remote=18.213.126.143:443 
> <http://18.213.126.143:443> FIRSTUP_PARENT FD 24 flags=1 timeout -1
> 
> 2022/06/30 15:22:49.198 kid1| 5,3| comm.cc 
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fcomm.cc&c=E,1,FfkOe7rgvl24KtYbMnfkVwBEdxcDHC1Qli-TWnd49Qh8gDEi83POkLUjbin88NBj9wz0eUa5EXJAjwxomX4QO4zLvkDabeKXKYlG6AdnYeWwBQX65a999EDQfHg,&typo=1&ancr_add=1>(877) 
> _comm_close: start closing FD 24 by Connection.cc:108 
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fConnection.cc%3a108&c=E,1,WyC_uIlGcAERUMOzZEzNpvTD0VNtdyMCu8_98mxi45Tfb8tS1Sk-xPVV7uo29dppxC6E7neNtZYKqy1MhMyuLt8f0VUXYaTTfg2ke0mgXESQjraUm9zxRlRV&typo=1&ancr_add=1>
> 
> 2022/06/30 15:22:49.198 kid1| 5,3| comm.cc 
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fcomm.cc&c=E,1,3Gy87egR90ZnusSy5exBZU0res4kBdHXTtCKE_jPDFJ67k-PY9AWyJYQlbMs93MRcEX4tmriDwIFkUn6n7F57YT-OWPTUDgMXKLJDMijoQr3ETZ_4qmLyO3mxoc,&typo=1&ancr_add=1>(558) 
> commUnsetFdTimeout: Remove timeout for FD 24
> 
> 
> Best Regards,
> 
> Johnathan
> 
> *_______________________________________________________*
> 
> **
> 
> *Johnathan Hasty*
> 
> Senior DevOps Engineer
> 
> Uncommon Schools
> 
> C: 989.366.1672
> 
> *Un*common Schools | Change History
> 
> Website 
> <https://linkprotect.cudasvc.com/url?a=http%3a%2f%2fwww.uncommonschools.org%2f&c=E,1,cWhZ9NA37cAb3SSkIYkr5EbwjBXA_1ECEBWI1BpFOMixjdXiqIYF5NH_rpjuRqGzBt9Av6GCLPt7UYFH62vFjyLlBBvmIAwJtSORWZeE&typo=1>?| 
> Facebook <http://www.facebook.com/uncommonschools>?| Twitter 
> <http://www.twitter.com/uncommonschools>?| LinkedIn 
> <http://www.linkedin.com/company/124759?trk=tyah>?| Apply Now 
> <https://linkprotect.cudasvc.com/url?a=http%3a%2f%2fwww.uncommonschools.org%2fcareers&c=E,1,rgbpQND7NOQlb8Jv2r2mLOBnCdzuRSxPkW0uIyooMP2TwhUotzeHZQjvRKQyUr3gDLWXSyG1jhOH92Ub7jL9_5wTQc42_HkbPCyQS5oyArE,&typo=1>
> 
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



From Johnathan.Hasty at uncommonschools.org  Fri Jul 15 15:11:42 2022
From: Johnathan.Hasty at uncommonschools.org (Johnathan Hasty)
Date: Fri, 15 Jul 2022 15:11:42 +0000
Subject: [squid-users] Upstream Proxy
In-Reply-To: <61072e0a-43e2-6388-d121-8e433092513a@measurement-factory.com>
References: <MN2PR10MB4176DD2030DFE34D7C349F6CF78B9@MN2PR10MB4176.namprd10.prod.outlook.com>
 <61072e0a-43e2-6388-d121-8e433092513a@measurement-factory.com>
Message-ID: <MN2PR10MB4176574481B914DF816E175AF78B9@MN2PR10MB4176.namprd10.prod.outlook.com>

Hi Alex, thank you so much for the response!

I've changed to user:password and still face the same issues.

Here's Tunnel Server REQUEST from last 1024 lines

2022/07/15 14:55:52.281 kid1| 11,2| HttpTunneler.cc(177) writeRequest: Tunnel Server REQUEST: conn886 local=10.56.1.3:40264 remote=52.44.107.1:443 FIRSTUP_PARENT FD 12 flags=1:
2022/07/15 14:55:52.656 kid1| 11,2| HttpTunneler.cc(177) writeRequest: Tunnel Server REQUEST: conn898 local=10.56.1.3:41554 remote=18.213.126.143:443 FIRSTUP_PARENT FD 12 flags=1:






2022/07/15 14:55:52.736 kid1| 11,2| HttpTunneler.cc(328) handleResponse: Tunnel Server conn898 local=10.56.1.3:41554 remote=18.213.126.143:443 FIRSTUP_PARENT FD 12 flags=1
2022/07/15 14:55:52.736 kid1| 11,2| HttpTunneler.cc(329) handleResponse: Tunnel Server RESPONSE:
---------
HTTP/1.1 407 Proxy Authentication Required
Proxy-Authenticate: Basic realm="Secure Browsing"
Date: Fri, 15 Jul 2022 14:55:52 GMT
Content-Length: 0
Connection: close

----------
2022/07/15 14:55:52.736 kid1| 83,3| HttpTunneler.cc(350) bailOnResponseError: unsupported CONNECT response status code [state:w FD 12 job1778]
2022/07/15 14:55:52.736 kid1| TCP connection to gateway.goguardian.com/443 failed
    current master transaction: master584
2022/07/15 14:55:52.736 kid1| 5,3| comm.cc(597) commUnsetConnTimeout: Remove timeout for conn898 local=10.56.1.3:41554 remote=18.213.126.143:443 FIRSTUP_PARENT FD 12 flags=1
2022/07/15 14:55:52.736 kid1| 5,3| comm.cc(571) commSetConnTimeout: conn898 local=10.56.1.3:41554 remote=18.213.126.143:443 FIRSTUP_PARENT FD 12 flags=1 timeout -1









1657896950.569     75 10.125.15.10 NONE_NONE/200 0 CONNECT content-signature-2.cdn.mozilla.net:443 johnathan.hasty at USI.UNCOMMONSCHOOLS.ORG HIER_NONE/- - "ws-iid=191" "ws-mac=00:00:00:00:00:00" "ws-duration=144" "ws-timing=1" "ws-mtime=0" "ws-scanflags=63" "ws-categories=70368744177664" "ws-trusted=1" "ws-level=1" "ws-verdict=0" "ws-policy=default" "ws-member=default" "ws-module=2" "ws-msgtype=2" "ws-param1=None" "ws-param2=None" "ws-debug=None" "squid-gt-st=3252"
1657896950.575    215 10.125.15.10 TCP_MISS/407 314 GET http://detectportal.firefox.com/canonical.html johnathan.hasty at USI.UNCOMMONSCHOOLS.ORG FIRSTUP_PARENT/52.204.217.22 - "ws-iid=184" "ws-mac=00:00:00:00:00:00" "ws-duration=2864" "ws-timing=0" "ws-mtime=0" "ws-scanflags=63" "ws-categories=8589934592" "ws-trusted=0" "ws-level=1" "ws-verdict=0" "ws-policy=default" "ws-member=default" "ws-module=2" "ws-msgtype=3" "ws-param1=None" "ws-param2=None" "ws-debug=None" "squid-gt-st=3331"
1657896951.018    288 10.125.15.10 TCP_MISS/407 314 GET http://detectportal.firefox.com/canonical.html johnathan.hasty at USI.UNCOMMONSCHOOLS.ORG FIRSTUP_PARENT/52.204.217.22 - "ws-iid=194" "ws-mac=00:00:00:00:00:00" "ws-duration=445" "ws-timing=0" "ws-mtime=0" "ws-scanflags=63" "ws-categories=8589934592" "ws-trusted=0" "ws-level=1" "ws-verdict=0" "ws-policy=default" "ws-member=default" "ws-module=2" "ws-msgtype=3" "ws-param1=None" "ws-param2=None" "ws-debug=None" "squid-gt-st=334"
1657896951.082      2 10.125.15.10 TCP_DENIED/407 4390 GET http://detectportal.firefox.com/canonical.html - HIER_NONE/- text/html "ws-iid=-" "ws-mac=00:00:00:00:00:00" "ws-duration=-" "ws-timing=-" "ws-mtime=-" "ws-scanflags=-" "ws-categories=-" "ws-trusted=-" "ws-level=-" "ws-verdict=-" "ws-policy=-" "ws-member=-" "ws-module=-" "ws-msgtype=-" "ws-param1=-" "ws-param2=-" "ws-debug=-" "squid-gt-st=334"
1657896951.388    820 10.125.15.10 TCP_TUNNEL/407 0 CONNECT content-signature-2.cdn.mozilla.net:443 johnathan.hasty at USI.UNCOMMONSCHOOLS.ORG FIRSTUP_PARENT/18.213.126.143 - "ws-iid=192" "ws-mac=00:00:00:00:00:00" "ws-duration=65" "ws-timing=0" "ws-mtime=0" "ws-scanflags=63" "ws-categories=70368744177664" "ws-trusted=1" "ws-level=1" "ws-verdict=0" "ws-policy=default" "ws-member=default" "ws-module=2" "ws-msgtype=2" "ws-param1=None" "ws-param2=None" "ws-debug=None" "squid-gt-st=0"
1657896951.389      0 10.125.15.10 NONE_NONE/000 0 - error:transaction-end-before-headers - HIER_NONE/- - "ws-iid=-" "ws-mac=-" "ws-duration=-" "ws-timing=-" "ws-mtime=-" "ws-scanflags=-" "ws-categories=-" "ws-trusted=-" "ws-level=-" "ws-verdict=-" "ws-policy=-" "ws-member=-" "ws-module=-" "ws-msgtype=-" "ws-param1=-" "ws-param2=-" "ws-debug=-" "squid-gt-st=517"
1657896951.468    211 10.125.15.10 TCP_MISS/407 314 GET http://detectportal.firefox.com/canonical.html johnathan.hasty at USI.UNCOMMONSCHOOLS.ORG FIRSTUP_PARENT/52.204.217.22 - "ws-iid=196" "ws-mac=00:00:00:00:00:00" "ws-duration=448" "ws-timing=0" "ws-mtime=0" "ws-scanflags=63" "ws-categories=8589934592" "ws-trusted=0" "ws-level=1" "ws-verdict=0" "ws-policy=default" "ws-member=default" "ws-module=2" "ws-msgtype=3" "ws-param1=None" "ws-param2=None" "ws-debug=None" "squid-gt-st=3331"




Best Regards,?
Johnathan
?
_______________________________________________________?
??
Johnathan Hasty?
Senior DevOps Engineer?
Uncommon Schools?
C: 989.366.1672?
??
Uncommon Schools | Change History?
Website?|?Facebook?|?Twitter?|?LinkedIn?|?Apply Now?

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Alex Rousskov
Sent: Friday, July 15, 2022 10:14 AM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Upstream Proxy

On 7/15/22 09:51, Johnathan Hasty wrote:

> I?ve been trying to hand off credentials to our upstream proxy 
> GoGuardian and have been facing many issues.

What HTTP authentication method(s) or scheme(s) does your upstream proxy support or require?


> HTTP/1.1 407 Proxy Authentication Required
> Proxy-Authenticate: Basic realm="Secure Browsing"

This is not my area of expertise, but the above error message suggests that the proxy wants to do HTTP Basic authentication, but you are configuring Squid to use NEGOTIATE, so perhaps you should switch to Basic as the next step in your triage, just to get something working (cache_peer ... login=user:password)?

Sharing what CONNECT request headers Squid sends to the parent proxy may be useful as well, but do not use any secrets in your test traffic if you are going to share such details. If you still have that cache.log, look for "Tunnel Server REQUEST" associated with conn2126.


HTH,

Alex.


> Has anyone gotten Squid to successfully hand off to GoGuardian as 
> their upstream proxy?
>
> Advanced ACLs:
> cache_peer 
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fgateway.goguardian
> .com&c=E,1,4mgHTezdkg3XvogUnlMp7R_aPvVQ_k4b-ypUDY-r87n90TNewVfWO2G7yD8
> KkbTZsmGhDBWiU-1QXOx9rTzbo3OKnuac4cWw9FtJNrmREkILe6q5FyICs2IE&typo=1 
> parent 443 0 no-query no-digest no-netdb-exchange connect-timeout=60 
> default tls login=NEGOTIATE:principal_name 
> sslcapath=/usr/local/share/ca-certificates/
>
> cache_peer_access 
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fgateway.goguardian
> .com&c=E,1,tXvnr1Bt31o7q-hOKeOXTPxzXW9DCW5ZYUwuJ7_zipiM8d7kDnxhExjas6S
> ZtisCB5rLGfXHr7wV5cw2SA_mQkr1n51atsqVDx1MnZZDHTRyJzW3bUc,&typo=1 allow 
> all
>
> never_direct allow all
>
> Log snipit:
> 2022/06/30 15:22:49.198 kid1| 5,3| 
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fIoCallback.cc&c=E,
> 1,wvOZEJacIjm7MMfIw4zokPxqyPEbXkGtlZd2OjPZnBaBwKYd4JhEY7iqqSOFpOEQkLML
> LliW5vfaXpVJZzleoEi_t79ZlTQE310p_aOzboKLmD8,&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fIoCallback.cc&c=E
> ,1,tkT-dyHiVAqZoP7tVfxLk3RVYLyb_avXd27fXGqjJMTzNKPAGHmmvW9pXYcC425jST0
> ZYFFPwV4uHf3fKHuux40xkg9kXWTzOHPdGV5BNGbILyA,&typo=1&ancr_add=1>(112)
> finish: called for conn2126 local=10.56.1.3:59674 
> <http://10.56.1.3:59674> remote=18.213.126.143:443 
> <http://18.213.126.143:443> FIRSTUP_PARENT FD 24 flags=1 (0, 0)
>
> 2022/06/30 15:22:49.198 kid1| 93,3| 
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fAsyncCall.cc&c=E,1
> ,_WyCB5FW8TPrE8VlwBDvbPPARxLAWIrkTCRh_yGS49ECyfGVDnBZtgXtv-rdu8B0ze3XP
> Z3nmMQ54CyPGOek_nP2SCr-pr0gbcacRhSqdvzu&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fAsyncCall.cc&c=E,
> 1,DRAaKArrkDvBn0UuKG4CO_yXvblIrZBSYHpMpA4H7oRhEraoEzGxMCRwZJpYUsTM63vF
> W1Co7R0A33jgXq0EZyS1JcelCRUFXLjE5tQ-siWuoU0bbvc,&typo=1&ancr_add=1>(96
> )
> ScheduleCall: 
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fIoCallback.cc&c=E,
> 1,CLrXyrjHJJLEUyDzFLyORoYkOc6dPPoPy8mcoj1pWEKli7eNc4SROUZ17OioxqFJZTmw
> KRRZPrkGHOKwEkKLPrjc6G5CJ49ccON5eC_SpzBM9RV52CvFHg,,&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fIoCallback.cc&c=E
> ,1,bCxz0FVR5jkr6lvnOvzW7e6G8tQBNRlVCCbel3ASQC74rRdj29Wxcj66G7Jit7W9Qdb
> z8catGFZxEEbA6bR1lmzxqhKOAxPRfaraHkB0Kq0,&typo=1&ancr_add=1>(131)
> will call Http::Tunneler::handleReadyRead(conn2126 
> local=10.56.1.3:59674 <http://10.56.1.3:59674> 
> remote=18.213.126.143:443 <http://18.213.126.143:443> FIRSTUP_PARENT 
> FD 24 flags=1,
> data=0x55849f4926c8) [call548666]
>
> 2022/06/30 15:22:49.198 kid1| 93,3| 
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fAsyncCallQueue.cc&
> c=E,1,UGKeO2qrCPs6m2GXyLlhHHkuRUPt2cGShW7xdl1TzFHGzrrU9aCKd6DcFICzKY0F
> 2-1vU7bOY71MSvAXS0vdAxZGyOUU9cucfyHU4997ePtvtjXY1YJx&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fAsyncCallQueue.cc
> &c=E,1,Ne0y7JJW7fBc_1MyCR5zK2LlFshqIfjXRI-DDHdH5PeY44sZtFyGkRMXgYLpMqH
> Yj17Z8PToa57tNyAfAp6EUkVwM3SHgK37ObzCJYBj&typo=1&ancr_add=1>(59)
> fireNext: entering Http::Tunneler::handleReadyRead(conn2126
> local=10.56.1.3:59674 <http://10.56.1.3:59674> 
> remote=18.213.126.143:443 <http://18.213.126.143:443> FIRSTUP_PARENT 
> FD 24 flags=1,
> data=0x55849f4926c8)
>
> 2022/06/30 15:22:49.198 kid1| 93,3| 
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fAsyncCall.cc&c=E,1
> ,0QLPJSskintC4NgwcvTUsoIWjY3qwFYZUU1K2zkIbJ9ApLohmZ0jnOQwLqm3rvsIX3QvY
> mtEc3ULAUby0qHSuTA6kfd_J5THUpYmykwPyyr9jlJi&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fAsyncCall.cc&c=E,
> 1,o0OzDC7879yEvRQoXyqb11XnNW2f6RJwmh1OP5vYSK4ukmnOFcBmRwtorjA94HFXF2MO
> 38TdGcH68cNv4LkX122TcPK1Gwh5xQXTTnzhZCk0N4c,&typo=1&ancr_add=1>(41)
> make: make call Http::Tunneler::handleReadyRead [call548666]
>
> 2022/06/30 15:22:49.198 kid1| 93,3| 
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fAsyncJob.cc&c=E,1,
> cutfUKQzcFc8e83JGLpUqZzQ5vCaW2rceWZI6_tL1mRPFEUxoNV2bmGFagx9y3wKCmcjXf
> T9VZ4000RPweRM3s91K0PDFBkVEIn0GzE2gdmQctpotwQ,&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fAsyncJob.cc&c=E,1
> ,0XdqwD1hHo1N94DousFFhRiwV1YBiWmgmGgnmN3ivpK14dkV-pET6DcSkS2X_BoPOU0rc
> ff0Z8GMOM6Se71G_crDtF1V4AWKNym2mjdbxuqKI47TC0GqeVQ,&typo=1&ancr_add=1>
> (123)
> callStart: Http::Tunneler status in: [state:w FD 24 job3836]
>
> 2022/06/30 15:22:49.198 kid1| 83,3| 
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fSession.cc&c=E,1,p
> 7LN0t2ClO-5Nl7j3E3wm40eWwqhcGz_6XzDNmr0Y75br1dSliqvHiNj1GUhOu6kNMD5SgJ
> 3gF_MOIcA9eubIR_v1k918fdLhCAgE1mGDPTKBVSZJr0,&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fSession.cc&c=E,1,
> 5pwOO8oysGpMl2UW2Xm5P9KkR_3HsM1xcAdWaqJ5W67u3ht9dZCWWqKu-yt1JrDyn7NvUN
> MMfVsPhYQQ6rNYqmGGLwDuReUm7h6KmDVvRXk9hFQ,&typo=1&ancr_add=1>(36)
> tls_read_method: started for session=0x55849f86d970
>
> 2022/06/30 15:22:49.198 kid1| 5,3| 
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fRead.cc&c=E,1,yB97
> lUNthiucTCUWsSMfvAziT5CLZb1OZogmu8ScWQnCNzUbYMQw1Zbn2OccWJTYDMmlA6u5-3
> vkeWyX6fQZOx1KGAdNoCK6r23yucjU&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fRead.cc&c=E,1,YRn
> dcJz2bAhwR1PdmoQI8sRvkmjGdcO5EIyIIpp4iqwmuG7h-eaf-3lfNBR39-ZO7iGAxJ7K0
> S_cHbSgNtNlm0fjWnm8WFDq58f6THu4DI699rCS7t0,&typo=1&ancr_add=1>(93)
> ReadNow: conn2126 local=10.56.1.3:59674 <http://10.56.1.3:59674>
> remote=18.213.126.143:443 <http://18.213.126.143:443> FIRSTUP_PARENT 
> FD
> 24 flags=1, size 65535, retval 172, errno 0
>
> 2022/06/30 15:22:49.198 kid1| 11,2| 
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fHttpTunneler.cc&c=
> E,1,qiS1pPbfXZ_Aobf_tcSVbmPX5IRTWWzk7rZklKhiXmyryzKUOjlZnh25vZMqWotwsh
> BOfFMiyTiQ2vxFbWn1PAo4Nk9yKW8OYdXAkAEpZg2YDOH4Jb4Fxtuu&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fHttpTunneler.cc&c
> =E,1,7NW0kgZsy7tR63h5jeGLIfWqkf7MZMOiNKoehdSMu4P8C_Cyj5_2ApYRUA6cZWFOq
> SGAjikQJc_BpXOW4-kzssgabw7mHmj9JehJw69jCPqdH0f2XA,,&typo=1&ancr_add=1>
> (328)
> handleResponse: Tunnel Server conn2126 local=10.56.1.3:59674 
> <http://10.56.1.3:59674> remote=18.213.126.143:443 
> <http://18.213.126.143:443> FIRSTUP_PARENT FD 24 flags=1
>
> 2022/06/30 15:22:49.198 kid1| 11,2| 
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fHttpTunneler.cc&c=
> E,1,yOUqRcgTyDqJM4As1g9no_2ivGGU2GU0PGsvC0nQjDk9PDDcutm2vFsyn3JmbEXXs1
> HYXQGoS7iH5h6BRNLNShj9pIEFQzE6dYrY1Eqblw2VBYg,&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fHttpTunneler.cc&c
> =E,1,3NizLysV5Gx9r_j5gTGoxUw_3T9zdjGtQ-DV4EhtvlwXKEzULXHluYnJByOJiEPPn
> VnNQqchSO6-31x_mXrtC-9VAHF1Rvi3G4KI9KdJOjbjUelpts2rPuVSNQ,,&typo=1&anc
> r_add=1>(329)
> handleResponse: Tunnel Server RESPONSE:
>
> ---------
>
> HTTP/1.1 407 Proxy Authentication Required
>
> Proxy-Authenticate: Basic realm="Secure Browsing"
>
> Date: Thu, 30 Jun 2022 15:22:49 GMT
>
> Content-Length: 0
>
> Connection: close
>
> ----------
>
> 2022/06/30 15:22:49.198 kid1| 83,3| 
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fHttpTunneler.cc&c=
> E,1,pufqpHpI8C7rAUfy9Tq2mNp2OZ1XMTAI6fkixf_-ua2kK8YpFPUMWFzh0rWHf9g0Ws
> uV3pIArjpDXfXhm2XC6M9Irhro_TxF-__TcOmuBGULF-f070nvp3mjpLM,&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fHttpTunneler.cc&c
> =E,1,GviZgdhx9RYhEwKjYE8dVgxbEl8iol-igCMYAgae4yqcKPIFswYtt6EwZhF84hnL-
> ef9RpuZwEHsx85Xll9B5Gfbg7d2dHfIF34rKZsAxv6qOdMumpxPDQ,,&typo=1&ancr_ad
> d=1>(350)
> bailOnResponseError: unsupported CONNECT response status code [state:w 
> FD 24 job3836]
>
> 2022/06/30 15:22:49.198 kid1| TCP connection to
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2f%2f%2fgateway.gogu
> ardian.com%2f443&c=E,1,UusqMjgeT_UOKD1S9PrgXx6upenAYP-hT7yGJTEnspLqlnS
> awFcJbipDzT1VUHjpy2b-j-nAl50SEUaFLAkQda-Y8KqaSsR9kCUbXTeurg,,&typo=1
> <https://linkprotect.cudasvc.com/url?a=http%3a%2f%2fgateway.goguardian
> .com%2f443&c=E,1,uAPXOfc9RgeMJ4nUQAbfSdcSO5Uq43sRY-gZmY85itIayxn-UVioU
> UW3XRszjHa-yYb6rECJlsja0UO3JoB46gLeuYZSjXkRbee8lCx9qDg8UMVty1UFtdYA&ty
> po=1>
> failed
>
>      current master transaction: master1228
>
> 2022/06/30 15:22:49.198 kid1| 15,2| 
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fneighbors.cc&c=E,1
> ,9ofiQEX_0QnggaY8xoZN6SuZPZwmqJoD1GNQ655oW2gywmEKyxLVKHrM4Ac6gBgcTtgDb
> uQcMGF0tup6n1llH-TGgGu4Ts6AJeKlaza1vvG52A1mXJmoxnRvCQ,,&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fneighbors.cc&c=E,
> 1,A9XtxL5DCKCd251CIXugkhx4aCzF9hXbpTke-TobSR1fyAJvDoqwTFq1cEcOoZJtiMbG
> KIRMTAdNo4BJFSkXvu8VJe16TUWacR3bLvbydug1knZSGkBYCZ0,&typo=1&ancr_add=1
> >(1284)
> peerConnectFailedSilent: TCP connection to 
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2f%2f%2fgateway.gogu
> ardian.com%2f443&c=E,1,is4BqJ6V4Qdfc04VYlolwa5QuKFNfTygVBDVwtBqmsf41gL
> UQI3CKcnxrF9sHxTsXgK3UQPazoH2N4bwj7wGWZ4IFpRpHOrLTaHLEg3riYlP&typo=1
> <https://linkprotect.cudasvc.com/url?a=http%3a%2f%2fgateway.goguardian
> .com%2f443&c=E,1,dGVDR_a1JorHZeL7cCLZZYEKPcdKNP8q3xqZrI0znu3mp7ytE8irV
> nBC73FhdcWJ5M0-LWIn2Mn0GzYRz6V0M_GYqDtl_rvKTY_dWhrXIAFI1UpgdRqKz0hp&ty
> po=1>
> dead
>
> 2022/06/30 15:22:49.198 kid1| 5,3| 
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fcomm.cc&c=E,1,wVzz
> fX9UMqeQdfmj9Yh-eEQTkXfgpAsRIs1xVjE6wsFdGqLtci-hbG5hqOsir3jaz800ooUnT6
> 02gcZzpoNCotYfELUz8GbehnzI-szfn_9t4ygswhCtKyiXsKtO&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fcomm.cc&c=E,1,_FS
> TyaiA0rkYHZ4Z7eAL4TwtVx69LC8zbzD277h9yuyffbapL47ZpB_oWH20eRbFct1TQy0vm
> I_r1caTRPIqNuxhiZ7iYIATofZyGH8m1ZkJn-_Pj74,&typo=1&ancr_add=1>(597)
> commUnsetConnTimeout: Remove timeout for conn2126 
> local=10.56.1.3:59674 <http://10.56.1.3:59674> 
> remote=18.213.126.143:443 <http://18.213.126.143:443> FIRSTUP_PARENT 
> FD 24 flags=1
>
> 2022/06/30 15:22:49.198 kid1| 5,3| 
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fcomm.cc&c=E,1,6_Om
> _qoW-p_W0CpO2EJHb7WhzwjJyFKkENF0xzjkBzWhiNEeuxQa8cl337nnoOOK7tey-YPgOv
> tYw-Asoq_RGiBrHLG1-3UZX9uG33SD1of4jv5b7QjHUPI,&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fcomm.cc&c=E,1,2X_
> UeJ7syPVMh46zfITvmAcOXeJskvfXEcgk8IyJC4YzRQfPu92bh2NzVodZ0n4ZRK7THXkr0
> YSUqM7xqyqJCvdnyd9FAu6HfF5w6S0BZI45WZI8zKdCZe8,&typo=1&ancr_add=1>(571
> )
> commSetConnTimeout: conn2126 local=10.56.1.3:59674 
> <http://10.56.1.3:59674> remote=18.213.126.143:443 
> <http://18.213.126.143:443> FIRSTUP_PARENT FD 24 flags=1 timeout -1
>
> 2022/06/30 15:22:49.198 kid1| 5,3| 
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fcomm.cc&c=E,1,f3jm
> C5svmDm2UMZPFo_bJ6TZqPvD1V85OGT0cw_YxUApcig2_G0CQ5uf8vaKUSpMHT2E-flXvO
> 3DJ81-xeFxHAoC3qOIK7wJYSws9qhHhgSW1R8n3Slt&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fcomm.cc&c=E,1,Ffk
> Oe7rgvl24KtYbMnfkVwBEdxcDHC1Qli-TWnd49Qh8gDEi83POkLUjbin88NBj9wz0eUa5E
> XJAjwxomX4QO4zLvkDabeKXKYlG6AdnYeWwBQX65a999EDQfHg,&typo=1&ancr_add=1>
> (877)
> _comm_close: start closing FD 24 by 
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fConnection.cc%3a10
> 8&c=E,1,p118dKeMyqtNGmJDUQfl3bqlowxip-f5vvzF5BGVoRt6v1MWaolkRXvJ3Ptu_b
> DI934lLcugy51gOKePiLt9X39tc9I-WvaSTfDN4UnHRAU,&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fConnection.cc%3a1
> 08&c=E,1,WyC_uIlGcAERUMOzZEzNpvTD0VNtdyMCu8_98mxi45Tfb8tS1Sk-xPVV7uo29
> dppxC6E7neNtZYKqy1MhMyuLt8f0VUXYaTTfg2ke0mgXESQjraUm9zxRlRV&typo=1&anc
> r_add=1>
>
> 2022/06/30 15:22:49.198 kid1| 5,3| 
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fcomm.cc&c=E,1,4wEE
> ydLqZtbeDc5YHCkgy5GsRjJ3_cLzlCGjyzHOV-hTEVEIsy3mNyF5ICP27wwTmSGp6ze8y2
> vdbqkthwhZqwWvH_jduoEypTSS0y2ytmL7&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fcomm.cc&c=E,1,3Gy
> 87egR90ZnusSy5exBZU0res4kBdHXTtCKE_jPDFJ67k-PY9AWyJYQlbMs93MRcEX4tmriD
> wIFkUn6n7F57YT-OWPTUDgMXKLJDMijoQr3ETZ_4qmLyO3mxoc,&typo=1&ancr_add=1>
> (558)
> commUnsetFdTimeout: Remove timeout for FD 24
>
>
> Best Regards,
>
> Johnathan
>
> *_______________________________________________________*
>
> **
>
> *Johnathan Hasty*
>
> Senior DevOps Engineer
>
> Uncommon Schools
>
> C: 989.366.1672
>
> *Un*common Schools | Change History
>
> Website
> <https://linkprotect.cudasvc.com/url?a=http%3a%2f%2fwww.uncommonschool
> s.org%2f&c=E,1,cWhZ9NA37cAb3SSkIYkr5EbwjBXA_1ECEBWI1BpFOMixjdXiqIYF5NH
> _rpjuRqGzBt9Av6GCLPt7UYFH62vFjyLlBBvmIAwJtSORWZeE&typo=1>?| Facebook 
> <http://www.facebook.com/uncommonschools>?| Twitter 
> <http://www.twitter.com/uncommonschools>?| LinkedIn 
> <http://www.linkedin.com/company/124759?trk=tyah>?| Apply Now 
> <https://linkprotect.cudasvc.com/url?a=http%3a%2f%2fwww.uncommonschool
> s.org%2fcareers&c=E,1,rgbpQND7NOQlb8Jv2r2mLOBnCdzuRSxPkW0uIyooMP2TwhUo
> tzeHZQjvRKQyUr3gDLWXSyG1jhOH92Ub7jL9_5wTQc42_HkbPCyQS5oyArE,&typo=1>
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> https://linkprotect.cudasvc.com/url?a=http%3a%2f%2flists.squid-cache.o
> rg%2flistinfo%2fsquid-users&c=E,1,J4_sclj9gC817Tmu9bhrA3OR4TSSruJYfYUM
> 6RkEXWZjj9XbwbXxgeS2yApz2pngh07velawZHPZD2mJFvgfC8P764tli3XXTMvKbYgp&t
> ypo=1

_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
https://linkprotect.cudasvc.com/url?a=http%3a%2f%2flists.squid-cache.org%2flistinfo%2fsquid-users&c=E,1,6nL_4Gs08LWJUKqb_q0ngPSzWGNPU1hDuBFl2fe6WS9B5z0mUCKS0CWyT3EUxoD8qdoRz_4UaAxr3vVuAUQCLDB05Yj639MDRp6MdlpX_jSXFtjL1Z2wKw,,&typo=1
CAUTION : This email originated from outside of the organization. Do not click links or open attachments unless you recognize the sender and know the content is safe.


From Johnathan.Hasty at uncommonschools.org  Fri Jul 15 15:24:56 2022
From: Johnathan.Hasty at uncommonschools.org (Johnathan Hasty)
Date: Fri, 15 Jul 2022 15:24:56 +0000
Subject: [squid-users] Upstream Proxy
In-Reply-To: <MN2PR10MB4176574481B914DF816E175AF78B9@MN2PR10MB4176.namprd10.prod.outlook.com>
References: <MN2PR10MB4176DD2030DFE34D7C349F6CF78B9@MN2PR10MB4176.namprd10.prod.outlook.com>
 <61072e0a-43e2-6388-d121-8e433092513a@measurement-factory.com>
 <MN2PR10MB4176574481B914DF816E175AF78B9@MN2PR10MB4176.namprd10.prod.outlook.com>
Message-ID: <MN2PR10MB41760F3B049E5D13F4C40E4AF78B9@MN2PR10MB4176.namprd10.prod.outlook.com>

My apologies, I just realized the change to user:password wasn't in effect. With that change in effect, the same issue arises:



2022/07/15 15:18:52.583 kid1| 11,2| HttpTunneler.cc(328) handleResponse: Tunnel Server conn714 local=10.56.1.3:41778 remote=18.213.126.143:443 FIRSTUP_PARENT FD 16 flags=1
2022/07/15 15:18:52.583 kid1| 11,2| HttpTunneler.cc(329) handleResponse: Tunnel Server RESPONSE:
---------
HTTP/1.1 407 Proxy Authentication Required
Proxy-Authenticate: Basic realm="Secure Browsing"
Date: Fri, 15 Jul 2022 15:18:52 GMT
Content-Length: 0
Connection: close

----------
2022/07/15 15:18:52.583 kid1| 83,3| HttpTunneler.cc(350) bailOnResponseError: unsupported CONNECT response status code [state:w FD 16 job1409]
2022/07/15 15:18:52.583 kid1| TCP connection to gateway.goguardian.com/443 failed
    current master transaction: master457




Tunnel Server REQUEST is not found in the last 1024 lines of the cache.




657898392.220    119 10.125.15.10 TCP_TUNNEL/407 0 CONNECT aus5.mozilla.org:443 johnathan.hasty at USI.UNCOMMONSCHOOLS.ORG FIRSTUP_PARENT/52.204.217.22 - "ws-iid=187" "ws-mac=00:00:00:00:00:00" "ws-duration=59" "ws-timing=0" "ws-mtime=0" "ws-scanflags=63" "ws-categories=70368744177664" "ws-trusted=1" "ws-level=1" "ws-verdict=0" "ws-policy=default" "ws-member=default" "ws-module=2" "ws-msgtype=2" "ws-param1=None" "ws-param2=None" "ws-debug=None" "squid-gt-st=0"
1657898392.220      0 10.125.15.10 NONE_NONE/000 0 - error:transaction-end-before-headers - HIER_NONE/- - "ws-iid=-" "ws-mac=-" "ws-duration=-" "ws-timing=-" "ws-mtime=-" "ws-scanflags=-" "ws-categories=-" "ws-trusted=-" "ws-level=-" "ws-verdict=-" "ws-policy=-" "ws-member=-" "ws-module=-" "ws-msgtype=-" "ws-param1=-" "ws-param2=-" "ws-debug=-" "squid-gt-st=197"
1657898428.972    274 10.125.15.10 TCP_MISS/407 314 GET http://detectportal.firefox.com/canonical.html johnathan.hasty at USI.UNCOMMONSCHOOLS.ORG FIRSTUP_PARENT/52.204.217.22 - "ws-iid=186" "ws-mac=00:00:00:00:00:00" "ws-duration=59831" "ws-timing=0" "ws-mtime=0" "ws-scanflags=63" "ws-categories=8589934592" "ws-trusted=0" "ws-level=1" "ws-verdict=0" "ws-policy=default" "ws-member=default" "ws-module=2" "ws-msgtype=3" "ws-param1=None" "ws-param2=None" "ws-debug=None" "squid-gt-st=334"
1657898429.063     22 10.125.15.10 TCP_MISS/407 314 GET http://detectportal.firefox.com/canonical.html johnathan.hasty at USI.UNCOMMONSCHOOLS.ORG FIRSTUP_PARENT/52.204.217.22 - "ws-iid=190" "ws-mac=00:00:00:00:00:00" "ws-duration=90" "ws-timing=0" "ws-mtime=0" "ws-scanflags=63" "ws-categories=8589934592" "ws-trusted=0" "ws-level=1" "ws-verdict=0" "ws-policy=default" "ws-member=default" "ws-module=2" "ws-msgtype=3" "ws-param1=None" "ws-param2=None" "ws-debug=None" "squid-gt-st=334"




This is new, now that basic auth is being used:


2022/07/15 15:23:22.652 kid1| 11,2| HttpTunneler.cc(177) writeRequest: Tunnel Server REQUEST: conn858 local=10.56.1.3:40518 remote=52.44.107.1:443 FIRSTUP_PARENT FD 12 flags=1:
----------
CONNECT spocs.getpocket.com:443 HTTP/1.1
Host: spocs.getpocket.com:443
Via: 1.1 poc-websafety.usi.uncommonschools.org (squid/5.5)
X-Forwarded-For: 10.125.15.10
Proxy-Authorization: Basic [redacted]
Cache-Control: max-age=259200
Connection: close


----------


Best Regards,?
Johnathan
?
_______________________________________________________?
??
Johnathan Hasty?
Senior DevOps Engineer?
Uncommon Schools?
C: 989.366.1672?
??
Uncommon Schools | Change History?
Website?|?Facebook?|?Twitter?|?LinkedIn?|?Apply Now?

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Johnathan Hasty
Sent: Friday, July 15, 2022 11:12 AM
To: Alex Rousskov <rousskov at measurement-factory.com>; squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Upstream Proxy

Hi Alex, thank you so much for the response!

I've changed to user:password and still face the same issues.

Here's Tunnel Server REQUEST from last 1024 lines

2022/07/15 14:55:52.281 kid1| 11,2| https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fHttpTunneler.cc&c=E,1,Z9dzp5fOyrtq9H8SuN_kjWUwA9meKEw9YTNtJOtZVua0QbLoGTcYZB0Juot-nDUHTBGxoVRIL66C5TwGbWyaIFcbtuVTOJ8OQJBO20Yw&typo=1(177) writeRequest: Tunnel Server REQUEST: conn886 local=10.56.1.3:40264 remote=52.44.107.1:443 FIRSTUP_PARENT FD 12 flags=1:
2022/07/15 14:55:52.656 kid1| 11,2| https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fHttpTunneler.cc&c=E,1,HY07zjejV4QLH46NO0UbipDxK32eEyC-_XWuIrR56wOokWY-W6vp5jCHPesccsEACLeQmAh8tZaTWiB4Pxj5mMRuXoW4kvIxV6tFCfs-bQzMmVyBFTZr&typo=1(177) writeRequest: Tunnel Server REQUEST: conn898 local=10.56.1.3:41554 remote=18.213.126.143:443 FIRSTUP_PARENT FD 12 flags=1:






2022/07/15 14:55:52.736 kid1| 11,2| https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fHttpTunneler.cc&c=E,1,on0TtYjsox8RcNeGWrDAl740DeE4uLoTByykbkBq42LUtj0Sry9O6BgaZIYYr1hYC488GKo6Mj2WJOMXP_1t-Mb0SAYPJZo24YeWRjHkBs1e&typo=1(328) handleResponse: Tunnel Server conn898 local=10.56.1.3:41554 remote=18.213.126.143:443 FIRSTUP_PARENT FD 12 flags=1
2022/07/15 14:55:52.736 kid1| 11,2| https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fHttpTunneler.cc&c=E,1,gHGxITMcEdqRsSj7pIyD37m9ggrul1QhDGuEvGiY8VhK8PyNJgJ-GrMOe-Y2P22_PgWhQ74-Jd3khuClFNFesAh5mQdLkylOM39HidSecLGnP7yqMg,,&typo=1(329) handleResponse: Tunnel Server RESPONSE:
---------
HTTP/1.1 407 Proxy Authentication Required
Proxy-Authenticate: Basic realm="Secure Browsing"
Date: Fri, 15 Jul 2022 14:55:52 GMT
Content-Length: 0
Connection: close

----------
2022/07/15 14:55:52.736 kid1| 83,3| https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fHttpTunneler.cc&c=E,1,OfKfh6KVQ4Zg9b4OcbJfAV3TjbqMtmIWTStHRwfB5Q7H0T22Wm1vUPBcyy0E-42jPvhHKe_7ff8l60HXzIMTg2W2Z-WXDrPaKJydxT9MglsyXbq_9A,,&typo=1(350) bailOnResponseError: unsupported CONNECT response status code [state:w FD 12 job1778]
2022/07/15 14:55:52.736 kid1| TCP connection to https://linkprotect.cudasvc.com/url?a=https%3a%2f%2f%2f%2fgateway.goguardian.com%2f443&c=E,1,Y076ZQWwoNFj_D-NMFmLm-CdcOxbvA0LdZvQUwK9KwDdNMa-GTwlM9mtuJ1ODpTlDCr9h0eoBw6Cjopn5_OSLGO7BwdrfGZMcmbJcKqz-XI,&typo=1 failed
    current master transaction: master584
2022/07/15 14:55:52.736 kid1| 5,3| https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fcomm.cc&c=E,1,L4rV40LaPYwokyYaPk3qQTS8hrCmiW_HWq8hVp64-WMs1uaDRlbLyKMuJGrDBKatDLoy0Yx99-T797SfhDGNKQfbslPfTaHNYOzqkUbQnkAJqYCXbMJpoeQS&typo=1(597) commUnsetConnTimeout: Remove timeout for conn898 local=10.56.1.3:41554 remote=18.213.126.143:443 FIRSTUP_PARENT FD 12 flags=1
2022/07/15 14:55:52.736 kid1| 5,3| https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fcomm.cc&c=E,1,zWT3K3_c9lemfAx22YB73QSI-HefXjfwOYeXxOFglfVKtYKv1R4x8kvfNmhPJz3gsFiu4DvAVfLl-aE5jgI298VNSjgwNloSL0CT4jaZl1UPaqI_GDRpEKiW&typo=1(571) commSetConnTimeout: conn898 local=10.56.1.3:41554 remote=18.213.126.143:443 FIRSTUP_PARENT FD 12 flags=1 timeout -1









1657896950.569     75 10.125.15.10 NONE_NONE/200 0 CONNECT content-signature-2.cdn.mozilla.net:443 johnathan.hasty at USI.UNCOMMONSCHOOLS.ORG HIER_NONE/- - "ws-iid=191" "ws-mac=00:00:00:00:00:00" "ws-duration=144" "ws-timing=1" "ws-mtime=0" "ws-scanflags=63" "ws-categories=70368744177664" "ws-trusted=1" "ws-level=1" "ws-verdict=0" "ws-policy=default" "ws-member=default" "ws-module=2" "ws-msgtype=2" "ws-param1=None" "ws-param2=None" "ws-debug=None" "squid-gt-st=3252"
1657896950.575    215 10.125.15.10 TCP_MISS/407 314 GET https://linkprotect.cudasvc.com/url?a=http%3a%2f%2fdetectportal.firefox.com%2fcanonical.html&c=E,1,x9JEJRejqd7-bYl4jZp1ckxC2ZGlbdi_UQPpq6hge5yRQMX85D-dtgFjvQyNaG2pqqGTUedTgAU3y1dLdSi2VR4lBQ17zSzKw4emVG9gDg,,&typo=1 johnathan.hasty at USI.UNCOMMONSCHOOLS.ORG FIRSTUP_PARENT/52.204.217.22 - "ws-iid=184" "ws-mac=00:00:00:00:00:00" "ws-duration=2864" "ws-timing=0" "ws-mtime=0" "ws-scanflags=63" "ws-categories=8589934592" "ws-trusted=0" "ws-level=1" "ws-verdict=0" "ws-policy=default" "ws-member=default" "ws-module=2" "ws-msgtype=3" "ws-param1=None" "ws-param2=None" "ws-debug=None" "squid-gt-st=3331"
1657896951.018    288 10.125.15.10 TCP_MISS/407 314 GET https://linkprotect.cudasvc.com/url?a=http%3a%2f%2fdetectportal.firefox.com%2fcanonical.html&c=E,1,8pVmhR-qRuZ17zuQsuL9C-Jmr_jfpuoQjWKehR3jxDlILGeouM1igPMKABi4IoX8pnbEuLx7ePCYJM8CVME2wVp5IyWKLgwkk-Qt9pvyP3AZ&typo=1 johnathan.hasty at USI.UNCOMMONSCHOOLS.ORG FIRSTUP_PARENT/52.204.217.22 - "ws-iid=194" "ws-mac=00:00:00:00:00:00" "ws-duration=445" "ws-timing=0" "ws-mtime=0" "ws-scanflags=63" "ws-categories=8589934592" "ws-trusted=0" "ws-level=1" "ws-verdict=0" "ws-policy=default" "ws-member=default" "ws-module=2" "ws-msgtype=3" "ws-param1=None" "ws-param2=None" "ws-debug=None" "squid-gt-st=334"
1657896951.082      2 10.125.15.10 TCP_DENIED/407 4390 GET https://linkprotect.cudasvc.com/url?a=http%3a%2f%2fdetectportal.firefox.com%2fcanonical.html&c=E,1,I6mgvjdyuvjzSYC9zixVVoCWTsi8K4Eodu57TsF02izb474NFQv2bYZ9SkSW7ByIa3uCmaaFUkqX8F6qkLsadHEqQHEMzjkWBJMOLBM02G1FHLr1IdcS228KMX0,&typo=1 - HIER_NONE/- text/html "ws-iid=-" "ws-mac=00:00:00:00:00:00" "ws-duration=-" "ws-timing=-" "ws-mtime=-" "ws-scanflags=-" "ws-categories=-" "ws-trusted=-" "ws-level=-" "ws-verdict=-" "ws-policy=-" "ws-member=-" "ws-module=-" "ws-msgtype=-" "ws-param1=-" "ws-param2=-" "ws-debug=-" "squid-gt-st=334"
1657896951.388    820 10.125.15.10 TCP_TUNNEL/407 0 CONNECT content-signature-2.cdn.mozilla.net:443 johnathan.hasty at USI.UNCOMMONSCHOOLS.ORG FIRSTUP_PARENT/18.213.126.143 - "ws-iid=192" "ws-mac=00:00:00:00:00:00" "ws-duration=65" "ws-timing=0" "ws-mtime=0" "ws-scanflags=63" "ws-categories=70368744177664" "ws-trusted=1" "ws-level=1" "ws-verdict=0" "ws-policy=default" "ws-member=default" "ws-module=2" "ws-msgtype=2" "ws-param1=None" "ws-param2=None" "ws-debug=None" "squid-gt-st=0"
1657896951.389      0 10.125.15.10 NONE_NONE/000 0 - error:transaction-end-before-headers - HIER_NONE/- - "ws-iid=-" "ws-mac=-" "ws-duration=-" "ws-timing=-" "ws-mtime=-" "ws-scanflags=-" "ws-categories=-" "ws-trusted=-" "ws-level=-" "ws-verdict=-" "ws-policy=-" "ws-member=-" "ws-module=-" "ws-msgtype=-" "ws-param1=-" "ws-param2=-" "ws-debug=-" "squid-gt-st=517"
1657896951.468    211 10.125.15.10 TCP_MISS/407 314 GET https://linkprotect.cudasvc.com/url?a=http%3a%2f%2fdetectportal.firefox.com%2fcanonical.html&c=E,1,m6f0ut953qjWTR0yIgxVVetjMjKfJGpwvKazqFCK77Li8y-m5jvK1tJrnk2ADc5EDKV0m-YcDqvoiIcsieBuzl1mVtfR9OaE4rq3rcCI_sc1&typo=1 johnathan.hasty at USI.UNCOMMONSCHOOLS.ORG FIRSTUP_PARENT/52.204.217.22 - "ws-iid=196" "ws-mac=00:00:00:00:00:00" "ws-duration=448" "ws-timing=0" "ws-mtime=0" "ws-scanflags=63" "ws-categories=8589934592" "ws-trusted=0" "ws-level=1" "ws-verdict=0" "ws-policy=default" "ws-member=default" "ws-module=2" "ws-msgtype=3" "ws-param1=None" "ws-param2=None" "ws-debug=None" "squid-gt-st=3331"




Best Regards,
Johnathan

_______________________________________________________

Johnathan Hasty
Senior DevOps Engineer
Uncommon Schools
C: 989.366.1672

Uncommon Schools | Change History
Website |?Facebook |?Twitter |?LinkedIn |?Apply Now

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Alex Rousskov
Sent: Friday, July 15, 2022 10:14 AM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Upstream Proxy

On 7/15/22 09:51, Johnathan Hasty wrote:

> I?ve been trying to hand off credentials to our upstream proxy 
> GoGuardian and have been facing many issues.

What HTTP authentication method(s) or scheme(s) does your upstream proxy support or require?


> HTTP/1.1 407 Proxy Authentication Required
> Proxy-Authenticate: Basic realm="Secure Browsing"

This is not my area of expertise, but the above error message suggests that the proxy wants to do HTTP Basic authentication, but you are configuring Squid to use NEGOTIATE, so perhaps you should switch to Basic as the next step in your triage, just to get something working (cache_peer ... login=user:password)?

Sharing what CONNECT request headers Squid sends to the parent proxy may be useful as well, but do not use any secrets in your test traffic if you are going to share such details. If you still have that cache.log, look for "Tunnel Server REQUEST" associated with conn2126.


HTH,

Alex.


> Has anyone gotten Squid to successfully hand off to GoGuardian as 
> their upstream proxy?
>
> Advanced ACLs:
> cache_peer
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fgateway.goguardian
> .com&c=E,1,4mgHTezdkg3XvogUnlMp7R_aPvVQ_k4b-ypUDY-r87n90TNewVfWO2G7yD8
> KkbTZsmGhDBWiU-1QXOx9rTzbo3OKnuac4cWw9FtJNrmREkILe6q5FyICs2IE&typo=1
> parent 443 0 no-query no-digest no-netdb-exchange connect-timeout=60 
> default tls login=NEGOTIATE:principal_name 
> sslcapath=/usr/local/share/ca-certificates/
>
> cache_peer_access
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fgateway.goguardian
> .com&c=E,1,tXvnr1Bt31o7q-hOKeOXTPxzXW9DCW5ZYUwuJ7_zipiM8d7kDnxhExjas6S
> ZtisCB5rLGfXHr7wV5cw2SA_mQkr1n51atsqVDx1MnZZDHTRyJzW3bUc,&typo=1 allow 
> all
>
> never_direct allow all
>
> Log snipit:
> 2022/06/30 15:22:49.198 kid1| 5,3|
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fIoCallback.cc&c=E,
> 1,wvOZEJacIjm7MMfIw4zokPxqyPEbXkGtlZd2OjPZnBaBwKYd4JhEY7iqqSOFpOEQkLML
> LliW5vfaXpVJZzleoEi_t79ZlTQE310p_aOzboKLmD8,&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fIoCallback.cc&c=E
> ,1,tkT-dyHiVAqZoP7tVfxLk3RVYLyb_avXd27fXGqjJMTzNKPAGHmmvW9pXYcC425jST0
> ZYFFPwV4uHf3fKHuux40xkg9kXWTzOHPdGV5BNGbILyA,&typo=1&ancr_add=1>(112)
> finish: called for conn2126 local=10.56.1.3:59674 
> <http://10.56.1.3:59674> remote=18.213.126.143:443 
> <http://18.213.126.143:443> FIRSTUP_PARENT FD 24 flags=1 (0, 0)
>
> 2022/06/30 15:22:49.198 kid1| 93,3|
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fAsyncCall.cc&c=E,1
> ,_WyCB5FW8TPrE8VlwBDvbPPARxLAWIrkTCRh_yGS49ECyfGVDnBZtgXtv-rdu8B0ze3XP
> Z3nmMQ54CyPGOek_nP2SCr-pr0gbcacRhSqdvzu&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fAsyncCall.cc&c=E,
> 1,DRAaKArrkDvBn0UuKG4CO_yXvblIrZBSYHpMpA4H7oRhEraoEzGxMCRwZJpYUsTM63vF
> W1Co7R0A33jgXq0EZyS1JcelCRUFXLjE5tQ-siWuoU0bbvc,&typo=1&ancr_add=1>(96
> )
> ScheduleCall:
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fIoCallback.cc&c=E,
> 1,CLrXyrjHJJLEUyDzFLyORoYkOc6dPPoPy8mcoj1pWEKli7eNc4SROUZ17OioxqFJZTmw
> KRRZPrkGHOKwEkKLPrjc6G5CJ49ccON5eC_SpzBM9RV52CvFHg,,&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fIoCallback.cc&c=E
> ,1,bCxz0FVR5jkr6lvnOvzW7e6G8tQBNRlVCCbel3ASQC74rRdj29Wxcj66G7Jit7W9Qdb
> z8catGFZxEEbA6bR1lmzxqhKOAxPRfaraHkB0Kq0,&typo=1&ancr_add=1>(131)
> will call Http::Tunneler::handleReadyRead(conn2126
> local=10.56.1.3:59674 <http://10.56.1.3:59674>
> remote=18.213.126.143:443 <http://18.213.126.143:443> FIRSTUP_PARENT 
> FD 24 flags=1,
> data=0x55849f4926c8) [call548666]
>
> 2022/06/30 15:22:49.198 kid1| 93,3|
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fAsyncCallQueue.cc&
> c=E,1,UGKeO2qrCPs6m2GXyLlhHHkuRUPt2cGShW7xdl1TzFHGzrrU9aCKd6DcFICzKY0F
> 2-1vU7bOY71MSvAXS0vdAxZGyOUU9cucfyHU4997ePtvtjXY1YJx&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fAsyncCallQueue.cc
> &c=E,1,Ne0y7JJW7fBc_1MyCR5zK2LlFshqIfjXRI-DDHdH5PeY44sZtFyGkRMXgYLpMqH
> Yj17Z8PToa57tNyAfAp6EUkVwM3SHgK37ObzCJYBj&typo=1&ancr_add=1>(59)
> fireNext: entering Http::Tunneler::handleReadyRead(conn2126
> local=10.56.1.3:59674 <http://10.56.1.3:59674>
> remote=18.213.126.143:443 <http://18.213.126.143:443> FIRSTUP_PARENT 
> FD 24 flags=1,
> data=0x55849f4926c8)
>
> 2022/06/30 15:22:49.198 kid1| 93,3|
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fAsyncCall.cc&c=E,1
> ,0QLPJSskintC4NgwcvTUsoIWjY3qwFYZUU1K2zkIbJ9ApLohmZ0jnOQwLqm3rvsIX3QvY
> mtEc3ULAUby0qHSuTA6kfd_J5THUpYmykwPyyr9jlJi&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fAsyncCall.cc&c=E,
> 1,o0OzDC7879yEvRQoXyqb11XnNW2f6RJwmh1OP5vYSK4ukmnOFcBmRwtorjA94HFXF2MO
> 38TdGcH68cNv4LkX122TcPK1Gwh5xQXTTnzhZCk0N4c,&typo=1&ancr_add=1>(41)
> make: make call Http::Tunneler::handleReadyRead [call548666]
>
> 2022/06/30 15:22:49.198 kid1| 93,3|
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fAsyncJob.cc&c=E,1,
> cutfUKQzcFc8e83JGLpUqZzQ5vCaW2rceWZI6_tL1mRPFEUxoNV2bmGFagx9y3wKCmcjXf
> T9VZ4000RPweRM3s91K0PDFBkVEIn0GzE2gdmQctpotwQ,&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fAsyncJob.cc&c=E,1
> ,0XdqwD1hHo1N94DousFFhRiwV1YBiWmgmGgnmN3ivpK14dkV-pET6DcSkS2X_BoPOU0rc
> ff0Z8GMOM6Se71G_crDtF1V4AWKNym2mjdbxuqKI47TC0GqeVQ,&typo=1&ancr_add=1>
> (123)
> callStart: Http::Tunneler status in: [state:w FD 24 job3836]
>
> 2022/06/30 15:22:49.198 kid1| 83,3|
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fSession.cc&c=E,1,p
> 7LN0t2ClO-5Nl7j3E3wm40eWwqhcGz_6XzDNmr0Y75br1dSliqvHiNj1GUhOu6kNMD5SgJ
> 3gF_MOIcA9eubIR_v1k918fdLhCAgE1mGDPTKBVSZJr0,&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fSession.cc&c=E,1,
> 5pwOO8oysGpMl2UW2Xm5P9KkR_3HsM1xcAdWaqJ5W67u3ht9dZCWWqKu-yt1JrDyn7NvUN
> MMfVsPhYQQ6rNYqmGGLwDuReUm7h6KmDVvRXk9hFQ,&typo=1&ancr_add=1>(36)
> tls_read_method: started for session=0x55849f86d970
>
> 2022/06/30 15:22:49.198 kid1| 5,3|
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fRead.cc&c=E,1,yB97
> lUNthiucTCUWsSMfvAziT5CLZb1OZogmu8ScWQnCNzUbYMQw1Zbn2OccWJTYDMmlA6u5-3
> vkeWyX6fQZOx1KGAdNoCK6r23yucjU&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fRead.cc&c=E,1,YRn
> dcJz2bAhwR1PdmoQI8sRvkmjGdcO5EIyIIpp4iqwmuG7h-eaf-3lfNBR39-ZO7iGAxJ7K0
> S_cHbSgNtNlm0fjWnm8WFDq58f6THu4DI699rCS7t0,&typo=1&ancr_add=1>(93)
> ReadNow: conn2126 local=10.56.1.3:59674 <http://10.56.1.3:59674>
> remote=18.213.126.143:443 <http://18.213.126.143:443> FIRSTUP_PARENT 
> FD
> 24 flags=1, size 65535, retval 172, errno 0
>
> 2022/06/30 15:22:49.198 kid1| 11,2|
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fHttpTunneler.cc&c=
> E,1,qiS1pPbfXZ_Aobf_tcSVbmPX5IRTWWzk7rZklKhiXmyryzKUOjlZnh25vZMqWotwsh
> BOfFMiyTiQ2vxFbWn1PAo4Nk9yKW8OYdXAkAEpZg2YDOH4Jb4Fxtuu&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fHttpTunneler.cc&c
> =E,1,7NW0kgZsy7tR63h5jeGLIfWqkf7MZMOiNKoehdSMu4P8C_Cyj5_2ApYRUA6cZWFOq
> SGAjikQJc_BpXOW4-kzssgabw7mHmj9JehJw69jCPqdH0f2XA,,&typo=1&ancr_add=1>
> (328)
> handleResponse: Tunnel Server conn2126 local=10.56.1.3:59674 
> <http://10.56.1.3:59674> remote=18.213.126.143:443 
> <http://18.213.126.143:443> FIRSTUP_PARENT FD 24 flags=1
>
> 2022/06/30 15:22:49.198 kid1| 11,2|
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fHttpTunneler.cc&c=
> E,1,yOUqRcgTyDqJM4As1g9no_2ivGGU2GU0PGsvC0nQjDk9PDDcutm2vFsyn3JmbEXXs1
> HYXQGoS7iH5h6BRNLNShj9pIEFQzE6dYrY1Eqblw2VBYg,&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fHttpTunneler.cc&c
> =E,1,3NizLysV5Gx9r_j5gTGoxUw_3T9zdjGtQ-DV4EhtvlwXKEzULXHluYnJByOJiEPPn
> VnNQqchSO6-31x_mXrtC-9VAHF1Rvi3G4KI9KdJOjbjUelpts2rPuVSNQ,,&typo=1&anc
> r_add=1>(329)
> handleResponse: Tunnel Server RESPONSE:
>
> ---------
>
> HTTP/1.1 407 Proxy Authentication Required
>
> Proxy-Authenticate: Basic realm="Secure Browsing"
>
> Date: Thu, 30 Jun 2022 15:22:49 GMT
>
> Content-Length: 0
>
> Connection: close
>
> ----------
>
> 2022/06/30 15:22:49.198 kid1| 83,3|
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fHttpTunneler.cc&c=
> E,1,pufqpHpI8C7rAUfy9Tq2mNp2OZ1XMTAI6fkixf_-ua2kK8YpFPUMWFzh0rWHf9g0Ws
> uV3pIArjpDXfXhm2XC6M9Irhro_TxF-__TcOmuBGULF-f070nvp3mjpLM,&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fHttpTunneler.cc&c
> =E,1,GviZgdhx9RYhEwKjYE8dVgxbEl8iol-igCMYAgae4yqcKPIFswYtt6EwZhF84hnL-
> ef9RpuZwEHsx85Xll9B5Gfbg7d2dHfIF34rKZsAxv6qOdMumpxPDQ,,&typo=1&ancr_ad
> d=1>(350)
> bailOnResponseError: unsupported CONNECT response status code [state:w 
> FD 24 job3836]
>
> 2022/06/30 15:22:49.198 kid1| TCP connection to 
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2f%2f%2fgateway.gogu
> ardian.com%2f443&c=E,1,UusqMjgeT_UOKD1S9PrgXx6upenAYP-hT7yGJTEnspLqlnS
> awFcJbipDzT1VUHjpy2b-j-nAl50SEUaFLAkQda-Y8KqaSsR9kCUbXTeurg,,&typo=1
> <https://linkprotect.cudasvc.com/url?a=http%3a%2f%2fgateway.goguardian
> .com%2f443&c=E,1,uAPXOfc9RgeMJ4nUQAbfSdcSO5Uq43sRY-gZmY85itIayxn-UVioU
> UW3XRszjHa-yYb6rECJlsja0UO3JoB46gLeuYZSjXkRbee8lCx9qDg8UMVty1UFtdYA&ty
> po=1>
> failed
>
>      current master transaction: master1228
>
> 2022/06/30 15:22:49.198 kid1| 15,2|
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fneighbors.cc&c=E,1
> ,9ofiQEX_0QnggaY8xoZN6SuZPZwmqJoD1GNQ655oW2gywmEKyxLVKHrM4Ac6gBgcTtgDb
> uQcMGF0tup6n1llH-TGgGu4Ts6AJeKlaza1vvG52A1mXJmoxnRvCQ,,&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fneighbors.cc&c=E,
> 1,A9XtxL5DCKCd251CIXugkhx4aCzF9hXbpTke-TobSR1fyAJvDoqwTFq1cEcOoZJtiMbG
> KIRMTAdNo4BJFSkXvu8VJe16TUWacR3bLvbydug1knZSGkBYCZ0,&typo=1&ancr_add=1
> >(1284)
> peerConnectFailedSilent: TCP connection to 
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2f%2f%2fgateway.gogu
> ardian.com%2f443&c=E,1,is4BqJ6V4Qdfc04VYlolwa5QuKFNfTygVBDVwtBqmsf41gL
> UQI3CKcnxrF9sHxTsXgK3UQPazoH2N4bwj7wGWZ4IFpRpHOrLTaHLEg3riYlP&typo=1
> <https://linkprotect.cudasvc.com/url?a=http%3a%2f%2fgateway.goguardian
> .com%2f443&c=E,1,dGVDR_a1JorHZeL7cCLZZYEKPcdKNP8q3xqZrI0znu3mp7ytE8irV
> nBC73FhdcWJ5M0-LWIn2Mn0GzYRz6V0M_GYqDtl_rvKTY_dWhrXIAFI1UpgdRqKz0hp&ty
> po=1>
> dead
>
> 2022/06/30 15:22:49.198 kid1| 5,3|
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fcomm.cc&c=E,1,wVzz
> fX9UMqeQdfmj9Yh-eEQTkXfgpAsRIs1xVjE6wsFdGqLtci-hbG5hqOsir3jaz800ooUnT6
> 02gcZzpoNCotYfELUz8GbehnzI-szfn_9t4ygswhCtKyiXsKtO&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fcomm.cc&c=E,1,_FS
> TyaiA0rkYHZ4Z7eAL4TwtVx69LC8zbzD277h9yuyffbapL47ZpB_oWH20eRbFct1TQy0vm
> I_r1caTRPIqNuxhiZ7iYIATofZyGH8m1ZkJn-_Pj74,&typo=1&ancr_add=1>(597)
> commUnsetConnTimeout: Remove timeout for conn2126
> local=10.56.1.3:59674 <http://10.56.1.3:59674>
> remote=18.213.126.143:443 <http://18.213.126.143:443> FIRSTUP_PARENT 
> FD 24 flags=1
>
> 2022/06/30 15:22:49.198 kid1| 5,3|
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fcomm.cc&c=E,1,6_Om
> _qoW-p_W0CpO2EJHb7WhzwjJyFKkENF0xzjkBzWhiNEeuxQa8cl337nnoOOK7tey-YPgOv
> tYw-Asoq_RGiBrHLG1-3UZX9uG33SD1of4jv5b7QjHUPI,&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fcomm.cc&c=E,1,2X_
> UeJ7syPVMh46zfITvmAcOXeJskvfXEcgk8IyJC4YzRQfPu92bh2NzVodZ0n4ZRK7THXkr0
> YSUqM7xqyqJCvdnyd9FAu6HfF5w6S0BZI45WZI8zKdCZe8,&typo=1&ancr_add=1>(571
> )
> commSetConnTimeout: conn2126 local=10.56.1.3:59674 
> <http://10.56.1.3:59674> remote=18.213.126.143:443 
> <http://18.213.126.143:443> FIRSTUP_PARENT FD 24 flags=1 timeout -1
>
> 2022/06/30 15:22:49.198 kid1| 5,3|
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fcomm.cc&c=E,1,f3jm
> C5svmDm2UMZPFo_bJ6TZqPvD1V85OGT0cw_YxUApcig2_G0CQ5uf8vaKUSpMHT2E-flXvO
> 3DJ81-xeFxHAoC3qOIK7wJYSws9qhHhgSW1R8n3Slt&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fcomm.cc&c=E,1,Ffk
> Oe7rgvl24KtYbMnfkVwBEdxcDHC1Qli-TWnd49Qh8gDEi83POkLUjbin88NBj9wz0eUa5E
> XJAjwxomX4QO4zLvkDabeKXKYlG6AdnYeWwBQX65a999EDQfHg,&typo=1&ancr_add=1>
> (877)
> _comm_close: start closing FD 24 by
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fConnection.cc%3a10
> 8&c=E,1,p118dKeMyqtNGmJDUQfl3bqlowxip-f5vvzF5BGVoRt6v1MWaolkRXvJ3Ptu_b
> DI934lLcugy51gOKePiLt9X39tc9I-WvaSTfDN4UnHRAU,&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fConnection.cc%3a1
> 08&c=E,1,WyC_uIlGcAERUMOzZEzNpvTD0VNtdyMCu8_98mxi45Tfb8tS1Sk-xPVV7uo29
> dppxC6E7neNtZYKqy1MhMyuLt8f0VUXYaTTfg2ke0mgXESQjraUm9zxRlRV&typo=1&anc
> r_add=1>
>
> 2022/06/30 15:22:49.198 kid1| 5,3|
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fcomm.cc&c=E,1,4wEE
> ydLqZtbeDc5YHCkgy5GsRjJ3_cLzlCGjyzHOV-hTEVEIsy3mNyF5ICP27wwTmSGp6ze8y2
> vdbqkthwhZqwWvH_jduoEypTSS0y2ytmL7&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fcomm.cc&c=E,1,3Gy
> 87egR90ZnusSy5exBZU0res4kBdHXTtCKE_jPDFJ67k-PY9AWyJYQlbMs93MRcEX4tmriD
> wIFkUn6n7F57YT-OWPTUDgMXKLJDMijoQr3ETZ_4qmLyO3mxoc,&typo=1&ancr_add=1>
> (558)
> commUnsetFdTimeout: Remove timeout for FD 24
>
>
> Best Regards,
>
> Johnathan
>
> *_______________________________________________________*
>
> **
>
> *Johnathan Hasty*
>
> Senior DevOps Engineer
>
> Uncommon Schools
>
> C: 989.366.1672
>
> *Un*common Schools | Change History
>
> Website
> <https://linkprotect.cudasvc.com/url?a=http%3a%2f%2fwww.uncommonschool
> s.org%2f&c=E,1,cWhZ9NA37cAb3SSkIYkr5EbwjBXA_1ECEBWI1BpFOMixjdXiqIYF5NH
> _rpjuRqGzBt9Av6GCLPt7UYFH62vFjyLlBBvmIAwJtSORWZeE&typo=1>?| Facebook 
> <http://www.facebook.com/uncommonschools>?| Twitter 
> <http://www.twitter.com/uncommonschools>?| LinkedIn 
> <http://www.linkedin.com/company/124759?trk=tyah>?| Apply Now 
> <https://linkprotect.cudasvc.com/url?a=http%3a%2f%2fwww.uncommonschool
> s.org%2fcareers&c=E,1,rgbpQND7NOQlb8Jv2r2mLOBnCdzuRSxPkW0uIyooMP2TwhUo
> tzeHZQjvRKQyUr3gDLWXSyG1jhOH92Ub7jL9_5wTQc42_HkbPCyQS5oyArE,&typo=1>
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> https://linkprotect.cudasvc.com/url?a=http%3a%2f%2flists.squid-cache.o
> rg%2flistinfo%2fsquid-users&c=E,1,J4_sclj9gC817Tmu9bhrA3OR4TSSruJYfYUM
> 6RkEXWZjj9XbwbXxgeS2yApz2pngh07velawZHPZD2mJFvgfC8P764tli3XXTMvKbYgp&t
> ypo=1

_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
https://linkprotect.cudasvc.com/url?a=http%3a%2f%2flists.squid-cache.org%2flistinfo%2fsquid-users&c=E,1,6nL_4Gs08LWJUKqb_q0ngPSzWGNPU1hDuBFl2fe6WS9B5z0mUCKS0CWyT3EUxoD8qdoRz_4UaAxr3vVuAUQCLDB05Yj639MDRp6MdlpX_jSXFtjL1Z2wKw,,&typo=1
CAUTION : This email originated from outside of the organization. Do not click links or open attachments unless you recognize the sender and know the content is safe.

_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
https://linkprotect.cudasvc.com/url?a=http%3a%2f%2flists.squid-cache.org%2flistinfo%2fsquid-users&c=E,1,_gt5RuG6OnpL5wNbM1Dzv4nuJJRVHT3EToMZP5hSDVox-iP_NPzQaaSo8V_f1XPFpn8T_C2R18Hum-eShKhL1zRxyXViMkrpo3iT-m1r&typo=1
CAUTION : This email originated from outside of the organization. Do not click links or open attachments unless you recognize the sender and know the content is safe.


From Johnathan.Hasty at uncommonschools.org  Fri Jul 15 16:05:36 2022
From: Johnathan.Hasty at uncommonschools.org (Johnathan Hasty)
Date: Fri, 15 Jul 2022 16:05:36 +0000
Subject: [squid-users] Upstream Proxy
In-Reply-To: <61072e0a-43e2-6388-d121-8e433092513a@measurement-factory.com>
References: <MN2PR10MB4176DD2030DFE34D7C349F6CF78B9@MN2PR10MB4176.namprd10.prod.outlook.com>
 <61072e0a-43e2-6388-d121-8e433092513a@measurement-factory.com>
Message-ID: <MN2PR10MB4176E4D46C38B24DFD6395F1F78B9@MN2PR10MB4176.namprd10.prod.outlook.com>

> What HTTP authentication method(s) or scheme(s) does your upstream proxy support or require?

They're very vague and not helpful. It was said they look for email, but in reality it would be user at blah.company.com rather than user at company.com.


This is the only information I have for them.

https://support.goguardian.com/s/article/Deploying-GoGuardian-Gateway-1629767892527

https://view.highspot.com/viewer/5f7241dd628ba24915723e85



Best Regards,?
Johnathan
?
_______________________________________________________?
??
Johnathan Hasty?
Senior DevOps Engineer?
Uncommon Schools?
C: 989.366.1672?
??
Uncommon Schools | Change History?
Website?|?Facebook?|?Twitter?|?LinkedIn?|?Apply Now?

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Alex Rousskov
Sent: Friday, July 15, 2022 10:14 AM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Upstream Proxy

On 7/15/22 09:51, Johnathan Hasty wrote:

> I?ve been trying to hand off credentials to our upstream proxy 
> GoGuardian and have been facing many issues.

What HTTP authentication method(s) or scheme(s) does your upstream proxy support or require?


> HTTP/1.1 407 Proxy Authentication Required
> Proxy-Authenticate: Basic realm="Secure Browsing"

This is not my area of expertise, but the above error message suggests that the proxy wants to do HTTP Basic authentication, but you are configuring Squid to use NEGOTIATE, so perhaps you should switch to Basic as the next step in your triage, just to get something working (cache_peer ... login=user:password)?

Sharing what CONNECT request headers Squid sends to the parent proxy may be useful as well, but do not use any secrets in your test traffic if you are going to share such details. If you still have that cache.log, look for "Tunnel Server REQUEST" associated with conn2126.


HTH,

Alex.


> Has anyone gotten Squid to successfully hand off to GoGuardian as 
> their upstream proxy?
>
> Advanced ACLs:
> cache_peer 
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fgateway.goguardian
> .com&c=E,1,4mgHTezdkg3XvogUnlMp7R_aPvVQ_k4b-ypUDY-r87n90TNewVfWO2G7yD8
> KkbTZsmGhDBWiU-1QXOx9rTzbo3OKnuac4cWw9FtJNrmREkILe6q5FyICs2IE&typo=1 
> parent 443 0 no-query no-digest no-netdb-exchange connect-timeout=60 
> default tls login=NEGOTIATE:principal_name 
> sslcapath=/usr/local/share/ca-certificates/
>
> cache_peer_access 
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fgateway.goguardian
> .com&c=E,1,tXvnr1Bt31o7q-hOKeOXTPxzXW9DCW5ZYUwuJ7_zipiM8d7kDnxhExjas6S
> ZtisCB5rLGfXHr7wV5cw2SA_mQkr1n51atsqVDx1MnZZDHTRyJzW3bUc,&typo=1 allow 
> all
>
> never_direct allow all
>
> Log snipit:
> 2022/06/30 15:22:49.198 kid1| 5,3| 
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fIoCallback.cc&c=E,
> 1,wvOZEJacIjm7MMfIw4zokPxqyPEbXkGtlZd2OjPZnBaBwKYd4JhEY7iqqSOFpOEQkLML
> LliW5vfaXpVJZzleoEi_t79ZlTQE310p_aOzboKLmD8,&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fIoCallback.cc&c=E
> ,1,tkT-dyHiVAqZoP7tVfxLk3RVYLyb_avXd27fXGqjJMTzNKPAGHmmvW9pXYcC425jST0
> ZYFFPwV4uHf3fKHuux40xkg9kXWTzOHPdGV5BNGbILyA,&typo=1&ancr_add=1>(112)
> finish: called for conn2126 local=10.56.1.3:59674 
> <http://10.56.1.3:59674> remote=18.213.126.143:443 
> <http://18.213.126.143:443> FIRSTUP_PARENT FD 24 flags=1 (0, 0)
>
> 2022/06/30 15:22:49.198 kid1| 93,3| 
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fAsyncCall.cc&c=E,1
> ,_WyCB5FW8TPrE8VlwBDvbPPARxLAWIrkTCRh_yGS49ECyfGVDnBZtgXtv-rdu8B0ze3XP
> Z3nmMQ54CyPGOek_nP2SCr-pr0gbcacRhSqdvzu&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fAsyncCall.cc&c=E,
> 1,DRAaKArrkDvBn0UuKG4CO_yXvblIrZBSYHpMpA4H7oRhEraoEzGxMCRwZJpYUsTM63vF
> W1Co7R0A33jgXq0EZyS1JcelCRUFXLjE5tQ-siWuoU0bbvc,&typo=1&ancr_add=1>(96
> )
> ScheduleCall: 
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fIoCallback.cc&c=E,
> 1,CLrXyrjHJJLEUyDzFLyORoYkOc6dPPoPy8mcoj1pWEKli7eNc4SROUZ17OioxqFJZTmw
> KRRZPrkGHOKwEkKLPrjc6G5CJ49ccON5eC_SpzBM9RV52CvFHg,,&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fIoCallback.cc&c=E
> ,1,bCxz0FVR5jkr6lvnOvzW7e6G8tQBNRlVCCbel3ASQC74rRdj29Wxcj66G7Jit7W9Qdb
> z8catGFZxEEbA6bR1lmzxqhKOAxPRfaraHkB0Kq0,&typo=1&ancr_add=1>(131)
> will call Http::Tunneler::handleReadyRead(conn2126 
> local=10.56.1.3:59674 <http://10.56.1.3:59674> 
> remote=18.213.126.143:443 <http://18.213.126.143:443> FIRSTUP_PARENT 
> FD 24 flags=1,
> data=0x55849f4926c8) [call548666]
>
> 2022/06/30 15:22:49.198 kid1| 93,3| 
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fAsyncCallQueue.cc&
> c=E,1,UGKeO2qrCPs6m2GXyLlhHHkuRUPt2cGShW7xdl1TzFHGzrrU9aCKd6DcFICzKY0F
> 2-1vU7bOY71MSvAXS0vdAxZGyOUU9cucfyHU4997ePtvtjXY1YJx&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fAsyncCallQueue.cc
> &c=E,1,Ne0y7JJW7fBc_1MyCR5zK2LlFshqIfjXRI-DDHdH5PeY44sZtFyGkRMXgYLpMqH
> Yj17Z8PToa57tNyAfAp6EUkVwM3SHgK37ObzCJYBj&typo=1&ancr_add=1>(59)
> fireNext: entering Http::Tunneler::handleReadyRead(conn2126
> local=10.56.1.3:59674 <http://10.56.1.3:59674> 
> remote=18.213.126.143:443 <http://18.213.126.143:443> FIRSTUP_PARENT 
> FD 24 flags=1,
> data=0x55849f4926c8)
>
> 2022/06/30 15:22:49.198 kid1| 93,3| 
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fAsyncCall.cc&c=E,1
> ,0QLPJSskintC4NgwcvTUsoIWjY3qwFYZUU1K2zkIbJ9ApLohmZ0jnOQwLqm3rvsIX3QvY
> mtEc3ULAUby0qHSuTA6kfd_J5THUpYmykwPyyr9jlJi&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fAsyncCall.cc&c=E,
> 1,o0OzDC7879yEvRQoXyqb11XnNW2f6RJwmh1OP5vYSK4ukmnOFcBmRwtorjA94HFXF2MO
> 38TdGcH68cNv4LkX122TcPK1Gwh5xQXTTnzhZCk0N4c,&typo=1&ancr_add=1>(41)
> make: make call Http::Tunneler::handleReadyRead [call548666]
>
> 2022/06/30 15:22:49.198 kid1| 93,3| 
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fAsyncJob.cc&c=E,1,
> cutfUKQzcFc8e83JGLpUqZzQ5vCaW2rceWZI6_tL1mRPFEUxoNV2bmGFagx9y3wKCmcjXf
> T9VZ4000RPweRM3s91K0PDFBkVEIn0GzE2gdmQctpotwQ,&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fAsyncJob.cc&c=E,1
> ,0XdqwD1hHo1N94DousFFhRiwV1YBiWmgmGgnmN3ivpK14dkV-pET6DcSkS2X_BoPOU0rc
> ff0Z8GMOM6Se71G_crDtF1V4AWKNym2mjdbxuqKI47TC0GqeVQ,&typo=1&ancr_add=1>
> (123)
> callStart: Http::Tunneler status in: [state:w FD 24 job3836]
>
> 2022/06/30 15:22:49.198 kid1| 83,3| 
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fSession.cc&c=E,1,p
> 7LN0t2ClO-5Nl7j3E3wm40eWwqhcGz_6XzDNmr0Y75br1dSliqvHiNj1GUhOu6kNMD5SgJ
> 3gF_MOIcA9eubIR_v1k918fdLhCAgE1mGDPTKBVSZJr0,&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fSession.cc&c=E,1,
> 5pwOO8oysGpMl2UW2Xm5P9KkR_3HsM1xcAdWaqJ5W67u3ht9dZCWWqKu-yt1JrDyn7NvUN
> MMfVsPhYQQ6rNYqmGGLwDuReUm7h6KmDVvRXk9hFQ,&typo=1&ancr_add=1>(36)
> tls_read_method: started for session=0x55849f86d970
>
> 2022/06/30 15:22:49.198 kid1| 5,3| 
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fRead.cc&c=E,1,yB97
> lUNthiucTCUWsSMfvAziT5CLZb1OZogmu8ScWQnCNzUbYMQw1Zbn2OccWJTYDMmlA6u5-3
> vkeWyX6fQZOx1KGAdNoCK6r23yucjU&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fRead.cc&c=E,1,YRn
> dcJz2bAhwR1PdmoQI8sRvkmjGdcO5EIyIIpp4iqwmuG7h-eaf-3lfNBR39-ZO7iGAxJ7K0
> S_cHbSgNtNlm0fjWnm8WFDq58f6THu4DI699rCS7t0,&typo=1&ancr_add=1>(93)
> ReadNow: conn2126 local=10.56.1.3:59674 <http://10.56.1.3:59674>
> remote=18.213.126.143:443 <http://18.213.126.143:443> FIRSTUP_PARENT 
> FD
> 24 flags=1, size 65535, retval 172, errno 0
>
> 2022/06/30 15:22:49.198 kid1| 11,2| 
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fHttpTunneler.cc&c=
> E,1,qiS1pPbfXZ_Aobf_tcSVbmPX5IRTWWzk7rZklKhiXmyryzKUOjlZnh25vZMqWotwsh
> BOfFMiyTiQ2vxFbWn1PAo4Nk9yKW8OYdXAkAEpZg2YDOH4Jb4Fxtuu&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fHttpTunneler.cc&c
> =E,1,7NW0kgZsy7tR63h5jeGLIfWqkf7MZMOiNKoehdSMu4P8C_Cyj5_2ApYRUA6cZWFOq
> SGAjikQJc_BpXOW4-kzssgabw7mHmj9JehJw69jCPqdH0f2XA,,&typo=1&ancr_add=1>
> (328)
> handleResponse: Tunnel Server conn2126 local=10.56.1.3:59674 
> <http://10.56.1.3:59674> remote=18.213.126.143:443 
> <http://18.213.126.143:443> FIRSTUP_PARENT FD 24 flags=1
>
> 2022/06/30 15:22:49.198 kid1| 11,2| 
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fHttpTunneler.cc&c=
> E,1,yOUqRcgTyDqJM4As1g9no_2ivGGU2GU0PGsvC0nQjDk9PDDcutm2vFsyn3JmbEXXs1
> HYXQGoS7iH5h6BRNLNShj9pIEFQzE6dYrY1Eqblw2VBYg,&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fHttpTunneler.cc&c
> =E,1,3NizLysV5Gx9r_j5gTGoxUw_3T9zdjGtQ-DV4EhtvlwXKEzULXHluYnJByOJiEPPn
> VnNQqchSO6-31x_mXrtC-9VAHF1Rvi3G4KI9KdJOjbjUelpts2rPuVSNQ,,&typo=1&anc
> r_add=1>(329)
> handleResponse: Tunnel Server RESPONSE:
>
> ---------
>
> HTTP/1.1 407 Proxy Authentication Required
>
> Proxy-Authenticate: Basic realm="Secure Browsing"
>
> Date: Thu, 30 Jun 2022 15:22:49 GMT
>
> Content-Length: 0
>
> Connection: close
>
> ----------
>
> 2022/06/30 15:22:49.198 kid1| 83,3| 
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fHttpTunneler.cc&c=
> E,1,pufqpHpI8C7rAUfy9Tq2mNp2OZ1XMTAI6fkixf_-ua2kK8YpFPUMWFzh0rWHf9g0Ws
> uV3pIArjpDXfXhm2XC6M9Irhro_TxF-__TcOmuBGULF-f070nvp3mjpLM,&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fHttpTunneler.cc&c
> =E,1,GviZgdhx9RYhEwKjYE8dVgxbEl8iol-igCMYAgae4yqcKPIFswYtt6EwZhF84hnL-
> ef9RpuZwEHsx85Xll9B5Gfbg7d2dHfIF34rKZsAxv6qOdMumpxPDQ,,&typo=1&ancr_ad
> d=1>(350)
> bailOnResponseError: unsupported CONNECT response status code [state:w 
> FD 24 job3836]
>
> 2022/06/30 15:22:49.198 kid1| TCP connection to
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2f%2f%2fgateway.gogu
> ardian.com%2f443&c=E,1,UusqMjgeT_UOKD1S9PrgXx6upenAYP-hT7yGJTEnspLqlnS
> awFcJbipDzT1VUHjpy2b-j-nAl50SEUaFLAkQda-Y8KqaSsR9kCUbXTeurg,,&typo=1
> <https://linkprotect.cudasvc.com/url?a=http%3a%2f%2fgateway.goguardian
> .com%2f443&c=E,1,uAPXOfc9RgeMJ4nUQAbfSdcSO5Uq43sRY-gZmY85itIayxn-UVioU
> UW3XRszjHa-yYb6rECJlsja0UO3JoB46gLeuYZSjXkRbee8lCx9qDg8UMVty1UFtdYA&ty
> po=1>
> failed
>
>      current master transaction: master1228
>
> 2022/06/30 15:22:49.198 kid1| 15,2| 
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fneighbors.cc&c=E,1
> ,9ofiQEX_0QnggaY8xoZN6SuZPZwmqJoD1GNQ655oW2gywmEKyxLVKHrM4Ac6gBgcTtgDb
> uQcMGF0tup6n1llH-TGgGu4Ts6AJeKlaza1vvG52A1mXJmoxnRvCQ,,&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fneighbors.cc&c=E,
> 1,A9XtxL5DCKCd251CIXugkhx4aCzF9hXbpTke-TobSR1fyAJvDoqwTFq1cEcOoZJtiMbG
> KIRMTAdNo4BJFSkXvu8VJe16TUWacR3bLvbydug1knZSGkBYCZ0,&typo=1&ancr_add=1
> >(1284)
> peerConnectFailedSilent: TCP connection to 
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2f%2f%2fgateway.gogu
> ardian.com%2f443&c=E,1,is4BqJ6V4Qdfc04VYlolwa5QuKFNfTygVBDVwtBqmsf41gL
> UQI3CKcnxrF9sHxTsXgK3UQPazoH2N4bwj7wGWZ4IFpRpHOrLTaHLEg3riYlP&typo=1
> <https://linkprotect.cudasvc.com/url?a=http%3a%2f%2fgateway.goguardian
> .com%2f443&c=E,1,dGVDR_a1JorHZeL7cCLZZYEKPcdKNP8q3xqZrI0znu3mp7ytE8irV
> nBC73FhdcWJ5M0-LWIn2Mn0GzYRz6V0M_GYqDtl_rvKTY_dWhrXIAFI1UpgdRqKz0hp&ty
> po=1>
> dead
>
> 2022/06/30 15:22:49.198 kid1| 5,3| 
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fcomm.cc&c=E,1,wVzz
> fX9UMqeQdfmj9Yh-eEQTkXfgpAsRIs1xVjE6wsFdGqLtci-hbG5hqOsir3jaz800ooUnT6
> 02gcZzpoNCotYfELUz8GbehnzI-szfn_9t4ygswhCtKyiXsKtO&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fcomm.cc&c=E,1,_FS
> TyaiA0rkYHZ4Z7eAL4TwtVx69LC8zbzD277h9yuyffbapL47ZpB_oWH20eRbFct1TQy0vm
> I_r1caTRPIqNuxhiZ7iYIATofZyGH8m1ZkJn-_Pj74,&typo=1&ancr_add=1>(597)
> commUnsetConnTimeout: Remove timeout for conn2126 
> local=10.56.1.3:59674 <http://10.56.1.3:59674> 
> remote=18.213.126.143:443 <http://18.213.126.143:443> FIRSTUP_PARENT 
> FD 24 flags=1
>
> 2022/06/30 15:22:49.198 kid1| 5,3| 
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fcomm.cc&c=E,1,6_Om
> _qoW-p_W0CpO2EJHb7WhzwjJyFKkENF0xzjkBzWhiNEeuxQa8cl337nnoOOK7tey-YPgOv
> tYw-Asoq_RGiBrHLG1-3UZX9uG33SD1of4jv5b7QjHUPI,&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fcomm.cc&c=E,1,2X_
> UeJ7syPVMh46zfITvmAcOXeJskvfXEcgk8IyJC4YzRQfPu92bh2NzVodZ0n4ZRK7THXkr0
> YSUqM7xqyqJCvdnyd9FAu6HfF5w6S0BZI45WZI8zKdCZe8,&typo=1&ancr_add=1>(571
> )
> commSetConnTimeout: conn2126 local=10.56.1.3:59674 
> <http://10.56.1.3:59674> remote=18.213.126.143:443 
> <http://18.213.126.143:443> FIRSTUP_PARENT FD 24 flags=1 timeout -1
>
> 2022/06/30 15:22:49.198 kid1| 5,3| 
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fcomm.cc&c=E,1,f3jm
> C5svmDm2UMZPFo_bJ6TZqPvD1V85OGT0cw_YxUApcig2_G0CQ5uf8vaKUSpMHT2E-flXvO
> 3DJ81-xeFxHAoC3qOIK7wJYSws9qhHhgSW1R8n3Slt&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fcomm.cc&c=E,1,Ffk
> Oe7rgvl24KtYbMnfkVwBEdxcDHC1Qli-TWnd49Qh8gDEi83POkLUjbin88NBj9wz0eUa5E
> XJAjwxomX4QO4zLvkDabeKXKYlG6AdnYeWwBQX65a999EDQfHg,&typo=1&ancr_add=1>
> (877)
> _comm_close: start closing FD 24 by 
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fConnection.cc%3a10
> 8&c=E,1,p118dKeMyqtNGmJDUQfl3bqlowxip-f5vvzF5BGVoRt6v1MWaolkRXvJ3Ptu_b
> DI934lLcugy51gOKePiLt9X39tc9I-WvaSTfDN4UnHRAU,&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fConnection.cc%3a1
> 08&c=E,1,WyC_uIlGcAERUMOzZEzNpvTD0VNtdyMCu8_98mxi45Tfb8tS1Sk-xPVV7uo29
> dppxC6E7neNtZYKqy1MhMyuLt8f0VUXYaTTfg2ke0mgXESQjraUm9zxRlRV&typo=1&anc
> r_add=1>
>
> 2022/06/30 15:22:49.198 kid1| 5,3| 
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fcomm.cc&c=E,1,4wEE
> ydLqZtbeDc5YHCkgy5GsRjJ3_cLzlCGjyzHOV-hTEVEIsy3mNyF5ICP27wwTmSGp6ze8y2
> vdbqkthwhZqwWvH_jduoEypTSS0y2ytmL7&typo=1
> <https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fcomm.cc&c=E,1,3Gy
> 87egR90ZnusSy5exBZU0res4kBdHXTtCKE_jPDFJ67k-PY9AWyJYQlbMs93MRcEX4tmriD
> wIFkUn6n7F57YT-OWPTUDgMXKLJDMijoQr3ETZ_4qmLyO3mxoc,&typo=1&ancr_add=1>
> (558)
> commUnsetFdTimeout: Remove timeout for FD 24
>
>
> Best Regards,
>
> Johnathan
>
> *_______________________________________________________*
>
> **
>
> *Johnathan Hasty*
>
> Senior DevOps Engineer
>
> Uncommon Schools
>
> C: 989.366.1672
>
> *Un*common Schools | Change History
>
> Website
> <https://linkprotect.cudasvc.com/url?a=http%3a%2f%2fwww.uncommonschool
> s.org%2f&c=E,1,cWhZ9NA37cAb3SSkIYkr5EbwjBXA_1ECEBWI1BpFOMixjdXiqIYF5NH
> _rpjuRqGzBt9Av6GCLPt7UYFH62vFjyLlBBvmIAwJtSORWZeE&typo=1>?| Facebook 
> <http://www.facebook.com/uncommonschools>?| Twitter 
> <http://www.twitter.com/uncommonschools>?| LinkedIn 
> <http://www.linkedin.com/company/124759?trk=tyah>?| Apply Now 
> <https://linkprotect.cudasvc.com/url?a=http%3a%2f%2fwww.uncommonschool
> s.org%2fcareers&c=E,1,rgbpQND7NOQlb8Jv2r2mLOBnCdzuRSxPkW0uIyooMP2TwhUo
> tzeHZQjvRKQyUr3gDLWXSyG1jhOH92Ub7jL9_5wTQc42_HkbPCyQS5oyArE,&typo=1>
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> https://linkprotect.cudasvc.com/url?a=http%3a%2f%2flists.squid-cache.o
> rg%2flistinfo%2fsquid-users&c=E,1,J4_sclj9gC817Tmu9bhrA3OR4TSSruJYfYUM
> 6RkEXWZjj9XbwbXxgeS2yApz2pngh07velawZHPZD2mJFvgfC8P764tli3XXTMvKbYgp&t
> ypo=1

_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
https://linkprotect.cudasvc.com/url?a=http%3a%2f%2flists.squid-cache.org%2flistinfo%2fsquid-users&c=E,1,6nL_4Gs08LWJUKqb_q0ngPSzWGNPU1hDuBFl2fe6WS9B5z0mUCKS0CWyT3EUxoD8qdoRz_4UaAxr3vVuAUQCLDB05Yj639MDRp6MdlpX_jSXFtjL1Z2wKw,,&typo=1
CAUTION : This email originated from outside of the organization. Do not click links or open attachments unless you recognize the sender and know the content is safe.


From squid3 at treenet.co.nz  Fri Jul 15 17:27:13 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 16 Jul 2022 05:27:13 +1200
Subject: [squid-users] Upstream Proxy
In-Reply-To: <MN2PR10MB4176E4D46C38B24DFD6395F1F78B9@MN2PR10MB4176.namprd10.prod.outlook.com>
References: <MN2PR10MB4176DD2030DFE34D7C349F6CF78B9@MN2PR10MB4176.namprd10.prod.outlook.com>
 <61072e0a-43e2-6388-d121-8e433092513a@measurement-factory.com>
 <MN2PR10MB4176E4D46C38B24DFD6395F1F78B9@MN2PR10MB4176.namprd10.prod.outlook.com>
Message-ID: <381fb914-298d-95bf-2271-be6639b49fa6@treenet.co.nz>

On 16/07/22 04:05, Johnathan Hasty wrote:
>> What HTTP authentication method(s) or scheme(s) does your upstream proxy support or require?
> 
> They're very vague and not helpful. It was said they look for email, but in reality it would be user at blah.company.com rather than user at company.com.
> 
> 
> This is the only information I have for them.
> 
> https://support.goguardian.com/s/article/Deploying-GoGuardian-Gateway-1629767892527
> 
> https://view.highspot.com/viewer/5f7241dd628ba24915723e85
> 

This document is providing some answers, but indeed are a bit obscure.

The authentication is using LDAP service. Which means Squid should have 
its own account in LDAP registered as a machine account type (not a 
regular user, so it can avoid constant password update requirements). 
Those are the credentials you configure in the cache_peer line to be 
passed to GG.
  Make sure that you configure the full username string. Whether it be 
login=user at blah.example.com:password  or login=user at example.com:password 
or  login=user:password


Also, cache_peer should not need sslcapath= option. Just 'tls' and 
ensure the Squid machine Trusted CA certs package is kept up to date. If 
GG has a special Server certificate based on some custom CA, then use 
the tls-cafile= option to load that custom public root cert.


If you are still having issues, the contents of the PAC file generated 
for a test user account could have some more hints about what GG is 
expecting.


HTH
Amos


From ritu.sood at intel.com  Fri Jul 15 20:46:16 2022
From: ritu.sood at intel.com (Sood, Ritu)
Date: Fri, 15 Jul 2022 20:46:16 +0000
Subject: [squid-users] Support for OAuth2 Authorization flow
Message-ID: <SJ0PR11MB5581D514C77E2170F12A68D2EC8B9@SJ0PR11MB5581.namprd11.prod.outlook.com>

Hi
Currently Squid Bearer Authentication assumes that there is enough information in the HTTP CONNECT request headers to validate the user.  But, in case, if there is no valid JWT,  in our use case we want to initiate OAuth2 authorization flow from Squid and redirect the user to go to an IDP for getting authorization grant and then get access token.
How can this be supported in Squid?

Thanks
Ritu


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220715/3985fb7d/attachment.htm>

From squid3 at treenet.co.nz  Fri Jul 15 21:14:06 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 16 Jul 2022 09:14:06 +1200
Subject: [squid-users] Support for OAuth2 Authorization flow
In-Reply-To: <SJ0PR11MB5581D514C77E2170F12A68D2EC8B9@SJ0PR11MB5581.namprd11.prod.outlook.com>
References: <SJ0PR11MB5581D514C77E2170F12A68D2EC8B9@SJ0PR11MB5581.namprd11.prod.outlook.com>
Message-ID: <6f2da794-308d-8bf2-61f8-06dabbd84a42@treenet.co.nz>

On 16/07/22 08:46, Sood, Ritu wrote:
> Hi
> 
> Currently Squid Bearer Authentication assumes that there is enough 
> information in the HTTP CONNECT request headers to validate the user.  
> But, in case, if there is no valid JWT, ?in our use case we want to 
> initiate OAuth2 authorization flow from Squid and redirect the user to 
> go to an IDP for getting authorization grant and then get access token.
> 
> How can this be supported in Squid?
> 

(I assume you are using the Bearer auth PR branch we have for Squid.)

The Bearer auth helper you design can send Squid a set of key=value 
which get used in %note{key} macro in a deny_info URL and/or 
reply_header_add directive to set header strings.
  <http://www.squid-cache.org/Doc/config/deny_info/>
  <http://www.squid-cache.org/Doc/config/reply_header_add/>

The catch comes in with CONNECT method responses other than 
accept/deny/re-auth being ignored by most Browsers.


Cheers
Amos


From Theo.BARRAGUE.ext at boursorama.fr  Mon Jul 18 06:38:42 2022
From: Theo.BARRAGUE.ext at boursorama.fr (=?utf-8?B?VGjDqW8gQkFSUkFHVUU=?=)
Date: Mon, 18 Jul 2022 06:38:42 +0000
Subject: [squid-users] Squid stop sending icp after a random time
Message-ID: <PAYP264MB41271CFB1E083ED1C67E6885A38C9@PAYP264MB4127.FRAP264.PROD.OUTLOOK.COM>

Hello,

After a random time ( seconds, minutes or even hours ) squid stop sending ICP to neighbours.
This is my configuration for squid-1 :

cache_peer squid-2 parent 3128 3130 background-ping

dns_nameservers 1.1.1.1

netdb_filename none
netdb_ping_period 1 seconds
query_icmp on
never_direct allow all

http_access allow all
http_port 3128
icp_access allow all
icp_port 3130

?This is my configuration for squid-2 :

cache_peer_access squid-1 allow

dns_nameservers 1.1.1.1

netdb_filename none
netdb_ping_period 1 seconds

cache_dir null /tmp
cache deny all

shutdown_lifetime 15 seconds

http_access allow all
http_port 3128
icp_access allow all
icp_port 3130


I'm using Squid 4.6 from Debian Bullseye on a amd64 architecture

Squid Cache: Version 4.6
Service Name: squid
Debian linux
configure options:  '--build=x86_64-linux-gnu' '--prefix=/usr' '--includedir=${prefix}/include' '--mandir=${prefix}/share/man' '--infodir=${prefix}/share/info' '--sysconfdir=/etc' '--localstatedir=/var' '--libexecdir=${prefix}/lib/squid' '--srcdir=.' '--disable-maintainer-mode' '--disable-dependency-tracking' '--disable-silent-rules' 'BUILDCXXFLAGS=-g -O2 -fdebug-prefix-map=/build/squid-TqH43S/squid-4.6=. -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2 -Wl,-z,relro -Wl,-z,now -Wl,--as-needed -latomic' 'BUILDCXX=x86_64-linux-gnu-g++' '--with-build-environment=default' '--enable-build-info=Debian linux' '--datadir=/usr/share/squid' '--sysconfdir=/etc/squid' '--libexecdir=/usr/lib/squid' '--mandir=/usr/share/man' '--enable-inline' '--disable-arch-native' '--enable-async-io=8' '--enable-storeio=ufs,aufs,diskd,rock' '--enable-removal-policies=lru,heap' '--enable-delay-pools' '--enable-cache-digests' '--enable-icap-client' '--enable-follow-x-forwarded-for' '--enable-auth-basic=DB,fake,getpwnam,LDAP,NCSA,NIS,PAM,POP3,RADIUS,SASL,SMB' '--enable-auth-digest=file,LDAP' '--enable-auth-negotiate=kerberos,wrapper' '--enable-auth-ntlm=fake,SMB_LM' '--enable-external-acl-helpers=file_userip,kerberos_ldap_group,LDAP_group,session,SQL_session,time_quota,unix_group,wbinfo_group' '--enable-security-cert-validators=fake' '--enable-storeid-rewrite-helpers=file' '--enable-url-rewrite-helpers=fake' '--enable-eui' '--enable-esi' '--enable-icmp' '--enable-zph-qos' '--enable-ecap' '--disable-translation' '--with-swapdir=/var/spool/squid' '--with-logdir=/var/log/squid' '--with-pidfile=/var/run/squid.pid' '--with-filedescriptors=65536' '--with-large-files' '--with-default-user=proxy' '--with-gnutls' '--enable-linux-netfilter' 'build_alias=x86_64-linux-gnu' 'CC=x86_64-linux-gnu-gcc' 'CFLAGS=-g -O2 -fdebug-prefix-map=/build/squid-TqH43S/squid-4.6=. -fstack-protector-strong -Wformat -Werror=format-security -Wall' 'LDFLAGS=-Wl,-z,relro -Wl,-z,now -Wl,--as-needed -latomic' 'CPPFLAGS=-Wdate-time -D_FORTIFY_SOURCE=2' 'CXX=x86_64-linux-gnu-g++' 'CXXFLAGS=-g -O2 -fdebug-prefix-map=/build/squid-TqH43S/squid-4.6=. -fstack-protector-strong -Wformat -Werror=format-security'

What am I missing ? Do I have to switch to the latest Squid 5 ?

Thank's!

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220718/09c618ba/attachment.htm>

From squid3 at treenet.co.nz  Mon Jul 18 08:18:14 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Mon, 18 Jul 2022 20:18:14 +1200
Subject: [squid-users] Squid stop sending icp after a random time
In-Reply-To: <PAYP264MB41271CFB1E083ED1C67E6885A38C9@PAYP264MB4127.FRAP264.PROD.OUTLOOK.COM>
References: <PAYP264MB41271CFB1E083ED1C67E6885A38C9@PAYP264MB4127.FRAP264.PROD.OUTLOOK.COM>
Message-ID: <c94e7e05-792b-4ff6-7a5a-de2730ea14bb@treenet.co.nz>

On 18/07/22 18:38, Th?o BARRAGUE wrote:> Hello,
> 
> After a random time ( seconds, minutes or even hours ) squid stop 
> sending ICP to neighbours.
Given that all traffic from squid-1 is forced to go through squid-2 why 
are you bothering with ICP? that is only useful when there are 2+ peers 
to select from.



> This is my configuration for squid-1 :
> 
> cache_peer squid-2 parent 3128 3130 background-ping
> 
> dns_nameservers 1.1.1.1
> > netdb_filename none
> netdb_ping_period 1 seconds> query_icmp on
> never_direct allow all
> 
I highly recommend that you at least retain the default security 
settings for http_access. They are designed to protect against some 
nasty situations like proxy hijacking and DoS attacks.


> http_access allow all
> http_port 3128
> icp_access allow all
> icp_port 3130
> 
> ?This is my configuration for squid-2 :
> 
> cache_peer_access squid-1 allow
> 


There is no cache_peer definition in this config. Either this is not 
actually your config file contents, or Squid is using a different config 
file than you think.


> dns_nameservers 1.1.1.1
> 
> netdb_filename none
> netdb_ping_period 1 seconds
> 
> cache_dir null /tmp


The "null" storage type has not been part of Squid for most of a decade.
Erase the cache_dir line. Add "cache_mem 0 KB" instead.


> cache deny all
> 
> shutdown_lifetime 15 seconds
> 
> http_access allow all
> http_port 3128
> icp_access allow all
> icp_port 3130
> 
> 
> I'm using Squid 4.6 from Debian Bullseye on a amd64 architecture
> 

Bullseye currently ships with Squid-4.13. Please update to that, if only 
for the security patches.

I doubt v5 will work differently for your issue, but YMMV.


HTH
Amos


From Johnathan.Hasty at uncommonschools.org  Mon Jul 18 16:15:46 2022
From: Johnathan.Hasty at uncommonschools.org (Johnathan Hasty)
Date: Mon, 18 Jul 2022 16:15:46 +0000
Subject: [squid-users] Upstream Proxy
In-Reply-To: <381fb914-298d-95bf-2271-be6639b49fa6@treenet.co.nz>
References: <MN2PR10MB4176DD2030DFE34D7C349F6CF78B9@MN2PR10MB4176.namprd10.prod.outlook.com>
 <61072e0a-43e2-6388-d121-8e433092513a@measurement-factory.com>
 <MN2PR10MB4176E4D46C38B24DFD6395F1F78B9@MN2PR10MB4176.namprd10.prod.outlook.com>
 <381fb914-298d-95bf-2271-be6639b49fa6@treenet.co.nz>
Message-ID: <MN2PR10MB417633FBFAA6372585230458F78C9@MN2PR10MB4176.namprd10.prod.outlook.com>

Hello Amos, thank you very much for your very helpful response!

The vendor, while not helpful at all as they want our org to use their new application rather than proxy....Has stated they are only looking for email address and not password. But they likely mean they're looking for user.name at sub.domain.com

Thank you for tls-cafile= correction, as I do have GoGuardian's root certificate in that path and trusted on the Squid-hosted OS.

For Login= I have been trying to pass credentials from Windows to Squid to GoGuardian. From your response, I believe you are stating to have a "machine" user account that will be static for all users passing through Squid. This setup would be fine for us, but we would prefer to have the unique user's "email" passed through so that on GoGuardian's end our reports reflect the correct user.

I currently have Squid working with auth (when not handing off to GG), with Kerberos and NTLM. What I was hoping to achieve is handing this off to GG in the form of the username ("email").

I feel like I have http://www.squid-cache.org/Doc/config/cache_peer/ 's authentication options memorized, however it is possible I am using them (login=) incorrectly.

The vendor refuses to look at logs on their end to troubleshoot, as they do not have access and the engineers who do aren't replying! Lovely...




1658160759.291    166 10.125.12.19 TCP_DENIED/407 4233 CONNECT abc.com:443 - HIER_NONE/- text/html "ws-iid=-" "ws-mac=00:00:00:00:00:00" "ws-duration=-" "ws-timing=-" "ws-mtime=-" "ws-scanflags=-" "ws-categories=-" "ws-trusted=-" "ws-level=-" "ws-verdict=-" "ws-policy=-" "ws-member=-" "ws-module=-" "ws-msgtype=-" "ws-param1=-" "ws-param2=-" "ws-debug=-" "squid-gt-st=199"
1658160760.048     73 10.125.12.19 NONE_NONE/200 0 CONNECT abc.com:443 johnathan.hasty at USI.UNCOMMONSCHOOLS.ORG HIER_NONE/- - "ws-iid=94" "ws-mac=00:00:00:00:00:00" "ws-duration=2105" "ws-timing=0" "ws-mtime=0" "ws-scanflags=63" "ws-categories=0" "ws-trusted=0" "ws-level=1" "ws-verdict=0" "ws-policy=default" "ws-member=default" "ws-module=2" "ws-msgtype=2" "ws-param1=None" "ws-param2=None" "ws-debug=None" "squid-gt-st=3220"
1658160760.165    117 10.125.12.19 TCP_TUNNEL/407 0 CONNECT abc.com:443 johnathan.hasty at USI.UNCOMMONSCHOOLS.ORG FIRSTUP_PARENT/52.44.107.1 - "ws-iid=95" "ws-mac=00:00:00:00:00:00" "ws-duration=63" "ws-timing=0" "ws-mtime=0" "ws-scanflags=63" "ws-categories=0" "ws-trusted=0" "ws-level=1" "ws-verdict=0" "ws-policy=default" "ws-member=default" "ws-module=2" "ws-msgtype=2" "ws-param1=None" "ws-param2=None" "ws-debug=None" "squid-gt-st=0"
1658160760.165      0 10.125.12.19 NONE_NONE/000 0 - error:transaction-end-before-headers - HIER_NONE/- - "ws-iid=-" "ws-mac=-" "ws-duration=-" "ws-timing=-" "ws-mtime=-" "ws-scanflags=-" "ws-categories=-" "ws-trusted=-" "ws-level=-" "ws-verdict=-" "ws-policy=-" "ws-member=-" "ws-module=-" "ws-msgtype=-" "ws-param1=-" "ws-param2=-" "ws-debug=-" "squid-gt-st=517"


----------
CONNECT getpocket.cdn.mozilla.net:443 HTTP/1.1
Host: getpocket.cdn.mozilla.net:443
Via: 1.1 poc-websafety.usi.uncommonschools.org (squid/5.5)
X-Forwarded-For: 10.125.12.19
Proxy-Authorization: Basic [redacted]
Cache-Control: max-age=259200
Connection: close


----------



---------
HTTP/1.1 407 Proxy Authentication Required
Proxy-Authenticate: Basic realm="Secure Browsing"
Date: Mon, 18 Jul 2022 16:13:28 GMT
Content-Length: 0
Connection: close

----------




Best Regards,?
Johnathan
?
_______________________________________________________?
??
Johnathan Hasty?
Senior DevOps Engineer?
Uncommon Schools?
C: 989.366.1672?
??
Uncommon Schools | Change History?
Website?|?Facebook?|?Twitter?|?LinkedIn?|?Apply Now?

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Amos Jeffries
Sent: Friday, July 15, 2022 1:27 PM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Upstream Proxy

On 16/07/22 04:05, Johnathan Hasty wrote:
>> What HTTP authentication method(s) or scheme(s) does your upstream proxy support or require?
>
> They're very vague and not helpful. It was said they look for email, but in reality it would be user at blah.company.com rather than user at company.com.
>
>
> This is the only information I have for them.
>
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fsupport.goguardian
> .com%2fs%2farticle%2fDeploying-GoGuardian-Gateway-1629767892527&c=E,1,
> kxoL6sN8CmL8UJVV7XAszjC5mA2VYXeLIYssH9544vgm37JbQ44M6EZogCrg-UmQilt1uk
> BdNerDVyJj9CitYUk5aQX0P9NqNDjbcNYV-ImK&typo=1
>
> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fview.highspot.com%
> 2fviewer%2f5f7241dd628ba24915723e85&c=E,1,dxC_Gqqw2wC0pGrZOpS7-THHKfgN
> Utm5i8wjs5Ac9f2Jon2meVKJs0rNytWei3YbxnYP8cNbFntUm7e9E34E2dGHoyKwTvfmiM
> MKCvRjnxg7&typo=1
>

This document is providing some answers, but indeed are a bit obscure.

The authentication is using LDAP service. Which means Squid should have its own account in LDAP registered as a machine account type (not a regular user, so it can avoid constant password update requirements).
Those are the credentials you configure in the cache_peer line to be passed to GG.
  Make sure that you configure the full username string. Whether it be login=user at blah.example.com:password  or login=user at example.com:password or  login=user:password


Also, cache_peer should not need sslcapath= option. Just 'tls' and ensure the Squid machine Trusted CA certs package is kept up to date. If GG has a special Server certificate based on some custom CA, then use the tls-cafile= option to load that custom public root cert.


If you are still having issues, the contents of the PAC file generated for a test user account could have some more hints about what GG is expecting.


HTH
Amos
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
https://linkprotect.cudasvc.com/url?a=http%3a%2f%2flists.squid-cache.org%2flistinfo%2fsquid-users&c=E,1,p0pIs1RkqwtsIzZ-qgPtXeEFoSfUyjivFLuTCVPZhVMDWCtYW2Nrlh1pGrW3jFWJYwsWZgEMtY8MTMjtg1bA-UDPcCY9hRhweJEdl7NdDScvjx-99Kir&typo=1
CAUTION : This email originated from outside of the organization. Do not click links or open attachments unless you recognize the sender and know the content is safe.



From rousskov at measurement-factory.com  Mon Jul 18 18:32:03 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Mon, 18 Jul 2022 14:32:03 -0400
Subject: [squid-users] Upstream Proxy
In-Reply-To: <MN2PR10MB417633FBFAA6372585230458F78C9@MN2PR10MB4176.namprd10.prod.outlook.com>
References: <MN2PR10MB4176DD2030DFE34D7C349F6CF78B9@MN2PR10MB4176.namprd10.prod.outlook.com>
 <61072e0a-43e2-6388-d121-8e433092513a@measurement-factory.com>
 <MN2PR10MB4176E4D46C38B24DFD6395F1F78B9@MN2PR10MB4176.namprd10.prod.outlook.com>
 <381fb914-298d-95bf-2271-be6639b49fa6@treenet.co.nz>
 <MN2PR10MB417633FBFAA6372585230458F78C9@MN2PR10MB4176.namprd10.prod.outlook.com>
Message-ID: <173580d7-12c6-ebf5-6e36-8240f9f10474@measurement-factory.com>

On 7/18/22 12:15, Johnathan Hasty wrote:

> The vendor, while not helpful at all as they want our org to use
> their new application rather than proxy....Has stated they are only
> looking for email address and not password. But they likely mean
> they're looking for user.name at sub.domain.com

I see two options for going forward:

* Continue guessing what the upstream proxy wants to receive from Squid. 
This may go on forever because you do not know the authentication scheme 
they are using and you do not know the proper credentials for that 
scheme. The number of potential configurations to test is infinite.

* Do what they want -- set things up (without Squid!) so that HTTP 
clients authenticate with the upstream proxy. AFAICT, the vendor will 
help you with that. Then use the _working_ example to reverse engineer 
the right answers instead of guessing them.

Alex.



> Thank you for tls-cafile= correction, as I do have GoGuardian's root certificate in that path and trusted on the Squid-hosted OS.
> 
> For Login= I have been trying to pass credentials from Windows to Squid to GoGuardian. From your response, I believe you are stating to have a "machine" user account that will be static for all users passing through Squid. This setup would be fine for us, but we would prefer to have the unique user's "email" passed through so that on GoGuardian's end our reports reflect the correct user.
> 
> I currently have Squid working with auth (when not handing off to GG), with Kerberos and NTLM. What I was hoping to achieve is handing this off to GG in the form of the username ("email").
> 
> I feel like I have http://www.squid-cache.org/Doc/config/cache_peer/ 's authentication options memorized, however it is possible I am using them (login=) incorrectly.
> 
> The vendor refuses to look at logs on their end to troubleshoot, as they do not have access and the engineers who do aren't replying! Lovely...
> 
> 
> 
> 
> 1658160759.291    166 10.125.12.19 TCP_DENIED/407 4233 CONNECT abc.com:443 - HIER_NONE/- text/html "ws-iid=-" "ws-mac=00:00:00:00:00:00" "ws-duration=-" "ws-timing=-" "ws-mtime=-" "ws-scanflags=-" "ws-categories=-" "ws-trusted=-" "ws-level=-" "ws-verdict=-" "ws-policy=-" "ws-member=-" "ws-module=-" "ws-msgtype=-" "ws-param1=-" "ws-param2=-" "ws-debug=-" "squid-gt-st=199"
> 1658160760.048     73 10.125.12.19 NONE_NONE/200 0 CONNECT abc.com:443 johnathan.hasty at USI.UNCOMMONSCHOOLS.ORG HIER_NONE/- - "ws-iid=94" "ws-mac=00:00:00:00:00:00" "ws-duration=2105" "ws-timing=0" "ws-mtime=0" "ws-scanflags=63" "ws-categories=0" "ws-trusted=0" "ws-level=1" "ws-verdict=0" "ws-policy=default" "ws-member=default" "ws-module=2" "ws-msgtype=2" "ws-param1=None" "ws-param2=None" "ws-debug=None" "squid-gt-st=3220"
> 1658160760.165    117 10.125.12.19 TCP_TUNNEL/407 0 CONNECT abc.com:443 johnathan.hasty at USI.UNCOMMONSCHOOLS.ORG FIRSTUP_PARENT/52.44.107.1 - "ws-iid=95" "ws-mac=00:00:00:00:00:00" "ws-duration=63" "ws-timing=0" "ws-mtime=0" "ws-scanflags=63" "ws-categories=0" "ws-trusted=0" "ws-level=1" "ws-verdict=0" "ws-policy=default" "ws-member=default" "ws-module=2" "ws-msgtype=2" "ws-param1=None" "ws-param2=None" "ws-debug=None" "squid-gt-st=0"
> 1658160760.165      0 10.125.12.19 NONE_NONE/000 0 - error:transaction-end-before-headers - HIER_NONE/- - "ws-iid=-" "ws-mac=-" "ws-duration=-" "ws-timing=-" "ws-mtime=-" "ws-scanflags=-" "ws-categories=-" "ws-trusted=-" "ws-level=-" "ws-verdict=-" "ws-policy=-" "ws-member=-" "ws-module=-" "ws-msgtype=-" "ws-param1=-" "ws-param2=-" "ws-debug=-" "squid-gt-st=517"
> 
> 
> ----------
> CONNECT getpocket.cdn.mozilla.net:443 HTTP/1.1
> Host: getpocket.cdn.mozilla.net:443
> Via: 1.1 poc-websafety.usi.uncommonschools.org (squid/5.5)
> X-Forwarded-For: 10.125.12.19
> Proxy-Authorization: Basic [redacted]
> Cache-Control: max-age=259200
> Connection: close
> 
> 
> ----------
> 
> 
> 
> ---------
> HTTP/1.1 407 Proxy Authentication Required
> Proxy-Authenticate: Basic realm="Secure Browsing"
> Date: Mon, 18 Jul 2022 16:13:28 GMT
> Content-Length: 0
> Connection: close
> 
> ----------
> 
> 
> 
> 
> Best Regards,
> Johnathan
>   
> _______________________________________________________
>    
> Johnathan Hasty
> Senior DevOps Engineer
> Uncommon Schools
> C: 989.366.1672
>    
> Uncommon Schools | Change History
> Website?|?Facebook?|?Twitter?|?LinkedIn?|?Apply Now
> 
> -----Original Message-----
> From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Amos Jeffries
> Sent: Friday, July 15, 2022 1:27 PM
> To: squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] Upstream Proxy
> 
> On 16/07/22 04:05, Johnathan Hasty wrote:
>>> What HTTP authentication method(s) or scheme(s) does your upstream proxy support or require?
>>
>> They're very vague and not helpful. It was said they look for email, but in reality it would be user at blah.company.com rather than user at company.com.
>>
>>
>> This is the only information I have for them.
>>
>> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fsupport.goguardian
>> .com%2fs%2farticle%2fDeploying-GoGuardian-Gateway-1629767892527&c=E,1,
>> kxoL6sN8CmL8UJVV7XAszjC5mA2VYXeLIYssH9544vgm37JbQ44M6EZogCrg-UmQilt1uk
>> BdNerDVyJj9CitYUk5aQX0P9NqNDjbcNYV-ImK&typo=1
>>
>> https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fview.highspot.com%
>> 2fviewer%2f5f7241dd628ba24915723e85&c=E,1,dxC_Gqqw2wC0pGrZOpS7-THHKfgN
>> Utm5i8wjs5Ac9f2Jon2meVKJs0rNytWei3YbxnYP8cNbFntUm7e9E34E2dGHoyKwTvfmiM
>> MKCvRjnxg7&typo=1
>>
> 
> This document is providing some answers, but indeed are a bit obscure.
> 
> The authentication is using LDAP service. Which means Squid should have its own account in LDAP registered as a machine account type (not a regular user, so it can avoid constant password update requirements).
> Those are the credentials you configure in the cache_peer line to be passed to GG.
>    Make sure that you configure the full username string. Whether it be login=user at blah.example.com:password  or login=user at example.com:password or  login=user:password
> 
> 
> Also, cache_peer should not need sslcapath= option. Just 'tls' and ensure the Squid machine Trusted CA certs package is kept up to date. If GG has a special Server certificate based on some custom CA, then use the tls-cafile= option to load that custom public root cert.
> 
> 
> If you are still having issues, the contents of the PAC file generated for a test user account could have some more hints about what GG is expecting.
> 
> 
> HTH
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> https://linkprotect.cudasvc.com/url?a=http%3a%2f%2flists.squid-cache.org%2flistinfo%2fsquid-users&c=E,1,p0pIs1RkqwtsIzZ-qgPtXeEFoSfUyjivFLuTCVPZhVMDWCtYW2Nrlh1pGrW3jFWJYwsWZgEMtY8MTMjtg1bA-UDPcCY9hRhweJEdl7NdDScvjx-99Kir&typo=1
> CAUTION : This email originated from outside of the organization. Do not click links or open attachments unless you recognize the sender and know the content is safe.
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



From ronny.preiss at gmail.com  Tue Jul 19 10:54:48 2022
From: ronny.preiss at gmail.com (Ronny Preiss)
Date: Tue, 19 Jul 2022 12:54:48 +0200
Subject: [squid-users] Fwd:  Sqid uses all RAM / killed by OOM
In-Reply-To: <001601d89b58$24178c60$6c46a520$@gmail.com>
References: <CABMAtPLpoUrAXJv+JJvMbAe=N-b-brQeTTzq4OqDNc3Rf31GoQ@mail.gmail.com>
 <000c01d89519$b244bd40$16ce37c0$@gmail.com>
 <CABMAtPL8ea829_YisKG8AgBPnB=FuoZXcYV9M2OVmDbKB-M-5Q@mail.gmail.com>
 <001f01d89a7b$9622fd40$c268f7c0$@gmail.com>
 <CABMAtPJtrRpMdiVyRFQnLKfEs7B96-M9Zk0Puuy=yc0w9aM8_Q@mail.gmail.com>
 <000f01d89b52$bc36c840$34a458c0$@gmail.com>
 <CABMAtPLLwGB9gXZhJT1tL8TdBNO8=48BXVZCRbrHO7T+v7qifQ@mail.gmail.com>
 <001601d89b58$24178c60$6c46a520$@gmail.com>
Message-ID: <CABMAtPK_m0OYzfDLU89+eBZ51EMRuJjPhRCtRzmvmkbBbe8h+A@mail.gmail.com>

Hello All,

Amos or Alexander can you help me to compile a working squid 5.6 version on
Ubuntu 22.04 without this "memory leak". I would need a patch here.
As you can see in the mail history below, between me and Eliezer, I have a
memory leak problem with Ubuntu 22.04 and the squid 5.2 from the ubuntu
repository.

---
With kind regards
Ronny


---------- Forwarded message ---------
Von: <ngtech1ltd at gmail.com>
Date: Di., 19. Juli 2022 um 12:13 Uhr
Subject: RE: [squid-users] Sqid uses all RAM / killed by OOM
To: Ronny Preiss <ronny.preiss at gmail.com>


No Problem.



----

Eliezer Croitoru

NgTech, Tech Support

Mobile: +972-5-28704261

Email: ngtech1ltd at gmail.com

Web: https://ngtech.co.il/

My-Tube: https://tube.ngtech.co.il/



*From:* Ronny Preiss <ronny.preiss at gmail.com>
*Sent:* Tuesday, 19 July 2022 12:42
*To:* ngtech1ltd at gmail.com
*Subject:* Re: [squid-users] Sqid uses all RAM / killed by OOM



Hi Eliezer,



Is it ok for you if I use this mail as reference when writing to Amos or
Alex via the squid-user mailing list?



---

With kind regards

Ronny





Am Di., 19. Juli 2022 um 11:34 Uhr schrieb <ngtech1ltd at gmail.com>:

There was a memory leak in 5.x which was fixed later on.

Currently there is no patch for 5.6 so that you will be able to run 5.6 on
Ubuntu 22.04.

It will take time for this patch to get into squid 5.7 or 5.8.

My recommendation for now is to use either 20.04 or another Linux version.

I am using Oracle Enterprise Linux 8 which is free and is very stable.



If you want to resolve the issue on Ubuntu 22.04 you will need to compile
and patch squid yourself.

Try to post again in the squid-user mailing list and maybe Amos or Alex be
able to offer you some guidance.



All The Bests,

Eliezer



----

Eliezer Croitoru

NgTech, Tech Support

Mobile: +972-5-28704261

Email: ngtech1ltd at gmail.com

Web: https://ngtech.co.il/

My-Tube: https://tube.ngtech.co.il/



*From:* Ronny Preiss <ronny.preiss at gmail.com>
*Sent:* Tuesday, 19 July 2022 10:10
*To:* ngtech1ltd at gmail.com
*Subject:* Re: [squid-users] Sqid uses all RAM / killed by OOM



Hey Eliezer,



>First you better use 16k FD just to be in the safe side.

I have increased the value to 16384 and increased the RAM to 8GB.

Furthermore I have uploaded logs again. Enclosed the link:

https://1drv.ms/u/s!Aj-l0jAnmUwxrzk9LShqiEAORyEg (OneDrive)



>cache deny all

>Should do the trick.



It looks like the RAM and SWAP are running full despite 'cache deny all'.



top - 09:07:23 up 21:08,  3 users,  load average: 0.12, 0.13, 0.09

Tasks: 244 total,   1 running, 243 sleeping,   0 stopped,   0 zombie

%Cpu(s):  1.6 us,  3.5 sy,  0.0 ni, 91.9 id,  0.0 wa,  0.0 hi,  3.0 si,
0.0 s

MiB Mem :   7951.2 total,    119.6 free,   7688.0 used,    143.6 buff/cache

MiB Swap:   3925.0 total,    649.2 free,   3275.8 used.     53.3 avail Mem



    PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+

   1769 proxy     20   0   13.3g   7.2g   8988 S  22.0  92.9  40:03.05

   1770 proxy     20   0    6060    672    672 S   0.0   0.0   0:17.24

   1771 proxy     20   0    6052    688    652 S   0.0   0.0   0:00.08

   2172 proxy     20   0    6172   3040   2768 S   0.0   0.0   0:01.47





> If you ask me it?s better to use 22.04 and or other versions of linux until
a fix will be found

>(if possible?.)

I have a requirement to upgrade from Ubuntu 20.04.4 to Ubuntu 22.04.



>Please let me know what is your:

>squid -v



Squid Cache: Version 5.2

Service Name: squid

Ubuntu linux

configure options:  '--build=x86_64-linux-gnu' '--prefix=/usr'
'--includedir=${prefix}/include' '--mandir=${prefix}/share/man'
'--infodir=${prefix}/share/info' '--sysconfdir=/etc' '--localstatedir=/var'
'--disable-option-checking' '--disable-silent-rules'
'--libdir=${prefix}/lib/x86_64-linux-gnu' '--runstatedir=/run'
'--disable-maintainer-mode' '--disable-dependency-tracking'
'BUILDCXXFLAGS=-g -O2 -ffile-prefix-map=/build/squid-DQ03Be/squid-5.2=.
-flto=auto -ffat-lto-objects -flto=auto -ffat-lto-objects
-fstack-protector-strong -Wformat -Werror=format-security -Wdate-time
-D_FORTIFY_SOURCE=2 -Wl,-Bsymbolic-functions -flto=auto -ffat-lto-objects
-flto=auto -Wl,-z,relro -Wl,-z,now ' 'BUILDCXX=g++'
'--with-build-environment=default' '--enable-build-info=Ubuntu linux'
'--datadir=/usr/share/squid' '--sysconfdir=/etc/squid'
'--libexecdir=/usr/lib/squid' '--mandir=/usr/share/man' '--enable-inline'
'--disable-arch-native' '--enable-async-io=8'
'--enable-storeio=ufs,aufs,diskd,rock' '--enable-removal-policies=lru,heap'
'--enable-delay-pools' '--enable-cache-digests' '--enable-icap-client'
'--enable-follow-x-forwarded-for'
'--enable-auth-basic=DB,fake,getpwnam,LDAP,NCSA,PAM,POP3,RADIUS,SASL,SMB'
'--enable-auth-digest=file,LDAP' '--enable-auth-negotiate=kerberos,wrapper'
'--enable-auth-ntlm=fake,SMB_LM'
'--enable-external-acl-helpers=file_userip,kerberos_ldap_group,LDAP_group,session,SQL_session,time_quota,unix_group,wbinfo_group'
'--enable-security-cert-validators=fake'
'--enable-storeid-rewrite-helpers=file' '--enable-url-rewrite-helpers=fake'
'--enable-eui' '--enable-esi' '--enable-icmp' '--enable-zph-qos'
'--enable-ecap' '--disable-translation' '--with-swapdir=/var/spool/squid'
'--with-logdir=/var/log/squid' '--with-pidfile=/run/squid.pid'
'--with-filedescriptors=65536' '--with-large-files'
'--with-default-user=proxy' '--enable-linux-netfilter' '--with-systemd'
'--with-gnutls' 'build_alias=x86_64-linux-gnu' 'CFLAGS=-g -O2
-ffile-prefix-map=/build/squid-DQ03Be/squid-5.2=. -flto=auto
-ffat-lto-objects -flto=auto -ffat-lto-objects -fstack-protector-strong
-Wformat -Werror=format-security -Wall' 'LDFLAGS=-Wl,-Bsymbolic-functions
-flto=auto -ffat-lto-objects -flto=auto -Wl,-z,relro -Wl,-z,now '
'CPPFLAGS=-Wdate-time -D_FORTIFY_SOURCE=2' 'CXXFLAGS=-g -O2
-ffile-prefix-map=/build/squid-DQ03Be/squid-5.2=. -flto=auto
-ffat-lto-objects -flto=auto -ffat-lto-objects -fstack-protector-strong
-Wformat -Werror=format-security'

root at 01-proxyha03:~#



Here also again my new adjusted current configuration:



root at 01-proxyha01:~# grep -v ^# /etc/squid/squid.conf | grep .

acl localnet src 0.0.0.1-0.255.255.255  # RFC 1122 "this" network (LAN)

acl localnet src 10.172.xxx.0/18        # RFC 1918 local private network
(LAN)

acl localnet src 100.64.0.0/10          # RFC 6598 shared address space
(CGN)

acl localnet src 169.254.0.0/16         # RFC 3927 link-local (directly
plugged) machines

acl localnet src 172.16.0.0/12          # RFC 1918 local private network
(LAN)

acl localnet src 192.168.0.0/16         # RFC 1918 local private network
(LAN)

acl SSL_ports port 443

acl Safe_ports port 80          # http

acl Safe_ports port 21          # ftp

acl Safe_ports port 443         # https

acl Safe_ports port 70          # gopher

acl Safe_ports port 210         # wais

acl Safe_ports port 1025-65535  # unregistered ports

acl Safe_ports port 280         # http-mgmt

acl Safe_ports port 488         # gss-http

acl Safe_ports port 591         # filemaker

acl Safe_ports port 777         # multiling http

http_access deny !Safe_ports

http_access allow localnet Safe_ports

http_access allow localhost manager

http_access deny manager

http_access allow localhost

http_access deny all

include /etc/squid/conf.d/*

cache_peer 10.210.xxx.xxx parent 8080 0 no-query default

cache deny all

cache_dir ufs /var/spool/squid 3000 16 256

coredump_dir /var/spool/squid

refresh_pattern ^ftp:           1440    20%     10080

refresh_pattern ^gopher:        1440    0%      1440

refresh_pattern -i (/cgi-bin/|\?) 0     0%      0

refresh_pattern \/(Packages|Sources)(|\.bz2|\.gz|\.xz)$ 0 0% 0 refresh-ims

refresh_pattern \/Release(|\.gpg)$ 0 0% 0 refresh-ims

refresh_pattern \/InRelease$ 0 0% 0 refresh-ims

refresh_pattern \/(Translation-.*)(|\.bz2|\.gz|\.xz)$ 0 0% 0 refresh-ims

refresh_pattern .               0       20%     4320

never_direct allow all

max_filedescriptors 16384

dns_nameservers 10.244.xxx.xxx

root at 01-proxyha01:~#



---

With kind regards

Ronny





Am Mo., 18. Juli 2022 um 09:54 Uhr schrieb <ngtech1ltd at gmail.com>:

Hey Ronny,



First you better use 16k FD just to be in the safe side.

Seconds I have seen that you need more then 4GB of ram ie at least 8GB.

Another thing to try to see if it helps is to disable the cache to verify
that this is not what causing the issue.



cache deny all



Should do the trick.



I didn?t manage to build Squid 5.6 on Ubuntu 22.04 yet and will test it
later on.

If you ask me it?s better to use 22.04 and or other versions of linux until
a fix will be found

(if possible?.)

Please let me know what is your:

squid -v



output so I can try to what are the right configure options for your use
case.



Eliezer



----

Eliezer Croitoru

NgTech, Tech Support

Mobile: +972-5-28704261

Email: ngtech1ltd at gmail.com

Web: https://ngtech.co.il/

My-Tube: https://tube.ngtech.co.il/



*From:* Ronny Preiss <ronny.preiss at gmail.com>
*Sent:* Monday, 18 July 2022 8:35
*To:* ngtech1ltd at gmail.com
*Subject:* Re: [squid-users] Sqid uses all RAM / killed by OOM



Hey Eliezer,



I hope I can answer everything so far.



> Second, use Squid 5.6 and not 5.2

How can I use Squid 5.6 in Ubuntu 22.04?  I've installed squid 5.2 with
"apt install squid"



> The issue is not necessarily  because of the Squid version but other
things.

On the Ubuntu 22.04 server only squid is installed so far.



> First upgrade to 5.6 and then we need the top snapshot.

How can I upgrade squid to 5.6? Compile it myself? If yes, which configure
options are needed?

Do you have any hints I should follow?



> I am using it like this:

> /usr/local/bin/dump-cache-mgr-to-file.sh 2>&1 | tee ?cachemg-data$(date
+%Y-%m-%d_%H-%M-%S)?

> cat

> Try to take couple dumps with 4.1 and 5.6 (if you want 5.2 also) and
upload the snapshots to somewhere in a zip file.

Download Link: https://1drv.ms/u/s!Aj-l0jAnmUwxrzjzqZwAF5LwTMEw?e=amk6om
(OneDrive)



>A machine that should handle ?max_filedescriptors 40960? ie above 16k
should have more RAM ie 8-16 GB as a starter.

I watched the value with the squidclient mgr:info for a while and adjusted
it to 12288.



---

With kind regards

Ronny





Am Mo., 11. Juli 2022 um 13:31 Uhr schrieb <ngtech1ltd at gmail.com>:

Hey Ronny,



First to make the data more readable use a top snapshot to illustrate the
memory usage.

Second, use Squid 5.6 and not 5.2

The issue is not necessarily  because of the Squid version but other things.

We should narrow down the issues as any other Squid issue.

First upgrade to 5.6 and then we need the top snapshot.

After that we need snapshots of cache-manager pages.



To dump snapshots of the cache manager pages you can use the next script:

https://gist.githubusercontent.com/elico/8790bdc835d8e9ecbc57e72fc31effc0/raw/60d140b0e772fa4f418779bfc27e4804a345ce23/dump-cache-mgr-to-file.sh



I am using it like this:

/usr/local/bin/dump-cache-mgr-to-file.sh 2>&1 | tee ?cachemg-data$(date
+%Y-%m-%d_%H-%M-%S)?

 cat

Try to take couple dumps with 4.1 and 5.6 (if you want 5.2 also) and upload
the snapshots to somewhere in a zip file.

Just take into account that these snapshots may contains confidential data
so you are advised to review them and deduct specific
parts of them before making them public.



Just an advice,

A machine that should handle ?max_filedescriptors 40960? ie above 16k
should have more RAM ie 8-16 GB as a starter.



All The Bests,

Eliezer



----

Eliezer Croitoru

NgTech, Tech Support

Mobile: +972-5-28704261

Email: ngtech1ltd at gmail.com

Web: https://ngtech.co.il/

My-Tube: https://tube.ngtech.co.il/



*From:* squid-users <squid-users-bounces at lists.squid-cache.org> *On Behalf
Of *Ronny Preiss
*Sent:* Monday, 11 July 2022 9:55
*To:* squid-users at lists.squid-cache.org
*Subject:* [squid-users] Sqid uses all RAM / killed by OOM



Hello all,



I have the following problem with squid 5.2 on ubuntu 22.04.

Squid consumes all ram and the entire SWAP. When swap and ram are
completely full, the OOM killer strikes and terminates the process.



We use three internal child proxy servers with keepalived and haproxy as
load balancers. From our ISP we use a parent upstream proxy for external
internet traffic.

As an operating system we have so far Ubuntu 20.04.4 with squid 4.1 in use.
This constellation works flawlessly.



Now I want to update the Server to Ubuntu 22.04 and squid 5.2. But with
Ubuntu 22.04 and squid 5.2 the above mentioned problem with the OOM Killer
occurs.

The new machine has only the OS and squid installed.



Who can help me with a solution?



With kind regards

Ronny



Attached the squid configuration and the VMWare specs.



### VM Specs ###

OS: Ubuntu 22.04 Server

CPU: 4x (Intel(R) Xeon(R) CPU E5-2690 v3 @ 2.60GHz)

RAM: 4 GB

VMWare: ESXi 7.0 U2



### CONFIG ###

acl 10.172.xxx.xxx/18 <http://10.172.128.0/18> src 10.172.xxx.xxx/18
<http://10.172.128.0/18>

acl 172.16.xxx.xxx/12 <http://172.16.0.0/12> src 172.16.xxx.xxx/12
<http://172.16.0.0/12>

acl 192.168.xxx.xxx/16 <http://192.168.0.0/16> src 192.168.xxx.xxx/16
<http://192.168.0.0/16>



acl Safe_ports port 80

acl Safe_ports port 21

acl Safe_ports port 443

acl Safe_ports port 70

acl Safe_ports port 210

acl Safe_ports port 1025-65535

acl Safe_ports port 280

acl Safe_ports port 488

acl Safe_ports port 591

acl Safe_ports port 777



http_access allow 10.172.xxx.xxx/18 <http://10.172.128.0/18> Safe_ports

http_access allow 172.16.xxx.xxx/12 <http://172.16.0.0/12> Safe_ports

http_access allow 192.168.xxx.xxx/16 <http://192.168.0.0/16> Safe_ports



http_access allow localhost manager

http_access allow localhost

http_access deny manager

http_access deny all



include /etc/squid/conf.d/*

http_port 10.172.xxx.xxx:3128 <http://10.172.128.34:3128>



cache_peer 10.210.xxx.xxx parent 8080 0

cache_dir ufs /var/spool/squid 3000 16 256

cache_effective_user proxy

cache_effective_group proxy



coredump_dir /var/spool/squid



refresh_pattern ^ftp:           1440    20%     10080

refresh_pattern ^gopher:        1440    0%      1440

refresh_pattern -i (/cgi-bin/|\?) 0     0%      0

refresh_pattern \/(Packages|Sources)(|\.bz2|\.gz|\.xz)$ 0 0% 0 refresh-ims

refresh_pattern \/Release(|\.gpg)$ 0 0% 0 refresh-ims

refresh_pattern \/InRelease$ 0 0% 0 refresh-ims

refresh_pattern \/(Translation-.*)(|\.bz2|\.gz|\.xz)$ 0 0% 0 refresh-ims

refresh_pattern .               0       20%     4320



never_direct allow all

max_filedescriptors 40960

dns_nameservers 10.244.xxx.xxx



### DMESG ###



[256929.150801]
oom-kill:constraint=CONSTRAINT_NONE,nodemask=(null),cpuset=/,mems_allowed=0,global_oom,task_memcg=/system.slice/squid.service,task=squid,pid=26390,uid=13

[256929.150822] Out of memory: Killed process 26390 (squid)
total-vm:9691764kB, anon-rss:3657748kB, file-rss:2320kB, shmem-rss:0kB,
UID:13 pgtables:18932kB oom_score_adj:0

[256929.510641] oom_reaper: reaped process 26390 (squid), now anon-rss:0kB,
file-rss:0kB, shmem-rss:0kB





_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220719/e138b38a/attachment.htm>

From squid.org at bloms.de  Tue Jul 19 12:05:17 2022
From: squid.org at bloms.de (Dieter Bloms)
Date: Tue, 19 Jul 2022 14:05:17 +0200
Subject: [squid-users] how to put the destination ip to an external acl
 helper ?
Message-ID: <20220719120517.3lr7e36jfgkemajn@bloms.de>

Hello,

I wrote a little external acl helper and want squid to put the
destination fqdn _and_ the destination ip to it.

I found the parameter %DST and this is filled with the destination fqdn.

Is there also a parameter for the destination ip squid want's to connect to ?


-- 
Regards

  Dieter

--
I do not get viruses because I do not use MS software.
If you use Outlook then please do not put my email address in your
address-book so that WHEN you get a virus it won't use my address in the
>From field.


From squid3 at treenet.co.nz  Tue Jul 19 21:51:26 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 20 Jul 2022 09:51:26 +1200
Subject: [squid-users] how to put the destination ip to an external acl
 helper ?
In-Reply-To: <20220719120517.3lr7e36jfgkemajn@bloms.de>
References: <20220719120517.3lr7e36jfgkemajn@bloms.de>
Message-ID: <97f0b9b7-2d48-ccd1-a47d-0a86fcc87fea@treenet.co.nz>

On 20/07/22 00:05, Dieter Bloms wrote:
> Hello,
> 
> I wrote a little external acl helper and want squid to put the
> destination fqdn _and_ the destination ip to it.
> 
> I found the parameter %DST and this is filled with the destination fqdn.
> 
> Is there also a parameter for the destination ip squid want's to connect to ?
> 

In modern Squid you use the logformat macros in external_acl_type format.


Amos


From ngtech1ltd at gmail.com  Tue Jul 19 22:02:19 2022
From: ngtech1ltd at gmail.com (NgTech LTD)
Date: Wed, 20 Jul 2022 01:02:19 +0300
Subject: [squid-users] how to put the destination ip to an external acl
 helper ?
In-Reply-To: <97f0b9b7-2d48-ccd1-a47d-0a86fcc87fea@treenet.co.nz>
References: <20220719120517.3lr7e36jfgkemajn@bloms.de>
 <97f0b9b7-2d48-ccd1-a47d-0a86fcc87fea@treenet.co.nz>
Message-ID: <CABA8h=R3gxLaPgpR3YObsJ9ftfuFPHikdg=3j6K3P9_ekyQYQA@mail.gmail.com>

But which one of them?

?????? ??? ??, 20 ????? 2022, 0:59, ??? Amos Jeffries ?<squid3 at treenet.co.nz
>:

> On 20/07/22 00:05, Dieter Bloms wrote:
> > Hello,
> >
> > I wrote a little external acl helper and want squid to put the
> > destination fqdn _and_ the destination ip to it.
> >
> > I found the parameter %DST and this is filled with the destination fqdn.
> >
> > Is there also a parameter for the destination ip squid want's to connect
> to ?
> >
>
> In modern Squid you use the logformat macros in external_acl_type format.
>
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220720/fbd8352d/attachment.htm>

From squid3 at treenet.co.nz  Tue Jul 19 22:13:32 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 20 Jul 2022 10:13:32 +1200
Subject: [squid-users] how to put the destination ip to an external acl
 helper ?
In-Reply-To: <CABA8h=R3gxLaPgpR3YObsJ9ftfuFPHikdg=3j6K3P9_ekyQYQA@mail.gmail.com>
References: <20220719120517.3lr7e36jfgkemajn@bloms.de>
 <97f0b9b7-2d48-ccd1-a47d-0a86fcc87fea@treenet.co.nz>
 <CABA8h=R3gxLaPgpR3YObsJ9ftfuFPHikdg=3j6K3P9_ekyQYQA@mail.gmail.com>
Message-ID: <2debbfb6-1814-258b-9943-49c97cf9091a@treenet.co.nz>

On 20/07/22 10:02, NgTech LTD wrote:
> But which one of them?
> 


    " %<A %<a "

Cheers
Amos


From squid.org at bloms.de  Wed Jul 20 06:47:14 2022
From: squid.org at bloms.de (Dieter Bloms)
Date: Wed, 20 Jul 2022 08:47:14 +0200
Subject: [squid-users] how to put the destination ip to an external acl
 helper ?
In-Reply-To: <2debbfb6-1814-258b-9943-49c97cf9091a@treenet.co.nz>
References: <20220719120517.3lr7e36jfgkemajn@bloms.de>
 <97f0b9b7-2d48-ccd1-a47d-0a86fcc87fea@treenet.co.nz>
 <CABA8h=R3gxLaPgpR3YObsJ9ftfuFPHikdg=3j6K3P9_ekyQYQA@mail.gmail.com>
 <2debbfb6-1814-258b-9943-49c97cf9091a@treenet.co.nz>
Message-ID: <20220720064714.zwlk3fang332dpkw@bloms.de>

Hello Amos,

On Wed, Jul 20, Amos Jeffries wrote:

> On 20/07/22 10:02, NgTech LTD wrote:
> > But which one of them?
> 
>    " %<A %<a "

I've tried to use them, but they %<a is filled with "-".
I configured an ip based rule beforehand the external helper acl to
force a dns lookup, but %<a is filled with "-" every time.

Here the relevant parts of my config:

# we have to force a dns lookup to get the ip addresses for the external helper
acl alldestination dst 1.1.1.1/32
http_access allow alldestination

external_acl_type aclhelper ttl=0 negative_ttl=0 grace=50 children-max=1 children-startup=1 %SRC %DST %<a %PORT %METHOD /usr/local/bin/aclhelper.py
acl aclhelper external aclhelper
http_access allow aclhelper


-- 
Regards

  Dieter

--
I do not get viruses because I do not use MS software.
If you use Outlook then please do not put my email address in your
address-book so that WHEN you get a virus it won't use my address in the
>From field.


From rousskov at measurement-factory.com  Wed Jul 20 13:10:56 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Wed, 20 Jul 2022 09:10:56 -0400
Subject: [squid-users] how to put the destination ip to an external acl
 helper ?
In-Reply-To: <20220719120517.3lr7e36jfgkemajn@bloms.de>
References: <20220719120517.3lr7e36jfgkemajn@bloms.de>
Message-ID: <592cb5e3-6c14-c3db-e6da-ced6d56f4260@measurement-factory.com>

On 7/19/22 08:05, Dieter Bloms wrote:
> Hello,
> 
> I wrote a little external acl helper and want squid to put the
> destination fqdn _and_ the destination ip to it.
> 
> I found the parameter %DST and this is filled with the destination fqdn.
> 
> Is there also a parameter for the destination ip squid want's to connect to ?

To answer your exact question, no, there is not. Until Squid actually 
starts connecting to a cache_peer or origin server, it does not know the 
destination IP(s). Those addresses become known only in the process of 
finding the right destination(s), resolving their names, determining 
whether to use IPv4 or IPv6, and establishing (or reusing) a TCP 
connection to the chosen IP address. Until then, %<a is not available.

I am not sure what the first squid.conf directive (with slow ACLs 
support) "guaranteed" to have filled %<a is. There is probably one 
before http_reply_access, but the exact directive depends on your 
configuration/environment.

Most likely, we should add configuration directive(s) (with slow ACLs 
support) that are applied soon after the IP address becomes known. One 
of them could be used, for example, to reject chosen destination IP 
addresses before Squid starts using them.


HTH,

Alex.


From robertkwild at gmail.com  Wed Jul 20 15:23:23 2022
From: robertkwild at gmail.com (robert k Wild)
Date: Wed, 20 Jul 2022 16:23:23 +0100
Subject: [squid-users] fool windows into thinking it has internet access
Message-ID: <CAGU_CiKTab_aziv7CHDjtGwu2W1D=a0hcYTTxyg=fHzMrqmWuQ@mail.gmail.com>

hi all,

trying to fool windows it has internet access and not just network access

looking at this guide

https://docs.microsoft.com/en-US/troubleshoot/windows-client/networking/internet-explorer-edge-open-connect-corporate-public-network

i have put in my white list

.msftconnecttest.com
.msftncsi.com

i have whitelisted ports 80 and 443 by default

on my windows client i have enabled the proxy via settings > proxy > manual
proxy setup

and also i have enabled the winhttp proxy putting this in cmd

netsh winhttp set proxy ip_address:port

and i get back a connection test text saying "microsoft connect test" if i
go to

http://www.msftconnecttest.com/connecttest.txt

but my network icon is still saying just network access only not internet
access

can anyone help me out please

thanks,
rob

-- 
Regards,

Robert K Wild.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220720/3416e4c6/attachment.htm>

From robertkwild at gmail.com  Wed Jul 20 17:19:22 2022
From: robertkwild at gmail.com (robert k Wild)
Date: Wed, 20 Jul 2022 18:19:22 +0100
Subject: [squid-users] fool windows into thinking it has internet access
In-Reply-To: <CAGU_CiKTab_aziv7CHDjtGwu2W1D=a0hcYTTxyg=fHzMrqmWuQ@mail.gmail.com>
References: <CAGU_CiKTab_aziv7CHDjtGwu2W1D=a0hcYTTxyg=fHzMrqmWuQ@mail.gmail.com>
Message-ID: <CAGU_CiJYAYXYoRTYk9+vnaULKvrX7QnWE6WjpzovbQQOncCbfw@mail.gmail.com>

ok i have realised something, my client cant resolve this address

C:\Users\rkw>ping dns.msftncsi.com
Ping request could not find host dns.msftncsi.com. Please check the name
and try again.

is there anyway i can enable ICMP/ping via the proxy so this works?

thanks,
rob

On Wed, 20 Jul 2022 at 16:23, robert k Wild <robertkwild at gmail.com> wrote:

> hi all,
>
> trying to fool windows it has internet access and not just network access
>
> looking at this guide
>
>
> https://docs.microsoft.com/en-US/troubleshoot/windows-client/networking/internet-explorer-edge-open-connect-corporate-public-network
>
> i have put in my white list
>
> .msftconnecttest.com
> .msftncsi.com
>
> i have whitelisted ports 80 and 443 by default
>
> on my windows client i have enabled the proxy via settings > proxy >
> manual proxy setup
>
> and also i have enabled the winhttp proxy putting this in cmd
>
> netsh winhttp set proxy ip_address:port
>
> and i get back a connection test text saying "microsoft connect test" if i
> go to
>
> http://www.msftconnecttest.com/connecttest.txt
>
> but my network icon is still saying just network access only not internet
> access
>
> can anyone help me out please
>
> thanks,
> rob
>
> --
> Regards,
>
> Robert K Wild.
>


-- 
Regards,

Robert K Wild.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220720/b26665ef/attachment.htm>

From Antony.Stone at squid.open.source.it  Wed Jul 20 17:44:06 2022
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Wed, 20 Jul 2022 19:44:06 +0200
Subject: [squid-users] fool windows into thinking it has internet access
In-Reply-To: <CAGU_CiJYAYXYoRTYk9+vnaULKvrX7QnWE6WjpzovbQQOncCbfw@mail.gmail.com>
References: <CAGU_CiKTab_aziv7CHDjtGwu2W1D=a0hcYTTxyg=fHzMrqmWuQ@mail.gmail.com>
 <CAGU_CiJYAYXYoRTYk9+vnaULKvrX7QnWE6WjpzovbQQOncCbfw@mail.gmail.com>
Message-ID: <202207201944.06709.Antony.Stone@squid.open.source.it>

On Wednesday 20 July 2022 at 19:19:22, robert k Wild wrote:

> ok i have realised something, my client cant resolve this address
> 
> C:\Users\rkw>ping dns.msftncsi.com
> Ping request could not find host dns.msftncsi.com. Please check the name
> and try again.
> 
> is there anyway i can enable ICMP/ping via the proxy so this works?

No, but you could add that name, either to the machine which wants to contact 
it, or to your local DNS server, so that it resolves to something on your 
network (or localhost if you prefer).

Out of interest, what is the purpose for making a Windows computer think it 
has Internet access when it doesn't?  What useful difference does that make?


Antony.

-- 
"Tannenbaumschmuck" is a perfectly reasonable German word
meaning Christmas tree decorations, and is not a quote from Linus Torvalds.

                                                   Please reply to the list;
                                                         please *don't* CC me.


From gtaylor at tnetconsulting.net  Wed Jul 20 17:46:50 2022
From: gtaylor at tnetconsulting.net (Grant Taylor)
Date: Wed, 20 Jul 2022 11:46:50 -0600
Subject: [squid-users] fool windows into thinking it has internet access
In-Reply-To: <CAGU_CiJYAYXYoRTYk9+vnaULKvrX7QnWE6WjpzovbQQOncCbfw@mail.gmail.com>
References: <CAGU_CiKTab_aziv7CHDjtGwu2W1D=a0hcYTTxyg=fHzMrqmWuQ@mail.gmail.com>
 <CAGU_CiJYAYXYoRTYk9+vnaULKvrX7QnWE6WjpzovbQQOncCbfw@mail.gmail.com>
Message-ID: <57e2ea94-5b82-e19b-22d3-1f8eb75dbf9d@spamtrap.tnetconsulting.net>

On 7/20/22 11:19 AM, robert k Wild wrote:
> ok i have realised something, my client cant resolve this address
> 
> C:\Users\rkw>ping dns.msftncsi.com <http://dns.msftncsi.com>
> Ping request could not find host dns.msftncsi.com. Please check the 
> name and try again.
> 
> is there anyway i can enable ICMP/ping via the proxy so this works?

You seem to be primarily facing a DNS name resolution issue first and 
foremost.

You may have secondary issues /after/ fixing the name resolution issue.



-- 
Grant. . . .
unix || die

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4017 bytes
Desc: S/MIME Cryptographic Signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220720/80c569c3/attachment.bin>

From gtaylor at tnetconsulting.net  Wed Jul 20 17:48:21 2022
From: gtaylor at tnetconsulting.net (Grant Taylor)
Date: Wed, 20 Jul 2022 11:48:21 -0600
Subject: [squid-users] fool windows into thinking it has internet access
In-Reply-To: <202207201944.06709.Antony.Stone@squid.open.source.it>
References: <CAGU_CiKTab_aziv7CHDjtGwu2W1D=a0hcYTTxyg=fHzMrqmWuQ@mail.gmail.com>
 <CAGU_CiJYAYXYoRTYk9+vnaULKvrX7QnWE6WjpzovbQQOncCbfw@mail.gmail.com>
 <202207201944.06709.Antony.Stone@squid.open.source.it>
Message-ID: <88f04f07-2e2a-8ee3-62bb-19a4d62a4f79@spamtrap.tnetconsulting.net>

On 7/20/22 11:44 AM, Antony Stone wrote:
> Out of interest, what is the purpose for making a Windows computer 
> think it has Internet access when it doesn't?  What useful difference 
> does that make?

End users may see the notification and report problems.

These same end users may never actually try to access the Internet, and 
thus never know that they don't have connectivity.  But the popup 
notification will ... chafe some.



-- 
Grant. . . .
unix || die

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4017 bytes
Desc: S/MIME Cryptographic Signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220720/bf9d4668/attachment.bin>

From robertkwild at gmail.com  Wed Jul 20 19:14:26 2022
From: robertkwild at gmail.com (robert k Wild)
Date: Wed, 20 Jul 2022 20:14:26 +0100
Subject: [squid-users] fool windows into thinking it has internet access
In-Reply-To: <202207201944.06709.Antony.Stone@squid.open.source.it>
References: <CAGU_CiKTab_aziv7CHDjtGwu2W1D=a0hcYTTxyg=fHzMrqmWuQ@mail.gmail.com>
 <CAGU_CiJYAYXYoRTYk9+vnaULKvrX7QnWE6WjpzovbQQOncCbfw@mail.gmail.com>
 <202207201944.06709.Antony.Stone@squid.open.source.it>
Message-ID: <CAGU_CiJggSJ3g2ctF5ZMh7DEL53sMLbjSzjxCJQ22G4XUaWFvA@mail.gmail.com>

Good question, as on my squid proxy I have whitelisted all of the Adobe
URLs needed for Adobe cc

On windows clients, to even open the Adobe cc app, it needs internet
access, now as this pc is on a production network, it can't have internet
access so I have fooled it and now I can open the cc app

On Wed, 20 Jul 2022, 18:44 Antony Stone, <Antony.Stone at squid.open.source.it>
wrote:

> On Wednesday 20 July 2022 at 19:19:22, robert k Wild wrote:
>
> > ok i have realised something, my client cant resolve this address
> >
> > C:\Users\rkw>ping dns.msftncsi.com
> > Ping request could not find host dns.msftncsi.com. Please check the name
> > and try again.
> >
> > is there anyway i can enable ICMP/ping via the proxy so this works?
>
> No, but you could add that name, either to the machine which wants to
> contact
> it, or to your local DNS server, so that it resolves to something on your
> network (or localhost if you prefer).
>
> Out of interest, what is the purpose for making a Windows computer think
> it
> has Internet access when it doesn't?  What useful difference does that
> make?
>
>
> Antony.
>
> --
> "Tannenbaumschmuck" is a perfectly reasonable German word
> meaning Christmas tree decorations, and is not a quote from Linus Torvalds.
>
>                                                    Please reply to the
> list;
>                                                          please *don't* CC
> me.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220720/568b7256/attachment.htm>

From rst at fomar.com.pl  Thu Jul 21 09:03:50 2022
From: rst at fomar.com.pl (=?UTF-8?Q?Rafa=C5=82_Stanilewicz?=)
Date: Thu, 21 Jul 2022 10:03:50 +0100
Subject: [squid-users] fool windows into thinking it has internet access
In-Reply-To: <CAGU_CiJggSJ3g2ctF5ZMh7DEL53sMLbjSzjxCJQ22G4XUaWFvA@mail.gmail.com>
References: <CAGU_CiKTab_aziv7CHDjtGwu2W1D=a0hcYTTxyg=fHzMrqmWuQ@mail.gmail.com>
 <CAGU_CiJYAYXYoRTYk9+vnaULKvrX7QnWE6WjpzovbQQOncCbfw@mail.gmail.com>
 <202207201944.06709.Antony.Stone@squid.open.source.it>
 <CAGU_CiJggSJ3g2ctF5ZMh7DEL53sMLbjSzjxCJQ22G4XUaWFvA@mail.gmail.com>
Message-ID: <CAPnyBTM_vKrdfd6ciMBadbNZVL_Zod3U_gjKiadfBjmDBuSUNA@mail.gmail.com>

Actually, tricking the machine into thinking it has Internet access when it
doesn't in reality, it's also good for malware analysis.

?r., 20 lip 2022 o 20:14 robert k Wild <robertkwild at gmail.com> napisa?(a):

> Good question, as on my squid proxy I have whitelisted all of the Adobe
> URLs needed for Adobe cc
>
> On windows clients, to even open the Adobe cc app, it needs internet
> access, now as this pc is on a production network, it can't have internet
> access so I have fooled it and now I can open the cc app
>
> On Wed, 20 Jul 2022, 18:44 Antony Stone, <
> Antony.Stone at squid.open.source.it> wrote:
>
>> On Wednesday 20 July 2022 at 19:19:22, robert k Wild wrote:
>>
>> > ok i have realised something, my client cant resolve this address
>> >
>> > C:\Users\rkw>ping dns.msftncsi.com
>> > Ping request could not find host dns.msftncsi.com. Please check the
>> name
>> > and try again.
>> >
>> > is there anyway i can enable ICMP/ping via the proxy so this works?
>>
>> No, but you could add that name, either to the machine which wants to
>> contact
>> it, or to your local DNS server, so that it resolves to something on your
>> network (or localhost if you prefer).
>>
>> Out of interest, what is the purpose for making a Windows computer think
>> it
>> has Internet access when it doesn't?  What useful difference does that
>> make?
>>
>>
>> Antony.
>>
>> --
>> "Tannenbaumschmuck" is a perfectly reasonable German word
>> meaning Christmas tree decorations, and is not a quote from Linus
>> Torvalds.
>>
>>                                                    Please reply to the
>> list;
>>                                                          please *don't*
>> CC me.
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
>>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>


-- 
Zanim wydrukujesz, pomy?l o ?rodowisku.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220721/cd543e76/attachment.htm>

From ngtech1ltd at gmail.com  Thu Jul 21 19:53:23 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Thu, 21 Jul 2022 22:53:23 +0300
Subject: [squid-users] fool windows into thinking it has internet access
In-Reply-To: <CAGU_CiKTab_aziv7CHDjtGwu2W1D=a0hcYTTxyg=fHzMrqmWuQ@mail.gmail.com>
References: <CAGU_CiKTab_aziv7CHDjtGwu2W1D=a0hcYTTxyg=fHzMrqmWuQ@mail.gmail.com>
Message-ID: <000001d89d3b$8a4b94b0$9ee2be10$@gmail.com>

Take a peek at:
https://docs.microsoft.com/en-us/powershell/module/nettcpip/test-netconnection?view=windowsserver2022-ps
 
This will highlight your issue and will probably make more sense into what you see.
 
Eliezer
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> 
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/
 
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of robert k Wild
Sent: Wednesday, 20 July 2022 18:23
To: Squid Users <squid-users at lists.squid-cache.org>
Subject: [squid-users] fool windows into thinking it has internet access
 
hi all,
 
trying to fool windows it has internet access and not just network access
 
looking at this guide
 
https://docs.microsoft.com/en-US/troubleshoot/windows-client/networking/internet-explorer-edge-open-connect-corporate-public-network
 
i have put in my white list
 
.msftconnecttest.com <http://msftconnecttest.com> 
.msftncsi.com <http://msftncsi.com> 
 
i have whitelisted ports 80 and 443 by default
 
on my windows client i have enabled the proxy via settings > proxy > manual proxy setup
 
and also i have enabled the winhttp proxy putting this in cmd
 
netsh winhttp set proxy ip_address:port
 
and i get back a connection test text saying "microsoft connect test" if i go to
 
http://www.msftconnecttest.com/connecttest.txt
 
but my network icon is still saying just network access only not internet access
 
can anyone help me out please
 
thanks,
rob

-- 
Regards, 

Robert K Wild.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220721/bddeb378/attachment.htm>

From robertkwild at gmail.com  Fri Jul 22 10:22:36 2022
From: robertkwild at gmail.com (robert k Wild)
Date: Fri, 22 Jul 2022 11:22:36 +0100
Subject: [squid-users] fool windows into thinking it has internet access
In-Reply-To: <000001d89d3b$8a4b94b0$9ee2be10$@gmail.com>
References: <CAGU_CiKTab_aziv7CHDjtGwu2W1D=a0hcYTTxyg=fHzMrqmWuQ@mail.gmail.com>
 <000001d89d3b$8a4b94b0$9ee2be10$@gmail.com>
Message-ID: <CAGU_CiJL9dFy=hbMLj=EqcSiXtVLV+X+WOtb1WpqJkVGZAjHGA@mail.gmail.com>

so i need to whitelist

internetbeacon.msedge.net

?

On Thu, 21 Jul 2022 at 20:53, <ngtech1ltd at gmail.com> wrote:

> Take a peek at:
>
>
> https://docs.microsoft.com/en-us/powershell/module/nettcpip/test-netconnection?view=windowsserver2022-ps
>
>
>
> This will highlight your issue and will probably make more sense into what
> you see.
>
>
>
> Eliezer
>
>
>
> ----
>
> Eliezer Croitoru
>
> NgTech, Tech Support
>
> Mobile: +972-5-28704261
>
> Email: ngtech1ltd at gmail.com
>
> Web: https://ngtech.co.il/
>
> My-Tube: https://tube.ngtech.co.il/
>
>
>
> *From:* squid-users <squid-users-bounces at lists.squid-cache.org> *On
> Behalf Of *robert k Wild
> *Sent:* Wednesday, 20 July 2022 18:23
> *To:* Squid Users <squid-users at lists.squid-cache.org>
> *Subject:* [squid-users] fool windows into thinking it has internet access
>
>
>
> hi all,
>
>
>
> trying to fool windows it has internet access and not just network access
>
>
>
> looking at this guide
>
>
>
>
> https://docs.microsoft.com/en-US/troubleshoot/windows-client/networking/internet-explorer-edge-open-connect-corporate-public-network
>
>
>
> i have put in my white list
>
>
>
> .msftconnecttest.com
> .msftncsi.com
>
>
>
> i have whitelisted ports 80 and 443 by default
>
>
>
> on my windows client i have enabled the proxy via settings > proxy >
> manual proxy setup
>
>
>
> and also i have enabled the winhttp proxy putting this in cmd
>
>
>
> netsh winhttp set proxy ip_address:port
>
>
>
> and i get back a connection test text saying "microsoft connect test" if i
> go to
>
>
>
> http://www.msftconnecttest.com/connecttest.txt
>
>
>
> but my network icon is still saying just network access only not internet
> access
>
>
>
> can anyone help me out please
>
>
>
> thanks,
>
> rob
>
>
> --
>
> Regards,
>
> Robert K Wild.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>


-- 
Regards,

Robert K Wild.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220722/0c9e1a05/attachment.htm>

From ngtech1ltd at gmail.com  Fri Jul 22 10:32:36 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Fri, 22 Jul 2022 13:32:36 +0300
Subject: [squid-users] fool windows into thinking it has internet access
In-Reply-To: <CAGU_CiJL9dFy=hbMLj=EqcSiXtVLV+X+WOtb1WpqJkVGZAjHGA@mail.gmail.com>
References: <CAGU_CiKTab_aziv7CHDjtGwu2W1D=a0hcYTTxyg=fHzMrqmWuQ@mail.gmail.com>
 <000001d89d3b$8a4b94b0$9ee2be10$@gmail.com>
 <CAGU_CiJL9dFy=hbMLj=EqcSiXtVLV+X+WOtb1WpqJkVGZAjHGA@mail.gmail.com>
Message-ID: <001501d89db6$5d169780$1743c680$@gmail.com>

Hey Robert,
 
The internet reachability test is composed of couple parts.
Only one of them is HTTP.
There is also an ICMP and DNS part to it.
You can customize it on the registry at:
Computer\HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\NlaSvc\Parameters\Internet
 
The windows internet access check doesn?t affect other software, they do not rely on any of windows checks but do this by themselves.
 
I hope this have helped you.
I can try to test it locally but it?s better that you will first make a tiny effort to dump with wireshark the traffic on the interface
(after you have flushed the dns cahce) to verify what traffic windows use to test the internet connectivity.
 
Eliezer
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> 
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/
 
From: robert k Wild <robertkwild at gmail.com> 
Sent: Friday, 22 July 2022 13:23
To: Eliezer Croitoru <ngtech1ltd at gmail.com>
Cc: Squid Users <squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] fool windows into thinking it has internet access
 
so i need to whitelist
 
internetbeacon.msedge.net <http://internetbeacon.msedge.net> 
?
 
On Thu, 21 Jul 2022 at 20:53, <ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> > wrote:
Take a peek at:
https://docs.microsoft.com/en-us/powershell/module/nettcpip/test-netconnection?view=windowsserver2022-ps
 
This will highlight your issue and will probably make more sense into what you see.
 
Eliezer
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> 
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/
 
From: squid-users <squid-users-bounces at lists.squid-cache.org <mailto:squid-users-bounces at lists.squid-cache.org> > On Behalf Of robert k Wild
Sent: Wednesday, 20 July 2022 18:23
To: Squid Users <squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> >
Subject: [squid-users] fool windows into thinking it has internet access
 
hi all,
 
trying to fool windows it has internet access and not just network access
 
looking at this guide
 
https://docs.microsoft.com/en-US/troubleshoot/windows-client/networking/internet-explorer-edge-open-connect-corporate-public-network
 
i have put in my white list
 
.msftconnecttest.com <http://msftconnecttest.com> 
.msftncsi.com <http://msftncsi.com> 
 
i have whitelisted ports 80 and 443 by default
 
on my windows client i have enabled the proxy via settings > proxy > manual proxy setup
 
and also i have enabled the winhttp proxy putting this in cmd
 
netsh winhttp set proxy ip_address:port
 
and i get back a connection test text saying "microsoft connect test" if i go to
 
http://www.msftconnecttest.com/connecttest.txt
 
but my network icon is still saying just network access only not internet access
 
can anyone help me out please
 
thanks,
rob

-- 
Regards, 

Robert K Wild.
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> 
http://lists.squid-cache.org/listinfo/squid-users


-- 
Regards, 

Robert K Wild.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220722/4d942c52/attachment.htm>

From robertkwild at gmail.com  Fri Jul 22 11:02:27 2022
From: robertkwild at gmail.com (robert k Wild)
Date: Fri, 22 Jul 2022 12:02:27 +0100
Subject: [squid-users] fool windows into thinking it has internet access
In-Reply-To: <001501d89db6$5d169780$1743c680$@gmail.com>
References: <CAGU_CiKTab_aziv7CHDjtGwu2W1D=a0hcYTTxyg=fHzMrqmWuQ@mail.gmail.com>
 <000001d89d3b$8a4b94b0$9ee2be10$@gmail.com>
 <CAGU_CiJL9dFy=hbMLj=EqcSiXtVLV+X+WOtb1WpqJkVGZAjHGA@mail.gmail.com>
 <001501d89db6$5d169780$1743c680$@gmail.com>
Message-ID: <CAGU_CiKsORwmgwEYEwrsoft3+=Zi7mZy0r2pg6OoK9TkMYVLRQ@mail.gmail.com>

nice thanks Eliezer, i was missing few registry entries

-
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\NlaSvc\Parameters\Internet\EnableActiveProbing

   - Key Type: DWORD
   - Value: Decimal 0 (False)

-
HKLM\Software\Policies\Microsoft\Windows\NetworkConnectivityStatusIndicator\NoActiveProbe

   - Key Type: DWORD
   - Value: Decimal 1 (True)

HKLM\Software\Policies\Microsoft\Windows\NetworkConnectivityStatusIndicator\DisablePassivePolling

   - Key Type: DWORD
   - Value: Decimal 1 (True)


On Fri, 22 Jul 2022 at 11:32, <ngtech1ltd at gmail.com> wrote:

> Hey Robert,
>
>
>
> The internet reachability test is composed of couple parts.
>
> Only one of them is HTTP.
>
> There is also an ICMP and DNS part to it.
>
> You can customize it on the registry at:
>
>
> Computer\HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\NlaSvc\Parameters\Internet
>
>
>
> The windows internet access check doesn?t affect other software, they do
> not rely on any of windows checks but do this by themselves.
>
>
>
> I hope this have helped you.
> I can try to test it locally but it?s better that you will first make a
> tiny effort to dump with wireshark the traffic on the interface
> (after you have flushed the dns cahce) to verify what traffic windows use
> to test the internet connectivity.
>
>
>
> Eliezer
>
>
>
> ----
>
> Eliezer Croitoru
>
> NgTech, Tech Support
>
> Mobile: +972-5-28704261
>
> Email: ngtech1ltd at gmail.com
>
> Web: https://ngtech.co.il/
>
> My-Tube: https://tube.ngtech.co.il/
>
>
>
> *From:* robert k Wild <robertkwild at gmail.com>
> *Sent:* Friday, 22 July 2022 13:23
> *To:* Eliezer Croitoru <ngtech1ltd at gmail.com>
> *Cc:* Squid Users <squid-users at lists.squid-cache.org>
> *Subject:* Re: [squid-users] fool windows into thinking it has internet
> access
>
>
>
> so i need to whitelist
>
>
>
> internetbeacon.msedge.net
>
> ?
>
>
>
> On Thu, 21 Jul 2022 at 20:53, <ngtech1ltd at gmail.com> wrote:
>
> Take a peek at:
>
>
> https://docs.microsoft.com/en-us/powershell/module/nettcpip/test-netconnection?view=windowsserver2022-ps
>
>
>
> This will highlight your issue and will probably make more sense into what
> you see.
>
>
>
> Eliezer
>
>
>
> ----
>
> Eliezer Croitoru
>
> NgTech, Tech Support
>
> Mobile: +972-5-28704261
>
> Email: ngtech1ltd at gmail.com
>
> Web: https://ngtech.co.il/
>
> My-Tube: https://tube.ngtech.co.il/
>
>
>
> *From:* squid-users <squid-users-bounces at lists.squid-cache.org> *On
> Behalf Of *robert k Wild
> *Sent:* Wednesday, 20 July 2022 18:23
> *To:* Squid Users <squid-users at lists.squid-cache.org>
> *Subject:* [squid-users] fool windows into thinking it has internet access
>
>
>
> hi all,
>
>
>
> trying to fool windows it has internet access and not just network access
>
>
>
> looking at this guide
>
>
>
>
> https://docs.microsoft.com/en-US/troubleshoot/windows-client/networking/internet-explorer-edge-open-connect-corporate-public-network
>
>
>
> i have put in my white list
>
>
>
> .msftconnecttest.com
> .msftncsi.com
>
>
>
> i have whitelisted ports 80 and 443 by default
>
>
>
> on my windows client i have enabled the proxy via settings > proxy >
> manual proxy setup
>
>
>
> and also i have enabled the winhttp proxy putting this in cmd
>
>
>
> netsh winhttp set proxy ip_address:port
>
>
>
> and i get back a connection test text saying "microsoft connect test" if i
> go to
>
>
>
> http://www.msftconnecttest.com/connecttest.txt
>
>
>
> but my network icon is still saying just network access only not internet
> access
>
>
>
> can anyone help me out please
>
>
>
> thanks,
>
> rob
>
>
> --
>
> Regards,
>
> Robert K Wild.
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
>
>
> --
>
> Regards,
>
> Robert K Wild.
>


-- 
Regards,

Robert K Wild.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220722/b687104e/attachment.htm>

From ronny.preiss at gmail.com  Mon Jul 25 05:59:05 2022
From: ronny.preiss at gmail.com (Ronny Preiss)
Date: Mon, 25 Jul 2022 07:59:05 +0200
Subject: [squid-users] Fwd: Sqid uses all RAM / killed by OOM
In-Reply-To: <CABMAtPLpoUrAXJv+JJvMbAe=N-b-brQeTTzq4OqDNc3Rf31GoQ@mail.gmail.com>
References: <CABMAtPLpoUrAXJv+JJvMbAe=N-b-brQeTTzq4OqDNc3Rf31GoQ@mail.gmail.com>
Message-ID: <CABMAtPJxqW-wum8SVGLYbYeU2VUMF0pa7BMTdxksi4B4ChWD9Q@mail.gmail.com>

Hello all,

I have now compiled and installed squid 4.17 as a transition solution on
ubuntu 22.04.

Can someone support me regarding my question about compiling squid 5.6 on
ubuntu 22.04?
Since my previous attempts also have the "memory leak" on ubuntu 22.04 and
squid 5.6 problem again.

Kind regards Ronny

---------- Forwarded message ---------
Von: Ronny Preiss <ronny.preiss at gmail.com>
Date: Mo., 11. Juli 2022 um 08:54 Uhr
Subject: Sqid uses all RAM / killed by OOM
To: <squid-users at lists.squid-cache.org>


Hello all,

I have the following problem with squid 5.2 on ubuntu 22.04.
Squid consumes all ram and the entire SWAP. When swap and ram are
completely full, the OOM killer strikes and terminates the process.

We use three internal child proxy servers with keepalived and haproxy as
load balancers. From our ISP we use a parent upstream proxy for external
internet traffic.
As an operating system we have so far Ubuntu 20.04.4 with squid 4.1 in use.
This constellation works flawlessly.

Now I want to update the Server to Ubuntu 22.04 and squid 5.2. But with
Ubuntu 22.04 and squid 5.2 the above mentioned problem with the OOM Killer
occurs.
The new machine has only the OS and squid installed.

Who can help me with a solution?

With kind regards
Ronny

Attached the squid configuration and the VMWare specs.

### VM Specs ###
OS: Ubuntu 22.04 Server
CPU: 4x (Intel(R) Xeon(R) CPU E5-2690 v3 @ 2.60GHz)
RAM: 4 GB
VMWare: ESXi 7.0 U2

### CONFIG ###
acl 10.172.xxx.xxx/18 <http://10.172.128.0/18> src 10.172.xxx.xxx/18
<http://10.172.128.0/18>
acl 172.16.xxx.xxx/12 <http://172.16.0.0/12> src 172.16.xxx.xxx/12
<http://172.16.0.0/12>
acl 192.168.xxx.xxx/16 <http://192.168.0.0/16> src 192.168.xxx.xxx/16
<http://192.168.0.0/16>

acl Safe_ports port 80
acl Safe_ports port 21
acl Safe_ports port 443
acl Safe_ports port 70
acl Safe_ports port 210
acl Safe_ports port 1025-65535
acl Safe_ports port 280
acl Safe_ports port 488
acl Safe_ports port 591
acl Safe_ports port 777

http_access allow 10.172.xxx.xxx/18 <http://10.172.128.0/18> Safe_ports
http_access allow 172.16.xxx.xxx/12 <http://172.16.0.0/12> Safe_ports
http_access allow 192.168.xxx.xxx/16 <http://192.168.0.0/16> Safe_ports

http_access allow localhost manager
http_access allow localhost
http_access deny manager
http_access deny all

include /etc/squid/conf.d/*
http_port 10.172.xxx.xxx:3128 <http://10.172.128.34:3128>

cache_peer 10.210.xxx.xxx parent 8080 0
cache_dir ufs /var/spool/squid 3000 16 256
cache_effective_user proxy
cache_effective_group proxy

coredump_dir /var/spool/squid

refresh_pattern ^ftp:           1440    20%     10080
refresh_pattern ^gopher:        1440    0%      1440
refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
refresh_pattern \/(Packages|Sources)(|\.bz2|\.gz|\.xz)$ 0 0% 0 refresh-ims
refresh_pattern \/Release(|\.gpg)$ 0 0% 0 refresh-ims
refresh_pattern \/InRelease$ 0 0% 0 refresh-ims
refresh_pattern \/(Translation-.*)(|\.bz2|\.gz|\.xz)$ 0 0% 0 refresh-ims
refresh_pattern .               0       20%     4320

never_direct allow all
max_filedescriptors 40960
dns_nameservers 10.244.xxx.xxx

### DMESG ###

[256929.150801]
oom-kill:constraint=CONSTRAINT_NONE,nodemask=(null),cpuset=/,mems_allowed=0,global_oom,task_memcg=/system.slice/squid.service,task=squid,pid=26390,uid=13
[256929.150822] Out of memory: Killed process 26390 (squid)
total-vm:9691764kB, anon-rss:3657748kB, file-rss:2320kB, shmem-rss:0kB,
UID:13 pgtables:18932kB oom_score_adj:0
[256929.510641] oom_reaper: reaped process 26390 (squid), now anon-rss:0kB,
file-rss:0kB, shmem-rss:0kB
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220725/fc440ae8/attachment.htm>

From Katerina.Bubenickova at bohnice.cz  Mon Jul 25 08:40:22 2022
From: Katerina.Bubenickova at bohnice.cz (Katerina Bubenickova)
Date: Mon, 25 Jul 2022 10:40:22 +0200
Subject: [squid-users] slow TCP_TUNNEL
References: <62DA93FD0200005F0004E80C@gwia.plbohnice.cz>
Message-ID: <62DE56F60200005F0004E844@gwia.plbohnice.cz>

Hi,
We have 2 squid proxies running on Centos 6 which is very old (let's
call them C1, C2) in DMZ.

I have installed Debian 11 bullseye and squid +squidguard, trying to use
the same configuration (let's call it D1).
If I use this proxy for 1 pc station, all is ok.
If Iadded the proxy to dns as third proxy (C1+C2 + D1) or use one old
proxy and the new one (C1+D1) the response of internet was very slow,
unusable.

I tryed to fix it without success:
I added directive url_rewrite_children 200

I changed DNS from 8.8.8.8 to localhost
I turned off squid cache
I commented out squidguard
I migrated from one vmware server to another, better,
I added memory (16 GB) and CPU (6) ,
I added directive dns_v4_first on
There are no rules in D1 firewall


We have about 700 pc and the problem starts after 15-20 minutes after I
add D1 into dns as proxy.
I can see it on our monitor Flowmon, where I can see value NPM response
time. In normal state it is about 0.1s, when the problem arises it is up
to 3s.
If I remove D1 from dns, all is ok after a while.

I  tried to set IP of D1 the same as IP of C2 (of course C2 was power
off) to test, whether the problem could be caused by some firewall
between user pc and proxy, it doesn.t help



 access.log of D1

1658483765.546 1622444 172.19.11.101 TCP_TUNNEL/200 3635 CONNECT
epns.eset.com:443 - HIER_DIRECT/91.228.167.192 -
1658483765.546 900188 172.19.14.73 TCP_TUNNEL/200 4738 CONNECT
prg.smartadserver.com:443 - HIER_DIRECT/185.86.138.16 -
1658483765.546 900246 172.19.14.73 TCP_TUNNEL/200 4102 CONNECT
bidder.criteo.com:443 - HIER_DIRECT/178.250.0.165 -
1658483765.546 1008081 172.19.13.171 TCP_TUNNEL/200 12749428 CONNECT
rr1---sn-jxnoxu-2gbl.googlevideo.com:443 - HIER_DIRECT/195.113.214.204 -
1658483765.546 901791 172.19.14.95 TCP_TUNNEL/200 2176 CONNECT
pcb.kb.cz:443 - HIER_DIRECT/194.50.226.158 -
1658483765.546 900569 172.19.14.73 TCP_TUNNEL/200 7260 CONNECT
adx.adform.net:443 - HIER_DIRECT/37.157.2.237 -
1658483766.547 935767 172.19.13.190 TCP_TUNNEL/200 110961 CONNECT
www.seznam.cz:443 - HIER_DIRECT/77.75.77.222 -
1658483766.547 1620846 172.19.15.40 TCP_TUNNEL/200 3520 CONNECT
epns.eset.com:443 - HIER_DIRECT/91.228.167.192 -
1658483766.547 900183 172.19.14.73 TCP_TUNNEL/200 4296 CONNECT
etarget-emea.adnxs.com:443 - HIER_DIRECT/37.252.173.214 -
1658483767.548 1028965 172.19.15.2 TCP_TUNNEL/200 20796 CONNECT
www.seznam.cz:443 - HIER_DIRECT/77.75.79.222 -
1658483767.548 959986 172.19.15.199 TCP_TUNNEL/200 7269 CONNECT
fonts.googleapis.com:443 - HIER_DIRECT/142.251.36.106 -
1658483767.548 900027 172.19.14.73 TCP_TUNNEL/200 10544 CONNECT
fastlane.rubiconproject.com:443 - HIER_DIRECT/69.173.144.141 -
1658483768.549 1625800 172.19.14.204 TCP_TUNNEL/200 3635 CONNECT
epns.eset.com:443 - HIER_DIRECT/91.228.167.192 -
1658483768.549 903754 172.19.14.73 TCP_TUNNEL/200 5891 CONNECT
region1.google-analytics.com:443 - HIER_DIRECT/216.239.34.36 -
1658483769.551 1017091 172.19.14.19 TCP_TUNNEL/200 4702 CONNECT
secure-it.imrworldwide.com:443 - HIER_DIRECT/54.246.16.130 -
1658483769.551 976878 172.19.14.69 TCP_TUNNEL/200 1120200 CONNECT
rr2---sn-jxnoxu-2gbl.googlevideo.com:443 - HIER_DIRECT/195.113.214.205 -
1658483769.551 1626332 172.19.15.189 TCP_TUNNEL/200 3635 CONNECT
epns.eset.com:443 - HIER_DIRECT/91.228.167.192 -
1658483769.551 986881 172.19.14.69 TCP_TUNNEL/200 11983552 CONNECT
rr5---sn-2gb7sn7r.googlevideo.com:443 - HIER_DIRECT/172.217.130.74 -




in access.log of C1 are the time numbers a lot lower:

1658491430.020      7 172.19.14.191 TCP_MISS/200 473 GET
http://i5.c.eset.com/v1/auth/60064ADBC289880E8D77/updlist/31/eid/108/lid/108
- DIRECT/91.228.166.45 application/octet-stream
1658491430.025      6 172.19.15.72 TCP_MISS/200 473 GET
http://i5.c.eset.com/v1/auth/60064ADBC289880E8D77/updlist/31/eid/108/lid/108
- DIRECT/91.228.166.45 application/octet-stream
1658491430.031      6 172.19.14.191 TCP_MISS/200 473 GET
http://i5.c.eset.com/v1/auth/60064ADBC289880E8D77/updlist/32/eid/117876/lid/117876
- DIRECT/91.228.166.45 ap1658491430.038    430 172.19.14.71 TCP_MISS/200 4906 CONNECT
v10.events.data.microsoft.com:443 - DIRECT/20.42.65.90 -
1658491430.076     40 172.19.14.191 TCP_MISS/200 473 GET
http://i5.c.eset.com/v1/auth/60064ADBC289880E8D77/updlist/33/eid/10185/lid/10185
- DIRECT/91.228.166.45 application/octet-stream
1658491430.112     55 172.19.15.72 TCP_MISS/200 473 GET
http://i5.c.eset.com/v1/auth/60064ADBC289880E8D77/updlist/32/eid/117876/lid/117876
- DIRECT/91.228.166.45 application/octet-stream
1658491430.155  30017 172.19.14.186 TCP_MISS/200 62553 CONNECT
armmf.adobe.com:443 - DIRECT/2.23.8.158 -
1658491430.180     43 172.19.14.191 TCP_MISS/200 473 GET
http://i5.c.eset.com/v1/auth/60064ADBC289880E8D77/updlist/34/eid/8576/lid/8576
- DIRECT/91.228.166.45 application/octet-stream
1658491430.227    235 172.19.15.144 TCP_MISS/200 3793 CONNECT
ts.eset.com:443 - DIRECT/91.228.166.148 -
1658491430.276     73 172.19.15.72 TCP_MISS/200 473 GET
http://i5.c.eset.com/v1/auth/60064ADBC289880E8D77/updlist/33/eid/10185/lid/10185
- DIRECT/91.228.166.45 application/octet-stream
1658491430.404     90 172.19.14.191 TCP_MISS/200 473 GET
http://i5.c.eset.com/v1/auth/60064ADBC289880E8D77/updlist/35/eid/7351/lid/7351
- DIRECT/91.228.166.45 application/octet-stream




Now I am out of ideas what to test.


Thank you very much for your help,
Katerina









 p {
}


Tato e-mailov? zpr?va m? pouze informativn? charakter a vych?z? z
podklad?, kter? byly odes?lateli p?ed?ny nebo zasl?ny v minulosti. Obsah
t?to e-mailov? zpr?vy, resp. jak?koliv p??padn? pr?vn? jedn?n?
vypl?vaj?c? z t?to e-mailov? zpr?vy, se nepova?uje za n?vrh na
uzav?en? smlouvy ve smyslu ustanoven? ? 1731 z?kona ?. 89/2012 Sb.,
ob?ansk?ho z?kon?ku, v platn?m zn?n? (d?le jen ?ob?ansk? z?kon?k?)
nebo akceptaci n?vrhu na uzav?en? smlouvy ve smyslu ? 1740 ob?ansk?ho
z?kon?ku, pop?. potvrzen? uzav?en? smluvn?ho vztahu, nen?-li
odes?latelem uvedeno v?slovn? jinak. Tato e-mailov? zpr?va je ur?ena
pouze pro osobn? a d?v?rn? u?it? ur?en?mi adres?ty, tedy osobou
(osobami), kter? (kter?m) je obsahov? ur?ena. Nejste-li osobou, kter? je
tato zpr?va ur?ena, upozor?ujeme V?s, ?e jak?koliv ???en? ?i kop?rov?n?
t?to e-mailov? zpr?vy, ?i informace z n?, je zak?z?no. Jestli?e tuto
e-mailovou zpr?vu obdr??te nedopat?en?m, pros?me, oznamte tuto
skute?nost odes?lateli a odstra?te zpr?vu samotnou i v?echny jej?
p??lohy ze sv?ho syst?mu.


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220725/17e712a0/attachment.htm>

From squid.org at bloms.de  Mon Jul 25 11:22:23 2022
From: squid.org at bloms.de (Dieter Bloms)
Date: Mon, 25 Jul 2022 13:22:23 +0200
Subject: [squid-users] pros/cons squid vs next generation firewall
Message-ID: <20220725112223.7zmlmuhauroo77fr@bloms.de>

Hello,

I run some Squid proxy servers in conjunction with ICAP virus scanners
and I'm very happy with them. Our company now wants to replace them with
a checkpoint next generation firewall. Do you have some arguments that
speak for the further operation of the Squid proxies?

Thank you for any hint!


-- 
Rgeards

  Dieter

--
I do not get viruses because I do not use MS software.
If you use Outlook then please do not put my email address in your
address-book so that WHEN you get a virus it won't use my address in the
>From field.


From Antony.Stone at squid.open.source.it  Mon Jul 25 11:29:10 2022
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Mon, 25 Jul 2022 13:29:10 +0200
Subject: [squid-users] pros/cons squid vs next generation firewall
In-Reply-To: <20220725112223.7zmlmuhauroo77fr@bloms.de>
References: <20220725112223.7zmlmuhauroo77fr@bloms.de>
Message-ID: <202207251329.10890.Antony.Stone@squid.open.source.it>

On Monday 25 July 2022 at 13:22:23, Dieter Bloms wrote:

> Hello,
> 
> I run some Squid proxy servers in conjunction with ICAP virus scanners
> and I'm very happy with them. Our company now wants to replace them with
> a checkpoint next generation firewall. Do you have some arguments that
> speak for the further operation of the Squid proxies?

I would always start by asking what the justification for changing is, and see 
whether you can show that it's not valid (or has drawbacks the people 
advocating the change haven't thought of).


Antony.

-- 
BASIC is to computer languages what Roman numerals are to arithmetic.

                                                   Please reply to the list;
                                                         please *don't* CC me.


From Joseph.Garbacik at netapp.com  Mon Jul 25 12:20:00 2022
From: Joseph.Garbacik at netapp.com (Garbacik, Joe)
Date: Mon, 25 Jul 2022 12:20:00 +0000
Subject: [squid-users] pros/cons squid vs next generation firewall
In-Reply-To: <202207251329.10890.Antony.Stone@squid.open.source.it>
References: <20220725112223.7zmlmuhauroo77fr@bloms.de>
 <202207251329.10890.Antony.Stone@squid.open.source.it>
Message-ID: <MN2PR06MB595169989C66ACD8E470EE7698959@MN2PR06MB5951.namprd06.prod.outlook.com>

I would recommend comparing capabilities based on your access control requirements. For instance with squid, you can easily limit a POST to something like https://s3.amazonaws.com  but deny a POST to https://s3.amazonaws.com/* ; some firewalls cannot get that granular without complexity of the rules. Why this particular example is important, is because it allows one to create an S-3 bucket but not put anything in it; this way you can limit to which S-3 buckets one is authorized to access and how (i.e. GET vs POST). While this may not be relevant to your company's requirements, think of what are your company's requirements and make sure the solution meets all those requirements.

Joe
From: squid-users <squid-users-bounces at lists.squid-cache.org> on behalf of Antony Stone <Antony.Stone at squid.open.source.it>
Date: Monday, July 25, 2022 at 7:29 AM
To: squid-users at lists.squid-cache.org <squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] pros/cons squid vs next generation firewall
NetApp Security WARNING: This is an external email. Do not click links or open attachments unless you recognize the sender and know the content is safe.




On Monday 25 July 2022 at 13:22:23, Dieter Bloms wrote:

> Hello,
>
> I run some Squid proxy servers in conjunction with ICAP virus scanners
> and I'm very happy with them. Our company now wants to replace them with
> a checkpoint next generation firewall. Do you have some arguments that
> speak for the further operation of the Squid proxies?

I would always start by asking what the justification for changing is, and see
whether you can show that it's not valid (or has drawbacks the people
advocating the change haven't thought of).


Antony.

--
BASIC is to computer languages what Roman numerals are to arithmetic.

                                                   Please reply to the list;
                                                         please *don't* CC me.
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220725/4036cd2d/attachment.htm>

From squid3 at treenet.co.nz  Mon Jul 25 16:46:27 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 26 Jul 2022 04:46:27 +1200
Subject: [squid-users] slow TCP_TUNNEL
In-Reply-To: <62DE56F60200005F0004E844@gwia.plbohnice.cz>
References: <62DA93FD0200005F0004E80C@gwia.plbohnice.cz>
 <62DE56F60200005F0004E844@gwia.plbohnice.cz>
Message-ID: <ca05fe4a-00c3-49cd-c947-b85c2a2e0aa5@treenet.co.nz>

On 25/07/22 20:40, Katerina Bubenickova wrote:
> 
> access.log of D1
> 
> 1658483765.546 1622444 172.19.11.101 TCP_TUNNEL/200 3635 CONNECT 
> epns.eset.com:443 - HIER_DIRECT/91.228.167.192 -

Over a day to transfer 3KB of data. Given this proxy is exclusively 
relaying TCP_TUNNEL traffic this looks like you need to disable client 
persistent connections.


Also, make sure your Debian is upgraded to the latest packages and 
security updates for its version.


Amos


From gtaylor at tnetconsulting.net  Mon Jul 25 17:14:59 2022
From: gtaylor at tnetconsulting.net (Grant Taylor)
Date: Mon, 25 Jul 2022 11:14:59 -0600
Subject: [squid-users] slow TCP_TUNNEL
In-Reply-To: <62DE56F60200005F0004E844@gwia.plbohnice.cz>
References: <62DA93FD0200005F0004E80C@gwia.plbohnice.cz>
 <62DE56F60200005F0004E844@gwia.plbohnice.cz>
Message-ID: <4af72b80-97bd-8989-2581-d8f45df432d5@spamtrap.tnetconsulting.net>

On 7/25/22 2:40 AM, Katerina Bubenickova wrote:
> Now I am out of ideas what to test.
I am a big fan of tcpdump (et al.).  With something taking nearly 30 
times as long to function, there is probably something relatively 
obvious if you know where to look.  I find that watching the traffic for 
a few minutes usually shines a light in the direction that needs to be 
investigated further.  There may be spurious DNS queries, or something's 
attempting IPv6 for something, or the likes.

Take a look at the traffic for a brief period (30 seconds - 5 minutes) 
and see if what you see makes sense.  Hopefully you will see something 
that doesn't make sense.  Chase that for a few more minutes until you 
can explain it.  Maybe it will be part of the problem.



-- 
Grant. . . .
unix || die

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4017 bytes
Desc: S/MIME Cryptographic Signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220725/4fd14b64/attachment.bin>

From rousskov at measurement-factory.com  Mon Jul 25 19:43:52 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Mon, 25 Jul 2022 15:43:52 -0400
Subject: [squid-users] slow TCP_TUNNEL
In-Reply-To: <62DE56F60200005F0004E844@gwia.plbohnice.cz>
References: <62DA93FD0200005F0004E80C@gwia.plbohnice.cz>
 <62DE56F60200005F0004E844@gwia.plbohnice.cz>
Message-ID: <3e14062c-b288-e78f-8470-44dfc7d6f29d@measurement-factory.com>

On 7/25/22 04:40, Katerina Bubenickova wrote:
> Hi,
> We have 2 squid proxies running on Centos 6 which is very old (let's 
> call them C1, C2) in DMZ.
> 
> I have installed Debian 11 bullseye and squid +squidguard, trying to use 
> the same configuration (let's call it D1).
> If I use this proxy for 1 pc station, all is ok.
> If Iadded the proxy to dns as third proxy (C1+C2 + D1) or use one old 
> proxy and the new one (C1+D1) the response of internet was very slow, 
> unusable.
> 
> I tryed to fix it without success:
> I added directive url_rewrite_children 200
> I changed DNS from 8.8.8.8 to localhost
> I turned off squid cache
> I commented out squidguard
> I migrated from one vmware server to another, better,
> I added memory (16 GB) and CPU (6) ,
> I added directive dns_v4_first on
> There are no rules in D1 firewall
> 
> We have about 700 pc and the problem starts after 15-20 minutes after I 
> add D1 into dns as proxy.
> I can see it on our monitor Flowmon, where I can see value NPM response 
> time. In normal state it is about 0.1s, when the problem arises it is up 
> to 3s.
> If I remove D1 from dns, all is ok after a while.
> 
> I? tried to set IP of D1 the same as IP of C2 (of course C2 was power 
> off) to test, whether the problem could be caused by some firewall 
> between user pc and proxy, it doesn.t help
> 
> 
> access.log of D1
> 
> 1658483765.546 1622444 172.19.11.101 TCP_TUNNEL/200 3635 CONNECT 
> epns.eset.com:443 - HIER_DIRECT/91.228.167.192 -

Are all D1 transactions that slow (the second field is response time in 
milliseconds)? Or are some of them fast even when others are slow?

Is D1 Squid itself very busy (90% single CPU core utilization or 
higher)? If Squid looks idle, it is probably waiting for something like 
a DNS response or a problematic helper.

Any errors or warnings in D1 cache.log?

Can you reproduce the problem with a single curl/wget transaction that 
targets D1?


HTH,

Alex.



> 
> in access.log of C1 are the time numbers a lot lower:
> 
> 1658491430.020????? 7 172.19.14.191 TCP_MISS/200 473 GET 
> http://i5.c.eset.com/v1/auth/60064ADBC289880E8D77/updlist/31/eid/108/lid/108 
> - DIRECT/91.228.166.45 application/octet-stream
> 1658491430.025????? 6 172.19.15.72 TCP_MISS/200 473 GET 
> http://i5.c.eset.com/v1/auth/60064ADBC289880E8D77/updlist/31/eid/108/lid/108 
> - DIRECT/91.228.166.45 application/octet-stream
> 1658491430.031????? 6 172.19.14.191 TCP_MISS/200 473 GET 
> http://i5.c.eset.com/v1/auth/60064ADBC289880E8D77/updlist/32/eid/117876/lid/117876 
> - DIRECT/91.228.166.45 application/octet-stream
> 1658491430.038??? 430 172.19.14.71 TCP_MISS/200 4906 CONNECT 
> v10.events.data.microsoft.com:443 - DIRECT/20.42.65.90 -
> 1658491430.076???? 40 172.19.14.191 TCP_MISS/200 473 GET 
> http://i5.c.eset.com/v1/auth/60064ADBC289880E8D77/updlist/33/eid/10185/lid/10185 
> - DIRECT/91.228.166.45 application/octet-stream
> 1658491430.112???? 55 172.19.15.72 TCP_MISS/200 473 GET 
> http://i5.c.eset.com/v1/auth/60064ADBC289880E8D77/updlist/32/eid/117876/lid/117876 
> - DIRECT/91.228.166.45 application/octet-stream
> 1658491430.155? 30017 172.19.14.186 TCP_MISS/200 62553 CONNECT 
> armmf.adobe.com:443 - DIRECT/2.23.8.158 -
> 1658491430.180???? 43 172.19.14.191 TCP_MISS/200 473 GET 
> http://i5.c.eset.com/v1/auth/60064ADBC289880E8D77/updlist/34/eid/8576/lid/8576 
> - DIRECT/91.228.166.45 application/octet-stream
> 1658491430.227??? 235 172.19.15.144 TCP_MISS/200 3793 CONNECT 
> ts.eset.com:443 - DIRECT/91.228.166.148 -
> 1658491430.276???? 73 172.19.15.72 TCP_MISS/200 473 GET 
> http://i5.c.eset.com/v1/auth/60064ADBC289880E8D77/updlist/33/eid/10185/lid/10185 
> - DIRECT/91.228.166.45 application/octet-stream
> 1658491430.404???? 90 172.19.14.191 TCP_MISS/200 473 GET 
> http://i5.c.eset.com/v1/auth/60064ADBC289880E8D77/updlist/35/eid/7351/lid/7351 
> - DIRECT/91.228.166.45 application/octet-stream
> 
> 
> 
> Now I am out of ideas what to test.



From rousskov at measurement-factory.com  Mon Jul 25 19:53:22 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Mon, 25 Jul 2022 15:53:22 -0400
Subject: [squid-users] pros/cons squid vs next generation firewall
In-Reply-To: <20220725112223.7zmlmuhauroo77fr@bloms.de>
References: <20220725112223.7zmlmuhauroo77fr@bloms.de>
Message-ID: <96c958f1-f6e2-6a7d-363c-81b84fa4fafb@measurement-factory.com>

On 7/25/22 07:22, Dieter Bloms wrote:

> I run some Squid proxy servers in conjunction with ICAP virus scanners
> and I'm very happy with them. Our company now wants to replace them with
> a checkpoint next generation firewall. Do you have some arguments that
> speak for the further operation of the Squid proxies?

I doubt any general arguments like "do not break what is working" would 
help you, but to go beyond those generalities, we would need to know 
what feeds that desire to replace (an apparently well-working) setup: 
Features? 24x7 support? Vulnerabilities? Kickbacks? :-)

Alex.


From rousskov at measurement-factory.com  Mon Jul 25 20:05:14 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Mon, 25 Jul 2022 16:05:14 -0400
Subject: [squid-users] Fwd: Sqid uses all RAM / killed by OOM
In-Reply-To: <CABMAtPJxqW-wum8SVGLYbYeU2VUMF0pa7BMTdxksi4B4ChWD9Q@mail.gmail.com>
References: <CABMAtPLpoUrAXJv+JJvMbAe=N-b-brQeTTzq4OqDNc3Rf31GoQ@mail.gmail.com>
 <CABMAtPJxqW-wum8SVGLYbYeU2VUMF0pa7BMTdxksi4B4ChWD9Q@mail.gmail.com>
Message-ID: <baaf98ff-559a-62f6-4a99-218610974c27@measurement-factory.com>

On 7/25/22 01:59, Ronny Preiss wrote:

> Can someone support me regarding my question about compiling squid 5.6 
> on ubuntu 22.04?

There is probably some misunderstanding: You are expecting some kind of 
a patch for Squid v5.6, but I do not know what patch you are talking 
about. I am aware of one important bug fix that was added to Squid v5 
after v5.6 release[1], but that fix is not targeting any memory leaks 
(it may still fix some as a side effect though).

I also do not recall any known memory leaks in v5.6, but perhaps I have 
forgotten something we fixed in master/v6 long time ago -- until [1], it 
was not possible to run v5 in production deployments I dealt with, so I 
can easily forget or miss some old v5 details.

If you believe that your Squid v5.6 is leaking memory, try [1]. If that 
does not help, you may need to create a bug report on Bugzilla and start 
collecting the necessary details to confirm the leak and identify what 
is leaking.

[1] https://github.com/squid-cache/squid/commit/c999621.diff


HTH,

Alex.



> Since my previous attempts also have the "memory leak" on ubuntu 22.04 
> and squid 5.6 problem again.
> 
> Kind regards Ronny
> 
> ---------- Forwarded message ---------
> Von: *Ronny Preiss* <ronny.preiss at gmail.com <mailto:ronny.preiss at gmail.com>>
> Date: Mo., 11. Juli 2022 um 08:54?Uhr
> Subject: Sqid uses all RAM / killed by OOM
> To: <squid-users at lists.squid-cache.org 
> <mailto:squid-users at lists.squid-cache.org>>
> 
> 
> Hello all,
> 
> I have the following problem with squid 5.2 on ubuntu 22.04.
> Squid consumes all ram and the entire SWAP. When swap and ram are 
> completely full, the OOM killer strikes and terminates the process.
> 
> We use three internal child proxy servers with keepalived and haproxy as 
> load balancers. From our ISP we use a parent upstream proxy for external 
> internet traffic.
> As an operating system we have so far Ubuntu 20.04.4 with squid 4.1 in 
> use. This constellation works flawlessly.
> 
> Now I want to update the Server to Ubuntu 22.04 and squid 5.2. But with 
> Ubuntu 22.04 and squid 5.2 the above mentioned problem with the OOM 
> Killer occurs.
> The new machine has only the OS and squid installed.
> 
> Who can help me with a solution?
> 
> With kind regards
> Ronny
> 
> Attached the squid configuration and the VMWare specs.
> 
> ### VM Specs ###
> OS: Ubuntu 22.04 Server
> CPU: 4x (Intel(R) Xeon(R) CPU E5-2690 v3 @ 2.60GHz)
> RAM: 4 GB
> VMWare: ESXi 7.0 U2
> 
> ### CONFIG ###
> acl 10.172.xxx.xxx/18 <http://10.172.128.0/18> src 10.172.xxx.xxx/18 
> <http://10.172.128.0/18>
> acl 172.16.xxx.xxx/12 <http://172.16.0.0/12> src 172.16.xxx.xxx/12 
> <http://172.16.0.0/12>
> acl 192.168.xxx.xxx/16 <http://192.168.0.0/16> src 192.168.xxx.xxx/16 
> <http://192.168.0.0/16>
> 
> acl Safe_ports port 80
> acl Safe_ports port 21
> acl Safe_ports port 443
> acl Safe_ports port 70
> acl Safe_ports port 210
> acl Safe_ports port 1025-65535
> acl Safe_ports port 280
> acl Safe_ports port 488
> acl Safe_ports port 591
> acl Safe_ports port 777
> 
> http_access allow 10.172.xxx.xxx/18 <http://10.172.128.0/18> Safe_ports
> http_access allow 172.16.xxx.xxx/12 <http://172.16.0.0/12> Safe_ports
> http_access allow 192.168.xxx.xxx/16 <http://192.168.0.0/16> Safe_ports
> 
> http_access allow localhost manager
> http_access allow localhost
> http_access deny manager
> http_access deny all
> 
> include /etc/squid/conf.d/*
> http_port 10.172.xxx.xxx:3128 <http://10.172.128.34:3128>
> 
> cache_peer 10.210.xxx.xxx parent 8080 0
> cache_dir ufs /var/spool/squid 3000 16 256
> cache_effective_user proxy
> cache_effective_group proxy
> 
> coredump_dir /var/spool/squid
> 
> refresh_pattern ^ftp:? ? ? ? ? ?1440? ? 20%? ? ?10080
> refresh_pattern ^gopher:? ? ? ? 1440? ? 0%? ? ? 1440
> refresh_pattern -i (/cgi-bin/|\?) 0? ? ?0%? ? ? 0
> refresh_pattern \/(Packages|Sources)(|\.bz2|\.gz|\.xz)$ 0 0% 0 refresh-ims
> refresh_pattern \/Release(|\.gpg)$ 0 0% 0 refresh-ims
> refresh_pattern \/InRelease$ 0 0% 0 refresh-ims
> refresh_pattern \/(Translation-.*)(|\.bz2|\.gz|\.xz)$ 0 0% 0 refresh-ims
> refresh_pattern .? ? ? ? ? ? ? ?0? ? ? ?20%? ? ?4320
> 
> never_direct allow all
> max_filedescriptors 40960
> dns_nameservers 10.244.xxx.xxx
> 
> ### DMESG ###
> 
> [256929.150801] 
> oom-kill:constraint=CONSTRAINT_NONE,nodemask=(null),cpuset=/,mems_allowed=0,global_oom,task_memcg=/system.slice/squid.service,task=squid,pid=26390,uid=13
> [256929.150822] Out of memory: Killed process 26390 (squid) 
> total-vm:9691764kB, anon-rss:3657748kB, file-rss:2320kB, shmem-rss:0kB, 
> UID:13 pgtables:18932kB oom_score_adj:0
> [256929.510641] oom_reaper: reaped process 26390 (squid), now 
> anon-rss:0kB, file-rss:0kB, shmem-rss:0kB
> 
> 
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



From ngtech1ltd at gmail.com  Mon Jul 25 20:26:16 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Mon, 25 Jul 2022 23:26:16 +0300
Subject: [squid-users] pros/cons squid vs next generation firewall
In-Reply-To: <20220725112223.7zmlmuhauroo77fr@bloms.de>
References: <20220725112223.7zmlmuhauroo77fr@bloms.de>
Message-ID: <006201d8a064$cb61fd00$6225f700$@gmail.com>

Hey Dieter,

You should differentiate between a SMB level  appliances to a more advanced ones.
The basic difference is simplicity of management via WEBUI.
They also have API but you will need developer level skills for that.
>From my experience with checkpoint they basically have a large DB of applications and threat feeds.
Since you need it for basic ACLs and ICAP virus scanners it's possible that a checkpoint server might be good
for your use case.
You should really compare the goals and the costs in general.
The SMB versions downgrades any HTTP connection to HTTP 1.x so don't expect these to support HTTP2.
I don't know the size of your company but in general the most "famous" vendors for NGFW are:
* CheckPoint
* FortiNet
* Palo Alto
* Sonicwall

There is a price for each product and you should compare all of them and also different versions of them.
Every product in the industry has it's limitations and I have found weaknesses in each and every one of them
and in many others including Squid.

The NGFW Is basically something that Palo Alto invented and all others used this same naming for publicity.
The one big PRO I found in checkpoint is that their support was very responsive.

Specifically in CheckPoint you should look at the:
Known Limitations

Per the firmware version you might be getting for the appliance or server your company might want to purchase.

All The Bests,
Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Dieter Bloms
Sent: Monday, 25 July 2022 14:22
To: squid-users at lists.squid-cache.org
Subject: [squid-users] pros/cons squid vs next generation firewall

Hello,

I run some Squid proxy servers in conjunction with ICAP virus scanners
and I'm very happy with them. Our company now wants to replace them with
a checkpoint next generation firewall. Do you have some arguments that
speak for the further operation of the Squid proxies?

Thank you for any hint!


-- 
Rgeards

  Dieter

--
I do not get viruses because I do not use MS software.
If you use Outlook then please do not put my email address in your
address-book so that WHEN you get a virus it won't use my address in the
>From field.
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From ngtech1ltd at gmail.com  Mon Jul 25 20:33:01 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Mon, 25 Jul 2022 23:33:01 +0300
Subject: [squid-users] Fwd: Sqid uses all RAM / killed by OOM
In-Reply-To: <baaf98ff-559a-62f6-4a99-218610974c27@measurement-factory.com>
References: <CABMAtPLpoUrAXJv+JJvMbAe=N-b-brQeTTzq4OqDNc3Rf31GoQ@mail.gmail.com>
 <CABMAtPJxqW-wum8SVGLYbYeU2VUMF0pa7BMTdxksi4B4ChWD9Q@mail.gmail.com>
 <baaf98ff-559a-62f6-4a99-218610974c27@measurement-factory.com>
Message-ID: <006301d8a065$bd098b50$371ca1f0$@gmail.com>

Hey Alex,

Just to clear out the doubts.
Ronny was trying to use 5.2 on Ubuntu 22.04 as an upgrade from 20.04.
The issue was that probably for the same traffic on 20.04 with another version of squid
it consumed a lot of RAM.

My first suggestion was to upgrade into latest 5.6 but since 22.04 uses OpenSSL 3.x Squid 5.6
would not compile on it. The referenced patch is for OpenSSL 3.x compatibility and not a memory leak. 

What I didn't understood is first: how can 4.17 can be compiled on 22.04 and if it compiles
is there still some memory leak?

I believe it's too soon to upgrade into 22.04 and I would suggest to use another OS for now.
>From what I have seen Ubuntu doesn't have more support than other OS for now so..

The only thing I can offer is to use some RPM based OS which can use my packages.

Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Alex Rousskov
Sent: Monday, 25 July 2022 23:05
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Fwd: Sqid uses all RAM / killed by OOM

On 7/25/22 01:59, Ronny Preiss wrote:

> Can someone support me regarding my question about compiling squid 5.6 
> on ubuntu 22.04?

There is probably some misunderstanding: You are expecting some kind of 
a patch for Squid v5.6, but I do not know what patch you are talking 
about. I am aware of one important bug fix that was added to Squid v5 
after v5.6 release[1], but that fix is not targeting any memory leaks 
(it may still fix some as a side effect though).

I also do not recall any known memory leaks in v5.6, but perhaps I have 
forgotten something we fixed in master/v6 long time ago -- until [1], it 
was not possible to run v5 in production deployments I dealt with, so I 
can easily forget or miss some old v5 details.

If you believe that your Squid v5.6 is leaking memory, try [1]. If that 
does not help, you may need to create a bug report on Bugzilla and start 
collecting the necessary details to confirm the leak and identify what 
is leaking.

[1] https://github.com/squid-cache/squid/commit/c999621.diff


HTH,

Alex.



> Since my previous attempts also have the "memory leak" on ubuntu 22.04 
> and squid 5.6 problem again.
> 
> Kind regards Ronny
> 
> ---------- Forwarded message ---------
> Von: *Ronny Preiss* <ronny.preiss at gmail.com <mailto:ronny.preiss at gmail.com>>
> Date: Mo., 11. Juli 2022 um 08:54 Uhr
> Subject: Sqid uses all RAM / killed by OOM
> To: <squid-users at lists.squid-cache.org 
> <mailto:squid-users at lists.squid-cache.org>>
> 
> 
> Hello all,
> 
> I have the following problem with squid 5.2 on ubuntu 22.04.
> Squid consumes all ram and the entire SWAP. When swap and ram are 
> completely full, the OOM killer strikes and terminates the process.
> 
> We use three internal child proxy servers with keepalived and haproxy as 
> load balancers. From our ISP we use a parent upstream proxy for external 
> internet traffic.
> As an operating system we have so far Ubuntu 20.04.4 with squid 4.1 in 
> use. This constellation works flawlessly.
> 
> Now I want to update the Server to Ubuntu 22.04 and squid 5.2. But with 
> Ubuntu 22.04 and squid 5.2 the above mentioned problem with the OOM 
> Killer occurs.
> The new machine has only the OS and squid installed.
> 
> Who can help me with a solution?
> 
> With kind regards
> Ronny
> 
> Attached the squid configuration and the VMWare specs.
> 
> ### VM Specs ###
> OS: Ubuntu 22.04 Server
> CPU: 4x (Intel(R) Xeon(R) CPU E5-2690 v3 @ 2.60GHz)
> RAM: 4 GB
> VMWare: ESXi 7.0 U2
> 
> ### CONFIG ###
> acl 10.172.xxx.xxx/18 <http://10.172.128.0/18> src 10.172.xxx.xxx/18 
> <http://10.172.128.0/18>
> acl 172.16.xxx.xxx/12 <http://172.16.0.0/12> src 172.16.xxx.xxx/12 
> <http://172.16.0.0/12>
> acl 192.168.xxx.xxx/16 <http://192.168.0.0/16> src 192.168.xxx.xxx/16 
> <http://192.168.0.0/16>
> 
> acl Safe_ports port 80
> acl Safe_ports port 21
> acl Safe_ports port 443
> acl Safe_ports port 70
> acl Safe_ports port 210
> acl Safe_ports port 1025-65535
> acl Safe_ports port 280
> acl Safe_ports port 488
> acl Safe_ports port 591
> acl Safe_ports port 777
> 
> http_access allow 10.172.xxx.xxx/18 <http://10.172.128.0/18> Safe_ports
> http_access allow 172.16.xxx.xxx/12 <http://172.16.0.0/12> Safe_ports
> http_access allow 192.168.xxx.xxx/16 <http://192.168.0.0/16> Safe_ports
> 
> http_access allow localhost manager
> http_access allow localhost
> http_access deny manager
> http_access deny all
> 
> include /etc/squid/conf.d/*
> http_port 10.172.xxx.xxx:3128 <http://10.172.128.34:3128>
> 
> cache_peer 10.210.xxx.xxx parent 8080 0
> cache_dir ufs /var/spool/squid 3000 16 256
> cache_effective_user proxy
> cache_effective_group proxy
> 
> coredump_dir /var/spool/squid
> 
> refresh_pattern ^ftp:           1440    20%     10080
> refresh_pattern ^gopher:        1440    0%      1440
> refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
> refresh_pattern \/(Packages|Sources)(|\.bz2|\.gz|\.xz)$ 0 0% 0 refresh-ims
> refresh_pattern \/Release(|\.gpg)$ 0 0% 0 refresh-ims
> refresh_pattern \/InRelease$ 0 0% 0 refresh-ims
> refresh_pattern \/(Translation-.*)(|\.bz2|\.gz|\.xz)$ 0 0% 0 refresh-ims
> refresh_pattern .               0       20%     4320
> 
> never_direct allow all
> max_filedescriptors 40960
> dns_nameservers 10.244.xxx.xxx
> 
> ### DMESG ###
> 
> [256929.150801] 
> oom-kill:constraint=CONSTRAINT_NONE,nodemask=(null),cpuset=/,mems_allowed=0,global_oom,task_memcg=/system.slice/squid.service,task=squid,pid=26390,uid=13
> [256929.150822] Out of memory: Killed process 26390 (squid) 
> total-vm:9691764kB, anon-rss:3657748kB, file-rss:2320kB, shmem-rss:0kB, 
> UID:13 pgtables:18932kB oom_score_adj:0
> [256929.510641] oom_reaper: reaped process 26390 (squid), now 
> anon-rss:0kB, file-rss:0kB, shmem-rss:0kB
> 
> 
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From rousskov at measurement-factory.com  Mon Jul 25 21:18:17 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Mon, 25 Jul 2022 17:18:17 -0400
Subject: [squid-users] Fwd: Sqid uses all RAM / killed by OOM
In-Reply-To: <006301d8a065$bd098b50$371ca1f0$@gmail.com>
References: <CABMAtPLpoUrAXJv+JJvMbAe=N-b-brQeTTzq4OqDNc3Rf31GoQ@mail.gmail.com>
 <CABMAtPJxqW-wum8SVGLYbYeU2VUMF0pa7BMTdxksi4B4ChWD9Q@mail.gmail.com>
 <baaf98ff-559a-62f6-4a99-218610974c27@measurement-factory.com>
 <006301d8a065$bd098b50$371ca1f0$@gmail.com>
Message-ID: <dc32d5cd-99af-a8c4-7262-a7e4a8ee1bf1@measurement-factory.com>

On 7/25/22 16:33, ngtech1ltd at gmail.com wrote:

> Ronny was trying to use 5.2 on Ubuntu 22.04 as an upgrade from 20.04.
> The issue was that probably for the same traffic on 20.04 with another version of squid
> it consumed a lot of RAM.

> My first suggestion was to upgrade into latest 5.6 but since 22.04 uses OpenSSL 3.x Squid 5.6
> would not compile on it.

I suspect Squid will compile just fine, just not with the default build 
options and/or default OpenSSL install:

* If the default install of OpenSSL on 22.04 still provides deprecated 
OpenSSL v1 APIs, then it may be possible to build Squid with that by 
telling the compiler not to treat warnings as errors (i.e. remove 
-Werror from CXXFLAGS).

* Otherwise, it is not very difficult to install any modern OpenSSL 
version from OpenSSL sources and build Squid with that.


> The referenced patch is for OpenSSL 3.x compatibility and not a memory leak.

Thank you for clarifying that. If there is a high quality patch that 
adds OpenSSL v3 support to Squid v5, then it is fine to use that patch 
as a short-term workaround, of course. I do not have such a patch.


> What I didn't understood is first: how can 4.17 can be compiled on 22.04

I do not know the answer, but perhaps Squid v4.17 does not enable some 
of the warnings that v5 does?


> and if it compiles is there still some memory leak?

I doubt OpenSSL upgrade can stop a serious memory leak, but it is not 
impossible. Some leak-sensitive code was modified/improved when adding 
support to OpenSSL v3.

Alex.



> I believe it's too soon to upgrade into 22.04 and I would suggest to use another OS for now.
> From what I have seen Ubuntu doesn't have more support than other OS for now so..
> 
> The only thing I can offer is to use some RPM based OS which can use my packages.
> 
> Eliezer
> 
> ----
> Eliezer Croitoru
> NgTech, Tech Support
> Mobile: +972-5-28704261
> Email: ngtech1ltd at gmail.com
> Web: https://ngtech.co.il/
> My-Tube: https://tube.ngtech.co.il/
> 
> -----Original Message-----
> From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Alex Rousskov
> Sent: Monday, 25 July 2022 23:05
> To: squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] Fwd: Sqid uses all RAM / killed by OOM
> 
> On 7/25/22 01:59, Ronny Preiss wrote:
> 
>> Can someone support me regarding my question about compiling squid 5.6
>> on ubuntu 22.04?
> 
> There is probably some misunderstanding: You are expecting some kind of
> a patch for Squid v5.6, but I do not know what patch you are talking
> about. I am aware of one important bug fix that was added to Squid v5
> after v5.6 release[1], but that fix is not targeting any memory leaks
> (it may still fix some as a side effect though).
> 
> I also do not recall any known memory leaks in v5.6, but perhaps I have
> forgotten something we fixed in master/v6 long time ago -- until [1], it
> was not possible to run v5 in production deployments I dealt with, so I
> can easily forget or miss some old v5 details.
> 
> If you believe that your Squid v5.6 is leaking memory, try [1]. If that
> does not help, you may need to create a bug report on Bugzilla and start
> collecting the necessary details to confirm the leak and identify what
> is leaking.
> 
> [1] https://github.com/squid-cache/squid/commit/c999621.diff
> 
> 
> HTH,
> 
> Alex.
> 
> 
> 
>> Since my previous attempts also have the "memory leak" on ubuntu 22.04
>> and squid 5.6 problem again.
>>
>> Kind regards Ronny
>>
>> ---------- Forwarded message ---------
>> Von: *Ronny Preiss* <ronny.preiss at gmail.com <mailto:ronny.preiss at gmail.com>>
>> Date: Mo., 11. Juli 2022 um 08:54 Uhr
>> Subject: Sqid uses all RAM / killed by OOM
>> To: <squid-users at lists.squid-cache.org
>> <mailto:squid-users at lists.squid-cache.org>>
>>
>>
>> Hello all,
>>
>> I have the following problem with squid 5.2 on ubuntu 22.04.
>> Squid consumes all ram and the entire SWAP. When swap and ram are
>> completely full, the OOM killer strikes and terminates the process.
>>
>> We use three internal child proxy servers with keepalived and haproxy as
>> load balancers. From our ISP we use a parent upstream proxy for external
>> internet traffic.
>> As an operating system we have so far Ubuntu 20.04.4 with squid 4.1 in
>> use. This constellation works flawlessly.
>>
>> Now I want to update the Server to Ubuntu 22.04 and squid 5.2. But with
>> Ubuntu 22.04 and squid 5.2 the above mentioned problem with the OOM
>> Killer occurs.
>> The new machine has only the OS and squid installed.
>>
>> Who can help me with a solution?
>>
>> With kind regards
>> Ronny
>>
>> Attached the squid configuration and the VMWare specs.
>>
>> ### VM Specs ###
>> OS: Ubuntu 22.04 Server
>> CPU: 4x (Intel(R) Xeon(R) CPU E5-2690 v3 @ 2.60GHz)
>> RAM: 4 GB
>> VMWare: ESXi 7.0 U2
>>
>> ### CONFIG ###
>> acl 10.172.xxx.xxx/18 <http://10.172.128.0/18> src 10.172.xxx.xxx/18
>> <http://10.172.128.0/18>
>> acl 172.16.xxx.xxx/12 <http://172.16.0.0/12> src 172.16.xxx.xxx/12
>> <http://172.16.0.0/12>
>> acl 192.168.xxx.xxx/16 <http://192.168.0.0/16> src 192.168.xxx.xxx/16
>> <http://192.168.0.0/16>
>>
>> acl Safe_ports port 80
>> acl Safe_ports port 21
>> acl Safe_ports port 443
>> acl Safe_ports port 70
>> acl Safe_ports port 210
>> acl Safe_ports port 1025-65535
>> acl Safe_ports port 280
>> acl Safe_ports port 488
>> acl Safe_ports port 591
>> acl Safe_ports port 777
>>
>> http_access allow 10.172.xxx.xxx/18 <http://10.172.128.0/18> Safe_ports
>> http_access allow 172.16.xxx.xxx/12 <http://172.16.0.0/12> Safe_ports
>> http_access allow 192.168.xxx.xxx/16 <http://192.168.0.0/16> Safe_ports
>>
>> http_access allow localhost manager
>> http_access allow localhost
>> http_access deny manager
>> http_access deny all
>>
>> include /etc/squid/conf.d/*
>> http_port 10.172.xxx.xxx:3128 <http://10.172.128.34:3128>
>>
>> cache_peer 10.210.xxx.xxx parent 8080 0
>> cache_dir ufs /var/spool/squid 3000 16 256
>> cache_effective_user proxy
>> cache_effective_group proxy
>>
>> coredump_dir /var/spool/squid
>>
>> refresh_pattern ^ftp:           1440    20%     10080
>> refresh_pattern ^gopher:        1440    0%      1440
>> refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
>> refresh_pattern \/(Packages|Sources)(|\.bz2|\.gz|\.xz)$ 0 0% 0 refresh-ims
>> refresh_pattern \/Release(|\.gpg)$ 0 0% 0 refresh-ims
>> refresh_pattern \/InRelease$ 0 0% 0 refresh-ims
>> refresh_pattern \/(Translation-.*)(|\.bz2|\.gz|\.xz)$ 0 0% 0 refresh-ims
>> refresh_pattern .               0       20%     4320
>>
>> never_direct allow all
>> max_filedescriptors 40960
>> dns_nameservers 10.244.xxx.xxx
>>
>> ### DMESG ###
>>
>> [256929.150801]
>> oom-kill:constraint=CONSTRAINT_NONE,nodemask=(null),cpuset=/,mems_allowed=0,global_oom,task_memcg=/system.slice/squid.service,task=squid,pid=26390,uid=13
>> [256929.150822] Out of memory: Killed process 26390 (squid)
>> total-vm:9691764kB, anon-rss:3657748kB, file-rss:2320kB, shmem-rss:0kB,
>> UID:13 pgtables:18932kB oom_score_adj:0
>> [256929.510641] oom_reaper: reaped process 26390 (squid), now
>> anon-rss:0kB, file-rss:0kB, shmem-rss:0kB
>>
>>
>>
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



From squid3 at treenet.co.nz  Tue Jul 26 01:55:57 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 26 Jul 2022 13:55:57 +1200
Subject: [squid-users] Fwd: Sqid uses all RAM / killed by OOM
In-Reply-To: <CABMAtPJxqW-wum8SVGLYbYeU2VUMF0pa7BMTdxksi4B4ChWD9Q@mail.gmail.com>
References: <CABMAtPLpoUrAXJv+JJvMbAe=N-b-brQeTTzq4OqDNc3Rf31GoQ@mail.gmail.com>
 <CABMAtPJxqW-wum8SVGLYbYeU2VUMF0pa7BMTdxksi4B4ChWD9Q@mail.gmail.com>
Message-ID: <42f1def8-a41e-4a97-4498-5ac954062cbe@treenet.co.nz>

On 25/07/22 17:59, Ronny Preiss wrote:
> Hello all,
> 
> I have now compiled and installed squid 4.17 as a transition solution on 
> ubuntu 22.04.
> 
> Can someone support me regarding my question about compiling squid 5.6 
> on ubuntu 22.04?
> Since my previous attempts also have the "memory leak" on ubuntu 22.04 
> and squid 5.6 problem again.

I am not sure if this will help at all with the memory leak. But the 
Debian package for 5.6+ contain OpenSSL v3 support and should build fine 
for this Ubuntu.


You will first need to run these to install the build requirements:
   apt-get update &&
   apt-get build-dep squid &&
   apt-get install git-buildpackage dpkg libssl-dev


Then from a build directory run these:

  git clone https://salsa.debian.org/squid-team/squid.git &&
  cd squid &&
  gbp buildpackage --git-no-sign-tags ;
  cd ..


Install the package you want like this:

  dpkg --install \
     squid-common_5.6-1_amd64.deb \
     squid_5.6-1_amd64.deb

  dpkg --install \
     squid-common_5.6-1_amd64.deb \
     squid-openssl_5.6-1_amd64.deb

Exact filenames may differ. Listing squid-common first is important.


If Ubuntu ship a newer version it will install over top of these 
packages. There should not be issues with that as it means Ubuntu have 
pulled in the OpenSSL v3 support from Debian.

Alternatively, you can keep the git clone/checkout around to track 
Debian security patches and newer releases. You just have to do the 
rebuild and re-install parts as-needed.


HTH
Amos


From ngtech1ltd at gmail.com  Tue Jul 26 19:40:10 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Tue, 26 Jul 2022 22:40:10 +0300
Subject: [squid-users] slow TCP_TUNNEL
In-Reply-To: <62DE56F60200005F0004E844@gwia.plbohnice.cz>
References: <62DA93FD0200005F0004E80C@gwia.plbohnice.cz>
 <62DE56F60200005F0004E844@gwia.plbohnice.cz>
Message-ID: <000001d8a127$85500500$8ff00f00$@gmail.com>

Hey Katerina,

Let?s try to understand the issue first.
The CentOS 6 squid version is what exactly? (squid -v )
What do you require from this proxy to do else then squidguard?
>From what I understand it?s a simple forward proxy and not an intercept proxy.
It means that all DNS resolution is done on the proxy.
What localhost DNS daemon are you using? (Bind? unbound? other?)
What version of Squid are you running on the Debian 11 machine (squid -v)

The `dns_v4_first` configuration is obsolete.
The first thing to check is that if the pinger is up and running.
>From what I remember Debian didn?t liked the pinger daemon.
Are you using workers in your configuration?
If you can share your current squid version and squid.conf we might be able to help you try to understand what?s going on.
The latest version of squid I have published for CentOS 6 was: squid-3.5.28-1.el6.x86_64.rpm

For a simple forward proxy you won?t need too much hardware but if you won?t be using workers this would be the expected behavior.
I believe that if you do not require special configurations we can compare another simple forward proxy just to make sure that
the core of the issue is something with squid.
(it?s possible to find the issue without using a comparison if enough details would be published)

How exactly is the proxy configured on the clients side?
Also is there any form of authentication happening or plain connections?
How do you load balance between the proxies?

>From my experience 700 clients are OK on a single proxy however?
only if the load is not too high in the network level.
It can be that the maximum limit of open file descriptors is reached or couple other reasons.
Can you share couple pages of your cache manager output?
The next script:
https://gist.githubusercontent.com/elico/8790bdc835d8e9ecbc57e72fc31effc0/raw/60d140b0e772fa4f418779bfc27e4804a345ce23/dump-cache-mgr-to-file.sh

should dump all pages to stdout but don?t send the output on the public list please.
I will try to analyze the pages and see if there is something specific I can understand from them.
If the above output would not be sufficient I have another more in-depth script that should help us
to understand what is the core issue with this VM.

I am waiting for more details so I would be able to try and help you.

Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: mailto:ngtech1ltd at gmail.com
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/

From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Katerina Bubenickova
Sent: Monday, 25 July 2022 11:40
To: squid-users at lists.squid-cache.org
Subject: [squid-users] slow TCP_TUNNEL

Hi,
We have 2 squid proxies running on Centos 6 which is very old (let's call them C1, C2) in DMZ.

I have installed Debian 11 bullseye and squid +squidguard, trying to use the same configuration (let's call it D1).
If I use this proxy for 1 pc station, all is ok.
If Iadded the proxy to dns as third proxy (C1+C2 + D1) or use one old proxy and the new one (C1+D1) the response of internet was very slow, unusable.

I tryed to fix it without success:
I added directive url_rewrite_children 200
I changed DNS from 8.8.8.8 to localhost
I turned off squid cache
I commented out squidguard
I migrated from one vmware server to another, better,
I added memory (16 GB) and CPU (6) ,
I added directive dns_v4_first on
There are no rules in D1 firewall

We have about 700 pc and the problem starts after 15-20 minutes after I add D1 into dns as proxy.
I can see it on our monitor Flowmon, where I can see value NPM response time. In normal state it is about 0.1s, when the problem arises it is up to 3s.
If I remove D1 from dns, all is ok after a while.

I  tried to set IP of D1 the same as IP of C2 (of course C2 was power off) to test, whether the problem could be caused by some firewall between user pc and proxy, it doesn.t help


access.log of D1
1658483765.546 1622444 172.19.11.101 TCP_TUNNEL/200 3635 CONNECT epns.eset.com:443 - HIER_DIRECT/91.228.167.192 -
1658483765.546 900188 172.19.14.73 TCP_TUNNEL/200 4738 CONNECT prg.smartadserver.com:443 - HIER_DIRECT/185.86.138.16 -
1658483765.546 900246 172.19.14.73 TCP_TUNNEL/200 4102 CONNECT bidder.criteo.com:443 - HIER_DIRECT/178.250.0.165 -
1658483765.546 1008081 172.19.13.171 TCP_TUNNEL/200 12749428 CONNECT rr1---sn-jxnoxu-2gbl.googlevideo.com:443 - HIER_DIRECT/195.113.214.204 -
1658483765.546 901791 172.19.14.95 TCP_TUNNEL/200 2176 CONNECT pcb.kb.cz:443 - HIER_DIRECT/194.50.226.158 -
1658483765.546 900569 172.19.14.73 TCP_TUNNEL/200 7260 CONNECT adx.adform.net:443 - HIER_DIRECT/37.157.2.237 -
1658483766.547 935767 172.19.13.190 TCP_TUNNEL/200 110961 CONNECT http://www.seznam.cz:443 - HIER_DIRECT/77.75.77.222 -
1658483766.547 1620846 172.19.15.40 TCP_TUNNEL/200 3520 CONNECT epns.eset.com:443 - HIER_DIRECT/91.228.167.192 -
1658483766.547 900183 172.19.14.73 TCP_TUNNEL/200 4296 CONNECT etarget-emea.adnxs.com:443 - HIER_DIRECT/37.252.173.214 -
1658483767.548 1028965 172.19.15.2 TCP_TUNNEL/200 20796 CONNECT http://www.seznam.cz:443 - HIER_DIRECT/77.75.79.222 -
1658483767.548 959986 172.19.15.199 TCP_TUNNEL/200 7269 CONNECT fonts.googleapis.com:443 - HIER_DIRECT/142.251.36.106 -
1658483767.548 900027 172.19.14.73 TCP_TUNNEL/200 10544 CONNECT fastlane.rubiconproject.com:443 - HIER_DIRECT/69.173.144.141 -
1658483768.549 1625800 172.19.14.204 TCP_TUNNEL/200 3635 CONNECT epns.eset.com:443 - HIER_DIRECT/91.228.167.192 -
1658483768.549 903754 172.19.14.73 TCP_TUNNEL/200 5891 CONNECT region1.google-analytics.com:443 - HIER_DIRECT/216.239.34.36 -
1658483769.551 1017091 172.19.14.19 TCP_TUNNEL/200 4702 CONNECT secure-it.imrworldwide.com:443 - HIER_DIRECT/54.246.16.130 -
1658483769.551 976878 172.19.14.69 TCP_TUNNEL/200 1120200 CONNECT rr2---sn-jxnoxu-2gbl.googlevideo.com:443 - HIER_DIRECT/195.113.214.205 -
1658483769.551 1626332 172.19.15.189 TCP_TUNNEL/200 3635 CONNECT epns.eset.com:443 - HIER_DIRECT/91.228.167.192 -
1658483769.551 986881 172.19.14.69 TCP_TUNNEL/200 11983552 CONNECT rr5---sn-2gb7sn7r.googlevideo.com:443 - HIER_DIRECT/172.217.130.74 -

in access.log of C1 are the time numbers a lot lower:

1658491430.020      7 172.19.14.191 TCP_MISS/200 473 GET http://i5.c.eset.com/v1/auth/60064ADBC289880E8D77/updlist/31/eid/108/lid/108 - DIRECT/91.228.166.45 application/octet-stream
1658491430.025      6 172.19.15.72 TCP_MISS/200 473 GET http://i5.c.eset.com/v1/auth/60064ADBC289880E8D77/updlist/31/eid/108/lid/108 - DIRECT/91.228.166.45 application/octet-stream
1658491430.031      6 172.19.14.191 TCP_MISS/200 473 GET http://i5.c.eset.com/v1/auth/60064ADBC289880E8D77/updlist/32/eid/117876/lid/117876 - DIRECT/91.228.166.45 application/octet-stream
1658491430.038    430 172.19.14.71 TCP_MISS/200 4906 CONNECT v10.events.data.microsoft.com:443 - DIRECT/20.42.65.90 -
1658491430.076     40 172.19.14.191 TCP_MISS/200 473 GET http://i5.c.eset.com/v1/auth/60064ADBC289880E8D77/updlist/33/eid/10185/lid/10185 - DIRECT/91.228.166.45 application/octet-stream
1658491430.112     55 172.19.15.72 TCP_MISS/200 473 GET http://i5.c.eset.com/v1/auth/60064ADBC289880E8D77/updlist/32/eid/117876/lid/117876 - DIRECT/91.228.166.45 application/octet-stream
1658491430.155  30017 172.19.14.186 TCP_MISS/200 62553 CONNECT armmf.adobe.com:443 - DIRECT/2.23.8.158 -
1658491430.180     43 172.19.14.191 TCP_MISS/200 473 GET http://i5.c.eset.com/v1/auth/60064ADBC289880E8D77/updlist/34/eid/8576/lid/8576 - DIRECT/91.228.166.45 application/octet-stream
1658491430.227    235 172.19.15.144 TCP_MISS/200 3793 CONNECT ts.eset.com:443 - DIRECT/91.228.166.148 -
1658491430.276     73 172.19.15.72 TCP_MISS/200 473 GET http://i5.c.eset.com/v1/auth/60064ADBC289880E8D77/updlist/33/eid/10185/lid/10185 - DIRECT/91.228.166.45 application/octet-stream
1658491430.404     90 172.19.14.191 TCP_MISS/200 473 GET http://i5.c.eset.com/v1/auth/60064ADBC289880E8D77/updlist/35/eid/7351/lid/7351 - DIRECT/91.228.166.45 application/octet-stream


Now I am out of ideas what to test.

Thank you very much for your help,
Katerina





}

Tato e-mailov? zpr?va m? pouze informativn? charakter a vych?z? z podklad?, kter? byly odes?lateli p?ed?ny nebo zasl?ny v minulosti. Obsah t?to e-mailov? zpr?vy, resp. jak?koliv p??padn? pr?vn? jedn?n? vypl?vaj?c? z t?to e-mailov? zpr?vy, se nepova?uje za n?vrh na uzav?en? smlouvy ve smyslu ustanoven? ? 1731 z?kona ?. 89/2012 Sb., ob?ansk?ho z?kon?ku, v platn?m zn?n? (d?le jen ?ob?ansk? z?kon?k?) nebo akceptaci n?vrhu na uzav?en? smlouvy ve smyslu ? 1740 ob?ansk?ho z?kon?ku, pop?. potvrzen? uzav?en? smluvn?ho vztahu, nen?-li odes?latelem uvedeno v?slovn? jinak. Tato e-mailov? zpr?va je ur?ena pouze pro osobn? a d?v?rn? u?it? ur?en?mi adres?ty, tedy osobou (osobami), kter? (kter?m) je obsahov? ur?ena. Nejste-li osobou, kter? je tato zpr?va ur?ena, upozor?ujeme V?s, ?e jak?koliv ???en? ?i kop?rov?n? t?to e-mailov? zpr?vy, ?i informace z n?, je zak?z?no. Jestli?e tuto e-mailovou zpr?vu obdr??te nedopat?en?m, pros?me, oznamte tuto skute?nost odes?lateli a odstra?te zpr?vu samotnou i v?echny jej? p??lohy ze sv?ho syst?mu. 



From muhanad at plciq.com  Tue Jul 26 19:52:15 2022
From: muhanad at plciq.com (muhanad at plciq.com)
Date: Tue, 26 Jul 2022 22:52:15 +0300
Subject: [squid-users] adding cache_control = nocache to http request using
 squid transparent proxy
Message-ID: <005101d8a129$3892b760$a9b82620$@plciq.com>

Hello

 

I am trying to edit the header of http headers to set the cache_control
option to " no-cache" to prevent users from being able to cache the contents
even if they are using any type of caching engines. the squid proxy will
work in a transparent mode. The traffic is originated from one of our CDNs,
also the connection is direct between the clients and the CDN servers, thus
the proxy will work in transparent mode with IP spoofing so the in the
header the IP address is stays the IP address of the client and  not the
proxy server. Help is highly appreciated.

PS: We are an ISP company based in Iraq, Baghdad and we are trying to
prevent the clients from caching all HTTP data.

 

Regards

Muhanad Abdullah

 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220726/1aab1cdf/attachment.htm>

From squid3 at treenet.co.nz  Wed Jul 27 00:46:15 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 27 Jul 2022 12:46:15 +1200
Subject: [squid-users] adding cache_control = nocache to http request
 using squid transparent proxy
In-Reply-To: <005101d8a129$3892b760$a9b82620$@plciq.com>
References: <005101d8a129$3892b760$a9b82620$@plciq.com>
Message-ID: <111ee184-20d3-3275-cb73-96b41f920bd1@treenet.co.nz>

On 27/07/22 07:52, muhanad wrote:
> Hello
> 
> I am trying to edit the header of http headers to set the cache_control 
> option to " no-cache" to prevent users from being able to cache the 
> contents

This will not do what you think it does.

The "no-cache" control actually *enables* caching by recipients. It just 
requires a quick revalidation check before the cached content is used.


> even if they are using any type of caching engines. the squid 
> proxy will work in a transparent mode. The traffic is originated from 
> one of our CDNs,

This does not make sense. Just publish the Squid machine IP in DNS 
instead of the CDN server IP. No need for interception.


> also the connection is direct between the clients and 
> the CDN servers, thus the proxy will work in transparent mode with IP 
> spoofing so the in the header the IP address is stays the IP address of 
> the client and? not the proxy server.

This may not do what you think it does. When traffic is arriving *from* 
Internet the source-IP indicates which route to deliver the response 
packets. You do not want the origin server(s) bypassing Squid on the TCP 
SYNACK packets - that will break all traffic.


> PS: We are an ISP company based in Iraq, Baghdad and we are trying to 
> prevent the clients from caching all HTTP data.
> 

Why? This is typically a very bad idea.

All it does is:
  * lower the amount of bandwidth available to your clients
    - given them a bad service/experience.
  * increase the traffic delays across your network
    - even worse service/experience.
  * encourage other ISP to erase the cache limitations on traffic from 
your servers even on traffic where it is correct
    - even worse service/experience.


Even if you are charging clients for bandwidth used. You want to be able 
to service *more* clients as quickly as possible, not scare them away 
with a bad service.


HTH
Amos


From Katerina.Bubenickova at bohnice.cz  Wed Jul 27 07:22:19 2022
From: Katerina.Bubenickova at bohnice.cz (Katerina Bubenickova)
Date: Wed, 27 Jul 2022 09:22:19 +0200
Subject: [squid-users] slow TCP_TUNNEL [SOLVED]
In-Reply-To: <000001d8a127$85500500$8ff00f00$@gmail.com>
References: <62DA93FD0200005F0004E80C@gwia.plbohnice.cz>
 <62DE56F60200005F0004E844@gwia.plbohnice.cz>
 <000001d8a127$85500500$8ff00f00$@gmail.com>
Message-ID: <62E0E7AB0200005F0004E94A@gwia.plbohnice.cz>

Hey Eliezer,


Thank you. Now I am ashamed for I have sent unintentionally [solved]
answer only to Alex yesterday.


I tried wireshark, disabled client persistent connections.
but the problem was system run out of filedescriptors.
4096 was not enough . I didn't notice it in the cache.log before


So I put into 

/etc/security/limits.conf


line 

* - nofile 65535




and into squid.conf:

max_filedescriptors 65535


systemctl restart squid

Now it is working all right.

Thank you for your effort,
now see I have a lot to learn.

I have to figure out the difference between  forward and intercept
proxy,
what the pinger daemon is and what workers are.


Two proxies makes faster performance for us, 

On Debian 11 there is version Version 4.13
load balance is done by bind - two IPs have the name in A record

I will remove the  `dns_v4_first` 


Thank you all again for your support,


Katerina













>>> <ngtech1ltd at gmail.com> 07/26/22 9:40 PM >>>
Hey Katerina,

Let?s try to understand the issue first.
The CentOS 6 squid version is what exactly? (squid -v )
What do you require from this proxy to do else then squidguard?
>From what I understand it?s a simple forward proxy and not an intercept
proxy.
It means that all DNS resolution is done on the proxy.
What localhost DNS daemon are you using? (Bind? unbound? other?)
What version of Squid are you running on the Debian 11 machine (squid
-v)

The `dns_v4_first` configuration is obsolete.
The first thing to check is that if the pinger is up and running.
>From what I remember Debian didn?t liked the pinger daemon.
Are you using workers in your configuration?
If you can share your current squid version and squid.conf we might be
able to help you try to understand what?s going on.
The latest version of squid I have published for CentOS 6 was:
squid-3.5.28-1.el6.x86_64.rpm

For a simple forward proxy you won?t need too much hardware but if you
won?t be using workers this would be the expected behavior.
I believe that if you do not require special configurations we can
compare another simple forward proxy just to make sure that
the core of the issue is something with squid.
(it?s possible to find the issue without using a comparison if enough
details would be published)

How exactly is the proxy configured on the clients side?
Also is there any form of authentication happening or plain connections?
How do you load balance between the proxies?

>From my experience 700 clients are OK on a single proxy however?
only if the load is not too high in the network level.
It can be that the maximum limit of open file descriptors is reached or
couple other reasons.
Can you share couple pages of your cache manager output?
The next script:
https://gist.githubusercontent.com/elico/8790bdc835d8e9ecbc57e72fc31effc0/raw/60d140b0e772fa4f418779bfc27e4804a345ce23/dump-cache-mgr-to-file.sh

should dump all pages to stdout but don?t send the output on the public
list please.
I will try to analyze the pages and see if there is something specific I
can understand from them.
If the above output would not be sufficient I have another more in-depth
script that should help us
to understand what is the core issue with this VM.

I am waiting for more details so I would be able to try and help you.

Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: mailto:ngtech1ltd at gmail.com
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/

From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf
Of Katerina Bubenickova
Sent: Monday, 25 July 2022 11:40
To: squid-users at lists.squid-cache.org
Subject: [squid-users] slow TCP_TUNNEL

Hi,
We have 2 squid proxies running on Centos 6 which is very old (let's
call them C1, C2) in DMZ.

I have installed Debian 11 bullseye and squid +squidguard, trying to use
the same configuration (let's call it D1).
If I use this proxy for 1 pc station, all is ok.
If Iadded the proxy toI tryed to fix it without success:
I added directive url_rewrite_children 200
I changed DNS from 8.8.8.8 to localhost
I turned off squid cache
I commented out squidguard
I migrated from one vmware server to another, better,
I added memory (16 GB) and CPU (6) ,
I added directive dns_v4_first on
There are no rules in D1 firewall

We have about 700 pc and the problem starts after 15-20 minutes after I
add D1 into dns as proxy.
I can see it on our monitor Flowmon, where I can see value NPM response
time. In normal state it is about 0.1s, when the problem arises it is up
to 3s.
If I remove D1 from dns, all is ok after a while.

I  tried to set IP of D1 the same as IP of C2 (of course C2 was power
off) to test, whether the problem could be caused by some firewall
between user pc and proxy, it doesn.t help


access.log of D1
1658483765.546 1622444 172.19.11.101 TCP_TUNNEL/200 3635 CONNECT
epns.eset.com:443 - HIER_DIRECT/91.228.167.192 -
1658483765.546 900188 172.19.14.73 TCP_TUNNEL/200 4738 CONNECT
prg.smartadserver.com:443 - HIER_DIRECT/185.86.138.16 -
1658483765.546 900246 172.19.14.73 TCP_TUNNEL/200 4102 CONNECT
bidder.criteo.com:443 - HIER_DIRECT/178.250.0.165 -
1658483765.546 1008081 172.19.13.171 TCP_TUNNEL/200 12749428 CONNECT
rr1---sn-jxnoxu-2gbl.googlevideo.com:443 - HIER_DIRECT/195.113.214.204 -
1658483765.546 901791 172.19.14.95 TCP_TUNNEL/200 2176 CONNECT
pcb.kb.cz:443 - HIER_DIRECT/194.50.226.158 -
1658483765.546 900569 172.19.14.73 TCP_TUNNEL/200 7260 CONNECT
adx.adform.net:443 - HIER_DIRECT/37.157.2.237 -
1658483766.547 935767 172.19.13.190 TCP_TUNNEL/200 110961 CONNECT
http://www.seznam.cz:443 - HIER_DIRECT/77.75.77.222 -
1658483766.547 1620846 172.19.15.40 TCP_TUNNEL/200 3520 CONNECT
epns.eset.com:443 - HIER_DIRECT/91.228.167.192 -
1658483766.547 900183 172.19.14.73 TCP_TUNNEL/200 4296 CONNECT
etarget-emea.adnxs.com:443 - HIER_DIRECT/37.252.173.214 -
1658483767.548 1028965 172.19.15.2 TCP_TUNNEL/200 20796 CONNECT
http://www.seznam.cz:443 - HIER_DIRECT/77.75.79.222 -
1658483767.548 959986 172.19.15.199 TCP_TUNNEL/200 7269 CONNECT
fonts.googleapis.com:443 - HIER_DIRECT/142.251.36.106 -
1658483767.548 900027 172.19.14.73 TCP_TUNNEL/200 10544 CONNECT
fastlane.rubiconproject.com:443 - HIER_DIRECT/69.173.144.141 -
1658483768.549 1625800 172.19.14.204 TCP_TUNNEL/200 3635 CONNECT
epns.eset.com:443 - HIER_DIRECT/91.228.167.192 -
1658483768.549 903754 172.19.14.73 TCP_TUNNEL/200 5891 CONNECT
region1.google-analytics.com:443 - HIER_DIRECT/216.239.34.36 -
1658483769.551 1017091 172.19.14.19 TCP_TUNNEL/200 4702 CONNECT
secure-it.imrworldwide.com:443 - HIER_DIRECT/54.246.16.130 -
1658483769.551 976878 172.19.14.69 TCP_TUNNEL/200 1120200 CONNECT
rr2---sn-jxnoxu-2gbl.googlevideo.com:443 - HIER_DIRECT/195.113.214.205 -
1658483769.551 1626332 172.19.15.189 TCP_TUNNEL/200 3635 CONNECT
epns.eset.com:443 - HIER_DIRECT/91.228.167.192 -
1658483769.551 986881 172.19.14.69 TCP_TUNNEL/200 11983552 CONNECT
rr5---sn-2gb7sn7r.googlevideo.com:443 - HIER_DIRECT/172.217.130.74 -

in access.log of C1 are the time numbers a lot lower:

1658491430.020      7 172.19.14.191 TCP_MISS/200 473 GET
http://i5.c.eset.com/v1/auth/60064ADBC289880E8D77/updlist/31/eid/108/lid/108
- DIRECT/91.228.166.45 application/octet-stream
1658491430.025      6 172.19.15.72 TCP_MISS/200 473 GET
http://i5.c.eset.com/v1/auth/60064ADBC289880E8D77/updlist/31/eid/108/lid/108
- DIRECT/91.228.166.45 application/octet-stream
1658491430.031      6 172.19.14.191 TCP_MISS/200 473 GET
http://i5.c.eset.com/v1/auth/60064ADBC289880E8D77/updlist/32/eid/117876/lid/117876
- DIRECT/91.228.166.45 application/octet-stream
1658491430.038    430 172.19.14.71 TCP_MISS/200 4906 CONNECT
v10.events.data.microsoft.com:443 - DIRECT/20.42.65.90 -
1658491430.076     40 172.19.14.191 TCP_MISS/200 473 GET
http://i5.c.eset.com/v1/auth/60064ADBC289880E8D77/updlist/33/eid/10185/lid/10185
- DIRECT/91.228.166.45 application/octet-stream
1658491430.112     55 172.19.15.72 TCP_MISS/200 473 GET
http://i5.c.eset.com/v1/auth/60064ADB- DIRECT/91.228.166.45 application/octet-stream
1658491430.155  30017 172.19.14.186 TCP_MISS/200 62553 CONNECT
armmf.adobe.com:443 - DIRECT/2.23.8.158 -
1658491430.180     43 172.19.14.191 TCP_MISS/200 473 GET
http://i5.c.eset.com/v1/auth/60064ADBC289880E8D77/updlist/34/eid/8576/lid/8576
- DIRECT/91.228.166.45 application/octet-stream
Tato e-mailov? zpr?va m? pouze informativn? charakter a vych?z? z 
podklad?, kter? byly odes?lateli p?ed?ny nebo zasl?ny v minulosti. Obsah
 t?to e-mailov? zpr?vy, resp. jak?koliv p??padn? pr?vn? jedn?n? 
vypl?vaj?c? z t?to e-mailov? zpr?vy, se nepova?uje za n?vrh na uzav?en? 
smlouvy ve smyslu ustanoven? ? 1731 z?kona ?. 89/2012 Sb., ob?ansk?ho 
z?kon?ku, v platn?m zn?n? (d?le jen ?ob?ansk? z?kon?k?) nebo akceptaci 
n?vrhu na uzav?en? smlouvy ve smyslu ? 1740 ob?ansk?ho z?kon?ku, pop?. 
potvrzen? uzav?en? smluvn?ho vztahu, nen?-li odes?latelem uvedeno 
v?slovn? jinak. Tato e-mailov? zpr?va je ur?ena pouze pro osobn? a 
d?v?rn? u?it? ur?en?mi adres?ty, tedy osobou (osobami), kter? (kter?m) 
je obsahov? ur?ena. Nejste-li osobou, kter? je tato zpr?va ur?ena, 
upozor?ujeme V?s, ?e jak?koliv ???en? ?i kop?rov?n? t?to e-mailov? 
zpr?vy, ?i informace z n?, je zak?z?no. Jestli?e tuto e-mailovou zpr?vu 
obdr??te nedopat?en?m, pros?me, oznamte tuto skute?nost odes?lateli a 
odstra?te zpr?vu samotnou i v?echny jej? p??lohy ze sv?ho syst?mu. 

1658491430.227    235 172.19.15.144 TCP_MISS/200 3793 CONNECT
ts.eset.com:443 - DIRECT/91.228.166.148 -
1658491430.276     73 172.19.15.72 TCP_MISS/200 473 GET
http://i5.c.eset.com/v1/auth/60064ADBC289880E8D77/updlist/33/eid/10185/lid/10185
- DIRECT/91.228.166.45 application/octet-stream
1658491430.404     90 172.19.14.191 TCP_MISS/200 473 GET
http://i5.c.eset.com/v1/auth/60064ADBC289880E8D77/updlist/35/eid/7351/lid/7351
- DIRECT/91.228.166.45 application/octet-stream


Now I am out of ideas what to test.

Thank you very much for your help,
Katerina





}



Tato e-mailov? zpr?va m? pouze informativn? charakter a vych?z? z
podklad?, kter? byly odes?lateli p?ed?ny nebo zasl?ny v minulosti. Obsah
t?to e-mailov? zpr?vy, resp. jak?koliv p??padn? pr?vn? jedn?n?
vypl?vaj?c? z t?to e-mailov? zpr?vy, se nepova?uje za n?vrh na
uzav?en? smlouvy ve smyslu ustanoven? ? 1731 z?kona ?. 89/2012 Sb.,
ob?ansk?ho z?kon?ku, v platn?m zn?n? (d?le jen ?ob?ansk? z?kon?k?)
nebo akceptaci n?vrhu na uzav?en? smlouvy ve smyslu ? 1740 ob?ansk?ho
z?kon?ku, pop?. potvrzen? uzav?en? smluvn?ho vztahu, nen?-li
odes?latelem uvedeno v?slovn? jinak. Tato e-mailov? zpr?va je ur?ena
pouze pro osobn? a d?v?rn? u?it? ur?en?mi adres?ty, tedy osobou
(osobami), kter? (kter?m) je obsahov? ur?ena. Nejste-li osobou, kter? je
tato zpr?va ur?ena, upozor?ujeme V?s, ?e jak?koliv ???en? ?i kop?rov?n?
t?to e-mailov? zpr?vy, ?i informace z n?, je zak?z?no. Jestli?e tuto
e-mailovou zpr?vu obdr??te nedopat?en?m, pros?me, oznamte tuto
skute?nost odes?lateli a odstra?te zpr?vu samotnou i v?echny jej?
p??lohy ze sv?ho syst?mu.


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220727/b10ebe84/attachment.htm>

From ilja.dejs at gmail.com  Wed Jul 27 08:03:26 2022
From: ilja.dejs at gmail.com (=?UTF-8?B?0JjQu9GM0Y8g0JTQtdC50YE=?=)
Date: Wed, 27 Jul 2022 11:03:26 +0300
Subject: [squid-users] Routing
Message-ID: <CAAV2eMoE70cGBD=VU8rvckNrrkwQo=BXxUrVMm5fLd=ha=3_Ug@mail.gmail.com>

Hello,
I ran into a problem when routing connections from a specific address.
I need to use a dedicated channel for downloading video, and for
everything else, a port-dependent channel. Routing is based on the
receiving port of the proxy server. I am using ssl_bum

Config example:

http_port 3128 tcpkeepalive=60,30,3 ssl-bump
generate-host-certificates=on dynamic_cert_mem_cache_size=20MB
tls-cert=/etc/squid/bump.crt tls-key=/etc/squid/bump.key
cipher=HIGH:MEDIUM:!LOW:!RC4:!SEED:!IDEA:!3DES:!MD5:!EXP:!PSK:!DSS
options=NO_TLSv1,NO_SSLv3,SINGLE_DH_US
E,SINGLE_ECDH_USE tls-dh=prime256v1:/etc/squid/bump_dhparam.pem
http_port 3129 tcpkeepalive=60,30,3 ssl-bump
generate-host-certificates=on dynamic_cert_mem_cache_size=20MB
tls-cert=/etc/squid/bump.crt tls-key=/etc/squid/bump.key
cipher=HIGH:MEDIUM:!LOW:!RC4:!SEED:!IDEA:!3DES:!MD5:!EXP:!PSK:!DSS
options=NO_TLSv1,NO_SSLv3,SINGLE_DH_US
E,SINGLE_ECDH_USE tls-dh=prime256v1:/etc/squid/bump_dhparam.pem
http_port 3130 tcpkeepalive=60,30,3 ssl-bump
generate-host-certificates=on dynamic_cert_mem_cache_size=20MB
tls-cert=/etc/squid/bump.crt tls-key=/etc/squid/bump.key
cipher=HIGH:MEDIUM:!LOW:!RC4:!SEED:!IDEA:!3DES:!MD5:!EXP:!PSK:!DSS
options=NO_TLSv1,NO_SSLv3,SINGLE_DH_US
E,SINGLE_ECDH_USE tls-dh=prime256v1:/etc/squid/bump_dhparam.pem
http_port 3131 tcpkeepalive=60,30,3 ssl-bump
generate-host-certificates=on dynamic_cert_mem_cache_size=20MB
tls-cert=/etc/squid/bump.crt tls-key=/etc/squid/bump.key
cipher=HIGH:MEDIUM:!LOW:!RC4:!SEED:!IDEA:!3DES:!MD5:!EXP:!PSK:!DSS
options=NO_TLSv1,NO_SSLv3,SINGLE_DH_US
E,SINGLE_ECDH_USE tls-dh=prime256v1:/etc/squid/bump_dhparam.pem
http_port 3132 tcpkeepalive=60,30,3 ssl-bump
generate-host-certificates=on dynamic_cert_mem_cache_size=20MB
tls-cert=/etc/squid/bump.crt tls-key=/etc/squid/bump.key
cipher=HIGH:MEDIUM:!LOW:!RC4:!SEED:!IDEA:!3DES:!MD5:!EXP:!PSK:!DSS
options=NO_TLSv1,NO_SSLv3,SINGLE_DH_US
E,SINGLE_ECDH_USE tls-dh=prime256v1:/etc/squid/bump_dhparam.pem
http_port 3133 tcpkeepalive=60,30,3 ssl-bump
generate-host-certificates=on dynamic_cert_mem_cache_size=20MB
tls-cert=/etc/squid/bump.crt tls-key=/etc/squid/bump.key
cipher=HIGH:MEDIUM:!LOW:!RC4:!SEED:!IDEA:!3DES:!MD5:!EXP:!PSK:!DSS
options=NO_TLSv1,NO_SSLv3,SINGLE_DH_US
E,SINGLE_ECDH_USE tls-dh=prime256v1:/etc/squid/bump_dhparam.pem
http_port 3134 tcpkeepalive=60,30,3 ssl-bump
generate-host-certificates=on dynamic_cert_mem_cache_size=20MB
tls-cert=/etc/squid/bump.crt tls-key=/etc/squid/bump.key
cipher=HIGH:MEDIUM:!LOW:!RC4:!SEED:!IDEA:!3DES:!MD5:!EXP:!PSK:!DSS
options=NO_TLSv1,NO_SSLv3,SINGLE_DH_US
E,SINGLE_ECDH_USE tls-dh=prime256v1:/etc/squid/bump_dhparam.pem
http_port 3135 tcpkeepalive=60,30,3 ssl-bump
generate-host-certificates=on dynamic_cert_mem_cache_size=20MB
tls-cert=/etc/squid/bump.crt tls-key=/etc/squid/bump.key
cipher=HIGH:MEDIUM:!LOW:!RC4:!SEED:!IDEA:!3DES:!MD5:!EXP:!PSK:!DSS
options=NO_TLSv1,NO_SSLv3,SINGLE_DH_US
E,SINGLE_ECDH_USE tls-dh=prime256v1:/etc/squid/bump_dhparam.pem
http_port 3136 tcpkeepalive=60,30,3 ssl-bump
generate-host-certificates=on dynamic_cert_mem_cache_size=20MB
tls-cert=/etc/squid/bump.crt tls-key=/etc/squid/bump.key
cipher=HIGH:MEDIUM:!LOW:!RC4:!SEED:!IDEA:!3DES:!MD5:!EXP:!PSK:!DSS
options=NO_TLSv1,NO_SSLv3,SINGLE_DH_US
E,SINGLE_ECDH_USE tls-dh=prime256v1:/etc/squid/bump_dhparam.pem
http_port 3137 tcpkeepalive=60,30,3 ssl-bump
generate-host-certificates=on dynamic_cert_mem_cache_size=20MB
tls-cert=/etc/squid/bump.crt tls-key=/etc/squid/bump.key
cipher=HIGH:MEDIUM:!LOW:!RC4:!SEED:!IDEA:!3DES:!MD5:!EXP:!PSK:!DSS
options=NO_TLSv1,NO_SSLv3,SINGLE_DH_US
E,SINGLE_ECDH_USE tls-dh=prime256v1:/etc/squid/bump_dhparam.pem

acl media_files urlpath_regex -i
\.(3g2|3gp|3gpp|asf|asx|ashx|avi|bin|dat|f4v|flv|gtp|h264|m4v|mkv|mod|moov|mov|mp4|mpeg|mpg|mts|rm|rmvb|spl|srt|stl|swf|ts|vcd|vid|vob|webm|wm|wmv|yuv)
tcp_outgoing_address 10.3.0.2 media_files

acl port3128 localport 3128
acl port3129 localport 3129
acl port3130 localport 3130
acl port3131 localport 3131
acl port3132 localport 3132
acl port3133 localport 3133
acl port3134 localport 3134
acl port3135 localport 3135
acl port3136 localport 3136
acl port3137 localport 3137

tcp_outgoing_address 10.3.2.190 !media_files port3128
tcp_outgoing_address 10.3.2.191 !media_files port3129
tcp_outgoing_address 10.3.2.192 !media_files port3130
tcp_outgoing_address 10.3.2.193 !media_files port3131
tcp_outgoing_address 10.3.2.194 !media_files port3132
tcp_outgoing_address 10.3.2.195 !media_files port3133
tcp_outgoing_address 10.3.2.196 !media_files port3134
tcp_outgoing_address 10.3.2.197 !media_files port3135
tcp_outgoing_address 10.3.2.198 !media_files port3136
tcp_outgoing_address 10.3.2.199 !media_files port3137

When using HTTP (not SSL), this rules work fine, but with using HTTPS
protocol first (with debug) used rule for CONNECT, and after rules
with tcp_outgoing_address not applied.
I commented this line and rebuild squid, but no more effect

// skip if an outgoing address is already set.
// if (!conn->local.isAnyAddr()) return;

please help me


From robertkwild at gmail.com  Wed Jul 27 09:54:52 2022
From: robertkwild at gmail.com (robert k Wild)
Date: Wed, 27 Jul 2022 10:54:52 +0100
Subject: [squid-users] regex for normal websites
Message-ID: <CAGU_CiJimq7-co9QCVT1+-NF8Y_V4pECVRiow_eOhh=rfXHK6g@mail.gmail.com>

hi all,

think i got it right but just want to double check with you guys

so in my "ssl::server_name" i had
.adobe.com

that worked but i want to mix normal website and regex websites together so
i just have one list for all

i now have this for "ssl::server_name_regex"
^.*adobe.com$

it works, so im guessing its right

thanks,
rob

-- 
Regards,

Robert K Wild.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220727/f63956f7/attachment.htm>

From uhlar at fantomas.sk  Wed Jul 27 10:05:45 2022
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Wed, 27 Jul 2022 12:05:45 +0200
Subject: [squid-users] regex for normal websites
In-Reply-To: <CAGU_CiJimq7-co9QCVT1+-NF8Y_V4pECVRiow_eOhh=rfXHK6g@mail.gmail.com>
References: <CAGU_CiJimq7-co9QCVT1+-NF8Y_V4pECVRiow_eOhh=rfXHK6g@mail.gmail.com>
Message-ID: <YuEN+aHq7/a1DVVh@fantomas.sk>

On 27.07.22 10:54, robert k Wild wrote:
>think i got it right but just want to double check with you guys
>
>so in my "ssl::server_name" i had
>.adobe.com
>
>that worked but i want to mix normal website and regex websites together so
>i just have one list for all

didn't the above work?  AFAIK it should, IIRC domain matching in squid 
matches "domain.com" if you check for ".domain.com".

>i now have this for "ssl::server_name_regex"
>^.*adobe.com$
>
>it works, so im guessing its right

the dot should be escaped


-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
BSE = Mad Cow Desease ... BSA = Mad Software Producents Desease


From robertkwild at gmail.com  Wed Jul 27 10:51:47 2022
From: robertkwild at gmail.com (robert k Wild)
Date: Wed, 27 Jul 2022 11:51:47 +0100
Subject: [squid-users] regex for normal websites
In-Reply-To: <YuEN+aHq7/a1DVVh@fantomas.sk>
References: <CAGU_CiJimq7-co9QCVT1+-NF8Y_V4pECVRiow_eOhh=rfXHK6g@mail.gmail.com>
 <YuEN+aHq7/a1DVVh@fantomas.sk>
Message-ID: <CAGU_CiJb9rfGdwLVoR0n8VE+vuJFtQwGu3v2HvGBW3i+uBQbGA@mail.gmail.com>

that's the weird thing, when i try this in  "ssl::server_name_regex"
.adobe.com

it doesnt work

you mean escape ie the \ character





On Wed, 27 Jul 2022 at 11:05, Matus UHLAR - fantomas <uhlar at fantomas.sk>
wrote:

> On 27.07.22 10:54, robert k Wild wrote:
> >think i got it right but just want to double check with you guys
> >
> >so in my "ssl::server_name" i had
> >.adobe.com
> >
> >that worked but i want to mix normal website and regex websites together
> so
> >i just have one list for all
>
> didn't the above work?  AFAIK it should, IIRC domain matching in squid
> matches "domain.com" if you check for ".domain.com".
>
> >i now have this for "ssl::server_name_regex"
> >^.*adobe.com$
> >
> >it works, so im guessing its right
>
> the dot should be escaped
>
>
> --
> Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
> Warning: I wish NOT to receive e-mail advertising to this address.
> Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
> BSE = Mad Cow Desease ... BSA = Mad Software Producents Desease
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>


-- 
Regards,

Robert K Wild.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220727/f82e19b3/attachment.htm>

From squid3 at treenet.co.nz  Wed Jul 27 11:19:38 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 27 Jul 2022 23:19:38 +1200
Subject: [squid-users] regex for normal websites
In-Reply-To: <CAGU_CiJimq7-co9QCVT1+-NF8Y_V4pECVRiow_eOhh=rfXHK6g@mail.gmail.com>
References: <CAGU_CiJimq7-co9QCVT1+-NF8Y_V4pECVRiow_eOhh=rfXHK6g@mail.gmail.com>
Message-ID: <9f0e5df5-771b-368b-4746-32bd4950a07b@treenet.co.nz>

On 27/07/22 21:54, robert k Wild wrote:
> hi all,
> 
> think i got it right but just want to double check with you guys
> 
> so in my "ssl::server_name" i had
> .adobe.com
> 
> that worked but i want to mix normal website and regex websites together 

What do you mean "normal website" ? and "regex websites" ?


> so i just have one list for all
> 
> i now have this for "ssl::server_name_regex"
> ^.*adobe.com$
> 
> it works, so im guessing its right
> 

Many things "work" in regex when they are not right.

As Matus said the dot in the domain needs to be escaped:

   ^.*adobe\.com$


Also, the "^.*" in your pattern does nothing useful, it should be omitted.

Leaving you with the pattern:

    adobe\.com$


HTH
Amos


From squid3 at treenet.co.nz  Wed Jul 27 11:26:30 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 27 Jul 2022 23:26:30 +1200
Subject: [squid-users] Routing
In-Reply-To: <CAAV2eMoE70cGBD=VU8rvckNrrkwQo=BXxUrVMm5fLd=ha=3_Ug@mail.gmail.com>
References: <CAAV2eMoE70cGBD=VU8rvckNrrkwQo=BXxUrVMm5fLd=ha=3_Ug@mail.gmail.com>
Message-ID: <3602b31d-73b4-addd-515c-d0e168b392dd@treenet.co.nz>

On 27/07/22 20:03, ???? ???? wrote:
> Hello,
> I ran into a problem when routing connections from a specific address.
> I need to use a dedicated channel for downloading video, and for
> everything else, a port-dependent channel. Routing is based on the
> receiving port of the proxy server. I am using ssl_bum
> 

> 
> When using HTTP (not SSL), this rules work fine, but with using HTTPS
> protocol first (with debug) used rule for CONNECT, and after rules
> with tcp_outgoing_address not applied.

> 
> please help me

What you want is not possible. With TLS decryption (bump'ing) the server 
connection is setup and being actively used long before any HTTP(S) 
message is received to get the URL path from. You cannot change the 
outgoing IP on an already existing connection.


Cheers
Amos


From gtaylor at tnetconsulting.net  Wed Jul 27 16:44:21 2022
From: gtaylor at tnetconsulting.net (Grant Taylor)
Date: Wed, 27 Jul 2022 10:44:21 -0600
Subject: [squid-users] regex for normal websites
In-Reply-To: <9f0e5df5-771b-368b-4746-32bd4950a07b@treenet.co.nz>
References: <CAGU_CiJimq7-co9QCVT1+-NF8Y_V4pECVRiow_eOhh=rfXHK6g@mail.gmail.com>
 <9f0e5df5-771b-368b-4746-32bd4950a07b@treenet.co.nz>
Message-ID: <60d1307c-e4e4-3af4-bcfa-90a792edbe7c@spamtrap.tnetconsulting.net>

On 7/27/22 5:19 AM, Amos Jeffries wrote:
> Also, the "^.*" in your pattern does nothing useful, it should be omitted. 

Is the bounding to the beginning /implicit/?  Or will adobe.com also 
match hackadobe.com?

> Leaving you with the pattern:
> 
>  ?? adobe\.com$

My understanding is that Robert is thinking about the difference between:

  - adobe.com
  - www.adobe.com



-- 
Grant. . . .
unix || die

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4017 bytes
Desc: S/MIME Cryptographic Signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220727/e33390be/attachment.bin>

From robertkwild at gmail.com  Wed Jul 27 17:25:46 2022
From: robertkwild at gmail.com (robert k Wild)
Date: Wed, 27 Jul 2022 18:25:46 +0100
Subject: [squid-users] regex for normal websites
In-Reply-To: <9f0e5df5-771b-368b-4746-32bd4950a07b@treenet.co.nz>
References: <CAGU_CiJimq7-co9QCVT1+-NF8Y_V4pECVRiow_eOhh=rfXHK6g@mail.gmail.com>
 <9f0e5df5-771b-368b-4746-32bd4950a07b@treenet.co.nz>
Message-ID: <CAGU_CiLmvL5QVYS7ijgjVZPPUh6RaxiyNk5kpmHz81=ZCU7fdA@mail.gmail.com>

nice one thanks Amos

i dont understand as in regex the terms

^ - start of line
. - any single character
* - repetition of character before
$ - end of line

 so going by this it should be

^.*adobe.com$

how come just

adobe.com$

as it doesnt know before adobe ie http(s)://www

sorry for the stupid question

On Wed, 27 Jul 2022 at 12:28, Amos Jeffries <squid3 at treenet.co.nz> wrote:

> On 27/07/22 21:54, robert k Wild wrote:
> > hi all,
> >
> > think i got it right but just want to double check with you guys
> >
> > so in my "ssl::server_name" i had
> > .adobe.com
> >
> > that worked but i want to mix normal website and regex websites together
>
> What do you mean "normal website" ? and "regex websites" ?
>
>
> > so i just have one list for all
> >
> > i now have this for "ssl::server_name_regex"
> > ^.*adobe.com$
> >
> > it works, so im guessing its right
> >
>
> Many things "work" in regex when they are not right.
>
> As Matus said the dot in the domain needs to be escaped:
>
>    ^.*adobe\.com$
>
>
> Also, the "^.*" in your pattern does nothing useful, it should be omitted.
>
> Leaving you with the pattern:
>
>     adobe\.com$
>
>
> HTH
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>


-- 
Regards,

Robert K Wild.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220727/63123d78/attachment.htm>

From Antony.Stone at squid.open.source.it  Wed Jul 27 17:59:09 2022
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Wed, 27 Jul 2022 19:59:09 +0200
Subject: [squid-users] regex for normal websites
In-Reply-To: <CAGU_CiLmvL5QVYS7ijgjVZPPUh6RaxiyNk5kpmHz81=ZCU7fdA@mail.gmail.com>
References: <CAGU_CiJimq7-co9QCVT1+-NF8Y_V4pECVRiow_eOhh=rfXHK6g@mail.gmail.com>
 <9f0e5df5-771b-368b-4746-32bd4950a07b@treenet.co.nz>
 <CAGU_CiLmvL5QVYS7ijgjVZPPUh6RaxiyNk5kpmHz81=ZCU7fdA@mail.gmail.com>
Message-ID: <202207271959.09311.Antony.Stone@squid.open.source.it>

On Wednesday 27 July 2022 at 19:25:46, robert k Wild wrote:

> nice one thanks Amos
> 
> i dont understand as in regex the terms
> 
> ^ - start of line
> . - any single character
> * - repetition of character before

Correction: zero or more instances of the character before

> $ - end of line
> 
>  so going by this it should be
> 
> ^.*adobe.com$

Well, that means "start of line, something or nothing, then 'adobe.com' and 
end of line".

So, it basically just means, "adobe,com at the end of the line"


Thus, the same as "adobe.com$"


Antony.

-- 
This space intentionally has nothing but text explaining why this space has 
nothing but text explaining that this space would otherwise have been left 
blank, and would otherwise have been left blank.

                                                   Please reply to the list;
                                                         please *don't* CC me.


From robertkwild at gmail.com  Wed Jul 27 18:02:37 2022
From: robertkwild at gmail.com (robert k Wild)
Date: Wed, 27 Jul 2022 19:02:37 +0100
Subject: [squid-users] regex for normal websites
In-Reply-To: <202207271959.09311.Antony.Stone@squid.open.source.it>
References: <CAGU_CiJimq7-co9QCVT1+-NF8Y_V4pECVRiow_eOhh=rfXHK6g@mail.gmail.com>
 <9f0e5df5-771b-368b-4746-32bd4950a07b@treenet.co.nz>
 <CAGU_CiLmvL5QVYS7ijgjVZPPUh6RaxiyNk5kpmHz81=ZCU7fdA@mail.gmail.com>
 <202207271959.09311.Antony.Stone@squid.open.source.it>
Message-ID: <CAGU_CiLxAbs1JcGwUSR3q9_Omxw+3TVykCWm_tjGv=xwzYs5uQ@mail.gmail.com>

Makes sense thanks Antony

On Wed, 27 Jul 2022, 18:59 Antony Stone, <Antony.Stone at squid.open.source.it>
wrote:

> On Wednesday 27 July 2022 at 19:25:46, robert k Wild wrote:
>
> > nice one thanks Amos
> >
> > i dont understand as in regex the terms
> >
> > ^ - start of line
> > . - any single character
> > * - repetition of character before
>
> Correction: zero or more instances of the character before
>
> > $ - end of line
> >
> >  so going by this it should be
> >
> > ^.*adobe.com$
>
> Well, that means "start of line, something or nothing, then 'adobe.com'
> and
> end of line".
>
> So, it basically just means, "adobe,com at the end of the line"
>
>
> Thus, the same as "adobe.com$"
>
>
> Antony.
>
> --
> This space intentionally has nothing but text explaining why this space
> has
> nothing but text explaining that this space would otherwise have been left
> blank, and would otherwise have been left blank.
>
>                                                    Please reply to the
> list;
>                                                          please *don't* CC
> me.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220727/399986c8/attachment.htm>

From ngtech1ltd at gmail.com  Thu Jul 28 05:20:11 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Thu, 28 Jul 2022 08:20:11 +0300
Subject: [squid-users] slow TCP_TUNNEL [SOLVED]
In-Reply-To: <62E0E7AB0200005F0004E94A@gwia.plbohnice.cz>
References: <62DA93FD0200005F0004E80C@gwia.plbohnice.cz>
 <62DE56F60200005F0004E844@gwia.plbohnice.cz>
 <000001d8a127$85500500$8ff00f00$@gmail.com>
 <62E0E7AB0200005F0004E94A@gwia.plbohnice.cz>
Message-ID: <006f01d8a241$b68800d0$23980270$@gmail.com>

Great!
 
I?m happy you were able to resolve the issue easily.
 
All The Bests,
Eliezer
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email:  <mailto:ngtech1ltd at gmail.com> ngtech1ltd at gmail.com
Web:  <https://ngtech.co.il/> https://ngtech.co.il/
My-Tube:  <https://tube.ngtech.co.il/> https://tube.ngtech.co.il/
 
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Katerina Bubenickova
Sent: Wednesday, 27 July 2022 10:22
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] slow TCP_TUNNEL [SOLVED]
 
Hey Eliezer,
 
Thank you. Now I am ashamed for I have sent unintentionally [solved] answer only to Alex yesterday.
 
I tried wireshark, disabled client persistent connections.
but the problem was system run out of filedescriptors.
4096 was not enough . I didn't notice it in the cache.log before
 
So I put into 
/etc/security/limits.conf
 
line 
* - nofile 65535
 
 
and into squid.conf:
max_filedescriptors 65535
 
systemctl restart squid
Now it is working all right.
 
Thank you for your effort,
now see I have a lot to learn.
I have to figure out the difference between  forward and intercept proxy,
what the pinger daemon is and what workers are.
 
Two proxies makes faster performance for us, 
On Debian 11 there is version Version 4.13
load balance is done by bind - two IPs have the name in A record
 
I will remove the `dns_v4_first` 
Thank you all again for your support,
 
 
Katerina
 
 
 
 
 
 
>>> <ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> > 07/26/22 9:40 PM >>>
Hey Katerina,

Let?s try to understand the issue first.
The CentOS 6 squid version is what exactly? (squid -v )
What do you require from this proxy to do else then squidguard?
>From what I understand it?s a simple forward proxy and not an intercept proxy.
It means that all DNS resolution is done on the proxy.
What localhost DNS daemon are you using? (Bind? unbound? other?)
What version of Squid are you running on the Debian 11 machine (squid -v)

The `dns_v4_first` configuration is obsolete.
The first thing to check is that if the pinger is up and running.
>From what I remember Debian didn?t liked the pinger daemon.
Are you using workers in your configuration?
If you can share your current squid version and squid.conf we might be able to help you try to understand what?s going on.
The latest version of squid I have published for CentOS 6 was: squid-3.5.28-1.el6.x86_64.rpm

For a simple forward proxy you won?t need too much hardware but if you won?t be using workers this would be the expected behavior.
I believe that if you do not require special configurations we can compare another simple forward proxy just to make sure that
the core of the issue is something with squid.
(it?s possible to find the issue without using a comparison if enough details would be published)

How exactly is the proxy configured on the clients side?
Also is there any form of authentication happening or plain connections?
How do you load balance between the proxies?

>From my experience 700 clients are OK on a single proxy however?
only if the load is not too high in the network level.
It can be that the maximum limit of open file descriptors is reached or couple other reasons.
Can you share couple pages of your cache manager output?
The next script:
https://gist.githubusercontent.com/elico/8790bdc835d8e9ecbc57e72fc31effc0/raw/60d140b0e772fa4f418779bfc27e4804a345ce23/dump-cache-mgr-to-file.sh

should dump all pages to stdout but don?t send the output on the public list please.
I will try to analyze the pages and see if there is something specific I can understand from them.
If the above output would not be sufficient I have another more in-depth script that should help us
to understand what is the core issue with this VM.

I am waiting for more details so I would be able to try and help you.

Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: mailto:ngtech1ltd at gmail.com
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/

From: squid-users <squid-users-bounces at lists.squid-cache.org <mailto:squid-users-bounces at lists.squid-cache.org> > On Behalf Of Katerina Bubenickova
Sent: Monday, 25 July 2022 11:40
To: squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> 
Subject: [squid-users] slow TCP_TUNNEL

Hi,
We have 2 squid proxies running on Centos 6 which is very old (let's call them C1, C2) in DMZ.

I have installed Debian 11 bullseye and squid +squidguard, trying to use the same configuration (let's call it D1).
If I use this proxy for 1 pc station, all is ok.
If Iadded the proxy to dns as third proxy (C1+C2 + D1) or use one old proxy and the new one (C1+D1) the response of internet was very slow, unusable.

I tryed to fix it without success:
I added directive url_rewrite_children 200
I changed DNS from 8.8.8.8 to localhost
I turned off squid cache
I commented out squidguard
I migrated from one vmware server to another, better,
I added memory (16 GB) and CPU (6) ,
I added directive dns_v4_first on
There are no rules in D1 firewall

We have about 700 pc and the problem starts after 15-20 minutes after I add D1 into dns as proxy.
I can see it on our monitor Flowmon, where I can see value NPM response time. In normal state it is about 0.1s, when the problem arises it is up to 3s.
If I remove D1 from dns, all is ok after a while.

I tried to set IP of D1 the same as IP of C2 (of course C2 was power off) to test, whether the problem could be caused by some firewall between user pc and proxy, it doesn.t help


access.log of D1
1658483765.546 1622444 172.19.11.101 TCP_TUNNEL/200 3635 CONNECT epns.eset.com:443 - HIER_DIRECT/91.228.167.192 -
1658483765.546 900188 172.19.14.73 TCP_TUNNEL/200 4738 CONNECT prg.smartadserver.com:443 - HIER_DIRECT/185.86.138.16 -
1658483765.546 900246 172.19.14.73 TCP_TUNNEL/200 4102 CONNECT bidder.criteo.com:443 - HIER_DIRECT/178.250.0.165 -
1658483765.546 1008081 172.19.13.171 TCP_TUNNEL/200 12749428 CONNECT rr1---sn-jxnoxu-2gbl.googlevideo.com:443 - HIER_DIRECT/195.113.214.204 -
1658483765.546 901791 172.19.14.95 TCP_TUNNEL/200 2176 CONNECT pcb.kb.cz:443 - HIER_DIRECT/194.50.226.158 -
1658483765.546 900569 172.19.14.73 TCP_TUNNEL/200 7260 CONNECT adx.adform.net:443 - HIER_DIRECT/37.157.2.237 -
1658483766.547 935767 172.19.13.190 TCP_TUNNEL/200 110961 CONNECT http://www.seznam.cz:443 - HIER_DIRECT/77.75.77.222 -
1658483766.547 1620846 172.19.15.40 TCP_TUNNEL/200 3520 CONNECT epns.eset.com:443 - HIER_DIRECT/91.228.167.192 -
1658483766.547 900183 172.19.14.73 TCP_TUNNEL/200 4296 CONNECT etarget-emea.adnxs.com:443 - HIER_DIRECT/37.252.173.214 -
1658483767.548 1028965 172.19.15.2 TCP_TUNNEL/200 20796 CONNECT http://www.seznam.cz:443 - HIER_DIRECT/77.75.79.222 -
1658483767.548 959986 172.19.15.199 TCP_TUNNEL/200 7269 CONNECT fonts.googleapis.com:443 - HIER_DIRECT/142.251.36.106 -
1658483767.548 900027 172.19.14.73 TCP_TUNNEL/200 10544 CONNECT fastlane.rubiconproject.com:443 - HIER_DIRECT/69.173.144.141 -
1658483768.549 1625800 172.19.14.204 TCP_TUNNEL/200 3635 CONNECT epns.eset.com:443 - HIER_DIRECT/91.228.167.192 -
1658483768.549 903754 172.19.14.73 TCP_TUNNEL/200 5891 CONNECT region1.google-analytics.com:443 - HIER_DIRECT/216.239.34.36 -
1658483769.551 1017091 172.19.14.19 TCP_TUNNEL/200 4702 CONNECT secure-it.imrworldwide.com:443 - HIER_DIRECT/54.246.16.130 -
1658483769.551 976878 172.19.14.69 TCP_TUNNEL/200 1120200 CONNECT rr2---sn-jxnoxu-2gbl.googlevideo.com:443 - HIER_DIRECT/195.113.214.205 -
1658483769.551 1626332 172.19.15.189 TCP_TUNNEL/200 3635 CONNECT epns.eset.com:443 - HIER_DIRECT/91.228.167.192 -
1658483769.551 986881 172.19.14.69 TCP_TUNNEL/200 11983552 CONNECT rr5---sn-2gb7sn7r.googlevideo.com:443 - HIER_DIRECT/172.217.130.74 -

in access.log of C1 are the time numbers a lot lower:

1658491430.020 7 172.19.14.191 TCP_MISS/200 473 GET http://i5.c.eset.com/v1/auth/60064ADBC289880E8D77/updlist/31/eid/108/lid/108 - DIRECT/91.228.166.45 application/octet-stream
1658491430.025 6 172.19.15.72 TCP_MISS/200 473 GET http://i5.c.eset.com/v1/auth/60064ADBC289880E8D77/updlist/31/eid/108/lid/108 - DIRECT/91.228.166.45 application/octet-stream
1658491430.031 6 172.19.14.191 TCP_MISS/200 473 GET http://i5.c.eset.com/v1/auth/60064ADBC289880E8D77/updlist/32/eid/117876/lid/117876 - DIRECT/91.228.166.45 application/octet-stream
1658491430.038 430 172.19.14.71 TCP_MISS/200 4906 CONNECT v10.events.data.microsoft.com:443 - DIRECT/20.42.65.90 -
1658491430.076 40 172.19.14.191 TCP_MISS/200 473 GET http://i5.c.eset.com/v1/auth/60064ADBC289880E8D77/updlist/33/eid/10185/lid/10185 - DIRECT/91.228.166.45 application/octet-stream
1658491430.112 55 172.19.15.72 TCP_MISS/200 473 GET http://i5.c.eset.com/v1/auth/60064ADBC289880E8D77/updlist/32/eid/117876/lid/117876 - DIRECT/91.228.166.45 application/octet-stream
1658491430.155 30017 172.19.14.186 TCP_MISS/200 62553 CONNECT armmf.adobe.com:443 - DIRECT/2.23.8.158 -
1658491430.180 43 172.19.14.191 TCP_MISS/200 473 GET http://i5.c.eset.com/v1/auth/60064ADBC289880E8D77/updlist/34/eid/8576/lid/8576 - DIRECT/91.228.166.45 application/octet-stream
Tato e-mailov? zpr?va m? pouze informativn? charakter a vych?z? z podklad?, kter? byly odes?lateli p?ed?ny nebo zasl?ny v minulosti. Obsah t?to e-mailov? zpr?vy, resp. jak?koliv p??padn? pr?vn? jedn?n? vypl?vaj?c? z t?to e-mailov? zpr?vy, se nepova?uje za n?vrh na uzav?en? smlouvy ve smyslu ustanoven? ? 1731 z?kona ?. 89/2012 Sb., ob?ansk?ho z?kon?ku, v platn?m zn?n? (d?le jen ?ob?ansk? z?kon?k?) nebo akceptaci n?vrhu na uzav?en? smlouvy ve smyslu ? 1740 ob?ansk?ho z?kon?ku, pop?. potvrzen? uzav?en? smluvn?ho vztahu, nen?-li odes?latelem uvedeno v?slovn? jinak. Tato e-mailov? zpr?va je ur?ena pouze pro osobn? a d?v?rn? u?it? ur?en?mi adres?ty, tedy osobou (osobami), kter? (kter?m) je obsahov? ur?ena. Nejste-li osobou, kter? je tato zpr?va ur?ena, upozor?ujeme V?s, ?e jak?koliv ???en? ?i kop?rov?n? t?to e-mailov? zpr?vy, ?i informace z n?, je zak?z?no. Jestli?e tuto e-mailovou zpr?vu obdr??te nedopat?en?m, pros?me, oznamte tuto skute?nost odes?lateli a odstra?te zpr?vu samotnou i v?echny jej? p??lohy ze sv?ho syst?mu. 

1658491430.227 235 172.19.15.144 TCP_MISS/200 3793 CONNECT ts.eset.com:443 - DIRECT/91.228.166.148 -
1658491430.276 73 172.19.15.72 TCP_MISS/200 473 GET http://i5.c.eset.com/v1/auth/60064ADBC289880E8D77/updlist/33/eid/10185/lid/10185 - DIRECT/91.228.166.45 application/octet-stream
1658491430.404 90 172.19.14.191 TCP_MISS/200 473 GET http://i5.c.eset.com/v1/auth/60064ADBC289880E8D77/updlist/35/eid/7351/lid/7351 - DIRECT/91.228.166.45 application/octet-stream


Now I am out of ideas what to test.

Thank you very much for your help,
Katerina





}

Tato e-mailov? zpr?va m? pouze informativn? charakter a vych?z? z podklad?, kter? byly odes?lateli p?ed?ny nebo zasl?ny v minulosti. Obsah t?to e-mailov? zpr?vy, resp. jak?koliv p??padn? pr?vn? jedn?n? vypl?vaj?c? z t?to e-mailov? zpr?vy, se nepova?uje za n?vrh na uzav?en? smlouvy ve smyslu ustanoven? ? 1731 z?kona ?. 89/2012 Sb., ob?ansk?ho z?kon?ku, v platn?m zn?n? (d?le jen ?ob?ansk? z?kon?k?) nebo akceptaci n?vrhu na uzav?en? smlouvy ve smyslu ? 1740 ob?ansk?ho z?kon?ku, pop?. potvrzen? uzav?en? smluvn?ho vztahu, nen?-li odes?latelem uvedeno v?slovn? jinak. Tato e-mailov? zpr?va je ur?ena pouze pro osobn? a d?v?rn? u?it? ur?en?mi adres?ty, tedy osobou (osobami), kter? (kter?m) je obsahov? ur?ena. Nejste-li osobou, kter? je tato zpr?va ur?ena, upozor?ujeme V?s, ?e jak?koliv ???en? ?i kop?rov?n? t?to e-mailov? zpr?vy, ?i informace z n?, je zak?z?no. Jestli?e tuto e-mailovou zpr?vu obdr??te nedopat?en?m, pros?me, oznamte tuto skute?nost odes?lateli a odstra?te zpr?vu samotnou i v?echny jej? p??lohy ze sv?ho syst?mu. 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220728/74620c1c/attachment.htm>

From ngtech1ltd at gmail.com  Thu Jul 28 06:29:04 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Thu, 28 Jul 2022 09:29:04 +0300
Subject: [squid-users] regex for normal websites
In-Reply-To: <CAGU_CiLxAbs1JcGwUSR3q9_Omxw+3TVykCWm_tjGv=xwzYs5uQ@mail.gmail.com>
References: <CAGU_CiJimq7-co9QCVT1+-NF8Y_V4pECVRiow_eOhh=rfXHK6g@mail.gmail.com>
 <9f0e5df5-771b-368b-4746-32bd4950a07b@treenet.co.nz>
 <CAGU_CiLmvL5QVYS7ijgjVZPPUh6RaxiyNk5kpmHz81=ZCU7fdA@mail.gmail.com>
 <202207271959.09311.Antony.Stone@squid.open.source.it>
 <CAGU_CiLxAbs1JcGwUSR3q9_Omxw+3TVykCWm_tjGv=xwzYs5uQ@mail.gmail.com>
Message-ID: <007a01d8a24b$55efb790$01cf26b0$@gmail.com>

I would assume that if you want to match something like dstdomain you would use:
(^(.*\.)?)adobe\.com$
 
Or two regex:
\.adobe\.com$
^adobe\.com$
 
I like very much: https://rubular.com/
 
Which allows you to see visually the matches.
 
Eliezer
 
 
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> 
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/
 
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of robert k Wild
Sent: Wednesday, 27 July 2022 21:03
To: Antony Stone <Antony.Stone at squid.open.source.it>
Cc: Squid Users <squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] regex for normal websites
 
Makes sense thanks Antony
 
On Wed, 27 Jul 2022, 18:59 Antony Stone, <Antony.Stone at squid.open.source.it <mailto:Antony.Stone at squid.open.source.it> > wrote:
On Wednesday 27 July 2022 at 19:25:46, robert k Wild wrote:

> nice one thanks Amos
> 
> i dont understand as in regex the terms
> 
> ^ - start of line
> . - any single character
> * - repetition of character before

Correction: zero or more instances of the character before

> $ - end of line
> 
>  so going by this it should be
> 
> ^.*adobe.com <http://adobe.com> $

Well, that means "start of line, something or nothing, then 'adobe.com <http://adobe.com> ' and 
end of line".

So, it basically just means, "adobe,com at the end of the line"


Thus, the same as "adobe.com <http://adobe.com> $"


Antony.

-- 
This space intentionally has nothing but text explaining why this space has 
nothing but text explaining that this space would otherwise have been left 
blank, and would otherwise have been left blank.

                                                   Please reply to the list;
                                                         please *don't* CC me.
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> 
http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220728/99a1ed6e/attachment.htm>

From uhlar at fantomas.sk  Thu Jul 28 06:44:04 2022
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Thu, 28 Jul 2022 08:44:04 +0200
Subject: [squid-users] regex for normal websites
In-Reply-To: <60d1307c-e4e4-3af4-bcfa-90a792edbe7c@spamtrap.tnetconsulting.net>
References: <CAGU_CiJimq7-co9QCVT1+-NF8Y_V4pECVRiow_eOhh=rfXHK6g@mail.gmail.com>
 <9f0e5df5-771b-368b-4746-32bd4950a07b@treenet.co.nz>
 <60d1307c-e4e4-3af4-bcfa-90a792edbe7c@spamtrap.tnetconsulting.net>
Message-ID: <YuIwNDPdW9owuPW8@fantomas.sk>

>On 7/27/22 5:19 AM, Amos Jeffries wrote:
>>Also, the "^.*" in your pattern does nothing useful, it should be 
>>omitted.

On 27.07.22 10:44, Grant Taylor wrote:
>Is the bounding to the beginning /implicit/?  Or will adobe.com also 
>match hackadobe.com?

in regexp, it will.


However,
adobe\.com$
and
^.*adobe\.com$

have the same effect, but second one is more CPU effective.

the problem the OP mentions is that it should match

\.adobe\.com$
^adobe\.com$

which leads me back to the question:
wasn't "dstdomain .adobe.com" supposed to match both?

https://wiki.squid-cache.org/SquidFaq/SquidAcl#Squid_doesn.27t_match_my_subdomains

indicates that since squid 2.4 it should.

and so, shouldn't ssl::server_name match both too?

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
42.7 percent of all statistics are made up on the spot.


From ngtech1ltd at gmail.com  Thu Jul 28 07:14:12 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Thu, 28 Jul 2022 10:14:12 +0300
Subject: [squid-users] regex for normal websites
In-Reply-To: <CAGU_CiJb9rfGdwLVoR0n8VE+vuJFtQwGu3v2HvGBW3i+uBQbGA@mail.gmail.com>
References: <CAGU_CiJimq7-co9QCVT1+-NF8Y_V4pECVRiow_eOhh=rfXHK6g@mail.gmail.com>
 <YuEN+aHq7/a1DVVh@fantomas.sk>
 <CAGU_CiJb9rfGdwLVoR0n8VE+vuJFtQwGu3v2HvGBW3i+uBQbGA@mail.gmail.com>
Message-ID: <008601d8a251$a482dd00$ed889700$@gmail.com>

Hey Robert,
 
The docs at http://www.squid-cache.org/Doc/config/acl/  states:
 
        acl aclname ssl::server_name_regex [-i] \.foo\.com ...
          # regex matches server name obtained from various sources [fast]
 
Which and I do not know exactly what it means but it will not work with a helper in most cases.
I have found the in the git the next sources:
https://github.com/squid-cache/squid/blob/bf95c10aa95bf8e56d9d8d1545cb5a3aafab0d2c/doc/release-notes/release-3.5.sgml#L414
 
                New types ssl::server_name  and ssl::server_name_regex
                   to match server name from various sources (CONNECT authority name,
                   TLS SNI domain, or X.509 certificate Subject Name).
 
Which means that there is a set of checks which the acl does and not just a domain name.
It?s also even possible that the domain name is not know in the CONNECT state of the connection.
If I remember correctly there is a possibility for browsers to use the same exact connection for multiple domains but
I have not seen this yet in production.
With Squid once you bump the connection to HTTP/1.x you can make 100% sure the features of the Host header request.
 
At Servername.cc ie:
https://github.com/squid-cache/squid/blob/aee3523a768aff4d1e6c1195c4a401b4ef5688a0/src/acl/ServerName.cc#L81 
 
There is a specific logic of what is done and what is matched but I am not sure what would be used in the case of:
*.adobe.com
 
Certificate SAN.
 
Specifically This part of the Common Names ie SAN:
https://github.com/squid-cache/squid/blob/aee3523a768aff4d1e6c1195c4a401b4ef5688a0/src/acl/ServerName.cc#L105
 
which to my understanding points to:
https://github.com/squid-cache/squid/blob/d146da3bfe7083381ae7ab38640cbfd0d2542374/src/ssl/support.cc#L195
 
doesn?t make any sense to me.( didn?t tried that much to understand)
 
If someone might be able to make sense of things in a synchronic fashion it would help.
(I do not see any debugs usage there or any helping comment )
 
Thanks,
Eliezer
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> 
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/
 
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of robert k Wild
Sent: Wednesday, 27 July 2022 13:52
To: Squid Users <squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] regex for normal websites
 
that's the weird thing, when i try this in  "ssl::server_name_regex"
.adobe.com <http://adobe.com> 
 
it doesnt work
 
you mean escape ie the \ character
 
 
 
 
 
On Wed, 27 Jul 2022 at 11:05, Matus UHLAR - fantomas <uhlar at fantomas.sk <mailto:uhlar at fantomas.sk> > wrote:
On 27.07.22 10:54, robert k Wild wrote:
>think i got it right but just want to double check with you guys
>
>so in my "ssl::server_name" i had
>.adobe.com <http://adobe.com> 
>
>that worked but i want to mix normal website and regex websites together so
>i just have one list for all

didn't the above work?  AFAIK it should, IIRC domain matching in squid 
matches "domain.com <http://domain.com> " if you check for ".domain.com <http://domain.com> ".

>i now have this for "ssl::server_name_regex"
>^.*adobe.com <http://adobe.com> $
>
>it works, so im guessing its right

the dot should be escaped


-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk <mailto:uhlar at fantomas.sk>  ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
BSE = Mad Cow Desease ... BSA = Mad Software Producents Desease
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> 
http://lists.squid-cache.org/listinfo/squid-users


 
-- 
Regards, 

Robert K Wild.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220728/f082e747/attachment.htm>

From ngtech1ltd at gmail.com  Thu Jul 28 07:41:42 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Thu, 28 Jul 2022 10:41:42 +0300
Subject: [squid-users] adding cache_control = nocache to http request
 using squid transparent proxy
In-Reply-To: <111ee184-20d3-3275-cb73-96b41f920bd1@treenet.co.nz>
References: <005101d8a129$3892b760$a9b82620$@plciq.com>
 <111ee184-20d3-3275-cb73-96b41f920bd1@treenet.co.nz>
Message-ID: <008b01d8a255$7bdfbd10$739f3730$@gmail.com>

Hey Amos,

I support what you wrote and I do not know why the service provider wants this but there are some cases
which there is a need to lower the cache ratio of the clients.
Usually fast service is what ISPs want but there are couple use cases that I have seen which makes sense to somehow
try to disable cache in the client side.
In these specific cases the relationship of the ISP and the client should be fully understood by both side
and the ISP should OVER COMMIT their services to the client to compensate for the client limitations.
I would assume it should be some 50-100% of the package over commit.
In the last years I have seen that 1080HD videos uses usually 3Mbps VBR in cases of real time transcoding of the video
( both in server and client side ) while 6Mbps in CBR for the exact same pre-transcoded videos.
(which reduces the client side CPU and device requirements).

So, in case I would have couple CDNs pushing data to my network while the one is overloading my clients current hardware
There is a right to push back this CDN performance since he somehow in-directly forces my clients to  upgrade their hardware.

To my understanding many ISPs and CDNs won't see their actions to give better service coverage as bad
but what's next? We won't be able to snoop in our noses between commercials that are popping into 
our screen or eyes or head?

I just put this really faint conversation in my head:
Son: ohh my head hurts dad!
Dad: Who hit you?
Son: I don't know, I was sitting Infront of the **device** and the video was 4k fps.
Dad: You should use a lower image fps rendering, in my days we used to watch matrix in 15-30 fps and it was fun.

Hope It Helps to give someone a smile.

Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Amos Jeffries
Sent: Wednesday, 27 July 2022 3:46
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] adding cache_control = nocache to http request using squid transparent proxy

On 27/07/22 07:52, muhanad wrote:
> Hello
> 
> I am trying to edit the header of http headers to set the cache_control 
> option to " no-cache" to prevent users from being able to cache the 
> contents

This will not do what you think it does.

The "no-cache" control actually *enables* caching by recipients. It just 
requires a quick revalidation check before the cached content is used.


> even if they are using any type of caching engines. the squid 
> proxy will work in a transparent mode. The traffic is originated from 
> one of our CDNs,

This does not make sense. Just publish the Squid machine IP in DNS 
instead of the CDN server IP. No need for interception.


> also the connection is direct between the clients and 
> the CDN servers, thus the proxy will work in transparent mode with IP 
> spoofing so the in the header the IP address is stays the IP address of 
> the client and  not the proxy server.

This may not do what you think it does. When traffic is arriving *from* 
Internet the source-IP indicates which route to deliver the response 
packets. You do not want the origin server(s) bypassing Squid on the TCP 
SYNACK packets - that will break all traffic.


> PS: We are an ISP company based in Iraq, Baghdad and we are trying to 
> prevent the clients from caching all HTTP data.
> 

Why? This is typically a very bad idea.

All it does is:
  * lower the amount of bandwidth available to your clients
    - given them a bad service/experience.
  * increase the traffic delays across your network
    - even worse service/experience.
  * encourage other ISP to erase the cache limitations on traffic from 
your servers even on traffic where it is correct
    - even worse service/experience.


Even if you are charging clients for bandwidth used. You want to be able 
to service *more* clients as quickly as possible, not scare them away 
with a bad service.


HTH
Amos
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From squid3 at treenet.co.nz  Thu Jul 28 08:39:26 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 28 Jul 2022 20:39:26 +1200
Subject: [squid-users] adding cache_control = nocache to http request
 using squid transparent proxy
In-Reply-To: <008b01d8a255$7bdfbd10$739f3730$@gmail.com>
References: <005101d8a129$3892b760$a9b82620$@plciq.com>
 <111ee184-20d3-3275-cb73-96b41f920bd1@treenet.co.nz>
 <008b01d8a255$7bdfbd10$739f3730$@gmail.com>
Message-ID: <d6575308-739f-629e-c7be-f8b07cf4a574@treenet.co.nz>

On 28/07/22 19:41, ngtech1ltd wrote:
> Hey Amos,
> 
> I support what you wrote and I do not know why the service provider wants this but there are some cases
> which there is a need to lower the cache ratio of the clients.

Yes I know. This is a query where we could make things worse by jumping 
to assumptions and providing immediate answers to the question as-asked.

Thus I'm pointing out the potential issues with the concept and waiting 
on clarification from OP to the "Why?" question before providing a 
solution to their actual need.


Cheers
Amos


From muhanad at plciq.com  Fri Jul 29 11:39:20 2022
From: muhanad at plciq.com (muhanad at plciq.com)
Date: Fri, 29 Jul 2022 14:39:20 +0300
Subject: [squid-users] adding cache_control = nocache to http request
 using squid transparent proxy
In-Reply-To: <mailman.1.1659009602.3746857.squid-users@lists.squid-cache.org>
References: <mailman.1.1659009602.3746857.squid-users@lists.squid-cache.org>
Message-ID: <000301d8a33f$dbee14f0$93ca3ed0$@plciq.com>

Hi

I apologize for my late reply. I guess I wasn't fully clear about my reason
for why I need to stop the contents from being cached. 
First, here in Iraq the internet service is extremely expensive for ISP to
provide services for home users. 
The ISP usually pay 25$ per 1Mbit/sec of bandwidth to the government on the
other hand the end users expect to pay 2$ per 1Mbit/sec. so the ISPs need to
rely heavily on caching and CDNs. Most of CDN companies hesitate heavily
before operating their services in Iraq and most of ISPs can't provide the
infrastructure for CDN operations ( namely high bandwidth required by CDN
vendors such us Akamai, CDN77, etc. ) this led us to make our company
specialized in providing caching and CDN traffic for ISPs. 
The issue we are facing here is some of the CDNs we have provide cacheable
HTTP content, the ISPs that use our services just cache these contents on
their local cache engines thus their traffic consumption from our CDNs will
drop significantly causing us huge revenue losses because the CDN is still
consuming bandwidth and minimal bandwidth. For this I am asking is there a
way by using transparent Squid proxy to turn this cacheable content to
non-cacheable one?.

Thanks in Advance 

Regards
Muhanad Abdullah

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of
squid-users-request at lists.squid-cache.org
Sent: Thursday, July 28, 2022 3:00 PM
To: squid-users at lists.squid-cache.org
Subject: squid-users Digest, Vol 95, Issue 41

Send squid-users mailing list submissions to
	squid-users at lists.squid-cache.org

To subscribe or unsubscribe via the World Wide Web, visit
	http://lists.squid-cache.org/listinfo/squid-users
or, via email, send a message with subject or body 'help' to
	squid-users-request at lists.squid-cache.org

You can reach the person managing the list at
	squid-users-owner at lists.squid-cache.org

When replying, please edit your Subject line so it is more specific than
"Re: Contents of squid-users digest..."


Today's Topics:

   1. Re: adding cache_control = nocache to http request using
      squid transparent proxy (ngtech1ltd at gmail.com)
   2. Re: adding cache_control = nocache to http request using
      squid transparent proxy (Amos Jeffries)


----------------------------------------------------------------------

Message: 1
Date: Thu, 28 Jul 2022 10:41:42 +0300
From: <ngtech1ltd at gmail.com>
To: <squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] adding cache_control = nocache to http
	request using squid transparent proxy
Message-ID: <008b01d8a255$7bdfbd10$739f3730$@gmail.com>
Content-Type: text/plain;	charset="utf-8"

Hey Amos,

I support what you wrote and I do not know why the service provider wants
this but there are some cases which there is a need to lower the cache ratio
of the clients.
Usually fast service is what ISPs want but there are couple use cases that I
have seen which makes sense to somehow try to disable cache in the client
side.
In these specific cases the relationship of the ISP and the client should be
fully understood by both side and the ISP should OVER COMMIT their services
to the client to compensate for the client limitations.
I would assume it should be some 50-100% of the package over commit.
In the last years I have seen that 1080HD videos uses usually 3Mbps VBR in
cases of real time transcoding of the video ( both in server and client side
) while 6Mbps in CBR for the exact same pre-transcoded videos.
(which reduces the client side CPU and device requirements).

So, in case I would have couple CDNs pushing data to my network while the
one is overloading my clients current hardware There is a right to push back
this CDN performance since he somehow in-directly forces my clients to
upgrade their hardware.

To my understanding many ISPs and CDNs won't see their actions to give
better service coverage as bad but what's next? We won't be able to snoop in
our noses between commercials that are popping into our screen or eyes or
head?

I just put this really faint conversation in my head:
Son: ohh my head hurts dad!
Dad: Who hit you?
Son: I don't know, I was sitting Infront of the **device** and the video was
4k fps.
Dad: You should use a lower image fps rendering, in my days we used to watch
matrix in 15-30 fps and it was fun.

Hope It Helps to give someone a smile.

Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of
Amos Jeffries
Sent: Wednesday, 27 July 2022 3:46
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] adding cache_control = nocache to http request
using squid transparent proxy

On 27/07/22 07:52, muhanad wrote:
> Hello
> 
> I am trying to edit the header of http headers to set the 
> cache_control option to " no-cache" to prevent users from being able 
> to cache the contents

This will not do what you think it does.

The "no-cache" control actually *enables* caching by recipients. It just
requires a quick revalidation check before the cached content is used.


> even if they are using any type of caching engines. the squid 
> proxy will work in a transparent mode. The traffic is originated from 
> one of our CDNs,

This does not make sense. Just publish the Squid machine IP in DNS 
instead of the CDN server IP. No need for interception.


> also the connection is direct between the clients and 
> the CDN servers, thus the proxy will work in transparent mode with IP 
> spoofing so the in the header the IP address is stays the IP address of 
> the client and  not the proxy server.

This may not do what you think it does. When traffic is arriving *from* 
Internet the source-IP indicates which route to deliver the response 
packets. You do not want the origin server(s) bypassing Squid on the TCP 
SYNACK packets - that will break all traffic.


> PS: We are an ISP company based in Iraq, Baghdad and we are trying to 
> prevent the clients from caching all HTTP data.
> 

Why? This is typically a very bad idea.

All it does is:
  * lower the amount of bandwidth available to your clients
    - given them a bad service/experience.
  * increase the traffic delays across your network
    - even worse service/experience.
  * encourage other ISP to erase the cache limitations on traffic from 
your servers even on traffic where it is correct
    - even worse service/experience.


Even if you are charging clients for bandwidth used. You want to be able 
to service *more* clients as quickly as possible, not scare them away 
with a bad service.


HTH
Amos
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



------------------------------

Message: 2
Date: Thu, 28 Jul 2022 20:39:26 +1200
From: Amos Jeffries <squid3 at treenet.co.nz>
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] adding cache_control = nocache to http
	request using squid transparent proxy
Message-ID: <d6575308-739f-629e-c7be-f8b07cf4a574 at treenet.co.nz>
Content-Type: text/plain; charset=UTF-8; format=flowed

On 28/07/22 19:41, ngtech1ltd wrote:
> Hey Amos,
> 
> I support what you wrote and I do not know why the service provider wants
this but there are some cases
> which there is a need to lower the cache ratio of the clients.

Yes I know. This is a query where we could make things worse by jumping 
to assumptions and providing immediate answers to the question as-asked.

Thus I'm pointing out the potential issues with the concept and waiting 
on clarification from OP to the "Why?" question before providing a 
solution to their actual need.


Cheers
Amos


------------------------------

Subject: Digest Footer

_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users


------------------------------

End of squid-users Digest, Vol 95, Issue 41
*******************************************



From ngtech1ltd at gmail.com  Sat Jul 30 19:23:43 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Sat, 30 Jul 2022 22:23:43 +0300
Subject: [squid-users] Windows Server 2019-22 Kerberos transparent Windows
 client authentication help wanted. Try 2
Message-ID: <002701d8a449$e30f7ac0$a92e7040$@gmail.com>

Hey Everybody,

Last time I have tried to test transparent windows client authentication to AD with Kerberos I have failed in any test.
The documentation at:
https://wiki.squid-cache.org/ConfigExamples/Authenticate/Kerberos
https://wiki.squid-cache.org/ConfigExamples/Authenticate/WindowsActiveDirectory

Is not sufficient, it only describes the idea and while this is well understood the actual implementation is not well explained
in most of the articles I have tried to understand from.
Last time I have tried both CentOS, RHEL, Fedora, Oracle, Debian ,Ubuntu and failed.

The latest documents I have seen which seems good to some degree are:
https://support.kaspersky.com/KWTS/6.1/en-US/166440.htm
https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/networking_guide/setting-up-squid-as-a-caching-proxy-with-kerberos-authentication


My next try is for:
https://journeyofthegeek.com/2017/12/30/pfsense-squid-kerberos/

If someone have the knowledge about a specific guide that works for Windows Server 2016+ please send me a link.

Thanks,
Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/




From rafael.akchurin at diladele.com  Sat Jul 30 19:26:20 2022
From: rafael.akchurin at diladele.com (Rafael Akchurin)
Date: Sat, 30 Jul 2022 19:26:20 +0000
Subject: [squid-users] Windows Server 2019-22 Kerberos transparent
 Windows client authentication help wanted. Try 2
In-Reply-To: <002701d8a449$e30f7ac0$a92e7040$@gmail.com>
References: <002701d8a449$e30f7ac0$a92e7040$@gmail.com>
Message-ID: <AM8PR04MB7745A140026969AB9C1EA29D8F989@AM8PR04MB7745.eurprd04.prod.outlook.com>

Hello Eliezer,

We use it all the time - https://docs.diladele.com/administrator_guide_stable/active_directory/index.html
Not sure if this satisfies your requirements though. But it seems to be very stable.

Best regards,
Rafael 



-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of ngtech1ltd at gmail.com
Sent: Saturday, July 30, 2022 9:24 PM
To: squid-users at lists.squid-cache.org
Subject: [squid-users] Windows Server 2019-22 Kerberos transparent Windows client authentication help wanted. Try 2

Hey Everybody,

Last time I have tried to test transparent windows client authentication to AD with Kerberos I have failed in any test.
The documentation at:
https://wiki.squid-cache.org/ConfigExamples/Authenticate/Kerberos
https://wiki.squid-cache.org/ConfigExamples/Authenticate/WindowsActiveDirectory

Is not sufficient, it only describes the idea and while this is well understood the actual implementation is not well explained in most of the articles I have tried to understand from.
Last time I have tried both CentOS, RHEL, Fedora, Oracle, Debian ,Ubuntu and failed.

The latest documents I have seen which seems good to some degree are:
https://support.kaspersky.com/KWTS/6.1/en-US/166440.htm
https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/networking_guide/setting-up-squid-as-a-caching-proxy-with-kerberos-authentication


My next try is for:
https://journeyofthegeek.com/2017/12/30/pfsense-squid-kerberos/

If someone have the knowledge about a specific guide that works for Windows Server 2016+ please send me a link.

Thanks,
Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/


_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users


From squid3 at treenet.co.nz  Sun Jul 31 01:57:02 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sun, 31 Jul 2022 13:57:02 +1200
Subject: [squid-users] adding cache_control = nocache to http request
 using squid transparent proxy
In-Reply-To: <000301d8a33f$dbee14f0$93ca3ed0$@plciq.com>
References: <mailman.1.1659009602.3746857.squid-users@lists.squid-cache.org>
 <000301d8a33f$dbee14f0$93ca3ed0$@plciq.com>
Message-ID: <6c3dc6e1-14c4-38fd-b51a-175c94976d63@treenet.co.nz>

On 29/07/22 23:39, muhanad wrote:
> Hi
> 
> I apologize for my late reply. I guess I wasn't fully clear about my reason
> for why I need to stop the contents from being cached.
> First, here in Iraq the internet service is extremely expensive for ISP to
> provide services for home users.
> The ISP usually pay 25$ per 1Mbit/sec of bandwidth to the government on the
> other hand the end users expect to pay 2$ per 1Mbit/sec. so the ISPs need to
> rely heavily on caching and CDNs. Most of CDN companies hesitate heavily
> before operating their services in Iraq and most of ISPs can't provide the
> infrastructure for CDN operations ( namely high bandwidth required by CDN
> vendors such us Akamai, CDN77, etc. ) this led us to make our company
> specialized in providing caching and CDN traffic for ISPs.
> The issue we are facing here is some of the CDNs we have provide cacheable
> HTTP content, the ISPs that use our services just cache these contents on
> their local cache engines thus their traffic consumption from our CDNs will
> drop significantly causing us huge revenue losses because the CDN is still
> consuming bandwidth and minimal bandwidth. For this I am asking is there a
> way by using transparent Squid proxy to turn this cacheable content to
> non-cacheable one?.
> 


What you want then is actually the "no-store" control. To prevent 
recipients storing the response.

   reply_header_add Cache-Control no-store


Cheers
Amos


