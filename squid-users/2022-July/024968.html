<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Connection reset and assertion failed
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Connection%20reset%20and%20assertion%20failed&In-Reply-To=%3C351c54f9-8e5a-0902-9e23-82453a816c99%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024966.html">
   <LINK REL="Next"  HREF="024967.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Connection reset and assertion failed</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Connection%20reset%20and%20assertion%20failed&In-Reply-To=%3C351c54f9-8e5a-0902-9e23-82453a816c99%40measurement-factory.com%3E"
       TITLE="[squid-users] Connection reset and assertion failed">rousskov at measurement-factory.com
       </A><BR>
    <I>Fri Jul 15 13:59:31 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="024966.html">[squid-users] Connection reset and assertion failed
</A></li>
        <LI>Next message (by thread): <A HREF="024967.html">[squid-users] Upstream Proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24968">[ date ]</a>
              <a href="thread.html#24968">[ thread ]</a>
              <a href="subject.html#24968">[ subject ]</a>
              <a href="author.html#24968">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 7/15/22 08:18, Thomas Dev wrote:

&gt;<i> currently, we are suffering from aborted downloads while going over
</I>&gt;<i> squid. When I look into the ethernet traffic, I can see many TCP-rests
</I>&gt;<i> by squid and in close timely relation to those resets I see messages
</I>&gt;<i> like:
</I>&gt;<i> 
</I>&gt;<i> 2022/07/15 12:04:24 kid1| assertion failed: tunnel.cc:1227:
</I>&gt;<i> &quot;!waitingForConnectExchange&quot;
</I>&gt;<i>      current master transaction: master1178
</I>&gt;<i> 
</I>&gt;<i> in cache.log.
</I>&gt;<i> 
</I>&gt;<i> Are these tcp-resets related to the failed assertion 
</I>
That would be my working theory.


&gt;<i> and can I do something about it?
</I>
I would start with an upgrade to Squid v5.6 or later. Squid v5.2 has a 
set of bugs that make it unusable in most production environments, and 
some of those bugs may manifest in assertions similar to yours. Squid 
v5.6 retained only one of those bugs (bug 5186 -- fixed in master/v6).


HTH,

Alex.


&gt;<i> Server: physical Ubuntu 22.04 LTS
</I>&gt;<i> 
</I>&gt;<i> Squid Cache: Version 5.2
</I>&gt;<i> Service Name: squid
</I>&gt;<i> Ubuntu linux
</I>&gt;<i> configure options:  '--build=x86_64-linux-gnu' '--prefix=/usr'
</I>&gt;<i> '--includedir=${prefix}/include' '--mandir=${prefix}/share/man'
</I>&gt;<i> '--infodir=${prefix}/share/info' '--sysconfdir=/etc'
</I>&gt;<i> '--localstatedir=/var' '--disable-option-checking'
</I>&gt;<i> '--disable-silent-rules' '--libdir=${prefix}/lib/x86_64-linux-gnu'
</I>&gt;<i> '--runstatedir=/run' '--disable-maintainer-mode'
</I>&gt;<i> '--disable-dependency-tracking' 'BUILDCXXFLAGS=-g -O2
</I>&gt;<i> -ffile-prefix-map=/build/squid-DQ03Be/squid-5.2=. -flto=auto
</I>&gt;<i> -ffat-lto-objects -flto=auto -ffat-lto-objects
</I>&gt;<i> -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time
</I>&gt;<i> -D_FORTIFY_SOURCE=2 -Wl,-Bsymbolic-functions -flto=auto
</I>&gt;<i> -ffat-lto-objects -flto=auto -Wl,-z,relro -Wl,-z,now ' 'BUILDCXX=g++'
</I>&gt;<i> '--with-build-environment=default' '--enable-build-info=Ubuntu linux'
</I>&gt;<i> '--datadir=/usr/share/squid' '--sysconfdir=/etc/squid'
</I>&gt;<i> '--libexecdir=/usr/lib/squid' '--mandir=/usr/share/man'
</I>&gt;<i> '--enable-inline' '--disable-arch-native' '--enable-async-io=8'
</I>&gt;<i> '--enable-storeio=ufs,aufs,diskd,rock'
</I>&gt;<i> '--enable-removal-policies=lru,heap' '--enable-delay-pools'
</I>&gt;<i> '--enable-cache-digests' '--enable-icap-client'
</I>&gt;<i> '--enable-follow-x-forwarded-for'
</I>&gt;<i> '--enable-auth-basic=DB,fake,getpwnam,LDAP,NCSA,PAM,POP3,RADIUS,SASL,SMB'
</I>&gt;<i> '--enable-auth-digest=file,LDAP'
</I>&gt;<i> '--enable-auth-negotiate=kerberos,wrapper'
</I>&gt;<i> '--enable-auth-ntlm=fake,SMB_LM'
</I>&gt;<i> '--enable-external-acl-helpers=file_userip,kerberos_ldap_group,LDAP_group,session,SQL_session,time_quota,unix_group,wbinfo_group'
</I>&gt;<i> '--enable-security-cert-validators=fake'
</I>&gt;<i> '--enable-storeid-rewrite-helpers=file'
</I>&gt;<i> '--enable-url-rewrite-helpers=fake' '--enable-eui' '--enable-esi'
</I>&gt;<i> '--enable-icmp' '--enable-zph-qos' '--enable-ecap'
</I>&gt;<i> '--disable-translation' '--with-swapdir=/var/spool/squid'
</I>&gt;<i> '--with-logdir=/var/log/squid' '--with-pidfile=/run/squid.pid'
</I>&gt;<i> '--with-filedescriptors=65536' '--with-large-files'
</I>&gt;<i> '--with-default-user=proxy' '--enable-linux-netfilter'
</I>&gt;<i> '--with-systemd' '--with-gnutls' 'build_alias=x86_64-linux-gnu'
</I>&gt;<i> 'CFLAGS=-g -O2 -ffile-prefix-map=/build/squid-DQ03Be/squid-5.2=.
</I>&gt;<i> -flto=auto -ffat-lto-objects -flto=auto -ffat-lto-objects
</I>&gt;<i> -fstack-protector-strong -Wformat -Werror=format-security -Wall'
</I>&gt;<i> 'LDFLAGS=-Wl,-Bsymbolic-functions -flto=auto -ffat-lto-objects
</I>&gt;<i> -flto=auto -Wl,-z,relro -Wl,-z,now ' 'CPPFLAGS=-Wdate-time
</I>&gt;<i> -D_FORTIFY_SOURCE=2' 'CXXFLAGS=-g -O2
</I>&gt;<i> -ffile-prefix-map=/build/squid-DQ03Be/squid-5.2=. -flto=auto
</I>&gt;<i> -ffat-lto-objects -flto=auto -ffat-lto-objects
</I>&gt;<i> -fstack-protector-strong -Wformat -Werror=format-security'
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="024966.html">[squid-users] Connection reset and assertion failed
</A></li>
	<LI>Next message (by thread): <A HREF="024967.html">[squid-users] Upstream Proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24968">[ date ]</a>
              <a href="thread.html#24968">[ thread ]</a>
              <a href="subject.html#24968">[ subject ]</a>
              <a href="author.html#24968">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
