<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Upstream Proxy
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Upstream%20Proxy&In-Reply-To=%3C173580d7-12c6-ebf5-6e36-8240f9f10474%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024978.html">
   <LINK REL="Next"  HREF="024974.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Upstream Proxy</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Upstream%20Proxy&In-Reply-To=%3C173580d7-12c6-ebf5-6e36-8240f9f10474%40measurement-factory.com%3E"
       TITLE="[squid-users] Upstream Proxy">rousskov at measurement-factory.com
       </A><BR>
    <I>Mon Jul 18 18:32:03 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="024978.html">[squid-users] Upstream Proxy
</A></li>
        <LI>Next message (by thread): <A HREF="024974.html">[squid-users] Support for OAuth2 Authorization flow
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24979">[ date ]</a>
              <a href="thread.html#24979">[ thread ]</a>
              <a href="subject.html#24979">[ subject ]</a>
              <a href="author.html#24979">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 7/18/22 12:15, Johnathan Hasty wrote:

&gt;<i> The vendor, while not helpful at all as they want our org to use
</I>&gt;<i> their new application rather than proxy....Has stated they are only
</I>&gt;<i> looking for email address and not password. But they likely mean
</I>&gt;<i> they're looking for <A HREF="https://lists.squid-cache.org/listinfo/squid-users">user.name at sub.domain.com</A>
</I>
I see two options for going forward:

* Continue guessing what the upstream proxy wants to receive from Squid. 
This may go on forever because you do not know the authentication scheme 
they are using and you do not know the proper credentials for that 
scheme. The number of potential configurations to test is infinite.

* Do what they want -- set things up (without Squid!) so that HTTP 
clients authenticate with the upstream proxy. AFAICT, the vendor will 
help you with that. Then use the _working_ example to reverse engineer 
the right answers instead of guessing them.

Alex.



&gt;<i> Thank you for tls-cafile= correction, as I do have GoGuardian's root certificate in that path and trusted on the Squid-hosted OS.
</I>&gt;<i> 
</I>&gt;<i> For Login= I have been trying to pass credentials from Windows to Squid to GoGuardian. From your response, I believe you are stating to have a &quot;machine&quot; user account that will be static for all users passing through Squid. This setup would be fine for us, but we would prefer to have the unique user's &quot;email&quot; passed through so that on GoGuardian's end our reports reflect the correct user.
</I>&gt;<i> 
</I>&gt;<i> I currently have Squid working with auth (when not handing off to GG), with Kerberos and NTLM. What I was hoping to achieve is handing this off to GG in the form of the username (&quot;email&quot;).
</I>&gt;<i> 
</I>&gt;<i> I feel like I have <A HREF="http://www.squid-cache.org/Doc/config/cache_peer/">http://www.squid-cache.org/Doc/config/cache_peer/</A> 's authentication options memorized, however it is possible I am using them (login=) incorrectly.
</I>&gt;<i> 
</I>&gt;<i> The vendor refuses to look at logs on their end to troubleshoot, as they do not have access and the engineers who do aren't replying! Lovely...
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 1658160759.291    166 10.125.12.19 TCP_DENIED/407 4233 CONNECT abc.com:443 - HIER_NONE/- text/html &quot;ws-iid=-&quot; &quot;ws-mac=00:00:00:00:00:00&quot; &quot;ws-duration=-&quot; &quot;ws-timing=-&quot; &quot;ws-mtime=-&quot; &quot;ws-scanflags=-&quot; &quot;ws-categories=-&quot; &quot;ws-trusted=-&quot; &quot;ws-level=-&quot; &quot;ws-verdict=-&quot; &quot;ws-policy=-&quot; &quot;ws-member=-&quot; &quot;ws-module=-&quot; &quot;ws-msgtype=-&quot; &quot;ws-param1=-&quot; &quot;ws-param2=-&quot; &quot;ws-debug=-&quot; &quot;squid-gt-st=199&quot;
</I>&gt;<i> 1658160760.048     73 10.125.12.19 NONE_NONE/200 0 CONNECT abc.com:443 <A HREF="https://lists.squid-cache.org/listinfo/squid-users">johnathan.hasty at USI.UNCOMMONSCHOOLS.ORG</A> HIER_NONE/- - &quot;ws-iid=94&quot; &quot;ws-mac=00:00:00:00:00:00&quot; &quot;ws-duration=2105&quot; &quot;ws-timing=0&quot; &quot;ws-mtime=0&quot; &quot;ws-scanflags=63&quot; &quot;ws-categories=0&quot; &quot;ws-trusted=0&quot; &quot;ws-level=1&quot; &quot;ws-verdict=0&quot; &quot;ws-policy=default&quot; &quot;ws-member=default&quot; &quot;ws-module=2&quot; &quot;ws-msgtype=2&quot; &quot;ws-param1=None&quot; &quot;ws-param2=None&quot; &quot;ws-debug=None&quot; &quot;squid-gt-st=3220&quot;
</I>&gt;<i> 1658160760.165    117 10.125.12.19 TCP_TUNNEL/407 0 CONNECT abc.com:443 <A HREF="https://lists.squid-cache.org/listinfo/squid-users">johnathan.hasty at USI.UNCOMMONSCHOOLS.ORG</A> FIRSTUP_PARENT/52.44.107.1 - &quot;ws-iid=95&quot; &quot;ws-mac=00:00:00:00:00:00&quot; &quot;ws-duration=63&quot; &quot;ws-timing=0&quot; &quot;ws-mtime=0&quot; &quot;ws-scanflags=63&quot; &quot;ws-categories=0&quot; &quot;ws-trusted=0&quot; &quot;ws-level=1&quot; &quot;ws-verdict=0&quot; &quot;ws-policy=default&quot; &quot;ws-member=default&quot; &quot;ws-module=2&quot; &quot;ws-msgtype=2&quot; &quot;ws-param1=None&quot; &quot;ws-param2=None&quot; &quot;ws-debug=None&quot; &quot;squid-gt-st=0&quot;
</I>&gt;<i> 1658160760.165      0 10.125.12.19 NONE_NONE/000 0 - error:transaction-end-before-headers - HIER_NONE/- - &quot;ws-iid=-&quot; &quot;ws-mac=-&quot; &quot;ws-duration=-&quot; &quot;ws-timing=-&quot; &quot;ws-mtime=-&quot; &quot;ws-scanflags=-&quot; &quot;ws-categories=-&quot; &quot;ws-trusted=-&quot; &quot;ws-level=-&quot; &quot;ws-verdict=-&quot; &quot;ws-policy=-&quot; &quot;ws-member=-&quot; &quot;ws-module=-&quot; &quot;ws-msgtype=-&quot; &quot;ws-param1=-&quot; &quot;ws-param2=-&quot; &quot;ws-debug=-&quot; &quot;squid-gt-st=517&quot;
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> ----------
</I>&gt;<i> CONNECT getpocket.cdn.mozilla.net:443 HTTP/1.1
</I>&gt;<i> Host: getpocket.cdn.mozilla.net:443
</I>&gt;<i> Via: 1.1 poc-websafety.usi.uncommonschools.org (squid/5.5)
</I>&gt;<i> X-Forwarded-For: 10.125.12.19
</I>&gt;<i> Proxy-Authorization: Basic [redacted]
</I>&gt;<i> Cache-Control: max-age=259200
</I>&gt;<i> Connection: close
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> ----------
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> ---------
</I>&gt;<i> HTTP/1.1 407 Proxy Authentication Required
</I>&gt;<i> Proxy-Authenticate: Basic realm=&quot;Secure Browsing&quot;
</I>&gt;<i> Date: Mon, 18 Jul 2022 16:13:28 GMT
</I>&gt;<i> Content-Length: 0
</I>&gt;<i> Connection: close
</I>&gt;<i> 
</I>&gt;<i> ----------
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Best Regards,
</I>&gt;<i> Johnathan
</I>&gt;<i>   
</I>&gt;<i> _______________________________________________________
</I>&gt;<i>    
</I>&gt;<i> Johnathan Hasty
</I>&gt;<i> Senior DevOps Engineer
</I>&gt;<i> Uncommon Schools
</I>&gt;<i> C: 989.366.1672
</I>&gt;<i>    
</I>&gt;<i> Uncommon Schools | Change History
</I>&gt;<i> Website&#160;|&#160;Facebook&#160;|&#160;Twitter&#160;|&#160;LinkedIn&#160;|&#160;Apply Now
</I>&gt;<i> 
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; On Behalf Of Amos Jeffries
</I>&gt;<i> Sent: Friday, July 15, 2022 1:27 PM
</I>&gt;<i> To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> Subject: Re: [squid-users] Upstream Proxy
</I>&gt;<i> 
</I>&gt;<i> On 16/07/22 04:05, Johnathan Hasty wrote:
</I>&gt;&gt;&gt;<i> What HTTP authentication method(s) or scheme(s) does your upstream proxy support or require?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> They're very vague and not helpful. It was said they look for email, but in reality it would be <A HREF="https://lists.squid-cache.org/listinfo/squid-users">user at blah.company.com</A> rather than <A HREF="https://lists.squid-cache.org/listinfo/squid-users">user at company.com.</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This is the only information I have for them.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> <A HREF="https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fsupport.goguardian">https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fsupport.goguardian</A>
</I>&gt;&gt;<i> .com%2fs%2farticle%2fDeploying-GoGuardian-Gateway-1629767892527&amp;c=E,1,
</I>&gt;&gt;<i> kxoL6sN8CmL8UJVV7XAszjC5mA2VYXeLIYssH9544vgm37JbQ44M6EZogCrg-UmQilt1uk
</I>&gt;&gt;<i> BdNerDVyJj9CitYUk5aQX0P9NqNDjbcNYV-ImK&amp;typo=1
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> <A HREF="https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fview.highspot.com%">https://linkprotect.cudasvc.com/url?a=https%3a%2f%2fview.highspot.com%</A>
</I>&gt;&gt;<i> 2fviewer%2f5f7241dd628ba24915723e85&amp;c=E,1,dxC_Gqqw2wC0pGrZOpS7-THHKfgN
</I>&gt;&gt;<i> Utm5i8wjs5Ac9f2Jon2meVKJs0rNytWei3YbxnYP8cNbFntUm7e9E34E2dGHoyKwTvfmiM
</I>&gt;&gt;<i> MKCvRjnxg7&amp;typo=1
</I>&gt;&gt;<i>
</I>&gt;<i> 
</I>&gt;<i> This document is providing some answers, but indeed are a bit obscure.
</I>&gt;<i> 
</I>&gt;<i> The authentication is using LDAP service. Which means Squid should have its own account in LDAP registered as a machine account type (not a regular user, so it can avoid constant password update requirements).
</I>&gt;<i> Those are the credentials you configure in the cache_peer line to be passed to GG.
</I>&gt;<i>    Make sure that you configure the full username string. Whether it be login=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">user at blah.example.com</A>:password  or login=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">user at example.com</A>:password or  login=user:password
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Also, cache_peer should not need sslcapath= option. Just 'tls' and ensure the Squid machine Trusted CA certs package is kept up to date. If GG has a special Server certificate based on some custom CA, then use the tls-cafile= option to load that custom public root cert.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> If you are still having issues, the contents of the PAC file generated for a test user account could have some more hints about what GG is expecting.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> HTH
</I>&gt;<i> Amos
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="https://linkprotect.cudasvc.com/url?a=http%3a%2f%2flists.squid-cache.org%2flistinfo%2fsquid-users&amp;c=E,1,p0pIs1RkqwtsIzZ-qgPtXeEFoSfUyjivFLuTCVPZhVMDWCtYW2Nrlh1pGrW3jFWJYwsWZgEMtY8MTMjtg1bA-UDPcCY9hRhweJEdl7NdDScvjx-99Kir&amp;typo=1">https://linkprotect.cudasvc.com/url?a=http%3a%2f%2flists.squid-cache.org%2flistinfo%2fsquid-users&amp;c=E,1,p0pIs1RkqwtsIzZ-qgPtXeEFoSfUyjivFLuTCVPZhVMDWCtYW2Nrlh1pGrW3jFWJYwsWZgEMtY8MTMjtg1bA-UDPcCY9hRhweJEdl7NdDScvjx-99Kir&amp;typo=1</A>
</I>&gt;<i> CAUTION : This email originated from outside of the organization. Do not click links or open attachments unless you recognize the sender and know the content is safe.
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="024978.html">[squid-users] Upstream Proxy
</A></li>
	<LI>Next message (by thread): <A HREF="024974.html">[squid-users] Support for OAuth2 Authorization flow
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24979">[ date ]</a>
              <a href="thread.html#24979">[ thread ]</a>
              <a href="subject.html#24979">[ subject ]</a>
              <a href="author.html#24979">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
