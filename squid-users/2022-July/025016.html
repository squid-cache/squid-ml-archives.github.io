<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Routing
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Routing&In-Reply-To=%3CCAAV2eMoE70cGBD%3DVU8rvckNrrkwQo%3DBXxUrVMm5fLd%3Dha%3D3_Ug%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025035.html">
   <LINK REL="Next"  HREF="025021.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Routing</H1>
    <B>&#1048;&#1083;&#1100;&#1103; &#1044;&#1077;&#1081;&#1089;</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Routing&In-Reply-To=%3CCAAV2eMoE70cGBD%3DVU8rvckNrrkwQo%3DBXxUrVMm5fLd%3Dha%3D3_Ug%40mail.gmail.com%3E"
       TITLE="[squid-users] Routing">ilja.dejs at gmail.com
       </A><BR>
    <I>Wed Jul 27 08:03:26 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025035.html">[squid-users] adding cache_control = nocache to http request using squid transparent proxy
</A></li>
        <LI>Next message (by thread): <A HREF="025021.html">[squid-users] Routing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25016">[ date ]</a>
              <a href="thread.html#25016">[ thread ]</a>
              <a href="subject.html#25016">[ subject ]</a>
              <a href="author.html#25016">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,
I ran into a problem when routing connections from a specific address.
I need to use a dedicated channel for downloading video, and for
everything else, a port-dependent channel. Routing is based on the
receiving port of the proxy server. I am using ssl_bum

Config example:

http_port 3128 tcpkeepalive=60,30,3 ssl-bump
generate-host-certificates=on dynamic_cert_mem_cache_size=20MB
tls-cert=/etc/squid/bump.crt tls-key=/etc/squid/bump.key
cipher=HIGH:MEDIUM:!LOW:!RC4:!SEED:!IDEA:!3DES:!MD5:!EXP:!PSK:!DSS
options=NO_TLSv1,NO_SSLv3,SINGLE_DH_US
E,SINGLE_ECDH_USE tls-dh=prime256v1:/etc/squid/bump_dhparam.pem
http_port 3129 tcpkeepalive=60,30,3 ssl-bump
generate-host-certificates=on dynamic_cert_mem_cache_size=20MB
tls-cert=/etc/squid/bump.crt tls-key=/etc/squid/bump.key
cipher=HIGH:MEDIUM:!LOW:!RC4:!SEED:!IDEA:!3DES:!MD5:!EXP:!PSK:!DSS
options=NO_TLSv1,NO_SSLv3,SINGLE_DH_US
E,SINGLE_ECDH_USE tls-dh=prime256v1:/etc/squid/bump_dhparam.pem
http_port 3130 tcpkeepalive=60,30,3 ssl-bump
generate-host-certificates=on dynamic_cert_mem_cache_size=20MB
tls-cert=/etc/squid/bump.crt tls-key=/etc/squid/bump.key
cipher=HIGH:MEDIUM:!LOW:!RC4:!SEED:!IDEA:!3DES:!MD5:!EXP:!PSK:!DSS
options=NO_TLSv1,NO_SSLv3,SINGLE_DH_US
E,SINGLE_ECDH_USE tls-dh=prime256v1:/etc/squid/bump_dhparam.pem
http_port 3131 tcpkeepalive=60,30,3 ssl-bump
generate-host-certificates=on dynamic_cert_mem_cache_size=20MB
tls-cert=/etc/squid/bump.crt tls-key=/etc/squid/bump.key
cipher=HIGH:MEDIUM:!LOW:!RC4:!SEED:!IDEA:!3DES:!MD5:!EXP:!PSK:!DSS
options=NO_TLSv1,NO_SSLv3,SINGLE_DH_US
E,SINGLE_ECDH_USE tls-dh=prime256v1:/etc/squid/bump_dhparam.pem
http_port 3132 tcpkeepalive=60,30,3 ssl-bump
generate-host-certificates=on dynamic_cert_mem_cache_size=20MB
tls-cert=/etc/squid/bump.crt tls-key=/etc/squid/bump.key
cipher=HIGH:MEDIUM:!LOW:!RC4:!SEED:!IDEA:!3DES:!MD5:!EXP:!PSK:!DSS
options=NO_TLSv1,NO_SSLv3,SINGLE_DH_US
E,SINGLE_ECDH_USE tls-dh=prime256v1:/etc/squid/bump_dhparam.pem
http_port 3133 tcpkeepalive=60,30,3 ssl-bump
generate-host-certificates=on dynamic_cert_mem_cache_size=20MB
tls-cert=/etc/squid/bump.crt tls-key=/etc/squid/bump.key
cipher=HIGH:MEDIUM:!LOW:!RC4:!SEED:!IDEA:!3DES:!MD5:!EXP:!PSK:!DSS
options=NO_TLSv1,NO_SSLv3,SINGLE_DH_US
E,SINGLE_ECDH_USE tls-dh=prime256v1:/etc/squid/bump_dhparam.pem
http_port 3134 tcpkeepalive=60,30,3 ssl-bump
generate-host-certificates=on dynamic_cert_mem_cache_size=20MB
tls-cert=/etc/squid/bump.crt tls-key=/etc/squid/bump.key
cipher=HIGH:MEDIUM:!LOW:!RC4:!SEED:!IDEA:!3DES:!MD5:!EXP:!PSK:!DSS
options=NO_TLSv1,NO_SSLv3,SINGLE_DH_US
E,SINGLE_ECDH_USE tls-dh=prime256v1:/etc/squid/bump_dhparam.pem
http_port 3135 tcpkeepalive=60,30,3 ssl-bump
generate-host-certificates=on dynamic_cert_mem_cache_size=20MB
tls-cert=/etc/squid/bump.crt tls-key=/etc/squid/bump.key
cipher=HIGH:MEDIUM:!LOW:!RC4:!SEED:!IDEA:!3DES:!MD5:!EXP:!PSK:!DSS
options=NO_TLSv1,NO_SSLv3,SINGLE_DH_US
E,SINGLE_ECDH_USE tls-dh=prime256v1:/etc/squid/bump_dhparam.pem
http_port 3136 tcpkeepalive=60,30,3 ssl-bump
generate-host-certificates=on dynamic_cert_mem_cache_size=20MB
tls-cert=/etc/squid/bump.crt tls-key=/etc/squid/bump.key
cipher=HIGH:MEDIUM:!LOW:!RC4:!SEED:!IDEA:!3DES:!MD5:!EXP:!PSK:!DSS
options=NO_TLSv1,NO_SSLv3,SINGLE_DH_US
E,SINGLE_ECDH_USE tls-dh=prime256v1:/etc/squid/bump_dhparam.pem
http_port 3137 tcpkeepalive=60,30,3 ssl-bump
generate-host-certificates=on dynamic_cert_mem_cache_size=20MB
tls-cert=/etc/squid/bump.crt tls-key=/etc/squid/bump.key
cipher=HIGH:MEDIUM:!LOW:!RC4:!SEED:!IDEA:!3DES:!MD5:!EXP:!PSK:!DSS
options=NO_TLSv1,NO_SSLv3,SINGLE_DH_US
E,SINGLE_ECDH_USE tls-dh=prime256v1:/etc/squid/bump_dhparam.pem

acl media_files urlpath_regex -i
\.(3g2|3gp|3gpp|asf|asx|ashx|avi|bin|dat|f4v|flv|gtp|h264|m4v|mkv|mod|moov|mov|mp4|mpeg|mpg|mts|rm|rmvb|spl|srt|stl|swf|ts|vcd|vid|vob|webm|wm|wmv|yuv)
tcp_outgoing_address 10.3.0.2 media_files

acl port3128 localport 3128
acl port3129 localport 3129
acl port3130 localport 3130
acl port3131 localport 3131
acl port3132 localport 3132
acl port3133 localport 3133
acl port3134 localport 3134
acl port3135 localport 3135
acl port3136 localport 3136
acl port3137 localport 3137

tcp_outgoing_address 10.3.2.190 !media_files port3128
tcp_outgoing_address 10.3.2.191 !media_files port3129
tcp_outgoing_address 10.3.2.192 !media_files port3130
tcp_outgoing_address 10.3.2.193 !media_files port3131
tcp_outgoing_address 10.3.2.194 !media_files port3132
tcp_outgoing_address 10.3.2.195 !media_files port3133
tcp_outgoing_address 10.3.2.196 !media_files port3134
tcp_outgoing_address 10.3.2.197 !media_files port3135
tcp_outgoing_address 10.3.2.198 !media_files port3136
tcp_outgoing_address 10.3.2.199 !media_files port3137

When using HTTP (not SSL), this rules work fine, but with using HTTPS
protocol first (with debug) used rule for CONNECT, and after rules
with tcp_outgoing_address not applied.
I commented this line and rebuild squid, but no more effect

// skip if an outgoing address is already set.
// if (!conn-&gt;local.isAnyAddr()) return;

please help me

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025035.html">[squid-users] adding cache_control = nocache to http request using squid transparent proxy
</A></li>
	<LI>Next message (by thread): <A HREF="025021.html">[squid-users] Routing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25016">[ date ]</a>
              <a href="thread.html#25016">[ thread ]</a>
              <a href="subject.html#25016">[ subject ]</a>
              <a href="author.html#25016">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
