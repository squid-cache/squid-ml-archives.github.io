From squid3 at treenet.co.nz  Wed Jun  1 10:32:09 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 1 Jun 2022 22:32:09 +1200
Subject: [squid-users] squid only partially working WHY ?
In-Reply-To: <e5f3e45e-7307-6059-919f-427ad2ef795e@st-andrews.ac.uk>
References: <e5f3e45e-7307-6059-919f-427ad2ef795e@st-andrews.ac.uk>
Message-ID: <4072129f-42f7-ea52-e737-4fc8ecdd28ed@treenet.co.nz>

On 30/05/22 21:58, Ian A Taylor wrote:
> Good day
> 
> I have install ubuntu 22.04 server on 4 machines
> 
> The machines are
> 
> spark
> 
> compute-0-[0,1,2]
> 
> spark has an internet connect plus a connection to a restricted 
> (10.1.1.0/24) network
> 
> compute-0-[0,1,2] are on the restricted network
> 
> 2 of the three compute-0-[0,1,2] machines install with snap ok
> 
> but the third fails
> 
> I cannot see why
> 

Spot the difference:


> 1653903468.117????? 1 10.1.1.252 TCP_MISS/500 5394 POST 
> http://snaps.spark.internal/v2/snaps/refresh - HIER_NONE/- text/html

> 1653903485.009? 51235 10.1.1.253 TCP_TUNNEL/200 117316495 CONNECT 
> canonical-lgw01.cdn.snapcraftcontent.com:443 - HIER_DIRECT/185.125.190.27 -


> 
> spark:/etc/squid/squid.conf
> acl localnet src 10.1.1.254/32
> acl localnet src 10.1.1.253/32
> acl localnet src 10.1.1.252/32
> 
> If someone could indicate why this is happening I would be sincerely 
> appreciative
> 

The traffic which is failing all seems to have *.internal domain names.

The HIER_NONE indicates Squid either cannot resolve those domains in DNS 
or cannot connect to any IP that was found.


Modern Squid are capable of resolving mDNS .local domains. I suggest you 
try using that instead of a custom .internal TLD. If you do need to have 
that custom TLD, make sure to test those domains resolve through the DNS 
server used by Squid.

HTH
Amos


From pponakanti at roblox.com  Wed Jun  1 21:31:46 2022
From: pponakanti at roblox.com (Praveen Ponakanti)
Date: Wed, 1 Jun 2022 14:31:46 -0700
Subject: [squid-users] Scaling concurrent TCP sessions beyond ephemeral
 port range
In-Reply-To: <5856354a-393a-0803-e3e6-da29f8f7d8b1@treenet.co.nz>
References: <CACabJxP86UGm_dm+PbyckMWoxiis2fc87jwyQq+uXHXAKm=AfA@mail.gmail.com>
 <f7f62043-e384-0395-6d0f-ff4d510b0baf@measurement-factory.com>
 <CACabJxNv5+o7AiY-tfuJ=_V4ZBNEks=dX4ki2YQBHcPPpUrABg@mail.gmail.com>
 <5856354a-393a-0803-e3e6-da29f8f7d8b1@treenet.co.nz>
Message-ID: <CACabJxPPwF1ZpGbhU2zXnzcEKkvt1Jej7aygzSxYXTEOfTEX=w@mail.gmail.com>

Hi,

We have patched in a small code diff to add the IP_BIND_ADDRESS_NO_PORT
sockopt flag and it has been working fine as we can see outbound TCP ports
being reused with different destination IP addresses.

Have some followup questions.
A lot of the client requests in our setup go to a small set of destination
webservers ( < 10), so we still run the risk of running out of ports for
concurrent connections to a single destination webserver. We have not
enabled the squid for caching and run multiple instances each with 30
workers.
- Is there some config knob available to have squid efficiently reuse
outbound connections across multiple client requests? It appears that each
client's request creates a separate TCP connection to the dest webserver
even if they are the same. This happens for both HTTP and HTTPS. How do we
enable connection pooling if that is available with squid?
- If this is something that isn't supported with v5.5, do you
recommend investigating code modifications to allow the reuse of outbound
connections? Any suggestions or gotchas before we go about this approach?

We have looked into the multiple tcp_oubound_adress option but would prefer
not to go that route.

Thanks
Praveen


On Fri, May 20, 2022 at 9:31 PM Amos Jeffries <squid3 at treenet.co.nz> wrote:

> On 20/05/22 19:44, Praveen Ponakanti wrote:
> > Hi Alex,
> >
> > Thanks for going through several steps to help mitigate src port
> > exhaustion. We are looking to achieve 400-500% more
> > concurrent connections if we could :) as there is a significant buffer
> > on the available CPU.
>
> Then you require at least 4, maybe 5, IP addresses to handle that many
> concurrent connections with Squid.
>
>
> > The option to use multiple tcp_outoing_addresses appears to be promising
> > along with some tweaks to the TCP timeouts. I guess we could use ACLs to
> > pick a different outbound IP based on the requesting client's prefix. We
> > had not considered that option as the ephemeral ports were no longer
> > available to other applications when squid uses most of them with a
> > single outbound IP configured. We are also looking to modify the code to
> > use the IP_BIND_ADDRESS_NO_PORT sockopt as that could help delay port
> > assignment with the bind() call on the outbound TCP sessions (to
> > hopefully allow access to the 4-tuple on the socket).
>
> Patches welcome.
>
> However, please be aware that use of the 4-tuple is often no different
> from the 3-tuple since the dst-port is typically identical for all
> outgoing traffic to a given dst-IP.
>
>
> Cheers
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220601/af8988c8/attachment.htm>

From roeeklinger60 at gmail.com  Mon Jun  6 16:21:54 2022
From: roeeklinger60 at gmail.com (roee klinger)
Date: Mon, 6 Jun 2022 19:21:54 +0300
Subject: [squid-users] How to make sure my Squid has no known
 vulnerabilities?
Message-ID: <CAGCa14qmF3Y95NWokrDbkrCjsKV1g6Dqy=5txatLnT9dBJqVKg@mail.gmail.com>

Hello,

I am installing Squid in Docker (Debian Buster) using Aptitude, the current
latest version that is being installed is Squid 4.6-1+deb10u6, today I was
contacted by a client that noticed we are using the Squid version 4.6,
which is an old version, and he mentioned that there are a few
known vulnerabilities with this old version, mainly he was bothered by
these:

CVE-2019-13345
CVE-2019-12529
CVE-2019-12527
CVE-2019-12525
CVE-2020-8450
CVE-2020-8449
CVE-2019-12528
CVE-2020-8517
CVE-2020-11945
CVE-2019-12519
CVE-2019-12521


I have checked the available Debian packages, and it seems I am indeed
running the latest available version that is provided by Aptitude, which is
Squid 4.6, it seems that to get Squid 5.5, I will have to use Debian
Bookworm.

Is the version of Squid that I am using backported with security patches
that cover the vulnerabilities above or do I have to install Squid 5.6 /
5.5 to get the latest security?

Thanks,
Roee
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220606/56d5b426/attachment.htm>

From uhlar at fantomas.sk  Tue Jun  7 12:43:22 2022
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Tue, 7 Jun 2022 14:43:22 +0200
Subject: [squid-users] How to make sure my Squid has no known
 vulnerabilities?
In-Reply-To: <CAGCa14qmF3Y95NWokrDbkrCjsKV1g6Dqy=5txatLnT9dBJqVKg@mail.gmail.com>
References: <CAGCa14qmF3Y95NWokrDbkrCjsKV1g6Dqy=5txatLnT9dBJqVKg@mail.gmail.com>
Message-ID: <Yp9H6px+IRGPZBD7@fantomas.sk>

On 06.06.22 19:21, roee klinger wrote:
>I am installing Squid in Docker (Debian Buster) using Aptitude, the current
>latest version that is being installed is Squid 4.6-1+deb10u6, today I was
>contacted by a client that noticed we are using the Squid version 4.6,
>which is an old version, and he mentioned that there are a few
>known vulnerabilities with this old version, mainly he was bothered by
>these:
>
>CVE-2019-13345

https://security-tracker.debian.org/tracker/CVE-2019-13345
= marked as fixed.

>CVE-2019-12529
>CVE-2019-12527
>CVE-2019-12525
>CVE-2020-8450
>CVE-2020-8449
>CVE-2019-12528
>CVE-2020-8517
>CVE-2020-11945
>CVE-2019-12519
>CVE-2019-12521

the same usually applies.

>I have checked the available Debian packages, and it seems I am indeed
>running the latest available version that is provided by Aptitude, which is
>Squid 4.6, it seems that to get Squid 5.5, I will have to use Debian
>Bookworm.
>
>Is the version of Squid that I am using backported with security patches

nearly all debian versions of nearly all packages contain security patched 
backported to installed versions.

you can check on https://security-tracker.debian.org/tracker/

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
"They say when you play that M$ CD backward you can hear satanic messages."
"That's nothing. If you play it forward it will install Windows."


From squid3 at treenet.co.nz  Tue Jun  7 15:58:42 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 8 Jun 2022 03:58:42 +1200
Subject: [squid-users] How to make sure my Squid has no known
 vulnerabilities?
In-Reply-To: <Yp9H6px+IRGPZBD7@fantomas.sk>
References: <CAGCa14qmF3Y95NWokrDbkrCjsKV1g6Dqy=5txatLnT9dBJqVKg@mail.gmail.com>
 <Yp9H6px+IRGPZBD7@fantomas.sk>
Message-ID: <60c8c17c-2e1d-5ca9-1a25-a81a955a9485@treenet.co.nz>

On 8/06/22 00:43, Matus UHLAR - fantomas wrote:
> nearly all debian versions of nearly all packages contain security 
> patched backported to installed versions.
> 
> you can check on https://security-tracker.debian.org/tracker/
> 


FTR, the page there for Squid is:
<https://security-tracker.debian.org/tracker/source-package/squid>

Amos


From ngtech1ltd at gmail.com  Sat Jun 11 21:19:27 2022
From: ngtech1ltd at gmail.com (Eliezer Croitoru)
Date: Sun, 12 Jun 2022 00:19:27 +0300
Subject: [squid-users] Squid-Cache Zoom is coming
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAG15AYh8TcJOh7jZfP/beGvCgAAAEAAAAN0pmZOT0JVOjRMRlUTIsZkBAAAAAA==@gmail.com>

Hey Everyone,

 

I have been working on a series of zoom meetings on Squid-Cache from 0 to
hero.

It's sort of a meet up with a basic agenda.

I would like to find the right time for these meetings and to put up a list
of subjects that I will touch in them.

However I would like to make some registration process for it to be
efficient.

 

Please if you are willing to participate give the thumbs up here in the list
or privately and I will try to put a date for these meetings.

 

Thanks,

Eliezer

 

----

Eliezer Croitoru

NgTech, Tech Support

Mobile: +972-5-28704261

Email:  <mailto:ngtech1ltd at gmail.com> ngtech1ltd at gmail.com

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220612/e9fc5837/attachment.htm>

From robertocarna36 at gmail.com  Mon Jun 13 18:17:15 2022
From: robertocarna36 at gmail.com (Roberto Carna)
Date: Mon, 13 Jun 2022 15:17:15 -0300
Subject: [squid-users] sftp through Squid: sftp error with proxy:
 command-line line 0 bad protocol 2 host key algorithms +ssh-dss
Message-ID: <CAG2Qp6vMD9_6-XOu1K_zyQW5=eC1fkS0xtuX4pG5yJ2LLcXvbQ@mail.gmail.com>

Dear all, I have an Ubuntu 22.04 with Squid package, and I've
configured it in order to let pass ssh protocol to Internet.

>From the own proxy, if I execute:

$ sftp -v -oConnectTimeout=20 -oPoxyCommand='nc -X connect -x
10.12.1.1:8080 %h %p' -oPort 60000 user at x.x.x.x

I can login successfully.

But if I try to connect with sftp from a host behind the proxy 10.12.1.1:8080:

$ sftp -v -oHostKeyAlgorithms=+ssh-dss -oConnectTimeout=20
-oPoxyCommand='nc -X connect -x 10.12.1.1:8080 %h %p' -oPort 60000
user at x.x.x.x

I get this error:

command-line line 0: Bad protocol 2 host key algorithms '+ssh-dss'.
Couldn't read packet: connection reset by peer.

What can be the cause of this error, trying to use sftp from a host
behind my Squid proxy?

Thanks a lot and regards!!!


From Matt.Toler at netapp.com  Mon Jun 13 22:35:51 2022
From: Matt.Toler at netapp.com (Toler, Matt)
Date: Mon, 13 Jun 2022 22:35:51 +0000
Subject: [squid-users] Reloading squid service results in connection resets
Message-ID: <DS7PR06MB6789C5AD65B4455DD7E9B228E9AB9@DS7PR06MB6789.namprd06.prod.outlook.com>

Hello!

I hope you all are well. We've run into a troublesome issue and hope to get some guidance.

We have an automated workflow that will reload the squid configuration if any changes are made. In our use case the changes are dynamic and happen often. We were able to determine that frequency isn't the problem as the issue can be manually reproduced in the absents of any automation or significant load.

Environment:
OS: RHEL 7.9
Kernel: 3.10.0-1160.62.1.el7.x86_64
Squid: 4.14

In our test case we're using the AWS CLI to get information from EC2 instances. While looping "ec2 describe-instances" through the squid via a load balancer everything works great until we reload the service. Most times the command will pause and return the requested output after a few more seconds. However, more times than is tolerable when the service is reloading the command will return error "Failed to connect to proxy URL" to the client. With the AWS CLI debug enabled before the "Failed to connect to proxy URL" is thrown we see "ConnectionResetError: [Errno 104] Connection reset by peer". We then ran packet captures and were able to determine that the reset was coming from the server running squid at the time the service was reloading. This connection is not logged by squid at all which was confusing to us that we had any client connection issues as the squid logs are clean. We are reloading the service with systemd but were able to reproduce the issue with "squid -k reconfigure" as well.

Our current plan is to upgrade our servers to RHEL8 and compile squid 5.6 in hopes that this issue will go away but we may need to go so far as programmatically removing a given squid node from the Load balancer before any service reload.

That said, it was our understanding that reloading the service would not disturb any old connections and new connections would receive the new configuration. We were wondering if anyone else has encountered any issues with connection resets of client traffic during squid service reload? Or may otherwise have any thoughts on this issue. Please let me know if I can provide any further detail.

Thanks in advance.

Regards,
Matt







-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220613/0c472565/attachment.htm>

From rousskov at measurement-factory.com  Tue Jun 14 01:04:03 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Mon, 13 Jun 2022 21:04:03 -0400
Subject: [squid-users] Reloading squid service results in connection
 resets
In-Reply-To: <DS7PR06MB6789C5AD65B4455DD7E9B228E9AB9@DS7PR06MB6789.namprd06.prod.outlook.com>
References: <DS7PR06MB6789C5AD65B4455DD7E9B228E9AB9@DS7PR06MB6789.namprd06.prod.outlook.com>
Message-ID: <832548b0-81ff-067c-7ea4-6629e34845b6@measurement-factory.com>

On 6/13/22 18:35, Toler, Matt wrote:

> That said, it was our understanding that reloading the service would not 
> disturb any old connections 

That is an oversimplified and somewhat optimistic view. Said that, most 
old connections indeed survive reconfiguration in most environments.


> and new connections would receive the new configuration.

That is correct only _after_ Squid starts listening for new connections 
again (as your experience can demonstrate).


> We were wondering if anyone else has encountered any 
> issues with connection resets of client traffic during squid service 
> reload? Or may otherwise have any thoughts on this issue.

The lack of smooth reconfiguration support is a known problem that has 
been discussed and is being addressed. Here are a few recent related 
discussions:

http://lists.squid-cache.org/pipermail/squid-users/2022-March/024675.html

http://lists.squid-cache.org/pipermail/squid-users/2022-May/024778.html


HTH,

Alex.


From uhlar at fantomas.sk  Tue Jun 14 07:16:51 2022
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Tue, 14 Jun 2022 09:16:51 +0200
Subject: [squid-users] sftp through Squid: sftp error with proxy:
 command-line line 0 bad protocol 2 host key algorithms +ssh-dss
In-Reply-To: <CAG2Qp6vMD9_6-XOu1K_zyQW5=eC1fkS0xtuX4pG5yJ2LLcXvbQ@mail.gmail.com>
References: <CAG2Qp6vMD9_6-XOu1K_zyQW5=eC1fkS0xtuX4pG5yJ2LLcXvbQ@mail.gmail.com>
Message-ID: <Yqg140l9I1ef2a55@fantomas.sk>

On 13.06.22 15:17, Roberto Carna wrote:
>Dear all, I have an Ubuntu 22.04 with Squid package, and I've
>configured it in order to let pass ssh protocol to Internet.
>
>From the own proxy, if I execute:
>
>$ sftp -v -oConnectTimeout=20 -oPoxyCommand='nc -X connect -x
>10.12.1.1:8080 %h %p' -oPort 60000 user at x.x.x.x
>
>I can login successfully.
>
>But if I try to connect with sftp from a host behind the proxy 10.12.1.1:8080:
>
>$ sftp -v -oHostKeyAlgorithms=+ssh-dss -oConnectTimeout=20
>-oPoxyCommand='nc -X connect -x 10.12.1.1:8080 %h %p' -oPort 60000
>user at x.x.x.x
>
>I get this error:
>
>command-line line 0: Bad protocol 2 host key algorithms '+ssh-dss'.
>Couldn't read packet: connection reset by peer.

you use option "HostKeyAlgorithms=+ssh-dss" and sftp does not like it.

>What can be the cause of this error, trying to use sftp from a host
>behind my Squid proxy?

This is not a squid issue, if it only happens with sftp.
it looks like your sftp client complaining, even without using proxy.

btw I use "connect-proxy" command instead of "nc"

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Linux IS user friendly, it's just selective who its friends are...


From simwin at mail.ru  Tue Jun 14 14:07:36 2022
From: simwin at mail.ru (simwin)
Date: Tue, 14 Jun 2022 17:07:36 +0300
Subject: [squid-users] There is the problems with instagram images and videos
Message-ID: <20220614170736.543895f8@vs>

Hi! There is the problems with instagram - I can see only text
without photos and videos. 

This is the errors in browsers console:

16:52:51.024 Subsequent non-fatal errors won't be logged; see
https://fburl.com/debugjs. GyaOhXSa8tR.js:56:563

errorListener
https://static.cdninstagram.com/rsrc.php/v3/yK/r/GyaOhXSa8tR.js?_nc_x=Ij3Wp8lg5Kz:56
reportNormalizedError
https://static.cdninstagram.com/rsrc.php/v3/yK/r/GyaOhXSa8tR.js?_nc_x=Ij3Wp8lg5Kz:56
reportError
https://static.cdninstagram.com/rsrc.php/v3/yK/r/GyaOhXSa8tR.js?_nc_x=Ij3Wp8lg5Kz:56
k
https://static.cdninstagram.com/rsrc.php/v3i7Br4/yh/l/ru_RU/0THwjINDuU0.js?_nc_x=Ij3Wp8lg5Kz:899
a
https://static.cdninstagram.com/rsrc.php/v3i7Br4/yh/l/ru_RU/0THwjINDuU0.js?_nc_x=Ij3Wp8lg5Kz:900
x
https://static.cdninstagram.com/rsrc.php/v3i7Br4/yh/l/ru_RU/0THwjINDuU0.js?_nc_x=Ij3Wp8lg5Kz:896
a
https://static.cdninstagram.com/rsrc.php/v3/yK/r/GyaOhXSa8tR.js?_nc_x=Ij3Wp8lg5Kz:220
m
https://static.cdninstagram.com/rsrc.php/v3/yK/r/GyaOhXSa8tR.js?_nc_x=Ij3Wp8lg5Kz:147
q
https://static.cdninstagram.com/rsrc.php/v3/yK/r/GyaOhXSa8tR.js?_nc_x=Ij3Wp8lg5Kz:147
applyWithGuard
https://static.cdninstagram.com/rsrc.php/v3/yK/r/GyaOhXSa8tR.js?_nc_x=Ij3Wp8lg5Kz:56
c
https://static.cdninstagram.com/rsrc.php/v3/yK/r/GyaOhXSa8tR.js?_nc_x=Ij3Wp8lg5Kz:56
e
https://static.cdninstagram.com/rsrc.php/v3/yK/r/GyaOhXSa8tR.js?_nc_x=Ij3Wp8lg5Kz:143
r
https://static.cdninstagram.com/rsrc.php/v3/yK/r/GyaOhXSa8tR.js?_nc_x=Ij3Wp8lg5Kz:143
onmessage
https://static.cdninstagram.com/rsrc.php/v3/yK/r/GyaOhXSa8tR.js?_nc_x=Ij3Wp8lg5Kz:143

16:52:51.026 A request from an outside source is blocked: The Single source
policy prohibits reading a remote resource on
https://graph.instagram.com/logging_client_events . (Reason: CORS request
failed). Status code: (null).

16:53:17.750 A request from an outside source is blocked: The Single source
policy prohibits reading a remote resource on
https://scontent-hel3-1.cdninstagram.com/v/t51.2885-19/82690581_2710077395747525_6629318554367819776_n.jpg?stp=dst-jpg_s150x150&_nc_ht=scontent-hel3-1.cdninstagram.com&_nc_cat=105&_nc_ohc=ctOErYLKsNAAX9tXH6M&edm=AJ9x6zYBAAAA&ccb=7-5&oh=00_AT85lFWnwrBmMMuEgs_q4E2WyNALHSTtKfbcOwA0pfA1eA&oe=62AD7CD2&_nc_sid=cff2a4
. (Reason: CORS request failed). Status code: (null)

My squid config, Debian 11:

grep -vE '^$|^#' /etc/squid/squid.conf

auth_param basic program /usr/lib/squid/basic_ncsa_auth
/etc/squid/internet_users
auth_param basic children 5
auth_param basic realm Sasic Authentication
auth_param basic credentialsttl 8 hours
auth_param basic casesensitive on
acl auth_users proxy_auth REQUIRED
http_access allow auth_users
acl localnet src 0.0.0.1-0.255.255.255	# RFC 1122 "this" network (LAN)
acl localnet src 10.0.0.0/8		# RFC 1918 local private network
(LAN)
acl localnet src 100.64.0.0/10		# RFC 6598 shared address space
(CGN)
acl localnet src 169.254.0.0/16 	# RFC 3927 link-local (directly
plugged) machines
acl localnet src 172.16.0.0/12		# RFC 1918 local private network
(LAN)
acl localnet src 192.168.0.0/16		# RFC 1918 local private network
(LAN)
acl localnet src fc00::/7       	# RFC 4193 local private network range
acl localnet src fe80::/10      	# RFC 4291 link-local (directly
plugged) machines
acl SSL_ports port 443
acl Safe_ports port 80		# http
acl Safe_ports port 21		# ftp
acl Safe_ports port 443		# https
acl Safe_ports port 70		# gopher
acl Safe_ports port 210		# wais
acl Safe_ports port 1025-65535	# unregistered ports
acl Safe_ports port 280		# http-mgmt
acl Safe_ports port 488		# gss-http
acl Safe_ports port 591		# filemaker
acl Safe_ports port 777		# multiling http
acl CONNECT method CONNECT
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow localhost manager
http_access deny manager
include /etc/squid/conf.d/*
http_access allow localhost
http_access deny all
http_port xxx.xxx.xxx.xxx:xxxx (hidden) 
sslproxy_cert_error allow all
sslcrtd_program /usr/lib/squid/security_file_certgen -s /var/spool/ssl_db -M
20MB
coredump_dir /var/spool/squid
refresh_pattern ^ftp:		1440	20%	10080
refresh_pattern ^gopher:	1440	0%	1440
refresh_pattern -i (/cgi-bin/|\?) 0	0%	0
refresh_pattern .		0	20%	4320
request_header_access Allow allow all
request_header_access Authorization allow all
request_header_access WWW-Authenticate allow all
request_header_access Proxy-Authorization allow all
request_header_access Proxy-Authenticate allow all
request_header_access Cache-Control allow all
request_header_access Content-Encoding allow all
request_header_access Content-Length allow all
request_header_access Content-Type allow all
request_header_access Date allow all
request_header_access Expires allow all
request_header_access Host allow all
request_header_access If-Modified-Since allow all
request_header_access Last-Modified allow all
request_header_access Location allow all
request_header_access Pragma allow all
request_header_access Accept allow all
request_header_access Accept-Charset allow all
request_header_access Accept-Encoding allow all
request_header_access Accept-Language allow all
request_header_access Content-Language allow all
request_header_access Mime-Version allow all
request_header_access Retry-After allow all
request_header_access Title allow all
request_header_access Connection allow all
request_header_access Proxy-Connection allow all
request_header_access User-Agent allow all
request_header_access Cookie allow all
request_header_access All deny all
icap_enable off
icap_service service_req reqmod_precache bypass=1 icap://127.0.0.1:1344/request
icap_service service_resp respmod_precache bypass=0
icap://127.0.0.1:1344/response
icap_class class_req service_req
icap_class class_resp service_resp
icap_access class_req allow all
icap_access class_resp allow all

=========================================

Please check it. 





From uhlar at fantomas.sk  Tue Jun 14 14:57:05 2022
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Tue, 14 Jun 2022 16:57:05 +0200
Subject: [squid-users] There is the problems with instagram images and
 videos
In-Reply-To: <20220614170736.543895f8@vs>
References: <20220614170736.543895f8@vs>
Message-ID: <YqihwZ8+Qq41we7N@fantomas.sk>

On 14.06.22 17:07, simwin wrote:
>Hi! There is the problems with instagram - I can see only text
>without photos and videos.
>
>This is the errors in browsers console:
>
>16:52:51.024 Subsequent non-fatal errors won't be logged; see
>https://fburl.com/debugjs. GyaOhXSa8tR.js:56:563

>16:52:51.026 A request from an outside source is blocked: The Single source
>policy prohibits reading a remote resource on
>https://graph.instagram.com/logging_client_events . (Reason: CORS request
>failed). Status code: (null).

if a browser prohibits this, squid can't do anything with it.
Have you tried without proxy?


>16:53:17.750 A request from an outside source is blocked: The Single source
>policy prohibits reading a remote resource on
>https://scontent-hel3-1.cdninstagram.com/v/t51.2885-19/82690581_2710077395747525_6629318554367819776_n.jpg?stp=dst-jpg_s150x150&_nc_ht=scontent-hel3-1.cdninstagram.com&_nc_cat=105&_nc_ohc=ctOErYLKsNAAX9tXH6M&edm=AJ9x6zYBAAAA&ccb=7-5&oh=00_AT85lFWnwrBmMMuEgs_q4E2WyNALHSTtKfbcOwA0pfA1eA&oe=62AD7CD2&_nc_sid=cff2a4
>. (Reason: CORS request failed). Status code: (null)
>
>My squid config, Debian 11:
>
>grep -vE '^$|^#' /etc/squid/squid.conf
>
>include /etc/squid/conf.d/*

is there anything in there?

>http_port xxx.xxx.xxx.xxx:xxxx (hidden)

don't hide this. Hite the IP, not the rest.

>sslproxy_cert_error allow all
>sslcrtd_program /usr/lib/squid/security_file_certgen -s /var/spool/ssl_db -M
>20MB

do you use ssl_bump?

>request_header_access Allow allow all
>request_header_access Authorization allow all
>request_header_access WWW-Authenticate allow all
>request_header_access Proxy-Authorization allow all
>request_header_access Proxy-Authenticate allow all
>request_header_access Cache-Control allow all
>request_header_access Content-Encoding allow all
>request_header_access Content-Length allow all
>request_header_access Content-Type allow all
>request_header_access Date allow all
>request_header_access Expires allow all
>request_header_access Host allow all
>request_header_access If-Modified-Since allow all
>request_header_access Last-Modified allow all
>request_header_access Location allow all
>request_header_access Pragma allow all
>request_header_access Accept allow all
>request_header_access Accept-Charset allow all
>request_header_access Accept-Encoding allow all
>request_header_access Accept-Language allow all
>request_header_access Content-Language allow all
>request_header_access Mime-Version allow all
>request_header_access Retry-After allow all
>request_header_access Title allow all
>request_header_access Connection allow all
>request_header_access Proxy-Connection allow all
>request_header_access User-Agent allow all
>request_header_access Cookie allow all
>request_header_access All deny all

first try commenting this out.

>icap_enable off
>icap_service service_req reqmod_precache bypass=1 icap://127.0.0.1:1344/request
>icap_service service_resp respmod_precache bypass=0
>icap://127.0.0.1:1344/response
>icap_class class_req service_req
>icap_class class_resp service_resp
>icap_access class_req allow all
>icap_access class_resp allow all

then try without icap

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Despite the cost of living, have you noticed how popular it remains?


From simwin at mail.ru  Tue Jun 14 15:01:41 2022
From: simwin at mail.ru (simwin)
Date: Tue, 14 Jun 2022 18:01:41 +0300
Subject: [squid-users] There is the problems with instagram images and
 videos
In-Reply-To: <YqihwZ8+Qq41we7N@fantomas.sk>
References: <20220614170736.543895f8@vs>
	<YqihwZ8+Qq41we7N@fantomas.sk>
Message-ID: <20220614180141.092824f7@vs>

? Tue, 14 Jun 2022 16:57:05 +0200
Matus UHLAR - fantomas <uhlar at fantomas.sk>:

> if a browser prohibits this, squid can't do anything with it.
> Have you tried without proxy?

Yes, it works fine without squid proxy and with ssh-tunnel proxy from my
localhost, but with danted proxy I have the same problem - no images and no
videos



From uhlar at fantomas.sk  Tue Jun 14 15:52:06 2022
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Tue, 14 Jun 2022 17:52:06 +0200
Subject: [squid-users] There is the problems with instagram images and
 videos
In-Reply-To: <20220614180141.092824f7@vs>
References: <20220614170736.543895f8@vs> <YqihwZ8+Qq41we7N@fantomas.sk>
 <20220614180141.092824f7@vs>
Message-ID: <Yqiupn+lKA5IdEp3@fantomas.sk>

>? Tue, 14 Jun 2022 16:57:05 +0200
>Matus UHLAR - fantomas <uhlar at fantomas.sk>:
>> if a browser prohibits this, squid can't do anything with it.
>> Have you tried without proxy?

On 14.06.22 18:01, simwin wrote:
>Yes, it works fine without squid proxy and with ssh-tunnel proxy from my
>localhost, but with danted proxy I have the same problem - no images and no
>videos

as first turn off all attempts to tune your squid and go with default 
config.

Then, you can trace which configuration directive causes it.

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Posli tento mail 100 svojim znamim - nech vidia aky si idiot
Send this email to 100 your friends - let them see what an idiot you are


From simwin at mail.ru  Tue Jun 14 21:16:45 2022
From: simwin at mail.ru (simwin)
Date: Wed, 15 Jun 2022 00:16:45 +0300
Subject: [squid-users] There is the problems with instagram images and
 videos
In-Reply-To: <Yqiupn+lKA5IdEp3@fantomas.sk>
References: <20220614170736.543895f8@vs> <YqihwZ8+Qq41we7N@fantomas.sk>
 <20220614180141.092824f7@vs> <Yqiupn+lKA5IdEp3@fantomas.sk>
Message-ID: <20220615001645.0b13681e@vs>


? Tue, 14 Jun 2022 17:52:06 +0200
Matus UHLAR - fantomas <uhlar at fantomas.sk> ?????:

> >? Tue, 14 Jun 2022 16:57:05 +0200
> >Matus UHLAR - fantomas <uhlar at fantomas.sk>:  
> >> if a browser prohibits this, squid can't do anything with it.
> >> Have you tried without proxy?  
> 
> On 14.06.22 18:01, simwin wrote:
> >Yes, it works fine without squid proxy and with ssh-tunnel proxy from my
> >localhost, but with danted proxy I have the same problem - no images and no
> >videos  
> 
> as first turn off all attempts to tune your squid and go with default 
> config.
> Then, you can trace which configuration directive causes it.

Ok. My default config see below, the result is the same - no intagram images, no
videos :(

$ grep -vE '^$|^#' /etc/squid/squid.conf

auth_param basic program /usr/lib/squid/basic_ncsa_auth
/etc/squid/internet_users acl auth_users proxy_auth REQUIRED
http_access allow auth_users
auth_param basic casesensitive on
acl localnet src 0.0.0.1-0.255.255.255	# RFC 1122 "this" network (LAN)
acl localnet src 10.0.0.0/8		# RFC 1918 local private network
(LAN) acl localnet src 100.64.0.0/10		# RFC 6598 shared address
space (CGN) acl localnet src 169.254.0.0/16 	# RFC 3927 link-local
(directly plugged) machines acl localnet src 172.16.0.0/12		# RFC
1918 local private network (LAN) acl localnet src 192.168.0.0/16
# RFC 1918 local private network (LAN) acl localnet src fc00::/7
# RFC 4193 local private network range acl localnet src fe80::/10
# RFC 4291 link-local (directly plugged) machines acl SSL_ports port 443
acl Safe_ports port 80		# http
acl Safe_ports port 21		# ftp
acl Safe_ports port 443		# https
acl Safe_ports port 70		# gopher
acl Safe_ports port 210		# wais
acl Safe_ports port 1025-65535	# unregistered ports
acl Safe_ports port 280		# http-mgmt
acl Safe_ports port 488		# gss-http
acl Safe_ports port 591		# filemaker
acl Safe_ports port 777		# multiling http
acl CONNECT method CONNECT
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow localhost manager
http_access deny manager
include /etc/squid/conf.d/*
http_access allow localhost
http_access deny all
http_port xxx.xxx.xxx.xxx:3128 (hidden)
coredump_dir /var/spool/squid
refresh_pattern ^ftp:		1440	20%	10080
refresh_pattern ^gopher:	1440	0%	1440
refresh_pattern -i (/cgi-bin/|\?) 0	0%	0
refresh_pattern .		0	20%	4320
 


From ngtech1ltd at gmail.com  Tue Jun 14 21:36:55 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Wed, 15 Jun 2022 00:36:55 +0300
Subject: [squid-users] There is the problems with instagram images and
 videos
In-Reply-To: <20220615001645.0b13681e@vs>
References: <20220614170736.543895f8@vs> <YqihwZ8+Qq41we7N@fantomas.sk>
 <20220614180141.092824f7@vs> <Yqiupn+lKA5IdEp3@fantomas.sk>
 <20220615001645.0b13681e@vs>
Message-ID: <000001d88036$dee3f3e0$9cabdba0$@gmail.com>

Hey,

You have reduced the conf.
We are not trying to guess....
You can either share your entire configuration or just to not ask.
We cannot try to help you if we are missing parts of the configuration.
( leaving aside the ip addresses and confidential information)
You should share both squid.conf and every included config file and also the relevant access.log details.

Eliezer

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of simwin
Sent: Wednesday, 15 June 2022 0:17
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] There is the problems with instagram images and videos


? Tue, 14 Jun 2022 17:52:06 +0200
Matus UHLAR - fantomas <uhlar at fantomas.sk> ?????:

> >? Tue, 14 Jun 2022 16:57:05 +0200
> >Matus UHLAR - fantomas <uhlar at fantomas.sk>:  
> >> if a browser prohibits this, squid can't do anything with it.
> >> Have you tried without proxy?  
> 
> On 14.06.22 18:01, simwin wrote:
> >Yes, it works fine without squid proxy and with ssh-tunnel proxy from my
> >localhost, but with danted proxy I have the same problem - no images and no
> >videos  
> 
> as first turn off all attempts to tune your squid and go with default 
> config.
> Then, you can trace which configuration directive causes it.

Ok. My default config see below, the result is the same - no intagram images, no
videos :(

$ grep -vE '^$|^#' /etc/squid/squid.conf

auth_param basic program /usr/lib/squid/basic_ncsa_auth
/etc/squid/internet_users acl auth_users proxy_auth REQUIRED
http_access allow auth_users
auth_param basic casesensitive on
acl localnet src 0.0.0.1-0.255.255.255	# RFC 1122 "this" network (LAN)
acl localnet src 10.0.0.0/8		# RFC 1918 local private network
(LAN) acl localnet src 100.64.0.0/10		# RFC 6598 shared address
space (CGN) acl localnet src 169.254.0.0/16 	# RFC 3927 link-local
(directly plugged) machines acl localnet src 172.16.0.0/12		# RFC
1918 local private network (LAN) acl localnet src 192.168.0.0/16
# RFC 1918 local private network (LAN) acl localnet src fc00::/7
# RFC 4193 local private network range acl localnet src fe80::/10
# RFC 4291 link-local (directly plugged) machines acl SSL_ports port 443
acl Safe_ports port 80		# http
acl Safe_ports port 21		# ftp
acl Safe_ports port 443		# https
acl Safe_ports port 70		# gopher
acl Safe_ports port 210		# wais
acl Safe_ports port 1025-65535	# unregistered ports
acl Safe_ports port 280		# http-mgmt
acl Safe_ports port 488		# gss-http
acl Safe_ports port 591		# filemaker
acl Safe_ports port 777		# multiling http
acl CONNECT method CONNECT
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow localhost manager
http_access deny manager
include /etc/squid/conf.d/*
http_access allow localhost
http_access deny all
http_port xxx.xxx.xxx.xxx:3128 (hidden)
coredump_dir /var/spool/squid
refresh_pattern ^ftp:		1440	20%	10080
refresh_pattern ^gopher:	1440	0%	1440
refresh_pattern -i (/cgi-bin/|\?) 0	0%	0
refresh_pattern .		0	20%	4320
 
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From ngtech1ltd at gmail.com  Tue Jun 14 22:05:44 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Wed, 15 Jun 2022 01:05:44 +0300
Subject: [squid-users] Reloading squid service results in connection
 resets
In-Reply-To: <DS7PR06MB6789C5AD65B4455DD7E9B228E9AB9@DS7PR06MB6789.namprd06.prod.outlook.com>
References: <DS7PR06MB6789C5AD65B4455DD7E9B228E9AB9@DS7PR06MB6789.namprd06.prod.outlook.com>
Message-ID: <000301d8803a$e59efcd0$b0dcf670$@gmail.com>

Hey Matt,

 

Can you please verify what is the size of the squid.conf and all of the related files?

How long does it take to reload the configuration?

I do not know the exact details but it?s recommended that you will upgrade to the latest 4.x or 5.x.
If this scenario is re-producible in another environment it?s possible that the issue itself might be found to some degree.

I have here a local virtual server with Oracle Enterprise Linux 8 which runs squid 5.15 with lots of helpers in a 

quite complex config that is being reconfigured enough to state that it?s a weird issue.

 

>From my experience it?s possible to implement a helper that will be able to reconfigure without any squid
reload or reconfiguration and I believe it?s the right way to do things.

It?s a better and faster path then fixing squid source code and reconfiguration sequence or write another proxy.

(just to be clear)

 

I am working on a series of zoom meetings: ?Squid-Cache from 0 to hero? and I am trying to collect use cases
that I will be able to discuss and demonstrate a practical solution for these.

 

Please feel free to shed more light on the scenario so I would be able to maybe use your case for the benefit
of the Squid-Users community.

 

Thanks,

Eliezer

 

*	If anyone else have a scenario and use case please flood the Squid-Users and we will try to help you
*	The Squid-Cache community encourages questions even the hardest or the dumbest, we like them all ;(

 

From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Toler, Matt
Sent: Tuesday, 14 June 2022 1:36
To: squid-users at lists.squid-cache.org
Subject: [squid-users] Reloading squid service results in connection resets

 

Hello!

 

I hope you all are well. We?ve run into a troublesome issue and hope to get some guidance. 

 

We have an automated workflow that will reload the squid configuration if any changes are made. In our use case the changes are dynamic and happen often. We were able to determine that frequency isn?t the problem as the issue can be manually reproduced in the absents of any automation or significant load.

 

Environment:

OS: RHEL 7.9

Kernel: 3.10.0-1160.62.1.el7.x86_64

Squid: 4.14

 

In our test case we?re using the AWS CLI to get information from EC2 instances. While looping ?ec2 describe-instances? through the squid via a load balancer everything works great until we reload the service. Most times the command will pause and return the requested output after a few more seconds. However, more times than is tolerable when the service is reloading the command will return error ?Failed to connect to proxy URL? to the client. With the AWS CLI debug enabled before the ?Failed to connect to proxy URL? is thrown we see ?ConnectionResetError: [Errno 104] Connection reset by peer?. We then ran packet captures and were able to determine that the reset was coming from the server running squid at the time the service was reloading. This connection is not logged by squid at all which was confusing to us that we had any client connection issues as the squid logs are clean. We are reloading the service with systemd but were able to reproduce the issue with ?squid -k reconfigure? as well. 

 

Our current plan is to upgrade our servers to RHEL8 and compile squid 5.6 in hopes that this issue will go away but we may need to go so far as programmatically removing a given squid node from the Load balancer before any service reload.   

 

That said, it was our understanding that reloading the service would not disturb any old connections and new connections would receive the new configuration. We were wondering if anyone else has encountered any issues with connection resets of client traffic during squid service reload? Or may otherwise have any thoughts on this issue. Please let me know if I can provide any further detail.

 

Thanks in advance.

 

Regards,

Matt   

 

 

 

 

 

 

   

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220615/ca81b64d/attachment.htm>

From simwin at mail.ru  Tue Jun 14 22:23:12 2022
From: simwin at mail.ru (simwin)
Date: Wed, 15 Jun 2022 01:23:12 +0300
Subject: [squid-users] There is the problems with instagram images and
 videos
In-Reply-To: <000001d88036$dee3f3e0$9cabdba0$@gmail.com>
References: <20220614170736.543895f8@vs> <YqihwZ8+Qq41we7N@fantomas.sk>
 <20220614180141.092824f7@vs> <Yqiupn+lKA5IdEp3@fantomas.sk>
 <20220615001645.0b13681e@vs>
 <000001d88036$dee3f3e0$9cabdba0$@gmail.com>
Message-ID: <20220615012312.2d89a23d@vs>

? Wed, 15 Jun 2022 00:36:55 +0300
<ngtech1ltd at gmail.com>:

> Hey,
> 
> You have reduced the conf.
> We are not trying to guess....
> You can either share your entire configuration or just to not ask.
> We cannot try to help you if we are missing parts of the configuration.
> ( leaving aside the ip addresses and confidential information)
> You should share both squid.conf and every included config file and also the
> relevant access.log details.

OK, I understand it. Please see links below:

My access.log - https://sharetext.me/z1mbjxkogv
My squid.conf - https://sharetext.me/wd7rdcpqax
and conf.d/debian.conf - https://sharetext.me/vdo9im5epe

> $ grep -vE '^$|^#' /etc/squid/squid.conf
> 
> auth_param basic program /usr/lib/squid/basic_ncsa_auth
> /etc/squid/internet_users acl auth_users proxy_auth REQUIRED
> http_access allow auth_users
> auth_param basic casesensitive on
> acl localnet src 0.0.0.1-0.255.255.255	# RFC 1122 "this" network (LAN)
> acl localnet src 10.0.0.0/8		# RFC 1918 local private network
> (LAN) acl localnet src 100.64.0.0/10		# RFC 6598 shared address
> space (CGN) acl localnet src 169.254.0.0/16 	# RFC 3927 link-local
> (directly plugged) machines acl localnet src 172.16.0.0/12		#
> RFC 1918 local private network (LAN) acl localnet src 192.168.0.0/16
> # RFC 1918 local private network (LAN) acl localnet src fc00::/7
> # RFC 4193 local private network range acl localnet src fe80::/10
> # RFC 4291 link-local (directly plugged) machines acl SSL_ports port 443
> acl Safe_ports port 80		# http
> acl Safe_ports port 21		# ftp
> acl Safe_ports port 443		# https
> acl Safe_ports port 70		# gopher
> acl Safe_ports port 210		# wais
> acl Safe_ports port 1025-65535	# unregistered ports
> acl Safe_ports port 280		# http-mgmt
> acl Safe_ports port 488		# gss-http
> acl Safe_ports port 591		# filemaker
> acl Safe_ports port 777		# multiling http
> acl CONNECT method CONNECT
> http_access deny !Safe_ports
> http_access deny CONNECT !SSL_ports
> http_access allow localhost manager
> http_access deny manager
> include /etc/squid/conf.d/*
> http_access allow localhost
> http_access deny all
> http_port xxx.xxx.xxx.xxx:3128 (hidden)
> coredump_dir /var/spool/squid
> refresh_pattern ^ftp:		1440	20%	10080
> refresh_pattern ^gopher:	1440	0%	1440
> refresh_pattern -i (/cgi-bin/|\?) 0	0%	0
> refresh_pattern .		0	20%	4320


From ngtech1ltd at gmail.com  Tue Jun 14 22:35:45 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Wed, 15 Jun 2022 01:35:45 +0300
Subject: [squid-users] There is the problems with instagram images and
 videos
In-Reply-To: <20220615012312.2d89a23d@vs>
References: <20220614170736.543895f8@vs> <YqihwZ8+Qq41we7N@fantomas.sk>
 <20220614180141.092824f7@vs> <Yqiupn+lKA5IdEp3@fantomas.sk>
 <20220615001645.0b13681e@vs> <000001d88036$dee3f3e0$9cabdba0$@gmail.com>
 <20220615012312.2d89a23d@vs>
Message-ID: <000801d8803f$173601e0$45a205a0$@gmail.com>

Hey,

Two things:

First, you have lots of TCP_TUNNEL_ABORTED and I am not sure if the client or the server is the cause for these.

Second, when you share the conf you can clean it up with the grep but just try to pay attention and make sure
that it would be human readable, usually mail agents tend to handle squid.conf in such a way that
later on they won't be readable.
So you can just share the tidy squid.conf in a clear plain text format that will not jump lines
if lines would jump it would be hard to read....

##

Since you are not using any SSL-BUMP it's pretty straight forward setup and I believe that the latest stable Squid-Cache version should
be used so the developers can help you and others with such an issue.
Can you please verify what browser or user agent is being using in your setup?
Also, can you show us the version of squid and share whether it's a self compiled or from a packges?
Please share as much details as possible about the host.

# squid -v

Should give us the relevant details.
What OS are you using?
I have a support script that might help us to make sure we have all the relevant details.

Thanks,
Eliezer


-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of simwin
Sent: Wednesday, 15 June 2022 1:23
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] There is the problems with instagram images and videos

? Wed, 15 Jun 2022 00:36:55 +0300
<ngtech1ltd at gmail.com>:

> Hey,
> 
> You have reduced the conf.
> We are not trying to guess....
> You can either share your entire configuration or just to not ask.
> We cannot try to help you if we are missing parts of the configuration.
> ( leaving aside the ip addresses and confidential information)
> You should share both squid.conf and every included config file and also the
> relevant access.log details.

OK, I understand it. Please see links below:

My access.log - https://sharetext.me/z1mbjxkogv
My squid.conf - https://sharetext.me/wd7rdcpqax
and conf.d/debian.conf - https://sharetext.me/vdo9im5epe

> $ grep -vE '^$|^#' /etc/squid/squid.conf
> 
> auth_param basic program /usr/lib/squid/basic_ncsa_auth
> /etc/squid/internet_users acl auth_users proxy_auth REQUIRED
> http_access allow auth_users
> auth_param basic casesensitive on
> acl localnet src 0.0.0.1-0.255.255.255	# RFC 1122 "this" network (LAN)
> acl localnet src 10.0.0.0/8		# RFC 1918 local private network
> (LAN) acl localnet src 100.64.0.0/10		# RFC 6598 shared address
> space (CGN) acl localnet src 169.254.0.0/16 	# RFC 3927 link-local
> (directly plugged) machines acl localnet src 172.16.0.0/12		#
> RFC 1918 local private network (LAN) acl localnet src 192.168.0.0/16
> # RFC 1918 local private network (LAN) acl localnet src fc00::/7
> # RFC 4193 local private network range acl localnet src fe80::/10
> # RFC 4291 link-local (directly plugged) machines acl SSL_ports port 443
> acl Safe_ports port 80		# http
> acl Safe_ports port 21		# ftp
> acl Safe_ports port 443		# https
> acl Safe_ports port 70		# gopher
> acl Safe_ports port 210		# wais
> acl Safe_ports port 1025-65535	# unregistered ports
> acl Safe_ports port 280		# http-mgmt
> acl Safe_ports port 488		# gss-http
> acl Safe_ports port 591		# filemaker
> acl Safe_ports port 777		# multiling http
> acl CONNECT method CONNECT
> http_access deny !Safe_ports
> http_access deny CONNECT !SSL_ports
> http_access allow localhost manager
> http_access deny manager
> include /etc/squid/conf.d/*
> http_access allow localhost
> http_access deny all
> http_port xxx.xxx.xxx.xxx:3128 (hidden)
> coredump_dir /var/spool/squid
> refresh_pattern ^ftp:		1440	20%	10080
> refresh_pattern ^gopher:	1440	0%	1440
> refresh_pattern -i (/cgi-bin/|\?) 0	0%	0
> refresh_pattern .		0	20%	4320
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From simwin at mail.ru  Tue Jun 14 22:57:50 2022
From: simwin at mail.ru (simwin)
Date: Wed, 15 Jun 2022 01:57:50 +0300
Subject: [squid-users] There is the problems with instagram images and
 videos
In-Reply-To: <000801d8803f$173601e0$45a205a0$@gmail.com>
References: <20220614170736.543895f8@vs> <YqihwZ8+Qq41we7N@fantomas.sk>
 <20220614180141.092824f7@vs> <Yqiupn+lKA5IdEp3@fantomas.sk>
 <20220615001645.0b13681e@vs>
 <000001d88036$dee3f3e0$9cabdba0$@gmail.com>
 <20220615012312.2d89a23d@vs>
 <000801d8803f$173601e0$45a205a0$@gmail.com>
Message-ID: <20220615015750.59cf9f05@vs>

? Wed, 15 Jun 2022 01:35:45 +0300
<ngtech1ltd at gmail.com>:

squid -v https://sharetext.me/52bxlj6sco

> Should give us the relevant details.
> What OS are you using?

OS Debian 11 

It you need some more information please let me know. 


From simwin at mail.ru  Tue Jun 14 23:00:43 2022
From: simwin at mail.ru (simwin)
Date: Wed, 15 Jun 2022 02:00:43 +0300
Subject: [squid-users] There is the problems with instagram images and
 videos
In-Reply-To: <000801d8803f$173601e0$45a205a0$@gmail.com>
References: <20220614170736.543895f8@vs> <YqihwZ8+Qq41we7N@fantomas.sk>
 <20220614180141.092824f7@vs> <Yqiupn+lKA5IdEp3@fantomas.sk>
 <20220615001645.0b13681e@vs>
 <000001d88036$dee3f3e0$9cabdba0$@gmail.com>
 <20220615012312.2d89a23d@vs>
 <000801d8803f$173601e0$45a205a0$@gmail.com>
Message-ID: <20220615020043.369710ab@vs>


? Wed, 15 Jun 2022 01:35:45 +0300
<ngtech1ltd at gmail.com>:

> Can you please verify what browser
Firefox Firefox 101.0


From simwin at mail.ru  Tue Jun 14 23:15:17 2022
From: simwin at mail.ru (simwin)
Date: Wed, 15 Jun 2022 02:15:17 +0300
Subject: [squid-users] There is the problems with instagram images and
 videos
In-Reply-To: <000801d8803f$173601e0$45a205a0$@gmail.com>
References: <20220614170736.543895f8@vs> <YqihwZ8+Qq41we7N@fantomas.sk>
 <20220614180141.092824f7@vs> <Yqiupn+lKA5IdEp3@fantomas.sk>
 <20220615001645.0b13681e@vs>
 <000001d88036$dee3f3e0$9cabdba0$@gmail.com>
 <20220615012312.2d89a23d@vs>
 <000801d8803f$173601e0$45a205a0$@gmail.com>
Message-ID: <20220615021517.19aa0c75@vs>


? Wed, 15 Jun 2022 01:35:45 +0300
<ngtech1ltd at gmail.com> ?????:

> whether it's a self compiled or from a packges?
It debian 11 default apt packages 


From simwin at mail.ru  Tue Jun 14 23:35:21 2022
From: simwin at mail.ru (simwin)
Date: Wed, 15 Jun 2022 02:35:21 +0300
Subject: [squid-users] There is the problems with instagram images and
 videos
In-Reply-To: <000801d8803f$173601e0$45a205a0$@gmail.com>
References: <20220614170736.543895f8@vs> <YqihwZ8+Qq41we7N@fantomas.sk>
 <20220614180141.092824f7@vs> <Yqiupn+lKA5IdEp3@fantomas.sk>
 <20220615001645.0b13681e@vs>
 <000001d88036$dee3f3e0$9cabdba0$@gmail.com>
 <20220615012312.2d89a23d@vs>
 <000801d8803f$173601e0$45a205a0$@gmail.com>
Message-ID: <20220615023521.00572fc3@vs>

Once more all together in raw txt format without lines breaking:

access.log - https://pastebin.mozilla.org/LQidBnKn/raw
squid.conf - https://pastebin.mozilla.org/mwO0yiRb/raw 
conf.d/debian.conf - https://sharetext.me/vdo9im5epe
squid -v - https://pastebin.mozilla.org/F0w2r623/raw
Browsers: 
Firefox 101 for Linux, 
Chrome Linux 102.0.5005.115 for Linux and Windows, 
Chromium 102.0.5005.61 for Linux 

OS Debian 11 64 bit.
Squid from Debian 11 default package




From ngtech1ltd at gmail.com  Tue Jun 14 23:59:29 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Wed, 15 Jun 2022 02:59:29 +0300
Subject: [squid-users] There is the problems with instagram images and
 videos
In-Reply-To: <20220615021517.19aa0c75@vs>
References: <20220614170736.543895f8@vs> <YqihwZ8+Qq41we7N@fantomas.sk>
 <20220614180141.092824f7@vs> <Yqiupn+lKA5IdEp3@fantomas.sk>
 <20220615001645.0b13681e@vs> <000001d88036$dee3f3e0$9cabdba0$@gmail.com>
 <20220615012312.2d89a23d@vs> <000801d8803f$173601e0$45a205a0$@gmail.com>
 <20220615021517.19aa0c75@vs>
Message-ID: <000c01d8804a$c96c8fe0$5c45afa0$@gmail.com>

Hey,

I just compiled the newest version of Squid for Debian 11(bullseye) at:
https://www.ngtech.co.il/repo/debian/11/x86_64/

However you need to know how to install it and I cannot work on the installer now.
It's also doesn't include all of my patches yet.


>From what I have seen at:
https://packages.debian.org/bullseye/squid

The current version at bullseye is 4.13 so you'd better try first 5.6 before any other things.

Eliezer

* Tomorrow I will try to publish the installer(I have it somewhere in my local repos but yet to find it, it was an ansible one as far as I remember)

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of simwin
Sent: Wednesday, 15 June 2022 2:15
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] There is the problems with instagram images and videos


? Wed, 15 Jun 2022 01:35:45 +0300
<ngtech1ltd at gmail.com> ?????:

> whether it's a self compiled or from a packges?
It debian 11 default apt packages 
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From ngtech1ltd at gmail.com  Wed Jun 15 00:00:38 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Wed, 15 Jun 2022 03:00:38 +0300
Subject: [squid-users] There is the problems with instagram images and
 videos
In-Reply-To: <20220615023521.00572fc3@vs>
References: <20220614170736.543895f8@vs> <YqihwZ8+Qq41we7N@fantomas.sk>
 <20220614180141.092824f7@vs> <Yqiupn+lKA5IdEp3@fantomas.sk>
 <20220615001645.0b13681e@vs> <000001d88036$dee3f3e0$9cabdba0$@gmail.com>
 <20220615012312.2d89a23d@vs> <000801d8803f$173601e0$45a205a0$@gmail.com>
 <20220615023521.00572fc3@vs>
Message-ID: <000d01d8804a$f253c0e0$d6fb42a0$@gmail.com>

We will be in touch tomorrow (I'm in IST so it?s +2 UTC), I assume you are in a different TZ.
In what TZ are you?

Eliezer

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of simwin
Sent: Wednesday, 15 June 2022 2:35
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] There is the problems with instagram images and videos

Once more all together in raw txt format without lines breaking:

access.log - https://pastebin.mozilla.org/LQidBnKn/raw
squid.conf - https://pastebin.mozilla.org/mwO0yiRb/raw 
conf.d/debian.conf - https://sharetext.me/vdo9im5epe
squid -v - https://pastebin.mozilla.org/F0w2r623/raw
Browsers: 
Firefox 101 for Linux, 
Chrome Linux 102.0.5005.115 for Linux and Windows, 
Chromium 102.0.5005.61 for Linux 

OS Debian 11 64 bit.
Squid from Debian 11 default package


_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From ngtech1ltd at gmail.com  Wed Jun 15 05:50:18 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Wed, 15 Jun 2022 08:50:18 +0300
Subject: [squid-users] Squid-Cache 5.6 RPMs are out
Message-ID: <001501d8807b$cbe93260$63bb9720$@gmail.com>

Hey Everybody,
 
Since 5.6 was recently published (and not all the masters has yet to pick it up) I have built RPM for:
CentOS 7,8
Oracle Enterprise Linux 7,8
Amazon Enterprise Linux 2
 
All of the above includes couple of my personal patches.
Feel free to pick the SRPMS and look at the sources.
 
All The Bests,
Eliezer
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220615/7df30168/attachment.htm>

From simwin at mail.ru  Wed Jun 15 09:14:22 2022
From: simwin at mail.ru (simwin)
Date: Wed, 15 Jun 2022 12:14:22 +0300
Subject: [squid-users] There is the problems with instagram images and
 videos
In-Reply-To: <000c01d8804a$c96c8fe0$5c45afa0$@gmail.com>
References: <20220614170736.543895f8@vs> <YqihwZ8+Qq41we7N@fantomas.sk>
 <20220614180141.092824f7@vs> <Yqiupn+lKA5IdEp3@fantomas.sk>
 <20220615001645.0b13681e@vs>
 <000001d88036$dee3f3e0$9cabdba0$@gmail.com>
 <20220615012312.2d89a23d@vs>
 <000801d8803f$173601e0$45a205a0$@gmail.com>
 <20220615021517.19aa0c75@vs>
 <000c01d8804a$c96c8fe0$5c45afa0$@gmail.com>
Message-ID: <20220615121422.7497c2b3@vs>

? Wed, 15 Jun 2022 02:59:29 +0300
<ngtech1ltd at gmail.com>:

> I just compiled the newest version of Squid for Debian 11(bullseye) at:
> https://www.ngtech.co.il/repo/debian/11/x86_64/ 
> However you need to know how to install it and I cannot work on the installer
> now. It's also doesn't include all of my patches yet.
> From what I have seen at:
> https://packages.debian.org/bullseye/squid
> The current version at bullseye is 4.13 so you'd better try first 5.6 before
> any other things.

That is the good idea! 

I'm already in trying to compile and install the latest 5.6 squid version.  

I am in GMT+3 time zone. 

Let you know about 5.6 results a bit latter. Thank you!


From simwin at mail.ru  Wed Jun 15 15:48:00 2022
From: simwin at mail.ru (simwin)
Date: Wed, 15 Jun 2022 18:48:00 +0300
Subject: [squid-users] There is the problems with instagram images and
 videos
In-Reply-To: <20220615121422.7497c2b3@vs>
References: <20220614170736.543895f8@vs> <YqihwZ8+Qq41we7N@fantomas.sk>
 <20220614180141.092824f7@vs> <Yqiupn+lKA5IdEp3@fantomas.sk>
 <20220615001645.0b13681e@vs>
 <000001d88036$dee3f3e0$9cabdba0$@gmail.com>
 <20220615012312.2d89a23d@vs>
 <000801d8803f$173601e0$45a205a0$@gmail.com>
 <20220615021517.19aa0c75@vs>
 <000c01d8804a$c96c8fe0$5c45afa0$@gmail.com>
 <20220615121422.7497c2b3@vs>
Message-ID: <20220615184800.3fb2f963@vs>

With the latest stable squid-5.6-20220607-rfca8b79b5 the result is the same
- no instagram photos and videos :(

The squid configs is default, please see all info below:

$ grep -vE '^$|^#' /etc/squid/squid.conf

acl localnet src 0.0.0.1-0.255.255.255	
acl localnet src 10.0.0.0/8		
acl localnet src 100.64.0.0/10		
acl localnet src 169.254.0.0/16 	
acl localnet src 172.16.0.0/12		
acl localnet src 192.168.0.0/16		
acl localnet src fc00::/7       	
acl localnet src fe80::/10      	
acl SSL_ports port 443
acl Safe_ports port 80		# http
acl Safe_ports port 21		# ftp
acl Safe_ports port 443		# https
acl Safe_ports port 70		# gopher
acl Safe_ports port 210		# wais
acl Safe_ports port 1025-65535	# unregistered ports
acl Safe_ports port 280		# http-mgmt
acl Safe_ports port 488		# gss-http
acl Safe_ports port 591		# filemaker
acl Safe_ports port 777		# multiling http

auth_param basic program /usr/libexec/squid/basic_ncsa_auth
/etc/squid/internet_users

acl auth_users proxy_auth REQUIRED
http_access allow auth_users
auth_param basic casesensitive on
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow localhost manager
http_access deny manager
http_access allow localnet
http_access allow localhost
http_access deny all
http_port xxx.xxx.xxx.xxx:xxxx
coredump_dir /var/cache/squid
refresh_pattern ^ftp:		1440	20%	10080
refresh_pattern ^gopher:	1440	0%	1440
refresh_pattern -i (/cgi-bin/|\?) 0	0%	0
refresh_pattern .		0	20%	4320

Full squid.conf - https://pastebin.mozilla.org/JKSiBuvU/raw
Firefox 101 console errors - https://pastebin.mozilla.org/0Osvw45J/raw
Squid access.log - https://pastebin.mozilla.org/pOsXtMBW/raw
OS Debian 11

2All: Please answer: does squid works with instagram (and twitter videos)
for anyone?!

? Wed, 15 Jun 2022 12:14:22 +0300
simwin <simwin at mail.ru> ?????:

> ? Wed, 15 Jun 2022 02:59:29 +0300
> <ngtech1ltd at gmail.com>:
> 
> > I just compiled the newest version of Squid for Debian 11(bullseye) at:
> > https://www.ngtech.co.il/repo/debian/11/x86_64/ 
> > However you need to know how to install it and I cannot work on the
> > installer now. It's also doesn't include all of my patches yet.
> > From what I have seen at:
> > https://packages.debian.org/bullseye/squid
> > The current version at bullseye is 4.13 so you'd better try first 5.6 before
> > any other things.  
> 
> That is the good idea! 
> 
> I'm already in trying to compile and install the latest 5.6 squid version.  
> 
> I am in GMT+3 time zone. 
> 
> Let you know about 5.6 results a bit latter. Thank you!


From uhlar at fantomas.sk  Wed Jun 15 15:53:33 2022
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Wed, 15 Jun 2022 17:53:33 +0200
Subject: [squid-users] There is the problems with instagram images and
 videos
In-Reply-To: <20220615184800.3fb2f963@vs>
References: <20220614180141.092824f7@vs> <Yqiupn+lKA5IdEp3@fantomas.sk>
 <20220615001645.0b13681e@vs>
 <000001d88036$dee3f3e0$9cabdba0$@gmail.com>
 <20220615012312.2d89a23d@vs>
 <000801d8803f$173601e0$45a205a0$@gmail.com>
 <20220615021517.19aa0c75@vs>
 <000c01d8804a$c96c8fe0$5c45afa0$@gmail.com>
 <20220615121422.7497c2b3@vs> <20220615184800.3fb2f963@vs>
Message-ID: <YqoAfUflczVHEugP@fantomas.sk>

On 15.06.22 18:48, simwin wrote:
>With the latest stable squid-5.6-20220607-rfca8b79b5 the result is the same
>- no instagram photos and videos :(

>acl auth_users proxy_auth REQUIRED
>http_access allow auth_users

can you so without auth first?
I mean, with original unchanged squid config.
  
>2All: Please answer: does squid works with instagram (and twitter videos)
>for anyone?!

we would know that already.

i maintain debian squid at a few customers who did not complain


-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
"To Boot or not to Boot, that's the question." [WD1270 Caviar]


From andre.bolinhas at articatech.com  Wed Jun 15 15:54:32 2022
From: andre.bolinhas at articatech.com (andre.bolinhas at articatech.com)
Date: Wed, 15 Jun 2022 16:54:32 +0100
Subject: [squid-users] There is the problems with instagram images and
 videos
In-Reply-To: <20220615184800.3fb2f963@vs>
References: <20220614170736.543895f8@vs> <YqihwZ8+Qq41we7N@fantomas.sk>
 <20220614180141.092824f7@vs> <Yqiupn+lKA5IdEp3@fantomas.sk>
 <20220615001645.0b13681e@vs> <000001d88036$dee3f3e0$9cabdba0$@gmail.com>
 <20220615012312.2d89a23d@vs> <000801d8803f$173601e0$45a205a0$@gmail.com>
 <20220615021517.19aa0c75@vs> <000c01d8804a$c96c8fe0$5c45afa0$@gmail.com>
 <20220615121422.7497c2b3@vs> <20220615184800.3fb2f963@vs>
Message-ID: <!&!AAAAAAAAAAAuAAAAAAAAAIVNjRjcTGZElYgADq7oyvYBAMO2jhD3dRHOtM0AqgC7tuYAAAAAAA4AABAAAAAYv0YofKkIR7U6Hj6vZR31AQAAAAA=@articatech.com>

TCP_TUNNEL/200 means that the proxy is able to establish a correct connection with the destination, do you have any firewall, antivirus, ad-blocker in between that could block the traffic?

Do not hesitate to contact me for any additional information.

Best regards,
Andr? Bolinhas
www: articatech.net
Help Desk: support.artica.systems
Skype: andre.bolinas



-----Mensagem original-----
De: squid-users <squid-users-bounces at lists.squid-cache.org> Em Nome De simwin
Enviada: 15 de junho de 2022 16:48
Para: squid-users at lists.squid-cache.org
Assunto: Re: [squid-users] There is the problems with instagram images and videos

With the latest stable squid-5.6-20220607-rfca8b79b5 the result is the same
- no instagram photos and videos :(

The squid configs is default, please see all info below:

$ grep -vE '^$|^#' /etc/squid/squid.conf

acl localnet src 0.0.0.1-0.255.255.255	
acl localnet src 10.0.0.0/8		
acl localnet src 100.64.0.0/10		
acl localnet src 169.254.0.0/16 	
acl localnet src 172.16.0.0/12		
acl localnet src 192.168.0.0/16		
acl localnet src fc00::/7       	
acl localnet src fe80::/10      	
acl SSL_ports port 443
acl Safe_ports port 80		# http
acl Safe_ports port 21		# ftp
acl Safe_ports port 443		# https
acl Safe_ports port 70		# gopher
acl Safe_ports port 210		# wais
acl Safe_ports port 1025-65535	# unregistered ports
acl Safe_ports port 280		# http-mgmt
acl Safe_ports port 488		# gss-http
acl Safe_ports port 591		# filemaker
acl Safe_ports port 777		# multiling http

auth_param basic program /usr/libexec/squid/basic_ncsa_auth
/etc/squid/internet_users

acl auth_users proxy_auth REQUIRED
http_access allow auth_users
auth_param basic casesensitive on
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow localhost manager
http_access deny manager
http_access allow localnet
http_access allow localhost
http_access deny all
http_port xxx.xxx.xxx.xxx:xxxx
coredump_dir /var/cache/squid
refresh_pattern ^ftp:		1440	20%	10080
refresh_pattern ^gopher:	1440	0%	1440
refresh_pattern -i (/cgi-bin/|\?) 0	0%	0
refresh_pattern .		0	20%	4320

Full squid.conf - https://pastebin.mozilla.org/JKSiBuvU/raw
Firefox 101 console errors - https://pastebin.mozilla.org/0Osvw45J/raw
Squid access.log - https://pastebin.mozilla.org/pOsXtMBW/raw
OS Debian 11

2All: Please answer: does squid works with instagram (and twitter videos) for anyone?!

? Wed, 15 Jun 2022 12:14:22 +0300
simwin <simwin at mail.ru> ?????:

> ? Wed, 15 Jun 2022 02:59:29 +0300
> <ngtech1ltd at gmail.com>:
> 
> > I just compiled the newest version of Squid for Debian 11(bullseye) at:
> > https://www.ngtech.co.il/repo/debian/11/x86_64/
> > However you need to know how to install it and I cannot work on the 
> > installer now. It's also doesn't include all of my patches yet.
> > From what I have seen at:
> > https://packages.debian.org/bullseye/squid
> > The current version at bullseye is 4.13 so you'd better try first 
> > 5.6 before any other things.
> 
> That is the good idea! 
> 
> I'm already in trying to compile and install the latest 5.6 squid version.  
> 
> I am in GMT+3 time zone. 
> 
> Let you know about 5.6 results a bit latter. Thank you!
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From simwin at mail.ru  Wed Jun 15 16:01:30 2022
From: simwin at mail.ru (simwin)
Date: Wed, 15 Jun 2022 19:01:30 +0300
Subject: [squid-users] There is the problems with instagram images and
 videos
In-Reply-To: <20220615184800.3fb2f963@vs>
References: <20220614170736.543895f8@vs> <YqihwZ8+Qq41we7N@fantomas.sk>
 <20220614180141.092824f7@vs> <Yqiupn+lKA5IdEp3@fantomas.sk>
 <20220615001645.0b13681e@vs>
 <000001d88036$dee3f3e0$9cabdba0$@gmail.com>
 <20220615012312.2d89a23d@vs>
 <000801d8803f$173601e0$45a205a0$@gmail.com>
 <20220615021517.19aa0c75@vs>
 <000c01d8804a$c96c8fe0$5c45afa0$@gmail.com>
 <20220615121422.7497c2b3@vs> <20220615184800.3fb2f963@vs>
Message-ID: <20220615190130.4bb3aa82@vs>

Plus squid -v:

configure options:  '--prefix=' '--bindir=/usr/bin' '--sbindir=/usr/sbin'
'--libexecdir=/usr/libexec/squid' '--libdir=/usr/lib/squid'
'--mandir=/usr/share/man/man8' '--sysconfdir=/etc/squid'
'--with-default-user=proxy' '--with-pidfile=/run/squid.pid'
'--with-logdir=/var/log/squid'

? Wed, 15 Jun 2022 18:48:00 +0300
simwin <simwin at mail.ru> ?????:

> With the latest stable squid-5.6-20220607-rfca8b79b5 the result is the same
> - no instagram photos and videos :(
> 
> The squid configs is default, please see all info below:
> 
> $ grep -vE '^$|^#' /etc/squid/squid.conf
> 
> acl localnet src 0.0.0.1-0.255.255.255	
> acl localnet src 10.0.0.0/8		
> acl localnet src 100.64.0.0/10		
> acl localnet src 169.254.0.0/16 	
> acl localnet src 172.16.0.0/12		
> acl localnet src 192.168.0.0/16		
> acl localnet src fc00::/7       	
> acl localnet src fe80::/10      	
> acl SSL_ports port 443
> acl Safe_ports port 80		# http
> acl Safe_ports port 21		# ftp
> acl Safe_ports port 443		# https
> acl Safe_ports port 70		# gopher
> acl Safe_ports port 210		# wais
> acl Safe_ports port 1025-65535	# unregistered ports
> acl Safe_ports port 280		# http-mgmt
> acl Safe_ports port 488		# gss-http
> acl Safe_ports port 591		# filemaker
> acl Safe_ports port 777		# multiling http
> 
> auth_param basic program /usr/libexec/squid/basic_ncsa_auth
> /etc/squid/internet_users
> 
> acl auth_users proxy_auth REQUIRED
> http_access allow auth_users
> auth_param basic casesensitive on
> http_access deny !Safe_ports
> http_access deny CONNECT !SSL_ports
> http_access allow localhost manager
> http_access deny manager
> http_access allow localnet
> http_access allow localhost
> http_access deny all
> http_port xxx.xxx.xxx.xxx:xxxx
> coredump_dir /var/cache/squid
> refresh_pattern ^ftp:		1440	20%	10080
> refresh_pattern ^gopher:	1440	0%	1440
> refresh_pattern -i (/cgi-bin/|\?) 0	0%	0
> refresh_pattern .		0	20%	4320
> 
> Full squid.conf - https://pastebin.mozilla.org/JKSiBuvU/raw
> Firefox 101 console errors - https://pastebin.mozilla.org/0Osvw45J/raw
> Squid access.log - https://pastebin.mozilla.org/pOsXtMBW/raw
> OS Debian 11
> 
> 2All: Please answer: does squid works with instagram (and twitter videos)
> for anyone?!
> 
> ? Wed, 15 Jun 2022 12:14:22 +0300
> simwin <simwin at mail.ru> ?????:
> 
> > ? Wed, 15 Jun 2022 02:59:29 +0300
> > <ngtech1ltd at gmail.com>:
> >   
> > > I just compiled the newest version of Squid for Debian 11(bullseye) at:
> > > https://www.ngtech.co.il/repo/debian/11/x86_64/ 
> > > However you need to know how to install it and I cannot work on the
> > > installer now. It's also doesn't include all of my patches yet.
> > > From what I have seen at:
> > > https://packages.debian.org/bullseye/squid
> > > The current version at bullseye is 4.13 so you'd better try first 5.6
> > > before any other things.    
> > 
> > That is the good idea! 
> > 
> > I'm already in trying to compile and install the latest 5.6 squid version.  
> > 
> > I am in GMT+3 time zone. 
> > 
> > Let you know about 5.6 results a bit latter. Thank you!  


From simwin at mail.ru  Wed Jun 15 16:16:29 2022
From: simwin at mail.ru (simwin)
Date: Wed, 15 Jun 2022 19:16:29 +0300
Subject: [squid-users] There is the problems with instagram images and
 videos
In-Reply-To: <20220615190130.4bb3aa82@vs>
References: <20220614170736.543895f8@vs> <YqihwZ8+Qq41we7N@fantomas.sk>
 <20220614180141.092824f7@vs> <Yqiupn+lKA5IdEp3@fantomas.sk>
 <20220615001645.0b13681e@vs>
 <000001d88036$dee3f3e0$9cabdba0$@gmail.com>
 <20220615012312.2d89a23d@vs>
 <000801d8803f$173601e0$45a205a0$@gmail.com>
 <20220615021517.19aa0c75@vs>
 <000c01d8804a$c96c8fe0$5c45afa0$@gmail.com>
 <20220615121422.7497c2b3@vs> <20220615184800.3fb2f963@vs>
 <20220615190130.4bb3aa82@vs>
Message-ID: <20220615191630.535e7719@vs>


andre.bolinhas at articatech.com:

> TCP_TUNNEL/200 means that the proxy is able to establish a correct connection
> with the destination, do you have any firewall, antivirus, ad-blocker in
> between that could block the traffic?  

No antivirus, no firewall and no ad-blocker - I've checked it!. 

I've made ssh tunnel (ssh -D 0.0.0.0:8888) and make sock5 proxy to my server -
it works fine! But with danted sock5 proxy I have the same problem - no
instagram images, no videos.
 
Also it may be providers issue - all instagram's traffic blocked in our
country. 

That is why I need to know - does squid works with instagram (and twitter
videos) for anyone from another country with default squid config?

? Wed, 15 Jun 2022 19:01:30 +0300
simwin <simwin at mail.ru>:

> Plus squid -v:
> 
> configure options:  '--prefix=' '--bindir=/usr/bin' '--sbindir=/usr/sbin'
> '--libexecdir=/usr/libexec/squid' '--libdir=/usr/lib/squid'
> '--mandir=/usr/share/man/man8' '--sysconfdir=/etc/squid'
> '--with-default-user=proxy' '--with-pidfile=/run/squid.pid'
> '--with-logdir=/var/log/squid'
> 
> ? Wed, 15 Jun 2022 18:48:00 +0300
> simwin <simwin at mail.ru> ?????:
> 
> > With the latest stable squid-5.6-20220607-rfca8b79b5 the result is the same
> > - no instagram photos and videos :(
> > 
> > The squid configs is default, please see all info below:
> > 
> > $ grep -vE '^$|^#' /etc/squid/squid.conf
> > 
> > acl localnet src 0.0.0.1-0.255.255.255	
> > acl localnet src 10.0.0.0/8		
> > acl localnet src 100.64.0.0/10		
> > acl localnet src 169.254.0.0/16 	
> > acl localnet src 172.16.0.0/12		
> > acl localnet src 192.168.0.0/16		
> > acl localnet src fc00::/7       	
> > acl localnet src fe80::/10      	
> > acl SSL_ports port 443
> > acl Safe_ports port 80		# http
> > acl Safe_ports port 21		# ftp
> > acl Safe_ports port 443		# https
> > acl Safe_ports port 70		# gopher
> > acl Safe_ports port 210		# wais
> > acl Safe_ports port 1025-65535	# unregistered ports
> > acl Safe_ports port 280		# http-mgmt
> > acl Safe_ports port 488		# gss-http
> > acl Safe_ports port 591		# filemaker
> > acl Safe_ports port 777		# multiling http
> > 
> > auth_param basic program /usr/libexec/squid/basic_ncsa_auth
> > /etc/squid/internet_users
> > 
> > acl auth_users proxy_auth REQUIRED
> > http_access allow auth_users
> > auth_param basic casesensitive on
> > http_access deny !Safe_ports
> > http_access deny CONNECT !SSL_ports
> > http_access allow localhost manager
> > http_access deny manager
> > http_access allow localnet
> > http_access allow localhost
> > http_access deny all
> > http_port xxx.xxx.xxx.xxx:xxxx
> > coredump_dir /var/cache/squid
> > refresh_pattern ^ftp:		1440	20%	10080
> > refresh_pattern ^gopher:	1440	0%	1440
> > refresh_pattern -i (/cgi-bin/|\?) 0	0%	0
> > refresh_pattern .		0	20%	4320
> > 
> > Full squid.conf - https://pastebin.mozilla.org/JKSiBuvU/raw
> > Firefox 101 console errors - https://pastebin.mozilla.org/0Osvw45J/raw
> > Squid access.log - https://pastebin.mozilla.org/pOsXtMBW/raw
> > OS Debian 11
> > 
> > 2All: Please answer: does squid works with instagram (and twitter videos)
> > for anyone?!
> > 
> > ? Wed, 15 Jun 2022 12:14:22 +0300
> > simwin <simwin at mail.ru> ?????:
> >   
> > > ? Wed, 15 Jun 2022 02:59:29 +0300
> > > <ngtech1ltd at gmail.com>:
> > >     
> > > > I just compiled the newest version of Squid for Debian 11(bullseye) at:
> > > > https://www.ngtech.co.il/repo/debian/11/x86_64/ 
> > > > However you need to know how to install it and I cannot work on the
> > > > installer now. It's also doesn't include all of my patches yet.
> > > > From what I have seen at:
> > > > https://packages.debian.org/bullseye/squid
> > > > The current version at bullseye is 4.13 so you'd better try first 5.6
> > > > before any other things.      
> > > 
> > > That is the good idea! 
> > > 
> > > I'm already in trying to compile and install the latest 5.6 squid
> > > version.  
> > > 
> > > I am in GMT+3 time zone. 
> > > 
> > > Let you know about 5.6 results a bit latter. Thank you!    


From andre.bolinhas at articatech.com  Wed Jun 15 16:18:36 2022
From: andre.bolinhas at articatech.com (andre.bolinhas at articatech.com)
Date: Wed, 15 Jun 2022 17:18:36 +0100
Subject: [squid-users] There is the problems with instagram images and
 videos
In-Reply-To: <20220615191630.535e7719@vs>
References: <20220614170736.543895f8@vs> <YqihwZ8+Qq41we7N@fantomas.sk>
 <20220614180141.092824f7@vs> <Yqiupn+lKA5IdEp3@fantomas.sk>
 <20220615001645.0b13681e@vs> <000001d88036$dee3f3e0$9cabdba0$@gmail.com>
 <20220615012312.2d89a23d@vs> <000801d8803f$173601e0$45a205a0$@gmail.com>
 <20220615021517.19aa0c75@vs> <000c01d8804a$c96c8fe0$5c45afa0$@gmail.com>
 <20220615121422.7497c2b3@vs> <20220615184800.3fb2f963@vs>
 <20220615190130.4bb3aa82@vs> <20220615191630.535e7719@vs>
Message-ID: <!&!AAAAAAAAAAAuAAAAAAAAAIVNjRjcTGZElYgADq7oyvYBAMO2jhD3dRHOtM0AqgC7tuYAAAAAAA4AABAAAABM+hX+DFZOQoW1dnbcxZzLAQAAAAA=@articatech.com>

Hi
We have thousands of clients worldwide using our proxy solutions (based on squid), and I can confirm the Instagram, Facebook, twitter works correctly under squid.


-----Mensagem original-----
De: squid-users <squid-users-bounces at lists.squid-cache.org> Em Nome De simwin
Enviada: 15 de junho de 2022 17:16
Para: squid-users at lists.squid-cache.org
Assunto: Re: [squid-users] There is the problems with instagram images and videos


andre.bolinhas at articatech.com:

> TCP_TUNNEL/200 means that the proxy is able to establish a correct 
> connection with the destination, do you have any firewall, antivirus, 
> ad-blocker in between that could block the traffic?

No antivirus, no firewall and no ad-blocker - I've checked it!. 

I've made ssh tunnel (ssh -D 0.0.0.0:8888) and make sock5 proxy to my server - it works fine! But with danted sock5 proxy I have the same problem - no instagram images, no videos.
 
Also it may be providers issue - all instagram's traffic blocked in our country. 

That is why I need to know - does squid works with instagram (and twitter
videos) for anyone from another country with default squid config?

? Wed, 15 Jun 2022 19:01:30 +0300
simwin <simwin at mail.ru>:

> Plus squid -v:
> 
> configure options:  '--prefix=' '--bindir=/usr/bin' '--sbindir=/usr/sbin'
> '--libexecdir=/usr/libexec/squid' '--libdir=/usr/lib/squid'
> '--mandir=/usr/share/man/man8' '--sysconfdir=/etc/squid'
> '--with-default-user=proxy' '--with-pidfile=/run/squid.pid'
> '--with-logdir=/var/log/squid'
> 
> ? Wed, 15 Jun 2022 18:48:00 +0300
> simwin <simwin at mail.ru> ?????:
> 
> > With the latest stable squid-5.6-20220607-rfca8b79b5 the result is 
> > the same
> > - no instagram photos and videos :(
> > 
> > The squid configs is default, please see all info below:
> > 
> > $ grep -vE '^$|^#' /etc/squid/squid.conf
> > 
> > acl localnet src 0.0.0.1-0.255.255.255	
> > acl localnet src 10.0.0.0/8		
> > acl localnet src 100.64.0.0/10		
> > acl localnet src 169.254.0.0/16 	
> > acl localnet src 172.16.0.0/12		
> > acl localnet src 192.168.0.0/16		
> > acl localnet src fc00::/7       	
> > acl localnet src fe80::/10      	
> > acl SSL_ports port 443
> > acl Safe_ports port 80		# http
> > acl Safe_ports port 21		# ftp
> > acl Safe_ports port 443		# https
> > acl Safe_ports port 70		# gopher
> > acl Safe_ports port 210		# wais
> > acl Safe_ports port 1025-65535	# unregistered ports
> > acl Safe_ports port 280		# http-mgmt
> > acl Safe_ports port 488		# gss-http
> > acl Safe_ports port 591		# filemaker
> > acl Safe_ports port 777		# multiling http
> > 
> > auth_param basic program /usr/libexec/squid/basic_ncsa_auth
> > /etc/squid/internet_users
> > 
> > acl auth_users proxy_auth REQUIRED
> > http_access allow auth_users
> > auth_param basic casesensitive on
> > http_access deny !Safe_ports
> > http_access deny CONNECT !SSL_ports
> > http_access allow localhost manager
> > http_access deny manager
> > http_access allow localnet
> > http_access allow localhost
> > http_access deny all
> > http_port xxx.xxx.xxx.xxx:xxxx
> > coredump_dir /var/cache/squid
> > refresh_pattern ^ftp:		1440	20%	10080
> > refresh_pattern ^gopher:	1440	0%	1440
> > refresh_pattern -i (/cgi-bin/|\?) 0	0%	0
> > refresh_pattern .		0	20%	4320
> > 
> > Full squid.conf - https://pastebin.mozilla.org/JKSiBuvU/raw
> > Firefox 101 console errors - 
> > https://pastebin.mozilla.org/0Osvw45J/raw
> > Squid access.log - https://pastebin.mozilla.org/pOsXtMBW/raw
> > OS Debian 11
> > 
> > 2All: Please answer: does squid works with instagram (and twitter 
> > videos) for anyone?!
> > 
> > ? Wed, 15 Jun 2022 12:14:22 +0300
> > simwin <simwin at mail.ru> ?????:
> >   
> > > ? Wed, 15 Jun 2022 02:59:29 +0300
> > > <ngtech1ltd at gmail.com>:
> > >     
> > > > I just compiled the newest version of Squid for Debian 11(bullseye) at:
> > > > https://www.ngtech.co.il/repo/debian/11/x86_64/
> > > > However you need to know how to install it and I cannot work on 
> > > > the installer now. It's also doesn't include all of my patches yet.
> > > > From what I have seen at:
> > > > https://packages.debian.org/bullseye/squid
> > > > The current version at bullseye is 4.13 so you'd better try first 5.6
> > > > before any other things.      
> > > 
> > > That is the good idea! 
> > > 
> > > I'm already in trying to compile and install the latest 5.6 squid 
> > > version.
> > > 
> > > I am in GMT+3 time zone. 
> > > 
> > > Let you know about 5.6 results a bit latter. Thank you!    
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From andre.bolinhas at articatech.com  Wed Jun 15 16:20:09 2022
From: andre.bolinhas at articatech.com (andre.bolinhas at articatech.com)
Date: Wed, 15 Jun 2022 17:20:09 +0100
Subject: [squid-users] There is the problems with instagram images and
 videos
In-Reply-To: <!&!AAAAAAAAAAAuAAAAAAAAAIVNjRjcTGZElYgADq7oyvYBAMO2jhD3dRHOtM0AqgC7tuYAAAAAAA4AABAAAABM+hX+DFZOQoW1dnbcxZzLAQAAAAA=@articatech.com>
References: <20220614170736.543895f8@vs> <YqihwZ8+Qq41we7N@fantomas.sk>
 <20220614180141.092824f7@vs> <Yqiupn+lKA5IdEp3@fantomas.sk>
 <20220615001645.0b13681e@vs> <000001d88036$dee3f3e0$9cabdba0$@gmail.com>
 <20220615012312.2d89a23d@vs> <000801d8803f$173601e0$45a205a0$@gmail.com>
 <20220615021517.19aa0c75@vs> <000c01d8804a$c96c8fe0$5c45afa0$@gmail.com>
 <20220615121422.7497c2b3@vs> <20220615184800.3fb2f963@vs>
 <20220615190130.4bb3aa82@vs> <20220615191630.535e7719@vs>
 <!&!AAAAAAAAAAAuAAAAAAAAAIVNjRjcTGZElYgADq7oyvYBAMO2jhD3dRHOtM0AqgC7tuYAAAAAAA4AABAAAABM+hX+DFZOQoW1dnbcxZzLAQAAAAA=@articatech.com>
Message-ID: <!&!AAAAAAAAAAAuAAAAAAAAAIVNjRjcTGZElYgADq7oyvYBAMO2jhD3dRHOtM0AqgC7tuYAAAAAAA4AABAAAAB4NUarGA4STJbHCMjCD8KbAQAAAAA=@articatech.com>

Also, without proxy, Instagram & Twitter works?

-----Mensagem original-----
De: squid-users <squid-users-bounces at lists.squid-cache.org> Em Nome De andre.bolinhas at articatech.com
Enviada: 15 de junho de 2022 17:19
Para: 'simwin' <simwin at mail.ru>; squid-users at lists.squid-cache.org
Assunto: Re: [squid-users] There is the problems with instagram images and videos

Hi
We have thousands of clients worldwide using our proxy solutions (based on squid), and I can confirm the Instagram, Facebook, twitter works correctly under squid.


-----Mensagem original-----
De: squid-users <squid-users-bounces at lists.squid-cache.org> Em Nome De simwin
Enviada: 15 de junho de 2022 17:16
Para: squid-users at lists.squid-cache.org
Assunto: Re: [squid-users] There is the problems with instagram images and videos


andre.bolinhas at articatech.com:

> TCP_TUNNEL/200 means that the proxy is able to establish a correct 
> connection with the destination, do you have any firewall, antivirus, 
> ad-blocker in between that could block the traffic?

No antivirus, no firewall and no ad-blocker - I've checked it!. 

I've made ssh tunnel (ssh -D 0.0.0.0:8888) and make sock5 proxy to my server - it works fine! But with danted sock5 proxy I have the same problem - no instagram images, no videos.
 
Also it may be providers issue - all instagram's traffic blocked in our country. 

That is why I need to know - does squid works with instagram (and twitter
videos) for anyone from another country with default squid config?

? Wed, 15 Jun 2022 19:01:30 +0300
simwin <simwin at mail.ru>:

> Plus squid -v:
> 
> configure options:  '--prefix=' '--bindir=/usr/bin' '--sbindir=/usr/sbin'
> '--libexecdir=/usr/libexec/squid' '--libdir=/usr/lib/squid'
> '--mandir=/usr/share/man/man8' '--sysconfdir=/etc/squid'
> '--with-default-user=proxy' '--with-pidfile=/run/squid.pid'
> '--with-logdir=/var/log/squid'
> 
> ? Wed, 15 Jun 2022 18:48:00 +0300
> simwin <simwin at mail.ru> ?????:
> 
> > With the latest stable squid-5.6-20220607-rfca8b79b5 the result is 
> > the same
> > - no instagram photos and videos :(
> > 
> > The squid configs is default, please see all info below:
> > 
> > $ grep -vE '^$|^#' /etc/squid/squid.conf
> > 
> > acl localnet src 0.0.0.1-0.255.255.255	
> > acl localnet src 10.0.0.0/8		
> > acl localnet src 100.64.0.0/10		
> > acl localnet src 169.254.0.0/16 	
> > acl localnet src 172.16.0.0/12		
> > acl localnet src 192.168.0.0/16		
> > acl localnet src fc00::/7       	
> > acl localnet src fe80::/10      	
> > acl SSL_ports port 443
> > acl Safe_ports port 80		# http
> > acl Safe_ports port 21		# ftp
> > acl Safe_ports port 443		# https
> > acl Safe_ports port 70		# gopher
> > acl Safe_ports port 210		# wais
> > acl Safe_ports port 1025-65535	# unregistered ports
> > acl Safe_ports port 280		# http-mgmt
> > acl Safe_ports port 488		# gss-http
> > acl Safe_ports port 591		# filemaker
> > acl Safe_ports port 777		# multiling http
> > 
> > auth_param basic program /usr/libexec/squid/basic_ncsa_auth
> > /etc/squid/internet_users
> > 
> > acl auth_users proxy_auth REQUIRED
> > http_access allow auth_users
> > auth_param basic casesensitive on
> > http_access deny !Safe_ports
> > http_access deny CONNECT !SSL_ports
> > http_access allow localhost manager
> > http_access deny manager
> > http_access allow localnet
> > http_access allow localhost
> > http_access deny all
> > http_port xxx.xxx.xxx.xxx:xxxx
> > coredump_dir /var/cache/squid
> > refresh_pattern ^ftp:		1440	20%	10080
> > refresh_pattern ^gopher:	1440	0%	1440
> > refresh_pattern -i (/cgi-bin/|\?) 0	0%	0
> > refresh_pattern .		0	20%	4320
> > 
> > Full squid.conf - https://pastebin.mozilla.org/JKSiBuvU/raw
> > Firefox 101 console errors -
> > https://pastebin.mozilla.org/0Osvw45J/raw
> > Squid access.log - https://pastebin.mozilla.org/pOsXtMBW/raw
> > OS Debian 11
> > 
> > 2All: Please answer: does squid works with instagram (and twitter
> > videos) for anyone?!
> > 
> > ? Wed, 15 Jun 2022 12:14:22 +0300
> > simwin <simwin at mail.ru> ?????:
> >   
> > > ? Wed, 15 Jun 2022 02:59:29 +0300
> > > <ngtech1ltd at gmail.com>:
> > >     
> > > > I just compiled the newest version of Squid for Debian 11(bullseye) at:
> > > > https://www.ngtech.co.il/repo/debian/11/x86_64/
> > > > However you need to know how to install it and I cannot work on 
> > > > the installer now. It's also doesn't include all of my patches yet.
> > > > From what I have seen at:
> > > > https://packages.debian.org/bullseye/squid
> > > > The current version at bullseye is 4.13 so you'd better try first 5.6
> > > > before any other things.      
> > > 
> > > That is the good idea! 
> > > 
> > > I'm already in trying to compile and install the latest 5.6 squid 
> > > version.
> > > 
> > > I am in GMT+3 time zone. 
> > > 
> > > Let you know about 5.6 results a bit latter. Thank you!    
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users

_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From simwin at mail.ru  Wed Jun 15 16:26:24 2022
From: simwin at mail.ru (simwin)
Date: Wed, 15 Jun 2022 19:26:24 +0300
Subject: [squid-users] There is the problems with instagram images and
 videos
In-Reply-To: <!&!AAAAAAAAAAAuAAAAAAAAAIVNjRjcTGZElYgADq7oyvYBAMO2jhD3dRHOtM0AqgC7tuYAAAAAAA4AABAAAAB4NUarGA4STJbHCMjCD8KbAQAAAAA=@articatech.com>
References: <20220614170736.543895f8@vs> <YqihwZ8+Qq41we7N@fantomas.sk>
 <20220614180141.092824f7@vs> <Yqiupn+lKA5IdEp3@fantomas.sk>
 <20220615001645.0b13681e@vs>
 <000001d88036$dee3f3e0$9cabdba0$@gmail.com>
 <20220615012312.2d89a23d@vs>
 <000801d8803f$173601e0$45a205a0$@gmail.com>
 <20220615021517.19aa0c75@vs>
 <000c01d8804a$c96c8fe0$5c45afa0$@gmail.com>
 <20220615121422.7497c2b3@vs> <20220615184800.3fb2f963@vs>
 <20220615190130.4bb3aa82@vs> <20220615191630.535e7719@vs>
 <!&!AAAAAAAAAAAuAAAAAAAAAIVNjRjcTGZElYgADq7oyvYBAMO2jhD3dRHOtM0AqgC7tuYAAAAAAA4AABAAAABM+hX+DFZOQoW1dnbcxZzLAQAAAAA=@articatech.com>
 <!&!AAAAAAAAAAAuAAAAAAAAAIVNjRjcTGZElYgADq7oyvYBAMO2jhD3dRHOtM0AqgC7tuYAAAAAAA4AABAAAAB4NUarGA4STJbHCMjCD8KbAQAAAAA=@articatech.com>
Message-ID: <20220615192624.1fec99bd@vs>

? Wed, 15 Jun 2022 17:20:09 +0100
<andre.bolinhas at articatech.com>:

> Also, without proxy, Instagram & Twitter works?
Can't check it. All instagram's traffic blocked in our country.


From dave at killthe.net  Wed Jun 15 16:36:09 2022
From: dave at killthe.net (Dave Blanchard)
Date: Wed, 15 Jun 2022 11:36:09 -0500
Subject: [squid-users] There is the problems with instagram images and
 videos
In-Reply-To: <20220615192624.1fec99bd@vs>
References: <20220614170736.543895f8@vs> <YqihwZ8+Qq41we7N@fantomas.sk>
 <20220614180141.092824f7@vs> <Yqiupn+lKA5IdEp3@fantomas.sk>
 <20220615001645.0b13681e@vs>
 <000001d88036$dee3f3e0$9cabdba0$@gmail.com>
 <20220615012312.2d89a23d@vs>
 <000801d8803f$173601e0$45a205a0$@gmail.com>
 <20220615021517.19aa0c75@vs>
 <000c01d8804a$c96c8fe0$5c45afa0$@gmail.com>
 <20220615121422.7497c2b3@vs> <20220615184800.3fb2f963@vs>
 <20220615190130.4bb3aa82@vs> <20220615191630.535e7719@vs>
 <!&!AAAAAAAAAAAuAAAAAAAAAIVNjRjcTGZElYgADq7oyvYBAMO2jhD3dRHOtM0AqgC7tuYAAAAAAA4AABAAAABM+hX+DFZOQoW1dnbcxZzLAQAAAAA=@articatech.com>
 <!&!AAAAAAAAAAAuAAAAAAAAAIVNjRjcTGZElYgADq7oyvYBAMO2jhD3dRHOtM0AqgC7tuYAAAAAAA4AABAAAAB4NUarGA4STJbHCMjCD8KbAQAAAAA=@articatech.com>
 <20220615192624.1fec99bd@vs>
Message-ID: <20220615113609.4f449e6e4c1db3ef3e407cc0@killthe.net>

On Wed, 15 Jun 2022 19:26:24 +0300
simwin <simwin at mail.ru> wrote:

> Can't check it. All instagram's traffic blocked in our country.

We are not so fortunate in the USA. I have to block it myself, at the DNS and firewall level.

-- 
Dave Blanchard <dave at killthe.net>


From andre.bolinhas at articatech.com  Wed Jun 15 16:43:17 2022
From: andre.bolinhas at articatech.com (andre.bolinhas at articatech.com)
Date: Wed, 15 Jun 2022 17:43:17 +0100
Subject: [squid-users] There is the problems with instagram images and
 videos
In-Reply-To: <20220615192624.1fec99bd@vs>
References: <20220614170736.543895f8@vs> <YqihwZ8+Qq41we7N@fantomas.sk>
 <20220614180141.092824f7@vs> <Yqiupn+lKA5IdEp3@fantomas.sk>
 <20220615001645.0b13681e@vs> <000001d88036$dee3f3e0$9cabdba0$@gmail.com>
 <20220615012312.2d89a23d@vs> <000801d8803f$173601e0$45a205a0$@gmail.com>
 <20220615021517.19aa0c75@vs> <000c01d8804a$c96c8fe0$5c45afa0$@gmail.com>
 <20220615121422.7497c2b3@vs> <20220615184800.3fb2f963@vs>
 <20220615190130.4bb3aa82@vs> <20220615191630.535e7719@vs>
 <!&!AAAAAAAAAAAuAAAAAAAAAIVNjRjcTGZElYgADq7oyvYBAMO2jhD3dRHOtM0AqgC7tuYAAAAAAA4AABAAAABM+hX+DFZOQoW1dnbcxZzLAQAAAAA=@articatech.com>
 <!&!AAAAAAAAAAAuAAAAAAAAAIVNjRjcTGZElYgADq7oyvYBAMO2jhD3dRHOtM0AqgC7tuYAAAAAAA4AABAAAAB4NUarGA4STJbHCMjCD8KbAQAAAAA=@articatech.com>
 <20220615192624.1fec99bd@vs>
Message-ID: <!&!AAAAAAAAAAAuAAAAAAAAAIVNjRjcTGZElYgADq7oyvYBAMO2jhD3dRHOtM0AqgC7tuYAAAAAAA4AABAAAADbdmoCXXgmTYXs4Q30Q+eXAQAAAAA=@articatech.com>

Hummm, so the problem is not in squid.
Try change the DNS in your squid server to a public ones like (1.1.1.1 or 8.8.8.8) maybe this can solve your issue, otherwise you will need to use a vpn.

Do not hesitate to contact me for any additional information.

Best regards,
Andr? Bolinhas
www: articatech.net
Help Desk: support.artica.systems
Skype: andre.bolinas



-----Mensagem original-----
De: squid-users <squid-users-bounces at lists.squid-cache.org> Em Nome De simwin
Enviada: 15 de junho de 2022 17:26
Para: squid-users at lists.squid-cache.org
Assunto: Re: [squid-users] There is the problems with instagram images and videos

? Wed, 15 Jun 2022 17:20:09 +0100
<andre.bolinhas at articatech.com>:

> Also, without proxy, Instagram & Twitter works?
Can't check it. All instagram's traffic blocked in our country.
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From robertkwild at gmail.com  Wed Jun 15 17:19:27 2022
From: robertkwild at gmail.com (robert k Wild)
Date: Wed, 15 Jun 2022 18:19:27 +0100
Subject: [squid-users] Logrotate question
Message-ID: <CAGU_CiL2m9WjAxTvh9+JVZWgmRNOxoBKytyd36t51M6Mku_eNA@mail.gmail.com>

Hi all,

ATM to clear the logs, I do this in crontab, every 3 months

0 0 1 */3 * echo "" > /usr/local/squid/var/logs/access.log and do the same
for cache log

It works but I want to really use log rotate ie

0 0 1 */3 * /usr/local/squid/sbin/squid -k rotate

I hear log rotate keeps 10 files by default so does that mean I will have
10 access logs etc and also will it keep the file the same ie won't change
the size or compress it to save space

Thanks,
Rob
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220615/41a6283d/attachment.htm>

From gtaylor at tnetconsulting.net  Wed Jun 15 18:44:01 2022
From: gtaylor at tnetconsulting.net (Grant Taylor)
Date: Wed, 15 Jun 2022 12:44:01 -0600
Subject: [squid-users] Logrotate question
In-Reply-To: <CAGU_CiL2m9WjAxTvh9+JVZWgmRNOxoBKytyd36t51M6Mku_eNA@mail.gmail.com>
References: <CAGU_CiL2m9WjAxTvh9+JVZWgmRNOxoBKytyd36t51M6Mku_eNA@mail.gmail.com>
Message-ID: <c8070ebf-4b96-4cfb-1c2f-94ff6411b512@spamtrap.tnetconsulting.net>

On 6/15/22 11:19 AM, robert k Wild wrote:
> I hear log rotate keeps 10 files by default so does that mean I will 
> have 10 access logs etc and also will it keep the file the same ie won't 
> change the size or compress it to save space

"by default" is the operative part of your question.

You can easily change just about all aspects of logrotate to make it 
treat each file the way that you want it to.



-- 
Grant. . . .
unix || die

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4017 bytes
Desc: S/MIME Cryptographic Signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220615/93c2b723/attachment.bin>

From ngtech1ltd at gmail.com  Thu Jun 16 06:50:23 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Thu, 16 Jun 2022 09:50:23 +0300
Subject: [squid-users] There is the problems with instagram images and
 videos
In-Reply-To: <20220615191630.535e7719@vs>
References: <20220614170736.543895f8@vs> <YqihwZ8+Qq41we7N@fantomas.sk>
 <20220614180141.092824f7@vs> <Yqiupn+lKA5IdEp3@fantomas.sk>
 <20220615001645.0b13681e@vs> <000001d88036$dee3f3e0$9cabdba0$@gmail.com>
 <20220615012312.2d89a23d@vs> <000801d8803f$173601e0$45a205a0$@gmail.com>
 <20220615021517.19aa0c75@vs> <000c01d8804a$c96c8fe0$5c45afa0$@gmail.com>
 <20220615121422.7497c2b3@vs> <20220615184800.3fb2f963@vs>
 <20220615190130.4bb3aa82@vs> <20220615191630.535e7719@vs>
Message-ID: <000001d8814d$5acdc7d0$10695770$@gmail.com>

Hey,

Let sum things up:
Squid-Cache works all over the world and you are having a trouble in a specific environment.
The main thing to do now is find the difference between others and you in the setup level.

First you referenced to a danted sock5 proxy.
So the issue is that your setup is more complex then a simple forward proxy.
I do not remember how socks5 works and also do not remember anything about a danted sock5 proxy.
I will try to learn more about such setups later and will try to response later on.

It's not a squid issue but please give me some tutorial that you might have used or will be good for me to re-produce such a setup.
Once I will have more details about the setup I might be able to respond the right way and be a bit smarter.

Eliezer

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of simwin
Sent: Wednesday, 15 June 2022 19:16
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] There is the problems with instagram images and videos


andre.bolinhas at articatech.com:

> TCP_TUNNEL/200 means that the proxy is able to establish a correct connection
> with the destination, do you have any firewall, antivirus, ad-blocker in
> between that could block the traffic?  

No antivirus, no firewall and no ad-blocker - I've checked it!. 

I've made ssh tunnel (ssh -D 0.0.0.0:8888) and make sock5 proxy to my server -
it works fine! But with danted sock5 proxy I have the same problem - no
instagram images, no videos.
 
Also it may be providers issue - all instagram's traffic blocked in our
country. 

That is why I need to know - does squid works with instagram (and twitter
videos) for anyone from another country with default squid config?

? Wed, 15 Jun 2022 19:01:30 +0300
simwin <simwin at mail.ru>:

> Plus squid -v:
> 
> configure options:  '--prefix=' '--bindir=/usr/bin' '--sbindir=/usr/sbin'
> '--libexecdir=/usr/libexec/squid' '--libdir=/usr/lib/squid'
> '--mandir=/usr/share/man/man8' '--sysconfdir=/etc/squid'
> '--with-default-user=proxy' '--with-pidfile=/run/squid.pid'
> '--with-logdir=/var/log/squid'
> 
> ? Wed, 15 Jun 2022 18:48:00 +0300
> simwin <simwin at mail.ru> ?????:
> 
> > With the latest stable squid-5.6-20220607-rfca8b79b5 the result is the same
> > - no instagram photos and videos :(
> > 
> > The squid configs is default, please see all info below:
> > 
> > $ grep -vE '^$|^#' /etc/squid/squid.conf
> > 
> > acl localnet src 0.0.0.1-0.255.255.255	
> > acl localnet src 10.0.0.0/8		
> > acl localnet src 100.64.0.0/10		
> > acl localnet src 169.254.0.0/16 	
> > acl localnet src 172.16.0.0/12		
> > acl localnet src 192.168.0.0/16		
> > acl localnet src fc00::/7       	
> > acl localnet src fe80::/10      	
> > acl SSL_ports port 443
> > acl Safe_ports port 80		# http
> > acl Safe_ports port 21		# ftp
> > acl Safe_ports port 443		# https
> > acl Safe_ports port 70		# gopher
> > acl Safe_ports port 210		# wais
> > acl Safe_ports port 1025-65535	# unregistered ports
> > acl Safe_ports port 280		# http-mgmt
> > acl Safe_ports port 488		# gss-http
> > acl Safe_ports port 591		# filemaker
> > acl Safe_ports port 777		# multiling http
> > 
> > auth_param basic program /usr/libexec/squid/basic_ncsa_auth
> > /etc/squid/internet_users
> > 
> > acl auth_users proxy_auth REQUIRED
> > http_access allow auth_users
> > auth_param basic casesensitive on
> > http_access deny !Safe_ports
> > http_access deny CONNECT !SSL_ports
> > http_access allow localhost manager
> > http_access deny manager
> > http_access allow localnet
> > http_access allow localhost
> > http_access deny all
> > http_port xxx.xxx.xxx.xxx:xxxx
> > coredump_dir /var/cache/squid
> > refresh_pattern ^ftp:		1440	20%	10080
> > refresh_pattern ^gopher:	1440	0%	1440
> > refresh_pattern -i (/cgi-bin/|\?) 0	0%	0
> > refresh_pattern .		0	20%	4320
> > 
> > Full squid.conf - https://pastebin.mozilla.org/JKSiBuvU/raw
> > Firefox 101 console errors - https://pastebin.mozilla.org/0Osvw45J/raw
> > Squid access.log - https://pastebin.mozilla.org/pOsXtMBW/raw
> > OS Debian 11
> > 
> > 2All: Please answer: does squid works with instagram (and twitter videos)
> > for anyone?!
> > 
> > ? Wed, 15 Jun 2022 12:14:22 +0300
> > simwin <simwin at mail.ru> ?????:
> >   
> > > ? Wed, 15 Jun 2022 02:59:29 +0300
> > > <ngtech1ltd at gmail.com>:
> > >     
> > > > I just compiled the newest version of Squid for Debian 11(bullseye) at:
> > > > https://www.ngtech.co.il/repo/debian/11/x86_64/ 
> > > > However you need to know how to install it and I cannot work on the
> > > > installer now. It's also doesn't include all of my patches yet.
> > > > From what I have seen at:
> > > > https://packages.debian.org/bullseye/squid
> > > > The current version at bullseye is 4.13 so you'd better try first 5.6
> > > > before any other things.      
> > > 
> > > That is the good idea! 
> > > 
> > > I'm already in trying to compile and install the latest 5.6 squid
> > > version.  
> > > 
> > > I am in GMT+3 time zone. 
> > > 
> > > Let you know about 5.6 results a bit latter. Thank you!    
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From ngtech1ltd at gmail.com  Thu Jun 16 07:11:31 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Thu, 16 Jun 2022 10:11:31 +0300
Subject: [squid-users] Logrotate question
In-Reply-To: <CAGU_CiL2m9WjAxTvh9+JVZWgmRNOxoBKytyd36t51M6Mku_eNA@mail.gmail.com>
References: <CAGU_CiL2m9WjAxTvh9+JVZWgmRNOxoBKytyd36t51M6Mku_eNA@mail.gmail.com>
Message-ID: <000601d88150$4ebff780$ec3fe680$@gmail.com>

Rob,
 
It will be different how you implement and use logrotate manually or with the logrotate tools.
What OS are you using?
 
Eliezer
 
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of robert k Wild
Sent: Wednesday, 15 June 2022 20:19
To: Squid Users <squid-users at lists.squid-cache.org>
Subject: [squid-users] Logrotate question
 
Hi all,
 
ATM to clear the logs, I do this in crontab, every 3 months
 
0 0 1 */3 * echo "" > /usr/local/squid/var/logs/access.log and do the same for cache log
 
It works but I want to really use log rotate ie
 
0 0 1 */3 * /usr/local/squid/sbin/squid -k rotate
 
I hear log rotate keeps 10 files by default so does that mean I will have 10 access logs etc and also will it keep the file the same ie won't change the size or compress it to save space
 
Thanks,
Rob
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220616/2cc6b95f/attachment.htm>

From uhlar at fantomas.sk  Thu Jun 16 07:28:08 2022
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Thu, 16 Jun 2022 09:28:08 +0200
Subject: [squid-users] There is the problems with instagram images and
 videos
In-Reply-To: <000001d8814d$5acdc7d0$10695770$@gmail.com>
References: <000001d88036$dee3f3e0$9cabdba0$@gmail.com>
 <20220615012312.2d89a23d@vs>
 <000801d8803f$173601e0$45a205a0$@gmail.com>
 <20220615021517.19aa0c75@vs>
 <000c01d8804a$c96c8fe0$5c45afa0$@gmail.com>
 <20220615121422.7497c2b3@vs> <20220615184800.3fb2f963@vs>
 <20220615190130.4bb3aa82@vs> <20220615191630.535e7719@vs>
 <000001d8814d$5acdc7d0$10695770$@gmail.com>
Message-ID: <YqrbiKTwMgHW6pNS@fantomas.sk>

On 16.06.22 09:50, ngtech1ltd at gmail.com wrote:
>Let sum things up:
>Squid-Cache works all over the world and you are having a trouble in a specific environment.
>The main thing to do now is find the difference between others and you in the setup level.
>
>First you referenced to a danted sock5 proxy.
>So the issue is that your setup is more complex then a simple forward proxy.
>I do not remember how socks5 works and also do not remember anything about a danted sock5 proxy.
>I will try to learn more about such setups later and will try to response later on.

according to the OP
"it works fine without squid proxy and with ssh-tunnel proxy from my
localhost, but with danted proxy I have the same problem - no images and no
videos"
http://lists.squid-cache.org/pipermail/squid-users/2022-June/024836.html

I assume it only works properly when using SOCKS proxy over SSH tunnelling.

since it does not work with local proxy, either danted or squid, tunnelling 
is required for instagram to work.
I have no idea how the blocking is done, via blocking or intercepting DNS 
- DNS over TLS ot DNS over HTTPS would help there
or simply blocking or redirecting destination servers
(access log could help).

However, I'm afraid that the tunnelling at least of connections to 
domains instagram uses is required for make it work.
-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Fucking windows! Bring Bill Gates! (Southpark the movie)


From robertkwild at gmail.com  Thu Jun 16 08:27:32 2022
From: robertkwild at gmail.com (robert k Wild)
Date: Thu, 16 Jun 2022 09:27:32 +0100
Subject: [squid-users] Logrotate question
In-Reply-To: <000601d88150$4ebff780$ec3fe680$@gmail.com>
References: <CAGU_CiL2m9WjAxTvh9+JVZWgmRNOxoBKytyd36t51M6Mku_eNA@mail.gmail.com>
 <000601d88150$4ebff780$ec3fe680$@gmail.com>
Message-ID: <CAGU_Ci+TkSF1wyWc_cLrP47vm+=RiC+3C-Lo4OsTO1=-ECeF5w@mail.gmail.com>

Thanks Eliezer

I have centos 7 and I want it to rotate every 3 months as we need to keep
logs for every 3 months.

Thanks,
Rob

On Thu, 16 Jun 2022, 08:11 , <ngtech1ltd at gmail.com> wrote:

> Rob,
>
>
>
> It will be different how you implement and use logrotate manually or with
> the logrotate tools.
>
> What OS are you using?
>
>
>
> Eliezer
>
>
>
> *From:* squid-users <squid-users-bounces at lists.squid-cache.org> *On
> Behalf Of *robert k Wild
> *Sent:* Wednesday, 15 June 2022 20:19
> *To:* Squid Users <squid-users at lists.squid-cache.org>
> *Subject:* [squid-users] Logrotate question
>
>
>
> Hi all,
>
>
>
> ATM to clear the logs, I do this in crontab, every 3 months
>
>
>
> 0 0 1 */3 * echo "" > /usr/local/squid/var/logs/access.log and do the same
> for cache log
>
>
>
> It works but I want to really use log rotate ie
>
>
>
> 0 0 1 */3 * /usr/local/squid/sbin/squid -k rotate
>
>
>
> I hear log rotate keeps 10 files by default so does that mean I will have
> 10 access logs etc and also will it keep the file the same ie won't change
> the size or compress it to save space
>
>
>
> Thanks,
>
> Rob
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220616/62aa1df8/attachment.htm>

From Antony.Stone at squid.open.source.it  Thu Jun 16 08:48:48 2022
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Thu, 16 Jun 2022 09:48:48 +0100
Subject: [squid-users] Logrotate question
In-Reply-To: <CAGU_Ci+TkSF1wyWc_cLrP47vm+=RiC+3C-Lo4OsTO1=-ECeF5w@mail.gmail.com>
References: <CAGU_CiL2m9WjAxTvh9+JVZWgmRNOxoBKytyd36t51M6Mku_eNA@mail.gmail.com>
 <000601d88150$4ebff780$ec3fe680$@gmail.com>
 <CAGU_Ci+TkSF1wyWc_cLrP47vm+=RiC+3C-Lo4OsTO1=-ECeF5w@mail.gmail.com>
Message-ID: <202206160948.49300.Antony.Stone@squid.open.source.it>

On Thursday 16 June 2022 at 09:27:32, robert k Wild wrote:

> Thanks Eliezer
> 
> I have centos 7 and I want it to rotate every 3 months as we need to keep
> logs for every 3 months.

Do you really mean you "need to keep logs for every 3 months"?

Or do you mean that you need to keep "the most recent 3 months' logs"?

I would recommend that you rotate every month, and keep 4 months' logs.

Firstly, there's no point in letting indivdual log files grow too large, and 
secondly, you then know that at all times you have the current month's logs, 
plus the previous 3 months, until the fourth one gets deleted by logrotate.


Antony.

> On Thu, 16 Jun 2022, 08:11 , <ngtech1ltd at gmail.com> wrote:
> > Rob,
> > 
> > It will be different how you implement and use logrotate manually or with
> > the logrotate tools.
> > 
> > What OS are you using?
> > 
> > Eliezer
> > 
> > *From:* squid-users <squid-users-bounces at lists.squid-cache.org> *On
> > Behalf Of *robert k Wild
> > *Sent:* Wednesday, 15 June 2022 20:19
> > *To:* Squid Users <squid-users at lists.squid-cache.org>
> > *Subject:* [squid-users] Logrotate question
> > 
> > Hi all,
> > 
> > ATM to clear the logs, I do this in crontab, every 3 months
> > 
> > 0 0 1 */3 * echo "" > /usr/local/squid/var/logs/access.log and do the
> > same for cache log
> > 
> > It works but I want to really use log rotate ie
> > 
> > 0 0 1 */3 * /usr/local/squid/sbin/squid -k rotate
> > 
> > I hear log rotate keeps 10 files by default so does that mean I will have
> > 10 access logs etc and also will it keep the file the same ie won't
> > change the size or compress it to save space
> > 
> > 
> > Thanks,
> > 
> > Rob
> > _______________________________________________
> > squid-users mailing list
> > squid-users at lists.squid-cache.org
> > http://lists.squid-cache.org/listinfo/squid-users

-- 
The next sentence is untrue.
The previous sentence is also not true.

                                                   Please reply to the list;
                                                         please *don't* CC me.


From robertkwild at gmail.com  Thu Jun 16 08:53:02 2022
From: robertkwild at gmail.com (robert k Wild)
Date: Thu, 16 Jun 2022 09:53:02 +0100
Subject: [squid-users] Logrotate question
In-Reply-To: <202206160948.49300.Antony.Stone@squid.open.source.it>
References: <CAGU_CiL2m9WjAxTvh9+JVZWgmRNOxoBKytyd36t51M6Mku_eNA@mail.gmail.com>
 <000601d88150$4ebff780$ec3fe680$@gmail.com>
 <CAGU_Ci+TkSF1wyWc_cLrP47vm+=RiC+3C-Lo4OsTO1=-ECeF5w@mail.gmail.com>
 <202206160948.49300.Antony.Stone@squid.open.source.it>
Message-ID: <CAGU_Ci+qWLTY72-eoDXwcjcg=R413qLJt9re=gJ+GOr9fJXubA@mail.gmail.com>

Hi Antony,

All I know is I need to keep a record of up to 3 months, worth of logs, due
to gdpr, how would you say I go about this

Thanks,
Rob

On Thu, 16 Jun 2022, 09:49 Antony Stone, <Antony.Stone at squid.open.source.it>
wrote:

> On Thursday 16 June 2022 at 09:27:32, robert k Wild wrote:
>
> > Thanks Eliezer
> >
> > I have centos 7 and I want it to rotate every 3 months as we need to keep
> > logs for every 3 months.
>
> Do you really mean you "need to keep logs for every 3 months"?
>
> Or do you mean that you need to keep "the most recent 3 months' logs"?
>
> I would recommend that you rotate every month, and keep 4 months' logs.
>
> Firstly, there's no point in letting indivdual log files grow too large,
> and
> secondly, you then know that at all times you have the current month's
> logs,
> plus the previous 3 months, until the fourth one gets deleted by logrotate.
>
>
> Antony.
>
> > On Thu, 16 Jun 2022, 08:11 , <ngtech1ltd at gmail.com> wrote:
> > > Rob,
> > >
> > > It will be different how you implement and use logrotate manually or
> with
> > > the logrotate tools.
> > >
> > > What OS are you using?
> > >
> > > Eliezer
> > >
> > > *From:* squid-users <squid-users-bounces at lists.squid-cache.org> *On
> > > Behalf Of *robert k Wild
> > > *Sent:* Wednesday, 15 June 2022 20:19
> > > *To:* Squid Users <squid-users at lists.squid-cache.org>
> > > *Subject:* [squid-users] Logrotate question
> > >
> > > Hi all,
> > >
> > > ATM to clear the logs, I do this in crontab, every 3 months
> > >
> > > 0 0 1 */3 * echo "" > /usr/local/squid/var/logs/access.log and do the
> > > same for cache log
> > >
> > > It works but I want to really use log rotate ie
> > >
> > > 0 0 1 */3 * /usr/local/squid/sbin/squid -k rotate
> > >
> > > I hear log rotate keeps 10 files by default so does that mean I will
> have
> > > 10 access logs etc and also will it keep the file the same ie won't
> > > change the size or compress it to save space
> > >
> > >
> > > Thanks,
> > >
> > > Rob
> > > _______________________________________________
> > > squid-users mailing list
> > > squid-users at lists.squid-cache.org
> > > http://lists.squid-cache.org/listinfo/squid-users
>
> --
> The next sentence is untrue.
> The previous sentence is also not true.
>
>                                                    Please reply to the
> list;
>                                                          please *don't* CC
> me.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220616/e0bec6a4/attachment.htm>

From uhlar at fantomas.sk  Thu Jun 16 09:22:01 2022
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Thu, 16 Jun 2022 11:22:01 +0200
Subject: [squid-users] Logrotate question
In-Reply-To: <CAGU_Ci+qWLTY72-eoDXwcjcg=R413qLJt9re=gJ+GOr9fJXubA@mail.gmail.com>
References: <CAGU_CiL2m9WjAxTvh9+JVZWgmRNOxoBKytyd36t51M6Mku_eNA@mail.gmail.com>
 <000601d88150$4ebff780$ec3fe680$@gmail.com>
 <CAGU_Ci+TkSF1wyWc_cLrP47vm+=RiC+3C-Lo4OsTO1=-ECeF5w@mail.gmail.com>
 <202206160948.49300.Antony.Stone@squid.open.source.it>
 <CAGU_Ci+qWLTY72-eoDXwcjcg=R413qLJt9re=gJ+GOr9fJXubA@mail.gmail.com>
Message-ID: <Yqr2Oep5n142uWkX@fantomas.sk>

On 16.06.22 09:53, robert k Wild wrote:
>All I know is I need to keep a record of up to 3 months, worth of logs, due
>to gdpr, how would you say I go about this

keeping 3 months of log is very different from rotating each 3 months.
configure logrotate to rotate daily and keep 92 days worth of logs.

I believe centos squid package comes with logrotate configured, should be in 
/etc/logrotate.d/squid

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
I feel like I'm diagonally parked in a parallel universe.


From robertkwild at gmail.com  Thu Jun 16 09:23:52 2022
From: robertkwild at gmail.com (robert k Wild)
Date: Thu, 16 Jun 2022 10:23:52 +0100
Subject: [squid-users] Logrotate question
In-Reply-To: <Yqr2Oep5n142uWkX@fantomas.sk>
References: <CAGU_CiL2m9WjAxTvh9+JVZWgmRNOxoBKytyd36t51M6Mku_eNA@mail.gmail.com>
 <000601d88150$4ebff780$ec3fe680$@gmail.com>
 <CAGU_Ci+TkSF1wyWc_cLrP47vm+=RiC+3C-Lo4OsTO1=-ECeF5w@mail.gmail.com>
 <202206160948.49300.Antony.Stone@squid.open.source.it>
 <CAGU_Ci+qWLTY72-eoDXwcjcg=R413qLJt9re=gJ+GOr9fJXubA@mail.gmail.com>
 <Yqr2Oep5n142uWkX@fantomas.sk>
Message-ID: <CAGU_CiKQp8J20rzHwFBnE5XYE5pnDGNGqiJnoT9Fb9e4CMSU0g@mail.gmail.com>

So I can use the package logrotate instead of the squid one

On Thu, 16 Jun 2022, 10:22 Matus UHLAR - fantomas, <uhlar at fantomas.sk>
wrote:

> On 16.06.22 09:53, robert k Wild wrote:
> >All I know is I need to keep a record of up to 3 months, worth of logs,
> due
> >to gdpr, how would you say I go about this
>
> keeping 3 months of log is very different from rotating each 3 months.
> configure logrotate to rotate daily and keep 92 days worth of logs.
>
> I believe centos squid package comes with logrotate configured, should be
> in
> /etc/logrotate.d/squid
>
> --
> Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
> Warning: I wish NOT to receive e-mail advertising to this address.
> Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
> I feel like I'm diagonally parked in a parallel universe.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220616/06ba336e/attachment.htm>

From uhlar at fantomas.sk  Thu Jun 16 09:26:40 2022
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Thu, 16 Jun 2022 11:26:40 +0200
Subject: [squid-users] Logrotate question
In-Reply-To: <CAGU_CiKQp8J20rzHwFBnE5XYE5pnDGNGqiJnoT9Fb9e4CMSU0g@mail.gmail.com>
References: <CAGU_CiL2m9WjAxTvh9+JVZWgmRNOxoBKytyd36t51M6Mku_eNA@mail.gmail.com>
 <000601d88150$4ebff780$ec3fe680$@gmail.com>
 <CAGU_Ci+TkSF1wyWc_cLrP47vm+=RiC+3C-Lo4OsTO1=-ECeF5w@mail.gmail.com>
 <202206160948.49300.Antony.Stone@squid.open.source.it>
 <CAGU_Ci+qWLTY72-eoDXwcjcg=R413qLJt9re=gJ+GOr9fJXubA@mail.gmail.com>
 <Yqr2Oep5n142uWkX@fantomas.sk>
 <CAGU_CiKQp8J20rzHwFBnE5XYE5pnDGNGqiJnoT9Fb9e4CMSU0g@mail.gmail.com>
Message-ID: <Yqr3UH3s/GEENzB2@fantomas.sk>

On 16.06.22 10:23, robert k Wild wrote:
>So I can use the package logrotate instead of the squid one

squid packages in debian comes configured for rotating logs with logrotate.
- logfile_rotate is set to 0
- logrotate config file tells when/how to rotate

perhaps it's the same with centos.


>On Thu, 16 Jun 2022, 10:22 Matus UHLAR - fantomas, <uhlar at fantomas.sk>
>wrote:
>
>> On 16.06.22 09:53, robert k Wild wrote:
>> >All I know is I need to keep a record of up to 3 months, worth of logs,
>> due
>> >to gdpr, how would you say I go about this
>>
>> keeping 3 months of log is very different from rotating each 3 months.
>> configure logrotate to rotate daily and keep 92 days worth of logs.
>>
>> I believe centos squid package comes with logrotate configured, should be
>> in
>> /etc/logrotate.d/squid


-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
My mind is like a steel trap - rusty and illegal in 37 states.


From Antony.Stone at squid.open.source.it  Thu Jun 16 09:31:57 2022
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Thu, 16 Jun 2022 10:31:57 +0100
Subject: [squid-users] Logrotate question
In-Reply-To: <CAGU_Ci+qWLTY72-eoDXwcjcg=R413qLJt9re=gJ+GOr9fJXubA@mail.gmail.com>
References: <CAGU_CiL2m9WjAxTvh9+JVZWgmRNOxoBKytyd36t51M6Mku_eNA@mail.gmail.com>
 <202206160948.49300.Antony.Stone@squid.open.source.it>
 <CAGU_Ci+qWLTY72-eoDXwcjcg=R413qLJt9re=gJ+GOr9fJXubA@mail.gmail.com>
Message-ID: <202206161031.57789.Antony.Stone@squid.open.source.it>

On Thursday 16 June 2022 at 09:53:02, robert k Wild wrote:

> Hi Antony,
> 
> All I know is I need to keep a record of up to 3 months, worth of logs, due
> to gdpr, how would you say I go about this

Here's the standard logrotate file for Squid3 which is installed on Debian (I 
doubt that CentOS should be significantly different):

-----
/var/log/squid/*.log {
        daily
        compress
        delaycompress
        rotate 2
        missingok
        nocreate
        sharedscripts
        prerotate
                test ! -x /usr/sbin/sarg-reports || /usr/sbin/sarg-reports 
daily
        endscript
        postrotate
                test ! -e /var/run/squid.pid || test ! -x /usr/sbin/squid || 
/usr/sbin/squid -k rotate
        endscript
}
-----

I suggest modifying this for your needs to:

-----
/var/log/squid/*.log {
        monthly
        rotate 4
        missingok
        nocreate
        sharedscripts
        prerotate
                test ! -x /usr/sbin/sarg-reports || /usr/sbin/sarg-reports 
daily
        endscript
        postrotate
                test ! -e /var/run/squid.pid || test ! -x /usr/sbin/squid || 
/usr/sbin/squid -k rotate
        endscript
}
-----

Regards,


Antony.

-- 
Your work is both good and original.  Unfortunately the parts that are good 
aren't original, and the parts that are original aren't good.

 - Samuel Johnson

                                                   Please reply to the list;
                                                         please *don't* CC me.


From robertkwild at gmail.com  Thu Jun 16 09:32:22 2022
From: robertkwild at gmail.com (robert k Wild)
Date: Thu, 16 Jun 2022 10:32:22 +0100
Subject: [squid-users] Logrotate question
In-Reply-To: <Yqr3UH3s/GEENzB2@fantomas.sk>
References: <CAGU_CiL2m9WjAxTvh9+JVZWgmRNOxoBKytyd36t51M6Mku_eNA@mail.gmail.com>
 <000601d88150$4ebff780$ec3fe680$@gmail.com>
 <CAGU_Ci+TkSF1wyWc_cLrP47vm+=RiC+3C-Lo4OsTO1=-ECeF5w@mail.gmail.com>
 <202206160948.49300.Antony.Stone@squid.open.source.it>
 <CAGU_Ci+qWLTY72-eoDXwcjcg=R413qLJt9re=gJ+GOr9fJXubA@mail.gmail.com>
 <Yqr2Oep5n142uWkX@fantomas.sk>
 <CAGU_CiKQp8J20rzHwFBnE5XYE5pnDGNGqiJnoT9Fb9e4CMSU0g@mail.gmail.com>
 <Yqr3UH3s/GEENzB2@fantomas.sk>
Message-ID: <CAGU_CiKb6yCApZW2N6N4-LmkednanKbpCHwVWvyy+5ycmBx9wA@mail.gmail.com>

Cool, Thanks all, il try the logrotate program instead of using squids one

Thanks guys :)

On Thu, 16 Jun 2022, 10:26 Matus UHLAR - fantomas, <uhlar at fantomas.sk>
wrote:

> On 16.06.22 10:23, robert k Wild wrote:
> >So I can use the package logrotate instead of the squid one
>
> squid packages in debian comes configured for rotating logs with logrotate.
> - logfile_rotate is set to 0
> - logrotate config file tells when/how to rotate
>
> perhaps it's the same with centos.
>
>
> >On Thu, 16 Jun 2022, 10:22 Matus UHLAR - fantomas, <uhlar at fantomas.sk>
> >wrote:
> >
> >> On 16.06.22 09:53, robert k Wild wrote:
> >> >All I know is I need to keep a record of up to 3 months, worth of logs,
> >> due
> >> >to gdpr, how would you say I go about this
> >>
> >> keeping 3 months of log is very different from rotating each 3 months.
> >> configure logrotate to rotate daily and keep 92 days worth of logs.
> >>
> >> I believe centos squid package comes with logrotate configured, should
> be
> >> in
> >> /etc/logrotate.d/squid
>
>
> --
> Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
> Warning: I wish NOT to receive e-mail advertising to this address.
> Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
> My mind is like a steel trap - rusty and illegal in 37 states.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220616/0dfa7c59/attachment.htm>

From ngtech1ltd at gmail.com  Thu Jun 16 09:39:09 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Thu, 16 Jun 2022 12:39:09 +0300
Subject: [squid-users] Logrotate question
In-Reply-To: <CAGU_Ci+TkSF1wyWc_cLrP47vm+=RiC+3C-Lo4OsTO1=-ECeF5w@mail.gmail.com>
References: <CAGU_CiL2m9WjAxTvh9+JVZWgmRNOxoBKytyd36t51M6Mku_eNA@mail.gmail.com>
 <000601d88150$4ebff780$ec3fe680$@gmail.com>
 <CAGU_Ci+TkSF1wyWc_cLrP47vm+=RiC+3C-Lo4OsTO1=-ECeF5w@mail.gmail.com>
Message-ID: <001201d88164$ee63cbe0$cb2b63a0$@gmail.com>

Hey Rob,
 
First there is a difference between rotation and deletion.
If it?s not a loaded system then 3 month is ok but? in most use cases it?s better to rotate every day but to delete after 3 month.
You have the choice to compress the files or to leave them in plain text but it?s only a choice of resources preservation.
 
Let me see, I will look at my CentOS 7 system and will try to find the right way to do it.
 
Eliezer
 
From: robert k Wild <robertkwild at gmail.com> 
Sent: Thursday, 16 June 2022 11:28
To: Eliezer Croitoru <ngtech1ltd at gmail.com>
Cc: Squid Users <squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] Logrotate question
 
Thanks Eliezer
 
I have centos 7 and I want it to rotate every 3 months as we need to keep logs for every 3 months.
 
Thanks,
Rob
 
On Thu, 16 Jun 2022, 08:11 , <ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> > wrote:
Rob,
 
It will be different how you implement and use logrotate manually or with the logrotate tools.
What OS are you using?
 
Eliezer
 
From: squid-users <squid-users-bounces at lists.squid-cache.org <mailto:squid-users-bounces at lists.squid-cache.org> > On Behalf Of robert k Wild
Sent: Wednesday, 15 June 2022 20:19
To: Squid Users <squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> >
Subject: [squid-users] Logrotate question
 
Hi all,
 
ATM to clear the logs, I do this in crontab, every 3 months
 
0 0 1 */3 * echo "" > /usr/local/squid/var/logs/access.log and do the same for cache log
 
It works but I want to really use log rotate ie
 
0 0 1 */3 * /usr/local/squid/sbin/squid -k rotate
 
I hear log rotate keeps 10 files by default so does that mean I will have 10 access logs etc and also will it keep the file the same ie won't change the size or compress it to save space
 
Thanks,
Rob
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> 
http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220616/b778f0cc/attachment.htm>

From ngtech1ltd at gmail.com  Thu Jun 16 09:45:17 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Thu, 16 Jun 2022 12:45:17 +0300
Subject: [squid-users] Logrotate question
In-Reply-To: <CAGU_CiKb6yCApZW2N6N4-LmkednanKbpCHwVWvyy+5ycmBx9wA@mail.gmail.com>
References: <CAGU_CiL2m9WjAxTvh9+JVZWgmRNOxoBKytyd36t51M6Mku_eNA@mail.gmail.com>
 <000601d88150$4ebff780$ec3fe680$@gmail.com>
 <CAGU_Ci+TkSF1wyWc_cLrP47vm+=RiC+3C-Lo4OsTO1=-ECeF5w@mail.gmail.com>
 <202206160948.49300.Antony.Stone@squid.open.source.it>
 <CAGU_Ci+qWLTY72-eoDXwcjcg=R413qLJt9re=gJ+GOr9fJXubA@mail.gmail.com>
 <Yqr2Oep5n142uWkX@fantomas.sk>
 <CAGU_CiKQp8J20rzHwFBnE5XYE5pnDGNGqiJnoT9Fb9e4CMSU0g@mail.gmail.com>
 <Yqr3UH3s/GEENzB2@fantomas.sk>
 <CAGU_CiKb6yCApZW2N6N4-LmkednanKbpCHwVWvyy+5ycmBx9wA@mail.gmail.com>
Message-ID: <002101d88165$ca38f500$5eaadf00$@gmail.com>

You should combine them both.
I am checking this for you right now?
 
Eliezer
 
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of robert k Wild
Sent: Thursday, 16 June 2022 12:32
To: Squid Users <squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] Logrotate question
 
Cool, Thanks all, il try the logrotate program instead of using squids one
 
Thanks guys :)
 
On Thu, 16 Jun 2022, 10:26 Matus UHLAR - fantomas, <uhlar at fantomas.sk <mailto:uhlar at fantomas.sk> > wrote:
On 16.06.22 10:23, robert k Wild wrote:
>So I can use the package logrotate instead of the squid one

squid packages in debian comes configured for rotating logs with logrotate.
- logfile_rotate is set to 0
- logrotate config file tells when/how to rotate

perhaps it's the same with centos.


>On Thu, 16 Jun 2022, 10:22 Matus UHLAR - fantomas, <uhlar at fantomas.sk <mailto:uhlar at fantomas.sk> >
>wrote:
>
>> On 16.06.22 09:53, robert k Wild wrote:
>> >All I know is I need to keep a record of up to 3 months, worth of logs,
>> due
>> >to gdpr, how would you say I go about this
>>
>> keeping 3 months of log is very different from rotating each 3 months.
>> configure logrotate to rotate daily and keep 92 days worth of logs.
>>
>> I believe centos squid package comes with logrotate configured, should be
>> in
>> /etc/logrotate.d/squid


-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk <mailto:uhlar at fantomas.sk>  ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
My mind is like a steel trap - rusty and illegal in 37 states.
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> 
http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220616/da25ad69/attachment.htm>

From robertkwild at gmail.com  Thu Jun 16 09:54:54 2022
From: robertkwild at gmail.com (robert k Wild)
Date: Thu, 16 Jun 2022 10:54:54 +0100
Subject: [squid-users] Logrotate question
In-Reply-To: <001201d88164$ee63cbe0$cb2b63a0$@gmail.com>
References: <CAGU_CiL2m9WjAxTvh9+JVZWgmRNOxoBKytyd36t51M6Mku_eNA@mail.gmail.com>
 <000601d88150$4ebff780$ec3fe680$@gmail.com>
 <CAGU_Ci+TkSF1wyWc_cLrP47vm+=RiC+3C-Lo4OsTO1=-ECeF5w@mail.gmail.com>
 <001201d88164$ee63cbe0$cb2b63a0$@gmail.com>
Message-ID: <CAGU_CiLZVtrjs+8o3D3Jhu6t0iYoBWeQeW+L_6neXys0ckAooA@mail.gmail.com>

Hi Eliezer,

Basically I want to keep logs for 3 months then rotate so it overwrites
them with another 3 months, if that makes sense

On Thu, 16 Jun 2022, 10:39 , <ngtech1ltd at gmail.com> wrote:

> Hey Rob,
>
>
>
> First there is a difference between rotation and deletion.
>
> If it?s not a loaded system then 3 month is ok but? in most use cases
> it?s better to rotate every day but to delete after 3 month.
>
> You have the choice to compress the files or to leave them in plain text
> but it?s only a choice of resources preservation.
>
>
>
> Let me see, I will look at my CentOS 7 system and will try to find the
> right way to do it.
>
>
>
> Eliezer
>
>
>
> *From:* robert k Wild <robertkwild at gmail.com>
> *Sent:* Thursday, 16 June 2022 11:28
> *To:* Eliezer Croitoru <ngtech1ltd at gmail.com>
> *Cc:* Squid Users <squid-users at lists.squid-cache.org>
> *Subject:* Re: [squid-users] Logrotate question
>
>
>
> Thanks Eliezer
>
>
>
> I have centos 7 and I want it to rotate every 3 months as we need to keep
> logs for every 3 months.
>
>
>
> Thanks,
>
> Rob
>
>
>
> On Thu, 16 Jun 2022, 08:11 , <ngtech1ltd at gmail.com> wrote:
>
> Rob,
>
>
>
> It will be different how you implement and use logrotate manually or with
> the logrotate tools.
>
> What OS are you using?
>
>
>
> Eliezer
>
>
>
> *From:* squid-users <squid-users-bounces at lists.squid-cache.org> *On
> Behalf Of *robert k Wild
> *Sent:* Wednesday, 15 June 2022 20:19
> *To:* Squid Users <squid-users at lists.squid-cache.org>
> *Subject:* [squid-users] Logrotate question
>
>
>
> Hi all,
>
>
>
> ATM to clear the logs, I do this in crontab, every 3 months
>
>
>
> 0 0 1 */3 * echo "" > /usr/local/squid/var/logs/access.log and do the same
> for cache log
>
>
>
> It works but I want to really use log rotate ie
>
>
>
> 0 0 1 */3 * /usr/local/squid/sbin/squid -k rotate
>
>
>
> I hear log rotate keeps 10 files by default so does that mean I will have
> 10 access logs etc and also will it keep the file the same ie won't change
> the size or compress it to save space
>
>
>
> Thanks,
>
> Rob
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220616/00467834/attachment.htm>

From uhlar at fantomas.sk  Thu Jun 16 10:14:08 2022
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Thu, 16 Jun 2022 12:14:08 +0200
Subject: [squid-users] Logrotate question
In-Reply-To: <CAGU_CiLZVtrjs+8o3D3Jhu6t0iYoBWeQeW+L_6neXys0ckAooA@mail.gmail.com>
References: <CAGU_CiL2m9WjAxTvh9+JVZWgmRNOxoBKytyd36t51M6Mku_eNA@mail.gmail.com>
 <000601d88150$4ebff780$ec3fe680$@gmail.com>
 <CAGU_Ci+TkSF1wyWc_cLrP47vm+=RiC+3C-Lo4OsTO1=-ECeF5w@mail.gmail.com>
 <001201d88164$ee63cbe0$cb2b63a0$@gmail.com>
 <CAGU_CiLZVtrjs+8o3D3Jhu6t0iYoBWeQeW+L_6neXys0ckAooA@mail.gmail.com>
Message-ID: <YqsCcAD35D1ka/rY@fantomas.sk>

On 16.06.22 10:54, robert k Wild wrote:
>Basically I want to keep logs for 3 months then rotate so it overwrites
>them with another 3 months, if that makes sense

in fact, it does not.

I guess you are supposed to keep 3 months of logs, which mean, you always 
need to have 3 months of logs available.

Each day, you can delete log files over 3 months old.

If you rotated lof once in 3 months, you would have single file with 3 
months of logs in it, and could remove it 3 months after rotating, when 
first logs would be 6 months old.

As we already told you, rotate daily and remove old logs after 92 days.
and use logrotate config.

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Linux - It's now safe to turn on your computer.
Linux - Teraz mozete pocitac bez obav zapnut.


From robertkwild at gmail.com  Thu Jun 16 10:26:37 2022
From: robertkwild at gmail.com (robert k Wild)
Date: Thu, 16 Jun 2022 11:26:37 +0100
Subject: [squid-users] Logrotate question
In-Reply-To: <YqsCcAD35D1ka/rY@fantomas.sk>
References: <CAGU_CiL2m9WjAxTvh9+JVZWgmRNOxoBKytyd36t51M6Mku_eNA@mail.gmail.com>
 <000601d88150$4ebff780$ec3fe680$@gmail.com>
 <CAGU_Ci+TkSF1wyWc_cLrP47vm+=RiC+3C-Lo4OsTO1=-ECeF5w@mail.gmail.com>
 <001201d88164$ee63cbe0$cb2b63a0$@gmail.com>
 <CAGU_CiLZVtrjs+8o3D3Jhu6t0iYoBWeQeW+L_6neXys0ckAooA@mail.gmail.com>
 <YqsCcAD35D1ka/rY@fantomas.sk>
Message-ID: <CAGU_CiKqDaPSo6+pJ2XhdBJJcnzsUQOZOnSVyAPPcy-Sp5EOQQ@mail.gmail.com>

Cool, so I will rotate daily and delete after 91 days, thanks guys

On Thu, 16 Jun 2022, 11:14 Matus UHLAR - fantomas, <uhlar at fantomas.sk>
wrote:

> On 16.06.22 10:54, robert k Wild wrote:
> >Basically I want to keep logs for 3 months then rotate so it overwrites
> >them with another 3 months, if that makes sense
>
> in fact, it does not.
>
> I guess you are supposed to keep 3 months of logs, which mean, you always
> need to have 3 months of logs available.
>
> Each day, you can delete log files over 3 months old.
>
> If you rotated lof once in 3 months, you would have single file with 3
> months of logs in it, and could remove it 3 months after rotating, when
> first logs would be 6 months old.
>
> As we already told you, rotate daily and remove old logs after 92 days.
> and use logrotate config.
>
> --
> Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
> Warning: I wish NOT to receive e-mail advertising to this address.
> Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
> Linux - It's now safe to turn on your computer.
> Linux - Teraz mozete pocitac bez obav zapnut.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220616/01af8a3c/attachment.htm>

From Antony.Stone at squid.open.source.it  Thu Jun 16 10:41:10 2022
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Thu, 16 Jun 2022 11:41:10 +0100
Subject: [squid-users] Logrotate question
In-Reply-To: <CAGU_CiKqDaPSo6+pJ2XhdBJJcnzsUQOZOnSVyAPPcy-Sp5EOQQ@mail.gmail.com>
References: <CAGU_CiL2m9WjAxTvh9+JVZWgmRNOxoBKytyd36t51M6Mku_eNA@mail.gmail.com>
 <YqsCcAD35D1ka/rY@fantomas.sk>
 <CAGU_CiKqDaPSo6+pJ2XhdBJJcnzsUQOZOnSVyAPPcy-Sp5EOQQ@mail.gmail.com>
Message-ID: <202206161141.11119.Antony.Stone@squid.open.source.it>

On Thursday 16 June 2022 at 11:26:37, robert k Wild wrote:

> Cool, so I will rotate daily and delete after 91 days, thanks guys

Why did you change the recommended 92 days into 91?

Consider June, July and August:

	June has 30 days
	July has 31 days
	August has 31 days

So, on September 1st, June 1st is 92 days ago, and you can delete the logs for 
May 31st, which are older than 92 days.

If you deleted older than 91 days, you would be deleting June 1st on September 
1st, and one day this might be significant to someone.


Antony.

> On Thu, 16 Jun 2022, 11:14 Matus UHLAR - fantomas wrote:
> > On 16.06.22 10:54, robert k Wild wrote:
> > >Basically I want to keep logs for 3 months then rotate so it overwrites
> > >them with another 3 months, if that makes sense
> > 
> > in fact, it does not.
> > 
> > I guess you are supposed to keep 3 months of logs, which mean, you always
> > need to have 3 months of logs available.
> > 
> > Each day, you can delete log files over 3 months old.
> > 
> > If you rotated lof once in 3 months, you would have single file with 3
> > months of logs in it, and could remove it 3 months after rotating, when
> > first logs would be 6 months old.
> > 
> > As we already told you, rotate daily and remove old logs after 92 days.
> > and use logrotate config.

-- 
I just got a new mobile phone, and I called it Titanic.  It's already syncing.

                                                   Please reply to the list;
                                                         please *don't* CC me.


From robertkwild at gmail.com  Thu Jun 16 10:56:23 2022
From: robertkwild at gmail.com (robert k Wild)
Date: Thu, 16 Jun 2022 11:56:23 +0100
Subject: [squid-users] Logrotate question
In-Reply-To: <202206161141.11119.Antony.Stone@squid.open.source.it>
References: <CAGU_CiL2m9WjAxTvh9+JVZWgmRNOxoBKytyd36t51M6Mku_eNA@mail.gmail.com>
 <YqsCcAD35D1ka/rY@fantomas.sk>
 <CAGU_CiKqDaPSo6+pJ2XhdBJJcnzsUQOZOnSVyAPPcy-Sp5EOQQ@mail.gmail.com>
 <202206161141.11119.Antony.Stone@squid.open.source.it>
Message-ID: <CAGU_Ci+0oWzzcnWeFDh-KQ_RBTYrM=Hogb8rFEc=qXr0b9X=iA@mail.gmail.com>

Ok sorry as normally 3 months is 90 days and I just added a 1 to it, but I
get what you mean if months have 31 I should really do 93 as I want to give
it extra room incase

On Thu, 16 Jun 2022, 11:41 Antony Stone, <Antony.Stone at squid.open.source.it>
wrote:

> On Thursday 16 June 2022 at 11:26:37, robert k Wild wrote:
>
> > Cool, so I will rotate daily and delete after 91 days, thanks guys
>
> Why did you change the recommended 92 days into 91?
>
> Consider June, July and August:
>
>         June has 30 days
>         July has 31 days
>         August has 31 days
>
> So, on September 1st, June 1st is 92 days ago, and you can delete the logs
> for
> May 31st, which are older than 92 days.
>
> If you deleted older than 91 days, you would be deleting June 1st on
> September
> 1st, and one day this might be significant to someone.
>
>
> Antony.
>
> > On Thu, 16 Jun 2022, 11:14 Matus UHLAR - fantomas wrote:
> > > On 16.06.22 10:54, robert k Wild wrote:
> > > >Basically I want to keep logs for 3 months then rotate so it
> overwrites
> > > >them with another 3 months, if that makes sense
> > >
> > > in fact, it does not.
> > >
> > > I guess you are supposed to keep 3 months of logs, which mean, you
> always
> > > need to have 3 months of logs available.
> > >
> > > Each day, you can delete log files over 3 months old.
> > >
> > > If you rotated lof once in 3 months, you would have single file with 3
> > > months of logs in it, and could remove it 3 months after rotating, when
> > > first logs would be 6 months old.
> > >
> > > As we already told you, rotate daily and remove old logs after 92 days.
> > > and use logrotate config.
>
> --
> I just got a new mobile phone, and I called it Titanic.  It's already
> syncing.
>
>                                                    Please reply to the
> list;
>                                                          please *don't* CC
> me.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220616/dd823404/attachment.htm>

From ngtech1ltd at gmail.com  Thu Jun 16 10:59:41 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Thu, 16 Jun 2022 13:59:41 +0300
Subject: [squid-users] Logrotate question
In-Reply-To: <CAGU_CiKqDaPSo6+pJ2XhdBJJcnzsUQOZOnSVyAPPcy-Sp5EOQQ@mail.gmail.com>
References: <CAGU_CiL2m9WjAxTvh9+JVZWgmRNOxoBKytyd36t51M6Mku_eNA@mail.gmail.com>
 <000601d88150$4ebff780$ec3fe680$@gmail.com>
 <CAGU_Ci+TkSF1wyWc_cLrP47vm+=RiC+3C-Lo4OsTO1=-ECeF5w@mail.gmail.com>
 <001201d88164$ee63cbe0$cb2b63a0$@gmail.com>
 <CAGU_CiLZVtrjs+8o3D3Jhu6t0iYoBWeQeW+L_6neXys0ckAooA@mail.gmail.com>
 <YqsCcAD35D1ka/rY@fantomas.sk>
 <CAGU_CiKqDaPSo6+pJ2XhdBJJcnzsUQOZOnSVyAPPcy-Sp5EOQQ@mail.gmail.com>
Message-ID: <002f01d88170$2e977df0$8bc679d0$@gmail.com>

Hey Rob,
 
The next is the file:
 
 
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of robert k Wild
Sent: Thursday, 16 June 2022 13:27
To: Squid Users <squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] Logrotate question
 
Cool, so I will rotate daily and delete after 91 days, thanks guys
 
On Thu, 16 Jun 2022, 11:14 Matus UHLAR - fantomas, <uhlar at fantomas.sk <mailto:uhlar at fantomas.sk> > wrote:
On 16.06.22 10:54, robert k Wild wrote:
>Basically I want to keep logs for 3 months then rotate so it overwrites
>them with another 3 months, if that makes sense

in fact, it does not.

I guess you are supposed to keep 3 months of logs, which mean, you always 
need to have 3 months of logs available.

Each day, you can delete log files over 3 months old.

If you rotated lof once in 3 months, you would have single file with 3 
months of logs in it, and could remove it 3 months after rotating, when 
first logs would be 6 months old.

As we already told you, rotate daily and remove old logs after 92 days.
and use logrotate config.

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk <mailto:uhlar at fantomas.sk>  ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Linux - It's now safe to turn on your computer.
Linux - Teraz mozete pocitac bez obav zapnut.
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> 
http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220616/b70c3d21/attachment.htm>

From ngtech1ltd at gmail.com  Thu Jun 16 11:01:17 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Thu, 16 Jun 2022 14:01:17 +0300
Subject: [squid-users] Logrotate question
References: <CAGU_CiL2m9WjAxTvh9+JVZWgmRNOxoBKytyd36t51M6Mku_eNA@mail.gmail.com>
 <000601d88150$4ebff780$ec3fe680$@gmail.com>
 <CAGU_Ci+TkSF1wyWc_cLrP47vm+=RiC+3C-Lo4OsTO1=-ECeF5w@mail.gmail.com>
 <001201d88164$ee63cbe0$cb2b63a0$@gmail.com>
 <CAGU_CiLZVtrjs+8o3D3Jhu6t0iYoBWeQeW+L_6neXys0ckAooA@mail.gmail.com>
 <YqsCcAD35D1ka/rY@fantomas.sk>
 <CAGU_CiKqDaPSo6+pJ2XhdBJJcnzsUQOZOnSVyAPPcy-Sp5EOQQ@mail.gmail.com> 
Message-ID: <003401d88170$67e7bbb0$37b73310$@gmail.com>

Oops,
 
The next is the file: /etc/logrotate.d/squid
##START
/var/log/squid/*.log {
    weekly
    rotate 5
    compress
    notifempty
    missingok
    nocreate
    sharedscripts
    postrotate
      # Asks squid to reopen its logs. (logfile_rotate 0 is set in squid.conf)
      # errors redirected to make it silent if squid is not running
      /usr/sbin/squid -k rotate 2>/dev/null
      # Wait a little to allow Squid to catch up before the logs is compressed
      sleep 1
    endscript
}
##END
 
So you need to change the rotate to 92+ and also change the squid number of logs to the same number.
 
Let me know if you it?s helpful.
 
Eliezer
 
From: ngtech1ltd at gmail.com <ngtech1ltd at gmail.com> 
Sent: Thursday, 16 June 2022 14:00
To: 'robert k Wild' <robertkwild at gmail.com>; 'Squid Users' <squid-users at lists.squid-cache.org>
Subject: RE: [squid-users] Logrotate question
 
Hey Rob,
 
The next is the file:
 
 
From: squid-users <squid-users-bounces at lists.squid-cache.org <mailto:squid-users-bounces at lists.squid-cache.org> > On Behalf Of robert k Wild
Sent: Thursday, 16 June 2022 13:27
To: Squid Users <squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> >
Subject: Re: [squid-users] Logrotate question
 
Cool, so I will rotate daily and delete after 91 days, thanks guys
 
On Thu, 16 Jun 2022, 11:14 Matus UHLAR - fantomas, <uhlar at fantomas.sk <mailto:uhlar at fantomas.sk> > wrote:
On 16.06.22 10:54, robert k Wild wrote:
>Basically I want to keep logs for 3 months then rotate so it overwrites
>them with another 3 months, if that makes sense

in fact, it does not.

I guess you are supposed to keep 3 months of logs, which mean, you always 
need to have 3 months of logs available.

Each day, you can delete log files over 3 months old.

If you rotated lof once in 3 months, you would have single file with 3 
months of logs in it, and could remove it 3 months after rotating, when 
first logs would be 6 months old.

As we already told you, rotate daily and remove old logs after 92 days.
and use logrotate config.

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk <mailto:uhlar at fantomas.sk>  ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Linux - It's now safe to turn on your computer.
Linux - Teraz mozete pocitac bez obav zapnut.
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> 
http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220616/22490d44/attachment.htm>

From robertkwild at gmail.com  Thu Jun 16 11:04:07 2022
From: robertkwild at gmail.com (robert k Wild)
Date: Thu, 16 Jun 2022 12:04:07 +0100
Subject: [squid-users] Logrotate question
In-Reply-To: <003401d88170$67e7bbb0$37b73310$@gmail.com>
References: <CAGU_CiL2m9WjAxTvh9+JVZWgmRNOxoBKytyd36t51M6Mku_eNA@mail.gmail.com>
 <000601d88150$4ebff780$ec3fe680$@gmail.com>
 <CAGU_Ci+TkSF1wyWc_cLrP47vm+=RiC+3C-Lo4OsTO1=-ECeF5w@mail.gmail.com>
 <001201d88164$ee63cbe0$cb2b63a0$@gmail.com>
 <CAGU_CiLZVtrjs+8o3D3Jhu6t0iYoBWeQeW+L_6neXys0ckAooA@mail.gmail.com>
 <YqsCcAD35D1ka/rY@fantomas.sk>
 <CAGU_CiKqDaPSo6+pJ2XhdBJJcnzsUQOZOnSVyAPPcy-Sp5EOQQ@mail.gmail.com>
 <003401d88170$67e7bbb0$37b73310$@gmail.com>
Message-ID: <CAGU_Ci+hX4y9RwwSgx-199AFCnPSXEnW_vOXSu_ssfTZg7Fx0w@mail.gmail.com>

I imagine Eliezer that's what I need to put in logrotate.conf file

On Thu, 16 Jun 2022, 12:01 , <ngtech1ltd at gmail.com> wrote:

> Oops,
>
>
>
> The next is the file: /etc/logrotate.d/squid
>
> ##START
>
> /var/log/squid/*.log {
>
>     weekly
>
>     rotate 5
>
>     compress
>
>     notifempty
>
>     missingok
>
>     nocreate
>
>     sharedscripts
>
>     postrotate
>
>       # Asks squid to reopen its logs. (logfile_rotate 0 is set in
> squid.conf)
>
>       # errors redirected to make it silent if squid is not running
>
>       /usr/sbin/squid -k rotate 2>/dev/null
>
>       # Wait a little to allow Squid to catch up before the logs is
> compressed
>
>       sleep 1
>
>     endscript
>
> }
>
> ##END
>
>
>
> So you need to change the rotate to 92+ and also change the squid number
> of logs to the same number.
>
>
>
> Let me know if you it?s helpful.
>
>
>
> Eliezer
>
>
>
> *From:* ngtech1ltd at gmail.com <ngtech1ltd at gmail.com>
> *Sent:* Thursday, 16 June 2022 14:00
> *To:* 'robert k Wild' <robertkwild at gmail.com>; 'Squid Users' <
> squid-users at lists.squid-cache.org>
> *Subject:* RE: [squid-users] Logrotate question
>
>
>
> Hey Rob,
>
>
>
> The next is the file:
>
>
>
>
>
> *From:* squid-users <squid-users-bounces at lists.squid-cache.org> *On
> Behalf Of *robert k Wild
> *Sent:* Thursday, 16 June 2022 13:27
> *To:* Squid Users <squid-users at lists.squid-cache.org>
> *Subject:* Re: [squid-users] Logrotate question
>
>
>
> Cool, so I will rotate daily and delete after 91 days, thanks guys
>
>
>
> On Thu, 16 Jun 2022, 11:14 Matus UHLAR - fantomas, <uhlar at fantomas.sk>
> wrote:
>
> On 16.06.22 10:54, robert k Wild wrote:
> >Basically I want to keep logs for 3 months then rotate so it overwrites
> >them with another 3 months, if that makes sense
>
> in fact, it does not.
>
> I guess you are supposed to keep 3 months of logs, which mean, you always
> need to have 3 months of logs available.
>
> Each day, you can delete log files over 3 months old.
>
> If you rotated lof once in 3 months, you would have single file with 3
> months of logs in it, and could remove it 3 months after rotating, when
> first logs would be 6 months old.
>
> As we already told you, rotate daily and remove old logs after 92 days.
> and use logrotate config.
>
> --
> Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
> Warning: I wish NOT to receive e-mail advertising to this address.
> Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
> Linux - It's now safe to turn on your computer.
> Linux - Teraz mozete pocitac bez obav zapnut.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220616/628e88fb/attachment.htm>

From robertkwild at gmail.com  Thu Jun 16 11:04:41 2022
From: robertkwild at gmail.com (robert k Wild)
Date: Thu, 16 Jun 2022 12:04:41 +0100
Subject: [squid-users] Logrotate question
In-Reply-To: <CAGU_Ci+hX4y9RwwSgx-199AFCnPSXEnW_vOXSu_ssfTZg7Fx0w@mail.gmail.com>
References: <CAGU_CiL2m9WjAxTvh9+JVZWgmRNOxoBKytyd36t51M6Mku_eNA@mail.gmail.com>
 <000601d88150$4ebff780$ec3fe680$@gmail.com>
 <CAGU_Ci+TkSF1wyWc_cLrP47vm+=RiC+3C-Lo4OsTO1=-ECeF5w@mail.gmail.com>
 <001201d88164$ee63cbe0$cb2b63a0$@gmail.com>
 <CAGU_CiLZVtrjs+8o3D3Jhu6t0iYoBWeQeW+L_6neXys0ckAooA@mail.gmail.com>
 <YqsCcAD35D1ka/rY@fantomas.sk>
 <CAGU_CiKqDaPSo6+pJ2XhdBJJcnzsUQOZOnSVyAPPcy-Sp5EOQQ@mail.gmail.com>
 <003401d88170$67e7bbb0$37b73310$@gmail.com>
 <CAGU_Ci+hX4y9RwwSgx-199AFCnPSXEnW_vOXSu_ssfTZg7Fx0w@mail.gmail.com>
Message-ID: <CAGU_CiKfV6x2TO1B05ARXbbOcX15pszJvFWxVzqCvET5FJkZFA@mail.gmail.com>

Oops sorry you did say that, sorry I didn't see that at first

On Thu, 16 Jun 2022, 12:04 robert k Wild, <robertkwild at gmail.com> wrote:

> I imagine Eliezer that's what I need to put in logrotate.conf file
>
> On Thu, 16 Jun 2022, 12:01 , <ngtech1ltd at gmail.com> wrote:
>
>> Oops,
>>
>>
>>
>> The next is the file: /etc/logrotate.d/squid
>>
>> ##START
>>
>> /var/log/squid/*.log {
>>
>>     weekly
>>
>>     rotate 5
>>
>>     compress
>>
>>     notifempty
>>
>>     missingok
>>
>>     nocreate
>>
>>     sharedscripts
>>
>>     postrotate
>>
>>       # Asks squid to reopen its logs. (logfile_rotate 0 is set in
>> squid.conf)
>>
>>       # errors redirected to make it silent if squid is not running
>>
>>       /usr/sbin/squid -k rotate 2>/dev/null
>>
>>       # Wait a little to allow Squid to catch up before the logs is
>> compressed
>>
>>       sleep 1
>>
>>     endscript
>>
>> }
>>
>> ##END
>>
>>
>>
>> So you need to change the rotate to 92+ and also change the squid number
>> of logs to the same number.
>>
>>
>>
>> Let me know if you it?s helpful.
>>
>>
>>
>> Eliezer
>>
>>
>>
>> *From:* ngtech1ltd at gmail.com <ngtech1ltd at gmail.com>
>> *Sent:* Thursday, 16 June 2022 14:00
>> *To:* 'robert k Wild' <robertkwild at gmail.com>; 'Squid Users' <
>> squid-users at lists.squid-cache.org>
>> *Subject:* RE: [squid-users] Logrotate question
>>
>>
>>
>> Hey Rob,
>>
>>
>>
>> The next is the file:
>>
>>
>>
>>
>>
>> *From:* squid-users <squid-users-bounces at lists.squid-cache.org> *On
>> Behalf Of *robert k Wild
>> *Sent:* Thursday, 16 June 2022 13:27
>> *To:* Squid Users <squid-users at lists.squid-cache.org>
>> *Subject:* Re: [squid-users] Logrotate question
>>
>>
>>
>> Cool, so I will rotate daily and delete after 91 days, thanks guys
>>
>>
>>
>> On Thu, 16 Jun 2022, 11:14 Matus UHLAR - fantomas, <uhlar at fantomas.sk>
>> wrote:
>>
>> On 16.06.22 10:54, robert k Wild wrote:
>> >Basically I want to keep logs for 3 months then rotate so it overwrites
>> >them with another 3 months, if that makes sense
>>
>> in fact, it does not.
>>
>> I guess you are supposed to keep 3 months of logs, which mean, you always
>> need to have 3 months of logs available.
>>
>> Each day, you can delete log files over 3 months old.
>>
>> If you rotated lof once in 3 months, you would have single file with 3
>> months of logs in it, and could remove it 3 months after rotating, when
>> first logs would be 6 months old.
>>
>> As we already told you, rotate daily and remove old logs after 92 days.
>> and use logrotate config.
>>
>> --
>> Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
>> Warning: I wish NOT to receive e-mail advertising to this address.
>> Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
>> Linux - It's now safe to turn on your computer.
>> Linux - Teraz mozete pocitac bez obav zapnut.
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
>>
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220616/f0fc2b35/attachment.htm>

From ngtech1ltd at gmail.com  Thu Jun 16 11:27:32 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Thu, 16 Jun 2022 14:27:32 +0300
Subject: [squid-users] Logrotate question
In-Reply-To: <CAGU_CiKfV6x2TO1B05ARXbbOcX15pszJvFWxVzqCvET5FJkZFA@mail.gmail.com>
References: <CAGU_CiL2m9WjAxTvh9+JVZWgmRNOxoBKytyd36t51M6Mku_eNA@mail.gmail.com>
 <000601d88150$4ebff780$ec3fe680$@gmail.com>
 <CAGU_Ci+TkSF1wyWc_cLrP47vm+=RiC+3C-Lo4OsTO1=-ECeF5w@mail.gmail.com>
 <001201d88164$ee63cbe0$cb2b63a0$@gmail.com>
 <CAGU_CiLZVtrjs+8o3D3Jhu6t0iYoBWeQeW+L_6neXys0ckAooA@mail.gmail.com>
 <YqsCcAD35D1ka/rY@fantomas.sk>
 <CAGU_CiKqDaPSo6+pJ2XhdBJJcnzsUQOZOnSVyAPPcy-Sp5EOQQ@mail.gmail.com>
 <003401d88170$67e7bbb0$37b73310$@gmail.com>
 <CAGU_Ci+hX4y9RwwSgx-199AFCnPSXEnW_vOXSu_ssfTZg7Fx0w@mail.gmail.com>
 <CAGU_CiKfV6x2TO1B05ARXbbOcX15pszJvFWxVzqCvET5FJkZFA@mail.gmail.com>
Message-ID: <004201d88174$1272c310$37584930$@gmail.com>

How did you installed squid on CentOS 7?
>From my packages or the OS default or self compiled or another source?
 
Eliezer
 
From: robert k Wild <robertkwild at gmail.com> 
Sent: Thursday, 16 June 2022 14:05
To: Eliezer Croitoru <ngtech1ltd at gmail.com>
Cc: Squid Users <squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] Logrotate question
 
Oops sorry you did say that, sorry I didn't see that at first
 
On Thu, 16 Jun 2022, 12:04 robert k Wild, <robertkwild at gmail.com <mailto:robertkwild at gmail.com> > wrote:
I imagine Eliezer that's what I need to put in logrotate.conf file
 
On Thu, 16 Jun 2022, 12:01 , <ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> > wrote:
Oops,
 
The next is the file: /etc/logrotate.d/squid
##START
/var/log/squid/*.log {
    weekly
    rotate 5
    compress
    notifempty
    missingok
    nocreate
    sharedscripts
    postrotate
      # Asks squid to reopen its logs. (logfile_rotate 0 is set in squid.conf)
      # errors redirected to make it silent if squid is not running
      /usr/sbin/squid -k rotate 2>/dev/null
      # Wait a little to allow Squid to catch up before the logs is compressed
      sleep 1
    endscript
}
##END
 
So you need to change the rotate to 92+ and also change the squid number of logs to the same number.
 
Let me know if you it?s helpful.
 
Eliezer
 
From: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com>  <ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> > 
Sent: Thursday, 16 June 2022 14:00
To: 'robert k Wild' <robertkwild at gmail.com <mailto:robertkwild at gmail.com> >; 'Squid Users' <squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> >
Subject: RE: [squid-users] Logrotate question
 
Hey Rob,
 
The next is the file:
 
 
From: squid-users <squid-users-bounces at lists.squid-cache.org <mailto:squid-users-bounces at lists.squid-cache.org> > On Behalf Of robert k Wild
Sent: Thursday, 16 June 2022 13:27
To: Squid Users <squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> >
Subject: Re: [squid-users] Logrotate question
 
Cool, so I will rotate daily and delete after 91 days, thanks guys
 
On Thu, 16 Jun 2022, 11:14 Matus UHLAR - fantomas, <uhlar at fantomas.sk <mailto:uhlar at fantomas.sk> > wrote:
On 16.06.22 10:54, robert k Wild wrote:
>Basically I want to keep logs for 3 months then rotate so it overwrites
>them with another 3 months, if that makes sense

in fact, it does not.

I guess you are supposed to keep 3 months of logs, which mean, you always 
need to have 3 months of logs available.

Each day, you can delete log files over 3 months old.

If you rotated lof once in 3 months, you would have single file with 3 
months of logs in it, and could remove it 3 months after rotating, when 
first logs would be 6 months old.

As we already told you, rotate daily and remove old logs after 92 days.
and use logrotate config.

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk <mailto:uhlar at fantomas.sk>  ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Linux - It's now safe to turn on your computer.
Linux - Teraz mozete pocitac bez obav zapnut.
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> 
http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220616/a54dc288/attachment.htm>

From robertkwild at gmail.com  Thu Jun 16 11:51:38 2022
From: robertkwild at gmail.com (robert k Wild)
Date: Thu, 16 Jun 2022 12:51:38 +0100
Subject: [squid-users] Logrotate question
In-Reply-To: <004201d88174$1272c310$37584930$@gmail.com>
References: <CAGU_CiL2m9WjAxTvh9+JVZWgmRNOxoBKytyd36t51M6Mku_eNA@mail.gmail.com>
 <000601d88150$4ebff780$ec3fe680$@gmail.com>
 <CAGU_Ci+TkSF1wyWc_cLrP47vm+=RiC+3C-Lo4OsTO1=-ECeF5w@mail.gmail.com>
 <001201d88164$ee63cbe0$cb2b63a0$@gmail.com>
 <CAGU_CiLZVtrjs+8o3D3Jhu6t0iYoBWeQeW+L_6neXys0ckAooA@mail.gmail.com>
 <YqsCcAD35D1ka/rY@fantomas.sk>
 <CAGU_CiKqDaPSo6+pJ2XhdBJJcnzsUQOZOnSVyAPPcy-Sp5EOQQ@mail.gmail.com>
 <003401d88170$67e7bbb0$37b73310$@gmail.com>
 <CAGU_Ci+hX4y9RwwSgx-199AFCnPSXEnW_vOXSu_ssfTZg7Fx0w@mail.gmail.com>
 <CAGU_CiKfV6x2TO1B05ARXbbOcX15pszJvFWxVzqCvET5FJkZFA@mail.gmail.com>
 <004201d88174$1272c310$37584930$@gmail.com>
Message-ID: <CAGU_CiJtUe3nbaS2utWuecWEL4krzOtbxJvjS0LzZbpyiB51-A@mail.gmail.com>

Self compiled from source with others ie

Squidclamav
Cicap
Cicap modules

And clamav but did this one via yum install


On Thu, 16 Jun 2022, 12:27 , <ngtech1ltd at gmail.com> wrote:

> How did you installed squid on CentOS 7?
>
> From my packages or the OS default or self compiled or another source?
>
>
>
> Eliezer
>
>
>
> *From:* robert k Wild <robertkwild at gmail.com>
> *Sent:* Thursday, 16 June 2022 14:05
> *To:* Eliezer Croitoru <ngtech1ltd at gmail.com>
> *Cc:* Squid Users <squid-users at lists.squid-cache.org>
> *Subject:* Re: [squid-users] Logrotate question
>
>
>
> Oops sorry you did say that, sorry I didn't see that at first
>
>
>
> On Thu, 16 Jun 2022, 12:04 robert k Wild, <robertkwild at gmail.com> wrote:
>
> I imagine Eliezer that's what I need to put in logrotate.conf file
>
>
>
> On Thu, 16 Jun 2022, 12:01 , <ngtech1ltd at gmail.com> wrote:
>
> Oops,
>
>
>
> The next is the file: /etc/logrotate.d/squid
>
> ##START
>
> /var/log/squid/*.log {
>
>     weekly
>
>     rotate 5
>
>     compress
>
>     notifempty
>
>     missingok
>
>     nocreate
>
>     sharedscripts
>
>     postrotate
>
>       # Asks squid to reopen its logs. (logfile_rotate 0 is set in
> squid.conf)
>
>       # errors redirected to make it silent if squid is not running
>
>       /usr/sbin/squid -k rotate 2>/dev/null
>
>       # Wait a little to allow Squid to catch up before the logs is
> compressed
>
>       sleep 1
>
>     endscript
>
> }
>
> ##END
>
>
>
> So you need to change the rotate to 92+ and also change the squid number
> of logs to the same number.
>
>
>
> Let me know if you it?s helpful.
>
>
>
> Eliezer
>
>
>
> *From:* ngtech1ltd at gmail.com <ngtech1ltd at gmail.com>
> *Sent:* Thursday, 16 June 2022 14:00
> *To:* 'robert k Wild' <robertkwild at gmail.com>; 'Squid Users' <
> squid-users at lists.squid-cache.org>
> *Subject:* RE: [squid-users] Logrotate question
>
>
>
> Hey Rob,
>
>
>
> The next is the file:
>
>
>
>
>
> *From:* squid-users <squid-users-bounces at lists.squid-cache.org> *On
> Behalf Of *robert k Wild
> *Sent:* Thursday, 16 June 2022 13:27
> *To:* Squid Users <squid-users at lists.squid-cache.org>
> *Subject:* Re: [squid-users] Logrotate question
>
>
>
> Cool, so I will rotate daily and delete after 91 days, thanks guys
>
>
>
> On Thu, 16 Jun 2022, 11:14 Matus UHLAR - fantomas, <uhlar at fantomas.sk>
> wrote:
>
> On 16.06.22 10:54, robert k Wild wrote:
> >Basically I want to keep logs for 3 months then rotate so it overwrites
> >them with another 3 months, if that makes sense
>
> in fact, it does not.
>
> I guess you are supposed to keep 3 months of logs, which mean, you always
> need to have 3 months of logs available.
>
> Each day, you can delete log files over 3 months old.
>
> If you rotated lof once in 3 months, you would have single file with 3
> months of logs in it, and could remove it 3 months after rotating, when
> first logs would be 6 months old.
>
> As we already told you, rotate daily and remove old logs after 92 days.
> and use logrotate config.
>
> --
> Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
> Warning: I wish NOT to receive e-mail advertising to this address.
> Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
> Linux - It's now safe to turn on your computer.
> Linux - Teraz mozete pocitac bez obav zapnut.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220616/08edaea6/attachment.htm>

From ngtech1ltd at gmail.com  Thu Jun 16 12:19:41 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Thu, 16 Jun 2022 15:19:41 +0300
Subject: [squid-users] Logrotate question
In-Reply-To: <CAGU_CiJtUe3nbaS2utWuecWEL4krzOtbxJvjS0LzZbpyiB51-A@mail.gmail.com>
References: <CAGU_CiL2m9WjAxTvh9+JVZWgmRNOxoBKytyd36t51M6Mku_eNA@mail.gmail.com>
 <000601d88150$4ebff780$ec3fe680$@gmail.com>
 <CAGU_Ci+TkSF1wyWc_cLrP47vm+=RiC+3C-Lo4OsTO1=-ECeF5w@mail.gmail.com>
 <001201d88164$ee63cbe0$cb2b63a0$@gmail.com>
 <CAGU_CiLZVtrjs+8o3D3Jhu6t0iYoBWeQeW+L_6neXys0ckAooA@mail.gmail.com>
 <YqsCcAD35D1ka/rY@fantomas.sk>
 <CAGU_CiKqDaPSo6+pJ2XhdBJJcnzsUQOZOnSVyAPPcy-Sp5EOQQ@mail.gmail.com>
 <003401d88170$67e7bbb0$37b73310$@gmail.com>
 <CAGU_Ci+hX4y9RwwSgx-199AFCnPSXEnW_vOXSu_ssfTZg7Fx0w@mail.gmail.com>
 <CAGU_CiKfV6x2TO1B05ARXbbOcX15pszJvFWxVzqCvET5FJkZFA@mail.gmail.com>
 <004201d88174$1272c310$37584930$@gmail.com>
 <CAGU_CiJtUe3nbaS2utWuecWEL4krzOtbxJvjS0LzZbpyiB51-A@mail.gmail.com>
Message-ID: <004901d8817b$5bb070c0$13115240$@gmail.com>

Since this one is from yum install it?s very simple to just change the config files of squid and logrotate.
 
If you need more assistance let me know.
 
Eliezer
 
From: robert k Wild <robertkwild at gmail.com> 
Sent: Thursday, 16 June 2022 14:52
To: Eliezer Croitoru <ngtech1ltd at gmail.com>
Cc: Squid Users <squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] Logrotate question
 
Self compiled from source with others ie
 
Squidclamav
Cicap
Cicap modules
 
And clamav but did this one via yum install
 
 
On Thu, 16 Jun 2022, 12:27 , <ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> > wrote:
How did you installed squid on CentOS 7?
>From my packages or the OS default or self compiled or another source?
 
Eliezer
 
From: robert k Wild <robertkwild at gmail.com <mailto:robertkwild at gmail.com> > 
Sent: Thursday, 16 June 2022 14:05
To: Eliezer Croitoru <ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> >
Cc: Squid Users <squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> >
Subject: Re: [squid-users] Logrotate question
 
Oops sorry you did say that, sorry I didn't see that at first
 
On Thu, 16 Jun 2022, 12:04 robert k Wild, <robertkwild at gmail.com <mailto:robertkwild at gmail.com> > wrote:
I imagine Eliezer that's what I need to put in logrotate.conf file
 
On Thu, 16 Jun 2022, 12:01 , <ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> > wrote:
Oops,
 
The next is the file: /etc/logrotate.d/squid
##START
/var/log/squid/*.log {
    weekly
    rotate 5
    compress
    notifempty
    missingok
    nocreate
    sharedscripts
    postrotate
      # Asks squid to reopen its logs. (logfile_rotate 0 is set in squid.conf)
      # errors redirected to make it silent if squid is not running
      /usr/sbin/squid -k rotate 2>/dev/null
      # Wait a little to allow Squid to catch up before the logs is compressed
      sleep 1
    endscript
}
##END
 
So you need to change the rotate to 92+ and also change the squid number of logs to the same number.
 
Let me know if you it?s helpful.
 
Eliezer
 
From: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com>  <ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> > 
Sent: Thursday, 16 June 2022 14:00
To: 'robert k Wild' <robertkwild at gmail.com <mailto:robertkwild at gmail.com> >; 'Squid Users' <squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> >
Subject: RE: [squid-users] Logrotate question
 
Hey Rob,
 
The next is the file:
 
 
From: squid-users <squid-users-bounces at lists.squid-cache.org <mailto:squid-users-bounces at lists.squid-cache.org> > On Behalf Of robert k Wild
Sent: Thursday, 16 June 2022 13:27
To: Squid Users <squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> >
Subject: Re: [squid-users] Logrotate question
 
Cool, so I will rotate daily and delete after 91 days, thanks guys
 
On Thu, 16 Jun 2022, 11:14 Matus UHLAR - fantomas, <uhlar at fantomas.sk <mailto:uhlar at fantomas.sk> > wrote:
On 16.06.22 10:54, robert k Wild wrote:
>Basically I want to keep logs for 3 months then rotate so it overwrites
>them with another 3 months, if that makes sense

in fact, it does not.

I guess you are supposed to keep 3 months of logs, which mean, you always 
need to have 3 months of logs available.

Each day, you can delete log files over 3 months old.

If you rotated lof once in 3 months, you would have single file with 3 
months of logs in it, and could remove it 3 months after rotating, when 
first logs would be 6 months old.

As we already told you, rotate daily and remove old logs after 92 days.
and use logrotate config.

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk <mailto:uhlar at fantomas.sk>  ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Linux - It's now safe to turn on your computer.
Linux - Teraz mozete pocitac bez obav zapnut.
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> 
http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220616/4d46e1b4/attachment.htm>

From robertkwild at gmail.com  Thu Jun 16 12:24:10 2022
From: robertkwild at gmail.com (robert k Wild)
Date: Thu, 16 Jun 2022 13:24:10 +0100
Subject: [squid-users] Logrotate question
In-Reply-To: <004901d8817b$5bb070c0$13115240$@gmail.com>
References: <CAGU_CiL2m9WjAxTvh9+JVZWgmRNOxoBKytyd36t51M6Mku_eNA@mail.gmail.com>
 <000601d88150$4ebff780$ec3fe680$@gmail.com>
 <CAGU_Ci+TkSF1wyWc_cLrP47vm+=RiC+3C-Lo4OsTO1=-ECeF5w@mail.gmail.com>
 <001201d88164$ee63cbe0$cb2b63a0$@gmail.com>
 <CAGU_CiLZVtrjs+8o3D3Jhu6t0iYoBWeQeW+L_6neXys0ckAooA@mail.gmail.com>
 <YqsCcAD35D1ka/rY@fantomas.sk>
 <CAGU_CiKqDaPSo6+pJ2XhdBJJcnzsUQOZOnSVyAPPcy-Sp5EOQQ@mail.gmail.com>
 <003401d88170$67e7bbb0$37b73310$@gmail.com>
 <CAGU_Ci+hX4y9RwwSgx-199AFCnPSXEnW_vOXSu_ssfTZg7Fx0w@mail.gmail.com>
 <CAGU_CiKfV6x2TO1B05ARXbbOcX15pszJvFWxVzqCvET5FJkZFA@mail.gmail.com>
 <004201d88174$1272c310$37584930$@gmail.com>
 <CAGU_CiJtUe3nbaS2utWuecWEL4krzOtbxJvjS0LzZbpyiB51-A@mail.gmail.com>
 <004901d8817b$5bb070c0$13115240$@gmail.com>
Message-ID: <CAGU_CiKAf6bcF7gPVL0wGjePHuuE58GukcJB=KqyHpunNBvZsw@mail.gmail.com>

No squid isn't sorry it is compiled from source, I forgot to add it sorry
about that

On Thu, 16 Jun 2022, 13:19 , <ngtech1ltd at gmail.com> wrote:

> Since this one is from yum install it?s very simple to just change the
> config files of squid and logrotate.
>
>
>
> If you need more assistance let me know.
>
>
>
> Eliezer
>
>
>
> *From:* robert k Wild <robertkwild at gmail.com>
> *Sent:* Thursday, 16 June 2022 14:52
> *To:* Eliezer Croitoru <ngtech1ltd at gmail.com>
> *Cc:* Squid Users <squid-users at lists.squid-cache.org>
> *Subject:* Re: [squid-users] Logrotate question
>
>
>
> Self compiled from source with others ie
>
>
>
> Squidclamav
>
> Cicap
>
> Cicap modules
>
>
>
> And clamav but did this one via yum install
>
>
>
>
>
> On Thu, 16 Jun 2022, 12:27 , <ngtech1ltd at gmail.com> wrote:
>
> How did you installed squid on CentOS 7?
>
> From my packages or the OS default or self compiled or another source?
>
>
>
> Eliezer
>
>
>
> *From:* robert k Wild <robertkwild at gmail.com>
> *Sent:* Thursday, 16 June 2022 14:05
> *To:* Eliezer Croitoru <ngtech1ltd at gmail.com>
> *Cc:* Squid Users <squid-users at lists.squid-cache.org>
> *Subject:* Re: [squid-users] Logrotate question
>
>
>
> Oops sorry you did say that, sorry I didn't see that at first
>
>
>
> On Thu, 16 Jun 2022, 12:04 robert k Wild, <robertkwild at gmail.com> wrote:
>
> I imagine Eliezer that's what I need to put in logrotate.conf file
>
>
>
> On Thu, 16 Jun 2022, 12:01 , <ngtech1ltd at gmail.com> wrote:
>
> Oops,
>
>
>
> The next is the file: /etc/logrotate.d/squid
>
> ##START
>
> /var/log/squid/*.log {
>
>     weekly
>
>     rotate 5
>
>     compress
>
>     notifempty
>
>     missingok
>
>     nocreate
>
>     sharedscripts
>
>     postrotate
>
>       # Asks squid to reopen its logs. (logfile_rotate 0 is set in
> squid.conf)
>
>       # errors redirected to make it silent if squid is not running
>
>       /usr/sbin/squid -k rotate 2>/dev/null
>
>       # Wait a little to allow Squid to catch up before the logs is
> compressed
>
>       sleep 1
>
>     endscript
>
> }
>
> ##END
>
>
>
> So you need to change the rotate to 92+ and also change the squid number
> of logs to the same number.
>
>
>
> Let me know if you it?s helpful.
>
>
>
> Eliezer
>
>
>
> *From:* ngtech1ltd at gmail.com <ngtech1ltd at gmail.com>
> *Sent:* Thursday, 16 June 2022 14:00
> *To:* 'robert k Wild' <robertkwild at gmail.com>; 'Squid Users' <
> squid-users at lists.squid-cache.org>
> *Subject:* RE: [squid-users] Logrotate question
>
>
>
> Hey Rob,
>
>
>
> The next is the file:
>
>
>
>
>
> *From:* squid-users <squid-users-bounces at lists.squid-cache.org> *On
> Behalf Of *robert k Wild
> *Sent:* Thursday, 16 June 2022 13:27
> *To:* Squid Users <squid-users at lists.squid-cache.org>
> *Subject:* Re: [squid-users] Logrotate question
>
>
>
> Cool, so I will rotate daily and delete after 91 days, thanks guys
>
>
>
> On Thu, 16 Jun 2022, 11:14 Matus UHLAR - fantomas, <uhlar at fantomas.sk>
> wrote:
>
> On 16.06.22 10:54, robert k Wild wrote:
> >Basically I want to keep logs for 3 months then rotate so it overwrites
> >them with another 3 months, if that makes sense
>
> in fact, it does not.
>
> I guess you are supposed to keep 3 months of logs, which mean, you always
> need to have 3 months of logs available.
>
> Each day, you can delete log files over 3 months old.
>
> If you rotated lof once in 3 months, you would have single file with 3
> months of logs in it, and could remove it 3 months after rotating, when
> first logs would be 6 months old.
>
> As we already told you, rotate daily and remove old logs after 92 days.
> and use logrotate config.
>
> --
> Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
> Warning: I wish NOT to receive e-mail advertising to this address.
> Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
> Linux - It's now safe to turn on your computer.
> Linux - Teraz mozete pocitac bez obav zapnut.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220616/f5991ced/attachment.htm>

From ngtech1ltd at gmail.com  Thu Jun 16 13:03:10 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Thu, 16 Jun 2022 16:03:10 +0300
Subject: [squid-users] Logrotate question
In-Reply-To: <CAGU_CiKAf6bcF7gPVL0wGjePHuuE58GukcJB=KqyHpunNBvZsw@mail.gmail.com>
References: <CAGU_CiL2m9WjAxTvh9+JVZWgmRNOxoBKytyd36t51M6Mku_eNA@mail.gmail.com>
 <000601d88150$4ebff780$ec3fe680$@gmail.com>
 <CAGU_Ci+TkSF1wyWc_cLrP47vm+=RiC+3C-Lo4OsTO1=-ECeF5w@mail.gmail.com>
 <001201d88164$ee63cbe0$cb2b63a0$@gmail.com>
 <CAGU_CiLZVtrjs+8o3D3Jhu6t0iYoBWeQeW+L_6neXys0ckAooA@mail.gmail.com>
 <YqsCcAD35D1ka/rY@fantomas.sk>
 <CAGU_CiKqDaPSo6+pJ2XhdBJJcnzsUQOZOnSVyAPPcy-Sp5EOQQ@mail.gmail.com>
 <003401d88170$67e7bbb0$37b73310$@gmail.com>
 <CAGU_Ci+hX4y9RwwSgx-199AFCnPSXEnW_vOXSu_ssfTZg7Fx0w@mail.gmail.com>
 <CAGU_CiKfV6x2TO1B05ARXbbOcX15pszJvFWxVzqCvET5FJkZFA@mail.gmail.com>
 <004201d88174$1272c310$37584930$@gmail.com>
 <CAGU_CiJtUe3nbaS2utWuecWEL4krzOtbxJvjS0LzZbpyiB51-A@mail.gmail.com>
 <004901d8817b$5bb070c0$13115240$@gmail.com>
 <CAGU_CiKAf6bcF7gPVL0wGjePHuuE58GukcJB=KqyHpunNBvZsw@mail.gmail.com>
Message-ID: <005001d88181$6ee957a0$4cbc06e0$@gmail.com>

So just create the file I sent you before or extract the file from the squid RPM using ?rpm2cpio squid?rpm |cpio -dimv? in some tmp dir.
You will just need to copy the file into the proper location, disable the cron you have created and if the squid binary is in a specific different folder change the path of the squid binary in the squid logrotate file accordingly.
 
All The Bests,
Eliezer
 
From: robert k Wild <robertkwild at gmail.com> 
Sent: Thursday, 16 June 2022 15:24
To: Eliezer Croitoru <ngtech1ltd at gmail.com>
Cc: Squid Users <squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] Logrotate question
 
No squid isn't sorry it is compiled from source, I forgot to add it sorry about that
 
On Thu, 16 Jun 2022, 13:19 , <ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> > wrote:
Since this one is from yum install it?s very simple to just change the config files of squid and logrotate.
 
If you need more assistance let me know.
 
Eliezer
 
From: robert k Wild <robertkwild at gmail.com <mailto:robertkwild at gmail.com> > 
Sent: Thursday, 16 June 2022 14:52
To: Eliezer Croitoru <ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> >
Cc: Squid Users <squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> >
Subject: Re: [squid-users] Logrotate question
 
Self compiled from source with others ie
 
Squidclamav
Cicap
Cicap modules
 
And clamav but did this one via yum install
 
 
On Thu, 16 Jun 2022, 12:27 , <ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> > wrote:
How did you installed squid on CentOS 7?
>From my packages or the OS default or self compiled or another source?
 
Eliezer
 
From: robert k Wild <robertkwild at gmail.com <mailto:robertkwild at gmail.com> > 
Sent: Thursday, 16 June 2022 14:05
To: Eliezer Croitoru <ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> >
Cc: Squid Users <squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> >
Subject: Re: [squid-users] Logrotate question
 
Oops sorry you did say that, sorry I didn't see that at first
 
On Thu, 16 Jun 2022, 12:04 robert k Wild, <robertkwild at gmail.com <mailto:robertkwild at gmail.com> > wrote:
I imagine Eliezer that's what I need to put in logrotate.conf file
 
On Thu, 16 Jun 2022, 12:01 , <ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> > wrote:
Oops,
 
The next is the file: /etc/logrotate.d/squid
##START
/var/log/squid/*.log {
    weekly
    rotate 5
    compress
    notifempty
    missingok
    nocreate
    sharedscripts
    postrotate
      # Asks squid to reopen its logs. (logfile_rotate 0 is set in squid.conf)
      # errors redirected to make it silent if squid is not running
      /usr/sbin/squid -k rotate 2>/dev/null
      # Wait a little to allow Squid to catch up before the logs is compressed
      sleep 1
    endscript
}
##END
 
So you need to change the rotate to 92+ and also change the squid number of logs to the same number.
 
Let me know if you it?s helpful.
 
Eliezer
 
From: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com>  <ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> > 
Sent: Thursday, 16 June 2022 14:00
To: 'robert k Wild' <robertkwild at gmail.com <mailto:robertkwild at gmail.com> >; 'Squid Users' <squid-users at lists.squid-cache.org>
Subject: RE: [squid-users] Logrotate question
 
Hey Rob,
 
The next is the file:
 
 
From: squid-users <squid-users-bounces at lists.squid-cache.org <mailto:squid-users-bounces at lists.squid-cache.org> > On Behalf Of robert k Wild
Sent: Thursday, 16 June 2022 13:27
To: Squid Users <squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> >
Subject: Re: [squid-users] Logrotate question
 
Cool, so I will rotate daily and delete after 91 days, thanks guys
 
On Thu, 16 Jun 2022, 11:14 Matus UHLAR - fantomas, <uhlar at fantomas.sk <mailto:uhlar at fantomas.sk> > wrote:
On 16.06.22 10:54, robert k Wild wrote:
>Basically I want to keep logs for 3 months then rotate so it overwrites
>them with another 3 months, if that makes sense

in fact, it does not.

I guess you are supposed to keep 3 months of logs, which mean, you always 
need to have 3 months of logs available.

Each day, you can delete log files over 3 months old.

If you rotated lof once in 3 months, you would have single file with 3 
months of logs in it, and could remove it 3 months after rotating, when 
first logs would be 6 months old.

As we already told you, rotate daily and remove old logs after 92 days.
and use logrotate config.

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk <mailto:uhlar at fantomas.sk>  ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Linux - It's now safe to turn on your computer.
Linux - Teraz mozete pocitac bez obav zapnut.
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> 
http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220616/1c6413c8/attachment.htm>

From robertkwild at gmail.com  Thu Jun 16 13:06:49 2022
From: robertkwild at gmail.com (robert k Wild)
Date: Thu, 16 Jun 2022 14:06:49 +0100
Subject: [squid-users] Logrotate question
In-Reply-To: <005001d88181$6ee957a0$4cbc06e0$@gmail.com>
References: <CAGU_CiL2m9WjAxTvh9+JVZWgmRNOxoBKytyd36t51M6Mku_eNA@mail.gmail.com>
 <000601d88150$4ebff780$ec3fe680$@gmail.com>
 <CAGU_Ci+TkSF1wyWc_cLrP47vm+=RiC+3C-Lo4OsTO1=-ECeF5w@mail.gmail.com>
 <001201d88164$ee63cbe0$cb2b63a0$@gmail.com>
 <CAGU_CiLZVtrjs+8o3D3Jhu6t0iYoBWeQeW+L_6neXys0ckAooA@mail.gmail.com>
 <YqsCcAD35D1ka/rY@fantomas.sk>
 <CAGU_CiKqDaPSo6+pJ2XhdBJJcnzsUQOZOnSVyAPPcy-Sp5EOQQ@mail.gmail.com>
 <003401d88170$67e7bbb0$37b73310$@gmail.com>
 <CAGU_Ci+hX4y9RwwSgx-199AFCnPSXEnW_vOXSu_ssfTZg7Fx0w@mail.gmail.com>
 <CAGU_CiKfV6x2TO1B05ARXbbOcX15pszJvFWxVzqCvET5FJkZFA@mail.gmail.com>
 <004201d88174$1272c310$37584930$@gmail.com>
 <CAGU_CiJtUe3nbaS2utWuecWEL4krzOtbxJvjS0LzZbpyiB51-A@mail.gmail.com>
 <004901d8817b$5bb070c0$13115240$@gmail.com>
 <CAGU_CiKAf6bcF7gPVL0wGjePHuuE58GukcJB=KqyHpunNBvZsw@mail.gmail.com>
 <005001d88181$6ee957a0$4cbc06e0$@gmail.com>
Message-ID: <CAGU_CiJn+2_ECxZACa7R6TQhbaJ_Oprsid45rJ8E+4E0TV6b2w@mail.gmail.com>

Thanks Eliezer, really appreciate it :)

On Thu, 16 Jun 2022, 14:03 , <ngtech1ltd at gmail.com> wrote:

> So just create the file I sent you before or extract the file from the
> squid RPM using ?rpm2cpio squid?rpm |cpio -dimv? in some tmp dir.
>
> You will just need to copy the file into the proper location, disable the
> cron you have created and if the squid binary is in a specific different
> folder change the path of the squid binary in the squid logrotate file
> accordingly.
>
>
>
> All The Bests,
>
> Eliezer
>
>
>
> *From:* robert k Wild <robertkwild at gmail.com>
> *Sent:* Thursday, 16 June 2022 15:24
> *To:* Eliezer Croitoru <ngtech1ltd at gmail.com>
> *Cc:* Squid Users <squid-users at lists.squid-cache.org>
> *Subject:* Re: [squid-users] Logrotate question
>
>
>
> No squid isn't sorry it is compiled from source, I forgot to add it sorry
> about that
>
>
>
> On Thu, 16 Jun 2022, 13:19 , <ngtech1ltd at gmail.com> wrote:
>
> Since this one is from yum install it?s very simple to just change the
> config files of squid and logrotate.
>
>
>
> If you need more assistance let me know.
>
>
>
> Eliezer
>
>
>
> *From:* robert k Wild <robertkwild at gmail.com>
> *Sent:* Thursday, 16 June 2022 14:52
> *To:* Eliezer Croitoru <ngtech1ltd at gmail.com>
> *Cc:* Squid Users <squid-users at lists.squid-cache.org>
> *Subject:* Re: [squid-users] Logrotate question
>
>
>
> Self compiled from source with others ie
>
>
>
> Squidclamav
>
> Cicap
>
> Cicap modules
>
>
>
> And clamav but did this one via yum install
>
>
>
>
>
> On Thu, 16 Jun 2022, 12:27 , <ngtech1ltd at gmail.com> wrote:
>
> How did you installed squid on CentOS 7?
>
> From my packages or the OS default or self compiled or another source?
>
>
>
> Eliezer
>
>
>
> *From:* robert k Wild <robertkwild at gmail.com>
> *Sent:* Thursday, 16 June 2022 14:05
> *To:* Eliezer Croitoru <ngtech1ltd at gmail.com>
> *Cc:* Squid Users <squid-users at lists.squid-cache.org>
> *Subject:* Re: [squid-users] Logrotate question
>
>
>
> Oops sorry you did say that, sorry I didn't see that at first
>
>
>
> On Thu, 16 Jun 2022, 12:04 robert k Wild, <robertkwild at gmail.com> wrote:
>
> I imagine Eliezer that's what I need to put in logrotate.conf file
>
>
>
> On Thu, 16 Jun 2022, 12:01 , <ngtech1ltd at gmail.com> wrote:
>
> Oops,
>
>
>
> The next is the file: /etc/logrotate.d/squid
>
> ##START
>
> /var/log/squid/*.log {
>
>     weekly
>
>     rotate 5
>
>     compress
>
>     notifempty
>
>     missingok
>
>     nocreate
>
>     sharedscripts
>
>     postrotate
>
>       # Asks squid to reopen its logs. (logfile_rotate 0 is set in
> squid.conf)
>
>       # errors redirected to make it silent if squid is not running
>
>       /usr/sbin/squid -k rotate 2>/dev/null
>
>       # Wait a little to allow Squid to catch up before the logs is
> compressed
>
>       sleep 1
>
>     endscript
>
> }
>
> ##END
>
>
>
> So you need to change the rotate to 92+ and also change the squid number
> of logs to the same number.
>
>
>
> Let me know if you it?s helpful.
>
>
>
> Eliezer
>
>
>
> *From:* ngtech1ltd at gmail.com <ngtech1ltd at gmail.com>
> *Sent:* Thursday, 16 June 2022 14:00
> *To:* 'robert k Wild' <robertkwild at gmail.com>; 'Squid Users' <
> squid-users at lists.squid-cache.org>
> *Subject:* RE: [squid-users] Logrotate question
>
>
>
> Hey Rob,
>
>
>
> The next is the file:
>
>
>
>
>
> *From:* squid-users <squid-users-bounces at lists.squid-cache.org> *On
> Behalf Of *robert k Wild
> *Sent:* Thursday, 16 June 2022 13:27
> *To:* Squid Users <squid-users at lists.squid-cache.org>
> *Subject:* Re: [squid-users] Logrotate question
>
>
>
> Cool, so I will rotate daily and delete after 91 days, thanks guys
>
>
>
> On Thu, 16 Jun 2022, 11:14 Matus UHLAR - fantomas, <uhlar at fantomas.sk>
> wrote:
>
> On 16.06.22 10:54, robert k Wild wrote:
> >Basically I want to keep logs for 3 months then rotate so it overwrites
> >them with another 3 months, if that makes sense
>
> in fact, it does not.
>
> I guess you are supposed to keep 3 months of logs, which mean, you always
> need to have 3 months of logs available.
>
> Each day, you can delete log files over 3 months old.
>
> If you rotated lof once in 3 months, you would have single file with 3
> months of logs in it, and could remove it 3 months after rotating, when
> first logs would be 6 months old.
>
> As we already told you, rotate daily and remove old logs after 92 days.
> and use logrotate config.
>
> --
> Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
> Warning: I wish NOT to receive e-mail advertising to this address.
> Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
> Linux - It's now safe to turn on your computer.
> Linux - Teraz mozete pocitac bez obav zapnut.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220616/734e2dfd/attachment.htm>

From ngtech1ltd at gmail.com  Thu Jun 16 21:43:16 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Fri, 17 Jun 2022 00:43:16 +0300
Subject: [squid-users] There is the problems with instagram images and
 videos
In-Reply-To: <20220614170736.543895f8@vs>
References: <20220614170736.543895f8@vs>
Message-ID: <007401d881ca$16fe6fa0$44fb4ee0$@gmail.com>

Hey,

Take a peek at:
https://www1.ngtech.co.il/wpe/2016/05/02/proxy-per-internet-user-is-it-realistic/

You might find ShadowSocks interesting.

Let me know if one of the proxies in the article is good enough for your use case.

Eliezer

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of simwin
Sent: Tuesday, 14 June 2022 17:08
To: squid-users at lists.squid-cache.org
Subject: [squid-users] There is the problems with instagram images and videos

Hi! There is the problems with instagram - I can see only text
without photos and videos. 

This is the errors in browsers console:

16:52:51.024 Subsequent non-fatal errors won't be logged; see
https://fburl.com/debugjs. GyaOhXSa8tR.js:56:563

errorListener
https://static.cdninstagram.com/rsrc.php/v3/yK/r/GyaOhXSa8tR.js?_nc_x=Ij3Wp8lg5Kz:56
reportNormalizedError
https://static.cdninstagram.com/rsrc.php/v3/yK/r/GyaOhXSa8tR.js?_nc_x=Ij3Wp8lg5Kz:56
reportError
https://static.cdninstagram.com/rsrc.php/v3/yK/r/GyaOhXSa8tR.js?_nc_x=Ij3Wp8lg5Kz:56
k
https://static.cdninstagram.com/rsrc.php/v3i7Br4/yh/l/ru_RU/0THwjINDuU0.js?_nc_x=Ij3Wp8lg5Kz:899
a
https://static.cdninstagram.com/rsrc.php/v3i7Br4/yh/l/ru_RU/0THwjINDuU0.js?_nc_x=Ij3Wp8lg5Kz:900
x
https://static.cdninstagram.com/rsrc.php/v3i7Br4/yh/l/ru_RU/0THwjINDuU0.js?_nc_x=Ij3Wp8lg5Kz:896
a
https://static.cdninstagram.com/rsrc.php/v3/yK/r/GyaOhXSa8tR.js?_nc_x=Ij3Wp8lg5Kz:220
m
https://static.cdninstagram.com/rsrc.php/v3/yK/r/GyaOhXSa8tR.js?_nc_x=Ij3Wp8lg5Kz:147
q
https://static.cdninstagram.com/rsrc.php/v3/yK/r/GyaOhXSa8tR.js?_nc_x=Ij3Wp8lg5Kz:147
applyWithGuard
https://static.cdninstagram.com/rsrc.php/v3/yK/r/GyaOhXSa8tR.js?_nc_x=Ij3Wp8lg5Kz:56
c
https://static.cdninstagram.com/rsrc.php/v3/yK/r/GyaOhXSa8tR.js?_nc_x=Ij3Wp8lg5Kz:56
e
https://static.cdninstagram.com/rsrc.php/v3/yK/r/GyaOhXSa8tR.js?_nc_x=Ij3Wp8lg5Kz:143
r
https://static.cdninstagram.com/rsrc.php/v3/yK/r/GyaOhXSa8tR.js?_nc_x=Ij3Wp8lg5Kz:143
onmessage
https://static.cdninstagram.com/rsrc.php/v3/yK/r/GyaOhXSa8tR.js?_nc_x=Ij3Wp8lg5Kz:143

16:52:51.026 A request from an outside source is blocked: The Single source
policy prohibits reading a remote resource on
https://graph.instagram.com/logging_client_events . (Reason: CORS request
failed). Status code: (null).

16:53:17.750 A request from an outside source is blocked: The Single source
policy prohibits reading a remote resource on
https://scontent-hel3-1.cdninstagram.com/v/t51.2885-19/82690581_2710077395747525_6629318554367819776_n.jpg?stp=dst-jpg_s150x150&_nc_ht=scontent-hel3-1.cdninstagram.com&_nc_cat=105&_nc_ohc=ctOErYLKsNAAX9tXH6M&edm=AJ9x6zYBAAAA&ccb=7-5&oh=00_AT85lFWnwrBmMMuEgs_q4E2WyNALHSTtKfbcOwA0pfA1eA&oe=62AD7CD2&_nc_sid=cff2a4
. (Reason: CORS request failed). Status code: (null)

My squid config, Debian 11:

grep -vE '^$|^#' /etc/squid/squid.conf

auth_param basic program /usr/lib/squid/basic_ncsa_auth
/etc/squid/internet_users
auth_param basic children 5
auth_param basic realm Sasic Authentication
auth_param basic credentialsttl 8 hours
auth_param basic casesensitive on
acl auth_users proxy_auth REQUIRED
http_access allow auth_users
acl localnet src 0.0.0.1-0.255.255.255	# RFC 1122 "this" network (LAN)
acl localnet src 10.0.0.0/8		# RFC 1918 local private network
(LAN)
acl localnet src 100.64.0.0/10		# RFC 6598 shared address space
(CGN)
acl localnet src 169.254.0.0/16 	# RFC 3927 link-local (directly
plugged) machines
acl localnet src 172.16.0.0/12		# RFC 1918 local private network
(LAN)
acl localnet src 192.168.0.0/16		# RFC 1918 local private network
(LAN)
acl localnet src fc00::/7       	# RFC 4193 local private network range
acl localnet src fe80::/10      	# RFC 4291 link-local (directly
plugged) machines
acl SSL_ports port 443
acl Safe_ports port 80		# http
acl Safe_ports port 21		# ftp
acl Safe_ports port 443		# https
acl Safe_ports port 70		# gopher
acl Safe_ports port 210		# wais
acl Safe_ports port 1025-65535	# unregistered ports
acl Safe_ports port 280		# http-mgmt
acl Safe_ports port 488		# gss-http
acl Safe_ports port 591		# filemaker
acl Safe_ports port 777		# multiling http
acl CONNECT method CONNECT
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow localhost manager
http_access deny manager
include /etc/squid/conf.d/*
http_access allow localhost
http_access deny all
http_port xxx.xxx.xxx.xxx:xxxx (hidden) 
sslproxy_cert_error allow all
sslcrtd_program /usr/lib/squid/security_file_certgen -s /var/spool/ssl_db -M
20MB
coredump_dir /var/spool/squid
refresh_pattern ^ftp:		1440	20%	10080
refresh_pattern ^gopher:	1440	0%	1440
refresh_pattern -i (/cgi-bin/|\?) 0	0%	0
refresh_pattern .		0	20%	4320
request_header_access Allow allow all
request_header_access Authorization allow all
request_header_access WWW-Authenticate allow all
request_header_access Proxy-Authorization allow all
request_header_access Proxy-Authenticate allow all
request_header_access Cache-Control allow all
request_header_access Content-Encoding allow all
request_header_access Content-Length allow all
request_header_access Content-Type allow all
request_header_access Date allow all
request_header_access Expires allow all
request_header_access Host allow all
request_header_access If-Modified-Since allow all
request_header_access Last-Modified allow all
request_header_access Location allow all
request_header_access Pragma allow all
request_header_access Accept allow all
request_header_access Accept-Charset allow all
request_header_access Accept-Encoding allow all
request_header_access Accept-Language allow all
request_header_access Content-Language allow all
request_header_access Mime-Version allow all
request_header_access Retry-After allow all
request_header_access Title allow all
request_header_access Connection allow all
request_header_access Proxy-Connection allow all
request_header_access User-Agent allow all
request_header_access Cookie allow all
request_header_access All deny all
icap_enable off
icap_service service_req reqmod_precache bypass=1 icap://127.0.0.1:1344/request
icap_service service_resp respmod_precache bypass=0
icap://127.0.0.1:1344/response
icap_class class_req service_req
icap_class class_resp service_resp
icap_access class_req allow all
icap_access class_resp allow all

=========================================

Please check it. 



_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From uhlar at fantomas.sk  Fri Jun 17 08:29:40 2022
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Fri, 17 Jun 2022 10:29:40 +0200
Subject: [squid-users] The usage of extended SNMPD commands to monitor
 squid.
In-Reply-To: <002e01d86f41$6060e5b0$2122b110$@gmail.com>
References: <002e01d86f41$6060e5b0$2122b110$@gmail.com>
Message-ID: <Yqw7dJBSbtaA8itm@fantomas.sk>

On 24.05.22 10:39, Eliezer Croitoru wrote:
>Since the Squid-Cache project doesn't maintain the SNMP part of it as far as
>I know I was thinking about:

Doesn't it?

I mean, some data are already avilable via SNMP.

If there are gauges and counters in squid and they are available via SNMP, 
we can expect them to be correct, am I right?

is it that they are in squid but not available via SNMP?

>Using extended SNMPD ie in /etc/snmp/snmpd.conf
>
>extend squid_x_stats /bin/bash /usr/local/bin/squid_x_stats.sh
>
>while the binary itself probably will be a single command/script that will
>have symlinks to itself with a different name (like what busybox provides
>binaries).
>
>With a set of these commands it would be possible to monitor squid via the
>linux SNMPD and the backend would be a script.
>
>To overcome a DOS from the SNMP side I can build a layer of caching in
>files.
>It would not be like the current squid SNMP tree of-course but as long the
>data is there it can be used in any system that supports it.
>
>I have used nagios/cacti/others to create graphs based on this concept.
>
>I am currently working on the PHP re-testing project and it seems that PHP
>7.4 is not exploding it's memory and crashes compared to older versions.
>
>I still need a more stressed system to test the scripts.
>
>I have created the next scripts for now:
>
>*	Fake helper
>*	Session helper based on Redis
>*	Session helper based on FS in /var/spool/squid/session_helper_fs


-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
10 GOTO 10 : REM (C) Bill Gates 1998, All Rights Reserved!


From ngtech1ltd at gmail.com  Fri Jun 17 10:16:05 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Fri, 17 Jun 2022 13:16:05 +0300
Subject: [squid-users] The usage of extended SNMPD commands to monitor
 squid.
In-Reply-To: <Yqw7dJBSbtaA8itm@fantomas.sk>
References: <002e01d86f41$6060e5b0$2122b110$@gmail.com>
 <Yqw7dJBSbtaA8itm@fantomas.sk>
Message-ID: <007d01d88233$41b259a0$c5170ce0$@gmail.com>

Hey Matus,

The Squid-Cache project to my knowledge doesn't have a developer expert or have enough "free" time to maintain the SNMP parts of the code.
Amos and Alex can correct me if I'm wrong.
There were plans to make the cache manager pages in a yaml format to allow programs to work with instead of parsing the current format.
I do not know were these plans stand and I believe that an extended SNMPD commands might be pretty useful since not everything in the cache manager pages is available via the SNMP.

It will require some development time and a bit of QA but the relevant things are:
* Prometheus (json)
* SNMP
* others (yaml)

It's pretty simple to parse the current cache manager to specific degree and specific developers and to convert it to json/yaml is also pretty simple.
I remember that I have some code somewhere that does some of the heavy lifting in such a project.

I will say something like this:
Let make a DIFF and see what happens, what do you think?

Eliezer

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Matus UHLAR - fantomas
Sent: Friday, 17 June 2022 11:30
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] The usage of extended SNMPD commands to monitor squid.

On 24.05.22 10:39, Eliezer Croitoru wrote:
>Since the Squid-Cache project doesn't maintain the SNMP part of it as far as
>I know I was thinking about:

Doesn't it?

I mean, some data are already avilable via SNMP.

If there are gauges and counters in squid and they are available via SNMP, 
we can expect them to be correct, am I right?

is it that they are in squid but not available via SNMP?

>Using extended SNMPD ie in /etc/snmp/snmpd.conf
>
>extend squid_x_stats /bin/bash /usr/local/bin/squid_x_stats.sh
>
>while the binary itself probably will be a single command/script that will
>have symlinks to itself with a different name (like what busybox provides
>binaries).
>
>With a set of these commands it would be possible to monitor squid via the
>linux SNMPD and the backend would be a script.
>
>To overcome a DOS from the SNMP side I can build a layer of caching in
>files.
>It would not be like the current squid SNMP tree of-course but as long the
>data is there it can be used in any system that supports it.
>
>I have used nagios/cacti/others to create graphs based on this concept.
>
>I am currently working on the PHP re-testing project and it seems that PHP
>7.4 is not exploding it's memory and crashes compared to older versions.
>
>I still need a more stressed system to test the scripts.
>
>I have created the next scripts for now:
>
>*	Fake helper
>*	Session helper based on Redis
>*	Session helper based on FS in /var/spool/squid/session_helper_fs


-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
10 GOTO 10 : REM (C) Bill Gates 1998, All Rights Reserved!
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From robertkwild at gmail.com  Fri Jun 17 18:27:26 2022
From: robertkwild at gmail.com (robert k Wild)
Date: Fri, 17 Jun 2022 19:27:26 +0100
Subject: [squid-users] Logrotate question
In-Reply-To: <CAGU_CiJn+2_ECxZACa7R6TQhbaJ_Oprsid45rJ8E+4E0TV6b2w@mail.gmail.com>
References: <CAGU_CiL2m9WjAxTvh9+JVZWgmRNOxoBKytyd36t51M6Mku_eNA@mail.gmail.com>
 <000601d88150$4ebff780$ec3fe680$@gmail.com>
 <CAGU_Ci+TkSF1wyWc_cLrP47vm+=RiC+3C-Lo4OsTO1=-ECeF5w@mail.gmail.com>
 <001201d88164$ee63cbe0$cb2b63a0$@gmail.com>
 <CAGU_CiLZVtrjs+8o3D3Jhu6t0iYoBWeQeW+L_6neXys0ckAooA@mail.gmail.com>
 <YqsCcAD35D1ka/rY@fantomas.sk>
 <CAGU_CiKqDaPSo6+pJ2XhdBJJcnzsUQOZOnSVyAPPcy-Sp5EOQQ@mail.gmail.com>
 <003401d88170$67e7bbb0$37b73310$@gmail.com>
 <CAGU_Ci+hX4y9RwwSgx-199AFCnPSXEnW_vOXSu_ssfTZg7Fx0w@mail.gmail.com>
 <CAGU_CiKfV6x2TO1B05ARXbbOcX15pszJvFWxVzqCvET5FJkZFA@mail.gmail.com>
 <004201d88174$1272c310$37584930$@gmail.com>
 <CAGU_CiJtUe3nbaS2utWuecWEL4krzOtbxJvjS0LzZbpyiB51-A@mail.gmail.com>
 <004901d8817b$5bb070c0$13115240$@gmail.com>
 <CAGU_CiKAf6bcF7gPVL0wGjePHuuE58GukcJB=KqyHpunNBvZsw@mail.gmail.com>
 <005001d88181$6ee957a0$4cbc06e0$@gmail.com>
 <CAGU_CiJn+2_ECxZACa7R6TQhbaJ_Oprsid45rJ8E+4E0TV6b2w@mail.gmail.com>
Message-ID: <CAGU_CiLHSKkdyS_jkfUBzL1KaVQK=4CJVNR-Qz+XMGGQyrTqtQ@mail.gmail.com>

just a question, im just playing with logrotate

/usr/local/squid/var/logs/*.log {
monthly
rotate 4
compress
delaycompress
missingok
dateext
dateformat -%d%m%Y
su root root
postrotate
/usr/local/squid/sbin/squid -k reconfigure
endscript
}

why is the "squid -k rotate" listed under "postrotate" as logrotate is
handling it

On Thu, 16 Jun 2022 at 14:06, robert k Wild <robertkwild at gmail.com> wrote:

> Thanks Eliezer, really appreciate it :)
>
> On Thu, 16 Jun 2022, 14:03 , <ngtech1ltd at gmail.com> wrote:
>
>> So just create the file I sent you before or extract the file from the
>> squid RPM using ?rpm2cpio squid?rpm |cpio -dimv? in some tmp dir.
>>
>> You will just need to copy the file into the proper location, disable the
>> cron you have created and if the squid binary is in a specific different
>> folder change the path of the squid binary in the squid logrotate file
>> accordingly.
>>
>>
>>
>> All The Bests,
>>
>> Eliezer
>>
>>
>>
>> *From:* robert k Wild <robertkwild at gmail.com>
>> *Sent:* Thursday, 16 June 2022 15:24
>> *To:* Eliezer Croitoru <ngtech1ltd at gmail.com>
>> *Cc:* Squid Users <squid-users at lists.squid-cache.org>
>> *Subject:* Re: [squid-users] Logrotate question
>>
>>
>>
>> No squid isn't sorry it is compiled from source, I forgot to add it sorry
>> about that
>>
>>
>>
>> On Thu, 16 Jun 2022, 13:19 , <ngtech1ltd at gmail.com> wrote:
>>
>> Since this one is from yum install it?s very simple to just change the
>> config files of squid and logrotate.
>>
>>
>>
>> If you need more assistance let me know.
>>
>>
>>
>> Eliezer
>>
>>
>>
>> *From:* robert k Wild <robertkwild at gmail.com>
>> *Sent:* Thursday, 16 June 2022 14:52
>> *To:* Eliezer Croitoru <ngtech1ltd at gmail.com>
>> *Cc:* Squid Users <squid-users at lists.squid-cache.org>
>> *Subject:* Re: [squid-users] Logrotate question
>>
>>
>>
>> Self compiled from source with others ie
>>
>>
>>
>> Squidclamav
>>
>> Cicap
>>
>> Cicap modules
>>
>>
>>
>> And clamav but did this one via yum install
>>
>>
>>
>>
>>
>> On Thu, 16 Jun 2022, 12:27 , <ngtech1ltd at gmail.com> wrote:
>>
>> How did you installed squid on CentOS 7?
>>
>> From my packages or the OS default or self compiled or another source?
>>
>>
>>
>> Eliezer
>>
>>
>>
>> *From:* robert k Wild <robertkwild at gmail.com>
>> *Sent:* Thursday, 16 June 2022 14:05
>> *To:* Eliezer Croitoru <ngtech1ltd at gmail.com>
>> *Cc:* Squid Users <squid-users at lists.squid-cache.org>
>> *Subject:* Re: [squid-users] Logrotate question
>>
>>
>>
>> Oops sorry you did say that, sorry I didn't see that at first
>>
>>
>>
>> On Thu, 16 Jun 2022, 12:04 robert k Wild, <robertkwild at gmail.com> wrote:
>>
>> I imagine Eliezer that's what I need to put in logrotate.conf file
>>
>>
>>
>> On Thu, 16 Jun 2022, 12:01 , <ngtech1ltd at gmail.com> wrote:
>>
>> Oops,
>>
>>
>>
>> The next is the file: /etc/logrotate.d/squid
>>
>> ##START
>>
>> /var/log/squid/*.log {
>>
>>     weekly
>>
>>     rotate 5
>>
>>     compress
>>
>>     notifempty
>>
>>     missingok
>>
>>     nocreate
>>
>>     sharedscripts
>>
>>     postrotate
>>
>>       # Asks squid to reopen its logs. (logfile_rotate 0 is set in
>> squid.conf)
>>
>>       # errors redirected to make it silent if squid is not running
>>
>>       /usr/sbin/squid -k rotate 2>/dev/null
>>
>>       # Wait a little to allow Squid to catch up before the logs is
>> compressed
>>
>>       sleep 1
>>
>>     endscript
>>
>> }
>>
>> ##END
>>
>>
>>
>> So you need to change the rotate to 92+ and also change the squid number
>> of logs to the same number.
>>
>>
>>
>> Let me know if you it?s helpful.
>>
>>
>>
>> Eliezer
>>
>>
>>
>> *From:* ngtech1ltd at gmail.com <ngtech1ltd at gmail.com>
>> *Sent:* Thursday, 16 June 2022 14:00
>> *To:* 'robert k Wild' <robertkwild at gmail.com>; 'Squid Users' <
>> squid-users at lists.squid-cache.org>
>> *Subject:* RE: [squid-users] Logrotate question
>>
>>
>>
>> Hey Rob,
>>
>>
>>
>> The next is the file:
>>
>>
>>
>>
>>
>> *From:* squid-users <squid-users-bounces at lists.squid-cache.org> *On
>> Behalf Of *robert k Wild
>> *Sent:* Thursday, 16 June 2022 13:27
>> *To:* Squid Users <squid-users at lists.squid-cache.org>
>> *Subject:* Re: [squid-users] Logrotate question
>>
>>
>>
>> Cool, so I will rotate daily and delete after 91 days, thanks guys
>>
>>
>>
>> On Thu, 16 Jun 2022, 11:14 Matus UHLAR - fantomas, <uhlar at fantomas.sk>
>> wrote:
>>
>> On 16.06.22 10:54, robert k Wild wrote:
>> >Basically I want to keep logs for 3 months then rotate so it overwrites
>> >them with another 3 months, if that makes sense
>>
>> in fact, it does not.
>>
>> I guess you are supposed to keep 3 months of logs, which mean, you always
>> need to have 3 months of logs available.
>>
>> Each day, you can delete log files over 3 months old.
>>
>> If you rotated lof once in 3 months, you would have single file with 3
>> months of logs in it, and could remove it 3 months after rotating, when
>> first logs would be 6 months old.
>>
>> As we already told you, rotate daily and remove old logs after 92 days.
>> and use logrotate config.
>>
>> --
>> Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
>> Warning: I wish NOT to receive e-mail advertising to this address.
>> Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
>> Linux - It's now safe to turn on your computer.
>> Linux - Teraz mozete pocitac bez obav zapnut.
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
>>
>>

-- 
Regards,

Robert K Wild.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220617/d3bab6d7/attachment.htm>

From robertkwild at gmail.com  Fri Jun 17 19:06:16 2022
From: robertkwild at gmail.com (robert k Wild)
Date: Fri, 17 Jun 2022 20:06:16 +0100
Subject: [squid-users] Logrotate question
In-Reply-To: <CAGU_CiLHSKkdyS_jkfUBzL1KaVQK=4CJVNR-Qz+XMGGQyrTqtQ@mail.gmail.com>
References: <CAGU_CiL2m9WjAxTvh9+JVZWgmRNOxoBKytyd36t51M6Mku_eNA@mail.gmail.com>
 <000601d88150$4ebff780$ec3fe680$@gmail.com>
 <CAGU_Ci+TkSF1wyWc_cLrP47vm+=RiC+3C-Lo4OsTO1=-ECeF5w@mail.gmail.com>
 <001201d88164$ee63cbe0$cb2b63a0$@gmail.com>
 <CAGU_CiLZVtrjs+8o3D3Jhu6t0iYoBWeQeW+L_6neXys0ckAooA@mail.gmail.com>
 <YqsCcAD35D1ka/rY@fantomas.sk>
 <CAGU_CiKqDaPSo6+pJ2XhdBJJcnzsUQOZOnSVyAPPcy-Sp5EOQQ@mail.gmail.com>
 <003401d88170$67e7bbb0$37b73310$@gmail.com>
 <CAGU_Ci+hX4y9RwwSgx-199AFCnPSXEnW_vOXSu_ssfTZg7Fx0w@mail.gmail.com>
 <CAGU_CiKfV6x2TO1B05ARXbbOcX15pszJvFWxVzqCvET5FJkZFA@mail.gmail.com>
 <004201d88174$1272c310$37584930$@gmail.com>
 <CAGU_CiJtUe3nbaS2utWuecWEL4krzOtbxJvjS0LzZbpyiB51-A@mail.gmail.com>
 <004901d8817b$5bb070c0$13115240$@gmail.com>
 <CAGU_CiKAf6bcF7gPVL0wGjePHuuE58GukcJB=KqyHpunNBvZsw@mail.gmail.com>
 <005001d88181$6ee957a0$4cbc06e0$@gmail.com>
 <CAGU_CiJn+2_ECxZACa7R6TQhbaJ_Oprsid45rJ8E+4E0TV6b2w@mail.gmail.com>
 <CAGU_CiLHSKkdyS_jkfUBzL1KaVQK=4CJVNR-Qz+XMGGQyrTqtQ@mail.gmail.com>
Message-ID: <CAGU_Ci+fei_+43BciQq78EcuxekqWrp65U4Aw5w3HbZXRWcYbQ@mail.gmail.com>

 i understand it now

cat /etc/logrotate.d/squid
/usr/local/squid/var/logs/*.log {
monthly
rotate 4
compress
delaycompress
missingok
sharedscripts
dateext
dateformat -%d%m%Y
su root root
postrotate
/usr/local/squid/sbin/squid -k reconfigure
endscript
}

needed the sharedscripts to run the postrotate just once for all logs

didnt need the squid -k rotate as already handled by logrotate

On Fri, 17 Jun 2022 at 19:27, robert k Wild <robertkwild at gmail.com> wrote:

> just a question, im just playing with logrotate
>
> /usr/local/squid/var/logs/*.log {
> monthly
> rotate 4
> compress
> delaycompress
> missingok
> dateext
> dateformat -%d%m%Y
> su root root
> postrotate
> /usr/local/squid/sbin/squid -k reconfigure
> endscript
> }
>
> why is the "squid -k rotate" listed under "postrotate" as logrotate is
> handling it
>
> On Thu, 16 Jun 2022 at 14:06, robert k Wild <robertkwild at gmail.com> wrote:
>
>> Thanks Eliezer, really appreciate it :)
>>
>> On Thu, 16 Jun 2022, 14:03 , <ngtech1ltd at gmail.com> wrote:
>>
>>> So just create the file I sent you before or extract the file from the
>>> squid RPM using ?rpm2cpio squid?rpm |cpio -dimv? in some tmp dir.
>>>
>>> You will just need to copy the file into the proper location, disable
>>> the cron you have created and if the squid binary is in a specific
>>> different folder change the path of the squid binary in the squid
>>> logrotate file accordingly.
>>>
>>>
>>>
>>> All The Bests,
>>>
>>> Eliezer
>>>
>>>
>>>
>>> *From:* robert k Wild <robertkwild at gmail.com>
>>> *Sent:* Thursday, 16 June 2022 15:24
>>> *To:* Eliezer Croitoru <ngtech1ltd at gmail.com>
>>> *Cc:* Squid Users <squid-users at lists.squid-cache.org>
>>> *Subject:* Re: [squid-users] Logrotate question
>>>
>>>
>>>
>>> No squid isn't sorry it is compiled from source, I forgot to add it
>>> sorry about that
>>>
>>>
>>>
>>> On Thu, 16 Jun 2022, 13:19 , <ngtech1ltd at gmail.com> wrote:
>>>
>>> Since this one is from yum install it?s very simple to just change the
>>> config files of squid and logrotate.
>>>
>>>
>>>
>>> If you need more assistance let me know.
>>>
>>>
>>>
>>> Eliezer
>>>
>>>
>>>
>>> *From:* robert k Wild <robertkwild at gmail.com>
>>> *Sent:* Thursday, 16 June 2022 14:52
>>> *To:* Eliezer Croitoru <ngtech1ltd at gmail.com>
>>> *Cc:* Squid Users <squid-users at lists.squid-cache.org>
>>> *Subject:* Re: [squid-users] Logrotate question
>>>
>>>
>>>
>>> Self compiled from source with others ie
>>>
>>>
>>>
>>> Squidclamav
>>>
>>> Cicap
>>>
>>> Cicap modules
>>>
>>>
>>>
>>> And clamav but did this one via yum install
>>>
>>>
>>>
>>>
>>>
>>> On Thu, 16 Jun 2022, 12:27 , <ngtech1ltd at gmail.com> wrote:
>>>
>>> How did you installed squid on CentOS 7?
>>>
>>> From my packages or the OS default or self compiled or another source?
>>>
>>>
>>>
>>> Eliezer
>>>
>>>
>>>
>>> *From:* robert k Wild <robertkwild at gmail.com>
>>> *Sent:* Thursday, 16 June 2022 14:05
>>> *To:* Eliezer Croitoru <ngtech1ltd at gmail.com>
>>> *Cc:* Squid Users <squid-users at lists.squid-cache.org>
>>> *Subject:* Re: [squid-users] Logrotate question
>>>
>>>
>>>
>>> Oops sorry you did say that, sorry I didn't see that at first
>>>
>>>
>>>
>>> On Thu, 16 Jun 2022, 12:04 robert k Wild, <robertkwild at gmail.com> wrote:
>>>
>>> I imagine Eliezer that's what I need to put in logrotate.conf file
>>>
>>>
>>>
>>> On Thu, 16 Jun 2022, 12:01 , <ngtech1ltd at gmail.com> wrote:
>>>
>>> Oops,
>>>
>>>
>>>
>>> The next is the file: /etc/logrotate.d/squid
>>>
>>> ##START
>>>
>>> /var/log/squid/*.log {
>>>
>>>     weekly
>>>
>>>     rotate 5
>>>
>>>     compress
>>>
>>>     notifempty
>>>
>>>     missingok
>>>
>>>     nocreate
>>>
>>>     sharedscripts
>>>
>>>     postrotate
>>>
>>>       # Asks squid to reopen its logs. (logfile_rotate 0 is set in
>>> squid.conf)
>>>
>>>       # errors redirected to make it silent if squid is not running
>>>
>>>       /usr/sbin/squid -k rotate 2>/dev/null
>>>
>>>       # Wait a little to allow Squid to catch up before the logs is
>>> compressed
>>>
>>>       sleep 1
>>>
>>>     endscript
>>>
>>> }
>>>
>>> ##END
>>>
>>>
>>>
>>> So you need to change the rotate to 92+ and also change the squid number
>>> of logs to the same number.
>>>
>>>
>>>
>>> Let me know if you it?s helpful.
>>>
>>>
>>>
>>> Eliezer
>>>
>>>
>>>
>>> *From:* ngtech1ltd at gmail.com <ngtech1ltd at gmail.com>
>>> *Sent:* Thursday, 16 June 2022 14:00
>>> *To:* 'robert k Wild' <robertkwild at gmail.com>; 'Squid Users' <
>>> squid-users at lists.squid-cache.org>
>>> *Subject:* RE: [squid-users] Logrotate question
>>>
>>>
>>>
>>> Hey Rob,
>>>
>>>
>>>
>>> The next is the file:
>>>
>>>
>>>
>>>
>>>
>>> *From:* squid-users <squid-users-bounces at lists.squid-cache.org> *On
>>> Behalf Of *robert k Wild
>>> *Sent:* Thursday, 16 June 2022 13:27
>>> *To:* Squid Users <squid-users at lists.squid-cache.org>
>>> *Subject:* Re: [squid-users] Logrotate question
>>>
>>>
>>>
>>> Cool, so I will rotate daily and delete after 91 days, thanks guys
>>>
>>>
>>>
>>> On Thu, 16 Jun 2022, 11:14 Matus UHLAR - fantomas, <uhlar at fantomas.sk>
>>> wrote:
>>>
>>> On 16.06.22 10:54, robert k Wild wrote:
>>> >Basically I want to keep logs for 3 months then rotate so it overwrites
>>> >them with another 3 months, if that makes sense
>>>
>>> in fact, it does not.
>>>
>>> I guess you are supposed to keep 3 months of logs, which mean, you
>>> always
>>> need to have 3 months of logs available.
>>>
>>> Each day, you can delete log files over 3 months old.
>>>
>>> If you rotated lof once in 3 months, you would have single file with 3
>>> months of logs in it, and could remove it 3 months after rotating, when
>>> first logs would be 6 months old.
>>>
>>> As we already told you, rotate daily and remove old logs after 92 days.
>>> and use logrotate config.
>>>
>>> --
>>> Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
>>> Warning: I wish NOT to receive e-mail advertising to this address.
>>> Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
>>> Linux - It's now safe to turn on your computer.
>>> Linux - Teraz mozete pocitac bez obav zapnut.
>>> _______________________________________________
>>> squid-users mailing list
>>> squid-users at lists.squid-cache.org
>>> http://lists.squid-cache.org/listinfo/squid-users
>>>
>>>
>
> --
> Regards,
>
> Robert K Wild.
>


-- 
Regards,

Robert K Wild.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220617/2c975f2d/attachment.htm>

From squid3 at treenet.co.nz  Fri Jun 17 23:03:37 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 18 Jun 2022 11:03:37 +1200
Subject: [squid-users] The usage of extended SNMPD commands to monitor
 squid.
In-Reply-To: <007d01d88233$41b259a0$c5170ce0$@gmail.com>
References: <002e01d86f41$6060e5b0$2122b110$@gmail.com>
 <Yqw7dJBSbtaA8itm@fantomas.sk> <007d01d88233$41b259a0$c5170ce0$@gmail.com>
Message-ID: <7fc3372f-36a1-2093-5246-a6950747cef9@treenet.co.nz>

On 17/06/22 22:16, ngtech1ltd wrote:
> Hey Matus,
> 
> The Squid-Cache project to my knowledge doesn't have a developer expert or have enough "free" time to maintain the SNMP parts of the code.
> Amos and Alex can correct me if I'm wrong.

That is essentially correct.

Squid SNMP is maintained in that we (the core dev team) are ensuring it 
continues to build and run properly. But feature development and 
additions of SNMP extensions are not being proactively added. We are 
relying on others with expertise in the protocol to contribute that type 
of change.

Amos


From squid3 at treenet.co.nz  Fri Jun 17 23:10:03 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 18 Jun 2022 11:10:03 +1200
Subject: [squid-users] Logrotate question
In-Reply-To: <CAGU_Ci+fei_+43BciQq78EcuxekqWrp65U4Aw5w3HbZXRWcYbQ@mail.gmail.com>
References: <CAGU_CiL2m9WjAxTvh9+JVZWgmRNOxoBKytyd36t51M6Mku_eNA@mail.gmail.com>
 <001201d88164$ee63cbe0$cb2b63a0$@gmail.com>
 <CAGU_CiLZVtrjs+8o3D3Jhu6t0iYoBWeQeW+L_6neXys0ckAooA@mail.gmail.com>
 <YqsCcAD35D1ka/rY@fantomas.sk>
 <CAGU_CiKqDaPSo6+pJ2XhdBJJcnzsUQOZOnSVyAPPcy-Sp5EOQQ@mail.gmail.com>
 <003401d88170$67e7bbb0$37b73310$@gmail.com>
 <CAGU_Ci+hX4y9RwwSgx-199AFCnPSXEnW_vOXSu_ssfTZg7Fx0w@mail.gmail.com>
 <CAGU_CiKfV6x2TO1B05ARXbbOcX15pszJvFWxVzqCvET5FJkZFA@mail.gmail.com>
 <004201d88174$1272c310$37584930$@gmail.com>
 <CAGU_CiJtUe3nbaS2utWuecWEL4krzOtbxJvjS0LzZbpyiB51-A@mail.gmail.com>
 <004901d8817b$5bb070c0$13115240$@gmail.com>
 <CAGU_CiKAf6bcF7gPVL0wGjePHuuE58GukcJB=KqyHpunNBvZsw@mail.gmail.com>
 <005001d88181$6ee957a0$4cbc06e0$@gmail.com>
 <CAGU_CiJn+2_ECxZACa7R6TQhbaJ_Oprsid45rJ8E+4E0TV6b2w@mail.gmail.com>
 <CAGU_CiLHSKkdyS_jkfUBzL1KaVQK=4CJVNR-Qz+XMGGQyrTqtQ@mail.gmail.com>
 <CAGU_Ci+fei_+43BciQq78EcuxekqWrp65U4Aw5w3HbZXRWcYbQ@mail.gmail.com>
Message-ID: <42ce9cba-e3cf-a4aa-39fd-fe5e64d3986b@treenet.co.nz>

On 18/06/22 07:06, robert k Wild wrote:
>  ?i understand it now
> 

Er, no.

> cat /etc/logrotate.d/squid
> /usr/local/squid/var/logs/*.log {
...
> postrotate
> /usr/local/squid/sbin/squid -k reconfigure
> endscript
> }
> 
> needed the sharedscripts to run the postrotate just once for all logs
> 
> didnt need the squid -k rotate as already handled by logrotate
> 

The "-k rotate" tells Squid to open and start writing to the new log 
files created by logrotate tool.

That "-k reconfigure" you have chosen is a far more complicated and slow 
operation. It is not guaranteed to change the files Squid is writing to.


PS. you also need to configure "logfile_rotate 0" for self-built Squid 
to prevent it doing any log file renumbering when logrotated is used.

Amos


From robertkwild at gmail.com  Fri Jun 17 23:25:06 2022
From: robertkwild at gmail.com (robert k Wild)
Date: Sat, 18 Jun 2022 00:25:06 +0100
Subject: [squid-users] Logrotate question
In-Reply-To: <42ce9cba-e3cf-a4aa-39fd-fe5e64d3986b@treenet.co.nz>
References: <CAGU_CiL2m9WjAxTvh9+JVZWgmRNOxoBKytyd36t51M6Mku_eNA@mail.gmail.com>
 <001201d88164$ee63cbe0$cb2b63a0$@gmail.com>
 <CAGU_CiLZVtrjs+8o3D3Jhu6t0iYoBWeQeW+L_6neXys0ckAooA@mail.gmail.com>
 <YqsCcAD35D1ka/rY@fantomas.sk>
 <CAGU_CiKqDaPSo6+pJ2XhdBJJcnzsUQOZOnSVyAPPcy-Sp5EOQQ@mail.gmail.com>
 <003401d88170$67e7bbb0$37b73310$@gmail.com>
 <CAGU_Ci+hX4y9RwwSgx-199AFCnPSXEnW_vOXSu_ssfTZg7Fx0w@mail.gmail.com>
 <CAGU_CiKfV6x2TO1B05ARXbbOcX15pszJvFWxVzqCvET5FJkZFA@mail.gmail.com>
 <004201d88174$1272c310$37584930$@gmail.com>
 <CAGU_CiJtUe3nbaS2utWuecWEL4krzOtbxJvjS0LzZbpyiB51-A@mail.gmail.com>
 <004901d8817b$5bb070c0$13115240$@gmail.com>
 <CAGU_CiKAf6bcF7gPVL0wGjePHuuE58GukcJB=KqyHpunNBvZsw@mail.gmail.com>
 <005001d88181$6ee957a0$4cbc06e0$@gmail.com>
 <CAGU_CiJn+2_ECxZACa7R6TQhbaJ_Oprsid45rJ8E+4E0TV6b2w@mail.gmail.com>
 <CAGU_CiLHSKkdyS_jkfUBzL1KaVQK=4CJVNR-Qz+XMGGQyrTqtQ@mail.gmail.com>
 <CAGU_Ci+fei_+43BciQq78EcuxekqWrp65U4Aw5w3HbZXRWcYbQ@mail.gmail.com>
 <42ce9cba-e3cf-a4aa-39fd-fe5e64d3986b@treenet.co.nz>
Message-ID: <CAGU_CiLphp4zydn7t2qPU1BntDzt_vqu8a7hSCMrSwPCv5JRJw@mail.gmail.com>

So what your saying is change the
-k reconfigure to
-k rotate

Even tho I've configured squid from source

On Sat, 18 Jun 2022, 00:17 Amos Jeffries, <squid3 at treenet.co.nz> wrote:

> On 18/06/22 07:06, robert k Wild wrote:
> >   i understand it now
> >
>
> Er, no.
>
> > cat /etc/logrotate.d/squid
> > /usr/local/squid/var/logs/*.log {
> ...
> > postrotate
> > /usr/local/squid/sbin/squid -k reconfigure
> > endscript
> > }
> >
> > needed the sharedscripts to run the postrotate just once for all logs
> >
> > didnt need the squid -k rotate as already handled by logrotate
> >
>
> The "-k rotate" tells Squid to open and start writing to the new log
> files created by logrotate tool.
>
> That "-k reconfigure" you have chosen is a far more complicated and slow
> operation. It is not guaranteed to change the files Squid is writing to.
>
>
> PS. you also need to configure "logfile_rotate 0" for self-built Squid
> to prevent it doing any log file renumbering when logrotated is used.
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220618/b6b4775a/attachment.htm>

From squid3 at treenet.co.nz  Sat Jun 18 00:19:49 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 18 Jun 2022 12:19:49 +1200
Subject: [squid-users] Logrotate question
In-Reply-To: <CAGU_CiLphp4zydn7t2qPU1BntDzt_vqu8a7hSCMrSwPCv5JRJw@mail.gmail.com>
References: <CAGU_CiL2m9WjAxTvh9+JVZWgmRNOxoBKytyd36t51M6Mku_eNA@mail.gmail.com>
 <YqsCcAD35D1ka/rY@fantomas.sk>
 <CAGU_CiKqDaPSo6+pJ2XhdBJJcnzsUQOZOnSVyAPPcy-Sp5EOQQ@mail.gmail.com>
 <003401d88170$67e7bbb0$37b73310$@gmail.com>
 <CAGU_Ci+hX4y9RwwSgx-199AFCnPSXEnW_vOXSu_ssfTZg7Fx0w@mail.gmail.com>
 <CAGU_CiKfV6x2TO1B05ARXbbOcX15pszJvFWxVzqCvET5FJkZFA@mail.gmail.com>
 <004201d88174$1272c310$37584930$@gmail.com>
 <CAGU_CiJtUe3nbaS2utWuecWEL4krzOtbxJvjS0LzZbpyiB51-A@mail.gmail.com>
 <004901d8817b$5bb070c0$13115240$@gmail.com>
 <CAGU_CiKAf6bcF7gPVL0wGjePHuuE58GukcJB=KqyHpunNBvZsw@mail.gmail.com>
 <005001d88181$6ee957a0$4cbc06e0$@gmail.com>
 <CAGU_CiJn+2_ECxZACa7R6TQhbaJ_Oprsid45rJ8E+4E0TV6b2w@mail.gmail.com>
 <CAGU_CiLHSKkdyS_jkfUBzL1KaVQK=4CJVNR-Qz+XMGGQyrTqtQ@mail.gmail.com>
 <CAGU_Ci+fei_+43BciQq78EcuxekqWrp65U4Aw5w3HbZXRWcYbQ@mail.gmail.com>
 <42ce9cba-e3cf-a4aa-39fd-fe5e64d3986b@treenet.co.nz>
 <CAGU_CiLphp4zydn7t2qPU1BntDzt_vqu8a7hSCMrSwPCv5JRJw@mail.gmail.com>
Message-ID: <aaafefa5-302c-1200-33df-d0f3548d3ffe@treenet.co.nz>

On 18/06/22 11:25, robert k Wild wrote:
> So what your saying is change the
> -k reconfigure to
> -k rotate
> 
> Even tho I've configured squid from source
> 

Yes.

Amos


From ngtech1ltd at gmail.com  Sat Jun 18 18:55:03 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Sat, 18 Jun 2022 21:55:03 +0300
Subject: [squid-users] Squid ACLs by DSCP
Message-ID: <009c01d88344$ec4aa7c0$c4dff740$@gmail.com>

Hey,
 
I have been marking different clients with DSCP and have managed to redirect traffic to different squid ports based on DSCP.
I am trying to use a single squid port that will read the DSCP of the connection as an ACL, is this even possible?
Currently my best shot is to use couple squid ports with different ACLs per squid port.
For example, SSL-BUMP for a specific port while the other will not or to allow unknown protocols etc..
 
Thanks,
Eliezer
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email:  <mailto:ngtech1ltd at gmail.com> ngtech1ltd at gmail.com
 
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220618/7b4d8ad3/attachment.htm>

From pponakanti at roblox.com  Sun Jun 19 16:48:46 2022
From: pponakanti at roblox.com (Praveen Ponakanti)
Date: Sun, 19 Jun 2022 09:48:46 -0700
Subject: [squid-users] Scaling concurrent TCP sessions beyond ephemeral
 port range
In-Reply-To: <5856354a-393a-0803-e3e6-da29f8f7d8b1@treenet.co.nz>
References: <CACabJxP86UGm_dm+PbyckMWoxiis2fc87jwyQq+uXHXAKm=AfA@mail.gmail.com>
 <f7f62043-e384-0395-6d0f-ff4d510b0baf@measurement-factory.com>
 <CACabJxNv5+o7AiY-tfuJ=_V4ZBNEks=dX4ki2YQBHcPPpUrABg@mail.gmail.com>
 <5856354a-393a-0803-e3e6-da29f8f7d8b1@treenet.co.nz>
Message-ID: <CACabJxMt1wkt7cUJH00WpbVK9wA2-8odhS8QrMGPhe8w4SUQpw@mail.gmail.com>

Hi,

Update:
We have been using a small code patch to add the IP_BIND_ADDRESS_NO_PORT
sockopt prior to the bind system call on outbound connections from squid.
This has allowed us to significantly scale concurrent sessions, with the
entire ip_local_port_range available to each unique destination IP:PORT.
Without the code patch, outbound connections to all destinations max out at
the ephemeral port range size.


What is the process to have this code patch upstreamed for future squid
versions?

On Fri, May 20, 2022 at 9:31 PM Amos Jeffries <squid3 at treenet.co.nz> wrote:

> On 20/05/22 19:44, Praveen Ponakanti wrote:
> > Hi Alex,
> >
> > Thanks for going through several steps to help mitigate src port
> > exhaustion. We are looking to achieve 400-500% more
> > concurrent connections if we could :) as there is a significant buffer
> > on the available CPU.
>
> Then you require at least 4, maybe 5, IP addresses to handle that many
> concurrent connections with Squid.
>
>
We would like to investigate going beyond the ephemeral port range for some
specific destination IP:PORT addresses. For that it appears squid does not
round-robin requests if we use multiple tcp_outgoing_addresses. We could
use ACL?s to pick a different outbound IP based on the clients source IP,
however that is not very ideal in our environment as our clients aren?t
always equally split by subnet. However, if we could split by the client?s
source port that might help achieve this. For example something like:


  acl pool1 clientport 0-32768

  acl pool2 clientport 32769-65536


  tcp_outgoing_address 10.1.0.1 pool1

  tcp_outgoing_address 10.1.0.2 pool2


Squid's ACLs currently do not allow filtering by the client's source port.
We could look into a separate patch to add this functionality to squid?s
ACL code if that makes sense. Or is there a better way to achieve this?


Thanks

Praveen


>
> > The option to use multiple tcp_outoing_addresses appears to be promising
> > along with some tweaks to the TCP timeouts. I guess we could use ACLs to
> > pick a different outbound IP based on the requesting client's prefix. We
> > had not considered that option as the ephemeral ports were no longer
> > available to other applications when squid uses most of them with a
> > single outbound IP configured. We are also looking to modify the code to
> > use the IP_BIND_ADDRESS_NO_PORT sockopt as that could help delay port
> > assignment with the bind() call on the outbound TCP sessions (to
> > hopefully allow access to the 4-tuple on the socket).
>
> Patches welcome.
>
> However, please be aware that use of the 4-tuple is often no different
> from the 3-tuple since the dst-port is typically identical for all
> outgoing traffic to a given dst-IP.
>
>
> Cheers
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220619/820106bf/attachment.htm>

From honeybajaj1 at gmail.com  Mon Jun 20 08:49:38 2022
From: honeybajaj1 at gmail.com (Honey Bajaj)
Date: Mon, 20 Jun 2022 09:49:38 +0100
Subject: [squid-users] Squid Upstream Configuration Query
Message-ID: <CAKmfg0-EYX9bXV7RXDmHy4dnN4yVQbwByyoeMZAn=Vv2T-qk+Q@mail.gmail.com>

Hi Team,

We are using Squid proxy quite successfully with following pattern:

Application (no ssl configuration) --> Squid (no sslbump) --> ExternalURL

Now, as a part of Enterprise security and consolidation, we are asked to
onboard a commercial SaaS based proxy solution. This solution requires a
SSL certificate to be embedded in every application which a commercial
vendor has shared with us. To simplify this process, we are evaluating if
Squid can play following role:

Application (no ssl configuration) --> Squid (Upstream configuration
hosting SaaS client certificate) --> SaaS Proxy --> ExternalURL

kindly suggest if this can be achieved.

Regards,
HB
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220620/3b25fe6a/attachment.htm>

From rousskov at measurement-factory.com  Mon Jun 20 15:24:26 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Mon, 20 Jun 2022 11:24:26 -0400
Subject: [squid-users] Squid Upstream Configuration Query
In-Reply-To: <CAKmfg0-EYX9bXV7RXDmHy4dnN4yVQbwByyoeMZAn=Vv2T-qk+Q@mail.gmail.com>
References: <CAKmfg0-EYX9bXV7RXDmHy4dnN4yVQbwByyoeMZAn=Vv2T-qk+Q@mail.gmail.com>
Message-ID: <c3694f9d-0dfb-7843-cdd8-46d073baf83c@measurement-factory.com>

On 6/20/22 04:49, Honey Bajaj wrote:

> as a part of Enterprise security and consolidation, we are asked to 
> onboard a commercial SaaS based?proxy solution. This solution requires a 
> SSL certificate to be embedded in every application which a commercial 
> vendor has shared with us. To simplify this process, we are evaluating 
> if Squid can play following role:
> 
> Application (no ssl configuration) --> Squid (Upstream configuration 
> hosting SaaS client certificate) --> SaaS Proxy --> ExternalURL
> 
> kindly suggest if this can be achieved.

Yes, if SaaS Proxy is an HTTPS proxy, then Squid can be configured to 
authenticate itself using a configured client certificate while talking 
TLS to that SaaS proxy. Here is a (somewhat redundant by explicit) 
configuration sketch to get you started:

     cache_peer ... parent tls sslcert=squid.pem ...
     nonhierarchical_direct off
     never_direct allow all
     always_direct deny all

The "tls" option is spelled "ssl" in earlier Squids IIRC.

See squid.conf.documented for details.


HTH,

Alex.


From david at articatech.com  Tue Jun 21 11:43:20 2022
From: david at articatech.com (David Touzeau)
Date: Tue, 21 Jun 2022 13:43:20 +0200
Subject: [squid-users] WCCPV2 with fortigate ERROR: Ignoring WCCPv2 message:
 truncated record
Message-ID: <54207710-866f-97a1-b1c7-0b9cb343dcca@articatech.com>

Hi

We trying to using WCCP with Fortigate without success Squid version? 
5.5 always claim "Ignoring WCCPv2 message: truncated record"

What can be the cause ?

We have added a service ID 80 on fortigate

config system wccp
 ??? edit "80"
 ??????? set router-id 10.10.50.1
 ??????? set group-address 0.0.0.0
 ??????? set server-list 10.10.50.2 255.255.255.255
 ??????? set server-type forward
 ??????? set authentication disable
 ??????? set forward-method GRE
 ??????? set return-method GRE
 ??????? set assignment-method HASH
 ??? next
end

Squid wccp configuration

wccp2_router 10.10.50.1
wccp_version 3
# tested v4 do the same behavior
wccp2_rebuild_wait on
wccp2_forwarding_method gre
wccp2_return_method gre
wccp2_assignment_method hash
wccp2_service dynamic 80
wccp2_service_info 80 protocol=tcp protocol=tcp flags=src_ip_hash 
priority=240 ports=80,443
wccp2_address 0.0.0.0
wccp2_weight 10000

Squid claim in debug log

022/06/21 13:15:38.780 kid4| 80,6| wccp2.cc(1206) wccp2HandleUdp: 
wccp2HandleUdp: Called.
2022/06/21 13:15:38.781 kid4| 5,5| ModEpoll.cc(118) SetSelect: FD 38, 
type=1, handler=1, client_data=0, timeout=0
2022/06/21 13:15:38.781 kid4| 80,3| wccp2.cc(1230) wccp2HandleUdp: 
Incoming WCCPv2 I_SEE_YOU length 112.
2022/06/21 13:15:38.781 kid4| ERROR: Ignoring WCCPv2 message: truncated 
record
 ??? exception location: wccp2.cc(1133) CheckSectionLength



-- 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220621/b9e46a4d/attachment.htm>

From rousskov at measurement-factory.com  Tue Jun 21 21:11:01 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Tue, 21 Jun 2022 17:11:01 -0400
Subject: [squid-users] Scaling concurrent TCP sessions beyond ephemeral
 port range
In-Reply-To: <CACabJxMt1wkt7cUJH00WpbVK9wA2-8odhS8QrMGPhe8w4SUQpw@mail.gmail.com>
References: <CACabJxP86UGm_dm+PbyckMWoxiis2fc87jwyQq+uXHXAKm=AfA@mail.gmail.com>
 <f7f62043-e384-0395-6d0f-ff4d510b0baf@measurement-factory.com>
 <CACabJxNv5+o7AiY-tfuJ=_V4ZBNEks=dX4ki2YQBHcPPpUrABg@mail.gmail.com>
 <5856354a-393a-0803-e3e6-da29f8f7d8b1@treenet.co.nz>
 <CACabJxMt1wkt7cUJH00WpbVK9wA2-8odhS8QrMGPhe8w4SUQpw@mail.gmail.com>
Message-ID: <97b1c32d-2172-d2fa-bfde-dd8c850c799a@measurement-factory.com>

On 6/19/22 12:48, Praveen Ponakanti wrote:

> What is the process to have this code patch upstreamed for future squid 
> versions?

In short, just post a quality pull request on GitHub (or find somebody 
who can guide your code towards official acceptance for you). For 
details, please see https://wiki.squid-cache.org/MergeProcedure


Thank you,

Alex.


> On Fri, May 20, 2022 at 9:31 PM Amos Jeffries <squid3 at treenet.co.nz 
> wrote:
> 
>     On 20/05/22 19:44, Praveen Ponakanti wrote:
>      > Hi Alex,
>      >
>      > Thanks for going through several steps to help mitigate src port
>      > exhaustion. We are looking to achieve 400-500% more
>      > concurrent?connections if we could :) as there is a
>     significant?buffer
>      > on the available CPU.
> 
>     Then you require at least 4, maybe 5, IP addresses to handle that many
>     concurrent connections with Squid.
> 
> 
> We would like to investigate going beyond the ephemeral port range for 
> some specific destination IP:PORT addresses. For that it appears squid 
> does not round-robin requests if we use multiple tcp_outgoing_addresses. 
> We could use ACL?s to pick a different outbound IP based on the clients 
> source IP, however that is not very ideal in our environment as our 
> clients aren?t always equally split by subnet. However, if we could 
> split by the client?s source port that might help achieve this. For 
> example something like:
> 
> 
> acl pool1 clientport 0-32768
> 
> acl pool2 clientport 32769-65536
> 
> 
> tcp_outgoing_address 10.1.0.1 pool1
> 
> tcp_outgoing_address 10.1.0.2 pool2
> 
> 
> Squid's ACLs currently do not allow filtering by the client's source 
> port. We could look into a separate patch to add this functionality to 
> squid?s ACL code if that makes sense. Or is there a better way to 
> achieve this?
> 
> 
> Thanks
> 
> Praveen
> 
> 
>      > The option to use multiple tcp_outoing_addresses appears to be
>     promising
>      > along with some tweaks to the TCP timeouts. I guess we could use
>     ACLs to
>      > pick a different outbound IP based on the requesting client's
>     prefix. We
>      > had not considered that option as the ephemeral ports were no longer
>      > available?to other applications when squid uses most of them with a
>      > single outbound IP configured. We are also looking to modify the
>     code to
>      > use the IP_BIND_ADDRESS_NO_PORT sockopt as that could help delay
>     port
>      > assignment with the bind() call on the outbound TCP sessions (to
>      > hopefully allow access to the 4-tuple on the socket).
> 
>     Patches welcome.
> 
>     However, please be aware that use of the 4-tuple is often no different
>     from the 3-tuple since the dst-port is typically identical for all
>     outgoing traffic to a given dst-IP.
> 
> 
>     Cheers
>     Amos
>     _______________________________________________
>     squid-users mailing list
>     squid-users at lists.squid-cache.org
>     <mailto:squid-users at lists.squid-cache.org>
>     http://lists.squid-cache.org/listinfo/squid-users
>     <http://lists.squid-cache.org/listinfo/squid-users>
> 
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



From squid3 at treenet.co.nz  Wed Jun 22 10:07:31 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 22 Jun 2022 22:07:31 +1200
Subject: [squid-users] Squid ACLs by DSCP
In-Reply-To: <009c01d88344$ec4aa7c0$c4dff740$@gmail.com>
References: <009c01d88344$ec4aa7c0$c4dff740$@gmail.com>
Message-ID: <8f8dbc97-fd09-f032-bfe3-2b26e7687c0e@treenet.co.nz>

On 19/06/22 06:55, ngtech1ltd wrote:
> Hey,
> 
> I have been marking different clients with DSCP and have managed to 
> redirect traffic to different squid ports based on DSCP.
> 
> I am trying to use a single squid port that will read the DSCP of the 
> connection as an ACL, is this even possible?
> 

The so-called DSCP "field" is a re-mapping of the TOS value.

See this table for the TOS hex values for each DSCP service type: 
<https://linuxreviews.org/Type_of_Service_(ToS)_and_DSCP_Values#The_DSCP_and_The_ToS_Byte_Values>


Squid has a fair amount of support for TOS. So the question is more 
whether Squid TOS directives can do what you want.


I do not understand quite what ACLs have to do with what you are 
wanting. Can you clarify what you are trying to have happen in terms of 
traffic flow?


HTH
Amos


From ngtech1ltd at gmail.com  Wed Jun 22 15:37:33 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Wed, 22 Jun 2022 18:37:33 +0300
Subject: [squid-users] Squid ACLs by DSCP
In-Reply-To: <8f8dbc97-fd09-f032-bfe3-2b26e7687c0e@treenet.co.nz>
References: <009c01d88344$ec4aa7c0$c4dff740$@gmail.com>
 <8f8dbc97-fd09-f032-bfe3-2b26e7687c0e@treenet.co.nz>
Message-ID: <004c01d8864d$fe8962d0$fb9c2870$@gmail.com>

Hey Amos,

I have a set of clients which I want to bump while others I don't want to bump.
I have 10 classes of clients which each and every one of them have a different pre-defined class.
If I can read the TOS hex value of the incoming intercepted connection I can decide in the ACLs 
based on the TOS specific decisions.
Since I am using an external_helper it's pretty easy to change the rules pretty easy without reloading squid.
Currently what I tried is to use couple squid ports and then intercept the traffic based on the DSCP(TOS..) value
to the designated port.

It's a pretty nice combination for my specific use case that I have about 10 pre defined client classes.

Thanks,
Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Amos Jeffries
Sent: Wednesday, 22 June 2022 13:08
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Squid ACLs by DSCP

On 19/06/22 06:55, ngtech1ltd wrote:
> Hey,
> 
> I have been marking different clients with DSCP and have managed to 
> redirect traffic to different squid ports based on DSCP.
> 
> I am trying to use a single squid port that will read the DSCP of the 
> connection as an ACL, is this even possible?
> 

The so-called DSCP "field" is a re-mapping of the TOS value.

See this table for the TOS hex values for each DSCP service type: 
<https://linuxreviews.org/Type_of_Service_(ToS)_and_DSCP_Values#The_DSCP_and_The_ToS_Byte_Values>


Squid has a fair amount of support for TOS. So the question is more 
whether Squid TOS directives can do what you want.


I do not understand quite what ACLs have to do with what you are 
wanting. Can you clarify what you are trying to have happen in terms of 
traffic flow?


HTH
Amos
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From rousskov at measurement-factory.com  Thu Jun 23 12:44:57 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Thu, 23 Jun 2022 08:44:57 -0400
Subject: [squid-users] WCCPV2 with fortigate ERROR: Ignoring WCCPv2
 message: truncated record
In-Reply-To: <54207710-866f-97a1-b1c7-0b9cb343dcca@articatech.com>
References: <54207710-866f-97a1-b1c7-0b9cb343dcca@articatech.com>
Message-ID: <c668553e-5d30-9853-0108-519348612566@measurement-factory.com>

On 6/21/22 07:43, David Touzeau wrote:

> We trying to using WCCP with Fortigate without success Squid version  
> 5.5 always claim "Ignoring WCCPv2 message: truncated record"
> 
> What can be the cause ?

The most likely cause are bugs in untested WCCP fixes (v5 commit 
7a73a54). Dormant draft PR 970 contains unfinished fixes for the 
problems in that previous attempt:
https://github.com/squid-cache/squid/pull/970

IMHO, folks that need WCCP support should invest into that 
semi-abandoned Squid feature or risk losing it. WCCP code needs serious 
refactoring and proper testing. There are currently no Project 
volunteers that have enough resources and capabilities to do either.

https://wiki.squid-cache.org/SquidFaq/AboutSquid#How_to_add_a_new_Squid_feature.2C_enhance.2C_of_fix_something.3F


HTH,

Alex.


> We have added a service ID 80 on fortigate
> 
> config system wccp
>  ??? edit "80"
>  ??????? set router-id 10.10.50.1
>  ??????? set group-address 0.0.0.0
>  ??????? set server-list 10.10.50.2 255.255.255.255
>  ??????? set server-type forward
>  ??????? set authentication disable
>  ??????? set forward-method GRE
>  ??????? set return-method GRE
>  ??????? set assignment-method HASH
>  ??? next
> end
> 
> Squid wccp configuration
> 
> wccp2_router 10.10.50.1
> wccp_version 3
> # tested v4 do the same behavior
> wccp2_rebuild_wait on
> wccp2_forwarding_method gre
> wccp2_return_method gre
> wccp2_assignment_method hash
> wccp2_service dynamic 80
> wccp2_service_info 80 protocol=tcp protocol=tcp flags=src_ip_hash 
> priority=240 ports=80,443
> wccp2_address 0.0.0.0
> wccp2_weight 10000
> 
> Squid claim in debug log
> 
> 022/06/21 13:15:38.780 kid4| 80,6| wccp2.cc(1206) wccp2HandleUdp: 
> wccp2HandleUdp: Called.
> 2022/06/21 13:15:38.781 kid4| 5,5| ModEpoll.cc(118) SetSelect: FD 38, 
> type=1, handler=1, client_data=0, timeout=0
> 2022/06/21 13:15:38.781 kid4| 80,3| wccp2.cc(1230) wccp2HandleUdp: 
> Incoming WCCPv2 I_SEE_YOU length 112.
> 2022/06/21 13:15:38.781 kid4| ERROR: Ignoring WCCPv2 message: truncated 
> record
>  ??? exception location: wccp2.cc(1133) CheckSectionLength
> 
> 
> 
> -- 
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



From ngtech1ltd at gmail.com  Thu Jun 23 14:39:07 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Thu, 23 Jun 2022 17:39:07 +0300
Subject: [squid-users] APPs defintions
Message-ID: <001b01d8870e$ff22c3f0$fd684bd0$@gmail.com>

I have started working on APPs definitions by destination AS, Domains and Destination IP addresses.
I am currently working on Netflix related domains.
 
If anyone knows about a specific source that contains such lists please let me know.
 
Thanks,
Eliezer
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email:  <mailto:ngtech1ltd at gmail.com> ngtech1ltd at gmail.com
Web:  <https://ngtech.co.il/> https://ngtech.co.il/
My-Tube:  <https://tube.ngtech.co.il/> https://tube.ngtech.co.il/
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220623/877dbd50/attachment.htm>

From david at articatech.com  Thu Jun 23 16:11:37 2022
From: david at articatech.com (David Touzeau)
Date: Thu, 23 Jun 2022 18:11:37 +0200
Subject: [squid-users] WCCPV2 with fortigate ERROR: Ignoring WCCPv2
 message: truncated record
In-Reply-To: <c668553e-5d30-9853-0108-519348612566@measurement-factory.com>
References: <54207710-866f-97a1-b1c7-0b9cb343dcca@articatech.com>
 <c668553e-5d30-9853-0108-519348612566@measurement-factory.com>
Message-ID: <7332cf67-5bc0-6b2a-3648-93ff7afab5a3@articatech.com>

Hi Alex,

is the v5 commit 7a73a54 already included in the latest 5.5,5.6 versions?

This is very unfortunate because WCCP is used by default by Fortinet 
firewall devices. It should be very popular.
Indeed, Fortinet is flooding the market.
I can volunteer for the funding and the necessary testing to be done.

Le 23/06/2022 ? 14:44, Alex Rousskov a ?crit?:
> On 6/21/22 07:43, David Touzeau wrote:
>
>> We trying to using WCCP with Fortigate without success Squid version? 
>> 5.5 always claim "Ignoring WCCPv2 message: truncated record"
>>
>> What can be the cause ?
>
> The most likely cause are bugs in untested WCCP fixes (v5 commit 
> 7a73a54). Dormant draft PR 970 contains unfinished fixes for the 
> problems in that previous attempt:
> https://github.com/squid-cache/squid/pull/970
>
> IMHO, folks that need WCCP support should invest into that 
> semi-abandoned Squid feature or risk losing it. WCCP code needs 
> serious refactoring and proper testing. There are currently no Project 
> volunteers that have enough resources and capabilities to do either.
>
> https://wiki.squid-cache.org/SquidFaq/AboutSquid#How_to_add_a_new_Squid_feature.2C_enhance.2C_of_fix_something.3F 
>
>
>
> HTH,
>
> Alex.
>
>
>> We have added a service ID 80 on fortigate
>>
>> config system wccp
>> ???? edit "80"
>> ???????? set router-id 10.10.50.1
>> ???????? set group-address 0.0.0.0
>> ???????? set server-list 10.10.50.2 255.255.255.255
>> ???????? set server-type forward
>> ???????? set authentication disable
>> ???????? set forward-method GRE
>> ???????? set return-method GRE
>> ???????? set assignment-method HASH
>> ???? next
>> end
>>
>> Squid wccp configuration
>>
>> wccp2_router 10.10.50.1
>> wccp_version 3
>> # tested v4 do the same behavior
>> wccp2_rebuild_wait on
>> wccp2_forwarding_method gre
>> wccp2_return_method gre
>> wccp2_assignment_method hash
>> wccp2_service dynamic 80
>> wccp2_service_info 80 protocol=tcp protocol=tcp flags=src_ip_hash 
>> priority=240 ports=80,443
>> wccp2_address 0.0.0.0
>> wccp2_weight 10000
>>
>> Squid claim in debug log
>>
>> 022/06/21 13:15:38.780 kid4| 80,6| wccp2.cc(1206) wccp2HandleUdp: 
>> wccp2HandleUdp: Called.
>> 2022/06/21 13:15:38.781 kid4| 5,5| ModEpoll.cc(118) SetSelect: FD 38, 
>> type=1, handler=1, client_data=0, timeout=0
>> 2022/06/21 13:15:38.781 kid4| 80,3| wccp2.cc(1230) wccp2HandleUdp: 
>> Incoming WCCPv2 I_SEE_YOU length 112.
>> 2022/06/21 13:15:38.781 kid4| ERROR: Ignoring WCCPv2 message: 
>> truncated record
>> ???? exception location: wccp2.cc(1133) CheckSectionLength
>>
>>
>>
>> -- 
>>
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
-- 
Technical Support
	
	
*David Touzeau*
Orgerus, Yvelines, France
*Artica Tech*

P:?+33 6 58 44 69 46
www: wiki.articatech.com <https://wiki.articatech.com>
www: articatech.net <http://articatech.net>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220623/d3f3be6e/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: adLFmtGuksAZror0.jpg
Type: image/jpeg
Size: 6266 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220623/d3f3be6e/attachment.jpg>

From ngtech1ltd at gmail.com  Thu Jun 23 16:33:01 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Thu, 23 Jun 2022 19:33:01 +0300
Subject: [squid-users] WCCPV2 with fortigate ERROR: Ignoring WCCPv2
 message: truncated record
In-Reply-To: <7332cf67-5bc0-6b2a-3648-93ff7afab5a3@articatech.com>
References: <54207710-866f-97a1-b1c7-0b9cb343dcca@articatech.com>
 <c668553e-5d30-9853-0108-519348612566@measurement-factory.com>
 <7332cf67-5bc0-6b2a-3648-93ff7afab5a3@articatech.com>
Message-ID: <000701d8871e$e8589e00$b909da00$@gmail.com>

Hey David,
 
Just trying to understand something:
Aren?t Fortinet something that should replace squid?
I assumed that it should do a much better job then Squid in many aeras.
What a Fortinet(I have one?) is not covering?
 
Thanks,
Eliezer
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> 
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/
 
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of David Touzeau
Sent: Thursday, 23 June 2022 19:12
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] WCCPV2 with fortigate ERROR: Ignoring WCCPv2 message: truncated record
 
Hi Alex,
is the v5 commit 7a73a54 already included in the latest 5.5,5.6 versions?

This is very unfortunate because WCCP is used by default by Fortinet firewall devices. It should be very popular.
Indeed, Fortinet is flooding the market.
I can volunteer for the funding and the necessary testing to be done.
Le 23/06/2022 ? 14:44, Alex Rousskov a ?crit :
On 6/21/22 07:43, David Touzeau wrote: 



We trying to using WCCP with Fortigate without success Squid version  5.5 always claim "Ignoring WCCPv2 message: truncated record" 

What can be the cause ? 

The most likely cause are bugs in untested WCCP fixes (v5 commit 7a73a54). Dormant draft PR 970 contains unfinished fixes for the problems in that previous attempt: 
https://github.com/squid-cache/squid/pull/970 

IMHO, folks that need WCCP support should invest into that semi-abandoned Squid feature or risk losing it. WCCP code needs serious refactoring and proper testing. There are currently no Project volunteers that have enough resources and capabilities to do either. 

https://wiki.squid-cache.org/SquidFaq/AboutSquid#How_to_add_a_new_Squid_feature.2C_enhance.2C_of_fix_something.3F 


HTH, 

Alex. 




We have added a service ID 80 on fortigate 

config system wccp 
     edit "80" 
         set router-id 10.10.50.1 
         set group-address 0.0.0.0 
         set server-list 10.10.50.2 255.255.255.255 
         set server-type forward 
         set authentication disable 
         set forward-method GRE 
         set return-method GRE 
         set assignment-method HASH 
     next 
end 

Squid wccp configuration 

wccp2_router 10.10.50.1 
wccp_version 3 
# tested v4 do the same behavior 
wccp2_rebuild_wait on 
wccp2_forwarding_method gre 
wccp2_return_method gre 
wccp2_assignment_method hash 
wccp2_service dynamic 80 
wccp2_service_info 80 protocol=tcp protocol=tcp flags=src_ip_hash priority=240 ports=80,443 
wccp2_address 0.0.0.0 
wccp2_weight 10000 

Squid claim in debug log 

022/06/21 13:15:38.780 kid4| 80,6| wccp2.cc(1206) wccp2HandleUdp: wccp2HandleUdp: Called. 
2022/06/21 13:15:38.781 kid4| 5,5| ModEpoll.cc(118) SetSelect: FD 38, type=1, handler=1, client_data=0, timeout=0 
2022/06/21 13:15:38.781 kid4| 80,3| wccp2.cc(1230) wccp2HandleUdp: Incoming WCCPv2 I_SEE_YOU length 112. 
2022/06/21 13:15:38.781 kid4| ERROR: Ignoring WCCPv2 message: truncated record 
     exception location: wccp2.cc(1133) CheckSectionLength 



-- 

_______________________________________________ 
squid-users mailing list 
squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org>  
http://lists.squid-cache.org/listinfo/squid-users 

_______________________________________________ 
squid-users mailing list 
squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org>  
http://lists.squid-cache.org/listinfo/squid-users 
-- 


Technical Support
	David Touzeau
Orgerus, Yvelines, France
Artica Tech 

P: +33 6 58 44 69 46 
www: wiki.articatech.com <https://wiki.articatech.com>  
www: articatech.net <http://articatech.net>  
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220623/21d69058/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.jpg
Type: image/jpeg
Size: 6266 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220623/21d69058/attachment.jpg>

From david at articatech.com  Fri Jun 24 11:04:02 2022
From: david at articatech.com (David Touzeau)
Date: Fri, 24 Jun 2022 13:04:02 +0200
Subject: [squid-users] WCCPV2 with fortigate ERROR: Ignoring WCCPv2
 message: truncated record
In-Reply-To: <000701d8871e$e8589e00$b909da00$@gmail.com>
References: <54207710-866f-97a1-b1c7-0b9cb343dcca@articatech.com>
 <c668553e-5d30-9853-0108-519348612566@measurement-factory.com>
 <7332cf67-5bc0-6b2a-3648-93ff7afab5a3@articatech.com>
 <000701d8871e$e8589e00$b909da00$@gmail.com>
Message-ID: <ea0d322b-336d-8f37-f7c9-f8860a80e121@articatech.com>

Hi Elizer

No, Fortinet is good.

In this case is connecting HTTP/HTTPs with WCCP from Fortinet to squid 
did not work, because SQUID refuse to communicate with Fortinet 
according to "Ignoring WCCPv2 message: truncated record" issue.

With Squid,? Fortinet report that is no WCCP server available.


Le 23/06/2022 ? 18:33, ngtech1ltd at gmail.com a ?crit?:
>
> Hey David,
>
> Just trying to understand something:
>
> Aren?t Fortinet something that should replace squid?
>
> I assumed that it should do a much better job then Squid in many aeras.
>
> What a Fortinet(I have one?) is not covering?
>
> Thanks,
>
> Eliezer
>
> ----
>
> Eliezer Croitoru
>
> NgTech, Tech Support
>
> Mobile: +972-5-28704261
>
> Email: ngtech1ltd at gmail.com
>
> Web: https://ngtech.co.il/
>
> My-Tube: https://tube.ngtech.co.il/
>
> *From:*squid-users <squid-users-bounces at lists.squid-cache.org> *On 
> Behalf Of *David Touzeau
> *Sent:* Thursday, 23 June 2022 19:12
> *To:* squid-users at lists.squid-cache.org
> *Subject:* Re: [squid-users] WCCPV2 with fortigate ERROR: Ignoring 
> WCCPv2 message: truncated record
>
> Hi Alex,
>
> is the v5 commit 7a73a54 already included in the latest 5.5,5.6 versions?
>
> This is very unfortunate because WCCP is used by default by Fortinet 
> firewall devices. It should be very popular.
> Indeed, Fortinet is flooding the market.
> I can volunteer for the funding and the necessary testing to be done.
>
> Le 23/06/2022 ? 14:44, Alex Rousskov a ?crit?:
>
>     On 6/21/22 07:43, David Touzeau wrote:
>
>
>         We trying to using WCCP with Fortigate without success Squid
>         version? 5.5 always claim "Ignoring WCCPv2 message: truncated
>         record"
>
>         What can be the cause ?
>
>
>     The most likely cause are bugs in untested WCCP fixes (v5 commit
>     7a73a54). Dormant draft PR 970 contains unfinished fixes for the
>     problems in that previous attempt:
>     https://github.com/squid-cache/squid/pull/970
>
>     IMHO, folks that need WCCP support should invest into that
>     semi-abandoned Squid feature or risk losing it. WCCP code needs
>     serious refactoring and proper testing. There are currently no
>     Project volunteers that have enough resources and capabilities to
>     do either.
>
>     https://wiki.squid-cache.org/SquidFaq/AboutSquid#How_to_add_a_new_Squid_feature.2C_enhance.2C_of_fix_something.3F
>
>
>
>     HTH,
>
>     Alex.
>
>
>
>         We have added a service ID 80 on fortigate
>
>         config system wccp
>         ???? edit "80"
>         ???????? set router-id 10.10.50.1
>         ???????? set group-address 0.0.0.0
>         ???????? set server-list 10.10.50.2 255.255.255.255
>         ???????? set server-type forward
>         ???????? set authentication disable
>         ???????? set forward-method GRE
>         ???????? set return-method GRE
>         ???????? set assignment-method HASH
>         ???? next
>         end
>
>         Squid wccp configuration
>
>         wccp2_router 10.10.50.1
>         wccp_version 3
>         # tested v4 do the same behavior
>         wccp2_rebuild_wait on
>         wccp2_forwarding_method gre
>         wccp2_return_method gre
>         wccp2_assignment_method hash
>         wccp2_service dynamic 80
>         wccp2_service_info 80 protocol=tcp protocol=tcp
>         flags=src_ip_hash priority=240 ports=80,443
>         wccp2_address 0.0.0.0
>         wccp2_weight 10000
>
>         Squid claim in debug log
>
>         022/06/21 13:15:38.780 kid4| 80,6| wccp2.cc(1206)
>         wccp2HandleUdp: wccp2HandleUdp: Called.
>         2022/06/21 13:15:38.781 kid4| 5,5| ModEpoll.cc(118) SetSelect:
>         FD 38, type=1, handler=1, client_data=0, timeout=0
>         2022/06/21 13:15:38.781 kid4| 80,3| wccp2.cc(1230)
>         wccp2HandleUdp: Incoming WCCPv2 I_SEE_YOU length 112.
>         2022/06/21 13:15:38.781 kid4| ERROR: Ignoring WCCPv2 message:
>         truncated record
>         ???? exception location: wccp2.cc(1133) CheckSectionLength
>
>
>
>         -- 
>
>         _______________________________________________
>         squid-users mailing list
>         squid-users at lists.squid-cache.org
>         http://lists.squid-cache.org/listinfo/squid-users
>
>
>     _______________________________________________
>     squid-users mailing list
>     squid-users at lists.squid-cache.org
>     http://lists.squid-cache.org/listinfo/squid-users
>
> -- 
>
> *Technical Support*
>
> 	
> 	
>
> *David Touzeau***
>
> Orgerus, Yvelines, France
>
> *Artica Tech*
>
>
> P:?+33 6 58 44 69 46
> www: wiki.articatech.com <https://wiki.articatech.com>
> www: articatech.net <http://articatech.net>
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
-- 
Technical Support
	
	
*David Touzeau*
Orgerus, Yvelines, France
*Artica Tech*

P:?+33 6 58 44 69 46
www: wiki.articatech.com <https://wiki.articatech.com>
www: articatech.net <http://articatech.net>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220624/f64b1129/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.jpg
Type: image/jpeg
Size: 6266 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220624/f64b1129/attachment.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: XiJKjGpmsvhKM2h3.jpg
Type: image/jpeg
Size: 6266 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220624/f64b1129/attachment-0001.jpg>

From ngtech1ltd at gmail.com  Fri Jun 24 11:17:18 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Fri, 24 Jun 2022 14:17:18 +0300
Subject: [squid-users] WCCPV2 with fortigate ERROR: Ignoring WCCPv2
 message: truncated record
In-Reply-To: <ea0d322b-336d-8f37-f7c9-f8860a80e121@articatech.com>
References: <54207710-866f-97a1-b1c7-0b9cb343dcca@articatech.com>
 <c668553e-5d30-9853-0108-519348612566@measurement-factory.com>
 <7332cf67-5bc0-6b2a-3648-93ff7afab5a3@articatech.com>
 <000701d8871e$e8589e00$b909da00$@gmail.com>
 <ea0d322b-336d-8f37-f7c9-f8860a80e121@articatech.com>
Message-ID: <001301d887bb$f7e14780$e7a3d680$@gmail.com>

Hey David,
 
I am not sure and can spin up my Forti but from what I remember there are PBR functions in the Forti.
Why would a WCCP be required? To pass only ports 80 and 443 instead of all traffic?
 
Thanks,
Eliezer
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> 
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/
 
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of David Touzeau
Sent: Friday, 24 June 2022 14:04
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] WCCPV2 with fortigate ERROR: Ignoring WCCPv2 message: truncated record
 
Hi Elizer
No, Fortinet is good.
In this case is connecting HTTP/HTTPs with WCCP from Fortinet to squid did not work, because SQUID refuse to communicate with Fortinet according to "Ignoring WCCPv2 message: truncated record" issue.
With Squid,  Fortinet report that is no WCCP server available.
 
Le 23/06/2022 ? 18:33, ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com>  a ?crit :
Hey David,
 
Just trying to understand something:
Aren?t Fortinet something that should replace squid?
I assumed that it should do a much better job then Squid in many aeras.
What a Fortinet(I have one?) is not covering?
 
Thanks,
Eliezer
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> 
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/
 
From: squid-users  <mailto:squid-users-bounces at lists.squid-cache.org> <squid-users-bounces at lists.squid-cache.org> On Behalf Of David Touzeau
Sent: Thursday, 23 June 2022 19:12
To: squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> 
Subject: Re: [squid-users] WCCPV2 with fortigate ERROR: Ignoring WCCPv2 message: truncated record
 
Hi Alex,
is the v5 commit 7a73a54 already included in the latest 5.5,5.6 versions?

This is very unfortunate because WCCP is used by default by Fortinet firewall devices. It should be very popular.
Indeed, Fortinet is flooding the market.
I can volunteer for the funding and the necessary testing to be done.
Le 23/06/2022 ? 14:44, Alex Rousskov a ?crit :
On 6/21/22 07:43, David Touzeau wrote: 



We trying to using WCCP with Fortigate without success Squid version  5.5 always claim "Ignoring WCCPv2 message: truncated record" 

What can be the cause ? 

The most likely cause are bugs in untested WCCP fixes (v5 commit 7a73a54). Dormant draft PR 970 contains unfinished fixes for the problems in that previous attempt: 
https://github.com/squid-cache/squid/pull/970 

IMHO, folks that need WCCP support should invest into that semi-abandoned Squid feature or risk losing it. WCCP code needs serious refactoring and proper testing. There are currently no Project volunteers that have enough resources and capabilities to do either. 

https://wiki.squid-cache.org/SquidFaq/AboutSquid#How_to_add_a_new_Squid_feature.2C_enhance.2C_of_fix_something.3F 


HTH, 

Alex. 




We have added a service ID 80 on fortigate 

config system wccp 
     edit "80" 
         set router-id 10.10.50.1 
         set group-address 0.0.0.0 
         set server-list 10.10.50.2 255.255.255.255 
         set server-type forward 
         set authentication disable 
         set forward-method GRE 
         set return-method GRE 
         set assignment-method HASH 
     next 
end 

Squid wccp configuration 

wccp2_router 10.10.50.1 
wccp_version 3 
# tested v4 do the same behavior 
wccp2_rebuild_wait on 
wccp2_forwarding_method gre 
wccp2_return_method gre 
wccp2_assignment_method hash 
wccp2_service dynamic 80 
wccp2_service_info 80 protocol=tcp protocol=tcp flags=src_ip_hash priority=240 ports=80,443 
wccp2_address 0.0.0.0 
wccp2_weight 10000 

Squid claim in debug log 

022/06/21 13:15:38.780 kid4| 80,6| wccp2.cc(1206) wccp2HandleUdp: wccp2HandleUdp: Called. 
2022/06/21 13:15:38.781 kid4| 5,5| ModEpoll.cc(118) SetSelect: FD 38, type=1, handler=1, client_data=0, timeout=0 
2022/06/21 13:15:38.781 kid4| 80,3| wccp2.cc(1230) wccp2HandleUdp: Incoming WCCPv2 I_SEE_YOU length 112. 
2022/06/21 13:15:38.781 kid4| ERROR: Ignoring WCCPv2 message: truncated record 
     exception location: wccp2.cc(1133) CheckSectionLength 



-- 

_______________________________________________ 
squid-users mailing list 
squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org>  
http://lists.squid-cache.org/listinfo/squid-users 

_______________________________________________ 
squid-users mailing list 
squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org>  
http://lists.squid-cache.org/listinfo/squid-users 
-- 


Technical Support
	David Touzeau
Orgerus, Yvelines, France
Artica Tech 

P: +33 6 58 44 69 46 
www: wiki.articatech.com <https://wiki.articatech.com>  
www: articatech.net <http://articatech.net>  
 



_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> 
http://lists.squid-cache.org/listinfo/squid-users
-- 


Technical Support
	David Touzeau
Orgerus, Yvelines, France
Artica Tech 

P: +33 6 58 44 69 46 
www: wiki.articatech.com <https://wiki.articatech.com>  
www: articatech.net <http://articatech.net>  
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220624/f38d6061/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.jpg
Type: image/jpeg
Size: 6266 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220624/f38d6061/attachment.jpg>

From david at articatech.com  Sun Jun 26 10:33:55 2022
From: david at articatech.com (David Touzeau)
Date: Sun, 26 Jun 2022 12:33:55 +0200
Subject: [squid-users] WCCPV2 with fortigate ERROR: Ignoring WCCPv2
 message: truncated record
In-Reply-To: <001301d887bb$f7e14780$e7a3d680$@gmail.com>
References: <54207710-866f-97a1-b1c7-0b9cb343dcca@articatech.com>
 <c668553e-5d30-9853-0108-519348612566@measurement-factory.com>
 <7332cf67-5bc0-6b2a-3648-93ff7afab5a3@articatech.com>
 <000701d8871e$e8589e00$b909da00$@gmail.com>
 <ea0d322b-336d-8f37-f7c9-f8860a80e121@articatech.com>
 <001301d887bb$f7e14780$e7a3d680$@gmail.com>
Message-ID: <725ccb19-4432-45da-a3fd-4fc43d4b4733@articatech.com>

Hi Eliezer

if you want to do transparent mode without having to put squid squidboix 
in front of your fortinet.

If you want to do transparent mode while your fortinet aggregates 
several VLANs, the WCCP mode is necessary

So you can control everything through your fortigate

By the way, fortinet offers their proxy based on WCCP to ensure a 
consistent integration with fortigate

My configuration is very simple to replicate :

We have added a service ID 80 on fortigate but failed caused by the 
squid bug

config system wccp
 ???? edit "80"
 ???????? set router-id 10.10.50.1
 ???????? set group-address 0.0.0.0
 ???????? set server-list 10.10.50.2 255.255.255.255
 ???????? set server-type forward
 ???????? set authentication disable
 ???????? set forward-method GRE
 ???????? set return-method GRE
 ???????? set assignment-method HASH
 ???? next
end

Squid wccp configuration

wccp2_router 10.10.50.1
wccp_version 3
# tested v4 do the same behavior
wccp2_rebuild_wait on
wccp2_forwarding_method gre
wccp2_return_method gre
wccp2_assignment_method hash
wccp2_service dynamic 80
wccp2_service_info 80 protocol=tcp protocol=tcp flags=src_ip_hash 
priority=240 ports=80,443
wccp2_address 0.0.0.0
wccp2_weight 10000


Le 24/06/2022 ? 13:17, ngtech1ltd at gmail.com a ?crit?:
>
> I am not sure and can spin up my Forti but from what I remember there 
> are PBR functions in the Forti.
>
> Why would a WCCP be required? To pass only ports 80 and 443 instead of 
> all traffic?
>
-- 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220626/1aa594ef/attachment.htm>

From ngtech1ltd at gmail.com  Sun Jun 26 11:27:06 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Sun, 26 Jun 2022 14:27:06 +0300
Subject: [squid-users] MS-SQL with squid helpers
Message-ID: <000d01d8894f$ab3182c0$01948840$@gmail.com>

Hey Everybody,
 
I was wondering if someone wrote a set of helpers that works with MS-SQL server database?
I have a very big MSSQL Database that contains a set of domains and urls and I have a program that runs queries against this DB.
 
If no one wrote such helpers I can manage to write a set of helpers at-least on ruby and GoLang and maybe couple other languages.
I can recommend a nice basic video about MS-SQL that I have seen lately:
https://www.youtube.com/watch?v=h0nxCDiD-zg
 
Very basic but very nice if you already have some SQL and programming fundamentals.
 

Eliezer
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email:  <mailto:ngtech1ltd at gmail.com> ngtech1ltd at gmail.com
Web:  <https://ngtech.co.il/> https://ngtech.co.il/
My-Tube:  <https://tube.ngtech.co.il/> https://tube.ngtech.co.il/
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220626/eb406372/attachment.htm>

From bruno.larini at riosoft.com.br  Mon Jun 27 21:53:00 2022
From: bruno.larini at riosoft.com.br (Bruno de Paula Larini)
Date: Mon, 27 Jun 2022 18:53:00 -0300
Subject: [squid-users] Squid also checking for IP on ACL
Message-ID: <beb371f2-b136-d203-dfc6-4d0988eb6deb@riosoft.com.br>

Spam detection software, running on the system "master.squid-cache.org",
has identified this incoming email as possible spam.  The original
message has been attached to this so you can view it or label
similar future email.  If you have any questions, see
the administrator of that system for details.

Content preview:  Hi list. I have a pretty simple configuration for website
  filtering (intercepted) and ssl_bump, which follows below. However, for some
   reason, it seems Squid resolves the website domain address, then uses the
   [...] 

Content analysis details:   (5.6 points, 5.0 required)

 pts rule name              description
---- ---------------------- --------------------------------------------------
 3.6 RCVD_IN_PBL            RBL: Received via a relay in Spamhaus PBL
                            [171.171.0.181 listed in zen.spamhaus.org]
 1.0 SPF_SOFTFAIL           SPF: sender does not match SPF record (softfail)
 0.0 NORMAL_HTTP_TO_IP      URI: URI host has a public dotted-decimal IPv4
                             address
 0.0 NUMERIC_HTTP_ADDR      URI: Uses a numeric IP address in URL
 0.1 DKIM_SIGNED            Message has a DKIM or DK signature, not necessarily
                            valid
-0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
                            author's domain
-0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                            envelope-from domain
-0.1 DKIM_VALID             Message has at least one valid DKIM or DK signature
 1.3 RDNS_NONE              Delivered to internal network by a host with no rDNS
 0.0 UNPARSEABLE_RELAY      Informational: message has unparseable relay
                            lines
-0.0 T_SCC_BODY_TEXT_LINE   No description available.
 0.0 NO_FM_NAME_IP_HOSTN    No From name + hostname using IP address


-------------- next part --------------
An embedded message was scrubbed...
From: Bruno de Paula Larini <bruno.larini at riosoft.com.br>
Subject: Squid also checking for IP on ACL
Date: Mon, 27 Jun 2022 18:53:00 -0300
Size: 3656
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220627/8b7c1aa2/attachment.eml>

From bruno.larini at riosoft.com.br  Mon Jun 27 22:01:25 2022
From: bruno.larini at riosoft.com.br (bruno.larini at riosoft.com.br)
Date: Mon, 27 Jun 2022 19:01:25 -0300
Subject: [squid-users] Squid also checking for IP on ACL
Message-ID: <81A0AB184EDF469FBCEE36ECE596E6C5.MAI@riosoft.com.br>

Spam detection software, running on the system "master.squid-cache.org",
has identified this incoming email as possible spam.  The original
message has been attached to this so you can view it or label
similar future email.  If you have any questions, see
the administrator of that system for details.

Content preview:  Hi list. I have a pretty simple configuration for website
  filtering (intercepted) and ssl_bump, which follows below. However, for some
   reason, it seems Squid resolves the website domain address, then uses the
   [...] 

Content analysis details:   (5.6 points, 5.0 required)

 pts rule name              description
---- ---------------------- --------------------------------------------------
 3.6 RCVD_IN_PBL            RBL: Received via a relay in Spamhaus PBL
                            [171.171.0.1 listed in zen.spamhaus.org]
 1.0 SPF_SOFTFAIL           SPF: sender does not match SPF record (softfail)
 0.0 NORMAL_HTTP_TO_IP      URI: URI host has a public dotted-decimal IPv4
                             address
 0.0 NUMERIC_HTTP_ADDR      URI: Uses a numeric IP address in URL
 0.0 HTML_MESSAGE           BODY: HTML included in message
 0.1 DKIM_SIGNED            Message has a DKIM or DK signature, not necessarily
                            valid
-0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
                            author's domain
-0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                            envelope-from domain
-0.1 DKIM_VALID             Message has at least one valid DKIM or DK signature
 1.3 RDNS_NONE              Delivered to internal network by a host with no rDNS
 0.0 UNPARSEABLE_RELAY      Informational: message has unparseable relay
                            lines
-0.0 T_SCC_BODY_TEXT_LINE   No description available.

The original message was not completely plain text, and may be unsafe to
open with some email clients; in particular, it may contain a virus,
or confirm that your address can receive spam.  If you wish to view
it, it may be safer to save it to a file and open it with an editor.

-------------- next part --------------
An embedded message was scrubbed...
From: <bruno.larini at riosoft.com.br>
Subject: Squid also checking for IP on ACL
Date: Mon, 27 Jun 2022 19:01:25 -0300
Size: 6361
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220627/34502eff/attachment.eml>

From m_zouhairy at ckta.by  Tue Jun 28 09:09:43 2022
From: m_zouhairy at ckta.by (Majed Zouhairy)
Date: Tue, 28 Jun 2022 12:09:43 +0300
Subject: [squid-users] squid still crashes
Message-ID: <caac86fd-53e0-5853-d6b9-42ff872ea74f@ckta.by>

Yesterday, we upgraded from squid 5.4.1 to squid 5.6 yet it still 
crashes in less than 12 hours..

Today, we check the logs..and there is this:

/06/28 00:10:03 kid1| ERROR: failure while accepting a TLS connection on 
conn8058 local=10.10.10.10:8080 remote=10.10.11.10:64023 FD 25 flags=1: 
0x55b631f514b0*1
     current master transaction: master57
2022/06/28 00:10:54 kid1| FATAL: check failed: transporting()
     exception location: FwdState.cc(678) noteDestinationsEnd
     current master transaction: master3490
2022/06/28 00:10:54 kid1| Closing Pinger socket on FD 53
     current master transaction: master3490
2022/06/28 00:10:54| Pinger exiting.
2022/06/28 00:10:54 kid1| Set Current Directory to /var/cache/squid
2022/06/28 00:10:54 kid1| Starting Squid Cache version 5.6 for 
x86_64-suse-linux-gnu...
2022/06/28 00:10:54 kid1| Service Name: squid
2022/06/28 00:10:54 kid1| Process ID 2962
2022/06/28 00:10:54 kid1| Process Roles: worker
2022/06/28 00:10:54 kid1| With 4096 file descriptors available
2022/06/28 00:10:54 kid1| Initializing IP Cache...
2022/06/28 00:10:54 kid1| DNS Socket created at [::], FD 8
2022/06/28 00:10:54 kid1| DNS Socket created at 0.0.0.0, FD 9
2022/06/28 00:10:54 kid1| Adding nameserver 10.0.12.10 from /etc/resolv.conf
2022/06/28 00:10:54 kid1| Adding nameserver 10.0.12.11 from /etc/resolv.conf
2022/06/28 00:10:54 kid1| helperOpenServers: Starting 5/32 
'security_file_certgen' processes
2022/06/28 00:10:54 kid1| helperOpenServers: Starting 8/16 'ufdbgclient' 
processes
2022/06/28 00:10:54 kid1| Logfile: opening log 
daemon:/var/log/squid/access.log
2022/06/28 00:10:54 kid1| Logfile Daemon: opening log 
/var/log/squid/access.log
2022/06/28 00:10:55 kid1| Unlinkd pipe opened on FD 41
2022/06/28 00:10:55 kid1| Local cache digest enabled; rebuild/rewrite 
every 3600/3600 sec
2022/06/28 00:10:55 kid1| Store logging disabled
2022/06/28 00:10:55 kid1| Swap maxSize 3072000 + 983040 KB, estimated 
311926 objects
2022/06/28 00:10:55 kid1| Target number of buckets: 15596
2022/06/28 00:10:55 kid1| Using 16384 Store buckets
2022/06/28 00:10:55 kid1| Max Mem  size: 983040 KB
2022/06/28 00:10:55 kid1| Max Swap size: 3072000 KB
2022/06/28 00:10:55 kid1| Rebuilding storage in /var/cache/squid (dirty log)
2022/06/28 00:10:55 kid1| Using Least Load store dir selection
2022/06/28 00:10:55 kid1| Set Current Directory to /var/cache/squid
2022/06/28 00:10:55 kid1| Finished loading MIME types and icons.
2022/06/28 00:10:55 kid1| HTCP Disabled.
2022/06/28 00:10:55 kid1| Pinger socket opened on FD 46
2022/06/28 00:10:55 kid1| Squid plugin modules loaded: 0
2022/06/28 00:10:55 kid1| Adaptation support is off.
2022/06/28 00:10:55 kid1| Accepting SSL bumped HTTP Socket connections 
at conn29 local=[::]:8080 remote=[::] FD 44 flags=9
2022/06/28 00:10:55| pinger: Initialising ICMP pinger ...
2022/06/28 00:10:55| pinger: ICMP socket opened.
2022/06/28 00:10:55| pinger: ICMPv6 socket opened
2022/06/28 00:10:55 kid1| Store rebuilding is 4.21% complete
2022/06/28 00:10:56 kid1| Done reading /var/cache/squid swaplog (94921 
entries)
2022/06/28 00:10:56 kid1| Finished rebuilding storage from disk.
2022/06/28 00:10:56 kid1|     94915 Entries scanned
2022/06/28 00:10:56 kid1|         0 Invalid entries.
2022/06/28 00:10:56 kid1|         0 With invalid flags.
2022/06/28 00:10:56 kid1|     94911 Objects loaded.
2022/06/28 00:10:56 kid1|         0 Objects expired.
2022/06/28 00:10:56 kid1|         6 Objects cancelled.
2022/06/28 00:10:56 kid1|         0 Duplicate URLs purged.
2022/06/28 00:10:56 kid1|         4 Swapfile clashes avoided.
2022/06/28 00:10:56 kid1|   Took 1.36 seconds (69553.12 objects/sec).
2022/06/28 00:10:56 kid1| Beginning Validation Procedure
2022/06/28 00:10:56 kid1|   Completed Validation Procedure
2022/06/28 00:10:56 kid1|   Validated 94908 Entries
2022/06/28 00:10:56 kid1|   store_swap_size = 2700488.00 KB
2022/06/28 00:10:56 kid1| storeLateRelease: released 6 objects
2022/06/28 00:11:00 kid1| ERROR: failure while accepting a TLS 
connection on conn244 local=10.10.10.10:8080 remote=10.10.11.10:64095 FD 
27 flags=1: 0x55804e1d9770*1
     current master transaction: master60


From 0xff1f at gmail.com  Tue Jun 28 09:12:12 2022
From: 0xff1f at gmail.com (Ahmad Alzaeem)
Date: Tue, 28 Jun 2022 09:12:12 +0000
Subject: [squid-users] is there any squid 4.x version has delay_pools
 working?
In-Reply-To: <a29de087-00f1-f7a8-6b49-50e0c9069d5a@measurement-factory.com>
References: <20220224122435.257ddc228d11dff7cd21285c@killthe.net>
 <1ac60e46-7f77-9bcc-72b2-92873d34eb41@measurement-factory.com>
 <20220224133856.b26137522496068ee70ea708@killthe.net>
 <e3380183-ef20-ca1f-54d6-4059cf7c3305@measurement-factory.com>
 <20220224154953.0623171e887350d6d5db2c08@killthe.net>
 <695E12D0-F862-4A17-9A41-D1D00BFB904C@gmail.com>
 <006a01d82a04$4765cf80$d6316e80$@gmail.com>
 <5055BF2B-2286-49DA-879F-804ACDF9D355@gmail.com>
 <a29de087-00f1-f7a8-6b49-50e0c9069d5a@measurement-factory.com>
Message-ID: <DBBPR09MB4523A9EE59D11909DB2DD690F7B89@DBBPR09MB4523.eurprd09.prod.outlook.com>

Hello team and Alex .

Any updates on this ?
Any squid4.x support delay pools for now ?


I tried a lot and none of them support delay pools !!!

From: squid-users <squid-users-bounces at lists.squid-cache.org> on behalf of Alex Rousskov <rousskov at measurement-factory.com>
Date: Saturday, March 5, 2022 at 1:07 PM
To: squid-users at lists.squid-cache.org <squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] is there any squid 4.x version has delay_pools working?
On 3/5/22 13:43, Ahmad Alzaeem wrote:
> Hello ,
>
> No SSL Pump .
> we use CONNECTmethod.
> squid accepts the directive, but it has no real affect.
>
> the same config on 3.x worked fine.
>
> Im sure 100 % , none of squid 4.x worked with delay pools with me.

Sounds like Bug 4913 to me:
https://bugs.squid-cache.org/show_bug.cgi?id=4913

I do not know whether the latest summary there is still accurate, but I
know that the underlying code is (still) badly broken.

Alex.



>> On Feb 24, 2022, at 11:58 PM, Eliezer Croitoru wrote:
>>
>> Hey Ahmad,
>> Can you please give more details on the specific issue or issues you
>> have verified in 4.17?
>> What exactly doesn?t work in delay_pools? Plain HTTP download or
>> upload speed?
>> Is it only on HTTP or also on CONNECT or HTTPS or SSL-BUMP connections?
>> Eliezer
>>
>>   * I was thinking about creating a webinar about Squid ssl(TLS) bump
>>
>> ----
>> Eliezer Croitoru
>> NgTech, Tech Support
>> Mobile: +972-5-28704261
>> Email:ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com>
>> *From:*squid-users <squid-users-bounces at lists.squid-cache.org
>> <mailto:squid-users-bounces at lists.squid-cache.org>>*On Behalf Of*Ahmad
>> Alzaeem
>> *Sent:*Friday, February 25, 2022 02:14
>> *To:*squid-users at lists.squid-cache.org
>> <mailto:squid-users at lists.squid-cache.org>
>> *Subject:*[squid-users] is there any squid 4.x version has delay_pools
>> working?
>> I tried many squid 4.x versions and none of them has delay_pools to work .
>> I have it to work on 3.x versions .
>> is there any specific 4.x version that ws tested with delay pools to
>> work ?
>> i would like to report it as bug at least in squid-4.17
>> <http://www.squid-cache.org/Versions/v4/squid-4.17-RELEASENOTES.html> which
>> i tested today .
>> Regards
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> <mailto:squid-users at lists.squid-cache.org>
>> http://lists.squid-cache.org/listinfo/squid-users
>> <http://lists.squid-cache.org/listinfo/squid-users>
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220628/4cf70e33/attachment.htm>

From bruno.larini at riosoft.com.br  Tue Jun 28 12:08:00 2022
From: bruno.larini at riosoft.com.br (Bruno de Paula Larini)
Date: Tue, 28 Jun 2022 09:08:00 -0300
Subject: [squid-users] Squid checking for both dstdomain and IP
Message-ID: <419c10f1-b987-68de-c968-a1507eacfc22@riosoft.com.br>

Hi list.

I have a pretty simple configuration for website filtering (intercepted) 
and ssl_bump, which follows below.
However, for some reason, it seems Squid resolves the website domain 
address, then uses the IP to compare with the ACLs.
As the IP is not included in the ACL, the access to the website is denied.
Before that, it already checked for the domain name. I can tell based on 
the error from the browser.
I'm using Squid version 5.5.

For example, while trying to open https://repo.maven.apache.org/ 
(included in the allowed sites), the browser shows the error:

 ??? The following error was encountered while trying to retrieve the 
URL: https://199.232.192.215/*

 ??? Access Denied.

If I replace 'deny all' with 'allow all', the website will open as expected.
Is there something wrong with my config? I have something similar 
running and working on version 4.4 (unless I'm missing something).
I'm still only splicing for now.

Thanks for the help!


### SQUID.CONF
...
#
# INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
#

acl allowed_sites dstdomain "/etc/squid/allowed-sites.txt"
http_access allow allowed_sites

acl step1 at_step SslBump1
ssl_bump peek step1
ssl_bump splice all

tls_outgoing_options capath=/etc/pki/tls/certs options=ALL

sslcrtd_program /usr/lib64/squid/security_file_certgen -s 
/var/lib/squid/ssl_db -M 8MB
sslcrtd_children 3

http_access allow localhost

# And finally deny all other access to this proxy
http_access deny all

# Squid normally listens to port 3128
http_port 192.168.10.10:8080
http_port 192.168.10.10:3128 intercept
https_port 192.168.10.10:3129 tls-cert=/etc/squid/ssl/squidCA.pem 
tls-key=/etc/squid/ssl/squidCA.key ssl-bump intercept 
generate-host-certificates=on dynamic_cert_mem_cache_size=8MB
...

### IPTABLES
...
iptables -t nat -A PREROUTING -i eth0 -s 192.168.10.0/24 -p tcp --dport 
80 -j REDIRECT --to-port 3128
iptables -t nat -A PREROUTING -i eth0 -s 192.168.10.0/24 -p tcp --dport 
443 -j REDIRECT --to-port 3129
...



From 0xff1f at gmail.com  Tue Jun 28 13:28:33 2022
From: 0xff1f at gmail.com (Ahmad Alzaeem)
Date: Tue, 28 Jun 2022 13:28:33 +0000
Subject: [squid-users] squid 3.x on Centos8 not working
Message-ID: <DBBPR09MB4523CC08514A6EA08BCD3DC2F7B89@DBBPR09MB4523.eurprd09.prod.outlook.com>


Hello Folks ,

Trying to compile squid 3.x on Centos8 but have an errors below seems in SMBLIB .

Squid ver :
squid-3.5.28

GCC ver :

gcc -v
Using built-in specs.
COLLECT_GCC=gcc
COLLECT_LTO_WRAPPER=/usr/libexec/gcc/x86_64-redhat-linux/8/lto-wrapper
OFFLOAD_TARGET_NAMES=nvptx-none
OFFLOAD_TARGET_DEFAULT=1
Target: x86_64-redhat-linux
Configured with: ../configure --enable-bootstrap --enable-languages=c,c++,fortran,lto --prefix=/usr --mandir=/usr/share/man --infodir=/usr/share/info --with-bugurl=http://bugzilla.redhat.com/bugzilla --enable-shared --enable-threads=posix --enable-checking=release --enable-multilib --with-system-zlib --enable-__cxa_atexit --disable-libunwind-exceptions --enable-gnu-unique-object --enable-linker-build-id --with-gcc-major-version-only --with-linker-hash-style=gnu --enable-plugin --enable-initfini-array --with-isl --disable-libmpx --enable-offload-targets=nvptx-none --without-cuda-driver --enable-gnu-indirect-function --enable-cet --with-tune=generic --with-arch_32=x86-64 --build=x86_64-redhat-linux
Thread model: posix
gcc version 8.5.0 20210514 (Red Hat 8.5.0-4) (GCC)

we are using ./configure  with default flags  ,  and have the errors below :


make[2]: Entering directory '/root/squid-3.5.28/lib/rfcnb'
depbase=`echo rfcnb-io.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
/bin/sh ../../libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H   -I../.. -I../../include -I../../lib -I../../src -I../../include    -I../../lib  -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT rfcnb-io.lo -MD -MP -MF $depbase.Tpo -c -o rfcnb-io.lo rfcnb-io.c &&\
mv -f $depbase.Tpo $depbase.Plo
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT rfcnb-io.lo -MD -MP -MF .deps/rfcnb-io.Tpo -c rfcnb-io.c  -fPIC -DPIC -o .libs/rfcnb-io.o
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT rfcnb-io.lo -MD -MP -MF .deps/rfcnb-io.Tpo -c rfcnb-io.c -o rfcnb-io.o >/dev/null 2>&1
depbase=`echo rfcnb-util.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
/bin/sh ../../libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H   -I../.. -I../../include -I../../lib -I../../src -I../../include    -I../../lib  -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT rfcnb-util.lo -MD -MP -MF $depbase.Tpo -c -o rfcnb-util.lo rfcnb-util.c &&\
mv -f $depbase.Tpo $depbase.Plo
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT rfcnb-util.lo -MD -MP -MF .deps/rfcnb-util.Tpo -c rfcnb-util.c  -fPIC -DPIC -o .libs/rfcnb-util.o
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT rfcnb-util.lo -MD -MP -MF .deps/rfcnb-util.Tpo -c rfcnb-util.c -o rfcnb-util.o >/dev/null 2>&1
depbase=`echo session.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
/bin/sh ../../libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H   -I../.. -I../../include -I../../lib -I../../src -I../../include    -I../../lib  -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT session.lo -MD -MP -MF $depbase.Tpo -c -o session.lo session.c &&\
mv -f $depbase.Tpo $depbase.Plo
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT session.lo -MD -MP -MF .deps/session.Tpo -c session.c  -fPIC -DPIC -o .libs/session.o
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT session.lo -MD -MP -MF .deps/session.Tpo -c session.c -o session.o >/dev/null 2>&1
/bin/sh ../../libtool  --tag=CC   --mode=link gcc -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2  -g -o librfcnb.la  rfcnb-io.lo rfcnb-util.lo session.lo
libtool: link: /usr/bin/ar cru .libs/librfcnb.a .libs/rfcnb-io.o .libs/rfcnb-util.o .libs/session.o
libtool: link: ranlib .libs/librfcnb.a
libtool: link: ( cd ".libs" && rm -f "librfcnb.la" && ln -s "../librfcnb.la" "librfcnb.la" )
make[2]: Leaving directory '/root/squid-3.5.28/lib/rfcnb'
Making all in smblib
make[2]: Entering directory '/root/squid-3.5.28/lib/smblib'
depbase=`echo md4.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
/bin/sh ../../libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H   -I../.. -I../../include -I../../lib -I../../src -I../../include    -I../../lib  -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT md4.lo -MD -MP -MF $depbase.Tpo -c -o md4.lo md4.c &&\
mv -f $depbase.Tpo $depbase.Plo
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT md4.lo -MD -MP -MF .deps/md4.Tpo -c md4.c  -fPIC -DPIC -o .libs/md4.o
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT md4.lo -MD -MP -MF .deps/md4.Tpo -c md4.c -o md4.o >/dev/null 2>&1
depbase=`echo smblib.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
/bin/sh ../../libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H   -I../.. -I../../include -I../../lib -I../../src -I../../include    -I../../lib  -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT smblib.lo -MD -MP -MF $depbase.Tpo -c -o smblib.lo smblib.c &&\
mv -f $depbase.Tpo $depbase.Plo
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT smblib.lo -MD -MP -MF .deps/smblib.Tpo -c smblib.c  -fPIC -DPIC -o .libs/smblib.o
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT smblib.lo -MD -MP -MF .deps/smblib.Tpo -c smblib.c -o smblib.o >/dev/null 2>&1
depbase=`echo smblib-util.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
/bin/sh ../../libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H   -I../.. -I../../include -I../../lib -I../../src -I../../include    -I../../lib  -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT smblib-util.lo -MD -MP -MF $depbase.Tpo -c -o smblib-util.lo smblib-util.c &&\
mv -f $depbase.Tpo $depbase.Plo
libtool: compile:  gcc -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -I../../lib -Wall -Wpointer-arith -Wwrite-strings -Wmissing-prototypes -Wmissing-declarations -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -Wall -g -O2 -MT smblib-util.lo -MD -MP -MF .deps/smblib-util.Tpo -c smblib-util.c  -fPIC -DPIC -o .libs/smblib-util.o
smblib-util.c: In function ?SMB_Negotiate?:
smblib-util.c:400:9: error: ?strncpy? output may be truncated copying 79 bytes from a string of length 79 [-Werror=stringop-truncation]
         strncpy(p, Con_Handle -> Svr_PDom, sizeof(Con_Handle -> Svr_PDom) - 1);
         ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
smblib-util.c:423:9: error: ?strncpy? output may be truncated copying 79 bytes from a string of length 79 [-Werror=stringop-truncation]
         strncpy(p, Con_Handle -> Svr_PDom, sizeof(Con_Handle -> Svr_PDom) - 1);
         ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
smblib-util.c: In function ?SMB_TreeConnect?:
smblib-util.c:537:5: error: ?strncpy? specified bound 129 equals destination size [-Werror=stringop-truncation]
     strncpy(tree -> path, path, sizeof(tree -> path));
     ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
smblib-util.c:538:5: error: ?strncpy? specified bound 20 equals destination size [-Werror=stringop-truncation]
     strncpy(tree -> device_type, device, sizeof(tree -> device_type));
     ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
cc1: all warnings being treated as errors
make[2]: *** [Makefile:776: smblib-util.lo] Error 1
make[2]: Leaving directory '/root/squid-3.5.28/lib/smblib'
make[1]: *** [Makefile:1043: all-recursive] Error 1
make[1]: Leaving directory '/root/squid-3.5.28/lib'
make: *** [Makefile:581: all-recursive] Error 1

Any help is welcome !
Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220628/db4d1057/attachment.htm>

From rousskov at measurement-factory.com  Tue Jun 28 13:32:46 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Tue, 28 Jun 2022 09:32:46 -0400
Subject: [squid-users] is there any squid 4.x version has delay_pools
 working?
In-Reply-To: <DBBPR09MB4523A9EE59D11909DB2DD690F7B89@DBBPR09MB4523.eurprd09.prod.outlook.com>
References: <20220224122435.257ddc228d11dff7cd21285c@killthe.net>
 <1ac60e46-7f77-9bcc-72b2-92873d34eb41@measurement-factory.com>
 <20220224133856.b26137522496068ee70ea708@killthe.net>
 <e3380183-ef20-ca1f-54d6-4059cf7c3305@measurement-factory.com>
 <20220224154953.0623171e887350d6d5db2c08@killthe.net>
 <695E12D0-F862-4A17-9A41-D1D00BFB904C@gmail.com>
 <006a01d82a04$4765cf80$d6316e80$@gmail.com>
 <5055BF2B-2286-49DA-879F-804ACDF9D355@gmail.com>
 <a29de087-00f1-f7a8-6b49-50e0c9069d5a@measurement-factory.com>
 <DBBPR09MB4523A9EE59D11909DB2DD690F7B89@DBBPR09MB4523.eurprd09.prod.outlook.com>
Message-ID: <75cf3db9-fa40-e115-8bd7-a8e85168bc6a@measurement-factory.com>

On 6/28/22 05:12, Ahmad Alzaeem wrote:
> Hello team and Alex .
> 
> Any updates on this ?

I have nothing to add to my previous response except that v4 is 
receiving very few updates these days. That does not mean all the delay 
pools bugs you have been suffering from are fixed in v5 or master/v6. 
See the bug reference in my earlier response for the details.

Alex.


> On 3/5/22 13:43, Ahmad Alzaeem wrote:
>> Hello ,
>> 
>> No SSL Pump .
>> we use CONNECTmethod.
>> squid accepts the directive, but it has no real affect.
>> 
>> the same config on 3.x worked fine.
>> 
>> Im sure 100 % , none of squid 4.x worked with delay pools with me.

> Sounds like Bug 4913 to me:
> https://bugs.squid-cache.org/show_bug.cgi?id=4913 
> 
> I do not know whether the latest summary there is still accurate, but I
> know that the underlying code is (still) badly broken.
> 
> Alex.


From rousskov at measurement-factory.com  Tue Jun 28 13:46:15 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Tue, 28 Jun 2022 09:46:15 -0400
Subject: [squid-users] squid still crashes
In-Reply-To: <caac86fd-53e0-5853-d6b9-42ff872ea74f@ckta.by>
References: <caac86fd-53e0-5853-d6b9-42ff872ea74f@ckta.by>
Message-ID: <96da7120-ab49-05f9-1812-de0d659ef26a@measurement-factory.com>

On 6/28/22 05:09, Majed Zouhairy wrote:
> Yesterday, we upgraded from squid 5.4.1 to squid 5.6 yet it still 
> crashes in less than 12 hours..

> 2022/06/28 00:10:54 kid1| FATAL: check failed: transporting()
>  ??? exception location: FwdState.cc(678) noteDestinationsEnd

Most likely, you are suffering from bug 5186. I hope it was fixed in 
master/v6 (there has been no independent confirmation IIRC). The fix has 
not been included in v5 yet:

https://bugs.squid-cache.org/show_bug.cgi?id=5186

Alex.


From rousskov at measurement-factory.com  Tue Jun 28 13:52:10 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Tue, 28 Jun 2022 09:52:10 -0400
Subject: [squid-users] Squid checking for both dstdomain and IP
In-Reply-To: <419c10f1-b987-68de-c968-a1507eacfc22@riosoft.com.br>
References: <419c10f1-b987-68de-c968-a1507eacfc22@riosoft.com.br>
Message-ID: <32a5bc9e-2900-9b33-061b-e3880694b30b@measurement-factory.com>

On 6/28/22 08:08, Bruno de Paula Larini wrote:

> I have a pretty simple configuration for website filtering (intercepted) 
> and ssl_bump, which follows below.
> However, for some reason, it seems Squid resolves the website domain 
> address, then uses the IP to compare with the ACLs.

Most likely, what is actually happening is that Squid does not have 
domain information during SslBump step1, and then gets that information 
during step2. Squid http_access rules apply to each SslBump step, so you 
have to write them accordingly.

Available to Squid information and expected Squid behavior is documented 
for each step at the following wiki page. There are bugs in that 
algorithm _implementation_, but they are being fixed, and I am not aware 
of better docs: 
https://wiki.squid-cache.org/Features/SslPeekAndSplice#Processing_steps


HTH,

Alex.


> As the IP is not included in the ACL, the access to the website is denied.
> Before that, it already checked for the domain name. I can tell based on 
> the error from the browser.
> I'm using Squid version 5.5.
> 
> For example, while trying to open https://repo.maven.apache.org/ 
> (included in the allowed sites), the browser shows the error:
> 
>  ??? The following error was encountered while trying to retrieve the 
> URL: https://199.232.192.215/*
> 
>  ??? Access Denied.
> 
> If I replace 'deny all' with 'allow all', the website will open as 
> expected.
> Is there something wrong with my config? I have something similar 
> running and working on version 4.4 (unless I'm missing something).
> I'm still only splicing for now.
> 
> Thanks for the help!
> 
> 
> ### SQUID.CONF
> ...
> #
> # INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
> #
> 
> acl allowed_sites dstdomain "/etc/squid/allowed-sites.txt"
> http_access allow allowed_sites
> 
> acl step1 at_step SslBump1
> ssl_bump peek step1
> ssl_bump splice all
> 
> tls_outgoing_options capath=/etc/pki/tls/certs options=ALL
> 
> sslcrtd_program /usr/lib64/squid/security_file_certgen -s 
> /var/lib/squid/ssl_db -M 8MB
> sslcrtd_children 3
> 
> http_access allow localhost
> 
> # And finally deny all other access to this proxy
> http_access deny all
> 
> # Squid normally listens to port 3128
> http_port 192.168.10.10:8080
> http_port 192.168.10.10:3128 intercept
> https_port 192.168.10.10:3129 tls-cert=/etc/squid/ssl/squidCA.pem 
> tls-key=/etc/squid/ssl/squidCA.key ssl-bump intercept 
> generate-host-certificates=on dynamic_cert_mem_cache_size=8MB
> ...
> 
> ### IPTABLES
> ...
> iptables -t nat -A PREROUTING -i eth0 -s 192.168.10.0/24 -p tcp --dport 
> 80 -j REDIRECT --to-port 3128
> iptables -t nat -A PREROUTING -i eth0 -s 192.168.10.0/24 -p tcp --dport 
> 443 -j REDIRECT --to-port 3129
> ...
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



From bruno.larini at riosoft.com.br  Tue Jun 28 18:32:29 2022
From: bruno.larini at riosoft.com.br (Bruno de Paula Larini)
Date: Tue, 28 Jun 2022 15:32:29 -0300
Subject: [squid-users] Squid checking for both dstdomain and IP
In-Reply-To: <32a5bc9e-2900-9b33-061b-e3880694b30b@measurement-factory.com>
References: <419c10f1-b987-68de-c968-a1507eacfc22@riosoft.com.br>
 <32a5bc9e-2900-9b33-061b-e3880694b30b@measurement-factory.com>
Message-ID: <3bf3765b-7bed-a230-21da-a2cda97ca164@riosoft.com.br>

Spam detection software, running on the system "master.squid-cache.org",
has identified this incoming email as possible spam.  The original
message has been attached to this so you can view it or label
similar future email.  If you have any questions, see
the administrator of that system for details.

Content preview:  Thanks for replying. I was already following the provided
  link for reference. It seems that splicing on step2 was correct, but in fact
   there were other things that I missed. acl allowed_sites dstdomain "/etc/squid/allowed-sites.txt"
   # Creates acl containing domain names for splice. acl spliced_sites ssl::server_name
   "/etc/squid/allowed-sites.txt" http_access allow allowed [...] 

Content analysis details:   (5.6 points, 5.0 required)

 pts rule name              description
---- ---------------------- --------------------------------------------------
 3.6 RCVD_IN_PBL            RBL: Received via a relay in Spamhaus PBL
                            [171.171.0.181 listed in zen.spamhaus.org]
 1.0 SPF_SOFTFAIL           SPF: sender does not match SPF record (softfail)
 0.0 NORMAL_HTTP_TO_IP      URI: URI host has a public dotted-decimal IPv4
                             address
 0.0 NUMERIC_HTTP_ADDR      URI: Uses a numeric IP address in URL
 0.1 DKIM_SIGNED            Message has a DKIM or DK signature, not necessarily
                            valid
-0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
                            author's domain
-0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                            envelope-from domain
-0.1 DKIM_VALID             Message has at least one valid DKIM or DK signature
 1.3 RDNS_NONE              Delivered to internal network by a host with no rDNS
 0.0 UNPARSEABLE_RELAY      Informational: message has unparseable relay
                            lines
-0.0 T_SCC_BODY_TEXT_LINE   No description available.
-0.0 NICE_REPLY_A           Looks like a legit reply (A)
 0.0 NO_FM_NAME_IP_HOSTN    No From name + hostname using IP address


-------------- next part --------------
An embedded message was scrubbed...
From: Bruno de Paula Larini <bruno.larini at riosoft.com.br>
Subject: Re: [squid-users] Squid checking for both dstdomain and IP
Date: Tue, 28 Jun 2022 15:32:29 -0300
Size: 5921
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220628/febd89fa/attachment.eml>

From rousskov at measurement-factory.com  Tue Jun 28 20:05:50 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Tue, 28 Jun 2022 16:05:50 -0400
Subject: [squid-users] Squid checking for both dstdomain and IP
In-Reply-To: <3bf3765b-7bed-a230-21da-a2cda97ca164@riosoft.com.br>
References: <419c10f1-b987-68de-c968-a1507eacfc22@riosoft.com.br>
 <32a5bc9e-2900-9b33-061b-e3880694b30b@measurement-factory.com>
 <3bf3765b-7bed-a230-21da-a2cda97ca164@riosoft.com.br>
Message-ID: <7bf85b12-57e9-ab85-686d-b0341a19115f@measurement-factory.com>

On 6/28/22 14:32, Bruno de Paula Larini wrote:

> http_access allow allowed_sites
> http_access allow SSL_ports

The above rules allow abuse of sites matching allowed_sites (by proxying 
CONNECT traffic to any port on those sites). They also allow any traffic 
to SSL_ports of any site. In summary, they are not much better than 
allowing all traffic, creating an open proxy ripe for abuse.

Most likely, Squid interpretation of http_access rules significantly 
differs from yours -- you probably thought the above rules achieve some 
other (desirable) effect. You may need to start from squid.conf.default 
rules and studying how http_access rules work in Squid. Once your 
interpretation matches Squid's you can advance to dealing with SslBump 
complexities; the above problems are not even related to SslBump.

You may find the following page useful, but I realize that it has a lot 
of information irrelevant to your specific use case:
https://wiki.squid-cache.org/SquidFaq/SquidAcl


HTH,

Alex.


On 6/28/22 14:32, Bruno de Paula Larini wrote:

> I was already following the provided link for reference.
> It seems that splicing on step2 was correct, but in fact there were other things that I missed.
> 
> acl allowed_sites dstdomain "/etc/squid/allowed-sites.txt"
> # Creates acl containing domain names for splice.
> acl spliced_sites ssl::server_name "/etc/squid/allowed-sites.txt"
> http_access allow allowed_sites
> # This eliminates the browser error containing the IP from the website.
> # >> I don't know if there are caveats for allowing free access to SSL_ports. <<
> http_access allow SSL_ports
> 
> acl step1 at_step SslBump1
> acl step2 at_step SslBump2
> 
> ssl_bump peek step1
> ssl_bump splice step2 spliced_sites
> # Same effect of 'deny all' for https websites.
> ssl_bump terminate all
> ...
> 
> *Apparently* that does it.
> If I stated anything wrong, please correct me.
> 
> Cheers.
> 
> 
> Em 28/06/2022 10:52, Alex Rousskov escreveu:
>> On 6/28/22 08:08, Bruno de Paula Larini wrote:
>>
>>> I have a pretty simple configuration for website filtering (intercepted) and ssl_bump, which follows below.
>>> However, for some reason, it seems Squid resolves the website domain address, then uses the IP to compare with the ACLs.
>>
>> Most likely, what is actually happening is that Squid does not have domain information during SslBump step1, and then gets that information during step2. Squid http_access rules apply to each SslBump step, so you have to write them accordingly.
>>
>> Available to Squid information and expected Squid behavior is documented for each step at the following wiki page. There are bugs in that algorithm _implementation_, but they are being fixed, and I am not aware of better docs: https://wiki.squid-cache.org/Features/SslPeekAndSplice#Processing_steps
>>
>>
>> HTH,
>>
>> Alex.
>>
>>
>>> As the IP is not included in the ACL, the access to the website is denied.
>>> Before that, it already checked for the domain name. I can tell based on the error from the browser.
>>> I'm using Squid version 5.5.
>>>
>>> For example, while trying to open https://repo.maven.apache.org/ (included in the allowed sites), the browser shows the error:
>>>
>>>      The following error was encountered while trying to retrieve the URL: https://199.232.192.215/*
>>>
>>>      Access Denied.
>>>
>>> If I replace 'deny all' with 'allow all', the website will open as expected.
>>> Is there something wrong with my config? I have something similar running and working on version 4.4 (unless I'm missing something).
>>> I'm still only splicing for now.
>>>
>>> Thanks for the help!
>>>
>>>
>>> ### SQUID.CONF
>>> ...
>>> #
>>> # INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
>>> #
>>>
>>> acl allowed_sites dstdomain "/etc/squid/allowed-sites.txt"
>>> http_access allow allowed_sites
>>>
>>> acl step1 at_step SslBump1
>>> ssl_bump peek step1
>>> ssl_bump splice all
>>>
>>> tls_outgoing_options capath=/etc/pki/tls/certs options=ALL
>>>
>>> sslcrtd_program /usr/lib64/squid/security_file_certgen -s /var/lib/squid/ssl_db -M 8MB
>>> sslcrtd_children 3
>>>
>>> http_access allow localhost
>>>
>>> # And finally deny all other access to this proxy
>>> http_access deny all
>>>
>>> # Squid normally listens to port 3128
>>> http_port 192.168.10.10:8080
>>> http_port 192.168.10.10:3128 intercept
>>> https_port 192.168.10.10:3129 tls-cert=/etc/squid/ssl/squidCA.pem tls-key=/etc/squid/ssl/squidCA.key ssl-bump intercept generate-host-certificates=on dynamic_cert_mem_cache_size=8MB
>>> ...
>>>
>>> ### IPTABLES
>>> ...
>>> iptables -t nat -A PREROUTING -i eth0 -s 192.168.10.0/24 -p tcp --dport 80 -j REDIRECT --to-port 3128
>>> iptables -t nat -A PREROUTING -i eth0 -s 192.168.10.0/24 -p tcp --dport 443 -j REDIRECT --to-port 3129
>>> ... 



From bruno.larini at riosoft.com.br  Wed Jun 29 15:22:10 2022
From: bruno.larini at riosoft.com.br (Bruno de Paula Larini)
Date: Wed, 29 Jun 2022 12:22:10 -0300
Subject: [squid-users] Squid checking for both dstdomain and IP
In-Reply-To: <7bf85b12-57e9-ab85-686d-b0341a19115f@measurement-factory.com>
References: <419c10f1-b987-68de-c968-a1507eacfc22@riosoft.com.br>
 <32a5bc9e-2900-9b33-061b-e3880694b30b@measurement-factory.com>
 <3bf3765b-7bed-a230-21da-a2cda97ca164@riosoft.com.br>
 <7bf85b12-57e9-ab85-686d-b0341a19115f@measurement-factory.com>
Message-ID: <f393fa2b-842e-7b62-d2fb-7380640f5684@riosoft.com.br>


> The above rules allow abuse of sites matching allowed_sites (by 
> proxying CONNECT traffic to any port on those sites).

Ok, maybe I'm lost. Any material on the internet I've read about writing 
ACLs to allow access on Squid, including the Squid website, follows the 
basic structure:
 ??? acl rule_name dstdomain "/path/to/file"
 ??? http_access allow rule_name
Which is exactly what I posted. Is there something wrong with that?

In fact, I forgot to tell what is my objective in the first post: allow 
access to some selected websites and deny all the rest. Simple as that.

> They also allow any traffic to SSL_ports of any site. In summary, they 
> are not much better than allowing all traffic, creating an open proxy 
> ripe for abuse.

I did mention I was unsure about allowing free access to SSL_ports, 
which in my case is only 443 itself.

But my reasoning behind that (and I'm probably wrong) is that only the 
allowed sites would be permitted access, then "ssl_bump terminate all" 
after splicing step2 would block other CONNECT attempts.
In local tests it *apparently* worked as expected. But I really am 
uncertain if that's just wrong for what I'm trying to achieve.

Assuming 'http_access allow SSL_ports' is wrong, removing it takes me 
back to the original problem:

 ???? The following error was encountered while trying to retrieve the 
URL: https://<ip_address>/*

 ???? Access Denied.

even if the 'dstdomain' hosted on that IP is allowed by the ACL.

Based on the provided documentation, I understand that is in step2 that 
the Client Hello shows more information regarding the server name, I 
tried peeking and then splicing on step3 but that also didn't help.

I'll put the full config here so anyone willing to help can better 
understand it.

Thanks!

### SQUID.CONF
#
# Recommended minimum configuration:
#

# Example rule allowing access from your local networks.
# Adapt to list your (internal) IP networks from where browsing
# should be allowed
acl localnet src 0.0.0.1-0.255.255.255? # RFC 1122 "this" network (LAN)
acl localnet src 10.0.0.0/8???????????? # RFC 1918 local private network 
(LAN)
acl localnet src 100.64.0.0/10????????? # RFC 6598 shared address space 
(CGN)
acl localnet src 169.254.0.0/16???????? # RFC 3927 link-local (directly 
plugged) machines
acl localnet src 172.16.0.0/12????????? # RFC 1918 local private network 
(LAN)
acl localnet src 192.168.0.0/16???????? # RFC 1918 local private network 
(LAN)
acl localnet src fc00::/7?????????????? # RFC 4193 local private network 
range
acl localnet src fe80::/10????????????? # RFC 4291 link-local (directly 
plugged) machines

acl SSL_ports port 443
acl Safe_ports port 80????????? # http
acl Safe_ports port 21????????? # ftp
acl Safe_ports port 443???????? # https
acl Safe_ports port 70????????? # gopher
acl Safe_ports port 210???????? # wais
acl Safe_ports port 1025-65535? # unregistered ports
acl Safe_ports port 280???????? # http-mgmt
acl Safe_ports port 488???????? # gss-http
acl Safe_ports port 591???????? # filemaker
acl Safe_ports port 777???????? # multiling http

#
# Recommended minimum Access Permission configuration:
#
# Deny requests to certain unsafe ports
http_access deny !Safe_ports

# Deny CONNECT to other than secure SSL ports
http_access deny CONNECT !SSL_ports
# Only allow cachemgr access from localhost
http_access allow localhost manager
http_access deny manager

# We strongly recommend the following be uncommented to protect innocent
# web applications running on the proxy server who think the only
# one who can access services on "localhost" is a local user
http_access deny to_localhost

#
# INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
#

debug_options ALL,0
access_log /var/log/squid/access.log

acl allowed_sites dstdomain "/etc/squid/allowed-sites.txt"
acl spliced_sites ssl::server_name "/etc/squid/allowed-sites.txt"
http_access allow allowed_sites
# This probably should be removed, but it's making it work for this test.
http_access allow SSL_ports

acl step1 at_step SslBump1
acl step2 at_step SslBump2
ssl_bump peek step1 all
ssl_bump splice step2 spliced_sites
ssl_bump terminate all

tls_outgoing_options capath=/etc/pki/tls/certs options=ALL
sslcrtd_program /usr/lib64/squid/security_file_certgen -s 
/var/lib/squid/ssl_db -M 8MB
sslcrtd_children 3

#
#=============
#

# Example rule allowing access from your local networks.
# Adapt localnet in the ACL section to list your (internal) IP networks
# from where browsing should be allowed
http_access allow localhost

# And finally deny all other access to this proxy
http_access deny all

# Squid normally listens to port 3128
http_port 192.168.10.10:8080
http_port 192.168.10.10:3128 intercept
https_port 192.168.10.10:3129 tls-cert=/etc/squid/ssl/squidCA.pem 
tls-key=/etc/squid/ssl/squidCA.key ssl-bump intercept 
generate-host-certificates=on dynamic_cert_mem_cache_size=8MB

# Uncomment and adjust the following to add a disk cache directory.
#cache_dir ufs /var/spool/squid 100 16 256

# Leave coredumps in the first cache dir
coredump_dir /var/spool/squid

#
# Add any of your own refresh_pattern entries above these.
#
refresh_pattern ^ftp:?????????? 1440??? 20%???? 10080
refresh_pattern ^gopher:??????? 1440??? 0%????? 1440
refresh_pattern -i (/cgi-bin/|\?) 0???? 0%????? 0
refresh_pattern .?????????????? 0?????? 20%???? 4320


Em 28/06/2022 17:05, Alex Rousskov escreveu:
> On 6/28/22 14:32, Bruno de Paula Larini wrote:
>
>> http_access allow allowed_sites
>> http_access allow SSL_ports
>
> The above rules allow abuse of sites matching allowed_sites (by 
> proxying CONNECT traffic to any port on those sites). They also allow 
> any traffic to SSL_ports of any site. In summary, they are not much 
> better than allowing all traffic, creating an open proxy ripe for abuse.
>
> Most likely, Squid interpretation of http_access rules significantly 
> differs from yours -- you probably thought the above rules achieve 
> some other (desirable) effect. You may need to start from 
> squid.conf.default rules and studying how http_access rules work in 
> Squid. Once your interpretation matches Squid's you can advance to 
> dealing with SslBump complexities; the above problems are not even 
> related to SslBump.
>
> You may find the following page useful, but I realize that it has a 
> lot of information irrelevant to your specific use case:
> https://wiki.squid-cache.org/SquidFaq/SquidAcl
>
>
> HTH,
>
> Alex.
>
>
> On 6/28/22 14:32, Bruno de Paula Larini wrote:
>
>> I was already following the provided link for reference.
>> It seems that splicing on step2 was correct, but in fact there were 
>> other things that I missed.
>>
>> acl allowed_sites dstdomain "/etc/squid/allowed-sites.txt"
>> # Creates acl containing domain names for splice.
>> acl spliced_sites ssl::server_name "/etc/squid/allowed-sites.txt"
>> http_access allow allowed_sites
>> # This eliminates the browser error containing the IP from the website.
>> # >> I don't know if there are caveats for allowing free access to 
>> SSL_ports. <<
>> http_access allow SSL_ports
>>
>> acl step1 at_step SslBump1
>> acl step2 at_step SslBump2
>>
>> ssl_bump peek step1
>> ssl_bump splice step2 spliced_sites
>> # Same effect of 'deny all' for https websites.
>> ssl_bump terminate all
>> ...
>>
>> *Apparently* that does it.
>> If I stated anything wrong, please correct me.
>>
>> Cheers.
>>
>>
>> Em 28/06/2022 10:52, Alex Rousskov escreveu:
>>> On 6/28/22 08:08, Bruno de Paula Larini wrote:
>>>
>>>> I have a pretty simple configuration for website filtering 
>>>> (intercepted) and ssl_bump, which follows below.
>>>> However, for some reason, it seems Squid resolves the website 
>>>> domain address, then uses the IP to compare with the ACLs.
>>>
>>> Most likely, what is actually happening is that Squid does not have 
>>> domain information during SslBump step1, and then gets that 
>>> information during step2. Squid http_access rules apply to each 
>>> SslBump step, so you have to write them accordingly.
>>>
>>> Available to Squid information and expected Squid behavior is 
>>> documented for each step at the following wiki page. There are bugs 
>>> in that algorithm _implementation_, but they are being fixed, and I 
>>> am not aware of better docs: 
>>> https://wiki.squid-cache.org/Features/SslPeekAndSplice#Processing_steps
>>>
>>>
>>> HTH,
>>>
>>> Alex.
>>>
>>>
>>>> As the IP is not included in the ACL, the access to the website is 
>>>> denied.
>>>> Before that, it already checked for the domain name. I can tell 
>>>> based on the error from the browser.
>>>> I'm using Squid version 5.5.
>>>>
>>>> For example, while trying to open https://repo.maven.apache.org/ 
>>>> (included in the allowed sites), the browser shows the error:
>>>>
>>>> ???? The following error was encountered while trying to retrieve 
>>>> the URL: https://199.232.192.215/*
>>>>
>>>> ???? Access Denied.
>>>>
>>>> If I replace 'deny all' with 'allow all', the website will open as 
>>>> expected.
>>>> Is there something wrong with my config? I have something similar 
>>>> running and working on version 4.4 (unless I'm missing something).
>>>> I'm still only splicing for now.
>>>>
>>>> Thanks for the help!
>>>>
>>>>
>>>> ### SQUID.CONF
>>>> ...
>>>> #
>>>> # INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
>>>> #
>>>>
>>>> acl allowed_sites dstdomain "/etc/squid/allowed-sites.txt"
>>>> http_access allow allowed_sites
>>>>
>>>> acl step1 at_step SslBump1
>>>> ssl_bump peek step1
>>>> ssl_bump splice all
>>>>
>>>> tls_outgoing_options capath=/etc/pki/tls/certs options=ALL
>>>>
>>>> sslcrtd_program /usr/lib64/squid/security_file_certgen -s 
>>>> /var/lib/squid/ssl_db -M 8MB
>>>> sslcrtd_children 3
>>>>
>>>> http_access allow localhost
>>>>
>>>> # And finally deny all other access to this proxy
>>>> http_access deny all
>>>>
>>>> # Squid normally listens to port 3128
>>>> http_port 192.168.10.10:8080
>>>> http_port 192.168.10.10:3128 intercept
>>>> https_port 192.168.10.10:3129 tls-cert=/etc/squid/ssl/squidCA.pem 
>>>> tls-key=/etc/squid/ssl/squidCA.key ssl-bump intercept 
>>>> generate-host-certificates=on dynamic_cert_mem_cache_size=8MB
>>>> ...
>>>>
>>>> ### IPTABLES
>>>> ...
>>>> iptables -t nat -A PREROUTING -i eth0 -s 192.168.10.0/24 -p tcp 
>>>> --dport 80 -j REDIRECT --to-port 3128
>>>> iptables -t nat -A PREROUTING -i eth0 -s 192.168.10.0/24 -p tcp 
>>>> --dport 443 -j REDIRECT --to-port 3129
>>>> ... 
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>



From rousskov at measurement-factory.com  Wed Jun 29 15:57:22 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Wed, 29 Jun 2022 11:57:22 -0400
Subject: [squid-users] Squid checking for both dstdomain and IP
In-Reply-To: <f393fa2b-842e-7b62-d2fb-7380640f5684@riosoft.com.br>
References: <419c10f1-b987-68de-c968-a1507eacfc22@riosoft.com.br>
 <32a5bc9e-2900-9b33-061b-e3880694b30b@measurement-factory.com>
 <3bf3765b-7bed-a230-21da-a2cda97ca164@riosoft.com.br>
 <7bf85b12-57e9-ab85-686d-b0341a19115f@measurement-factory.com>
 <f393fa2b-842e-7b62-d2fb-7380640f5684@riosoft.com.br>
Message-ID: <3e2cc675-bd59-444a-4c9d-1bb1083b1297@measurement-factory.com>

On 6/29/22 11:22, Bruno de Paula Larini wrote:
>> The above rules allow abuse of sites matching allowed_sites (by 
>> proxying CONNECT traffic to any port on those sites).

> Ok, maybe I'm lost. Any material on the internet I've read about writing 
> ACLs to allow access on Squid, including the Squid website, follows the 
> basic structure:
>  ??? acl rule_name dstdomain "/path/to/file"
>  ??? http_access allow rule_name
> Which is exactly what I posted. Is there something wrong with that?

You need to look at the http_access configuration as a whole. There may 
be nothing wrong with each http_access rule in isolation while the 
configuration is completely broken. For example, the following two 
configurations use identical set of rules. However, only one of them is 
correct:

     http_access allow goodRequests
     http_access deny all

     http_access deny all
     http_access allow goodRequests

Your previous email did not contain critical http_access rules in your 
configuration, and I incorrectly assumed that you have no other 
http_access rules. Thank you for correcting that mistake:


> http_access deny !Safe_ports
> http_access deny CONNECT !SSL_ports
> 
> http_access allow localhost manager
> http_access deny manager
> 
> http_access deny to_localhost
 >
> http_access allow allowed_sites
> http_access allow SSL_ports
 >
> http_access allow localhost
> 
> http_access deny all

AFAICT, the above is your current http_access configuration. One of the 
(potential) problems I see is that you allow CONNECT tunnels to SSL 
ports of not-allowed sites.


> But my reasoning behind that (and I'm probably wrong) is that only the 
> allowed sites would be permitted access, then "ssl_bump terminate all" 
> after splicing step2 would block other CONNECT attempts.

I do not recommend (ab)using ssl_bump rules for access control. When 
things go wrong, and they will, Squid may not reach your "ssl_bump 
terminate all" rule. Unlike http_access which is evaluated for virtually 
all incoming traffic, Squid evaluates ssl_bump rules only in some 
specific circumstances.


> In local tests it *apparently* worked as expected.

Have you tested attacking your Squid with an (intercepted) TLS 
connection that goes to a prohibited server but contains an allowed site 
name in TLS SNI? AFAICT, Squid will allow and tunnel that connection. 
However, perhaps you do not consider this a valid attack in your 
environment.


> But I really am 
> uncertain if that's just wrong for what I'm trying to achieve.

No, your overall goals are reasonable/common.


HTH,

Alex.


> Assuming 'http_access allow SSL_ports' is wrong, removing it takes me 
> back to the original problem:
> 
>  ???? The following error was encountered while trying to retrieve the 
> URL: https://<ip_address>/*
> 
>  ???? Access Denied.
> 
> even if the 'dstdomain' hosted on that IP is allowed by the ACL.
> 
> Based on the provided documentation, I understand that is in step2 that 
> the Client Hello shows more information regarding the server name, I 
> tried peeking and then splicing on step3 but that also didn't help.
> 
> I'll put the full config here so anyone willing to help can better 
> understand it.
> 
> Thanks!
> 
> ### SQUID.CONF
> #
> # Recommended minimum configuration:
> #
> 
> # Example rule allowing access from your local networks.
> # Adapt to list your (internal) IP networks from where browsing
> # should be allowed
> acl localnet src 0.0.0.1-0.255.255.255? # RFC 1122 "this" network (LAN)
> acl localnet src 10.0.0.0/8???????????? # RFC 1918 local private network 
> (LAN)
> acl localnet src 100.64.0.0/10????????? # RFC 6598 shared address space 
> (CGN)
> acl localnet src 169.254.0.0/16???????? # RFC 3927 link-local (directly 
> plugged) machines
> acl localnet src 172.16.0.0/12????????? # RFC 1918 local private network 
> (LAN)
> acl localnet src 192.168.0.0/16???????? # RFC 1918 local private network 
> (LAN)
> acl localnet src fc00::/7?????????????? # RFC 4193 local private network 
> range
> acl localnet src fe80::/10????????????? # RFC 4291 link-local (directly 
> plugged) machines
> 
> acl SSL_ports port 443
> acl Safe_ports port 80????????? # http
> acl Safe_ports port 21????????? # ftp
> acl Safe_ports port 443???????? # https
> acl Safe_ports port 70????????? # gopher
> acl Safe_ports port 210???????? # wais
> acl Safe_ports port 1025-65535? # unregistered ports
> acl Safe_ports port 280???????? # http-mgmt
> acl Safe_ports port 488???????? # gss-http
> acl Safe_ports port 591???????? # filemaker
> acl Safe_ports port 777???????? # multiling http
> 
> #
> # Recommended minimum Access Permission configuration:
> #
> # Deny requests to certain unsafe ports
> http_access deny !Safe_ports
> 
> # Deny CONNECT to other than secure SSL ports
> http_access deny CONNECT !SSL_ports
> # Only allow cachemgr access from localhost
> http_access allow localhost manager
> http_access deny manager
> 
> # We strongly recommend the following be uncommented to protect innocent
> # web applications running on the proxy server who think the only
> # one who can access services on "localhost" is a local user
> http_access deny to_localhost
> 
> #
> # INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
> #
> 
> debug_options ALL,0
> access_log /var/log/squid/access.log
> 
> acl allowed_sites dstdomain "/etc/squid/allowed-sites.txt"
> acl spliced_sites ssl::server_name "/etc/squid/allowed-sites.txt"
> http_access allow allowed_sites
> # This probably should be removed, but it's making it work for this test.
> http_access allow SSL_ports
> 
> acl step1 at_step SslBump1
> acl step2 at_step SslBump2
> ssl_bump peek step1 all
> ssl_bump splice step2 spliced_sites
> ssl_bump terminate all
> 
> tls_outgoing_options capath=/etc/pki/tls/certs options=ALL
> sslcrtd_program /usr/lib64/squid/security_file_certgen -s 
> /var/lib/squid/ssl_db -M 8MB
> sslcrtd_children 3
> 
> #
> #=============
> #
> 
> # Example rule allowing access from your local networks.
> # Adapt localnet in the ACL section to list your (internal) IP networks
> # from where browsing should be allowed
> http_access allow localhost
> 
> # And finally deny all other access to this proxy
> http_access deny all
> 
> # Squid normally listens to port 3128
> http_port 192.168.10.10:8080
> http_port 192.168.10.10:3128 intercept
> https_port 192.168.10.10:3129 tls-cert=/etc/squid/ssl/squidCA.pem 
> tls-key=/etc/squid/ssl/squidCA.key ssl-bump intercept 
> generate-host-certificates=on dynamic_cert_mem_cache_size=8MB
> 
> # Uncomment and adjust the following to add a disk cache directory.
> #cache_dir ufs /var/spool/squid 100 16 256
> 
> # Leave coredumps in the first cache dir
> coredump_dir /var/spool/squid
> 
> #
> # Add any of your own refresh_pattern entries above these.
> #
> refresh_pattern ^ftp:?????????? 1440??? 20%???? 10080
> refresh_pattern ^gopher:??????? 1440??? 0%????? 1440
> refresh_pattern -i (/cgi-bin/|\?) 0???? 0%????? 0
> refresh_pattern .?????????????? 0?????? 20%???? 4320
> 
> 
> Em 28/06/2022 17:05, Alex Rousskov escreveu:
>> On 6/28/22 14:32, Bruno de Paula Larini wrote:
>>
>>> http_access allow allowed_sites
>>> http_access allow SSL_ports
>>
>> The above rules allow abuse of sites matching allowed_sites (by 
>> proxying CONNECT traffic to any port on those sites). They also allow 
>> any traffic to SSL_ports of any site. In summary, they are not much 
>> better than allowing all traffic, creating an open proxy ripe for abuse.
>>
>> Most likely, Squid interpretation of http_access rules significantly 
>> differs from yours -- you probably thought the above rules achieve 
>> some other (desirable) effect. You may need to start from 
>> squid.conf.default rules and studying how http_access rules work in 
>> Squid. Once your interpretation matches Squid's you can advance to 
>> dealing with SslBump complexities; the above problems are not even 
>> related to SslBump.
>>
>> You may find the following page useful, but I realize that it has a 
>> lot of information irrelevant to your specific use case:
>> https://wiki.squid-cache.org/SquidFaq/SquidAcl
>>
>>
>> HTH,
>>
>> Alex.
>>
>>
>> On 6/28/22 14:32, Bruno de Paula Larini wrote:
>>
>>> I was already following the provided link for reference.
>>> It seems that splicing on step2 was correct, but in fact there were 
>>> other things that I missed.
>>>
>>> acl allowed_sites dstdomain "/etc/squid/allowed-sites.txt"
>>> # Creates acl containing domain names for splice.
>>> acl spliced_sites ssl::server_name "/etc/squid/allowed-sites.txt"
>>> http_access allow allowed_sites
>>> # This eliminates the browser error containing the IP from the website.
>>> # >> I don't know if there are caveats for allowing free access to 
>>> SSL_ports. <<
>>> http_access allow SSL_ports
>>>
>>> acl step1 at_step SslBump1
>>> acl step2 at_step SslBump2
>>>
>>> ssl_bump peek step1
>>> ssl_bump splice step2 spliced_sites
>>> # Same effect of 'deny all' for https websites.
>>> ssl_bump terminate all
>>> ...
>>>
>>> *Apparently* that does it.
>>> If I stated anything wrong, please correct me.
>>>
>>> Cheers.
>>>
>>>
>>> Em 28/06/2022 10:52, Alex Rousskov escreveu:
>>>> On 6/28/22 08:08, Bruno de Paula Larini wrote:
>>>>
>>>>> I have a pretty simple configuration for website filtering 
>>>>> (intercepted) and ssl_bump, which follows below.
>>>>> However, for some reason, it seems Squid resolves the website 
>>>>> domain address, then uses the IP to compare with the ACLs.
>>>>
>>>> Most likely, what is actually happening is that Squid does not have 
>>>> domain information during SslBump step1, and then gets that 
>>>> information during step2. Squid http_access rules apply to each 
>>>> SslBump step, so you have to write them accordingly.
>>>>
>>>> Available to Squid information and expected Squid behavior is 
>>>> documented for each step at the following wiki page. There are bugs 
>>>> in that algorithm _implementation_, but they are being fixed, and I 
>>>> am not aware of better docs: 
>>>> https://wiki.squid-cache.org/Features/SslPeekAndSplice#Processing_steps
>>>>
>>>>
>>>> HTH,
>>>>
>>>> Alex.
>>>>
>>>>
>>>>> As the IP is not included in the ACL, the access to the website is 
>>>>> denied.
>>>>> Before that, it already checked for the domain name. I can tell 
>>>>> based on the error from the browser.
>>>>> I'm using Squid version 5.5.
>>>>>
>>>>> For example, while trying to open https://repo.maven.apache.org/ 
>>>>> (included in the allowed sites), the browser shows the error:
>>>>>
>>>>> ???? The following error was encountered while trying to retrieve 
>>>>> the URL: https://199.232.192.215/*
>>>>>
>>>>> ???? Access Denied.
>>>>>
>>>>> If I replace 'deny all' with 'allow all', the website will open as 
>>>>> expected.
>>>>> Is there something wrong with my config? I have something similar 
>>>>> running and working on version 4.4 (unless I'm missing something).
>>>>> I'm still only splicing for now.
>>>>>
>>>>> Thanks for the help!
>>>>>
>>>>>
>>>>> ### SQUID.CONF
>>>>> ...
>>>>> #
>>>>> # INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
>>>>> #
>>>>>
>>>>> acl allowed_sites dstdomain "/etc/squid/allowed-sites.txt"
>>>>> http_access allow allowed_sites
>>>>>
>>>>> acl step1 at_step SslBump1
>>>>> ssl_bump peek step1
>>>>> ssl_bump splice all
>>>>>
>>>>> tls_outgoing_options capath=/etc/pki/tls/certs options=ALL
>>>>>
>>>>> sslcrtd_program /usr/lib64/squid/security_file_certgen -s 
>>>>> /var/lib/squid/ssl_db -M 8MB
>>>>> sslcrtd_children 3
>>>>>
>>>>> http_access allow localhost
>>>>>
>>>>> # And finally deny all other access to this proxy
>>>>> http_access deny all
>>>>>
>>>>> # Squid normally listens to port 3128
>>>>> http_port 192.168.10.10:8080
>>>>> http_port 192.168.10.10:3128 intercept
>>>>> https_port 192.168.10.10:3129 tls-cert=/etc/squid/ssl/squidCA.pem 
>>>>> tls-key=/etc/squid/ssl/squidCA.key ssl-bump intercept 
>>>>> generate-host-certificates=on dynamic_cert_mem_cache_size=8MB
>>>>> ...
>>>>>
>>>>> ### IPTABLES
>>>>> ...
>>>>> iptables -t nat -A PREROUTING -i eth0 -s 192.168.10.0/24 -p tcp 
>>>>> --dport 80 -j REDIRECT --to-port 3128
>>>>> iptables -t nat -A PREROUTING -i eth0 -s 192.168.10.0/24 -p tcp 
>>>>> --dport 443 -j REDIRECT --to-port 3129
>>>>> ... 
>>
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
>>
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



From bruno.larini at riosoft.com.br  Wed Jun 29 18:29:34 2022
From: bruno.larini at riosoft.com.br (Bruno de Paula Larini)
Date: Wed, 29 Jun 2022 15:29:34 -0300
Subject: [squid-users] Squid checking for both dstdomain and IP
In-Reply-To: <3e2cc675-bd59-444a-4c9d-1bb1083b1297@measurement-factory.com>
References: <419c10f1-b987-68de-c968-a1507eacfc22@riosoft.com.br>
 <32a5bc9e-2900-9b33-061b-e3880694b30b@measurement-factory.com>
 <3bf3765b-7bed-a230-21da-a2cda97ca164@riosoft.com.br>
 <7bf85b12-57e9-ab85-686d-b0341a19115f@measurement-factory.com>
 <f393fa2b-842e-7b62-d2fb-7380640f5684@riosoft.com.br>
 <3e2cc675-bd59-444a-4c9d-1bb1083b1297@measurement-factory.com>
Message-ID: <e512f9f5-de19-5498-164d-78cf63ef61bc@riosoft.com.br>


> I do not recommend (ab)using ssl_bump rules for access control. When 
> things go wrong, and they will, Squid may not reach your "ssl_bump 
> terminate all" rule. Unlike http_access which is evaluated for 
> virtually all incoming traffic, Squid evaluates ssl_bump rules only in 
> some specific circumstances.

Is there a recommended way to deal with filtering in intercepted https 
connections ? Or that's what Squid is able to do at the present?
(I'm guessing if there was, you already would have said it)
All reading material I was able to find on searches around the web 
suggest using similar configurations.

Your explanation really helped me have a better understanding on how it 
works though.
Thanks a lot.


Em 29/06/2022 12:57, Alex Rousskov escreveu:
> On 6/29/22 11:22, Bruno de Paula Larini wrote:
>>> The above rules allow abuse of sites matching allowed_sites (by 
>>> proxying CONNECT traffic to any port on those sites).
>
>> Ok, maybe I'm lost. Any material on the internet I've read about 
>> writing ACLs to allow access on Squid, including the Squid website, 
>> follows the basic structure:
>> ???? acl rule_name dstdomain "/path/to/file"
>> ???? http_access allow rule_name
>> Which is exactly what I posted. Is there something wrong with that?
>
> You need to look at the http_access configuration as a whole. There 
> may be nothing wrong with each http_access rule in isolation while the 
> configuration is completely broken. For example, the following two 
> configurations use identical set of rules. However, only one of them 
> is correct:
>
> ??? http_access allow goodRequests
> ??? http_access deny all
>
> ??? http_access deny all
> ??? http_access allow goodRequests
>
> Your previous email did not contain critical http_access rules in your 
> configuration, and I incorrectly assumed that you have no other 
> http_access rules. Thank you for correcting that mistake:
>
>
>> http_access deny !Safe_ports
>> http_access deny CONNECT !SSL_ports
>>
>> http_access allow localhost manager
>> http_access deny manager
>>
>> http_access deny to_localhost
> >
>> http_access allow allowed_sites
>> http_access allow SSL_ports
> >
>> http_access allow localhost
>>
>> http_access deny all
>
> AFAICT, the above is your current http_access configuration. One of 
> the (potential) problems I see is that you allow CONNECT tunnels to 
> SSL ports of not-allowed sites.
>
>
>> But my reasoning behind that (and I'm probably wrong) is that only 
>> the allowed sites would be permitted access, then "ssl_bump terminate 
>> all" after splicing step2 would block other CONNECT attempts.
>
> I do not recommend (ab)using ssl_bump rules for access control. When 
> things go wrong, and they will, Squid may not reach your "ssl_bump 
> terminate all" rule. Unlike http_access which is evaluated for 
> virtually all incoming traffic, Squid evaluates ssl_bump rules only in 
> some specific circumstances.
>
>
>> In local tests it *apparently* worked as expected.
>
> Have you tested attacking your Squid with an (intercepted) TLS 
> connection that goes to a prohibited server but contains an allowed 
> site name in TLS SNI? AFAICT, Squid will allow and tunnel that 
> connection. However, perhaps you do not consider this a valid attack 
> in your environment.
>
>
>> But I really am uncertain if that's just wrong for what I'm trying to 
>> achieve.
>
> No, your overall goals are reasonable/common.
>
>
> HTH,
>
> Alex.
>
>
>> Assuming 'http_access allow SSL_ports' is wrong, removing it takes me 
>> back to the original problem:
>>
>> ????? The following error was encountered while trying to retrieve 
>> the URL: https://<ip_address>/*
>>
>> ????? Access Denied.
>>
>> even if the 'dstdomain' hosted on that IP is allowed by the ACL.
>>
>> Based on the provided documentation, I understand that is in step2 
>> that the Client Hello shows more information regarding the server 
>> name, I tried peeking and then splicing on step3 but that also didn't 
>> help.
>>
>> I'll put the full config here so anyone willing to help can better 
>> understand it.
>>
>> Thanks!
>>
>> ### SQUID.CONF
>> #
>> # Recommended minimum configuration:
>> #
>>
>> # Example rule allowing access from your local networks.
>> # Adapt to list your (internal) IP networks from where browsing
>> # should be allowed
>> acl localnet src 0.0.0.1-0.255.255.255? # RFC 1122 "this" network (LAN)
>> acl localnet src 10.0.0.0/8???????????? # RFC 1918 local private 
>> network (LAN)
>> acl localnet src 100.64.0.0/10????????? # RFC 6598 shared address 
>> space (CGN)
>> acl localnet src 169.254.0.0/16???????? # RFC 3927 link-local 
>> (directly plugged) machines
>> acl localnet src 172.16.0.0/12????????? # RFC 1918 local private 
>> network (LAN)
>> acl localnet src 192.168.0.0/16???????? # RFC 1918 local private 
>> network (LAN)
>> acl localnet src fc00::/7?????????????? # RFC 4193 local private 
>> network range
>> acl localnet src fe80::/10????????????? # RFC 4291 link-local 
>> (directly plugged) machines
>>
>> acl SSL_ports port 443
>> acl Safe_ports port 80????????? # http
>> acl Safe_ports port 21????????? # ftp
>> acl Safe_ports port 443???????? # https
>> acl Safe_ports port 70????????? # gopher
>> acl Safe_ports port 210???????? # wais
>> acl Safe_ports port 1025-65535? # unregistered ports
>> acl Safe_ports port 280???????? # http-mgmt
>> acl Safe_ports port 488???????? # gss-http
>> acl Safe_ports port 591???????? # filemaker
>> acl Safe_ports port 777???????? # multiling http
>>
>> #
>> # Recommended minimum Access Permission configuration:
>> #
>> # Deny requests to certain unsafe ports
>> http_access deny !Safe_ports
>>
>> # Deny CONNECT to other than secure SSL ports
>> http_access deny CONNECT !SSL_ports
>> # Only allow cachemgr access from localhost
>> http_access allow localhost manager
>> http_access deny manager
>>
>> # We strongly recommend the following be uncommented to protect innocent
>> # web applications running on the proxy server who think the only
>> # one who can access services on "localhost" is a local user
>> http_access deny to_localhost
>>
>> #
>> # INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
>> #
>>
>> debug_options ALL,0
>> access_log /var/log/squid/access.log
>>
>> acl allowed_sites dstdomain "/etc/squid/allowed-sites.txt"
>> acl spliced_sites ssl::server_name "/etc/squid/allowed-sites.txt"
>> http_access allow allowed_sites
>> # This probably should be removed, but it's making it work for this 
>> test.
>> http_access allow SSL_ports
>>
>> acl step1 at_step SslBump1
>> acl step2 at_step SslBump2
>> ssl_bump peek step1 all
>> ssl_bump splice step2 spliced_sites
>> ssl_bump terminate all
>>
>> tls_outgoing_options capath=/etc/pki/tls/certs options=ALL
>> sslcrtd_program /usr/lib64/squid/security_file_certgen -s 
>> /var/lib/squid/ssl_db -M 8MB
>> sslcrtd_children 3
>>
>> #
>> #=============
>> #
>>
>> # Example rule allowing access from your local networks.
>> # Adapt localnet in the ACL section to list your (internal) IP networks
>> # from where browsing should be allowed
>> http_access allow localhost
>>
>> # And finally deny all other access to this proxy
>> http_access deny all
>>
>> # Squid normally listens to port 3128
>> http_port 192.168.10.10:8080
>> http_port 192.168.10.10:3128 intercept
>> https_port 192.168.10.10:3129 tls-cert=/etc/squid/ssl/squidCA.pem 
>> tls-key=/etc/squid/ssl/squidCA.key ssl-bump intercept 
>> generate-host-certificates=on dynamic_cert_mem_cache_size=8MB
>>
>> # Uncomment and adjust the following to add a disk cache directory.
>> #cache_dir ufs /var/spool/squid 100 16 256
>>
>> # Leave coredumps in the first cache dir
>> coredump_dir /var/spool/squid
>>
>> #
>> # Add any of your own refresh_pattern entries above these.
>> #
>> refresh_pattern ^ftp:?????????? 1440??? 20%???? 10080
>> refresh_pattern ^gopher:??????? 1440??? 0%????? 1440
>> refresh_pattern -i (/cgi-bin/|\?) 0???? 0%????? 0
>> refresh_pattern .?????????????? 0?????? 20%???? 4320
>>
>>
>> Em 28/06/2022 17:05, Alex Rousskov escreveu:
>>> On 6/28/22 14:32, Bruno de Paula Larini wrote:
>>>
>>>> http_access allow allowed_sites
>>>> http_access allow SSL_ports
>>>
>>> The above rules allow abuse of sites matching allowed_sites (by 
>>> proxying CONNECT traffic to any port on those sites). They also 
>>> allow any traffic to SSL_ports of any site. In summary, they are not 
>>> much better than allowing all traffic, creating an open proxy ripe 
>>> for abuse.
>>>
>>> Most likely, Squid interpretation of http_access rules significantly 
>>> differs from yours -- you probably thought the above rules achieve 
>>> some other (desirable) effect. You may need to start from 
>>> squid.conf.default rules and studying how http_access rules work in 
>>> Squid. Once your interpretation matches Squid's you can advance to 
>>> dealing with SslBump complexities; the above problems are not even 
>>> related to SslBump.
>>>
>>> You may find the following page useful, but I realize that it has a 
>>> lot of information irrelevant to your specific use case:
>>> https://wiki.squid-cache.org/SquidFaq/SquidAcl
>>>
>>>
>>> HTH,
>>>
>>> Alex.
>>>
>>>
>>> On 6/28/22 14:32, Bruno de Paula Larini wrote:
>>>
>>>> I was already following the provided link for reference.
>>>> It seems that splicing on step2 was correct, but in fact there were 
>>>> other things that I missed.
>>>>
>>>> acl allowed_sites dstdomain "/etc/squid/allowed-sites.txt"
>>>> # Creates acl containing domain names for splice.
>>>> acl spliced_sites ssl::server_name "/etc/squid/allowed-sites.txt"
>>>> http_access allow allowed_sites
>>>> # This eliminates the browser error containing the IP from the 
>>>> website.
>>>> # >> I don't know if there are caveats for allowing free access to 
>>>> SSL_ports. <<
>>>> http_access allow SSL_ports
>>>>
>>>> acl step1 at_step SslBump1
>>>> acl step2 at_step SslBump2
>>>>
>>>> ssl_bump peek step1
>>>> ssl_bump splice step2 spliced_sites
>>>> # Same effect of 'deny all' for https websites.
>>>> ssl_bump terminate all
>>>> ...
>>>>
>>>> *Apparently* that does it.
>>>> If I stated anything wrong, please correct me.
>>>>
>>>> Cheers.
>>>>
>>>>
>>>> Em 28/06/2022 10:52, Alex Rousskov escreveu:
>>>>> On 6/28/22 08:08, Bruno de Paula Larini wrote:
>>>>>
>>>>>> I have a pretty simple configuration for website filtering 
>>>>>> (intercepted) and ssl_bump, which follows below.
>>>>>> However, for some reason, it seems Squid resolves the website 
>>>>>> domain address, then uses the IP to compare with the ACLs.
>>>>>
>>>>> Most likely, what is actually happening is that Squid does not 
>>>>> have domain information during SslBump step1, and then gets that 
>>>>> information during step2. Squid http_access rules apply to each 
>>>>> SslBump step, so you have to write them accordingly.
>>>>>
>>>>> Available to Squid information and expected Squid behavior is 
>>>>> documented for each step at the following wiki page. There are 
>>>>> bugs in that algorithm _implementation_, but they are being fixed, 
>>>>> and I am not aware of better docs: 
>>>>> https://wiki.squid-cache.org/Features/SslPeekAndSplice#Processing_steps 
>>>>>
>>>>>
>>>>>
>>>>> HTH,
>>>>>
>>>>> Alex.
>>>>>
>>>>>
>>>>>> As the IP is not included in the ACL, the access to the website 
>>>>>> is denied.
>>>>>> Before that, it already checked for the domain name. I can tell 
>>>>>> based on the error from the browser.
>>>>>> I'm using Squid version 5.5.
>>>>>>
>>>>>> For example, while trying to open https://repo.maven.apache.org/ 
>>>>>> (included in the allowed sites), the browser shows the error:
>>>>>>
>>>>>> ???? The following error was encountered while trying to retrieve 
>>>>>> the URL: https://199.232.192.215/*
>>>>>>
>>>>>> ???? Access Denied.
>>>>>>
>>>>>> If I replace 'deny all' with 'allow all', the website will open 
>>>>>> as expected.
>>>>>> Is there something wrong with my config? I have something similar 
>>>>>> running and working on version 4.4 (unless I'm missing something).
>>>>>> I'm still only splicing for now.
>>>>>>
>>>>>> Thanks for the help!
>>>>>>
>>>>>>
>>>>>> ### SQUID.CONF
>>>>>> ...
>>>>>> #
>>>>>> # INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
>>>>>> #
>>>>>>
>>>>>> acl allowed_sites dstdomain "/etc/squid/allowed-sites.txt"
>>>>>> http_access allow allowed_sites
>>>>>>
>>>>>> acl step1 at_step SslBump1
>>>>>> ssl_bump peek step1
>>>>>> ssl_bump splice all
>>>>>>
>>>>>> tls_outgoing_options capath=/etc/pki/tls/certs options=ALL
>>>>>>
>>>>>> sslcrtd_program /usr/lib64/squid/security_file_certgen -s 
>>>>>> /var/lib/squid/ssl_db -M 8MB
>>>>>> sslcrtd_children 3
>>>>>>
>>>>>> http_access allow localhost
>>>>>>
>>>>>> # And finally deny all other access to this proxy
>>>>>> http_access deny all
>>>>>>
>>>>>> # Squid normally listens to port 3128
>>>>>> http_port 192.168.10.10:8080
>>>>>> http_port 192.168.10.10:3128 intercept
>>>>>> https_port 192.168.10.10:3129 tls-cert=/etc/squid/ssl/squidCA.pem 
>>>>>> tls-key=/etc/squid/ssl/squidCA.key ssl-bump intercept 
>>>>>> generate-host-certificates=on dynamic_cert_mem_cache_size=8MB
>>>>>> ...
>>>>>>
>>>>>> ### IPTABLES
>>>>>> ...
>>>>>> iptables -t nat -A PREROUTING -i eth0 -s 192.168.10.0/24 -p tcp 
>>>>>> --dport 80 -j REDIRECT --to-port 3128
>>>>>> iptables -t nat -A PREROUTING -i eth0 -s 192.168.10.0/24 -p tcp 
>>>>>> --dport 443 -j REDIRECT --to-port 3129
>>>>>> ... 
>>>
>>> _______________________________________________
>>> squid-users mailing list
>>> squid-users at lists.squid-cache.org
>>> http://lists.squid-cache.org/listinfo/squid-users
>>>
>>
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



From lists at merit.unu.edu  Thu Jun 30 09:34:56 2022
From: lists at merit.unu.edu (mj)
Date: Thu, 30 Jun 2022 11:34:56 +0200
Subject: [squid-users] override the "combined" logformat
Message-ID: <2be55fa9-b286-d0ea-6a43-f3d47801127b@merit.unu.edu>

Hi,

We have set the following in /etc/squid/squid.conf, and it doesn't take 
effect:

> logformat combined %>a %ui %un [%{%d/%b/%Y:%H:%M:%S +0100}tl] \
> "%rm %ru HTTP/%rv" %>Hs %<st "%{Referer}>h" "%{User-Agent}>h" %Ss:%Sh "remote ip" %>a
> access_log   syslog:local2.notice combined

With the above, the defined "remote ip" %>a is NOT logged.

Changing *only* the logformat name from "combined" to "test", like:

> logformat test %>a %ui %un [%{%d/%b/%Y:%H:%M:%S +0100}tl] \
> "%rm %ru HTTP/%rv" %>Hs %<st "%{Referer}>h" "%{User-Agent}>h" %Ss:%Sh "remote ip" %>a
> access_log   syslog:local2.notice test

has the result that "remote ip" 1.2.3.4 starts appearing in the logs 
immediately.

I would like to understand why. Is it not possible to make changes to 
the "combined" log format..? Or is the fact that logs go through syslog 
causing this?

Is this expected?

This is RHEL8, with it's stock squid.

Thanks for any insights :-)

MJ


From squid3 at treenet.co.nz  Thu Jun 30 12:03:38 2022
From: squid3 at treenet.co.nz (=?UTF-8?B?4oCqQW1vcyBKZWZmcmllc+KArA==?=)
Date: Fri, 01 Jul 2022 00:03:38 +1200
Subject: [squid-users] override the "combined" logformat
References: <2be55fa9-b286-d0ea-6a43-f3d47801127b@merit.unu.edu>
Message-ID: <4vi1cp-1nvdpo-ybgnxlqd1u21mnig0lswqfkokxl3aw-2crbzho0qaaecahz2y-w0vv79-gv31oa-k56qm2-nizxbeghpvss-f82uka-f7c577aldut1-3kpxpgwe51hb-rsadnv-t7xj80oghqsd-gqa35l.1656590618774@email.android.com>

An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220701/28b4cc4d/attachment.htm>

From lists at merit.unu.edu  Thu Jun 30 12:36:14 2022
From: lists at merit.unu.edu (mj)
Date: Thu, 30 Jun 2022 14:36:14 +0200
Subject: [squid-users] override the "combined" logformat
In-Reply-To: <4vi1cp-1nvdpo-ybgnxlqd1u21mnig0lswqfkokxl3aw-2crbzho0qaaecahz2y-w0vv79-gv31oa-k56qm2-nizxbeghpvss-f82uka-f7c577aldut1-3kpxpgwe51hb-rsadnv-t7xj80oghqsd-gqa35l.1656590618774@email.android.com>
References: <2be55fa9-b286-d0ea-6a43-f3d47801127b@merit.unu.edu>
 <4vi1cp-1nvdpo-ybgnxlqd1u21mnig0lswqfkokxl3aw-2crbzho0qaaecahz2y-w0vv79-gv31oa-k56qm2-nizxbeghpvss-f82uka-f7c577aldut1-3kpxpgwe51hb-rsadnv-t7xj80oghqsd-gqa35l.1656590618774@email.android.com>
Message-ID: <d7ccc396-9512-8ba3-0dd9-27f477844973@merit.unu.edu>

Hi Amos,

So: everything works as designed :-)

Thanks for explaining!

MJ

Op 30-06-2022 om 14:03 schreef Amos Jeffries:
> The built-in log formats have a specification for what each column 
> contains and are hard coded to comply with that. You cannot "override" them.
> 
> What you should do is make up your own name for custom formats. Like you 
> did with "test".
> 
> Amos


From ngtech1ltd at gmail.com  Thu Jun 30 17:00:48 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Thu, 30 Jun 2022 20:00:48 +0300
Subject: [squid-users] the free domains blacklists are gone..
Message-ID: <010001d88ca2$f2df9840$d89ec8c0$@gmail.com>

Hey,
 
I have tried to download blacklists from couple sites that was publishing these in the past and all of them are gone.
The only free resource I have found was DNS blacklists.
 
I just wrote a dstdomain external helper that can work with a SQL DB and it seems to run pretty nice.
Until now I have tried MySQL, Maraidb, MSSQL, PostgreSQL and all of them works pretty nice.
There is an overhead in storing the data in a DB compared to a plain text file but the benefits are worth it.
 
The only lists I have found are for Pihole for example at:
https://github.com/blocklistproject/Lists
 
So now I just need to convert these to dstdomain format and it will work with Squid pretty nice.
 
Any recommendations for free lists are welcome.
 
Thanks,
Eliezer
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email:  <mailto:ngtech1ltd at gmail.com> ngtech1ltd at gmail.com
Web:  <https://ngtech.co.il/> https://ngtech.co.il/
My-Tube:  <https://tube.ngtech.co.il/> https://tube.ngtech.co.il/
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220630/aeec533c/attachment.htm>

