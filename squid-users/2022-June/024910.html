<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] WCCPV2 with fortigate ERROR: Ignoring WCCPv2 message: truncated record
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20WCCPV2%20with%20fortigate%20ERROR%3A%20Ignoring%20WCCPv2%0A%20message%3A%20truncated%20record&In-Reply-To=%3C7332cf67-5bc0-6b2a-3648-93ff7afab5a3%40articatech.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024908.html">
   <LINK REL="Next"  HREF="024911.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] WCCPV2 with fortigate ERROR: Ignoring WCCPv2 message: truncated record</H1>
    <B>David Touzeau</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20WCCPV2%20with%20fortigate%20ERROR%3A%20Ignoring%20WCCPv2%0A%20message%3A%20truncated%20record&In-Reply-To=%3C7332cf67-5bc0-6b2a-3648-93ff7afab5a3%40articatech.com%3E"
       TITLE="[squid-users] WCCPV2 with fortigate ERROR: Ignoring WCCPv2 message: truncated record">david at articatech.com
       </A><BR>
    <I>Thu Jun 23 16:11:37 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="024908.html">[squid-users] WCCPV2 with fortigate ERROR: Ignoring WCCPv2 message: truncated record
</A></li>
        <LI>Next message (by thread): <A HREF="024911.html">[squid-users] WCCPV2 with fortigate ERROR: Ignoring WCCPv2 message: truncated record
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24910">[ date ]</a>
              <a href="thread.html#24910">[ thread ]</a>
              <a href="subject.html#24910">[ subject ]</a>
              <a href="author.html#24910">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Alex,

is the v5 commit 7a73a54 already included in the latest 5.5,5.6 versions?

This is very unfortunate because WCCP is used by default by Fortinet 
firewall devices. It should be very popular.
Indeed, Fortinet is flooding the market.
I can volunteer for the funding and the necessary testing to be done.

Le 23/06/2022 &#224; 14:44, Alex Rousskov a &#233;crit&#160;:
&gt;<i> On 6/21/22 07:43, David Touzeau wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> We trying to using WCCP with Fortigate without success Squid version&#160; 
</I>&gt;&gt;<i> 5.5 always claim &quot;Ignoring WCCPv2 message: truncated record&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> What can be the cause ?
</I>&gt;<i>
</I>&gt;<i> The most likely cause are bugs in untested WCCP fixes (v5 commit 
</I>&gt;<i> 7a73a54). Dormant draft PR 970 contains unfinished fixes for the 
</I>&gt;<i> problems in that previous attempt:
</I>&gt;<i> <A HREF="https://github.com/squid-cache/squid/pull/970">https://github.com/squid-cache/squid/pull/970</A>
</I>&gt;<i>
</I>&gt;<i> IMHO, folks that need WCCP support should invest into that 
</I>&gt;<i> semi-abandoned Squid feature or risk losing it. WCCP code needs 
</I>&gt;<i> serious refactoring and proper testing. There are currently no Project 
</I>&gt;<i> volunteers that have enough resources and capabilities to do either.
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://wiki.squid-cache.org/SquidFaq/AboutSquid#How_to_add_a_new_Squid_feature.2C_enhance.2C_of_fix_something.3F">https://wiki.squid-cache.org/SquidFaq/AboutSquid#How_to_add_a_new_Squid_feature.2C_enhance.2C_of_fix_something.3F</A> 
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> HTH,
</I>&gt;<i>
</I>&gt;<i> Alex.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> We have added a service ID 80 on fortigate
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> config system wccp
</I>&gt;&gt;<i> &#160;&#160;&#160;&#160; edit &quot;80&quot;
</I>&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; set router-id 10.10.50.1
</I>&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; set group-address 0.0.0.0
</I>&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; set server-list 10.10.50.2 255.255.255.255
</I>&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; set server-type forward
</I>&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; set authentication disable
</I>&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; set forward-method GRE
</I>&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; set return-method GRE
</I>&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; set assignment-method HASH
</I>&gt;&gt;<i> &#160;&#160;&#160;&#160; next
</I>&gt;&gt;<i> end
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Squid wccp configuration
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> wccp2_router 10.10.50.1
</I>&gt;&gt;<i> wccp_version 3
</I>&gt;&gt;<i> # tested v4 do the same behavior
</I>&gt;&gt;<i> wccp2_rebuild_wait on
</I>&gt;&gt;<i> wccp2_forwarding_method gre
</I>&gt;&gt;<i> wccp2_return_method gre
</I>&gt;&gt;<i> wccp2_assignment_method hash
</I>&gt;&gt;<i> wccp2_service dynamic 80
</I>&gt;&gt;<i> wccp2_service_info 80 protocol=tcp protocol=tcp flags=src_ip_hash 
</I>&gt;&gt;<i> priority=240 ports=80,443
</I>&gt;&gt;<i> wccp2_address 0.0.0.0
</I>&gt;&gt;<i> wccp2_weight 10000
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Squid claim in debug log
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 022/06/21 13:15:38.780 kid4| 80,6| wccp2.cc(1206) wccp2HandleUdp: 
</I>&gt;&gt;<i> wccp2HandleUdp: Called.
</I>&gt;&gt;<i> 2022/06/21 13:15:38.781 kid4| 5,5| ModEpoll.cc(118) SetSelect: FD 38, 
</I>&gt;&gt;<i> type=1, handler=1, client_data=0, timeout=0
</I>&gt;&gt;<i> 2022/06/21 13:15:38.781 kid4| 80,3| wccp2.cc(1230) wccp2HandleUdp: 
</I>&gt;&gt;<i> Incoming WCCPv2 I_SEE_YOU length 112.
</I>&gt;&gt;<i> 2022/06/21 13:15:38.781 kid4| ERROR: Ignoring WCCPv2 message: 
</I>&gt;&gt;<i> truncated record
</I>&gt;&gt;<i> &#160;&#160;&#160;&#160; exception location: wccp2.cc(1133) CheckSectionLength
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> -- 
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>-- 
Technical Support
	
	
*David Touzeau*
Orgerus, Yvelines, France
*Artica Tech*

P:&#160;+33 6 58 44 69 46
www: wiki.articatech.com &lt;<A HREF="https://wiki.articatech.com">https://wiki.articatech.com</A>&gt;
www: articatech.net &lt;<A HREF="http://articatech.net">http://articatech.net</A>&gt;
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20220623/d3f3be6e/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20220623/d3f3be6e/attachment.htm</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: adLFmtGuksAZror0.jpg
Type: image/jpeg
Size: 6266 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20220623/d3f3be6e/attachment.jpg">http://lists.squid-cache.org/pipermail/squid-users/attachments/20220623/d3f3be6e/attachment.jpg</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="024908.html">[squid-users] WCCPV2 with fortigate ERROR: Ignoring WCCPv2 message: truncated record
</A></li>
	<LI>Next message (by thread): <A HREF="024911.html">[squid-users] WCCPV2 with fortigate ERROR: Ignoring WCCPv2 message: truncated record
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24910">[ date ]</a>
              <a href="thread.html#24910">[ thread ]</a>
              <a href="subject.html#24910">[ subject ]</a>
              <a href="author.html#24910">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
