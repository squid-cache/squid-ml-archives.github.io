<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] WCCPV2 with fortigate ERROR: Ignoring WCCPv2 message: truncated record
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20WCCPV2%20with%20fortigate%20ERROR%3A%20Ignoring%20WCCPv2%0A%20message%3A%20truncated%20record&In-Reply-To=%3C000701d8871e%24e8589e00%24b909da00%24%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024910.html">
   <LINK REL="Next"  HREF="024912.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] WCCPV2 with fortigate ERROR: Ignoring WCCPv2 message: truncated record</H1>
    <B>ngtech1ltd at gmail.com</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20WCCPV2%20with%20fortigate%20ERROR%3A%20Ignoring%20WCCPv2%0A%20message%3A%20truncated%20record&In-Reply-To=%3C000701d8871e%24e8589e00%24b909da00%24%40gmail.com%3E"
       TITLE="[squid-users] WCCPV2 with fortigate ERROR: Ignoring WCCPv2 message: truncated record">ngtech1ltd at gmail.com
       </A><BR>
    <I>Thu Jun 23 16:33:01 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="024910.html">[squid-users] WCCPV2 with fortigate ERROR: Ignoring WCCPv2 message: truncated record
</A></li>
        <LI>Next message (by thread): <A HREF="024912.html">[squid-users] WCCPV2 with fortigate ERROR: Ignoring WCCPv2 message: truncated record
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24911">[ date ]</a>
              <a href="thread.html#24911">[ thread ]</a>
              <a href="subject.html#24911">[ subject ]</a>
              <a href="author.html#24911">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey David,
 
Just trying to understand something:
Aren&#8217;t Fortinet something that should replace squid?
I assumed that it should do a much better job then Squid in many aeras.
What a Fortinet(I have one&#8230;) is not covering?
 
Thanks,
Eliezer
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A>&gt; 
Web: <A HREF="https://ngtech.co.il/">https://ngtech.co.il/</A>
My-Tube: <A HREF="https://tube.ngtech.co.il/">https://tube.ngtech.co.il/</A>
 
From: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; On Behalf Of David Touzeau
Sent: Thursday, 23 June 2022 19:12
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] WCCPV2 with fortigate ERROR: Ignoring WCCPv2 message: truncated record
 
Hi Alex,
is the v5 commit 7a73a54 already included in the latest 5.5,5.6 versions?

This is very unfortunate because WCCP is used by default by Fortinet firewall devices. It should be very popular.
Indeed, Fortinet is flooding the market.
I can volunteer for the funding and the necessary testing to be done.
Le 23/06/2022 &#224; 14:44, Alex Rousskov a &#233;crit :
On 6/21/22 07:43, David Touzeau wrote: 



We trying to using WCCP with Fortigate without success Squid version  5.5 always claim &quot;Ignoring WCCPv2 message: truncated record&quot; 

What can be the cause ? 

The most likely cause are bugs in untested WCCP fixes (v5 commit 7a73a54). Dormant draft PR 970 contains unfinished fixes for the problems in that previous attempt: 
<A HREF="https://github.com/squid-cache/squid/pull/970">https://github.com/squid-cache/squid/pull/970</A> 

IMHO, folks that need WCCP support should invest into that semi-abandoned Squid feature or risk losing it. WCCP code needs serious refactoring and proper testing. There are currently no Project volunteers that have enough resources and capabilities to do either. 

<A HREF="https://wiki.squid-cache.org/SquidFaq/AboutSquid#How_to_add_a_new_Squid_feature.2C_enhance.2C_of_fix_something.3F">https://wiki.squid-cache.org/SquidFaq/AboutSquid#How_to_add_a_new_Squid_feature.2C_enhance.2C_of_fix_something.3F</A> 


HTH, 

Alex. 




We have added a service ID 80 on fortigate 

config system wccp 
     edit &quot;80&quot; 
         set router-id 10.10.50.1 
         set group-address 0.0.0.0 
         set server-list 10.10.50.2 255.255.255.255 
         set server-type forward 
         set authentication disable 
         set forward-method GRE 
         set return-method GRE 
         set assignment-method HASH 
     next 
end 

Squid wccp configuration 

wccp2_router 10.10.50.1 
wccp_version 3 
# tested v4 do the same behavior 
wccp2_rebuild_wait on 
wccp2_forwarding_method gre 
wccp2_return_method gre 
wccp2_assignment_method hash 
wccp2_service dynamic 80 
wccp2_service_info 80 protocol=tcp protocol=tcp flags=src_ip_hash priority=240 ports=80,443 
wccp2_address 0.0.0.0 
wccp2_weight 10000 

Squid claim in debug log 

022/06/21 13:15:38.780 kid4| 80,6| wccp2.cc(1206) wccp2HandleUdp: wccp2HandleUdp: Called. 
2022/06/21 13:15:38.781 kid4| 5,5| ModEpoll.cc(118) SetSelect: FD 38, type=1, handler=1, client_data=0, timeout=0 
2022/06/21 13:15:38.781 kid4| 80,3| wccp2.cc(1230) wccp2HandleUdp: Incoming WCCPv2 I_SEE_YOU length 112. 
2022/06/21 13:15:38.781 kid4| ERROR: Ignoring WCCPv2 message: truncated record 
     exception location: wccp2.cc(1133) CheckSectionLength 



-- 

_______________________________________________ 
squid-users mailing list 
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;  
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A> 

_______________________________________________ 
squid-users mailing list 
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;  
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A> 
-- 


Technical Support
	David Touzeau
Orgerus, Yvelines, France
Artica Tech 

P: +33 6 58 44 69 46 
www: wiki.articatech.com &lt;<A HREF="https://wiki.articatech.com">https://wiki.articatech.com</A>&gt;  
www: articatech.net &lt;<A HREF="http://articatech.net">http://articatech.net</A>&gt;  
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20220623/21d69058/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20220623/21d69058/attachment.htm</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.jpg
Type: image/jpeg
Size: 6266 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20220623/21d69058/attachment.jpg">http://lists.squid-cache.org/pipermail/squid-users/attachments/20220623/21d69058/attachment.jpg</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="024910.html">[squid-users] WCCPV2 with fortigate ERROR: Ignoring WCCPv2 message: truncated record
</A></li>
	<LI>Next message (by thread): <A HREF="024912.html">[squid-users] WCCPV2 with fortigate ERROR: Ignoring WCCPv2 message: truncated record
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24911">[ date ]</a>
              <a href="thread.html#24911">[ thread ]</a>
              <a href="subject.html#24911">[ subject ]</a>
              <a href="author.html#24911">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
