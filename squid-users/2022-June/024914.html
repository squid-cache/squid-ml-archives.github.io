<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] WCCPV2 with fortigate ERROR: Ignoring WCCPv2 message: truncated record
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20WCCPV2%20with%20fortigate%20ERROR%3A%20Ignoring%20WCCPv2%0A%20message%3A%20truncated%20record&In-Reply-To=%3C725ccb19-4432-45da-a3fd-4fc43d4b4733%40articatech.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024913.html">
   <LINK REL="Next"  HREF="024909.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] WCCPV2 with fortigate ERROR: Ignoring WCCPv2 message: truncated record</H1>
    <B>David Touzeau</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20WCCPV2%20with%20fortigate%20ERROR%3A%20Ignoring%20WCCPv2%0A%20message%3A%20truncated%20record&In-Reply-To=%3C725ccb19-4432-45da-a3fd-4fc43d4b4733%40articatech.com%3E"
       TITLE="[squid-users] WCCPV2 with fortigate ERROR: Ignoring WCCPv2 message: truncated record">david at articatech.com
       </A><BR>
    <I>Sun Jun 26 10:33:55 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="024913.html">[squid-users] WCCPV2 with fortigate ERROR: Ignoring WCCPv2 message: truncated record
</A></li>
        <LI>Next message (by thread): <A HREF="024909.html">[squid-users] APPs defintions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24914">[ date ]</a>
              <a href="thread.html#24914">[ thread ]</a>
              <a href="subject.html#24914">[ subject ]</a>
              <a href="author.html#24914">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Eliezer

if you want to do transparent mode without having to put squid squidboix 
in front of your fortinet.

If you want to do transparent mode while your fortinet aggregates 
several VLANs, the WCCP mode is necessary

So you can control everything through your fortigate

By the way, fortinet offers their proxy based on WCCP to ensure a 
consistent integration with fortigate

My configuration is very simple to replicate :

We have added a service ID 80 on fortigate but failed caused by the 
squid bug

config system wccp
 &#160;&#160;&#160;&#160; edit &quot;80&quot;
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; set router-id 10.10.50.1
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; set group-address 0.0.0.0
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; set server-list 10.10.50.2 255.255.255.255
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; set server-type forward
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; set authentication disable
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; set forward-method GRE
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; set return-method GRE
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; set assignment-method HASH
 &#160;&#160;&#160;&#160; next
end

Squid wccp configuration

wccp2_router 10.10.50.1
wccp_version 3
# tested v4 do the same behavior
wccp2_rebuild_wait on
wccp2_forwarding_method gre
wccp2_return_method gre
wccp2_assignment_method hash
wccp2_service dynamic 80
wccp2_service_info 80 protocol=tcp protocol=tcp flags=src_ip_hash 
priority=240 ports=80,443
wccp2_address 0.0.0.0
wccp2_weight 10000


Le 24/06/2022 &#224; 13:17, <A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A> a &#233;crit&#160;:
&gt;<i>
</I>&gt;<i> I am not sure and can spin up my Forti but from what I remember there 
</I>&gt;<i> are PBR functions in the Forti.
</I>&gt;<i>
</I>&gt;<i> Why would a WCCP be required? To pass only ports 80 and 443 instead of 
</I>&gt;<i> all traffic?
</I>&gt;<i>
</I>-- 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20220626/1aa594ef/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20220626/1aa594ef/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="024913.html">[squid-users] WCCPV2 with fortigate ERROR: Ignoring WCCPv2 message: truncated record
</A></li>
	<LI>Next message (by thread): <A HREF="024909.html">[squid-users] APPs defintions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24914">[ date ]</a>
              <a href="thread.html#24914">[ thread ]</a>
              <a href="subject.html#24914">[ subject ]</a>
              <a href="author.html#24914">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
