From amajer at suse.de  Tue Mar  1 09:45:19 2022
From: amajer at suse.de (Adam Majer)
Date: Tue, 1 Mar 2022 10:45:19 +0100
Subject: [squid-users] Squid 5 OOM
In-Reply-To: <CAARSQBcouqJWVmZgjiQ+2=nWGALPURZETCY2t5pjTsi+ybMrhQ@mail.gmail.com>
References: <CAARSQBcouqJWVmZgjiQ+2=nWGALPURZETCY2t5pjTsi+ybMrhQ@mail.gmail.com>
Message-ID: <c89c86a5-b436-e59f-01f8-4cb7346f7fdf@suse.de>

On 2/28/22 17:42, Frank Ruiz wrote:
> Greetings,
> 
> I am using squid 5, and I am trying to use it strictly as a proxy only 
> with no caching.
> 
>  ?ip-10-4-0-200 kernel: [7520199.557517] Out of memory: Killed process 
> 17574 (squid5) total-vm:15926268kB, anon-rss:15021268kB, file-rss:0kB, 
> shmem-rss:72kB, UID:13 pgtables:31104kB oom_score_adj:0

This looks like a memory leak. It got killed at almost 16GB memory usage.

Which exact version are you using?

- Adam


From frank.ruiz at gmail.com  Tue Mar  1 15:15:58 2022
From: frank.ruiz at gmail.com (Frank Ruiz)
Date: Tue, 1 Mar 2022 07:15:58 -0800
Subject: [squid-users] squid-users Digest, Vol 91, Issue 1
In-Reply-To: <mailman.3.1646136001.2752443.squid-users@lists.squid-cache.org>
References: <mailman.3.1646136001.2752443.squid-users@lists.squid-cache.org>
Message-ID: <CAARSQBfJ8WF7fvY-EcBpzLqxjh1tH3_rGZ1d3cJ326FO=fyeXw@mail.gmail.com>

Version is 5.2-1
https://salsa.debian.org/squid-team/squid/-/tree/debian/5.2-1

On Tue, Mar 1, 2022 at 4:00 AM <squid-users-request at lists.squid-cache.org>
wrote:

> Send squid-users mailing list submissions to
>         squid-users at lists.squid-cache.org
>
> To subscribe or unsubscribe via the World Wide Web, visit
>         http://lists.squid-cache.org/listinfo/squid-users
> or, via email, send a message with subject or body 'help' to
>         squid-users-request at lists.squid-cache.org
>
> You can reach the person managing the list at
>         squid-users-owner at lists.squid-cache.org
>
> When replying, please edit your Subject line so it is more specific
> than "Re: Contents of squid-users digest..."
>
>
> Today's Topics:
>
>    1. Squid 5 OOM (Frank Ruiz)
>    2. Re: Squid 5 OOM (Adam Majer)
>
>
> ----------------------------------------------------------------------
>
> Message: 1
> Date: Mon, 28 Feb 2022 08:42:08 -0800
> From: Frank Ruiz <frank.ruiz at gmail.com>
> To: squid-users at lists.squid-cache.org
> Subject: [squid-users] Squid 5 OOM
> Message-ID:
>         <CAARSQBcouqJWVmZgjiQ+2=
> nWGALPURZETCY2t5pjTsi+ybMrhQ at mail.gmail.com>
> Content-Type: text/plain; charset="utf-8"
>
> Greetings,
>
> I am using squid 5, and I am trying to use it strictly as a proxy only with
> no caching.
>
> kernel: [7520199.557517] Out of memory: Killed process 17574
> (squid5) total-vm:15926268kB, anon-rss:15021268kB, file-rss:0kB,
> shmem-rss:72kB, UID:13 pgtables:31104kB oom_score_adj:0
>
> Is there a way to disable caching completely for my use case?
> -------------- next part --------------
> An HTML attachment was scrubbed...
> URL: <
> http://lists.squid-cache.org/pipermail/squid-users/attachments/20220228/c786bafd/attachment-0001.htm
> >
>
> ------------------------------
>
> Message: 2
> Date: Tue, 1 Mar 2022 10:45:19 +0100
> From: Adam Majer <amajer at suse.de>
> To: squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] Squid 5 OOM
> Message-ID: <c89c86a5-b436-e59f-01f8-4cb7346f7fdf at suse.de>
> Content-Type: text/plain; charset=UTF-8; format=flowed
>
> On 2/28/22 17:42, Frank Ruiz wrote:
> > Greetings,
> >
> > I am using squid 5, and I am trying to use it strictly as a proxy only
> > with no caching.
> >
> >  ?kernel: [7520199.557517] Out of memory: Killed process
> > 17574 (squid5) total-vm:15926268kB, anon-rss:15021268kB, file-rss:0kB,
> > shmem-rss:72kB, UID:13 pgtables:31104kB oom_score_adj:0
>
> This looks like a memory leak. It got killed at almost 16GB memory usage.
>
> Which exact version are you using?
>
> - Adam
>
>
> ------------------------------
>
> Subject: Digest Footer
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
>
> ------------------------------
>
> End of squid-users Digest, Vol 91, Issue 1
> ******************************************
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220301/7e5b1ff2/attachment.htm>

From freefallbenson at hotmail.com  Wed Mar  2 02:15:16 2022
From: freefallbenson at hotmail.com (=?gb2312?B?y9UguPE=?=)
Date: Wed, 2 Mar 2022 02:15:16 +0000
Subject: [squid-users] SQUID refuses to listen on any TCP Port
Message-ID: <OSZP286MB1606426763752532E3AD7D5AC7039@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>

Hi,

I run squid 4.17 on ubuntu 20.04.4 and it starts without any error. But no matter what TCP port I specify, it won?t listen on it.Netstat -tunpal shows only udp port associated with squid.

I have compiled it using the following options:



 ./configure  --prefix=/usr/local --localstatedir=/var --libexecdir=${prefix}/lib/squid  --srcdir=. --datadir=${prefix}/share/squid --sysconfdir=/etc/squid --with-default-user=proxy --with-logdir=/var/log --with-pidfile=/var/run/squid.pid --enable-ssl --enable-dlmalloc --enable-gnuregex --enable-xmalloc-debug --enable-xmalloc-debug-trace --enable-xmalloc-statistics --enable-async-io --enable-icmp --enable-delay-pools --enable-useragent-log--enable-kill-parent-hack --enable-cachemgr-hostname --enable-htpc --enable-forw-via-db --enable-cache-digests --enable-follow-x-forwarded-for --enable-auth --enable-linux-netfilter --with-openssl --with-filedescriptors=65536 --enable-ltdl-convenience



I have been struggling with this for several days and hope someone here can help me. Thank you!

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220302/233f7607/attachment.htm>

From rousskov at measurement-factory.com  Wed Mar  2 14:45:15 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Wed, 2 Mar 2022 09:45:15 -0500
Subject: [squid-users] SQUID refuses to listen on any TCP Port
In-Reply-To: <OSZP286MB1606426763752532E3AD7D5AC7039@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
References: <OSZP286MB1606426763752532E3AD7D5AC7039@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
Message-ID: <ef2125f0-3241-6440-903f-7b182e28527c@measurement-factory.com>

On 3/1/22 21:15, ? ? wrote:

> I run squid 4.17 on ubuntu 20.04.4 and it starts without any error. But 
> no matter what TCP port I specify, it won?t listen on it.Netstat -tunpal 
> shows only udp port associated with squid.
> 
> I have compiled it using the following options:
> 
>  ?./configure ?--prefix=/usr/local --localstatedir=/var 
> --libexecdir=${prefix}/lib/squid ?--srcdir=. 
> --datadir=${prefix}/share/squid --sysconfdir=/etc/squid 
> --with-default-user=proxy --with-logdir=/var/log 
> --with-pidfile=/var/run/squid.pid --enable-ssl --enable-dlmalloc 
> --enable-gnuregex --enable-xmalloc-debug --enable-xmalloc-debug-trace 
> --enable-xmalloc-statistics --enable-async-io --enable-icmp 
> --enable-delay-pools --enable-useragent-log--enable-kill-parent-hack 
> --enable-cachemgr-hostname --enable-htpc --enable-forw-via-db 
> --enable-cache-digests --enable-follow-x-forwarded-for --enable-auth 
> --enable-linux-netfilter --with-openssl --with-filedescriptors=65536 
> --enable-ltdl-convenience

Do you use "workers" in squid.conf? If yes, try temporary setting that 
directive to 1 or starting Squid with "-N" to see whether this is an 
SMP-related problem.

Please share cache.log output that appears when you start Squid. That 
log may be in /var/log, but I am not sure (and it depends, in part, on 
your Squid configuration). If there is no output there, you may need to 
start your Squid by hand and give a "-d1" command line option (among 
others) to see startup output on the console.

Sharing you *_port directives may also be helpful.

Alex.


From freefallbenson at hotmail.com  Thu Mar  3 01:48:00 2022
From: freefallbenson at hotmail.com (ben)
Date: Thu, 3 Mar 2022 09:48:00 +0800
Subject: [squid-users] SQUID refuses to listen on any TCP Port
In-Reply-To: <ef2125f0-3241-6440-903f-7b182e28527c@measurement-factory.com>
References: <OSZP286MB1606426763752532E3AD7D5AC7039@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <ef2125f0-3241-6440-903f-7b182e28527c@measurement-factory.com>
Message-ID: <OSZP286MB160680B3FDD5D5D7197EAFAEC7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>

Hi,Alex,


Thanks for your help. I run squid with the option d1 and its output is 
as followings
2022/03/03 09:17:39 kid1| Current Directory is /root
2022/03/03 09:17:39 kid1| Starting Squid Cache version 4.17 for 
x86_64-pc-linux-gnu...
2022/03/03 09:17:39 kid1| Service Name: squid
2022/03/03 09:17:39 kid1| Process ID 239617
2022/03/03 09:17:39 kid1| Process Roles: worker
2022/03/03 09:17:39 kid1| With 1024 file descriptors available
2022/03/03 09:17:39 kid1| Initializing IP Cache...
2022/03/03 09:17:39 kid1| DNS Socket created at [::], FD 5
2022/03/03 09:17:39 kid1| DNS Socket created at 0.0.0.0, FD 8
2022/03/03 09:17:39 kid1| Adding nameserver 8.8.8.8 from /etc/resolv.conf
2022/03/03 09:17:39 kid1| Logfile: opening log 
daemon:/var/log/squid/access.log
2022/03/03 09:17:39 kid1| Logfile Daemon: opening log 
/var/log/squid/access.log
2022/03/03 09:17:39 kid1| Local cache digest enabled; rebuild/rewrite 
every 3600/3600 sec
2022/03/03 09:17:39 kid1| Store logging disabled
2022/03/03 09:17:39 kid1| Swap maxSize 0 + 262144 KB, estimated 20164 
objects
2022/03/03 09:17:39 kid1| Target number of buckets: 1008
2022/03/03 09:17:39 kid1| Using 8192 Store buckets
2022/03/03 09:17:39 kid1| Max Mem ?size: 262144 KB
2022/03/03 09:17:39 kid1| Max Swap size: 0 KB
2022/03/03 09:17:39 kid1| Using Least Load store dir selection
2022/03/03 09:17:39 kid1| Current Directory is /root
2022/03/03 09:17:39 kid1| Finished loading MIME types and icons.
2022/03/03 09:17:39 kid1| HTCP Disabled.

the only line in squid.conf is http_port 3128
On 2022/3/2 22:45, Alex Rousskov wrote:
> On 3/1/22 21:15, ? ? wrote:
>
>> I run squid 4.17 on ubuntu 20.04.4 and it starts without any error. 
>> But no matter what TCP port I specify, it won?t listen on it.Netstat 
>> -tunpal shows only udp port associated with squid.
>>
>> I have compiled it using the following options:
>>
>> ??./configure ?--prefix=/usr/local --localstatedir=/var 
>> --libexecdir=${prefix}/lib/squid ?--srcdir=. 
>> --datadir=${prefix}/share/squid --sysconfdir=/etc/squid 
>> --with-default-user=proxy --with-logdir=/var/log 
>> --with-pidfile=/var/run/squid.pid --enable-ssl --enable-dlmalloc 
>> --enable-gnuregex --enable-xmalloc-debug --enable-xmalloc-debug-trace 
>> --enable-xmalloc-statistics --enable-async-io --enable-icmp 
>> --enable-delay-pools --enable-useragent-log--enable-kill-parent-hack 
>> --enable-cachemgr-hostname --enable-htpc --enable-forw-via-db 
>> --enable-cache-digests --enable-follow-x-forwarded-for --enable-auth 
>> --enable-linux-netfilter --with-openssl --with-filedescriptors=65536 
>> --enable-ltdl-convenience
>
> Do you use "workers" in squid.conf? If yes, try temporary setting that 
> directive to 1 or starting Squid with "-N" to see whether this is an 
> SMP-related problem.
>
> Please share cache.log output that appears when you start Squid. That 
> log may be in /var/log, but I am not sure (and it depends, in part, on 
> your Squid configuration). If there is no output there, you may need 
> to start your Squid by hand and give a "-d1" command line option 
> (among others) to see startup output on the console.
>
> Sharing you *_port directives may also be helpful.
>
> Alex.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220303/f96b5d5e/attachment.htm>

From squid3 at treenet.co.nz  Thu Mar  3 08:37:40 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 3 Mar 2022 21:37:40 +1300
Subject: [squid-users] SQUID refuses to listen on any TCP Port
In-Reply-To: <OSZP286MB160680B3FDD5D5D7197EAFAEC7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
References: <OSZP286MB1606426763752532E3AD7D5AC7039@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <ef2125f0-3241-6440-903f-7b182e28527c@measurement-factory.com>
 <OSZP286MB160680B3FDD5D5D7197EAFAEC7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
Message-ID: <78f95f39-3c90-c1e8-6ee8-603bd6beda6c@treenet.co.nz>

On 3/03/22 14:48, ben wrote:
> Hi,Alex,
> 
> 
> Thanks for your help. I run squid with the option d1 and its output is 
> as followings
> 2022/03/03 09:17:39 kid1| Current Directory is /root
> 2022/03/03 09:17:39 kid1| Starting Squid Cache version 4.17 for 
> x86_64-pc-linux-gnu...
> 2022/03/03 09:17:39 kid1| Service Name: squid
> 2022/03/03 09:17:39 kid1| Process ID 239617
> 2022/03/03 09:17:39 kid1| Process Roles: worker
> 2022/03/03 09:17:39 kid1| With 1024 file descriptors available
> 2022/03/03 09:17:39 kid1| Initializing IP Cache...
> 2022/03/03 09:17:39 kid1| DNS Socket created at [::], FD 5
> 2022/03/03 09:17:39 kid1| DNS Socket created at 0.0.0.0, FD 8
> 2022/03/03 09:17:39 kid1| Adding nameserver 8.8.8.8 from /etc/resolv.conf
> 2022/03/03 09:17:39 kid1| Logfile: opening log 
> daemon:/var/log/squid/access.log
> 2022/03/03 09:17:39 kid1| Logfile Daemon: opening log 
> /var/log/squid/access.log
> 2022/03/03 09:17:39 kid1| Local cache digest enabled; rebuild/rewrite 
> every 3600/3600 sec
> 2022/03/03 09:17:39 kid1| Store logging disabled
> 2022/03/03 09:17:39 kid1| Swap maxSize 0 + 262144 KB, estimated 20164 
> objects
> 2022/03/03 09:17:39 kid1| Target number of buckets: 1008
> 2022/03/03 09:17:39 kid1| Using 8192 Store buckets
> 2022/03/03 09:17:39 kid1| Max Mem ?size: 262144 KB
> 2022/03/03 09:17:39 kid1| Max Swap size: 0 KB
> 2022/03/03 09:17:39 kid1| Using Least Load store dir selection
> 2022/03/03 09:17:39 kid1| Current Directory is /root
> 2022/03/03 09:17:39 kid1| Finished loading MIME types and icons.
> 2022/03/03 09:17:39 kid1| HTCP Disabled.
> 
> the only line in squid.conf is http_port 3128


That itself could be the problem.

Please at least use the default config file shown in 
<https://wiki.squid-cache.org/Squid-4>, or better use the squid.conf 
file built with your custom binary.



Cheers
Amos


From ngtech1ltd at gmail.com  Thu Mar  3 11:50:25 2022
From: ngtech1ltd at gmail.com (Eliezer Croitoru)
Date: Thu, 3 Mar 2022 13:50:25 +0200
Subject: [squid-users] SQUID refuses to listen on any TCP Port
In-Reply-To: <78f95f39-3c90-c1e8-6ee8-603bd6beda6c@treenet.co.nz>
References: <OSZP286MB1606426763752532E3AD7D5AC7039@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <ef2125f0-3241-6440-903f-7b182e28527c@measurement-factory.com>
 <OSZP286MB160680B3FDD5D5D7197EAFAEC7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <78f95f39-3c90-c1e8-6ee8-603bd6beda6c@treenet.co.nz>
Message-ID: <003c01d82ef4$dfc30eb0$9f492c10$@gmail.com>

Should "squid -kparse" be of help for such a scenario?
Else then using the default squid.conf it would be helpful to explain what are the basic squid.conf that is required for squid to run.
I believe that a wiki/doc about this would be nice (volunteering to write a draft later on)

Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Amos Jeffries
Sent: Thursday, March 3, 2022 10:38
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] SQUID refuses to listen on any TCP Port

On 3/03/22 14:48, ben wrote:
> Hi,Alex,
> 
> 
> Thanks for your help. I run squid with the option d1 and its output is 
> as followings
> 2022/03/03 09:17:39 kid1| Current Directory is /root
> 2022/03/03 09:17:39 kid1| Starting Squid Cache version 4.17 for 
> x86_64-pc-linux-gnu...
> 2022/03/03 09:17:39 kid1| Service Name: squid
> 2022/03/03 09:17:39 kid1| Process ID 239617
> 2022/03/03 09:17:39 kid1| Process Roles: worker
> 2022/03/03 09:17:39 kid1| With 1024 file descriptors available
> 2022/03/03 09:17:39 kid1| Initializing IP Cache...
> 2022/03/03 09:17:39 kid1| DNS Socket created at [::], FD 5
> 2022/03/03 09:17:39 kid1| DNS Socket created at 0.0.0.0, FD 8
> 2022/03/03 09:17:39 kid1| Adding nameserver 8.8.8.8 from /etc/resolv.conf
> 2022/03/03 09:17:39 kid1| Logfile: opening log 
> daemon:/var/log/squid/access.log
> 2022/03/03 09:17:39 kid1| Logfile Daemon: opening log 
> /var/log/squid/access.log
> 2022/03/03 09:17:39 kid1| Local cache digest enabled; rebuild/rewrite 
> every 3600/3600 sec
> 2022/03/03 09:17:39 kid1| Store logging disabled
> 2022/03/03 09:17:39 kid1| Swap maxSize 0 + 262144 KB, estimated 20164 
> objects
> 2022/03/03 09:17:39 kid1| Target number of buckets: 1008
> 2022/03/03 09:17:39 kid1| Using 8192 Store buckets
> 2022/03/03 09:17:39 kid1| Max Mem  size: 262144 KB
> 2022/03/03 09:17:39 kid1| Max Swap size: 0 KB
> 2022/03/03 09:17:39 kid1| Using Least Load store dir selection
> 2022/03/03 09:17:39 kid1| Current Directory is /root
> 2022/03/03 09:17:39 kid1| Finished loading MIME types and icons.
> 2022/03/03 09:17:39 kid1| HTCP Disabled.
> 
> the only line in squid.conf is http_port 3128


That itself could be the problem.

Please at least use the default config file shown in 
<https://wiki.squid-cache.org/Squid-4>, or better use the squid.conf 
file built with your custom binary.



Cheers
Amos
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From freefallbenson at hotmail.com  Thu Mar  3 13:56:00 2022
From: freefallbenson at hotmail.com (=?gb2312?B?y9UguPE=?=)
Date: Thu, 3 Mar 2022 13:56:00 +0000
Subject: [squid-users] SQUID refuses to listen on any TCP Port
In-Reply-To: <78f95f39-3c90-c1e8-6ee8-603bd6beda6c@treenet.co.nz>
References: <OSZP286MB1606426763752532E3AD7D5AC7039@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <ef2125f0-3241-6440-903f-7b182e28527c@measurement-factory.com>
 <OSZP286MB160680B3FDD5D5D7197EAFAEC7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <78f95f39-3c90-c1e8-6ee8-603bd6beda6c@treenet.co.nz>
Message-ID: <OSZP286MB1606BD8554AF8244A2C80D7BC7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>



Hi,

I tried using the default config. No difference

2022/03/03 21:49:17 kid1| Set Current Directory to /var/cache/squid
2022/03/03 21:49:17 kid1| Starting Squid Cache version 4.17 for x86_64-pc-linux-gnu...
2022/03/03 21:49:17 kid1| Service Name: squid
2022/03/03 21:49:17 kid1| Process ID 382776
2022/03/03 21:49:17 kid1| Process Roles: worker
2022/03/03 21:49:17 kid1| With 1024 file descriptors available
2022/03/03 21:49:17 kid1| Initializing IP Cache...
2022/03/03 21:49:17 kid1| DNS Socket created at [::], FD 5
2022/03/03 21:49:17 kid1| DNS Socket created at 0.0.0.0, FD 8
2022/03/03 21:49:17 kid1| Adding nameserver 8.8.8.8 from /etc/resolv.conf
2022/03/03 21:49:17 kid1| Logfile: opening log daemon:/var/log/access.log
2022/03/03 21:49:17 kid1| Logfile Daemon: opening log /var/log/access.log
2022/03/03 21:49:17 kid1| Local cache digest enabled; rebuild/rewrite every 3600/3600 sec
2022/03/03 21:49:17 kid1| Store logging disabled
2022/03/03 21:49:17 kid1| Swap maxSize 0 + 262144 KB, estimated 20164 objects
2022/03/03 21:49:17 kid1| Target number of buckets: 1008
2022/03/03 21:49:17 kid1| Using 8192 Store buckets
2022/03/03 21:49:17 kid1| Max Mem  size: 262144 KB
2022/03/03 21:49:17 kid1| Max Swap size: 0 KB
2022/03/03 21:49:17 kid1| Using Least Load store dir selection
2022/03/03 21:49:17 kid1| Set Current Directory to /var/cache/squid
2022/03/03 21:49:17 kid1| Finished loading MIME types and icons.
2022/03/03 21:49:17 kid1| HTCP Disabled.

netstat -tunpal shows
 netstat -tunpal | grep squid
udp        0      0 0.0.0.0:21638           0.0.0.0:*                           382776/(squid-1)
udp6       0      0 ::1:40383               ::1:50900               ESTABLISHED 382776/(squid-1)
udp6       0      0 ::1:50900               ::1:40383               ESTABLISHED 382776/(squid-1)
udp6       0      0 :::15633                :::*                                382776/(squid-1)

On 3/03/22 14:48, ben wrote:
> Hi,Alex,
>
>
> Thanks for your help. I run squid with the option d1 and its output is
> as followings
> 2022/03/03 09:17:39 kid1| Current Directory is /root
> 2022/03/03 09:17:39 kid1| Starting Squid Cache version 4.17 for
> x86_64-pc-linux-gnu...
> 2022/03/03 09:17:39 kid1| Service Name: squid
> 2022/03/03 09:17:39 kid1| Process ID 239617
> 2022/03/03 09:17:39 kid1| Process Roles: worker
> 2022/03/03 09:17:39 kid1| With 1024 file descriptors available
> 2022/03/03 09:17:39 kid1| Initializing IP Cache...
> 2022/03/03 09:17:39 kid1| DNS Socket created at [::], FD 5
> 2022/03/03 09:17:39 kid1| DNS Socket created at 0.0.0.0, FD 8
> 2022/03/03 09:17:39 kid1| Adding nameserver 8.8.8.8 from /etc/resolv.conf
> 2022/03/03 09:17:39 kid1| Logfile: opening log
> daemon:/var/log/squid/access.log
> 2022/03/03 09:17:39 kid1| Logfile Daemon: opening log
> /var/log/squid/access.log
> 2022/03/03 09:17:39 kid1| Local cache digest enabled; rebuild/rewrite
> every 3600/3600 sec
> 2022/03/03 09:17:39 kid1| Store logging disabled
> 2022/03/03 09:17:39 kid1| Swap maxSize 0 + 262144 KB, estimated 20164
> objects
> 2022/03/03 09:17:39 kid1| Target number of buckets: 1008
> 2022/03/03 09:17:39 kid1| Using 8192 Store buckets
> 2022/03/03 09:17:39 kid1| Max Mem  size: 262144 KB
> 2022/03/03 09:17:39 kid1| Max Swap size: 0 KB
> 2022/03/03 09:17:39 kid1| Using Least Load store dir selection
> 2022/03/03 09:17:39 kid1| Current Directory is /root
> 2022/03/03 09:17:39 kid1| Finished loading MIME types and icons.
> 2022/03/03 09:17:39 kid1| HTCP Disabled.
>
> the only line in squid.conf is http_port 3128


That itself could be the problem.

Please at least use the default config file shown in
<https://wiki.squid-cache.org/Squid-4>, or better use the squid.conf
file built with your custom binary.



Cheers
Amos
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220303/ca540aa4/attachment.htm>

From freefallbenson at hotmail.com  Thu Mar  3 13:58:34 2022
From: freefallbenson at hotmail.com (=?gb2312?B?y9UguPE=?=)
Date: Thu, 3 Mar 2022 13:58:34 +0000
Subject: [squid-users] SQUID refuses to listen on any TCP Port
In-Reply-To: <OSZP286MB1606BD8554AF8244A2C80D7BC7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
References: <OSZP286MB1606426763752532E3AD7D5AC7039@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <ef2125f0-3241-6440-903f-7b182e28527c@measurement-factory.com>
 <OSZP286MB160680B3FDD5D5D7197EAFAEC7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <78f95f39-3c90-c1e8-6ee8-603bd6beda6c@treenet.co.nz>
 <OSZP286MB1606BD8554AF8244A2C80D7BC7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
Message-ID: <OSZP286MB160613A80F8C2BFADD36809CC7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>



here is the default config

#
# Recommended minimum configuration:
#

# Example rule allowing access from your local networks.
# Adapt to list your (internal) IP networks from where browsing
# should be allowed
acl localnet src 0.0.0.1-0.255.255.255  # RFC 1122 "this" network (LAN)
acl localnet src 10.0.0.0/8             # RFC 1918 local private network (LAN)
acl localnet src 100.64.0.0/10          # RFC 6598 shared address space (CGN)
acl localnet src 169.254.0.0/16         # RFC 3927 link-local (directly plugged) machines
acl localnet src 172.16.0.0/12          # RFC 1918 local private network (LAN)
acl localnet src 192.168.0.0/16         # RFC 1918 local private network (LAN)
acl localnet src fc00::/7               # RFC 4193 local private network range
acl localnet src fe80::/10              # RFC 4291 link-local (directly plugged) machines

acl SSL_ports port 443
acl Safe_ports port 80          # http
acl Safe_ports port 21          # ftp
acl Safe_ports port 443         # https
acl Safe_ports port 70          # gopher
acl Safe_ports port 210         # wais
acl Safe_ports port 1025-65535  # unregistered ports
acl Safe_ports port 280         # http-mgmt
acl Safe_ports port 488         # gss-http
acl Safe_ports port 591         # filemaker
acl Safe_ports port 777         # multiling http
acl CONNECT method CONNECT

#
# Recommended minimum Access Permission configuration:
#
# Deny requests to certain unsafe ports
http_access deny !Safe_ports

# Deny CONNECT to other than secure SSL ports
http_access deny CONNECT !SSL_ports

# Only allow cachemgr access from localhost
http_access allow localhost manager
http_access deny manager

# We strongly recommend the following be uncommented to protect innocent
# web applications running on the proxy server who think the only
# one who can access services on "localhost" is a local user
#http_access deny to_localhost

#
# INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
#

# Example rule allowing access from your local networks.
# Adapt localnet in the ACL section to list your (internal) IP networks
# from where browsing should be allowed
http_access allow localnet
http_access allow localhost

# And finally deny all other access to this proxy
http_access deny all

# Squid normally listens to port 3128
http_port 3128

# Uncomment and adjust the following to add a disk cache directory.
#cache_dir ufs /var/cache/squid 100 16 256

# Leave coredumps in the first cache dir
coredump_dir /var/cache/squid

#
# Add any of your own refresh_pattern entries above these.
#
refresh_pattern ^ftp:           1440    20%     10080
refresh_pattern ^gopher:        1440    0%      1440
refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
refresh_pattern .               0       20%     4320

Hi,

I tried using the default config. No difference

2022/03/03 21:49:17 kid1| Set Current Directory to /var/cache/squid
2022/03/03 21:49:17 kid1| Starting Squid Cache version 4.17 for x86_64-pc-linux-gnu...
2022/03/03 21:49:17 kid1| Service Name: squid
2022/03/03 21:49:17 kid1| Process ID 382776
2022/03/03 21:49:17 kid1| Process Roles: worker
2022/03/03 21:49:17 kid1| With 1024 file descriptors available
2022/03/03 21:49:17 kid1| Initializing IP Cache...
2022/03/03 21:49:17 kid1| DNS Socket created at [::], FD 5
2022/03/03 21:49:17 kid1| DNS Socket created at 0.0.0.0, FD 8
2022/03/03 21:49:17 kid1| Adding nameserver 8.8.8.8 from /etc/resolv.conf
2022/03/03 21:49:17 kid1| Logfile: opening log daemon:/var/log/access.log
2022/03/03 21:49:17 kid1| Logfile Daemon: opening log /var/log/access.log
2022/03/03 21:49:17 kid1| Local cache digest enabled; rebuild/rewrite every 3600/3600 sec
2022/03/03 21:49:17 kid1| Store logging disabled
2022/03/03 21:49:17 kid1| Swap maxSize 0 + 262144 KB, estimated 20164 objects
2022/03/03 21:49:17 kid1| Target number of buckets: 1008
2022/03/03 21:49:17 kid1| Using 8192 Store buckets
2022/03/03 21:49:17 kid1| Max Mem  size: 262144 KB
2022/03/03 21:49:17 kid1| Max Swap size: 0 KB
2022/03/03 21:49:17 kid1| Using Least Load store dir selection
2022/03/03 21:49:17 kid1| Set Current Directory to /var/cache/squid
2022/03/03 21:49:17 kid1| Finished loading MIME types and icons.
2022/03/03 21:49:17 kid1| HTCP Disabled.

netstat -tunpal shows
 netstat -tunpal | grep squid
udp        0      0 0.0.0.0:21638           0.0.0.0:*                           382776/(squid-1)
udp6       0      0 ::1:40383               ::1:50900               ESTABLISHED 382776/(squid-1)
udp6       0      0 ::1:50900               ::1:40383               ESTABLISHED 382776/(squid-1)
udp6       0      0 :::15633                :::*                                382776/(squid-1)

On 3/03/22 14:48, ben wrote:
> Hi,Alex,
>
>
> Thanks for your help. I run squid with the option d1 and its output is
> as followings
> 2022/03/03 09:17:39 kid1| Current Directory is /root
> 2022/03/03 09:17:39 kid1| Starting Squid Cache version 4.17 for
> x86_64-pc-linux-gnu...
> 2022/03/03 09:17:39 kid1| Service Name: squid
> 2022/03/03 09:17:39 kid1| Process ID 239617
> 2022/03/03 09:17:39 kid1| Process Roles: worker
> 2022/03/03 09:17:39 kid1| With 1024 file descriptors available
> 2022/03/03 09:17:39 kid1| Initializing IP Cache...
> 2022/03/03 09:17:39 kid1| DNS Socket created at [::], FD 5
> 2022/03/03 09:17:39 kid1| DNS Socket created at 0.0.0.0, FD 8
> 2022/03/03 09:17:39 kid1| Adding nameserver 8.8.8.8 from /etc/resolv.conf
> 2022/03/03 09:17:39 kid1| Logfile: opening log
> daemon:/var/log/squid/access.log
> 2022/03/03 09:17:39 kid1| Logfile Daemon: opening log
> /var/log/squid/access.log
> 2022/03/03 09:17:39 kid1| Local cache digest enabled; rebuild/rewrite
> every 3600/3600 sec
> 2022/03/03 09:17:39 kid1| Store logging disabled
> 2022/03/03 09:17:39 kid1| Swap maxSize 0 + 262144 KB, estimated 20164
> objects
> 2022/03/03 09:17:39 kid1| Target number of buckets: 1008
> 2022/03/03 09:17:39 kid1| Using 8192 Store buckets
> 2022/03/03 09:17:39 kid1| Max Mem  size: 262144 KB
> 2022/03/03 09:17:39 kid1| Max Swap size: 0 KB
> 2022/03/03 09:17:39 kid1| Using Least Load store dir selection
> 2022/03/03 09:17:39 kid1| Current Directory is /root
> 2022/03/03 09:17:39 kid1| Finished loading MIME types and icons.
> 2022/03/03 09:17:39 kid1| HTCP Disabled.
>
> the only line in squid.conf is http_port 3128


That itself could be the problem.

Please at least use the default config file shown in
<https://wiki.squid-cache.org/Squid-4>, or better use the squid.conf
file built with your custom binary.



Cheers
Amos
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220303/b47a2565/attachment.htm>

From uhlar at fantomas.sk  Thu Mar  3 14:29:00 2022
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Thu, 3 Mar 2022 15:29:00 +0100
Subject: [squid-users] SQUID refuses to listen on any TCP Port
In-Reply-To: <OSZP286MB1606BD8554AF8244A2C80D7BC7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
References: <OSZP286MB1606426763752532E3AD7D5AC7039@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <ef2125f0-3241-6440-903f-7b182e28527c@measurement-factory.com>
 <OSZP286MB160680B3FDD5D5D7197EAFAEC7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <78f95f39-3c90-c1e8-6ee8-603bd6beda6c@treenet.co.nz>
 <OSZP286MB1606BD8554AF8244A2C80D7BC7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
Message-ID: <YiDQrN3t7lrVLSyP@fantomas.sk>

On 03.03.22 13:56, ? ? wrote:
>I tried using the default config. No difference

are you sure there's this line in the default config?

http_port 3128

are you sure there's nothing listening on 3128?

netstat -tnlpe|grep :3128

>2022/03/03 21:49:17 kid1| Set Current Directory to /var/cache/squid
>2022/03/03 21:49:17 kid1| Starting Squid Cache version 4.17 for x86_64-pc-linux-gnu...
>2022/03/03 21:49:17 kid1| Service Name: squid
>2022/03/03 21:49:17 kid1| Process ID 382776
>2022/03/03 21:49:17 kid1| Process Roles: worker
>2022/03/03 21:49:17 kid1| With 1024 file descriptors available
>2022/03/03 21:49:17 kid1| Initializing IP Cache...
>2022/03/03 21:49:17 kid1| DNS Socket created at [::], FD 5
>2022/03/03 21:49:17 kid1| DNS Socket created at 0.0.0.0, FD 8
>2022/03/03 21:49:17 kid1| Adding nameserver 8.8.8.8 from /etc/resolv.conf
>2022/03/03 21:49:17 kid1| Logfile: opening log daemon:/var/log/access.log
>2022/03/03 21:49:17 kid1| Logfile Daemon: opening log /var/log/access.log
>2022/03/03 21:49:17 kid1| Local cache digest enabled; rebuild/rewrite every 3600/3600 sec
>2022/03/03 21:49:17 kid1| Store logging disabled
>2022/03/03 21:49:17 kid1| Swap maxSize 0 + 262144 KB, estimated 20164 objects
>2022/03/03 21:49:17 kid1| Target number of buckets: 1008
>2022/03/03 21:49:17 kid1| Using 8192 Store buckets
>2022/03/03 21:49:17 kid1| Max Mem  size: 262144 KB
>2022/03/03 21:49:17 kid1| Max Swap size: 0 KB
>2022/03/03 21:49:17 kid1| Using Least Load store dir selection
>2022/03/03 21:49:17 kid1| Set Current Directory to /var/cache/squid
>2022/03/03 21:49:17 kid1| Finished loading MIME types and icons.
>2022/03/03 21:49:17 kid1| HTCP Disabled.
>
>netstat -tunpal shows
> netstat -tunpal | grep squid
>udp        0      0 0.0.0.0:21638           0.0.0.0:*                           382776/(squid-1)
>udp6       0      0 ::1:40383               ::1:50900               ESTABLISHED 382776/(squid-1)
>udp6       0      0 ::1:50900               ::1:40383               ESTABLISHED 382776/(squid-1)
>udp6       0      0 :::15633                :::*                                382776/(squid-1)

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
I don't have lysdexia. The Dog wouldn't allow that.


From freefallbenson at hotmail.com  Thu Mar  3 14:42:33 2022
From: freefallbenson at hotmail.com (=?gb2312?B?y9UguPE=?=)
Date: Thu, 3 Mar 2022 14:42:33 +0000
Subject: [squid-users] SQUID refuses to listen on any TCP Port
In-Reply-To: <YiDQrN3t7lrVLSyP@fantomas.sk>
References: <OSZP286MB1606426763752532E3AD7D5AC7039@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <ef2125f0-3241-6440-903f-7b182e28527c@measurement-factory.com>
 <OSZP286MB160680B3FDD5D5D7197EAFAEC7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <78f95f39-3c90-c1e8-6ee8-603bd6beda6c@treenet.co.nz>
 <OSZP286MB1606BD8554AF8244A2C80D7BC7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <YiDQrN3t7lrVLSyP@fantomas.sk>
Message-ID: <OSZP286MB16063B4FD8C9CA0DFC74C5D9C7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>

Hi,
Yes, I checked the config again and I'm sure that's the config squid is running with


netstat -tnlpe|grep :3128 failed to produce any output

Thank you for your help!

________________________________
???: squid-users <squid-users-bounces at lists.squid-cache.org> ?? Matus UHLAR - fantomas <uhlar at fantomas.sk>
????: 2022?3?3? 14:29
???: squid-users at lists.squid-cache.org <squid-users at lists.squid-cache.org>
??: Re: [squid-users] SQUID refuses to listen on any TCP Port

On 03.03.22 13:56, ? ? wrote:
>I tried using the default config. No difference

are you sure there's this line in the default config?

http_port 3128

are you sure there's nothing listening on 3128?

netstat -tnlpe|grep :3128

>2022/03/03 21:49:17 kid1| Set Current Directory to /var/cache/squid
>2022/03/03 21:49:17 kid1| Starting Squid Cache version 4.17 for x86_64-pc-linux-gnu...
>2022/03/03 21:49:17 kid1| Service Name: squid
>2022/03/03 21:49:17 kid1| Process ID 382776
>2022/03/03 21:49:17 kid1| Process Roles: worker
>2022/03/03 21:49:17 kid1| With 1024 file descriptors available
>2022/03/03 21:49:17 kid1| Initializing IP Cache...
>2022/03/03 21:49:17 kid1| DNS Socket created at [::], FD 5
>2022/03/03 21:49:17 kid1| DNS Socket created at 0.0.0.0, FD 8
>2022/03/03 21:49:17 kid1| Adding nameserver 8.8.8.8 from /etc/resolv.conf
>2022/03/03 21:49:17 kid1| Logfile: opening log daemon:/var/log/access.log
>2022/03/03 21:49:17 kid1| Logfile Daemon: opening log /var/log/access.log
>2022/03/03 21:49:17 kid1| Local cache digest enabled; rebuild/rewrite every 3600/3600 sec
>2022/03/03 21:49:17 kid1| Store logging disabled
>2022/03/03 21:49:17 kid1| Swap maxSize 0 + 262144 KB, estimated 20164 objects
>2022/03/03 21:49:17 kid1| Target number of buckets: 1008
>2022/03/03 21:49:17 kid1| Using 8192 Store buckets
>2022/03/03 21:49:17 kid1| Max Mem  size: 262144 KB
>2022/03/03 21:49:17 kid1| Max Swap size: 0 KB
>2022/03/03 21:49:17 kid1| Using Least Load store dir selection
>2022/03/03 21:49:17 kid1| Set Current Directory to /var/cache/squid
>2022/03/03 21:49:17 kid1| Finished loading MIME types and icons.
>2022/03/03 21:49:17 kid1| HTCP Disabled.
>
>netstat -tunpal shows
> netstat -tunpal | grep squid
>udp        0      0 0.0.0.0:21638           0.0.0.0:*                           382776/(squid-1)
>udp6       0      0 ::1:40383               ::1:50900               ESTABLISHED 382776/(squid-1)
>udp6       0      0 ::1:50900               ::1:40383               ESTABLISHED 382776/(squid-1)
>udp6       0      0 :::15633                :::*                                382776/(squid-1)

--
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
I don't have lysdexia. The Dog wouldn't allow that.
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220303/b239e828/attachment.htm>

From rousskov at measurement-factory.com  Thu Mar  3 14:52:22 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Thu, 3 Mar 2022 09:52:22 -0500
Subject: [squid-users] SQUID refuses to listen on any TCP Port
In-Reply-To: <OSZP286MB16063B4FD8C9CA0DFC74C5D9C7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
References: <OSZP286MB1606426763752532E3AD7D5AC7039@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <ef2125f0-3241-6440-903f-7b182e28527c@measurement-factory.com>
 <OSZP286MB160680B3FDD5D5D7197EAFAEC7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <78f95f39-3c90-c1e8-6ee8-603bd6beda6c@treenet.co.nz>
 <OSZP286MB1606BD8554AF8244A2C80D7BC7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <YiDQrN3t7lrVLSyP@fantomas.sk>
 <OSZP286MB16063B4FD8C9CA0DFC74C5D9C7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
Message-ID: <5625a031-aafe-2453-93a4-c0043bb5cf8e@measurement-factory.com>

On 3/3/22 09:42, ? ? wrote:

> Yes, I checked the config again and I'm sure that's the config squid is 
> running with

Your Squid output suggests that you are running an SMP Squid. That, in 
turn, suggests that you suffer from an SMP/IPC communication problem.

I suggest the following triage steps:

1. Move your Squid configuration file somewhere else for safekeeping.

2. Write a new configuration file with nothing but some garbage in it. 
For example, you can put an "http_port XXX" line and nothing else. Make 
sure you get a startup error with that configuration file. No Squid 
process should be running. If your Squid still starts OK, then you are 
not using the configuration file you think you are using.

3. Start Squid from the command line, using "-N -d1 -f 
path/to/saved-configuration-file-from-item1.conf" or similar command 
line options and see if you can get your Squid to listen that way. Share 
your results.


HTH,

Alex.




> netstat -tnlpe|grep :3128 failed to produce any output
> 
> Thank you for your help!
> 
> ------------------------------------------------------------------------
> *???:* squid-users <squid-users-bounces at lists.squid-cache.org> ?? 
> Matus UHLAR - fantomas <uhlar at fantomas.sk>
> *????:* 2022?3?3? 14:29
> *???:* squid-users at lists.squid-cache.org 
> <squid-users at lists.squid-cache.org>
> *??:* Re: [squid-users] SQUID refuses to listen on any TCP Port
> On 03.03.22 13:56, ? ? wrote:
>>I tried using the default config. No difference
> 
> are you sure there's this line in the default config?
> 
> http_port 3128
> 
> are you sure there's nothing listening on 3128?
> 
> netstat -tnlpe|grep :3128
> 
>>2022/03/03 21:49:17 kid1| Set Current Directory to /var/cache/squid
>>2022/03/03 21:49:17 kid1| Starting Squid Cache version 4.17 for x86_64-pc-linux-gnu...
>>2022/03/03 21:49:17 kid1| Service Name: squid
>>2022/03/03 21:49:17 kid1| Process ID 382776
>>2022/03/03 21:49:17 kid1| Process Roles: worker
>>2022/03/03 21:49:17 kid1| With 1024 file descriptors available
>>2022/03/03 21:49:17 kid1| Initializing IP Cache...
>>2022/03/03 21:49:17 kid1| DNS Socket created at [::], FD 5
>>2022/03/03 21:49:17 kid1| DNS Socket created at 0.0.0.0, FD 8
>>2022/03/03 21:49:17 kid1| Adding nameserver 8.8.8.8 from /etc/resolv.conf
>>2022/03/03 21:49:17 kid1| Logfile: opening log daemon:/var/log/access.log
>>2022/03/03 21:49:17 kid1| Logfile Daemon: opening log /var/log/access.log
>>2022/03/03 21:49:17 kid1| Local cache digest enabled; rebuild/rewrite every 3600/3600 sec
>>2022/03/03 21:49:17 kid1| Store logging disabled
>>2022/03/03 21:49:17 kid1| Swap maxSize 0 + 262144 KB, estimated 20164 objects
>>2022/03/03 21:49:17 kid1| Target number of buckets: 1008
>>2022/03/03 21:49:17 kid1| Using 8192 Store buckets
>>2022/03/03 21:49:17 kid1| Max Mem? size: 262144 KB
>>2022/03/03 21:49:17 kid1| Max Swap size: 0 KB
>>2022/03/03 21:49:17 kid1| Using Least Load store dir selection
>>2022/03/03 21:49:17 kid1| Set Current Directory to /var/cache/squid
>>2022/03/03 21:49:17 kid1| Finished loading MIME types and icons.
>>2022/03/03 21:49:17 kid1| HTCP Disabled.
>>
>>netstat -tunpal shows
>> netstat -tunpal | grep squid
>>udp??????? 0????? 0 0.0.0.0:21638?????????? 0.0.0.0:*?????????????????????????? 382776/(squid-1)
>>udp6?????? 0????? 0 ::1:40383?????????????? ::1:50900?????????????? ESTABLISHED 382776/(squid-1)
>>udp6?????? 0????? 0 ::1:50900?????????????? ::1:40383?????????????? ESTABLISHED 382776/(squid-1)
>>udp6?????? 0????? 0 :::15633??????????????? :::*??????????????????????????????? 382776/(squid-1)
> 
> -- 
> Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/ 
> <http://www.fantomas.sk/>
> Warning: I wish NOT to receive e-mail advertising to this address.
> Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
> I don't have lysdexia. The Dog wouldn't allow that.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users 
> <http://lists.squid-cache.org/listinfo/squid-users>
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



From freefallbenson at hotmail.com  Thu Mar  3 16:12:39 2022
From: freefallbenson at hotmail.com (ben)
Date: Fri, 4 Mar 2022 00:12:39 +0800
Subject: [squid-users] SQUID refuses to listen on any TCP Port
In-Reply-To: <OSZP286MB16063B4FD8C9CA0DFC74C5D9C7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
References: <OSZP286MB1606426763752532E3AD7D5AC7039@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <ef2125f0-3241-6440-903f-7b182e28527c@measurement-factory.com>
 <OSZP286MB160680B3FDD5D5D7197EAFAEC7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <78f95f39-3c90-c1e8-6ee8-603bd6beda6c@treenet.co.nz>
 <OSZP286MB1606BD8554AF8244A2C80D7BC7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <YiDQrN3t7lrVLSyP@fantomas.sk>
 <OSZP286MB16063B4FD8C9CA0DFC74C5D9C7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
Message-ID: <OSZP286MB16068B4C454A57B35A601436C7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>


Hi,

I tried your suggestions and it is the same result
first I deliberately put some erroreous config in squid.conff and it 
failed to start as a result.
When I ran it again by specifying the default config manually, it make 
no difference from before.

Many thinks for your help
root at vps:/etc/squid# squid -d1
2022/03/04 00:04:37| FATAL: http_port: missing Port: dfdf
2022/03/04 00:04:37| FATAL: Bungled /etc/squid/squid.conf line 1: 
http_port dfdf
2022/03/04 00:04:37| Squid Cache (Version 4.17): Terminated abnormally.
CPU Usage: 0.005 seconds = 0.000 user + 0.005 sys
Maximum Resident Size: 54160 KB
Page faults with physical i/o: 1
root at vps3:/etc/squid# squid -N -d1 -f /etc/squid/squid.conf.saved
2022/03/04 00:05:32| Created PID file (/var/run/squid.pid)
2022/03/04 00:05:32| Set Current Directory to /var/cache/squid
2022/03/04 00:05:32| Starting Squid Cache version 4.17 for 
x86_64-pc-linux-gnu...
2022/03/04 00:05:32| Service Name: squid
2022/03/04 00:05:32| Process ID 384315
2022/03/04 00:05:32| Process Roles: master worker
2022/03/04 00:05:32| With 1024 file descriptors available
2022/03/04 00:05:32| Initializing IP Cache...
2022/03/04 00:05:32| DNS Socket created at [::], FD 3
2022/03/04 00:05:32| DNS Socket created at 0.0.0.0, FD 9
2022/03/04 00:05:32| Adding nameserver 8.8.8.8 from /etc/resolv.conf
2022/03/04 00:05:32| Logfile: opening log daemon:/var/log/access.log
2022/03/04 00:05:32| Logfile Daemon: opening log /var/log/access.log
2022/03/04 00:05:32| Local cache digest enabled; rebuild/rewrite every 
3600/3600 sec
2022/03/04 00:05:32| Store logging disabled
2022/03/04 00:05:32| Swap maxSize 0 + 262144 KB, estimated 20164 objects
2022/03/04 00:05:32| Target number of buckets: 1008
2022/03/04 00:05:32| Using 8192 Store buckets
2022/03/04 00:05:32| Max Mem? size: 262144 KB
2022/03/04 00:05:32| Max Swap size: 0 KB
2022/03/04 00:05:32| Using Least Load store dir selection
2022/03/04 00:05:32| Set Current Directory to /var/cache/squid
2022/03/04 00:05:32| Finished loading MIME types and icons.
2022/03/04 00:05:32| HTCP Disabled.
>
>
> -- 
> Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
> Warning: I wish NOT to receive e-mail advertising to this address.
> Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
> I don't have lysdexia. The Dog wouldn't allow that.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220304/adb38dcf/attachment.htm>

From rousskov at measurement-factory.com  Thu Mar  3 19:39:30 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Thu, 3 Mar 2022 14:39:30 -0500
Subject: [squid-users] SQUID refuses to listen on any TCP Port
In-Reply-To: <OSZP286MB16068B4C454A57B35A601436C7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
References: <OSZP286MB1606426763752532E3AD7D5AC7039@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <ef2125f0-3241-6440-903f-7b182e28527c@measurement-factory.com>
 <OSZP286MB160680B3FDD5D5D7197EAFAEC7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <78f95f39-3c90-c1e8-6ee8-603bd6beda6c@treenet.co.nz>
 <OSZP286MB1606BD8554AF8244A2C80D7BC7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <YiDQrN3t7lrVLSyP@fantomas.sk>
 <OSZP286MB16063B4FD8C9CA0DFC74C5D9C7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <OSZP286MB16068B4C454A57B35A601436C7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
Message-ID: <59df0b4a-01e7-9439-9945-ae04c95323f0@measurement-factory.com>

On 3/3/22 11:12, ben wrote:

> I tried your suggestions and it is the same result
> first I deliberately put some erroreous config in squid.conff and it 
> failed to start as a result.
> When I ran it again by specifying the default config manually, it make 
> no difference from before.

There is a difference, but apparently not in the final outcome.

Please use the following or equivalent command to start your Squid with 
debugging enabled (-X), wait ~30 seconds, and then press Control-C (to 
kill the running Squid process if it is running), compress, and share a 
pointer to the resulting stderr output captured in the 
/tmp/debugging.log file.

     squid -X -N -d9 -f /etc/squid/squid.conf.saved 2> /tmp/debugging.log

It is best to use default Squid configuration for this triage in order 
to reduce the chances of sharing sensitive information in that debugging 
log.

Alex.


From squid3 at treenet.co.nz  Fri Mar  4 04:29:35 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 4 Mar 2022 17:29:35 +1300
Subject: [squid-users] SQUID refuses to listen on any TCP Port
In-Reply-To: <003c01d82ef4$dfc30eb0$9f492c10$@gmail.com>
References: <OSZP286MB1606426763752532E3AD7D5AC7039@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <ef2125f0-3241-6440-903f-7b182e28527c@measurement-factory.com>
 <OSZP286MB160680B3FDD5D5D7197EAFAEC7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <78f95f39-3c90-c1e8-6ee8-603bd6beda6c@treenet.co.nz>
 <003c01d82ef4$dfc30eb0$9f492c10$@gmail.com>
Message-ID: <fa68b1f4-aa47-f808-31d5-db18d1002c58@treenet.co.nz>

On 4/03/22 00:50, Eliezer Croitoru wrote:
> Should "squid -kparse" be of help for such a scenario?

Ideally, but it depends on what the exact cause is. The purpose of 
"-kparse" is to find errors that a startup would show anyway, but 
without actually needing a running proxy.

Nothing being visible at all in cache.log indicates Squid has no 
specific check for the situation yet.


> Else then using the default squid.conf it would be helpful to explain what are the basic squid.conf that is required for squid to run.
> I believe that a wiki/doc about this would be nice (volunteering to write a draft later on)
> 

The bundled QUICKSTART file is supposed to be that first-time basic intro.

FYI; wiki is being overhauled by kinkie right now :-). If you do any 
significant update please ping him with details. Cheers


Amos


From freefallbenson at hotmail.com  Fri Mar  4 11:11:19 2022
From: freefallbenson at hotmail.com (ben)
Date: Fri, 4 Mar 2022 19:11:19 +0800
Subject: [squid-users] SQUID refuses to listen on any TCP Port
In-Reply-To: <59df0b4a-01e7-9439-9945-ae04c95323f0@measurement-factory.com>
References: <OSZP286MB1606426763752532E3AD7D5AC7039@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <ef2125f0-3241-6440-903f-7b182e28527c@measurement-factory.com>
 <OSZP286MB160680B3FDD5D5D7197EAFAEC7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <78f95f39-3c90-c1e8-6ee8-603bd6beda6c@treenet.co.nz>
 <OSZP286MB1606BD8554AF8244A2C80D7BC7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <YiDQrN3t7lrVLSyP@fantomas.sk>
 <OSZP286MB16063B4FD8C9CA0DFC74C5D9C7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <OSZP286MB16068B4C454A57B35A601436C7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <59df0b4a-01e7-9439-9945-ae04c95323f0@measurement-factory.com>
Message-ID: <OSZP286MB1606D3618BE6836F1CDC3C8EC7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>

Hi,

I've done this and uploaded the log. Please take a look at it. Thank you

https://www.dropbox.com/s/k8nwdjs7bly4exw/squid.log.gz

> On 3/3/22 11:12, ben wrote:
>
>> I tried your suggestions and it is the same result
>> first I deliberately put some erroreous config in squid.conff and it 
>> failed to start as a result.
>> When I ran it again by specifying the default config manually, it 
>> make no difference from before.
>
> There is a difference, but apparently not in the final outcome.
>
> Please use the following or equivalent command to start your Squid 
> with debugging enabled (-X), wait ~30 seconds, and then press 
> Control-C (to kill the running Squid process if it is running), 
> compress, and share a pointer to the resulting stderr output captured 
> in the /tmp/debugging.log file.
>
> ??? squid -X -N -d9 -f /etc/squid/squid.conf.saved 2> /tmp/debugging.log
>
> It is best to use default Squid configuration for this triage in order 
> to reduce the chances of sharing sensitive information in that 
> debugging log.
>
> Alex.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users


From squid3 at treenet.co.nz  Fri Mar  4 13:18:44 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 5 Mar 2022 02:18:44 +1300
Subject: [squid-users] SQUID refuses to listen on any TCP Port
In-Reply-To: <OSZP286MB1606D3618BE6836F1CDC3C8EC7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
References: <OSZP286MB1606426763752532E3AD7D5AC7039@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <ef2125f0-3241-6440-903f-7b182e28527c@measurement-factory.com>
 <OSZP286MB160680B3FDD5D5D7197EAFAEC7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <78f95f39-3c90-c1e8-6ee8-603bd6beda6c@treenet.co.nz>
 <OSZP286MB1606BD8554AF8244A2C80D7BC7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <YiDQrN3t7lrVLSyP@fantomas.sk>
 <OSZP286MB16063B4FD8C9CA0DFC74C5D9C7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <OSZP286MB16068B4C454A57B35A601436C7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <59df0b4a-01e7-9439-9945-ae04c95323f0@measurement-factory.com>
 <OSZP286MB1606D3618BE6836F1CDC3C8EC7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
Message-ID: <79f61cf8-4e8b-fbff-b99a-7e6f009ae932@treenet.co.nz>

On 5/03/22 00:11, ben wrote:
> Hi,
> 
> I've done this and uploaded the log. Please take a look at it. Thank you
> 
> https://www.dropbox.com/s/k8nwdjs7bly4exw/squid.log.gz
> 

This log shows port 3128 being opened, right at the end.


2022/03/04 18:12:54.537| 33,2| AsyncCall.cc(25) AsyncCall: The AsyncCall 
clientListenerConnectionOpened constructed, this=0x5579e31de710 [call3]
...

2022/03/04 18:12:54.537| 54,3| StartListening.cc(58) StartListening: 
opened listen local=[::]:3128 remote=[::] FD 12 flags=9

2022/03/04 18:12:54.537| 33,2| AsyncCall.cc(92) ScheduleCall: 
StartListening.cc(59) will call 
clientListenerConnectionOpened(local=[::]:3128 remote=[::] FD 12 
flags=9, err=0, HTTP Socket port=0x5579e31de770) [call3]


Amos


From freefallbenson at hotmail.com  Fri Mar  4 14:23:32 2022
From: freefallbenson at hotmail.com (ben)
Date: Fri, 4 Mar 2022 22:23:32 +0800
Subject: [squid-users] SQUID refuses to listen on any TCP Port
In-Reply-To: <79f61cf8-4e8b-fbff-b99a-7e6f009ae932@treenet.co.nz>
References: <OSZP286MB1606426763752532E3AD7D5AC7039@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <ef2125f0-3241-6440-903f-7b182e28527c@measurement-factory.com>
 <OSZP286MB160680B3FDD5D5D7197EAFAEC7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <78f95f39-3c90-c1e8-6ee8-603bd6beda6c@treenet.co.nz>
 <OSZP286MB1606BD8554AF8244A2C80D7BC7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <YiDQrN3t7lrVLSyP@fantomas.sk>
 <OSZP286MB16063B4FD8C9CA0DFC74C5D9C7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <OSZP286MB16068B4C454A57B35A601436C7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <59df0b4a-01e7-9439-9945-ae04c95323f0@measurement-factory.com>
 <OSZP286MB1606D3618BE6836F1CDC3C8EC7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <79f61cf8-4e8b-fbff-b99a-7e6f009ae932@treenet.co.nz>
Message-ID: <OSZP286MB1606FFFEFBB7C6D3B72090D1C7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>

Hi,

But the sad fact is that there is an empty result when running netstat 
-tunpal | grep 3128. Nor can I telnet localhost 3128 successfully.Any 
idea what it is going on? Thank you!

? 2022/3/4 21:18, Amos Jeffries :
> This log shows port 3128 being opened, right at the end.
>
>
> 2022/03/04 18:12:54.537| 33,2| AsyncCall.cc(25) AsyncCall: The 
> AsyncCall clientListenerConnectionOpened constructed, 
> this=0x5579e31de710 [call3]
> ...
>
> 2022/03/04 18:12:54.537| 54,3| StartListening.cc(58) StartListening: 
> opened listen local=[::]:3128 remote=[::] FD 12 flags=9
>
> 2022/03/04 18:12:54.537| 33,2| AsyncCall.cc(92) ScheduleCall: 
> StartListening.cc(59) will call 
> clientListenerConnectionOpened(local=[::]:3128 remote=[::] FD 12 
> flags=9, err=0, HTTP Socket port=0x5579e31de770) [call3]
>
>
> Amos 


From ngtech1ltd at gmail.com  Fri Mar  4 14:41:16 2022
From: ngtech1ltd at gmail.com (Eliezer Croitoru)
Date: Fri, 4 Mar 2022 16:41:16 +0200
Subject: [squid-users] SQUID refuses to listen on any TCP Port
In-Reply-To: <OSZP286MB1606FFFEFBB7C6D3B72090D1C7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
References: <OSZP286MB1606426763752532E3AD7D5AC7039@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <ef2125f0-3241-6440-903f-7b182e28527c@measurement-factory.com>
 <OSZP286MB160680B3FDD5D5D7197EAFAEC7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <78f95f39-3c90-c1e8-6ee8-603bd6beda6c@treenet.co.nz>
 <OSZP286MB1606BD8554AF8244A2C80D7BC7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <YiDQrN3t7lrVLSyP@fantomas.sk>
 <OSZP286MB16063B4FD8C9CA0DFC74C5D9C7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <OSZP286MB16068B4C454A57B35A601436C7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <59df0b4a-01e7-9439-9945-ae04c95323f0@measurement-factory.com>
 <OSZP286MB1606D3618BE6836F1CDC3C8EC7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <79f61cf8-4e8b-fbff-b99a-7e6f009ae932@treenet.co.nz>
 <OSZP286MB1606FFFEFBB7C6D3B72090D1C7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
Message-ID: <000001d82fd5$e853dfa0$b8fb9ee0$@gmail.com>

Do you want to try another version of squid that was compiled by me?

All The Bests,
Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of ben
Sent: Friday, March 4, 2022 16:24
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] SQUID refuses to listen on any TCP Port

Hi,

But the sad fact is that there is an empty result when running netstat 
-tunpal | grep 3128. Nor can I telnet localhost 3128 successfully.Any 
idea what it is going on? Thank you!

? 2022/3/4 21:18, Amos Jeffries :
> This log shows port 3128 being opened, right at the end.
>
>
> 2022/03/04 18:12:54.537| 33,2| AsyncCall.cc(25) AsyncCall: The 
> AsyncCall clientListenerConnectionOpened constructed, 
> this=0x5579e31de710 [call3]
> ...
>
> 2022/03/04 18:12:54.537| 54,3| StartListening.cc(58) StartListening: 
> opened listen local=[::]:3128 remote=[::] FD 12 flags=9
>
> 2022/03/04 18:12:54.537| 33,2| AsyncCall.cc(92) ScheduleCall: 
> StartListening.cc(59) will call 
> clientListenerConnectionOpened(local=[::]:3128 remote=[::] FD 12 
> flags=9, err=0, HTTP Socket port=0x5579e31de770) [call3]
>
>
> Amos 
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From freefallbenson at hotmail.com  Fri Mar  4 14:45:01 2022
From: freefallbenson at hotmail.com (ben)
Date: Fri, 4 Mar 2022 22:45:01 +0800
Subject: [squid-users] SQUID refuses to listen on any TCP Port
In-Reply-To: <000001d82fd5$e853dfa0$b8fb9ee0$@gmail.com>
References: <OSZP286MB1606426763752532E3AD7D5AC7039@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <ef2125f0-3241-6440-903f-7b182e28527c@measurement-factory.com>
 <OSZP286MB160680B3FDD5D5D7197EAFAEC7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <78f95f39-3c90-c1e8-6ee8-603bd6beda6c@treenet.co.nz>
 <OSZP286MB1606BD8554AF8244A2C80D7BC7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <YiDQrN3t7lrVLSyP@fantomas.sk>
 <OSZP286MB16063B4FD8C9CA0DFC74C5D9C7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <OSZP286MB16068B4C454A57B35A601436C7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <59df0b4a-01e7-9439-9945-ae04c95323f0@measurement-factory.com>
 <OSZP286MB1606D3618BE6836F1CDC3C8EC7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <79f61cf8-4e8b-fbff-b99a-7e6f009ae932@treenet.co.nz>
 <OSZP286MB1606FFFEFBB7C6D3B72090D1C7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <000001d82fd5$e853dfa0$b8fb9ee0$@gmail.com>
Message-ID: <OSZP286MB16061F1656E5EBB6DC973E4FC7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>

Hi,

Does it have ssl enabled? I use squid mainly as a https proxy server and 
the default version on ubuntu 20.04 doesn't have it. Thank you for being 
so kind

? 2022/3/4 22:41, Eliezer Croitoru
> Do you want to try another version of squid that was compiled by me?
>
> All The Bests,
> Eliezer


From uhlar at fantomas.sk  Fri Mar  4 15:07:34 2022
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Fri, 4 Mar 2022 16:07:34 +0100
Subject: [squid-users] log UUID
Message-ID: <YiIrNhvh1MpW+Uz7@fantomas.sk>

Hello,

I'm thinking about adding optional SSL parameters into logging, but not 
within standard access.log, extra lines might be better.

does squid have any UUID to log so I can pair log lines?

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Support bacteria - they're the only culture some people have.


From rousskov at measurement-factory.com  Fri Mar  4 15:32:00 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Fri, 4 Mar 2022 10:32:00 -0500
Subject: [squid-users] SQUID refuses to listen on any TCP Port
In-Reply-To: <OSZP286MB1606D3618BE6836F1CDC3C8EC7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
References: <OSZP286MB1606426763752532E3AD7D5AC7039@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <ef2125f0-3241-6440-903f-7b182e28527c@measurement-factory.com>
 <OSZP286MB160680B3FDD5D5D7197EAFAEC7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <78f95f39-3c90-c1e8-6ee8-603bd6beda6c@treenet.co.nz>
 <OSZP286MB1606BD8554AF8244A2C80D7BC7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <YiDQrN3t7lrVLSyP@fantomas.sk>
 <OSZP286MB16063B4FD8C9CA0DFC74C5D9C7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <OSZP286MB16068B4C454A57B35A601436C7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <59df0b4a-01e7-9439-9945-ae04c95323f0@measurement-factory.com>
 <OSZP286MB1606D3618BE6836F1CDC3C8EC7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
Message-ID: <2e950932-dc5a-dc9a-9347-9b254e0be6bc@measurement-factory.com>

On 3/4/22 06:11, ben wrote:

> I've done this and uploaded the log. Please take a look at it. Thank you
> https://www.dropbox.com/s/k8nwdjs7bly4exw/squid.log.gz

Did you wait a few seconds and then killed Squid? Or did Squid quit 
(i.e. gave back control to your terminal/console session) on its own?

It looks like your Squid process is being killed by something: The log 
is missing a debugging line that should have been there right after the 
last line logged. There are no particularly dangerous calls between 
those two debugging lines.

Can you start your Squid from gdb instead of the command line?

     sudo gdb --args squid -X -N -d9 -f ...
     (gdb) run

Alex.

>> On 3/3/22 11:12, ben wrote:
>>
>>> I tried your suggestions and it is the same result
>>> first I deliberately put some erroreous config in squid.conff and it 
>>> failed to start as a result.
>>> When I ran it again by specifying the default config manually, it 
>>> make no difference from before.
>>
>> There is a difference, but apparently not in the final outcome.
>>
>> Please use the following or equivalent command to start your Squid 
>> with debugging enabled (-X), wait ~30 seconds, and then press 
>> Control-C (to kill the running Squid process if it is running), 
>> compress, and share a pointer to the resulting stderr output captured 
>> in the /tmp/debugging.log file.
>>
>> ??? squid -X -N -d9 -f /etc/squid/squid.conf.saved 2> /tmp/debugging.log
>>
>> It is best to use default Squid configuration for this triage in order 
>> to reduce the chances of sharing sensitive information in that 
>> debugging log.
>>
>> Alex.
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



From rousskov at measurement-factory.com  Fri Mar  4 15:39:55 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Fri, 4 Mar 2022 10:39:55 -0500
Subject: [squid-users] log UUID
In-Reply-To: <YiIrNhvh1MpW+Uz7@fantomas.sk>
References: <YiIrNhvh1MpW+Uz7@fantomas.sk>
Message-ID: <6c577e04-961d-e813-733c-d5b070839e4b@measurement-factory.com>

On 3/4/22 10:07, Matus UHLAR - fantomas wrote:

> I'm thinking about adding optional SSL parameters into logging, but not 
> within standard access.log, extra lines might be better.
> 
> does squid have any UUID to log so I can pair log lines?

Not yet. We have an active project that adds UUID support. That project 
will not log anything, but it would be easier to add the corresponding 
transaction UUID logging support after that.

Meanwhile, you can generate UUIDs using an always-matching external ACL 
and log them using %note{myUUID_} or equivalent.


HTH,

Alex.


From david at articatech.com  Sat Mar  5 16:50:54 2022
From: david at articatech.com (David Touzeau)
Date: Sat, 5 Mar 2022 17:50:54 +0100
Subject: [squid-users] Squid 5.4 : ERR_PROTOCOL_UNKNOWN and
 exception=18686e4e
Message-ID: <19266859-ce10-7bda-b79c-d1e8ca17696e@articatech.com>

Hi

added? exterr="%err_code|%err_detail" in logging and result return some 
request with ERR_PROTOCOL_UNKNOWN|exception=18686e4e

1646498399.887 46 176.12.1.2 NONE_NONE/000 0 CONNECT 62.67.238.138:443 - 
HIER_NONE/-:- exterr="ERR_PROTOCOL_UNKNOWN|exception=18686e4e"

What does "exception=18686e4e" means, how to avoid/force squid to 
forward data ?

Does /on_unsupported_protocol /should fix this behavior ?

regards
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220305/cd399f72/attachment.htm>

From ngtech1ltd at gmail.com  Sat Mar  5 18:11:21 2022
From: ngtech1ltd at gmail.com (Eliezer Croitoru)
Date: Sat, 5 Mar 2022 20:11:21 +0200
Subject: [squid-users] SQUID refuses to listen on any TCP Port
In-Reply-To: <OSZP286MB16061F1656E5EBB6DC973E4FC7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
References: <OSZP286MB1606426763752532E3AD7D5AC7039@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <ef2125f0-3241-6440-903f-7b182e28527c@measurement-factory.com>
 <OSZP286MB160680B3FDD5D5D7197EAFAEC7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <78f95f39-3c90-c1e8-6ee8-603bd6beda6c@treenet.co.nz>
 <OSZP286MB1606BD8554AF8244A2C80D7BC7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <YiDQrN3t7lrVLSyP@fantomas.sk>
 <OSZP286MB16063B4FD8C9CA0DFC74C5D9C7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <OSZP286MB16068B4C454A57B35A601436C7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <59df0b4a-01e7-9439-9945-ae04c95323f0@measurement-factory.com>
 <OSZP286MB1606D3618BE6836F1CDC3C8EC7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <79f61cf8-4e8b-fbff-b99a-7e6f009ae932@treenet.co.nz>
 <OSZP286MB1606FFFEFBB7C6D3B72090D1C7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <000001d82fd5$e853dfa0$b8fb9ee0$@gmail.com>
 <OSZP286MB16061F1656E5EBB6DC973E4FC7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
Message-ID: <000001d830bc$6bca8910$435f9b30$@gmail.com>

My binaries include ssl bump.
I belive it will be good enough for your use case.
Just remember to first install squid package from ubuntu to make sure all dependencies are installed and only then use my binaries.
I still do not have an installation file but this will come later on in a form of a Makefile.
I will probably not provide a deb file since others do that better then me.

What you need is this file:
http://www.ngtech.co.il/repo/ubuntu/20.04/x86_64/squid-4.17-64-bin-stripped-only.tar

There are other files there as well but this is the latest version.
First untar the file into a temporary directory.
Then and only then you should install the relevant binaries and conf files to
their respective directories ie /etc/squid and /usr/sbin /usr/bin and /usr/share...

If you have any trouble let me know and I will try to help you if possible.

All The Bests,
Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of ben
Sent: Friday, March 4, 2022 16:45
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] SQUID refuses to listen on any TCP Port

Hi,

Does it have ssl enabled? I use squid mainly as a https proxy server and 
the default version on ubuntu 20.04 doesn't have it. Thank you for being 
so kind

? 2022/3/4 22:41, Eliezer Croitoru
> Do you want to try another version of squid that was compiled by me?
>
> All The Bests,
> Eliezer
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From 0xff1f at gmail.com  Sat Mar  5 18:43:09 2022
From: 0xff1f at gmail.com (Ahmad Alzaeem)
Date: Sat, 5 Mar 2022 13:43:09 -0500
Subject: [squid-users] is there any squid 4.x version has delay_pools
 working?
In-Reply-To: <006a01d82a04$4765cf80$d6316e80$@gmail.com>
References: <20220224122435.257ddc228d11dff7cd21285c@killthe.net>
 <1ac60e46-7f77-9bcc-72b2-92873d34eb41@measurement-factory.com>
 <20220224133856.b26137522496068ee70ea708@killthe.net>
 <e3380183-ef20-ca1f-54d6-4059cf7c3305@measurement-factory.com>
 <20220224154953.0623171e887350d6d5db2c08@killthe.net>
 <695E12D0-F862-4A17-9A41-D1D00BFB904C@gmail.com>
 <006a01d82a04$4765cf80$d6316e80$@gmail.com>
Message-ID: <5055BF2B-2286-49DA-879F-804ACDF9D355@gmail.com>

Hello ,

No SSL Pump .
we use CONNECTmethod.
squid accepts the directive, but it has no real affect.

the same config on 3.x worked fine.

Im sure 100 % , none of squid 4.x worked with delay pools with me.


Thanks 


> On Feb 24, 2022, at 11:58 PM, Eliezer Croitoru <ngtech1ltd at gmail.com> wrote:
> 
> Hey Ahmad,
>  
> Can you please give more details on the specific issue or issues you have verified in 4.17?
> What exactly doesn?t work in delay_pools? Plain HTTP download or upload speed?
> Is it only on HTTP or also on CONNECT or HTTPS or SSL-BUMP connections?
>  
> Eliezer
>  
> I was thinking about creating a webinar about Squid ssl(TLS) bump
>  
> ----
> Eliezer Croitoru
> NgTech, Tech Support
> Mobile: +972-5-28704261
> Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com>
>  
> From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Ahmad Alzaeem
> Sent: Friday, February 25, 2022 02:14
> To: squid-users at lists.squid-cache.org
> Subject: [squid-users] is there any squid 4.x version has delay_pools working?
>  
> I tried many squid 4.x versions and none of them has delay_pools to work .
> I have it to work on 3.x versions .
>  
> is there any specific 4.x version that ws tested with delay pools to work ?
>  
>  
> i would like to report it as bug at least in squid-4.17 <http://www.squid-cache.org/Versions/v4/squid-4.17-RELEASENOTES.html> which i tested today .
>  
> Regards 
>  
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org>
> http://lists.squid-cache.org/listinfo/squid-users <http://lists.squid-cache.org/listinfo/squid-users>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220305/c8d1b5b4/attachment.htm>

From squid3 at treenet.co.nz  Sat Mar  5 20:24:31 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sun, 6 Mar 2022 09:24:31 +1300
Subject: [squid-users] Squid 5.4 : ERR_PROTOCOL_UNKNOWN and
 exception=18686e4e
In-Reply-To: <19266859-ce10-7bda-b79c-d1e8ca17696e@articatech.com>
References: <19266859-ce10-7bda-b79c-d1e8ca17696e@articatech.com>
Message-ID: <321f59c9-894d-9075-f4c8-45271ac706f2@treenet.co.nz>

On 6/03/22 05:50, David Touzeau wrote:
> Hi
> 
> added? exterr="%err_code|%err_detail" in logging and result return some 
> request with ERR_PROTOCOL_UNKNOWN|exception=18686e4e
> 
> 1646498399.887 46 176.12.1.2 NONE_NONE/000 0 CONNECT 62.67.238.138:443 - 
> HIER_NONE/-:- exterr="ERR_PROTOCOL_UNKNOWN|exception=18686e4e"
> 
> What does "exception=18686e4e" means, how to avoid/force squid to 
> forward data ?
> 

It is an "exception ID which scripts/calc-must-ids.sh can map to a 
relevant source code location."


> Does /on_unsupported_protocol /should fix this behavior ?
> 

Probably. The error code is unknown/unsupported protocol.


Amos


From rousskov at measurement-factory.com  Sat Mar  5 21:07:24 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Sat, 5 Mar 2022 16:07:24 -0500
Subject: [squid-users] is there any squid 4.x version has delay_pools
 working?
In-Reply-To: <5055BF2B-2286-49DA-879F-804ACDF9D355@gmail.com>
References: <20220224122435.257ddc228d11dff7cd21285c@killthe.net>
 <1ac60e46-7f77-9bcc-72b2-92873d34eb41@measurement-factory.com>
 <20220224133856.b26137522496068ee70ea708@killthe.net>
 <e3380183-ef20-ca1f-54d6-4059cf7c3305@measurement-factory.com>
 <20220224154953.0623171e887350d6d5db2c08@killthe.net>
 <695E12D0-F862-4A17-9A41-D1D00BFB904C@gmail.com>
 <006a01d82a04$4765cf80$d6316e80$@gmail.com>
 <5055BF2B-2286-49DA-879F-804ACDF9D355@gmail.com>
Message-ID: <a29de087-00f1-f7a8-6b49-50e0c9069d5a@measurement-factory.com>

On 3/5/22 13:43, Ahmad Alzaeem wrote:
> Hello ,
> 
> No SSL Pump .
> we use CONNECTmethod.
> squid accepts the directive, but it has no real affect.
> 
> the same config on 3.x worked fine.
> 
> Im sure 100 % , none of squid 4.x worked with delay pools with me.

Sounds like Bug 4913 to me:
https://bugs.squid-cache.org/show_bug.cgi?id=4913

I do not know whether the latest summary there is still accurate, but I 
know that the underlying code is (still) badly broken.

Alex.



>> On Feb 24, 2022, at 11:58 PM, Eliezer Croitoru wrote:
>>
>> Hey Ahmad,
>> Can you please give more details on the specific issue or issues you 
>> have verified in 4.17?
>> What exactly doesn?t work in delay_pools? Plain HTTP download or 
>> upload speed?
>> Is it only on HTTP or also on CONNECT or HTTPS or SSL-BUMP connections?
>> Eliezer
>>
>>   * I was thinking about creating a webinar about Squid ssl(TLS) bump
>>
>> ----
>> Eliezer Croitoru
>> NgTech, Tech Support
>> Mobile: +972-5-28704261
>> Email:ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com>
>> *From:*squid-users <squid-users-bounces at lists.squid-cache.org 
>> <mailto:squid-users-bounces at lists.squid-cache.org>>*On Behalf Of*Ahmad 
>> Alzaeem
>> *Sent:*Friday, February 25, 2022 02:14
>> *To:*squid-users at lists.squid-cache.org 
>> <mailto:squid-users at lists.squid-cache.org>
>> *Subject:*[squid-users] is there any squid 4.x version has delay_pools 
>> working?
>> I tried many squid 4.x versions and none of them has delay_pools to work .
>> I have it to work on 3.x versions .
>> is there any specific 4.x version that ws tested with delay pools to 
>> work ?
>> i would like to report it as bug at least in squid-4.17 
>> <http://www.squid-cache.org/Versions/v4/squid-4.17-RELEASENOTES.html>?which 
>> i tested today .
>> Regards
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org 
>> <mailto:squid-users at lists.squid-cache.org>
>> http://lists.squid-cache.org/listinfo/squid-users 
>> <http://lists.squid-cache.org/listinfo/squid-users>
> 
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



From squid3 at treenet.co.nz  Sun Mar  6 02:08:09 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sun, 6 Mar 2022 15:08:09 +1300
Subject: [squid-users] Squid 5.4 : ERR_PROTOCOL_UNKNOWN and
 exception=18686e4e
In-Reply-To: <321f59c9-894d-9075-f4c8-45271ac706f2@treenet.co.nz>
References: <19266859-ce10-7bda-b79c-d1e8ca17696e@articatech.com>
 <321f59c9-894d-9075-f4c8-45271ac706f2@treenet.co.nz>
Message-ID: <228d31f9-30ad-0912-bf0e-8c0d5ca35d34@treenet.co.nz>

On 6/03/22 09:24, Amos Jeffries wrote:
> On 6/03/22 05:50, David Touzeau wrote:
>> Hi
>>
>> added? exterr="%err_code|%err_detail" in logging and result return 
>> some request with ERR_PROTOCOL_UNKNOWN|exception=18686e4e
>>
>> 1646498399.887 46 176.12.1.2 NONE_NONE/000 0 CONNECT 62.67.238.138:443 
>> - HIER_NONE/-:- exterr="ERR_PROTOCOL_UNKNOWN|exception=18686e4e"
>>
>> What does "exception=18686e4e" means, how to avoid/force squid to 
>> forward data ?
>>
> 
> It is an "exception ID which scripts/calc-must-ids.sh can map to a 
> relevant source code location."
> 

I have looked into the ID using that script and it appears to be the TLS 
record type having an unknown value.

To get any further figuring out what it is will require the actual 
value. There may be something in cache.log, hopefully using the same 
exception ID.


Amos


From freefallbenson at hotmail.com  Sun Mar  6 03:13:09 2022
From: freefallbenson at hotmail.com (ben)
Date: Sun, 6 Mar 2022 11:13:09 +0800
Subject: [squid-users] SQUID refuses to listen on any TCP Port
In-Reply-To: <000001d830bc$6bca8910$435f9b30$@gmail.com>
References: <OSZP286MB1606426763752532E3AD7D5AC7039@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <OSZP286MB160680B3FDD5D5D7197EAFAEC7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <78f95f39-3c90-c1e8-6ee8-603bd6beda6c@treenet.co.nz>
 <OSZP286MB1606BD8554AF8244A2C80D7BC7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <YiDQrN3t7lrVLSyP@fantomas.sk>
 <OSZP286MB16063B4FD8C9CA0DFC74C5D9C7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <OSZP286MB16068B4C454A57B35A601436C7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <59df0b4a-01e7-9439-9945-ae04c95323f0@measurement-factory.com>
 <OSZP286MB1606D3618BE6836F1CDC3C8EC7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <79f61cf8-4e8b-fbff-b99a-7e6f009ae932@treenet.co.nz>
 <OSZP286MB1606FFFEFBB7C6D3B72090D1C7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <000001d82fd5$e853dfa0$b8fb9ee0$@gmail.com>
 <OSZP286MB16061F1656E5EBB6DC973E4FC7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <000001d830bc$6bca8910$435f9b30$@gmail.com>
Message-ID: <OSZP286MB160693FFC1DFC7C8976245F2C7079@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>

Hi,Eliezer

Many thanks for your help. But sorry to tell you that it didn't work 
either. I've done with it and will try to use a different version of 
ubuntu. Thank you again!

? 2022/3/6 2:11, Eliezer Croitoru :
> My binaries include ssl bump.
> I belive it will be good enough for your use case.
> Just remember to first install squid package from ubuntu to make sure all dependencies are installed and only then use my binaries.
> I still do not have an installation file but this will come later on in a form of a Makefile.
> I will probably not provide a deb file since others do that better then me.
>
> What you need is this file:
> http://www.ngtech.co.il/repo/ubuntu/20.04/x86_64/squid-4.17-64-bin-stripped-only.tar
>
> There are other files there as well but this is the latest version.
> First untar the file into a temporary directory.
> Then and only then you should install the relevant binaries and conf files to
> their respective directories ie /etc/squid and /usr/sbin /usr/bin and /usr/share...
>
> If you have any trouble let me know and I will try to help you if possible.
>
> All The Bests,
> Eliezer
>
> ----
> Eliezer Croitoru
> NgTech, Tech Support
> Mobile: +972-5-28704261
> Email: ngtech1ltd at gmail.com
>
> -----Original Message-----
> From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of ben
> Sent: Friday, March 4, 2022 16:45
> To: squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] SQUID refuses to listen on any TCP Port
>
> Hi,
>
> Does it have ssl enabled? I use squid mainly as a https proxy server and
> the default version on ubuntu 20.04 doesn't have it. Thank you for being
> so kind
>
> ? 2022/3/4 22:41, Eliezer Croitoru
>> Do you want to try another version of squid that was compiled by me?
>>
>> All The Bests,
>> Eliezer
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users


From ngtech1ltd at gmail.com  Sun Mar  6 05:41:20 2022
From: ngtech1ltd at gmail.com (Eliezer Croitoru)
Date: Sun, 6 Mar 2022 07:41:20 +0200
Subject: [squid-users] SQUID refuses to listen on any TCP Port
In-Reply-To: <OSZP286MB160693FFC1DFC7C8976245F2C7079@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
References: <OSZP286MB1606426763752532E3AD7D5AC7039@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <OSZP286MB160680B3FDD5D5D7197EAFAEC7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <78f95f39-3c90-c1e8-6ee8-603bd6beda6c@treenet.co.nz>
 <OSZP286MB1606BD8554AF8244A2C80D7BC7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <YiDQrN3t7lrVLSyP@fantomas.sk>
 <OSZP286MB16063B4FD8C9CA0DFC74C5D9C7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <OSZP286MB16068B4C454A57B35A601436C7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <59df0b4a-01e7-9439-9945-ae04c95323f0@measurement-factory.com>
 <OSZP286MB1606D3618BE6836F1CDC3C8EC7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <79f61cf8-4e8b-fbff-b99a-7e6f009ae932@treenet.co.nz>
 <OSZP286MB1606FFFEFBB7C6D3B72090D1C7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <000001d82fd5$e853dfa0$b8fb9ee0$@gmail.com>
 <OSZP286MB16061F1656E5EBB6DC973E4FC7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <000001d830bc$6bca8910$435f9b30$@gmail.com>
 <OSZP286MB160693FFC1DFC7C8976245F2C7079@OSZP286MB1606.JPNP286.PROD.OUTLO
 OK.COM>
Message-ID: <000601d8311c$cfdd1ed0$6f975c70$@gmail.com>

Hey Ben,

If it doesn't work for you then you are clearly doing something wrong....

I can try to give you instructions on how to make it work 100% unless your setup is messed up or is not a plain ubuntu 20.04.
Is it a simple VM?

Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of ben
Sent: Sunday, March 6, 2022 05:13
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] SQUID refuses to listen on any TCP Port

Hi,Eliezer

Many thanks for your help. But sorry to tell you that it didn't work 
either. I've done with it and will try to use a different version of 
ubuntu. Thank you again!

? 2022/3/6 2:11, Eliezer Croitoru :
> My binaries include ssl bump.
> I belive it will be good enough for your use case.
> Just remember to first install squid package from ubuntu to make sure all dependencies are installed and only then use my binaries.
> I still do not have an installation file but this will come later on in a form of a Makefile.
> I will probably not provide a deb file since others do that better then me.
>
> What you need is this file:
> http://www.ngtech.co.il/repo/ubuntu/20.04/x86_64/squid-4.17-64-bin-stripped-only.tar
>
> There are other files there as well but this is the latest version.
> First untar the file into a temporary directory.
> Then and only then you should install the relevant binaries and conf files to
> their respective directories ie /etc/squid and /usr/sbin /usr/bin and /usr/share...
>
> If you have any trouble let me know and I will try to help you if possible.
>
> All The Bests,
> Eliezer
>
> ----
> Eliezer Croitoru
> NgTech, Tech Support
> Mobile: +972-5-28704261
> Email: ngtech1ltd at gmail.com
>
> -----Original Message-----
> From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of ben
> Sent: Friday, March 4, 2022 16:45
> To: squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] SQUID refuses to listen on any TCP Port
>
> Hi,
>
> Does it have ssl enabled? I use squid mainly as a https proxy server and
> the default version on ubuntu 20.04 doesn't have it. Thank you for being
> so kind
>
> ? 2022/3/4 22:41, Eliezer Croitoru
>> Do you want to try another version of squid that was compiled by me?
>>
>> All The Bests,
>> Eliezer
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From freefallbenson at hotmail.com  Sun Mar  6 05:50:55 2022
From: freefallbenson at hotmail.com (ben)
Date: Sun, 6 Mar 2022 13:50:55 +0800
Subject: [squid-users] SQUID refuses to listen on any TCP Port
In-Reply-To: <000601d8311c$cfdd1ed0$6f975c70$@gmail.com>
References: <OSZP286MB1606426763752532E3AD7D5AC7039@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <78f95f39-3c90-c1e8-6ee8-603bd6beda6c@treenet.co.nz>
 <OSZP286MB1606BD8554AF8244A2C80D7BC7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <YiDQrN3t7lrVLSyP@fantomas.sk>
 <OSZP286MB16063B4FD8C9CA0DFC74C5D9C7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <OSZP286MB16068B4C454A57B35A601436C7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <59df0b4a-01e7-9439-9945-ae04c95323f0@measurement-factory.com>
 <OSZP286MB1606D3618BE6836F1CDC3C8EC7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <79f61cf8-4e8b-fbff-b99a-7e6f009ae932@treenet.co.nz>
 <OSZP286MB1606FFFEFBB7C6D3B72090D1C7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <000001d82fd5$e853dfa0$b8fb9ee0$@gmail.com>
 <OSZP286MB16061F1656E5EBB6DC973E4FC7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <000001d830bc$6bca8910$435f9b30$@gmail.com>
 <OSZP286MB160693FFC1DFC7C8976245F2C7079@OSZP286MB1606.JPNP286.PROD.OUTLO
 OK.COM> <000601d8311c$cfdd1ed0$6f975c70$@gmail.com>
Message-ID: <OSZP286MB16062F5C437851E3E7CC1021C7079@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>


Hi Eliezer,

It is a KVM VPS server with ubuntu 20.04. I just reinstalled the whole 
operating sytem and started it from scratch but got the same result: No 
tcp port listening. I don't know if it is something wrong with the OS 
template. Please let me know what I need to do. Thank you!
> Hey Ben,
>
> If it doesn't work for you then you are clearly doing something wrong....
>
> I can try to give you instructions on how to make it work 100% unless your setup is messed up or is not a plain ubuntu 20.04.
> Is it a simple VM?
>
> Eliezer


From ngtech1ltd at gmail.com  Sun Mar  6 20:06:39 2022
From: ngtech1ltd at gmail.com (Eliezer Croitoru)
Date: Sun, 6 Mar 2022 22:06:39 +0200
Subject: [squid-users] SQUID refuses to listen on any TCP Port
In-Reply-To: <OSZP286MB16062F5C437851E3E7CC1021C7079@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
References: <OSZP286MB1606426763752532E3AD7D5AC7039@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <78f95f39-3c90-c1e8-6ee8-603bd6beda6c@treenet.co.nz>
 <OSZP286MB1606BD8554AF8244A2C80D7BC7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <YiDQrN3t7lrVLSyP@fantomas.sk>
 <OSZP286MB16063B4FD8C9CA0DFC74C5D9C7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <OSZP286MB16068B4C454A57B35A601436C7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <59df0b4a-01e7-9439-9945-ae04c95323f0@measurement-factory.com>
 <OSZP286MB1606D3618BE6836F1CDC3C8EC7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <79f61cf8-4e8b-fbff-b99a-7e6f009ae932@treenet.co.nz>
 <OSZP286MB1606FFFEFBB7C6D3B72090D1C7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <000001d82fd5$e853dfa0$b8fb9ee0$@gmail.com>
 <OSZP286MB16061F1656E5EBB6DC973E4FC7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <000001d830bc$6bca8910$435f9b30$@gmail.com>
 <OSZP286MB160693FFC1DFC7C8976245F2C7079@OSZP286MB1606.JPNP286.PROD.OUTLO
 OK.COM> <000601d8311c$cfdd1ed0$6f975c70$@gmail.com>
 <OSZP286MB16062F5C437851E3E
 7CC1021C7079@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
Message-ID: <000001d83195$b1cf4a70$156ddf50$@gmail.com>

Hey Ben,

I cannot tell you if there is something wrong with what you are doing or the
OS.
What I did was to install a basic squid on ubuntu 20.4 which comes with
version 4.10.
I shut down the current running suqid.
I took the /etc/squid/squid.conf file and left it with a single line.
After that I started squid with "systemctl start squid" and it seems to work
fine.
I shut down squid and downloaded my version and again left the squid.conf
with a single line.
Just.. adding the mime.conf into /etc/squid/ and it worked like a charm.
Try to use "ss -ntlp" instead of netstat.
You should first try this on a VM on you local desktop in virtualbox or
hyperv.

All The Bests,
Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of
ben
Sent: Sunday, March 6, 2022 07:51
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] SQUID refuses to listen on any TCP Port


Hi Eliezer,

It is a KVM VPS server with ubuntu 20.04. I just reinstalled the whole 
operating sytem and started it from scratch but got the same result: No 
tcp port listening. I don't know if it is something wrong with the OS 
template. Please let me know what I need to do. Thank you!
> Hey Ben,
>
> If it doesn't work for you then you are clearly doing something wrong....
>
> I can try to give you instructions on how to make it work 100% unless your
setup is messed up or is not a plain ubuntu 20.04.
> Is it a simple VM?
>
> Eliezer
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From belle at bazuin.nl  Mon Mar  7 08:18:56 2022
From: belle at bazuin.nl (=?windows-1252?Q?L.P.H._van_Belle?=)
Date: Mon, 7 Mar 2022 09:18:56 +0100
Subject: [squid-users] SQUID refuses to listen on any TCP Port
In-Reply-To: <000001d83195$b1cf4a70$156ddf50$@gmail.com>
References: <OSZP286MB16062F5C437851E3E7CC1021C7079@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
Message-ID: <vmime.6225bff0.7168.6a849f902907a6f0@ms249-lin-003.rotterdam.bazuin.nl>

If you guys want to test a 5.4 build.. 
I have a debian buster and bullseye squid 5.4 in my repo. 
A rebuild to ubuntu should be very simple. 

Add my repo with sources. 

echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/louis-van-belle.gpg] http://apt.van-belle.nl/debian/ bullseye-squid54 main" |\
 sudo tee -a /etc/apt/sources.list.d/van-belle.list 
echo "deb-src [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/louis-van-belle.gpg] http://apt.van-belle.nl/debian/ bullseye-squid54 main" |\
 sudo tee -a /etc/apt/sources.list.d/van-belle.list 

Most simple rebuild. 
apt update
apt-get source squid -b

You get squid and squid-openssl packages, install the squid-openssl for bump support. 


Greetz, 

Louis


> -----Oorspronkelijk bericht-----
> Van: squid-users 
> [mailto:squid-users-bounces at lists.squid-cache.org] Namens 
> Eliezer Croitoru
> Verzonden: zondag 6 maart 2022 21:07
> Aan: squid-users at lists.squid-cache.org
> Onderwerp: Re: [squid-users] SQUID refuses to listen on any TCP Port
> 
> Hey Ben,
> 
> I cannot tell you if there is something wrong with what you 
> are doing or the
> OS.
> What I did was to install a basic squid on ubuntu 20.4 which 
> comes with
> version 4.10.
> I shut down the current running suqid.
> I took the /etc/squid/squid.conf file and left it with a single line.
> After that I started squid with "systemctl start squid" and 
> it seems to work
> fine.
> I shut down squid and downloaded my version and again left 
> the squid.conf
> with a single line.
> Just.. adding the mime.conf into /etc/squid/ and it worked 
> like a charm.
> Try to use "ss -ntlp" instead of netstat.
> You should first try this on a VM on you local desktop in 
> virtualbox or
> hyperv.
> 
> All The Bests,
> Eliezer
> 
> ----
> Eliezer Croitoru
> NgTech, Tech Support
> Mobile: +972-5-28704261
> Email: ngtech1ltd at gmail.com
> 
> -----Original Message-----
> From: squid-users <squid-users-bounces at lists.squid-cache.org> 
> On Behalf Of
> ben
> Sent: Sunday, March 6, 2022 07:51
> To: squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] SQUID refuses to listen on any TCP Port
> 
> 
> Hi Eliezer,
> 
> It is a KVM VPS server with ubuntu 20.04. I just reinstalled 
> the whole 
> operating sytem and started it from scratch but got the same 
> result: No 
> tcp port listening. I don't know if it is something wrong with the OS 
> template. Please let me know what I need to do. Thank you!
> > Hey Ben,
> >
> > If it doesn't work for you then you are clearly doing 
> something wrong....
> >
> > I can try to give you instructions on how to make it work 
> 100% unless your
> setup is messed up or is not a plain ubuntu 20.04.
> > Is it a simple VM?
> >
> > Eliezer
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 
> 



From Ralf.Hildebrandt at charite.de  Mon Mar  7 08:25:14 2022
From: Ralf.Hildebrandt at charite.de (Ralf Hildebrandt)
Date: Mon, 7 Mar 2022 09:25:14 +0100
Subject: [squid-users] auto-generated release on
 http://www.squid-cache.org/Versions/v6/ somewhat stale?
Message-ID: <YiXBavzVJTLBakN9@charite.de>

Are the auto-generated releases on
http://www.squid-cache.org/Versions/v6/ 
simply broken or is there another reason for a recent tarball since
07.02.2022?

Ralf Hildebrandt
Charit? - Universit?tsmedizin Berlin
Gesch?ftsbereich IT | Abteilung Netzwerk

Campus Benjamin Franklin (CBF)
Haus I | 1. OG | Raum 105
Hindenburgdamm 30 | D-12203 Berlin

Tel. +49 30 450 570 155
ralf.hildebrandt at charite.de
https://www.charite.de


From squid3 at treenet.co.nz  Tue Mar  8 02:03:43 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 8 Mar 2022 15:03:43 +1300
Subject: [squid-users] auto-generated release on
 http://www.squid-cache.org/Versions/v6/ somewhat stale?
In-Reply-To: <YiXBavzVJTLBakN9@charite.de>
References: <YiXBavzVJTLBakN9@charite.de>
Message-ID: <d7583da2-dfd8-36e4-2ded-eb8089e1c1d4@treenet.co.nz>

On 7/03/22 21:25, Ralf Hildebrandt wrote:
> Are the auto-generated releases on
> http://www.squid-cache.org/Versions/v6/
> simply broken or is there another reason for a recent tarball since
> 07.02.2022?
> 

The snapshots only publish if our CI system confirms the code as working 
on a range of popular systems and compilers.
(<http://build.squid-cache.org/job/trunk-matrix/>)

A build fix for FreeBSD broke the build for Ubuntu Xenial clang. So the 
v6 development branch is not passing that check right now.
It is being worked on (slowly) at 
<https://github.com/squid-cache/squid/pull/986>.

All other OS and compilers appear fine. So I have now kicked a snapshot 
build to happen. It should show up in the next 24 hrs.

Amos


From acd at woods.net  Tue Mar  8 19:16:48 2022
From: acd at woods.net (Aaron Dewell)
Date: Tue, 8 Mar 2022 12:16:48 -0700
Subject: [squid-users] ssl_bump with parent cache
Message-ID: <CAE02DFF-21A4-4F38-955D-BAB1642F6301@getmailspring.com>


Hi all,
I'm trying to use these two features at the same time. The use case is pretty simple. I want to capture all traffic from a single source (a device of mine) to another squid proxy server and decrypt/log it. I'm using the Ubuntu 20 package of squid-ssl version 4.13.
Device -> ssl_bump proxy -> upstream proxy -> website
It was all successfully working without ssl_bump, so the cache_peer configuration works. One side note: the parent proxy is running on 443 without SSL (I believe - I don't run it but I've asked those that do for confirmation, but I do know it's a pretty standard destination proxy configuration).
The website itself is not directly accessible thus the upstream proxy is required.
Adding the ssl_bump configuration caused it to not work, with errors about SSL versions and "Error negotiating SSL connection on FD xx". My best guess is that it is attempting to establish an SSL connection to the upstream and failing.
acl step1 at_step SslBump1
ssl_bump peek step1
ssl_bump bump all
http_port 3128 ssl-bump cert=/var/lib/squid/ssl_cert/myCA.pem generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
tls_outgoing_options options=NO_SSLv3 flags=DON'T_VERIFY_PEER,DONT_VERIFY_DOMAIN cert=/var/lib/squid/ssl_cert/device.pem key=/var/lib/squid/ssl_cert/client.key

(client.key and client.pem are from the device and are needed due to the authentication of the session at the destination server. Also, I haven't looked at the packet logging yet. I assume that will be an easy addition once the setup works generally.)
However, my understanding is that the cache_peer configuration should NOT do TLS by default unless that was specified in the options, and I see no way to explicitly disable it.
So first question: is that assumption accurate? No TLS to the parent unless explicitly configured?
And if the ssl_bump configuration is causing it to attempt an upstream TLS connection, how can I force it off?
Anything here that I'm doing obviously wrong?

I appreciate any and all suggestions. Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220308/26f46b9d/attachment.htm>

From rousskov at measurement-factory.com  Tue Mar  8 20:43:46 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Tue, 8 Mar 2022 15:43:46 -0500
Subject: [squid-users] ssl_bump with parent cache
In-Reply-To: <CAE02DFF-21A4-4F38-955D-BAB1642F6301@getmailspring.com>
References: <CAE02DFF-21A4-4F38-955D-BAB1642F6301@getmailspring.com>
Message-ID: <1ba61eae-5f36-62ad-054a-e8194484c0ed@measurement-factory.com>

On 3/8/22 14:16, Aaron Dewell wrote:

> I'm trying to use these two features at the same time.? The use case is 
> pretty simple.? I want to capture all traffic from a single source (a 
> device of mine) to another squid proxy server and decrypt/log it.??? I'm 
> using the Ubuntu 20 package of squid-ssl version 4.13.
> 
> Device -> ssl_bump proxy -> upstream proxy -> website
> 
> It was all successfully working without ssl_bump, so the cache_peer 
> configuration works.? One side note: the parent proxy is running on 443 
> without SSL (I believe - I don't run it but I've asked those that do for 
> confirmation, but I do know it's a pretty standard destination proxy 
> configuration).
> 
> The website itself is not directly accessible thus the upstream proxy is 
> required.
> 
> Adding the ssl_bump configuration caused it to not work, with errors 
> about SSL versions and "Error negotiating SSL connection on FD xx".? My 
> best guess is that it is attempting to establish an SSL connection to 
> the upstream and failing.
> 
> acl step1 at_step SslBump1
> ssl_bump peek step1
> ssl_bump bump all
> http_port?3128 ssl-bump cert=/var/lib/squid/ssl_cert/myCA.pem 
> generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
> tls_outgoing_options options=NO_SSLv3 
> flags=DON'T_VERIFY_PEER,DONT_VERIFY_DOMAIN 
> cert=/var/lib/squid/ssl_cert/device.pem 
> key=/var/lib/squid/ssl_cert/client.key
> 
> (client.key and client.pem are from the device and are needed due to the 
> authentication of the session at the destination server.? Also, I 
> haven't looked at the packet logging yet. I assume that will be an easy 
> addition once the setup works generally.)
> 
> However, my understanding is that the cache_peer configuration should 
> NOT do TLS by default unless that was specified in the options, and I 
> see no way to explicitly disable it.
> 
> So first question: is that assumption accurate?? No TLS to the parent 
> unless explicitly configured?

Yes, that is correct: cache_peers are plain HTTP forward proxies unless 
explicitly configured otherwise. Their listening port value does carry 
any special meaning as far as Squid code is concerned.

However, it is very unusual to run a plain HTTP forward proxy on port 
443. That port may imply that your parent proxy is an HTTPS reverse 
proxy. If it is, you need to use originserver flag when configuring the 
corresponding cache_peer line. You can check by sending plain CONNECT 
requests to that upstream proxy using wget, curl, or some such. A 
reverse HTTPS proxy would reject such requests.


> if the ssl_bump configuration is causing it to attempt an upstream 
> TLS connection ...

Bugs notwithstanding, it should not.


> Anything here that I'm doing obviously wrong?

I see no red flags relevant to your specific question.

Does replacing "bump all" with "splice all" fix the problem? I realize 
that you do want to bump/see the device traffic, but I wonder whether 
the errors are not between Squid and the upstream proxy but Squid and 
the web site. Splicing would remove those errors while still keeping 
some SslBump code active.

Sharing a (pointer to compressed) libpcap packet capture and/or a 
(pointer to compressed) ALL,9 cache.log while reproducing the problem 
with a single transaction may help: 
https://wiki.squid-cache.org/SquidFaq/BugReporting#Debugging_a_single_transaction

Alex.


From acd at woods.net  Tue Mar  8 21:44:10 2022
From: acd at woods.net (Aaron Dewell)
Date: Tue, 8 Mar 2022 14:44:10 -0700
Subject: [squid-users] ssl_bump with parent cache
In-Reply-To: <1ba61eae-5f36-62ad-054a-e8194484c0ed@measurement-factory.com>
References: <1ba61eae-5f36-62ad-054a-e8194484c0ed@measurement-factory.com>
Message-ID: <C17056D9-5664-484C-A6F9-EE8358223779@getmailspring.com>


Hi Alex, thanks for your reply! I did get access to the parent proxy and my assumption was wrong, it's doing minimal bumping. Also, the reason it's on 443 is to operate on a "standard" port for firewalls.
The parent is doing peek and splice to an exact list of internal destinations. Specifically, peek step1 all, peek step2 allowed_sites, splice allowed_sites, terminate all. That shouldn't (to my imperfect knowledge) interfere with what I'm doing though.
That's a good idea to do splice only and see if that's successful. Trying to do too much at once! I'll see what that does, then try debug again. The debug output wasn't very helpful before, but stepwise may be better.
On Mar 8 2022, at 1:43 pm, Alex Rousskov <rousskov at measurement-factory.com> wrote:
> On 3/8/22 14:16, Aaron Dewell wrote:
>
> > I'm trying to use these two features at the same time. The use case is
> > pretty simple. I want to capture all traffic from a single source (a
> > device of mine) to another squid proxy server and decrypt/log it. I'm
> > using the Ubuntu 20 package of squid-ssl version 4.13.
> >
> > Device -> ssl_bump proxy -> upstream proxy -> website
> >
> > It was all successfully working without ssl_bump, so the cache_peer
> > configuration works. One side note: the parent proxy is running on 443
> > without SSL (I believe - I don't run it but I've asked those that do for
> > confirmation, but I do know it's a pretty standard destination proxy
> > configuration).
> >
> > The website itself is not directly accessible thus the upstream proxy is
> > required.
> >
> > Adding the ssl_bump configuration caused it to not work, with errors
> > about SSL versions and "Error negotiating SSL connection on FD xx". My
> > best guess is that it is attempting to establish an SSL connection to
> > the upstream and failing.
> >
> > acl step1 at_step SslBump1
> > ssl_bump peek step1
> > ssl_bump bump all
> > http_port 3128 ssl-bump cert=/var/lib/squid/ssl_cert/myCA.pem
> > generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
> > tls_outgoing_options options=NO_SSLv3
> > flags=DON'T_VERIFY_PEER,DONT_VERIFY_DOMAIN
> > cert=/var/lib/squid/ssl_cert/device.pem
> > key=/var/lib/squid/ssl_cert/client.key
> >
> > (client.key and client.pem are from the device and are needed due to the
> > authentication of the session at the destination server. Also, I
> > haven't looked at the packet logging yet. I assume that will be an easy
> > addition once the setup works generally.)
> >
> > However, my understanding is that the cache_peer configuration should
> > NOT do TLS by default unless that was specified in the options, and I
> > see no way to explicitly disable it.
> >
> > So first question: is that assumption accurate? No TLS to the parent
> > unless explicitly configured?
>
> Yes, that is correct: cache_peers are plain HTTP forward proxies unless
> explicitly configured otherwise. Their listening port value does carry
> any special meaning as far as Squid code is concerned.
>
> However, it is very unusual to run a plain HTTP forward proxy on port
> 443. That port may imply that your parent proxy is an HTTPS reverse
> proxy. If it is, you need to use originserver flag when configuring the
> corresponding cache_peer line. You can check by sending plain CONNECT
> requests to that upstream proxy using wget, curl, or some such. A
> reverse HTTPS proxy would reject such requests.
>
>
> > if the ssl_bump configuration is causing it to attempt an upstream
> > TLS connection ...
>
> Bugs notwithstanding, it should not.
>
> > Anything here that I'm doing obviously wrong?
> I see no red flags relevant to your specific question.
> Does replacing "bump all" with "splice all" fix the problem? I realize
> that you do want to bump/see the device traffic, but I wonder whether
> the errors are not between Squid and the upstream proxy but Squid and
> the web site. Splicing would remove those errors while still keeping
> some SslBump code active.
>
> Sharing a (pointer to compressed) libpcap packet capture and/or a
> (pointer to compressed) ALL,9 cache.log while reproducing the problem
> with a single transaction may help:
> https://wiki.squid-cache.org/SquidFaq/BugReporting#Debugging_a_single_transaction
>
> Alex.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220308/49d7ab61/attachment.htm>

From rousskov at measurement-factory.com  Tue Mar  8 21:57:36 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Tue, 8 Mar 2022 16:57:36 -0500
Subject: [squid-users] ssl_bump with parent cache
In-Reply-To: <AA91D618-7909-45F0-B0EA-7543119978C6@getmailspring.com>
References: <1ba61eae-5f36-62ad-054a-e8194484c0ed@measurement-factory.com>
 <AA91D618-7909-45F0-B0EA-7543119978C6@getmailspring.com>
Message-ID: <f716fa4b-6dfe-925d-e5eb-550d3762eedc@measurement-factory.com>

On 3/8/22 16:38, Aaron Dewell wrote:

> Hi Alex, thanks for your reply!? I did get access to the parent proxy 
> and my assumption was wrong, it's doing minimal bumping.

TLS inspection at the parent proxy does not affect what I was trying to 
double check. What matters is whether it is a forward HTTP proxy (e.g., 
a Squid instance listening on an http_port configured without intercept, 
tproxy, or accel flags). It sounds like that is what it is. That's OK!

I do not remember whether your Squid version (v4.13) supports SslBump 
with parent forward proxies, but I believe modern Squids do, and we can 
assume that your Squid version does as well. The debugging should show 
whether that is indeed the case.


> The parent is doing peek and splice to an exact list of internal 
> destinations.? Specifically, peek step1 all, peek step2 allowed_sites, 
> splice allowed_sites, terminate all.? That shouldn't (to my imperfect 
> knowledge) interfere with what I'm doing though.

Yes, assuming the parent does not terminate your Squid connections, of 
course (i.e. assuming connections from your Squid always match 
allowed_sites after step1 at the parent proxy).


> That's a good idea to do splice only and see if that's successful.  
> Trying to do too much at once!? I'll see what that does, then try debug 
> again.? The debug output wasn't very helpful before, but stepwise may be 
> more useful.

Just to clarify: The debugging output was not meant for you to 
interpret. A Squid developer should do that. It may contain sensitive 
details; it is best to not use anything but test traffic and test 
certificate keys when sharing ALL,9 output.

Alex.


> On Mar 8 2022, at 1:43 pm, Alex Rousskov  wrote:
> 
>     On 3/8/22 14:16, Aaron Dewell wrote:
> 
>      > I'm trying to use these two features at the same time.? The use
>     case is
>      > pretty simple.? I want to capture all traffic from a single source (a
>      > device of mine) to another squid proxy server and decrypt/log
>     it.??? I'm
>      > using the Ubuntu 20 package of squid-ssl version 4.13.
>      >
>      > Device -> ssl_bump proxy -> upstream proxy -> website
>      >
>      > It was all successfully working without ssl_bump, so the cache_peer
>      > configuration works.? One side note: the parent proxy is running
>     on 443
>      > without SSL (I believe - I don't run it but I've asked those that
>     do for
>      > confirmation, but I do know it's a pretty standard destination proxy
>      > configuration).
>      >
>      > The website itself is not directly accessible thus the upstream
>     proxy is
>      > required.
>      >
>      > Adding the ssl_bump configuration caused it to not work, with errors
>      > about SSL versions and "Error negotiating SSL connection on FD
>     xx".? My
>      > best guess is that it is attempting to establish an SSL connection to
>      > the upstream and failing.
>      >
>      > acl step1 at_step SslBump1
>      > ssl_bump peek step1
>      > ssl_bump bump all
>      > http_port?3128 ssl-bump cert=/var/lib/squid/ssl_cert/myCA.pem
>      > generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
>      > tls_outgoing_options options=NO_SSLv3
>      > flags=DON'T_VERIFY_PEER,DONT_VERIFY_DOMAIN
>      > cert=/var/lib/squid/ssl_cert/device.pem
>      > key=/var/lib/squid/ssl_cert/client.key
>      >
>      > (client.key and client.pem are from the device and are needed due
>     to the
>      > authentication of the session at the destination server.? Also, I
>      > haven't looked at the packet logging yet. I assume that will be
>     an easy
>      > addition once the setup works generally.)
>      >
>      > However, my understanding is that the cache_peer configuration should
>      > NOT do TLS by default unless that was specified in the options, and I
>      > see no way to explicitly disable it.
>      >
>      > So first question: is that assumption accurate?? No TLS to the parent
>      > unless explicitly configured?
> 
>     Yes, that is correct: cache_peers are plain HTTP forward proxies unless
>     explicitly configured otherwise. Their listening port value does carry
>     any special meaning as far as Squid code is concerned.
> 
>     However, it is very unusual to run a plain HTTP forward proxy on port
>     443. That port may imply that your parent proxy is an HTTPS reverse
>     proxy. If it is, you need to use originserver flag when configuring the
>     corresponding cache_peer line. You can check by sending plain CONNECT
>     requests to that upstream proxy using wget, curl, or some such. A
>     reverse HTTPS proxy would reject such requests.
> 
> 
>      > if the ssl_bump configuration is causing it to attempt an upstream
>      > TLS connection ...
> 
>     Bugs notwithstanding, it should not.
> 
> 
>      > Anything here that I'm doing obviously wrong?
> 
>     I see no red flags relevant to your specific question.
> 
>     Does replacing "bump all" with "splice all" fix the problem? I realize
>     that you do want to bump/see the device traffic, but I wonder whether
>     the errors are not between Squid and the upstream proxy but Squid and
>     the web site. Splicing would remove those errors while still keeping
>     some SslBump code active.
> 
>     Sharing a (pointer to compressed) libpcap packet capture and/or a
>     (pointer to compressed) ALL,9 cache.log while reproducing the problem
>     with a single transaction may help:
>     https://wiki.squid-cache.org/SquidFaq/BugReporting#Debugging_a_single_transaction
> 
>     Alex.
>     _______________________________________________
>     squid-users mailing list
>     squid-users at lists.squid-cache.org
>     http://lists.squid-cache.org/listinfo/squid-users
> 
> Sent from Mailspring



From acd at woods.net  Tue Mar  8 22:56:22 2022
From: acd at woods.net (Aaron Dewell)
Date: Tue, 8 Mar 2022 15:56:22 -0700
Subject: [squid-users] ssl_bump with parent cache
In-Reply-To: <f716fa4b-6dfe-925d-e5eb-550d3762eedc@measurement-factory.com>
References: <f716fa4b-6dfe-925d-e5eb-550d3762eedc@measurement-factory.com>
Message-ID: <E24BC440-52BA-431A-A9AC-A6C5A1958101@getmailspring.com>


Ok, with a bit more messing with it... Changing bump to splice does work:
ssl_bump splice all
Adding:
acl step2 at_step SslBump2
ssl_bump peek step1
ssl_bump peek step2
ssl_bump splice step2

Fails (back to the connection errors as with bump). My guess is that this means it can splice at step1 but not step 2, which I know is more intrusive.
This appears to be the relevant data from the log:
2022/03/08 14:35:47.644 kid1| 83,7| bio.cc(163) stateChanged: FD 10 now: 0x4004 TED (TLSv1.3 early data)
2022/03/08 14:35:47.644 kid1| 83,7| bio.cc(163) stateChanged: FD 10 now: 0x2002 SSLERR (error)
2022/03/08 14:35:47.644 kid1| Error negotiating SSL connection on FD 10: error:00000001:lib(0):func(0):reason(1) (1/-1)

at which point it starts freeing memory, etc.
On Mar 8 2022, at 2:57 pm, Alex Rousskov <rousskov at measurement-factory.com> wrote:
> On 3/8/22 16:38, Aaron Dewell wrote:
>
> > Hi Alex, thanks for your reply! I did get access to the parent proxy
> > and my assumption was wrong, it's doing minimal bumping.
>
> TLS inspection at the parent proxy does not affect what I was trying to
> double check. What matters is whether it is a forward HTTP proxy (e.g.,
> a Squid instance listening on an http_port configured without intercept,
> tproxy, or accel flags). It sounds like that is what it is. That's OK!
>
> I do not remember whether your Squid version (v4.13) supports SslBump
> with parent forward proxies, but I believe modern Squids do, and we can
> assume that your Squid version does as well. The debugging should show
> whether that is indeed the case.
>
>
> > The parent is doing peek and splice to an exact list of internal
> > destinations. Specifically, peek step1 all, peek step2 allowed_sites,
> > splice allowed_sites, terminate all. That shouldn't (to my imperfect
> > knowledge) interfere with what I'm doing though.
>
> Yes, assuming the parent does not terminate your Squid connections, of
> course (i.e. assuming connections from your Squid always match
> allowed_sites after step1 at the parent proxy).
>
>
> > That's a good idea to do splice only and see if that's successful.
> > Trying to do too much at once! I'll see what that does, then try debug
> > again. The debug output wasn't very helpful before, but stepwise may be
> > more useful.
>
> Just to clarify: The debugging output was not meant for you to
> interpret. A Squid developer should do that. It may contain sensitive
> details; it is best to not use anything but test traffic and test
> certificate keys when sharing ALL,9 output.
>
> Alex.
>
> > On Mar 8 2022, at 1:43 pm, Alex Rousskov wrote:
> >
> > On 3/8/22 14:16, Aaron Dewell wrote:
> >
> > > I'm trying to use these two features at the same time. The use
> > case is
> > > pretty simple. I want to capture all traffic from a single source (a
> > > device of mine) to another squid proxy server and decrypt/log
> > it. I'm
> > > using the Ubuntu 20 package of squid-ssl version 4.13.
> > >
> > > Device -> ssl_bump proxy -> upstream proxy -> website
> > >
> > > It was all successfully working without ssl_bump, so the cache_peer
> > > configuration works. One side note: the parent proxy is running
> > on 443
> > > without SSL (I believe - I don't run it but I've asked those that
> > do for
> > > confirmation, but I do know it's a pretty standard destination proxy
> > > configuration).
> > >
> > > The website itself is not directly accessible thus the upstream
> > proxy is
> > > required.
> > >
> > > Adding the ssl_bump configuration caused it to not work, with errors
> > > about SSL versions and "Error negotiating SSL connection on FD
> > xx". My
> > > best guess is that it is attempting to establish an SSL connection to
> > > the upstream and failing.
> > >
> > > acl step1 at_step SslBump1
> > > ssl_bump peek step1
> > > ssl_bump bump all
> > > http_port 3128 ssl-bump cert=/var/lib/squid/ssl_cert/myCA.pem
> > > generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
> > > tls_outgoing_options options=NO_SSLv3
> > > flags=DON'T_VERIFY_PEER,DONT_VERIFY_DOMAIN
> > > cert=/var/lib/squid/ssl_cert/device.pem
> > > key=/var/lib/squid/ssl_cert/client.key
> > >
> > > (client.key and client.pem are from the device and are needed due
> > to the
> > > authentication of the session at the destination server. Also, I
> > > haven't looked at the packet logging yet. I assume that will be
> > an easy
> > > addition once the setup works generally.)
> > >
> > > However, my understanding is that the cache_peer configuration should
> > > NOT do TLS by default unless that was specified in the options, and I
> > > see no way to explicitly disable it.
> > >
> > > So first question: is that assumption accurate? No TLS to the parent
> > > unless explicitly configured?
> >
> > Yes, that is correct: cache_peers are plain HTTP forward proxies unless
> > explicitly configured otherwise. Their listening port value does carry
> > any special meaning as far as Squid code is concerned.
> >
> > However, it is very unusual to run a plain HTTP forward proxy on port
> > 443. That port may imply that your parent proxy is an HTTPS reverse
> > proxy. If it is, you need to use originserver flag when configuring the
> > corresponding cache_peer line. You can check by sending plain CONNECT
> > requests to that upstream proxy using wget, curl, or some such. A
> > reverse HTTPS proxy would reject such requests.
> >
> >
> > > if the ssl_bump configuration is causing it to attempt an upstream
> > > TLS connection ...
> >
> > Bugs notwithstanding, it should not.
> >
> >
> > > Anything here that I'm doing obviously wrong?
> >
> > I see no red flags relevant to your specific question.
> >
> > Does replacing "bump all" with "splice all" fix the problem? I realize
> > that you do want to bump/see the device traffic, but I wonder whether
> > the errors are not between Squid and the upstream proxy but Squid and
> > the web site. Splicing would remove those errors while still keeping
> > some SslBump code active.
> >
> > Sharing a (pointer to compressed) libpcap packet capture and/or a
> > (pointer to compressed) ALL,9 cache.log while reproducing the problem
> > with a single transaction may help:
> > https://wiki.squid-cache.org/SquidFaq/BugReporting#Debugging_a_single_transaction
> >
> > Alex.
> > _______________________________________________
> > squid-users mailing list
> > squid-users at lists.squid-cache.org
> > http://lists.squid-cache.org/listinfo/squid-users
> >
> > Sent from Mailspring
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220308/ebdf3508/attachment.htm>

From rousskov at measurement-factory.com  Tue Mar  8 23:16:27 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Tue, 8 Mar 2022 18:16:27 -0500
Subject: [squid-users] ssl_bump with parent cache
In-Reply-To: <E24BC440-52BA-431A-A9AC-A6C5A1958101@getmailspring.com>
References: <f716fa4b-6dfe-925d-e5eb-550d3762eedc@measurement-factory.com>
 <E24BC440-52BA-431A-A9AC-A6C5A1958101@getmailspring.com>
Message-ID: <f4d7a6b2-e24a-5eef-bbe8-70e50897c329@measurement-factory.com>

On 3/8/22 17:56, Aaron Dewell wrote:
> Ok, with a bit more messing with it...? Changing bump to splice does work:

> ssl_bump splice all

Noted.


> Adding:
> 
> acl step2 at_step SslBump2
> ssl_bump peek step1
> ssl_bump peek step2
> ssl_bump splice step2

The above is a bad configuration because no rule matches during step3.

Please try this configuration instead, to make sure you are not seeing a 
side effect of various Squid bugs related to such configurations (we are 
working on fixing them):

   ssl_bump peek all
   ssl_bump splice all

If the above fails, please see my earlier suggestions about sharing test 
artifacts. Otherwise, please try this:

   ssl_bump stare all
   ssl_bump bump all

If the above fails, please see my earlier suggestions about sharing test 
artifacts. Otherwise, please try this:

   ssl_bump peek step1
   ssl_bump bump all

If the above fails, please see my earlier suggestions about sharing test 
artifacts. Otherwise, you got a working config (which is the same config 
you have started with, so I doubt you will get to this stage!).


> This appears to be the relevant data from the log:
> 
> 2022/03/08 14:35:47.644 kid1| 83,7| bio.cc(163) stateChanged: FD 10 now: 0x4004 TED (TLSv1.3 early data)
> 2022/03/08 14:35:47.644 kid1| 83,7| bio.cc(163) stateChanged: FD 10 now: 0x2002 SSLERR (error)
> 2022/03/08 14:35:47.644 kid1| Error negotiating SSL connection on FD 10: error:00000001:lib(0):func(0):reason(1) (1/-1)

YMMV, but I will need to see a lot more lines surrounding this snippet 
to understand what exactly went wrong. That is why I am asking for the 
entire transaction log rather than selected "error" lines.

Sharing a packet capture might be sufficient if this is a basic 
misconfiguration error -- we will see wrong protocol traffic on one of 
both Squid sides. You can start with that (often, but not always, safer 
as far as sensitive info disclosure) step if you prefer.


HTH,

Alex.


> On Mar 8 2022, at 2:57 pm, Alex Rousskov wrote:
> 
>     On 3/8/22 16:38, Aaron Dewell wrote:
> 
>      > Hi Alex, thanks for your reply!? I did get access to the parent proxy
>      > and my assumption was wrong, it's doing minimal bumping.
> 
>     TLS inspection at the parent proxy does not affect what I was trying to
>     double check. What matters is whether it is a forward HTTP proxy (e.g.,
>     a Squid instance listening on an http_port configured without intercept,
>     tproxy, or accel flags). It sounds like that is what it is. That's OK!
> 
>     I do not remember whether your Squid version (v4.13) supports SslBump
>     with parent forward proxies, but I believe modern Squids do, and we can
>     assume that your Squid version does as well. The debugging should show
>     whether that is indeed the case.
> 
> 
>      > The parent is doing peek and splice to an exact list of internal
>      > destinations.? Specifically, peek step1 all, peek step2
>     allowed_sites,
>      > splice allowed_sites, terminate all.? That shouldn't (to my imperfect
>      > knowledge) interfere with what I'm doing though.
> 
>     Yes, assuming the parent does not terminate your Squid connections, of
>     course (i.e. assuming connections from your Squid always match
>     allowed_sites after step1 at the parent proxy).
> 
> 
>      > That's a good idea to do splice only and see if that's successful.
>      > Trying to do too much at once!? I'll see what that does, then try
>     debug
>      > again.? The debug output wasn't very helpful before, but stepwise
>     may be
>      > more useful.
> 
>     Just to clarify: The debugging output was not meant for you to
>     interpret. A Squid developer should do that. It may contain sensitive
>     details; it is best to not use anything but test traffic and test
>     certificate keys when sharing ALL,9 output.
> 
>     Alex.
> 
> 
>      > On Mar 8 2022, at 1:43 pm, Alex Rousskov wrote:
>      >
>      > On 3/8/22 14:16, Aaron Dewell wrote:
>      >
>      > > I'm trying to use these two features at the same time.? The use
>      > case is
>      > > pretty simple.? I want to capture all traffic from a single
>     source (a
>      > > device of mine) to another squid proxy server and decrypt/log
>      > it.??? I'm
>      > > using the Ubuntu 20 package of squid-ssl version 4.13.
>      > >
>      > > Device -> ssl_bump proxy -> upstream proxy -> website
>      > >
>      > > It was all successfully working without ssl_bump, so the cache_peer
>      > > configuration works.? One side note: the parent proxy is running
>      > on 443
>      > > without SSL (I believe - I don't run it but I've asked those that
>      > do for
>      > > confirmation, but I do know it's a pretty standard destination
>     proxy
>      > > configuration).
>      > >
>      > > The website itself is not directly accessible thus the upstream
>      > proxy is
>      > > required.
>      > >
>      > > Adding the ssl_bump configuration caused it to not work, with
>     errors
>      > > about SSL versions and "Error negotiating SSL connection on FD
>      > xx".? My
>      > > best guess is that it is attempting to establish an SSL
>     connection to
>      > > the upstream and failing.
>      > >
>      > > acl step1 at_step SslBump1
>      > > ssl_bump peek step1
>      > > ssl_bump bump all
>      > > http_port?3128 ssl-bump cert=/var/lib/squid/ssl_cert/myCA.pem
>      > > generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
>      > > tls_outgoing_options options=NO_SSLv3
>      > > flags=DON'T_VERIFY_PEER,DONT_VERIFY_DOMAIN
>      > > cert=/var/lib/squid/ssl_cert/device.pem
>      > > key=/var/lib/squid/ssl_cert/client.key
>      > >
>      > > (client.key and client.pem are from the device and are needed due
>      > to the
>      > > authentication of the session at the destination server.? Also, I
>      > > haven't looked at the packet logging yet. I assume that will be
>      > an easy
>      > > addition once the setup works generally.)
>      > >
>      > > However, my understanding is that the cache_peer configuration
>     should
>      > > NOT do TLS by default unless that was specified in the options,
>     and I
>      > > see no way to explicitly disable it.
>      > >
>      > > So first question: is that assumption accurate?? No TLS to the
>     parent
>      > > unless explicitly configured?
>      >
>      > Yes, that is correct: cache_peers are plain HTTP forward proxies
>     unless
>      > explicitly configured otherwise. Their listening port value does
>     carry
>      > any special meaning as far as Squid code is concerned.
>      >
>      > However, it is very unusual to run a plain HTTP forward proxy on port
>      > 443. That port may imply that your parent proxy is an HTTPS reverse
>      > proxy. If it is, you need to use originserver flag when
>     configuring the
>      > corresponding cache_peer line. You can check by sending plain CONNECT
>      > requests to that upstream proxy using wget, curl, or some such. A
>      > reverse HTTPS proxy would reject such requests.
>      >
>      >
>      > > if the ssl_bump configuration is causing it to attempt an upstream
>      > > TLS connection ...
>      >
>      > Bugs notwithstanding, it should not.
>      >
>      >
>      > > Anything here that I'm doing obviously wrong?
>      >
>      > I see no red flags relevant to your specific question.
>      >
>      > Does replacing "bump all" with "splice all" fix the problem? I
>     realize
>      > that you do want to bump/see the device traffic, but I wonder whether
>      > the errors are not between Squid and the upstream proxy but Squid and
>      > the web site. Splicing would remove those errors while still keeping
>      > some SslBump code active.
>      >
>      > Sharing a (pointer to compressed) libpcap packet capture and/or a
>      > (pointer to compressed) ALL,9 cache.log while reproducing the problem
>      > with a single transaction may help:
>      >
>     https://wiki.squid-cache.org/SquidFaq/BugReporting#Debugging_a_single_transaction
>      >
>      > Alex.
>      > _______________________________________________
>      > squid-users mailing list
>      > squid-users at lists.squid-cache.org
>      > http://lists.squid-cache.org/listinfo/squid-users
>      >
>      > Sent from Mailspring
> 
> Sent from Mailspring



From acd at woods.net  Wed Mar  9 21:16:14 2022
From: acd at woods.net (Aaron Dewell)
Date: Wed, 9 Mar 2022 14:16:14 -0700
Subject: [squid-users] ssl_bump with parent cache
In-Reply-To: <f4d7a6b2-e24a-5eef-bbe8-70e50897c329@measurement-factory.com>
References: <f4d7a6b2-e24a-5eef-bbe8-70e50897c329@measurement-factory.com>
Message-ID: <D38C42C1-291B-4932-9405-E8BA358DB29D@getmailspring.com>


So after a bit more experimentation. the difference in what works and what doesn't is:
ssl_bump peek step1
ssl_bump splice all

(working) and this not working:
ssl_bump peek all
ssl_bump splice all

I'm not clear on why peeking at "all" vs. "step1" would cause it to fail. However, I also note that not peeking at anything makes it work also (commenting out the "peek" line), so I'm suspicious that "peek step1" is effectively having it do nothing.
"stare step1" also works, but "stare all" does not (i.e. same result as "peek").
"stare step1" followed by "bump all" fails as well (i.e. changing "splice" to "bump"), as does "stare all/bump all".
I'm probably not going to be able to share any packet dumps so that does make things difficult. This device is under development and the details of "what it's doing" is likely to be sensitive. I appreciate that makes troubleshooting things difficult. What I could do is put a VM behind it and do manual wgets or something from it but that will take some changes to the environment, or perhaps just creating a new one to test this where this device isn't present. If that's where it needs to go, I'll have to start discussions on exactly how sensitive it is and/or start creating the new/modified setup.
Anyway, I do appreciate the suggestions, and the lightbulb is starting to go on, albeit dimly. :)
On Mar 8 2022, at 4:16 pm, Alex Rousskov <rousskov at measurement-factory.com> wrote:
> On 3/8/22 17:56, Aaron Dewell wrote:
> > Ok, with a bit more messing with it... Changing bump to splice does work:
>
> > ssl_bump splice all
> Noted.
>
> > Adding:
> >
> > acl step2 at_step SslBump2
> > ssl_bump peek step1
> > ssl_bump peek step2
> > ssl_bump splice step2
>
> The above is a bad configuration because no rule matches during step3.
> Please try this configuration instead, to make sure you are not seeing a
> side effect of various Squid bugs related to such configurations (we are
> working on fixing them):
>
> ssl_bump peek all
> ssl_bump splice all
>
> If the above fails, please see my earlier suggestions about sharing test
> artifacts. Otherwise, please try this:
>
> ssl_bump stare all
> ssl_bump bump all
>
> If the above fails, please see my earlier suggestions about sharing test
> artifacts. Otherwise, please try this:
>
> ssl_bump peek step1
> ssl_bump bump all
>
> If the above fails, please see my earlier suggestions about sharing test
> artifacts. Otherwise, you got a working config (which is the same config
> you have started with, so I doubt you will get to this stage!).
>
>
> > This appears to be the relevant data from the log:
> >
> > 2022/03/08 14:35:47.644 kid1| 83,7| bio.cc(163) stateChanged: FD 10 now: 0x4004 TED (TLSv1.3 early data)
> > 2022/03/08 14:35:47.644 kid1| 83,7| bio.cc(163) stateChanged: FD 10 now: 0x2002 SSLERR (error)
> > 2022/03/08 14:35:47.644 kid1| Error negotiating SSL connection on FD 10: error:00000001:lib(0):func(0):reason(1) (1/-1)
>
> YMMV, but I will need to see a lot more lines surrounding this snippet
> to understand what exactly went wrong. That is why I am asking for the
> entire transaction log rather than selected "error" lines.
>
> Sharing a packet capture might be sufficient if this is a basic
> misconfiguration error -- we will see wrong protocol traffic on one of
> both Squid sides. You can start with that (often, but not always, safer
> as far as sensitive info disclosure) step if you prefer.
>
>
> HTH,
> Alex.
>
> > On Mar 8 2022, at 2:57 pm, Alex Rousskov wrote:
> >
> > On 3/8/22 16:38, Aaron Dewell wrote:
> >
> > > Hi Alex, thanks for your reply! I did get access to the parent proxy
> > > and my assumption was wrong, it's doing minimal bumping.
> >
> > TLS inspection at the parent proxy does not affect what I was trying to
> > double check. What matters is whether it is a forward HTTP proxy (e.g.,
> > a Squid instance listening on an http_port configured without intercept,
> > tproxy, or accel flags). It sounds like that is what it is. That's OK!
> >
> > I do not remember whether your Squid version (v4.13) supports SslBump
> > with parent forward proxies, but I believe modern Squids do, and we can
> > assume that your Squid version does as well. The debugging should show
> > whether that is indeed the case.
> >
> >
> > > The parent is doing peek and splice to an exact list of internal
> > > destinations. Specifically, peek step1 all, peek step2
> > allowed_sites,
> > > splice allowed_sites, terminate all. That shouldn't (to my imperfect
> > > knowledge) interfere with what I'm doing though.
> >
> > Yes, assuming the parent does not terminate your Squid connections, of
> > course (i.e. assuming connections from your Squid always match
> > allowed_sites after step1 at the parent proxy).
> >
> >
> > > That's a good idea to do splice only and see if that's successful.
> > > Trying to do too much at once! I'll see what that does, then try
> > debug
> > > again. The debug output wasn't very helpful before, but stepwise
> > may be
> > > more useful.
> >
> > Just to clarify: The debugging output was not meant for you to
> > interpret. A Squid developer should do that. It may contain sensitive
> > details; it is best to not use anything but test traffic and test
> > certificate keys when sharing ALL,9 output.
> >
> > Alex.
> >
> >
> > > On Mar 8 2022, at 1:43 pm, Alex Rousskov wrote:
> > >
> > > On 3/8/22 14:16, Aaron Dewell wrote:
> > >
> > > > I'm trying to use these two features at the same time. The use
> > > case is
> > > > pretty simple. I want to capture all traffic from a single
> > source (a
> > > > device of mine) to another squid proxy server and decrypt/log
> > > it. I'm
> > > > using the Ubuntu 20 package of squid-ssl version 4.13.
> > > >
> > > > Device -> ssl_bump proxy -> upstream proxy -> website
> > > >
> > > > It was all successfully working without ssl_bump, so the cache_peer
> > > > configuration works. One side note: the parent proxy is running
> > > on 443
> > > > without SSL (I believe - I don't run it but I've asked those that
> > > do for
> > > > confirmation, but I do know it's a pretty standard destination
> > proxy
> > > > configuration).
> > > >
> > > > The website itself is not directly accessible thus the upstream
> > > proxy is
> > > > required.
> > > >
> > > > Adding the ssl_bump configuration caused it to not work, with
> > errors
> > > > about SSL versions and "Error negotiating SSL connection on FD
> > > xx". My
> > > > best guess is that it is attempting to establish an SSL
> > connection to
> > > > the upstream and failing.
> > > >
> > > > acl step1 at_step SslBump1
> > > > ssl_bump peek step1
> > > > ssl_bump bump all
> > > > http_port 3128 ssl-bump cert=/var/lib/squid/ssl_cert/myCA.pem
> > > > generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
> > > > tls_outgoing_options options=NO_SSLv3
> > > > flags=DON'T_VERIFY_PEER,DONT_VERIFY_DOMAIN
> > > > cert=/var/lib/squid/ssl_cert/device.pem
> > > > key=/var/lib/squid/ssl_cert/client.key
> > > >
> > > > (client.key and client.pem are from the device and are needed due
> > > to the
> > > > authentication of the session at the destination server. Also, I
> > > > haven't looked at the packet logging yet. I assume that will be
> > > an easy
> > > > addition once the setup works generally.)
> > > >
> > > > However, my understanding is that the cache_peer configuration
> > should
> > > > NOT do TLS by default unless that was specified in the options,
> > and I
> > > > see no way to explicitly disable it.
> > > >
> > > > So first question: is that assumption accurate? No TLS to the
> > parent
> > > > unless explicitly configured?
> > >
> > > Yes, that is correct: cache_peers are plain HTTP forward proxies
> > unless
> > > explicitly configured otherwise. Their listening port value does
> > carry
> > > any special meaning as far as Squid code is concerned.
> > >
> > > However, it is very unusual to run a plain HTTP forward proxy on port
> > > 443. That port may imply that your parent proxy is an HTTPS reverse
> > > proxy. If it is, you need to use originserver flag when
> > configuring the
> > > corresponding cache_peer line. You can check by sending plain CONNECT
> > > requests to that upstream proxy using wget, curl, or some such. A
> > > reverse HTTPS proxy would reject such requests.
> > >
> > >
> > > > if the ssl_bump configuration is causing it to attempt an upstream
> > > > TLS connection ...
> > >
> > > Bugs notwithstanding, it should not.
> > >
> > >
> > > > Anything here that I'm doing obviously wrong?
> > >
> > > I see no red flags relevant to your specific question.
> > >
> > > Does replacing "bump all" with "splice all" fix the problem? I
> > realize
> > > that you do want to bump/see the device traffic, but I wonder whether
> > > the errors are not between Squid and the upstream proxy but Squid and
> > > the web site. Splicing would remove those errors while still keeping
> > > some SslBump code active.
> > >
> > > Sharing a (pointer to compressed) libpcap packet capture and/or a
> > > (pointer to compressed) ALL,9 cache.log while reproducing the problem
> > > with a single transaction may help:
> > >
> > https://wiki.squid-cache.org/SquidFaq/BugReporting#Debugging_a_single_transaction
> > >
> > > Alex.
> > > _______________________________________________
> > > squid-users mailing list
> > > squid-users at lists.squid-cache.org
> > > http://lists.squid-cache.org/listinfo/squid-users
> > >
> > > Sent from Mailspring
> >
> > Sent from Mailspring
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220309/ea6f561b/attachment.htm>

From rousskov at measurement-factory.com  Wed Mar  9 21:43:10 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Wed, 9 Mar 2022 16:43:10 -0500
Subject: [squid-users] ssl_bump with parent cache
In-Reply-To: <D38C42C1-291B-4932-9405-E8BA358DB29D@getmailspring.com>
References: <f4d7a6b2-e24a-5eef-bbe8-70e50897c329@measurement-factory.com>
 <D38C42C1-291B-4932-9405-E8BA358DB29D@getmailspring.com>
Message-ID: <f575f3ea-8d18-8b19-eb53-6e2f16a47a5a@measurement-factory.com>

On 3/9/22 16:16, Aaron Dewell wrote:

> the difference in what works and what doesn't is:
> 
> ssl_bump peek step1
> ssl_bump splice all
> 
> (working) and this not working:
> 
> ssl_bump peek all
> ssl_bump splice all

... which, for comparison purposes, is equivalent to:

   ssl_bump peek step1
   ssl_bump peek step2
   ssl_bump splice all

In summary, bugs notwithstanding, the difference is in peeking at the 
server certificate (during step2). The working configuration does not 
look at the server certificate at all. The broken one does. Thus, 
something goes wrong when Squid tries to look at the server certificate 
and/or when Squid tries to deliver the problem it found (while looking 
at that server certificate) to the client.


> I'm probably not going to be able to share any packet dumps so that does 
> make things difficult.? This device is under development and the details 
> of "what it's doing" is likely to be sensitive.

Please keep in mind that HTTP traffic details would be encrypted and 
non-encrypted TCP/TLS details may not be worth protecting.


> I appreciate that makes 
> troubleshooting things difficult.? What I could do is put a VM behind it 
> and do manual wgets or something from it but that will take some changes 
> to the environment, or perhaps just creating a new one to test this 
> where this device isn't present.? If that's where it needs to go, I'll 
> have to start discussions on exactly how sensitive it is and/or start 
> creating the new/modified setup.

If you are feeling lucky, you can collect an ALL,9 cache.log from one 
transaction and grep for "check failed", "exception:", "FwdState", and 
"PeerConnector". Then see whether you can share (a pointer to a 
compressed file with) just the matching lines. It may take a few 
iterations...

You can also find a Squid developer you can trust who is willing to sign 
an NDA and look at your complete logs for a fee, of course.

Alex.


> On Mar 8 2022, at 4:16 pm, Alex Rousskov wrote:
> 
>     On 3/8/22 17:56, Aaron Dewell wrote:
>      > Ok, with a bit more messing with it...? Changing bump to splice
>     does work:
> 
>      > ssl_bump splice all
> 
>     Noted.
> 
> 
>      > Adding:
>      >
>      > acl step2 at_step SslBump2
>      > ssl_bump peek step1
>      > ssl_bump peek step2
>      > ssl_bump splice step2
> 
>     The above is a bad configuration because no rule matches during step3.
> 
>     Please try this configuration instead, to make sure you are not seeing a
>     side effect of various Squid bugs related to such configurations (we are
>     working on fixing them):
> 
>     ssl_bump peek all
>     ssl_bump splice all
> 
>     If the above fails, please see my earlier suggestions about sharing test
>     artifacts. Otherwise, please try this:
> 
>     ssl_bump stare all
>     ssl_bump bump all
> 
>     If the above fails, please see my earlier suggestions about sharing test
>     artifacts. Otherwise, please try this:
> 
>     ssl_bump peek step1
>     ssl_bump bump all
> 
>     If the above fails, please see my earlier suggestions about sharing test
>     artifacts. Otherwise, you got a working config (which is the same config
>     you have started with, so I doubt you will get to this stage!).
> 
> 
>      > This appears to be the relevant data from the log:
>      >
>      > 2022/03/08 14:35:47.644 kid1| 83,7| bio.cc(163) stateChanged: FD
>     10 now: 0x4004 TED (TLSv1.3 early data)
>      > 2022/03/08 14:35:47.644 kid1| 83,7| bio.cc(163) stateChanged: FD
>     10 now: 0x2002 SSLERR (error)
>      > 2022/03/08 14:35:47.644 kid1| Error negotiating SSL connection on
>     FD 10: error:00000001:lib(0):func(0):reason(1) (1/-1)
> 
>     YMMV, but I will need to see a lot more lines surrounding this snippet
>     to understand what exactly went wrong. That is why I am asking for the
>     entire transaction log rather than selected "error" lines.
> 
>     Sharing a packet capture might be sufficient if this is a basic
>     misconfiguration error -- we will see wrong protocol traffic on one of
>     both Squid sides. You can start with that (often, but not always, safer
>     as far as sensitive info disclosure) step if you prefer.
> 
> 
>     HTH,
> 
>     Alex.
> 
> 
>      > On Mar 8 2022, at 2:57 pm, Alex Rousskov wrote:
>      >
>      > On 3/8/22 16:38, Aaron Dewell wrote:
>      >
>      > > Hi Alex, thanks for your reply!? I did get access to the parent
>     proxy
>      > > and my assumption was wrong, it's doing minimal bumping.
>      >
>      > TLS inspection at the parent proxy does not affect what I was
>     trying to
>      > double check. What matters is whether it is a forward HTTP proxy
>     (e.g.,
>      > a Squid instance listening on an http_port configured without
>     intercept,
>      > tproxy, or accel flags). It sounds like that is what it is.
>     That's OK!
>      >
>      > I do not remember whether your Squid version (v4.13) supports SslBump
>      > with parent forward proxies, but I believe modern Squids do, and
>     we can
>      > assume that your Squid version does as well. The debugging should
>     show
>      > whether that is indeed the case.
>      >
>      >
>      > > The parent is doing peek and splice to an exact list of internal
>      > > destinations.? Specifically, peek step1 all, peek step2
>      > allowed_sites,
>      > > splice allowed_sites, terminate all.? That shouldn't (to my
>     imperfect
>      > > knowledge) interfere with what I'm doing though.
>      >
>      > Yes, assuming the parent does not terminate your Squid
>     connections, of
>      > course (i.e. assuming connections from your Squid always match
>      > allowed_sites after step1 at the parent proxy).
>      >
>      >
>      > > That's a good idea to do splice only and see if that's successful.
>      > > Trying to do too much at once!? I'll see what that does, then try
>      > debug
>      > > again.? The debug output wasn't very helpful before, but stepwise
>      > may be
>      > > more useful.
>      >
>      > Just to clarify: The debugging output was not meant for you to
>      > interpret. A Squid developer should do that. It may contain sensitive
>      > details; it is best to not use anything but test traffic and test
>      > certificate keys when sharing ALL,9 output.
>      >
>      > Alex.
>      >
>      >
>      > > On Mar 8 2022, at 1:43 pm, Alex Rousskov wrote:
>      > >
>      > > On 3/8/22 14:16, Aaron Dewell wrote:
>      > >
>      > > > I'm trying to use these two features at the same time.? The use
>      > > case is
>      > > > pretty simple.? I want to capture all traffic from a single
>      > source (a
>      > > > device of mine) to another squid proxy server and decrypt/log
>      > > it.??? I'm
>      > > > using the Ubuntu 20 package of squid-ssl version 4.13.
>      > > >
>      > > > Device -> ssl_bump proxy -> upstream proxy -> website
>      > > >
>      > > > It was all successfully working without ssl_bump, so the
>     cache_peer
>      > > > configuration works.? One side note: the parent proxy is running
>      > > on 443
>      > > > without SSL (I believe - I don't run it but I've asked those that
>      > > do for
>      > > > confirmation, but I do know it's a pretty standard destination
>      > proxy
>      > > > configuration).
>      > > >
>      > > > The website itself is not directly accessible thus the upstream
>      > > proxy is
>      > > > required.
>      > > >
>      > > > Adding the ssl_bump configuration caused it to not work, with
>      > errors
>      > > > about SSL versions and "Error negotiating SSL connection on FD
>      > > xx".? My
>      > > > best guess is that it is attempting to establish an SSL
>      > connection to
>      > > > the upstream and failing.
>      > > >
>      > > > acl step1 at_step SslBump1
>      > > > ssl_bump peek step1
>      > > > ssl_bump bump all
>      > > > http_port?3128 ssl-bump cert=/var/lib/squid/ssl_cert/myCA.pem
>      > > > generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
>      > > > tls_outgoing_options options=NO_SSLv3
>      > > > flags=DON'T_VERIFY_PEER,DONT_VERIFY_DOMAIN
>      > > > cert=/var/lib/squid/ssl_cert/device.pem
>      > > > key=/var/lib/squid/ssl_cert/client.key
>      > > >
>      > > > (client.key and client.pem are from the device and are needed due
>      > > to the
>      > > > authentication of the session at the destination server.? Also, I
>      > > > haven't looked at the packet logging yet. I assume that will be
>      > > an easy
>      > > > addition once the setup works generally.)
>      > > >
>      > > > However, my understanding is that the cache_peer configuration
>      > should
>      > > > NOT do TLS by default unless that was specified in the options,
>      > and I
>      > > > see no way to explicitly disable it.
>      > > >
>      > > > So first question: is that assumption accurate?? No TLS to the
>      > parent
>      > > > unless explicitly configured?
>      > >
>      > > Yes, that is correct: cache_peers are plain HTTP forward proxies
>      > unless
>      > > explicitly configured otherwise. Their listening port value does
>      > carry
>      > > any special meaning as far as Squid code is concerned.
>      > >
>      > > However, it is very unusual to run a plain HTTP forward proxy
>     on port
>      > > 443. That port may imply that your parent proxy is an HTTPS reverse
>      > > proxy. If it is, you need to use originserver flag when
>      > configuring the
>      > > corresponding cache_peer line. You can check by sending plain
>     CONNECT
>      > > requests to that upstream proxy using wget, curl, or some such. A
>      > > reverse HTTPS proxy would reject such requests.
>      > >
>      > >
>      > > > if the ssl_bump configuration is causing it to attempt an
>     upstream
>      > > > TLS connection ...
>      > >
>      > > Bugs notwithstanding, it should not.
>      > >
>      > >
>      > > > Anything here that I'm doing obviously wrong?
>      > >
>      > > I see no red flags relevant to your specific question.
>      > >
>      > > Does replacing "bump all" with "splice all" fix the problem? I
>      > realize
>      > > that you do want to bump/see the device traffic, but I wonder
>     whether
>      > > the errors are not between Squid and the upstream proxy but
>     Squid and
>      > > the web site. Splicing would remove those errors while still
>     keeping
>      > > some SslBump code active.
>      > >
>      > > Sharing a (pointer to compressed) libpcap packet capture and/or a
>      > > (pointer to compressed) ALL,9 cache.log while reproducing the
>     problem
>      > > with a single transaction may help:
>      > >
>      >
>     https://wiki.squid-cache.org/SquidFaq/BugReporting#Debugging_a_single_transaction
>      > >
>      > > Alex.
>      > > _______________________________________________
>      > > squid-users mailing list
>      > > squid-users at lists.squid-cache.org
>      > > http://lists.squid-cache.org/listinfo/squid-users
>      > >
>      > > Sent from Mailspring
>      >
>      > Sent from Mailspring
> 



From spinter at npsh.hu  Thu Mar 10 16:38:20 2022
From: spinter at npsh.hu (=?UTF-8?Q?Pint=c3=a9r_Szabolcs?=)
Date: Thu, 10 Mar 2022 17:38:20 +0100
Subject: [squid-users] squid with OAuth2.0
Message-ID: <85423ee4-4efa-f162-a2b5-e9e7ca77a8b8@npsh.hu>

Hi


I'm Szabolcs and I want to use your proxy with an OAuth2 solution.

I think I have tou use this part of the Documentiation:

https://wiki.squid-cache.org/Features/BearerAuthentication


But I didn't find more information about this, can I use it if i rebuild 
the code from there project: https://github.com/squid-cache/squid. 
(Sadly I didn't find any relevant part from the code or the git commits)

I find just this flags on a configure file: ? --enable-auth , 
--enable-auth-basic="list of helpers", --enable-auth-digest="list of 
helpers", --enable-auth-negotiate="list of helpers", 
--enable-auth-ntlm="list of helpers".


Have I any chacne to find an OAuth solution for squid?


Thank you for your help and reply.


Best

Szabolcs



From squid3 at treenet.co.nz  Fri Mar 11 03:31:54 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 11 Mar 2022 16:31:54 +1300
Subject: [squid-users] squid with OAuth2.0
In-Reply-To: <85423ee4-4efa-f162-a2b5-e9e7ca77a8b8@npsh.hu>
References: <85423ee4-4efa-f162-a2b5-e9e7ca77a8b8@npsh.hu>
Message-ID: <e849c17d-4e88-2698-5a1b-f389471a0ac2@treenet.co.nz>

On 11/03/22 05:38, Pint?r Szabolcs wrote:
> Hi
> 
> 
> I'm Szabolcs and I want to use your proxy with an OAuth2 solution.
> 
> I think I have tou use this part of the Documentiation:
> 
> https://wiki.squid-cache.org/Features/BearerAuthentication
> 
> 
> But I didn't find more information about this, can I use it if i rebuild 
> the code from there project: https://github.com/squid-cache/squid. 
> (Sadly I didn't find any relevant part from the code or the git commits)
> 
> I find just this flags on a configure file: ? --enable-auth , 
> --enable-auth-basic="list of helpers", --enable-auth-digest="list of 
> helpers", --enable-auth-negotiate="list of helpers", 
> --enable-auth-ntlm="list of helpers".
> 
> 
> Have I any chacne to find an OAuth solution for squid?
> 


You currently still need to build the code development branch at 
<https://github.com/squid-cache/squid/pull/30>. Looks like some build 
issues right now, I hope to have a fix in the next day or so for that.

You will have to create your own auth helper to do the OAuth b64token 
verification. I/O protocol for the helper is documented on that page.

Also, please be aware that as far as we can tell Browser clients only 
use OAuth Bearer when they think they are talking to an origin server. 
So it is mostly useful as a reverse-proxy authentication.


Amos


From Ralf.Hildebrandt at charite.de  Fri Mar 11 13:20:39 2022
From: Ralf.Hildebrandt at charite.de (Ralf Hildebrandt)
Date: Fri, 11 Mar 2022 14:20:39 +0100
Subject: [squid-users] Identify websockets traffic in the log?
Message-ID: <YitMp7fq+jRSwPJZ@charite.de>

Is it possible to identify websockets traffic in the log (using
squid-6 here)?

Ralf Hildebrandt
Charit? - Universit?tsmedizin Berlin
Gesch?ftsbereich IT | Abteilung Netzwerk

Campus Benjamin Franklin (CBF)
Haus I | 1. OG | Raum 105
Hindenburgdamm 30 | D-12203 Berlin

Tel. +49 30 450 570 155
ralf.hildebrandt at charite.de
https://www.charite.de


From freefallbenson at hotmail.com  Sat Mar 12 03:25:00 2022
From: freefallbenson at hotmail.com (ben)
Date: Sat, 12 Mar 2022 11:25:00 +0800
Subject: [squid-users] SQUID refuses to listen on any TCP Port
In-Reply-To: <000001d83195$b1cf4a70$156ddf50$@gmail.com>
References: <OSZP286MB1606426763752532E3AD7D5AC7039@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <YiDQrN3t7lrVLSyP@fantomas.sk>
 <OSZP286MB16063B4FD8C9CA0DFC74C5D9C7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <OSZP286MB16068B4C454A57B35A601436C7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <59df0b4a-01e7-9439-9945-ae04c95323f0@measurement-factory.com>
 <OSZP286MB1606D3618BE6836F1CDC3C8EC7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <79f61cf8-4e8b-fbff-b99a-7e6f009ae932@treenet.co.nz>
 <OSZP286MB1606FFFEFBB7C6D3B72090D1C7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <000001d82fd5$e853dfa0$b8fb9ee0$@gmail.com>
 <OSZP286MB16061F1656E5EBB6DC973E4FC7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <000001d830bc$6bca8910$435f9b30$@gmail.com>
 <OSZP286MB160693FFC1DFC7C8976245F2C7079@OSZP286MB1606.JPNP286.PROD.OUTLO
 OK.COM> <000601d8311c$cfdd1ed0$6f975c70$@gmail.com>
 <OSZP286MB16062F5C437851E3E
 7CC1021C7079@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <000001d83195$b1cf4a70$156ddf50$@gmail.com>
Message-ID: <OS3P286MB1616ADC048342B87B05E23DCC70D9@OS3P286MB1616.JPNP286.PROD.OUTLOOK.COM>


Hi Eliezer,
Thanks for your help. I tried your method. it worked in a few VM 
instances but not on others. All have the same version of ubuntu 20.04. 
I just have no idea why Squid is so glitchy. same methods, same OS, 
sometimes it did start accepting connection on the specificed TCP port, 
but most of times it didn't. I also tried to install from a PPA repos 
and it is the same story. Any suggestion?
> Hey Ben,
>
> I cannot tell you if there is something wrong with what you are doing or the
> OS.
> What I did was to install a basic squid on ubuntu 20.4 which comes with
> version 4.10.
> I shut down the current running suqid.
> I took the /etc/squid/squid.conf file and left it with a single line.
> After that I started squid with "systemctl start squid" and it seems to work
> fine.
> I shut down squid and downloaded my version and again left the squid.conf
> with a single line.
> Just.. adding the mime.conf into /etc/squid/ and it worked like a charm.
> Try to use "ss -ntlp" instead of netstat.
> You should first try this on a VM on you local desktop in virtualbox or
> hyperv.
>
> All The Bests,
> Eliezer
>
> ----
> Eliezer Croitoru
> NgTech, Tech Support
> Mobile: +972-5-28704261
> Email: ngtech1ltd at gmail.com
>
> -----Original Message-----
> From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of
> ben
> Sent: Sunday, March 6, 2022 07:51
> To: squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] SQUID refuses to listen on any TCP Port
>
>
> Hi Eliezer,
>
> It is a KVM VPS server with ubuntu 20.04. I just reinstalled the whole
> operating sytem and started it from scratch but got the same result: No
> tcp port listening. I don't know if it is something wrong with the OS
> template. Please let me know what I need to do. Thank you!
>> Hey Ben,
>>
>> If it doesn't work for you then you are clearly doing something wrong....
>>
>> I can try to give you instructions on how to make it work 100% unless your
> setup is messed up or is not a plain ubuntu 20.04.
>> Is it a simple VM?
>>
>> Eliezer
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users


From ngtech1ltd at gmail.com  Sat Mar 12 17:24:15 2022
From: ngtech1ltd at gmail.com (Eliezer Croitoru)
Date: Sat, 12 Mar 2022 19:24:15 +0200
Subject: [squid-users] SQUID refuses to listen on any TCP Port
In-Reply-To: <OS3P286MB1616ADC048342B87B05E23DCC70D9@OS3P286MB1616.JPNP286.PROD.OUTLOOK.COM>
References: <OSZP286MB1606426763752532E3AD7D5AC7039@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <YiDQrN3t7lrVLSyP@fantomas.sk>
 <OSZP286MB16063B4FD8C9CA0DFC74C5D9C7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <OSZP286MB16068B4C454A57B35A601436C7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <59df0b4a-01e7-9439-9945-ae04c95323f0@measurement-factory.com>
 <OSZP286MB1606D3618BE6836F1CDC3C8EC7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <79f61cf8-4e8b-fbff-b99a-7e6f009ae932@treenet.co.nz>
 <OSZP286MB1606FFFEFBB7C6D3B72090D1C7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <000001d82fd5$e853dfa0$b8fb9ee0$@gmail.com>
 <OSZP286MB16061F1656E5EBB6DC973E4FC7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <000001d830bc$6bca8910$435f9b30$@gmail.com>
 <OSZP286MB160693FFC1DFC7C8976245F2C7079@OSZP286MB1606.JPNP286.PROD.OUTLO
 OK.COM> <000601d8311c$cfdd1ed0$6f975c70$@gmail.com>
 <OSZP286MB16062F5C437851E3E
 7CC1021C7079@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <000001d83195$b1cf4a70$156ddf50$@gmail.com>
 <OS3P286MB1616ADC048342B87B05E23DCC
 70D9@OS3P286MB1616.JPNP286.PROD.OUTLOOK.COM>
Message-ID: <002801d83636$00950650$01bf12f0$@gmail.com>

Hey Ben,

You should try the next test:
install netcat with "apt install netcat"

Then run the next two commands:
netcat -v -l -6 4444
netcat -v -l -4 4444

and send us the output of these.
You can change the ports to 3128 which doesn't work and see what might cause
this issue.
It's possible that your VPS hosting service is using a custom kernel or
another thing happens there.
It's not squid by itself that is at fault in this issue since it was tested
on more then one system over the last 10 years including Ubuntu 20.04.

All The Bests,
Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of
ben
Sent: Saturday, March 12, 2022 05:25
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] SQUID refuses to listen on any TCP Port


Hi Eliezer,
Thanks for your help. I tried your method. it worked in a few VM 
instances but not on others. All have the same version of ubuntu 20.04. 
I just have no idea why Squid is so glitchy. same methods, same OS, 
sometimes it did start accepting connection on the specificed TCP port, 
but most of times it didn't. I also tried to install from a PPA repos 
and it is the same story. Any suggestion?
> Hey Ben,
>
> I cannot tell you if there is something wrong with what you are doing or
the
> OS.
> What I did was to install a basic squid on ubuntu 20.4 which comes with
> version 4.10.
> I shut down the current running suqid.
> I took the /etc/squid/squid.conf file and left it with a single line.
> After that I started squid with "systemctl start squid" and it seems to
work
> fine.
> I shut down squid and downloaded my version and again left the squid.conf
> with a single line.
> Just.. adding the mime.conf into /etc/squid/ and it worked like a charm.
> Try to use "ss -ntlp" instead of netstat.
> You should first try this on a VM on you local desktop in virtualbox or
> hyperv.
>
> All The Bests,
> Eliezer
>
> ----
> Eliezer Croitoru
> NgTech, Tech Support
> Mobile: +972-5-28704261
> Email: ngtech1ltd at gmail.com
>
> -----Original Message-----
> From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of
> ben
> Sent: Sunday, March 6, 2022 07:51
> To: squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] SQUID refuses to listen on any TCP Port
>
>
> Hi Eliezer,
>
> It is a KVM VPS server with ubuntu 20.04. I just reinstalled the whole
> operating sytem and started it from scratch but got the same result: No
> tcp port listening. I don't know if it is something wrong with the OS
> template. Please let me know what I need to do. Thank you!
>> Hey Ben,
>>
>> If it doesn't work for you then you are clearly doing something wrong....
>>
>> I can try to give you instructions on how to make it work 100% unless
your
> setup is messed up or is not a plain ubuntu 20.04.
>> Is it a simple VM?
>>
>> Eliezer
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From dave at killthe.net  Sun Mar 13 07:22:59 2022
From: dave at killthe.net (Dave Blanchard)
Date: Sun, 13 Mar 2022 01:22:59 -0600
Subject: [squid-users] Bug: 'squid -k interrupt' quits on config file error,
 fails to kill process
Message-ID: <20220313012259.ad89c7d8b290db2e1c72e1f8@killthe.net>

If one has edited the config file and there is some kind of error in the new config, 'squid -k interrupt' fails to kill Squid, but instead complains about the broken config and exits. I think the correct behavior should be for Squid to kill the running process regardless, then report a config error, if necessary. Ideally the config would only be carefully scrutinized when starting Squid, not when killing it.

-- 
Dave Blanchard <dave at killthe.net>


From freefallbenson at hotmail.com  Sun Mar 13 10:24:16 2022
From: freefallbenson at hotmail.com (ben)
Date: Sun, 13 Mar 2022 18:24:16 +0800
Subject: [squid-users] SQUID refuses to listen on any TCP Port
In-Reply-To: <002801d83636$00950650$01bf12f0$@gmail.com>
References: <OSZP286MB1606426763752532E3AD7D5AC7039@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <OSZP286MB16068B4C454A57B35A601436C7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <59df0b4a-01e7-9439-9945-ae04c95323f0@measurement-factory.com>
 <OSZP286MB1606D3618BE6836F1CDC3C8EC7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <79f61cf8-4e8b-fbff-b99a-7e6f009ae932@treenet.co.nz>
 <OSZP286MB1606FFFEFBB7C6D3B72090D1C7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <000001d82fd5$e853dfa0$b8fb9ee0$@gmail.com>
 <OSZP286MB16061F1656E5EBB6DC973E4FC7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <000001d830bc$6bca8910$435f9b30$@gmail.com>
 <OSZP286MB160693FFC1DFC7C8976245F2C7079@OSZP286MB1606.JPNP286.PROD.OUTLO
 OK.COM> <000601d8311c$cfdd1ed0$6f975c70$@gmail.com>
 <OSZP286MB16062F5C437851E3E
 7CC1021C7079@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <000001d83195$b1cf4a70$156ddf50$@gmail.com>
 <OS3P286MB1616ADC048342B87B05E23DCC
 70D9@OS3P286MB1616.JPNP286.PROD.OUTLOOK.COM>
 <002801d83636$00950650$01bf12f0$@gmail.com>
Message-ID: <OSZP286MB16069235E4116929D8178685C70E9@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>


Hello,

It looks like that if I start installing it right after OS installation, 
it works. But not if I install any packages, for example, make, 
gcc,strongswan and so on. once it stop working, it will not work anymore 
even if I remove all aforementioned packages. reboot also doesn't help. 
I also tried it on Debian 11. no luck either! it only works in old ubuntu 16
I can be 100% sure that squid is not listening on any TCP ports. running 
these commands looks fine

Thanks for your being patient and kind

root at host8d66c97880:~# netcat -v -l -4 34568
Listening on 0.0.0.0 34568
^C
root at host8d66c97880:~# netcat -v -l -6 34568
Listening on :: 34568

I configured it to listen on 34568


> netcat -v -l -6 4444
> netcat -v -l -4 4444


From freefallbenson at hotmail.com  Sun Mar 13 12:36:41 2022
From: freefallbenson at hotmail.com (ben)
Date: Sun, 13 Mar 2022 20:36:41 +0800
Subject: [squid-users] SQUID refuses to listen on any TCP Port
In-Reply-To: <OSZP286MB16069235E4116929D8178685C70E9@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
References: <OSZP286MB1606426763752532E3AD7D5AC7039@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <59df0b4a-01e7-9439-9945-ae04c95323f0@measurement-factory.com>
 <OSZP286MB1606D3618BE6836F1CDC3C8EC7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <79f61cf8-4e8b-fbff-b99a-7e6f009ae932@treenet.co.nz>
 <OSZP286MB1606FFFEFBB7C6D3B72090D1C7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <000001d82fd5$e853dfa0$b8fb9ee0$@gmail.com>
 <OSZP286MB16061F1656E5EBB6DC973E4FC7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <000001d830bc$6bca8910$435f9b30$@gmail.com>
 <OSZP286MB160693FFC1DFC7C8976245F2C7079@OSZP286MB1606.JPNP286.PROD.OUTLO
 OK.COM> <000601d8311c$cfdd1ed0$6f975c70$@gmail.com>
 <OSZP286MB16062F5C437851E3E
 7CC1021C7079@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <000001d83195$b1cf4a70$156ddf50$@gmail.com>
 <OS3P286MB1616ADC048342B87B05E23DCC
 70D9@OS3P286MB1616.JPNP286.PROD.OUTLOOK.COM>
 <002801d83636$00950650$01bf12f0$@gmail.com>
 <OSZP286MB16069235E4116929D8178685C70E9@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
Message-ID: <OSZP286MB16067BFC2DBC5534E8968F59C70E9@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>


Hello,
It could be that squid doesn't like some of my packages(I'm not sure 
which one). I installed the following packages:
 ? strongswan,nrpe, nagios-plugins

I also tweaked some kernel settings
net.ipv4.ip_forward = 1
net.ipv4.ip_local_port_range = 10000 61000
net.ipv4.tcp_max_syn_backlog = 8192
net.ipv4.tcp_tw_reuse = 1
net.ipv4.tcp_max_tw_buckets = 5000
fs.file-max = 65536
net.core.rmem_max = 67108864
net.core.wmem_max = 67108864
net.ipv4.tcp_rmem = 4096 87380 67108864
net.ipv4.tcp_wmem = 4096 65536 67108864
net.core.netdev_max_backlog = 250000
net.ipv4.tcp_mtu_probing = 1
net.core.default_qdisc = fq
net.ipv4.tcp_congestion_control = bbr

I couldn't win her heart back even if I rolled back all these settings 
and removed the packages.

I'm willing to pay if someone can help me resolve this issue

Thank you!
>
> Hello,
>
> It looks like that if I start installing it right after OS 
> installation, it works. But not if I install any packages, for 
> example, make, gcc,strongswan and so on. once it stop working, it will 
> not work anymore even if I remove all aforementioned packages. reboot 
> also doesn't help. I also tried it on Debian 11. no luck either! it 
> only works in old ubuntu 16
> I can be 100% sure that squid is not listening on any TCP ports. 
> running these commands looks fine
>
> Thanks for your being patient and kind
>
> root at host8d66c97880:~# netcat -v -l -4 34568
> Listening on 0.0.0.0 34568
> ^C
> root at host8d66c97880:~# netcat -v -l -6 34568
> Listening on :: 34568
>
> I configured it to listen on 34568
>
>
>> netcat -v -l -6 4444
>> netcat -v -l -4 4444
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users


From freefallbenson at hotmail.com  Sun Mar 13 15:41:02 2022
From: freefallbenson at hotmail.com (ben)
Date: Sun, 13 Mar 2022 23:41:02 +0800
Subject: [squid-users] SQUID refuses to listen on any TCP Port
In-Reply-To: <OSZP286MB16067BFC2DBC5534E8968F59C70E9@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
References: <OSZP286MB1606426763752532E3AD7D5AC7039@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <79f61cf8-4e8b-fbff-b99a-7e6f009ae932@treenet.co.nz>
 <OSZP286MB1606FFFEFBB7C6D3B72090D1C7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <000001d82fd5$e853dfa0$b8fb9ee0$@gmail.com>
 <OSZP286MB16061F1656E5EBB6DC973E4FC7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <000001d830bc$6bca8910$435f9b30$@gmail.com>
 <OSZP286MB160693FFC1DFC7C8976245F2C7079@OSZP286MB1606.JPNP286.PROD.OUTLO
 OK.COM> <000601d8311c$cfdd1ed0$6f975c70$@gmail.com>
 <OSZP286MB16062F5C437851E3E
 7CC1021C7079@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <000001d83195$b1cf4a70$156ddf50$@gmail.com>
 <OS3P286MB1616ADC048342B87B05E23DCC
 70D9@OS3P286MB1616.JPNP286.PROD.OUTLOOK.COM>
 <002801d83636$00950650$01bf12f0$@gmail.com>
 <OSZP286MB16069235E4116929D8178685C70E9@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <OSZP286MB16067BFC2DBC5534E8968F59C70E9@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
Message-ID: <OSZP286MB1606EE9C7C591A9E78FDCAE8C70E9@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>

Hello,

I've finally pinpointed the cause. It is my IPV6 iptables rules at 
fault. Once I changed the INPUT policy from DROP to Accept, everything 
works as expected! what a waste of so many hours! Thank you all
>
> Hello,
> It could be that squid doesn't like some of my packages(I'm not sure 
> which one). I installed the following packages:
> ? strongswan,nrpe, nagios-plugins
>
> I also tweaked some kernel settings
> net.ipv4.ip_forward = 1
> net.ipv4.ip_local_port_range = 10000 61000
> net.ipv4.tcp_max_syn_backlog = 8192
> net.ipv4.tcp_tw_reuse = 1
> net.ipv4.tcp_max_tw_buckets = 5000
> fs.file-max = 65536
> net.core.rmem_max = 67108864
> net.core.wmem_max = 67108864
> net.ipv4.tcp_rmem = 4096 87380 67108864
> net.ipv4.tcp_wmem = 4096 65536 67108864
> net.core.netdev_max_backlog = 250000
> net.ipv4.tcp_mtu_probing = 1
> net.core.default_qdisc = fq
> net.ipv4.tcp_congestion_control = bbr
>
> I couldn't win her heart back even if I rolled back all these settings 
> and removed the packages.
>
> I'm willing to pay if someone can help me resolve this issue
>
> Thank you!
>>
>> Hello,
>>
>> It looks like that if I start installing it right after OS 
>> installation, it works. But not if I install any packages, for 
>> example, make, gcc,strongswan and so on. once it stop working, it 
>> will not work anymore even if I remove all aforementioned packages. 
>> reboot also doesn't help. I also tried it on Debian 11. no luck 
>> either! it only works in old ubuntu 16
>> I can be 100% sure that squid is not listening on any TCP ports. 
>> running these commands looks fine
>>
>> Thanks for your being patient and kind
>>
>> root at host8d66c97880:~# netcat -v -l -4 34568
>> Listening on 0.0.0.0 34568
>> ^C
>> root at host8d66c97880:~# netcat -v -l -6 34568
>> Listening on :: 34568
>>
>> I configured it to listen on 34568
>>
>>
>>> netcat -v -l -6 4444
>>> netcat -v -l -4 4444
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users


From ngtech1ltd at gmail.com  Sun Mar 13 17:17:58 2022
From: ngtech1ltd at gmail.com (Eliezer Croitoru)
Date: Sun, 13 Mar 2022 19:17:58 +0200
Subject: [squid-users] SQUID refuses to listen on any TCP Port
In-Reply-To: <OSZP286MB16069235E4116929D8178685C70E9@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
References: <OSZP286MB1606426763752532E3AD7D5AC7039@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <OSZP286MB16068B4C454A57B35A601436C7049@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <59df0b4a-01e7-9439-9945-ae04c95323f0@measurement-factory.com>
 <OSZP286MB1606D3618BE6836F1CDC3C8EC7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <79f61cf8-4e8b-fbff-b99a-7e6f009ae932@treenet.co.nz>
 <OSZP286MB1606FFFEFBB7C6D3B72090D1C7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <000001d82fd5$e853dfa0$b8fb9ee0$@gmail.com>
 <OSZP286MB16061F1656E5EBB6DC973E4FC7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <000001d830bc$6bca8910$435f9b30$@gmail.com>
 <OSZP286MB160693FFC1DFC7C8976245F2C7079@OSZP286MB1606.JPNP286.PROD.OUTLO
 OK.COM> <000601d8311c$cfdd1ed0$6f975c70$@gmail.com>
 <OSZP286MB16062F5C437851E3E
 7CC1021C7079@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <000001d83195$b1cf4a70$156ddf50$@gmail.com>
 <OS3P286MB1616ADC048342B87B05E23DCC
 70D9@OS3P286MB1616.JPNP286.PROD.OUTLOOK.COM>
 <002801d83636$00950650$01bf12f0$@gmail.com> <OSZP286MB16069235E41
 16929D8178685C70E9@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
Message-ID: <004401d836fe$4a60ca80$df225f80$@gmail.com>

Hey Ben,

The next step in this situation is to try and connect with netcat from a
remote host and also locally.
>From what I understood the issue was a firewall issue so Squid was
listening.
I can also assume that squid was listening.
Just For future reference:
Try to run the next commands:
sudo netstat -ntlp
sudo ss -ntlp

and send their output to us.
In ubuntu you will not see any "squid" when running plain netstat or ss.

All The Bests,
Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of
ben
Sent: Sunday, March 13, 2022 12:24
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] SQUID refuses to listen on any TCP Port


Hello,

It looks like that if I start installing it right after OS installation, 
it works. But not if I install any packages, for example, make, 
gcc,strongswan and so on. once it stop working, it will not work anymore 
even if I remove all aforementioned packages. reboot also doesn't help. 
I also tried it on Debian 11. no luck either! it only works in old ubuntu 16
I can be 100% sure that squid is not listening on any TCP ports. running 
these commands looks fine

Thanks for your being patient and kind

root at host8d66c97880:~# netcat -v -l -4 34568
Listening on 0.0.0.0 34568
^C
root at host8d66c97880:~# netcat -v -l -6 34568
Listening on :: 34568

I configured it to listen on 34568


> netcat -v -l -6 4444
> netcat -v -l -4 4444
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From rousskov at measurement-factory.com  Sun Mar 13 18:12:20 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Sun, 13 Mar 2022 14:12:20 -0400
Subject: [squid-users] Bug: 'squid -k interrupt' quits on config file
 error, fails to kill process
In-Reply-To: <20220313012259.ad89c7d8b290db2e1c72e1f8@killthe.net>
References: <20220313012259.ad89c7d8b290db2e1c72e1f8@killthe.net>
Message-ID: <5c2dd95d-120b-8397-8855-9a89def972e4@measurement-factory.com>

On 3/13/22 03:22, Dave Blanchard wrote:

> If one has edited the config file and there is some kind of error in
> the new config, 'squid -k interrupt' fails to kill Squid, but instead
> complains about the broken config and exits. I think the correct
> behavior should be for Squid to kill the running process

I would not call the current behavior incorrect -- Squid has the right 
to demand a valid configuration file, especially when asked to do 
something fairly destructive.

Moreover, killing the running instance correctly depends on certain 
squid.conf settings (e.g., pid_filename). Yes, it is technically 
possible to teach Squid to ignore errors in all the irrelevant 
configuration settings, but that is a very complex feature that Squid is 
not ready for. IMO, our scarce resources are best spent elsewhere.

If you need a dumb process killer, use OS process killing tools.

Alex.


From dave at killthe.net  Sun Mar 13 19:48:06 2022
From: dave at killthe.net (Dave Blanchard)
Date: Sun, 13 Mar 2022 14:48:06 -0500
Subject: [squid-users] Bug: 'squid -k interrupt' quits on config file
 error, fails to kill process
In-Reply-To: <5c2dd95d-120b-8397-8855-9a89def972e4@measurement-factory.com>
References: <20220313012259.ad89c7d8b290db2e1c72e1f8@killthe.net>
 <5c2dd95d-120b-8397-8855-9a89def972e4@measurement-factory.com>
Message-ID: <20220313144806.76a01f3d0f0f40166ed0f32a@killthe.net>

OK. Would there be any harm in using 'kill -9 <pid>'? 'kill <pid>' seems to be interpreted as 'take your time, then quit whenever you're ready.' As long as kill -9 won't potentially cause any inconsistencies in state files or anything like that, I guess I'll do it that way. Thanks.

-- 
Dave Blanchard <dave at killthe.net>


From squid3 at treenet.co.nz  Sun Mar 13 21:22:28 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Mon, 14 Mar 2022 10:22:28 +1300
Subject: [squid-users] Bug: 'squid -k interrupt' quits on config file
 error, fails to kill process
In-Reply-To: <20220313144806.76a01f3d0f0f40166ed0f32a@killthe.net>
References: <20220313012259.ad89c7d8b290db2e1c72e1f8@killthe.net>
 <5c2dd95d-120b-8397-8855-9a89def972e4@measurement-factory.com>
 <20220313144806.76a01f3d0f0f40166ed0f32a@killthe.net>
Message-ID: <af59a59c-05ac-3bf3-a0e0-d5c774a88d40@treenet.co.nz>

On 14/03/22 08:48, Dave Blanchard wrote:
> OK. Would there be any harm in using 'kill -9 <pid>'? 'kill <pid>' seems to be interpreted as 'take your time, then quit whenever you're ready.'

Indeed. Busy proxy may have many clients to finish talking to, so there 
is a delay.

Sending the SIGHUP ('kill <pid>') a second time ends that delay and 
Squid will exit quickly.


> As long as kill -9 won't potentially cause any inconsistencies in state files or anything like that, I guess I'll do it that way. Thanks.
> 

"kill -9" will definitely leave some things in an odd state. Try the 
double-kill first.


HTH
Amos


From rousskov at measurement-factory.com  Sun Mar 13 22:38:05 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Sun, 13 Mar 2022 18:38:05 -0400
Subject: [squid-users] Bug: 'squid -k interrupt' quits on config file
 error, fails to kill process
In-Reply-To: <af59a59c-05ac-3bf3-a0e0-d5c774a88d40@treenet.co.nz>
References: <20220313012259.ad89c7d8b290db2e1c72e1f8@killthe.net>
 <5c2dd95d-120b-8397-8855-9a89def972e4@measurement-factory.com>
 <20220313144806.76a01f3d0f0f40166ed0f32a@killthe.net>
 <af59a59c-05ac-3bf3-a0e0-d5c774a88d40@treenet.co.nz>
Message-ID: <ba4da2dc-3694-9eee-f1b4-09121f430bc7@measurement-factory.com>

On 3/13/22 17:22, Amos Jeffries wrote:
> On 14/03/22 08:48, Dave Blanchard wrote:
>> OK. Would there be any harm in using 'kill -9 <pid>'? 'kill <pid>' 
>> seems to be interpreted as 'take your time, then quit whenever you're 
>> ready.'

> Indeed. Busy proxy may have many clients to finish talking to, so there 
> is a delay.
> 
> Sending the SIGHUP ('kill <pid>') a second time ends that delay and 
> Squid will exit quickly.

SIGHUP is a reconfiguration signal. Amos may be thinking about SIGTERM 
("squid -k shutdown" signal and "kill" default signal).


>> As long as kill -9 won't potentially cause any inconsistencies in 
>> state files or anything like that, I guess I'll do it that way. Thanks.


> "kill -9" will definitely leave some things in an odd state. Try the 
> double-kill first.

Just to add: kill -9 will not kill SMP Squid workers and other kid 
processes. To a large degree, Squid will just keep running as if nothing 
happened -- that signal cannot be caught and processed specially by the 
receiving Squid process. Do not use "kill -9 `cat pidfile`" if you are 
using SMP Squids!


HTH,

Alex.


From dave at killthe.net  Sun Mar 13 23:49:42 2022
From: dave at killthe.net (Dave Blanchard)
Date: Sun, 13 Mar 2022 18:49:42 -0500
Subject: [squid-users] Bug: 'squid -k interrupt' quits on config file
 error, fails to kill process
In-Reply-To: <ba4da2dc-3694-9eee-f1b4-09121f430bc7@measurement-factory.com>
References: <20220313012259.ad89c7d8b290db2e1c72e1f8@killthe.net>
 <5c2dd95d-120b-8397-8855-9a89def972e4@measurement-factory.com>
 <20220313144806.76a01f3d0f0f40166ed0f32a@killthe.net>
 <af59a59c-05ac-3bf3-a0e0-d5c774a88d40@treenet.co.nz>
 <ba4da2dc-3694-9eee-f1b4-09121f430bc7@measurement-factory.com>
Message-ID: <20220313184942.67385e503e61bda2110440e0@killthe.net>

On Sun, 13 Mar 2022 18:38:05 -0400
Alex Rousskov <rousskov at measurement-factory.com> wrote:

> > "kill -9" will definitely leave some things in an odd state. Try the 
> > double-kill first.
> 
> Just to add: kill -9 will not kill SMP Squid workers and other kid 
> processes. To a large degree, Squid will just keep running as if nothing 
> happened -- that signal cannot be caught and processed specially by the 
> receiving Squid process. Do not use "kill -9 `cat pidfile`" if you are 
> using SMP Squids!

It turns out double kill with a SIGTERM, besides being rather inelegant, doesn't do the job either. It takes its sweet ass time--a few seconds--to exit. Who said I wanted the proxy, busy or not, to keep running and finish what it's doing? The entire point is for it to stop IMMEDIATELY! ESPECIALLY if it's currently busy!

One of the main purposes for Squid on my system is to proxy Chromium, which likewise has the brilliant design of continuing to load page elements (on my extremely low bandwidth connection with a quota) when I've clearly told it to STOP NOW. The point is to put a hard, immediate stop to it, via killing the proxy.

So is there a signal that can be sent which is the exact equivalent of squid -k interrupt? The only reason I was using that command in the first place is because 'kill' wasn't doing the job correctly.

Why, oh why, does the config file have to be 100% valid, when the request is to simply STOP the damn thing? That makes no logical sense. Deciding to crash on some obscure malformed config directive while simply giving the command to STOP is NOT the right way to handle the situation. Forget about "not enough resources to add that feature." That is how it should have been designed from day one! So basically, "not enough resources to fix what we designed wrong in the first place." To be fair, I guess you just initially assumed everyone would want the proxy to finish up what it's doing before quitting. But that's not true in every case.

What is actual use of the pidfile to the end user, when kill -9 does not actually kill the damn thing, but actually fucks things up worse by leaving zombie processes running in the background--and SIGTERM doesn't do the job either, even when asked twice? Why the hell aren't all signals being forwarded to the child process(es), or otherwise architected so death of the controlling process brings down the whole thing?

-- 
Dave Blanchard <dave at killthe.net>


From freefallbenson at hotmail.com  Mon Mar 14 04:42:35 2022
From: freefallbenson at hotmail.com (ben)
Date: Mon, 14 Mar 2022 12:42:35 +0800
Subject: [squid-users] SQUID refuses to listen on any TCP Port
In-Reply-To: <004401d836fe$4a60ca80$df225f80$@gmail.com>
References: <OSZP286MB1606426763752532E3AD7D5AC7039@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <OSZP286MB1606D3618BE6836F1CDC3C8EC7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <79f61cf8-4e8b-fbff-b99a-7e6f009ae932@treenet.co.nz>
 <OSZP286MB1606FFFEFBB7C6D3B72090D1C7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <000001d82fd5$e853dfa0$b8fb9ee0$@gmail.com>
 <OSZP286MB16061F1656E5EBB6DC973E4FC7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <000001d830bc$6bca8910$435f9b30$@gmail.com>
 <OSZP286MB160693FFC1DFC7C8976245F2C7079@OSZP286MB1606.JPNP286.PROD.OUTLO
 OK.COM> <000601d8311c$cfdd1ed0$6f975c70$@gmail.com>
 <OSZP286MB16062F5C437851E3E
 7CC1021C7079@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <000001d83195$b1cf4a70$156ddf50$@gmail.com>
 <OS3P286MB1616ADC048342B87B05E23DCC
 70D9@OS3P286MB1616.JPNP286.PROD.OUTLOOK.COM>
 <002801d83636$00950650$01bf12f0$@gmail.com> <OSZP286MB16069235E41
 16929D8178685C70E9@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <004401d836fe$4a60ca80$df225f80$@gmail.com>
Message-ID: <OSZP286MB1606A04C625EB822CD4D94D1C70F9@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>


Hi Eliezer,

SQUID started listening only after I run "ip6tables -P INPUT ACCEPT". I 
had searched everywhere on the internet regarding this issue and no one 
mentioned that IPV6 iptables rules could stop squid from listening on 
TCP ports. And Squid just started without any complaint. To my limited 
knowledge, it seems no other software behaves like this?
 ?? At first I was indeed suspecting that the issue is related to IPV6. 
I had tried recompiling SQUID without IPV6 and disabed IPV6 using 
sysctl.conf, nothing worked. It never occured to me that my IPV6 INPUT 
POLICY could be the culprit.
 ? Again, many thanks for your help
> Hey Ben,
>
> The next step in this situation is to try and connect with netcat from a
> remote host and also locally.
>  From what I understood the issue was a firewall issue so Squid was
> listening.
> I can also assume that squid was listening.
> Just For future reference:
> Try to run the next commands:
> sudo netstat -ntlp
> sudo ss -ntlp
>
> and send their output to us.
> In ubuntu you will not see any "squid" when running plain netstat or ss.
>
> All The Bests,
> Eliezer
>
> ----
> Eliezer Croitoru
> NgTech, Tech Support
> Mobile: +972-5-28704261
> Email: ngtech1ltd at gmail.com
>
> -----Original Message-----
> From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of
> ben
> Sent: Sunday, March 13, 2022 12:24
> To: squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] SQUID refuses to listen on any TCP Port
>
>
> Hello,
>
> It looks like that if I start installing it right after OS installation,
> it works. But not if I install any packages, for example, make,
> gcc,strongswan and so on. once it stop working, it will not work anymore
> even if I remove all aforementioned packages. reboot also doesn't help.
> I also tried it on Debian 11. no luck either! it only works in old ubuntu 16
> I can be 100% sure that squid is not listening on any TCP ports. running
> these commands looks fine
>
> Thanks for your being patient and kind
>
> root at host8d66c97880:~# netcat -v -l -4 34568
> Listening on 0.0.0.0 34568
> ^C
> root at host8d66c97880:~# netcat -v -l -6 34568
> Listening on :: 34568
>
> I configured it to listen on 34568
>
>
>> netcat -v -l -6 4444
>> netcat -v -l -4 4444
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users


From ngtech1ltd at gmail.com  Mon Mar 14 08:48:57 2022
From: ngtech1ltd at gmail.com (Eliezer Croitoru)
Date: Mon, 14 Mar 2022 10:48:57 +0200
Subject: [squid-users] SQUID refuses to listen on any TCP Port
In-Reply-To: <OSZP286MB1606A04C625EB822CD4D94D1C70F9@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
References: <OSZP286MB1606426763752532E3AD7D5AC7039@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <OSZP286MB1606D3618BE6836F1CDC3C8EC7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <79f61cf8-4e8b-fbff-b99a-7e6f009ae932@treenet.co.nz>
 <OSZP286MB1606FFFEFBB7C6D3B72090D1C7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <000001d82fd5$e853dfa0$b8fb9ee0$@gmail.com>
 <OSZP286MB16061F1656E5EBB6DC973E4FC7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <000001d830bc$6bca8910$435f9b30$@gmail.com>
 <OSZP286MB160693FFC1DFC7C8976245F2C7079@OSZP286MB1606.JPNP286.PROD.OUTLO
 OK.COM> <000601d8311c$cfdd1ed0$6f975c70$@gmail.com>
 <OSZP286MB16062F5C437851E3E
 7CC1021C7079@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <000001d83195$b1cf4a70$156ddf50$@gmail.com>
 <OS3P286MB1616ADC048342B87B05E23DCC
 70D9@OS3P286MB1616.JPNP286.PROD.OUTLOOK.COM>
 <002801d83636$00950650$01bf12f0$@gmail.com> <OSZP286MB16069235E41
 16929D8178685C70E9@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <004401d836fe$4a60ca80$df225f80$@gmail.com>
 <OSZP286MB1606A04C625EB822CD4D94D1C70F9
 @OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
Message-ID: <000d01d83780$58c29b80$0a47d280$@gmail.com>

Hey Ben,

I do not know if it won't listen.
I can try to reproduce locally and see the results.
I assume it might be related to the pinger process or maybe something else but not 100% sure.

Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of ben
Sent: Monday, March 14, 2022 06:43
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] SQUID refuses to listen on any TCP Port


Hi Eliezer,

SQUID started listening only after I run "ip6tables -P INPUT ACCEPT". I 
had searched everywhere on the internet regarding this issue and no one 
mentioned that IPV6 iptables rules could stop squid from listening on 
TCP ports. And Squid just started without any complaint. To my limited 
knowledge, it seems no other software behaves like this?
    At first I was indeed suspecting that the issue is related to IPV6. 
I had tried recompiling SQUID without IPV6 and disabed IPV6 using 
sysctl.conf, nothing worked. It never occured to me that my IPV6 INPUT 
POLICY could be the culprit.
   Again, many thanks for your help
> Hey Ben,
>
> The next step in this situation is to try and connect with netcat from a
> remote host and also locally.
>  From what I understood the issue was a firewall issue so Squid was
> listening.
> I can also assume that squid was listening.
> Just For future reference:
> Try to run the next commands:
> sudo netstat -ntlp
> sudo ss -ntlp
>
> and send their output to us.
> In ubuntu you will not see any "squid" when running plain netstat or ss.
>
> All The Bests,
> Eliezer
>
> ----
> Eliezer Croitoru
> NgTech, Tech Support
> Mobile: +972-5-28704261
> Email: ngtech1ltd at gmail.com
>
> -----Original Message-----
> From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of
> ben
> Sent: Sunday, March 13, 2022 12:24
> To: squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] SQUID refuses to listen on any TCP Port
>
>
> Hello,
>
> It looks like that if I start installing it right after OS installation,
> it works. But not if I install any packages, for example, make,
> gcc,strongswan and so on. once it stop working, it will not work anymore
> even if I remove all aforementioned packages. reboot also doesn't help.
> I also tried it on Debian 11. no luck either! it only works in old ubuntu 16
> I can be 100% sure that squid is not listening on any TCP ports. running
> these commands looks fine
>
> Thanks for your being patient and kind
>
> root at host8d66c97880:~# netcat -v -l -4 34568
> Listening on 0.0.0.0 34568
> ^C
> root at host8d66c97880:~# netcat -v -l -6 34568
> Listening on :: 34568
>
> I configured it to listen on 34568
>
>
>> netcat -v -l -6 4444
>> netcat -v -l -4 4444
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From ngtech1ltd at gmail.com  Mon Mar 14 09:00:18 2022
From: ngtech1ltd at gmail.com (Eliezer Croitoru)
Date: Mon, 14 Mar 2022 11:00:18 +0200
Subject: [squid-users] SQUID refuses to listen on any TCP Port
References: <OSZP286MB1606426763752532E3AD7D5AC7039@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <OSZP286MB1606D3618BE6836F1CDC3C8EC7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <79f61cf8-4e8b-fbff-b99a-7e6f009ae932@treenet.co.nz>
 <OSZP286MB1606FFFEFBB7C6D3B72090D1C7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <000001d82fd5$e853dfa0$b8fb9ee0$@gmail.com>
 <OSZP286MB16061F1656E5EBB6DC973E4FC7059@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <000001d830bc$6bca8910$435f9b30$@gmail.com>
 <OSZP286MB160693FFC1DFC7C8976245F2C7079@OSZP286MB1606.JPNP286.PROD.OUTLO
 OK.COM> <000601d8311c$cfdd1ed0$6f975c70$@gmail.com>
 <OSZP286MB16062F5C437851E3E
 7CC1021C7079@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <000001d83195$b1cf4a70$156ddf50$@gmail.com>
 <OS3P286MB1616ADC048342B87B05E23DCC
 70D9@OS3P286MB1616.JPNP286.PROD.OUTLOOK.COM>
 <002801d83636$00950650$01bf12f0$@gmail.com> <OSZP286MB16069235E41
 16929D8178685C70E9@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <004401d836fe$4a60ca80$df225f80$@gmail.com>
 <OSZP286MB1606A04C625EB822CD4D94D1C70F9
 @OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
Message-ID: <000e01d83781$eef40cf0$ccdc26d0$@gmail.com>

Hey Ben,

As I suspected it's the pinger that is causing this issue.
In my RPM builds it's disabled by defaults to avoid selinux complications.
I think it's a very special case you have found.
Try to use the:
pinger_enable off

and see if it fixes your issue.

All The Bests,
Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com

-----Original Message-----
From: Eliezer Croitoru <ngtech1ltd at gmail.com> 
Sent: Monday, March 14, 2022 10:49
To: 'squid-users at lists.squid-cache.org' <squid-users at lists.squid-cache.org>
Subject: RE: [squid-users] SQUID refuses to listen on any TCP Port

Hey Ben,

I do not know if it won't listen.
I can try to reproduce locally and see the results.
I assume it might be related to the pinger process or maybe something else but not 100% sure.

Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of ben
Sent: Monday, March 14, 2022 06:43
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] SQUID refuses to listen on any TCP Port


Hi Eliezer,

SQUID started listening only after I run "ip6tables -P INPUT ACCEPT". I 
had searched everywhere on the internet regarding this issue and no one 
mentioned that IPV6 iptables rules could stop squid from listening on 
TCP ports. And Squid just started without any complaint. To my limited 
knowledge, it seems no other software behaves like this?
    At first I was indeed suspecting that the issue is related to IPV6. 
I had tried recompiling SQUID without IPV6 and disabed IPV6 using 
sysctl.conf, nothing worked. It never occured to me that my IPV6 INPUT 
POLICY could be the culprit.
   Again, many thanks for your help
> Hey Ben,
>
> The next step in this situation is to try and connect with netcat from a
> remote host and also locally.
>  From what I understood the issue was a firewall issue so Squid was
> listening.
> I can also assume that squid was listening.
> Just For future reference:
> Try to run the next commands:
> sudo netstat -ntlp
> sudo ss -ntlp
>
> and send their output to us.
> In ubuntu you will not see any "squid" when running plain netstat or ss.
>
> All The Bests,
> Eliezer
>
> ----
> Eliezer Croitoru
> NgTech, Tech Support
> Mobile: +972-5-28704261
> Email: ngtech1ltd at gmail.com
>
> -----Original Message-----
> From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of
> ben
> Sent: Sunday, March 13, 2022 12:24
> To: squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] SQUID refuses to listen on any TCP Port
>
>
> Hello,
>
> It looks like that if I start installing it right after OS installation,
> it works. But not if I install any packages, for example, make,
> gcc,strongswan and so on. once it stop working, it will not work anymore
> even if I remove all aforementioned packages. reboot also doesn't help.
> I also tried it on Debian 11. no luck either! it only works in old ubuntu 16
> I can be 100% sure that squid is not listening on any TCP ports. running
> these commands looks fine
>
> Thanks for your being patient and kind
>
> root at host8d66c97880:~# netcat -v -l -4 34568
> Listening on 0.0.0.0 34568
> ^C
> root at host8d66c97880:~# netcat -v -l -6 34568
> Listening on :: 34568
>
> I configured it to listen on 34568
>
>
>> netcat -v -l -6 4444
>> netcat -v -l -4 4444
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From uhlar at fantomas.sk  Mon Mar 14 09:23:39 2022
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Mon, 14 Mar 2022 10:23:39 +0100
Subject: [squid-users] Bug: 'squid -k interrupt' quits on config file
 error, fails to kill process
In-Reply-To: <20220313184942.67385e503e61bda2110440e0@killthe.net>
References: <20220313012259.ad89c7d8b290db2e1c72e1f8@killthe.net>
 <5c2dd95d-120b-8397-8855-9a89def972e4@measurement-factory.com>
 <20220313144806.76a01f3d0f0f40166ed0f32a@killthe.net>
 <af59a59c-05ac-3bf3-a0e0-d5c774a88d40@treenet.co.nz>
 <ba4da2dc-3694-9eee-f1b4-09121f430bc7@measurement-factory.com>
 <20220313184942.67385e503e61bda2110440e0@killthe.net>
Message-ID: <Yi8JmxDxfTOY2f2s@fantomas.sk>

>
>> > "kill -9" will definitely leave some things in an odd state. Try the
>> > double-kill first.

>On Sun, 13 Mar 2022 18:38:05 -0400
>Alex Rousskov <rousskov at measurement-factory.com> wrote:
>> Just to add: kill -9 will not kill SMP Squid workers and other kid
>> processes. To a large degree, Squid will just keep running as if nothing
>> happened -- that signal cannot be caught and processed specially by the
>> receiving Squid process. Do not use "kill -9 `cat pidfile`" if you are
>> using SMP Squids!

On 13.03.22 18:49, Dave Blanchard wrote:
> It turns out double kill with a SIGTERM, besides being rather inelegant, 
> doesn't do the job either.  It takes its sweet ass time--a few seconds--to 
> exit. 

this is how squid works - it needs to cleanly close connections etc.

you can lower shutdown_lifetime option in config file 

> One of the main purposes for Squid on my system is to proxy Chromium, 
> which likewise has the brilliant design of continuing to load page 
> elements (on my extremely low bandwidth connection with a quota) when I've 
> clearly told it to STOP NOW.  The point is to put a hard, immediate stop 
> to it, via killing the proxy.

try different browser probably. I don't know if chromium has option not to 
fetch images etc.

> So is there a signal that can be sent which is the exact equivalent of 
> squid -k interrupt?  The only reason I was using that command in the first 
> place is because 'kill' wasn't doing the job correctly.

either shut it down correctly so it can start again, or don't shut it down 
and then expect not being able to start.

> Why, oh why, does the config file have to be 100% valid, when the request 
> is to simply STOP the damn thing?  That makes no logical sense.

this makes much sense and has already been explained.
starting with invalid configuration ignorec means possible unexpected 
behaviour.

according to what you wrote above, I am sure you don't want to squid fetch 
full content of interrupted transactions just because config directives were 
not read properly.


>  Deciding 
> to crash on some obscure malformed config directive while simply giving 
> the command to STOP is NOT the right way to handle the situation.  Forget 
> about "not enough resources to add that feature." That is how it should 
> have been designed from day one!  So basically, "not enough resources to 
> fix what we designed wrong in the first place." To be fair, I guess you 
> just initially assumed everyone would want the proxy to finish up what 
> it's doing before quitting.  But that's not true in every case.
>
> What is actual use of the pidfile to the end user, when kill -9 does not 
> actually kill the damn thing,

kill -9 DOES kill the damn thing, and it doesn't allow the damn thing 
cleaning up the mess.

https://porkmail.org/era/unix/award#uuk9letter

> but actually fucks things up worse by 
> leaving zombie processes running in the background--and SIGTERM doesn't do 
> the job either, even when asked twice?  Why the hell aren't all signals 
> being forwarded to the child process(es), or otherwise architected so 
> death of the controlling process brings down the whole thing?

this discussion makes no sense.
if you don't like how squid works, try e.g. wwwoffle.

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
99 percent of lawyers give the rest a bad name.


From Antony.Stone at squid.open.source.it  Mon Mar 14 09:27:05 2022
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Mon, 14 Mar 2022 10:27:05 +0100
Subject: [squid-users] SQUID refuses to listen on any TCP Port
In-Reply-To: <OSZP286MB1606A04C625EB822CD4D94D1C70F9@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
References: <OSZP286MB1606426763752532E3AD7D5AC7039@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <004401d836fe$4a60ca80$df225f80$@gmail.com>
 <OSZP286MB1606A04C625EB822CD4D94D1C70F9@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
Message-ID: <202203141027.05166.Antony.Stone@squid.open.source.it>

On Monday 14 March 2022 at 05:42:35, ben wrote:

> Hi Eliezer,
> 
> SQUID started listening only after I run "ip6tables -P INPUT ACCEPT".

Without seeing the rest of your iptables rules, it's not clear whether this 
really does apply to every interface and every protocol, or whether there are 
exception rules which over-ride this default policy rule.

However, there are quite a number of applications which will refuse to start, 
or not operate correctly, if you do not permit loopback traffic (IPv4 as well as 
IPv6), so this may be the cause of your problems.


Antony.

-- 
"Once you have a panic, things tend to become rather undefined."

 - murble

                                                   Please reply to the list;
                                                         please *don't* CC me.


From rousskov at measurement-factory.com  Mon Mar 14 13:53:39 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Mon, 14 Mar 2022 09:53:39 -0400
Subject: [squid-users] Bug: 'squid -k interrupt' quits on config file
 error, fails to kill process
In-Reply-To: <20220313184942.67385e503e61bda2110440e0@killthe.net>
References: <20220313012259.ad89c7d8b290db2e1c72e1f8@killthe.net>
 <5c2dd95d-120b-8397-8855-9a89def972e4@measurement-factory.com>
 <20220313144806.76a01f3d0f0f40166ed0f32a@killthe.net>
 <af59a59c-05ac-3bf3-a0e0-d5c774a88d40@treenet.co.nz>
 <ba4da2dc-3694-9eee-f1b4-09121f430bc7@measurement-factory.com>
 <20220313184942.67385e503e61bda2110440e0@killthe.net>
Message-ID: <123f936b-4d3f-e956-05d9-2ebc385b49c4@measurement-factory.com>

On 3/13/22 19:49, Dave Blanchard wrote:
> On Sun, 13 Mar 2022 18:38:05 -0400 Alex Rousskov wrote:
>> kill -9 will not kill SMP Squid workers and other kid
>> processes. To a large degree, Squid will just keep running as if nothing
>> happened -- that signal cannot be caught and processed specially by the
>> receiving Squid process. Do not use "kill -9 `cat pidfile`" if you are
>> using SMP Squids!


> It turns out double kill with a SIGTERM, besides being rather
> inelegant, doesn't do the job either. It takes its sweet ass time--a
> few seconds--to exit.

If you do not want Squid to wait for shutdown_lifetime to let some 
pending transactions finish, then use "squid -k interrupt" (or SIGINT if 
you want to work around unsupported invalid configuration files). That 
shutdown procedure does not have a delay.


> Who said I wanted the proxy, busy or not, to keep running and finish
> what it's doing? The entire point is for it to stop IMMEDIATELY!
> ESPECIALLY if it's currently busy!

Squid supports a variety of shutdown procedures that accommodate many 
realistic use cases. The better you specify what _you_ want, the better 
we can help you achieve those results. Your original email did not say 
that you wanted Squid to stop IMMEDIATELY, and your followup email was 
concerned with "any harm", so Amos suggested a graceful shutdown mode, 
probably (very reasonably IMO!) assuming that you want to minimize harm.


> So is there a signal that can be sent which is the exact equivalent
> of squid -k interrupt?

Yes, "squid -k interrupt" uses SIGINT.


> Why, oh why, does the config file have to be 100% valid

I believe I have already answered that loaded question. If something is 
not clear in my answer, please feel free to ask followup questions, but 
we should not go in circles.


> What is actual use of the pidfile to the end user

I think there are two ways to answer this question:

* None: The PID file is not meant to be used by the end user. You may 
use it at your own risk (e.g., if you want to work around unsupported 
invalid configuration files), but such use is just an unsupported hack.

* The actual use of the PID file is to send a (supported) signal to the 
running Squid instance without executing the Squid binary, with all the 
conveniences and problems such executions may bring.

I am not sure what the official Squid Project position is regarding end 
user use of the PID file. Such an official position may not exist (yet), 
but I suspect it is currently closer to the first bullet because we do 
not disclose/document which signals are used by various "squid -k" commands.


HTH,

Alex.


From doctor at doctor.nl2k.ab.ca  Mon Mar 14 14:45:10 2022
From: doctor at doctor.nl2k.ab.ca (The Doctor)
Date: Mon, 14 Mar 2022 08:45:10 -0600
Subject: [squid-users] Openssl 3 compliance
Message-ID: <Yi9U9jQbxjoaRZTW@doctor.nl2k.ab.ca>

I just read that opensssl 1.X will be end of life.

When will Squid comply with both openssl 1.X and openssl 3.x?

-- 
Member - Liberal International This is doctor@@nl2k.ab.ca Ici doctor@@nl2k.ab.ca
Yahweh, Queen & country!Never Satan President Republic!Beware AntiChrist rising!
Look at Psalms 14 and 53 on Atheism https://www.empire.kred/ROOTNK?t=94a1f39b  
There are times when it is the traitor giving the orders.  -unknown Beware https://mindspring.com


From psilvao at gmail.com  Mon Mar 14 16:06:50 2022
From: psilvao at gmail.com (Pablo Silva)
Date: Mon, 14 Mar 2022 13:06:50 -0300
Subject: [squid-users] filtering web browsing
Message-ID: <CAF1in6SP-xr+e=0vZQBeX+j_9evV+xer7VuS552dKJ0PG9-UMQ@mail.gmail.com>

Hi people, years ago I was a squid user, time has passed and I need to
implement again on the personal laptop (which my 9-year-old daughter uses),
that she cannot access to search for certain words.

Install squid for windows 10, I generated the following acl to detect words
that can be searched by google, but it seems that squid is only oriented to
access websites and not to block words that are searched by search engines.

acl keyword_block  url_regex -i "/etc/squid/bloqueo.txt"

 http_access deny keyword_block

Due to the above, I would like to know if there is any directive or plugin
that allows me to detect on the fly, and block the search carried out by
google or any other search engine using squid.

Beforehand thank you very much
Pablo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220314/3dea5612/attachment.htm>

From ngtech1ltd at gmail.com  Mon Mar 14 19:55:12 2022
From: ngtech1ltd at gmail.com (Eliezer Croitoru)
Date: Mon, 14 Mar 2022 21:55:12 +0200
Subject: [squid-users] SQUID refuses to listen on any TCP Port
In-Reply-To: <202203141027.05166.Antony.Stone@squid.open.source.it>
References: <OSZP286MB1606426763752532E3AD7D5AC7039@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <004401d836fe$4a60ca80$df225f80$@gmail.com>
 <OSZP286MB1606A04C625EB822CD4D94D1C70F9@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <202203141027.05166.Antony.Stone@squid.open.source.it>
Message-ID: <000401d837dd$6b9497b0$42bdc710$@gmail.com>

Hey Antony and Ben,

I have verified that the Pinger process is at fault.
I don't know if it's a bug or not.
You can disable pinger and it will work:
http://www.squid-cache.org/Doc/config/pinger_enable/

pinger_enable off

will resolve this issue.

All The Bests,
Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of
Antony Stone
Sent: Monday, March 14, 2022 11:27
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] SQUID refuses to listen on any TCP Port

On Monday 14 March 2022 at 05:42:35, ben wrote:

> Hi Eliezer,
> 
> SQUID started listening only after I run "ip6tables -P INPUT ACCEPT".

Without seeing the rest of your iptables rules, it's not clear whether this 
really does apply to every interface and every protocol, or whether there
are 
exception rules which over-ride this default policy rule.

However, there are quite a number of applications which will refuse to
start, 
or not operate correctly, if you do not permit loopback traffic (IPv4 as
well as 
IPv6), so this may be the cause of your problems.


Antony.

-- 
"Once you have a panic, things tend to become rather undefined."

 - murble

                                                   Please reply to the list;
                                                         please *don't* CC
me.
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From freefallbenson at hotmail.com  Tue Mar 15 08:35:18 2022
From: freefallbenson at hotmail.com (ben)
Date: Tue, 15 Mar 2022 16:35:18 +0800
Subject: [squid-users] SQUID refuses to listen on any TCP Port
In-Reply-To: <000401d837dd$6b9497b0$42bdc710$@gmail.com>
References: <OSZP286MB1606426763752532E3AD7D5AC7039@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <004401d836fe$4a60ca80$df225f80$@gmail.com>
 <OSZP286MB1606A04C625EB822CD4D94D1C70F9@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>
 <202203141027.05166.Antony.Stone@squid.open.source.it>
 <000401d837dd$6b9497b0$42bdc710$@gmail.com>
Message-ID: <OSZP286MB160670DEF4488C3C4BA53C08C7109@OSZP286MB1606.JPNP286.PROD.OUTLOOK.COM>


Hi Eliezer,

It worked! Now I can set my IPV6 input policy back to DROP.Anyway, this 
is my only ipv6-related firewall rules and anything else are defaults. 
Thank you!
> I have verified that the Pinger process is at fault.
> I don't know if it's a bug or not.
> You can disable pinger and it will work:
> http://www.squid-cache.org/Doc/config/pinger_enable/
>
> pinger_enable off
>
> will resolve this issue.
>
> All The Bests,
> Eliezer


From squid3 at treenet.co.nz  Tue Mar 15 13:15:44 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 16 Mar 2022 02:15:44 +1300
Subject: [squid-users] Openssl 3 compliance
In-Reply-To: <Yi9U9jQbxjoaRZTW@doctor.nl2k.ab.ca>
References: <Yi9U9jQbxjoaRZTW@doctor.nl2k.ab.ca>
Message-ID: <10ec10b1-69d9-6b72-12c4-f72972ec158b@treenet.co.nz>

On 15/03/22 03:45, The Doctor wrote:
> I just read that opensssl 1.X will be end of life.
> 
> When will Squid comply with both openssl 1.X and openssl 3.x?
> 


We have a PR with initial support that can be used if you really need 
it. <https://github.com/squid-cache/squid/pull/694>

FWIW, Ubuntu Jammy package of Squid has been patched to contain these 
changes.


I am hopeful that it will be available in Squid-6 later this year. 
Though unrelated things keep adding delays so no guarantees.


Amos


From jason.spashett at menlosecurity.com  Tue Mar 15 19:09:29 2022
From: jason.spashett at menlosecurity.com (Jason Spashett)
Date: Tue, 15 Mar 2022 19:09:29 +0000
Subject: [squid-users] Domain fronting detection
Message-ID: <CANj0NTqcJFP7-98PiZZnHWXTxEjH2hgN3yhZ5wjR+QNPL0ZD6A@mail.gmail.com>

Hello squid-users,

I wonder if there is a set of workable acls at present that can detect
and/or block domain fronting. By way of my understanding, that would be
comparing the TLS SNI during a client connecting to squid and issuing a
CONNECT method. Squid would bump that TLS request to also examine each and
every Host header and compare it to the TLS SNI to see if there is a
discrepancy.

Looking at the code at the moment I can only see absolute URL vs host
header checks, which do not appear to look at the CONNECT TLS SNI, which I
think to be found in the master xaction.

Regards,

Jason.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220315/325ada53/attachment.htm>

From johnnylam at udshk.com  Wed Mar 16 03:58:35 2022
From: johnnylam at udshk.com (Johnny Lam)
Date: Wed, 16 Mar 2022 11:58:35 +0800
Subject: [squid-users] Squid 3.5 Proxy Return 503 Error When Set as Proxy in
 Oralce Yum.conf
Message-ID: <CAGOSX7EQ9MQx=XK44E6pPB=BQJrX44ghTMBQn-VqktNOr_gUUQ@mail.gmail.com>

Hi all,

To reduce the bandwidth, we put the Cache Proxy in each regional office.
However, the proxy return 503 error when we try to access yum.oracle.com.
Attached the error log and the squid.conf file for your reference. Do I
need to do any SSL inspection to make it work ?

We already tried to set the company proxy in Cache Proxy setting and also
the Windows Server Connection layer. But result the same.

The connection is like below. The cache proxy 3.5 is installed on Windows
Server

Oralce Linux with yum.conf set > Cache Proxy > Company Proxy > Redhat/Oracle

[image: image.png]
Best Regards,

Johnny Lam
AWS Certified Solutions Architect
Security Consultant

UDS Data Systems Ltd
Office: +852 2851 0271 <+852%202851%200271>, Fax: +852 2851 0155
<+852%202851%200155>
Mobile: +852 9504 5848 <+852%209120%207940> China Mobile: +86 14715379352
<+86%209120%207940>
URL: http://www.udshk.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220316/c657d10b/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image.png
Type: image/png
Size: 21091 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220316/c657d10b/attachment.png>
-------------- next part --------------
#
# Recommended minimum configuration:
#

# Example rule allowing access from your local networks.
# Adapt to list your (internal) IP networks from where browsing
# should be allowed

acl localnet src 10.0.0.0/8	# RFC1918 possible internal network
acl localnet src 172.16.0.0/12	# RFC1918 possible internal network
acl localnet src 192.168.0.0/16	# RFC1918 possible internal network
acl localnet src fc00::/7       # RFC 4193 local private network range
acl localnet src fe80::/10      # RFC 4291 link-local (directly plugged) machines
acl localnet src 172.28.47.0/25

acl SSL_ports port 443
acl Safe_ports port 80		# http
acl Safe_ports port 21		# ftp
acl Safe_ports port 443		# https
acl Safe_ports port 70		# gopher
acl Safe_ports port 210		# wais
acl Safe_ports port 1025-65535	# unregistered ports
acl Safe_ports port 280		# http-mgmt
acl Safe_ports port 488		# gss-http
acl Safe_ports port 591		# filemaker
acl Safe_ports port 777		# multiling http
acl CONNECT method CONNECT

#
# Recommended minimum Access Permission configuration:
#

acl repo_domain dstdomain yum.oracle.com cdn.redhat.com
http_access allow repo_domain
http_access deny all
#http_access allow all
# Only allow cachemgr access from localhost
http_access allow localhost manager
http_access deny manager

# Deny requests to certain unsafe ports
http_access deny !Safe_ports

# Deny CONNECT to other than secure SSL ports
http_access deny CONNECT !SSL_ports

# We strongly recommend the following be uncommented to protect innocent
# web applications running on the proxy server who think the only
# one who can access services on "localhost" is a local user
#http_access deny to_localhost

#
# INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
#

# Example rule allowing access from your local networks.
# Adapt localnet in the ACL section to list your (internal) IP networks
# from where browsing should be allowed
http_access allow localnet
http_access allow localhost

# And finally deny all other access to this proxy
#http_access deny all

# Squid normally listens to port 3128
http_port 3128

# Uncomment the line below to enable disk caching - path format is /cygdrive/<full path to cache folder>, i.e.
cache_dir aufs /cygdrive/d/squid/var/cache/squid 3000000 16 256


# Leave coredumps in the first cache dir
coredump_dir /var/cache/squid

# Add any of your own refresh_pattern entries above these.
refresh_pattern ^ftp:		1440	20%	10080
refresh_pattern ^gopher:	1440	0%	1440
refresh_pattern -i (/cgi-bin/|\?) 0	0%	0
refresh_pattern .		0	20%	4320

dns_nameservers 172.28.45.63 172.28.45.64
forward_max_tries 25

max_filedescriptors 3200

cache_mem 64 MB
cache_swap_high 90
cache_swap_low 30

cache_log d:/squid/var/log/cache.log
access_log d:/squid/var/log/access.log
cache_store_log d:/squid/var/log/store.log
#cache_peer 172.28.121.200 parent 7070 0 no-query default

From spinter at npsh.hu  Wed Mar 16 07:43:54 2022
From: spinter at npsh.hu (=?UTF-8?Q?Pint=c3=a9r_Szabolcs?=)
Date: Wed, 16 Mar 2022 08:43:54 +0100
Subject: [squid-users] squid with OAuth2.0
In-Reply-To: <e849c17d-4e88-2698-5a1b-f389471a0ac2@treenet.co.nz>
References: <85423ee4-4efa-f162-a2b5-e9e7ca77a8b8@npsh.hu>
 <e849c17d-4e88-2698-5a1b-f389471a0ac2@treenet.co.nz>
Message-ID: <4ff7ad3f-03e9-41d9-d914-ff520ccf3240@npsh.hu>

Hi


Thank you for the reply.


I see the merge to the master failed?

Could you try again the merging or is there any problem with the solution?


Can I use this tree https://github.com/yadij/squid/tree/auth-bearer for 
a test until the merging doesn't going to be success?



2022. 03. 11. 4:31 keltez?ssel, Amos Jeffries ?rta:
> On 11/03/22 05:38, Pint?r Szabolcs wrote:
>> Hi
>>
>>
>> I'm Szabolcs and I want to use your proxy with an OAuth2 solution.
>>
>> I think I have tou use this part of the Documentiation:
>>
>> https://wiki.squid-cache.org/Features/BearerAuthentication
>>
>>
>> But I didn't find more information about this, can I use it if i 
>> rebuild the code from there project: 
>> https://github.com/squid-cache/squid. (Sadly I didn't find any 
>> relevant part from the code or the git commits)
>>
>> I find just this flags on a configure file: ? --enable-auth , 
>> --enable-auth-basic="list of helpers", --enable-auth-digest="list of 
>> helpers", --enable-auth-negotiate="list of helpers", 
>> --enable-auth-ntlm="list of helpers".
>>
>>
>> Have I any chacne to find an OAuth solution for squid?
>>
>
>
> You currently still need to build the code development branch at 
> <https://github.com/squid-cache/squid/pull/30>. Looks like some build 
> issues right now, I hope to have a fix in the next day or so for that.
>
> You will have to create your own auth helper to do the OAuth b64token 
> verification. I/O protocol for the helper is documented on that page.
>
> Also, please be aware that as far as we can tell Browser clients only 
> use OAuth Bearer when they think they are talking to an origin server. 
> So it is mostly useful as a reverse-proxy authentication.
>
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users


From squid.org at bloms.de  Wed Mar 16 09:40:17 2022
From: squid.org at bloms.de (Dieter Bloms)
Date: Wed, 16 Mar 2022 10:40:17 +0100
Subject: [squid-users] happy eyeball broken for dual homed hosts ?
Message-ID: <20220316094017.buof3zliit5h7s76@bloms.de>

Hello,

while using squid 4.17 my ipv4/ipv6 ratio is about 56/44.
When i use squid 5.3 my ipv4/ipv6 ratio is about 98/2.
Both tests on the same host.

Is it possible that the happy eyeball mechanism prefers ipv4 over ipv6 in
th squid5 series ?

-- 
Regards

  Dieter

--
I do not get viruses because I do not use MS software.
If you use Outlook then please do not put my email address in your
address-book so that WHEN you get a virus it won't use my address in the
>From field.


From ngtech1ltd at gmail.com  Wed Mar 16 10:29:44 2022
From: ngtech1ltd at gmail.com (Eliezer Croitoru)
Date: Wed, 16 Mar 2022 12:29:44 +0200
Subject: [squid-users] Squid 3.5 Proxy Return 503 Error When Set as
 Proxy in Oralce Yum.conf
In-Reply-To: <CAGOSX7EQ9MQx=XK44E6pPB=BQJrX44ghTMBQn-VqktNOr_gUUQ@mail.gmail.com>
References: <CAGOSX7EQ9MQx=XK44E6pPB=BQJrX44ghTMBQn-VqktNOr_gUUQ@mail.gmail.com>
Message-ID: <001001d83920$c20c91d0$4625b570$@gmail.com>

We need to know what the 503 meaning is.

It can be a gateway or another issue.

Use curl -v to try and access https://yum.oracle.com/ and see what the error page shows.

 

Eliezer

 

----

Eliezer Croitoru

NgTech, Tech Support

Mobile: +972-5-28704261

Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> 

 

From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Johnny Lam
Sent: Wednesday, March 16, 2022 05:59
To: squid-users at lists.squid-cache.org
Subject: [squid-users] Squid 3.5 Proxy Return 503 Error When Set as Proxy in Oralce Yum.conf

 

Hi all,

 

To reduce the bandwidth, we put the Cache Proxy in each regional office. However, the proxy return 503 error when we try to access yum.oracle.com <http://yum.oracle.com/> . Attached the error log and the squid.conf file for your reference. Do I need to do any SSL inspection to make it work ?

We already tried to set the company proxy in Cache Proxy setting and also the Windows Server Connection layer. But result the same.

The connection is like below. The cache proxy 3.5 is installed on Windows Server

Oralce Linux with yum.conf set > Cache Proxy > Company Proxy > Redhat/Oracle

 



Best Regards,

 

Johnny Lam

AWS Certified Solutions Architect 

Security Consultant

 

UDS Data Systems Ltd 

Office: +852 2851 0271 <tel:+852%202851%200271> , Fax: +852 2851 0155 <tel:+852%202851%200155> 

Mobile: +852 9504 5848 <tel:+852%209120%207940>  China Mobile: +86 14715379352 <tel:+86%209120%207940> 

URL: http://www.udshk.com <http://www.udshk.com/>      

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220316/c1590619/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.jpg
Type: image/jpeg
Size: 24387 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220316/c1590619/attachment.jpg>

From squid3 at treenet.co.nz  Wed Mar 16 10:48:21 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 16 Mar 2022 23:48:21 +1300
Subject: [squid-users] happy eyeball broken for dual homed hosts ?
In-Reply-To: <20220316094017.buof3zliit5h7s76@bloms.de>
References: <20220316094017.buof3zliit5h7s76@bloms.de>
Message-ID: <95cd12c6-8b88-fd1b-8e7e-b664c3e43b38@treenet.co.nz>

On 16/03/22 22:40, Dieter Bloms wrote:
> Hello,
> 
> while using squid 4.17 my ipv4/ipv6 ratio is about 56/44.

Squid-4 traditional networking strictly favours IPv6 per BCP17 
specification.


> When i use squid 5.3 my ipv4/ipv6 ratio is about 98/2.

Squid-5 "Happy Eyeballs" uses the fastest responding protocol, with a 
(insignificant) bias towards IPv6.

Under happy eyeballs the apparent preference can switch randomly based 
on remote networks activity and hardware changes.


Amos


From squid3 at treenet.co.nz  Wed Mar 16 11:04:39 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 17 Mar 2022 00:04:39 +1300
Subject: [squid-users] Domain fronting detection
In-Reply-To: <CANj0NTqcJFP7-98PiZZnHWXTxEjH2hgN3yhZ5wjR+QNPL0ZD6A@mail.gmail.com>
References: <CANj0NTqcJFP7-98PiZZnHWXTxEjH2hgN3yhZ5wjR+QNPL0ZD6A@mail.gmail.com>
Message-ID: <798f5098-bcdf-eefc-8715-4adcedf54ee3@treenet.co.nz>

On 16/03/22 08:09, Jason Spashett wrote:
> Hello squid-users,
> 
> I wonder?if there is a set of workable acls at present?that can detect 
> and/or block domain fronting.

Unfortunately no.


> By way of my understanding, that would be 
> comparing the TLS SNI during a client connecting to squid and issuing a 
> CONNECT method. Squid would bump that TLS request to also examine each 
> and every Host header and compare it to the TLS SNI to see if there is a 
> discrepancy.
> 
> Looking?at the code at the moment I can only see absolute?URL vs host 
> header checks, which do not appear to look at the CONNECT TLS SNI, which 
> I think to be found in the master xaction.
> 

This was part of the original intended design of that class. But there 
has been significant pushback against having any kind of connection 
between two "master transactions" and work in underway now to revert the 
class.


Amos


From rousskov at measurement-factory.com  Wed Mar 16 13:34:12 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Wed, 16 Mar 2022 09:34:12 -0400
Subject: [squid-users] Domain fronting detection
In-Reply-To: <CANj0NTqcJFP7-98PiZZnHWXTxEjH2hgN3yhZ5wjR+QNPL0ZD6A@mail.gmail.com>
References: <CANj0NTqcJFP7-98PiZZnHWXTxEjH2hgN3yhZ5wjR+QNPL0ZD6A@mail.gmail.com>
Message-ID: <d70b84b4-e7ea-429b-c918-d410b12c5219@measurement-factory.com>

On 3/15/22 15:09, Jason Spashett wrote:

> I wonder?if there is a set of workable acls at present?that can detect 
> and/or block domain fronting. By way of my understanding, that would be 
> comparing the TLS SNI during a client connecting to squid and issuing a 
> CONNECT method. Squid would bump that TLS request to also examine each 
> and every Host header and compare it to the TLS SNI to see if there is a 
> discrepancy.

Bugs notwithstanding, modern Squids should be able to do that using an 
external ACL. Your external ACL helper can receive SNI information via 
%ssl::>sni in the external_acl_type FORMAT field.


> On 3/16/22 07:04, Amos Jeffries wrote:
>>> Looking at the code at the moment I can only see absolute URL vs host 
>>> header checks, which do not appear to look at the CONNECT TLS SNI, 
>>> which I think to be found in the master xaction.

>> This was part of the original intended design of that class. But there 
>> has been significant pushback against having any kind of connection 
>> between two "master transactions" and work in underway now to revert the 
>> class.

SNI is a client-Squid connection info shared among all master 
transactions associated with that connection. The MasterXaction class 
will eventually provide access to more client-Squid connection info, 
including SNI. Any reasonable outcome of the ongoing dispute regarding 
MasterXaction future will reflect these fundamental relationships.


HTH,

Alex.


From snip3rmh at gmail.com  Wed Mar 16 14:37:14 2022
From: snip3rmh at gmail.com (Alberto Montes de Oca)
Date: Wed, 16 Mar 2022 10:37:14 -0400
Subject: [squid-users] Dynamic delay pools in squid?
Message-ID: <CAOYupTQzzG+bJkZ0Vnh2wG3TJ_kTZERPDY7c6K2O6O1uQY6qzA@mail.gmail.com>

 Hi guys, I?d like to implement some bandwidth management using squid delay
pools, but so far I can?t find any solution/example to do it dynamically,
in my case what I want to accomplish is this:
I have a 10Mb/s Internet connection, I want to use let?s say 6Mb/s for the
standard users, and reserve 4Mb/s for IT users, servers, etc. I want to
split the 6Mb/s bandwidth between the connected users at a given time,
something like (6Mb / N_users) where N_users is the amount of users
connected at a time. If there are 10 users connected they?ll get more
bandwidth than if there were 30 users connected. I don?t want to split the
bandwidth with a fixed percent for each user. Can this be done?
Thanks for the help
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220316/9f46e01e/attachment.htm>

From ngtech1ltd at gmail.com  Wed Mar 16 15:38:50 2022
From: ngtech1ltd at gmail.com (NgTech LTD)
Date: Wed, 16 Mar 2022 17:38:50 +0200
Subject: [squid-users] Dynamic delay pools in squid?
In-Reply-To: <CAOYupTQzzG+bJkZ0Vnh2wG3TJ_kTZERPDY7c6K2O6O1uQY6qzA@mail.gmail.com>
References: <CAOYupTQzzG+bJkZ0Vnh2wG3TJ_kTZERPDY7c6K2O6O1uQY6qzA@mail.gmail.com>
Message-ID: <CABA8h=SzcoX+OP=D9gFsbxbV+i56CzdxyCN2twkT7sGO7ZfNTQ@mail.gmail.com>

Hey,

Have you tried qos on the os/routing level?

Eliezer

?????? ??? ??, 16 ???? 2022, 16:36, ??? Alberto Montes de Oca ?<
snip3rmh at gmail.com>:

> Hi guys, I?d like to implement some bandwidth management using squid delay
> pools, but so far I can?t find any solution/example to do it dynamically,
> in my case what I want to accomplish is this:
> I have a 10Mb/s Internet connection, I want to use let?s say 6Mb/s for the
> standard users, and reserve 4Mb/s for IT users, servers, etc. I want to
> split the 6Mb/s bandwidth between the connected users at a given time,
> something like (6Mb / N_users) where N_users is the amount of users
> connected at a time. If there are 10 users connected they?ll get more
> bandwidth than if there were 30 users connected. I don?t want to split the
> bandwidth with a fixed percent for each user. Can this be done?
> Thanks for the help
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220316/fc47b80c/attachment.htm>

From squid3 at treenet.co.nz  Wed Mar 16 15:36:50 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 17 Mar 2022 04:36:50 +1300
Subject: [squid-users] Dynamic delay pools in squid?
In-Reply-To: <CAOYupTQzzG+bJkZ0Vnh2wG3TJ_kTZERPDY7c6K2O6O1uQY6qzA@mail.gmail.com>
References: <CAOYupTQzzG+bJkZ0Vnh2wG3TJ_kTZERPDY7c6K2O6O1uQY6qzA@mail.gmail.com>
Message-ID: <99b32519-a995-1f3e-931c-378db6cd1021@treenet.co.nz>

On 17/03/22 03:37, Alberto Montes de Oca wrote:
> Hi guys, I?d like to implement some bandwidth management using squid 
> delay pools, but so far I can?t find any solution/example to do it 
> dynamically, in my case what I want to accomplish is this:
> I have a 10Mb/s Internet connection, I want to use let?s say 6Mb/s for 
> the standard users, and reserve 4Mb/s for IT users, servers, etc. I want 
> to split the 6Mb/s bandwidth between the connected users at a given 
> time, something like (6Mb / N_users) where N_users is the amount of 
> users connected at a time. If there are 10 users connected they?ll get 
> more bandwidth than if there were 30 users connected. I don?t want to 
> split the bandwidth with a fixed percent for each user. Can this be done?


This is effectively what you are describing:

  acl standard_users ...

  delay_pools 2

  # 6 Mb/s pool for "standard users"
  delay_class 1 1
  delay_parameters 1 786432/-1
  delay_access 1 allow standard_users
  delay_access 1 deny all

  # 4 Mb/s pool for everything else
  delay_class 2 1
  delay_parameters 2 524288/-1
  delay_access 2 deny standard_users
  delay_access 2 allow all


Please be aware that you *will* see what looks like unfair/unbalanced 
use of traffic by users. Simply a side effect of the N_users value 
changing constantly on a per-request basis *within* each second.


Your system QoS features are the place to go for better bandwidth 
management beyond simplistic Mb/s rate limits. Squid is able to classify 
traffic with TOS or NFMARK for the QoS systems to use in their policy 
decisions.
see
  <http://www.squid-cache.org/Doc/config/tcp_outgoing_tos/>
  <http://www.squid-cache.org/Doc/config/tcp_outgoing_mark/>

Amos



From roeeklinger60 at gmail.com  Sat Mar 19 00:48:29 2022
From: roeeklinger60 at gmail.com (roee klinger)
Date: Sat, 19 Mar 2022 02:48:29 +0200
Subject: [squid-users] Reconfiguring Squid every few seconds
Message-ID: <CAGCa14oWzbRYC0So5Z-WeuOVEZ5uQe25zDrzYbVY6JAUBV68Cw@mail.gmail.com>

Hello,

I have a server with multiple 4G modems with Squid running on it, the 4G
modems get an internal private IP that is dynamic (unfortunately this can't
be changed),

I set up Squid to use the interfaces as follows:

tcp_outgoing_address <some_ip>

The configuration works well and everything works great, however, whenever
I restart one of the modems (I have many, and I restart them a lot), I get
a new internal private IP, and I need to reconfigure Squid, this means that
I will be running "squid -k reconfigure" multiple times a minute.

Will this have a bad effect on Squid and traffic (I understand this does
not cause Squid to restart)? What is my alternative?

Thanks,
Roee
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220319/02894237/attachment.htm>

From rousskov at measurement-factory.com  Sat Mar 19 14:46:57 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Sat, 19 Mar 2022 10:46:57 -0400
Subject: [squid-users] Reconfiguring Squid every few seconds
In-Reply-To: <CAGCa14oWzbRYC0So5Z-WeuOVEZ5uQe25zDrzYbVY6JAUBV68Cw@mail.gmail.com>
References: <CAGCa14oWzbRYC0So5Z-WeuOVEZ5uQe25zDrzYbVY6JAUBV68Cw@mail.gmail.com>
Message-ID: <775aa04d-3aa3-e7b4-8dd0-c59541a8ac6b@measurement-factory.com>

On 3/18/22 20:48, roee klinger wrote:

> I set up Squid to use the interfaces as follows:
> 
>     tcp_outgoing_address <some_ip>

> I will be running "squid -k reconfigure" multiple times a minute.

> Will this have a bad effect on Squid and traffic?

Yes, it will. Squid reconfiguration is a fairly heavy, disruptive event. 
FWIW, we are working on a smooth reconfiguration project that removes 
most of the negative side effects of reconfiguration.


> What is my alternative?

There are probably some routing solutions external to Squid, but I 
cannot recommend any specific one.

If you are looking for a Squid-specific solution, then hacking Squid 
sources to do what you want (without reconfiguration) feels like a 
viable short-term workaround. I also see two long-term solutions:

* Smooth reconfiguration: We have an ongoing project that makes Squid 
reconfigure just the changed configuration directives, without 
disrupting traffic. We can modify Squid to add the tcp_outgoing_address 
directive to the list of options that support smooth reconfiguration.

* Dynamic routing: Modify Squid to select the outgoing IP address based 
on dynamically computed addresses. The address configuration strings can 
be supplied by an external ACL helper or an adaptation service 
implementing your custom IP detection logic, including loading the new 
IP address from a file.


HTH,

Alex.


From ngtech1ltd at gmail.com  Sat Mar 19 22:19:58 2022
From: ngtech1ltd at gmail.com (Eliezer Croitoru)
Date: Sun, 20 Mar 2022 00:19:58 +0200
Subject: [squid-users] Reconfiguring Squid every few seconds
In-Reply-To: <CAGCa14oWzbRYC0So5Z-WeuOVEZ5uQe25zDrzYbVY6JAUBV68Cw@mail.gmail.com>
References: <CAGCa14oWzbRYC0So5Z-WeuOVEZ5uQe25zDrzYbVY6JAUBV68Cw@mail.gmail.com>
Message-ID: <000d01d83bdf$7935bba0$6ba132e0$@gmail.com>

Hey Roee,

 

The best solution for you case is to use a network namespace Router between the squid instance to the actual modem interface.

You can attach each modem to a network namespace and leave squid to do it?s thing with a static IP address.

 

All The Bests,

Eliezer

 

----

Eliezer Croitoru

NgTech, Tech Support

Mobile: +972-5-28704261

Email:  <mailto:ngtech1ltd at gmail.com> ngtech1ltd at gmail.com

 

From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of roee klinger
Sent: Saturday, March 19, 2022 02:48
To: Squid Users <squid-users at lists.squid-cache.org>
Subject: [squid-users] Reconfiguring Squid every few seconds

 

Hello,

 

I have a server with multiple 4G modems with Squid running on it, the 4G modems get an internal private IP that is dynamic (unfortunately this can't be changed),

 

I set up Squid to use the interfaces as follows:

tcp_outgoing_address <some_ip>

 

The configuration works well and everything works great, however, whenever I restart one of the modems (I have many, and I restart them a lot), I get a new internal private IP, and I need to reconfigure Squid, this means that I will be running "squid -k reconfigure" multiple times a minute.

 

Will this have a bad effect on Squid and traffic (I understand this does not cause Squid to restart)? What is my alternative?

 

Thanks,

Roee

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220320/a464c88b/attachment.htm>

From squid3 at treenet.co.nz  Sun Mar 20 04:50:47 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sun, 20 Mar 2022 17:50:47 +1300
Subject: [squid-users] Reconfiguring Squid every few seconds
In-Reply-To: <CAGCa14oWzbRYC0So5Z-WeuOVEZ5uQe25zDrzYbVY6JAUBV68Cw@mail.gmail.com>
References: <CAGCa14oWzbRYC0So5Z-WeuOVEZ5uQe25zDrzYbVY6JAUBV68Cw@mail.gmail.com>
Message-ID: <84ac2b51-d956-2095-2adb-6fb4fc90ec13@treenet.co.nz>

On 19/03/22 13:48, roee klinger wrote:
> Hello,
> 
> I have a server with multiple 4G modems with Squid running?on it, the 4G 
> modems get an internal private IP that is dynamic (unfortunately?this 
> can't be changed),
> 
> I set up Squid to use the interfaces as follows:
> 
>     tcp_outgoing_address <some_ip>
> 
> The configuration works well and everything works great, however, 
> whenever I restart one of the modems (I have many, and I restart them a 
> lot), I get a new internal private IP, and I need to reconfigure Squid, 
> this means that I will be running "squid -k reconfigure" multiple times 
> a minute.
> 
> Will this have a bad effect on Squid and traffic (I understand this does 
> not cause?Squid to restart)? What is my alternative?
> 

Alternative is to **not** configure Squid with a static IP.

You could use an outgoing TOS or NFMARK from Squid. The OS networking 
rules can select routes based on that.

OR, if the src-IP has to change based on the modem being used. You could 
use the TOS/MARK in src-NAT rules before route selection - those being 
the point reconfigured instead of Squid.

Amos


From shadowpilot34 at gmail.com  Sun Mar 20 06:40:45 2022
From: shadowpilot34 at gmail.com (His Shadow)
Date: Sun, 20 Mar 2022 09:40:45 +0300
Subject: [squid-users] Reconfiguring Squid every few seconds
In-Reply-To: <84ac2b51-d956-2095-2adb-6fb4fc90ec13@treenet.co.nz>
References: <CAGCa14oWzbRYC0So5Z-WeuOVEZ5uQe25zDrzYbVY6JAUBV68Cw@mail.gmail.com>
 <84ac2b51-d956-2095-2adb-6fb4fc90ec13@treenet.co.nz>
Message-ID: <CAK7W0xe2Wi9jMoU3aKGnaCdo=mJaft0bnmA-heR_H2mycOQjeQ@mail.gmail.com>

I once patched squid to use the local address of an incoming socket as
the local address of the outgoing connection, instead of having 2k
tcp_outgoing_address directives in my configuration. Perhaps something
like this can be done here as well?

??, 20 ???. 2022 ?. ? 07:54, Amos Jeffries <squid3 at treenet.co.nz>:
>
> On 19/03/22 13:48, roee klinger wrote:
> > Hello,
> >
> > I have a server with multiple 4G modems with Squid running on it, the 4G
> > modems get an internal private IP that is dynamic (unfortunately this
> > can't be changed),
> >
> > I set up Squid to use the interfaces as follows:
> >
> >     tcp_outgoing_address <some_ip>
> >
> > The configuration works well and everything works great, however,
> > whenever I restart one of the modems (I have many, and I restart them a
> > lot), I get a new internal private IP, and I need to reconfigure Squid,
> > this means that I will be running "squid -k reconfigure" multiple times
> > a minute.
> >
> > Will this have a bad effect on Squid and traffic (I understand this does
> > not cause Squid to restart)? What is my alternative?
> >
>
> Alternative is to **not** configure Squid with a static IP.
>
> You could use an outgoing TOS or NFMARK from Squid. The OS networking
> rules can select routes based on that.
>
> OR, if the src-IP has to change based on the modem being used. You could
> use the TOS/MARK in src-NAT rules before route selection - those being
> the point reconfigured instead of Squid.
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



-- 
HisShadow


From ngtech1ltd at gmail.com  Sun Mar 20 12:33:40 2022
From: ngtech1ltd at gmail.com (Eliezer Croitoru)
Date: Sun, 20 Mar 2022 14:33:40 +0200
Subject: [squid-users] Reconfiguring Squid every few seconds
References: <CAGCa14oWzbRYC0So5Z-WeuOVEZ5uQe25zDrzYbVY6JAUBV68Cw@mail.gmail.com> 
Message-ID: <001a01d83c56$bb6aeaf0$3240c0d0$@gmail.com>

To give some perspective you can see the next example:

https://github.com/elico/mwan-nft-lb-example

 

but you need to learn first how network namespaces works in linux.

You will probably need to run squid in it?s own namespace which will be managed from the ?main? or ?root? namespace.

It will probably be similar to a management interface and virtual routers on products like Palo Alto.

 

Eliezer

 

----

Eliezer Croitoru

NgTech, Tech Support

Mobile: +972-5-28704261

Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> 

 

From: Eliezer Croitoru <ngtech1ltd at gmail.com> 
Sent: Sunday, March 20, 2022 00:20
To: 'Squid Users' <squid-users at lists.squid-cache.org>
Subject: RE: [squid-users] Reconfiguring Squid every few seconds

 

Hey Roee,

 

The best solution for you case is to use a network namespace Router between the squid instance to the actual modem interface.

You can attach each modem to a network namespace and leave squid to do it?s thing with a static IP address.

 

All The Bests,

Eliezer

 

----

Eliezer Croitoru

NgTech, Tech Support

Mobile: +972-5-28704261

Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> 

 

From: squid-users <squid-users-bounces at lists.squid-cache.org <mailto:squid-users-bounces at lists.squid-cache.org> > On Behalf Of roee klinger
Sent: Saturday, March 19, 2022 02:48
To: Squid Users <squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> >
Subject: [squid-users] Reconfiguring Squid every few seconds

 

Hello,

 

I have a server with multiple 4G modems with Squid running on it, the 4G modems get an internal private IP that is dynamic (unfortunately this can't be changed),

 

I set up Squid to use the interfaces as follows:

tcp_outgoing_address <some_ip>

 

The configuration works well and everything works great, however, whenever I restart one of the modems (I have many, and I restart them a lot), I get a new internal private IP, and I need to reconfigure Squid, this means that I will be running "squid -k reconfigure" multiple times a minute.

 

Will this have a bad effect on Squid and traffic (I understand this does not cause Squid to restart)? What is my alternative?

 

Thanks,

Roee

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220320/a9da0e4e/attachment.htm>

From roeeklinger60 at gmail.com  Mon Mar 21 00:34:26 2022
From: roeeklinger60 at gmail.com (roee klinger)
Date: Mon, 21 Mar 2022 02:34:26 +0200
Subject: [squid-users] Reconfiguring Squid every few seconds
In-Reply-To: <001a01d83c56$bb6aeaf0$3240c0d0$@gmail.com>
References: <CAGCa14oWzbRYC0So5Z-WeuOVEZ5uQe25zDrzYbVY6JAUBV68Cw@mail.gmail.com>
 <001a01d83c56$bb6aeaf0$3240c0d0$@gmail.com>
Message-ID: <05c40641-7e45-4671-8c40-58b24e316a7b@Spark>

Thank you everyone for your advice.

As far as I can tell, there is no graceful and easy way to do it in Squid out of the box,
I will have to use namespaces + virtual interfaces or mark outgoing traffic from Squid,
I am currently looking into these 2 solutions that you suggested, I will implement them
and update here how it goes after testing.

However, for now as much as I love Squid I need a fast and easy solution, so I decided to
use Tiny-proxy transparent proxy instead, where I can simply run the service 40 times in parallel since it is so light.
Then, if there is a reboot of the modem, I can simply restart the specific service I need,
without effecting the other services and users.

Of course, this only works if you have a really simple configuration, for example like my case:
traffic from port 8001 -> out from modem1
traffic from port 8002 -> out from modem2
...
...

I will update shortly when I find a Squid solution,
Roee


On 20 Mar 2022, 14:33 +0200, Eliezer Croitoru <ngtech1ltd at gmail.com>, wrote:
> To give some perspective you can see the next example:
> https://github.com/elico/mwan-nft-lb-example
>
> but you need to learn first how network namespaces works in linux.
> You will probably need to run squid in it?s own namespace which will be managed from the ?main? or ?root? namespace.
> It will probably be similar to a management interface and virtual routers on products like Palo Alto.
>
> Eliezer
>
> ----
> Eliezer Croitoru
> NgTech, Tech Support
> Mobile: +972-5-28704261
> Email: ngtech1ltd at gmail.com
>
> From: Eliezer Croitoru <ngtech1ltd at gmail.com>
> Sent: Sunday, March 20, 2022 00:20
> To: 'Squid Users' <squid-users at lists.squid-cache.org>
> Subject: RE: [squid-users] Reconfiguring Squid every few seconds
>
> Hey Roee,
>
> The best solution for you case is to use a network namespace Router between the squid instance to the actual modem interface.
> You can attach each modem to a network namespace and leave squid to do it?s thing with a static IP address.
>
> All The Bests,
> Eliezer
>
> ----
> Eliezer Croitoru
> NgTech, Tech Support
> Mobile: +972-5-28704261
> Email: ngtech1ltd at gmail.com
>
> From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of roee klinger
> Sent: Saturday, March 19, 2022 02:48
> To: Squid Users <squid-users at lists.squid-cache.org>
> Subject: [squid-users] Reconfiguring Squid every few seconds
>
> Hello,
>
> I have a server with multiple 4G modems with Squid running?on it, the 4G modems get an internal private IP that is dynamic (unfortunately?this can't be changed),
>
> I set up Squid to use the interfaces as follows:
> > tcp_outgoing_address <some_ip>
> >
> The configuration works well and everything works great, however, whenever I restart one of the modems (I have many, and I restart them a lot), I get a new internal private IP, and I need to reconfigure Squid, this means that I will be running "squid -k reconfigure" multiple times a minute.
>
> Will this have a bad effect on Squid and traffic (I understand this does not cause?Squid to restart)? What is my alternative?
>
> Thanks,
> Roee
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220321/c2f04ebf/attachment.htm>

From ngtech1ltd at gmail.com  Mon Mar 21 05:11:15 2022
From: ngtech1ltd at gmail.com (Eliezer Croitoru)
Date: Mon, 21 Mar 2022 07:11:15 +0200
Subject: [squid-users] Reconfiguring Squid every few seconds
In-Reply-To: <05c40641-7e45-4671-8c40-58b24e316a7b@Spark>
References: <CAGCa14oWzbRYC0So5Z-WeuOVEZ5uQe25zDrzYbVY6JAUBV68Cw@mail.gmail.com>
 <001a01d83c56$bb6aeaf0$3240c0d0$@gmail.com>
 <05c40641-7e45-4671-8c40-58b24e316a7b@Spark>
Message-ID: <000201d83ce2$17e68b50$47b3a1f0$@gmail.com>

Hey Roee,

 

If Tiny-proxy works for you then it?s great.

 

All The Bests,

Eliezer

 

*	There are many ways to offer the same solution however the best solution is what works for you..

 

----

Eliezer Croitoru

NgTech, Tech Support

Mobile: +972-5-28704261

Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> 

 

From: roee klinger <roeeklinger60 at gmail.com> 
Sent: Monday, March 21, 2022 02:34
To: Squid Users <squid-users at lists.squid-cache.org>; Eliezer Croitoru <ngtech1ltd at gmail.com>
Subject: Re: [squid-users] Reconfiguring Squid every few seconds

 

Thank you everyone for your advice.

As far as I can tell, there is no graceful and easy way to do it in Squid out of the box,
I will have to use namespaces + virtual interfaces or mark outgoing traffic from Squid,
I am currently looking into these 2 solutions that you suggested, I will implement them
and update here how it goes after testing.

However, for now as much as I love Squid I need a fast and easy solution, so I decided to
use Tiny-proxy transparent proxy instead, where I can simply run the service 40 times in parallel since it is so light.
Then, if there is a reboot of the modem, I can simply restart the specific service I need,
without effecting the other services and users.

Of course, this only works if you have a really simple configuration, for example like my case:
traffic from port 8001 -> out from modem1
traffic from port 8002 -> out from modem2
...
...

I will update shortly when I find a Squid solution,
Roee

 

On 20 Mar 2022, 14:33 +0200, Eliezer Croitoru <ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> >, wrote:



To give some perspective you can see the next example:

https://github.com/elico/mwan-nft-lb-example

 

but you need to learn first how network namespaces works in linux.

You will probably need to run squid in it?s own namespace which will be managed from the ?main? or ?root? namespace.

It will probably be similar to a management interface and virtual routers on products like Palo Alto.

 

Eliezer

 

----

Eliezer Croitoru

NgTech, Tech Support

Mobile: +972-5-28704261

Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> 

 

From: Eliezer Croitoru <ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> >
Sent: Sunday, March 20, 2022 00:20
To: 'Squid Users' <squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> >
Subject: RE: [squid-users] Reconfiguring Squid every few seconds

 

Hey Roee,

 

The best solution for you case is to use a network namespace Router between the squid instance to the actual modem interface.

You can attach each modem to a network namespace and leave squid to do it?s thing with a static IP address.

 

All The Bests,

Eliezer

 

----

Eliezer Croitoru

NgTech, Tech Support

Mobile: +972-5-28704261

Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> 

 

From: squid-users <squid-users-bounces at lists.squid-cache.org <mailto:squid-users-bounces at lists.squid-cache.org> > On Behalf Of roee klinger
Sent: Saturday, March 19, 2022 02:48
To: Squid Users <squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> >
Subject: [squid-users] Reconfiguring Squid every few seconds

 

Hello,

 

I have a server with multiple 4G modems with Squid running on it, the 4G modems get an internal private IP that is dynamic (unfortunately this can't be changed),

 

I set up Squid to use the interfaces as follows:

tcp_outgoing_address <some_ip>

 

The configuration works well and everything works great, however, whenever I restart one of the modems (I have many, and I restart them a lot), I get a new internal private IP, and I need to reconfigure Squid, this means that I will be running "squid -k reconfigure" multiple times a minute.

 

Will this have a bad effect on Squid and traffic (I understand this does not cause Squid to restart)? What is my alternative?

 

Thanks,

Roee

_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> 
http://lists.squid-cache.org/listinfo/squid-users

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220321/2de0c8c9/attachment.htm>

From eugen at grosbein.net  Tue Mar 22 09:27:42 2022
From: eugen at grosbein.net (Eugene Grosbein)
Date: Tue, 22 Mar 2022 16:27:42 +0700
Subject: [squid-users] version 5.4.1 aborts squid process (SIGABRT)
Message-ID: <60e572fb-f308-83ad-f9f8-b07ba7a2406b@grosbein.net>

Hi!

Recently I upgraded one old squid-3.5 instance to the version 5.4.1 under FreeBSD-12.3/amd64 (64 bit)
using its Ports Collection.

Old version worked rock-stable for years but after upgrade new one crashed with a message from the kernel:

kernel: pid 43512 (squid), jid 0, uid 100: exited on signal 6 (core dumped)

Then, I rebuilt squid with debugging symbols enabled and next time it crashed
I've got nice coredump and backtrace:

(gdb) bt
#0  0x000000080175bf1a in thr_kill () from /lib/libc.so.7
#1  0x000000080175a2d4 in raise () from /lib/libc.so.7
#2  0x00000008016d2d29 in abort () from /lib/libc.so.7
#3  0x000000080174a2c1 in __assert () from /lib/libc.so.7
#4  0x00000000009c2d07 in Ip::Address::getAddrInfo (this=0x81393b7e8,
    dst=@0x7fffffffdfa0: 0x813af39d0, force=0) at Address.cc:663
#5  0x00000000009b2300 in comm_openex (sock_type=1, proto=6, addr=..., flags=1,
    note=0x84cd1b040 "[fe80::30be:e84c:67b2:d2c2]") at comm.cc:347
#6  0x0000000000a060cb in Comm::ConnOpener::createFd (this=0x80d8c72d8) at ConnOpener.cc:288
#7  0x0000000000a05ca1 in Comm::ConnOpener::start (this=0x80d8c72d8) at ConnOpener.cc:261
#8  0x00000000009a2983 in NullaryMemFunT<AsyncJob>::doDial (this=0x80ca26ed8)
    at ../../src/base/AsyncJobCalls.h:103
#9  0x00000000009a2e6b in JobDialer<AsyncJob>::dial (this=0x80ca26ed8, call=...)
    at ../../src/base/AsyncJobCalls.h:175
#10 0x00000000009a2cfc in AsyncCallT<NullaryMemFunT<AsyncJob> >::fire (this=0x80ca26ea0)
    at ../../src/base/AsyncCall.h:145
#11 0x000000000099e62d in AsyncCall::make (this=0x80ca26ea0) at AsyncCall.cc:44
#12 0x000000000099f5df in AsyncCallQueue::fireNext (this=0x802280cd0) at AsyncCallQueue.cc:60
#13 0x000000000099f1cc in AsyncCallQueue::fire (this=0x802280cd0) at AsyncCallQueue.cc:43
#14 0x00000000006a0839 in EventLoop::dispatchCalls (this=0x7fffffffea90) at EventLoop.cc:144
#15 0x00000000006a0711 in EventLoop::runOnce (this=0x7fffffffea90) at EventLoop.cc:121
#16 0x00000000006a0580 in EventLoop::run (this=0x7fffffffea90) at EventLoop.cc:83
#17 0x0000000000826ed3 in SquidMain (argc=5, argv=0x7fffffffeba8) at main.cc:1716
#18 0x0000000000826155 in SquidMainSafe (argc=5, argv=0x7fffffffeba8) at main.cc:1403
#19 0x0000000000826122 in main (argc=5, argv=0x7fffffffeba8) at main.cc:1391

(gdb) frame 4
#4  0x00000000009c2d07 in Ip::Address::getAddrInfo (this=0x81393b7e8,
    dst=@0x7fffffffdfa0: 0x813af39d0, force=0) at Address.cc:663
663             IASSERT("false",false);
(gdb) l
658
659             dst->ai_addrlen = sizeof(struct sockaddr_in);
660
661             dst->ai_family = ((struct sockaddr_in*)dst->ai_addr)->sin_family;
662         } else {
663             IASSERT("false",false);
664         }
665     }
666
667     void
(gdb) p Ip::EnableIpv6
$27 = 0

It was built from source without --enable-ipv6,
also src/cf.data.pre was modified before build (by Ports building system):

"::1" removed from the line "DEFAULT: localhost src 127.0.0.1/32 ::1"
"::1/128 ::/128" removed from the line "DEFAULT: to_localhost dst 127.0.0.0/8 0.0.0.0/32 ::1/128 ::/128"
"2001:DB8::2" removed from the line "acl htcp_clr_peer src 192.0.2.2 2001:DB8::2"
"2001:DB8::a:0/64" removed from the line "acl localclients src 192.0.2.0/24 2001:DB8::a:0/64"

Also, the following lines removed completely:

acl localnet src fc00::/7              # RFC 4193 local private network range
acl localnet src fe80::/10             # RFC 4291 link-local (directly plugged) machines
tcp_outgoing_address 2001:db8::c001 good_service_net
tcp_outgoing_address 2001:db8::beef normal_service_net
tcp_outgoing_address 2001:db8::1

The system is not configured for IPv6 ether, as it runs inside private IPv4-only network behind NAT box
that has no IPv6 connectivity, too. The system has no IPv6 addresses configured on its network interfaces
except of loopback "inet6 fe80::1%lo0 prefixlen 64 scopeid 0x3" on the interface lo0.

So, the function comm_openex() calls addr.getAddrInfo(AI) with default value of force argument:
https://github.com/squid-cache/squid/blame/master/src/comm.cc#L345

EnableIpv6 is zero, therefore Ip::Address::getAddrInfo() crashes squid:
https://github.com/squid-cache/squid/blame/master/src/ip/Address.cc#L663

Looks like a bug in the Ip::Address::getAddrInfo(), does it?


From squid3 at treenet.co.nz  Tue Mar 22 09:52:06 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 22 Mar 2022 22:52:06 +1300
Subject: [squid-users] version 5.4.1 aborts squid process (SIGABRT)
In-Reply-To: <60e572fb-f308-83ad-f9f8-b07ba7a2406b@grosbein.net>
References: <60e572fb-f308-83ad-f9f8-b07ba7a2406b@grosbein.net>
Message-ID: <8ea7f231-2a75-9302-7c7c-e93b7c342a0a@treenet.co.nz>

On 22/03/22 22:27, Eugene Grosbein wrote:
> #5  0x00000000009b2300 in comm_openex (sock_type=1, proto=6, addr=..., flags=1,
>      note=0x84cd1b040 "[fe80::30be:e84c:67b2:d2c2]") at comm.cc:347

This is <https://bugs.squid-cache.org/show_bug.cgi?id=5154>

Amos


From admin at tiehm.me  Tue Mar 22 20:04:03 2022
From: admin at tiehm.me (admin at tiehm.me)
Date: Tue, 22 Mar 2022 21:04:03 +0100
Subject: [squid-users] Difference between cache manager http request count
 and access.log entries
Message-ID: <002901d83e27$fbed28e0$f3c77aa0$@tiehm.me>

Hi!

 

I?ve recently stumbled across all the information that is returned from the squid cache manager. Now after analysing the request count data a bit on the cache manager information responses I noticed that they do not match up with the amount of logs in access.log. There might be 300 requests/s (as shown by the cache manager by comparing the values and calculating the average per second) and only 100 access.log entries in the somewhat similar time (given a few seconds to make sure it was written). 

I am wondering: what causes that or rather how do I have to interpret those different numbers? Which of those can I trust?

I am aware that a CONNECT only shows up once and requests routed through the tunnel do not show up in access.log, however I thought that you can not see single requests on squids side as it is encrypted and thus not count it. That would be my only guess on what it could be.

 

Using squid 5 on Debian 11 and 99.9% of the traffic is HTTPS.

 

I would appreciate any help.

Thanks!  

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220322/c2983712/attachment.htm>

From squid3 at treenet.co.nz  Wed Mar 23 09:43:04 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 23 Mar 2022 22:43:04 +1300
Subject: [squid-users] Difference between cache manager http request
 count and access.log entries
In-Reply-To: <002901d83e27$fbed28e0$f3c77aa0$@tiehm.me>
References: <002901d83e27$fbed28e0$f3c77aa0$@tiehm.me>
Message-ID: <9cfc2a6b-f7a1-2468-de89-55c94101a9f2@treenet.co.nz>

On 23/03/22 09:04, admin wrote:
> Hi!
> 
> I?ve recently stumbled across all the information that is returned from 
> the squid cache manager. Now after analysing the request count data a 
> bit on the cache manager information responses I noticed that they do 
> not match up with the amount of logs in access.log. There might be 300 
> requests/s (as shown by the cache manager by comparing the values and 
> calculating the average per second) and only 100 access.log entries in 
> the somewhat similar time (given a few seconds to make sure it was 
> written).
> 
> I am wondering: what causes that or rather how do I have to interpret 
> those different numbers? Which of those can I trust?

Which manager report are you looking at?

Some reports show average across the entire Squid lifetime across all 
workers.

> 
> I am aware that a CONNECT only shows up once and requests routed through 
> the tunnel do not show up in access.log, however I thought that you can 
> not see single requests on squids side as it is encrypted and thus not 
> count it.

That is normally correct, unless you are decrypting the traffic. In 
which case the decrypted requests and several transactions used to do 
the decryption are logged (and counted).


HTH
Amos


From admin at tiehm.me  Sat Mar 26 13:34:58 2022
From: admin at tiehm.me (admin at tiehm.me)
Date: Sat, 26 Mar 2022 14:34:58 +0100
Subject: [squid-users] Difference between cache manager http request
 count and access.log entries
In-Reply-To: <9cfc2a6b-f7a1-2468-de89-55c94101a9f2@treenet.co.nz>
References: <002901d83e27$fbed28e0$f3c77aa0$@tiehm.me>
 <9cfc2a6b-f7a1-2468-de89-55c94101a9f2@treenet.co.nz>
Message-ID: <001c01d84116$4c2f64d0$e48e2e70$@tiehm.me>

I am looking at the "counters" report, so the total requests which I then calculate into rates with Prometheus/Grafana. I will double check if there is something wrong there if there is no other explanation for this behaviour.
I do not run a MITM or root certificate so I am unable to read HTTP Requests on their own on all traffic, so that can not be it really.

-----Urspr?ngliche Nachricht-----
Von: squid-users <squid-users-bounces at lists.squid-cache.org> Im Auftrag von Amos Jeffries
Gesendet: Wednesday, 23 March 2022 10:43
An: squid-users at lists.squid-cache.org
Betreff: Re: [squid-users] Difference between cache manager http request count and access.log entries

On 23/03/22 09:04, admin wrote:
> Hi!
> 
> I?ve recently stumbled across all the information that is returned 
> from the squid cache manager. Now after analysing the request count 
> data a bit on the cache manager information responses I noticed that 
> they do not match up with the amount of logs in access.log. There 
> might be 300 requests/s (as shown by the cache manager by comparing 
> the values and calculating the average per second) and only 100 
> access.log entries in the somewhat similar time (given a few seconds 
> to make sure it was written).
> 
> I am wondering: what causes that or rather how do I have to interpret 
> those different numbers? Which of those can I trust?

Which manager report are you looking at?

Some reports show average across the entire Squid lifetime across all workers.

> 
> I am aware that a CONNECT only shows up once and requests routed 
> through the tunnel do not show up in access.log, however I thought 
> that you can not see single requests on squids side as it is encrypted 
> and thus not count it.

That is normally correct, unless you are decrypting the traffic. In which case the decrypted requests and several transactions used to do the decryption are logged (and counted).


HTH
Amos
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From ngtech1ltd at gmail.com  Sun Mar 27 01:32:42 2022
From: ngtech1ltd at gmail.com (Eliezer Croitoru)
Date: Sun, 27 Mar 2022 04:32:42 +0300
Subject: [squid-users] Thinking out loud about "applications" definition for
 squid
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAG15AYh8TcJOh7jZfP/beGvCgAAAEAAAAAdp827zbIBEnsSKBEnN0i4BAAAAAA==@gmail.com>

Hey,

I have been thinking about defining a specific way that will tag connections
with an APP ID for simplicity.
For example I have just seen couple support websites of web systems vendors
that provide their domains and ip addresses.
The basic example would be:
https://help.pluralsight.com/help/ip-allowlist

Which provides the next basic info:
*.pluralsight.com
*.typekit.com

# Video CDN
vid.pluralsight.com
vid5.pluralsight.com
vid20.pluralsight.com
vid21.pluralsight.com
vid30.pluralsight.com

# Excertises files
ip-video-course-exercise-files-us-west-2.s3.us-west-2.amazonaws.com

So it means that technically if I have this defined somewhere I can run an
external acl helper that will get all the details of the request and will
tag
the request and/or connection with an APP ID that can be allowed or denied
by the next external acl helper in the pipe line.
The next access log:
https://www.ngtech.co.il/squid/pluralsight-access-log.txt

is a bit redacted but still contains the relevant log lines.

So the relevant ACL options are:
http_access Allow/deny
TLS Splice/bump
Dst_ip - APP ID
Src_ip - Allow/Deny/others
Cache allow/deny
 
I would assume that every request with the dstdomain:
.pluralsight.com
ip-video-course-exercise-files-us-west-2.s3.us-west-2.amazonaws.com

Or SNI regex:
\.pluralsight\.com$
^ip-video-course-exercise-files-us-west-2\.s3\.us-west-2\.amazonaws\.com$

Should 100% be tagged with a pluralsight APP ID tag.

It would be a similar idea with goolge/gmail/Microsoft/AV/others
And since it's a very simple and re-producible APP ID tagging technique it
can be simplified into a set of helpers.

So first, what do you as a squid user think about it?
Can you and others help me work on a simple project that will help with this
specific idea?
A list of applications ID might be a good starter for the first
POC/Development process.

One place I have seen a similar implementation would be:
https://github.com/ntop/nDPI/blob/dev/src/include/ndpi_protocol_ids.h

I think that the goal would be that it would be possible to use an API that
will be able to change a rule or a ruleset per client paired with a
protocol.
Much like in a FW rules the helper would be able to run a query against a
small embedded json/other dbase/base that will contain all the relevant
details of the apps
And another part of it would be to contain the ruleset itself.

So for example a definition of:
Match: client, appID, verdict(allow/deny)
Match: client, appID, verdict(bump/splice)
Match: dst, appID, verdict(allow/deny)..

Would be pretty simple to define by the proxy admin.

Let me know how can you help with this project.

Thanks,
Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com




From spinter at npsh.hu  Mon Mar 28 17:29:16 2022
From: spinter at npsh.hu (=?UTF-8?Q?Pint=c3=a9r_Szabolcs?=)
Date: Mon, 28 Mar 2022 19:29:16 +0200
Subject: [squid-users] squid with OAuth2.0
In-Reply-To: <4ff7ad3f-03e9-41d9-d914-ff520ccf3240@npsh.hu>
References: <85423ee4-4efa-f162-a2b5-e9e7ca77a8b8@npsh.hu>
 <e849c17d-4e88-2698-5a1b-f389471a0ac2@treenet.co.nz>
 <4ff7ad3f-03e9-41d9-d914-ff520ccf3240@npsh.hu>
Message-ID: <b1ccbaf0-6fb7-34dd-9d22-4b1bd7a4df49@npsh.hu>

Hi


Could I get plus information about the merging problem and the solution.

We need help with this problem because we want to use this with 50000useres.


Thanks,

Szabolcs!



2022. 03. 16. 8:43 keltez?ssel, Pint?r Szabolcs ?rta:
> Hi
>
>
> Thank you for the reply.
>
>
> I see the merge to the master failed?
>
> Could you try again the merging or is there any problem with the 
> solution?
>
>
> Can I use this tree https://github.com/yadij/squid/tree/auth-bearer 
> for a test until the merging doesn't going to be success?
>
>
>
> 2022. 03. 11. 4:31 keltez?ssel, Amos Jeffries ?rta:
>> On 11/03/22 05:38, Pint?r Szabolcs wrote:
>>> Hi
>>>
>>>
>>> I'm Szabolcs and I want to use your proxy with an OAuth2 solution.
>>>
>>> I think I have tou use this part of the Documentiation:
>>>
>>> https://wiki.squid-cache.org/Features/BearerAuthentication
>>>
>>>
>>> But I didn't find more information about this, can I use it if i 
>>> rebuild the code from there project: 
>>> https://github.com/squid-cache/squid. (Sadly I didn't find any 
>>> relevant part from the code or the git commits)
>>>
>>> I find just this flags on a configure file: ? --enable-auth , 
>>> --enable-auth-basic="list of helpers", --enable-auth-digest="list of 
>>> helpers", --enable-auth-negotiate="list of helpers", 
>>> --enable-auth-ntlm="list of helpers".
>>>
>>>
>>> Have I any chacne to find an OAuth solution for squid?
>>>
>>
>>
>> You currently still need to build the code development branch at 
>> <https://github.com/squid-cache/squid/pull/30>. Looks like some build 
>> issues right now, I hope to have a fix in the next day or so for that.
>>
>> You will have to create your own auth helper to do the OAuth b64token 
>> verification. I/O protocol for the helper is documented on that page.
>>
>> Also, please be aware that as far as we can tell Browser clients only 
>> use OAuth Bearer when they think they are talking to an origin 
>> server. So it is mostly useful as a reverse-proxy authentication.
>>
>>
>> Amos
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
-- 
*Pint?r Szabolcs P?ter*
H-1117 Budapest, Neumann J?nos u. 1. A ?p?let 2. emelet
+36 1 489-4600
+36 30 471-3827
spinter at npsh.hu
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220328/9544ebc5/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0FmgGQvi2VIeg3XK.png
Type: image/png
Size: 3869 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220328/9544ebc5/attachment.png>

From squid3 at treenet.co.nz  Tue Mar 29 00:46:42 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 29 Mar 2022 13:46:42 +1300
Subject: [squid-users] squid with OAuth2.0
In-Reply-To: <b1ccbaf0-6fb7-34dd-9d22-4b1bd7a4df49@npsh.hu>
References: <85423ee4-4efa-f162-a2b5-e9e7ca77a8b8@npsh.hu>
 <e849c17d-4e88-2698-5a1b-f389471a0ac2@treenet.co.nz>
 <4ff7ad3f-03e9-41d9-d914-ff520ccf3240@npsh.hu>
 <b1ccbaf0-6fb7-34dd-9d22-4b1bd7a4df49@npsh.hu>
Message-ID: <3c6f36db-e905-27c1-de53-978a6f9dc0e6@treenet.co.nz>

On 29/03/22 06:29, Pint?r Szabolcs wrote:
> Hi
> 
> Could I get plus information about the merging problem and the solution.
> 

The recent merge from master;
   failed due to an extra CI spellcheck, and C++11 syntax master started 
using since the branch previous update. The fixes were all trivial and 
not affecting how the code works.


The branch not being merged officially;
  is waiting for me to have time to polish up the formal addition of 
ttl= kv-pair into the helper official protocol. The OAuth Bearer auth PR 
includes that addition, so can be used without other patching.


> We need help with this problem because we want to use this with 50000useres.
> 

AFAIK it is usable without the alterations being waited on for formal 
release. Do test it first though before rollout.


Amos


From snip3rmh at gmail.com  Tue Mar 29 13:17:11 2022
From: snip3rmh at gmail.com (Alberto Montes de Oca)
Date: Tue, 29 Mar 2022 09:17:11 -0400
Subject: [squid-users] Access denied using mskutil
Message-ID: <CAOYupTT7CNKcBb1diwtsXi4BT4VYFs6W6UGcvqORP7+4QCUd6w@mail.gmail.com>

Hi, I?m trying to set up squid authentication with a Windows AD domain
controller, and everything goes well until I try to check if the host
account updates successfully, using the following commands:

msktutil --auto-update --verbose --dont-expire-password \
-b "CN=SQUIDPROXY,OU=OU_NAME,,DC=MYDOMAIN,DC=XX" \
--user-creds-only \
--computer-name SQUIDPROXY \
-k /etc/squid/squidproxy.keytab \
--server pdc1.mydomain.xx \
--no-reverse-lookups

and I always end up with the same error:
 -- init_password: Wiping the computer password structure
 -- generate_new_password: Generating a new, random password for the
computer account
 -- generate_new_password:  Characters read from /dev/urandom = 93
 -- create_fake_krb5_conf: Created a fake krb5.conf file:
/tmp/.msktkrb5.conf-atrIYH
 -- destroy_g_context: Destroying Kerberos Context
 -- initialize_g_context: Creating Kerberos Context
 -- finalize_exec: SAM Account Name is: SQUIDPROXY$
 -- try_user_creds: Checking if default ticket cache has tickets
 -- finalize_exec: Authenticated using method 5
 -- LDAPConnection: Connecting to LDAP server: dc1.cip.cu
SASL/GSSAPI authentication started
SASL username: HTTP/squidproxy.mydomain.xx at MYDOMAIN.XX
SASL SSF: 256
SASL data security layer installed.
 -- ldap_get_base_dn: Determining default LDAP base: dc=MYDOMAIN,dc=XX
 -- ldap_check_account: Checking that a computer account for SQUIDPROXY$
exists
 -- ldap_check_account: Checking computer account - found
 -- ldap_check_account: Found userAccountControl = 0x11000
 -- ldap_check_account: Found supportedEncryptionTypes = 28
 -- ldap_check_account: Found dNSHostName = squidproxy.mydomain.xx
 -- ldap_check_account: Found Principal: host/squidproxy.mydomain.xx
 -- ldap_check_account: Found Principal: HTTP/squidproxy.mydomain.xx
 -- ldap_check_account: Found User Principal: HTTP/squidproxy.mydomain.xx
 -- ldap_check_account_strings: Inspecting (and updating) computer account
attributes
 -- ldap_set_supportedEncryptionTypes: No need to change
msDs-supportedEncryptionTypes they are 28
 -- ldap_set_userAccountControl_flag: Setting userAccountControl bit at
0x200000 to 0x0
 -- ldap_set_userAccountControl_flag: userAccountControl not changed 0x11000
 -- ldap_set_userAccountControl_flag: Setting userAccountControl bit at
0x10000 to 0x1
 -- ldap_set_userAccountControl_flag: userAccountControl not changed 0x11000
 -- ldap_get_kvno: KVNO is 1
 -- set_password: Attempting to reset computer's password
 -- set_password: Try change password using user's ticket cache
 -- ldap_get_pwdLastSet: pwdLastSet is 132929651811891069
Error: Unable to set machine password for SQUIDPROXY$: (5) Access denied
Error: set_password failed

The account I'm using for this procedure is the domain administrator
account, so I don?t know why is giving me an access denied error. This is
the procedure I?m using:
1 - start the session using the domain controller account <kinit
manager at MYDOMAIN.XX>

2 - created the ticket and host account in the domain controller, and
everytihng went well
msktutil -c -b "OU=OU_NAME" \
-s HTTP/squidproxy.mydomain.xx \
-h squidproxy.mydomain.xx \
-k /etc/squid/squidproxy.keytab \
--computer-name SQUIDPROXY \
--upn HTTP/squidproxy.mydomain.xx \
--server pdc1.mydomain.xx \
--verbose \
--dont-expire-password \
--no-reverse-lookups \
--enctypes 28

3 - checked if the previous procedure went well by typing the following and
it returns nothing as it should
kinit -k HTTP/squidproxy.mydomain.xx

4 - Checked the keytab with klist -k and then changed the permissions and
owner to the keytab file (640 / proxy:proxy)

Then the error when I try to check if the host account updates succesfuly
as explained at the begining, any ideas why this is happening? I would
appreciate the help!!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220329/66e50ebc/attachment.htm>

From hoverhell at gmail.com  Tue Mar 29 13:19:43 2022
From: hoverhell at gmail.com (HoverHell)
Date: Tue, 29 Mar 2022 16:19:43 +0300
Subject: [squid-users] https_port ... tls-cert=... missing the chain in the
 handshake
Message-ID: <CAFrNd3v-n9zO9bxtBXUk9hp1LAEMWvK6rS8esHd=mt9X4SwvGw@mail.gmail.com>

Trying to set up a non-transparent forward proxy with TLS,
using squid 4.10-1ubuntu1.5 (ubuntu 20.04)
config line
`https_port 12345 tls-cert=/etc/letsencrypt/.../fullchain.pem
tls-key=/etc/letsencrypt/.../privkey.pem`
When establishing a TLS connection to that port, squid seems to return only
the domain certificate from the certificate chain:

$ openssl s_client -showcerts -connect hostname:12345 | grep -v
'^[A-Za-z0-9]'
depth=0 CN = ...
verify error:num=20:unable to get local issuer certificate
verify return:1
depth=0 CN = ...
verify error:num=21:unable to verify the first certificate
verify return:1
---
0 s:CN = ...
  i:C = US, O = Let's Encrypt, CN = R3
-----BEGIN CERTIFICATE-----
-----END CERTIFICATE-----

While nginx, using the same pair of files, works correctly:

$ openssl s_client -showcerts -connect hostname:443 | grep -v
'^[A-Za-z0-9]'
depth=2 C = US, O = Internet Security Research Group, CN = ISRG Root X1
verify return:1
depth=1 C = US, O = Let's Encrypt, CN = R3
verify return:1
depth=0 CN = ...
verify return:1
---
0 s:CN = ...
  i:C = US, O = Let's Encrypt, CN = R3
-----BEGIN CERTIFICATE-----
-----END CERTIFICATE-----
1 s:C = US, O = Let's Encrypt, CN = R3
  i:C = US, O = Internet Security Research Group, CN = ISRG Root X1
-----BEGIN CERTIFICATE-----
-----END CERTIFICATE-----
2 s:C = US, O = Internet Security Research Group, CN = ISRG Root X1
  i:O = Digital Signature Trust Co., CN = DST Root CA X3
-----BEGIN CERTIFICATE-----
-----END CERTIFICATE-----

Am I missing some configuration option, or is this a squid4 bug?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220329/ee732a0c/attachment.htm>

From ngtech1ltd at gmail.com  Wed Mar 30 07:27:33 2022
From: ngtech1ltd at gmail.com (Eliezer Croitoru)
Date: Wed, 30 Mar 2022 10:27:33 +0300
Subject: [squid-users] acl aclname server_cert_fingerprint
In-Reply-To: <0713c44d-1790-42c6-ad94-57c749661a72@measurement-factory.com>
References: <000001d6f309$c8996680$59cc3380$@gmail.com>
 <4140a6a8-2555-eb5c-b082-6723c78a739d@measurement-factory.com>
 <000201d6f3b2$3b626240$b22726c0$@gmail.com>
 <2ec9e90e-580c-d37d-68f6-3d1b3d27bb02@measurement-factory.com>
 <000001d6f4cb$ce1242d0$6a36c870$@gmail.com>
 <198a0cb8-a7db-1cbb-b410-e5c067765d59@measurement-factory.com>
 <000001d6f4dd$40289700$c079c500$@gmail.com>
 <0713c44d-1790-42c6-ad94-57c749661a72@measurement-factory.com>
Message-ID: <000001d84407$a02b1ef0$e0815cd0$@gmail.com>

So just to illustrate the usage of :
server_cert_fingerprint

What this acl purpose is? Can it be documented?

Also, There are more things regaring ssl bump bumping and certificates.
Is it possible today to decide whether to bump or not a connection based on some part of the certificate,
else then the sni or domain?
Let say I want to see the certificate and only then decide if it's valid for me.
The best example is a Lets Encrypt certificates.
These are valid technically but for a specific sites I would like to do something else.
Also, can a tag be sent back from a sslcrtd_program??
I want to be able to do something with the certificate and response accordingly.

I have a use case which I want to differentiate between general domain validation certificates to EV ones.
Usually EV certificates are valid for PCI compliance and there for should not be bumped at all.

For example:
https://www.leumi.co.il/

Thanks,
Eliezer


----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com

-----Original Message-----
From: Alex Rousskov <rousskov at measurement-factory.com> 
Sent: Wednesday, January 27, 2021 22:07
To: squid-users at lists.squid-cache.org
Cc: Eliezer Croitoru <ngtech1ltd at gmail.com>
Subject: Re: [squid-users] acl aclname server_cert_fingerprint

On 1/27/21 1:50 PM, Eliezer Croitoru wrote:

> I am still missing a way to make this work with the fingerprint.

I do not know what you are trying to accomplish (i.e. what "this" is).


> We first need to know the fingerprint but when squid "knows" about
> it, it's already too late. In what config scenario can it work?

Knowing the fingerprint (or any other server-sent detail!) is indeed not
useful for making bump-vs-splice decisions. Fingerprint knowledge can be
useful for many other decisions, including whether to allow an HTTP
request, whether to cache an HTTP response, and whether to terminate a
TLS connection.


HTH,

Alex.


> -----Original Message-----
> From: Alex Rousskov <rousskov at measurement-factory.com> 
> Sent: Wednesday, January 27, 2021 8:43 PM
> To: squid-users at lists.squid-cache.org
> Cc: Eliezer Croitoru <ngtech1ltd at gmail.com>
> Subject: Re: [squid-users] acl aclname server_cert_fingerprint
> 
> On 1/27/21 11:45 AM, Eliezer Croitoru wrote:
> 
>> I'm not sure I understood hat these errorcde and error detai.
> 
> FWIW, access log fields are configured using logformat %codes. Search
> squid.conf.documented for the words "err_code" and "err_detail" (no quotes).
> 
> 
>> acl tls_to_splice any-of ... NoBump_certificate_fingerprint
> 
>> acl tls_s1_connect at_step SslBump1
>> acl tls_s2_client_hello at_step SslBump2
> 
>> ssl_bump peek tls_s1_connect
>> ssl_bump splice tls_to_splice
>> ssl_bump stare tls_s2_client_hello
>> ssl_bump bump tls_to_bump
> 
> Bugs notwithstanding, the NoBump_certificate_fingerprint ACL will never
> match in the above configuration AFAICT:
> 
> * step1 is excluded by the earlier "peek if tls_s1_connect" rule. The
> server certificate is not yet available during that step anyway.
> 
> * step2 is reachable for a "splice" action, but the server certificate
> is still not yet available during that step.
> 
> * step3 is unreachable for a "splice" action because the only non-final
> action during step2 is "stare". Starting precludes splicing.
> 
> 
> HTH,
> 
> Alex.
> 
> 
>> -----Original Message-----
>> From: Alex Rousskov <rousskov at measurement-factory.com> 
>> Sent: Wednesday, January 27, 2021 5:12 PM
>> To: Eliezer Croitoru <ngtech1ltd at gmail.com>; squid-users at lists.squid-cache.org
>> Subject: Re: [squid-users] acl aclname server_cert_fingerprint
>>
>> On 1/26/21 2:09 AM, Eliezer Croitoru wrote:
>>
>>> I'm trying to understand what I'm doing wrong in the config that stil
>>> lets edition.cnn.com be decrypted instead of spliced?
>>
>> If you still need help, please share the relevant parts of your
>> configuration and logs. I would start with ssl_bump rules and access log
>> records containing additional %error_code/%err_detail fields.
>>
>> Alex.
>>
>>
>>
>>> -----Original Message-----
>>> From: Alex Rousskov <rousskov at measurement-factory.com> 
>>> Sent: Tuesday, January 26, 2021 6:22 AM
>>> To: Eliezer Croitoru <ngtech1ltd at gmail.com>; squid-users at lists.squid-cache.org
>>> Subject: Re: [squid-users] acl aclname server_cert_fingerprint
>>>
>>> On 1/25/21 6:03 AM, Eliezer Croitoru wrote:
>>>> I'm trying to use:
>>>> acl aclname server_cert_fingerprint [-sha1] fingerprint
>>>>
>>>>
>>>> I have cerated the next file:
>>>> /etc/squid/no-ssl-bump-server-fingerprint.list
>>>>
>>>> And trying to use the next line:
>>>> acl NoBump_certificate_fingerprint server_cert_fingerprint -sha1
>>>> "/etc/squid/no-ssl-bump-server-fingerprint.list"
>>>>
>>>> To be explicit despite that only sha1 is a valid checksum.
>>>> Squid doesn't accept the above line 
>>>
>>>
>>> Does not accept how? What is the error message?
>>>
>>>
>>>> but this one yes:
>>>> acl NoBump_certificate_fingerprint server_cert_fingerprint
>>>> "/etc/squid/no-ssl-bump-server-fingerprint.list"
>>>
>>>> Is there a reason for that?
>>>
>>>
>>> The use of ACL options and ACL parameter options is poorly documented.
>>>
>>> Squid Bug 4847 is marked as fixed, but the corresponding commit d4c6aca
>>> says that server_cert_fingerprint is still broken. Not sure whether that
>>> was true, whether some other commit has fixed that ACL, and whether the
>>> problem mentioned in the commit message is related to your troubles.
>>> https://bugs.squid-cache.org/show_bug.cgi?id=4847
>>> https://github.com/squid-cache/squid/pull/191
>>>
>>> Also, according to my 2015 notes, server_cert_fingerprint happens to be
>>> case sensitive. I consider that a bug. I am not sure, but I think Squid
>>> expects uppercase hex letters (if any). I do not know whether that has
>>> been fixed.
>>>
>>>
>>> Finally, it is dangerous to list ACL parameter options like -sha1 in
>>> front of parameter filename when that parameter file may contain its own
>>> parameter options. A reader may think that -sha1 in squid.conf
>>> overwrites, say, -sha256 in the parameter file, but that is not what
>>> probably will happen when Squid starts supporting both options.
>>>
>>> That consideration may actually be the reason why Squid rejects your
>>> first configuration sample (or perhaps it should be the reason even if
>>> it does not).
>>>
>>> I am sure there are use cases where the admin wants to apply one
>>> parameter option to the whole file, but the ambiguity is too dangerous
>>> to allow IMO. We should make the choice explicit.
>>>
>>>
>>> HTH,
>>>
>>> Alex.
>>>
>>>
>>>
>>>
>>> _______________________________________________
>>> squid-users mailing list
>>> squid-users at lists.squid-cache.org
>>> http://lists.squid-cache.org/listinfo/squid-users
>>>



From carlimeunier at gmail.com  Wed Mar 30 09:09:56 2022
From: carlimeunier at gmail.com (Carl Meunier)
Date: Wed, 30 Mar 2022 11:09:56 +0200
Subject: [squid-users] Are there centos 7 rpm's on ARM of squid 4 or 5?
Message-ID: <CALOwN8=n_Ai3q9Usmk9WFs_4cxvAfqQX4DrsxUKRa+=F2x=gtQ@mail.gmail.com>

Hello,

I want to install squid rpms on Centos 7 on ARM arch.
Are there any packages for this?

Thanks
Carl
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220330/66e73641/attachment.htm>

From ngtech1ltd at gmail.com  Wed Mar 30 12:12:41 2022
From: ngtech1ltd at gmail.com (Eliezer Croitoru)
Date: Wed, 30 Mar 2022 15:12:41 +0300
Subject: [squid-users] Are there centos 7 rpm's on ARM of squid 4 or 5?
In-Reply-To: <CALOwN8=n_Ai3q9Usmk9WFs_4cxvAfqQX4DrsxUKRa+=F2x=gtQ@mail.gmail.com>
References: <CALOwN8=n_Ai3q9Usmk9WFs_4cxvAfqQX4DrsxUKRa+=F2x=gtQ@mail.gmail.com>
Message-ID: <000801d8442f$75891760$609b4620$@gmail.com>

Hey Carl,

 

I do not have an ARM based machine so I cannot build for it.

However it might be possible to build for ARM in the build services of Fedora:

https://copr.fedorainfracloud.org/

 

or OpenSUSE

https://build.opensuse.org/

 

The other option is to build the RPMs inside a container in your environment.

I will try to publish the latest SRPM for CentOS 7 which should work on ARM based systems.

 

Let me know if you can try to build for ARM locally using rpmbuild or a container.

 

Thanks,

Eliezer

 

----

Eliezer Croitoru

NgTech, Tech Support

Mobile: +972-5-28704261

Email:  <mailto:ngtech1ltd at gmail.com> ngtech1ltd at gmail.com

 

From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Carl Meunier
Sent: Wednesday, March 30, 2022 12:10
To: squid-users at lists.squid-cache.org
Subject: [squid-users] Are there centos 7 rpm's on ARM of squid 4 or 5?

 

Hello,

 

I want to install squid rpms on Centos 7 on ARM arch. 

Are there any packages for this?

 

Thanks

Carl  

 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220330/370c4c04/attachment.htm>

From carlimeunier at gmail.com  Wed Mar 30 12:34:18 2022
From: carlimeunier at gmail.com (Carl Meunier)
Date: Wed, 30 Mar 2022 14:34:18 +0200
Subject: [squid-users] Are there centos 7 rpm's on ARM of squid 4 or 5?
In-Reply-To: <000801d8442f$75891760$609b4620$@gmail.com>
References: <CALOwN8=n_Ai3q9Usmk9WFs_4cxvAfqQX4DrsxUKRa+=F2x=gtQ@mail.gmail.com>
 <000801d8442f$75891760$609b4620$@gmail.com>
Message-ID: <CALOwN8=RAb=H7Qk7qn8mT4CwL8PvZ5u7c8Y9eTMo3O5T7Hu6vA@mail.gmail.com>

Thank you for your reply.

Yes you can publish the SRPM. I can build it. I have an ARM based machine
that is ready.

Please let me know when it will be published.



On Wed, 30 Mar 2022, 14:12 Eliezer Croitoru, <ngtech1ltd at gmail.com> wrote:

> Hey Carl,
>
>
>
> I do not have an ARM based machine so I cannot build for it.
>
> However it might be possible to build for ARM in the build services of
> Fedora:
>
> https://copr.fedorainfracloud.org/
>
>
>
> or OpenSUSE
>
> https://build.opensuse.org/
>
>
>
> The other option is to build the RPMs inside a container in your
> environment.
>
> I will try to publish the latest SRPM for CentOS 7 which should work on
> ARM based systems.
>
>
>
> Let me know if you can try to build for ARM locally using rpmbuild or a
> container.
>
>
>
> Thanks,
>
> Eliezer
>
>
>
> ----
>
> Eliezer Croitoru
>
> NgTech, Tech Support
>
> Mobile: +972-5-28704261
>
> Email: ngtech1ltd at gmail.com
>
>
>
> *From:* squid-users <squid-users-bounces at lists.squid-cache.org> *On
> Behalf Of *Carl Meunier
> *Sent:* Wednesday, March 30, 2022 12:10
> *To:* squid-users at lists.squid-cache.org
> *Subject:* [squid-users] Are there centos 7 rpm's on ARM of squid 4 or 5?
>
>
>
> Hello,
>
>
>
> I want to install squid rpms on Centos 7 on ARM arch.
>
> Are there any packages for this?
>
>
>
> Thanks
>
> Carl
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220330/d3a701ca/attachment.htm>

From rousskov at measurement-factory.com  Wed Mar 30 14:26:56 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Wed, 30 Mar 2022 10:26:56 -0400
Subject: [squid-users] acl aclname server_cert_fingerprint
In-Reply-To: <000001d84407$a02b1ef0$e0815cd0$@gmail.com>
References: <000001d6f309$c8996680$59cc3380$@gmail.com>
 <4140a6a8-2555-eb5c-b082-6723c78a739d@measurement-factory.com>
 <000201d6f3b2$3b626240$b22726c0$@gmail.com>
 <2ec9e90e-580c-d37d-68f6-3d1b3d27bb02@measurement-factory.com>
 <000001d6f4cb$ce1242d0$6a36c870$@gmail.com>
 <198a0cb8-a7db-1cbb-b410-e5c067765d59@measurement-factory.com>
 <000001d6f4dd$40289700$c079c500$@gmail.com>
 <0713c44d-1790-42c6-ad94-57c749661a72@measurement-factory.com>
 <000001d84407$a02b1ef0$e0815cd0$@gmail.com>
Message-ID: <21166f34-666b-3a69-f069-2b10732b7087@measurement-factory.com>

On 3/30/22 03:27, Eliezer Croitoru wrote:
> So just to illustrate the usage of :
> server_cert_fingerprint
> 
> What this acl purpose is? Can it be documented?

Please see squid.conf.documented for the best available answers to those 
two questions. If something is not clear in that documentation, please 
ask more specific questions. If my answers clarified something for you, 
consider submitting a pull request that improves existing documentation.


> Is it possible today to decide whether to bump or not a connection
> based on some part of the certificate, else then the sni or domain?

Yes, to a certain extent: After Squid saw the server certificate, it is 
too late to make a bump-vs-splice decision, but it is still possible to 
make a decision to either continue with the previously implicitly 
decided action (bump or splice, depending on whether step2 action was 
stare or peek) or close the TCP connections (i.e. apply the "terminate" 
action).

In other words, after seeing the server certificate, Squid can make a 
continue-vs-terminate decision but not a splice-vs-bump decision.

This is how TLS works. The only known alternative is to use a second, 
"probing" TLS connection to the origin server. Squid does not support 
that alternative natively yet, but there is a constant trickle of 
requests for that feature, especially given TLS v1.3 encryption of 
certificates that effectively places them outside the peek/stare actions 
reach.


> Also, can a tag be sent back from a sslcrtd_program??

IIRC, not yet, but we are working on adding that functionality to the 
sslcrtvalidator_program. If extending that addition to both programs is 
easy, we will do that.


HTH,

Alex.



> -----Original Message-----
> From: Alex Rousskov <rousskov at measurement-factory.com>
> Sent: Wednesday, January 27, 2021 22:07
> To: squid-users at lists.squid-cache.org
> Cc: Eliezer Croitoru <ngtech1ltd at gmail.com>
> Subject: Re: [squid-users] acl aclname server_cert_fingerprint
> 
> On 1/27/21 1:50 PM, Eliezer Croitoru wrote:
> 
>> I am still missing a way to make this work with the fingerprint.
> 
> I do not know what you are trying to accomplish (i.e. what "this" is).
> 
> 
>> We first need to know the fingerprint but when squid "knows" about
>> it, it's already too late. In what config scenario can it work?
> 
> Knowing the fingerprint (or any other server-sent detail!) is indeed not
> useful for making bump-vs-splice decisions. Fingerprint knowledge can be
> useful for many other decisions, including whether to allow an HTTP
> request, whether to cache an HTTP response, and whether to terminate a
> TLS connection.
> 
> 
> HTH,
> 
> Alex.
> 
> 
>> -----Original Message-----
>> From: Alex Rousskov <rousskov at measurement-factory.com>
>> Sent: Wednesday, January 27, 2021 8:43 PM
>> To: squid-users at lists.squid-cache.org
>> Cc: Eliezer Croitoru <ngtech1ltd at gmail.com>
>> Subject: Re: [squid-users] acl aclname server_cert_fingerprint
>>
>> On 1/27/21 11:45 AM, Eliezer Croitoru wrote:
>>
>>> I'm not sure I understood hat these errorcde and error detai.
>>
>> FWIW, access log fields are configured using logformat %codes. Search
>> squid.conf.documented for the words "err_code" and "err_detail" (no quotes).
>>
>>
>>> acl tls_to_splice any-of ... NoBump_certificate_fingerprint
>>
>>> acl tls_s1_connect at_step SslBump1
>>> acl tls_s2_client_hello at_step SslBump2
>>
>>> ssl_bump peek tls_s1_connect
>>> ssl_bump splice tls_to_splice
>>> ssl_bump stare tls_s2_client_hello
>>> ssl_bump bump tls_to_bump
>>
>> Bugs notwithstanding, the NoBump_certificate_fingerprint ACL will never
>> match in the above configuration AFAICT:
>>
>> * step1 is excluded by the earlier "peek if tls_s1_connect" rule. The
>> server certificate is not yet available during that step anyway.
>>
>> * step2 is reachable for a "splice" action, but the server certificate
>> is still not yet available during that step.
>>
>> * step3 is unreachable for a "splice" action because the only non-final
>> action during step2 is "stare". Starting precludes splicing.
>>
>>
>> HTH,
>>
>> Alex.
>>
>>
>>> -----Original Message-----
>>> From: Alex Rousskov <rousskov at measurement-factory.com>
>>> Sent: Wednesday, January 27, 2021 5:12 PM
>>> To: Eliezer Croitoru <ngtech1ltd at gmail.com>; squid-users at lists.squid-cache.org
>>> Subject: Re: [squid-users] acl aclname server_cert_fingerprint
>>>
>>> On 1/26/21 2:09 AM, Eliezer Croitoru wrote:
>>>
>>>> I'm trying to understand what I'm doing wrong in the config that stil
>>>> lets edition.cnn.com be decrypted instead of spliced?
>>>
>>> If you still need help, please share the relevant parts of your
>>> configuration and logs. I would start with ssl_bump rules and access log
>>> records containing additional %error_code/%err_detail fields.
>>>
>>> Alex.
>>>
>>>
>>>
>>>> -----Original Message-----
>>>> From: Alex Rousskov <rousskov at measurement-factory.com>
>>>> Sent: Tuesday, January 26, 2021 6:22 AM
>>>> To: Eliezer Croitoru <ngtech1ltd at gmail.com>; squid-users at lists.squid-cache.org
>>>> Subject: Re: [squid-users] acl aclname server_cert_fingerprint
>>>>
>>>> On 1/25/21 6:03 AM, Eliezer Croitoru wrote:
>>>>> I'm trying to use:
>>>>> acl aclname server_cert_fingerprint [-sha1] fingerprint
>>>>>
>>>>>
>>>>> I have cerated the next file:
>>>>> /etc/squid/no-ssl-bump-server-fingerprint.list
>>>>>
>>>>> And trying to use the next line:
>>>>> acl NoBump_certificate_fingerprint server_cert_fingerprint -sha1
>>>>> "/etc/squid/no-ssl-bump-server-fingerprint.list"
>>>>>
>>>>> To be explicit despite that only sha1 is a valid checksum.
>>>>> Squid doesn't accept the above line
>>>>
>>>>
>>>> Does not accept how? What is the error message?
>>>>
>>>>
>>>>> but this one yes:
>>>>> acl NoBump_certificate_fingerprint server_cert_fingerprint
>>>>> "/etc/squid/no-ssl-bump-server-fingerprint.list"
>>>>
>>>>> Is there a reason for that?
>>>>
>>>>
>>>> The use of ACL options and ACL parameter options is poorly documented.
>>>>
>>>> Squid Bug 4847 is marked as fixed, but the corresponding commit d4c6aca
>>>> says that server_cert_fingerprint is still broken. Not sure whether that
>>>> was true, whether some other commit has fixed that ACL, and whether the
>>>> problem mentioned in the commit message is related to your troubles.
>>>> https://bugs.squid-cache.org/show_bug.cgi?id=4847
>>>> https://github.com/squid-cache/squid/pull/191
>>>>
>>>> Also, according to my 2015 notes, server_cert_fingerprint happens to be
>>>> case sensitive. I consider that a bug. I am not sure, but I think Squid
>>>> expects uppercase hex letters (if any). I do not know whether that has
>>>> been fixed.
>>>>
>>>>
>>>> Finally, it is dangerous to list ACL parameter options like -sha1 in
>>>> front of parameter filename when that parameter file may contain its own
>>>> parameter options. A reader may think that -sha1 in squid.conf
>>>> overwrites, say, -sha256 in the parameter file, but that is not what
>>>> probably will happen when Squid starts supporting both options.
>>>>
>>>> That consideration may actually be the reason why Squid rejects your
>>>> first configuration sample (or perhaps it should be the reason even if
>>>> it does not).
>>>>
>>>> I am sure there are use cases where the admin wants to apply one
>>>> parameter option to the whole file, but the ambiguity is too dangerous
>>>> to allow IMO. We should make the choice explicit.
>>>>
>>>>
>>>> HTH,
>>>>
>>>> Alex.
>>>>
>>>>
>>>>
>>>>
>>>> _______________________________________________
>>>> squid-users mailing list
>>>> squid-users at lists.squid-cache.org
>>>> http://lists.squid-cache.org/listinfo/squid-users
>>>>



From ngtech1ltd at gmail.com  Wed Mar 30 19:25:06 2022
From: ngtech1ltd at gmail.com (Eliezer Croitoru)
Date: Wed, 30 Mar 2022 22:25:06 +0300
Subject: [squid-users] Are there centos 7 rpm's on ARM of squid 4 or 5?
In-Reply-To: <CALOwN8=RAb=H7Qk7qn8mT4CwL8PvZ5u7c8Y9eTMo3O5T7Hu6vA@mail.gmail.com>
References: <CALOwN8=n_Ai3q9Usmk9WFs_4cxvAfqQX4DrsxUKRa+=F2x=gtQ@mail.gmail.com>
 <000801d8442f$75891760$609b4620$@gmail.com>
 <CALOwN8=RAb=H7Qk7qn8mT4CwL8PvZ5u7c8Y9eTMo3O5T7Hu6vA@mail.gmail.com>
Message-ID: <001601d8446b$de1cd2d0$9a567870$@gmail.com>

Hey Carl,

 

The next SRPM:

https://www.ngtech.co.il/repo/centos/7/SRPMS/squid-4.17-8.el7.src.rpm

 

Should work on ARM based systems as well.

This however is not guaranteed since I do not have any option to verify this.

Once you will rebuild this let me know if it works for you.


Please pay attention that this version is patched with a series of 3 patches which allow intercepted CONNECT/SSL connections
to have different IP then the one which the squid DNS will respond with.

This patch is unique and can be disabled with a squid.conf directive.

 

This specific version is running in production for the last month or a bit more and seems to be doing the job for my use case.

 

All The Bests,

Eliezer

 

----

Eliezer Croitoru

NgTech, Tech Support

Mobile: +972-5-28704261

Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> 

 

From: Carl Meunier <carlimeunier at gmail.com> 
Sent: Wednesday, March 30, 2022 15:34
To: Eliezer Croitoru <ngtech1ltd at gmail.com>
Cc: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Are there centos 7 rpm's on ARM of squid 4 or 5?

 

Thank you for your reply.

 

Yes you can publish the SRPM. I can build it. I have an ARM based machine that is ready.

 

Please let me know when it will be published.

 

 

 

On Wed, 30 Mar 2022, 14:12 Eliezer Croitoru, <ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> > wrote:

Hey Carl,

 

I do not have an ARM based machine so I cannot build for it.

However it might be possible to build for ARM in the build services of Fedora:

https://copr.fedorainfracloud.org/

 

or OpenSUSE

https://build.opensuse.org/

 

The other option is to build the RPMs inside a container in your environment.

I will try to publish the latest SRPM for CentOS 7 which should work on ARM based systems.

 

Let me know if you can try to build for ARM locally using rpmbuild or a container.

 

Thanks,

Eliezer

 

----

Eliezer Croitoru

NgTech, Tech Support

Mobile: +972-5-28704261

Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> 

 

From: squid-users <squid-users-bounces at lists.squid-cache.org <mailto:squid-users-bounces at lists.squid-cache.org> > On Behalf Of Carl Meunier
Sent: Wednesday, March 30, 2022 12:10
To: squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> 
Subject: [squid-users] Are there centos 7 rpm's on ARM of squid 4 or 5?

 

Hello,

 

I want to install squid rpms on Centos 7 on ARM arch. 

Are there any packages for this?

 

Thanks

Carl  

 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220330/dfa02a69/attachment.htm>

From carlimeunier at gmail.com  Thu Mar 31 10:06:19 2022
From: carlimeunier at gmail.com (Carl Meunier)
Date: Thu, 31 Mar 2022 12:06:19 +0200
Subject: [squid-users] Are there centos 7 rpm's on ARM of squid 4 or 5?
In-Reply-To: <001601d8446b$de1cd2d0$9a567870$@gmail.com>
References: <CALOwN8=n_Ai3q9Usmk9WFs_4cxvAfqQX4DrsxUKRa+=F2x=gtQ@mail.gmail.com>
 <000801d8442f$75891760$609b4620$@gmail.com>
 <CALOwN8=RAb=H7Qk7qn8mT4CwL8PvZ5u7c8Y9eTMo3O5T7Hu6vA@mail.gmail.com>
 <001601d8446b$de1cd2d0$9a567870$@gmail.com>
Message-ID: <CALOwN8k_juQPgjquC7Lguk8Bd0pvmLYiQmg8TtzkmhE0v10HjA@mail.gmail.com>

Thank you Eliezer.

I will test it today and let you know.

Just one question: Is this patch included in the next version of squid?
That would be really interesting.

Thanks
Carl

On Wed, 30 Mar 2022, 21:25 Eliezer Croitoru, <ngtech1ltd at gmail.com> wrote:

> Hey Carl,
>
>
>
> The next SRPM:
>
> https://www.ngtech.co.il/repo/centos/7/SRPMS/squid-4.17-8.el7.src.rpm
>
>
>
> Should work on ARM based systems as well.
>
> This however is not guaranteed since I do not have any option to verify
> this.
>
> Once you will rebuild this let me know if it works for you.
>
>
> Please pay attention that this version is patched with a series of 3
> patches which allow intercepted CONNECT/SSL connections
> to have different IP then the one which the squid DNS will respond with.
>
> This patch is unique and can be disabled with a squid.conf directive.
>
>
>
> This specific version is running in production for the last month or a bit
> more and seems to be doing the job for my use case.
>
>
>
> All The Bests,
>
> Eliezer
>
>
>
> ----
>
> Eliezer Croitoru
>
> NgTech, Tech Support
>
> Mobile: +972-5-28704261
>
> Email: ngtech1ltd at gmail.com
>
>
>
> *From:* Carl Meunier <carlimeunier at gmail.com>
> *Sent:* Wednesday, March 30, 2022 15:34
> *To:* Eliezer Croitoru <ngtech1ltd at gmail.com>
> *Cc:* squid-users at lists.squid-cache.org
> *Subject:* Re: [squid-users] Are there centos 7 rpm's on ARM of squid 4
> or 5?
>
>
>
> Thank you for your reply.
>
>
>
> Yes you can publish the SRPM. I can build it. I have an ARM based machine
> that is ready.
>
>
>
> Please let me know when it will be published.
>
>
>
>
>
>
>
> On Wed, 30 Mar 2022, 14:12 Eliezer Croitoru, <ngtech1ltd at gmail.com> wrote:
>
> Hey Carl,
>
>
>
> I do not have an ARM based machine so I cannot build for it.
>
> However it might be possible to build for ARM in the build services of
> Fedora:
>
> https://copr.fedorainfracloud.org/
>
>
>
> or OpenSUSE
>
> https://build.opensuse.org/
>
>
>
> The other option is to build the RPMs inside a container in your
> environment.
>
> I will try to publish the latest SRPM for CentOS 7 which should work on
> ARM based systems.
>
>
>
> Let me know if you can try to build for ARM locally using rpmbuild or a
> container.
>
>
>
> Thanks,
>
> Eliezer
>
>
>
> ----
>
> Eliezer Croitoru
>
> NgTech, Tech Support
>
> Mobile: +972-5-28704261
>
> Email: ngtech1ltd at gmail.com
>
>
>
> *From:* squid-users <squid-users-bounces at lists.squid-cache.org> *On
> Behalf Of *Carl Meunier
> *Sent:* Wednesday, March 30, 2022 12:10
> *To:* squid-users at lists.squid-cache.org
> *Subject:* [squid-users] Are there centos 7 rpm's on ARM of squid 4 or 5?
>
>
>
> Hello,
>
>
>
> I want to install squid rpms on Centos 7 on ARM arch.
>
> Are there any packages for this?
>
>
>
> Thanks
>
> Carl
>
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220331/9765b40e/attachment.htm>

From ngtech1ltd at gmail.com  Thu Mar 31 14:06:21 2022
From: ngtech1ltd at gmail.com (Eliezer Croitoru)
Date: Thu, 31 Mar 2022 17:06:21 +0300
Subject: [squid-users] Are there centos 7 rpm's on ARM of squid 4 or 5?
In-Reply-To: <CALOwN8k_juQPgjquC7Lguk8Bd0pvmLYiQmg8TtzkmhE0v10HjA@mail.gmail.com>
References: <CALOwN8=n_Ai3q9Usmk9WFs_4cxvAfqQX4DrsxUKRa+=F2x=gtQ@mail.gmail.com>
 <000801d8442f$75891760$609b4620$@gmail.com>
 <CALOwN8=RAb=H7Qk7qn8mT4CwL8PvZ5u7c8Y9eTMo3O5T7Hu6vA@mail.gmail.com>
 <001601d8446b$de1cd2d0$9a567870$@gmail.com>
 <CALOwN8k_juQPgjquC7Lguk8Bd0pvmLYiQmg8TtzkmhE0v10HjA@mail.gmail.com>
Message-ID: <001a01d84508$8093bb90$81bb32b0$@gmail.com>

Hey Carl,

 

I didn?t even tried to push it into squid code since it?s a very simple patch.

The process of applying patches to the project compared to basic sense and testing is too much for me now.

I supplied the patch since squid is unusable without it in many environments.

 

All The Bests,

Eliezer

 

----

Eliezer Croitoru

NgTech, Tech Support

Mobile: +972-5-28704261

Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> 

 

From: Carl Meunier <carlimeunier at gmail.com> 
Sent: Thursday, March 31, 2022 13:06
To: Eliezer Croitoru <ngtech1ltd at gmail.com>
Cc: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Are there centos 7 rpm's on ARM of squid 4 or 5?

 

Thank you Eliezer.

 

I will test it today and let you know.

 

Just one question: Is this patch included in the next version of squid? That would be really interesting.

 

Thanks

Carl

 

On Wed, 30 Mar 2022, 21:25 Eliezer Croitoru, <ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> > wrote:

Hey Carl,

 

The next SRPM:

https://www.ngtech.co.il/repo/centos/7/SRPMS/squid-4.17-8.el7.src.rpm

 

Should work on ARM based systems as well.

This however is not guaranteed since I do not have any option to verify this.

Once you will rebuild this let me know if it works for you.


Please pay attention that this version is patched with a series of 3 patches which allow intercepted CONNECT/SSL connections
to have different IP then the one which the squid DNS will respond with.

This patch is unique and can be disabled with a squid.conf directive.

 

This specific version is running in production for the last month or a bit more and seems to be doing the job for my use case.

 

All The Bests,

Eliezer

 

----

Eliezer Croitoru

NgTech, Tech Support

Mobile: +972-5-28704261

Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> 

 

From: Carl Meunier <carlimeunier at gmail.com <mailto:carlimeunier at gmail.com> > 
Sent: Wednesday, March 30, 2022 15:34
To: Eliezer Croitoru <ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> >
Cc: squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> 
Subject: Re: [squid-users] Are there centos 7 rpm's on ARM of squid 4 or 5?

 

Thank you for your reply.

 

Yes you can publish the SRPM. I can build it. I have an ARM based machine that is ready.

 

Please let me know when it will be published.

 

 

 

On Wed, 30 Mar 2022, 14:12 Eliezer Croitoru, <ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> > wrote:

Hey Carl,

 

I do not have an ARM based machine so I cannot build for it.

However it might be possible to build for ARM in the build services of Fedora:

https://copr.fedorainfracloud.org/

 

or OpenSUSE

https://build.opensuse.org/

 

The other option is to build the RPMs inside a container in your environment.

I will try to publish the latest SRPM for CentOS 7 which should work on ARM based systems.

 

Let me know if you can try to build for ARM locally using rpmbuild or a container.

 

Thanks,

Eliezer

 

----

Eliezer Croitoru

NgTech, Tech Support

Mobile: +972-5-28704261

Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> 

 

From: squid-users <squid-users-bounces at lists.squid-cache.org <mailto:squid-users-bounces at lists.squid-cache.org> > On Behalf Of Carl Meunier
Sent: Wednesday, March 30, 2022 12:10
To: squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org> 
Subject: [squid-users] Are there centos 7 rpm's on ARM of squid 4 or 5?

 

Hello,

 

I want to install squid rpms on Centos 7 on ARM arch. 

Are there any packages for this?

 

Thanks

Carl  

 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220331/127c4690/attachment.htm>

From 0xff1f at gmail.com  Thu Mar 31 15:04:08 2022
From: 0xff1f at gmail.com (Ahmad Alzaeem)
Date: Thu, 31 Mar 2022 15:04:08 +0000
Subject: [squid-users] Squid 3-5 CPU optimization and best practise .
Message-ID: <DBBPR09MB452385D62C7E1DABEC86DD26F7E19@DBBPR09MB4523.eurprd09.prod.outlook.com>

Hello Team ,
I?m just making a research about the major changes in squid in terms of fast response and Low CPU compensation but I have not found more info on Wiki or what?s new .
https://wiki.squid-cache.org/Squid-5

The main usage is proxy with no ssl pump .
My main question is , is there any major changes in squid 5 that make it faster than squid 3 or squid 4 in terms of low CPU usage ?



Is there any best practice I can use to lower the cpu usage or response time ?
Like Deny caching on the HDD or server_persistent_connections off  similar directives





Thanks


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220331/a8cbc473/attachment.htm>

From rousskov at measurement-factory.com  Thu Mar 31 15:59:38 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Thu, 31 Mar 2022 11:59:38 -0400
Subject: [squid-users] Squid 3-5 CPU optimization and best practise .
In-Reply-To: <DBBPR09MB452385D62C7E1DABEC86DD26F7E19@DBBPR09MB4523.eurprd09.prod.outlook.com>
References: <DBBPR09MB452385D62C7E1DABEC86DD26F7E19@DBBPR09MB4523.eurprd09.prod.outlook.com>
Message-ID: <5bec2f16-d14f-6d81-6cba-53fada94e012@measurement-factory.com>

On 3/31/22 11:04, Ahmad Alzaeem wrote:

> My main question is , is there any major changes in squid 5 that make it 
> faster than squid 3 or squid 4 in terms of low CPU usage?

I do not recall any _major_ changes in that area, but the http_port 
worker-queues option may be of interest to those looking for performance 
optimizations.


> Is there any best practice I can use to lower the cpu usage or response 
> time ?

YMMV, but I would start by using (the right number of) SMP workers with 
cpu_affinity_map and worker-queues. More on that at
https://wiki.squid-cache.org/Features/SmpScale#How_to_configure_SMP_Squid_for_top_performance.3F

Beyond that, one would have to analyze your Squid performance to find 
out performance bottleneck(s) and then try to eliminate them or reduce 
their impact.


> Like Deny caching on the HDD or server_persistent_connections off 
>  ?similar directives

Disabling persistent connections will make things _worse_ in many cases 
but YMMV. Whether cache_dirs (and even shared memory cache) slow down or 
speed up an average response depends on your environment -- measure and 
adjust/remove accordingly.


HTH,

Alex.


From 0xff1f at gmail.com  Thu Mar 31 16:19:26 2022
From: 0xff1f at gmail.com (Ahmad Alzaeem)
Date: Thu, 31 Mar 2022 16:19:26 +0000
Subject: [squid-users] Squid 3-5 CPU optimization and best practise .
In-Reply-To: <5bec2f16-d14f-6d81-6cba-53fada94e012@measurement-factory.com>
References: <DBBPR09MB452385D62C7E1DABEC86DD26F7E19@DBBPR09MB4523.eurprd09.prod.outlook.com>
 <5bec2f16-d14f-6d81-6cba-53fada94e012@measurement-factory.com>
Message-ID: <DBBPR09MB45239A6457A6672047FC3EB4F7E19@DBBPR09MB4523.eurprd09.prod.outlook.com>

Hello Alex ,
Thanks for your reply ,

I thought as long as squid is only as forward proxy only and no https , we may disable some built in squid features that is not required in my purpose for getting lower CPU consumption such as use minimum squid functions .

We don?t have any bottleneck in squid .
The only issue is when there is a very high traffic that will use the CPU at higher scale .
So my only goal is decrease squid CPU consumption as much as I can .

So I build local dns server to fasten the lookup , but still don?t see any rich topics online for my goal .


Thanks



From: squid-users <squid-users-bounces at lists.squid-cache.org> on behalf of Alex Rousskov <rousskov at measurement-factory.com>
Date: Thursday, March 31, 2022 at 8:59 AM
To: squid-users at lists.squid-cache.org <squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] Squid 3-5 CPU optimization and best practise .
On 3/31/22 11:04, Ahmad Alzaeem wrote:

> My main question is , is there any major changes in squid 5 that make it
> faster than squid 3 or squid 4 in terms of low CPU usage?

I do not recall any _major_ changes in that area, but the http_port
worker-queues option may be of interest to those looking for performance
optimizations.


> Is there any best practice I can use to lower the cpu usage or response
> time ?

YMMV, but I would start by using (the right number of) SMP workers with
cpu_affinity_map and worker-queues. More on that at
https://wiki.squid-cache.org/Features/SmpScale#How_to_configure_SMP_Squid_for_top_performance.3F

Beyond that, one would have to analyze your Squid performance to find
out performance bottleneck(s) and then try to eliminate them or reduce
their impact.


> Like Deny caching on the HDD or server_persistent_connections off
>   similar directives

Disabling persistent connections will make things _worse_ in many cases
but YMMV. Whether cache_dirs (and even shared memory cache) slow down or
speed up an average response depends on your environment -- measure and
adjust/remove accordingly.


HTH,

Alex.
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220331/e851f9ca/attachment.htm>

From ngtech1ltd at gmail.com  Thu Mar 31 19:23:06 2022
From: ngtech1ltd at gmail.com (Eliezer Croitoru)
Date: Thu, 31 Mar 2022 22:23:06 +0300
Subject: [squid-users] Squid 3-5 CPU optimization and best practise .
In-Reply-To: <DBBPR09MB45239A6457A6672047FC3EB4F7E19@DBBPR09MB4523.eurprd09.prod.outlook.com>
References: <DBBPR09MB452385D62C7E1DABEC86DD26F7E19@DBBPR09MB4523.eurprd09.prod.outlook.com>
 <5bec2f16-d14f-6d81-6cba-53fada94e012@measurement-factory.com>
 <DBBPR09MB45239A6457A6672047FC3EB4F7E19@DBBPR09MB4523.eurprd09.prod.outlook.com>
Message-ID: <002e01d84534$c139db80$43ad9280$@gmail.com>

Hey Ahmad,

 

It's possible to use another proxy software.

If you do not need any specific functions that squid has you can easily run
a forward proxy that will probably
be simpler to operate, unless. you have something specific that only squid
gives.

 

All The Bests,

Eliezer

 

----

Eliezer Croitoru

NgTech, Tech Support

Mobile: +972-5-28704261

Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> 

 

From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of
Ahmad Alzaeem
Sent: Thursday, March 31, 2022 19:19
To: Alex Rousskov <rousskov at measurement-factory.com>;
squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Squid 3-5 CPU optimization and best practise .

 

Hello Alex , 

Thanks for your reply ,

 

I thought as long as squid is only as forward proxy only and no https , we
may disable some built in squid features that is not required in my purpose
for getting lower CPU consumption such as use minimum squid functions .

 

We don't have any bottleneck in squid .

The only issue is when there is a very high traffic that will use the CPU at
higher scale .

So my only goal is decrease squid CPU consumption as much as I can .

 

So I build local dns server to fasten the lookup , but still don't see any
rich topics online for my goal .

 

 

Thanks 

 

 

 

From: squid-users <squid-users-bounces at lists.squid-cache.org
<mailto:squid-users-bounces at lists.squid-cache.org> > on behalf of Alex
Rousskov <rousskov at measurement-factory.com
<mailto:rousskov at measurement-factory.com> >
Date: Thursday, March 31, 2022 at 8:59 AM
To: squid-users at lists.squid-cache.org
<mailto:squid-users at lists.squid-cache.org>
<squid-users at lists.squid-cache.org
<mailto:squid-users at lists.squid-cache.org> >
Subject: Re: [squid-users] Squid 3-5 CPU optimization and best practise .

On 3/31/22 11:04, Ahmad Alzaeem wrote:

> My main question is , is there any major changes in squid 5 that make it 
> faster than squid 3 or squid 4 in terms of low CPU usage?

I do not recall any _major_ changes in that area, but the http_port 
worker-queues option may be of interest to those looking for performance 
optimizations.


> Is there any best practice I can use to lower the cpu usage or response 
> time ?

YMMV, but I would start by using (the right number of) SMP workers with 
cpu_affinity_map and worker-queues. More on that at
https://wiki.squid-cache.org/Features/SmpScale#How_to_configure_SMP_Squid_fo
r_top_performance.3F

Beyond that, one would have to analyze your Squid performance to find 
out performance bottleneck(s) and then try to eliminate them or reduce 
their impact.


> Like Deny caching on the HDD or server_persistent_connections off 
>   similar directives

Disabling persistent connections will make things _worse_ in many cases 
but YMMV. Whether cache_dirs (and even shared memory cache) slow down or 
speed up an average response depends on your environment -- measure and 
adjust/remove accordingly.


HTH,

Alex.
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org <mailto:squid-users at lists.squid-cache.org>

http://lists.squid-cache.org/listinfo/squid-users

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20220331/2d0795fc/attachment.htm>

