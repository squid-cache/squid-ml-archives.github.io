<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Bug: 'squid -k interrupt' quits on config file error, fails to kill process
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Bug%3A%20%27squid%20-k%20interrupt%27%20quits%20on%20config%20file%0A%20error%2C%20fails%20to%20kill%20process&In-Reply-To=%3C20220313184942.67385e503e61bda2110440e0%40killthe.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024650.html">
   <LINK REL="Next"  HREF="024655.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Bug: 'squid -k interrupt' quits on config file error, fails to kill process</H1>
    <B>Dave Blanchard</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Bug%3A%20%27squid%20-k%20interrupt%27%20quits%20on%20config%20file%0A%20error%2C%20fails%20to%20kill%20process&In-Reply-To=%3C20220313184942.67385e503e61bda2110440e0%40killthe.net%3E"
       TITLE="[squid-users] Bug: 'squid -k interrupt' quits on config file error, fails to kill process">dave at killthe.net
       </A><BR>
    <I>Sun Mar 13 23:49:42 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="024650.html">[squid-users] Bug: 'squid -k interrupt' quits on config file error, fails to kill process
</A></li>
        <LI>Next message (by thread): <A HREF="024655.html">[squid-users] Bug: 'squid -k interrupt' quits on config file error, fails to kill process
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24651">[ date ]</a>
              <a href="thread.html#24651">[ thread ]</a>
              <a href="subject.html#24651">[ subject ]</a>
              <a href="author.html#24651">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sun, 13 Mar 2022 18:38:05 -0400
Alex Rousskov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt; wrote:

&gt;<i> &gt; &quot;kill -9&quot; will definitely leave some things in an odd state. Try the 
</I>&gt;<i> &gt; double-kill first.
</I>&gt;<i> 
</I>&gt;<i> Just to add: kill -9 will not kill SMP Squid workers and other kid 
</I>&gt;<i> processes. To a large degree, Squid will just keep running as if nothing 
</I>&gt;<i> happened -- that signal cannot be caught and processed specially by the 
</I>&gt;<i> receiving Squid process. Do not use &quot;kill -9 `cat pidfile`&quot; if you are 
</I>&gt;<i> using SMP Squids!
</I>
It turns out double kill with a SIGTERM, besides being rather inelegant, doesn't do the job either. It takes its sweet ass time--a few seconds--to exit. Who said I wanted the proxy, busy or not, to keep running and finish what it's doing? The entire point is for it to stop IMMEDIATELY! ESPECIALLY if it's currently busy!

One of the main purposes for Squid on my system is to proxy Chromium, which likewise has the brilliant design of continuing to load page elements (on my extremely low bandwidth connection with a quota) when I've clearly told it to STOP NOW. The point is to put a hard, immediate stop to it, via killing the proxy.

So is there a signal that can be sent which is the exact equivalent of squid -k interrupt? The only reason I was using that command in the first place is because 'kill' wasn't doing the job correctly.

Why, oh why, does the config file have to be 100% valid, when the request is to simply STOP the damn thing? That makes no logical sense. Deciding to crash on some obscure malformed config directive while simply giving the command to STOP is NOT the right way to handle the situation. Forget about &quot;not enough resources to add that feature.&quot; That is how it should have been designed from day one! So basically, &quot;not enough resources to fix what we designed wrong in the first place.&quot; To be fair, I guess you just initially assumed everyone would want the proxy to finish up what it's doing before quitting. But that's not true in every case.

What is actual use of the pidfile to the end user, when kill -9 does not actually kill the damn thing, but actually fucks things up worse by leaving zombie processes running in the background--and SIGTERM doesn't do the job either, even when asked twice? Why the hell aren't all signals being forwarded to the child process(es), or otherwise architected so death of the controlling process brings down the whole thing?

-- 
Dave Blanchard &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">dave at killthe.net</A>&gt;

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="024650.html">[squid-users] Bug: 'squid -k interrupt' quits on config file error, fails to kill process
</A></li>
	<LI>Next message (by thread): <A HREF="024655.html">[squid-users] Bug: 'squid -k interrupt' quits on config file error, fails to kill process
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24651">[ date ]</a>
              <a href="thread.html#24651">[ thread ]</a>
              <a href="subject.html#24651">[ subject ]</a>
              <a href="author.html#24651">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
