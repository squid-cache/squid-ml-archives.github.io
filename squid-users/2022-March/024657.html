<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Bug: 'squid -k interrupt' quits on config file error, fails to kill process
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Bug%3A%20%27squid%20-k%20interrupt%27%20quits%20on%20config%20file%0A%20error%2C%20fails%20to%20kill%20process&In-Reply-To=%3C123f936b-4d3f-e956-05d9-2ebc385b49c4%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024655.html">
   <LINK REL="Next"  HREF="024658.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Bug: 'squid -k interrupt' quits on config file error, fails to kill process</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Bug%3A%20%27squid%20-k%20interrupt%27%20quits%20on%20config%20file%0A%20error%2C%20fails%20to%20kill%20process&In-Reply-To=%3C123f936b-4d3f-e956-05d9-2ebc385b49c4%40measurement-factory.com%3E"
       TITLE="[squid-users] Bug: 'squid -k interrupt' quits on config file error, fails to kill process">rousskov at measurement-factory.com
       </A><BR>
    <I>Mon Mar 14 13:53:39 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="024655.html">[squid-users] Bug: 'squid -k interrupt' quits on config file error, fails to kill process
</A></li>
        <LI>Next message (by thread): <A HREF="024658.html">[squid-users] Openssl 3 compliance
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24657">[ date ]</a>
              <a href="thread.html#24657">[ thread ]</a>
              <a href="subject.html#24657">[ subject ]</a>
              <a href="author.html#24657">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 3/13/22 19:49, Dave Blanchard wrote:
&gt;<i> On Sun, 13 Mar 2022 18:38:05 -0400 Alex Rousskov wrote:
</I>&gt;&gt;<i> kill -9 will not kill SMP Squid workers and other kid
</I>&gt;&gt;<i> processes. To a large degree, Squid will just keep running as if nothing
</I>&gt;&gt;<i> happened -- that signal cannot be caught and processed specially by the
</I>&gt;&gt;<i> receiving Squid process. Do not use &quot;kill -9 `cat pidfile`&quot; if you are
</I>&gt;&gt;<i> using SMP Squids!
</I>

&gt;<i> It turns out double kill with a SIGTERM, besides being rather
</I>&gt;<i> inelegant, doesn't do the job either. It takes its sweet ass time--a
</I>&gt;<i> few seconds--to exit.
</I>
If you do not want Squid to wait for shutdown_lifetime to let some 
pending transactions finish, then use &quot;squid -k interrupt&quot; (or SIGINT if 
you want to work around unsupported invalid configuration files). That 
shutdown procedure does not have a delay.


&gt;<i> Who said I wanted the proxy, busy or not, to keep running and finish
</I>&gt;<i> what it's doing? The entire point is for it to stop IMMEDIATELY!
</I>&gt;<i> ESPECIALLY if it's currently busy!
</I>
Squid supports a variety of shutdown procedures that accommodate many 
realistic use cases. The better you specify what _you_ want, the better 
we can help you achieve those results. Your original email did not say 
that you wanted Squid to stop IMMEDIATELY, and your followup email was 
concerned with &quot;any harm&quot;, so Amos suggested a graceful shutdown mode, 
probably (very reasonably IMO!) assuming that you want to minimize harm.


&gt;<i> So is there a signal that can be sent which is the exact equivalent
</I>&gt;<i> of squid -k interrupt?
</I>
Yes, &quot;squid -k interrupt&quot; uses SIGINT.


&gt;<i> Why, oh why, does the config file have to be 100% valid
</I>
I believe I have already answered that loaded question. If something is 
not clear in my answer, please feel free to ask followup questions, but 
we should not go in circles.


&gt;<i> What is actual use of the pidfile to the end user
</I>
I think there are two ways to answer this question:

* None: The PID file is not meant to be used by the end user. You may 
use it at your own risk (e.g., if you want to work around unsupported 
invalid configuration files), but such use is just an unsupported hack.

* The actual use of the PID file is to send a (supported) signal to the 
running Squid instance without executing the Squid binary, with all the 
conveniences and problems such executions may bring.

I am not sure what the official Squid Project position is regarding end 
user use of the PID file. Such an official position may not exist (yet), 
but I suspect it is currently closer to the first bullet because we do 
not disclose/document which signals are used by various &quot;squid -k&quot; commands.


HTH,

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="024655.html">[squid-users] Bug: 'squid -k interrupt' quits on config file error, fails to kill process
</A></li>
	<LI>Next message (by thread): <A HREF="024658.html">[squid-users] Openssl 3 compliance
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24657">[ date ]</a>
              <a href="thread.html#24657">[ thread ]</a>
              <a href="subject.html#24657">[ subject ]</a>
              <a href="author.html#24657">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
