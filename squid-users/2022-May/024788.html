<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] disable https inspection for licensing some apps
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20disable%20https%20inspection%20for%20licensing%20some%20apps&In-Reply-To=%3C0a024267-6d35-4bc5-ea98-4af9f5866022%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024787.html">
   <LINK REL="Next"  HREF="024789.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] disable https inspection for licensing some apps</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20disable%20https%20inspection%20for%20licensing%20some%20apps&In-Reply-To=%3C0a024267-6d35-4bc5-ea98-4af9f5866022%40measurement-factory.com%3E"
       TITLE="[squid-users] disable https inspection for licensing some apps">rousskov at measurement-factory.com
       </A><BR>
    <I>Wed May 18 18:38:47 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="024787.html">[squid-users] disable https inspection for licensing some apps
</A></li>
        <LI>Next message (by thread): <A HREF="024789.html">[squid-users] disable https inspection for licensing some apps
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24788">[ date ]</a>
              <a href="thread.html#24788">[ thread ]</a>
              <a href="subject.html#24788">[ subject ]</a>
              <a href="author.html#24788">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 5/18/22 12:28, robert k Wild wrote:

&gt;<i> acl DiscoverSNIHost at_step SslBump1
</I>&gt;<i> acl NoSSLIntercept ssl::server_name &quot;/usr/local/squid/etc/nointercept.txt&quot;
</I>&gt;<i> ssl_bump peek DiscoverSNIHost
</I>&gt;<i> ssl_bump splice NoSSLIntercept
</I>&gt;<i> ssl_bump bump all
</I>
OK, the above configuration makes the splice/bump decision based on 
plain text information provided by the TLS client.


&gt;<i> and in the nointercept.txt
</I>&gt;<i> i have the url in there
</I>
ssl::server_name needs a host/domain name, not a regular URL. No URLs 
are exchanged in plain text between TLS client and the origin server.

Please note that, even after adjusting nointercept.txt to contain domain 
name(s), the above configuration may not always work in modern Squids: 
It will work when the client sends a matching domain name

* in the CONNECT request headers (and sends no TLS SNI at all)
* in the CONNECT request headers and in TLS SNI
* in TLS SNI (the CONNECT request headers should not matter).

It will also work when a CONNECT request is using an IP address that 
reverse-resolves to a matching domain name (which is not overwritten by 
a mismatching SNI).

In all other cases, Squid will bump traffic even if it is ultimately 
going to the server named in nointercept.txt.

There is no configuration that will address all possible cases in 
general. TLS makes that impossible (at least not without probing TLS 
origin servers which is something Squid does not do yet).


HTH,

Alex.


&gt;<i>, also i have it in the url white list so it can actually see the url
</I>&gt;<i> 
</I>&gt;<i> is there something else i need to add for this to work
</I>&gt;<i> 
</I>&gt;<i> or maybe some websites ie license website just dont like it going through a proxy
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On Wed, 18 May 2022 at 16:57, robert k Wild &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">robertkwild at gmail.com</A> 
</I>&gt;<i> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">robertkwild at gmail.com</A>&gt;&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i>     hi all,
</I>&gt;<i> 
</I>&gt;<i>     i have squid proxy configured as ssl bump and i white list some
</I>&gt;<i>     websites only
</I>&gt;<i> 
</I>&gt;<i>     but for some websites i dont want to inspect https traffic as it
</I>&gt;<i>     breaks the cert when i want to license some apps via the url
</I>&gt;<i>     (whitelist url)
</I>&gt;<i> 
</I>&gt;<i>     how can i disable https inspection for some websites please
</I>&gt;<i> 
</I>&gt;<i>     many thanks,
</I>&gt;<i>     rob
</I>&gt;<i> 
</I>&gt;<i>     -- 
</I>&gt;<i>     Regards,
</I>&gt;<i> 
</I>&gt;<i>     Robert K Wild.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> -- 
</I>&gt;<i> Regards,
</I>&gt;<i> 
</I>&gt;<i> Robert K Wild.
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="024787.html">[squid-users] disable https inspection for licensing some apps
</A></li>
	<LI>Next message (by thread): <A HREF="024789.html">[squid-users] disable https inspection for licensing some apps
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24788">[ date ]</a>
              <a href="thread.html#24788">[ thread ]</a>
              <a href="subject.html#24788">[ subject ]</a>
              <a href="author.html#24788">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
