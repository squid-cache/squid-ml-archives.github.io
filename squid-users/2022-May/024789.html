<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] disable https inspection for licensing some apps
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20disable%20https%20inspection%20for%20licensing%20some%20apps&In-Reply-To=%3C006201d86aec%2439a1f0d0%24ace5d270%24%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024788.html">
   <LINK REL="Next"  HREF="024792.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] disable https inspection for licensing some apps</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20disable%20https%20inspection%20for%20licensing%20some%20apps&In-Reply-To=%3C006201d86aec%2439a1f0d0%24ace5d270%24%40gmail.com%3E"
       TITLE="[squid-users] disable https inspection for licensing some apps">ngtech1ltd at gmail.com
       </A><BR>
    <I>Wed May 18 19:19:40 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="024788.html">[squid-users] disable https inspection for licensing some apps
</A></li>
        <LI>Next message (by thread): <A HREF="024792.html">[squid-users] disable https inspection for licensing some apps
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24789">[ date ]</a>
              <a href="thread.html#24789">[ thread ]</a>
              <a href="subject.html#24789">[ subject ]</a>
              <a href="author.html#24789">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE> Hey Alex,

I have started working on some external_acl helper that will probe the
server certificate like what ufdbguard does but will be written 
probably in another language then C++ ... ie scripting or GoLang or Rust.
The idea is that there will be some cache or DB that will store information
about an IP+port paired with SNI.
A storage engine like a cache would help to &quot;know&quot; enough about the server
to ultimately decide if there is a risk in splicing this specific
connection.
It's also possible that the first time that the request will pass via thru
the proxy it will be bumped to probe the connection for more information
when possible.

In general for commercial products there is either a CDN service or a
dedicated service.
These usually are not the risk for the proxy users and can be spliced.
The main issue is if one service on a specific IP serves  more then one
domain that contains different content.
The best example is google CDN network that might serve on the same IP and
certificate and SNI(because of HTTP/2.0) different domains.

Eliezer

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A>

-----Original Message-----
From: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; On Behalf Of
Alex Rousskov
Sent: Wednesday, May 18, 2022 21:39
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] disable https inspection for licensing some apps

On 5/18/22 12:28, robert k Wild wrote:

&gt;<i> acl DiscoverSNIHost at_step SslBump1
</I>&gt;<i> acl NoSSLIntercept ssl::server_name &quot;/usr/local/squid/etc/nointercept.txt&quot;
</I>&gt;<i> ssl_bump peek DiscoverSNIHost
</I>&gt;<i> ssl_bump splice NoSSLIntercept
</I>&gt;<i> ssl_bump bump all
</I>
OK, the above configuration makes the splice/bump decision based on 
plain text information provided by the TLS client.


&gt;<i> and in the nointercept.txt
</I>&gt;<i> i have the url in there
</I>
ssl::server_name needs a host/domain name, not a regular URL. No URLs 
are exchanged in plain text between TLS client and the origin server.

Please note that, even after adjusting nointercept.txt to contain domain 
name(s), the above configuration may not always work in modern Squids: 
It will work when the client sends a matching domain name

* in the CONNECT request headers (and sends no TLS SNI at all)
* in the CONNECT request headers and in TLS SNI
* in TLS SNI (the CONNECT request headers should not matter).

It will also work when a CONNECT request is using an IP address that 
reverse-resolves to a matching domain name (which is not overwritten by 
a mismatching SNI).

In all other cases, Squid will bump traffic even if it is ultimately 
going to the server named in nointercept.txt.

There is no configuration that will address all possible cases in 
general. TLS makes that impossible (at least not without probing TLS 
origin servers which is something Squid does not do yet).


HTH,

Alex.


&gt;<i>, also i have it in the url white list so it can actually see the url
</I>&gt;<i> 
</I>&gt;<i> is there something else i need to add for this to work
</I>&gt;<i> 
</I>&gt;<i> or maybe some websites ie license website just dont like it going through
</I>a proxy
&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On Wed, 18 May 2022 at 16:57, robert k Wild &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">robertkwild at gmail.com</A> 
</I>&gt;<i> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">robertkwild at gmail.com</A>&gt;&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i>     hi all,
</I>&gt;<i> 
</I>&gt;<i>     i have squid proxy configured as ssl bump and i white list some
</I>&gt;<i>     websites only
</I>&gt;<i> 
</I>&gt;<i>     but for some websites i dont want to inspect https traffic as it
</I>&gt;<i>     breaks the cert when i want to license some apps via the url
</I>&gt;<i>     (whitelist url)
</I>&gt;<i> 
</I>&gt;<i>     how can i disable https inspection for some websites please
</I>&gt;<i> 
</I>&gt;<i>     many thanks,
</I>&gt;<i>     rob
</I>&gt;<i> 
</I>&gt;<i>     -- 
</I>&gt;<i>     Regards,
</I>&gt;<i> 
</I>&gt;<i>     Robert K Wild.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> -- 
</I>&gt;<i> Regards,
</I>&gt;<i> 
</I>&gt;<i> Robert K Wild.
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="024788.html">[squid-users] disable https inspection for licensing some apps
</A></li>
	<LI>Next message (by thread): <A HREF="024792.html">[squid-users] disable https inspection for licensing some apps
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24789">[ date ]</a>
              <a href="thread.html#24789">[ thread ]</a>
              <a href="subject.html#24789">[ subject ]</a>
              <a href="author.html#24789">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
