<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] disable https inspection for licensing some apps
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20disable%20https%20inspection%20for%20licensing%20some%20apps&In-Reply-To=%3CCAGU_CiJiYQR_6A0Ogq5hztzNVD-JYX3EvSV_d4EE_r3Kk1hpGg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024789.html">
   <LINK REL="Next"  HREF="024790.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] disable https inspection for licensing some apps</H1>
    <B>robert k Wild</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20disable%20https%20inspection%20for%20licensing%20some%20apps&In-Reply-To=%3CCAGU_CiJiYQR_6A0Ogq5hztzNVD-JYX3EvSV_d4EE_r3Kk1hpGg%40mail.gmail.com%3E"
       TITLE="[squid-users] disable https inspection for licensing some apps">robertkwild at gmail.com
       </A><BR>
    <I>Thu May 19 12:47:11 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="024789.html">[squid-users] disable https inspection for licensing some apps
</A></li>
        <LI>Next message (by thread): <A HREF="024790.html">[squid-users] linuxize.com and other sites captcha
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24792">[ date ]</a>
              <a href="thread.html#24792">[ thread ]</a>
              <a href="subject.html#24792">[ subject ]</a>
              <a href="author.html#24792">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I worked it out, my &quot;no Https interception&quot; was working on websites if I
put the URL in that txt file

nointercept.txt

But I needed to make a proxy.ini file as well on the host in question, for
it to point to the proxy

Once it pointed to the proxy I could then monitor the traffic and see what
URL I needed to whitelist and to put in the no SSL interception

Once I did that all good

Thanks guys, much appreciated
On Wed, 18 May 2022, 20:21 Eliezer Croitoru, &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A>&gt; wrote:

&gt;<i>  Hey Alex,
</I>&gt;<i>
</I>&gt;<i> I have started working on some external_acl helper that will probe the
</I>&gt;<i> server certificate like what ufdbguard does but will be written
</I>&gt;<i> probably in another language then C++ ... ie scripting or GoLang or Rust.
</I>&gt;<i> The idea is that there will be some cache or DB that will store information
</I>&gt;<i> about an IP+port paired with SNI.
</I>&gt;<i> A storage engine like a cache would help to &quot;know&quot; enough about the server
</I>&gt;<i> to ultimately decide if there is a risk in splicing this specific
</I>&gt;<i> connection.
</I>&gt;<i> It's also possible that the first time that the request will pass via thru
</I>&gt;<i> the proxy it will be bumped to probe the connection for more information
</I>&gt;<i> when possible.
</I>&gt;<i>
</I>&gt;<i> In general for commercial products there is either a CDN service or a
</I>&gt;<i> dedicated service.
</I>&gt;<i> These usually are not the risk for the proxy users and can be spliced.
</I>&gt;<i> The main issue is if one service on a specific IP serves  more then one
</I>&gt;<i> domain that contains different content.
</I>&gt;<i> The best example is google CDN network that might serve on the same IP and
</I>&gt;<i> certificate and SNI(because of HTTP/2.0) different domains.
</I>&gt;<i>
</I>&gt;<i> Eliezer
</I>&gt;<i>
</I>&gt;<i> ----
</I>&gt;<i> Eliezer Croitoru
</I>&gt;<i> NgTech, Tech Support
</I>&gt;<i> Mobile: +972-5-28704261
</I>&gt;<i> Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A>
</I>&gt;<i>
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; On Behalf Of
</I>&gt;<i> Alex Rousskov
</I>&gt;<i> Sent: Wednesday, May 18, 2022 21:39
</I>&gt;<i> To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> Subject: Re: [squid-users] disable https inspection for licensing some apps
</I>&gt;<i>
</I>&gt;<i> On 5/18/22 12:28, robert k Wild wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; acl DiscoverSNIHost at_step SslBump1
</I>&gt;<i> &gt; acl NoSSLIntercept ssl::server_name
</I>&gt;<i> &quot;/usr/local/squid/etc/nointercept.txt&quot;
</I>&gt;<i> &gt; ssl_bump peek DiscoverSNIHost
</I>&gt;<i> &gt; ssl_bump splice NoSSLIntercept
</I>&gt;<i> &gt; ssl_bump bump all
</I>&gt;<i>
</I>&gt;<i> OK, the above configuration makes the splice/bump decision based on
</I>&gt;<i> plain text information provided by the TLS client.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; and in the nointercept.txt
</I>&gt;<i> &gt; i have the url in there
</I>&gt;<i>
</I>&gt;<i> ssl::server_name needs a host/domain name, not a regular URL. No URLs
</I>&gt;<i> are exchanged in plain text between TLS client and the origin server.
</I>&gt;<i>
</I>&gt;<i> Please note that, even after adjusting nointercept.txt to contain domain
</I>&gt;<i> name(s), the above configuration may not always work in modern Squids:
</I>&gt;<i> It will work when the client sends a matching domain name
</I>&gt;<i>
</I>&gt;<i> * in the CONNECT request headers (and sends no TLS SNI at all)
</I>&gt;<i> * in the CONNECT request headers and in TLS SNI
</I>&gt;<i> * in TLS SNI (the CONNECT request headers should not matter).
</I>&gt;<i>
</I>&gt;<i> It will also work when a CONNECT request is using an IP address that
</I>&gt;<i> reverse-resolves to a matching domain name (which is not overwritten by
</I>&gt;<i> a mismatching SNI).
</I>&gt;<i>
</I>&gt;<i> In all other cases, Squid will bump traffic even if it is ultimately
</I>&gt;<i> going to the server named in nointercept.txt.
</I>&gt;<i>
</I>&gt;<i> There is no configuration that will address all possible cases in
</I>&gt;<i> general. TLS makes that impossible (at least not without probing TLS
</I>&gt;<i> origin servers which is something Squid does not do yet).
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> HTH,
</I>&gt;<i>
</I>&gt;<i> Alex.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt;, also i have it in the url white list so it can actually see the url
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; is there something else i need to add for this to work
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; or maybe some websites ie license website just dont like it going through
</I>&gt;<i> a proxy
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On Wed, 18 May 2022 at 16:57, robert k Wild &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">robertkwild at gmail.com</A>
</I>&gt;<i> &gt; &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">robertkwild at gmail.com</A>&gt;&gt; wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     hi all,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     i have squid proxy configured as ssl bump and i white list some
</I>&gt;<i> &gt;     websites only
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     but for some websites i dont want to inspect https traffic as it
</I>&gt;<i> &gt;     breaks the cert when i want to license some apps via the url
</I>&gt;<i> &gt;     (whitelist url)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     how can i disable https inspection for some websites please
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     many thanks,
</I>&gt;<i> &gt;     rob
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     --
</I>&gt;<i> &gt;     Regards,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     Robert K Wild.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; --
</I>&gt;<i> &gt; Regards,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Robert K Wild.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; squid-users mailing list
</I>&gt;<i> &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> &gt; <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20220519/725618f8/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20220519/725618f8/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="024789.html">[squid-users] disable https inspection for licensing some apps
</A></li>
	<LI>Next message (by thread): <A HREF="024790.html">[squid-users] linuxize.com and other sites captcha
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24792">[ date ]</a>
              <a href="thread.html#24792">[ thread ]</a>
              <a href="subject.html#24792">[ subject ]</a>
              <a href="author.html#24792">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
