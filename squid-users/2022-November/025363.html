<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Does Squid support client ssl termination?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Does%20Squid%20support%20client%20ssl%20termination%3F&In-Reply-To=%3CCAB-cPArjyq_LpNs%2Bak8vMk4HJh5X5ce5%3DMPNwHBWULz7SC1juw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   
   <LINK REL="Next"  HREF="025364.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Does Squid support client ssl termination?</H1>
    <B>mingheng wang</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Does%20Squid%20support%20client%20ssl%20termination%3F&In-Reply-To=%3CCAB-cPArjyq_LpNs%2Bak8vMk4HJh5X5ce5%3DMPNwHBWULz7SC1juw%40mail.gmail.com%3E"
       TITLE="[squid-users] Does Squid support client ssl termination?">ifoolb at gmail.com
       </A><BR>
    <I>Tue Nov  1 01:32:27 UTC 2022</I>
    <P><UL>
        
        <LI>Next message (by thread): <A HREF="025364.html">[squid-users] Does Squid support client ssl termination?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25363">[ date ]</a>
              <a href="thread.html#25363">[ thread ]</a>
              <a href="subject.html#25363">[ subject ]</a>
              <a href="author.html#25363">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, Oct 31, 2022, 11:46 PM Grant Taylor &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">gtaylor at tnetconsulting.net</A>&gt;
wrote:

&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> Pre-script:  Did you mean to reply directly to me?  Or did you intend
</I>&gt;<i> for your reply to go to the squid-users mailing list?
</I>&gt;<i>
</I>&gt;<i> Sorry about that, don't know why it only went to you.
</I>
&gt;<i> On 10/27/22 6:47 PM, mingheng wang wrote:
</I>&gt;<i> &gt; In my experience, many clients, such as Firefox and Chrome, favor
</I>&gt;<i> &gt; HTTPS over HTTP, and some clients even enforce HTTPS. They down right
</I>&gt;<i> &gt; send HTTPS CONNECT to 443.
</I>&gt;<i>
</I>&gt;<i> I think that is a relatively recent change in preference.
</I>&gt;<i>
</I>&gt;<i> &gt; Does this mean Squid does support this:
</I>&gt;<i> &gt;   Client --[HTTPS on self-signed certs]--&gt;Squid--[HTTP]--&gt; site (suppose
</I>&gt;<i> &gt; it doesn't redirect)
</I>&gt;<i>
</I>&gt;<i> Yes, that is entirely likely to happen.
</I>&gt;<i>
</I>&gt;<i> N.B. I'm going to trust that the self-signed vs CA-signed certs are a
</I>&gt;<i> non-issue and that clients have been configured to trust whatever cert
</I>&gt;<i> is being used, no matter who signed it.
</I>&gt;<i>
</I>&gt;<i> I delved into the configuration the last few days, and found that Squid
</I>doesn't officially support
cache_peer when ssl_bump is in use. Actually, I can't find a single tool in
the market that
can just encrypt any HTTP connection, &quot;converting&quot; it to an HTTPS
connection. I'm reading
RFCs and documentation to write my own proxy.


&gt;<i> &gt; My Apache server only listens on 80, but when using Cloudflare in
</I>&gt;<i> &gt; front of it, Cloudflare can add HTTPS support, signed by them, and
</I>&gt;<i> &gt; web browsers say the connection is secured. So I thought Squid could
</I>&gt;<i> &gt; do the same, only with self-signed certs.
</I>&gt;<i>
</I>&gt;<i> Cloudflare is functioning as a /reverse/-proxy in that case.  Forward vs
</I>&gt;<i> reverse proxy is technically different and has different semantics.
</I>&gt;<i>
</I>&gt;<i> I believe that Squid can function as a reverse proxy.
</I>&gt;<i>
</I>&gt;<i> This is what still confuses me. A reverse proxy is supposed to proxy a web
</I>site. At least that's what I learnt from Nginx and Haproxy's documentation.
I'll read more on this when I have time.


&gt;<i> &gt; Because I also want to avoid TLS over TLS, if I chain another HTTPS
</I>&gt;<i> &gt; proxy between the local Squid and the remote Squid. Our company's
</I>&gt;<i> &gt; gateway monitors traffic and forbids tunnels to prevent accessing
</I>&gt;<i> &gt; systems from outside but this is also hurting my internet access. When
</I>&gt;<i> &gt; using HTTPS over a SSL tunnel within our company, it may trigger the
</I>&gt;<i> &gt; IT security policy.
</I>&gt;<i>
</I>&gt;<i> Okay.  This local restriction may complicate things.
</I>&gt;<i>
</I>&gt;<i> Very tough network environment. They can even somehow detect a confidential
</I>file going through the gateway, even with TLS.

&gt;<i> That would mean that unencrypted sites would never be encrypted between
</I>&gt;<i> the two proxies.  If that's okay with you, then fine by me.
</I>&gt;<i>
</I>&gt;<i> &gt; The downstream child Squid is running on the same localhost as with
</I>&gt;<i> &gt; other programs that are going to use it.
</I>&gt;<i>
</I>&gt;<i> Okay.  Thank you for clarifying.
</I>&gt;<i>
</I>&gt;<i> Aside:  I see little benefit, and non-trivial complication, to do HTTPS
</I>&gt;<i> web browser to Squid connections to have Squid do unencrypted traffic out.
</I>&gt;<i>
</I>&gt;<i> &gt; I mean certs signed by well known public CA, like DigiCert, Cloudflare
</I>&gt;<i> &gt; etc.
</I>&gt;<i>
</I>&gt;<i> Okay.  Thank you for clarifying.
</I>&gt;<i>
</I>&gt;<i> &gt; Our company blocks HTTPS connections with self-signed certs. It says
</I>&gt;<i> &gt; they're malicious.  Besides, I want to reuse the public CA signed
</I>&gt;<i> &gt; certs that my website uses. Sorry for not being clearer before,
</I>&gt;<i> &gt; perhaps my use case is too specific.
</I>&gt;<i>
</I>&gt;<i> Re-using CA-signed certificates from a web server on a Squid proxy
</I>&gt;<i> server may not work as well as you hope.  There's a good chance that you
</I>&gt;<i> will run into issues related to CN / SAN mis-match.
</I>&gt;<i>
</I>&gt;<i> If you don't have any CN / SAN mis-match issues, as in the original cert
</I>&gt;<i> includes the proxy's name as a SAN, you'll probably be okay.
</I>&gt;<i>
</I>&gt;<i> I can just negotiate HTTPS using a separate piece of software and send
</I>HTTP data
through the tunnel. I believe the important part is the TLS negotiation.
Eliminating TLS over TLS should be enough to evade our IT's DPI. They even
banned
git from accessing the net outside the company because they can't be sure
what we
are doing with git as it's simultaneously downloading and uploading.

&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Grant. . . .
</I>&gt;<i> unix || die
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20221101/c554486a/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20221101/c554486a/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message (by thread): <A HREF="025364.html">[squid-users] Does Squid support client ssl termination?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25363">[ date ]</a>
              <a href="thread.html#25363">[ thread ]</a>
              <a href="subject.html#25363">[ subject ]</a>
              <a href="author.html#25363">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
