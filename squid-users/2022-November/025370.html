<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] FW: Encrypted browser-Squid connection errors
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20FW%3A%20Encrypted%20browser-Squid%20connection%20errors&In-Reply-To=%3Ca61972fddb4c5661ce60f4ddf47e7068%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025367.html">
   <LINK REL="Next"  HREF="025371.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] FW: Encrypted browser-Squid connection errors</H1>
    <B>squid3 at treenet.co.nz</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20FW%3A%20Encrypted%20browser-Squid%20connection%20errors&In-Reply-To=%3Ca61972fddb4c5661ce60f4ddf47e7068%40treenet.co.nz%3E"
       TITLE="[squid-users] FW: Encrypted browser-Squid connection errors">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Nov  1 19:24:03 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025367.html">[squid-users] Problem with wss protocol.
</A></li>
        <LI>Next message (by thread): <A HREF="025371.html">[squid-users] FW: Encrypted browser-Squid connection errors
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25370">[ date ]</a>
              <a href="thread.html#25370">[ thread ]</a>
              <a href="subject.html#25370">[ subject ]</a>
              <a href="author.html#25370">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2022-11-01 11:38, Grant Taylor wrote:
&gt;<i> On 10/30/22 6:59 AM, <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A> wrote:
</I>&gt;&gt;<i> Duane W. would be the best one to ask about the details.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> What I know is that some 10-12 years ago I discovered an message by 
</I>&gt;&gt;<i> Duane mentioning that W3C had (given or accepted) port 3128 for Squid 
</I>&gt;&gt;<i> use. I've checked the squid-cache archives and not seeing the message.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Right now it looks like the W3C changed their systems and only track 
</I>&gt;&gt;<i> the standards documents. So I cannot reference their (outdated?) 
</I>&gt;&gt;<i> protocol registry :-{ . Also checked the squid-cache archives and not 
</I>&gt;&gt;<i> finding it email history. Sorry.
</I>&gt;<i> 
</I>&gt;<i> Did you by chance mean IANA?
</I>
No I meant W3C. Back in the before times things were a bit messy.

&gt;<i> 
</I>&gt;<i> I looked and 3128 is registered to something other than Squid.
</I>&gt;<i> 
</I>
Indeed, thus we cannot register it with IEFT/IANA now. The IANA http-alt 
port would probably be best if we did go official.


&gt;<i> Nor did their search bring anything up for Squid.
</I>&gt;<i> 
</I>&gt;&gt;<i> I mean &quot;authority&quot; as used by HTTP specification, which refers to 
</I>&gt;&gt;<i> <A HREF="https://www.rfc-editor.org/rfc/rfc3986#section-3.2">https://www.rfc-editor.org/rfc/rfc3986#section-3.2</A>
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Yes exactly. That is the source of the problem, perpetuated by the 
</I>&gt;&gt;<i> need to retain on-wire byte/octet backward compatibility until HTTP/2 
</I>&gt;&gt;<i> changed to binary format.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Consider what the proxy has to do when (not if) the IP:port being 
</I>&gt;&gt;<i> connected to are that proxy's (eg localhost:80) and the URL is only a 
</I>&gt;&gt;<i> path (&quot;/&quot;) on an origin server somewhere else. Does the &quot;GET / 
</I>&gt;&gt;<i> HTTP/1.0&quot; mean &quot;<A HREF="http://example.com/">http://example.com/</A>&quot; or &quot;<A HREF="http://example.net/">http://example.net/</A>&quot; ?
</I>&gt;<i> 
</I>&gt;<i> I would hope that it would return an error page, much like Squid does 
</I>&gt;<i> when it can't resolve a domain name or the connection times out.
</I>
You see my point I hope. A gateway proxy that returns an error to 
*every* request is not very good.


&gt;<i> 
</I>&gt;&gt;<i> The key point is that the proxy host:port and the origin host:port are 
</I>&gt;&gt;<i> two different authority and only the origin may be passed along in the 
</I>&gt;&gt;<i> URL (or URL+Host header).
</I>&gt;<i> 
</I>&gt;<i> Agreed.
</I>&gt;<i> 
</I>&gt;&gt;<i> When the client uses port 80 and 443 thinking they are origin services 
</I>&gt;&gt;<i> it is *required* (per 
</I>&gt;&gt;<i> <A HREF="https://www.rfc-editor.org/rfc/rfc9112.html#name-origin-form">https://www.rfc-editor.org/rfc/rfc9112.html#name-origin-form</A>) to omit 
</I>&gt;&gt;<i> the real origins info. Enter problems.
</I>&gt;<i> 
</I>&gt;<i> Why would a client (worth it's disk space) ever conflate the value of 
</I>&gt;<i> it's configured proxy as the origin server?
</I>&gt;<i> 
</I>
There is no &quot;configured proxy&quot; for this use-case.


&gt;<i> I can see a potential for confusion when using (network) transparent / 
</I>&gt;<i> intercepting proxies.
</I>&gt;<i> 
</I>
Those are the two most/extremely common instances of the problematic 
use-cases. All implicit use of proxy (or gateway) have the same issue.


&gt;<i> 
</I>&gt;&gt;<i> The defaults though are tuned for origin server (or reverse-proxy) 
</I>&gt;&gt;<i> direct contact.
</I>&gt;<i> 
</I>&gt;<i> I don't see how that precludes their use for (forward) proxy servers.
</I>&gt;<i> 
</I>
I think you are getting stuck with the subtle difference between &quot;use 
for case X&quot; and &quot;use by default&quot;.

ANY port number can be used for *some* use-case(s). &quot;by default&quot; has to 
work for *all* use-cases.


&gt;&gt;<i> No Browser I know supports 
</I>&gt;&gt;<i> &quot;http-<A HREF="alt://proxy.example.com?http://origin.example.net/index.html">alt://proxy.example.com?http://origin.example.net/index.html</A>&quot; 
</I>&gt;&gt;<i> URLs.
</I>&gt;<i> 
</I>&gt;<i> But I bet that many browsers would support:
</I>&gt;<i> 
</I>&gt;<i>    <A HREF="http://proxy.example.com:8080/?http://origin.example.net/index.html">http://proxy.example.com:8080/?http://origin.example.net/index.html</A>
</I>&gt;<i> 
</I>
Note that you are now having to add a non-default port &quot;8080&quot; and path 
&quot;/&quot; to the URL to make it valid/accepted by the Browser.

Clients speaking HTTP origin-form (the <A HREF="http://">http://</A> scheme) are not permitted 
to request tunnels or equivalent gateway services. They can only ask for 
resource representations.


&gt;<i> Also, I'm talking about &quot;<A HREF="http://">http://</A>&quot; and &quot;<A HREF="https://">https://</A>&quot; using their default 
</I>&gt;<i> ports of 80 &amp; 443.
</I>&gt;<i> 
</I>
Port is just a number, it can be anything *IF* it is made explicit.
The scheme determines what protocol syntax is being spoken and thus what 
restrictions and/or requirements are.

... and so the protocol for talking to a webcache service is 
http-<A HREF="alt://.">alt://.</A>
Whose default port is not 80 nor 443 for all the same reasons why Squid 
default listening port is 3128.

If we wanted to we could easily switch Squid default port to 
http-alt/8080 without causing technical issues. But it would be annoying 
to update all the existing documentation around the Internet, so not 
worth the effort changing now.


&gt;<i> 
</I>&gt;&gt;<i> It is based on experience. Squid used to be a lot more lenient and 
</I>&gt;&gt;<i> tried for decades to do the syntax auto-detection. The path from that 
</I>&gt;&gt;<i> to separate ports is littered with CVEs. Most notably the curse that 
</I>&gt;&gt;<i> keeps on giving: CVE-2009-0801, which is just the trigger issue for a 
</I>&gt;&gt;<i> whole nest of bad side effects.
</I>&gt;<i> 
</I>&gt;<i> I wonder how much of that problematic history was related to HTTP/0.9 
</I>&gt;<i> vs HTTP/1.0 vs HTTP/1.1 clients.
</I>
Ditto. Though the legacy install base has a long long long tail. 26 
years after HTTP/1.0 came out and HTTP/0.9 still has use-cases alive.

&gt;<i> 
</I>&gt;<i> I similarly wonder how much HTTP/1.0, or even HTTP/0.9, protocol is 
</I>&gt;<i> used these days.
</I>
Decreasing, but still a potentially significant amount of traffic seen 
by Squid in general.

&gt;<i> 
</I>&gt;<i> Also, there is the elephant in the room of we're talking about a proxy 
</I>&gt;<i> server which is frequently, but not always, on a dedicated system or 
</I>&gt;<i> IP.  As such, I have no problem predicating the use of the HTTP(80) and 
</I>&gt;<i> HTTPS(443) ports when there is no possible chance of confusion between 
</I>&gt;<i> forward proxy roles and origin server / reverse proxy roles.
</I>&gt;<i> 
</I>
Ah, if you have been treating it like an irrelevant elephant that is 
your confusion. The &quot;but not always&quot; is a critical detail in the puzzle 
- its side-effects are the answer to your initial question of *why* 
Squid defaults to X instead of 80/443.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025367.html">[squid-users] Problem with wss protocol.
</A></li>
	<LI>Next message (by thread): <A HREF="025371.html">[squid-users] FW: Encrypted browser-Squid connection errors
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25370">[ date ]</a>
              <a href="thread.html#25370">[ thread ]</a>
              <a href="subject.html#25370">[ subject ]</a>
              <a href="author.html#25370">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
