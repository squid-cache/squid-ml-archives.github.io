<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] FW: Encrypted browser-Squid connection errors
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20FW%3A%20Encrypted%20browser-Squid%20connection%20errors&In-Reply-To=%3C769fb3cf7a6adafebd98dac5f2981dac%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025371.html">
   <LINK REL="Next"  HREF="025376.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] FW: Encrypted browser-Squid connection errors</H1>
    <B>squid3 at treenet.co.nz</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20FW%3A%20Encrypted%20browser-Squid%20connection%20errors&In-Reply-To=%3C769fb3cf7a6adafebd98dac5f2981dac%40treenet.co.nz%3E"
       TITLE="[squid-users] FW: Encrypted browser-Squid connection errors">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Nov  2 00:27:02 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025371.html">[squid-users] FW: Encrypted browser-Squid connection errors
</A></li>
        <LI>Next message (by thread): <A HREF="025376.html">[squid-users] FW: Encrypted browser-Squid connection errors
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25373">[ date ]</a>
              <a href="thread.html#25373">[ thread ]</a>
              <a href="subject.html#25373">[ subject ]</a>
              <a href="author.html#25373">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2022-11-02 09:03, Grant Taylor wrote:
&gt;<i> On 11/1/22 1:24 PM, squid3 wrote:
</I>&gt;&gt;<i> No I meant W3C. Back in the before times things were a bit messy.
</I>&gt;<i> 
</I>&gt;<i> Hum.  I have more questions than answers.  I'm not aware of W3C ever 
</I>&gt;<i> assigning ports.  I thought it was /always/ IANA.
</I>&gt;<i> 
</I>&gt;&gt;<i> Indeed, thus we cannot register it with IEFT/IANA now. The IANA 
</I>&gt;&gt;<i> http-alt port would probably be best if we did go official.
</I>&gt;<i> 
</I>&gt;<i> ACK
</I>&gt;<i> 
</I>&gt;&gt;<i> You see my point I hope. A gateway proxy that returns an error to 
</I>&gt;&gt;<i> *every* request is not very good.
</I>&gt;<i> 
</I>&gt;<i> Except it's not &quot;/ever/ /request/&quot;  It's &quot;/every/ /request/ /of/ /a/ 
</I>&gt;<i> /specific/ /type/&quot; where type is an HTTP version.
</I>&gt;<i> 
</I>
No, you cropped my use-case description. It specified a client which was 
*unaware* that it was talking to a forward-proxy. Such a client will 
send requests that only a reverse-proxy or origin server can handle 
properly - because they have explicit special configuration to do so.

In all proxying cases there is special configuration somewhere. For 
forward-proxy it is in the client (or its OS so-called &quot;default&quot;), for 
reverse-proxy it is in the proxy, for interception-proxy it is in both 
the network and the proxy.


&gt;<i> What does CloudFlare or any of the other big proxy services or even 
</I>&gt;<i> other proxy applications do if you send them an HTTP/1.0 or even 
</I>&gt;<i> HTTP/0.9 request without the associated Host: header?
</I>&gt;<i> 
</I>
The working ones deliver an HTTP/1.1 302 redirect to their companies 
homepage if the request came from outside the company LAN. If the 
request came from an administrators machine it may respond with stats 
data about the node being probed.


&gt;&gt;<i> There is no &quot;configured proxy&quot; for this use-case.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Those are the two most/extremely common instances of the problematic 
</I>&gt;&gt;<i> use-cases. All implicit use of proxy (or gateway) have the same issue.
</I>&gt;<i> 
</I>&gt;<i> How common is the (network) transparent / intercepting / implicit use 
</I>&gt;<i> of Squid (or any proxy for that matter)?
</I>&gt;<i> 
</I>&gt;<i> All of the installs that I've worked on (both as a user and as an 
</I>&gt;<i> administrator) have been explicit / non-transparent.
</I>&gt;<i> 
</I>
Almost all the installs I have worked on had interception as part of 
their configuration. It is officially recommended to include 
interception as a backup to explicit forward-proxy for networks needing 
full traffic control and/or monitoring.

I take it from your statement you have not worked on networks like 
web-cafes, airports, schools, hospitals, public shopping malls who all 
use captive portal systems, or high-security institutions capturing 
traffic for personnel activity audits.

There are also at least a half dozen nation states with national 
firewalls doing traffic monitoring and censorship. At least 3 of the 
ones I know of use Squid's for the HTTP portion.


&gt;&gt;<i> I think you are getting stuck with the subtle difference between &quot;use 
</I>&gt;&gt;<i> for case X&quot; and &quot;use by default&quot;.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> ANY port number can be used for *some* use-case(s).
</I>&gt;<i> 
</I>&gt;<i> Sure.
</I>&gt;<i> 
</I>&gt;&gt;<i> &quot;by default&quot; has to work for *all* use-cases.
</I>&gt;<i> 
</I>&gt;<i> I disagree.
</I>&gt;<i> 
</I>
ACK. That is you. I am coming at this from the maintainer viewpoint 
where the entire community's needs have to be balanced.


&gt;&gt;<i> Note that you are now having to add a non-default port &quot;8080&quot; and path 
</I>&gt;&gt;<i> &quot;/&quot; to the URL to make it valid/accepted by the Browser.
</I>&gt;<i> 
</I>&gt;<i> You were already specifying the non-default-http port via the 
</I>&gt;<i> &quot;http-<A HREF="alt://">alt://</A>&quot; scheme in your example.
</I>&gt;<i> 
</I>
And you were specifying the non-default-'http-alt' port via the 
&quot;<A HREF="http://">http://</A>&quot; scheme in yours.
Either way these are two different HTTP syntax with different &quot;default 
port&quot; values.


An agent supporting the <A HREF="http://">http://</A> URL treats it as a request for some 
resource at the HTTP origin server indicated by the URL authority part 
or Host header.

An agent supporting the http-<A HREF="alt://">alt://</A> URL treats it as a request to 
forward-proxy the request-target specified in the URL query segment, 
using the upstream proxy indicated by the URL authority part or Host 
header.


&gt;&gt;<i> Clients speaking HTTP origin-form (the <A HREF="http://">http://</A> scheme) are not 
</I>&gt;&gt;<i> permitted to request tunnels or equivalent gateway services. They can 
</I>&gt;&gt;<i> only ask for resource representations.
</I>&gt;<i> 
</I>&gt;<i> I question the veracity of that.  Mostly around said client's use of an 
</I>&gt;<i> explicit proxy.
</I>&gt;<i> 
</I>
It is clear side-effect of the fact that tunnels cannot be opened by 
requesting an origin-form URL (eg &quot;/index.html&quot;). They require an 
authority-form URI (eg &quot;example.com:80&quot;).

See <A HREF="https://www.rfc-editor.org/rfc/rfc9110.html#name-intermediaries">https://www.rfc-editor.org/rfc/rfc9110.html#name-intermediaries</A> for 
definitions of intermediary and role scopes.
Note that it explicitly says (requires) absolute-URI for &quot;proxy&quot; (aka 
forward-proxy) intermediaries. Clients do not speak origin-form to 
explicit proxies.

[yes I know the first paragraph says an intermediary may switch 
behaviour based on just the request, that is for HTTP/2+. Squid being 
1.1 is more restricted by the legacy issues].


&gt;&gt;<i> Port is just a number, it can be anything *IF* it is made explicit.
</I>&gt;&gt;<i> The scheme determines what protocol syntax is being spoken and thus 
</I>&gt;&gt;<i> what restrictions and/or requirements are.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> ... and so the protocol for talking to a webcache service is 
</I>&gt;&gt;<i> http-<A HREF="alt://.">alt://.</A>
</I>&gt;&gt;<i> Whose default port is not 80 nor 443 for all the same reasons why 
</I>&gt;&gt;<i> Squid default listening port is 3128.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> If we wanted to we could easily switch Squid default port to 
</I>&gt;&gt;<i> http-alt/8080 without causing technical issues. But it would be 
</I>&gt;&gt;<i> annoying to update all the existing documentation around the Internet, 
</I>&gt;&gt;<i> so not worth the effort changing now.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Ditto. Though the legacy install base has a long long long tail. 26 
</I>&gt;&gt;<i> years after HTTP/1.0 came out and HTTP/0.9 still has use-cases alive.
</I>&gt;<i> 
</I>&gt;<i> Where is HTTP/0.9 still being used?
</I>
The ones I am aware of are:
  * HTTP software testing and development
  * IoT sensor polling
  * printer network bootstrapping
  * manufacturing controller management
  * network stability monitoring systems


&gt;<i> 
</I>&gt;&gt;<i> Decreasing, but still a potentially significant amount of traffic seen 
</I>&gt;&gt;<i> by Squid in general.
</I>&gt;<i> 
</I>&gt;<i> Can you, or anyone else, quantify what &quot;a potentially significant 
</I>&gt;<i> amount of traffic&quot; is?
</I>&gt;<i> 
</I>
I doubt anyone can quantify it accurately. But worldwide use of HTTP/1.1 
is also dropping, and at a faster rate than 0.9/1.0 right now as the 
more efficient HTTP/2+ expand.


&gt;<i> Do these cases *really* /need/ to be covered by the /default/ 
</I>&gt;<i> configuration?  Or can they be addressed by a variation from the 
</I>&gt;<i> default configuration?
</I>
HTTP/1.1 specification requires semantic compatibility. So long as 1.1 
is still a thing the older versions are likely to remain as well. 
Undesirable as that may be.

Cheers
Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025371.html">[squid-users] FW: Encrypted browser-Squid connection errors
</A></li>
	<LI>Next message (by thread): <A HREF="025376.html">[squid-users] FW: Encrypted browser-Squid connection errors
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25373">[ date ]</a>
              <a href="thread.html#25373">[ thread ]</a>
              <a href="subject.html#25373">[ subject ]</a>
              <a href="author.html#25373">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
