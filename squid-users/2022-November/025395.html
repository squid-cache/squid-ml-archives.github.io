<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Does Squid support client ssl termination?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Does%20Squid%20support%20client%20ssl%20termination%3F&In-Reply-To=%3Ca39a2395-c924-2561-5fb8-6306fc16f970%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025381.html">
   <LINK REL="Next"  HREF="025397.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Does Squid support client ssl termination?</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Does%20Squid%20support%20client%20ssl%20termination%3F&In-Reply-To=%3Ca39a2395-c924-2561-5fb8-6306fc16f970%40treenet.co.nz%3E"
       TITLE="[squid-users] Does Squid support client ssl termination?">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Nov  4 13:05:19 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025381.html">[squid-users] Does Squid support client ssl termination?
</A></li>
        <LI>Next message (by thread): <A HREF="025397.html">[squid-users] Does Squid support client ssl termination?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25395">[ date ]</a>
              <a href="thread.html#25395">[ thread ]</a>
              <a href="subject.html#25395">[ subject ]</a>
              <a href="author.html#25395">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 3/11/2022 4:13 am, Grant Taylor wrote:
&gt;<i> On 11/1/22 4:17 PM, squid3 wrote:
</I>&gt;&gt;<i> Yes I was addressing mingheng's statement.
</I>&gt;<i>
</I>&gt;<i> Thank you for clarifying.
</I>&gt;<i>
</I>&gt;&gt;<i> The first thing you need to do is avoid that &quot;HTTPS&quot; term. It has 
</I>&gt;&gt;<i> multiple meanings and they cause confusion. Instead decompose it into 
</I>&gt;&gt;<i> its TLS and HTTP layers.
</I>&gt;<i>
</I>&gt;<i> Largely okay.
</I>&gt;<i>
</I>&gt;<i> However, a minor nitpick:&#160; TCP, TLS, and HTTP are three distinct things.
</I>&gt;<i>
</I>&gt;<i> TCP is the traditional transport.
</I>&gt;<i> TLS is the optional presentation layer that rides on top of TCP.
</I>&gt;<i> HTTP is the application layer protocol that's spoken between endpoints 
</I>&gt;<i> which rides on top of TLS if present or TCP if TLS is not present.
</I>&gt;<i>
</I>&gt;<i> N.B. I'm eliding UDP / QUIC.
</I>&gt;<i>
</I>
Aye, that is the terminology definitions of them. Which does not clearly 
convey the recursive layer/nesting properties. They way I suggested to 
think of TLS and HTTP as transfer layers helps clarify that property.

&gt;&gt;<i> * A client can use TCP or TLS to connect to a proxy.
</I>&gt;&gt;<i> &#160;&#160;- this is configured with http_port vs https_port
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> * Independently of the connection type the client can request <A HREF="http://">http://</A> 
</I>&gt;&gt;<i> or <A HREF="https://">https://</A> URLs or CONNECT tunnels.
</I>&gt;<i>
</I>&gt;<i> Do you have any recommendation of clarifying / consistent terms for 
</I>&gt;<i> using to describe the connection between the client and the proxy with 
</I>&gt;<i> the goal of differentiating it from the connection between the proxy 
</I>&gt;<i> and the server?
</I>&gt;<i>
</I>
The best I have found is the rule-of-thumb to avoid abbreviations that 
have multiple meanings and use simple nouns that the reader understands 
already to build a compound noun that they can comprehend. As such you 
will find my wording varies between discussions, and can adjust as I 
learn what terms the others understand already.

&gt;<i> I'll argue, but be open to arguments to the contrary, that both 
</I>&gt;<i> connections are using the HTTP application layer protocol on top of 
</I>&gt;<i> whatever transport is being used; TCP or TCP+TLS.
</I>
To Squid the transport is (almost) always TCP. Whether TLS is treated as 
transport layer or application layer depends on the Squid features (eg 
SSL-Bump).

So for your purpose of understanding the possibilities it is best to 
think of it as just another transfer protocol that Squid can receive 
like HTTP. Which can either transfer opaque client information, or 
another type of transfer protocols &quot;nested&quot; inside it.

&gt;&gt;<i> * Independent of what the client is doing/requesting, a cache_peer 
</I>&gt;&gt;<i> may be connected to using TCP or TLS.
</I>&gt;&gt;<i> &#160;&#160;- this is configured with cache_peer tls options (or their absence)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> * Independent of anything else, a cache_peer MAY be asked to open a 
</I>&gt;&gt;<i> CONNECT tunnel for opaque uses.
</I>&gt;&gt;<i> &#160;&#160;- this is automatically decided by Squid based on various criteria.
</I>&gt;<i>
</I>&gt;<i> Oy vey!
</I>&gt;<i>
</I>&gt;<i> I had forgotten about using HTTP's CONNECT to carry non-HTTP traffic.
</I>&gt;<i>
</I>&gt;&gt;<i> TCP is the foundation layer. On top of that can be HTTP transfer or 
</I>&gt;&gt;<i> TLS transfer. Transfer layers can be nested infinitely deep in any 
</I>&gt;&gt;<i> order.
</I>&gt;<i>
</I>&gt;<i> I'm avoiding -- what I've seen referenced as -- &quot;chaining&quot; for this 
</I>&gt;<i> discussion.
</I>&gt;<i>
</I>
Oh, I see (I think). I use nesting or layering (from OSI model 
terminology) because &quot;chain&quot; is used by HTTP in the definition of how 
traffic is routed between multiple agents. For example; 
client-&gt;squid-&gt;server is a chain.

&gt;<i> I'm focusing on the what traditional web browsers / clients support 
</I>&gt;<i> out of the box; client-to-proxy and proxy-to-server.
</I>&gt;<i>
</I>
Browsers are origin-client software. They deal with these layers:
 &#160;* HTTP (<A HREF="http://">http://</A> to origin, or <A HREF="http://">http://</A> to traditional plain-text 
forward-proxy), or
 &#160;* HTTP-over-TLS (<A HREF="https://">https://</A> to origin), or
 &#160;* HTTP-over-TLS-over-HTTP (traditional <A HREF="https://">https://</A> to plain-text 
forward-proxy).

Recently some started handling HTTP-over-TLS-over-HTTP-over-TLS - which 
is traditional <A HREF="https://">https://</A> to an secure/encrypted forward-proxy.




&gt;<i> After all, even when chaining is in scope, the chained / down stream 
</I>&gt;<i> proxy is really functioning as the server that the first / upstream 
</I>&gt;<i> proxy connects to.&#160; Thus it's really higher layer traffic as far as 
</I>&gt;<i> the first / upstream proxy is concerned.
</I>
There you are running into the ambiguity of &quot;chain&quot;. Using both its 
meanings in one sentence.


&gt;<i>
</I>&gt;&gt;<i> So &quot;HTTPS&quot; can mean any one of things like:
</I>&gt;&gt;<i> &#160;&#160;1) HTTP-over-TLS (how Browsers handle <A HREF="https://">https://</A> URLs)
</I>&gt;&gt;<i> &#160;&#160;2) HTTP-over-TLS (sending <A HREF="http://">http://</A> URLs over a secure connection)
</I>&gt;&gt;<i> &#160;&#160;3) HTTP-over-TLS-over-TLS (relay (1) through a secure cache_peer)
</I>&gt;&gt;<i> &#160;&#160;4) HTTP-over-TLS-over-HTTP (relay (1), (2) or (3) through an 
</I>&gt;&gt;<i> insecure cache_peer via CONNECT tunnel)
</I>&gt;<i>
</I>&gt;<i> Hence my question about nomenclature.
</I>&gt;<i>
</I>&gt;<i> ...really big snip...
</I>&gt;<i>
</I>&gt;&gt;<i> Vaguely yes. There are three dimensions to the matrix, you only have 
</I>&gt;&gt;<i> two shown here.
</I>&gt;<i>
</I>&gt;<i> Please elaborate.&#160; I'm not following what the 3rd dimension would be 
</I>&gt;<i> with the small amount of coffee that I've had.
</I>&gt;<i>
</I>
The three dimensions in play are:
 &#160;1) protocol X being spoken between client and Squid
 &#160;2) protocol Y the client is requesting to use with the origin server
 &#160;3) protocol Z actually being spoken between Squid and next-hop peer/server

protocol Z *could* be the same protocol the client requested, OR it 
could be a CONNECT tunnel (plain-text HTTP) to the origin server.


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025381.html">[squid-users] Does Squid support client ssl termination?
</A></li>
	<LI>Next message (by thread): <A HREF="025397.html">[squid-users] Does Squid support client ssl termination?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25395">[ date ]</a>
              <a href="thread.html#25395">[ thread ]</a>
              <a href="subject.html#25395">[ subject ]</a>
              <a href="author.html#25395">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
