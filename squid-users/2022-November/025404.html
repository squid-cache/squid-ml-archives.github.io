<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid ssl_bump configuration optimized for highest CPS?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20ssl_bump%20configuration%20optimized%20for%20highest%0A%20CPS%3F&In-Reply-To=%3CPH0PR11MB4966049C5503CE5E4F17594185019%40PH0PR11MB4966.namprd11.prod.outlook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025403.html">
   <LINK REL="Next"  HREF="025406.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid ssl_bump configuration optimized for highest CPS?</H1>
    <B>Andralojc, Wojciech</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20ssl_bump%20configuration%20optimized%20for%20highest%0A%20CPS%3F&In-Reply-To=%3CPH0PR11MB4966049C5503CE5E4F17594185019%40PH0PR11MB4966.namprd11.prod.outlook.com%3E"
       TITLE="[squid-users] Squid ssl_bump configuration optimized for highest CPS?">wojciech.andralojc at intel.com
       </A><BR>
    <I>Thu Nov 10 16:38:17 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025403.html">[squid-users] Update from Squid 4 to Squid 5 :
</A></li>
        <LI>Next message (by thread): <A HREF="025406.html">[squid-users] Squid ssl_bump configuration optimized for highest CPS?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25404">[ date ]</a>
              <a href="thread.html#25404">[ thread ]</a>
              <a href="subject.html#25404">[ subject ]</a>
              <a href="author.html#25404">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I'm running squid v4.13 in TLS bump mode.
Trying to configure it to get highest (single core) CPS (new TLS sessions/connections per second) numbers.

I run multiple s_time tests on client side and &quot;plain&quot; nginx on server side.

Example s_time command line:
openssl s_time -connect server:443 -new -cipher AES128-GCM-SHA256 -time 30 -CAfile /opt/proxy_rootCA.pem -tls1_2

Could you please review config below and suggest changes to improve performance?

Assumptions:

  *   SSL bump/transparent SSL proxy;
  *   single core performance;
  *   caching disabled;
  *   persistent connections disabled;
  *   no logs;

Best wishes
Wojciech Andralojc

---

acl localnet src 10.0.8.0/24

acl SSL_ports port 443
acl Safe_ports port 80          # http
acl Safe_ports port 21          # ftp
acl Safe_ports port 443         # https
acl Safe_ports port 70          # gopher
acl Safe_ports port 210         # wais
acl Safe_ports port 1025-65535  # unregistered ports
acl Safe_ports port 280         # http-mgmt
acl Safe_ports port 488         # gss-http
acl Safe_ports port 591         # filemaker
acl Safe_ports port 777         # multiling http
acl CONNECT method CONNECT

http_access deny !Safe_ports

http_access deny CONNECT !SSL_ports

http_access allow localhost manager
http_access deny manager

http_access allow localnet
http_access allow localhost

http_access allow all

# Squid normally listens to port 3128
http_port 3128
http_port 3129 intercept
ssl_bump server-first all
https_port 3130 intercept ssl-bump cert=/etc/ssl/certs//rootCA.pem generate-host-certificates=on

# Leave coredumps in the first cache dir
coredump_dir /var/cache/squid

#
# Add any of your own refresh_pattern entries above these.
#
refresh_pattern ^ftp:           1440    20%     10080
refresh_pattern ^gopher:        1440    0%      1440
refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
refresh_pattern .               0       20%     4320
dns_nameservers 127.0.0.1
visible_hostname &quot;proxy&quot;
tls_outgoing_options cafile=/etc/ssl/certs//nginx.pem
access_log none
cache_store_log none
cache_log /dev/null
workers 1
cache deny all
cache_mem 0
server_persistent_connections off
client_persistent_connections off
--------------------------------------------------------------
Intel Research and Development Ireland Limited
Registered in Ireland
Registered Office: Collinstown Industrial Park, Leixlip, County Kildare
Registered Number: 308263


This e-mail and any attachments may contain confidential material for the sole
use of the intended recipient(s). Any review or distribution by others is
strictly prohibited. If you are not the intended recipient, please contact the
sender and delete all copies.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20221110/3392a0b0/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20221110/3392a0b0/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025403.html">[squid-users] Update from Squid 4 to Squid 5 :
</A></li>
	<LI>Next message (by thread): <A HREF="025406.html">[squid-users] Squid ssl_bump configuration optimized for highest CPS?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25404">[ date ]</a>
              <a href="thread.html#25404">[ thread ]</a>
              <a href="subject.html#25404">[ subject ]</a>
              <a href="author.html#25404">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
