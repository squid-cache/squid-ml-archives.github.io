<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 5: server_cert_fingerprint not working fine...
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%205%3A%20server_cert_fingerprint%20not%20working%0A%20fine...&In-Reply-To=%3C001201d8ff86%24ba7267b0%242f573710%24%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025442.html">
   <LINK REL="Next"  HREF="025435.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 5: server_cert_fingerprint not working fine...</H1>
    <B>ngtech1ltd at gmail.com</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%205%3A%20server_cert_fingerprint%20not%20working%0A%20fine...&In-Reply-To=%3C001201d8ff86%24ba7267b0%242f573710%24%40gmail.com%3E"
       TITLE="[squid-users] Squid 5: server_cert_fingerprint not working fine...">ngtech1ltd at gmail.com
       </A><BR>
    <I>Wed Nov 23 21:58:31 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025442.html">[squid-users] Squid 5: server_cert_fingerprint not working fine...
</A></li>
        <LI>Next message (by thread): <A HREF="025435.html">[squid-users] does squid 5.7 support HTTP/2 protocol
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25453">[ date ]</a>
              <a href="thread.html#25453">[ thread ]</a>
              <a href="subject.html#25453">[ subject ]</a>
              <a href="author.html#25453">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey Fred,
 
First take into account that to the Squid-Users no question is ridicules at any time!!!!
There are couple sides for a forum/list and only one of them is the technical one.
I was told by a good mentor of me the next sentence:
Think about the other side of the conversation on the line like your own son or daughter.
Sometimes a father or a friend are saying things because they truly love you. The only reason you might not understand the comparison you are doing is probably since you are not used to do specific tasks.
And I will try to make sense of both sides.
Think about squid about the &#8220;nice&#8221; kid in the neighborhood.
Squid is almost the only proxy software out there that is trying to give a solution for everything and every use case for a very long time.
It is more complicated to support everyone then writing a proxy that does one specific thing very good.
 
Squid is here since 1985~ and will not be taken down easily and will kick in the web a long ahead compared to others.
This is despite it not being the most advertised software out there.
The original goal of Squid-Cache was achieved and not just in a standard way but with a really good success and every piece of the Internet was and is still affected by it.
 
Sometimes I would answer my kid with a really rough answer (compared to what I believe should have been a softer one) but my intent is good.
 
This is a place where we would like you Fred to get a grasp of what is happening and to help you become better and only one of the tools to get there is coding.
The Squid-Cache project tried and tries to make the proxy smart as possible and to not harm while doing it&#8217;s job/purpose.
 
For example, ufdbguard (which is a great piece of code which deserves honor and respect) does destination tls probing.
The overhead for that is that eventually (if there is no caching involved) per CONNECT request there is another tls/tcp request that is going to hit the hosting service.
For a single connection of a home user it&#8217;s fine.
For a single connection of a home user doubles an ISP it&#8217;s not fine&#8230;
I will call this as it is, an &#8220;amplification attack&#8221;.
Which means that every single action hits in power of 2 or more.
Squid tries to avoid this as much as possible.
 
I would try to give you a sense of the issue in a human level.
Assume that there is a shop in the street that sell .. let say fruits.
One customer comes and asks to taste something small from the store before buying. As a good and nice shop owner he lets him do so.
Then a bunch of clients comes and take each a fruit to &#8220;taste&#8221; and goes off without buying anything.
The end result is that the whole sector of this specific fruit is gone and the owner left with an open mouth shocked and.. robbed.
 
Take into account that every single TLS connection consumes more CPU then a single linux kernel &#8220;sendfile&#8221; operation.
To make more sense of it, a CPU is merely some form of programmable electrical resistor.
If you would know something in electronics(these days called electricity engineering) there is a specific life span to a resistor and by definition to any electrical component.
 
I believe that you don&#8217;t want to harm every CPU in every site your clients are visiting.
Every HIT costs and one of the goals of Squid-Cache is to reduce these HITs on the origin service and to offload some of the HIT rate from the origin server and to allow the local or regional ISP take the HIT on itself since it&#8217;s more reasonable for a group of clients to take the HIT for their demand for any communication consumption.
 
For some reason else then maybe Microsoft the Gaming industry and couple other big players nobody wants to be a part of this.
And it&#8217;s not that I don&#8217;t understand why many goes after the TLS everywhere and couple other communication trends but it&#8217;s mostly because of an un-justified fear.
TLS is not security but rather it&#8217;s a burden on the service providers and shop owners, it&#8217;s actually a &#8220;protection&#8221; mechanism.
So I would just say that to protect the data you don&#8217;t need to protect every piece of the shop but rather make an effort to block the &#8220;escape&#8221; routes or &#8220;leak&#8221; routes.
 
What you want to achieve is good but what I am trying to say is that you must have both brains and sensitivity to others on the Internet and if you are probing the services on the Internet you should write a good caching layer that will lower the power of your amplification attack from power of 2 to a lower ratio since probably the signature of a SNI+ip+port or NO-SNI+ip+port would stay the same for at-least 12 hours and with let-encrypt around the cert is valid and fresh for 30~ days for a domain star certificate.
 
So to summarize:
I didn&#8217;t touch every piece of technical aspect of the SNI+IP+PORT TLS probing solution but I hope it&#8217;s enough to make some sense into caching with redis(for example) the results of this probing.
 
And if you would ask any standard and non-greedy client if they would prefer to get good security without harming the service provider, they would surly answer they would be ok waiting an extra couple milliseconds for the caching layer to get a good answer like from a MariaDB table(layer 2) compared to a Redis(layer 1).
 
And I just must tell you something:
I am religious person and we have a very old story about a person who wanted to get to Jerusalem. (in the old days)
He got to a place near Jerusalem where you cannot see the city because of the hills and also because Jerusalem(old one) is actually a very low mountain compared to couple others in the area.
In this place the kids of Jerusalem were playing and wondering around and he have seen one kid (the kids of Jerusalem are known for their wisdom).
He then asked him for directions to Jerusalem and the kid told him the next:
You have from here two ways to Jerusalem, the short long and the long short.
He assumed that the short long is the shorter&#8230; but..
He started walking this short long way and it was a nice and smooth route but as he started seeing Jerusalem, he started to stumble thorns and bushes. After fighting the &#8230; lost cause to reach Jerusalem he got back to the intersection of roads where he met the boy.
He then asked him: Why did you told me that this is the short way? It&#8217;s the worst way to get to Jerusalem!!!!
The kid then answered him: I told you there are two ways.
There is a short and long while the other is long but short.
He then tried the other way understanding the basic wisdom of the kids of Jerusalem.
Indeed the &#8220;long short&#8221; way started rough but not as rough as the other rough part of the &#8220;short long&#8221; way.
After a while when he was a bit exhausted from the road he saw Jerusalem so close he felt he was already there and as he saw this he gets a relief since from this point the terrain became smooth.
At this point he got to grasp how smart are the kids of Jerusalem and threw a blessing to the air &#8220;If this smart are the kids of Jerusalem, I wish their wisdom would spread in the world&#8221;.
 
I have known your name for a very long time and I believe you are on the right track, just make sure that the architecture of your helper is smart enough so that the amplification attack it causes will try to get to the result with less then the power of 2 HIT ratio on the services it&#8217;s probing.
 
Yours,
Eliezer  
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A>&gt; 
Web: <A HREF="https://ngtech.co.il/">https://ngtech.co.il/</A>
My-Tube: <A HREF="https://tube.ngtech.co.il/">https://tube.ngtech.co.il/</A>
 
From: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; On Behalf Of UnveilTech - Support
Sent: Wednesday, 23 November 2022 14:59
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] [SPAM] Re: Squid 5: server_cert_fingerprint not working fine...
 
Amos,
 
For your information, sslcrtvalidator_program is also not compatible with TLS1.3.
We have done dozen of tests and we only get TLS1.2 information with sslcrtvalidator_program.
 
My &#171; question-conclusion &#187; &#171;  could be ridiculous but the imcompability is here a fact, sorry for that.
Instead a PHP helper we have build a C++ helper (300 lines including comments) and we can also work with TLS1.3 by using basis OpenSSL functions, we suppose the same the Squid uses&#8230;
 
PS : OpenSSL is the same we use to compile Squid 5.7.
 
Ye Fred
 
De : squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] De la part de David Touzeau
Envoy&#233; : samedi 19 novembre 2022 19:19
&#192; : <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt; 
Objet : [SPAM] Re: [squid-users] Squid 5: server_cert_fingerprint not working fine...
 
Thanks Amos for this clarification,

We also have the same needs and indeed, we face with the same approach.

It is possible that the structure of Squid could not, in some cases, recovering this type of information.
Although the concept of a proxy is neither more nor less than a big browser that surfs instead of the client browsers.

The SHA1 and certificate information reception are very valuable because it ensures better detection of compromised sites (many malicious sites use the same information in their certificates).
This allows detecting &quot;nests&quot; of malicious sites automatically.

Unfortunately, there is madness in the approach to security, there is a race to strengthen the security of tunnels (produced by Google and browsers vendors).
What is the advantage of encrypting wikipedia and Youtube channels?

On the other hand, it is crucial to look inside these streams to detect threats.
This is antinomic...

So TLS 1.3 and soon the use of QUIC with UDP 80/443 will make use of a proxy useless as these features are rolled out  (trust Google to motivate them)
Unless the proxy manages to follow this protocol madness race...

For this reason, firewall manufacturers propose the use of client software that fills the gap of protocol visibility in their gateway products or you -can see a growth of workstation protections , such EDR concept

Just an ideological and non-technical approach...

Regards
Le 19/11/2022 &#224; 16:50, Amos Jeffries a &#233;crit :
On 19/11/2022 2:55 am, UnveilTech - Support wrote: 
Hi Amos, 

We have tested with a &quot;ssl_bump bump&quot; (&quot;ssl_bump all&quot; and &quot;ssl_bump bump sslstep1&quot;), it does not solve the problem. 
According to Alex, we can also confirm it's a bug with Squid 5.x and TLS 1.3. 

Okay. 


It seems Squid is only compatible with TLS 1.2, it's not good for the future... 

One bug (or lack of ability) does not make the entire protocol &quot;incompatible&quot;. It only affects people trying to do the particular buggy action. 
Unfortunately for you (and others) it happens to be accessing this server cert fingerprint. 

I/we have been clear from the beginning that *when used properly* TLS/SSL cannot be &quot;bump&quot;ed - that is true for all versions of TLS and SSL before it. In that same &quot;bump&quot; use-case the server does not provide *any* details, it just rejects the proxy attempted connection. In some paranoid security environments the server can reject even for &quot;splice&quot; when the clientHello is passed on unchanged by the proxy. HTTPS use on the web is typically *neither* of those &quot;proper&quot; setups so SSL-Bump &quot;bump&quot; in general works and &quot;splice&quot; almost always. 

Cheers 
Amos 

_______________________________________________ 
squid-users mailing list 
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;  
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20221123/d830bfa9/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20221123/d830bfa9/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025442.html">[squid-users] Squid 5: server_cert_fingerprint not working fine...
</A></li>
	<LI>Next message (by thread): <A HREF="025435.html">[squid-users] does squid 5.7 support HTTP/2 protocol
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25453">[ date ]</a>
              <a href="thread.html#25453">[ thread ]</a>
              <a href="subject.html#25453">[ subject ]</a>
              <a href="author.html#25453">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
