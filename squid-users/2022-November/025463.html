<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Network appliance Sizing for Squid transparent proxy
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Network%20appliance%20Sizing%20for%20Squid%20transparent%0A%20proxy&In-Reply-To=%3Cc59c8163-e1cc-12d2-1299-1388dc576d29%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025461.html">
   <LINK REL="Next"  HREF="025467.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Network appliance Sizing for Squid transparent proxy</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Network%20appliance%20Sizing%20for%20Squid%20transparent%0A%20proxy&In-Reply-To=%3Cc59c8163-e1cc-12d2-1299-1388dc576d29%40treenet.co.nz%3E"
       TITLE="[squid-users] Network appliance Sizing for Squid transparent proxy">squid3 at treenet.co.nz
       </A><BR>
    <I>Sun Nov 27 15:28:03 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025461.html">[squid-users] Network appliance Sizing for Squid transparent proxy
</A></li>
        <LI>Next message (by thread): <A HREF="025467.html">[squid-users] Network appliance Sizing for Squid transparent proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25463">[ date ]</a>
              <a href="thread.html#25463">[ thread ]</a>
              <a href="subject.html#25463">[ subject ]</a>
              <a href="author.html#25463">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 27/11/2022 5:37 am, Lucas Vicente Pereira wrote:
&gt;<i> Dear,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I have a project and would like to use Squid for WebProxy with Full 
</I>&gt;<i> SSL inspection, external acl to control urls access.
</I>&gt;<i>
</I>
Firstly, be aware that TLS when used properly *cannot* be decrypted 
transparently.
So do not expect 100% inspection rates. Even though typical web HTTPS 
can still be inspected, service security levels vary a lot.


&gt;<i> Environment information:
</I>&gt;<i>
</I>&gt;<i> ~2500 users
</I>&gt;<i> 3 x Internet links 1 Gbps each
</I>&gt;<i> Average HTTP requests per minute since start: 65956.1
</I>&gt;<i> ClamAv integration
</I>&gt;<i> Snort Integration
</I>&gt;<i> Iptables REDIRECT for squid
</I>&gt;<i>
</I>&gt;<i> Please, can you please help me with appliance sizing for this environment?
</I>&gt;<i>
</I>
Disclaimer:&#160; I do not have any numbers for Squid when ClamAv is added. 
Someone else here may be able to supply or correct my below numbers from 
their actual experience when that tool is used.

AFAIK Snort and iptables are so much more efficient than Squid that they 
are essentially not relevant.


Your 1.1k RPS is well within Squid's capabilities for HTTP (15k-20k RPS 
limit), but the &quot;SSL inspection&quot; will add much overhead so YMMV.

Squid places heavy loads on CPU and I/O systems. The key things to look 
for when you are pushing performance boundaries are (in order of 
impact/gains IMO):

 &#160;* as much RAM as you can afford. Within reason, ~128GB is probably 
enough for most Squid.
 &#160; - I/O is a major point of performance loss. Network I/O is implicitly 
minimized by Squid defaults.
 &#160; - Now that RAM comes by the GB I typically recommend a memory cache 
over disk cache.

 &#160;* prefer CPU with higher GHz rating than more cores,
 &#160; - the GHz translates directly into faster transaction times + more 
clients, cores translates only to parallel capacity/clients.

 &#160;* real/physical cores better than hyper-threading,
 &#160;&#160; - Squid workers are single-threaded and can push their CPU hard. In 
this case hyper-threading just slows the CPU down.

 &#160;* bare-metal better than container;&#160; container better than VM.
 &#160; - under load Squid will just keep squeezing the machine until it has 
nothing left to give - then traffic speed takes a nosedive at the worst 
possible time to do so.

The rest is down to configuration and making the whole system as simple 
as possible at every level.


HTH
Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025461.html">[squid-users] Network appliance Sizing for Squid transparent proxy
</A></li>
	<LI>Next message (by thread): <A HREF="025467.html">[squid-users] Network appliance Sizing for Squid transparent proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25463">[ date ]</a>
              <a href="thread.html#25463">[ thread ]</a>
              <a href="subject.html#25463">[ subject ]</a>
              <a href="author.html#25463">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
