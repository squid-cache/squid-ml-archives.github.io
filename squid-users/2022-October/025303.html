<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] FW: Encrypted browser-Squid connection errors
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20FW%3A%20Encrypted%20browser-Squid%20connection%20errors&In-Reply-To=%3CDBAPR02MB61496C45B952998FCC050A49F5249%40DBAPR02MB6149.eurprd02.prod.outlook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025301.html">
   <LINK REL="Next"  HREF="025304.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] FW: Encrypted browser-Squid connection errors</H1>
    <B>LEMRAZZEQ, Wadie</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20FW%3A%20Encrypted%20browser-Squid%20connection%20errors&In-Reply-To=%3CDBAPR02MB61496C45B952998FCC050A49F5249%40DBAPR02MB6149.eurprd02.prod.outlook.com%3E"
       TITLE="[squid-users] FW: Encrypted browser-Squid connection errors">wadie.lemrazzeq at capgemini.com
       </A><BR>
    <I>Fri Oct 14 14:32:11 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025301.html">[squid-users] Ubuntu 20.04 LTS repository for Squid 5.7 (rebuilt from sources in Debian unstable)
</A></li>
        <LI>Next message (by thread): <A HREF="025304.html">[squid-users] FW: Encrypted browser-Squid connection errors
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25303">[ date ]</a>
              <a href="thread.html#25303">[ thread ]</a>
              <a href="subject.html#25303">[ subject ]</a>
              <a href="author.html#25303">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

I'm trying to set up an encrypted communication between the browser and squid

theoretically, I followed this section to implement it : <A HREF="https://wiki.squid-cache.org/Features/HTTPS#Encrypted_browser-Squid_connection">https://wiki.squid-cache.org/Features/HTTPS#Encrypted_browser-Squid_connection</A>

I tried to implement this on a dockerized Alpine, and a squid 5.5 with openssl module
in squid.conf, I have:
...
http_port 3128
https_port 3129 cert=/etc/squid/crt.pem key=/etc/squid/key.pem
...

but when I request squid https port, I got this error every time, in cache.log:
...
ERROR: failure while accepting a TLS connection on conn77 local=172.17.0.2:3129 remote=172.17.0.1:56608 FD 12 flags=1: 0x7fbd208f33e0*1
    connection: conn77 local=172.17.0.2:3129 remote=172.17.0.1:56608 FD 12 flags=1
Pipeline.cc(31) front: Pipeline 0x7fbd208f13a0 empty
Error.cc(22) update: recent: ERR_SECURE_ACCEPT_FAIL/SQUID_TLS_ERR_ACCEPT+TLS_LIB_ERR=1408F09B+TLS_IO_ERR=1
...

I also tried this with squid 4.10 with gnutls module, in an Ubuntu 20.40 environment, with the same squid.conf, and I got again a TLS error
...
client_side.cc(2597) tlsAttemptHandshake: Error negotiating TLS on local=x.x.x.x:3129 remote=x.x.x.x:50874 FD 11 flags=1: Aborted by client: An unexpected TLS packet was received.
...

I used for certificates, a self signed one, and a generated certificate signed by our CA, for both scenarios

Also, I tried multiple https_port options (disable some SSL implementation, manipulation of client certificates...) but without success

Am I missing something in the squid configuration?
This message contains information that may be privileged or confidential and is the property of the Capgemini Group. It is intended only for the person to whom it is addressed. If you are not the intended recipient, you are not authorized to read, print, retain, copy, disseminate, distribute, or use this message or any part thereof. If you receive this message in error, please notify the sender immediately and delete all copies of this message.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20221014/22d927fb/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20221014/22d927fb/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025301.html">[squid-users] Ubuntu 20.04 LTS repository for Squid 5.7 (rebuilt from sources in Debian unstable)
</A></li>
	<LI>Next message (by thread): <A HREF="025304.html">[squid-users] FW: Encrypted browser-Squid connection errors
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25303">[ date ]</a>
              <a href="thread.html#25303">[ thread ]</a>
              <a href="subject.html#25303">[ subject ]</a>
              <a href="author.html#25303">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
