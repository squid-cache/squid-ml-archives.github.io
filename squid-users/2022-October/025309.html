<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] FW: Encrypted browser-Squid connection errors
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20FW%3A%20Encrypted%20browser-Squid%20connection%20errors&In-Reply-To=%3CDBAPR02MB6149F7F567889AC742B77519F52B9%40DBAPR02MB6149.eurprd02.prod.outlook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025307.html">
   <LINK REL="Next"  HREF="025312.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] FW: Encrypted browser-Squid connection errors</H1>
    <B>LEMRAZZEQ, Wadie</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20FW%3A%20Encrypted%20browser-Squid%20connection%20errors&In-Reply-To=%3CDBAPR02MB6149F7F567889AC742B77519F52B9%40DBAPR02MB6149.eurprd02.prod.outlook.com%3E"
       TITLE="[squid-users] FW: Encrypted browser-Squid connection errors">wadie.lemrazzeq at capgemini.com
       </A><BR>
    <I>Wed Oct 19 13:53:51 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025307.html">[squid-users] FW: Encrypted browser-Squid connection errors
</A></li>
        <LI>Next message (by thread): <A HREF="025312.html">[squid-users] FW: Encrypted browser-Squid connection errors
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25309">[ date ]</a>
              <a href="thread.html#25309">[ thread ]</a>
              <a href="subject.html#25309">[ subject ]</a>
              <a href="author.html#25309">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 10/18/22 04:55, LEMRAZZEQ, Wadie wrote:

&gt;&gt;&gt;<i> I have problem only web browsers (Firefox, chromium), and I do specify 
</I>&gt;&gt;&gt;<i> to use https proxy in the browser proxy config But if I use curl, it 
</I>&gt;&gt;&gt;<i> works
</I>

&gt;&gt;&gt;&gt;<i> ERROR: failure while accepting a TLS connection on conn77
</I>&gt;&gt;&gt;&gt;<i> local=172.17.0.2:3129 remote=172.17.0.1:56608 FD 12 flags=1:
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> connection: conn77 local=172.17.0.2:3129 remote=172.17.0.1:56608 FD 
</I>&gt;&gt;&gt;&gt;<i> 12
</I>&gt;&gt;&gt;&gt;<i> flags=1
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Error.cc(22) update: recent:
</I>&gt;&gt;&gt;&gt;<i> ERR_SECURE_ACCEPT_FAIL/SQUID_TLS_ERR_ACCEPT+TLS_LIB_ERR=1408F09B+TLS
</I>&gt;&gt;&gt;&gt;<i> _I
</I>&gt;&gt;&gt;&gt;<i> O_ERR=1
</I>
&gt;&gt;&gt;<i> According to &quot;openssl errstr&quot;, that OpenSSL error is:
</I>&gt;&gt;&gt;<i>       error:1408F09B:SSL routines:ssl3_get_record:https proxy request
</I>

&gt;&gt;&gt;<i> Most likely, the client is sending a plain text CONNECT request 
</I>&gt;&gt;&gt;<i> before encrypting the TLS connection to the HTTPS proxy. In other 
</I>&gt;&gt;&gt;<i> words, the client thinks it is talking to an HTTP proxy while &gt; you 
</I>&gt;&gt;&gt;<i> want it to think that it is talking to an HTTPS proxy. For example,
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> * HTTP proxy:  curl -x <A HREF="http://172.17.0.2:3128/">http://172.17.0.2:3128/</A> ... 
</I>&gt;&gt;&gt;<i> <A HREF="https://example.com">https://example.com</A>
</I>&gt;&gt;&gt;<i> * HTTPS proxy: curl -x <A HREF="https://172.17.0.2:3129/">https://172.17.0.2:3129/</A> ... 
</I>&gt;&gt;&gt;<i> <A HREF="https://example.com">https://example.com</A>
</I>

&gt;&gt;<i> Yes indeed, requesting with curl works unless the web browsers
</I>
&gt;<i> As far as I can tell based on the information you have provided, your browser is not doing what you want it to do. I can only speculate that the browser is misconfigured.
</I>
&gt;<i> You can confirm what the browser is doing by looking at browser-Squid packets using wireshark or a similar tool. If you see an HTTP CONNECT requests sent to Squid over a plain text TCP 
</I>&gt;<i> connection, then your browser is _not_ configured to use an HTTPS proxy (or is buggy). The browser should be opening a TCP connection and then initiating a TLS handshake.
</I>
Yes, that's what I did
Here is the capture of firefox: <A HREF="https://i.stack.imgur.com/NNnGx.png">https://i.stack.imgur.com/NNnGx.png</A>
And here the capture of curl: <A HREF="https://i.stack.imgur.com/OxJJ3.png">https://i.stack.imgur.com/OxJJ3.png</A>
As you can see firefox sends a plain text CONNECT request, and I did parameter https proxy in firefox settings
If it is a browser bug, firefox team resolved this compatibility issue a while ago: <A HREF="https://bugzilla.mozilla.org/show_bug.cgi?id=378637#c68">https://bugzilla.mozilla.org/show_bug.cgi?id=378637#c68</A>
But still the issue persists or I did miss something

Thank you
Regards,


This message contains information that may be privileged or confidential and is the property of the Capgemini Group. It is intended only for the person to whom it is addressed. If you are not the intended recipient, you are not authorized to read, print, retain, copy, disseminate, distribute, or use this message or any part thereof. If you receive this message in error, please notify the sender immediately and delete all copies of this message.
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025307.html">[squid-users] FW: Encrypted browser-Squid connection errors
</A></li>
	<LI>Next message (by thread): <A HREF="025312.html">[squid-users] FW: Encrypted browser-Squid connection errors
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25309">[ date ]</a>
              <a href="thread.html#25309">[ thread ]</a>
              <a href="subject.html#25309">[ subject ]</a>
              <a href="author.html#25309">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
