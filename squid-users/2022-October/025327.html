<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] FW: Encrypted browser-Squid connection errors
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20FW%3A%20Encrypted%20browser-Squid%20connection%20errors&In-Reply-To=%3C7b177298-2613-9215-2a99-b322e8b7c8e0%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025323.html">
   <LINK REL="Next"  HREF="025329.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] FW: Encrypted browser-Squid connection errors</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20FW%3A%20Encrypted%20browser-Squid%20connection%20errors&In-Reply-To=%3C7b177298-2613-9215-2a99-b322e8b7c8e0%40treenet.co.nz%3E"
       TITLE="[squid-users] FW: Encrypted browser-Squid connection errors">squid3 at treenet.co.nz
       </A><BR>
    <I>Sat Oct 22 05:30:09 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025323.html">[squid-users] FW: Encrypted browser-Squid connection errors
</A></li>
        <LI>Next message (by thread): <A HREF="025329.html">[squid-users] FW: Encrypted browser-Squid connection errors
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25327">[ date ]</a>
              <a href="thread.html#25327">[ thread ]</a>
              <a href="subject.html#25327">[ subject ]</a>
              <a href="author.html#25327">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 22/10/22 06:04, Grant Taylor wrote:
&gt;<i> On 10/20/22 11:58 PM, Adam Majer wrote:
</I>&gt;&gt;<i> It's basically by convention now.
</I>&gt;<i> 
</I>&gt;<i> Sure.
</I>&gt;<i> 
</I>&gt;<i> Conventions change over time.
</I>&gt;<i> 
</I>&gt;<i> Long enough ago 3128 wasn't the conventional port for Squid.
</I>&gt;<i> 
</I>
Not just convention. AFAICT was formally registered with W3C, before 
everyone went to using IETF for registrations.




&gt;<i> Maybe, hopefully, said discussion will spark an idea in at least one 
</I>&gt;<i> person's head and that might turn into something in 10 or 20 years.
</I>&gt;<i> 
</I>
FYI, discussion started ~30 years ago.


The problem:

For bandwidth savings HTTP/1.0 defined different URL syntax for origin 
and relay/proxy requests. The form sent to an origin server lacks any 
information about the authority. That was expected to be known 
out-of-band by the origin itself.


HTTP/1.1 has attempted several different mechanisms to fix this over the 
years. None of them has been universally accepted, so the problem 
remains. The best we have is mandatory Host header which most (but sadly 
not all) clients and servers use.


HTTP/2 cements that design with mandatory &quot;:authority&quot; pseudo-header 
field. So the problem is &quot;fixed&quot;for native HTTP/2+ traffic. But until 
HTTP/1.0 and broken HTTP/1.1 clients are all gone the issue will still 
crop up.
  And ... Squid still only supports HTTP/1.1 and older.


&gt;<i> 
</I>&gt;&gt;<i> Forward proxies don't sit on regular server ports because they require 
</I>&gt;&gt;<i> explicit config on the client.
</I>&gt;<i> 
</I>&gt;<i> If we're explicitly configuring the client, then what does the port 
</I>&gt;<i> that's chosen have any influence on the explicit configuration?
</I>

More importantly the proxy hostname:port the client is opening TCP 
connections to may be different from the authority-info specified in the 
HTTP request message (or lack thereof). This crosses security boundaries 
and involves out-of-band information sources at all three endpoints 
involved in the transaction for the message semantics and protocol 
negotiations to work properly.


&gt;<i> 
</I>&gt;<i> Curl's man page is rather convenient and somewhat supportive ~&gt; telling:
</I>&gt;<i> 
</I>&gt;<i> ```
</I>&gt;<i>  &#160;&#160;&#160;&#160;&#160;&#160; Using an environment variable to set the proxy has the same 
</I>&gt;<i> effect as using the -x, --proxy option.
</I>&gt;<i> 
</I>&gt;<i>  &#160;&#160;&#160;&#160;&#160;&#160; http_proxy [<A HREF="protocol://">protocol://</A>]&lt;host&gt;[:port]
</I>&gt;<i>  &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Sets the proxy server to use for HTTP.
</I>&gt;<i> 
</I>&gt;<i>  &#160;&#160;&#160;&#160;&#160;&#160; HTTPS_PROXY [<A HREF="protocol://">protocol://</A>]&lt;host&gt;[:port]
</I>&gt;<i>  &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Sets the proxy server to use for HTTPS.
</I>&gt;<i> ```
</I>&gt;<i> 
</I>&gt;<i> Notice how the `[:port]` is /optional/?
</I>&gt;<i> 
</I>
What that text does not say is that when they are omitted by the 
**user** they are taken from configuration settings in the OS:

  * the environment variable name provides:
     - the protocol name (&quot;http&quot; or &quot;HTTPS&quot;, aka plain-text or encrypted)
     - the expected protocol syntax/semantics (&quot;proxy&quot; aka forward-proxy)

  * the machine /etc/services configuration provides the default port 
for the named protocol.


Attempting to use a reverse-proxy or origin server such a configuration 
may work for some messages, but **will** fail due to syntax or semantic 
errors on others.
  Likewise NAT'ing inbound port 443 or port 80 traffic to a 
forward-proxy will encounter the same types of issues - while it is 
perfectly fine to do so towards a reverse-proxy or origin server.


HTH
Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025323.html">[squid-users] FW: Encrypted browser-Squid connection errors
</A></li>
	<LI>Next message (by thread): <A HREF="025329.html">[squid-users] FW: Encrypted browser-Squid connection errors
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25327">[ date ]</a>
              <a href="thread.html#25327">[ thread ]</a>
              <a href="subject.html#25327">[ subject ]</a>
              <a href="author.html#25327">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
