<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] TCP_MISS only
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TCP_MISS%20only&In-Reply-To=%3Cc580c069-bdae-684c-4cda-6e4792bb0540%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025322.html">
   <LINK REL="Next"  HREF="025330.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] TCP_MISS only</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TCP_MISS%20only&In-Reply-To=%3Cc580c069-bdae-684c-4cda-6e4792bb0540%40treenet.co.nz%3E"
       TITLE="[squid-users] TCP_MISS only">squid3 at treenet.co.nz
       </A><BR>
    <I>Sat Oct 22 06:09:19 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025322.html">[squid-users] TCP_MISS only
</A></li>
        <LI>Next message (by thread): <A HREF="025330.html">[squid-users] Empty transfer-encoding header causes 502 response
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25328">[ date ]</a>
              <a href="thread.html#25328">[ thread ]</a>
              <a href="subject.html#25328">[ subject ]</a>
              <a href="author.html#25328">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 22/10/22 01:50, Andy Armstrong wrote:
&gt;<i> Hi Amos, All,
</I>&gt;<i> 
</I>&gt;<i> I continue to struggle with only receiving TCP_MISS when using 
</I>&gt;<i> squid-cache. I have now implemented a server which is responding to HTTP 
</I>&gt;<i> GETs. I have checked the endpoint with redbot.org and it states that :
</I>&gt;<i> 
</I>&gt;<i> 1/The response allows all caches to store it
</I>&gt;<i> 
</I>&gt;<i> 2/The response is fresh until 7 days from now
</I>&gt;<i> 
</I>&gt;<i> The reason may still be served by a cache once it becomes stale.
</I>&gt;<i> 
</I>&gt;<i> Therefore I believe the server side of this is now valid as a test for 
</I>&gt;<i> squid cache.
</I>&gt;<i> 
</I>
Excellent.


&gt;<i> My client, is routing calls to squidcache, and when it arrives there, I 
</I>&gt;<i> see the following log entry:
</I>&gt;<i> 
</I>&gt;<i> 1666355825.841106 10.1.1.70 TCP_MISS/200 60646 GET 
</I>&gt;<i> <A HREF="http://192.168.20.1:3004/largeapp/largeapp/007005/bongo?">http://192.168.20.1:3004/largeapp/largeapp/007005/bongo?</A> - 
</I>&gt;<i> HIER_DIRECT/192.168.20.1 application/json
</I>&gt;<i> 
</I>
The URL contains a query-string section. That is elided by default for 
security (in case credentials or other sensitive info is in there).

To more accurately test this you should add this to your squid.conf:

   strip_query_terms off

That will log the full query-string for accurate URL checking in 
access.log. You can remove it for the production system later if you want.


If the resulting access.log shows any difference (one single byte is 
enough) between the URLs they are different objects as far as the cache 
can tell.

Are you using the Vary feature of HTTP at all? If so the exact bytes in 
the named client headers matter (both case-sensitive and order-sensitive).



&gt;<i> Infact every single client call I make results in this TCP_MISS.
</I>&gt;<i> 
</I>&gt;<i> I therefore think this may be to do with my squid.conf.
</I>&gt;<i> 
</I>
There does not appear to be anything wrong with your squid.conf.
I suspect some misunderstanding of the HTTP semantics.

...
&gt;<i> 
</I>&gt;<i> refresh_pattern -i http:\/\/192.168.20.1:3001\/.* 10080 100% 43200  
</I>&gt;<i> override-lastmod
</I>&gt;<i> 
</I>&gt;<i> refresh_pattern -i http:\/\/192.168.20.1:3004\/.* 10080 100% 43200  
</I>&gt;<i> override-lastmod
</I>&gt;<i> 
</I>
The redbot.org results indicate that the object is cacheable according 
to the server headers so you should not need these. I do not think they 
are being harmful, but please remove for now to simplify the 
troubleshooting.


Please do the following:

  * add this to squid.conf to see the actual traffic flow in cache.log:

    debug_options ALL,1 11,2

  * make two (2) client requests for the same object. Waiting until the 
server responses have both arrived.

  * check access.log to verify the full URL is indeed identical.

We will need to see the HTTP traffic sequence you should be able to find 
in cache.log. The log entries are multi-line and start with the 
following tags, appearing in this order:

   &quot;HTTP Client REQUEST&quot;
   &quot;HTTP Server REQUEST&quot;
   &quot;HTTP Server RESPONSE&quot;
   &quot;HTTP Client RESPONSE&quot;

Please post the line(s) with that tag and the block of headers that 
follow it.

If any other log lines appear interesting or suspicious, it would be 
helpful to see those too and where exactly in the sequence they appear.


HTH
Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025322.html">[squid-users] TCP_MISS only
</A></li>
	<LI>Next message (by thread): <A HREF="025330.html">[squid-users] Empty transfer-encoding header causes 502 response
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25328">[ date ]</a>
              <a href="thread.html#25328">[ thread ]</a>
              <a href="subject.html#25328">[ subject ]</a>
              <a href="author.html#25328">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
