<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Empty transfer-encoding header causes 502 response
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Empty%20transfer-encoding%20header%20causes%20502%20response&In-Reply-To=%3CCAC-Lcd_Vevs8qfan%3D05fnzLn9aw_KV8kB7FeX7VrOd9zBiRukA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025328.html">
   <LINK REL="Next"  HREF="025337.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Empty transfer-encoding header causes 502 response</H1>
    <B>Matthew H</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Empty%20transfer-encoding%20header%20causes%20502%20response&In-Reply-To=%3CCAC-Lcd_Vevs8qfan%3D05fnzLn9aw_KV8kB7FeX7VrOd9zBiRukA%40mail.gmail.com%3E"
       TITLE="[squid-users] Empty transfer-encoding header causes 502 response">squid at marrold.co.uk
       </A><BR>
    <I>Mon Oct 24 00:36:15 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025328.html">[squid-users] TCP_MISS only
</A></li>
        <LI>Next message (by thread): <A HREF="025337.html">[squid-users] Empty transfer-encoding header causes 502 response
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25330">[ date ]</a>
              <a href="thread.html#25330">[ thread ]</a>
              <a href="subject.html#25330">[ subject ]</a>
              <a href="author.html#25330">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I'm using Squid to proxy HTTP requests to another proxy. I can see squid
sending the request to the parent and getting a response, but it sends the
client that initiated the request a 502 Bad Gateway response.

On closer inspection it appears the parent proxy is sending an
empty transfer-encoding header, and this is causing Squid to send a 502. Is
there any way to ignore this? It looks like its enforced in
HttpHeader.cc#L510
&lt;<A HREF="https://github.com/squid-cache/squid/blob/5139f0f64a4d7bba0d91d631b031c4700e7576b4/src/HttpHeader.cc#L510">https://github.com/squid-cache/squid/blob/5139f0f64a4d7bba0d91d631b031c4700e7576b4/src/HttpHeader.cc#L510</A>&gt;

I'm using Squid 5.6, or more specifically the ubuntu/squid:5.6-22.10_edge
docker image.

I've included the logs below.

Thanks
Matthew

2022/10/24 00:23:59.106| ctx: enter level  0: '<A HREF="http://nintendo.com/">http://nintendo.com/</A>'
2022/10/24 00:23:59.106| 11,3| http.cc(666) processReplyHeader:
processReplyHeader: key '19010000000000000C00000000000000'
2022/10/24 00:23:59.106| 11,2| http.cc(720) processReplyHeader: HTTP Server
conn294 local=172.25.0.3:57802 remote=159.203.14.9:1996 FIRSTUP_PARENT FD
26 flags=1
2022/10/24 00:23:59.106| 11,2| http.cc(721) processReplyHeader: HTTP Server
RESPONSE:
---------
HTTP/1.1 200 OK
x-powered-by: Express
content-type: text/html; charset=iso-8859-1
transfer-encoding:
date: Mon, 24 Oct 2022 00:23:57 GMT
connection: close

----------
2022/10/24 00:23:59.106| 55,3| HttpHeader.cc(882) getList: empty list
header: Transfer-Encoding(Transfer-Encoding[63])
2022/10/24 00:23:59.106| 55,2| HttpHeader.cc(559) parse: WARNING:
unsupported Transfer-Encoding used by client:
2022/10/24 00:23:59.106| ctx: exit level  0
2022/10/24 00:23:59.106| 20,3| store.cc(1673) reset: <A HREF="http://nintendo.com/">http://nintendo.com/</A>
2022/10/24 00:23:59.107| 17,3| FwdState.cc(492) fail: ERR_INVALID_RESP &quot;Bad
Gateway&quot;
        <A HREF="http://nintendo.com/">http://nintendo.com/</A>
2022/10/24 00:23:59.107| 17,3| FwdState.cc(533) unregister:
<A HREF="http://nintendo.com/">http://nintendo.com/</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20221024/4a082b13/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20221024/4a082b13/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025328.html">[squid-users] TCP_MISS only
</A></li>
	<LI>Next message (by thread): <A HREF="025337.html">[squid-users] Empty transfer-encoding header causes 502 response
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25330">[ date ]</a>
              <a href="thread.html#25330">[ thread ]</a>
              <a href="subject.html#25330">[ subject ]</a>
              <a href="author.html#25330">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
