<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid exiting on signal 6
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20exiting%20on%20signal%206&In-Reply-To=%3CCADJd0Y39U8PLW7KLpecpJYxt_V6wUeMJ-%3DSZr9sz1Hm6Rp0R3Q%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025296.html">
   <LINK REL="Next"  HREF="025297.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid exiting on signal 6</H1>
    <B>Andrey K</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20exiting%20on%20signal%206&In-Reply-To=%3CCADJd0Y39U8PLW7KLpecpJYxt_V6wUeMJ-%3DSZr9sz1Hm6Rp0R3Q%40mail.gmail.com%3E"
       TITLE="[squid-users] squid exiting on signal 6">ankor2023 at gmail.com
       </A><BR>
    <I>Mon Oct 24 06:58:38 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025296.html">[squid-users] squid exiting on signal 6
</A></li>
        <LI>Next message (by thread): <A HREF="025297.html">[squid-users] Squid 5.7 + bump ERR_READ_ERROR|WITH_SERVER
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25331">[ date ]</a>
              <a href="thread.html#25331">[ thread ]</a>
              <a href="subject.html#25331">[ subject ]</a>
              <a href="author.html#25331">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello ludovit,

We experienced the similar problems of crashing squid with &quot;signal 6 and
status 0&quot; symptoms in the /var/log/messages. There were hundreds of crashes
per hour during the working hours. There were also many crashes during
night hours. And I had no idea what the cause of the problem was.
But your case shed light on the problem.

I captured network traffic and saw in the dump many requests to IPv6
addresses like this: POST <A HREF="http://[2001:67c:4e8:f004::a">http://[2001:67c:4e8:f004::a</A>]:80/api HTTP/1.1\r\n
I think that the requests were generated by the Telegram application,
because neighboring similar requests were addressed to Telegram IPv4 pools:
POST <A HREF="http://91.105.192.100:80/api">http://91.105.192.100:80/api</A> HTTP/1.1\r\n

To fix the problem somehow, I added the following rules to the very
beginning of the SQUID configuration:
  acl urldst_ipv6 url_regex ^<A HREF="http://\[">http://\[</A>
  http_access deny urldst_ipv6

Now it seems the problem has been solved.

I was wondering if this is a SQUID bug. In my opinion, SQUID should not
crash on requests to IPv6 resources, but should send a response with an
error, for example, Bad gateway 502, or Not Acceptable 406.


Kind regards,
    Ankor.


&#1089;&#1088;, 12 &#1086;&#1082;&#1090;. 2022 &#1075;. &#1074; 15:30, Ludovit Koren &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">ludovit.koren at gmail.com</A>&gt;:

&gt;<i> &gt;&gt;&gt;&gt;&gt; Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; writes:
</I>&gt;<i>
</I>&gt;<i>     &gt; On 12/10/22 21:12, Ludovit Koren wrote:
</I>&gt;<i>     &gt;&gt; Hi,
</I>&gt;<i>     &gt;&gt; I am running squid-5.7 on FreeBSD 12.3-STABLE r371879. Occasionally
</I>&gt;<i>     &gt;&gt; I
</I>&gt;<i>     &gt;&gt; get the following error:
</I>&gt;<i>     &gt;&gt;
</I>&gt;<i>
</I>&gt;<i>     &gt;&gt; #3  0x000000080111fcb1 in __assert (func=&lt;optimized out&gt;,
</I>&gt;<i> file=&lt;optimized out&gt;, line=&lt;optimized out&gt;, failedexpr=&lt;optimized out&gt;) at
</I>&gt;<i> /usr/src/lib/libc/gen/assert.c:51
</I>&gt;<i>     &gt;&gt; #4  0x0000000000698fcd in Ip::Address::getAddrInfo
</I>&gt;<i> (this=0x861c04588, dst=&lt;optimized out&gt;, force=0) at Address.cc:663
</I>&gt;<i>     &gt;&gt; #5  0x000000000068b732 in comm_openex (sock_type=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">sock_type at entry</A>=1,
</I>&gt;<i> proto=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proto at entry</A>=6, addr=..., flags=1, note=0x85ce42dc0
</I>&gt;<i> &quot;[fe80::21f:29ff:fe28:7017]&quot;) at comm.cc:347
</I>&gt;<i>     &gt; ...
</I>&gt;<i>
</I>&gt;<i>     &gt;&gt; The squid is compiled without IPv6 option, so I do not understand
</I>&gt;<i>     &gt;&gt; why it
</I>&gt;<i>     &gt;&gt; tries to reach IPv6 address.
</I>&gt;<i>     &gt;&gt;
</I>&gt;<i>
</I>&gt;<i>     &gt; A client is requiring connection to an IPv6 server. But Squid cannot
</I>&gt;<i>     &gt; convert that IPv6 address or use on an IPv4-only network. Lack of
</I>&gt;<i> IPv6
</I>&gt;<i>     &gt; support also forbids IPv6 failover handling being used.
</I>&gt;<i>
</I>&gt;<i> So the solution is to reenable IPv6 in the squid, as well as in the OS
</I>&gt;<i> network stack? Am I right?
</I>&gt;<i>
</I>&gt;<i> Thank you.
</I>&gt;<i>
</I>&gt;<i> Regards,
</I>&gt;<i>
</I>&gt;<i> lk
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20221024/1a76db40/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20221024/1a76db40/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025296.html">[squid-users] squid exiting on signal 6
</A></li>
	<LI>Next message (by thread): <A HREF="025297.html">[squid-users] Squid 5.7 + bump ERR_READ_ERROR|WITH_SERVER
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25331">[ date ]</a>
              <a href="thread.html#25331">[ thread ]</a>
              <a href="subject.html#25331">[ subject ]</a>
              <a href="author.html#25331">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
