<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] [squid][v5.6] : problem with &quot;slow&quot; or &quot;fast&quot; acl
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%5Bsquid%5D%5Bv5.6%5D%20%3A%20problem%20with%20%22slow%22%20or%20%22fast%22%20acl&In-Reply-To=%3C6315F1FD.5010501%40interieur.gouv.fr%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025168.html">
   <LINK REL="Next"  HREF="025174.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] [squid][v5.6] : problem with &quot;slow&quot; or &quot;fast&quot; acl</H1>
    <B>PERROT Eric DNUM SDCAST BST SSAIM</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%5Bsquid%5D%5Bv5.6%5D%20%3A%20problem%20with%20%22slow%22%20or%20%22fast%22%20acl&In-Reply-To=%3C6315F1FD.5010501%40interieur.gouv.fr%3E"
       TITLE="[squid-users] [squid][v5.6] : problem with &quot;slow&quot; or &quot;fast&quot; acl">eric.perrot at interieur.gouv.fr
       </A><BR>
    <I>Mon Sep  5 12:56:29 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025168.html">[squid-users] squid-users Digest, Vol 97, Issue 2
</A></li>
        <LI>Next message (by thread): <A HREF="025174.html">[squid-users] [squid][v5.6] : problem with &quot;slow&quot; or &quot;fast&quot; acl
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25169">[ date ]</a>
              <a href="thread.html#25169">[ thread ]</a>
              <a href="subject.html#25169">[ subject ]</a>
              <a href="author.html#25169">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

We use directives &quot;reply_body_max_size&quot;, &quot;request_body_max_size&quot; and 
&quot;delay_access&quot; to limit upload, download and passband in our infra.

This configuration existes since a while, but we have noticed that with 
squid v4.16, our delay pool didn't react as we wanted anymore. We were 
excpeting improvment upgrading squid to v5.6. But it got worth :
- restriction still didn't work
- and squid had a segmentation fault each time some acl where used

Thanks to Alex Rousskov (bug 5231), after some investigation, it appears 
that we used &quot;slow&quot; acl (proxy_auth an time acl) where only &quot;fast&quot; acl 
where authorized...). The bug is still open as squid has not flagged the 
problem in cache logs,

My email, is to show you our configuration and the behaviour we espect, 
and the behaviour we finally have.
1 - squd v4.12 : we expect to limit downlod/upload and passband during 
working time for all login except those starting with cg_*
&quot;
|<i>###### Gestion de bande passante ##########
</I>acl bureau time 09:00-12:00
acl bureau time 14:00-17:00
# Comptes generiques
|||<i>acl my_ldap_auth proxy_auth REQUIRED
</I>|<i>acl cgen proxy_auth_regex cg_
</I>reply_body_max_size 800 MB *bureau !cgen*
request_body_max_size 5 MB
# La limite de bande passante ne fonctionne plus avec le BUMP
# A tester ...
delay_pools 1
# Pendant time sauf cgen, emeraude
delay_class 1 4
delay_access 1 allow**||*||my_ldap_auth !cgen||***!emeraude
delay_access 1 deny all
# 512000 = 5120 kbits/user 640 ko
# 307200 = 3072 kbits/user 384 ko
delay_parameters 1 -1/-1 -1/-1 -1/-1 107200/107200
##################################################|
&quot;
=&gt; with this configuration, the delay pool seemed not to work anymore, 
so we upgraded squid to v5.6. Which caused the squid segmentation fault...

2 - squid v5.6 : to solve the segmentation fault, we had to take off 
my_ldap_auth/cgen (proxy_auth acl) and bureau (time acl). The limitation 
work again, but we are no more able to limit restriction during working 
time, or for sp&#233;cific login...
&quot;
|<i>###### Gestion de bande passante ##########
</I>acl bureau time 09:00-12:00
acl bureau time 14:00-17:00
# Comptes generiques
acl userrgt src 10.0.0.0/8
|||<i>acl my_ldap_auth proxy_auth REQUIRED
</I>|<i>acl cgen proxy_auth_regex cg_
</I>reply_body_max_size 800 MB *userrgt*
request_body_max_size 5 MB
# La limite de bande passante ne fonctionne plus avec le BUMP
# A tester ...
delay_pools 1
# Pendant time sauf cgen, emeraude
delay_class 1 4
delay_access 1 allow||*||||***!emeraude
delay_access 1 deny all
# 512000 = 5120 kbits/user 640 ko
# 307200 = 3072 kbits/user 384 ko
delay_parameters 1 -1/-1 -1/-1 -1/-1 107200/107200
##################################################|
&quot;

Can you tell me if what we want to do is still possible? Limiting 
upload/download/passband for all logged user except those starting by 
cg_*..?.

Thank you for the time reading, and thank you for your answers.

Regards,

Eric Perrot




Pour une administration exemplaire, pr&#233;servons l'environnement.
N'imprimons que si n&#233;cessaire.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20220905/d5c31230/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20220905/d5c31230/attachment.htm</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature-perroter.png
Type: image/png
Size: 10699 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20220905/d5c31230/attachment.png">http://lists.squid-cache.org/pipermail/squid-users/attachments/20220905/d5c31230/attachment.png</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025168.html">[squid-users] squid-users Digest, Vol 97, Issue 2
</A></li>
	<LI>Next message (by thread): <A HREF="025174.html">[squid-users] [squid][v5.6] : problem with &quot;slow&quot; or &quot;fast&quot; acl
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25169">[ date ]</a>
              <a href="thread.html#25169">[ thread ]</a>
              <a href="subject.html#25169">[ subject ]</a>
              <a href="author.html#25169">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
