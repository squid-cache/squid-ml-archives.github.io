<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] logfileHandleWrite: daemon:/var/log/squid/access.log: error writing ((32) Broken pipe)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20logfileHandleWrite%3A%0A%20daemon%3A/var/log/squid/access.log%3A%20error%20writing%20%28%2832%29%20Broken%20pipe%29&In-Reply-To=%3C171b0b23-7a59-b420-ac05-fcbdb02a213d%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025172.html">
   <LINK REL="Next"  HREF="025178.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] logfileHandleWrite: daemon:/var/log/squid/access.log: error writing ((32) Broken pipe)</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20logfileHandleWrite%3A%0A%20daemon%3A/var/log/squid/access.log%3A%20error%20writing%20%28%2832%29%20Broken%20pipe%29&In-Reply-To=%3C171b0b23-7a59-b420-ac05-fcbdb02a213d%40measurement-factory.com%3E"
       TITLE="[squid-users] logfileHandleWrite: daemon:/var/log/squid/access.log: error writing ((32) Broken pipe)">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Sep  6 13:28:39 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025172.html">[squid-users] logfileHandleWrite: daemon:/var/log/squid/access.log: error writing ((32) Broken pipe)
</A></li>
        <LI>Next message (by thread): <A HREF="025178.html">[squid-users] logfileHandleWrite: daemon:/var/log/squid/access.log: error writing ((32) Broken pipe)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25173">[ date ]</a>
              <a href="thread.html#25173">[ thread ]</a>
              <a href="subject.html#25173">[ subject ]</a>
              <a href="author.html#25173">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 9/6/22 07:41, roee klinger wrote:

&gt;<i> It is also important to know that I am running multiple Squid instances 
</I>&gt;<i> on the same machine, they are all getting the error at the same time
</I>
What external event(s) happen at that time? Something is probably 
sending a signal to the logging daemon process. It would be good to know 
what that something (and that signal) is. Your syslog or cache.log might 
contain more info. Analyzing the timing/schedule of these problems may 
also be helpful in identifying the trigger.


&gt;<i> Is a possible workaround that might be just replacing the line with 
</I>&gt;<i> this? 
</I>
 &gt; access_log /var/log/squid/access2.log

As you know, this configuration (in this deprecated spelling or with and 
explicit &quot;stdio:&quot; prefix) will result in Squid workers writing to the 
log file directly instead of asking the logging daemon. This will, 
naturally, get rid of the pipe between workers and their daemons, and 
the associated broken pipe error.

&gt;<i> or will this cause a problem?
</I>
Impossible to say for sure without knowing whether your workers benefit 
from the anticipated performance advantages of avoiding blocking file 
I/O _and_ whether those advantages are real (in your environment). Too 
many variables and too many unknowns. I would treat this as an important 
(and potentially disruptive) configuration change and carefully test the 
outcome.


HTH,

Alex.


&gt;<i> INFO -
</I>&gt;<i> Versions:
</I>&gt;<i> 
</I>&gt;<i>     Squid Cache: Version 4.10
</I>&gt;<i>     Ubuntu 20.04.4 LTS
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Example squid.conf:
</I>&gt;<i> 
</I>&gt;<i>     visible_hostname squid2
</I>&gt;<i> 
</I>&gt;<i>     access_log daemon:/var/log/squid/access2.log squid
</I>&gt;<i> 
</I>&gt;<i>     cache_log /var/log/squid/cache2.log
</I>&gt;<i> 
</I>&gt;<i>     pid_filename /var/run/squid2.pid
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     acl localnet src 0.0.0.1-0.255.255.255# RFC 1122 &quot;this&quot; network (LAN)
</I>&gt;<i> 
</I>&gt;<i>     acl localnet src 10.0.0.0/8 &lt;<A HREF="http://10.0.0.0/8">http://10.0.0.0/8</A>&gt; # RFC 1918 local
</I>&gt;<i>     private network (LAN)
</I>&gt;<i> 
</I>&gt;<i>     acl localnet src 100.64.0.0/10 &lt;<A HREF="http://100.64.0.0/10">http://100.64.0.0/10</A>&gt;# RFC 6598
</I>&gt;<i>     shared address space (CGN)
</I>&gt;<i> 
</I>&gt;<i>     acl localnet src 169.254.0.0/16 &lt;<A HREF="http://169.254.0.0/16">http://169.254.0.0/16</A>&gt; # RFC 3927
</I>&gt;<i>     link-local (directly plugged) machines
</I>&gt;<i> 
</I>&gt;<i>     acl localnet src 172.16.0.0/12 &lt;<A HREF="http://172.16.0.0/12">http://172.16.0.0/12</A>&gt;# RFC 1918
</I>&gt;<i>     local private network (LAN)
</I>&gt;<i> 
</I>&gt;<i>     acl localnet src 192.168.0.0/16 &lt;<A HREF="http://192.168.0.0/16">http://192.168.0.0/16</A>&gt; # RFC 1918
</I>&gt;<i>     local private network (LAN)
</I>&gt;<i> 
</I>&gt;<i>     acl localnet src fc00::/7 # RFC 4193 local private network range
</I>&gt;<i> 
</I>&gt;<i>     acl localnet src fe80::/10# RFC 4291 link-local (directly plugged)
</I>&gt;<i>     machines
</I>&gt;<i> 
</I>&gt;<i>     acl SSL_ports port 443
</I>&gt;<i> 
</I>&gt;<i>     acl Safe_ports port 80# http
</I>&gt;<i> 
</I>&gt;<i>     acl Safe_ports port 21# ftp
</I>&gt;<i> 
</I>&gt;<i>     acl Safe_ports port 443 # https
</I>&gt;<i> 
</I>&gt;<i>     acl Safe_ports port 70# gopher
</I>&gt;<i> 
</I>&gt;<i>     acl Safe_ports port 210 # wais
</I>&gt;<i> 
</I>&gt;<i>     acl Safe_ports port 1025-65535# unregistered ports
</I>&gt;<i> 
</I>&gt;<i>     acl Safe_ports port 280 # http-mgmt
</I>&gt;<i> 
</I>&gt;<i>     acl Safe_ports port 488 # gss-http
</I>&gt;<i> 
</I>&gt;<i>     acl Safe_ports port 591 # filemaker
</I>&gt;<i> 
</I>&gt;<i>     acl Safe_ports port 777 # multiling http
</I>&gt;<i> 
</I>&gt;<i>     acl CONNECT method CONNECT
</I>&gt;<i> 
</I>&gt;<i>     http_access deny !Safe_ports
</I>&gt;<i> 
</I>&gt;<i>     http_access deny CONNECT !SSL_ports
</I>&gt;<i> 
</I>&gt;<i>     http_access allow localhost manager
</I>&gt;<i> 
</I>&gt;<i>     http_access deny manager
</I>&gt;<i> 
</I>&gt;<i>     # include /etc/squid/conf.d/*
</I>&gt;<i> 
</I>&gt;<i>     http_access allow localhost
</I>&gt;<i> 
</I>&gt;<i>     acl aws src *censored*
</I>&gt;<i> 
</I>&gt;<i>     http_access allow aws
</I>&gt;<i> 
</I>&gt;<i>     # http_access deny all
</I>&gt;<i> 
</I>&gt;<i>     tcp_outgoing_address *censored*
</I>&gt;<i> 
</I>&gt;<i>     http_port 10002
</I>&gt;<i> 
</I>&gt;<i>     coredump_dir /var/spool/squid
</I>&gt;<i> 
</I>&gt;<i>     refresh_pattern ^ftp: 144020% 10080
</I>&gt;<i> 
</I>&gt;<i>     refresh_pattern ^gopher:14400%1440
</I>&gt;<i> 
</I>&gt;<i>     refresh_pattern -i (/cgi-bin/|\?) 0 0%0
</I>&gt;<i> 
</I>&gt;<i>     refresh_pattern \/(Packages|Sources)(|\.bz2|\.gz|\.xz)$ 0 0% 0
</I>&gt;<i>     refresh-ims
</I>&gt;<i> 
</I>&gt;<i>     refresh_pattern \/Release(|\.gpg)$ 0 0% 0 refresh-ims
</I>&gt;<i> 
</I>&gt;<i>     refresh_pattern \/InRelease$ 0 0% 0 refresh-ims
</I>&gt;<i> 
</I>&gt;<i>     refresh_pattern \/(Translation-.*)(|\.bz2|\.gz|\.xz)$ 0 0% 0 refresh-ims
</I>&gt;<i> 
</I>&gt;<i>     refresh_pattern . 0 20% 4320
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     shutdown_lifetime 1 seconds
</I>&gt;<i> 
</I>&gt;<i>     logfile_rotate 0
</I>&gt;<i> 
</I>&gt;<i>     max_filedescriptors 16384
</I>&gt;<i> 
</I>&gt;<i>     dns_nameservers 8.8.8.8 8.8.4.4 1.1.1.1
</I>&gt;<i> 
</I>&gt;<i>     cache deny all
</I>&gt;<i> 
</I>&gt;<i>     cache_dir null /tmp
</I>&gt;<i> 
</I>&gt;<i>     via off
</I>&gt;<i> 
</I>&gt;<i>     forwarded_for off
</I>&gt;<i> 
</I>&gt;<i>     request_header_access From deny all
</I>&gt;<i> 
</I>&gt;<i>     request_header_access Server deny all
</I>&gt;<i> 
</I>&gt;<i>     request_header_access WWW-Authenticate deny all
</I>&gt;<i> 
</I>&gt;<i>     request_header_access Link deny all
</I>&gt;<i> 
</I>&gt;<i>     request_header_access Cache-Control deny all
</I>&gt;<i> 
</I>&gt;<i>     request_header_access Proxy-Connection deny all
</I>&gt;<i> 
</I>&gt;<i>     request_header_access X-Cache deny all
</I>&gt;<i> 
</I>&gt;<i>     request_header_access X-Cache-Lookup deny all
</I>&gt;<i> 
</I>&gt;<i>     request_header_access Via deny all
</I>&gt;<i> 
</I>&gt;<i>     request_header_access X-Forwarded-For deny all
</I>&gt;<i> 
</I>&gt;<i>     request_header_access Pragma deny all
</I>&gt;<i> 
</I>&gt;<i>     request_header_access Keep-Alive deny all
</I>&gt;<i> 
</I>&gt;<i>     dns_v4_first on
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Example&#160;service file:
</I>&gt;<i> 
</I>&gt;<i>     ## Copyright (C) 1996-2020 The Squid Software Foundation and
</I>&gt;<i>     contributors
</I>&gt;<i> 
</I>&gt;<i>     ##
</I>&gt;<i> 
</I>&gt;<i>     ## Squid software is distributed under GPLv2+ license and includes
</I>&gt;<i> 
</I>&gt;<i>     ## contributions from numerous individuals and organizations.
</I>&gt;<i> 
</I>&gt;<i>     ## Please see the COPYING and CONTRIBUTORS files for details.
</I>&gt;<i> 
</I>&gt;<i>     ##
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     [Unit]
</I>&gt;<i> 
</I>&gt;<i>     Description=Squid Web Proxy Server
</I>&gt;<i> 
</I>&gt;<i>     Documentation=man:squid(8)
</I>&gt;<i> 
</I>&gt;<i>     After=network.target network-online.target nss-lookup.target
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     [Service]
</I>&gt;<i> 
</I>&gt;<i>     Type=forking
</I>&gt;<i> 
</I>&gt;<i>     PIDFile=/var/run/squid2.pid
</I>&gt;<i> 
</I>&gt;<i>     ExecStartPre=/usr/sbin/squid --foreground -z -f /etc/squid/squid2.conf
</I>&gt;<i> 
</I>&gt;<i>     ExecStart=/usr/sbin/squid -sYC -f /etc/squid/squid2.conf
</I>&gt;<i> 
</I>&gt;<i>     ExecReload=/bin/kill -HUP $MAINPID
</I>&gt;<i> 
</I>&gt;<i>     KillMode=mixed
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     [Install]
</I>&gt;<i> 
</I>&gt;<i>     WantedBy=multi-user.target
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Permissions:
</I>&gt;<i> 
</I>&gt;<i>     &#10140;&#160; ls -alt /etc/squid/
</I>&gt;<i>     total 128
</I>&gt;<i>     drwxr-xr-x &#160; 2 root root 4096 Sep &#160;6 11:33 .
</I>&gt;<i>     -rw-r--r-- &#160; 1 root root 2831 Sep &#160;6 11:33 squid7.conf
</I>&gt;<i>     drwxr-xr-x 116 root root 4096 Sep &#160;6 11:33 ..
</I>&gt;<i>     -rw-r--r-- &#160; 1 root root 2830 Sep &#160;6 11:33 squid2.conf
</I>&gt;<i>     -rw-r--r-- &#160; 1 root root 2836 Sep &#160;6 11:33 squid13.conf
</I>&gt;<i>     -rw-r--r-- &#160; 1 root root 2836 Sep &#160;6 11:32 squid23.conf
</I>&gt;<i>     -rw-r--r-- &#160; 1 root root 2836 Sep &#160;6 11:32 squid19.conf
</I>&gt;<i>     -rw-r--r-- &#160; 1 root root 2832 Sep &#160;6 11:32 squid1.conf
</I>&gt;<i>     -rw-r--r-- &#160; 1 root root 2836 Sep &#160;6 11:32 squid17.conf
</I>&gt;<i>     -rw-r--r-- &#160; 1 root root 2832 Sep &#160;6 11:31 squid4.conf
</I>&gt;<i>     -rw-r--r-- &#160; 1 root root 2834 Sep &#160;6 11:31 squid21.conf
</I>&gt;<i>     -rw-r--r-- &#160; 1 root root 2833 Sep &#160;6 11:31 squid25.conf
</I>&gt;<i>     -rw-r--r-- &#160; 1 root root 2834 Sep &#160;6 11:31 squid12.conf
</I>&gt;<i>     -rw-r--r-- &#160; 1 root root 2832 Sep &#160;6 11:31 squid3.conf
</I>&gt;<i>     -rw-r--r-- &#160; 1 root root 2836 Sep &#160;6 11:30 squid10.conf
</I>&gt;<i>     -rw-r--r-- &#160; 1 root root 2835 Sep &#160;6 11:30 squid11.conf
</I>&gt;<i>     -rw-r--r-- &#160; 1 root root 2833 Sep &#160;6 11:30 squid18.conf
</I>&gt;<i>     -rw-r--r-- &#160; 1 root root 2830 Sep &#160;6 11:30 squid8.conf
</I>&gt;<i>     -rw-r--r-- &#160; 1 root root 2830 Sep &#160;6 11:30 squid6.conf
</I>&gt;<i>     -rw-r--r-- &#160; 1 root root 2833 Sep &#160;6 11:30 squid28.conf
</I>&gt;<i>     -rw-r--r-- &#160; 1 root root 2830 Sep &#160;6 11:25 squid9.conf
</I>&gt;<i>     -rw-r--r-- &#160; 1 root root 2836 Sep &#160;6 11:25 squid24.conf
</I>&gt;<i>     -rw-r--r-- &#160; 1 root root 2835 Sep &#160;6 11:25 squid22.conf
</I>&gt;<i>     -rw-r--r-- &#160; 1 root root 2837 Sep &#160;6 11:25 squid20.conf
</I>&gt;<i>     -rw-r--r-- &#160; 1 root root 2836 Sep &#160;6 11:25 squid16.conf
</I>&gt;<i>     -rw-r--r-- &#160; 1 root root 2835 Sep &#160;6 11:25 squid15.conf
</I>&gt;<i>     -rw-r--r-- &#160; 1 root root 2836 Sep &#160;6 11:25 squid14.conf
</I>&gt;<i>     -rw-r--r-- &#160; 1 root root 2831 Sep &#160;6 11:25 squid5.conf
</I>&gt;<i>     -rw-r--r-- &#160; 1 root root 2833 Sep &#160;6 11:25 squid27.conf
</I>&gt;<i>     -rw-r--r-- &#160; 1 root root 2835 Sep &#160;6 11:25 squid26.conf
</I>&gt;<i>     -rw-r--r-- &#160; 1 root root 2835 Sep &#160;6 11:25 squid30.conf
</I>&gt;<i>     -rw-r--r-- &#160; 1 root root 2835 Sep &#160;6 11:25 squid29.conf
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025172.html">[squid-users] logfileHandleWrite: daemon:/var/log/squid/access.log: error writing ((32) Broken pipe)
</A></li>
	<LI>Next message (by thread): <A HREF="025178.html">[squid-users] logfileHandleWrite: daemon:/var/log/squid/access.log: error writing ((32) Broken pipe)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25173">[ date ]</a>
              <a href="thread.html#25173">[ thread ]</a>
              <a href="subject.html#25173">[ subject ]</a>
              <a href="author.html#25173">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
