<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] [squid][v5.6] : problem with &quot;slow&quot; or &quot;fast&quot; acl
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%5Bsquid%5D%5Bv5.6%5D%20%3A%20problem%20with%20%22slow%22%20or%20%22fast%22%20acl&In-Reply-To=%3C33020e46-99dc-d860-324b-30da97991049%40articatech.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025169.html">
   <LINK REL="Next"  HREF="025175.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] [squid][v5.6] : problem with &quot;slow&quot; or &quot;fast&quot; acl</H1>
    <B>David Touzeau</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%5Bsquid%5D%5Bv5.6%5D%20%3A%20problem%20with%20%22slow%22%20or%20%22fast%22%20acl&In-Reply-To=%3C33020e46-99dc-d860-324b-30da97991049%40articatech.com%3E"
       TITLE="[squid-users] [squid][v5.6] : problem with &quot;slow&quot; or &quot;fast&quot; acl">david at articatech.com
       </A><BR>
    <I>Tue Sep  6 15:45:08 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025169.html">[squid-users] [squid][v5.6] : problem with &quot;slow&quot; or &quot;fast&quot; acl
</A></li>
        <LI>Next message (by thread): <A HREF="025175.html">[squid-users] [squid][v5.6] : problem with &quot;slow&quot; or &quot;fast&quot; acl
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25174">[ date ]</a>
              <a href="thread.html#25174">[ thread ]</a>
              <a href="subject.html#25174">[ subject ]</a>
              <a href="author.html#25174">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Eric.

We had the same restrictions with the fast or slow ACLs.
Have you thought about creating a squid helper that calculates your needs?
So maybe you can get around this by using the acl &quot;note&quot; acl note xxx 
xxx which turns your helper results (slow) into &quot;fast&quot;.



Le 05/09/2022 &#224; 14:56, PERROT Eric DNUM SDCAST BST SSAIM a &#233;crit&#160;:
&gt;<i> Hello,
</I>&gt;<i>
</I>&gt;<i> We use directives &quot;reply_body_max_size&quot;, &quot;request_body_max_size&quot; and 
</I>&gt;<i> &quot;delay_access&quot; to limit upload, download and passband in our infra.
</I>&gt;<i>
</I>&gt;<i> This configuration existes since a while, but we have noticed that 
</I>&gt;<i> with squid v4.16, our delay pool didn't react as we wanted anymore. We 
</I>&gt;<i> were excpeting improvment upgrading squid to v5.6. But it got worth :
</I>&gt;<i> - restriction still didn't work
</I>&gt;<i> - and squid had a segmentation fault each time some acl where used
</I>&gt;<i>
</I>&gt;<i> Thanks to Alex Rousskov (bug 5231), after some investigation, it 
</I>&gt;<i> appears that we used &quot;slow&quot; acl (proxy_auth an time acl) where only 
</I>&gt;<i> &quot;fast&quot; acl where authorized...). The bug is still open as squid has 
</I>&gt;<i> not flagged the problem in cache logs,
</I>&gt;<i>
</I>&gt;<i> My email, is to show you our configuration and the behaviour we 
</I>&gt;<i> espect, and the behaviour we finally have.
</I>&gt;<i> 1 - squd v4.12 : we expect to limit downlod/upload and passband during 
</I>&gt;<i> working time for all login except those starting with cg_*
</I>&gt;<i> &quot;
</I>&gt;<i> |###### Gestion de bande passante ##########
</I>&gt;<i> acl bureau time 09:00-12:00
</I>&gt;<i> acl bureau time 14:00-17:00
</I>&gt;<i> # Comptes generiques
</I>&gt;<i> |||acl my_ldap_auth proxy_auth REQUIRED
</I>&gt;<i> |acl cgen proxy_auth_regex cg_
</I>&gt;<i> reply_body_max_size 800 MB *bureau !cgen*
</I>&gt;<i> request_body_max_size 5 MB
</I>&gt;<i> # La limite de bande passante ne fonctionne plus avec le BUMP
</I>&gt;<i> # A tester ...
</I>&gt;<i> delay_pools 1
</I>&gt;<i> # Pendant time sauf cgen, emeraude
</I>&gt;<i> delay_class 1 4
</I>&gt;<i> delay_access 1 allow**||*||my_ldap_auth !cgen||***!emeraude
</I>&gt;<i> delay_access 1 deny all
</I>&gt;<i> # 512000 = 5120 kbits/user 640 ko
</I>&gt;<i> # 307200 = 3072 kbits/user 384 ko
</I>&gt;<i> delay_parameters 1 -1/-1 -1/-1 -1/-1 107200/107200
</I>&gt;<i> ##################################################|
</I>&gt;<i> &quot;
</I>&gt;<i> =&gt; with this configuration, the delay pool seemed not to work anymore, 
</I>&gt;<i> so we upgraded squid to v5.6. Which caused the squid segmentation 
</I>&gt;<i> fault...
</I>&gt;<i>
</I>&gt;<i> 2 - squid v5.6 : to solve the segmentation fault, we had to take off 
</I>&gt;<i> my_ldap_auth/cgen (proxy_auth acl) and bureau (time acl). The 
</I>&gt;<i> limitation work again, but we are no more able to limit restriction 
</I>&gt;<i> during working time, or for sp&#233;cific login...
</I>&gt;<i> &quot;
</I>&gt;<i> |###### Gestion de bande passante ##########
</I>&gt;<i> acl bureau time 09:00-12:00
</I>&gt;<i> acl bureau time 14:00-17:00
</I>&gt;<i> # Comptes generiques
</I>&gt;<i> acl userrgt src 10.0.0.0/8
</I>&gt;<i> |||acl my_ldap_auth proxy_auth REQUIRED
</I>&gt;<i> |acl cgen proxy_auth_regex cg_
</I>&gt;<i> reply_body_max_size 800 MB *userrgt*
</I>&gt;<i> request_body_max_size 5 MB
</I>&gt;<i> # La limite de bande passante ne fonctionne plus avec le BUMP
</I>&gt;<i> # A tester ...
</I>&gt;<i> delay_pools 1
</I>&gt;<i> # Pendant time sauf cgen, emeraude
</I>&gt;<i> delay_class 1 4
</I>&gt;<i> delay_access 1 allow||*||||***!emeraude
</I>&gt;<i> delay_access 1 deny all
</I>&gt;<i> # 512000 = 5120 kbits/user 640 ko
</I>&gt;<i> # 307200 = 3072 kbits/user 384 ko
</I>&gt;<i> delay_parameters 1 -1/-1 -1/-1 -1/-1 107200/107200
</I>&gt;<i> ##################################################|
</I>&gt;<i> &quot;
</I>&gt;<i>
</I>&gt;<i> Can you tell me if what we want to do is still possible? Limiting 
</I>&gt;<i> upload/download/passband for all logged user except those starting by 
</I>&gt;<i> cg_*..?.
</I>&gt;<i>
</I>&gt;<i> Thank you for the time reading, and thank you for your answers.
</I>&gt;<i>
</I>&gt;<i> Regards,
</I>&gt;<i>
</I>&gt;<i> Eric Perrot
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Pour une administration exemplaire, pr&#233;servons l'environnement.
</I>&gt;<i> N'imprimons que si n&#233;cessaire.
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>-- 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20220906/0c569514/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20220906/0c569514/attachment.htm</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature-perroter.png
Type: image/png
Size: 10699 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20220906/0c569514/attachment.png">http://lists.squid-cache.org/pipermail/squid-users/attachments/20220906/0c569514/attachment.png</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025169.html">[squid-users] [squid][v5.6] : problem with &quot;slow&quot; or &quot;fast&quot; acl
</A></li>
	<LI>Next message (by thread): <A HREF="025175.html">[squid-users] [squid][v5.6] : problem with &quot;slow&quot; or &quot;fast&quot; acl
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25174">[ date ]</a>
              <a href="thread.html#25174">[ thread ]</a>
              <a href="subject.html#25174">[ subject ]</a>
              <a href="author.html#25174">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
