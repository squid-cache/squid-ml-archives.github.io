<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] logfileHandleWrite: daemon:/var/log/squid/access.log: error writing ((32) Broken pipe)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20logfileHandleWrite%3A%0A%20daemon%3A/var/log/squid/access.log%3A%20error%20writing%20%28%2832%29%20Broken%20pipe%29&In-Reply-To=%3C3dce10cb-9ed3-4176-bc70-5763ff9f7c67%40Spark%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025173.html">
   <LINK REL="Next"  HREF="025179.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] logfileHandleWrite: daemon:/var/log/squid/access.log: error writing ((32) Broken pipe)</H1>
    <B>roee klinger</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20logfileHandleWrite%3A%0A%20daemon%3A/var/log/squid/access.log%3A%20error%20writing%20%28%2832%29%20Broken%20pipe%29&In-Reply-To=%3C3dce10cb-9ed3-4176-bc70-5763ff9f7c67%40Spark%3E"
       TITLE="[squid-users] logfileHandleWrite: daemon:/var/log/squid/access.log: error writing ((32) Broken pipe)">roeeklinger60 at gmail.com
       </A><BR>
    <I>Tue Sep  6 22:02:53 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025173.html">[squid-users] logfileHandleWrite: daemon:/var/log/squid/access.log: error writing ((32) Broken pipe)
</A></li>
        <LI>Next message (by thread): <A HREF="025179.html">[squid-users] logfileHandleWrite: daemon:/var/log/squid/access.log: error writing ((32) Broken pipe)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25178">[ date ]</a>
              <a href="thread.html#25178">[ thread ]</a>
              <a href="subject.html#25178">[ subject ]</a>
              <a href="author.html#25178">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey Alex,

Thank you for your reply.
&gt;<i> Your syslog or cache.log might
</I>&gt;<i> contain more info. Analyzing the timing/schedule of these problems may
</I>&gt;<i> also be helpful in identifying the trigger.
</I>
After following this advice, I could easily see that this happens due to disk space running out on my server,
it seems that the logs has filled over 100GB of log data, since I made a configuration mistake (I think?) by setting this:
&gt;<i> quote_type
</I>&gt;<i> logfile_rotate 0
</I>&gt;<i>
</I>If I remember and read correctly, this means that the rotation of the files is disabled and they will just keeping increasing
in size if left unchecked.

I have now gone ahead and changed all the configuration file to this setting:
&gt;<i> quote_type
</I>&gt;<i> logfile_rotate 1
</I>&gt;<i>
</I>So now it should rotate once daily, and on the next rotation it should be deleted, and this is all handled by logrotate on Debian-based machines?

This is my / cat /etc/logrotate.d/squid:
&#10140; / cat /etc/logrotate.d/squid
#
# Logrotate fragment for squid.
#
/var/log/squid/*.log {
&#160;daily
&#160;compress
&#160;delaycompress
&#160;rotate 2
&#160;missingok
&#160;nocreate
&#160;sharedscripts
&#160;prerotate
&#160;test ! -x /usr/sbin/sarg-reports || /usr/sbin/sarg-reports daily
&#160;endscript
&#160;postrotate
&#160;test ! -e /var/run/squid.pid || test ! -x /usr/sbin/squid || /usr/sbin/squid -k rotate
&#160;endscript
}

Is there a way for me to set it so it just get deleted every 24 or 12 hours without the archive first?

Thanks,
Roee
On 6 Sep 2022, 16:28 +0300, Alex Rousskov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt;, wrote:
&gt;<i> On 9/6/22 07:41, roee klinger wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; It is also important to know that I am running multiple Squid instances
</I>&gt;<i> &gt; on the same machine, they are all getting the error at the same time
</I>&gt;<i>
</I>&gt;<i> What external event(s) happen at that time? Something is probably
</I>&gt;<i> sending a signal to the logging daemon process. It would be good to know
</I>&gt;<i> what that something (and that signal) is. Your syslog or cache.log might
</I>&gt;<i> contain more info. Analyzing the timing/schedule of these problems may
</I>&gt;<i> also be helpful in identifying the trigger.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; Is a possible workaround that might be just replacing the line with
</I>&gt;<i> &gt; this?
</I>&gt;<i>
</I>&gt;<i> &gt; access_log /var/log/squid/access2.log
</I>&gt;<i>
</I>&gt;<i> As you know, this configuration (in this deprecated spelling or with and
</I>&gt;<i> explicit &quot;stdio:&quot; prefix) will result in Squid workers writing to the
</I>&gt;<i> log file directly instead of asking the logging daemon. This will,
</I>&gt;<i> naturally, get rid of the pipe between workers and their daemons, and
</I>&gt;<i> the associated broken pipe error.
</I>&gt;<i>
</I>&gt;<i> &gt; or will this cause a problem?
</I>&gt;<i>
</I>&gt;<i> Impossible to say for sure without knowing whether your workers benefit
</I>&gt;<i> from the anticipated performance advantages of avoiding blocking file
</I>&gt;<i> I/O _and_ whether those advantages are real (in your environment). Too
</I>&gt;<i> many variables and too many unknowns. I would treat this as an important
</I>&gt;<i> (and potentially disruptive) configuration change and carefully test the
</I>&gt;<i> outcome.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> HTH,
</I>&gt;<i>
</I>&gt;<i> Alex.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; INFO -
</I>&gt;<i> &gt; Versions:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Squid Cache: Version 4.10
</I>&gt;<i> &gt; Ubuntu 20.04.4 LTS
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Example squid.conf:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; visible_hostname squid2
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; access_log daemon:/var/log/squid/access2.log squid
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; cache_log /var/log/squid/cache2.log
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; pid_filename /var/run/squid2.pid
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; acl localnet src 0.0.0.1-0.255.255.255# RFC 1122 &quot;this&quot; network (LAN)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; acl localnet src 10.0.0.0/8 &lt;<A HREF="http://10.0.0.0/8">http://10.0.0.0/8</A>&gt; # RFC 1918 local
</I>&gt;<i> &gt; private network (LAN)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; acl localnet src 100.64.0.0/10 &lt;<A HREF="http://100.64.0.0/10">http://100.64.0.0/10</A>&gt;# RFC 6598
</I>&gt;<i> &gt; shared address space (CGN)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; acl localnet src 169.254.0.0/16 &lt;<A HREF="http://169.254.0.0/16">http://169.254.0.0/16</A>&gt; # RFC 3927
</I>&gt;<i> &gt; link-local (directly plugged) machines
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; acl localnet src 172.16.0.0/12 &lt;<A HREF="http://172.16.0.0/12">http://172.16.0.0/12</A>&gt;# RFC 1918
</I>&gt;<i> &gt; local private network (LAN)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; acl localnet src 192.168.0.0/16 &lt;<A HREF="http://192.168.0.0/16">http://192.168.0.0/16</A>&gt; # RFC 1918
</I>&gt;<i> &gt; local private network (LAN)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; acl localnet src fc00::/7 # RFC 4193 local private network range
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; acl localnet src fe80::/10# RFC 4291 link-local (directly plugged)
</I>&gt;<i> &gt; machines
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; acl SSL_ports port 443
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; acl Safe_ports port 80# http
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; acl Safe_ports port 21# ftp
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; acl Safe_ports port 443 # https
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; acl Safe_ports port 70# gopher
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; acl Safe_ports port 210 # wais
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; acl Safe_ports port 1025-65535# unregistered ports
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; acl Safe_ports port 280 # http-mgmt
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; acl Safe_ports port 488 # gss-http
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; acl Safe_ports port 591 # filemaker
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; acl Safe_ports port 777 # multiling http
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; acl CONNECT method CONNECT
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; http_access deny !Safe_ports
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; http_access deny CONNECT !SSL_ports
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; http_access allow localhost manager
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; http_access deny manager
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; # include /etc/squid/conf.d/*
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; http_access allow localhost
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; acl aws src *censored*
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; http_access allow aws
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; # http_access deny all
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; tcp_outgoing_address *censored*
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; http_port 10002
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; coredump_dir /var/spool/squid
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; refresh_pattern ^ftp: 144020% 10080
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; refresh_pattern ^gopher:14400%1440
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; refresh_pattern -i (/cgi-bin/|\?) 0 0%0
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; refresh_pattern \/(Packages|Sources)(|\.bz2|\.gz|\.xz)$ 0 0% 0
</I>&gt;<i> &gt; refresh-ims
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; refresh_pattern \/Release(|\.gpg)$ 0 0% 0 refresh-ims
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; refresh_pattern \/InRelease$ 0 0% 0 refresh-ims
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; refresh_pattern \/(Translation-.*)(|\.bz2|\.gz|\.xz)$ 0 0% 0 refresh-ims
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; refresh_pattern . 0 20% 4320
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; shutdown_lifetime 1 seconds
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; logfile_rotate 0
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; max_filedescriptors 16384
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; dns_nameservers 8.8.8.8 8.8.4.4 1.1.1.1
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; cache deny all
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; cache_dir null /tmp
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; via off
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; forwarded_for off
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; request_header_access From deny all
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; request_header_access Server deny all
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; request_header_access WWW-Authenticate deny all
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; request_header_access Link deny all
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; request_header_access Cache-Control deny all
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; request_header_access Proxy-Connection deny all
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; request_header_access X-Cache deny all
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; request_header_access X-Cache-Lookup deny all
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; request_header_access Via deny all
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; request_header_access X-Forwarded-For deny all
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; request_header_access Pragma deny all
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; request_header_access Keep-Alive deny all
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; dns_v4_first on
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Example&#160;service file:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ## Copyright (C) 1996-2020 The Squid Software Foundation and
</I>&gt;<i> &gt; contributors
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ##
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ## Squid software is distributed under GPLv2+ license and includes
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ## contributions from numerous individuals and organizations.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ## Please see the COPYING and CONTRIBUTORS files for details.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ##
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; [Unit]
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Description=Squid Web Proxy Server
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Documentation=man:squid(8)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; After=network.target network-online.target nss-lookup.target
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; [Service]
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Type=forking
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; PIDFile=/var/run/squid2.pid
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ExecStartPre=/usr/sbin/squid --foreground -z -f /etc/squid/squid2.conf
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ExecStart=/usr/sbin/squid -sYC -f /etc/squid/squid2.conf
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ExecReload=/bin/kill -HUP $MAINPID
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; KillMode=mixed
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; [Install]
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; WantedBy=multi-user.target
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Permissions:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &#10140;&#160; ls -alt /etc/squid/
</I>&gt;<i> &gt; total 128
</I>&gt;<i> &gt; drwxr-xr-x &#160; 2 root root 4096 Sep &#160;6 11:33 .
</I>&gt;<i> &gt; -rw-r--r-- &#160; 1 root root 2831 Sep &#160;6 11:33 squid7.conf
</I>&gt;<i> &gt; drwxr-xr-x 116 root root 4096 Sep &#160;6 11:33 ..
</I>&gt;<i> &gt; -rw-r--r-- &#160; 1 root root 2830 Sep &#160;6 11:33 squid2.conf
</I>&gt;<i> &gt; -rw-r--r-- &#160; 1 root root 2836 Sep &#160;6 11:33 squid13.conf
</I>&gt;<i> &gt; -rw-r--r-- &#160; 1 root root 2836 Sep &#160;6 11:32 squid23.conf
</I>&gt;<i> &gt; -rw-r--r-- &#160; 1 root root 2836 Sep &#160;6 11:32 squid19.conf
</I>&gt;<i> &gt; -rw-r--r-- &#160; 1 root root 2832 Sep &#160;6 11:32 squid1.conf
</I>&gt;<i> &gt; -rw-r--r-- &#160; 1 root root 2836 Sep &#160;6 11:32 squid17.conf
</I>&gt;<i> &gt; -rw-r--r-- &#160; 1 root root 2832 Sep &#160;6 11:31 squid4.conf
</I>&gt;<i> &gt; -rw-r--r-- &#160; 1 root root 2834 Sep &#160;6 11:31 squid21.conf
</I>&gt;<i> &gt; -rw-r--r-- &#160; 1 root root 2833 Sep &#160;6 11:31 squid25.conf
</I>&gt;<i> &gt; -rw-r--r-- &#160; 1 root root 2834 Sep &#160;6 11:31 squid12.conf
</I>&gt;<i> &gt; -rw-r--r-- &#160; 1 root root 2832 Sep &#160;6 11:31 squid3.conf
</I>&gt;<i> &gt; -rw-r--r-- &#160; 1 root root 2836 Sep &#160;6 11:30 squid10.conf
</I>&gt;<i> &gt; -rw-r--r-- &#160; 1 root root 2835 Sep &#160;6 11:30 squid11.conf
</I>&gt;<i> &gt; -rw-r--r-- &#160; 1 root root 2833 Sep &#160;6 11:30 squid18.conf
</I>&gt;<i> &gt; -rw-r--r-- &#160; 1 root root 2830 Sep &#160;6 11:30 squid8.conf
</I>&gt;<i> &gt; -rw-r--r-- &#160; 1 root root 2830 Sep &#160;6 11:30 squid6.conf
</I>&gt;<i> &gt; -rw-r--r-- &#160; 1 root root 2833 Sep &#160;6 11:30 squid28.conf
</I>&gt;<i> &gt; -rw-r--r-- &#160; 1 root root 2830 Sep &#160;6 11:25 squid9.conf
</I>&gt;<i> &gt; -rw-r--r-- &#160; 1 root root 2836 Sep &#160;6 11:25 squid24.conf
</I>&gt;<i> &gt; -rw-r--r-- &#160; 1 root root 2835 Sep &#160;6 11:25 squid22.conf
</I>&gt;<i> &gt; -rw-r--r-- &#160; 1 root root 2837 Sep &#160;6 11:25 squid20.conf
</I>&gt;<i> &gt; -rw-r--r-- &#160; 1 root root 2836 Sep &#160;6 11:25 squid16.conf
</I>&gt;<i> &gt; -rw-r--r-- &#160; 1 root root 2835 Sep &#160;6 11:25 squid15.conf
</I>&gt;<i> &gt; -rw-r--r-- &#160; 1 root root 2836 Sep &#160;6 11:25 squid14.conf
</I>&gt;<i> &gt; -rw-r--r-- &#160; 1 root root 2831 Sep &#160;6 11:25 squid5.conf
</I>&gt;<i> &gt; -rw-r--r-- &#160; 1 root root 2833 Sep &#160;6 11:25 squid27.conf
</I>&gt;<i> &gt; -rw-r--r-- &#160; 1 root root 2835 Sep &#160;6 11:25 squid26.conf
</I>&gt;<i> &gt; -rw-r--r-- &#160; 1 root root 2835 Sep &#160;6 11:25 squid30.conf
</I>&gt;<i> &gt; -rw-r--r-- &#160; 1 root root 2835 Sep &#160;6 11:25 squid29.conf
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; squid-users mailing list
</I>&gt;<i> &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> &gt; <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20220907/a07dbea2/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20220907/a07dbea2/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025173.html">[squid-users] logfileHandleWrite: daemon:/var/log/squid/access.log: error writing ((32) Broken pipe)
</A></li>
	<LI>Next message (by thread): <A HREF="025179.html">[squid-users] logfileHandleWrite: daemon:/var/log/squid/access.log: error writing ((32) Broken pipe)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25178">[ date ]</a>
              <a href="thread.html#25178">[ thread ]</a>
              <a href="subject.html#25178">[ subject ]</a>
              <a href="author.html#25178">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
