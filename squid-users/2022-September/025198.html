<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] logfileHandleWrite: daemon:/var/log/squid/access.log: error writing ((32) Broken pipe)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20logfileHandleWrite%3A%0A%20daemon%3A/var/log/squid/access.log%3A%20error%20writing%20%28%2832%29%20Broken%20pipe%29&In-Reply-To=%3C47359982-dafd-4a65-b916-4ff02510f979%40Spark%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025181.html">
   <LINK REL="Next"  HREF="025176.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] logfileHandleWrite: daemon:/var/log/squid/access.log: error writing ((32) Broken pipe)</H1>
    <B>roee klinger</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20logfileHandleWrite%3A%0A%20daemon%3A/var/log/squid/access.log%3A%20error%20writing%20%28%2832%29%20Broken%20pipe%29&In-Reply-To=%3C47359982-dafd-4a65-b916-4ff02510f979%40Spark%3E"
       TITLE="[squid-users] logfileHandleWrite: daemon:/var/log/squid/access.log: error writing ((32) Broken pipe)">roeeklinger60 at gmail.com
       </A><BR>
    <I>Fri Sep  9 12:40:32 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025181.html">[squid-users] logfileHandleWrite: daemon:/var/log/squid/access.log: error writing ((32) Broken pipe)
</A></li>
        <LI>Next message (by thread): <A HREF="025176.html">[squid-users] MySQL backend for time restrictions of clients
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25198">[ date ]</a>
              <a href="thread.html#25198">[ thread ]</a>
              <a href="subject.html#25198">[ subject ]</a>
              <a href="author.html#25198">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thank you, Alex and Eli,

Just wanted to update that I was able to solve the problem in case someone runs into it in the future,
based on Eliezers suggestion, I disabled logrotate (although it can be tweaked to work), and just wrote
a custom cron job to run daily and rotate the logs for each squid instance using something like this:
&gt;<i> quote_type
</I>&gt;<i> squid -f /etc/squid/squid12.conf -k rotate
</I>&gt;<i> ..
</I>&gt;<i> ..
</I>&gt;<i> ..
</I>&gt;<i>
</I>Now everything seems to be working properly, logfile_rotate is set to 1, so the files move over once
and then they get deleted, just as I wanted.
On 7 Sep 2022, 19:27 +0300, NgTech LTD &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A>&gt;, wrote:
&gt;<i> Good one, Alex.
</I>&gt;<i>
</I>&gt;<i> For this specific use case you need a special rotate script which will know the confs file and will loop over them.
</I>&gt;<i> Later on I will try to see if yave one of these on my servers.
</I>&gt;<i> Basically you will need an array of config files and loop on them.
</I>&gt;<i>
</I>&gt;<i> The pid shouldn't be relevevant for a rotate operation but it depends on the nature of the system.(on a 24/7 system you should know about a service that is down way before the logrotate happpens)
</I>&gt;<i> If you have a set of config files you can generate a set of postrotate commands compared to a special script.
</I>&gt;<i>
</I>&gt;<i> Let me know if this solution might fit for your use case.
</I>&gt;<i>
</I>&gt;<i> Eliezer
</I>&gt;<i>
</I>&gt;<i> &gt; &#1489;&#1514;&#1488;&#1512;&#1497;&#1498; &#1497;&#1493;&#1501; &#1491;&#1523;, 7 &#1489;&#1505;&#1508;&#1496;&#1523; 2022, 3:53, &#1502;&#1488;&#1514; Alex Rousskov &#8207;&lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt;:
</I>&gt;<i> &gt; &gt; &#160;&gt; pid_filename /var/run/squid2.pid
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; &#160;&gt;&#160; &#160;postrotate
</I>&gt;<i> &gt; &gt; &#160;&gt;&#160; &#160;test ! -e /var/run/squid.pid || ... /usr/sbin/squid -k rotate
</I>&gt;<i> &gt; &gt; &#160;&gt;&#160; &#160;endscript
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; I spotted one more (potentially critical) problem: Your Squid
</I>&gt;<i> &gt; &gt; configuration sets pid_filename to /var/run/squid2.pid but your
</I>&gt;<i> &gt; &gt; logrotate configuration assumes Squid uses /var/run/squid.pid.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; IMHO, in general, it is best not to guess where Squid has its PID if you
</I>&gt;<i> &gt; &gt; are using &quot;squid -k ...&quot;. If you want to test whether Squid is currently
</I>&gt;<i> &gt; &gt; running, try using &quot;squid -k check&quot; instead.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; HTH,
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Alex.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; On 9/6/22 20:45, Alex Rousskov wrote:
</I>&gt;<i> &gt; &gt; &gt; On 9/6/22 18:02, roee klinger wrote:
</I>&gt;<i> &gt; &gt; &gt;&gt; it seems that the logs has filled over 100GB of log data, since I made
</I>&gt;<i> &gt; &gt; &gt;&gt; a configuration mistake (I think?) by setting this:
</I>&gt;<i> &gt; &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt; &#160;&#160;&#160; logfile_rotate 0
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; This is correct setting when using an external log rotation tool like
</I>&gt;<i> &gt; &gt; &gt; the logrotate daemon. More on that below.
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;&gt; If I remember and read correctly, this means that the rotation of the
</I>&gt;<i> &gt; &gt; &gt;&gt; files is disabled and they will just keeping increasing
</I>&gt;<i> &gt; &gt; &gt;&gt; in size if left unchecked.
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; To be more precise, this means that you are relying on an external tool
</I>&gt;<i> &gt; &gt; &gt; to rename the log files. With this setting, Squid rotate command closes
</I>&gt;<i> &gt; &gt; &gt; the access log and opens a new one (under the same name). While that
</I>&gt;<i> &gt; &gt; &gt; might sound useless, it is the right (and necessary) thing for Squid to
</I>&gt;<i> &gt; &gt; &gt; do when combined with the correct external log rotation setup.
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;&gt; I have now gone ahead and changed all the configuration file to this
</I>&gt;<i> &gt; &gt; &gt;&gt; setting:
</I>&gt;<i> &gt; &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt; &#160;&#160;&#160; logfile_rotate 1
</I>&gt;<i> &gt; &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt; So now it should rotate once daily, and on the next rotation it should
</I>&gt;<i> &gt; &gt; &gt;&gt; be deleted, and this is all handled by logrotate on Debian-based
</I>&gt;<i> &gt; &gt; &gt;&gt; machines?
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; AFAIK, if you are using an external (to Squid) tool like logrotate, you
</I>&gt;<i> &gt; &gt; &gt; should be setting logfile_rotate to zero.
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;&gt; This is my / cat /etc/logrotate.d/squid:
</I>&gt;<i> &gt; &gt; &gt;&gt; &#10140; / cat /etc/logrotate.d/squid
</I>&gt;<i> &gt; &gt; &gt;&gt; #
</I>&gt;<i> &gt; &gt; &gt;&gt; # Logrotate fragment for squid.
</I>&gt;<i> &gt; &gt; &gt;&gt; #
</I>&gt;<i> &gt; &gt; &gt;&gt; /var/log/squid/*.log {
</I>&gt;<i> &gt; &gt; &gt;&gt; &#160;&#160;daily
</I>&gt;<i> &gt; &gt; &gt;&gt; &#160;&#160;compress
</I>&gt;<i> &gt; &gt; &gt;&gt; &#160;&#160;delaycompress
</I>&gt;<i> &gt; &gt; &gt;&gt; &#160;&#160;rotate 2
</I>&gt;<i> &gt; &gt; &gt;&gt; &#160;&#160;missingok
</I>&gt;<i> &gt; &gt; &gt;&gt; &#160;&#160;nocreate
</I>&gt;<i> &gt; &gt; &gt;&gt; &#160;&#160;sharedscripts
</I>&gt;<i> &gt; &gt; &gt;&gt; &#160;&#160;prerotate
</I>&gt;<i> &gt; &gt; &gt;&gt; &#160;&#160;test ! -x /usr/sbin/sarg-reports || /usr/sbin/sarg-reports daily
</I>&gt;<i> &gt; &gt; &gt;&gt; &#160;&#160;endscript
</I>&gt;<i> &gt; &gt; &gt;&gt; &#160;&#160;postrotate
</I>&gt;<i> &gt; &gt; &gt;&gt; &#160;&#160;test ! -e /var/run/squid.pid || test ! -x /usr/sbin/squid ||
</I>&gt;<i> &gt; &gt; &gt;&gt; /usr/sbin/squid -k rotate
</I>&gt;<i> &gt; &gt; &gt;&gt; &#160;&#160;endscript
</I>&gt;<i> &gt; &gt; &gt;&gt; }
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; This is not my area of expertise, but the above configuration does not
</I>&gt;<i> &gt; &gt; &gt; look 100% correct to me: sarg-reports execution failures should have no
</I>&gt;<i> &gt; &gt; &gt; effect on log rotation but does (AFAICT). There may be other problems
</I>&gt;<i> &gt; &gt; &gt; (e.g., I do not know whether your /usr/sbin/squid finds the right Squid
</I>&gt;<i> &gt; &gt; &gt; configuration file). I hope sysadmin experts on this mailing list will
</I>&gt;<i> &gt; &gt; &gt; help you polish this.
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; You should be able to test whether the above is working (e.g., by asking
</I>&gt;<i> &gt; &gt; &gt; logrotate to rotate). Testing is critical even if you do end up getting
</I>&gt;<i> &gt; &gt; &gt; expert log rotation help on this list (this email is not it!).
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; HTH,
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; Alex.
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;&gt; Is there a way for me to set it so it just get deleted every 24 or 12
</I>&gt;<i> &gt; &gt; &gt;&gt; hours without the archive first?
</I>&gt;<i> &gt; &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt; Thanks,
</I>&gt;<i> &gt; &gt; &gt;&gt; Roee
</I>&gt;<i> &gt; &gt; &gt;&gt; On 6 Sep 2022, 16:28 +0300, Alex Rousskov
</I>&gt;<i> &gt; &gt; &gt;&gt; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt;, wrote:
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; On 9/6/22 07:41, roee klinger wrote:
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; It is also important to know that I am running multiple Squid instances
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; on the same machine, they are all getting the error at the same time
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; What external event(s) happen at that time? Something is probably
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; sending a signal to the logging daemon process. It would be good to know
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; what that something (and that signal) is. Your syslog or cache.log might
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; contain more info. Analyzing the timing/schedule of these problems may
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; also be helpful in identifying the trigger.
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; Is a possible workaround that might be just replacing the line with
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; this?
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; access_log /var/log/squid/access2.log
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; As you know, this configuration (in this deprecated spelling or with and
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; explicit &quot;stdio:&quot; prefix) will result in Squid workers writing to the
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; log file directly instead of asking the logging daemon. This will,
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; naturally, get rid of the pipe between workers and their daemons, and
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; the associated broken pipe error.
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; or will this cause a problem?
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; Impossible to say for sure without knowing whether your workers benefit
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; from the anticipated performance advantages of avoiding blocking file
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; I/O _and_ whether those advantages are real (in your environment). Too
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; many variables and too many unknowns. I would treat this as an important
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; (and potentially disruptive) configuration change and carefully test the
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; outcome.
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; HTH,
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; Alex.
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; INFO -
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; Versions:
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; Squid Cache: Version 4.10
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; Ubuntu 20.04.4 LTS
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; Example squid.conf:
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; visible_hostname squid2
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; access_log daemon:/var/log/squid/access2.log squid
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; cache_log /var/log/squid/cache2.log
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; pid_filename /var/run/squid2.pid
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; acl localnet src 0.0.0.1-0.255.255.255# RFC 1122 &quot;this&quot; network (LAN)
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; acl localnet src 10.0.0.0/8 &lt;<A HREF="http://10.0.0.0/8">http://10.0.0.0/8</A>&gt; # RFC 1918 local
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; private network (LAN)
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; acl localnet src 100.64.0.0/10 &lt;<A HREF="http://100.64.0.0/10">http://100.64.0.0/10</A>&gt;# RFC 6598
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; shared address space (CGN)
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; acl localnet src 169.254.0.0/16 &lt;<A HREF="http://169.254.0.0/16">http://169.254.0.0/16</A>&gt; # RFC 3927
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; link-local (directly plugged) machines
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; acl localnet src 172.16.0.0/12 &lt;<A HREF="http://172.16.0.0/12">http://172.16.0.0/12</A>&gt;# RFC 1918
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; local private network (LAN)
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; acl localnet src 192.168.0.0/16 &lt;<A HREF="http://192.168.0.0/16">http://192.168.0.0/16</A>&gt; # RFC 1918
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; local private network (LAN)
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; acl localnet src fc00::/7 # RFC 4193 local private network range
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; acl localnet src fe80::/10# RFC 4291 link-local (directly plugged)
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; machines
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; acl SSL_ports port 443
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; acl Safe_ports port 80# http
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; acl Safe_ports port 21# ftp
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; acl Safe_ports port 443 # https
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; acl Safe_ports port 70# gopher
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; acl Safe_ports port 210 # wais
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; acl Safe_ports port 1025-65535# unregistered ports
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; acl Safe_ports port 280 # http-mgmt
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; acl Safe_ports port 488 # gss-http
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; acl Safe_ports port 591 # filemaker
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; acl Safe_ports port 777 # multiling http
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; acl CONNECT method CONNECT
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; http_access deny !Safe_ports
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; http_access deny CONNECT !SSL_ports
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; http_access allow localhost manager
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; http_access deny manager
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; # include /etc/squid/conf.d/*
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; http_access allow localhost
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; acl aws src *censored*
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; http_access allow aws
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; # http_access deny all
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; tcp_outgoing_address *censored*
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; http_port 10002
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; coredump_dir /var/spool/squid
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; refresh_pattern ^ftp: 144020% 10080
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; refresh_pattern ^gopher:14400%1440
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; refresh_pattern -i (/cgi-bin/|\?) 0 0%0
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; refresh_pattern \/(Packages|Sources)(|\.bz2|\.gz|\.xz)$ 0 0% 0
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; refresh-ims
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; refresh_pattern \/Release(|\.gpg)$ 0 0% 0 refresh-ims
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; refresh_pattern \/InRelease$ 0 0% 0 refresh-ims
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; refresh_pattern \/(Translation-.*)(|\.bz2|\.gz|\.xz)$ 0 0% 0
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; refresh-ims
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; refresh_pattern . 0 20% 4320
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; shutdown_lifetime 1 seconds
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; logfile_rotate 0
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; max_filedescriptors 16384
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; dns_nameservers 8.8.8.8 8.8.4.4 1.1.1.1
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; cache deny all
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; cache_dir null /tmp
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; via off
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; forwarded_for off
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; request_header_access From deny all
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; request_header_access Server deny all
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; request_header_access WWW-Authenticate deny all
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; request_header_access Link deny all
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; request_header_access Cache-Control deny all
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; request_header_access Proxy-Connection deny all
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; request_header_access X-Cache deny all
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; request_header_access X-Cache-Lookup deny all
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; request_header_access Via deny all
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; request_header_access X-Forwarded-For deny all
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; request_header_access Pragma deny all
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; request_header_access Keep-Alive deny all
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; dns_v4_first on
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; Example&#160;service file:
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; ## Copyright (C) 1996-2020 The Squid Software Foundation and
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; contributors
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; ##
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; ## Squid software is distributed under GPLv2+ license and includes
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; ## contributions from numerous individuals and organizations.
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; ## Please see the COPYING and CONTRIBUTORS files for details.
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; ##
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; [Unit]
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; Description=Squid Web Proxy Server
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; Documentation=man:squid(8)
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; After=network.target network-online.target nss-lookup.target
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; [Service]
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; Type=forking
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; PIDFile=/var/run/squid2.pid
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; ExecStartPre=/usr/sbin/squid --foreground -z -f /etc/squid/squid2.conf
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; ExecStart=/usr/sbin/squid -sYC -f /etc/squid/squid2.conf
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; ExecReload=/bin/kill -HUP $MAINPID
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; KillMode=mixed
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; [Install]
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; WantedBy=multi-user.target
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; Permissions:
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; &#10140;&#160; ls -alt /etc/squid/
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; total 128
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; drwxr-xr-x &#160; 2 root root 4096 Sep &#160;6 11:33 .
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; -rw-r--r-- &#160; 1 root root 2831 Sep &#160;6 11:33 squid7.conf
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; drwxr-xr-x 116 root root 4096 Sep &#160;6 11:33 ..
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; -rw-r--r-- &#160; 1 root root 2830 Sep &#160;6 11:33 squid2.conf
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; -rw-r--r-- &#160; 1 root root 2836 Sep &#160;6 11:33 squid13.conf
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; -rw-r--r-- &#160; 1 root root 2836 Sep &#160;6 11:32 squid23.conf
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; -rw-r--r-- &#160; 1 root root 2836 Sep &#160;6 11:32 squid19.conf
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; -rw-r--r-- &#160; 1 root root 2832 Sep &#160;6 11:32 squid1.conf
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; -rw-r--r-- &#160; 1 root root 2836 Sep &#160;6 11:32 squid17.conf
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; -rw-r--r-- &#160; 1 root root 2832 Sep &#160;6 11:31 squid4.conf
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; -rw-r--r-- &#160; 1 root root 2834 Sep &#160;6 11:31 squid21.conf
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; -rw-r--r-- &#160; 1 root root 2833 Sep &#160;6 11:31 squid25.conf
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; -rw-r--r-- &#160; 1 root root 2834 Sep &#160;6 11:31 squid12.conf
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; -rw-r--r-- &#160; 1 root root 2832 Sep &#160;6 11:31 squid3.conf
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; -rw-r--r-- &#160; 1 root root 2836 Sep &#160;6 11:30 squid10.conf
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; -rw-r--r-- &#160; 1 root root 2835 Sep &#160;6 11:30 squid11.conf
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; -rw-r--r-- &#160; 1 root root 2833 Sep &#160;6 11:30 squid18.conf
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; -rw-r--r-- &#160; 1 root root 2830 Sep &#160;6 11:30 squid8.conf
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; -rw-r--r-- &#160; 1 root root 2830 Sep &#160;6 11:30 squid6.conf
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; -rw-r--r-- &#160; 1 root root 2833 Sep &#160;6 11:30 squid28.conf
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; -rw-r--r-- &#160; 1 root root 2830 Sep &#160;6 11:25 squid9.conf
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; -rw-r--r-- &#160; 1 root root 2836 Sep &#160;6 11:25 squid24.conf
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; -rw-r--r-- &#160; 1 root root 2835 Sep &#160;6 11:25 squid22.conf
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; -rw-r--r-- &#160; 1 root root 2837 Sep &#160;6 11:25 squid20.conf
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; -rw-r--r-- &#160; 1 root root 2836 Sep &#160;6 11:25 squid16.conf
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; -rw-r--r-- &#160; 1 root root 2835 Sep &#160;6 11:25 squid15.conf
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; -rw-r--r-- &#160; 1 root root 2836 Sep &#160;6 11:25 squid14.conf
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; -rw-r--r-- &#160; 1 root root 2831 Sep &#160;6 11:25 squid5.conf
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; -rw-r--r-- &#160; 1 root root 2833 Sep &#160;6 11:25 squid27.conf
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; -rw-r--r-- &#160; 1 root root 2835 Sep &#160;6 11:25 squid26.conf
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; -rw-r--r-- &#160; 1 root root 2835 Sep &#160;6 11:25 squid30.conf
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; -rw-r--r-- &#160; 1 root root 2835 Sep &#160;6 11:25 squid29.conf
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; _______________________________________________
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; squid-users mailing list
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;&gt; <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; _______________________________________________
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; squid-users mailing list
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> &gt; &gt; &gt;&gt;&gt; <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; _______________________________________________
</I>&gt;<i> &gt; &gt; &gt; squid-users mailing list
</I>&gt;<i> &gt; &gt; &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> &gt; &gt; &gt; <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; _______________________________________________
</I>&gt;<i> &gt; &gt; squid-users mailing list
</I>&gt;<i> &gt; &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> &gt; &gt; <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20220909/dcdba5fc/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20220909/dcdba5fc/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025181.html">[squid-users] logfileHandleWrite: daemon:/var/log/squid/access.log: error writing ((32) Broken pipe)
</A></li>
	<LI>Next message (by thread): <A HREF="025176.html">[squid-users] MySQL backend for time restrictions of clients
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25198">[ date ]</a>
              <a href="thread.html#25198">[ thread ]</a>
              <a href="subject.html#25198">[ subject ]</a>
              <a href="author.html#25198">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
