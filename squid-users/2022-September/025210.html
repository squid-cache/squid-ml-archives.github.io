<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Do squid logs performence affect general request performece?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Do%20squid%20logs%20performence%20affect%20general%20request%0A%20performece%3F&In-Reply-To=%3C9b254c79-ed34-4464-a767-a9863e4e2ab4%40Spark%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025201.html">
   <LINK REL="Next"  HREF="025211.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Do squid logs performence affect general request performece?</H1>
    <B>roee klinger</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Do%20squid%20logs%20performence%20affect%20general%20request%0A%20performece%3F&In-Reply-To=%3C9b254c79-ed34-4464-a767-a9863e4e2ab4%40Spark%3E"
       TITLE="[squid-users] Do squid logs performence affect general request performece?">roeeklinger60 at gmail.com
       </A><BR>
    <I>Mon Sep 12 22:20:10 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025201.html">[squid-users] Do squid logs performence affect general request performece?
</A></li>
        <LI>Next message (by thread): <A HREF="025211.html">[squid-users] Do squid logs performence affect general request performece?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25210">[ date ]</a>
              <a href="thread.html#25210">[ thread ]</a>
              <a href="subject.html#25210">[ subject ]</a>
              <a href="author.html#25210">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

Thank you for your advice, as suggested I tested a both TCP and UDP, and found TCP to be so slow
that is it practically unusable, UDP however works fine, but has the normal disadvantages of UDP.

It seems that TCP sends each message by itself, and UDP sends them in bulk (10-20 at a time),
which seems to be a big part of the performance difference, in fact TCP is so slow that it causes
Squid to crash after a while.

After carefully reading the logs, I tried to get TCP to send in bulk as well by configuring:
&gt;<i> quote_type
</I>&gt;<i> logformat logstash %ts.%03tu %6tr %&gt;a %&lt;la %&gt;lp %Ss/%03&gt;Hs %&lt;st %rm %ru %[un %Sh/%&lt;a %mt %{Client-Tags}&gt;h
</I>&gt;<i> access_log <A HREF="tcp://127.0.0.1:5400">tcp://127.0.0.1:5400</A> logformat=logstash buffer-size=64KB
</I>&gt;<i> buffered_logs on
</I>&gt;<i>
</I>But it seems to still be sending the logs line by line, am I missing something?

Thanks,
Roee
On 9 Sep 2022, 19:57 +0300, Alex Rousskov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt;, wrote:
&gt;<i> On 9/9/22 08:49, roee klinger wrote:
</I>&gt;<i> &gt; Hello,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I have just recently started exploring ingesting logs from Squid via
</I>&gt;<i> &gt; Logstash (TCP log ingestion)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I now have to make the decision of how to deploy Logstash, it seems to
</I>&gt;<i> &gt; me that I have two options:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 1. Deploy a Logstash instance for every region where I have a Squid
</I>&gt;<i> &gt; instance running, resulting in the lowest latency possible between
</I>&gt;<i> &gt; Squid and Logstash.
</I>&gt;<i> &gt; 2. Deploy a central Logstash instance for all Squid instance worldwide,
</I>&gt;<i> &gt; which is the cheapest and easiest option, but will have high latency
</I>&gt;<i> &gt; for some of the Squid instance which are located far away
</I>&gt;<i> &gt; geographically from the Logstash instance.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I already know that if the log server crashes in Squid, then Squid will
</I>&gt;<i> &gt; crash with a fatal error,
</I>&gt;<i>
</I>&gt;<i> FYI: Logging error handling is configurable via &quot;access_log on-error&quot;.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; so Squid takes logging very seriously, so my
</I>&gt;<i> &gt; question is: does TCP logging performance in Squid effect the total
</I>&gt;<i> &gt; request performance, or are they independent from each other?
</I>&gt;<i>
</I>&gt;<i> TCP logger uses asynchronous non-blocking I/O. Individual HTTP
</I>&gt;<i> transactions do not wait for individual log records to be sent. Needless
</I>&gt;<i> to say, logging does consume resources and, hence, may affect overall
</I>&gt;<i> HTTP transaction performance. And if the log record recipient is too
</I>&gt;<i> slow, then Squid will die and/or log records will be dropped.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; What would be you recommendations, if request performance is crucial
</I>&gt;<i> &gt; (and log performance is not)?
</I>&gt;<i>
</I>&gt;<i> I would not be surprised if you would not be able to measure meaningful
</I>&gt;<i> performance difference among these modules. From general performance
</I>&gt;<i> point of view, and module-specific bugs and limitations notwithstanding,
</I>&gt;<i> I would expect &quot;daemon&quot; and &quot;udp&quot; modules to have smaller performance
</I>&gt;<i> overhead/cost for Squid workers than the &quot;tcp&quot; module because I expect
</I>&gt;<i> that TCP has to &quot;do more&quot; than stdout I/O and UDP. However, I would not
</I>&gt;<i> base this decision on such high-level speculations and test various
</I>&gt;<i> options instead.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> HTH,
</I>&gt;<i>
</I>&gt;<i> Alex.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20220913/9020f0a6/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20220913/9020f0a6/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025201.html">[squid-users] Do squid logs performence affect general request performece?
</A></li>
	<LI>Next message (by thread): <A HREF="025211.html">[squid-users] Do squid logs performence affect general request performece?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25210">[ date ]</a>
              <a href="thread.html#25210">[ thread ]</a>
              <a href="subject.html#25210">[ subject ]</a>
              <a href="author.html#25210">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
