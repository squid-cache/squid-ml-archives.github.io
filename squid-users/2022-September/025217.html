<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] [squid][v5.6] : problem with &quot;slow&quot; or &quot;fast&quot; acl
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%5Bsquid%5D%5Bv5.6%5D%20%3A%20problem%20with%20%22slow%22%20or%20%22fast%22%20acl&In-Reply-To=%3C134aba14e66bb9d58b5999d733a64627%40interieur.gouv.fr%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025175.html">
   <LINK REL="Next"  HREF="025219.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] [squid][v5.6] : problem with &quot;slow&quot; or &quot;fast&quot; acl</H1>
    <B>PERROT Eric DNUM SDCAST BST SSAIM</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%5Bsquid%5D%5Bv5.6%5D%20%3A%20problem%20with%20%22slow%22%20or%20%22fast%22%20acl&In-Reply-To=%3C134aba14e66bb9d58b5999d733a64627%40interieur.gouv.fr%3E"
       TITLE="[squid-users] [squid][v5.6] : problem with &quot;slow&quot; or &quot;fast&quot; acl">eric.perrot at interieur.gouv.fr
       </A><BR>
    <I>Fri Sep 16 07:11:58 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025175.html">[squid-users] [squid][v5.6] : problem with &quot;slow&quot; or &quot;fast&quot; acl
</A></li>
        <LI>Next message (by thread): <A HREF="025219.html">[squid-users] [squid][v5.6] : problem with &quot;slow&quot; or &quot;fast&quot; acl
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25217">[ date ]</a>
              <a href="thread.html#25217">[ thread ]</a>
              <a href="subject.html#25217">[ subject ]</a>
              <a href="author.html#25217">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE> 

Hello Elizer and David, 

Sorry for the delay, I have been monopolized by another subject... 

I am not sur to understand how note acl could help me. If the idear of
&quot;note acl&quot; is similar to the one proposed by Amos (creating a group with
annotate acl). 

My requirement is to have special limitation for logged users, except
for those with a login starting by cg_*.

I have been using proxy_auth acl to identify my users, but this acl is
slow and is not recommended with limitation directive
(&quot;reply_body_max_size&quot;, &quot;request_body_max_size&quot; and &quot;delay_access&quot;). 

I am testing to create groups today and I'll come back to you

Thank you for your thinking, 

Eric 

Le 06/09/2022 20:10, <A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A> a &#233;crit : 

&gt;<i> Hey Eric and David, 
</I>&gt;<i> 
</I>&gt;<i> I am thinking about the best place to put a note acl. 
</I>&gt;<i> 
</I>&gt;<i> What is the actual requirement?
</I>&gt;<i> Do you want to limit a specific client or all of them?
</I>&gt;<i> I have not used delay pools for a very long time so I am not sure about what you want these to do. 
</I>&gt;<i> 
</I>&gt;<i> Eliezer 
</I>&gt;<i> 
</I>&gt;<i> ---- 
</I>&gt;<i> 
</I>&gt;<i> Eliezer Croitoru 
</I>&gt;<i> 
</I>&gt;<i> NgTech, Tech Support 
</I>&gt;<i> 
</I>&gt;<i> Mobile: +972-5-28704261 
</I>&gt;<i> 
</I>&gt;<i> Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A> 
</I>&gt;<i> 
</I>&gt;<i> Web: <A HREF="https://ngtech.co.il/">https://ngtech.co.il/</A> [2] 
</I>&gt;<i> 
</I>&gt;<i> My-Tube: <A HREF="https://tube.ngtech.co.il/">https://tube.ngtech.co.il/</A> [3] 
</I>&gt;<i> 
</I>&gt;<i> FROM: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; ON BEHALF OF David Touzeau
</I>&gt;<i> SENT: Tuesday, 6 September 2022 18:45
</I>&gt;<i> TO: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> SUBJECT: Re: [squid-users] [squid][v5.6] : problem with &quot;slow&quot; or &quot;fast&quot; acl 
</I>&gt;<i> 
</I>&gt;<i> Hi Eric. 
</I>&gt;<i> 
</I>&gt;<i> We had the same restrictions with the fast or slow ACLs. 
</I>&gt;<i> Have you thought about creating a squid helper that calculates your needs? 
</I>&gt;<i> So maybe you can get around this by using the acl &quot;note&quot; acl note xxx xxx which turns your helper results (slow) into &quot;fast&quot;. 
</I>&gt;<i> 
</I>&gt;<i> Le 05/09/2022 &#224; 14:56, PERROT Eric DNUM SDCAST BST SSAIM a &#233;crit : 
</I>&gt;<i> 
</I>&gt;&gt;<i> Hello,
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> We use directives &quot;reply_body_max_size&quot;, &quot;request_body_max_size&quot; and &quot;delay_access&quot; to limit upload, download and passband in our infra.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> This configuration existes since a while, but we have noticed that with squid v4.16, our delay pool didn't react as we wanted anymore. We were excpeting improvment upgrading squid to v5.6. But it got worth :
</I>&gt;&gt;<i> - restriction still didn't work
</I>&gt;&gt;<i> - and squid had a segmentation fault each time some acl where used
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Thanks to Alex Rousskov (bug 5231), after some investigation, it appears that we used &quot;slow&quot; acl (proxy_auth an time acl) where only &quot;fast&quot; acl where authorized...). The bug is still open as squid has not flagged the problem in cache logs, 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> My email, is to show you our configuration and the behaviour we espect, and the behaviour we finally have.
</I>&gt;&gt;<i> 1 - squd v4.12 : we expect to limit downlod/upload and passband during working time for all login except those starting with cg_*
</I>&gt;&gt;<i> &quot;
</I>&gt;&gt;<i> ###### Gestion de bande passante ##########
</I>&gt;&gt;<i> acl bureau time 09:00-12:00
</I>&gt;&gt;<i> acl bureau time 14:00-17:00
</I>&gt;&gt;<i> # Comptes generiques
</I>&gt;&gt;<i> acl my_ldap_auth proxy_auth REQUIRED
</I>&gt;&gt;<i> acl cgen proxy_auth_regex cg_
</I>&gt;&gt;<i> reply_body_max_size 800 MB BUREAU !CGEN
</I>&gt;&gt;<i> request_body_max_size 5 MB 
</I>&gt;&gt;<i> # La limite de bande passante ne fonctionne plus avec le BUMP
</I>&gt;&gt;<i> # A tester ...
</I>&gt;&gt;<i> delay_pools 1
</I>&gt;&gt;<i> # Pendant time sauf cgen, emeraude 
</I>&gt;&gt;<i> delay_class 1 4
</I>&gt;&gt;<i> delay_access 1 allow MY_LDAP_AUTH !CGEN !emeraude
</I>&gt;&gt;<i> delay_access 1 deny all
</I>&gt;&gt;<i> # 512000 = 5120 kbits/user 640 ko
</I>&gt;&gt;<i> # 307200 = 3072 kbits/user 384 ko
</I>&gt;&gt;<i> delay_parameters 1 -1/-1 -1/-1 -1/-1 107200/107200
</I>&gt;&gt;<i> ##################################################
</I>&gt;&gt;<i> &quot;
</I>&gt;&gt;<i> =&gt; with this configuration, the delay pool seemed not to work anymore, so we upgraded squid to v5.6. Which caused the squid segmentation fault... 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 2 - squid v5.6 : to solve the segmentation fault, we had to take off my_ldap_auth/cgen (proxy_auth acl) and bureau (time acl). The limitation work again, but we are no more able to limit restriction during working time, or for sp&#233;cific login...
</I>&gt;&gt;<i> &quot;
</I>&gt;&gt;<i> ###### Gestion de bande passante ##########
</I>&gt;&gt;<i> acl bureau time 09:00-12:00
</I>&gt;&gt;<i> acl bureau time 14:00-17:00
</I>&gt;&gt;<i> # Comptes generiques
</I>&gt;&gt;<i> acl userrgt src 10.0.0.0/8
</I>&gt;&gt;<i> acl my_ldap_auth proxy_auth REQUIRED
</I>&gt;&gt;<i> acl cgen proxy_auth_regex cg_
</I>&gt;&gt;<i> reply_body_max_size 800 MB USERRGT
</I>&gt;&gt;<i> request_body_max_size 5 MB 
</I>&gt;&gt;<i> # La limite de bande passante ne fonctionne plus avec le BUMP
</I>&gt;&gt;<i> # A tester ...
</I>&gt;&gt;<i> delay_pools 1
</I>&gt;&gt;<i> # Pendant time sauf cgen, emeraude 
</I>&gt;&gt;<i> delay_class 1 4
</I>&gt;&gt;<i> delay_access 1 allow!emeraude
</I>&gt;&gt;<i> delay_access 1 deny all
</I>&gt;&gt;<i> # 512000 = 5120 kbits/user 640 ko
</I>&gt;&gt;<i> # 307200 = 3072 kbits/user 384 ko
</I>&gt;&gt;<i> delay_parameters 1 -1/-1 -1/-1 -1/-1 107200/107200
</I>&gt;&gt;<i> ##################################################
</I>&gt;&gt;<i> &quot;
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Can you tell me if what we want to do is still possible? Limiting upload/download/passband for all logged user except those starting by cg_*..?.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Thank you for the time reading, and thank you for your answers.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Regards,
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Eric Perrot 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Pour une administration exemplaire, pr&#233;servons l'environnement. 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> N'imprimons que si n&#233;cessaire. 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A> [1]
</I>&gt;<i> 
</I>&gt;<i> -- 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A> [1]
</I> 

Links:
------
[1] <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
[2] <A HREF="https://ngtech.co.il/">https://ngtech.co.il/</A>
[3] <A HREF="https://tube.ngtech.co.il/">https://tube.ngtech.co.il/</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20220916/aa07da5d/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20220916/aa07da5d/attachment.htm</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 10699 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20220916/aa07da5d/attachment.png">http://lists.squid-cache.org/pipermail/squid-users/attachments/20220916/aa07da5d/attachment.png</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025175.html">[squid-users] [squid][v5.6] : problem with &quot;slow&quot; or &quot;fast&quot; acl
</A></li>
	<LI>Next message (by thread): <A HREF="025219.html">[squid-users] [squid][v5.6] : problem with &quot;slow&quot; or &quot;fast&quot; acl
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25217">[ date ]</a>
              <a href="thread.html#25217">[ thread ]</a>
              <a href="subject.html#25217">[ subject ]</a>
              <a href="author.html#25217">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
