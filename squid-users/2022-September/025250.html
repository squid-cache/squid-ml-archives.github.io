<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Fwd: Squid shutdown on web request of type http://ftp.domain.country
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Fwd%3A%20Squid%20shutdown%20on%20web%20request%20of%20type%0A%20http%3A//ftp.domain.country&In-Reply-To=%3Cae505ff6-7b26-55f2-8198-e60ca826601d%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025249.html">
   <LINK REL="Next"  HREF="025251.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Fwd: Squid shutdown on web request of type http://ftp.domain.country</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Fwd%3A%20Squid%20shutdown%20on%20web%20request%20of%20type%0A%20http%3A//ftp.domain.country&In-Reply-To=%3Cae505ff6-7b26-55f2-8198-e60ca826601d%40measurement-factory.com%3E"
       TITLE="[squid-users] Fwd: Squid shutdown on web request of type http://ftp.domain.country">rousskov at measurement-factory.com
       </A><BR>
    <I>Thu Sep 22 22:31:59 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025249.html">[squid-users] Fwd: Squid shutdown on web request of type http://ftp.domain.country
</A></li>
        <LI>Next message (by thread): <A HREF="025251.html">[squid-users] Use ICP RTT with HTTPS request
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25250">[ date ]</a>
              <a href="thread.html#25250">[ thread ]</a>
              <a href="subject.html#25250">[ subject ]</a>
              <a href="author.html#25250">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 9/22/22 18:07, Francisco wrote:
&gt;<i> I have compiled and installed Squid proxy (version 5.6) on Debian 11. 
</I>&gt;<i> When I enable certain response size control rules 
</I>&gt;<i> (/*reply_body_max_size*/), Squid stops instantly when making a web 
</I>&gt;<i> request to web-serving FTPs (for example: <A HREF="http://ftp.sld.cu">http://ftp.sld.cu</A> 
</I>&gt;<i> it&#180;s a FTP site served as HTTP), only happen with this kind of site.
</I>
&gt;<i> In /var/log/kernel.log I founded: [squid][500]: segfault at 448 ip 
</I>
Squid segmentation faults are usually Squid bugs. Please consider filing 
a bug report with Squid bugzilla and attaching a backtrace from the 
coredump file there. Please keep the coredump file for further analysis.

There is some old information about enabling and examining coredumps at 
the FAQ URL below, but you can use your OS documentation as well:
<A HREF="https://wiki.squid-cache.org/SquidFaq/BugReporting#crashes_and_core_dumps">https://wiki.squid-cache.org/SquidFaq/BugReporting#crashes_and_core_dumps</A>

Upgrading to Squid v5.7 first is a good idea, but it may not address 
this specific bug.


Thank you,

Alex.


&gt;<i> I have the following acl:
</I>&gt;<i> 
</I>&gt;<i> |acl usuarios_nav_basica proxy_auth &quot;/etc/squid/usuarios/nav-basica&quot; acl 
</I>&gt;<i> usuarios_internet proxy_auth &quot;/etc/squid/usuarios/nav-internet&quot; acl 
</I>&gt;<i> usuarios_admins proxy_auth &quot;/etc/squid/usuarios/admins&quot; acl dominio_cuba 
</I>&gt;<i> dstdomain .cu acl dominio_infomed dstdomain .sld.cu &lt;<A HREF="http://sld.cu">http://sld.cu</A>&gt; acl 
</I>&gt;<i> dominio_bandec dstdomain .bandec.cu &lt;<A HREF="http://bandec.cu">http://bandec.cu</A>&gt; #thousands of 
</I>&gt;<i> domains acl dominios dstdomain &quot;/etc/squid/infomed/dominios&quot; acl 
</I>&gt;<i> dominios_parciales dstdomain &quot;/etc/squid/infomed/dominios_parciales&quot; 
</I>&gt;<i> #thousands of sites acl sitios url_regex -i &quot;/etc/squid/infomed/sitios&quot; 
</I>&gt;<i> acl horario_manhana time MTWHFA 00:00-11:59 acl extensiones_media 
</I>&gt;<i> urlpath_regex -i \.(mpg|mp3|avi|mp4|mov|m4v|mkv|flv)(\?.*)?$ acl 
</I>&gt;<i> extensiones_limitadas urlpath_regex -i \.(exe|cab|msi|iso)(\?.*)?$ 
</I>&gt;<i> cache_peer XXX.XXX.XXX.XXX parent 3128 0 no-query default 
</I>&gt;<i> cache_peer_access XXX.XXX.XXX.XXX allow !dominio_infomed always_direct 
</I>&gt;<i> allow dominio_infomed never_direct allow !dominio_infomed |
</I>&gt;<i> 
</I>&gt;<i> When I activate these rules, Squid shuts down:
</I>&gt;<i> 
</I>&gt;<i> |reply_body_max_size 5 MB extensiones_media usuarios_internet 
</I>&gt;<i> horario_manhana !dominio_cuba !dominios !dominios_parciales !sitios 
</I>&gt;<i> reply_body_max_size 5 MB extensiones_limitadas usuarios_internet 
</I>&gt;<i> horario_manhana !dominio_cuba !dominios !dominios_parciales !sitios ## 
</I>&gt;<i> Usuarios de navegacion basica reply_body_max_size 50 MB 
</I>&gt;<i> usuarios_nav_basica horario_manhana !dominio_infomed dominio_cuba 
</I>&gt;<i> reply_body_max_size 50 MB usuarios_nav_basica horario_manhana dominios 
</I>&gt;<i> !dominio_infomed reply_body_max_size 50 MB usuarios_nav_basica 
</I>&gt;<i> horario_manhana !dominio_infomed dominios_parciales reply_body_max_size 
</I>&gt;<i> 50 MB usuarios_nav_basica horario_manhana !dominio_infomed sitios 
</I>&gt;<i> reply_body_max_size 100 MB usuarios_nav_basica !horario_manhana 
</I>&gt;<i> !dominio_infomed dominio_cuba reply_body_max_size 100 MB 
</I>&gt;<i> usuarios_nav_basica !horario_manhana !dominio_infomed dominios 
</I>&gt;<i> reply_body_max_size 100 MB usuarios_nav_basica !horario_manhana 
</I>&gt;<i> !dominio_infomed dominios_parciales reply_body_max_size 100 MB 
</I>&gt;<i> usuarios_nav_basica !horario_manhana !dominio_infomed sitios ## Usuarios 
</I>&gt;<i> con acceso a internet reply_body_max_size 50 MB usuarios_internet 
</I>&gt;<i> horario_manhana !dominio_infomed dominio_cuba reply_body_max_size 50 MB 
</I>&gt;<i> usuarios_internet horario_manhana !dominio_infomed dominios 
</I>&gt;<i> reply_body_max_size 50 MB usuarios_internet horario_manhana 
</I>&gt;<i> !dominio_infomed dominios_parciales reply_body_max_size 50 MB 
</I>&gt;<i> usuarios_internet horario_manhana !dominio_infomed sitios 
</I>&gt;<i> reply_body_max_size 100 MB usuarios_internet horario_manhana 
</I>&gt;<i> !dominio_cuba reply_body_max_size 100 MB usuarios_internet 
</I>&gt;<i> horario_manhana !dominios reply_body_max_size 100 MB usuarios_internet 
</I>&gt;<i> horario_manhana !dominios_parciales reply_body_max_size 100 MB 
</I>&gt;<i> usuarios_internet horario_manhana !sitios reply_body_max_size 1024 MB 
</I>&gt;<i> usuarios_internet !horario_manhana !dominio_cuba reply_body_max_size 
</I>&gt;<i> 1024 MB usuarios_internet !horario_manhana !dominios reply_body_max_size 
</I>&gt;<i> 1024 MB usuarios_internet !horario_manhana !dominios_parciales 
</I>&gt;<i> reply_body_max_size 1024 MB usuarios_internet !horario_manhana !sitios 
</I>&gt;<i> reply_body_max_size 200 KB all |
</I>&gt;<i> 
</I>&gt;<i> When I make |systemctl status squid|, it show Exiting due to repeated, 
</I>&gt;<i> frequent failures. In /var/log/squid/cache.log I don&#180;t found any about 
</I>&gt;<i> the error.
</I>&gt;<i> 
</I>&gt;<i>  &#160;In /var/log/kernel.log I founded: [squid][500]: segfault at 448 ip 
</I>&gt;<i> 00005653d5ec933a sp 0000fffdf9374730 error 4 in squid [5653d5c950000+4c0000]
</I>&gt;<i> 
</I>&gt;<i> *Note*: If I leave the two first |reply_body_max_size|&#160;rules 
</I>&gt;<i> declarations, it&#180;s work ok!!!
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025249.html">[squid-users] Fwd: Squid shutdown on web request of type http://ftp.domain.country
</A></li>
	<LI>Next message (by thread): <A HREF="025251.html">[squid-users] Use ICP RTT with HTTPS request
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25250">[ date ]</a>
              <a href="thread.html#25250">[ thread ]</a>
              <a href="subject.html#25250">[ subject ]</a>
              <a href="author.html#25250">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
