<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Use ICP RTT with HTTPS request
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Use%20ICP%20RTT%20with%20HTTPS%20request&In-Reply-To=%3C44da60ba-d691-06ba-22c6-4e95ad6b9fc5%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025251.html">
   <LINK REL="Next"  HREF="025254.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Use ICP RTT with HTTPS request</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Use%20ICP%20RTT%20with%20HTTPS%20request&In-Reply-To=%3C44da60ba-d691-06ba-22c6-4e95ad6b9fc5%40measurement-factory.com%3E"
       TITLE="[squid-users] Use ICP RTT with HTTPS request">rousskov at measurement-factory.com
       </A><BR>
    <I>Fri Sep 23 14:52:38 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025251.html">[squid-users] Use ICP RTT with HTTPS request
</A></li>
        <LI>Next message (by thread): <A HREF="025254.html">[squid-users] Use ICP RTT with HTTPS request
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25252">[ date ]</a>
              <a href="thread.html#25252">[ thread ]</a>
              <a href="subject.html#25252">[ subject ]</a>
              <a href="author.html#25252">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 9/23/22 10:30, Th&#233;o BARRAGUE wrote:

&gt;<i> How can I say &quot;please, use ICP for RTT sharing like you did with
</I>&gt;<i> HTTP&quot; ?
</I>
AFAICT, Squid tries to use NetDB on both HTTP and HTTPS paths, but 
something probably goes wrong somewhere. The easiest way to figure this 
out may be to analyze debugging cache.log while reproducing the problem 
with a single transaction.

<A HREF="https://wiki.squid-cache.org/SquidFaq/BugReporting#Debugging_a_single_transaction">https://wiki.squid-cache.org/SquidFaq/BugReporting#Debugging_a_single_transaction</A>

Beyond that, I do not have any good triage ideas. You may want to share 
Cache Manager mgr:server_list page for additional clues. Does changing 
the order of cache_peer lines in squid.conf change the outcome?


Cheers,

Alex.



&gt;<i> I'm trying to setup ICP exchange with HTTPS request.
</I>&gt;<i> With my current setup (no ssl bumping) I can't use ICP for cache but it 
</I>&gt;<i> may be possible for RTT.
</I>&gt;<i> My goal is to use the closest parent to establish the connection.
</I>&gt;<i> 
</I>&gt;<i> My configuration look like :
</I>&gt;<i> 
</I>&gt;<i>     cache_peer 127.0.0.1 parent 3129 3131 no-digest proxy-only
</I>&gt;<i>     name=same-server
</I>&gt;<i>     cache_peer_access same-server allow all
</I>&gt;<i> 
</I>&gt;<i>     cache_peer w.x.y.z parent 3129 3131 no-digest proxy-only
</I>&gt;<i>     name=pair-server
</I>&gt;<i>     cache_peer_access pair-server allow all
</I>&gt;<i> 
</I>&gt;<i>     query_icmp on
</I>&gt;<i>     never_direct allow all
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> It works great for http, when I curl for the first time i got that :
</I>&gt;<i> 
</I>&gt;<i>     same-server
</I>&gt;<i>     Network &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;recv/sent &#160; &#160; RTT
</I>&gt;<i>      &#160;Hops Hostnames
</I>&gt;<i>     142.251.40.0 &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;1/ &#160; 1 &#160; 121.0
</I>&gt;<i>      &#160;14.0 www.google.fr
</I>&gt;<i> 
</I>&gt;<i>     pair-server
</I>&gt;<i>     Network &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;recv/sent &#160; &#160; RTT
</I>&gt;<i>      &#160;Hops Hostnames
</I>&gt;<i>     172.253.122.0 &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; 1/ &#160; 1 &#160; &#160;94.0
</I>&gt;<i>      &#160;23.0 www.google.fr &lt;<A HREF="http://www.google.fr">http://www.google.fr</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Next requests will go through pair-server, example :
</I>&gt;<i> 
</I>&gt;<i>     same-server
</I>&gt;<i>     Network &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;recv/sent &#160; &#160; RTT
</I>&gt;<i>      &#160;Hops Hostnames
</I>&gt;<i>     142.251.40.0 &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;1/ &#160; 1 &#160; 121.0
</I>&gt;<i>      &#160;14.0 www.google.fr
</I>&gt;<i> 
</I>&gt;<i>     pair-server
</I>&gt;<i>     Network &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;recv/sent &#160; &#160; RTT
</I>&gt;<i>      &#160;Hops Hostnames
</I>&gt;<i>     172.253.122.0 &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;10/ &#160;10 &#160; &#160;93.1
</I>&gt;<i>      &#160;23.0 www.google.fr &lt;<A HREF="http://www.google.fr">http://www.google.fr</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> But for HTTPS, squid is able to determine hostname and network but 
</I>&gt;<i> doesn't care about RTT sharing :
</I>&gt;<i> 
</I>&gt;<i>     same-server
</I>&gt;<i>     Network &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;recv/sent &#160; &#160; RTT
</I>&gt;<i>      &#160;Hops Hostnames
</I>&gt;<i>     149.202.190.0&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; 10/ &#160; 1 &#160; &#160; 6.0
</I>&gt;<i>      &#160;15.0 api.gouv.fr
</I>&gt;<i> 
</I>&gt;<i>     pair-server
</I>&gt;<i>     Network &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;recv/sent &#160; &#160; RTT
</I>&gt;<i>      &#160;Hops Hostnames
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Even if I force a request though the pair-server to initiate NetDB, ICP 
</I>&gt;<i> not used.
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025251.html">[squid-users] Use ICP RTT with HTTPS request
</A></li>
	<LI>Next message (by thread): <A HREF="025254.html">[squid-users] Use ICP RTT with HTTPS request
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25252">[ date ]</a>
              <a href="thread.html#25252">[ thread ]</a>
              <a href="subject.html#25252">[ subject ]</a>
              <a href="author.html#25252">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
