<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Enable caching
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Enable%20caching&In-Reply-To=%3C1171a8a3-bf15-67ca-1635-64f8ef425c57%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025726.html">
   <LINK REL="Next"  HREF="025731.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Enable caching</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Enable%20caching&In-Reply-To=%3C1171a8a3-bf15-67ca-1635-64f8ef425c57%40measurement-factory.com%3E"
       TITLE="[squid-users] Enable caching">rousskov at measurement-factory.com
       </A><BR>
    <I>Wed Apr  5 13:27:07 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025726.html">[squid-users] Enable caching
</A></li>
        <LI>Next message (by thread): <A HREF="025731.html">[squid-users] Enable caching
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25727">[ date ]</a>
              <a href="thread.html#25727">[ thread ]</a>
              <a href="subject.html#25727">[ subject ]</a>
              <a href="author.html#25727">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 4/5/23 06:07, Andrey K wrote:

&gt;<i> Previously, caching was disabled on our proxy servers. Now we need to 
</I>&gt;<i> cache some content (files about 10 MB in size).
</I>&gt;<i> So we changed the squid.conf:
</I>
&gt;<i> cache_dir ufs /data/squid/cache 32000 16 256 max-size=12000000
</I>&gt;<i> 
</I>&gt;<i> We have 24 workers on each proxy.
</I>
UFS-based cache_dirs are not supported in multi-worker configurations 
and, in most cases, should not be used in such configurations. The 
combination will violate basic HTTP caching rules and may crash Squid 
and/or corrupt responses.


&gt;<i> We saw that some requests were taken from the cache, and some were not.
</I>&gt;<i> The documentation&#160;says:
</I>&gt;<i> &quot;In SMP configurations, cache_dir must not precede the workers option 
</I>&gt;<i> and should use configuration macros or conditionals to give each worker 
</I>&gt;<i> interested in disk caching a dedicated cache directory.&quot;
</I>
The official documentation quoted above is stale and very misleading in 
modern Squids. Ignore it. I will try to find the time to post a PR to 
fix this.


&gt;<i> So we switched to a rock cache_dir:
</I>&gt;<i> cache_dir rock /data/squid/cache 32000 max-size=12000000
</I>&gt;<i> 
</I>&gt;<i> Now everything seems to be working fine in the test environment, but I 
</I>&gt;<i> found limitations on the RockStore 
</I>&gt;<i> (<A HREF="https://wiki.squid-cache.org/Features/RockStore:">https://wiki.squid-cache.org/Features/RockStore:</A>
</I>&gt;<i> &quot;Objects larger than 32,000 bytes cannot be cached when cache_dirs are 
</I>&gt;<i> shared among workers.&quot;
</I>
The Feature/RockStore page is stale and can easily mislead. In general, 
Feature/Foo wiki pages are often development-focused and get stale with 
time. They cannot be reliably used as a Squid feature documentation.


&gt;<i> Does this mean that&#160;RockStore&#160;is not suitable for caching large files?
</I>
No, it does not. Rock storage has evolved since that Feature page was 
written. You can see the following wiki page discussing evolved rock 
storage design, but that page probably has some stale info as well:
<A HREF="https://wiki.squid-cache.org/Features/LargeRockStore">https://wiki.squid-cache.org/Features/LargeRockStore</A>


&gt;<i> Should I switch back&#160;to the UFS and configure 24 cache_dirs
</I>
If everything is &quot;working fine&quot;, then you should not. Otherwise, I 
recommend discussing specific problems before switching to that 
unsupported and dangerous hack.


HTH,

Alex.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025726.html">[squid-users] Enable caching
</A></li>
	<LI>Next message (by thread): <A HREF="025731.html">[squid-users] Enable caching
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25727">[ date ]</a>
              <a href="thread.html#25727">[ thread ]</a>
              <a href="subject.html#25727">[ subject ]</a>
              <a href="author.html#25727">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
