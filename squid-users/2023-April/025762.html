<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] General Questions in squid 4.x
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20General%20Questions%20in%20squid%204.x&In-Reply-To=%3C716a9dc3-4b28-14d0-3e73-1e70b1c85681%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025761.html">
   <LINK REL="Next"  HREF="025766.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] General Questions in squid 4.x</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20General%20Questions%20in%20squid%204.x&In-Reply-To=%3C716a9dc3-4b28-14d0-3e73-1e70b1c85681%40measurement-factory.com%3E"
       TITLE="[squid-users] General Questions in squid 4.x">rousskov at measurement-factory.com
       </A><BR>
    <I>Thu Apr 13 01:35:41 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025761.html">[squid-users] General Questions in squid 4.x
</A></li>
        <LI>Next message (by thread): <A HREF="025766.html">[squid-users] Help to understand tcp_denied in access.log
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25762">[ date ]</a>
              <a href="thread.html#25762">[ thread ]</a>
              <a href="subject.html#25762">[ subject ]</a>
              <a href="author.html#25762">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 4/12/23 17:37, Dr.X wrote:

&gt;<i> Question #1:
</I>&gt;<i> 
</I>&gt;<i> My Squid server is working fine, but we accidentally removed the conf 
</I>&gt;<i> file. The service is still running without any issues, but if we stop 
</I>&gt;<i> it, we won't be able to power it up again as no conf file exists. Is 
</I>&gt;<i> there a file dropped in RAM or somewhere else where we can retrieve the 
</I>&gt;<i> configuration file?
</I>
Short answer: No.

If your Squid was configured to allow mgr:config cache manager queries, 
then you can get a &quot;configuration dump&quot; from the running Squid. However, 
code dumping configuration has many bugs and design flaws, so you will 
only get something that kind of resemblance the original configuration. 
You will not be able to copy-paste that output to restore the lost 
configuration.

If your Squid was configured to deny mgr:config queries (that is the 
default IIRC), then you might still be able to get the configuration 
dump mentioned above by attaching a debugging to the running Squid 
instance and adjusting Squid memory state to allow such queries, but 
doing so requires developer-level knowledge (and will freeze the Squid 
worker while you are modifying its state). I am only mentioning this 
developer-focused option for completeness sake.

See cachemgr_passwd directive documentation for more details about 
protected cache manager queries:
<A HREF="http://www.squid-cache.org/Doc/config/cachemgr_passwd/">http://www.squid-cache.org/Doc/config/cachemgr_passwd/</A>


&gt;<i> Question #2:
</I>&gt;<i> 
</I>&gt;<i> I believe there are some Squid config directives that are added by 
</I>&gt;<i> default to squid.conf and are hidden in the config file. Is there a way 
</I>&gt;<i> to check all the Squid directives that are loaded, whether they are 
</I>&gt;<i> hidden or not?
</I>
A clarification for the question itself: Nothing is secretly added to 
your squid.conf file, but, yes, Squid does apply a lot of defaults and, 
to a certain extent, they are treated as if Squid found them in your 
squid.conf file.

With that clarification in mind, the short answer to your question is &quot;No&quot;.

You can get a sense of most of the directive defaults by searching for 
&quot;Default:&quot; lines in squid.conf.documented, but many of those defaults 
require manual interpretation. Some of the defaults cannot be expressed 
as squid.conf directives.

Another way to look at the &quot;active&quot; or &quot;actual&quot; configuration is the 
mgr:config dump mentioned in Q1, with all its deficiencies. That dump 
does not show some of the defaults.


&gt;<i> Question #3:
</I>&gt;<i> 
</I>&gt;<i> If we start Squid but mistakenly start it again, we receive the error 
</I>&gt;<i> message below:
</I>&gt;<i> 
</I>&gt;<i> 2023/04/12 17:33:52| FATAL: squid is already running: Found fresh 
</I>&gt;<i> instance PID file (/var/run/squidtest.pid) with PID 959949
</I>
Yes, that is correct/expected behavior.


&gt;<i> As a result, the old service becomes dead,
</I>
That should not be happening. If by &quot;service&quot; you mean &quot;squid instance&quot;, 
and you can reproduce this &quot;old service become dead&quot; problem with Squid 
v5+, then please file a bug report with the instructions on how to 
reproduce, preferably without using OS-specific service commands. The 
expected behavior is that the old Squid instance continues to run as if 
nothing happened.

There were related bugs in earlier Squid versions that prevented clean 
behavior during such &quot;competing&quot; startups, but no such bugs are known in 
Squid v5+ IIRC.


&gt;<i> Is there any Squid directive that prevents the instance from 
</I>&gt;<i> crashing in case we accidentally start it again?
</I>  The second concurrently started instance should quit (with an error 
message similar to the one you have shared above) without lasting side 
effects (other than logging to console or syslog), and before it starts 
accepting or generating traffic. Resources permitting, the first 
instance should continue running as if nothing happened. Anything else 
is a misconfiguration or a bug.


HTH,

Alex.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025761.html">[squid-users] General Questions in squid 4.x
</A></li>
	<LI>Next message (by thread): <A HREF="025766.html">[squid-users] Help to understand tcp_denied in access.log
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25762">[ date ]</a>
              <a href="thread.html#25762">[ thread ]</a>
              <a href="subject.html#25762">[ subject ]</a>
              <a href="author.html#25762">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
