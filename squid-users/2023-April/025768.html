<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] logging: TCP connection to x.x.x.x/3128 failed
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20logging%3A%20TCP%20connection%20to%20x.x.x.x/3128%20failed&In-Reply-To=%3CZDkdDLHlDU0APBp5%40waldemar-brodkorb.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025733.html">
   <LINK REL="Next"  HREF="025770.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] logging: TCP connection to x.x.x.x/3128 failed</H1>
    <B>Waldemar Brodkorb</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20logging%3A%20TCP%20connection%20to%20x.x.x.x/3128%20failed&In-Reply-To=%3CZDkdDLHlDU0APBp5%40waldemar-brodkorb.de%3E"
       TITLE="[squid-users] logging: TCP connection to x.x.x.x/3128 failed">wbx at openadk.org
       </A><BR>
    <I>Fri Apr 14 09:29:48 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025733.html">[squid-users] logging: TCP connection to x.x.x.x/3128 failed
</A></li>
        <LI>Next message (by thread): <A HREF="025770.html">[squid-users] logging: TCP connection to x.x.x.x/3128 failed
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25768">[ date ]</a>
              <a href="thread.html#25768">[ thread ]</a>
              <a href="subject.html#25768">[ subject ]</a>
              <a href="author.html#25768">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Alex,
Alex Rousskov wrote,

&gt;<i> On 4/6/23 06:41, Waldemar Brodkorb wrote:
</I>&gt;<i> 
</I>&gt;<i> &gt; There is still one assertion which happens sometimes:
</I>&gt;<i> &gt; cache.log:2023/04/06 07:24:48 kid1| assertion failed: ../src/base/CbcPointer.h:181: &quot;EX&quot;
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Have you ever seen this in the wild? What does it mean?
</I>&gt;<i> 
</I>&gt;<i> This low-level assertion (where &quot;EX&quot; is usually spelled as &quot;c&quot;) corresponds
</I>&gt;<i> to many high-level Squid bugs, most of them fixed. Please see
</I>&gt;<i> <A HREF="https://bugs.squid-cache.org/show_bug.cgi?id=5265#c1">https://bugs.squid-cache.org/show_bug.cgi?id=5265#c1</A> for the suggested next
</I>&gt;<i> steps.
</I>
We have a core dump now. Ubuntu 22.04 with Squid 5.8.

gdb /usr/sbin/squid core.13.873301.1681462147 
GNU gdb (Ubuntu 12.1-0ubuntu1~22.04) 12.1
Copyright (C) 2022 Free Software Foundation, Inc.                                                                                                                                                                   
License GPLv3+: GNU GPL version 3 or later &lt;<A HREF="http://gnu.org/licenses/gpl.html">http://gnu.org/licenses/gpl.html</A>&gt;                                                                                                                                       
This is free software: you are free to change and redistribute it.                                                                                                                                                  
There is NO WARRANTY, to the extent permitted by law.                                                                                                                                                               
Type &quot;show copying&quot; and &quot;show warranty&quot; for details.                                                                                                                                                                
This GDB was configured as &quot;x86_64-linux-gnu&quot;.                                                                                                                                                                      
Type &quot;show configuration&quot; for configuration details.                                                                                                                                                                
For bug reporting instructions, please see:                                                                                                                                                                         
&lt;<A HREF="https://www.gnu.org/software/gdb/bugs/">https://www.gnu.org/software/gdb/bugs/</A>&gt;.                                                                                                                                                                           
Find the GDB manual and other documentation resources online at:                                                                                                                                                    
    &lt;<A HREF="http://www.gnu.org/software/gdb/documentation/">http://www.gnu.org/software/gdb/documentation/</A>&gt;.                                                                                                                                                               

For help, type &quot;help&quot;.                                                                                                                                                  
Type &quot;apropos word&quot; to search for commands related to &quot;word&quot;...                                                                                                                                                     
Reading symbols from /usr/sbin/squid...                                                                                                                                                                             
Reading symbols from /usr/lib/debug/.build-id/4d/655715326bdce358de6a95a564b6e4e                                                                                                                                    ec84d5e.debug...                                                                                                                                                                                                    
[New LWP 873301]                                                                                                                                
[Thread debugging using libthread_db enabled]                                                                                                                                                                       
Using host libthread_db library &quot;/lib/x86_64-linux-gnu/libthread_db.so.1&quot;.                                                                                                                                          
Core was generated by `(squid-1) --kid squid-1 --foreground -sYC'.                                                                                                                                                  
Program terminated with signal SIGABRT, Aborted.                                                                                                                                                                    
--Type &lt;RET&gt; for more, q to quit, c to continue without paging--                                                                                                                                                    
#0  __pthread_kill_implementation (no_tid=0, signo=6, threadid=140419666299392)                                                                                                                                     
    at ./nptl/pthread_kill.c:44                                                                                                                                                                             
44      ./nptl/pthread_kill.c: No such file or directory.                                                                                                                                                           
(gdb) bt full                                                                                                                       
#0  __pthread_kill_implementation (no_tid=0, signo=6, threadid=140419666299392)                                                                                                                                     
    at ./nptl/pthread_kill.c:44                                                                                                                                                                             
        tid = &lt;optimized out&gt;                                                                                                                                                                       
        ret = 0                                                                                                                             
        pd = 0x7fb600544a00                                                                                                                                                                 
        old_mask = {__val = {94534848520128, 94535132367528, 94533992246864,                                                                                                                                        
            94532923700193, 94532920519424, 94532966275696, 94533267707520,                                                                                                                                         
            140419709921070, 94534848520128, 0, 140723926211296,                                                                                                                                                    
            94532958412936, 0, 8, 26902275, 140419709808628}}                                                                                                                                                       
        ret = &lt;optimized out&gt;                                                                                                                                                                       
        pd = &lt;optimized out&gt;                                                                                                                                                                    
        old_mask = &lt;optimized out&gt;                                                                                                                                                                                  
        ret = &lt;optimized out&gt;                                                                                                                                                                       
        tid = &lt;optimized out&gt;                                                                                                                                                                       
        ret = &lt;optimized out&gt;                                                                                                                                                                       
        resultvar = &lt;optimized out&gt;                                                                                                                                                                                 
        resultvar = &lt;optimized out&gt;                                                                                                                                                                                 
        __arg3 = &lt;optimized out&gt;                                                                                                                                                                                
        __arg2 = &lt;optimized out&gt;                                                                                                                                                                                
        __arg1 = &lt;optimized out&gt;                                                                                                                                                                                
        _a3 = &lt;optimized out&gt;                                                                                                                                                                       
        _a2 = &lt;optimized out&gt;
        _a1 = &lt;optimized out&gt;                                                                                                                                                                       
--Type &lt;RET&gt; for more, q to quit, c to continue without paging--                                                                                                                                                    
        __futex = &lt;optimized out&gt;                                                                                                                                                                                   
        resultvar = &lt;optimized out&gt;                                                                                                                                                                                 
        __arg3 = &lt;optimized out&gt;                                                                                                                                                                                
        __arg2 = &lt;optimized out&gt;                                                                                                                                                                                
        __arg1 = &lt;optimized out&gt;                                                                                                                                                                                
        _a3 = &lt;optimized out&gt;                                                                                                                                                                       
        _a2 = &lt;optimized out&gt;                                                                                                                                                                       
        _a1 = &lt;optimized out&gt;                                                                                                                                                                       
        __futex = &lt;optimized out&gt;                                                                                                                                                                                   
        __private = &lt;optimized out&gt;                                                                                                                                                                                 
        __oldval = &lt;optimized out&gt;                                                                                                                                                                                  
        result = &lt;optimized out&gt;                                                                                                                                                                                
#1  __pthread_kill_internal (signo=6, threadid=140419666299392)                                                                                                                                                     
    at ./nptl/pthread_kill.c:78                                                                                                                                                                             
No locals.                                                                                                              
#2  __GI___pthread_kill (threadid=140419666299392, signo=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">signo at entry</A>=6)                                                                                                                                             
    at ./nptl/pthread_kill.c:89                                                                                                                                                                             
No locals.                                                                                                              

#3  0x00007fb602aa7476 in __GI_raise (sig=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">sig at entry</A>=6)                                                                                                                                                              
    at ../sysdeps/posix/raise.c:26                                                                                                                                                                                  
        ret = &lt;optimized out&gt;                                                                                                                                                                       
#4  0x00007fb602a8d7f3 in __GI_abort () at ./stdlib/abort.c:79                                                                                                                                                      
        save_stage = 1                                                                                                                                                  
--Type &lt;RET&gt; for more, q to quit, c to continue without paging--
        act = {__sigaction_handler = {sa_handler = 0x55fa2959746f,                                                                                                                                                  
            sa_sigaction = 0x55fa2959746f}, sa_mask = {__val = {                                                                                                                                                    
              18446744073709551288, 11, 140723926211456, 94532958412928, 181,                                                                                                                                       
              94532923913327, 140419705906387, 140723926211472,                                                                                                                                                     
              140723926211456, 94532958412928, 94532925905808,                                                                                                                                                      
              140723926211472, 94532920570578, 94533607213200, 99, 99}},                                                                                                                                            
          sa_flags = 1335251568, sa_restorer = 0x55fa2959746f}                                                                                                                                                      
        sigs = {__val = {32, 0, 94533607213200, 6, 99, 140723926211136,                                                                                                                                             
            94532958413328, 0, 99, 16762180390345294848, 94532958413040,                                                                                                                                            
            140723926211456, 0, 94532958413328, 99, 16762180390345294848}}                                                                                                                                          
#5  0x000055fa29124e55 in xassert (msg=&lt;optimized out&gt;, file=&lt;optimized out&gt;,                                                                                                                                       
    line=&lt;optimized out&gt;) at ./src/debug.cc:624                                                                                                                                                                     
        __FUNCTION__ = &lt;optimized out&gt;                                                                                                                                                                              
#6  0x000055fa29118734 in CbcPointer&lt;BodyProducer&gt;::operator-&gt; (                                                                                                                                                    
    this=&lt;optimized out&gt;) at ../src/base/CbcPointer.h:181                                                                                                                                                           
        c = &lt;optimized out&gt;                                                                                                                                                                 
#7  CbcPointer&lt;BodyConsumer&gt;::operator-&gt; (this=&lt;optimized out&gt;)                                                                                                                                                     
    at ../src/base/CbcPointer.h:178                                                                                                                                                                                 
        c = &lt;optimized out&gt;                                                                                                                                                                 
        c = &lt;optimized out&gt;                                                                                                                                                                 
#8  JobDialer&lt;BodyConsumer&gt;::dial (call=..., this=&lt;optimized out&gt;)                                                                                                                                                  
    at base/AsyncJobCalls.h:182                                                                                                                                                                             
        __FUNCTION__ = &lt;optimized out&gt;                                                                                                                                                                              
--Type &lt;RET&gt; for more, q to quit, c to continue without paging--
#9  AsyncCallT&lt;BodyConsumerDialer&gt;::fire (this=0x55fa4f965270)                                                                                                                                                      
    at ../src/base/AsyncCall.h:145                                                                                                                                                                                  
No locals.                                                                                                              
#10 0x000055fa293cfaab in AsyncCallQueue::fireNext (this=&lt;optimized out&gt;)                                                                                                                                           
    at base/../../src/base/RefCount.h:73                                                                                                                                                                            
        call = {p_ = 0x55fa4f965270}                                                                                                                                                                                
        __FUNCTION__ = &lt;optimized out&gt;
#11 0x000055fa293d189a in AsyncCallQueue::fire (this=0x55fa2b930a20)
    at base/AsyncCallQueue.cc:43
        made = true
#12 0x000055fa291ad500 in EventLoop::dispatchCalls (this=0x7ffcd7a21ef0)
    at ./src/EventLoop.cc:144
        dispatchedSome = &lt;optimized out&gt;
#13 EventLoop::runOnce (this=0x7ffcd7a21ef0) at ./src/EventLoop.cc:121
        sawActivity = &lt;optimized out&gt;
        waitingEngine = 0x7ffcd7a21e30
        __FUNCTION__ = &lt;optimized out&gt;
#14 0x000055fa292b5f10 in EventLoop::run (this=0x7ffcd7a21ef0)
    at ./src/EventLoop.cc:83
No locals.
#15 SquidMain (argc=&lt;optimized out&gt;, argv=&lt;optimized out&gt;)
    at ./src/main.cc:1719
        cmdLine = {argv_ = std::vector of length 6, capacity 6 = {
--Type &lt;RET&gt; for more, q to quit, c to continue without paging--
            0x55fa29977220 &quot;(squid-1)&quot;, 0x55fa299772e0 &quot;--kid&quot;, 
            0x55fa299773a0 &quot;squid-1&quot;, 0x55fa29977460 &quot;--foreground&quot;, 
            0x55fa29977520 &quot;-sYC&quot;, 0x0}, 
          shortOptions_ = 0x55fa299a2450 &quot;CDFNRSYXa:d:f:hk:m::n:sl:u:vz?&quot;, 
          longOptions_ = std::vector of length 5, capacity 8 = {{&lt;option&gt; = {
                name = 0x55fa29977cc0 &quot;foreground&quot;, has_arg = 0, flag = 0x0, 
                val = 2}, &lt;No data fields&gt;}, {&lt;option&gt; = {
                name = 0x55fa299778e0 &quot;kid&quot;, has_arg = 1, flag = 0x0, 
                val = 3}, &lt;No data fields&gt;}, {&lt;option&gt; = {
                name = 0x55fa299779a0 &quot;help&quot;, has_arg = 0, flag = 0x0, 
                val = 104}, &lt;No data fields&gt;}, {&lt;option&gt; = {
                name = 0x55fa29977a80 &quot;version&quot;, has_arg = 0, flag = 0x0, 
                val = 118}, &lt;No data fields&gt;}, {&lt;option&gt; = {name = 0x0, 
                has_arg = 0, flag = 0x0, val = 0}, &lt;No data fields&gt;}}}
        WIN32_init_err = 0
        mainLoop = {errcount = 0, static Running = 0x7ffcd7a21ef0, 
          last_loop = false, engines = std::vector of length 4, capacity 4 = {
            0x7ffcd7a21e70, 0x55fa296e8fd0 &lt;EventScheduler::_instance&gt;, 
            0x7ffcd7a21e50, 0x7ffcd7a21e30}, timeService = 0x7ffcd7a21da8, 
          primaryEngine = 0x7ffcd7a21e30, loop_delay = 0, error = false, 
          runOnceResult = false}
        signalEngine = {&lt;AsyncEngine&gt; = {
            _vptr.AsyncEngine = 0x55fa296e1e50 &lt;vtable for SignalEngine+16&gt;}, &lt;N--Type &lt;RET&gt; for more, q to quit, c to continue without paging--
o data fields&gt;}
        store_engine = {&lt;AsyncEngine&gt; = {
            _vptr.AsyncEngine = 0x55fa296c8310 &lt;vtable for StoreRootEngine+16&gt;}, &lt;No data fields&gt;}
        comm_engine = {&lt;AsyncEngine&gt; = {
            _vptr.AsyncEngine = 0x55fa296e1e28 &lt;vtable for CommSelectEngine+16&gt;}, &lt;No data fields&gt;}
        time_engine = {
          _vptr.TimeEngine = 0x55fa296e2480 &lt;vtable for TimeEngine+16&gt;}
        __FUNCTION__ = &lt;optimized out&gt;
#16 0x000055fa291524e6 in SquidMainSafe (argv=0x7ffcd7a22208, argc=5)
    at ./src/main.cc:1406
        __FUNCTION__ = &lt;optimized out&gt;
#17 main (argc=5, argv=0x7ffcd7a22208) at ./src/main.cc:1394
No locals.
(gdb) 

Do you can see where the bug is?

best regards
 Waldemar

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025733.html">[squid-users] logging: TCP connection to x.x.x.x/3128 failed
</A></li>
	<LI>Next message (by thread): <A HREF="025770.html">[squid-users] logging: TCP connection to x.x.x.x/3128 failed
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25768">[ date ]</a>
              <a href="thread.html#25768">[ thread ]</a>
              <a href="subject.html#25768">[ subject ]</a>
              <a href="author.html#25768">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
