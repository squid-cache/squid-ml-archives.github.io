<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] logging: TCP connection to x.x.x.x/3128 failed
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20logging%3A%20TCP%20connection%20to%20x.x.x.x/3128%20failed&In-Reply-To=%3Ccef825ed-fca1-550c-5e17-4acf9bd6caf8%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025768.html">
   <LINK REL="Next"  HREF="025805.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] logging: TCP connection to x.x.x.x/3128 failed</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20logging%3A%20TCP%20connection%20to%20x.x.x.x/3128%20failed&In-Reply-To=%3Ccef825ed-fca1-550c-5e17-4acf9bd6caf8%40measurement-factory.com%3E"
       TITLE="[squid-users] logging: TCP connection to x.x.x.x/3128 failed">rousskov at measurement-factory.com
       </A><BR>
    <I>Fri Apr 14 13:40:34 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025768.html">[squid-users] logging: TCP connection to x.x.x.x/3128 failed
</A></li>
        <LI>Next message (by thread): <A HREF="025805.html">[squid-users] logging: TCP connection to x.x.x.x/3128 failed
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25770">[ date ]</a>
              <a href="thread.html#25770">[ thread ]</a>
              <a href="subject.html#25770">[ subject ]</a>
              <a href="author.html#25770">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 4/14/23 05:29, Waldemar Brodkorb wrote:
&gt;&gt;<i> On 4/6/23 06:41, Waldemar Brodkorb wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> There is still one assertion which happens sometimes:
</I>&gt;&gt;&gt;<i> cache.log:2023/04/06 07:24:48 kid1| assertion failed: ../src/base/CbcPointer.h:181: &quot;EX&quot;
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Have you ever seen this in the wild? What does it mean?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This low-level assertion (where &quot;EX&quot; is usually spelled as &quot;c&quot;) corresponds
</I>&gt;&gt;<i> to many high-level Squid bugs, most of them fixed. Please see
</I>&gt;&gt;<i> <A HREF="https://bugs.squid-cache.org/show_bug.cgi?id=5265#c1">https://bugs.squid-cache.org/show_bug.cgi?id=5265#c1</A> for the suggested next
</I>&gt;&gt;<i> steps.
</I>
&gt;<i> We have a core dump now. Ubuntu 22.04 with Squid 5.8.
</I>
 &gt; Do you can see where the bug is?

On the surface, the stack trace looks like bug #4981 to me. That bug has 
a workaround for v4. I do not know whether that workaround patch still 
applies to v5, but it is worth trying:
<A HREF="https://bugs.squid-cache.org/show_bug.cgi?id=4981">https://bugs.squid-cache.org/show_bug.cgi?id=4981</A>

Please keep us posted.

HTH,

Alex.


&gt;<i> gdb /usr/sbin/squid core.13.873301.1681462147
</I>&gt;<i> GNU gdb (Ubuntu 12.1-0ubuntu1~22.04) 12.1
</I>&gt;<i> Copyright (C) 2022 Free Software Foundation, Inc.
</I>&gt;<i> License GPLv3+: GNU GPL version 3 or later &lt;<A HREF="http://gnu.org/licenses/gpl.html">http://gnu.org/licenses/gpl.html</A>&gt;
</I>&gt;<i> This is free software: you are free to change and redistribute it.
</I>&gt;<i> There is NO WARRANTY, to the extent permitted by law.
</I>&gt;<i> Type &quot;show copying&quot; and &quot;show warranty&quot; for details.
</I>&gt;<i> This GDB was configured as &quot;x86_64-linux-gnu&quot;.
</I>&gt;<i> Type &quot;show configuration&quot; for configuration details.
</I>&gt;<i> For bug reporting instructions, please see:
</I>&gt;<i> &lt;<A HREF="https://www.gnu.org/software/gdb/bugs/">https://www.gnu.org/software/gdb/bugs/</A>&gt;.
</I>&gt;<i> Find the GDB manual and other documentation resources online at:
</I>&gt;<i>      &lt;<A HREF="http://www.gnu.org/software/gdb/documentation/">http://www.gnu.org/software/gdb/documentation/</A>&gt;.
</I>&gt;<i> 
</I>&gt;<i> For help, type &quot;help&quot;.
</I>&gt;<i> Type &quot;apropos word&quot; to search for commands related to &quot;word&quot;...
</I>&gt;<i> Reading symbols from /usr/sbin/squid...
</I>&gt;<i> Reading symbols from /usr/lib/debug/.build-id/4d/655715326bdce358de6a95a564b6e4e                                                                                                                                    ec84d5e.debug...
</I>&gt;<i> [New LWP 873301]
</I>&gt;<i> [Thread debugging using libthread_db enabled]
</I>&gt;<i> Using host libthread_db library &quot;/lib/x86_64-linux-gnu/libthread_db.so.1&quot;.
</I>&gt;<i> Core was generated by `(squid-1) --kid squid-1 --foreground -sYC'.
</I>&gt;<i> Program terminated with signal SIGABRT, Aborted.
</I>&gt;<i> --Type &lt;RET&gt; for more, q to quit, c to continue without paging--
</I>&gt;<i> #0  __pthread_kill_implementation (no_tid=0, signo=6, threadid=140419666299392)
</I>&gt;<i>      at ./nptl/pthread_kill.c:44
</I>&gt;<i> 44      ./nptl/pthread_kill.c: No such file or directory.
</I>&gt;<i> (gdb) bt full
</I>&gt;<i> #0  __pthread_kill_implementation (no_tid=0, signo=6, threadid=140419666299392)
</I>&gt;<i>      at ./nptl/pthread_kill.c:44
</I>&gt;<i>          tid = &lt;optimized out&gt;
</I>&gt;<i>          ret = 0
</I>&gt;<i>          pd = 0x7fb600544a00
</I>&gt;<i>          old_mask = {__val = {94534848520128, 94535132367528, 94533992246864,
</I>&gt;<i>              94532923700193, 94532920519424, 94532966275696, 94533267707520,
</I>&gt;<i>              140419709921070, 94534848520128, 0, 140723926211296,
</I>&gt;<i>              94532958412936, 0, 8, 26902275, 140419709808628}}
</I>&gt;<i>          ret = &lt;optimized out&gt;
</I>&gt;<i>          pd = &lt;optimized out&gt;
</I>&gt;<i>          old_mask = &lt;optimized out&gt;
</I>&gt;<i>          ret = &lt;optimized out&gt;
</I>&gt;<i>          tid = &lt;optimized out&gt;
</I>&gt;<i>          ret = &lt;optimized out&gt;
</I>&gt;<i>          resultvar = &lt;optimized out&gt;
</I>&gt;<i>          resultvar = &lt;optimized out&gt;
</I>&gt;<i>          __arg3 = &lt;optimized out&gt;
</I>&gt;<i>          __arg2 = &lt;optimized out&gt;
</I>&gt;<i>          __arg1 = &lt;optimized out&gt;
</I>&gt;<i>          _a3 = &lt;optimized out&gt;
</I>&gt;<i>          _a2 = &lt;optimized out&gt;
</I>&gt;<i>          _a1 = &lt;optimized out&gt;
</I>&gt;<i> --Type &lt;RET&gt; for more, q to quit, c to continue without paging--
</I>&gt;<i>          __futex = &lt;optimized out&gt;
</I>&gt;<i>          resultvar = &lt;optimized out&gt;
</I>&gt;<i>          __arg3 = &lt;optimized out&gt;
</I>&gt;<i>          __arg2 = &lt;optimized out&gt;
</I>&gt;<i>          __arg1 = &lt;optimized out&gt;
</I>&gt;<i>          _a3 = &lt;optimized out&gt;
</I>&gt;<i>          _a2 = &lt;optimized out&gt;
</I>&gt;<i>          _a1 = &lt;optimized out&gt;
</I>&gt;<i>          __futex = &lt;optimized out&gt;
</I>&gt;<i>          __private = &lt;optimized out&gt;
</I>&gt;<i>          __oldval = &lt;optimized out&gt;
</I>&gt;<i>          result = &lt;optimized out&gt;
</I>&gt;<i> #1  __pthread_kill_internal (signo=6, threadid=140419666299392)
</I>&gt;<i>      at ./nptl/pthread_kill.c:78
</I>&gt;<i> No locals.
</I>&gt;<i> #2  __GI___pthread_kill (threadid=140419666299392, signo=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">signo at entry</A>=6)
</I>&gt;<i>      at ./nptl/pthread_kill.c:89
</I>&gt;<i> No locals.
</I>&gt;<i> 
</I>&gt;<i> #3  0x00007fb602aa7476 in __GI_raise (sig=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">sig at entry</A>=6)
</I>&gt;<i>      at ../sysdeps/posix/raise.c:26
</I>&gt;<i>          ret = &lt;optimized out&gt;
</I>&gt;<i> #4  0x00007fb602a8d7f3 in __GI_abort () at ./stdlib/abort.c:79
</I>&gt;<i>          save_stage = 1
</I>&gt;<i> --Type &lt;RET&gt; for more, q to quit, c to continue without paging--
</I>&gt;<i>          act = {__sigaction_handler = {sa_handler = 0x55fa2959746f,
</I>&gt;<i>              sa_sigaction = 0x55fa2959746f}, sa_mask = {__val = {
</I>&gt;<i>                18446744073709551288, 11, 140723926211456, 94532958412928, 181,
</I>&gt;<i>                94532923913327, 140419705906387, 140723926211472,
</I>&gt;<i>                140723926211456, 94532958412928, 94532925905808,
</I>&gt;<i>                140723926211472, 94532920570578, 94533607213200, 99, 99}},
</I>&gt;<i>            sa_flags = 1335251568, sa_restorer = 0x55fa2959746f}
</I>&gt;<i>          sigs = {__val = {32, 0, 94533607213200, 6, 99, 140723926211136,
</I>&gt;<i>              94532958413328, 0, 99, 16762180390345294848, 94532958413040,
</I>&gt;<i>              140723926211456, 0, 94532958413328, 99, 16762180390345294848}}
</I>&gt;<i> #5  0x000055fa29124e55 in xassert (msg=&lt;optimized out&gt;, file=&lt;optimized out&gt;,
</I>&gt;<i>      line=&lt;optimized out&gt;) at ./src/debug.cc:624
</I>&gt;<i>          __FUNCTION__ = &lt;optimized out&gt;
</I>&gt;<i> #6  0x000055fa29118734 in CbcPointer&lt;BodyProducer&gt;::operator-&gt; (
</I>&gt;<i>      this=&lt;optimized out&gt;) at ../src/base/CbcPointer.h:181
</I>&gt;<i>          c = &lt;optimized out&gt;
</I>&gt;<i> #7  CbcPointer&lt;BodyConsumer&gt;::operator-&gt; (this=&lt;optimized out&gt;)
</I>&gt;<i>      at ../src/base/CbcPointer.h:178
</I>&gt;<i>          c = &lt;optimized out&gt;
</I>&gt;<i>          c = &lt;optimized out&gt;
</I>&gt;<i> #8  JobDialer&lt;BodyConsumer&gt;::dial (call=..., this=&lt;optimized out&gt;)
</I>&gt;<i>      at base/AsyncJobCalls.h:182
</I>&gt;<i>          __FUNCTION__ = &lt;optimized out&gt;
</I>&gt;<i> --Type &lt;RET&gt; for more, q to quit, c to continue without paging--
</I>&gt;<i> #9  AsyncCallT&lt;BodyConsumerDialer&gt;::fire (this=0x55fa4f965270)
</I>&gt;<i>      at ../src/base/AsyncCall.h:145
</I>&gt;<i> No locals.
</I>&gt;<i> #10 0x000055fa293cfaab in AsyncCallQueue::fireNext (this=&lt;optimized out&gt;)
</I>&gt;<i>      at base/../../src/base/RefCount.h:73
</I>&gt;<i>          call = {p_ = 0x55fa4f965270}
</I>&gt;<i>          __FUNCTION__ = &lt;optimized out&gt;
</I>&gt;<i> #11 0x000055fa293d189a in AsyncCallQueue::fire (this=0x55fa2b930a20)
</I>&gt;<i>      at base/AsyncCallQueue.cc:43
</I>&gt;<i>          made = true
</I>&gt;<i> #12 0x000055fa291ad500 in EventLoop::dispatchCalls (this=0x7ffcd7a21ef0)
</I>&gt;<i>      at ./src/EventLoop.cc:144
</I>&gt;<i>          dispatchedSome = &lt;optimized out&gt;
</I>&gt;<i> #13 EventLoop::runOnce (this=0x7ffcd7a21ef0) at ./src/EventLoop.cc:121
</I>&gt;<i>          sawActivity = &lt;optimized out&gt;
</I>&gt;<i>          waitingEngine = 0x7ffcd7a21e30
</I>&gt;<i>          __FUNCTION__ = &lt;optimized out&gt;
</I>&gt;<i> #14 0x000055fa292b5f10 in EventLoop::run (this=0x7ffcd7a21ef0)
</I>&gt;<i>      at ./src/EventLoop.cc:83
</I>&gt;<i> No locals.
</I>&gt;<i> #15 SquidMain (argc=&lt;optimized out&gt;, argv=&lt;optimized out&gt;)
</I>&gt;<i>      at ./src/main.cc:1719
</I>&gt;<i>          cmdLine = {argv_ = std::vector of length 6, capacity 6 = {
</I>&gt;<i> --Type &lt;RET&gt; for more, q to quit, c to continue without paging--
</I>&gt;<i>              0x55fa29977220 &quot;(squid-1)&quot;, 0x55fa299772e0 &quot;--kid&quot;,
</I>&gt;<i>              0x55fa299773a0 &quot;squid-1&quot;, 0x55fa29977460 &quot;--foreground&quot;,
</I>&gt;<i>              0x55fa29977520 &quot;-sYC&quot;, 0x0},
</I>&gt;<i>            shortOptions_ = 0x55fa299a2450 &quot;CDFNRSYXa:d:f:hk:m::n:sl:u:vz?&quot;,
</I>&gt;<i>            longOptions_ = std::vector of length 5, capacity 8 = {{&lt;option&gt; = {
</I>&gt;<i>                  name = 0x55fa29977cc0 &quot;foreground&quot;, has_arg = 0, flag = 0x0,
</I>&gt;<i>                  val = 2}, &lt;No data fields&gt;}, {&lt;option&gt; = {
</I>&gt;<i>                  name = 0x55fa299778e0 &quot;kid&quot;, has_arg = 1, flag = 0x0,
</I>&gt;<i>                  val = 3}, &lt;No data fields&gt;}, {&lt;option&gt; = {
</I>&gt;<i>                  name = 0x55fa299779a0 &quot;help&quot;, has_arg = 0, flag = 0x0,
</I>&gt;<i>                  val = 104}, &lt;No data fields&gt;}, {&lt;option&gt; = {
</I>&gt;<i>                  name = 0x55fa29977a80 &quot;version&quot;, has_arg = 0, flag = 0x0,
</I>&gt;<i>                  val = 118}, &lt;No data fields&gt;}, {&lt;option&gt; = {name = 0x0,
</I>&gt;<i>                  has_arg = 0, flag = 0x0, val = 0}, &lt;No data fields&gt;}}}
</I>&gt;<i>          WIN32_init_err = 0
</I>&gt;<i>          mainLoop = {errcount = 0, static Running = 0x7ffcd7a21ef0,
</I>&gt;<i>            last_loop = false, engines = std::vector of length 4, capacity 4 = {
</I>&gt;<i>              0x7ffcd7a21e70, 0x55fa296e8fd0 &lt;EventScheduler::_instance&gt;,
</I>&gt;<i>              0x7ffcd7a21e50, 0x7ffcd7a21e30}, timeService = 0x7ffcd7a21da8,
</I>&gt;<i>            primaryEngine = 0x7ffcd7a21e30, loop_delay = 0, error = false,
</I>&gt;<i>            runOnceResult = false}
</I>&gt;<i>          signalEngine = {&lt;AsyncEngine&gt; = {
</I>&gt;<i>              _vptr.AsyncEngine = 0x55fa296e1e50 &lt;vtable for SignalEngine+16&gt;}, &lt;N--Type &lt;RET&gt; for more, q to quit, c to continue without paging--
</I>&gt;<i> o data fields&gt;}
</I>&gt;<i>          store_engine = {&lt;AsyncEngine&gt; = {
</I>&gt;<i>              _vptr.AsyncEngine = 0x55fa296c8310 &lt;vtable for StoreRootEngine+16&gt;}, &lt;No data fields&gt;}
</I>&gt;<i>          comm_engine = {&lt;AsyncEngine&gt; = {
</I>&gt;<i>              _vptr.AsyncEngine = 0x55fa296e1e28 &lt;vtable for CommSelectEngine+16&gt;}, &lt;No data fields&gt;}
</I>&gt;<i>          time_engine = {
</I>&gt;<i>            _vptr.TimeEngine = 0x55fa296e2480 &lt;vtable for TimeEngine+16&gt;}
</I>&gt;<i>          __FUNCTION__ = &lt;optimized out&gt;
</I>&gt;<i> #16 0x000055fa291524e6 in SquidMainSafe (argv=0x7ffcd7a22208, argc=5)
</I>&gt;<i>      at ./src/main.cc:1406
</I>&gt;<i>          __FUNCTION__ = &lt;optimized out&gt;
</I>&gt;<i> #17 main (argc=5, argv=0x7ffcd7a22208) at ./src/main.cc:1394
</I>&gt;<i> No locals.
</I>&gt;<i> (gdb)
</I>&gt;<i> 
</I>&gt;<i> Do you can see where the bug is?
</I>&gt;<i> 
</I>&gt;<i> best regards
</I>&gt;<i>   Waldemar
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025768.html">[squid-users] logging: TCP connection to x.x.x.x/3128 failed
</A></li>
	<LI>Next message (by thread): <A HREF="025805.html">[squid-users] logging: TCP connection to x.x.x.x/3128 failed
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25770">[ date ]</a>
              <a href="thread.html#25770">[ thread ]</a>
              <a href="subject.html#25770">[ subject ]</a>
              <a href="author.html#25770">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
