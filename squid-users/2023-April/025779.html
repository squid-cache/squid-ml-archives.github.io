<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Disable IPV6 for certain destinations only?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Disable%20IPV6%20for%20certain%20destinations%20only%3F&In-Reply-To=%3Cf4a1d8bf-185d-0b51-d597-fed5efa300bf%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025777.html">
   <LINK REL="Next"  HREF="025780.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Disable IPV6 for certain destinations only?</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Disable%20IPV6%20for%20certain%20destinations%20only%3F&In-Reply-To=%3Cf4a1d8bf-185d-0b51-d597-fed5efa300bf%40measurement-factory.com%3E"
       TITLE="[squid-users] Disable IPV6 for certain destinations only?">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Apr 18 12:53:31 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025777.html">[squid-users] [ext] Re: Disable IPV6 for certain destinations only?
</A></li>
        <LI>Next message (by thread): <A HREF="025780.html">[squid-users] Disable IPV6 for certain destinations only?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25779">[ date ]</a>
              <a href="thread.html#25779">[ thread ]</a>
              <a href="subject.html#25779">[ subject ]</a>
              <a href="author.html#25779">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 4/18/23 03:38, Ralf Hildebrandt wrote:

&gt;<i> We're using squid-6, currently v4 only. The use case for us is mostly
</I>&gt;<i> our users using our proxy to retrieve full text publications of
</I>&gt;<i> several thousand medical journals... via IPv4.
</I>&gt;<i> 
</I>&gt;<i> The publishers &quot;know&quot; our IPv4 range for the proxies and allow us to
</I>&gt;<i> download freely. What they don't (yet) know is our ipv6 range.
</I>&gt;<i> 
</I>&gt;<i> Thus arises the need to &quot;fall back&quot; to ipv4 in the unlikely case some
</I>&gt;<i> publisher already has ipv6, we connect via ipv6 and suddenly are not
</I>&gt;<i> allowed to download the publications.
</I>&gt;<i> 
</I>&gt;<i> Is there an acl for that kind of need?
</I>
I will rephrase your question to avoid the distraction of &quot;acl&quot;:

   How can I configure Squid to try IPv4 if IPv6 fails?

The answer depends on how IPv6 fails:

1. If IPv6 fails at DNS resolution time (i.e. the DNS resolver does not 
respond with a usable address to a AAAA query), then Squid will 
automatically use IPv4 (i.e. the DNS resolver address in an A response). 
There is nothing to configure.

2. If IPv6 fails at TCP connection establishment time, then Squid will 
automatically use an IPv4 connection. There is nothing to configure 
(although there are a few Happy Eyeballs configuration options that you 
can tune).

3. If IPv6 fails at TLS connection establishment time, then, IIRC, #2 
applies unless SslBump is involved. Squid will not retry failed TLS 
connections that are subject to SslBump IIRC.

4. If IPv6 fails at HTTP request time, then Squid will retry in _some_ 
cases. See [1] for a long list of conditions; you are probably mostly 
interested in the last four or five bullets, but keep in mind that the 
list is of cases where Squid does _not_ re-forward the failed request.

[1] 
<A HREF="https://wiki.squid-cache.org/SquidFaq/InnerWorkings#when-does-squid-re-forward-a-client-request">https://wiki.squid-cache.org/SquidFaq/InnerWorkings#when-does-squid-re-forward-a-client-request</A>

You can also replace your DNS resolver with a custom one (that drops 
AAAA answers) or, as Adam has suggested, with hard-coded IPv4-only 
/etc/hosts entries.


HTH,

Alex.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025777.html">[squid-users] [ext] Re: Disable IPV6 for certain destinations only?
</A></li>
	<LI>Next message (by thread): <A HREF="025780.html">[squid-users] Disable IPV6 for certain destinations only?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25779">[ date ]</a>
              <a href="thread.html#25779">[ thread ]</a>
              <a href="subject.html#25779">[ subject ]</a>
              <a href="author.html#25779">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
