<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] cache_peer_access by dynamic ACL
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20cache_peer_access%20by%20dynamic%20ACL&In-Reply-To=%3CCAFqyDwCKi%2BCB_M-NgirDraHjUoiF5XUy8GyM-5ivU1rLe5fGGQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025790.html">
   <LINK REL="Next"  HREF="025792.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] cache_peer_access by dynamic ACL</H1>
    <B>Alexey&#1103;&#1088; Gruzdov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20cache_peer_access%20by%20dynamic%20ACL&In-Reply-To=%3CCAFqyDwCKi%2BCB_M-NgirDraHjUoiF5XUy8GyM-5ivU1rLe5fGGQ%40mail.gmail.com%3E"
       TITLE="[squid-users] cache_peer_access by dynamic ACL">my.shellac at gmail.com
       </A><BR>
    <I>Thu Apr 20 14:54:15 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025790.html">[squid-users] cache_peer_access by dynamic ACL
</A></li>
        <LI>Next message (by thread): <A HREF="025792.html">[squid-users] cache_peer_access by dynamic ACL
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25791">[ date ]</a>
              <a href="thread.html#25791">[ thread ]</a>
              <a href="subject.html#25791">[ subject ]</a>
              <a href="author.html#25791">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The cpu is around 100% even no any requests is going....
For now I left just one cache_peer in configuration and got the new error:

commBind Cannot bind socket FD 28 to [::]: (13) Permission denied


&#1095;&#1090;, 20 &#1072;&#1087;&#1088;. 2023&#8239;&#1075;. &#1074; 17:21, Alex Rousskov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>
&gt;:<i>
</I>
&gt;<i> On 4/20/23 04:23, Alexey&#1103;&#1088; Gruzdov wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; cache_peer peerG1.com parent 40001 0 no-query no-digest name=peerG1
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; external_acl_type ext_proxy_g1_type %LOGIN %DST /usr/local/bin/g1.py
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; acl proxy_g1_ext_mark_acl  ext_proxy_g1_type
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; acl proxy_g1_ext_marked_acl  annotate_transaction proxy=g1
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; acl proxy_peerG1_acl note proxy g1
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; http_access deny proxy_g1_ext_mark_acl  proxy_g1_ext_marked_acl !all
</I>&gt;<i> &gt; .....
</I>&gt;<i> &gt; others http_access rules
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; And this above works.
</I>&gt;<i>
</I>&gt;<i> Glad to hear that. ( If others are going to use the above as a guiding
</I>&gt;<i> example, I would recommend naming these ACLs very differently, but that
</I>&gt;<i> is not important to Squid. )
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; BUT
</I>&gt;<i> &gt; I am worried about why this my external script for ACL  type loads the
</I>&gt;<i> &gt; one of core of CPU to 100%.....???
</I>&gt;<i>
</I>&gt;<i> External ACL caching aside, the script will be contacted once for every
</I>&gt;<i> Squid transaction. Does your script CPU usage go down to zero when there
</I>&gt;<i> is no traffic? If not, then there is a bug in the script itself.
</I>&gt;<i>
</I>&gt;<i> If you use the script from the command line, without Squid, does it
</I>&gt;<i> consume a lot of CPU and/or take a lot of time per fake query? You can
</I>&gt;<i> adjust the script to log the real query (when the script is used by
</I>&gt;<i> Squid), so that you can easily replicate that query when running the
</I>&gt;<i> script without Squid...
</I>&gt;<i>
</I>&gt;<i> The cache key in your case is (the expansion of) &quot;%LOGIN %DST&quot;. It is
</I>&gt;<i> enabled by default IIRC. Look for &quot;cache&quot; related options at
</I>&gt;<i> <A HREF="http://www.squid-cache.org/Doc/config/external_acl_type/">http://www.squid-cache.org/Doc/config/external_acl_type/</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; ( I used three of workers in config,
</I>&gt;<i> &gt; but I can see a six process called like my external helper script, looks
</I>&gt;<i> &gt; like squid runs x2 process for external ACL )
</I>&gt;<i>
</I>&gt;<i> See external_acl_type children-* options:
</I>&gt;<i> <A HREF="http://www.squid-cache.org/Doc/config/external_acl_type/">http://www.squid-cache.org/Doc/config/external_acl_type/</A>
</I>&gt;<i>
</I>&gt;<i> In most environments, I recommend setting all three of them to the same
</I>&gt;<i> value. Please note that these options are not SMP-aware (yet), so Squid
</I>&gt;<i> will _not_ divide their values by the number of workers and give each
</I>&gt;<i> worker as many children as you state in squid.conf.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; Because if I will put the one more group of users (that must to use
</I>&gt;<i> &gt; another cache_peer ) - I will need to create one more external script
</I>&gt;<i> &gt; that will making to check an existed users from an other DB table
</I>&gt;<i>
</I>&gt;<i> Once you get the basic setup above working for one group to your
</I>&gt;<i> satisfaction, I would recommend migrating from (one script and one
</I>&gt;<i> matching annotate_transaction ACL) per group to a single script for all
</I>&gt;<i> groups. That single external ACL script will send the right
</I>&gt;<i> annotation(s) to Squid.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> HTH,
</I>&gt;<i>
</I>&gt;<i> Alex.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; &#1089;&#1088;, 19 &#1072;&#1087;&#1088;. 2023&#8239;&#1075;. &#1074; 22:39, Alex Rousskov:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     On 4/19/23 13:30, Alexey&#1103;&#1088; Gruzdov wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;      &gt; cache_peer peerG1.com parent 40001 0 no-query no-digest
</I>&gt;<i> name=peerG1
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;      &gt; external_acl_type ext_proxy_g1_type %LOGIN %DST
</I>&gt;<i> /usr/local/bin/g1.py
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;      &gt; acl proxy_g1_ext_acl ext_proxy_g1_type
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     OK. I assume that /usr/local/bin/g1.py will only match users that
</I>&gt;<i> &gt;     should
</I>&gt;<i> &gt;     go to cache_peer called peerG1.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;      &gt; acl proxy_g1_ext_acl_mark  annotate_transaction proxy=g1
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     Please note that the name of this annotate_transaction ACL --
</I>&gt;<i> &gt;     &quot;proxy_g1_ext_acl_mark&quot; -- implies a relationship to the external ACL
</I>&gt;<i> &gt;     named &quot;proxy_g1_ext_acl&quot;, but there is no such relationship. Squid
</I>&gt;<i> does
</I>&gt;<i> &gt;     not care about ACL names, but this naming problem may indicate a
</I>&gt;<i> &gt;     misunderstanding. To follow your naming scheme, this ACL should be
</I>&gt;<i> &gt;     called something like &quot;proxy_g1_mark_acl&quot; or &quot;mark_for_proxy_g1_acl&quot;.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;      &gt; acl proxy_peerG1_acl note proxy g1
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     OK. FWIW, a more consistent ACL name would have been
</I>&gt;<i> &gt;     &quot;proxy_g1_marked_acl&quot; or &quot;marked_for_proxy_g1_acl&quot;. Again, Squid does
</I>&gt;<i> &gt;     not really care about these names, so use whatever you think is
</I>&gt;<i> &gt;     consistent/meaningful/etc.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;      &gt; http_access deny proxy_g1_ext_acl !all
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     This line has no (positive) effect. Squid will evaluate the external
</I>&gt;<i> &gt;     ACL, but since the rule, as a whole, will never match due to &quot;!all&quot;,
</I>&gt;<i> &gt;     and
</I>&gt;<i> &gt;     since the external ACL has no (relevant) side effects, you can just
</I>&gt;<i> &gt;     delete this line from your configuration.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     Needless to say, if you delete this line, then proxy_g1_ext_acl will
</I>&gt;<i> be
</I>&gt;<i> &gt;     unused, which should tell you that this configuration is not doing
</I>&gt;<i> what
</I>&gt;<i> &gt;     you want. See below for a fix recommendation.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;      &gt; http_access deny proxy_g1_ext_acl_mark !all
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     This line will mark _all_ transactions. You only want to mark
</I>&gt;<i> &gt;     transactions that also matched proxy_g1_ext_acl. That &quot;b only if a&quot;
</I>&gt;<i> &gt;     logic is accomplished by using _both_ ACLs in the same rule:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;         http_access deny proxy_g1_ext_acl proxy_g1_ext_acl_mark !all
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     With the above http_access rule (instead of the earlier two), Squid
</I>&gt;<i> &gt;     will
</I>&gt;<i> &gt;     evaluate the external ACL, and, if it matches, Squid will also
</I>&gt;<i> evaluate
</I>&gt;<i> &gt;     the annotation-setting ACL. The whole rule will then be rejected due
</I>&gt;<i> to
</I>&gt;<i> &gt;     &quot;!all&quot;, but not until it annotates the transaction (if the external
</I>&gt;<i> ACL
</I>&gt;<i> &gt;     matches). Again, in this sketch, we are using this rule for its
</I>&gt;<i> &gt;     annotation side effect only.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;      &gt; And this works like I need now....
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     AFAICT, if the tests indicate that this configuration works, then the
</I>&gt;<i> &gt;     tests are broken. IMHO, you should fix the tests (while you have a
</I>&gt;<i> &gt;     broken configuration that can be used to test the tests) before
</I>&gt;<i> &gt;     proceeding with the configuration fix.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     HTH,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     Alex.
</I>&gt;<i> &gt;     P.S. Please keep this email thread on squid-users instead of
</I>&gt;<i> responding
</I>&gt;<i> &gt;     to me personally.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;      &gt; &#1089;&#1088;, 19 &#1072;&#1087;&#1088;. 2023&#8239;&#1075;. &#1074; 21:01, Alexey&#1103;&#1088; Gruzdov:
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;     so, ok  - Lets limit just to one cache peer and one single
</I>&gt;<i> &gt;     ACL (just
</I>&gt;<i> &gt;      &gt;     to understand the logic):
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;       cache_peer peerG1.com parent 40001 0 no-query no-digest
</I>&gt;<i> &gt;     name=peerG1
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;       external_acl_type ext_proxy_g1_type %LOGIN %DST
</I>&gt;<i> &gt;      &gt;     /usr/local/bin/g1.py   (this will answer &quot;OK&quot;  or &quot;ERR&quot;,
</I>&gt;<i> &gt;     depends if
</I>&gt;<i> &gt;      &gt;     user consists in DB)
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;       acl proxy_g1_ext_acl  ext_proxy_g1_type annotate_transaction
</I>&gt;<i> &gt;      &gt;     proxy=g1   (If I right understood here is a key point of how
</I>&gt;<i> &gt;     to add
</I>&gt;<i> &gt;      &gt;     the tag to transaction related with user)
</I>&gt;<i> &gt;      &gt;       acl proxy_peerG1_acl note proxy g1  (here we create the ACL
</I>&gt;<i> &gt;     based
</I>&gt;<i> &gt;      &gt;     on the tag and this is fast ACL yet and we should to use it in
</I>&gt;<i> &gt;      &gt;     cache_peer_access)
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;     http_access deny proxy_g1_ext_acl !all
</I>&gt;<i> &gt;      &gt;     ......&lt;others http access rules&gt;
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;     cache_peer_access peerG1 allow proxy_peerG1_acl
</I>&gt;<i> &gt;      &gt;     cache_peer_access peerG1 deny all
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;     Is that correct ?
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;     &#1074;&#1090;, 18 &#1072;&#1087;&#1088;. 2023&#8239;&#1075;. &#1074; 23:44, Alex Rousskov
</I>&gt;<i> &gt;      &gt;     &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>
</I>&gt;<i> &gt;     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt;
</I>&gt;<i> &gt;      &gt;     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>
</I>&gt;<i> &gt;     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt;&gt;&gt;:
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;         On 4/18/23 11:41, Alexey&#1103;&#1088; Gruzdov wrote:
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;          &gt; Could you explain me how the annotation transaction
</I>&gt;<i> &gt;     works and
</I>&gt;<i> &gt;      &gt;         how it
</I>&gt;<i> &gt;      &gt;          &gt; related to acl that I could to use with cache_peers
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;         Transactions have a (possibly empty) set of name=value
</I>&gt;<i> &gt;     annotations.
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;         During Squid configuration time, Squid parses all ACL
</I>&gt;<i> &gt;      &gt;         declarations in
</I>&gt;<i> &gt;      &gt;         your configuration file. When Squid parses an
</I>&gt;<i> &gt;      &gt;         annotation_transaction ACL
</I>&gt;<i> &gt;      &gt;         declaration, Squid remembers what transaction annotation
</I>&gt;<i> &gt;     to add
</I>&gt;<i> &gt;      &gt;         in the
</I>&gt;<i> &gt;      &gt;         future, [every time] when that ACL is evaluated (e.g.,
</I>&gt;<i> &gt;     used in
</I>&gt;<i> &gt;      &gt;         http_access rule that Squid reaches during transaction
</I>&gt;<i> &gt;     processing).
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;         When evaluated, an &quot;annotation_transaction&quot; ACL simply
</I>&gt;<i> &gt;     adds the
</I>&gt;<i> &gt;      &gt;         previously configured annotation to the current
</I>&gt;<i> &gt;     transaction and
</I>&gt;<i> &gt;      &gt;         returns
</I>&gt;<i> &gt;      &gt;         a &quot;yes, this transaction matches&quot; result.
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;         When evaluated, a &quot;note&quot; ACL returns a &quot;yes, this
</I>&gt;<i> transaction
</I>&gt;<i> &gt;      &gt;         matches&quot;
</I>&gt;<i> &gt;      &gt;         result if and only if the current transaction already has
</I>&gt;<i> the
</I>&gt;<i> &gt;      &gt;         matching
</I>&gt;<i> &gt;      &gt;         annotation. This ACL does not modify the set of
</I>&gt;<i> transaction
</I>&gt;<i> &gt;      &gt;         annotations.
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;         The combination of annotate_transaction and note ACLs
</I>&gt;<i> &gt;     allows you to
</I>&gt;<i> &gt;      &gt;         annotate a transaction at one time and check previously
</I>&gt;<i> set
</I>&gt;<i> &gt;      &gt;         transaction
</I>&gt;<i> &gt;      &gt;         annotations at another time. The timing and meaning of
</I>&gt;<i> those
</I>&gt;<i> &gt;      &gt;         annotations
</I>&gt;<i> &gt;      &gt;         are up to you.
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;          &gt; ok! Lets look to my case example:
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;          &gt; cache_peer peerG1.com parent 40001 0 no-query no-digest
</I>&gt;<i> &gt;      &gt;         name=peerG1 round-robin
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;          &gt; cache_peer_access  peerG1 allow proxy_peerG1_acl
</I>&gt;<i> &gt;      &gt;          &gt; cache_peer_access  peerG1 allow proxy_all_acl
</I>&gt;<i> &gt;      &gt;          &gt; cache_peer_access  peerG1 deny all
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;          &gt; acl proxy_peerG1_acl  proxy_auth  &quot;../users.peerG1.txt&quot;
</I>&gt;<i> &gt;      &gt;          &gt; acl proxy_all_acl  proxy_auth  &quot;../users.all.txt&quot;
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;         [ I added the missing &quot;acl &quot; directive to the above ACL
</I>&gt;<i> &gt;      &gt;         declarations and
</I>&gt;<i> &gt;      &gt;         stripped rules for two out of three cache_peers ]
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;         As you know, the above cache_peer_access configuration is
</I>&gt;<i> not
</I>&gt;<i> &gt;      &gt;         supported
</I>&gt;<i> &gt;      &gt;         because it uses &quot;slow&quot; proxy_auth ACLs in
</I>&gt;<i> cache_peer_access
</I>&gt;<i> &gt;      &gt;         directives
</I>&gt;<i> &gt;      &gt;         that only support &quot;fast&quot; ACLs. It does not matter (to me),
</I>&gt;<i> &gt;      &gt;         whether the
</I>&gt;<i> &gt;      &gt;         above appears to &quot;work&quot; in some environments. YMMV.
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;         To fix this problem, we can use http_access rules to
</I>&gt;<i> &gt;     essentially
</I>&gt;<i> &gt;      &gt;         remember proxy_auth evaluation results (at http_access
</I>&gt;<i> &gt;      &gt;         evaluation time)
</I>&gt;<i> &gt;      &gt;         as transaction annotations. Here is an untested sketch
</I>&gt;<i> that
</I>&gt;<i> &gt;      &gt;         omits other
</I>&gt;<i> &gt;      &gt;         (important but irrelevant here) http_access rules and
</I>&gt;<i> assumes
</I>&gt;<i> &gt;      &gt;         that these
</I>&gt;<i> &gt;      &gt;         sketched http_access rules _are_ evaluated:
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;             # if proxy_peerG1_acl matches, evaluate
</I>&gt;<i> mark_for_peerG1
</I>&gt;<i> &gt;      &gt;             http_access deny proxy_peerG1_acl mark_for_peerG1 !all
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;             # if proxy_all_acl matches, evaluate
</I>&gt;<i> mark_for_all_peers
</I>&gt;<i> &gt;      &gt;             http_access deny proxy_all_acl mark_for_all_peers !all
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;         Now we can use those remembered proxy_... acl evaluation
</I>&gt;<i> &gt;     results
</I>&gt;<i> &gt;      &gt;         (i.e.
</I>&gt;<i> &gt;      &gt;         we can check for the matching annotations) in
</I>&gt;<i> &gt;     cache_peer_access
</I>&gt;<i> &gt;      &gt;         rules:
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;             cache_peer_access peerG1 allow marked_for_peerG1
</I>&gt;<i> &gt;      &gt;             cache_peer_access peerG1 allow marked_for_all_peers
</I>&gt;<i> &gt;      &gt;             cache_peer_access peerG1 deny all
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;         where the new ACLs mentioned above are declared along
</I>&gt;<i> &gt;     these lines:
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;             acl mark_for_peerG1 annotate_transaction for_peer_=G1
</I>&gt;<i> &gt;      &gt;             acl mark_for_all_peers annotate_transaction
</I>&gt;<i> &gt;     for_all_peers_=true
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;             acl marked_for_peerG1 note for_peer_ G1
</I>&gt;<i> &gt;      &gt;             acl marked_for_all_peers note for_all_peers_ true
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;         This can probably be simplified further by using
</I>&gt;<i> &gt;     for_peer_=ALL
</I>&gt;<i> &gt;      &gt;         instead
</I>&gt;<i> &gt;      &gt;         of for_all_peers_=true annotation, but I wanted to
</I>&gt;<i> &gt;     preserve the
</I>&gt;<i> &gt;      &gt;         symmetry
</I>&gt;<i> &gt;      &gt;         with your original configuration.
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;          &gt; And these all works like I need, But - once I am
</I>&gt;<i> &gt;     changing a
</I>&gt;<i> &gt;      &gt;         list of
</I>&gt;<i> &gt;      &gt;          &gt; users (add or remove) - I need to use &quot;squid -k
</I>&gt;<i> &gt;      &gt;         reconfigure&quot;...... but
</I>&gt;<i> &gt;      &gt;          &gt; of course better to go without this reconfigure
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;         One can avoid reconfiguration using an external ACL
</I>&gt;<i> &gt;     script that
</I>&gt;<i> &gt;      &gt;         gives
</I>&gt;<i> &gt;      &gt;         Squid the right for_peer_=... annotations (instead of
</I>&gt;<i> using
</I>&gt;<i> &gt;      &gt;         &quot;constant&quot;
</I>&gt;<i> &gt;      &gt;         or &quot;hard-coded&quot; annotate_transaction ACLs to store the
</I>&gt;<i> same
</I>&gt;<i> &gt;      &gt;         annotations).
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;         However, it may be better to make the above sketch to work
</I>&gt;<i> &gt;      &gt;         _before_ you
</I>&gt;<i> &gt;      &gt;         replace mark_for_peerG1 ACLs/rules with an external
</I>&gt;<i> &gt;      &gt;         mark_for_the_right_peer ACL.
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;         HTH,
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;         Alex.
</I>&gt;<i> &gt;      &gt;         P.S. This thread continues the discussion started at
</I>&gt;<i> &gt;      &gt; <A HREF="https://bugs.squid-cache.org/show_bug.cgi?id=5268">https://bugs.squid-cache.org/show_bug.cgi?id=5268</A>
</I>&gt;<i> &gt;     &lt;<A HREF="https://bugs.squid-cache.org/show_bug.cgi?id=5268">https://bugs.squid-cache.org/show_bug.cgi?id=5268</A>&gt;
</I>&gt;<i> &gt;      &gt;         &lt;<A HREF="https://bugs.squid-cache.org/show_bug.cgi?id=5268">https://bugs.squid-cache.org/show_bug.cgi?id=5268</A>
</I>&gt;<i> &gt;     &lt;<A HREF="https://bugs.squid-cache.org/show_bug.cgi?id=5268">https://bugs.squid-cache.org/show_bug.cgi?id=5268</A>&gt;&gt;
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;         _______________________________________________
</I>&gt;<i> &gt;      &gt;         squid-users mailing list
</I>&gt;<i> &gt;      &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> &gt;     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i> &gt;      &gt;         &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> &gt;     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;&gt;
</I>&gt;<i> &gt;      &gt; <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> &gt;     &lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>&gt;
</I>&gt;<i> &gt;      &gt;         &lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> &gt;     &lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>&gt;&gt;
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;     --
</I>&gt;<i> &gt;      &gt;     &#1057; &#1091;&#1074;&#1072;&#1078;&#1077;&#1085;&#1080;&#1077;&#1084; &#1082; &#1042;&#1072;&#1084;
</I>&gt;<i> &gt;      &gt;     &#1040;&#1083;&#1077;&#1082;&#1089;&#1077;&#1081;
</I>&gt;<i> &gt;      &gt;     +79043828661
</I>&gt;<i> &gt;      &gt;     620000 &#1075;.&#1045;&#1082;&#1072;&#1090;&#1077;&#1088;&#1080;&#1085;&#1073;&#1091;&#1088;&#1075;  2022
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt; --
</I>&gt;<i> &gt;      &gt; &#1057; &#1091;&#1074;&#1072;&#1078;&#1077;&#1085;&#1080;&#1077;&#1084; &#1082; &#1042;&#1072;&#1084;
</I>&gt;<i> &gt;      &gt; &#1040;&#1083;&#1077;&#1082;&#1089;&#1077;&#1081;
</I>&gt;<i> &gt;      &gt; +79043828661
</I>&gt;<i> &gt;      &gt; 620000 &#1075;.&#1045;&#1082;&#1072;&#1090;&#1077;&#1088;&#1080;&#1085;&#1073;&#1091;&#1088;&#1075;  2022
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; --
</I>&gt;<i> &gt; &#1057; &#1091;&#1074;&#1072;&#1078;&#1077;&#1085;&#1080;&#1077;&#1084; &#1082; &#1042;&#1072;&#1084;
</I>&gt;<i> &gt; &#1040;&#1083;&#1077;&#1082;&#1089;&#1077;&#1081;
</I>&gt;<i> &gt; +79043828661
</I>&gt;<i> &gt; 620000 &#1075;.&#1045;&#1082;&#1072;&#1090;&#1077;&#1088;&#1080;&#1085;&#1073;&#1091;&#1088;&#1075;  2022
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; squid-users mailing list
</I>&gt;<i> &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> &gt; <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20230420/3233f5cf/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20230420/3233f5cf/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025790.html">[squid-users] cache_peer_access by dynamic ACL
</A></li>
	<LI>Next message (by thread): <A HREF="025792.html">[squid-users] cache_peer_access by dynamic ACL
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25791">[ date ]</a>
              <a href="thread.html#25791">[ thread ]</a>
              <a href="subject.html#25791">[ subject ]</a>
              <a href="author.html#25791">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
