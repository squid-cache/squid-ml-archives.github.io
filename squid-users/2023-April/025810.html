<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Cannot get Squid to start with external ACL in config
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Cannot%20get%20Squid%20to%20start%20with%20external%20ACL%20in%20config&In-Reply-To=%3Ca3CsZVe5D4KN40xTI3yLpY1b9r0ZlA8hz_Mcc0cs7Ie_ccoQgWJbasjWmGm4U_8sNxBeszMIG1RRwgCsMwCOPoLVazqyUkqrcJ8GiMQIjpE%3D%40protonmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025817.html">
   <LINK REL="Next"  HREF="025811.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Cannot get Squid to start with external ACL in config</H1>
    <B>deennyycsgo</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Cannot%20get%20Squid%20to%20start%20with%20external%20ACL%20in%20config&In-Reply-To=%3Ca3CsZVe5D4KN40xTI3yLpY1b9r0ZlA8hz_Mcc0cs7Ie_ccoQgWJbasjWmGm4U_8sNxBeszMIG1RRwgCsMwCOPoLVazqyUkqrcJ8GiMQIjpE%3D%40protonmail.com%3E"
       TITLE="[squid-users] Cannot get Squid to start with external ACL in config">deennyycsgo at protonmail.com
       </A><BR>
    <I>Tue Apr 25 17:49:30 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025817.html">[squid-users] Caching uncachable resources
</A></li>
        <LI>Next message (by thread): <A HREF="025811.html">[squid-users] Cannot get Squid to start with external ACL in config
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25810">[ date ]</a>
              <a href="thread.html#25810">[ thread ]</a>
              <a href="subject.html#25810">[ subject ]</a>
              <a href="author.html#25810">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello, I'm having an issue configuring an external ACL, the error i get is:

Can't use proxy auth because no authentication schemes are fully configured.
FATAL: ERROR: Invalid ACL: acl ext_acl external acl_name

Here is my config: acl SSL_ports port 443 acl Safe_ports port 80 acl Safe_ports port 21 acl Safe_ports port 443 acl Safe_ports port 70 acl Safe_ports port 210 acl Safe_ports port 1025-65535 acl Safe_ports port 280 acl Safe_ports port 488 acl Safe_ports port 591 acl Safe_ports port 777 acl CONNECT method CONNECT external_acl_type acl_name %SRC %LOGIN %DST /etc/squid/ext_acl.py acl ext_acl external acl_name http_access allow ext_acl http_access deny !Safe_ports http_access deny CONNECT !SSL_ports http_access allow localhost manager http_access deny manager http_access allow localhost http_access deny all http_port 3128 coredump_dir /var/spool/squid3 refresh_pattern ^ftp: 1440 20% 10080 refresh_pattern ^gopher: 1440 0% 1440 refresh_pattern -i (/cgi-bin/|\?) 0 0% 0 refresh_pattern . 0 20% 4320

And here is the python script:
#!/usr/bin/python3
import sys
import logging
import time

def grant ():
sys.stdout.write('OK\n')
sys.stdout.flush()

def deny ():
sys.stdout.write('ERR\n')
sys.stdout.flush()

while True:
line = sys.stdin.readline().strip()
if line:
deny()
else:
time.sleep( 1 )

The python script has 777 permissions and is owned by the proxy user.
Running it through the terminal results in expected output and expected behaviour.

I'm running Squid version 4.10 on Ubuntu Server 20.04 Thanks in advance!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20230425/9d2e22e9/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20230425/9d2e22e9/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025817.html">[squid-users] Caching uncachable resources
</A></li>
	<LI>Next message (by thread): <A HREF="025811.html">[squid-users] Cannot get Squid to start with external ACL in config
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25810">[ date ]</a>
              <a href="thread.html#25810">[ thread ]</a>
              <a href="subject.html#25810">[ subject ]</a>
              <a href="author.html#25810">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
