<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid 6.1 esi compile error, ubuntu 22.04
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%206.1%20esi%20compile%20error%2C%20ubuntu%2022.04&In-Reply-To=%3C55298982-d394-99bd-7649-d57fbe278e6c%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026027.html">
   <LINK REL="Next"  HREF="026026.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid 6.1 esi compile error, ubuntu 22.04</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%206.1%20esi%20compile%20error%2C%20ubuntu%2022.04&In-Reply-To=%3C55298982-d394-99bd-7649-d57fbe278e6c%40measurement-factory.com%3E"
       TITLE="[squid-users] squid 6.1 esi compile error, ubuntu 22.04">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Aug  8 15:22:41 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="026027.html">[squid-users] squid 6.1 esi compile error, ubuntu 22.04
</A></li>
        <LI>Next message (by thread): <A HREF="026026.html">[squid-users] squid 6.1 esi compile error, ubuntu 22.04
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26028">[ date ]</a>
              <a href="thread.html#26028">[ thread ]</a>
              <a href="subject.html#26028">[ subject ]</a>
              <a href="author.html#26028">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 8/8/23 01:10, Dmitry Melekhov wrote:
&gt;<i> 07.08.2023 17:27, Alex Rousskov &#1087;&#1080;&#1096;&#1077;&#1090;:
</I>&gt;&gt;<i> On 8/7/23 04:00, Dmitry Melekhov wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Built&#160; using --disable-esi without problems.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> First of all, if you do not need ESI, I recommend building with 
</I>&gt;&gt;<i> --disable-esi to avoid accidental exposure to dangerous ESI bugs in 
</I>&gt;&gt;<i> deployments that should not be using ESI features.
</I>
&gt;<i> Really, I know nothing about it, so most probably I don't need it.
</I>
Agreed.


&gt;&gt;<i> FWIW, in Project CI environment that also uses GCC on Ubuntu 22.04, 
</I>&gt;&gt;<i> Squid v6.1 ESI build[1] succeeds, including the Libxml2Parser.cc 
</I>&gt;&gt;<i> compilation step that fails in your environment.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> [1] <A HREF="https://github.com/squid-cache/squid/actions/runs/5471818575">https://github.com/squid-cache/squid/actions/runs/5471818575</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &#160;&#160;&#160; $ grep -A6 LIBEXPAT configure.log
</I>&gt;&gt;<i> &#160;&#160;&#160; checking for LIBEXPAT... yes
</I>&gt;&gt;<i> &#160;&#160;&#160; checking for expat.h... yes
</I>&gt;&gt;<i> &#160;&#160;&#160; checking for LIBXML2... yes
</I>&gt;&gt;<i> &#160;&#160;&#160; checking for libxml/parser.h... yes
</I>&gt;&gt;<i> &#160;&#160;&#160; checking for libxml/HTMLparser.h... yes
</I>&gt;&gt;<i> &#160;&#160;&#160; checking for libxml/HTMLtree.h... yes
</I>&gt;&gt;<i> &#160;&#160;&#160; configure: Enabling ESI processor:&#160; -lexpat -lm&#160; -lxml2
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &#160;&#160;&#160; $ grep HAVE_LIBXML include/autoconf.h
</I>&gt;&gt;<i> &#160;&#160;&#160; #define HAVE_LIBXML2 1
</I>&gt;&gt;<i> &#160;&#160;&#160; #define HAVE_LIBXML_HTMLPARSER_H 1
</I>&gt;&gt;<i> &#160;&#160;&#160; #define HAVE_LIBXML_HTMLTREE_H 1
</I>&gt;&gt;<i> &#160;&#160;&#160; #define HAVE_LIBXML_PARSER_H 1
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Can you share the corresponding ./configure output and 
</I>&gt;&gt;<i> include/autoconf.h lines from your build environment?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Could you tell me what can cause this?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I suspect your system lacks libxml/HTMLparser.h or Squid ./configure 
</I>&gt;&gt;<i> was unable to find that header. I cannot find relevant libxml2 
</I>&gt;&gt;<i> documentation, but if libxml promises to declare xmlParserCtxtPtr in 
</I>&gt;&gt;<i> libxml/HTMLparser.h, then this is a Squid bug: When that bug (if it is 
</I>&gt;&gt;<i> a Squid bug) is fixed, your build will fail at ./configure time 
</I>&gt;&gt;<i> instead of &quot;make&quot; time.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Next steps:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> * If your system lacks libxml/HTMLparser.h, then install the missing 
</I>&gt;&gt;<i> libxml2 headers. Check the output sampled above to confirm that the 
</I>&gt;&gt;<i> installation led to header discovery by ./configure.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> * If your system has libxml/HTMLparser.h, set/adjust CPPFLAGS given to 
</I>&gt;&gt;<i> ./configure. Check the output sampled above to confirm that your 
</I>&gt;&gt;<i> adjustments led to header discovery by ./configure.
</I>


&gt;<i> It is in place, the same as in Ubuntu 20.04,&#160; where I compiled squid 6.1 
</I>&gt;<i> without problems,
</I>&gt;<i> 
</I>&gt;<i> but configure can't find it:
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> configure:28616: checking for libxml/parser.h
</I>&gt;<i> configure:28616: g++ -std=c++17 -c&#160; -g -O2&#160;&#160; conftest.cpp &gt;&amp;5
</I>&gt;<i> conftest.cpp:120:10: fatal error: libxml/parser.h: No such file or 
</I>&gt;<i> directory
</I>&gt;<i>  &#160; 120 | #include &lt;libxml/parser.h&gt;
</I>&gt;<i>  &#160;&#160;&#160;&#160;&#160; |&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ^~~~~~~~~~~~~~~~~
</I>&gt;<i> compilation terminated.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> export CPPFLAGS=-I/usr/include/libxml2/
</I>&gt;<i> 
</I>&gt;<i> helps
</I>&gt;<i> 
</I>&gt;<i> now :
</I>&gt;<i> 
</I>&gt;<i> configure:28616: checking for libxml/parser.h
</I>&gt;<i> configure:28616: g++ -std=c++17 -c&#160; -g -O2 -I/usr/include/libxml2/ 
</I>&gt;<i> conftest.cpp &gt;&amp;5
</I>&gt;<i> configure:28616: $? = 0
</I>&gt;<i> configure:28616: result: yes
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> and squid is compiled.
</I>
&gt;<i> This is new install of ubuntu 22.04
</I>
Thank you for reporting these details! They may help others experiencing 
similar problems.

I cannot explain why setting CPPFLAGS is needed in your environment 
_but_ not needed in other very similar environments with libxml2 
installed. There might be some subtle differences in _how_ that library 
and its headers were installed, but I am just grasping at straws here.


Alex.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="026027.html">[squid-users] squid 6.1 esi compile error, ubuntu 22.04
</A></li>
	<LI>Next message (by thread): <A HREF="026026.html">[squid-users] squid 6.1 esi compile error, ubuntu 22.04
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26028">[ date ]</a>
              <a href="thread.html#26028">[ thread ]</a>
              <a href="subject.html#26028">[ subject ]</a>
              <a href="author.html#26028">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
