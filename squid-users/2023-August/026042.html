<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 6.2 with WCCP
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%206.2%20with%20WCCP&In-Reply-To=%3CLO0P265MB5503918F5857C242D659CF91F01EA%40LO0P265MB5503.GBRP265.PROD.OUTLOOK.COM%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026041.html">
   <LINK REL="Next"  HREF="026043.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 6.2 with WCCP</H1>
    <B>Callum Haywood</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%206.2%20with%20WCCP&In-Reply-To=%3CLO0P265MB5503918F5857C242D659CF91F01EA%40LO0P265MB5503.GBRP265.PROD.OUTLOOK.COM%3E"
       TITLE="[squid-users] Squid 6.2 with WCCP">callum.haywood at appliansys.com
       </A><BR>
    <I>Mon Aug 21 09:06:08 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="026041.html">[squid-users] [icap] rewritten transparent intercept tutorials for squid, mikrotik, ubuntu 20, debian 12 (nftables) and rhel 9 (firewalld)
</A></li>
        <LI>Next message (by thread): <A HREF="026043.html">[squid-users] Squid 6.2 with WCCP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26042">[ date ]</a>
              <a href="thread.html#26042">[ thread ]</a>
              <a href="subject.html#26042">[ subject ]</a>
              <a href="author.html#26042">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

We are currently testing Squid 6.2 with WCCP. Running on Ubuntu 20.04.6 LTS with a GRE tunnel to a Cisco 2821.

We are seeing the following errors in the logs:

2023/08/18 10:13:02| ERROR: Ignoring WCCPv2 message: check failed: duplicate security definition
    exception location: wccp2.cc(1254) wccp2HandleUdp
2023/08/18 10:13:12| ERROR: Ignoring WCCPv2 message: check failed: duplicate security definition
    exception location: wccp2.cc(1254) wccp2HandleUdp
2023/08/18 10:13:22| ERROR: Ignoring WCCPv2 message: check failed: duplicate security definition
    exception location: wccp2.cc(1254) wccp2HandleUdp
2023/08/18 10:13:27| ERROR: Ignoring WCCPv2 message: check failed: WCCP packet type unsupported
    exception location: wccp2.cc(1226) wccp2HandleUdp
2023/08/18 10:13:32| ERROR: Ignoring WCCPv2 message: check failed: duplicate security definition
    exception location: wccp2.cc(1254) wccp2HandleUdp
2023/08/18 10:13:42| ERROR: Ignoring WCCPv2 message: check failed: duplicate security definition
    exception location: wccp2.cc(1254) wccp2HandleUdp

The squid config is attached (it is only used in a controlled test lab), as well as the complete log.

I have built Squid 4.15 on the same host and using the same config the Cisco is able to see Squid, send traffic, and there are no WCCP errors in the logs.

I have done a diff between the wccp2.cc source in 4.15 and 6.2 and see that there are quite a few changes. In the release notes I see &quot;WCCP: Validate packets better&quot;.

Does anyone understand what is causing these errors? Are there any known issues or patches in progress?

Thanks
Callum

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20230821/ab6bc521/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20230821/ab6bc521/attachment.htm</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: squid_wccp_minimal.conf
Type: application/octet-stream
Size: 1450 bytes
Desc: squid_wccp_minimal.conf
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20230821/ab6bc521/attachment.obj">http://lists.squid-cache.org/pipermail/squid-users/attachments/20230821/ab6bc521/attachment.obj</A>&gt;
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: squid_wccp_full_log.txt
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20230821/ab6bc521/attachment.txt">http://lists.squid-cache.org/pipermail/squid-users/attachments/20230821/ab6bc521/attachment.txt</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="026041.html">[squid-users] [icap] rewritten transparent intercept tutorials for squid, mikrotik, ubuntu 20, debian 12 (nftables) and rhel 9 (firewalld)
</A></li>
	<LI>Next message (by thread): <A HREF="026043.html">[squid-users] Squid 6.2 with WCCP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26042">[ date ]</a>
              <a href="thread.html#26042">[ thread ]</a>
              <a href="subject.html#26042">[ subject ]</a>
              <a href="author.html#26042">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
