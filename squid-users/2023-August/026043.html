<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 6.2 with WCCP
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%206.2%20with%20WCCP&In-Reply-To=%3Ca41412c6-936e-c6f1-d2fd-a204e71c1dc8%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026042.html">
   <LINK REL="Next"  HREF="026048.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 6.2 with WCCP</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%206.2%20with%20WCCP&In-Reply-To=%3Ca41412c6-936e-c6f1-d2fd-a204e71c1dc8%40measurement-factory.com%3E"
       TITLE="[squid-users] Squid 6.2 with WCCP">rousskov at measurement-factory.com
       </A><BR>
    <I>Mon Aug 21 13:34:09 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="026042.html">[squid-users] Squid 6.2 with WCCP
</A></li>
        <LI>Next message (by thread): <A HREF="026048.html">[squid-users] Squid 6.2 with WCCP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26043">[ date ]</a>
              <a href="thread.html#26043">[ thread ]</a>
              <a href="subject.html#26043">[ subject ]</a>
              <a href="author.html#26043">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 8/21/23 05:06, Callum Haywood wrote:

&gt;<i> We are currently testing Squid 6.2 with WCCP. Running on Ubuntu 20.04.6 
</I>&gt;<i> LTS with a GRE tunnel to a Cisco 2821.
</I>&gt;<i> 
</I>&gt;<i> We are seeing the following errors in the logs:
</I>&gt;<i> 
</I>&gt;<i> 2023/08/18 10:13:02| ERROR: Ignoring WCCPv2 message: check failed: duplicate security definition
</I>&gt;<i>  &#160; &#160; exception location: wccp2.cc(1254) wccp2HandleUdp
</I>
&gt;<i> I have built Squid 4.15 on the same host and using the same config the 
</I>&gt;<i> Cisco is able to see Squid, send traffic, and there are no WCCP errors 
</I>&gt;<i> in the logs.
</I>&gt;<i> 
</I>&gt;<i> I have done a diff between the wccp2.cc source in 4.15 and 6.2 and see 
</I>&gt;<i> that there are quite a few changes. In the release notes I see &quot;WCCP: 
</I>&gt;<i> Validate packets better&quot;.
</I>
FWIW, that change is present in Squid v4.17 as well.


&gt;<i> Does anyone understand what is causing these errors? Are there any known 
</I>&gt;<i> issues or patches in progress?
</I>
A few years ago, several serious problems were discovered in WCCP code, 
including security vulnerabilities:

<A HREF="https://github.com/squid-cache/squid/security/advisories/GHSA-rgf3-9v3p-qp82">https://github.com/squid-cache/squid/security/advisories/GHSA-rgf3-9v3p-qp82</A>

Some of the WCCP bugs were fixed without testing; developers fixing 
those bugs could not easily test WCCP. Some of the old WCCP bugs 
remained and some of the new fixes were buggy.

Today, WCCP code remains problematic. If your customers rely on WCCP, 
consider investing into revamping that neglected and buggy feature.


Current Squid v4-v6 releases appear to be missing the following WCCP fix 
in master/v7 (but it will probably not address the &quot;duplicate security 
definition&quot; issue you are facing):

<A HREF="https://github.com/squid-cache/squid/commit/478eba2a3392c46b12cd5abf433ac4442d7515b7">https://github.com/squid-cache/squid/commit/478eba2a3392c46b12cd5abf433ac4442d7515b7</A>


HTH,

Alex.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="026042.html">[squid-users] Squid 6.2 with WCCP
</A></li>
	<LI>Next message (by thread): <A HREF="026048.html">[squid-users] Squid 6.2 with WCCP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26043">[ date ]</a>
              <a href="thread.html#26043">[ thread ]</a>
              <a href="subject.html#26043">[ subject ]</a>
              <a href="author.html#26043">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
