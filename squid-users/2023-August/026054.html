<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] How can I forward most requests to another proxy, except a few domains?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20How%20can%20I%20forward%20most%20requests%20to%20another%20proxy%2C%0A%20except%20a%20few%20domains%3F&In-Reply-To=%3CCAC-Lcd_CVoP9oKmbsxjfwP3J4Sx9Z9Nz_-jePUfx9RjCyJ7jCQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026053.html">
   <LINK REL="Next"  HREF="026055.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] How can I forward most requests to another proxy, except a few domains?</H1>
    <B>Matthew H</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20How%20can%20I%20forward%20most%20requests%20to%20another%20proxy%2C%0A%20except%20a%20few%20domains%3F&In-Reply-To=%3CCAC-Lcd_CVoP9oKmbsxjfwP3J4Sx9Z9Nz_-jePUfx9RjCyJ7jCQ%40mail.gmail.com%3E"
       TITLE="[squid-users] How can I forward most requests to another proxy, except a few domains?">Matthew at marrold.co.uk
       </A><BR>
    <I>Mon Aug 28 00:11:54 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="026053.html">[squid-users] How can I forward most requests to another proxy, except a few domains?
</A></li>
        <LI>Next message (by thread): <A HREF="026055.html">[squid-users] Squid ssl_bump splice configuration
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26054">[ date ]</a>
              <a href="thread.html#26054">[ thread ]</a>
              <a href="subject.html#26054">[ subject ]</a>
              <a href="author.html#26054">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> One possible issue is I'm using &quot;intercept&quot; mode, and a router with
</I>&gt;<i> DSTNAT rules to forward requests to the proxy; however some of the
</I>&gt;<i> documents state that NAT must be done on the squid box itself?
</I>
I've since remembered this is not quite accurate. I'm using a DNS
server to reply to all requests with the IP address of the squid
proxy.

If something is accessed directly via IP address its DSTNATed to the proxy

Thanks

On Mon, Aug 28, 2023 at 12:28&#8239;AM Matthew H &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">Matthew at marrold.co.uk</A>&gt; wrote:
&gt;<i>
</I>&gt;<i> Hi all,
</I>&gt;<i>
</I>&gt;<i> I'm trying to use squid to proxy requests to another upstream proxy,
</I>&gt;<i> but a few domains should go direct rather than via a proxy.
</I>&gt;<i>
</I>&gt;<i> I've set up squid with a config that I believe should work, but if I
</I>&gt;<i> try to access <A HREF="http://dialup.cutel.net">http://dialup.cutel.net</A> I get a 403 from squid and don't
</I>&gt;<i> see any requests go out to the origin. Everything via the proxy works
</I>&gt;<i> as expected.
</I>&gt;<i>
</I>&gt;<i> One possible issue is I'm using &quot;intercept&quot; mode, and a router with
</I>&gt;<i> DSTNAT rules to forward requests to the proxy; however some of the
</I>&gt;<i> documents state that NAT must be done on the squid box itself?
</I>&gt;<i>
</I>&gt;<i> Thanks
</I>&gt;<i>
</I>&gt;<i> Config below:
</I>&gt;<i>
</I>&gt;<i> #debug_options ALL,2
</I>&gt;<i>
</I>&gt;<i> debug_options ALL,0 85,2 88,2
</I>&gt;<i>
</I>&gt;<i> # ACL definitions
</I>&gt;<i>
</I>&gt;<i> acl localnet src 127.0.0.1
</I>&gt;<i> acl rfc_1918 src 10.0.0.0/8
</I>&gt;<i> acl rfc_1918 src 172.16.0.0/12
</I>&gt;<i> acl rfc_1918 src 192.168.0.0/16
</I>&gt;<i> acl protoweb src 100.80.13.0/24
</I>&gt;<i> acl direct_sites dstdomain dialup.cutel.net
</I>&gt;<i>
</I>&gt;<i> # Listen directives
</I>&gt;<i> http_port 3128
</I>&gt;<i> http_port 0.0.0.0:8080 intercept
</I>&gt;<i>
</I>&gt;<i> # Only allow localhost to access the squid management interface
</I>&gt;<i> http_access allow localhost manager
</I>&gt;<i> http_access deny manager
</I>&gt;<i>
</I>&gt;<i> # Only allow private and Dial-Up clients to connect to proxy
</I>&gt;<i> http_access allow localnet
</I>&gt;<i> http_access allow rfc_1918
</I>&gt;<i> http_access allow protoweb
</I>&gt;<i> http_access allow direct_sites
</I>&gt;<i> http_access deny all
</I>&gt;<i>
</I>&gt;<i> always_direct allow direct_sites
</I>&gt;<i> always_direct deny all
</I>&gt;<i> never_direct deny direct_sites
</I>&gt;<i> never_direct allow all
</I>&gt;<i>
</I>&gt;<i> cache_peer wayback.protoweb.org parent 7851 0 default proxy-only
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="026053.html">[squid-users] How can I forward most requests to another proxy, except a few domains?
</A></li>
	<LI>Next message (by thread): <A HREF="026055.html">[squid-users] Squid ssl_bump splice configuration
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26054">[ date ]</a>
              <a href="thread.html#26054">[ thread ]</a>
              <a href="subject.html#26054">[ subject ]</a>
              <a href="author.html#26054">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
