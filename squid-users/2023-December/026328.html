<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] [External] Re:  Cache_peer breaks Squid 5.5
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%5BExternal%5D%20Re%3A%20%20Cache_peer%20breaks%20Squid%205.5&In-Reply-To=%3CCY1P110MB061318CD0F41FAE296842EDCBE8DA%40CY1P110MB0613.NAMP110.PROD.OUTLOOK.COM%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026327.html">
   <LINK REL="Next"  HREF="026329.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] [External] Re:  Cache_peer breaks Squid 5.5</H1>
    <B>HENDERSON, GAVEN L     RTX</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%5BExternal%5D%20Re%3A%20%20Cache_peer%20breaks%20Squid%205.5&In-Reply-To=%3CCY1P110MB061318CD0F41FAE296842EDCBE8DA%40CY1P110MB0613.NAMP110.PROD.OUTLOOK.COM%3E"
       TITLE="[squid-users] [External] Re:  Cache_peer breaks Squid 5.5">gaven.l.henderson at rtx.com
       </A><BR>
    <I>Wed Dec 13 02:45:46 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="026327.html">[squid-users] Cache_peer breaks Squid 5.5
</A></li>
        <LI>Next message (by thread): <A HREF="026329.html">[squid-users] [External] Re:  Cache_peer breaks Squid 5.5
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26328">[ date ]</a>
              <a href="thread.html#26328">[ thread ]</a>
              <a href="subject.html#26328">[ subject ]</a>
              <a href="author.html#26328">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>assertion failed: peer_digest.cc:419: &quot;EX&quot;

Found this:  <A HREF="https://access.redhat.com/solutions/7048529">https://access.redhat.com/solutions/7048529</A>

Any thoughts on how to fix this on Rocky 9?


Regards,

Gaven Henderson
DT System Administrator - Raytheon Vision Systems
RIS Digital Technologies - AADS Mfg Solutions
Raytheon Technologies

+1 805-562-2614   (office)
+1 805-451-6572   (cell)
+1 805-880-6513   (pager)

This message contains information that may be confidential and privileged. Unless you are the addressee (or authorized to receive mail for the addressee), you should not use, copy or disclose to anyone this message or any information contained in this message. If you have received this message in error, please so advise the sender by reply email and delete this message. Thank you for your cooperation.

-----Original Message-----
From: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; On Behalf Of Alex Rousskov
Sent: Tuesday, December 12, 2023 10:22 AM
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: [External] Re: [squid-users] Cache_peer breaks Squid 5.5

On 2023-12-12 11:25, HENDERSON, GAVEN L RTX wrote:
&gt;<i> Sorry if this has already been answered.  I couldn't find anything online regarding the problem I am experiencing.  I have a Squid server acting as a proxy relay.  It listens on two ports and, depending on which port a request comes in, the request is forwarded to a specific upstream proxy.  Everything was working prior to the 5.5 update.  Now, Squid starts but crashes a few seconds later.  I have traced it down to the cache_peer directives.  If I comment them out, the service is stable.  I have also tried the stock configuration with only the cache_peer directive added and it still crashes so I don't think the problem is being triggered by some other part of my configuration.  I'm not seeing anything particularly helpful in the messages log:
</I>
What do you see in Squid's cache.log? I would expect a message about Squid hitting an assertion or detecting another catastrophic problem before crashing. If there is nothing in cache.log, consider (enabling core dumps in your OS configuration and) getting a backtrace from the crashed Squid process.


HTH,

Alex.



&gt;<i> Nov 24 15:17:30 svr-squid squid[2259]: Squid Parent: squid-1 process
</I>&gt;<i> 2290 exited due to signal 6 with status 0 Nov 24 15:17:30 svr-squid
</I>&gt;<i> squid[2259]: Squid Parent: squid-1 process 2290 will not be restarted
</I>&gt;<i> for 3600 seconds due to repeated, frequent failures Nov 24 15:17:30 svr-squid squid[2259]: Exiting due to repeated, frequent failures Nov 24 15:17:30 svr-squid systemd[1]: mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">systemd-coredump at 21-2295-0.service</A>: Deactivated successfully.
</I>&gt;<i> Nov 24 15:17:30 svr-squid systemd[1]: squid.service: Main process
</I>&gt;<i> exited, code=exited, status=1/FAILURE Nov 24 15:17:30 svr-squid systemd[1]: squid.service: Failed with result 'exit-code'.
</I>&gt;<i>
</I>&gt;<i> Here is my configuration:
</I>&gt;<i>
</I>&gt;<i> http_port 192.168.0.1:80 name=port80
</I>&gt;<i> http_port 192.168.0.1:81 name=port81
</I>&gt;<i>
</I>&gt;<i> acl port80_acl myportname port80
</I>&gt;<i> acl port81_acl myportname port81
</I>&gt;<i> acl bypass_parent dstdom_regex &quot;/etc/squid/bypass_parent.txt&quot;
</I>&gt;<i> acl domain_blacklist dstdomain &quot;/etc/squid/domain_blacklist.txt&quot;
</I>&gt;<i>
</I>&gt;<i> http_access deny all domain_blacklist
</I>&gt;<i> always_direct allow bypass_parent
</I>&gt;<i> never_direct allow port80_acl
</I>&gt;<i> never_direct allow port81_acl
</I>&gt;<i>
</I>&gt;<i> cache_peer proxy1.domain.com parent 80 0 default name=proxy80
</I>&gt;<i> cache_peer_access proxy80 allow port80_acl cache_peer_access proxy80
</I>&gt;<i> deny all
</I>&gt;<i>
</I>&gt;<i> cache_peer proxy2.domain.com parent 80 0 default name=proxy81
</I>&gt;<i> cache_peer_access proxy81 allow port81_acl cache_peer_access proxy81
</I>&gt;<i> deny all
</I>&gt;<i>
</I>&gt;<i> http_access allow all
</I>&gt;<i>
</I>&gt;<i> logformat squid [%tl] %&gt;a %&gt;eui %Ss/%03&gt;Hs %&lt;st %rm %ru %[un %Sh/%&lt;a
</I>&gt;<i> %mt _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="https://urldefense.com/v3/__https://lists.squid-cache.org/listinfo/squ">https://urldefense.com/v3/__https://lists.squid-cache.org/listinfo/squ</A>
</I>&gt;<i> id-users__;!!MvWE!FEDTJs2pTa3njy74FPFejy1UEla67Tsxo5KMiUxhSdHn4--dUL_t
</I>&gt;<i> kUqmWCJ64l_RHB9_uSLhEWcTeWWRcO7R6E68TUQsCFE6$
</I>
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="https://urldefense.com/v3/__https://lists.squid-cache.org/listinfo/squid-users__;!!MvWE!FEDTJs2pTa3njy74FPFejy1UEla67Tsxo5KMiUxhSdHn4--dUL_tkUqmWCJ64l_RHB9_uSLhEWcTeWWRcO7R6E68TUQsCFE6$">https://urldefense.com/v3/__https://lists.squid-cache.org/listinfo/squid-users__;!!MvWE!FEDTJs2pTa3njy74FPFejy1UEla67Tsxo5KMiUxhSdHn4--dUL_tkUqmWCJ64l_RHB9_uSLhEWcTeWWRcO7R6E68TUQsCFE6$</A>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="026327.html">[squid-users] Cache_peer breaks Squid 5.5
</A></li>
	<LI>Next message (by thread): <A HREF="026329.html">[squid-users] [External] Re:  Cache_peer breaks Squid 5.5
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26328">[ date ]</a>
              <a href="thread.html#26328">[ thread ]</a>
              <a href="subject.html#26328">[ subject ]</a>
              <a href="author.html#26328">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
