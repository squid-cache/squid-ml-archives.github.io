<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid hangs and dies and can not be killed - needs system reboot
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20hangs%20and%20dies%20and%20can%20not%20be%20killed%20-%0A%20needs%20system%20reboot&In-Reply-To=%3C61d0bb96-9d31-4c67-b071-c99250714dff%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026341.html">
   <LINK REL="Next"  HREF="026342.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid hangs and dies and can not be killed - needs system reboot</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20hangs%20and%20dies%20and%20can%20not%20be%20killed%20-%0A%20needs%20system%20reboot&In-Reply-To=%3C61d0bb96-9d31-4c67-b071-c99250714dff%40measurement-factory.com%3E"
       TITLE="[squid-users] squid hangs and dies and can not be killed - needs system reboot">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Dec 19 15:16:17 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="026341.html">[squid-users] squid hangs and dies and can not be killed - needs system reboot
</A></li>
        <LI>Next message (by thread): <A HREF="026342.html">[squid-users] squid hangs and dies and can not be killed - needs system reboot
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26340">[ date ]</a>
              <a href="thread.html#26340">[ thread ]</a>
              <a href="subject.html#26340">[ subject ]</a>
              <a href="author.html#26340">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2023-12-18 22:29, Amish wrote:
&gt;<i> On 19/12/23 01:14, Alex Rousskov wrote:
</I>&gt;&gt;<i> On 2023-12-18 09:35, Amish wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I use Arch Linux and today I updated squid from squid 5.7 to squid 6.6.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt; Dec 18 13:01:24 mumbai squid[604]: kick abandoning conn199
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I do not know whether the above problem is the primary problem in your 
</I>&gt;&gt;<i> setup, but it is a red flag. Transactions on the same connection may 
</I>&gt;&gt;<i> get stuck after that message; it is essentially a Squid bug.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I am not sure at all, but this bug might be related to Bug 5187 
</I>&gt;&gt;<i> workaround that went into Squid v6.2 (commit c44cfe7): 
</I>&gt;&gt;<i> <A HREF="https://bugs.squid-cache.org/show_bug.cgi?id=5187">https://bugs.squid-cache.org/show_bug.cgi?id=5187</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Does Squid accept new TCP connections after it enters what you 
</I>&gt;&gt;<i> describe as a dead state? For example, does &quot;telnet 127.0.0.1 8080&quot; 
</I>&gt;&gt;<i> establishes a connection if executed on the same machine as Squid?
</I>&gt;&gt;<i>
</I>&gt;<i> Yes it establishes connection. But I do not know what to do next. 
</I>
This tells us that your Squid is still listening for incoming 
connections. Most likely, it is not &quot;dead&quot; but running and just unable 
to make progress with those connections (for yet unknown reasons). That 
information is helpful but not sufficient (for me) to solve the problem 
you are describing.

The next step that I would recommend is to collect debugging information 
from the running process and share a pointer to the corresponding 
compressed cache.log file:

* Ideally, start collection when Squid starts and reproduce the problem 
while collecting full debugging information:
<A HREF="http://wiki.squid-cache.org/SquidFaq/BugReporting#full-debug-output">http://wiki.squid-cache.org/SquidFaq/BugReporting#full-debug-output</A>

* If you have to, start collection after Squid is already in bad state 
and just before you use telnet or browser to tickle Squid:
<A HREF="http://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction">http://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction</A>

Do not use any secret information (e.g., production certificate keys) 
for these tests (unless you are going to share the logs privately with 
those you trust).

Do not downgrade to v5 for these tests.


HTH,

Alex.


&gt;<i> Browser showed &quot;Connection timed out&quot; message. But I believe browser's 
</I>&gt;<i> also connected but nothing happened afterwards.
</I>&gt;<i> 
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt; kill -9 does nothing
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Is it possible that you are trying to kill the wrong process? You 
</I>&gt;&gt;<i> should be killing this process AFAICT:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt; root&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 601&#160; 0.0&#160; 0.2&#160; 73816 22528 ?&#160;&#160;&#160;&#160;&#160;&#160;&#160; Ss&#160;&#160; 12:59 0:02
</I>&gt;&gt;<i> &gt; /usr/bin/squid -f /etc/squid/btnet/squid.btnet.conf --foreground -sYC
</I>&gt;<i> 
</I>&gt;<i> I did not clarify but all processes needed SIGKILL and vanished except 
</I>&gt;<i> the Dead squid process which still remained.
</I>&gt;<i> 
</I>&gt;<i> # systemctl stop squid
</I>&gt;<i> 
</I>&gt;<i> Dec 19 08:46:38 mumbai systemd[1]: squid.service: State 'stop-sigterm' 
</I>&gt;<i> timed out. Killing.
</I>&gt;<i> Dec 19 08:46:38 mumbai systemd[1]: squid.service: Killing process 601 
</I>&gt;<i> (squid) with signal SIGKILL.
</I>&gt;<i> Dec 19 08:46:38 mumbai systemd[1]: squid.service: Killing process 604 
</I>&gt;<i> (squid) with signal SIGKILL.
</I>&gt;<i> Dec 19 08:46:38 mumbai systemd[1]: squid.service: Killing process 607 
</I>&gt;<i> (security_file_c) with signal SIGKILL.
</I>&gt;<i> Dec 19 08:46:38 mumbai systemd[1]: squid.service: Killing process 608 
</I>&gt;<i> (security_file_c) with signal SIGKILL.
</I>&gt;<i> Dec 19 08:46:38 mumbai systemd[1]: squid.service: Killing process 609 
</I>&gt;<i> (security_file_c) with signal SIGKILL.
</I>&gt;<i> Dec 19 08:46:38 mumbai systemd[1]: squid.service: Killing process 610 
</I>&gt;<i> (security_file_c) with signal SIGKILL.
</I>&gt;<i> Dec 19 08:46:38 mumbai systemd[1]: squid.service: Killing process 611 
</I>&gt;<i> (security_file_c) with signal SIGKILL.
</I>&gt;<i> Dec 19 08:46:38 mumbai systemd[1]: squid.service: Killing process 622 
</I>&gt;<i> (log_file_daemon) with signal SIGKILL.
</I>&gt;<i> Dec 19 08:46:38 mumbai systemd[1]: squid.service: Main process exited, 
</I>&gt;<i> code=killed, status=9/KILL
</I>&gt;<i> Dec 19 08:46:38 mumbai systemd[1]: squid.service: Killing process 604 
</I>&gt;<i> (squid) with signal SIGKILL.
</I>&gt;<i> 
</I>&gt;<i> Waited for 2 minutes for squid to stop then pressed ctrl-c to systemctl 
</I>&gt;<i> stop squid command.
</I>&gt;<i> 
</I>&gt;<i> As you can see in last line shows that attempt was made to kill DEAD 
</I>&gt;<i> process with PID 604.
</I>&gt;<i> 
</I>&gt;<i> # ps aux |grep squid
</I>&gt;<i> proxy&#160;&#160;&#160;&#160;&#160;&#160;&#160; 604&#160; 0.0&#160; 0.0&#160;&#160;&#160;&#160;&#160; 0&#160;&#160;&#160;&#160; 0 ?&#160;&#160;&#160;&#160;&#160;&#160;&#160; D&#160;&#160;&#160; Dec18&#160;&#160; 0:03 [squid]
</I>&gt;<i> 
</I>&gt;<i> Now only DEAD squid process remains.
</I>&gt;<i> 
</I>&gt;<i> What next? Should I downgrade to 5.9 and check?
</I>&gt;<i> 
</I>&gt;<i> Regards
</I>&gt;<i> 
</I>&gt;<i> Amish
</I>&gt;<i> 
</I>&gt;&gt;<i> Alex.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> After the update from 5.7 to 6.6, squid starts but then reaches Dead 
</I>&gt;&gt;&gt;<i> state in a minute or two.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> # ps aux | grep squid
</I>&gt;&gt;&gt;<i> root&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 601&#160; 0.0&#160; 0.2&#160; 73816 22528 ?&#160;&#160;&#160;&#160;&#160;&#160;&#160; Ss&#160;&#160; 12:59 0:02 
</I>&gt;&gt;&gt;<i> /usr/bin/squid -f /etc/squid/btnet/squid.btnet.conf --foreground -sYC
</I>&gt;&gt;&gt;<i> proxy&#160;&#160;&#160;&#160;&#160;&#160;&#160; 604&#160; 0.0&#160; 0.0&#160;&#160;&#160;&#160;&#160; 0&#160;&#160;&#160;&#160; 0 ?&#160;&#160;&#160;&#160;&#160;&#160;&#160; D&#160;&#160;&#160; 12:59 0:03 [squid]
</I>&gt;&gt;&gt;<i> proxy&#160;&#160;&#160;&#160;&#160;&#160;&#160; 607&#160; 0.0&#160; 0.0&#160; 11976&#160; 7424 ?&#160;&#160;&#160;&#160;&#160;&#160;&#160; S&#160;&#160;&#160; 12:59 0:00 
</I>&gt;&gt;&gt;<i> (security_file_certgen) -s /var/cache/squid/ssl_db -M 4MB
</I>&gt;&gt;&gt;<i> proxy&#160;&#160;&#160;&#160;&#160;&#160;&#160; 608&#160; 0.0&#160; 0.0&#160; 11976&#160; 7168 ?&#160;&#160;&#160;&#160;&#160;&#160;&#160; S&#160;&#160;&#160; 12:59 0:00 
</I>&gt;&gt;&gt;<i> (security_file_certgen) -s /var/cache/squid/ssl_db -M 4MB
</I>&gt;&gt;&gt;<i> proxy&#160;&#160;&#160;&#160;&#160;&#160;&#160; 609&#160; 0.0&#160; 0.0&#160; 11712&#160; 5632 ?&#160;&#160;&#160;&#160;&#160;&#160;&#160; S&#160;&#160;&#160; 12:59 0:00 
</I>&gt;&gt;&gt;<i> (security_file_certgen) -s /var/cache/squid/ssl_db -M 4MB
</I>&gt;&gt;&gt;<i> proxy&#160;&#160;&#160;&#160;&#160;&#160;&#160; 610&#160; 0.0&#160; 0.0&#160; 11712&#160; 5376 ?&#160;&#160;&#160;&#160;&#160;&#160;&#160; S&#160;&#160;&#160; 12:59 0:00 
</I>&gt;&gt;&gt;<i> (security_file_certgen) -s /var/cache/squid/ssl_db -M 4MB
</I>&gt;&gt;&gt;<i> proxy&#160;&#160;&#160;&#160;&#160;&#160;&#160; 611&#160; 0.0&#160; 0.0&#160; 11712&#160; 5504 ?&#160;&#160;&#160;&#160;&#160;&#160;&#160; S&#160;&#160;&#160; 12:59 0:00 
</I>&gt;&gt;&gt;<i> (security_file_certgen) -s /var/cache/squid/ssl_db -M 4MB
</I>&gt;&gt;&gt;<i> proxy&#160;&#160;&#160;&#160;&#160;&#160;&#160; 622&#160; 0.0&#160; 0.0&#160;&#160; 6116&#160; 3200 ?&#160;&#160;&#160;&#160;&#160;&#160;&#160; S&#160;&#160;&#160; 12:59 0:00 
</I>&gt;&gt;&gt;<i> (logfile-daemon) /var/log/squid/access.log
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> And then all requests get stuck. Notice the D (dead) state of squid.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I use multiple ports for multiple purposes. (It all worked fine in 
</I>&gt;&gt;&gt;<i> squid 5.7)
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Dec 18 12:59:10 mumbai squid[601]: Starting Authentication on port 
</I>&gt;&gt;&gt;<i> [::]:3128
</I>&gt;&gt;&gt;<i> Dec 18 12:59:10 mumbai squid[601]: Disabling Authentication on port 
</I>&gt;&gt;&gt;<i> [::]:3128 (interception enabled)
</I>&gt;&gt;&gt;<i> Dec 18 12:59:10 mumbai squid[601]: Starting Authentication on port 
</I>&gt;&gt;&gt;<i> [::]:8081
</I>&gt;&gt;&gt;<i> Dec 18 12:59:10 mumbai squid[601]: Disabling Authentication on port 
</I>&gt;&gt;&gt;<i> [::]:8081 (interception enabled)
</I>&gt;&gt;&gt;<i> Dec 18 12:59:12 mumbai squid[601]: Starting Authentication on port 
</I>&gt;&gt;&gt;<i> [::]:8082
</I>&gt;&gt;&gt;<i> Dec 18 12:59:12 mumbai squid[601]: Disabling Authentication on port 
</I>&gt;&gt;&gt;<i> [::]:8082 (interception enabled)
</I>&gt;&gt;&gt;<i> Dec 18 12:59:12 mumbai squid[601]: Starting Authentication on port 
</I>&gt;&gt;&gt;<i> [::]:8083
</I>&gt;&gt;&gt;<i> Dec 18 12:59:12 mumbai squid[601]: Disabling Authentication on port 
</I>&gt;&gt;&gt;<i> [::]:8083 (interception enabled)
</I>&gt;&gt;&gt;<i> Dec 18 12:59:13 mumbai squid[601]: Starting Authentication on port 
</I>&gt;&gt;&gt;<i> [::]:8084
</I>&gt;&gt;&gt;<i> Dec 18 12:59:13 mumbai squid[601]: Disabling Authentication on port 
</I>&gt;&gt;&gt;<i> [::]:8084 (interception enabled)
</I>&gt;&gt;&gt;<i> Dec 18 12:59:13 mumbai squid[601]: Starting Authentication on port 
</I>&gt;&gt;&gt;<i> [::]:3136
</I>&gt;&gt;&gt;<i> Dec 18 12:59:13 mumbai squid[601]: Disabling Authentication on port 
</I>&gt;&gt;&gt;<i> [::]:3136 (interception enabled)
</I>&gt;&gt;&gt;<i> Dec 18 12:59:13 mumbai squid[601]: Starting Authentication on port 
</I>&gt;&gt;&gt;<i> [::]:3137
</I>&gt;&gt;&gt;<i> Dec 18 12:59:13 mumbai squid[601]: Disabling Authentication on port 
</I>&gt;&gt;&gt;<i> [::]:3137 (interception enabled)
</I>&gt;&gt;&gt;<i> ...
</I>&gt;&gt;&gt;<i> Dec 18 12:59:29 mumbai squid[604]: Adaptation support is on
</I>&gt;&gt;&gt;<i> Dec 18 12:59:29 mumbai squid[604]: Accepting NAT intercepted HTTP 
</I>&gt;&gt;&gt;<i> Socket connections at conn19 local=[::]:3128 remote=[::] FD 27 flags=41
</I>&gt;&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; listening port: 3128
</I>&gt;&gt;&gt;<i> Dec 18 12:59:29 mumbai squid[604]: Accepting SSL bumped HTTP Socket 
</I>&gt;&gt;&gt;<i> connections at conn21 local=[::]:8080 remote=[::] FD 28 flags=9
</I>&gt;&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; listening port: 8080
</I>&gt;&gt;&gt;<i> Dec 18 12:59:29 mumbai squid[604]: Accepting NAT intercepted SSL 
</I>&gt;&gt;&gt;<i> bumped HTTPS Socket connections at conn23 local=[::]:8081 remote=[::] 
</I>&gt;&gt;&gt;<i> FD 29 flags=41
</I>&gt;&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; listening port: 8081
</I>&gt;&gt;&gt;<i> Dec 18 12:59:29 mumbai squid[604]: Accepting SSL bumped HTTP Socket 
</I>&gt;&gt;&gt;<i> connections at conn25 local=[::]:8092 remote=[::] FD 30 flags=9
</I>&gt;&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; listening port: 8092
</I>&gt;&gt;&gt;<i> Dec 18 12:59:29 mumbai systemd[1]: Started Squid Web Proxy Server.
</I>&gt;&gt;&gt;<i> Dec 18 12:59:29 mumbai squid[604]: Accepting SSL bumped HTTP Socket 
</I>&gt;&gt;&gt;<i> connections at conn27 local=[::]:8093 remote=[::] FD 31 flags=9
</I>&gt;&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; listening port: 8093
</I>&gt;&gt;&gt;<i> Dec 18 12:59:29 mumbai squid[604]: Accepting SSL bumped HTTP Socket 
</I>&gt;&gt;&gt;<i> connections at conn29 local=[::]:8094 remote=[::] FD 32 flags=9
</I>&gt;&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; listening port: 8094
</I>&gt;&gt;&gt;<i> Dec 18 12:59:29 mumbai squid[604]: Accepting NAT intercepted SSL 
</I>&gt;&gt;&gt;<i> bumped HTTPS Socket connections at conn31 local=[::]:8082 remote=[::] 
</I>&gt;&gt;&gt;<i> FD 33 flags=41
</I>&gt;&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; listening port: 8082
</I>&gt;&gt;&gt;<i> Dec 18 12:59:29 mumbai squid[604]: Accepting NAT intercepted SSL 
</I>&gt;&gt;&gt;<i> bumped HTTPS Socket connections at conn33 local=[::]:8083 remote=[::] 
</I>&gt;&gt;&gt;<i> FD 34 flags=41
</I>&gt;&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; listening port: 8083
</I>&gt;&gt;&gt;<i> Dec 18 12:59:29 mumbai squid[604]: Accepting NAT intercepted SSL 
</I>&gt;&gt;&gt;<i> bumped HTTPS Socket connections at conn35 local=[::]:8084 remote=[::] 
</I>&gt;&gt;&gt;<i> FD 35 flags=41
</I>&gt;&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; listening port: 8084
</I>&gt;&gt;&gt;<i> Dec 18 12:59:29 mumbai squid[604]: Accepting NAT intercepted HTTP 
</I>&gt;&gt;&gt;<i> Socket connections at conn37 local=[::]:3136 remote=[::] FD 36 flags=41
</I>&gt;&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; listening port: 3136
</I>&gt;&gt;&gt;<i> Dec 18 12:59:29 mumbai squid[604]: Accepting NAT intercepted HTTP 
</I>&gt;&gt;&gt;<i> Socket connections at conn39 local=[::]:3137 remote=[::] FD 37 flags=41
</I>&gt;&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; listening port: 3137
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> And then following errors came:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Dec 18 12:59:45 mumbai squid[604]: ERROR: failure while accepting a 
</I>&gt;&gt;&gt;<i> TLS connection on conn41 local=192.168.0.1:8080 
</I>&gt;&gt;&gt;<i> remote=192.168.0.111:53867 FD 12 flags=1: SQUID_TLS
</I>&gt;&gt;&gt;<i> _ERR_ACCEPT+TLS_LIB_ERR=A000416+TLS_IO_ERR=1
</I>&gt;&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; current master transaction: 
</I>&gt;&gt;&gt;<i> master53
</I>&gt;&gt;&gt;<i> Dec 18 12:59:45 mumbai squid[604]: ERROR: failure while accepting a 
</I>&gt;&gt;&gt;<i> TLS connection on conn42 local=192.168.0.1:8080 
</I>&gt;&gt;&gt;<i> remote=192.168.0.111:53868 FD 14 flags=1: SQUID_TLS
</I>&gt;&gt;&gt;<i> _ERR_ACCEPT+TLS_LIB_ERR=A000416+TLS_IO_ERR=1
</I>&gt;&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; current master transaction: 
</I>&gt;&gt;&gt;<i> master53
</I>&gt;&gt;&gt;<i> Dec 18 12:59:45 mumbai squid[604]: ERROR: failure while accepting a 
</I>&gt;&gt;&gt;<i> TLS connection on conn43 local=192.168.0.1:8080 
</I>&gt;&gt;&gt;<i> remote=192.168.0.111:53869 FD 16 flags=1: SQUID_TLS
</I>&gt;&gt;&gt;<i> _ERR_ACCEPT+TLS_LIB_ERR=A000416+TLS_IO_ERR=1
</I>&gt;&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; current master transaction: 
</I>&gt;&gt;&gt;<i> master57
</I>&gt;&gt;&gt;<i> Dec 18 12:59:45 mumbai squid[604]: ERROR: failure while accepting a 
</I>&gt;&gt;&gt;<i> TLS connection on conn44 local=192.168.0.1:8080 
</I>&gt;&gt;&gt;<i> remote=192.168.0.111:53870 FD 12 flags=1: SQUID_TLS
</I>&gt;&gt;&gt;<i> _ERR_ACCEPT+TLS_LIB_ERR=A000416+TLS_IO_ERR=1
</I>&gt;&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; current master transaction: 
</I>&gt;&gt;&gt;<i> master57
</I>&gt;&gt;&gt;<i> Dec 18 12:59:56 mumbai squid[604]: ERROR: failure while accepting a 
</I>&gt;&gt;&gt;<i> TLS connection on conn62 local=192.168.0.1:8080 
</I>&gt;&gt;&gt;<i> remote=192.168.0.111:53887 FD 12 flags=1: SQUID_TLS
</I>&gt;&gt;&gt;<i> _ERR_ACCEPT+TLS_LIB_ERR=A000416+TLS_IO_ERR=1
</I>&gt;&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; current master transaction: 
</I>&gt;&gt;&gt;<i> master95
</I>&gt;&gt;&gt;<i> Dec 18 12:59:59 mumbai squid[604]: ERROR: failure while accepting a 
</I>&gt;&gt;&gt;<i> TLS connection on conn64 local=192.168.0.1:8080 
</I>&gt;&gt;&gt;<i> remote=192.168.0.111:53888 FD 12 flags=1: SQUID_TLS
</I>&gt;&gt;&gt;<i> _ERR_ACCEPT+TLS_LIB_ERR=A000416+TLS_IO_ERR=1
</I>&gt;&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; current master transaction: 
</I>&gt;&gt;&gt;<i> master99
</I>&gt;&gt;&gt;<i> Dec 18 13:00:02 mumbai squid[604]: ERROR: failure while accepting a 
</I>&gt;&gt;&gt;<i> TLS connection on conn65 local=192.168.0.1:8080 
</I>&gt;&gt;&gt;<i> remote=192.168.0.178:56115 FD 12 flags=1: SQUID_TLS
</I>&gt;&gt;&gt;<i> _ERR_ACCEPT+TLS_LIB_ERR=A000418+TLS_IO_ERR=1
</I>&gt;&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; current master transaction: 
</I>&gt;&gt;&gt;<i> master53
</I>&gt;&gt;&gt;<i> Dec 18 13:01:24 mumbai squid[604]: kick abandoning conn199 
</I>&gt;&gt;&gt;<i> local=192.168.0.1:8093 remote=192.168.0.101:52211 FD 52 flags=1
</I>&gt;&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; connection: conn199 
</I>&gt;&gt;&gt;<i> local=192.168.0.1:8093 remote=192.168.0.101:52211 FD 52 flags=1
</I>&gt;&gt;&gt;<i> Dec 18 13:01:45 mumbai squid[604]: ERROR: failure while accepting a 
</I>&gt;&gt;&gt;<i> TLS connection on conn240 local=192.168.0.1:8093 
</I>&gt;&gt;&gt;<i> remote=192.168.0.111:53931 FD 48 flags=1: SQUID_TL
</I>&gt;&gt;&gt;<i> S_ERR_ACCEPT+TLS_LIB_ERR=A000416+TLS_IO_ERR=1
</I>&gt;&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; current master transaction: 
</I>&gt;&gt;&gt;<i> master314
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> After this point there is nothing in systemd journal (via: journalctl 
</I>&gt;&gt;&gt;<i> -f -u squid) and same lines are in cache.log.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Squid got stuck (DEAD state) at 13:01 and right now it 19:26 (6 hours 
</I>&gt;&gt;&gt;<i> passed) and squid is still in dead state.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> kill -9 or kill -ALRM or -HUP also does nothing.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> So to restart squid - I will need to restart whole system.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I have sslbump directives but it is not really applied.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> #NOTE: nosslbump_ips below contains 192.168.0.0/24 (whole LAN) so 
</I>&gt;&gt;&gt;<i> effectively there is no SSL bump after step1.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> acl nosslbump_ips src 192.168.0.0/24
</I>&gt;&gt;&gt;<i> ssl_bump splice ssl_step1 nosslbump_ips
</I>&gt;&gt;&gt;<i> ssl_bump peek ssl_step1
</I>&gt;&gt;&gt;<i> ssl_bump splice nosslbump_domains
</I>&gt;&gt;&gt;<i> ssl_bump stare sslbump_domains
</I>&gt;&gt;&gt;<i> ssl_bump splice ssl_step2
</I>&gt;&gt;&gt;<i> ssl_bump bump all
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Any idea? If anything changed from 5.7 to 6.6 that may cause this 
</I>&gt;&gt;&gt;<i> behaviour?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Looking at changelog:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Bug 5256: Intercepting port fails to accept
</I>&gt;&gt;&gt;<i> <A HREF="https://bugs.squid-cache.org/show_bug.cgi?id=5256">https://bugs.squid-cache.org/show_bug.cgi?id=5256</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Bug 5154: Do not open IPv6 sockets when IPv6 is disabled
</I>&gt;&gt;&gt;<i> <A HREF="https://bugs.squid-cache.org/show_bug.cgi?id=5154">https://bugs.squid-cache.org/show_bug.cgi?id=5154</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Not sure if above two bug FIXES (in between v5.7 to v6.6) are related 
</I>&gt;&gt;&gt;<i> to my issue.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I ran netstat:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> # netstat -ntlp
</I>&gt;&gt;&gt;<i> Active Internet connections (only servers)
</I>&gt;&gt;&gt;<i> Proto Recv-Q Send-Q Local Address&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Foreign Address 
</I>&gt;&gt;&gt;<i> State&#160;&#160;&#160;&#160;&#160;&#160; PID/Program name
</I>&gt;&gt;&gt;<i> ...
</I>&gt;&gt;&gt;<i> tcp6&#160;&#160;&#160;&#160;&#160; 33&#160;&#160;&#160;&#160;&#160; 0 :::3137 :::*&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; LISTEN -
</I>&gt;&gt;&gt;<i> tcp6&#160;&#160;&#160;&#160;&#160;&#160; 0&#160;&#160;&#160;&#160;&#160; 0 :::3136 :::*&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; LISTEN -
</I>&gt;&gt;&gt;<i> tcp6&#160;&#160;&#160;&#160;&#160;&#160; 4&#160;&#160;&#160;&#160;&#160; 0 :::3128 :::*&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; LISTEN -
</I>&gt;&gt;&gt;<i> tcp6&#160;&#160;&#160;&#160;&#160;&#160; 0&#160;&#160;&#160;&#160;&#160; 0 :::8081 :::*&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; LISTEN -
</I>&gt;&gt;&gt;<i> tcp6&#160;&#160;&#160;&#160;&#160;&#160; 0&#160;&#160;&#160;&#160;&#160; 0 :::8080 :::*&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; LISTEN -
</I>&gt;&gt;&gt;<i> tcp6&#160;&#160;&#160;&#160;&#160;&#160; 0&#160;&#160;&#160;&#160;&#160; 0 :::8083 :::*&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; LISTEN -
</I>&gt;&gt;&gt;<i> tcp6&#160;&#160;&#160;&#160;&#160;&#160; 0&#160;&#160;&#160;&#160;&#160; 0 :::8082 :::*&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; LISTEN -
</I>&gt;&gt;&gt;<i> tcp6&#160;&#160;&#160;&#160;&#160;&#160; 0&#160;&#160;&#160;&#160;&#160; 0 :::8084 :::*&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; LISTEN -
</I>&gt;&gt;&gt;<i> tcp6&#160;&#160;&#160; 4097&#160;&#160;&#160;&#160;&#160; 0 :::8093 :::*&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; LISTEN -
</I>&gt;&gt;&gt;<i> tcp6&#160;&#160;&#160;&#160;&#160;&#160; 0&#160;&#160;&#160;&#160;&#160; 0 :::8092 :::*&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; LISTEN -
</I>&gt;&gt;&gt;<i> tcp6&#160;&#160;&#160;&#160;&#160;&#160; 0&#160;&#160;&#160;&#160;&#160; 0 :::8094 :::*&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; LISTEN -
</I>&gt;&gt;&gt;<i> ...
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I do not have IPv6 enabled, yet there are 33 and 4097 numbers in 
</I>&gt;&gt;&gt;<i> Recv-Q and also no process/PID owns these ports.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Same IPv4 ports are not shown in use by netstat, so only IPv6 ports 
</I>&gt;&gt;&gt;<i> remain open, that too orphaned!
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> So what is happening?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Any idea to solve or any workaround?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Thank you,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Amish.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="026341.html">[squid-users] squid hangs and dies and can not be killed - needs system reboot
</A></li>
	<LI>Next message (by thread): <A HREF="026342.html">[squid-users] squid hangs and dies and can not be killed - needs system reboot
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26340">[ date ]</a>
              <a href="thread.html#26340">[ thread ]</a>
              <a href="subject.html#26340">[ subject ]</a>
              <a href="author.html#26340">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
