<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid hangs and dies and can not be killed - needs system reboot
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20hangs%20and%20dies%20and%20can%20not%20be%20killed%20-%0A%20needs%20system%20reboot&In-Reply-To=%3Cadd5fbda-db7f-42f2-8225-66a87cc81e12%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026340.html">
   <LINK REL="Next"  HREF="026343.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid hangs and dies and can not be killed - needs system reboot</H1>
    <B>Amish</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20hangs%20and%20dies%20and%20can%20not%20be%20killed%20-%0A%20needs%20system%20reboot&In-Reply-To=%3Cadd5fbda-db7f-42f2-8225-66a87cc81e12%40gmail.com%3E"
       TITLE="[squid-users] squid hangs and dies and can not be killed - needs system reboot">anon.amish at gmail.com
       </A><BR>
    <I>Thu Dec 21 12:10:40 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="026340.html">[squid-users] squid hangs and dies and can not be killed - needs system reboot
</A></li>
        <LI>Next message (by thread): <A HREF="026343.html">[squid-users] squid hangs and dies and can not be killed - needs system reboot
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26342">[ date ]</a>
              <a href="thread.html#26342">[ thread ]</a>
              <a href="subject.html#26342">[ subject ]</a>
              <a href="author.html#26342">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Alex,

Sorry for late reply. But this is a production system and hence 
debugging is tough. May take few days.

However I noticed that everytime squid hangs (goes dead), the dmesg has 
these errors.

[63567.802188] divide error: 0000 [#1] PREEMPT SMP PTI
[63567.802215] CPU: 3 PID: 617 Comm: squid Not tainted 6.6.7-arch1-1 #1 
4505c4baa0b3d7c4037b0e8f5402626fa360717f
[63567.802238] Hardware name: Gigabyte Technology Co., Ltd. 
H81M-S/H81M-S, BIOS F2 08/19/2015
[63567.802255] RIP: 0010:tcp_rcv_space_adjust+0xbe/0x160
[63567.802267] Code: f8 41 89 d0 29 d0 31 d2 49 0f af c2 49 f7 f0 45 8b 
81 bc 04 00 00 44 0f b6 8b 10 06 00 00 31 d2 49 8d 04 42 48 98 48 c1 e0 
08 &lt;49&gt; f7 f1 49 63 d0
48 98 48 39 d0 48 0f 47 c2 39 83 18 01 00 00 7c
[63567.802287] RSP: 0018:ffffba9f00da3c18 EFLAGS: 00010206
[63567.802296] RAX: 0000000004fb2800 RBX: ffff9e124acc1c80 RCX: 
0000000eccd9dace
[63567.802304] RDX: 0000000000000000 RSI: 0000000037fa4ae8 RDI: 
0000000000008349
[63567.802314] RBP: ffff9e124acc1c80 R08: 0000000000600000 R09: 
0000000000000000
[63567.802322] R10: 00000000000161d2 R11: ffff9e1346621700 R12: 
0000000000000000
[63567.802331] R13: ffff9e124acc1d58 R14: 0000000000000000 R15: 
ffff9e124acc2214
[63567.802340] FS:&#160; 00007fc3d627c840(0000) GS:ffff9e1457380000(0000) 
knlGS:0000000000000000
[63567.802350] CS:&#160; 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[63567.802358] CR2: 0000560b7e86d690 CR3: 0000000102f44001 CR4: 
00000000001706e0
[63567.802367] Call Trace:
[63567.802372]&#160; &lt;TASK&gt;
[63567.802378]&#160; ? die+0x36/0x90
[63567.802386]&#160; ? do_trap+0xda/0x100
[63567.802392]&#160; ? tcp_rcv_space_adjust+0xbe/0x160
[63567.802401]&#160; ? do_error_trap+0x6a/0x90
[63567.802408]&#160; ? tcp_rcv_space_adjust+0xbe/0x160
[63567.802415]&#160; ? exc_divide_error+0x38/0x50
[63567.802423]&#160; ? tcp_rcv_space_adjust+0xbe/0x160
[63567.802431]&#160; ? asm_exc_divide_error+0x1a/0x20
[63567.802441]&#160; ? tcp_rcv_space_adjust+0xbe/0x160
[63567.802449]&#160; ? tcp_rcv_space_adjust+0x1a/0x160
[63567.802456]&#160; tcp_recvmsg_locked+0x2d4/0x960
[63567.802464]&#160; tcp_recvmsg+0x87/0x1f0
[63567.802471]&#160; inet6_recvmsg+0x56/0x130
[63567.802479]&#160; ? __pfx_bpf_lsm_socket_recvmsg+0x10/0x10
[63567.802488]&#160; ? security_socket_recvmsg+0x44/0x70
[63567.802497]&#160; sock_recvmsg+0x57/0xd0
[63567.802505]&#160; sock_read_iter+0x96/0x100
[63567.802513]&#160; vfs_read+0x303/0x350
[63567.802796]&#160; ksys_read+0xbb/0xf0
[63567.803074]&#160; do_syscall_64+0x60/0x90
[63567.803346]&#160; ? syscall_exit_to_user_mode+0x2b/0x40
[63567.803619]&#160; ? do_syscall_64+0x6c/0x90
[63567.803890]&#160; ? syscall_exit_to_user_mode+0x2b/0x40
[63567.804163]&#160; ? do_syscall_64+0x6c/0x90
[63567.804438]&#160; ? do_syscall_64+0x6c/0x90
[63567.804710]&#160; entry_SYSCALL_64_after_hwframe+0x6e/0xd8
[63567.804984] RIP: 0033:0x7fc3d5f21531
[63567.805271] Code: ff ff eb c3 67 e8 2f c9 01 00 66 2e 0f 1f 84 00 00 
00 00 00 0f 1f 44 00 00 f3 0f 1e fa 80 3d 35 ce 0d 00 00 74 13 31 c0 0f 
05 &lt;48&gt; 3d 00 f0 ff ff
77 57 c3 66 0f 1f 44 00 00 48 83 ec 28 48 89 54
[63567.805909] RSP: 002b:00007fffa66f6748 EFLAGS: 00000246 ORIG_RAX: 
0000000000000000
[63567.806225] RAX: ffffffffffffffda RBX: 00007fffa66f6830 RCX: 
00007fc3d5f21531
[63567.806542] RDX: 000000000000191a RSI: 000055d106003d80 RDI: 
00000000000000bd
[63567.806855] RBP: 000055d10620bc30 R08: 000055d10620bc30 R09: 
000055d1036a8e78
[63567.807163] R10: 000055d1037ad630 R11: 0000000000000246 R12: 
000000000000191a
[63567.807472] R13: 000055d10664f410 R14: 000055d106003d80 R15: 
00007fc3d627c6b8
[63567.807768]&#160; &lt;/TASK&gt;
[63567.808037] Modules linked in: nfnetlink_queue nf_conntrack_netlink 
xt_connmark xt_mark ip_set_hash_net xt_NFQUEUE xt_set ip_set_hash_ip 
ip_set cls_fw sch_sfq sch_h
tb nf_nat_ftp nf_conntrack_ftp tls tun cfg80211 rfkill nft_chain_nat 
xt_MASQUERADE xt_nat xt_REDIRECT nf_nat nft_limit xt_limit xt_conntrack 
nf_conntrack nf_defrag_ipv
6 nf_defrag_ipv4 xt_multiport xt_tcpudp nft_compat nf_tables libcrc32c 
intel_rapl_msr intel_rapl_common x86_pkg_temp_thermal intel_powerclamp 
snd_hda_codec_realtek cor
etemp snd_hda_codec_generic ledtrig_audio snd_hda_codec_hdmi kvm_intel 
snd_hda_intel kvm snd_intel_dspcfg snd_intel_sdw_acpi irqbypass 
snd_hda_codec snd_hda_core crct1
0dif_pclmul r8169 crc32_pclmul snd_hwdep polyval_clmulni snd_pcm 
polyval_generic gf128mul snd_timer realtek ax88179_178a spi_nor 
mdio_devres usbnet snd libphy ghash_cl
mulni_intel mtd sha512_ssse3 at24 soundcore mii mei_pxp mei_hdcp 
sha256_ssse3 sha1_ssse3 iTCO_wdt i2c_i801 mei_me spi_intel_platform 
mousedev aesni_intel intel_pmc_bxt
 &#160;spi_intel iTCO_vendor_support
[63567.808076]&#160; i2c_smbus mei crypto_simd lpc_ich cryptd rapl 
intel_cstate intel_uncore psmouse mac_hid pcspkr pkcs8_key_parser fuse 
dm_mod loop nfnetlink ip_tables x_
tables ext4 crc32c_generic crc16 mbcache jbd2 i915 serio_raw 
i2c_algo_bit atkbd drm_buddy libps2 ttm vivaldi_fmap intel_gtt xhci_pci 
crc32c_intel drm_display_helper xh
ci_pci_renesas cec i8042 video serio wmi
[63567.811333] ---[ end trace 0000000000000000 ]---
[63567.811701] RIP: 0010:tcp_rcv_space_adjust+0xbe/0x160
[63567.812069] Code: f8 41 89 d0 29 d0 31 d2 49 0f af c2 49 f7 f0 45 8b 
81 bc 04 00 00 44 0f b6 8b 10 06 00 00 31 d2 49 8d 04 42 48 98 48 c1 e0 
08 &lt;49&gt; f7 f1 49 63 d0
48 98 48 39 d0 48 0f 47 c2 39 83 18 01 00 00 7c
[63567.812848] RSP: 0018:ffffba9f00da3c18 EFLAGS: 00010206
[63567.813252] RAX: 0000000004fb2800 RBX: ffff9e124acc1c80 RCX: 
0000000eccd9dace
[63567.813651] RDX: 0000000000000000 RSI: 0000000037fa4ae8 RDI: 
0000000000008349
[63567.814064] RBP: ffff9e124acc1c80 R08: 0000000000600000 R09: 
0000000000000000
[63567.814470] R10: 00000000000161d2 R11: ffff9e1346621700 R12: 
0000000000000000
[63567.814879] R13: ffff9e124acc1d58 R14: 0000000000000000 R15: 
ffff9e124acc2214
[63567.815290] FS:&#160; 00007fc3d627c840(0000) GS:ffff9e1457380000(0000) 
knlGS:0000000000000000
[63567.815700] CS:&#160; 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[63567.816121] CR2: 0000560b7e86d690 CR3: 0000000102f44001 CR4: 
00000000001706e0

After this the &quot;child&quot; squid process can not be killed, even by systemd, 
even by kill -9.

It appears that squid &quot;main&quot; process (owned by root user) does not hang 
and hence connections on port 8080 are accepted.

But squid child process (owned by proxy user) hangs and never recovers 
after above dmesg. And hence nothing happens and connection times out.

# ps aux |grep squid
root&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 612&#160; 0.0&#160; 0.2&#160; 75500 23680 ?&#160;&#160;&#160;&#160;&#160;&#160;&#160; Ss&#160;&#160; Dec20&#160;&#160; 0:02 
/usr/bin/squid -f /etc/squid/btnet/squid.btnet.conf --foreground -sYC
proxy&#160;&#160;&#160;&#160;&#160;&#160;&#160; 617&#160; 0.0&#160; 0.0&#160;&#160;&#160;&#160;&#160; 0&#160;&#160;&#160;&#160; 0 ?&#160;&#160;&#160;&#160;&#160;&#160;&#160; D&#160;&#160;&#160; Dec20&#160;&#160; 1:00 [squid]
proxy&#160;&#160;&#160;&#160;&#160;&#160;&#160; 620&#160; 0.0&#160; 0.0&#160; 12152&#160; 7552 ?&#160;&#160;&#160;&#160;&#160;&#160;&#160; S&#160;&#160;&#160; Dec20&#160;&#160; 0:00 
(security_file_certgen) -s /var/cache/squid/ssl_db -M 4MB
proxy&#160;&#160;&#160;&#160;&#160;&#160;&#160; 621&#160; 0.0&#160; 0.0&#160; 12152&#160; 7552 ?&#160;&#160;&#160;&#160;&#160;&#160;&#160; S&#160;&#160;&#160; Dec20&#160;&#160; 0:00 
(security_file_certgen) -s /var/cache/squid/ssl_db -M 4MB
proxy&#160;&#160;&#160;&#160;&#160;&#160;&#160; 622&#160; 0.0&#160; 0.0&#160; 11888&#160; 5504 ?&#160;&#160;&#160;&#160;&#160;&#160;&#160; S&#160;&#160;&#160; Dec20&#160;&#160; 0:00 
(security_file_certgen) -s /var/cache/squid/ssl_db -M 4MB
proxy&#160;&#160;&#160;&#160;&#160;&#160;&#160; 623&#160; 0.0&#160; 0.0&#160; 11888&#160; 5632 ?&#160;&#160;&#160;&#160;&#160;&#160;&#160; S&#160;&#160;&#160; Dec20&#160;&#160; 0:00 
(security_file_certgen) -s /var/cache/squid/ssl_db -M 4MB
proxy&#160;&#160;&#160;&#160;&#160;&#160;&#160; 624&#160; 0.0&#160; 0.0&#160; 11888&#160; 5632 ?&#160;&#160;&#160;&#160;&#160;&#160;&#160; S&#160;&#160;&#160; Dec20&#160;&#160; 0:00 
(security_file_certgen) -s /var/cache/squid/ssl_db -M 4MB
proxy&#160;&#160;&#160;&#160;&#160;&#160;&#160; 643&#160; 0.0&#160; 0.0&#160;&#160; 6116&#160; 3200 ?&#160;&#160;&#160;&#160;&#160;&#160;&#160; S&#160;&#160;&#160; Dec20&#160;&#160; 0:01 
(logfile-daemon) /var/log/squid/access.log

# telnet 127.0.0.1 8080
Trying 127.0.0.1...
Connected to 127.0.0.1.
Escape character is '^]'.
^]
telnet&gt; c

# curl -x 127.0.0.1:8080 --max-time 30 <A HREF="https://google.com">https://google.com</A>
curl: (28) Connection timed out after 30002 milliseconds

# kill 612 617

Ran kill 5 times, nothing happened. All squid processes remained.

# kill -9 612 617

Ran once, and all squid processes except 617 (child squid process) got 
killed

# ps aux |grep squid
proxy&#160;&#160;&#160;&#160;&#160;&#160;&#160; 617&#160; 0.0&#160; 0.0&#160;&#160;&#160;&#160;&#160; 0&#160;&#160;&#160;&#160; 0 ?&#160;&#160;&#160;&#160;&#160;&#160;&#160; D&#160;&#160;&#160; Dec20&#160;&#160; 1:00 [squid]
root&#160;&#160;&#160;&#160;&#160;&#160; 90764&#160; 0.0&#160; 0.0&#160;&#160; 6552&#160; 2560 pts/5&#160;&#160;&#160; S+&#160;&#160; 17:36&#160;&#160; 0:00 grep 
--color=auto squid

Can above information be of any help?

Thanks and regards,

Amish

On 19/12/23 20:46, Alex Rousskov wrote:
&gt;<i> On 2023-12-18 22:29, Amish wrote:
</I>&gt;&gt;<i> On 19/12/23 01:14, Alex Rousskov wrote:
</I>&gt;&gt;&gt;<i> On 2023-12-18 09:35, Amish wrote:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> I use Arch Linux and today I updated squid from squid 5.7 to squid 
</I>&gt;&gt;&gt;&gt;<i> 6.6.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> &gt; Dec 18 13:01:24 mumbai squid[604]: kick abandoning conn199
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I do not know whether the above problem is the primary problem in 
</I>&gt;&gt;&gt;<i> your setup, but it is a red flag. Transactions on the same 
</I>&gt;&gt;&gt;<i> connection may get stuck after that message; it is essentially a 
</I>&gt;&gt;&gt;<i> Squid bug.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I am not sure at all, but this bug might be related to Bug 5187 
</I>&gt;&gt;&gt;<i> workaround that went into Squid v6.2 (commit c44cfe7): 
</I>&gt;&gt;&gt;<i> <A HREF="https://bugs.squid-cache.org/show_bug.cgi?id=5187">https://bugs.squid-cache.org/show_bug.cgi?id=5187</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Does Squid accept new TCP connections after it enters what you 
</I>&gt;&gt;&gt;<i> describe as a dead state? For example, does &quot;telnet 127.0.0.1 8080&quot; 
</I>&gt;&gt;&gt;<i> establishes a connection if executed on the same machine as Squid?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i> Yes it establishes connection. But I do not know what to do next. 
</I>&gt;<i>
</I>&gt;<i> This tells us that your Squid is still listening for incoming 
</I>&gt;<i> connections. Most likely, it is not &quot;dead&quot; but running and just unable 
</I>&gt;<i> to make progress with those connections (for yet unknown reasons). 
</I>&gt;<i> That information is helpful but not sufficient (for me) to solve the 
</I>&gt;<i> problem you are describing.
</I>&gt;<i>
</I>&gt;<i> The next step that I would recommend is to collect debugging 
</I>&gt;<i> information from the running process and share a pointer to the 
</I>&gt;<i> corresponding compressed cache.log file:
</I>&gt;<i>
</I>&gt;<i> * Ideally, start collection when Squid starts and reproduce the 
</I>&gt;<i> problem while collecting full debugging information:
</I>&gt;<i> <A HREF="http://wiki.squid-cache.org/SquidFaq/BugReporting#full-debug-output">http://wiki.squid-cache.org/SquidFaq/BugReporting#full-debug-output</A>
</I>&gt;<i>
</I>&gt;<i> * If you have to, start collection after Squid is already in bad state 
</I>&gt;<i> and just before you use telnet or browser to tickle Squid:
</I>&gt;<i> <A HREF="http://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction">http://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction</A> 
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Do not use any secret information (e.g., production certificate keys) 
</I>&gt;<i> for these tests (unless you are going to share the logs privately with 
</I>&gt;<i> those you trust).
</I>&gt;<i>
</I>&gt;<i> Do not downgrade to v5 for these tests.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> HTH,
</I>&gt;<i>
</I>&gt;<i> Alex.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> Browser showed &quot;Connection timed out&quot; message. But I believe 
</I>&gt;&gt;<i> browser's also connected but nothing happened afterwards.
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> &gt; kill -9 does nothing
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Is it possible that you are trying to kill the wrong process? You 
</I>&gt;&gt;&gt;<i> should be killing this process AFAICT:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> &gt; root&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 601&#160; 0.0&#160; 0.2&#160; 73816 22528 ?&#160;&#160;&#160;&#160;&#160;&#160;&#160; Ss 12:59 0:02
</I>&gt;&gt;&gt;<i> &gt; /usr/bin/squid -f /etc/squid/btnet/squid.btnet.conf --foreground -sYC
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I did not clarify but all processes needed SIGKILL and vanished 
</I>&gt;&gt;<i> except the Dead squid process which still remained.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # systemctl stop squid
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Dec 19 08:46:38 mumbai systemd[1]: squid.service: State 
</I>&gt;&gt;<i> 'stop-sigterm' timed out. Killing.
</I>&gt;&gt;<i> Dec 19 08:46:38 mumbai systemd[1]: squid.service: Killing process 601 
</I>&gt;&gt;<i> (squid) with signal SIGKILL.
</I>&gt;&gt;<i> Dec 19 08:46:38 mumbai systemd[1]: squid.service: Killing process 604 
</I>&gt;&gt;<i> (squid) with signal SIGKILL.
</I>&gt;&gt;<i> Dec 19 08:46:38 mumbai systemd[1]: squid.service: Killing process 607 
</I>&gt;&gt;<i> (security_file_c) with signal SIGKILL.
</I>&gt;&gt;<i> Dec 19 08:46:38 mumbai systemd[1]: squid.service: Killing process 608 
</I>&gt;&gt;<i> (security_file_c) with signal SIGKILL.
</I>&gt;&gt;<i> Dec 19 08:46:38 mumbai systemd[1]: squid.service: Killing process 609 
</I>&gt;&gt;<i> (security_file_c) with signal SIGKILL.
</I>&gt;&gt;<i> Dec 19 08:46:38 mumbai systemd[1]: squid.service: Killing process 610 
</I>&gt;&gt;<i> (security_file_c) with signal SIGKILL.
</I>&gt;&gt;<i> Dec 19 08:46:38 mumbai systemd[1]: squid.service: Killing process 611 
</I>&gt;&gt;<i> (security_file_c) with signal SIGKILL.
</I>&gt;&gt;<i> Dec 19 08:46:38 mumbai systemd[1]: squid.service: Killing process 622 
</I>&gt;&gt;<i> (log_file_daemon) with signal SIGKILL.
</I>&gt;&gt;<i> Dec 19 08:46:38 mumbai systemd[1]: squid.service: Main process 
</I>&gt;&gt;<i> exited, code=killed, status=9/KILL
</I>&gt;&gt;<i> Dec 19 08:46:38 mumbai systemd[1]: squid.service: Killing process 604 
</I>&gt;&gt;<i> (squid) with signal SIGKILL.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Waited for 2 minutes for squid to stop then pressed ctrl-c to 
</I>&gt;&gt;<i> systemctl stop squid command.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> As you can see in last line shows that attempt was made to kill DEAD 
</I>&gt;&gt;<i> process with PID 604.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # ps aux |grep squid
</I>&gt;&gt;<i> proxy&#160;&#160;&#160;&#160;&#160;&#160;&#160; 604&#160; 0.0&#160; 0.0&#160;&#160;&#160;&#160;&#160; 0&#160;&#160;&#160;&#160; 0 ?&#160;&#160;&#160;&#160;&#160;&#160;&#160; D&#160;&#160;&#160; Dec18 0:03 [squid]
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Now only DEAD squid process remains.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> What next? Should I downgrade to 5.9 and check?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Regards
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Amish
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Alex.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> After the update from 5.7 to 6.6, squid starts but then reaches 
</I>&gt;&gt;&gt;&gt;<i> Dead state in a minute or two.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> # ps aux | grep squid
</I>&gt;&gt;&gt;&gt;<i> root&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 601&#160; 0.0&#160; 0.2&#160; 73816 22528 ?&#160;&#160;&#160;&#160;&#160;&#160;&#160; Ss&#160;&#160; 12:59 0:02 
</I>&gt;&gt;&gt;&gt;<i> /usr/bin/squid -f /etc/squid/btnet/squid.btnet.conf --foreground -sYC
</I>&gt;&gt;&gt;&gt;<i> proxy&#160;&#160;&#160;&#160;&#160;&#160;&#160; 604&#160; 0.0&#160; 0.0&#160;&#160;&#160;&#160;&#160; 0&#160;&#160;&#160;&#160; 0 ?&#160;&#160;&#160;&#160;&#160;&#160;&#160; D&#160;&#160;&#160; 12:59 0:03 
</I>&gt;&gt;&gt;&gt;<i> [squid]
</I>&gt;&gt;&gt;&gt;<i> proxy&#160;&#160;&#160;&#160;&#160;&#160;&#160; 607&#160; 0.0&#160; 0.0&#160; 11976&#160; 7424 ?&#160;&#160;&#160;&#160;&#160;&#160;&#160; S&#160;&#160;&#160; 12:59 0:00 
</I>&gt;&gt;&gt;&gt;<i> (security_file_certgen) -s /var/cache/squid/ssl_db -M 4MB
</I>&gt;&gt;&gt;&gt;<i> proxy&#160;&#160;&#160;&#160;&#160;&#160;&#160; 608&#160; 0.0&#160; 0.0&#160; 11976&#160; 7168 ?&#160;&#160;&#160;&#160;&#160;&#160;&#160; S&#160;&#160;&#160; 12:59 0:00 
</I>&gt;&gt;&gt;&gt;<i> (security_file_certgen) -s /var/cache/squid/ssl_db -M 4MB
</I>&gt;&gt;&gt;&gt;<i> proxy&#160;&#160;&#160;&#160;&#160;&#160;&#160; 609&#160; 0.0&#160; 0.0&#160; 11712&#160; 5632 ?&#160;&#160;&#160;&#160;&#160;&#160;&#160; S&#160;&#160;&#160; 12:59 0:00 
</I>&gt;&gt;&gt;&gt;<i> (security_file_certgen) -s /var/cache/squid/ssl_db -M 4MB
</I>&gt;&gt;&gt;&gt;<i> proxy&#160;&#160;&#160;&#160;&#160;&#160;&#160; 610&#160; 0.0&#160; 0.0&#160; 11712&#160; 5376 ?&#160;&#160;&#160;&#160;&#160;&#160;&#160; S&#160;&#160;&#160; 12:59 0:00 
</I>&gt;&gt;&gt;&gt;<i> (security_file_certgen) -s /var/cache/squid/ssl_db -M 4MB
</I>&gt;&gt;&gt;&gt;<i> proxy&#160;&#160;&#160;&#160;&#160;&#160;&#160; 611&#160; 0.0&#160; 0.0&#160; 11712&#160; 5504 ?&#160;&#160;&#160;&#160;&#160;&#160;&#160; S&#160;&#160;&#160; 12:59 0:00 
</I>&gt;&gt;&gt;&gt;<i> (security_file_certgen) -s /var/cache/squid/ssl_db -M 4MB
</I>&gt;&gt;&gt;&gt;<i> proxy&#160;&#160;&#160;&#160;&#160;&#160;&#160; 622&#160; 0.0&#160; 0.0&#160;&#160; 6116&#160; 3200 ?&#160;&#160;&#160;&#160;&#160;&#160;&#160; S&#160;&#160;&#160; 12:59 0:00 
</I>&gt;&gt;&gt;&gt;<i> (logfile-daemon) /var/log/squid/access.log
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> And then all requests get stuck. Notice the D (dead) state of squid.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> I use multiple ports for multiple purposes. (It all worked fine in 
</I>&gt;&gt;&gt;&gt;<i> squid 5.7)
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Dec 18 12:59:10 mumbai squid[601]: Starting Authentication on port 
</I>&gt;&gt;&gt;&gt;<i> [::]:3128
</I>&gt;&gt;&gt;&gt;<i> Dec 18 12:59:10 mumbai squid[601]: Disabling Authentication on port 
</I>&gt;&gt;&gt;&gt;<i> [::]:3128 (interception enabled)
</I>&gt;&gt;&gt;&gt;<i> Dec 18 12:59:10 mumbai squid[601]: Starting Authentication on port 
</I>&gt;&gt;&gt;&gt;<i> [::]:8081
</I>&gt;&gt;&gt;&gt;<i> Dec 18 12:59:10 mumbai squid[601]: Disabling Authentication on port 
</I>&gt;&gt;&gt;&gt;<i> [::]:8081 (interception enabled)
</I>&gt;&gt;&gt;&gt;<i> Dec 18 12:59:12 mumbai squid[601]: Starting Authentication on port 
</I>&gt;&gt;&gt;&gt;<i> [::]:8082
</I>&gt;&gt;&gt;&gt;<i> Dec 18 12:59:12 mumbai squid[601]: Disabling Authentication on port 
</I>&gt;&gt;&gt;&gt;<i> [::]:8082 (interception enabled)
</I>&gt;&gt;&gt;&gt;<i> Dec 18 12:59:12 mumbai squid[601]: Starting Authentication on port 
</I>&gt;&gt;&gt;&gt;<i> [::]:8083
</I>&gt;&gt;&gt;&gt;<i> Dec 18 12:59:12 mumbai squid[601]: Disabling Authentication on port 
</I>&gt;&gt;&gt;&gt;<i> [::]:8083 (interception enabled)
</I>&gt;&gt;&gt;&gt;<i> Dec 18 12:59:13 mumbai squid[601]: Starting Authentication on port 
</I>&gt;&gt;&gt;&gt;<i> [::]:8084
</I>&gt;&gt;&gt;&gt;<i> Dec 18 12:59:13 mumbai squid[601]: Disabling Authentication on port 
</I>&gt;&gt;&gt;&gt;<i> [::]:8084 (interception enabled)
</I>&gt;&gt;&gt;&gt;<i> Dec 18 12:59:13 mumbai squid[601]: Starting Authentication on port 
</I>&gt;&gt;&gt;&gt;<i> [::]:3136
</I>&gt;&gt;&gt;&gt;<i> Dec 18 12:59:13 mumbai squid[601]: Disabling Authentication on port 
</I>&gt;&gt;&gt;&gt;<i> [::]:3136 (interception enabled)
</I>&gt;&gt;&gt;&gt;<i> Dec 18 12:59:13 mumbai squid[601]: Starting Authentication on port 
</I>&gt;&gt;&gt;&gt;<i> [::]:3137
</I>&gt;&gt;&gt;&gt;<i> Dec 18 12:59:13 mumbai squid[601]: Disabling Authentication on port 
</I>&gt;&gt;&gt;&gt;<i> [::]:3137 (interception enabled)
</I>&gt;&gt;&gt;&gt;<i> ...
</I>&gt;&gt;&gt;&gt;<i> Dec 18 12:59:29 mumbai squid[604]: Adaptation support is on
</I>&gt;&gt;&gt;&gt;<i> Dec 18 12:59:29 mumbai squid[604]: Accepting NAT intercepted HTTP 
</I>&gt;&gt;&gt;&gt;<i> Socket connections at conn19 local=[::]:3128 remote=[::] FD 27 
</I>&gt;&gt;&gt;&gt;<i> flags=41
</I>&gt;&gt;&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; listening port: 3128
</I>&gt;&gt;&gt;&gt;<i> Dec 18 12:59:29 mumbai squid[604]: Accepting SSL bumped HTTP Socket 
</I>&gt;&gt;&gt;&gt;<i> connections at conn21 local=[::]:8080 remote=[::] FD 28 flags=9
</I>&gt;&gt;&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; listening port: 8080
</I>&gt;&gt;&gt;&gt;<i> Dec 18 12:59:29 mumbai squid[604]: Accepting NAT intercepted SSL 
</I>&gt;&gt;&gt;&gt;<i> bumped HTTPS Socket connections at conn23 local=[::]:8081 
</I>&gt;&gt;&gt;&gt;<i> remote=[::] FD 29 flags=41
</I>&gt;&gt;&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; listening port: 8081
</I>&gt;&gt;&gt;&gt;<i> Dec 18 12:59:29 mumbai squid[604]: Accepting SSL bumped HTTP Socket 
</I>&gt;&gt;&gt;&gt;<i> connections at conn25 local=[::]:8092 remote=[::] FD 30 flags=9
</I>&gt;&gt;&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; listening port: 8092
</I>&gt;&gt;&gt;&gt;<i> Dec 18 12:59:29 mumbai systemd[1]: Started Squid Web Proxy Server.
</I>&gt;&gt;&gt;&gt;<i> Dec 18 12:59:29 mumbai squid[604]: Accepting SSL bumped HTTP Socket 
</I>&gt;&gt;&gt;&gt;<i> connections at conn27 local=[::]:8093 remote=[::] FD 31 flags=9
</I>&gt;&gt;&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; listening port: 8093
</I>&gt;&gt;&gt;&gt;<i> Dec 18 12:59:29 mumbai squid[604]: Accepting SSL bumped HTTP Socket 
</I>&gt;&gt;&gt;&gt;<i> connections at conn29 local=[::]:8094 remote=[::] FD 32 flags=9
</I>&gt;&gt;&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; listening port: 8094
</I>&gt;&gt;&gt;&gt;<i> Dec 18 12:59:29 mumbai squid[604]: Accepting NAT intercepted SSL 
</I>&gt;&gt;&gt;&gt;<i> bumped HTTPS Socket connections at conn31 local=[::]:8082 
</I>&gt;&gt;&gt;&gt;<i> remote=[::] FD 33 flags=41
</I>&gt;&gt;&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; listening port: 8082
</I>&gt;&gt;&gt;&gt;<i> Dec 18 12:59:29 mumbai squid[604]: Accepting NAT intercepted SSL 
</I>&gt;&gt;&gt;&gt;<i> bumped HTTPS Socket connections at conn33 local=[::]:8083 
</I>&gt;&gt;&gt;&gt;<i> remote=[::] FD 34 flags=41
</I>&gt;&gt;&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; listening port: 8083
</I>&gt;&gt;&gt;&gt;<i> Dec 18 12:59:29 mumbai squid[604]: Accepting NAT intercepted SSL 
</I>&gt;&gt;&gt;&gt;<i> bumped HTTPS Socket connections at conn35 local=[::]:8084 
</I>&gt;&gt;&gt;&gt;<i> remote=[::] FD 35 flags=41
</I>&gt;&gt;&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; listening port: 8084
</I>&gt;&gt;&gt;&gt;<i> Dec 18 12:59:29 mumbai squid[604]: Accepting NAT intercepted HTTP 
</I>&gt;&gt;&gt;&gt;<i> Socket connections at conn37 local=[::]:3136 remote=[::] FD 36 
</I>&gt;&gt;&gt;&gt;<i> flags=41
</I>&gt;&gt;&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; listening port: 3136
</I>&gt;&gt;&gt;&gt;<i> Dec 18 12:59:29 mumbai squid[604]: Accepting NAT intercepted HTTP 
</I>&gt;&gt;&gt;&gt;<i> Socket connections at conn39 local=[::]:3137 remote=[::] FD 37 
</I>&gt;&gt;&gt;&gt;<i> flags=41
</I>&gt;&gt;&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; listening port: 3137
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> And then following errors came:
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Dec 18 12:59:45 mumbai squid[604]: ERROR: failure while accepting a 
</I>&gt;&gt;&gt;&gt;<i> TLS connection on conn41 local=192.168.0.1:8080 
</I>&gt;&gt;&gt;&gt;<i> remote=192.168.0.111:53867 FD 12 flags=1: SQUID_TLS
</I>&gt;&gt;&gt;&gt;<i> _ERR_ACCEPT+TLS_LIB_ERR=A000416+TLS_IO_ERR=1
</I>&gt;&gt;&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; current master transaction: 
</I>&gt;&gt;&gt;&gt;<i> master53
</I>&gt;&gt;&gt;&gt;<i> Dec 18 12:59:45 mumbai squid[604]: ERROR: failure while accepting a 
</I>&gt;&gt;&gt;&gt;<i> TLS connection on conn42 local=192.168.0.1:8080 
</I>&gt;&gt;&gt;&gt;<i> remote=192.168.0.111:53868 FD 14 flags=1: SQUID_TLS
</I>&gt;&gt;&gt;&gt;<i> _ERR_ACCEPT+TLS_LIB_ERR=A000416+TLS_IO_ERR=1
</I>&gt;&gt;&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; current master transaction: 
</I>&gt;&gt;&gt;&gt;<i> master53
</I>&gt;&gt;&gt;&gt;<i> Dec 18 12:59:45 mumbai squid[604]: ERROR: failure while accepting a 
</I>&gt;&gt;&gt;&gt;<i> TLS connection on conn43 local=192.168.0.1:8080 
</I>&gt;&gt;&gt;&gt;<i> remote=192.168.0.111:53869 FD 16 flags=1: SQUID_TLS
</I>&gt;&gt;&gt;&gt;<i> _ERR_ACCEPT+TLS_LIB_ERR=A000416+TLS_IO_ERR=1
</I>&gt;&gt;&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; current master transaction: 
</I>&gt;&gt;&gt;&gt;<i> master57
</I>&gt;&gt;&gt;&gt;<i> Dec 18 12:59:45 mumbai squid[604]: ERROR: failure while accepting a 
</I>&gt;&gt;&gt;&gt;<i> TLS connection on conn44 local=192.168.0.1:8080 
</I>&gt;&gt;&gt;&gt;<i> remote=192.168.0.111:53870 FD 12 flags=1: SQUID_TLS
</I>&gt;&gt;&gt;&gt;<i> _ERR_ACCEPT+TLS_LIB_ERR=A000416+TLS_IO_ERR=1
</I>&gt;&gt;&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; current master transaction: 
</I>&gt;&gt;&gt;&gt;<i> master57
</I>&gt;&gt;&gt;&gt;<i> Dec 18 12:59:56 mumbai squid[604]: ERROR: failure while accepting a 
</I>&gt;&gt;&gt;&gt;<i> TLS connection on conn62 local=192.168.0.1:8080 
</I>&gt;&gt;&gt;&gt;<i> remote=192.168.0.111:53887 FD 12 flags=1: SQUID_TLS
</I>&gt;&gt;&gt;&gt;<i> _ERR_ACCEPT+TLS_LIB_ERR=A000416+TLS_IO_ERR=1
</I>&gt;&gt;&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; current master transaction: 
</I>&gt;&gt;&gt;&gt;<i> master95
</I>&gt;&gt;&gt;&gt;<i> Dec 18 12:59:59 mumbai squid[604]: ERROR: failure while accepting a 
</I>&gt;&gt;&gt;&gt;<i> TLS connection on conn64 local=192.168.0.1:8080 
</I>&gt;&gt;&gt;&gt;<i> remote=192.168.0.111:53888 FD 12 flags=1: SQUID_TLS
</I>&gt;&gt;&gt;&gt;<i> _ERR_ACCEPT+TLS_LIB_ERR=A000416+TLS_IO_ERR=1
</I>&gt;&gt;&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; current master transaction: 
</I>&gt;&gt;&gt;&gt;<i> master99
</I>&gt;&gt;&gt;&gt;<i> Dec 18 13:00:02 mumbai squid[604]: ERROR: failure while accepting a 
</I>&gt;&gt;&gt;&gt;<i> TLS connection on conn65 local=192.168.0.1:8080 
</I>&gt;&gt;&gt;&gt;<i> remote=192.168.0.178:56115 FD 12 flags=1: SQUID_TLS
</I>&gt;&gt;&gt;&gt;<i> _ERR_ACCEPT+TLS_LIB_ERR=A000418+TLS_IO_ERR=1
</I>&gt;&gt;&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; current master transaction: 
</I>&gt;&gt;&gt;&gt;<i> master53
</I>&gt;&gt;&gt;&gt;<i> Dec 18 13:01:24 mumbai squid[604]: kick abandoning conn199 
</I>&gt;&gt;&gt;&gt;<i> local=192.168.0.1:8093 remote=192.168.0.101:52211 FD 52 flags=1
</I>&gt;&gt;&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; connection: conn199 
</I>&gt;&gt;&gt;&gt;<i> local=192.168.0.1:8093 remote=192.168.0.101:52211 FD 52 flags=1
</I>&gt;&gt;&gt;&gt;<i> Dec 18 13:01:45 mumbai squid[604]: ERROR: failure while accepting a 
</I>&gt;&gt;&gt;&gt;<i> TLS connection on conn240 local=192.168.0.1:8093 
</I>&gt;&gt;&gt;&gt;<i> remote=192.168.0.111:53931 FD 48 flags=1: SQUID_TL
</I>&gt;&gt;&gt;&gt;<i> S_ERR_ACCEPT+TLS_LIB_ERR=A000416+TLS_IO_ERR=1
</I>&gt;&gt;&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; current master transaction: 
</I>&gt;&gt;&gt;&gt;<i> master314
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> After this point there is nothing in systemd journal (via: 
</I>&gt;&gt;&gt;&gt;<i> journalctl -f -u squid) and same lines are in cache.log.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Squid got stuck (DEAD state) at 13:01 and right now it 19:26 (6 
</I>&gt;&gt;&gt;&gt;<i> hours passed) and squid is still in dead state.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> kill -9 or kill -ALRM or -HUP also does nothing.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> So to restart squid - I will need to restart whole system.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> I have sslbump directives but it is not really applied.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> #NOTE: nosslbump_ips below contains 192.168.0.0/24 (whole LAN) so 
</I>&gt;&gt;&gt;&gt;<i> effectively there is no SSL bump after step1.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> acl nosslbump_ips src 192.168.0.0/24
</I>&gt;&gt;&gt;&gt;<i> ssl_bump splice ssl_step1 nosslbump_ips
</I>&gt;&gt;&gt;&gt;<i> ssl_bump peek ssl_step1
</I>&gt;&gt;&gt;&gt;<i> ssl_bump splice nosslbump_domains
</I>&gt;&gt;&gt;&gt;<i> ssl_bump stare sslbump_domains
</I>&gt;&gt;&gt;&gt;<i> ssl_bump splice ssl_step2
</I>&gt;&gt;&gt;&gt;<i> ssl_bump bump all
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Any idea? If anything changed from 5.7 to 6.6 that may cause this 
</I>&gt;&gt;&gt;&gt;<i> behaviour?
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Looking at changelog:
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Bug 5256: Intercepting port fails to accept
</I>&gt;&gt;&gt;&gt;<i> <A HREF="https://bugs.squid-cache.org/show_bug.cgi?id=5256">https://bugs.squid-cache.org/show_bug.cgi?id=5256</A>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Bug 5154: Do not open IPv6 sockets when IPv6 is disabled
</I>&gt;&gt;&gt;&gt;<i> <A HREF="https://bugs.squid-cache.org/show_bug.cgi?id=5154">https://bugs.squid-cache.org/show_bug.cgi?id=5154</A>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Not sure if above two bug FIXES (in between v5.7 to v6.6) are 
</I>&gt;&gt;&gt;&gt;<i> related to my issue.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> I ran netstat:
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> # netstat -ntlp
</I>&gt;&gt;&gt;&gt;<i> Active Internet connections (only servers)
</I>&gt;&gt;&gt;&gt;<i> Proto Recv-Q Send-Q Local Address&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Foreign Address 
</I>&gt;&gt;&gt;&gt;<i> State&#160;&#160;&#160;&#160;&#160;&#160; PID/Program name
</I>&gt;&gt;&gt;&gt;<i> ...
</I>&gt;&gt;&gt;&gt;<i> tcp6&#160;&#160;&#160;&#160;&#160; 33&#160;&#160;&#160;&#160;&#160; 0 :::3137 :::*&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; LISTEN -
</I>&gt;&gt;&gt;&gt;<i> tcp6&#160;&#160;&#160;&#160;&#160;&#160; 0&#160;&#160;&#160;&#160;&#160; 0 :::3136 :::*&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; LISTEN -
</I>&gt;&gt;&gt;&gt;<i> tcp6&#160;&#160;&#160;&#160;&#160;&#160; 4&#160;&#160;&#160;&#160;&#160; 0 :::3128 :::*&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; LISTEN -
</I>&gt;&gt;&gt;&gt;<i> tcp6&#160;&#160;&#160;&#160;&#160;&#160; 0&#160;&#160;&#160;&#160;&#160; 0 :::8081 :::*&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; LISTEN -
</I>&gt;&gt;&gt;&gt;<i> tcp6&#160;&#160;&#160;&#160;&#160;&#160; 0&#160;&#160;&#160;&#160;&#160; 0 :::8080 :::*&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; LISTEN -
</I>&gt;&gt;&gt;&gt;<i> tcp6&#160;&#160;&#160;&#160;&#160;&#160; 0&#160;&#160;&#160;&#160;&#160; 0 :::8083 :::*&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; LISTEN -
</I>&gt;&gt;&gt;&gt;<i> tcp6&#160;&#160;&#160;&#160;&#160;&#160; 0&#160;&#160;&#160;&#160;&#160; 0 :::8082 :::*&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; LISTEN -
</I>&gt;&gt;&gt;&gt;<i> tcp6&#160;&#160;&#160;&#160;&#160;&#160; 0&#160;&#160;&#160;&#160;&#160; 0 :::8084 :::*&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; LISTEN -
</I>&gt;&gt;&gt;&gt;<i> tcp6&#160;&#160;&#160; 4097&#160;&#160;&#160;&#160;&#160; 0 :::8093 :::*&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; LISTEN -
</I>&gt;&gt;&gt;&gt;<i> tcp6&#160;&#160;&#160;&#160;&#160;&#160; 0&#160;&#160;&#160;&#160;&#160; 0 :::8092 :::*&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; LISTEN -
</I>&gt;&gt;&gt;&gt;<i> tcp6&#160;&#160;&#160;&#160;&#160;&#160; 0&#160;&#160;&#160;&#160;&#160; 0 :::8094 :::*&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; LISTEN -
</I>&gt;&gt;&gt;&gt;<i> ...
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> I do not have IPv6 enabled, yet there are 33 and 4097 numbers in 
</I>&gt;&gt;&gt;&gt;<i> Recv-Q and also no process/PID owns these ports.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Same IPv4 ports are not shown in use by netstat, so only IPv6 ports 
</I>&gt;&gt;&gt;&gt;<i> remain open, that too orphaned!
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> So what is happening?
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Any idea to solve or any workaround?
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Thank you,
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Amish.
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="026340.html">[squid-users] squid hangs and dies and can not be killed - needs system reboot
</A></li>
	<LI>Next message (by thread): <A HREF="026343.html">[squid-users] squid hangs and dies and can not be killed - needs system reboot
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26342">[ date ]</a>
              <a href="thread.html#26342">[ thread ]</a>
              <a href="subject.html#26342">[ subject ]</a>
              <a href="author.html#26342">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
