<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] why-squid-reuse-headers-from-parent-but-not-the-html-body-when-not-200-ok
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%0A%20why-squid-reuse-headers-from-parent-but-not-the-html-body-when-not-200-ok&In-Reply-To=%3Cb62ab530-4924-a2cf-b755-b67e72c3a88a%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025611.html">
   <LINK REL="Next"  HREF="025615.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] why-squid-reuse-headers-from-parent-but-not-the-html-body-when-not-200-ok</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%0A%20why-squid-reuse-headers-from-parent-but-not-the-html-body-when-not-200-ok&In-Reply-To=%3Cb62ab530-4924-a2cf-b755-b67e72c3a88a%40treenet.co.nz%3E"
       TITLE="[squid-users] why-squid-reuse-headers-from-parent-but-not-the-html-body-when-not-200-ok">squid3 at treenet.co.nz
       </A><BR>
    <I>Sat Feb  4 17:19:47 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025611.html">[squid-users] why-squid-reuse-headers-from-parent-but-not-the-html-body-when-not-200-ok
</A></li>
        <LI>Next message (by thread): <A HREF="025615.html">[squid-users] why-squid-reuse-headers-from-parent-but-not-the-html-body-when-not-200-ok
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25612">[ date ]</a>
              <a href="thread.html#25612">[ thread ]</a>
              <a href="subject.html#25612">[ subject ]</a>
              <a href="author.html#25612">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 4/02/2023 11:06 am, Tom JABBER wrote:
&gt;<i> @alex
</I>&gt;<i>
</I>&gt;<i> &quot;because popular browsers pretty much ignore CONNECT response headers 
</I>&gt;<i> (except for proxy authentication) and body (always?).&quot;
</I>&gt;<i>
</I>&gt;<i> Well that's exactly how we discovered it: facing a parent proxy that 
</I>&gt;<i> needs some AUTH.
</I>&gt;<i>
</I>&gt;<i> &quot;* After sending (to the client) an HTTP response header promising a 
</I>&gt;<i> body, Squid has an obligation to send that promised (and available to 
</I>&gt;<i> Squid) response body. Squid does not send it. Squid is buggy.&quot;
</I>&gt;<i>
</I>&gt;<i> We definitively agree on this.
</I>&gt;<i>
</I>&gt;<i> &quot;It is possible to modify Squid to stop promising to send the 
</I>&gt;<i> cache_peer response body (at an HTTP framing level), but it is 
</I>&gt;<i> probably better (and easier!) to modify Squid to just generate a short 
</I>&gt;<i> error response from scratch (instead of forwarding cache_peer response 
</I>&gt;<i> headers without a body). Doing so will probably break some use cases, 
</I>&gt;<i> so such a change may be officially rejected, but, even if it is, it 
</I>&gt;<i> may still work/help in some other specific use cases.&quot;
</I>&gt;<i>
</I>&gt;<i> By saying this you're suggesting I try to code this ? Or is there a 
</I>&gt;<i> possible configuration I missed ?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> @amos
</I>&gt;<i>
</I>&gt;<i> &quot;curl itself does this even without Squid.&quot;
</I>&gt;<i>
</I>&gt;<i> What do you mean ?
</I>&gt;<i>
</I>
The curl trace I showed in my post after that statement is identical in 
all the important ways to the one provided as evidence of Squid bug.
Except that my trace was done by making curl contact a web server - not 
a proxy.

In my test, using the squidclient tool to replicate the identical 
traffic shows content being delivered by the web server that curl did 
not show.

As such the curl output provided with &quot;no content&quot; is not evidence of 
anything other than how curl itself is behaving.


Cheers
Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025611.html">[squid-users] why-squid-reuse-headers-from-parent-but-not-the-html-body-when-not-200-ok
</A></li>
	<LI>Next message (by thread): <A HREF="025615.html">[squid-users] why-squid-reuse-headers-from-parent-but-not-the-html-body-when-not-200-ok
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25612">[ date ]</a>
              <a href="thread.html#25612">[ thread ]</a>
              <a href="subject.html#25612">[ subject ]</a>
              <a href="author.html#25612">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
