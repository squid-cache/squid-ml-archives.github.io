<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid returns 500 on rapidly changing DNS records
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20returns%20500%20on%20rapidly%20changing%20DNS%20records&In-Reply-To=%3CCACSz3ZTZob9rHQudeWqmvJw%2BajNxQ2T5ge6P-G-qmXRtx2psZg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025639.html">
   <LINK REL="Next"  HREF="025642.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid returns 500 on rapidly changing DNS records</H1>
    <B>Maciej Leks</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20returns%20500%20on%20rapidly%20changing%20DNS%20records&In-Reply-To=%3CCACSz3ZTZob9rHQudeWqmvJw%2BajNxQ2T5ge6P-G-qmXRtx2psZg%40mail.gmail.com%3E"
       TITLE="[squid-users] Squid returns 500 on rapidly changing DNS records">maciej.leks at gmail.com
       </A><BR>
    <I>Fri Feb 17 18:24:54 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025639.html">[squid-users] Squid returns 500 on rapidly changing DNS records
</A></li>
        <LI>Next message (by thread): <A HREF="025642.html">[squid-users] Squid returns 500 on rapidly changing DNS records
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25640">[ date ]</a>
              <a href="thread.html#25640">[ thread ]</a>
              <a href="subject.html#25640">[ subject ]</a>
              <a href="author.html#25640">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I understand your last question but it's hard me to answer clearly -
yes/no .  Instead of this let me show you this log:

17/Feb/2023:17:16:21 +0100 1676650581.827    103 100.121.11.70
100.121.11.70 NONE_NONE/500 0 CONNECT
scala-module-5515.scratch.lightning.force.com:443 - HIER_NONE/- -
17/Feb/2023:17:16:22 +0100 1676650582.297      0 100.121.11.70
100.121.11.70 NONE_NONE/500 0 CONNECT
scala-module-5515.scratch.lightning.force.com:443 - HIER_NONE/- -
17/Feb/2023:17:16:22 +0100 1676650582.893      0 100.121.11.70
100.121.11.70 NONE_NONE/500 0 CONNECT
scala-module-5515.scratch.lightning.force.com:443 - HIER_NONE/- -
17/Feb/2023:17:16:23 +0100 1676650583.625      0 100.121.11.70
100.121.11.70 NONE_NONE/500 0 CONNECT
scala-module-5515.scratch.lightning.force.com:443 - HIER_NONE/- -
17/Feb/2023:17:16:23 +0100 1676650583.711      0 100.121.11.70
100.121.11.70 NONE_NONE/500 0 CONNECT
scala-module-5515.scratch.lightning.force.com:443 - HIER_NONE/- -
17/Feb/2023:17:16:25 +0100 1676650585.073      0 100.121.11.70
100.121.11.70 NONE_NONE/500 0 CONNECT
scala-module-5515.scratch.lightning.force.com:443 - HIER_NONE/- -
17/Feb/2023:17:16:25 +0100 1676650585.799      0 100.121.11.70
100.121.11.70 NONE_NONE/500 0 CONNECT
scala-module-5515.scratch.lightning.force.com:443 - HIER_NONE/- -
17/Feb/2023:17:16:25 +0100 1676650585.882      0 100.121.11.70
100.121.11.70 NONE_NONE/500 0 CONNECT
scala-module-5515.scratch.lightning.force.com:443 - HIER_NONE/- -
17/Feb/2023:17:16:26 +0100 1676650586.258      0 100.121.11.70
100.121.11.70 NONE_NONE/500 0 CONNECT
scala-module-5515.scratch.lightning.force.com:443 - HIER_NONE/- -
17/Feb/2023:17:16:26 +0100 1676650586.995      0 100.121.11.70
100.121.11.70 NONE_NONE/500 0 CONNECT
scala-module-5515.scratch.lightning.force.com:443 - HIER_NONE/- -
17/Feb/2023:17:16:28 +0100 1676650588.468      0 100.121.11.70
100.121.11.70 NONE_NONE/500 0 CONNECT
scala-module-5515.scratch.lightning.force.com:443 - HIER_NONE/- -
17/Feb/2023:17:16:29 +0100 1676650589.159      0 100.121.11.70
100.121.11.70 NONE_NONE/500 0 CONNECT
scala-module-5515.scratch.lightning.force.com:443 - HIER_NONE/- -
17/Feb/2023:17:16:29 +0100 1676650589.560      0 100.121.11.70
100.121.11.70 NONE_NONE/500 0 CONNECT
scala-module-5515.scratch.lightning.force.com:443 - HIER_NONE/- -
17/Feb/2023:17:16:30 +0100 1676650590.319      0 100.121.11.70
100.121.11.70 NONE_NONE/500 0 CONNECT
scala-module-5515.scratch.lightning.force.com:443 - HIER_NONE/- -

This is the last resort parent squid and the 100.121.11.70 is our
downstream squid (child). I understand it as follows, thanks to
connect_retries set to 10 (here we have more than 10 tries) try to
connect.
I suppose the A/AAAA records should already be in the DNS, but the
last resort squid gave up.

Maciek

pt., 17 lut 2023 o 17:46 Alex Rousskov
&lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt; napisa&#322;(a):
&gt;<i>
</I>&gt;<i> On 2/17/23 09:31, Maciej Leks wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; We have being facing the 500 error codes in our squids (v5.7) when it
</I>&gt;<i> &gt; comes to communicate with Salesforce DNS for ephemeral hosts
</I>&gt;<i>
</I>&gt;<i> &gt;     A cs128-fra.fra.r.salesforce.com.              30s   85.222.154.211
</I>&gt;<i> &gt;     A cs128-fra.fra.r.salesforce.com.              30s   160.8.252.83
</I>&gt;<i> &gt;     A cs128-fra.fra.r.salesforce.com.              30s   85.222.152.83
</I>&gt;<i>
</I>&gt;<i> 30s TTLs will naturally limit the time Squid can cache these IPs for.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; From time to time DNS answers only sending SOA record (no A,AAAA records)
</I>&gt;<i>
</I>&gt;<i> Squid will fail to forward traffic if Squid does not have the
</I>&gt;<i> destination IP address cached and its new DNS lookup returns no IPv4 or
</I>&gt;<i> IPv6 records. Moreover, I am not 100% sure -- needs checking/testing --
</I>&gt;<i> but Squid might cache that &quot;negative&quot; no-IPs result (see
</I>&gt;<i> negative_dns_ttl that defaults to 60 seconds).
</I>&gt;<i>
</I>&gt;<i> Do all 500 error cases correspond to DNS answers without IPs? In other
</I>&gt;<i> words, is there a 500 error case after a DNS answer with IPs (within 29
</I>&gt;<i> seconds from each other)?
</I>&gt;<i>
</I>&gt;<i> HTH,
</I>&gt;<i>
</I>&gt;<i> Alex.
</I>&gt;<i> P.S. Sorry for not answering your questions below directly. I do not
</I>&gt;<i> have the time to document what Squid debugging logs mean, and I
</I>&gt;<i> recommend sharing them without analysis (by non-developers).
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; dig:
</I>&gt;<i> &gt; IP address of sagittarius-oatmilk-722.scratch.my.salesforce.com is
</I>&gt;<i> &gt; cs128.salesforce.com.
</I>&gt;<i> &gt; cs128-fra.salesforce.com.
</I>&gt;<i> &gt; cs128-fra.fra.r.salesforce.com.
</I>&gt;<i> &gt; 160.8.255.83
</I>&gt;<i> &gt; 160.8.249.83
</I>&gt;<i> &gt; 85.222.154.211
</I>&gt;<i> &gt; Failed to resolve sagittarius-oatmilk-722.scratch.my.salesforce.com
</I>&gt;<i> &gt; Failed to resolve sagittarius-oatmilk-722.scratch.my.salesforce.com
</I>&gt;<i> &gt; Failed to resolve sagittarius-oatmilk-722.scratch.my.salesforce.com
</I>&gt;<i> &gt; Failed to resolve sagittarius-oatmilk-722.scratch.my.salesforce.com
</I>&gt;<i> &gt; IP address of sagittarius-oatmilk-722.scratch.my.salesforce.com is
</I>&gt;<i> &gt; cs128.salesforce.com.
</I>&gt;<i> &gt; cs128-fra.salesforce.com.
</I>&gt;<i> &gt; cs128-fra.fra.r.salesforce.com.
</I>&gt;<i> &gt; 85.222.154.211
</I>&gt;<i> &gt; 160.8.255.83
</I>&gt;<i> &gt; 160.8.249.83
</I>&gt;<i> &gt; IP address of sagittarius-oatmilk-722.scratch.my.salesforce.com is
</I>&gt;<i> &gt; cs128.salesforce.com.
</I>&gt;<i> &gt; cs128-fra.salesforce.com.
</I>&gt;<i> &gt; cs128-fra.fra.r.salesforce.com.
</I>&gt;<i> &gt; 160.8.253.83
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Squid outputs then:
</I>&gt;<i> &gt; 16/Feb/2023:13:45:54 +0100 1676551554.420    107 100.113.24.84
</I>&gt;<i> &gt; 100.113.24.84 NONE_NONE/500 0 CONNECT
</I>&gt;<i> &gt; canal-trailblazer-1066.scratch.my.salesforce.com:443 - HIER_NONE/- - -
</I>&gt;<i> &gt; - &quot;/CN=gitlab-executor-stg.navio-services.opl-gcp.int&quot;
</I>&gt;<i> &gt; 16/Feb/2023:13:51:55 +0100 1676551915.973     82 100.113.25.178
</I>&gt;<i> &gt; 100.113.25.178 NONE_NONE/500 0 CONNECT
</I>&gt;<i> &gt; pumpkinspice-pisces-6588.scratch.my.salesforce.com:443 - HIER_NONE/- -
</I>&gt;<i> &gt; - - &quot;/CN=gitlab-executor-stg.navio-services.opl-gcp.int&quot;
</I>&gt;<i> &gt; 16/Feb/2023:13:52:44 +0100 1676551964.285     95 100.113.24.84
</I>&gt;<i> &gt; 100.113.24.84 NONE_NONE/500 0 CONNECT
</I>&gt;<i> &gt; trailblazer-builder-1043.scratch.file.force.com:443 - HIER_NONE/- - -
</I>&gt;<i> &gt; Mozilla/5.0%20(X11;%20Linux%20x86_64)%20AppleWebKit/537.36%20(KHTML,%20like%20Gecko)%20HeadlessChrome/109.0.5414.74%20Safari/537.36
</I>&gt;<i> &gt; &quot;/CN=gitlab-executor-stg.navio-services.opl-gcp.int&quot;
</I>&gt;<i> &gt; 16/Feb/2023:13:56:11 +0100 1676552171.392     43 100.121.10.183
</I>&gt;<i> &gt; 100.121.10.183 NONE_NONE/500 0 CONNECT
</I>&gt;<i> &gt; pistachio-vente-806.scratch.my.salesforce.com:443 - HIER_NONE/- - - -
</I>&gt;<i> &gt; &quot;/CN=gitlab-executor-stg.navio-services.opl-gcp.int&quot;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Child squids get then (the same situation but different case):
</I>&gt;<i> &gt; 17/Feb/2023:13:18:49 +0000 1676639929.989 88 100.121.10.104
</I>&gt;<i> &gt; TCP_TUNNEL/500 0 CONNECT
</I>&gt;<i> &gt; beans-goldengate-9524.scratch.my.salesforce.com:443 -
</I>&gt;<i> &gt; ANY_OLD_PARENT/100.112.36.14 -
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Such a situation but not the same case from squid internals point of
</I>&gt;<i> &gt; view I list below:
</I>&gt;<i> &gt; 74,5| RequestParser.cc(377) doParse: request-line: retval 1:
</I>&gt;<i> &gt; line={266, data='CONNECT
</I>&gt;<i> &gt; baybridge-module-8155.scratch.my.salesforce.com:443 HTTP/1.1
</I>&gt;<i> &gt; Host: baybridge-module-8155.scratch.my.salesforce.com:443
</I>&gt;<i> &gt; 2023/02/15 15:44:24.223 kid1| 74,5| RequestParser.cc(379) doParse:
</I>&gt;<i> &gt; request-line: url: baybridge-module-8155.scratch.my.salesforce.com:443
</I>&gt;<i> &gt; 2023/02/15 15:44:24.223 kid1| 74,5| Parser.cc(192) grabMimeBlock: mime
</I>&gt;<i> &gt; header (0-196) {Host:
</I>&gt;<i> &gt; baybridge-module-8155.scratch.my.salesforce.com:443
</I>&gt;<i> &gt; CONNECT baybridge-module-8155.scratch.my.salesforce.com:443 HTTP/1.1
</I>&gt;<i> &gt; Host: baybridge-module-8155.scratch.my.salesforce.com:443
</I>&gt;<i> &gt; Host: baybridge-module-8155.scratch.my.salesforce.com:443
</I>&gt;<i> &gt; 2023/02/15 15:44:24.223 kid1| 23,3| Uri.cc(441) parse: Split URL
</I>&gt;<i> &gt; 'baybridge-module-8155.scratch.my.salesforce.com:443' into proto='',
</I>&gt;<i> &gt; host='baybridge-module-8155.scratch.my.salesforce.com', port='443',
</I>&gt;<i> &gt; path=''
</I>&gt;<i> &gt; 2023/02/15 15:44:24.223 kid1| 14,3| Address.cc(389) lookupHostIP:
</I>&gt;<i> &gt; Given Non-IP 'baybridge-module-8155.scratch.my.salesforce.com': Name
</I>&gt;<i> &gt; or service not known
</I>&gt;<i> &gt; 2023/02/15 15:44:24.223 kid1| 33,5| Http1Server.cc(193)
</I>&gt;<i> &gt; buildHttpRequest: normalize 1 Host header using
</I>&gt;<i> &gt; baybridge-module-8155.scratch.my.salesforce.com:443
</I>&gt;<i> &gt; 2023/02/15 15:44:24.224 kid1| 85,3| client_side_request.cc(637)
</I>&gt;<i> &gt; hostHeaderVerify: validate
</I>&gt;<i> &gt; host=baybridge-module-8155.scratch.my.salesforce.com, port=443,
</I>&gt;<i> &gt; portStr=443
</I>&gt;<i> &gt; 2023/02/15 15:44:24.224 kid1| 14,3| ipcache.cc(722)
</I>&gt;<i> &gt; ipcache_gethostbyname: ipcache_gethostbyname:
</I>&gt;<i> &gt; 'baybridge-module-8155.scratch.my.salesforce.com', flags=1
</I>&gt;<i> &gt; 2023/02/15 15:44:24.224 kid1| 14,3| ipcache.cc(310) ipcacheRelease:
</I>&gt;<i> &gt; ipcacheRelease: Releasing entry for
</I>&gt;<i> &gt; 'baybridge-module-8155.scratch.my.salesforce.com'
</I>&gt;<i> &gt; 2023/02/15 15:44:24.224 kid1| 14,3| Address.cc(389) lookupHostIP:
</I>&gt;<i> &gt; Given Non-IP 'baybridge-module-8155.scratch.my.salesforce.com': Name
</I>&gt;<i> &gt; or service not known
</I>&gt;<i> &gt; 2023/02/15 15:44:24.224 kid1| 14,4| ipcache.cc(600)
</I>&gt;<i> &gt; ipcache_nbgethostbyname:
</I>&gt;<i> &gt; baybridge-module-8155.scratch.my.salesforce.com
</I>&gt;<i> &gt; 2023/02/15 15:44:24.224 kid1| 14,3| Address.cc(389) lookupHostIP:
</I>&gt;<i> &gt; Given Non-IP 'baybridge-module-8155.scratch.my.salesforce.com': Name
</I>&gt;<i> &gt; or service not known
</I>&gt;<i> &gt; 2023/02/15 15:44:24.224 kid1| 14,5| ipcache.cc(660)
</I>&gt;<i> &gt; ipcache_nbgethostbyname_: ipcache_nbgethostbyname: MISS for
</I>&gt;<i> &gt; 'baybridge-module-8155.scratch.my.salesforce.com'
</I>&gt;<i> &gt; 2023/02/15 15:44:24.224 kid1| 78,3| dns_internal.cc(1788) idnsALookup:
</I>&gt;<i> &gt; idnsALookup: buf is 65 bytes for
</I>&gt;<i> &gt; baybridge-module-8155.scratch.my.salesforce.com, id = 0x9c4
</I>&gt;<i> &gt; 2023/02/15 15:44:24.224 kid1| 78,3| dns_internal.cc(1724)
</I>&gt;<i> &gt; idnsSendSlaveAAAAQuery: buf is 65 bytes for
</I>&gt;<i> &gt; baybridge-module-8155.scratch.my.salesforce.com, id = 0x5b5e
</I>&gt;<i> &gt; 2023/02/15 15:44:24.224 kid1| 28,3| DestinationIp.cc(78) match: can't
</I>&gt;<i> &gt; yet compare 'to_localhost' ACL for
</I>&gt;<i> &gt; baybridge-module-8155.scratch.my.salesforce.com
</I>&gt;<i> &gt; 2023/02/15 15:44:24.224 kid1| 14,4| ipcache.cc(600)
</I>&gt;<i> &gt; ipcache_nbgethostbyname:
</I>&gt;<i> &gt; baybridge-module-8155.scratch.my.salesforce.com
</I>&gt;<i> &gt; 2023/02/15 15:44:24.224 kid1| 14,3| Address.cc(389) lookupHostIP:
</I>&gt;<i> &gt; Given Non-IP 'baybridge-module-8155.scratch.my.salesforce.com': Name
</I>&gt;<i> &gt; or service not known
</I>&gt;<i> &gt; 2023/02/15 15:44:24.224 kid1| 14,5| ipcache.cc(660)
</I>&gt;<i> &gt; ipcache_nbgethostbyname_: ipcache_nbgethostbyname: MISS for
</I>&gt;<i> &gt; 'baybridge-module-8155.scratch.my.salesforce.com'
</I>&gt;<i> &gt; 2023/02/15 15:44:24.247 kid1| 14,3| ipcache.cc(456) latestError: DNS
</I>&gt;<i> &gt; error while resolving baybridge-module-8155.scratch.my.salesforce.com:
</I>&gt;<i> &gt; No DNS records
</I>&gt;<i> &gt; 2023/02/15 15:44:24.248 kid1| 14,3| ipcache.cc(456) latestError: DNS
</I>&gt;<i> &gt; error while resolving baybridge-module-8155.scratch.my.salesforce.com:
</I>&gt;<i> &gt; No DNS records
</I>&gt;<i> &gt; 2023/02/15 15:44:24.282 kid1| 14,3| ipcache.cc(477) ipcacheParse: 3
</I>&gt;<i> &gt; answers for baybridge-module-8155.scratch.my.salesforce.com
</I>&gt;<i> &gt; 2023/02/15 15:44:24.282 kid1| 14,3| ipcache.cc(576)
</I>&gt;<i> &gt; ipcacheHandleReply: done with
</I>&gt;<i> &gt; baybridge-module-8155.scratch.my.salesforce.com: [no cached IPs]
</I>&gt;<i> &gt; 2023/02/15 15:44:24.282 kid1| 14,3| ipcache.cc(477) ipcacheParse: 3
</I>&gt;<i> &gt; answers for baybridge-module-8155.scratch.my.salesforce.com
</I>&gt;<i> &gt; 2023/02/15 15:44:24.282 kid1| 14,3| ipcache.cc(576)
</I>&gt;<i> &gt; ipcacheHandleReply: done with
</I>&gt;<i> &gt; baybridge-module-8155.scratch.my.salesforce.com: [no cached IPs]
</I>&gt;<i> &gt; 2023/02/15 15:44:24.282 kid1| 14,3| ipcache.cc(310) ipcacheRelease:
</I>&gt;<i> &gt; ipcacheRelease: Releasing entry for
</I>&gt;<i> &gt; 'baybridge-module-8155.scratch.my.salesforce.com'
</I>&gt;<i> &gt; 2023/02/15 15:44:24.282 kid1| 14,3| ipcache.cc(722)
</I>&gt;<i> &gt; ipcache_gethostbyname: ipcache_gethostbyname:
</I>&gt;<i> &gt; 'baybridge-module-8155.scratch.my.salesforce.com', flags=1
</I>&gt;<i> &gt; 2023/02/15 15:44:24.282 kid1| 28,3| DomainData.cc(110) match:
</I>&gt;<i> &gt; aclMatchDomainList: checking
</I>&gt;<i> &gt; 'baybridge-module-8155.scratch.my.salesforce.com'
</I>&gt;<i> &gt; 2023/02/15 15:44:24.282 kid1| 28,3| DomainData.cc(115) match:
</I>&gt;<i> &gt; aclMatchDomainList: 'baybridge-module-8155.scratch.my.salesforce.com'
</I>&gt;<i> &gt; NOT found
</I>&gt;<i> &gt; 2023/02/15 15:44:24.283 kid1| 28,3| DomainData.cc(110) match:
</I>&gt;<i> &gt; aclMatchDomainList: checking
</I>&gt;<i> &gt; 'baybridge-module-8155.scratch.my.salesforce.com'
</I>&gt;<i> &gt; 2023/02/15 15:44:24.283 kid1| 28,3| DomainData.cc(115) match:
</I>&gt;<i> &gt; aclMatchDomainList: 'baybridge-module-8155.scratch.my.salesforce.com'
</I>&gt;<i> &gt; found
</I>&gt;<i> &gt; 2023/02/15 15:44:24.283 kid1| 85,2| client_side_request.cc(745)
</I>&gt;<i> &gt; clientAccessCheckDone: The request CONNECT
</I>&gt;<i> &gt; baybridge-module-8155.scratch.my.salesforce.com:443 is ALLOWED; last
</I>&gt;<i> &gt; ACL checked: gitlab-executor-stg-dst
</I>&gt;<i> &gt; 2023/02/15 15:44:24.284 kid1| 85,2| client_side_request.cc(745)
</I>&gt;<i> &gt; clientAccessCheckDone: The request CONNECT
</I>&gt;<i> &gt; baybridge-module-8155.scratch.my.salesforce.com:443 is ALLOWED; last
</I>&gt;<i> &gt; ACL checked: gitlab-executor-stg-dst
</I>&gt;<i> &gt; 2023/02/15 15:44:24.284 kid1| 85,4| client_side_request.cc(1514)
</I>&gt;<i> &gt; processRequest: CONNECT
</I>&gt;<i> &gt; baybridge-module-8155.scratch.my.salesforce.com:443
</I>&gt;<i> &gt; 2023/02/15 15:44:24.284 kid1| 26,3| tunnel.cc(1140) tunnelStart:
</I>&gt;<i> &gt; CONNECT baybridge-module-8155.scratch.my.salesforce.com:443 HTTP/1.1
</I>&gt;<i> &gt; 2023/02/15 15:44:24.284 kid1| 44,3| peer_select.cc(612) selectMore:
</I>&gt;<i> &gt; CONNECT baybridge-module-8155.scratch.my.salesforce.com
</I>&gt;<i> &gt; 2023/02/15 15:44:24.284 kid1| 44,3| peer_select.cc(1098) addSelection:
</I>&gt;<i> &gt; adding HIER_DIRECT#baybridge-module-8155.scratch.my.salesforce.com
</I>&gt;<i> &gt; 2023/02/15 15:44:24.284 kid1| 44,2| peer_select.cc(460)
</I>&gt;<i> &gt; resolveSelected: Find IP destination for:
</I>&gt;<i> &gt; baybridge-module-8155.scratch.my.salesforce.com:443' via
</I>&gt;<i> &gt; baybridge-module-8155.scratch.my.salesforce.com
</I>&gt;<i> &gt; 2023/02/15 15:44:24.284 kid1| 14,4| ipcache.cc(607) nbgethostbyname:
</I>&gt;<i> &gt; baybridge-module-8155.scratch.my.salesforce.com
</I>&gt;<i> &gt; 2023/02/15 15:44:24.284 kid1| 14,3| Address.cc(389) lookupHostIP:
</I>&gt;<i> &gt; Given Non-IP 'baybridge-module-8155.scratch.my.salesforce.com': Name
</I>&gt;<i> &gt; or service not known
</I>&gt;<i> &gt; 2023/02/15 15:44:24.284 kid1| 14,4| ipcache.cc(647)
</I>&gt;<i> &gt; ipcache_nbgethostbyname_: ipcache_nbgethostbyname: HIT for
</I>&gt;<i> &gt; 'baybridge-module-8155.scratch.my.salesforce.com'
</I>&gt;<i> &gt; 2023/02/15 15:44:24.284 kid1| 44,2| peer_select.cc(479)
</I>&gt;<i> &gt; resolveSelected: PeerSelector4664913 found all 0 destinations for
</I>&gt;<i> &gt; baybridge-module-8155.scratch.my.salesforce.com:443
</I>&gt;<i> &gt; 2023/02/15 15:44:24.284 kid1| 4,3| errorpage.cc(1249)
</I>&gt;<i> &gt; compileLegacyCode: %U --&gt;
</I>&gt;<i> &gt; '<A HREF="https://baybridge-module-8155.scratch.my.salesforce.com/*">https://baybridge-module-8155.scratch.my.salesforce.com/*</A>'
</I>&gt;<i> &gt; 2023/02/15 15:44:24.284 kid1| 4,3| errorpage.cc(1249)
</I>&gt;<i> &gt; compileLegacyCode: %U --&gt;
</I>&gt;<i> &gt; '<A HREF="https://baybridge-module-8155.scratch.my.salesforce.com/*">https://baybridge-module-8155.scratch.my.salesforce.com/*</A>'
</I>&gt;<i> &gt; 2023/02/15 15:44:24.284 kid1| 4,3| errorpage.cc(1249)
</I>&gt;<i> &gt; compileLegacyCode: %W --&gt;
</I>&gt;<i> &gt; '?subject=CacheErrorInfo%20-%20ERR_CANNOT_FORWARD&amp;body=CacheHost%3A%20opl-egress-proxy-vm-31vr%0D%0AErrPage%3A%20ERR_CANNOT_FORWARD%0D%0AErr%3A%20%5Bnone%5D%0D%0ATimeStamp%3A%20Wed,%2015%20Feb%202023%2014%3A44%3A24%20GMT%0D%0A%0D%0AClientIP%3A%20100.121.10.148%0D%0A%0D%0AHTTP%20Request%3A%0D%0ACONNECT%20%20HTTP%2F1.1%0AVia%3A%201.1%20gitlab-proxy-6d445dbd8d-mxtqv%20(squid%2F5.7)%0D%0AX-Forwarded-For%3A%20100.113.24.224%0D%0ACache-Control%3A%20max-age%3D259200%0D%0AConnection%3A%20close%0D%0AHost%3A%20baybridge-module-8155.scratch.my.salesforce.com%3A443%0D%0A%0D%0A%0D%0A'
</I>&gt;<i> &gt; 2023/02/15 15:44:24.286 kid1| 33,3| client_side_request.cc(272)
</I>&gt;<i> &gt; ~ClientHttpRequest: httpRequestFree:
</I>&gt;<i> &gt; baybridge-module-8155.scratch.my.salesforce.com:443
</I>&gt;<i> &gt; 2023/02/15 15:44:24.286 kid1| 33,5| client_side.cc(385) logRequest:
</I>&gt;<i> &gt; logging half-baked transaction:
</I>&gt;<i> &gt; baybridge-module-8155.scratch.my.salesforce.com:443
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Our parent proxy settings for DNS:
</I>&gt;<i> &gt; negative_dns_ttl 3 seconds  #if we set 1s it behaves the same
</I>&gt;<i> &gt; dns_nameservers 8.8.8.8 1.1.1.1
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The question is:
</I>&gt;<i> &gt; If you carefully look at the debug log you see:
</I>&gt;<i> &gt; a. I(Squid) can't find IP for the name
</I>&gt;<i> &gt; b. I've got 3 IPs from DNS
</I>&gt;<i> &gt; c. OK, so I've got IP
</I>&gt;<i> &gt; d. ...Oh, I cannot find any IP
</I>&gt;<i> &gt; e. I can't find any destinations (what's that?)
</I>&gt;<i> &gt; f. I'm outputing an error
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; So, do you think it's ok or there is a bug?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Rgds,
</I>&gt;<i> &gt; Maciej Leks
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; squid-users mailing list
</I>&gt;<i> &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> &gt; <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025639.html">[squid-users] Squid returns 500 on rapidly changing DNS records
</A></li>
	<LI>Next message (by thread): <A HREF="025642.html">[squid-users] Squid returns 500 on rapidly changing DNS records
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25640">[ date ]</a>
              <a href="thread.html#25640">[ thread ]</a>
              <a href="subject.html#25640">[ subject ]</a>
              <a href="author.html#25640">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
