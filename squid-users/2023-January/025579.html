<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Allow SFTP connection to port 9122
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Allow%20SFTP%20connection%20to%20port%209122&In-Reply-To=%3CCP6P284MB162439452C55D6662114C142B4C49%40CP6P284MB1624.BRAP284.PROD.OUTLOOK.COM%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025578.html">
   <LINK REL="Next"  HREF="025580.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Allow SFTP connection to port 9122</H1>
    <B>Emanuel Gonzalez</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Allow%20SFTP%20connection%20to%20port%209122&In-Reply-To=%3CCP6P284MB162439452C55D6662114C142B4C49%40CP6P284MB1624.BRAP284.PROD.OUTLOOK.COM%3E"
       TITLE="[squid-users] Allow SFTP connection to port 9122">emanuel_gonzalez at live.com.ar
       </A><BR>
    <I>Thu Jan 19 13:45:51 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025578.html">[squid-users] Squid Dual HTTP &amp; SOCKS Set-Up
</A></li>
        <LI>Next message (by thread): <A HREF="025580.html">[squid-users] Allow SFTP connection to port 9122
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25579">[ date ]</a>
              <a href="thread.html#25579">[ thread ]</a>
              <a href="subject.html#25579">[ subject ]</a>
              <a href="author.html#25579">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all,

Hi, I need some help.

I have configured an instance with squid as a proxy service. HTTP/HTTPS requests pass through the proxy correctly.

acl Safe_ports port 9122
acl SSL_ports port 9122
acl Safe_ports port 22
acl SSL_ports port 22


But I need to connect to an SFTP service that listens on port 9122.

On the squid configuration side I have added port 9122 to the secure ports and the connection host to the hosts allowed in the dstdomain.

I have created the environment variables necessary to be able to exit through the proxy:

http_proxy=<A HREF="http://myprox.prod:3142">http://myprox.prod:3142</A>

ftp_proxy=<A HREF="http://myproxy.prod:3142">http://myproxy.prod:3142</A>

https_proxy=<A HREF="http://myproxy.prod:3142">http://myproxy.prod:3142</A>

i try the connection but never happen

sftp -v -oProxyCommand='nc -v -xtheprovider-front.prod:3142 %h %p' -oPort=9122 <A HREF="https://lists.squid-cache.org/listinfo/squid-users">user at sftp.server.com</A>
OpenSSH_6.7p1 Debian-5+deb8u3, OpenSSL 1.0.1t  3 May 2016
debug1: Reading configuration data /etc/ssh/ssh_config
debug1: /etc/ssh/ssh_config line 18: Applying options for *
debug1: Executing proxy command: exec nc -v -xtheprovider front.prod:3142 sftp.server.com 9122
debug1: permanently_set_uid: 0/0
debug1: permanently_drop_suid: 0
debug1: key_load_public: No such file or directory
debug1: identity file /root/.ssh/id_rsa type -1
debug1: key_load_public: No such file or directory
debug1: identity file /root/.ssh/id_rsa-cert type -1
debug1: key_load_public: No such file or directory
debug1: identity file /root/.ssh/id_dsa type -1
debug1: key_load_public: No such file or directory
debug1: identity file /root/.ssh/id_dsa-cert type -1
debug1: key_load_public: No such file or directory
debug1: identity file /root/.ssh/id_ecdsa type -1
debug1: key_load_public: No such file or directory
debug1: identity file /root/.ssh/id_ecdsa-cert type -1
debug1: key_load_public: No such file or directory
debug1: identity file /root/.ssh/id_ed25519 type -1
debug1: key_load_public: No such file or directory
debug1: identity file /root/.ssh/id_ed25519-cert type -1
debug1: Enabling compatibility mode for protocol 2.0
debug1: Local version string SSH-2.0-OpenSSH_6.7p1 Debian-5+deb8u3



#### squid logs

1674134582.904      0 172.31.29.227 NONE/000 0 NONE error:transaction-end-before-headers - HIER_NONE/- -


Any help?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20230119/c6a2ba1c/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20230119/c6a2ba1c/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025578.html">[squid-users] Squid Dual HTTP &amp; SOCKS Set-Up
</A></li>
	<LI>Next message (by thread): <A HREF="025580.html">[squid-users] Allow SFTP connection to port 9122
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25579">[ date ]</a>
              <a href="thread.html#25579">[ thread ]</a>
              <a href="subject.html#25579">[ subject ]</a>
              <a href="author.html#25579">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
