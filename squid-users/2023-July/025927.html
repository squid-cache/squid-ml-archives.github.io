<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] make URL bypass squid proxy
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20make%20URL%20bypass%20squid%20proxy&In-Reply-To=%3CCAGU_Ci%2Bc_BbOYXED69V6EgTCKYkWhGp69F5c1LSUY5CK-xHTJQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025924.html">
   <LINK REL="Next"  HREF="025928.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] make URL bypass squid proxy</H1>
    <B>robert k Wild</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20make%20URL%20bypass%20squid%20proxy&In-Reply-To=%3CCAGU_Ci%2Bc_BbOYXED69V6EgTCKYkWhGp69F5c1LSUY5CK-xHTJQ%40mail.gmail.com%3E"
       TITLE="[squid-users] make URL bypass squid proxy">robertkwild at gmail.com
       </A><BR>
    <I>Thu Jul  6 12:29:51 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025924.html">[squid-users] trickeling support in squid as icap client
</A></li>
        <LI>Next message (by thread): <A HREF="025928.html">[squid-users] Squid config Teams add-on in Outlook
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25927">[ date ]</a>
              <a href="thread.html#25927">[ thread ]</a>
              <a href="subject.html#25927">[ subject ]</a>
              <a href="author.html#25927">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>hi Eliezer,

unfortunately that did not work ie

acl NoSSLInterceptRegEx ssl::server_name_regex (^|.*\.)redshift3d\.com$
acl NoSSLInterceptDstDom ssl::server_name .redshift3d.com

acl NoSSLInterceptAnyOf any-of NoSSLInterceptDstDom NoSSLInterceptRegEx

ssl_bump peek DiscoverSNIHost
ssl_bump splice NoSSLInterceptAnyOf
ssl_bump bump all

but strange is on the firewall if i make a rule for that network, port 80,
443 to access redshift3d.com it works, so ive narrowed it down to the squid

thanks,
rob

On Thu, 29 Jun 2023 at 11:40, &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A>&gt; wrote:

&gt;<i> Hey Rob,
</I>&gt;<i>
</I>&gt;<i> it&#8217;s a great question.
</I>&gt;<i> I will assume you are using squid 5.x since it&#8217;s the stable one.
</I>&gt;<i> There is a configuration reference documentation at:
</I>&gt;<i> <A HREF="http://www.squid-cache.org/Versions/v5/cfgman/">http://www.squid-cache.org/Versions/v5/cfgman/</A>
</I>&gt;<i>
</I>&gt;<i> And the relevant one is &#8216;acl&#8217;:
</I>&gt;<i> <A HREF="http://www.squid-cache.org/Versions/v5/cfgman/acl.html">http://www.squid-cache.org/Versions/v5/cfgman/acl.html</A>
</I>&gt;<i>
</I>&gt;<i> In the config we the next options:
</I>&gt;<i> * dstdom_regex
</I>&gt;<i> * dstdomain
</I>&gt;<i> * ssl::server_name
</I>&gt;<i> * ssl::server_name_regex
</I>&gt;<i>
</I>&gt;<i> Each one of them is different in two things.
</I>&gt;<i> The dstdomain is happening when the http request verification is done,
</I>&gt;<i> usually in the http_access part.
</I>&gt;<i> So for a CONNECT request in your case it should work but will only work
</I>&gt;<i> for http_access rules ie allow or deny the connection to being proxied by
</I>&gt;<i> the proxy.
</I>&gt;<i> All this happens before the bump stage.
</I>&gt;<i> The dstdom_regex is doing the same but with another &quot;lookup&quot; mechanism.
</I>&gt;<i> Just to illustrate we will use the domain www.example.com.
</I>&gt;<i>
</I>&gt;<i> With dstdomain .example.com which is a wildcard domain the www.example
</I>&gt;<i> .com will match since what it does it..
</I>&gt;<i> Take apart the .example.com into .com and .example and example
</I>&gt;<i> (logically, not the code actually does..)
</I>&gt;<i> Then when a request for www.example-2.com arrives the dstdomain acl
</I>&gt;<i> checks the strings one by one ie:
</I>&gt;<i> com
</I>&gt;<i> example-2
</I>&gt;<i> www
</I>&gt;<i>
</I>&gt;<i> So the &quot;com&quot; would match and since it has a dot &quot;.&quot; as a prefix it
</I>&gt;<i> continues to the next part of the domain name ie:
</I>&gt;<i> example-2
</I>&gt;<i>
</I>&gt;<i> and it will try to match it to &quot;example&quot; from the &quot;.example.com'.
</I>&gt;<i> then it will fail and there for it will declare the specific definition in
</I>&gt;<i> the acl as &quot;do not match.
</I>&gt;<i> But for www.example .com it would be different:
</I>&gt;<i>
</I>&gt;<i> Squid will find that the .com is in the &quot;com&quot; part of www.example.com and
</I>&gt;<i> will continue to the next part ie
</I>&gt;<i> &quot;example&quot; and it will match.
</I>&gt;<i> Then it will see the dot &quot;.&quot; which means that all subdomains are a part of
</I>&gt;<i> this rule ie both example.com and any other domain
</I>&gt;<i> under .example.com will match so... www.example.com and www2.example.com
</I>&gt;<i> and w.example.com will match and this is compared to
</I>&gt;<i> example.com
</I>&gt;<i>
</I>&gt;<i> with dstdomain example.com it will only match a full match of example.com
</I>&gt;<i> but not www.example.com and it's pointless to define both:
</I>&gt;<i> - example.com
</I>&gt;<i> - .example.com
</I>&gt;<i>
</I>&gt;<i> In the same acl file.
</I>&gt;<i> Squid will compare it to the basic proxy url request and the Host: header
</I>&gt;<i> inside of it.
</I>&gt;<i> (Amos might remember which one of these wins or which one is the main one)
</I>&gt;<i>
</I>&gt;<i> So that's how a dstdomain test works.
</I>&gt;<i> The dstdom_regex is applied on the same &quot;part&quot; of the proxy request ie
</I>&gt;<i> request url and Host header but...
</I>&gt;<i> Tries to match it with a regex that is a much more &quot;CPU&quot; intensive but can
</I>&gt;<i> do magic if you know how to use it right.
</I>&gt;<i> The pros are that you can use one regex to match about 100 domains however
</I>&gt;<i> dstdomain is much faster in many cases.
</I>&gt;<i> To test regex in general I love:
</I>&gt;<i> <A HREF="https://rubular.com/">https://rubular.com/</A>
</I>&gt;<i>
</I>&gt;<i> and it's very simple to put a line with the url or the domain itself and
</I>&gt;<i> write the pattern and then get instant result.
</I>&gt;<i> There are many sites which does this exact same thing.
</I>&gt;<i> You need: activate.redshift3d.com  for the test.
</I>&gt;<i>
</I>&gt;<i> For the server_name dstdom and regex the difference is on what part of the
</I>&gt;<i> &quot;known&quot; information on the request done.
</I>&gt;<i> Ie it's not on the known plain text proxy request but a &quot;peek&quot; into the
</I>&gt;<i> client or server TLS part of the connection bumping.
</I>&gt;<i> It's possible on TLS 1.2 with ease but 1.3 with encryption it's a whole
</I>&gt;<i> other story.
</I>&gt;<i> (Alex and his team is more involved in this part then me)
</I>&gt;<i>
</I>&gt;<i> It's a bit more complex in the server_name part since from what I remember
</I>&gt;<i> the server_name can be the SNI itself or parts of the
</I>&gt;<i> certificate of the server.
</I>&gt;<i> In the certificate of the server in many cases there is no real domain but
</I>&gt;<i> a catch all ie multidomain which is for example:
</I>&gt;<i> *.example.com
</I>&gt;<i>
</I>&gt;<i> The ssl::server_name is like dstdomain so .example.com should match both
</I>&gt;<i> SNI with www.example.com and the *.example.com
</I>&gt;<i> If it doesn't then it&#8217;s a bug..
</I>&gt;<i>
</I>&gt;<i> About the ssl::server_name_regex you will need to test and match the regex
</I>&gt;<i> against couple possibilities that are in the certificate ie:
</I>&gt;<i> *.example.com
</I>&gt;<i> activation.example.com
</I>&gt;<i>
</I>&gt;<i> etc...
</I>&gt;<i>
</I>&gt;<i> The current certificate I see is:
</I>&gt;<i> Certificate:
</I>&gt;<i>     Data:
</I>&gt;<i>         Version: 3 (0x2)
</I>&gt;<i>         Serial Number:
</I>&gt;<i>             c0:71:02:fc:1f:e5:64:5b:0d:d6:ae:c8:1a:17:e6:80
</I>&gt;<i>         Signature Algorithm: sha256WithRSAEncryption
</I>&gt;<i>         Issuer: C = GB, ST = Greater Manchester, L = Salford, O = Sectigo
</I>&gt;<i> Limited, CN = Sectigo RSA Domain Validation Secure Server CA
</I>&gt;<i>         Validity
</I>&gt;<i>             Not Before: Dec 14 00:00:00 2022 GMT
</I>&gt;<i>             Not After : Jan 12 23:59:59 2024 GMT
</I>&gt;<i>         Subject: CN = activate.redshift3d.com
</I>&gt;<i>         Subject Public Key Info:
</I>&gt;<i>             Public Key Algorithm: rsaEncryption
</I>&gt;<i>                 RSA Public-Key: (2048 bit)
</I>&gt;<i>                 Modulus:
</I>&gt;<i>                     00:cd:f9:bd:58:a4:7a:16:3f:23:12:9d:e0:1e:39:
</I>&gt;<i>                     a0:ef:66:ae:b3:ae:32:5c:69:9e:cc:89:83:fb:a2:
</I>&gt;<i>                     e0:c7:9d:86:aa:e6:9b:b3:d9:0c:bb:35:36:2f:cf:
</I>&gt;<i>                     be:ec:1e:62:ca:d8:ab:16:66:6e:00:8d:f7:42:3d:
</I>&gt;<i>                     5b:d6:bf:a0:30:a1:c2:6f:5e:69:76:ef:0c:38:73:
</I>&gt;<i>                     d2:e8:42:b8:83:04:a3:2c:da:22:a4:c4:13:71:38:
</I>&gt;<i>                     36:00:1b:e7:b3:f0:fe:6e:59:17:11:e7:0a:81:3e:
</I>&gt;<i>                     04:b2:ad:e0:61:c1:15:f3:9a:36:33:24:a6:f1:0d:
</I>&gt;<i>                     b6:e6:32:91:34:54:7c:da:40:14:72:06:25:91:78:
</I>&gt;<i>                     75:07:84:62:47:7b:3f:05:60:e6:35:d3:27:55:1e:
</I>&gt;<i>                     ff:23:82:18:09:f5:8a:0f:a6:cb:02:bc:d6:09:98:
</I>&gt;<i>                     54:5b:10:e3:d2:09:4e:31:2a:75:42:29:00:86:9b:
</I>&gt;<i>                     f9:78:2f:fd:99:9e:2e:10:3e:bc:84:f5:9b:3a:3f:
</I>&gt;<i>                     fa:d9:b6:20:c0:2e:86:f3:de:14:be:3a:1a:05:30:
</I>&gt;<i>                     3b:00:e6:50:8d:4c:13:a3:97:dc:f4:03:9e:84:31:
</I>&gt;<i>                     0d:23:f2:02:50:6d:53:a5:30:03:b0:fd:f2:46:64:
</I>&gt;<i>                     49:22:a4:d1:5a:00:fb:78:37:fc:51:b1:f0:6e:41:
</I>&gt;<i>                     3b:5d
</I>&gt;<i>                 Exponent: 65537 (0x10001)
</I>&gt;<i>         X509v3 extensions:
</I>&gt;<i>             X509v3 Authority Key Identifier:
</I>&gt;<i>
</I>&gt;<i> keyid:8D:8C:5E:C4:54:AD:8A:E1:77:E9:9B:F9:9B:05:E1:B8:01:8D:61:E1
</I>&gt;<i>
</I>&gt;<i>             X509v3 Subject Key Identifier:
</I>&gt;<i>                 5D:BC:D9:F2:C4:99:83:5E:C0:3A:F1:BF:FE:F2:E3:92:92:F1:F0:29
</I>&gt;<i>             X509v3 Key Usage: critical
</I>&gt;<i>                 Digital Signature, Key Encipherment
</I>&gt;<i>             X509v3 Basic Constraints: critical
</I>&gt;<i>                 CA:FALSE
</I>&gt;<i>             X509v3 Extended Key Usage:
</I>&gt;<i>                 TLS Web Server Authentication, TLS Web Client
</I>&gt;<i> Authentication
</I>&gt;<i>             X509v3 Certificate Policies:
</I>&gt;<i>                 Policy: 1.3.6.1.4.1.6449.1.2.2.7
</I>&gt;<i>                   CPS: <A HREF="https://sectigo.com/CPS">https://sectigo.com/CPS</A>
</I>&gt;<i>                 Policy: 2.23.140.1.2.1
</I>&gt;<i>
</I>&gt;<i>             Authority Information Access:
</I>&gt;<i>                 CA Issuers - URI:
</I>&gt;<i> <A HREF="http://crt.sectigo.com/SectigoRSADomainValidationSecureServerCA.crt">http://crt.sectigo.com/SectigoRSADomainValidationSecureServerCA.crt</A>
</I>&gt;<i>                 OCSP - URI:<A HREF="http://ocsp.sectigo.com">http://ocsp.sectigo.com</A>
</I>&gt;<i>
</I>&gt;<i>             X509v3 Subject Alternative Name:
</I>&gt;<i>                 DNS:activate.redshift3d.com, DNS:
</I>&gt;<i> www.activate.redshift3d.com
</I>&gt;<i>             CT Precertificate SCTs:
</I>&gt;<i>                 Signed Certificate Timestamp:
</I>&gt;<i>                     Version   : v1 (0x0)
</I>&gt;<i>                     Log ID    :
</I>&gt;<i> 76:FF:88:3F:0A:B6:FB:95:51:C2:61:CC:F5:87:BA:34:
</I>&gt;<i>
</I>&gt;<i> B4:A4:CD:BB:29:DC:68:42:0A:9F:E6:67:4C:5A:3A:74
</I>&gt;<i>                     Timestamp : Dec 14 15:34:39.227 2022 GMT
</I>&gt;<i>                     Extensions: none
</I>&gt;<i>                     Signature : ecdsa-with-SHA256
</I>&gt;<i>
</I>&gt;<i> 30:44:02:20:6E:D0:96:68:F3:07:A0:5F:DD:C5:B2:61:
</I>&gt;<i>
</I>&gt;<i> 2F:51:6B:06:4A:3C:7F:9B:DA:08:6D:5A:31:0D:B8:0B:
</I>&gt;<i>
</I>&gt;<i> 83:7D:D6:37:02:20:64:66:3F:A2:40:87:78:9E:C8:90:
</I>&gt;<i>
</I>&gt;<i> 7C:EE:7C:77:3C:BB:43:C1:9F:52:54:F1:04:85:B6:AC:
</I>&gt;<i>                                 6B:F2:36:8E:E3:03
</I>&gt;<i>                 Signed Certificate Timestamp:
</I>&gt;<i>                     Version   : v1 (0x0)
</I>&gt;<i>                     Log ID    :
</I>&gt;<i> 3B:53:77:75:3E:2D:B9:80:4E:8B:30:5B:06:FE:40:3B:
</I>&gt;<i>
</I>&gt;<i> 67:D8:4F:C3:F4:C7:BD:00:0D:2D:72:6F:E1:FA:D4:17
</I>&gt;<i>                     Timestamp : Dec 14 15:34:39.153 2022 GMT
</I>&gt;<i>                     Extensions: none
</I>&gt;<i>                     Signature : ecdsa-with-SHA256
</I>&gt;<i>
</I>&gt;<i> 30:44:02:20:69:BA:F2:DD:32:B3:48:0C:26:E3:FB:F0:
</I>&gt;<i>
</I>&gt;<i> DD:4E:5E:10:95:1E:B4:59:5B:67:64:C4:F2:40:7C:A8:
</I>&gt;<i>
</I>&gt;<i> 62:35:71:FE:02:20:13:15:41:26:E5:9C:DB:34:DA:D7:
</I>&gt;<i>
</I>&gt;<i> B9:CB:B3:1A:4E:33:C7:46:7F:D9:93:45:25:7F:DE:A3:
</I>&gt;<i>                                 72:EB:07:03:DB:C5
</I>&gt;<i>                 Signed Certificate Timestamp:
</I>&gt;<i>                     Version   : v1 (0x0)
</I>&gt;<i>                     Log ID    :
</I>&gt;<i> EE:CD:D0:64:D5:DB:1A:CE:C5:5C:B7:9D:B4:CD:13:A2:
</I>&gt;<i>
</I>&gt;<i> 32:87:46:7C:BC:EC:DE:C3:51:48:59:46:71:1F:B5:9B
</I>&gt;<i>                     Timestamp : Dec 14 15:34:39.124 2022 GMT
</I>&gt;<i>                     Extensions: none
</I>&gt;<i>                     Signature : ecdsa-with-SHA256
</I>&gt;<i>
</I>&gt;<i> 30:45:02:20:2C:E2:85:9C:A6:54:1B:1C:31:E5:F8:37:
</I>&gt;<i>
</I>&gt;<i> E9:CD:09:8B:D8:26:29:E4:C7:65:94:9C:FF:32:D2:41:
</I>&gt;<i>
</I>&gt;<i> CD:16:A3:51:02:21:00:A0:2F:C3:F7:A6:55:3B:21:EB:
</I>&gt;<i>
</I>&gt;<i> 9B:CA:6E:4E:07:A2:8C:40:4B:E2:27:D6:82:44:0F:09:
</I>&gt;<i>                                 C9:F7:7D:1B:72:6F:13
</I>&gt;<i>     Signature Algorithm: sha256WithRSAEncryption
</I>&gt;<i>          25:bd:bb:de:57:c0:7f:07:5e:18:62:2e:0b:d3:03:54:a7:45:
</I>&gt;<i>          ab:c6:1f:e2:f6:58:ff:6e:8e:6b:4f:09:9a:87:66:32:81:7f:
</I>&gt;<i>          f4:35:4f:7e:65:e5:6a:04:d6:62:62:ff:d9:3a:f2:6f:19:ba:
</I>&gt;<i>          fa:e6:35:0e:2a:44:5c:3b:ee:9d:97:72:05:86:0c:4c:01:c1:
</I>&gt;<i>          f0:8c:21:c1:c4:84:54:d8:a8:05:25:18:72:db:f7:53:9b:f1:
</I>&gt;<i>          13:d6:0b:bc:92:6e:01:e3:fd:de:a1:45:e9:29:37:e1:2e:64:
</I>&gt;<i>          36:b4:4d:38:c1:60:02:6a:17:3d:87:a2:5f:33:3b:86:eb:0d:
</I>&gt;<i>          cc:dd:fa:d4:43:58:50:43:e7:b7:ec:0a:4f:86:72:15:e5:30:
</I>&gt;<i>          c9:bb:5f:0b:83:9c:26:6f:60:49:dd:1a:7c:92:45:45:4e:b5:
</I>&gt;<i>          ce:cd:64:8c:12:83:e9:3d:5c:6b:65:97:75:99:4c:66:eb:d0:
</I>&gt;<i>          3a:ca:18:62:8a:08:07:16:ab:09:66:bd:65:43:94:00:d9:79:
</I>&gt;<i>          3e:84:b4:60:7d:7e:f9:09:3c:fe:2d:ad:98:94:17:0c:24:8f:
</I>&gt;<i>          e1:a2:74:b6:3b:68:c0:01:f9:67:e8:b9:d2:6a:65:9e:99:a3:
</I>&gt;<i>          4a:5f:39:31:ae:c1:59:02:7b:ef:db:b2:94:06:f8:1a:74:c1:
</I>&gt;<i>          d7:5b:5b:6a
</I>&gt;<i>
</I>&gt;<i> So the DNS names it will check are:
</I>&gt;<i>         Subject: CN = activate.redshift3d.com
</I>&gt;<i>                 DNS:activate.redshift3d.com, DNS:
</I>&gt;<i> www.activate.redshift3d.com
</I>&gt;<i>
</I>&gt;<i> So to summarize the checks of ssl::server_name/ will be done on:
</I>&gt;<i> * activate.redshift3d.com
</I>&gt;<i> * activate.redshift3d.com
</I>&gt;<i> * www.activate.redshift3d.com
</I>&gt;<i>
</I>&gt;<i> So . redshift3d.com ssl::server_name should match the certificate.
</I>&gt;<i> If for any reason it doesn't work you can try ssl::server_name_regex with
</I>&gt;<i> something like:
</I>&gt;<i> (^|\.)activate\.redshift3d\.com$
</I>&gt;<i>
</I>&gt;<i> Or just to verify if there is a bug in squid code try:
</I>&gt;<i> (^|\.)activate\.redshift3d\.com
</I>&gt;<i>
</I>&gt;<i> Now, the splice should be able to take into account also dstdomain and
</I>&gt;<i> dstdom_regex but it should match them only if they exist in a plain text
</I>&gt;<i> form like in any simple forward proxy CONNECT request.
</I>&gt;<i> If for any reason it doesn&#8217;t work we should investigate what might cause
</I>&gt;<i> this issue.
</I>&gt;<i>
</I>&gt;<i> I hope the scroll I wrote make sense to you and with hopes it will clear
</I>&gt;<i> out the doubts about the wiki article you mentioned.
</I>&gt;<i> I believe this is considered a summary of the subject and if Alex and
</I>&gt;<i> others might think so it can be converted into an example article in the
</I>&gt;<i> wiki.
</I>&gt;<i>
</I>&gt;<i> Let me know if this makes sense and resolve the issue.
</I>&gt;<i>
</I>&gt;<i> Yours,
</I>&gt;<i> Eliezer
</I>&gt;<i>
</I>&gt;<i> From: robert k Wild &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">robertkwild at gmail.com</A>&gt;
</I>&gt;<i> Sent: Thursday, June 29, 2023 12:18
</I>&gt;<i> To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A>
</I>&gt;<i> Cc: Squid Users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i> Subject: Re: [squid-users] make URL bypass squid proxy
</I>&gt;<i>
</I>&gt;<i> very clever, so you bunch all the acls up
</I>&gt;<i>
</I>&gt;<i> acl NoSSLInterceptAnyOf any-of NoSSLInterceptDstDom
</I>&gt;<i> NoSSLInterceptDstDomFile NoSSLInterceptRegEx NoSSLInterceptRegExFile
</I>&gt;<i>
</I>&gt;<i> the key word is &quot;any-of&quot; ie if the url hits any one do that first
</I>&gt;<i>
</I>&gt;<i> what about instead of making it
</I>&gt;<i>
</I>&gt;<i> ssl::server_name_regex
</I>&gt;<i>
</I>&gt;<i> i make it
</I>&gt;<i>
</I>&gt;<i> dstdom_regex
</I>&gt;<i>
</I>&gt;<i> On Thu, 29 Jun 2023 at 01:38, &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A>&gt; wrote:
</I>&gt;<i> Hey Rob,
</I>&gt;<i>
</I>&gt;<i> The first thing is to allow the domain in the http_acces just to be sure
</I>&gt;<i> and use a basic deny all bottom line.
</I>&gt;<i> Let me try to simplify your squid.conf
</I>&gt;<i> In a link:
</I>&gt;<i> <A HREF="https://gist.github.com/elico/b49f4a28d4b5db5ba882b10d40872d5e">https://gist.github.com/elico/b49f4a28d4b5db5ba882b10d40872d5e</A>
</I>&gt;<i>
</I>&gt;<i> In plain text:
</I>&gt;<i> ## START OF FILE
</I>&gt;<i> # SSL Interception  basic rules
</I>&gt;<i> acl DiscoverSNIHost at_step SslBump1
</I>&gt;<i>
</I>&gt;<i> acl NoSSLInterceptRegEx ssl::server_name_regex (^|.*\.)redshift3d\.com$
</I>&gt;<i> acl NoSSLInterceptRegExFile ssl::server_name_regex
</I>&gt;<i> &quot;/usr/local/squid/etc/no-intercept-ssl-regex.txt&quot;
</I>&gt;<i>
</I>&gt;<i> acl NoSSLInterceptDstDom ssl::server_name .redshift3d.com
</I>&gt;<i> acl NoSSLInterceptDstDomFile ssl::server_name
</I>&gt;<i> &quot;/usr/local/squid/etc/no-intercept-ssl-dstdom.txt&quot;
</I>&gt;<i>
</I>&gt;<i> ## Any of will test what ever rule match first in a first match/hit fasion
</I>&gt;<i> acl NoSSLInterceptAnyOf any-of NoSSLInterceptDstDom
</I>&gt;<i> NoSSLInterceptDstDomFile NoSSLInterceptRegEx NoSSLInterceptRegExFile
</I>&gt;<i>
</I>&gt;<i> ssl_bump peek DiscoverSNIHost
</I>&gt;<i> ssl_bump splice NoSSLInterceptAnyOf
</I>&gt;<i> ssl_bump bump all
</I>&gt;<i>
</I>&gt;<i> #SSL Bump port
</I>&gt;<i> http_port 3128 ssl-bump cert=/usr/local/squid/etc/ssl_cert/myCA.pem
</I>&gt;<i> generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
</I>&gt;<i> sslcrtd_program /usr/local/squid/libexec/security_file_certgen -s
</I>&gt;<i> /var/lib/ssl_db -M 4MB
</I>&gt;<i>
</I>&gt;<i> ## http_access acls, will apply on incomming requests and not on responses
</I>&gt;<i> acl special_url_regex url_regex https?://(^|.*\.)redshift3d\.com\/
</I>&gt;<i> acl special_url_regex_file url_regex
</I>&gt;<i> &quot;/usr/local/squid/etc/special_url_regex.txt&quot;
</I>&gt;<i>
</I>&gt;<i> acl special_url_dst_dom dstdomain .redshift3d.com
</I>&gt;<i> acl special_url_dst_dom_file dstdomain
</I>&gt;<i> &quot;/usr/local/squid/etc/special_url_dstdom.txt&quot;
</I>&gt;<i>
</I>&gt;<i> acl special_url_any_of any-of special_url_dst_dom special_url_dst_dom_file
</I>&gt;<i> special_url_regex special_url_regex_file
</I>&gt;<i>
</I>&gt;<i> acl localnet src <A HREF="http://192.168.0.0/16">http://192.168.0.0/16</A>
</I>&gt;<i> acl localnet src <A HREF="http://10.0.0.0/8">http://10.0.0.0/8</A>
</I>&gt;<i>
</I>&gt;<i> http_access allow localnet special_url_any_of
</I>&gt;<i> http_access deny all
</I>&gt;<i> ## END OF FILE
</I>&gt;<i>
</I>&gt;<i>  Once the above will work try to add other http_access rule like reply
</I>&gt;<i> access rules
</I>&gt;<i>
</I>&gt;<i> Let me know what happens,
</I>&gt;<i> Eliezer
</I>&gt;<i>
</I>&gt;<i> From: robert k Wild &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">robertkwild at gmail.com</A>&gt;
</I>&gt;<i> Sent: Tuesday, June 27, 2023 09:36
</I>&gt;<i> To: mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A>
</I>&gt;<i> Cc: Squid Users &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i> Subject: Re: [squid-users] make URL bypass squid proxy
</I>&gt;<i>
</I>&gt;<i> Hi Eliezer,
</I>&gt;<i>
</I>&gt;<i> this is a snippet of my whitelist and no intercept SSL config
</I>&gt;<i>
</I>&gt;<i> #SSL Interception
</I>&gt;<i> acl DiscoverSNIHost at_step SslBump1
</I>&gt;<i> acl NoSSLIntercept ssl::server_name_regex
</I>&gt;<i> &quot;/usr/local/squid/etc/interceptssl.txt&quot;
</I>&gt;<i> ssl_bump peek DiscoverSNIHost
</I>&gt;<i> ssl_bump splice NoSSLIntercept
</I>&gt;<i> ssl_bump bump all
</I>&gt;<i> #
</I>&gt;<i> #SSL Bump
</I>&gt;<i> http_port 3128 ssl-bump cert=/usr/local/squid/etc/ssl_cert/myCA.pem
</I>&gt;<i> generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
</I>&gt;<i> sslcrtd_program /usr/local/squid/libexec/security_file_certgen -s
</I>&gt;<i> /var/lib/ssl_db -M 4MB
</I>&gt;<i> #
</I>&gt;<i> #deny up MIME types
</I>&gt;<i> acl upmime req_mime_type &quot;/usr/local/squid/etc/mimedeny.txt&quot;
</I>&gt;<i> #
</I>&gt;<i> #deny URL links
</I>&gt;<i> acl url_links url_regex &quot;/usr/local/squid/etc/linksurl.txt&quot;
</I>&gt;<i> #
</I>&gt;<i> #allow special URL paths
</I>&gt;<i> acl special_url url_regex &quot;/usr/local/squid/etc/urlspecial.txt&quot;
</I>&gt;<i> #
</I>&gt;<i> #deny down MIME types
</I>&gt;<i> acl downmime rep_mime_type &quot;/usr/local/squid/etc/mimedeny.txt&quot;
</I>&gt;<i> #
</I>&gt;<i> http_reply_access allow special_url
</I>&gt;<i> http_reply_access deny downmime
</I>&gt;<i> #http_access deny upmime
</I>&gt;<i> #http_access deny url_links
</I>&gt;<i> #
</I>&gt;<i> #HTTP_HTTPS whitelist websites
</I>&gt;<i> acl whitelist ssl::server_name_regex &quot;/usr/local/squid/etc/urlwhite.txt&quot;
</I>&gt;<i> #
</I>&gt;<i> http_access allow activation whitelist
</I>&gt;<i> http_access deny all
</I>&gt;<i>
</I>&gt;<i> so basically no SSL interception
</I>&gt;<i>
</I>&gt;<i> #SSL Interception
</I>&gt;<i> acl DiscoverSNIHost at_step SslBump1
</I>&gt;<i> acl NoSSLIntercept ssl::server_name_regex
</I>&gt;<i> &quot;/usr/local/squid/etc/interceptssl.txt&quot;
</I>&gt;<i> ssl_bump peek DiscoverSNIHost
</I>&gt;<i> ssl_bump splice NoSSLIntercept
</I>&gt;<i> ssl_bump bump all
</I>&gt;<i>
</I>&gt;<i> and whitelisting
</I>&gt;<i>
</I>&gt;<i> #HTTP_HTTPS whitelist websites
</I>&gt;<i> acl whitelist ssl::server_name_regex &quot;/usr/local/squid/etc/urlwhite.txt&quot;
</I>&gt;<i>
</I>&gt;<i> in both txt files ie
</I>&gt;<i>
</I>&gt;<i> /usr/local/squid/etc/interceptssl.txt
</I>&gt;<i> /usr/local/squid/etc/urlwhite.txt
</I>&gt;<i>
</I>&gt;<i> i have a URL that first i have to whitelist and then if i want squid not
</I>&gt;<i> to inspect the url traffic i put it in the SSL interception (i do this as
</I>&gt;<i> some websites dont like MITM )
</I>&gt;<i>
</I>&gt;<i> but even putting the URL in question in both files im still having issues
</I>&gt;<i> with this website ie its still being detected that its passing through a
</I>&gt;<i> proxy
</I>&gt;<i>
</I>&gt;<i> thanks,
</I>&gt;<i> rob
</I>&gt;<i>
</I>&gt;<i> On Mon, 26 Jun 2023 at 23:35, &lt;mailto:mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A>&gt; wrote:
</I>&gt;<i> Hey Robert,
</I>&gt;<i>
</I>&gt;<i> I am not sure what forward proxy setup you have there.
</I>&gt;<i> A simple forward proxy?
</I>&gt;<i> What tool are you using for whitelisting?
</I>&gt;<i> You can use an external acl helper to allow dynamic updates of the
</I>&gt;<i> whitelists or
</I>&gt;<i> to periodic update your lists and reload.
</I>&gt;<i> It will depend on the size of your lists.
</I>&gt;<i> What OS are you using for your squid proxy?
</I>&gt;<i>
</I>&gt;<i> More details will help us help you.
</I>&gt;<i>
</I>&gt;<i> Eliezer
</I>&gt;<i>
</I>&gt;<i> From: squid-users &lt;mailto:mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt;
</I>&gt;<i> On Behalf Of robert k Wild
</I>&gt;<i> Sent: Monday, June 26, 2023 22:25
</I>&gt;<i> To: Squid Users &lt;mailto:mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i> Subject: [squid-users] make URL bypass squid proxy
</I>&gt;<i>
</I>&gt;<i> hi all,
</I>&gt;<i>
</I>&gt;<i> i have set up squid for url whitelisting and no intercept SSL (see below)
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://wiki.squid-cache.org/ConfigExamples/Caching/AdobeProducts">https://wiki.squid-cache.org/ConfigExamples/Caching/AdobeProducts</A>
</I>&gt;<i>
</I>&gt;<i> but some websites i want the client to bypass the squid proxy and go
</I>&gt;<i> straight to the website as i think this is why a url isnt working even when
</I>&gt;<i> i add the url to both files ie urlwhite and no intercept SSL
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> thanks,
</I>&gt;<i> rob
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Regards,
</I>&gt;<i>
</I>&gt;<i> Robert K Wild.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Regards,
</I>&gt;<i>
</I>&gt;<i> Robert K Wild.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Regards,
</I>&gt;<i>
</I>&gt;<i> Robert K Wild.
</I>&gt;<i>
</I>&gt;<i>
</I>
-- 
Regards,

Robert K Wild.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20230706/95040306/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20230706/95040306/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025924.html">[squid-users] trickeling support in squid as icap client
</A></li>
	<LI>Next message (by thread): <A HREF="025928.html">[squid-users] Squid config Teams add-on in Outlook
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25927">[ date ]</a>
              <a href="thread.html#25927">[ thread ]</a>
              <a href="subject.html#25927">[ subject ]</a>
              <a href="author.html#25927">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
