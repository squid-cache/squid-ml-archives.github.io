<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] instances/queues when same script for multiple external_acl_type rules
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20instances/queues%20when%20same%20script%20for%20multiple%0A%20external_acl_type%20rules&In-Reply-To=%3C809c1d2f-bfe6-9aa0-2e89-4ea6ef6af063%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025950.html">
   <LINK REL="Next"  HREF="025954.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] instances/queues when same script for multiple external_acl_type rules</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20instances/queues%20when%20same%20script%20for%20multiple%0A%20external_acl_type%20rules&In-Reply-To=%3C809c1d2f-bfe6-9aa0-2e89-4ea6ef6af063%40measurement-factory.com%3E"
       TITLE="[squid-users] instances/queues when same script for multiple external_acl_type rules">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Jul 11 15:20:26 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025950.html">[squid-users] instances/queues when same script for multiple external_acl_type rules
</A></li>
        <LI>Next message (by thread): <A HREF="025954.html">[squid-users] Help with squid Proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25951">[ date ]</a>
              <a href="thread.html#25951">[ thread ]</a>
              <a href="subject.html#25951">[ subject ]</a>
              <a href="author.html#25951">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 7/11/23 11:00, Kevin Kretz wrote:

&gt;<i> I have a script that queries a database when a request is made to
</I>&gt;<i> squid.  It handles two different types of request:  those made from
</I>&gt;<i> authenticated users, and unauthenticated requests which can be
</I>&gt;<i> allowed based on the requesting host.
</I>
&gt;<i> Requests of each type are defined with a different external_acl_type
</I>&gt;<i> definition in squid.conf and different arguments are sent to the
</I>&gt;<i> script depending which type it is.
</I>
&gt;<i> Recently we hit the limits of the default children_max and its
</I>&gt;<i> associated queue length.  It was addressed by increasing children_max
</I>&gt;<i> - but it made me wonder:  if I have two external_acl_type rules
</I>&gt;<i> calling the same external script, does squid maintain separate counts
</I>&gt;<i> for the script instances associated for each external_acl_type
</I>&gt;<i> definition?  Does
</I>

&gt;<i> external_acl_type children-max 10 host_based blah blah blah script.py
</I>&gt;<i> external_acl_type children-max 10 user_based blah blah blah script.py
</I>
&gt;<i> ... have a max of 10 instances for each acl_type?  Or 10 instances total?
</I>
The above external_acl_type configuration lines appear to contain 
out-of-order tokens and other syntax violations, but children-max limit 
(and all other external_acl_type parameters) are dedicated to the 
corresponding external_acl_type. Squid may start 10 helper instances for 
each external_acl_type (with a unique external_acl_type name), even if 
all of them have the same script name.

BTW, AFAICT by glancing through Squid source code and without testing, 
Squid does not reject configurations with multiple external_acl_type 
lines that use the same external_acl_type name parameter value (a Squid 
bug). Squid will effectively ignore all but the very first such line.


HTH,

Alex.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025950.html">[squid-users] instances/queues when same script for multiple external_acl_type rules
</A></li>
	<LI>Next message (by thread): <A HREF="025954.html">[squid-users] Help with squid Proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25951">[ date ]</a>
              <a href="thread.html#25951">[ thread ]</a>
              <a href="subject.html#25951">[ subject ]</a>
              <a href="author.html#25951">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
