<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Proxy server to support a large number of simultaneous requests
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Proxy%20server%20to%20support%20a%20large%20number%20of%0A%20simultaneous%20requests&In-Reply-To=%3C55a12ae0-9a7b-28e5-a8d1-03a0c2752cbe%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025856.html">
   <LINK REL="Next"  HREF="025862.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Proxy server to support a large number of simultaneous requests</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Proxy%20server%20to%20support%20a%20large%20number%20of%0A%20simultaneous%20requests&In-Reply-To=%3C55a12ae0-9a7b-28e5-a8d1-03a0c2752cbe%40measurement-factory.com%3E"
       TITLE="[squid-users] Proxy server to support a large number of simultaneous requests">rousskov at measurement-factory.com
       </A><BR>
    <I>Mon Jun  5 14:31:44 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025856.html">[squid-users] Proxy server to support a large number of simultaneous requests
</A></li>
        <LI>Next message (by thread): <A HREF="025862.html">[squid-users] Proxy server to support a large number of simultaneous requests
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25861">[ date ]</a>
              <a href="thread.html#25861">[ thread ]</a>
              <a href="subject.html#25861">[ subject ]</a>
              <a href="author.html#25861">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 6/2/23 03:29, Andrey K wrote:

&gt;<i>  &gt; Can you repeat this test and share a pointer to the corresponding
</I>&gt;<i>  &gt; compressed cache.log, containing those 500 (or fewer, as long as the
</I>&gt;<i>  &gt; problem is reproduced!) concurrent transactions. One or many of those
</I>&gt;<i>  &gt; concurrent transactions resulted in the unwanted entry deletion. The log
</I>&gt;<i>  &gt; may show what happened in that case.
</I>
&gt;<i> I cleared the rock cache, set the debug level, restarted squid, cleared 
</I>&gt;<i> the cache.log, ran 500-threads test, waited for it to finish and 
</I>&gt;<i> launched curl to make sure it returned TCP_MISS.
</I>&gt;<i> Then stopped squid to limit the cache.log file.
</I>

Thank you for sharing that log! I only had time to study a few misses. 
They all stemmed from the same sequence of events:

1. A collapsed request finds the corresponding entry in the cache.
2. Squid decides that this request should open the disk file.
3. The rock disk entry is still being written (i.e. &quot;swapped out&quot;),
    so the attempt to swap it in fails (TCP_SWAPFAIL_MISS).
4. The request goes to the origin server.
5. The fresh response deletes the existing cached entry.
6. When a subsequent request finds the cached entry marked for
    deletion, it declares a cache miss (TCP_MISS) and goes to step 4.

Disclaimer: The above sequence of events causes misses, but it may not 
be the only or even the primary cause. I do not have enough free time to 
rule out or confirm other causes (and order them by severity).


Squid can (and should) handle concurrent swapout/swapins better, and we 
may be able to estimate that improvement potential for your workload 
without significant development, but, for the next step, I suggest 
disabling cache_dir and testing whether your get substantially better 
results with memory cache alone. Shared memory cache also has periods 
where a being-written entry cannot be read, but, compared to the disk 
cache, those periods are much shorter IIRC. I would like to confirm that 
this simplified mode of operation works well for your workload before I 
suggest code changes that would rely, in part, on this mode.


Thank you,

Alex.


&gt;<i> &#1095;&#1090;, 1 &#1080;&#1102;&#1085;. 2023&#8239;&#1075;. &#1074; 19:15, Alex Rousskov:
</I>&gt;<i> 
</I>&gt;<i>     On 6/1/23 05:20, Andrey K wrote:
</I>&gt;<i> 
</I>&gt;<i>      &gt;&#160; &gt; The next step I would recommend is to study the very first
</I>&gt;<i>     cache miss
</I>&gt;<i>      &gt;&#160; &gt; _after_ the 500 or 200 concurrent threads test. Doing so may
</I>&gt;<i>     shed light
</I>&gt;<i>      &gt;&#160; &gt; on why Squid is refusing to serve that (presumably cached)
</I>&gt;<i>     object from
</I>&gt;<i>      &gt;&#160; &gt; the cache. I suspect that the object was marked for deletion
</I>&gt;<i>     earlier
</I>&gt;<i> 
</I>&gt;<i>      &gt; openForReadingAt: cannot open marked entry 11138 for reading
</I>&gt;<i>     cache_mem_map
</I>&gt;<i>      &gt; openForReadingAt: cannot open marked entry 719406 for reading
</I>&gt;<i>     /data/squid.user/cache_map
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     The debugging log you have shared confirms that Squid deleted[1] the
</I>&gt;<i>     previously cached entry, from both caches (memory and disk). Now comes
</I>&gt;<i>     the hard part -- figuring out why Squid deleted that entry.
</I>&gt;<i> 
</I>&gt;<i>      &gt; I cleared the rock cache, changed the squid.conf (added debug_options
</I>&gt;<i>      &gt; ALL,9), restarted the squid, ran a test with 500 concurrent threads
</I>&gt;<i> 
</I>&gt;<i>     Can you repeat this test and share a pointer to the corresponding
</I>&gt;<i>     compressed cache.log, containing those 500 (or fewer, as long as the
</I>&gt;<i>     problem is reproduced!) concurrent transactions. One or many of those
</I>&gt;<i>     concurrent transactions resulted in the unwanted entry deletion. The
</I>&gt;<i>     log
</I>&gt;<i>     may show what happened in that case.
</I>&gt;<i> 
</I>&gt;<i>     FWIW, I do not recommend spending your time analyzing that huge log.
</I>&gt;<i>     Efficient analysis requires specialized knowledge in this case. I will
</I>&gt;<i>     share the results here, of course.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     Thank you,
</I>&gt;<i> 
</I>&gt;<i>     Alex.
</I>&gt;<i> 
</I>&gt;<i>     [1] That entry deletion does not imply that all (or any) of the cached
</I>&gt;<i>     entry bytes are gone from the cache file on disk. It is likely that
</I>&gt;<i>     only
</I>&gt;<i>     the shared memory _index_ for that disk file was adjusted in your micro
</I>&gt;<i>     test. That index adjustment is enough for Squid to declare a cache miss.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>      &gt; &#1089;&#1088;, 31 &#1084;&#1072;&#1103; 2023&#8239;&#1075;. &#1074; 16:43, Alex Rousskov:
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160;On 5/31/23 02:56, Andrey K wrote:
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &gt; Do you get close to 100% hit ratio if clients access
</I>&gt;<i>     these URLs
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &gt; sequentially rather than concurrently? If not, then
</I>&gt;<i>     focus on that
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &gt; problem before you open the collapsed forwarding
</I>&gt;<i>     Pandora box.
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; When I run curl sequentially&#160;like this:
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; for i in `seq 500`; do curl --tlsv1.2 -k &#160; --proxy
</I>&gt;<i>     0001vsg01:3131
</I>&gt;<i>      &gt;&#160; &#160; &#160; &#160;-v
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; $URL&#160;&#160;&gt;/dev/null 2&gt;&amp;1; done
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; I get only the first request with a status TCP_MISS&#160;and all
</I>&gt;<i>      &gt;&#160; &#160; &#160;others with
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; TCP_MEM_HIT:
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; Cnt Status&#160; &#160; &#160; &#160; &#160; &#160; Parent
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; 499 TCP_MEM_HIT/200/- HIER_NONE/-
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160; 1 TCP_MISS/200/200 FIRSTUP_PARENT/parent_proxy
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160;Excellent. This confirms that your Squid can successfully
</I>&gt;<i>     cache this
</I>&gt;<i>      &gt;&#160; &#160; &#160;object (in memory).
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; It is interesting to note that on both squid versions if I
</I>&gt;<i>     run a
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; separate curl after processing 500 or 200 concurrent
</I>&gt;<i>     threads, I
</I>&gt;<i>      &gt;&#160; &#160; &#160;get a
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; result with the status TCP_MISS/200
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160;The next step I would recommend is to study the very first
</I>&gt;<i>     cache miss
</I>&gt;<i>      &gt;&#160; &#160; &#160;_after_ the 500 or 200 concurrent threads test. Doing so may
</I>&gt;<i>     shed light
</I>&gt;<i>      &gt;&#160; &#160; &#160;on why Squid is refusing to serve that (presumably cached)
</I>&gt;<i>     object from
</I>&gt;<i>      &gt;&#160; &#160; &#160;the cache. I suspect that the object was marked for deletion
</I>&gt;<i>     earlier,
</I>&gt;<i>      &gt;&#160; &#160; &#160;but we should check before spending more time on more complex
</I>&gt;<i>     triage of
</I>&gt;<i>      &gt;&#160; &#160; &#160;concurrent cases. If you can share a (link to) compressed ALL,9
</I>&gt;<i>      &gt;&#160; &#160; &#160;cache.log from that single transaction against Squid v6, I
</I>&gt;<i>     may be able
</I>&gt;<i>      &gt;&#160; &#160; &#160;to help you with that step.
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160;Cheers,
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160;Alex.
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &gt; What is your Squid version? Older Squids have more
</I>&gt;<i>     collapsed
</I>&gt;<i>      &gt;&#160; &#160; &#160;forwarding
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &gt; bugs than newer ones. I recommend testing with Squid v6 or
</I>&gt;<i>      &gt;&#160; &#160; &#160;master/v7, at
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &gt; least to confirm that the problem is still present in
</I>&gt;<i>     the latest
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &gt; official code.
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; I run tests on SQUID 5.9.
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; We compiled&#160;6.0.2 (with disabled delay-pools) and
</I>&gt;<i>     increased memory
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; parameters:
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; cache_mem 2048 MB
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; maximum_object_size_in_memory 10 MB
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; The complete configuration is shown below.
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; Now on the version 6.0.2 we have the next results:
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; 500 threads -&#160; Hit ratio 3.8%:
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160; 3 TCP_CF_HIT/200/- HIER_NONE/-
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160; 2 TCP_CF_MISS/200/200 FIRSTUP_PARENT/parent_proxy
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160;16 TCP_HIT/200/- HIER_NONE/-
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; 467 TCP_MISS/200/200 FIRSTUP_PARENT/parent_proxy
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160;12 TCP_SWAPFAIL_MISS/200/200 FIRSTUP_PARENT/parent_proxy
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; 200 threads - 6%
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160; 6 TCP_CF_HIT/200/- HIER_NONE/-
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160;10 TCP_HIT/200/- HIER_NONE/-
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; 176 TCP_MISS/200/200 FIRSTUP_PARENT/parent_proxy
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160; 8 TCP_SWAPFAIL_MISS/200/200 FIRSTUP_PARENT/parent_proxy
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; 50 threads - 82%
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160;30 TCP_CF_HIT/200/- HIER_NONE/-
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160;11 TCP_HIT/200/- HIER_NONE/-
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160; 1 TCP_MISS/200/200 FIRSTUP_PARENT/parent_proxy
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160; 8 TCP_SWAPFAIL_MISS/200/200 FIRSTUP_PARENT/parent_proxy
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; The results are slightly worse than they were on the
</I>&gt;<i>     version 5.9.
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; It is interesting to note that on both squid versions if I
</I>&gt;<i>     run a
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; separate curl after processing 500 or 200 concurrent
</I>&gt;<i>     threads, I
</I>&gt;<i>      &gt;&#160; &#160; &#160;get a
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; result with the status TCP_MISS/200, although the
</I>&gt;<i>     requested URL is
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; already in the rock cache (I can see it in the contents of
</I>&gt;<i>     the cache
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; using the utility I developed rock_cache_dump.pl
</I>&gt;<i>     &lt;<A HREF="http://rock_cache_dump.pl">http://rock_cache_dump.pl</A>&gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160;&lt;<A HREF="http://rock_cache_dump.pl">http://rock_cache_dump.pl</A> &lt;<A HREF="http://rock_cache_dump.pl">http://rock_cache_dump.pl</A>&gt;&gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; &lt;<A HREF="http://rock_cache_dump.pl">http://rock_cache_dump.pl</A> &lt;<A HREF="http://rock_cache_dump.pl">http://rock_cache_dump.pl</A>&gt;
</I>&gt;<i>     &lt;<A HREF="http://rock_cache_dump.pl">http://rock_cache_dump.pl</A> &lt;<A HREF="http://rock_cache_dump.pl">http://rock_cache_dump.pl</A>&gt;&gt;&gt;:
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; $VAR1 = {
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160; &#160; &#160; '1' =&gt; {
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'VERSION' =&gt; 'Wed May 31 09:18:05 2023',
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'KEY_MD5' =&gt;
</I>&gt;<i>     'e5eb10f0ab7d84ff9d3fd1e5a6d3eb9c',
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'OBJSIZE' =&gt; 446985,
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'STD_LFS' =&gt; {
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; 'lastref' =&gt; 'Wed May 31
</I>&gt;<i>      &gt;&#160; &#160; &#160;09:18:05 2023',
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; 'flags' =&gt; '0x4004',
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; 'expires' =&gt; 'Wed May 31
</I>&gt;<i>      &gt;&#160; &#160; &#160;15:18:05 2023',
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; 'swap_file_sz' =&gt; 0,
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; 'refcount' =&gt; 1,
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; 'lastmod' =&gt; 'Wed Jun 29
</I>&gt;<i>      &gt;&#160; &#160; &#160;16:09:14 2016',
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; 'timestamp' =&gt; 'Wed May 31
</I>&gt;<i>      &gt;&#160; &#160; &#160;09:18:05 2023'
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; },
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'URL' =&gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;   
</I>&gt;<i>      &#160;'<A HREF="https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf">https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf</A> &lt;<A HREF="https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf">https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf</A>&gt; &lt;<A HREF="https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf">https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf</A> &lt;<A HREF="https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf">https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf</A>&gt;&gt; &lt;<A HREF="https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf">https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf</A> &lt;<A HREF="https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf">https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf</A>&gt; &lt;<A HREF="https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf">https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf</A> &lt;<A HREF="https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf">https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf</A>&gt;&gt;&gt;'
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;}
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160; &#160; };
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; ).
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &gt; How much RAM does your server have? You are using default
</I>&gt;<i>      &gt;&#160; &#160; &#160;256MB memory
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &gt; cache (cache_mem). If you have spare memory, make your
</I>&gt;<i>     memory
</I>&gt;<i>      &gt;&#160; &#160; &#160;cache much
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &gt; larger: A rock cache_dir cannot (yet) share the response
</I>&gt;<i>      &gt;&#160; &#160; &#160;_while_ the
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &gt; response is being written to disk, so relying on
</I>&gt;<i>     cache_dir too
</I>&gt;<i>      &gt;&#160; &#160; &#160;much will
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &gt; decrease your hit ratio, especially in a collapsed
</I>&gt;<i>     forwarding
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; environment.
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; The VM has 32 GB RAM. I configured cache_mem 2048 MB on
</I>&gt;<i>     the 6.0.2
</I>&gt;<i>      &gt;&#160; &#160; &#160;version.
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &gt; Is your Squid built with --enable-delay-pools? If yes,
</I>&gt;<i>      &gt;&#160; &#160; &#160;TCP_MISS does not
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &gt; necessarily mean a cache miss (an old Squid bug), even
</I>&gt;<i>     if you
</I>&gt;<i>      &gt;&#160; &#160; &#160;do not use
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &gt; any delay pools.
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; Yes, delay pools on the version 5.9 were enabled though&#160;we
</I>&gt;<i>     don't use
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; them. I disabled this feature on the 6.0.2 version.
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &gt; Since you are trying to cache objects lager than 512KB, see
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &gt; maximum_object_size_in_memory.
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; I configured maximum_object_size_in_memory 10 MB&#160;on the 6.0.2
</I>&gt;<i>      &gt;&#160; &#160; &#160;version
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; (as videochunks are less than 7 MB).
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &gt; Consider making your test much longer (more sequential
</I>&gt;<i>      &gt;&#160; &#160; &#160;requests per
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &gt; client/curl worker), to see whether the cache becomes
</I>&gt;<i>     &quot;stable&quot;
</I>&gt;<i>      &gt;&#160; &#160; &#160;after one
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &gt; of the first transactions manages to fully cache the
</I>&gt;<i>     response.
</I>&gt;<i>      &gt;&#160; &#160; &#160;This may
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &gt; not help with older Squids, but might help with newer ones.
</I>&gt;<i>      &gt;&#160; &#160; &#160;However, you
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &gt; should not test using real origin servers (that you do not
</I>&gt;<i>      &gt;&#160; &#160; &#160;control)!
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; I don't have any of my own web servers for tests, so I
</I>&gt;<i>     choose some
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; resources on the public internet that have a robust
</I>&gt;<i>     infrastructure.
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; I will conduct the longer tests next week.
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; Kind regards,
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160; Ankor.
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; *squid.conf*
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; workers 21
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; sslcrtd_program
</I>&gt;<i>      &gt;&#160; &#160; &#160;/data/squid.user/usr/lib/squid/security_file_certgen -s
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; /data/squid.user/var/lib/squid/ssl_db -M 20MB
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; sslcrtd_children 21
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; logformat extended-squid %{%Y-%m-%d %H:%M:%S}tl| %6tr %&gt;a
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; %Ss/%03&gt;Hs/%&lt;Hs %&lt;st %rm %ru %un %Sh/%&lt;A %mt %ea
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; logfile_rotate 0
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; access_log daemon:/var/log/squid.user/access.log
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; logformat=extended-squid on-error=drop
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; cache_peer parent_proxy &#160;parent 3128 0
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; never_direct allow all
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; cachemgr_passwd pass config
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; acl PURGE method PURGE
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; http_access allow PURGE
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; http_access allow all
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; http_port 3131 ssl-bump generate-host-certificates=on
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; dynamic_cert_mem_cache_size=20MB
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; tls-cert=/etc/squid.user/sslbump/bump.crt
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; tls-key=/etc/squid.user/sslbump/bump.key
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; sslproxy_cert_error allow all
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; acl step1 at_step SslBump1
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; acl step2 at_step SslBump2
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; acl step3 at_step SslBump3
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; ssl_bump peek step1
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; ssl_bump bump step2
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; ssl_bump bump step3
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; cache_dir rock /data/squid.user/cache 20000 max-size=12000000
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; cache_swap_low 85
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; cache_swap_high 90
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; collapsed_forwarding on
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; cache_mem 2048 MB
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; maximum_object_size_in_memory 10 MB
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; pinger_enable off
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; max_filedesc 8192
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; shutdown_lifetime 5 seconds
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; netdb_filename none
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; log_icp_queries off
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; via off
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; forwarded_for delete
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; client_request_buffer_max_size 100 MB
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; coredump_dir /data/squid.user/var/cache/squid
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; &#1087;&#1085;, 29 &#1084;&#1072;&#1103; 2023&#8239;&#1075;. &#1074; 23:17, Alex Rousskov
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160;&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt;&gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160;&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt;&gt;&gt;&gt;:
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;On 5/29/23 10:43, Andrey K wrote:
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; We need to configure a dedicated proxy server to
</I>&gt;<i>     provide
</I>&gt;<i>      &gt;&#160; &#160; &#160;caching of
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; online video broadcasts in order to reduce the load
</I>&gt;<i>     on the
</I>&gt;<i>      &gt;&#160; &#160; &#160;uplink
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;proxy.
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; Hundreds of users will access the same video-chunks
</I>&gt;<i>      &gt;&#160; &#160; &#160;simultaneously.
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; I developed a simple configuration for the test
</I>&gt;<i>     purposes
</I>&gt;<i>      &gt;&#160; &#160; &#160;(it is
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;shown
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; below).
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; The *collapsed_forwarding*&#160;option is on.
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;Do you get close to 100% hit ratio if clients access
</I>&gt;<i>     these URLs
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;sequentially rather than concurrently? If not, then
</I>&gt;<i>     focus on that
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;problem before you open the collapsed forwarding
</I>&gt;<i>     Pandora box.
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;What is your Squid version? Older Squids have more
</I>&gt;<i>     collapsed
</I>&gt;<i>      &gt;&#160; &#160; &#160;forwarding
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;bugs than newer ones. I recommend testing with Squid v6 or
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;master/v7, at
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;least to confirm that the problem is still present in
</I>&gt;<i>     the latest
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;official code.
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;How much RAM does your server have? You are using default
</I>&gt;<i>      &gt;&#160; &#160; &#160;256MB memory
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;cache (cache_mem). If you have spare memory, make your
</I>&gt;<i>     memory
</I>&gt;<i>      &gt;&#160; &#160; &#160;cache
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;much
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;larger: A rock cache_dir cannot (yet) share the response
</I>&gt;<i>      &gt;&#160; &#160; &#160;_while_ the
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;response is being written to disk, so relying on cache_dir
</I>&gt;<i>      &gt;&#160; &#160; &#160;too much
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;will
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;decrease your hit ratio, especially in a collapsed
</I>&gt;<i>     forwarding
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;environment.
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;Is your Squid built with --enable-delay-pools? If yes,
</I>&gt;<i>      &gt;&#160; &#160; &#160;TCP_MISS does
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;not
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;necessarily mean a cache miss (an old Squid bug), even
</I>&gt;<i>     if you
</I>&gt;<i>      &gt;&#160; &#160; &#160;do not
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;use
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;any delay pools.
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;Since you are trying to cache objects lager than
</I>&gt;<i>     512KB, see
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;maximum_object_size_in_memory.
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;Consider making your test much longer (more sequential
</I>&gt;<i>      &gt;&#160; &#160; &#160;requests per
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;client/curl worker), to see whether the cache becomes
</I>&gt;<i>      &gt;&#160; &#160; &#160;&quot;stable&quot; after
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;one
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;of the first transactions manages to fully cache the
</I>&gt;<i>      &gt;&#160; &#160; &#160;response. This may
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;not help with older Squids, but might help with newer
</I>&gt;<i>     ones.
</I>&gt;<i>      &gt;&#160; &#160; &#160;However,
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;you
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;should not test using real origin servers (that you do not
</I>&gt;<i>      &gt;&#160; &#160; &#160;control)!
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; Could you clarify if this behavior of my squid is
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; a bug/misconfiguration, or if I'm running into server
</I>&gt;<i>      &gt;&#160; &#160; &#160;performance
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; limitations (squid is running on a VM with 22 cores)?
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;Most likely, reduction of hit ratio with increase of
</I>&gt;<i>      &gt;&#160; &#160; &#160;concurrency is
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;_not_ a performance limitation.
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;HTH,
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;Alex.
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; I selected a couple of cacheable resources in the
</I>&gt;<i>     internet for
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;testing:
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;&#160; &#160;- small size (~400 KB):
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;
</I>&gt;<i>     <A HREF="https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf">https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf</A> &lt;<A HREF="https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf">https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf</A>&gt; &lt;<A HREF="https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf">https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf</A> &lt;<A HREF="https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf">https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf</A>&gt;&gt; &lt;<A HREF="https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf">https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf</A> &lt;<A HREF="https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf">https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf</A>&gt; &lt;<A HREF="https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf">https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf</A> &lt;<A HREF="https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf">https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf</A>&gt;&gt;&gt; &lt;<A HREF="https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf">https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf</A> &lt;<A HREF="https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf">https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf</A>&gt; &lt;<A HREF="https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf">https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf</A> &lt;<A HREF="https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf">https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf</A>&gt;&gt; &lt;<A HREF="https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf">https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf</A> &lt;<A HREF="https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf">https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf</A>&gt; &lt;<A HREF="https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf">https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf</A> &lt;<A HREF="https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf">https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf</A>&gt;&gt;&gt;&gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;&#160; &#160;- large (~8 MB):
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;
</I>&gt;<i>     <A HREF="https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf">https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf</A> &lt;<A HREF="https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf">https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf</A>&gt; &lt;<A HREF="https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf">https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf</A> &lt;<A HREF="https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf">https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf</A>&gt;&gt; &lt;<A HREF="https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf">https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf</A> &lt;<A HREF="https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf">https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf</A>&gt; &lt;<A HREF="https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf">https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf</A> &lt;<A HREF="https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf">https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf</A>&gt;&gt;&gt; &lt;<A HREF="https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf">https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf</A> &lt;<A HREF="https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf">https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf</A>&gt; &lt;<A HREF="https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf">https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf</A> &lt;<A HREF="https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf">https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf</A>&gt;&gt; &lt;<A HREF="https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf">https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf</A> &lt;<A HREF="https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf">https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf</A>&gt; &lt;<A HREF="https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf">https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf</A> &lt;<A HREF="https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf">https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf</A>&gt;&gt;&gt;&gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; To test simultaneous connections I am forking curl
</I>&gt;<i>     using a
</I>&gt;<i>      &gt;&#160; &#160; &#160;simple
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;script
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; (it is also shown below).
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; When I run a test (500 curl threads to
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;
</I>&gt;<i>     <A HREF="https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf">https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf</A> &lt;<A HREF="https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf">https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf</A>&gt; &lt;<A HREF="https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf">https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf</A> &lt;<A HREF="https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf">https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf</A>&gt;&gt; &lt;<A HREF="https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf">https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf</A> &lt;<A HREF="https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf">https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf</A>&gt; &lt;<A HREF="https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf">https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf</A> &lt;<A HREF="https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf">https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf</A>&gt;&gt;&gt; &lt;<A HREF="https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf">https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf</A> &lt;<A HREF="https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf">https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf</A>&gt; &lt;<A HREF="https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf">https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf</A> &lt;<A HREF="https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf">https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf</A>&gt;&gt; &lt;<A HREF="https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf">https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf</A> &lt;<A HREF="https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf">https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf</A>&gt; &lt;<A HREF="https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf">https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf</A> &lt;<A HREF="https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf">https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf</A>&gt;&gt;&gt;&gt;) I see lots of&#160;TCP_MISS/200 with&#160;FIRSTUP_PARENT/parent_proxy records in the logs.
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; A simple analysis shows&#160;a low percentage of cache hits:
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; cat /var/log/squid.user/access.log| grep
</I>&gt;<i>     '2023-05-29 14' |
</I>&gt;<i>      &gt;&#160; &#160; &#160;grep
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;pdf &#160;|
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; awk '{print $5&quot; &quot; $10}' | sort | uniq -c
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160;24 TCP_CF_MISS/200/- HIER_NONE/-
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; 457 TCP_MISS/200/200 FIRSTUP_PARENT/parent_proxy
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160;10 TCP_MISS/200/- HIER_NONE/-
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160; 9 TCP_SWAPFAIL_MISS/200/200
</I>&gt;<i>     FIRSTUP_PARENT/parent_proxy
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; So the Hit ratio is about (500-457-9)*100/500=6.8%
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; Almost the same situation we see when run 200 threads:
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; cat /var/log/squid.user/access.log| grep
</I>&gt;<i>     '2023-05-29 15:45' |
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;grep pdf
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;&#160; &#160;| awk '{print $5&quot; &quot; $10}' | sort | uniq -c
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160; 4 TCP_CF_MISS/200/- HIER_NONE/-
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; 140 TCP_MISS/200/200 FIRSTUP_PARENT/parent_proxy
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160;40 TCP_MISS/200/- HIER_NONE/-
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160;16 TCP_SWAPFAIL_MISS/200/200
</I>&gt;<i>     FIRSTUP_PARENT/parent_proxy
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; This time the Hit ratio is about
</I>&gt;<i>     (200-140-16)*100/500=21%
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; With 50 threads the Hit ratio is 90%:
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; cat /var/log/squid.user/access.log| grep
</I>&gt;<i>     '2023-05-29 15:50' |
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;grep pdf
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;&#160; &#160;| awk '{print $5&quot; &quot; $10}' | sort | uniq -c
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160;27 TCP_CF_MISS/200/- HIER_NONE/-
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160; 1 TCP_MISS/200/200 FIRSTUP_PARENT/parent_proxy
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160;18 TCP_MISS/200/- HIER_NONE/-
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160; 4 TCP_SWAPFAIL_MISS/200/200
</I>&gt;<i>     FIRSTUP_PARENT/parent_proxy
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; I thought that it should always be near 99% - only
</I>&gt;<i>     the first
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;request to
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; an URL should be forwarded to the parent proxy and all
</I>&gt;<i>      &gt;&#160; &#160; &#160;subsequent
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; requests should be served from the cache.
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; The situation is even worse with downloading a
</I>&gt;<i>     large file:
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; 500 threads (0.4%):
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; cat /var/log/squid.user/access.log| grep
</I>&gt;<i>     '2023-05-29 17:2'
</I>&gt;<i>      &gt;&#160; &#160; &#160;| grep
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;pdf &#160;|
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; awk '{print $5&quot; &quot; $10}' | sort | uniq -c
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160;10 TCP_CF_MISS/200/200
</I>&gt;<i>     FIRSTUP_PARENT/parent_proxy
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160; 2 TCP_CF_MISS/200/- HIER_NONE/-
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; 488 TCP_MISS/200/200 FIRSTUP_PARENT/parent_proxy
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; 200 threads (3%):
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; cat /var/log/squid.user/access.log| grep
</I>&gt;<i>     '2023-05-29 17:3'
</I>&gt;<i>      &gt;&#160; &#160; &#160;| grep
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;pdf &#160;|
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; awk '{print $5&quot; &quot; $10}' | sort | uniq -c
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160; 9 TCP_CF_MISS/200/200
</I>&gt;<i>     FIRSTUP_PARENT/parent_proxy
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160; 6 TCP_CF_MISS/200/- HIER_NONE/-
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; 180 TCP_MISS/200/200 FIRSTUP_PARENT/parent_proxy
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160; 5 TCP_SWAPFAIL_MISS/200/200
</I>&gt;<i>     FIRSTUP_PARENT/parent_proxy
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; 50 threads (98%):
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; cat /var/log/squid.user/access.log| grep
</I>&gt;<i>     '2023-05-29 17:36' |
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;grep pdf
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;&#160; &#160;| awk '{print $5&quot; &quot; $10}' | sort | uniq -c
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160;25 TCP_CF_HIT/200/- HIER_NONE/-
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160;12 TCP_CF_MISS/200/- HIER_NONE/-
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160;12 TCP_HIT/200/- HIER_NONE/-
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160; 1 TCP_MISS/200/200 FIRSTUP_PARENT/parent_proxy
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; Could you clarify if this behavior of my squid is a
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; bug/misconfiguration, or if I'm running into server
</I>&gt;<i>      &gt;&#160; &#160; &#160;performance
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; limitations (squid is running on a VM with 22 cores)?
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; Kind regards,
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160;Ankor
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; *squid.conf:*
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; workers 21
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; sslcrtd_program
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;/data/squid.user/usr/lib/squid/security_file_certgen -s
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; /data/squid.user/var/lib/squid/ssl_db -M 20MB
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; sslcrtd_children 21
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; logformat extended-squid %{%Y-%m-%d %H:%M:%S}tl|
</I>&gt;<i>     %6tr %&gt;a
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; %Ss/%03&gt;Hs/%&lt;Hs %&lt;st %rm %ru %un %Sh/%&lt;A %mt %ea
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; logfile_rotate 0
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; access_log daemon:/var/log/squid.user/access.log
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; logformat=extended-squid on-error=drop
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; cache_peer parent_proxy &#160;parent 3128 0
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; never_direct allow all
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; cachemgr_passwd pass config
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; acl PURGE method PURGE
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; http_access allow PURGE
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; http_access allow all
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; http_port 3131 ssl-bump generate-host-certificates=on
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; dynamic_cert_mem_cache_size=20MB
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; tls-cert=/etc/squid.user/sslbump/bump.crt
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; tls-key=/etc/squid.user/sslbump/bump.key
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; sslproxy_cert_error allow all
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; acl step1 at_step SslBump1
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; acl step2 at_step SslBump2
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; acl step3 at_step SslBump3
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; ssl_bump peek step1
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; ssl_bump bump step2
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; ssl_bump bump step3
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; cache_dir rock /data/squid.user/cache 20000
</I>&gt;<i>     max-size=12000000
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; cache_swap_low 85
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; cache_swap_high 90
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; *collapsed_forwarding on*
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; pinger_enable off
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; max_filedesc 8192
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; shutdown_lifetime 5 seconds
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; netdb_filename none
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; log_icp_queries off
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; client_request_buffer_max_size 100 MB
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; via off
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; forwarded_for delete
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; coredump_dir /data/squid.user/var/cache/squid
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; *curl_forker.sh:*
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; #!/bin/sh
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; N=100
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;     
</I>&gt;<i>      &#160;URL=<A HREF="https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf">https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf</A> &lt;<A HREF="https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf">https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf</A>&gt; &lt;<A HREF="https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf">https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf</A> &lt;<A HREF="https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf">https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf</A>&gt;&gt; &lt;<A HREF="https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf">https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf</A> &lt;<A HREF="https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf">https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf</A>&gt; &lt;<A HREF="https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf">https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf</A> &lt;<A HREF="https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf">https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf</A>&gt;&gt;&gt; &lt;<A HREF="https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf">https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf</A> &lt;<A HREF="https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf">https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf</A>&gt; &lt;<A HREF="https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf">https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf</A> &lt;<A HREF="https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf">https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf</A>&gt;&gt; &lt;<A HREF="https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf">https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf</A> &lt;<A HREF="https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf">https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf</A>&gt; &lt;<A HREF="https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf">https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf</A> &lt;<A HREF="https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf">https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf</A>&gt;&gt;&gt;&gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; if [[ &#160;-n $1 &amp;&amp; &#160;$1 =~ help$ &#160;]];
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; then
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;echo &quot;Usage: $0 [&lt;cnt&gt;] [&lt;url&gt;]&quot;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;echo
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;echo &quot;Example: $0 10
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;
</I>&gt;<i>     <A HREF="https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf">https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf</A> &lt;<A HREF="https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf">https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf</A>&gt; &lt;<A HREF="https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf">https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf</A> &lt;<A HREF="https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf">https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf</A>&gt;&gt; &lt;<A HREF="https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf">https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf</A> &lt;<A HREF="https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf">https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf</A>&gt; &lt;<A HREF="https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf">https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf</A> &lt;<A HREF="https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf">https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf</A>&gt;&gt;&gt; &lt;<A HREF="https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf">https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf</A> &lt;<A HREF="https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf">https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf</A>&gt; &lt;<A HREF="https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf">https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf</A> &lt;<A HREF="https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf">https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf</A>&gt;&gt; &lt;<A HREF="https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf">https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf</A> &lt;<A HREF="https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf">https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf</A>&gt; &lt;<A HREF="https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf">https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf</A> &lt;<A HREF="https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf">https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf</A>&gt;&gt;&gt;&gt;&quot;;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;echo
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;exit;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; fi
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; while [[ $# -gt 0 ]]
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; do
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;&#160; &#160; if [[ $1 =~ ^[0-9]+$ ]]
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;&#160; &#160; then
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160;N=$1
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;&#160; &#160; else
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160;URL=$1
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;&#160; &#160; fi
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;&#160; &#160; shift
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; done
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; echo $URL
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; echo $N threads
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; for i in `seq $N`
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; do
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;&#160; &#160; nohup curl --tlsv1.2 -k &#160; --proxy 0001vsg01:3131
</I>&gt;<i>      &#160;-v $URL
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &#160;&gt;/dev/null
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;&#160; &#160;2&gt;&amp;1 &amp;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; done
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; _______________________________________________
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; squid-users mailing list
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160;&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;&gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160;&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;&gt;&gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160; &gt; <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>     &lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>&gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160;&lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>     &lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>&gt;&gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;&lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>     &lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>&gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160;&lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>     &lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>&gt;&gt;&gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;_______________________________________________
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;squid-users mailing list
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160;&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;&gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160;&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;&gt;&gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt; <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>     &lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>&gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160;&lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>     &lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>&gt;&gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;&#160; &#160; &#160;&lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>     &lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>&gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160;&lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>     &lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>&gt;&gt;&gt;
</I>&gt;<i>      &gt;&#160; &#160; &#160; &gt;
</I>&gt;<i>      &gt;
</I>&gt;<i> 
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025856.html">[squid-users] Proxy server to support a large number of simultaneous requests
</A></li>
	<LI>Next message (by thread): <A HREF="025862.html">[squid-users] Proxy server to support a large number of simultaneous requests
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25861">[ date ]</a>
              <a href="thread.html#25861">[ thread ]</a>
              <a href="subject.html#25861">[ subject ]</a>
              <a href="author.html#25861">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
