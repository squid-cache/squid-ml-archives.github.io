<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Proxy server to support a large number of simultaneous requests
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Proxy%20server%20to%20support%20a%20large%20number%20of%0A%20simultaneous%20requests&In-Reply-To=%3CCADJd0Y3YRXJ55pUr0zJvwO5JxfEUY3tgPF9%2BaVMkcXKHowzFeg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025865.html">
   <LINK REL="Next"  HREF="025857.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Proxy server to support a large number of simultaneous requests</H1>
    <B>Andrey K</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Proxy%20server%20to%20support%20a%20large%20number%20of%0A%20simultaneous%20requests&In-Reply-To=%3CCADJd0Y3YRXJ55pUr0zJvwO5JxfEUY3tgPF9%2BaVMkcXKHowzFeg%40mail.gmail.com%3E"
       TITLE="[squid-users] Proxy server to support a large number of simultaneous requests">ankor2023 at gmail.com
       </A><BR>
    <I>Thu Jun 22 09:07:55 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025865.html">[squid-users] Proxy server to support a large number of simultaneous requests
</A></li>
        <LI>Next message (by thread): <A HREF="025857.html">[squid-users] External ACL doesn't used
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25886">[ date ]</a>
              <a href="thread.html#25886">[ thread ]</a>
              <a href="subject.html#25886">[ subject ]</a>
              <a href="author.html#25886">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,  Eliezer,

Thank you for the comment.
I tried squid for this scenario only in the test environment.
I will share the results after conducting a real video broadcast.

Kind regards,
       Ankor

&#1087;&#1085;, 12 &#1080;&#1102;&#1085;. 2023&#8239;&#1075;. &#1074; 11:08, &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A>&gt;:

&gt;<i> Hey Ankor,
</I>&gt;<i>
</I>&gt;<i> Thanks for sharing the scenario.
</I>&gt;<i> At the beginning I was thinking to myself: Why Squid? Is it the best
</I>&gt;<i> choice for the scenario?
</I>&gt;<i> And after walking through my list of caching proxies, including couple I
</I>&gt;<i> wrote myself I got to the conclusion:
</I>&gt;<i> Well.. Squid-Cache is simple to use and just works.
</I>&gt;<i> Compared to other caching mechanisms squid is so simple to configure and
</I>&gt;<i> it really leaves dust
</I>&gt;<i> behind to all many other cache mechanisms.
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i> Eliezer
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> From: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; On Behalf
</I>&gt;<i> Of Andrey K
</I>&gt;<i> Sent: Tuesday, June 6, 2023 16:08
</I>&gt;<i> To: Alex Rousskov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt;
</I>&gt;<i> Cc: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> Subject: Re: [squid-users] Proxy server to support a large number of
</I>&gt;<i> simultaneous requests
</I>&gt;<i>
</I>&gt;<i> Hello, Alex,
</I>&gt;<i>
</I>&gt;<i> I have shortened the correspondence because it does not meet the size
</I>&gt;<i> requirements for the mailing list.
</I>&gt;<i>
</I>&gt;<i> Thank you so much for your time, the analysis and recommendations.
</I>&gt;<i>
</I>&gt;<i> I disabled the cache_dir and now squid works as expected -  there is only
</I>&gt;<i> one request to the original content server:
</I>&gt;<i> - on the small file:
</I>&gt;<i>       1 NONE_NONE/503/- HIER_NONE/-
</I>&gt;<i>       4 TCP_CF_HIT/200/- HIER_NONE/-
</I>&gt;<i>     128 TCP_HIT/200/- HIER_NONE/-
</I>&gt;<i>     366 TCP_MEM_HIT/200/- HIER_NONE/-
</I>&gt;<i>       1 TCP_MISS/200/200 FIRSTUP_PARENT/parent_proxy
</I>&gt;<i>
</I>&gt;<i> - on the large file:
</I>&gt;<i>      17 TCP_CF_HIT/200/- HIER_NONE/-
</I>&gt;<i>     482 TCP_HIT/200/- HIER_NONE/-
</I>&gt;<i>       1 TCP_MISS/200/200 FIRSTUP_PARENT/parent_proxy
</I>&gt;<i>
</I>&gt;<i> I think this configuration is perfect for caching online video broadcasts.
</I>&gt;<i> Chanks of video are required by clients simultaneously only for a short
</I>&gt;<i> period of time, so there is no need to save them to disk..
</I>&gt;<i> As my VM has 32 GB of RAM, I can configure a sufficient amount of
</I>&gt;<i> cache_mem, say 20000 MB to provide caching of video broadcasts.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Kind regards,
</I>&gt;<i>      Ankor.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &#1087;&#1085;, 5 &#1080;&#1102;&#1085;. 2023&#8239;&#1075;. &#1074; 17:31, Alex Rousskov &lt;mailto:
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt;:
</I>&gt;<i> On 6/2/23 03:29, Andrey K wrote:
</I>&gt;<i>
</I>&gt;<i> &gt;  &gt; Can you repeat this test and share a pointer to the corresponding
</I>&gt;<i> &gt;  &gt; compressed cache.log, containing those 500 (or fewer, as long as the
</I>&gt;<i> &gt;  &gt; problem is reproduced!) concurrent transactions. One or many of those
</I>&gt;<i> &gt;  &gt; concurrent transactions resulted in the unwanted entry deletion. The
</I>&gt;<i> log
</I>&gt;<i> &gt;  &gt; may show what happened in that case.
</I>&gt;<i>
</I>&gt;<i> &gt; I cleared the rock cache, set the debug level, restarted squid, cleared
</I>&gt;<i> &gt; the cache.log, ran 500-threads test, waited for it to finish and
</I>&gt;<i> &gt; launched curl to make sure it returned TCP_MISS.
</I>&gt;<i> &gt; Then stopped squid to limit the cache.log file.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thank you for sharing that log! I only had time to study a few misses.
</I>&gt;<i> They all stemmed from the same sequence of events:
</I>&gt;<i>
</I>&gt;<i> 1. A collapsed request finds the corresponding entry in the cache.
</I>&gt;<i> 2. Squid decides that this request should open the disk file.
</I>&gt;<i> 3. The rock disk entry is still being written (i.e. &quot;swapped out&quot;),
</I>&gt;<i>     so the attempt to swap it in fails (TCP_SWAPFAIL_MISS).
</I>&gt;<i> 4. The request goes to the origin server.
</I>&gt;<i> 5. The fresh response deletes the existing cached entry.
</I>&gt;<i> 6. When a subsequent request finds the cached entry marked for
</I>&gt;<i>     deletion, it declares a cache miss (TCP_MISS) and goes to step 4.
</I>&gt;<i>
</I>&gt;<i> Disclaimer: The above sequence of events causes misses, but it may not
</I>&gt;<i> be the only or even the primary cause. I do not have enough free time to
</I>&gt;<i> rule out or confirm other causes (and order them by severity).
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Squid can (and should) handle concurrent swapout/swapins better, and we
</I>&gt;<i> may be able to estimate that improvement potential for your workload
</I>&gt;<i> without significant development, but, for the next step, I suggest
</I>&gt;<i> disabling cache_dir and testing whether your get substantially better
</I>&gt;<i> results with memory cache alone. Shared memory cache also has periods
</I>&gt;<i> where a being-written entry cannot be read, but, compared to the disk
</I>&gt;<i> cache, those periods are much shorter IIRC. I would like to confirm that
</I>&gt;<i> this simplified mode of operation works well for your workload before I
</I>&gt;<i> suggest code changes that would rely, in part, on this mode.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thank you,
</I>&gt;<i>
</I>&gt;<i> Alex.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20230622/fec96b06/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20230622/fec96b06/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025865.html">[squid-users] Proxy server to support a large number of simultaneous requests
</A></li>
	<LI>Next message (by thread): <A HREF="025857.html">[squid-users] External ACL doesn't used
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25886">[ date ]</a>
              <a href="thread.html#25886">[ thread ]</a>
              <a href="subject.html#25886">[ subject ]</a>
              <a href="author.html#25886">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
