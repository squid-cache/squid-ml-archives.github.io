<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] make URL bypass squid proxy
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20make%20URL%20bypass%20squid%20proxy&In-Reply-To=%3Cb34086dc-81e3-e4ab-d9ea-c7bd4709ca24%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025900.html">
   <LINK REL="Next"  HREF="025905.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] make URL bypass squid proxy</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20make%20URL%20bypass%20squid%20proxy&In-Reply-To=%3Cb34086dc-81e3-e4ab-d9ea-c7bd4709ca24%40measurement-factory.com%3E"
       TITLE="[squid-users] make URL bypass squid proxy">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Jun 27 20:51:10 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025900.html">[squid-users] make URL bypass squid proxy
</A></li>
        <LI>Next message (by thread): <A HREF="025905.html">[squid-users] make URL bypass squid proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25902">[ date ]</a>
              <a href="thread.html#25902">[ thread ]</a>
              <a href="subject.html#25902">[ subject ]</a>
              <a href="author.html#25902">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 6/27/23 16:29, robert k Wild wrote:
&gt;<i> Ok I've literally commented out &quot;http deny all&quot; so the proxy isn't 
</I>&gt;<i> blocking anything and allowing everything
</I>&gt;<i> 
</I>&gt;<i> http_access allow activation whitelist
</I>&gt;<i> #http_access deny all
</I>&gt;<i> 
</I>&gt;<i> And still it's not allowing this specific URL to go through the proxy
</I>&gt;<i> 
</I>&gt;<i> activate.redshift3d.com &lt;<A HREF="http://activate.redshift3d.com">http://activate.redshift3d.com</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> Well it is but it isn't, as it's an activation URL it isn't activating 
</I>&gt;<i> the app via the proxy, as soon as I pop the pc on the internet, it 
</I>&gt;<i> activates the app
</I>&gt;<i> 
</I>&gt;<i> Any ideas guys?
</I>
If you have not already, restore the &quot;deny all&quot; rule and make sure that 
everything works if you do not bump traffic. Use just &quot;http_port 3128&quot; 
if you have to, without the ssl-bump flag and related ssl_bump rules.

Once the above is working, I would check whether your app trusts your CA 
certificate (/usr/local/squid/etc/ssl_cert/myCA.pem). If you have not 
done anything about that trust on the app side, then that app will not 
trust it, and all bumped transactions will fail because the app will 
refuse to receive TLS traffic related to that certificate.

Add %err_code/%err_detail fields to your access.log using the logformat 
and access_log directives. They may help identify failed transactions.


HTH,

Alex.


&gt;<i> On Tue, 27 Jun 2023, 07:36 robert k Wild, &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">robertkwild at gmail.com</A> 
</I>&gt;<i> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">robertkwild at gmail.com</A>&gt;&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i>     Hi Eliezer,
</I>&gt;<i> 
</I>&gt;<i>     this is a snippet of my whitelist and no intercept SSL config
</I>&gt;<i> 
</I>&gt;<i>     #SSL Interception
</I>&gt;<i>     acl DiscoverSNIHost at_step SslBump1
</I>&gt;<i>     acl NoSSLIntercept ssl::server_name_regex
</I>&gt;<i>     &quot;/usr/local/squid/etc/interceptssl.txt&quot;
</I>&gt;<i>     ssl_bump peek DiscoverSNIHost
</I>&gt;<i>     ssl_bump splice NoSSLIntercept
</I>&gt;<i>     ssl_bump bump all
</I>&gt;<i>     #
</I>&gt;<i>     #SSL Bump
</I>&gt;<i>     http_port 3128 ssl-bump cert=/usr/local/squid/etc/ssl_cert/myCA.pem
</I>&gt;<i>     generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
</I>&gt;<i>     sslcrtd_program /usr/local/squid/libexec/security_file_certgen -s
</I>&gt;<i>     /var/lib/ssl_db -M 4MB
</I>&gt;<i>     #
</I>&gt;<i>     #deny up MIME types
</I>&gt;<i>     acl upmime req_mime_type &quot;/usr/local/squid/etc/mimedeny.txt&quot;
</I>&gt;<i>     #
</I>&gt;<i>     #deny URL links
</I>&gt;<i>     acl url_links url_regex &quot;/usr/local/squid/etc/linksurl.txt&quot;
</I>&gt;<i>     #
</I>&gt;<i>     #allow special URL paths
</I>&gt;<i>     acl special_url url_regex &quot;/usr/local/squid/etc/urlspecial.txt&quot;
</I>&gt;<i>     #
</I>&gt;<i>     #deny down MIME types
</I>&gt;<i>     acl downmime rep_mime_type &quot;/usr/local/squid/etc/mimedeny.txt&quot;
</I>&gt;<i>     #
</I>&gt;<i>     http_reply_access allow special_url
</I>&gt;<i>     http_reply_access deny downmime
</I>&gt;<i>     #http_access deny upmime
</I>&gt;<i>     #http_access deny url_links
</I>&gt;<i>     #
</I>&gt;<i>     #HTTP_HTTPS whitelist websites
</I>&gt;<i>     acl whitelist ssl::server_name_regex &quot;/usr/local/squid/etc/urlwhite.txt&quot;
</I>&gt;<i>     #
</I>&gt;<i>     http_access allow activation whitelist
</I>&gt;<i>     http_access deny all
</I>&gt;<i> 
</I>&gt;<i>     so basically no SSL interception
</I>&gt;<i> 
</I>&gt;<i>     #SSL Interception
</I>&gt;<i>     acl DiscoverSNIHost at_step SslBump1
</I>&gt;<i>     acl NoSSLIntercept ssl::server_name_regex
</I>&gt;<i>     &quot;/usr/local/squid/etc/interceptssl.txt&quot;
</I>&gt;<i>     ssl_bump peek DiscoverSNIHost
</I>&gt;<i>     ssl_bump splice NoSSLIntercept
</I>&gt;<i>     ssl_bump bump all
</I>&gt;<i> 
</I>&gt;<i>     and whitelisting
</I>&gt;<i> 
</I>&gt;<i>     #HTTP_HTTPS whitelist websites
</I>&gt;<i>     acl whitelist ssl::server_name_regex
</I>&gt;<i>     &quot;/usr/local/squid/etc/urlwhite.txt&quot;
</I>&gt;<i> 
</I>&gt;<i>     in both txt files ie
</I>&gt;<i> 
</I>&gt;<i>     /usr/local/squid/etc/interceptssl.txt
</I>&gt;<i>     /usr/local/squid/etc/urlwhite.txt
</I>&gt;<i> 
</I>&gt;<i>     i have a URL that first i have to whitelist and then if i want squid
</I>&gt;<i>     not to inspect the url traffic i put it in the SSL interception (i
</I>&gt;<i>     do this as some websites dont like MITM )
</I>&gt;<i> 
</I>&gt;<i>     but even putting the URL in question in both files im still having
</I>&gt;<i>     issues with this website ie its still being detected that its
</I>&gt;<i>     passing through a proxy
</I>&gt;<i> 
</I>&gt;<i>     thanks,
</I>&gt;<i>     rob
</I>&gt;<i> 
</I>&gt;<i>     On Mon, 26 Jun 2023 at 23:35, &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A>&gt;&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i>         Hey Robert,____
</I>&gt;<i> 
</I>&gt;<i>         __ __
</I>&gt;<i> 
</I>&gt;<i>         I am not sure what forward proxy setup you have there.____
</I>&gt;<i> 
</I>&gt;<i>         A simple forward proxy?____
</I>&gt;<i> 
</I>&gt;<i>         What tool are you using for whitelisting?____
</I>&gt;<i> 
</I>&gt;<i>         You can use an external acl helper to allow dynamic updates of
</I>&gt;<i>         the whitelists or
</I>&gt;<i>         to periodic update your lists and reload.
</I>&gt;<i>         It will depend on the size of your lists.
</I>&gt;<i>         What OS are you using for your squid proxy?____
</I>&gt;<i> 
</I>&gt;<i>         __ __
</I>&gt;<i> 
</I>&gt;<i>         More details will help us help you.____
</I>&gt;<i> 
</I>&gt;<i>         __ __
</I>&gt;<i> 
</I>&gt;<i>         Eliezer____
</I>&gt;<i> 
</I>&gt;<i>         __ __
</I>&gt;<i> 
</I>&gt;<i>         *From:*squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>
</I>&gt;<i>         &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt;&gt; *On Behalf
</I>&gt;<i>         Of *robert k Wild
</I>&gt;<i>         *Sent:* Monday, June 26, 2023 22:25
</I>&gt;<i>         *To:* Squid Users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i>         &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;&gt;
</I>&gt;<i>         *Subject:* [squid-users] make URL bypass squid proxy____
</I>&gt;<i> 
</I>&gt;<i>         __ __
</I>&gt;<i> 
</I>&gt;<i>         hi all,____
</I>&gt;<i> 
</I>&gt;<i>         __ __
</I>&gt;<i> 
</I>&gt;<i>         i have set up squid for url whitelisting and no intercept SSL
</I>&gt;<i>         (see below)____
</I>&gt;<i> 
</I>&gt;<i>         __ __
</I>&gt;<i> 
</I>&gt;<i>         <A HREF="https://wiki.squid-cache.org/ConfigExamples/Caching/AdobeProducts">https://wiki.squid-cache.org/ConfigExamples/Caching/AdobeProducts</A> &lt;<A HREF="https://wiki.squid-cache.org/ConfigExamples/Caching/AdobeProducts">https://wiki.squid-cache.org/ConfigExamples/Caching/AdobeProducts</A>&gt;____
</I>&gt;<i> 
</I>&gt;<i>         __ __
</I>&gt;<i> 
</I>&gt;<i>         but some websites i want the client to bypass the squid proxy
</I>&gt;<i>         and go straight to the website as i think this is why a url isnt
</I>&gt;<i>         working even when i add the url to both files ie urlwhite and no
</I>&gt;<i>         intercept SSL____
</I>&gt;<i> 
</I>&gt;<i>         __ __
</I>&gt;<i> 
</I>&gt;<i>         __ __
</I>&gt;<i> 
</I>&gt;<i>         __ __
</I>&gt;<i> 
</I>&gt;<i>         thanks,____
</I>&gt;<i> 
</I>&gt;<i>         rob____
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>         -- ____
</I>&gt;<i> 
</I>&gt;<i>         Regards,
</I>&gt;<i> 
</I>&gt;<i>         Robert K Wild.____
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     -- 
</I>&gt;<i>     Regards,
</I>&gt;<i> 
</I>&gt;<i>     Robert K Wild.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025900.html">[squid-users] make URL bypass squid proxy
</A></li>
	<LI>Next message (by thread): <A HREF="025905.html">[squid-users] make URL bypass squid proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25902">[ date ]</a>
              <a href="thread.html#25902">[ thread ]</a>
              <a href="subject.html#25902">[ subject ]</a>
              <a href="author.html#25902">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
