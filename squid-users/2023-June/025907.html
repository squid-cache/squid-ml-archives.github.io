<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] make URL bypass squid proxy
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20make%20URL%20bypass%20squid%20proxy&In-Reply-To=%3CCAGU_CiKqgxK0ejJoL1F0n5YF3y-4JY2OJbpSJe7TUK6sskRKzw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025905.html">
   <LINK REL="Next"  HREF="025908.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] make URL bypass squid proxy</H1>
    <B>robert k Wild</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20make%20URL%20bypass%20squid%20proxy&In-Reply-To=%3CCAGU_CiKqgxK0ejJoL1F0n5YF3y-4JY2OJbpSJe7TUK6sskRKzw%40mail.gmail.com%3E"
       TITLE="[squid-users] make URL bypass squid proxy">robertkwild at gmail.com
       </A><BR>
    <I>Thu Jun 29 09:18:26 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025905.html">[squid-users] make URL bypass squid proxy
</A></li>
        <LI>Next message (by thread): <A HREF="025908.html">[squid-users] make URL bypass squid proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25907">[ date ]</a>
              <a href="thread.html#25907">[ thread ]</a>
              <a href="subject.html#25907">[ subject ]</a>
              <a href="author.html#25907">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>very clever, so you bunch all the acls up

acl NoSSLInterceptAnyOf any-of NoSSLInterceptDstDom
NoSSLInterceptDstDomFile NoSSLInterceptRegEx NoSSLInterceptRegExFile

the key word is &quot;any-of&quot; ie if the url hits any one do that first

what about instead of making it

ssl::server_name_regex

i make it

*dstdom_regex*

On Thu, 29 Jun 2023 at 01:38, &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A>&gt; wrote:

&gt;<i> Hey Rob,
</I>&gt;<i>
</I>&gt;<i> The first thing is to allow the domain in the http_acces just to be sure
</I>&gt;<i> and use a basic deny all bottom line.
</I>&gt;<i> Let me try to simplify your squid.conf
</I>&gt;<i> In a link:
</I>&gt;<i> <A HREF="https://gist.github.com/elico/b49f4a28d4b5db5ba882b10d40872d5e">https://gist.github.com/elico/b49f4a28d4b5db5ba882b10d40872d5e</A>
</I>&gt;<i>
</I>&gt;<i> In plain text:
</I>&gt;<i> ## START OF FILE
</I>&gt;<i> # SSL Interception  basic rules
</I>&gt;<i> acl DiscoverSNIHost at_step SslBump1
</I>&gt;<i>
</I>&gt;<i> acl NoSSLInterceptRegEx ssl::server_name_regex (^|.*\.)redshift3d\.com$
</I>&gt;<i> acl NoSSLInterceptRegExFile ssl::server_name_regex
</I>&gt;<i> &quot;/usr/local/squid/etc/no-intercept-ssl-regex.txt&quot;
</I>&gt;<i>
</I>&gt;<i> acl NoSSLInterceptDstDom ssl::server_name .redshift3d.com
</I>&gt;<i> acl NoSSLInterceptDstDomFile ssl::server_name
</I>&gt;<i> &quot;/usr/local/squid/etc/no-intercept-ssl-dstdom.txt&quot;
</I>&gt;<i>
</I>&gt;<i> ## Any of will test what ever rule match first in a first match/hit fasion
</I>&gt;<i> acl NoSSLInterceptAnyOf any-of NoSSLInterceptDstDom
</I>&gt;<i> NoSSLInterceptDstDomFile NoSSLInterceptRegEx NoSSLInterceptRegExFile
</I>&gt;<i>
</I>&gt;<i> ssl_bump peek DiscoverSNIHost
</I>&gt;<i> ssl_bump splice NoSSLInterceptAnyOf
</I>&gt;<i> ssl_bump bump all
</I>&gt;<i>
</I>&gt;<i> #SSL Bump port
</I>&gt;<i> http_port 3128 ssl-bump cert=/usr/local/squid/etc/ssl_cert/myCA.pem
</I>&gt;<i> generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
</I>&gt;<i> sslcrtd_program /usr/local/squid/libexec/security_file_certgen -s
</I>&gt;<i> /var/lib/ssl_db -M 4MB
</I>&gt;<i>
</I>&gt;<i> ## http_access acls, will apply on incomming requests and not on responses
</I>&gt;<i> acl special_url_regex url_regex https?://(^|.*\.)redshift3d\.com\/
</I>&gt;<i> acl special_url_regex_file url_regex
</I>&gt;<i> &quot;/usr/local/squid/etc/special_url_regex.txt&quot;
</I>&gt;<i>
</I>&gt;<i> acl special_url_dst_dom dstdomain .redshift3d.com
</I>&gt;<i> acl special_url_dst_dom_file dstdomain
</I>&gt;<i> &quot;/usr/local/squid/etc/special_url_dstdom.txt&quot;
</I>&gt;<i>
</I>&gt;<i> acl special_url_any_of any-of special_url_dst_dom special_url_dst_dom_file
</I>&gt;<i> special_url_regex special_url_regex_file
</I>&gt;<i>
</I>&gt;<i> acl localnet src 192.168.0.0/16
</I>&gt;<i> acl localnet src 10.0.0.0/8
</I>&gt;<i>
</I>&gt;<i> http_access allow localnet special_url_any_of
</I>&gt;<i> http_access deny all
</I>&gt;<i> ## END OF FILE
</I>&gt;<i>
</I>&gt;<i>  Once the above will work try to add other http_access rule like reply
</I>&gt;<i> access rules
</I>&gt;<i>
</I>&gt;<i> Let me know what happens,
</I>&gt;<i> Eliezer
</I>&gt;<i>
</I>&gt;<i> From: robert k Wild &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">robertkwild at gmail.com</A>&gt;
</I>&gt;<i> Sent: Tuesday, June 27, 2023 09:36
</I>&gt;<i> To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A>
</I>&gt;<i> Cc: Squid Users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i> Subject: Re: [squid-users] make URL bypass squid proxy
</I>&gt;<i>
</I>&gt;<i> Hi Eliezer,
</I>&gt;<i>
</I>&gt;<i> this is a snippet of my whitelist and no intercept SSL config
</I>&gt;<i>
</I>&gt;<i> #SSL Interception
</I>&gt;<i> acl DiscoverSNIHost at_step SslBump1
</I>&gt;<i> acl NoSSLIntercept ssl::server_name_regex
</I>&gt;<i> &quot;/usr/local/squid/etc/interceptssl.txt&quot;
</I>&gt;<i> ssl_bump peek DiscoverSNIHost
</I>&gt;<i> ssl_bump splice NoSSLIntercept
</I>&gt;<i> ssl_bump bump all
</I>&gt;<i> #
</I>&gt;<i> #SSL Bump
</I>&gt;<i> http_port 3128 ssl-bump cert=/usr/local/squid/etc/ssl_cert/myCA.pem
</I>&gt;<i> generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
</I>&gt;<i> sslcrtd_program /usr/local/squid/libexec/security_file_certgen -s
</I>&gt;<i> /var/lib/ssl_db -M 4MB
</I>&gt;<i> #
</I>&gt;<i> #deny up MIME types
</I>&gt;<i> acl upmime req_mime_type &quot;/usr/local/squid/etc/mimedeny.txt&quot;
</I>&gt;<i> #
</I>&gt;<i> #deny URL links
</I>&gt;<i> acl url_links url_regex &quot;/usr/local/squid/etc/linksurl.txt&quot;
</I>&gt;<i> #
</I>&gt;<i> #allow special URL paths
</I>&gt;<i> acl special_url url_regex &quot;/usr/local/squid/etc/urlspecial.txt&quot;
</I>&gt;<i> #
</I>&gt;<i> #deny down MIME types
</I>&gt;<i> acl downmime rep_mime_type &quot;/usr/local/squid/etc/mimedeny.txt&quot;
</I>&gt;<i> #
</I>&gt;<i> http_reply_access allow special_url
</I>&gt;<i> http_reply_access deny downmime
</I>&gt;<i> #http_access deny upmime
</I>&gt;<i> #http_access deny url_links
</I>&gt;<i> #
</I>&gt;<i> #HTTP_HTTPS whitelist websites
</I>&gt;<i> acl whitelist ssl::server_name_regex &quot;/usr/local/squid/etc/urlwhite.txt&quot;
</I>&gt;<i> #
</I>&gt;<i> http_access allow activation whitelist
</I>&gt;<i> http_access deny all
</I>&gt;<i>
</I>&gt;<i> so basically no SSL interception
</I>&gt;<i>
</I>&gt;<i> #SSL Interception
</I>&gt;<i> acl DiscoverSNIHost at_step SslBump1
</I>&gt;<i> acl NoSSLIntercept ssl::server_name_regex
</I>&gt;<i> &quot;/usr/local/squid/etc/interceptssl.txt&quot;
</I>&gt;<i> ssl_bump peek DiscoverSNIHost
</I>&gt;<i> ssl_bump splice NoSSLIntercept
</I>&gt;<i> ssl_bump bump all
</I>&gt;<i>
</I>&gt;<i> and whitelisting
</I>&gt;<i>
</I>&gt;<i> #HTTP_HTTPS whitelist websites
</I>&gt;<i> acl whitelist ssl::server_name_regex &quot;/usr/local/squid/etc/urlwhite.txt&quot;
</I>&gt;<i>
</I>&gt;<i> in both txt files ie
</I>&gt;<i>
</I>&gt;<i> /usr/local/squid/etc/interceptssl.txt
</I>&gt;<i> /usr/local/squid/etc/urlwhite.txt
</I>&gt;<i>
</I>&gt;<i> i have a URL that first i have to whitelist and then if i want squid not
</I>&gt;<i> to inspect the url traffic i put it in the SSL interception (i do this as
</I>&gt;<i> some websites dont like MITM )
</I>&gt;<i>
</I>&gt;<i> but even putting the URL in question in both files im still having issues
</I>&gt;<i> with this website ie its still being detected that its passing through a
</I>&gt;<i> proxy
</I>&gt;<i>
</I>&gt;<i> thanks,
</I>&gt;<i> rob
</I>&gt;<i>
</I>&gt;<i> On Mon, 26 Jun 2023 at 23:35, &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">ngtech1ltd at gmail.com</A>&gt; wrote:
</I>&gt;<i> Hey Robert,
</I>&gt;<i>
</I>&gt;<i> I am not sure what forward proxy setup you have there.
</I>&gt;<i> A simple forward proxy?
</I>&gt;<i> What tool are you using for whitelisting?
</I>&gt;<i> You can use an external acl helper to allow dynamic updates of the
</I>&gt;<i> whitelists or
</I>&gt;<i> to periodic update your lists and reload.
</I>&gt;<i> It will depend on the size of your lists.
</I>&gt;<i> What OS are you using for your squid proxy?
</I>&gt;<i>
</I>&gt;<i> More details will help us help you.
</I>&gt;<i>
</I>&gt;<i> Eliezer
</I>&gt;<i>
</I>&gt;<i> From: squid-users &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; On
</I>&gt;<i> Behalf Of robert k Wild
</I>&gt;<i> Sent: Monday, June 26, 2023 22:25
</I>&gt;<i> To: Squid Users &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i> Subject: [squid-users] make URL bypass squid proxy
</I>&gt;<i>
</I>&gt;<i> hi all,
</I>&gt;<i>
</I>&gt;<i> i have set up squid for url whitelisting and no intercept SSL (see below)
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://wiki.squid-cache.org/ConfigExamples/Caching/AdobeProducts">https://wiki.squid-cache.org/ConfigExamples/Caching/AdobeProducts</A>
</I>&gt;<i>
</I>&gt;<i> but some websites i want the client to bypass the squid proxy and go
</I>&gt;<i> straight to the website as i think this is why a url isnt working even when
</I>&gt;<i> i add the url to both files ie urlwhite and no intercept SSL
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> thanks,
</I>&gt;<i> rob
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Regards,
</I>&gt;<i>
</I>&gt;<i> Robert K Wild.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Regards,
</I>&gt;<i>
</I>&gt;<i> Robert K Wild.
</I>&gt;<i>
</I>&gt;<i>
</I>
-- 
Regards,

Robert K Wild.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20230629/2fb91e6c/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20230629/2fb91e6c/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025905.html">[squid-users] make URL bypass squid proxy
</A></li>
	<LI>Next message (by thread): <A HREF="025908.html">[squid-users] make URL bypass squid proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25907">[ date ]</a>
              <a href="thread.html#25907">[ thread ]</a>
              <a href="subject.html#25907">[ subject ]</a>
              <a href="author.html#25907">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
