<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] ClamAV crash in eCAP Adapter
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ClamAV%20crash%20in%20eCAP%20Adapter&In-Reply-To=%3C29ff3195-5a94-de06-e9a2-559aacd4d22e%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025675.html">
   <LINK REL="Next"  HREF="025677.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] ClamAV crash in eCAP Adapter</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ClamAV%20crash%20in%20eCAP%20Adapter&In-Reply-To=%3C29ff3195-5a94-de06-e9a2-559aacd4d22e%40measurement-factory.com%3E"
       TITLE="[squid-users] ClamAV crash in eCAP Adapter">rousskov at measurement-factory.com
       </A><BR>
    <I>Wed Mar  1 17:07:22 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025675.html">[squid-users] ClamAV crash in eCAP Adapter
</A></li>
        <LI>Next message (by thread): <A HREF="025677.html">[squid-users] Missing translation directories und 'errors' in squid 5.8
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25676">[ date ]</a>
              <a href="thread.html#25676">[ thread ]</a>
              <a href="subject.html#25676">[ subject ]</a>
              <a href="author.html#25676">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 3/1/23 11:31, Rafael Akchurin wrote:
&gt;<i> Hello everyone,
</I>&gt;<i> 
</I>&gt;<i> May I ask for your experiences with the latest update of ClamAV with eCAP adapter enabled. Running Squid 5.7 on Ubuntu 20.04.
</I>&gt;<i> Starting from today (01-March-2023) the following crash stops Squid process.
</I>
For ClamAV eCAP adapter support, please use that adapter support 
channels rather that squid-users: <A HREF="https://www.e-cap.org/support/">https://www.e-cap.org/support/</A>
It may help if you define &quot;crash&quot; more precisely when following up there.


&gt;<i> #0  0x00007fab13a44ff0 in cli_bm_scanbuff () from /lib/x86_64-linux-gnu/libclamav.so.9
</I>&gt;<i> #1  0x00007fab13a4c8da in ?? () from /lib/x86_64-linux-gnu/libclamav.so.9
</I>&gt;<i> #2  0x00007fab13a52023 in ?? () from /lib/x86_64-linux-gnu/libclamav.so.9
</I>&gt;<i> #3  0x00007fab13a545a9 in ?? () from /lib/x86_64-linux-gnu/libclamav.so.9
</I>&gt;<i> #4  0x00007fab13a5a589 in ?? () from /lib/x86_64-linux-gnu/libclamav.so.9
</I>&gt;<i> #5  0x00007fab13a5b4cf in ?? () from /lib/x86_64-linux-gnu/libclamav.so.9
</I>&gt;<i> #6  0x00007fab13a54251 in ?? () from /lib/x86_64-linux-gnu/libclamav.so.9
</I>&gt;<i> #7  0x00007fab13a5767a in cl_load () from /lib/x86_64-linux-gnu/libclamav.so.9
</I>&gt;<i> #8  0x00007fab13c123e5 in Adapter::ClamAv::loadDatabase (this=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">this at entry</A>=0x56119a5f4290) at ClamAv.cc:137
</I>&gt;<i> #9  0x00007fab13c12658 in Adapter::ClamAv::configure (this=0x56119a5f4290, cfg=...) at ClamAv.cc:83
</I>&gt;<i> #10 0x00007fab13c0939d in Adapter::Service::configure (this=0x56119a5ef940, cfg=warning: RTTI symbol not found for class 'Adaptation::Ecap::ConfigRep'
</I>&gt;<i> ...) at /usr/include/c++/9/tr1/shared_ptr.h:668
</I>&gt;<i> #11 0x000056119979bd04 in Adaptation::Ecap::ServiceRep::tryConfigureAndStart() ()
</I>&gt;<i> #12 0x000056119979c38b in Adaptation::Ecap::ServiceRep::finalize() ()
</I>&gt;<i> #13 0x0000561199783126 in Adaptation::Config::Finalize(bool) ()
</I>&gt;<i> #14 0x000056119951ba3f in SquidMain(int, char**) ()
</I>&gt;<i> #15 0x00005611993a8ef6 in main ()
</I>&gt;<i> 
</I>&gt;<i> Am I correct to think the crash might be related to some definition file update issued by ClamAV team?
</I>

It might be. In the past, the changes in the ClamAV database file 
location and/or name resulted in crashes with similar symptoms as 
detailed at <A HREF="https://bugs.launchpad.net/ecap/+bug/1426095">https://bugs.launchpad.net/ecap/+bug/1426095</A>

That information may no longer be relevant, but according to the triage 
of that (very old!) issue, you may want to enable Squid debugging and 
search for errors like the following:

LibClamAV Error: cl_load(): No such file or directory: 
/usr/local/clamav/share/clamav


HTH,

Alex.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025675.html">[squid-users] ClamAV crash in eCAP Adapter
</A></li>
	<LI>Next message (by thread): <A HREF="025677.html">[squid-users] Missing translation directories und 'errors' in squid 5.8
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25676">[ date ]</a>
              <a href="thread.html#25676">[ thread ]</a>
              <a href="subject.html#25676">[ subject ]</a>
              <a href="author.html#25676">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
