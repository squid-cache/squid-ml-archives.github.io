<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Can't store log in mysql 8.0 database
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Can%27t%20store%20log%20in%20mysql%208.0%20database&In-Reply-To=%3CCAJXDObZaB3bjqZ41%2BtDKKvTx_w4Q6B%2B4uqgMKwruMO6SL7fTZA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025681.html">
   <LINK REL="Next"  HREF="025682.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Can't store log in mysql 8.0 database</H1>
    <B>Francisco</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Can%27t%20store%20log%20in%20mysql%208.0%20database&In-Reply-To=%3CCAJXDObZaB3bjqZ41%2BtDKKvTx_w4Q6B%2B4uqgMKwruMO6SL7fTZA%40mail.gmail.com%3E"
       TITLE="[squid-users] Can't store log in mysql 8.0 database">frizquierdo87 at gmail.com
       </A><BR>
    <I>Fri Mar  3 19:22:27 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025681.html">[squid-users] Missing translation directories und 'errors' in squid 5.8
</A></li>
        <LI>Next message (by thread): <A HREF="025682.html">[squid-users] Can't store log in mysql 8.0 database
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25679">[ date ]</a>
              <a href="thread.html#25679">[ thread ]</a>
              <a href="subject.html#25679">[ subject ]</a>
              <a href="author.html#25679">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi, I\m trying to store logs in a mysql server 8.0 database from squid 5.7
in Debian 11.

My idea is store all logs in /var/log/squid/ dir, and logs from specifics
urls, domains and sites store in mysql database ('access_log_internet'
table) to restrict those users that overcuote an specific amount of MB.


*The config:*
*access_log /var/log/squid/nav_basica-access.log squid dominios*

* access_log /var/log/squid/nav_basica-access.log squid dominios_parciales *

* access_log /var/log/squid/nav_basica-access.log squid sitios *
* access_log /var/log/squid/nav_basica-access.log squid dominio_cu*
* access_log /var/log/squid/internet-access.log squid !dominios
!dominios_parciales !sitios !dominio_cu*

*logfile_daemon /usr/lib/squid/log_db_daemon*
*access_log
daemon:/192.168.56.2:3306/squidmgr/access_log_internet/squidmgr/squidmgrsquid
&lt;<A HREF="http://192.168.56.2:3306/squidmgr/access_log_internet/squidmgr/squidmgrsquid">http://192.168.56.2:3306/squidmgr/access_log_internet/squidmgr/squidmgrsquid</A>&gt;
!dominios !dominios_parciales !sitios !dominio_cu*

when try start squid, it's fail:



















*Dec 31 19:00:00 1969Use of uninitialized value $DBI::errstr in
concatenation (.) or string at /usr/lib/squid/log_db_daemon line 403.Dec 31
19:00:00 1969Cannot connect to database:  at /usr/lib/squid/log_db_daemon
line 403.Dec 31 19:33:43 1969/03/03 14:10:32| pinger: Initialising ICMP
pinger ...Dec 31 19:33:43 1969/03/03 14:10:32| pinger: ICMP socket
opened.Dec 31 19:33:43 1969/03/03 14:10:32| pinger: ICMPv6 socket openedDec
31 19:33:43 1969/03/03 14:10:32| Pinger exiting.Dec 31 19:33:43 1969/03/03
14:10:32 kid1| logfileHandleWrite:
daemon:/192.168.56.1:3306/squidmgr/access_log_internet/squidmgr/squidmgr
&lt;<A HREF="http://192.168.56.1:3306/squidmgr/access_log_internet/squidmgr/squidmgr">http://192.168.56.1:3306/squidmgr/access_log_internet/squidmgr/squidmgr</A>&gt;:
error writing ((32) Broken pipe)Dec 31 19:33:43 1969/03/03 14:10:32 kid1|
Closing HTTP(S) port 192.168.56.2:8080 &lt;<A HREF="http://192.168.56.2:8080">http://192.168.56.2:8080</A>&gt;Dec 31
19:33:43 1969/03/03 14:10:32 kid1| storeDirWriteCleanLogs: Starting...Dec
31 19:33:43 1969/03/03 14:10:32 kid1|   Finished.  Wrote 134 entries.Dec 31
19:33:43 1969/03/03 14:10:32 kid1|   Took 0.00 seconds (308045.98
entries/sec).Dec 31 19:33:43 1969/03/03 14:10:32 kid1| FATAL: I don't
handle this error well!Dec 31 19:33:43 1969/03/03 14:10:32 kid1| Squid
Cache (Version 5.7): Terminated abnormally.Dec 31 19:00:00 1969CPU Usage:
0.161 seconds = 0.132 user + 0.029 sysDec 31 19:00:00 1969Maximum Resident
Size: 109440 KBDec 31 19:00:00 1969Page faults with physical i/o: 0Dec 31
19:33:43 1969/03/03 14:10:32 kid1| Closing Pinger socket on FD 66Dec 31
19:33:43 1969/03/03 14:10:32| Removing PID file (/run/squid.pid)*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20230303/b066310c/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20230303/b066310c/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025681.html">[squid-users] Missing translation directories und 'errors' in squid 5.8
</A></li>
	<LI>Next message (by thread): <A HREF="025682.html">[squid-users] Can't store log in mysql 8.0 database
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25679">[ date ]</a>
              <a href="thread.html#25679">[ thread ]</a>
              <a href="subject.html#25679">[ subject ]</a>
              <a href="author.html#25679">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
