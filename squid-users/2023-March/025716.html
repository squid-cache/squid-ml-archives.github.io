<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid 5.7 Bad request from parent cache after squid -k reconfigure
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%205.7%20Bad%20request%20from%20parent%20cache%20after%20squid%0A%20-k%20reconfigure&In-Reply-To=%3CCAJXDObbwMZBcE0w1JV91-a-3b%2BvgSxgfJG_WfTrPLAFxJhtM6Q%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025715.html">
   <LINK REL="Next"  HREF="025718.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid 5.7 Bad request from parent cache after squid -k reconfigure</H1>
    <B>Francisco</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%205.7%20Bad%20request%20from%20parent%20cache%20after%20squid%0A%20-k%20reconfigure&In-Reply-To=%3CCAJXDObbwMZBcE0w1JV91-a-3b%2BvgSxgfJG_WfTrPLAFxJhtM6Q%40mail.gmail.com%3E"
       TITLE="[squid-users] squid 5.7 Bad request from parent cache after squid -k reconfigure">frizquierdo87 at gmail.com
       </A><BR>
    <I>Fri Mar 24 01:34:40 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025715.html">[squid-users] [EXTERNAL] FreeBSD 12 thousands connections
</A></li>
        <LI>Next message (by thread): <A HREF="025718.html">[squid-users] squid 5.7 Bad request from parent cache after squid -k reconfigure
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25716">[ date ]</a>
              <a href="thread.html#25716">[ thread ]</a>
              <a href="subject.html#25716">[ subject ]</a>
              <a href="author.html#25716">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi, (first Iapologize for my English) I have a local squid proxy in forward
mode, with parent cache. I'm trying calc and restrict authenticated users
that reach the assigned cuote on certains domains and sites, and for that I
store the access log into database that match determinates ACL. Every one
minute run an script that calc http_size for every user from database
(leaving out logs records derived from TCP_HIT_, zero size, NONE, etc,
etc), and those users that get her assigned limit, I put them into a file
(that point to an access deny_rule), and make squid -k reconfigure.
All process described works ok, the users are denied but, when users try to
visit all others sites that are not taked in account to overcuote the
users, they get TCP_MISS/400 from parent cache (or NONE_NONE_ABORTED,
TCP_NEGATIVE_HIT, etc), and when user refresh the requested url, the
resource load again. Looking the parent response I look that url is
incorrect because it is missing the scheme and the host, for example: for
an url like <A HREF="http://www.certaindomain.com/page/section-algo/bla-bla-bla,">http://www.certaindomain.com/page/section-algo/bla-bla-bla,</A> the
TCP_MISS/400 (bad request from parent cache) result
in: /page/section-algo/bla-bla-bla
Any help with that?? where is my mistake?? Thank you

squid 5.7 over debian 11 (from Debian sid repository but until now it work
ok in others aspects).
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20230323/9e60bbc2/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20230323/9e60bbc2/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025715.html">[squid-users] [EXTERNAL] FreeBSD 12 thousands connections
</A></li>
	<LI>Next message (by thread): <A HREF="025718.html">[squid-users] squid 5.7 Bad request from parent cache after squid -k reconfigure
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25716">[ date ]</a>
              <a href="thread.html#25716">[ thread ]</a>
              <a href="subject.html#25716">[ subject ]</a>
              <a href="author.html#25716">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
