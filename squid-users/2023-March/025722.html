<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid-users Digest, Vol 103, Issue 23
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid-users%20Digest%2C%20Vol%20103%2C%20Issue%2023&In-Reply-To=%3CCAJXDObb7uFq7YBxqNcOW%2BwC2scDkOC4xe1ZCnS0VkoJFiG95_w%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025721.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid-users Digest, Vol 103, Issue 23</H1>
    <B>Francisco</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid-users%20Digest%2C%20Vol%20103%2C%20Issue%2023&In-Reply-To=%3CCAJXDObb7uFq7YBxqNcOW%2BwC2scDkOC4xe1ZCnS0VkoJFiG95_w%40mail.gmail.com%3E"
       TITLE="[squid-users] squid-users Digest, Vol 103, Issue 23">frizquierdo87 at gmail.com
       </A><BR>
    <I>Thu Mar 30 13:37:15 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025721.html">[squid-users] logging: TCP connection to x.x.x.x/3128 failed
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25722">[ date ]</a>
              <a href="thread.html#25722">[ thread ]</a>
              <a href="subject.html#25722">[ subject ]</a>
              <a href="author.html#25722">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I got the external acl setup to work, it had some bugs but I notice
something that maybe through configuration I can fix.

It's a configuration
external_acl_type CHECKOVERCUOTE concurrency=100 ttl=3 negative_ttl=10
children-max=50 children-startup=10 children-idle=5  %LOGIN
/usr/lib/squid/ext_sql_session_acl --dsn &quot;DBI:mysql:database=squidmgr&quot;
--user squidmgr --password squ1dmgr --table &quot;proxy_usuario&quot; --uidcol
&quot;identificador&quot; --usercol &quot;identificador&quot; --cond &quot;overcuote = 1&quot; --debug
acl OVERCUOTE external CHECKOVERCUOTE

It generate: SELECT identificador AS 'user', '' AS 'tag' FROM proxy_usuario
WHERE (identificador = ?) AND overcuote =1
UID queried: 'frizquierdo - ' # when user identifier authenticated on squid
is 'frizquierdo'

The user identifier generated by the ext_sql_session_acl query is made up
of the user identifier +space+ hyphen +space, for example (for
'frizquierdo' identifier, 'frizquierdo - ' is generated), so in the
database it would have to be the user identifier stored in that format.
Is there a directive that guarantees that the parameter is not created that
way?

El mi&#233;, 29 mar 2023 a las 8:00, &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-request at lists.squid-cache.org</A>&gt;
escribi&#243;:

&gt;<i> Send squid-users mailing list submissions to
</I>&gt;<i>         <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i>
</I>&gt;<i> To subscribe or unsubscribe via the World Wide Web, visit
</I>&gt;<i>         <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> or, via email, send a message with subject or body 'help' to
</I>&gt;<i>         <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-request at lists.squid-cache.org</A>
</I>&gt;<i>
</I>&gt;<i> You can reach the person managing the list at
</I>&gt;<i>         <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-owner at lists.squid-cache.org</A>
</I>&gt;<i>
</I>&gt;<i> When replying, please edit your Subject line so it is more specific
</I>&gt;<i> than &quot;Re: Contents of squid-users digest...&quot;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Today's Topics:
</I>&gt;<i>
</I>&gt;<i>    1. Re: squid-users Digest, Vol 103, Issue 22 (Francisco)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ----------------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i> Message: 1
</I>&gt;<i> Date: Tue, 28 Mar 2023 11:46:29 -0400
</I>&gt;<i> From: Francisco &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">frizquierdo87 at gmail.com</A>&gt;
</I>&gt;<i> To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> Subject: Re: [squid-users] squid-users Digest, Vol 103, Issue 22
</I>&gt;<i> Message-ID:
</I>&gt;<i>         &lt;
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">CAJXDOba8SokfbZWeG-GidyLb6-r-hJYG__qJCCF6iQ2zQJUE0g at mail.gmail.com</A>&gt;
</I>&gt;<i> Content-Type: text/plain; charset=&quot;utf-8&quot;
</I>&gt;<i>
</I>&gt;<i> In my previous email I was missing part of the text when I sent it, I
</I>&gt;<i> deleted it by mistake.
</I>&gt;<i> This is what I have so far:
</I>&gt;<i>
</I>&gt;<i> I try to make the following config:
</I>&gt;<i> external_acl_type CHECKOVERCUOTE ttl=5 negative_ttl=5 children-max=10
</I>&gt;<i> children-startup=5 %ACL /usr/lib/squid/ext_sql_session_acl --dsn
</I>&gt;<i> &quot;DBI:mysql:database=squidmgr&quot; --user squidmgr --password squidmgr --table
</I>&gt;<i> &quot;proxy_usuario&quot; uidcol &quot;id&quot; --usercol &quot;identificador&quot; --cond &quot;overcuote=1&quot;
</I>&gt;<i> --persist
</I>&gt;<i> acl OVERCUOTE external CHECKOVERCUOTE
</I>&gt;<i>
</I>&gt;<i> http_access allow CONNECT SSL_ports !dominio_cuba usuarios_internet
</I>&gt;<i> macs_red_local red_local !OVERCUOTE
</I>&gt;<i>
</I>&gt;<i> --cond &quot;overcuote=1&quot; is the field in database that it's set to 1 when user
</I>&gt;<i> calc overcuote.
</I>&gt;<i>
</I>&gt;<i> if i try ext_sql_session_acl from terminal, i see:
</I>&gt;<i> ERR message=&quot;unknow UID ' '&quot;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> El mar, 28 mar 2023 a las 8:00, &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-request at lists.squid-cache.org</A>
</I>&gt;<i> &gt;
</I>&gt;<i> escribi?:
</I>&gt;<i>
</I>&gt;<i> &gt; Send squid-users mailing list submissions to
</I>&gt;<i> &gt;         <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; To subscribe or unsubscribe via the World Wide Web, visit
</I>&gt;<i> &gt;         <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> &gt; or, via email, send a message with subject or body 'help' to
</I>&gt;<i> &gt;         <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-request at lists.squid-cache.org</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; You can reach the person managing the list at
</I>&gt;<i> &gt;         <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-owner at lists.squid-cache.org</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; When replying, please edit your Subject line so it is more specific
</I>&gt;<i> &gt; than &quot;Re: Contents of squid-users digest...&quot;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Today's Topics:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;    1. Re: squid-users Digest, Vol 103, Issue 21 (Francisco)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ----------------------------------------------------------------------
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Message: 1
</I>&gt;<i> &gt; Date: Mon, 27 Mar 2023 18:09:10 -0400
</I>&gt;<i> &gt; From: Francisco &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">frizquierdo87 at gmail.com</A>&gt;
</I>&gt;<i> &gt; To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> &gt; Subject: Re: [squid-users] squid-users Digest, Vol 103, Issue 21
</I>&gt;<i> &gt; Message-ID:
</I>&gt;<i> &gt;         &lt;CAJXDObaQz4X2g=
</I>&gt;<i> &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">Y5Uh3U6NPmoafA-RygPWMvfED6bEYNszf_uA at mail.gmail.com</A>&gt;
</I>&gt;<i> &gt; Content-Type: text/plain; charset=&quot;utf-8&quot;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Sorry, I don't understand how to combine *ext_sql_session_acl* with
</I>&gt;<i> &gt; anothers acl of type dstdomain for example, becasue I need calc user's
</I>&gt;<i> &gt; cuote only for an certains sites (domains, and sites).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; El lun, 27 mar 2023 a las 8:00, &lt;
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-request at lists.squid-cache.org</A>
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; escribi?:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; Send squid-users mailing list submissions to
</I>&gt;<i> &gt; &gt;         <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; To subscribe or unsubscribe via the World Wide Web, visit
</I>&gt;<i> &gt; &gt;         <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> &gt; &gt; or, via email, send a message with subject or body 'help' to
</I>&gt;<i> &gt; &gt;         <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-request at lists.squid-cache.org</A>
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; You can reach the person managing the list at
</I>&gt;<i> &gt; &gt;         <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-owner at lists.squid-cache.org</A>
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; When replying, please edit your Subject line so it is more specific
</I>&gt;<i> &gt; &gt; than &quot;Re: Contents of squid-users digest...&quot;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Today's Topics:
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;    1. Re: squid 5.7 Bad request from parent cache after squid -k
</I>&gt;<i> &gt; &gt;       reconfigure (Amos Jeffries)
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; ----------------------------------------------------------------------
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Message: 1
</I>&gt;<i> &gt; &gt; Date: Mon, 27 Mar 2023 05:05:02 +1300
</I>&gt;<i> &gt; &gt; From: Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;
</I>&gt;<i> &gt; &gt; To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> &gt; &gt; Subject: Re: [squid-users] squid 5.7 Bad request from parent cache
</I>&gt;<i> &gt; &gt;         after squid -k reconfigure
</I>&gt;<i> &gt; &gt; Message-ID: &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">bfd2a571-02d1-2cff-690c-59caf55a0338 at treenet.co.nz</A>&gt;
</I>&gt;<i> &gt; &gt; Content-Type: text/plain; charset=UTF-8; format=flowed
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; On 24/03/2023 2:34 pm, Francisco wrote:
</I>&gt;<i> &gt; &gt; &gt; Hi, (first Iapologize for my English) I have a local squid proxy in
</I>&gt;<i> &gt; &gt; &gt; forward mode, with parent cache. I'm trying calc and restrict
</I>&gt;<i> &gt; &gt; &gt; authenticated users that reach the assigned cuote on certains domains
</I>&gt;<i> &gt; &gt; &gt; and sites, and for that I store the access log into database that
</I>&gt;<i> &gt; &gt; &gt; match determinates ACL.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; Every one minute run an script that calc http_size for every user
</I>&gt;<i> from
</I>&gt;<i> &gt; &gt; &gt; database (leaving out logs records derived from TCP_HIT_, zero size,
</I>&gt;<i> &gt; &gt; &gt; NONE, etc, etc), and those users that get her assigned limit, I put
</I>&gt;<i> &gt; &gt; &gt; them into a file (that point to an access deny_rule), and make squid
</I>&gt;<i> &gt; &gt; &gt; -k reconfigure.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Constantly reconfiguring Squid has a large number of side effects such
</I>&gt;<i> &gt; &gt; as the one you noticed. Avoiding that is a good idea.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; I recommend having a table in the database with the details about
</I>&gt;<i> &gt; &gt; whether a user is allowed (or not). The ext_sql_session_acl helper can
</I>&gt;<i> &gt; &gt; check that table to allow/deny users.
</I>&gt;<i> &gt; &gt;  ?&lt;
</I>&gt;<i> &gt; <A HREF="http://www.squid-cache.org/Versions/v4/manuals/ext_sql_session_acl.html">http://www.squid-cache.org/Versions/v4/manuals/ext_sql_session_acl.html</A>
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; HTH
</I>&gt;<i> &gt; &gt; Amos
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; ------------------------------
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Subject: Digest Footer
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; _______________________________________________
</I>&gt;<i> &gt; &gt; squid-users mailing list
</I>&gt;<i> &gt; &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> &gt; &gt; <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; ------------------------------
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; End of squid-users Digest, Vol 103, Issue 21
</I>&gt;<i> &gt; &gt; ********************************************
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; -------------- next part --------------
</I>&gt;<i> &gt; An HTML attachment was scrubbed...
</I>&gt;<i> &gt; URL: &lt;
</I>&gt;<i> &gt;
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20230327/48f4c47d/attachment-0001.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20230327/48f4c47d/attachment-0001.htm</A>
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ------------------------------
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Subject: Digest Footer
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; squid-users mailing list
</I>&gt;<i> &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> &gt; <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ------------------------------
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; End of squid-users Digest, Vol 103, Issue 22
</I>&gt;<i> &gt; ********************************************
</I>&gt;<i> &gt;
</I>&gt;<i> -------------- next part --------------
</I>&gt;<i> An HTML attachment was scrubbed...
</I>&gt;<i> URL: &lt;
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20230328/fd60a036/attachment-0001.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20230328/fd60a036/attachment-0001.htm</A>
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> ------------------------------
</I>&gt;<i>
</I>&gt;<i> Subject: Digest Footer
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ------------------------------
</I>&gt;<i>
</I>&gt;<i> End of squid-users Digest, Vol 103, Issue 23
</I>&gt;<i> ********************************************
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20230330/cab03651/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20230330/cab03651/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025721.html">[squid-users] logging: TCP connection to x.x.x.x/3128 failed
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25722">[ date ]</a>
              <a href="thread.html#25722">[ thread ]</a>
              <a href="subject.html#25722">[ subject ]</a>
              <a href="author.html#25722">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
