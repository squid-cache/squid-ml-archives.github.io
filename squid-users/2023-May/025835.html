<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] cache_peer selection
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20cache_peer%20selection&In-Reply-To=%3C42979f46-868c-4b29-7456-73a1765ce2d6%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025834.html">
   <LINK REL="Next"  HREF="025836.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] cache_peer selection</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20cache_peer%20selection&In-Reply-To=%3C42979f46-868c-4b29-7456-73a1765ce2d6%40measurement-factory.com%3E"
       TITLE="[squid-users] cache_peer selection">rousskov at measurement-factory.com
       </A><BR>
    <I>Fri May 12 14:53:03 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025834.html">[squid-users] cache_peer selection
</A></li>
        <LI>Next message (by thread): <A HREF="025836.html">[squid-users] cache_peer selection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25835">[ date ]</a>
              <a href="thread.html#25835">[ thread ]</a>
              <a href="subject.html#25835">[ subject ]</a>
              <a href="author.html#25835">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 5/12/23 07:28, Alexey&#1103;&#1088; Gruzdov wrote:
&gt;<i> Hello Guys!
</I>&gt;<i> 
</I>&gt;<i> Thank you for your help that was&#160;before!
</I>&gt;<i> 
</I>&gt;<i> Could you explain somethings - For example I have a five cache_peer servers
</I>&gt;<i> 
</I>&gt;<i> peer1
</I>&gt;<i> peer2
</I>&gt;<i> peer3
</I>&gt;<i> peer4
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> And users like:
</I>&gt;<i> 
</I>&gt;<i> User-100
</I>&gt;<i> User-101
</I>&gt;<i> 
</I>&gt;<i> For forwarding requests over&#160; existed cache_peer I use an external ACL 
</I>&gt;<i> and &quot;note&quot; option - all works well.
</I>&gt;<i> 
</I>&gt;<i> Now I'd like to implement the next logic:
</I>&gt;<i> This is something like a failover of specified&#160;cache_peers for specified 
</I>&gt;<i> user.
</I>
If your external ACL can tell whether the peer has &quot;failed&quot;, then the 
external ACL can annotate the transaction not to use that failed peer.

Otherwise, what you want may be possible using complex ACL tricks, but I 
am not sure, and do not have the time to explain/test those tricks. In 
short, you would need to create ACLs that detect peer selection stage[1] 
and select a different peer during different stages.

[1] <A HREF="https://wiki.squid-cache.org/Features/LoadBalance#go-through-a-peer">https://wiki.squid-cache.org/Features/LoadBalance#go-through-a-peer</A>


FWIW, dynamic peer selection with failover preference support is a known 
missing feature. Factory has implemented that feature[2], but we need 
more time to polish and submit our implementation for the official Squid 
Project consideration. With that feature, there is no need for the 
complex ACLs mentioned above because the ACL script simply tells Squid 
which peers to use for the transaction, in which failover order.

[2] <A HREF="https://github.com/measurement-factory/squid/pull/169">https://github.com/measurement-factory/squid/pull/169</A>


&gt;<i> For example:
</I>&gt;<i> We send User-100 over peer1, if peer1 is failed - that User-100 must to 
</I>&gt;<i> go over peer2.
</I>
Without code modifications, the above example will work because Squid 
will prefer peer1 to peer2, assuming that, in squid.conf, the cache_peer 
directive for peer1 is listed higher/earlier than that for peer2.


&gt;<i> For User-101 - something like - primary&#160;will be peer4, if its&#160;failed 
</I>&gt;<i> User-101 must to go over peer3.
</I>
However, this example will _not_ work by default, for the same reason: 
When both peers are alive, Squid will prefer peer3 over peer4.


HTH,

Alex.


&gt;<i> its something like primary and multiple of backup of cache_peer
</I>&gt;<i> 
</I>&gt;<i> etc....
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Thank you !
</I>&gt;<i> 
</I>&gt;<i> Alexg
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025834.html">[squid-users] cache_peer selection
</A></li>
	<LI>Next message (by thread): <A HREF="025836.html">[squid-users] cache_peer selection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25835">[ date ]</a>
              <a href="thread.html#25835">[ thread ]</a>
              <a href="subject.html#25835">[ subject ]</a>
              <a href="author.html#25835">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
