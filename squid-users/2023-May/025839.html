<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] host_verify_check behaviour in intercept mode for domain behind Loadbalancer ( multiple IPs )
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20host_verify_check%20behaviour%20in%20intercept%20mode%20for%0A%20domain%20behind%20Loadbalancer%20%28%20multiple%20IPs%20%29&In-Reply-To=%3C69b3c42c-8a9a-24e3-737a-ac4bd5b48bad%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025838.html">
   <LINK REL="Next"  HREF="025851.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] host_verify_check behaviour in intercept mode for domain behind Loadbalancer ( multiple IPs )</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20host_verify_check%20behaviour%20in%20intercept%20mode%20for%0A%20domain%20behind%20Loadbalancer%20%28%20multiple%20IPs%20%29&In-Reply-To=%3C69b3c42c-8a9a-24e3-737a-ac4bd5b48bad%40treenet.co.nz%3E"
       TITLE="[squid-users] host_verify_check behaviour in intercept mode for domain behind Loadbalancer ( multiple IPs )">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue May 16 14:03:15 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025838.html">[squid-users] host_verify_check behaviour in intercept mode for domain behind Loadbalancer ( multiple IPs )
</A></li>
        <LI>Next message (by thread): <A HREF="025851.html">[squid-users] host_verify_check behaviour in intercept mode for domain behind Loadbalancer ( multiple IPs )
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25839">[ date ]</a>
              <a href="thread.html#25839">[ thread ]</a>
              <a href="subject.html#25839">[ subject ]</a>
              <a href="author.html#25839">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 16/05/2023 6:52 pm, sachin gupta wrote:
&gt;<i> Hi
</I>&gt;<i> We recently shifted to squid 5.9 and started seeing errors in 
</I>&gt;<i> Transparent mode SECURITY ALERT: Host header forgery detected on 
</I>&gt;<i> conn3615903 local=44.242.184.237:443 &lt;<A HREF="http://44.242.184.237:443">http://44.242.184.237:443</A>&gt; 
</I>&gt;<i> remote=10.109.176.240:8990 &lt;<A HREF="http://10.109.176.240:8990">http://10.109.176.240:8990</A>&gt; FD 28029 
</I>&gt;<i> flags=17 (local IP does not match any domain IP)
</I>
This is not a error, it is a alert to what is going on. The client 
10.109.176.240 is trying to connect to 44.242.184.237 requesting a 
domain which DNS says is **not** hosted there.

What happens next depends on what Squid is able to do given the 
transaction type.
Some are rejected as unable to continue, some are allowed to complete 
under restricted handling.

&gt;<i> Previously we were using 
</I>&gt;<i> <A HREF="https://github.com/NethServer/dev/issues/5348.">https://github.com/NethServer/dev/issues/5348.</A> In addition we are 
</I>&gt;<i> using client_dst_passthru off. When building 5.9, the patch was not 
</I>&gt;<i> applied cleanly and we wanted to check if things worked without this 
</I>&gt;<i> patch. They did not work.
</I>
Please clarify &quot;things&quot; and &quot;did not work&quot;.

&gt;<i> I did check the forum responses 
</I>&gt;<i> <A HREF="https://wiki.squid-cache.org/KnowledgeBase/HostHeaderForgery.">https://wiki.squid-cache.org/KnowledgeBase/HostHeaderForgery.</A> and 
</I>&gt;<i> <A HREF="https://docs.diladele.com/faq/squid/host_header_forgery.html.">https://docs.diladele.com/faq/squid/host_header_forgery.html.</A> We 
</I>&gt;<i> already support explicit proxy but that is not always an option. We 
</I>&gt;<i> can create another patch to circumvent issues like ***. But I wanted 
</I>&gt;<i> to know if there is a plan to make this check optional or there is 
</I>&gt;<i> some way we can workaround this problem without changing the code. 
</I>&gt;<i> Without this support, how can intercept mode work for any website 
</I>&gt;<i> which is behind a loadbalancer with multiple IPs.
</I>
More recent version of Squid allow some more CONNECT traffic cases be 
handled instead of rejected.
There are also some ideas on further improvements, but those are a long 
way off.

Cheers
Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025838.html">[squid-users] host_verify_check behaviour in intercept mode for domain behind Loadbalancer ( multiple IPs )
</A></li>
	<LI>Next message (by thread): <A HREF="025851.html">[squid-users] host_verify_check behaviour in intercept mode for domain behind Loadbalancer ( multiple IPs )
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25839">[ date ]</a>
              <a href="thread.html#25839">[ thread ]</a>
              <a href="subject.html#25839">[ subject ]</a>
              <a href="author.html#25839">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
