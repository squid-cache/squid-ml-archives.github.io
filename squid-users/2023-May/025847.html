<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] TCP_TUNNEL/500 in squid logs in squid 5.9
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TCP_TUNNEL/500%20in%20squid%20logs%20in%20squid%205.9&In-Reply-To=%3CCALpWAcoD4NdJL78yU2o_9KvrKTc_jVLH0npDa-rE%3Dj_BdDyOcg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025846.html">
   <LINK REL="Next"  HREF="025848.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] TCP_TUNNEL/500 in squid logs in squid 5.9</H1>
    <B>sachin gupta</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TCP_TUNNEL/500%20in%20squid%20logs%20in%20squid%205.9&In-Reply-To=%3CCALpWAcoD4NdJL78yU2o_9KvrKTc_jVLH0npDa-rE%3Dj_BdDyOcg%40mail.gmail.com%3E"
       TITLE="[squid-users] TCP_TUNNEL/500 in squid logs in squid 5.9">sachin1.g at gmail.com
       </A><BR>
    <I>Thu May 25 15:20:31 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025846.html">[squid-users] maintenance period for ngtech www services
</A></li>
        <LI>Next message (by thread): <A HREF="025848.html">[squid-users] TCP_TUNNEL/500 in squid logs in squid 5.9
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25847">[ date ]</a>
              <a href="thread.html#25847">[ thread ]</a>
              <a href="subject.html#25847">[ subject ]</a>
              <a href="author.html#25847">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi All

We are migrating for squid 4.15 to squid 5.9. We are running our existing
test suite to check if we pass our sanity testing.

For requests in transparent mode, though request passes and client get 200,
in squid logs we are getting TCP_TUNNEL/500. We were not getting this issue
with squid 4.15.

*Client logs*

curl -v <A HREF="https://origin/cache/0">https://origin/cache/0</A>

*   Trying 10.80.96.68:443...

* TCP_NODELAY set

* Connected to origin (10.80.96.68) port 443 (#0)

* ALPN, offering h2

* ALPN, offering http/1.1

* Cipher selection:
ALL:!EXPORT:!EXPORT40:!EXPORT56:!aNULL:!LOW:!RC4:@STRENGTH

* successfully set certificate verify locations:

*   CAfile: /etc/pki/tls/certs/ca-bundle.crt

  CApath: none

* TLSv1.2 (OUT), TLS header, Certificate Status (22):

* TLSv1.2 (OUT), TLS handshake, Client hello (1):

* TLSv1.2 (IN), TLS handshake, Server hello (2):

* TLSv1.2 (IN), TLS handshake, Certificate (11):

* TLSv1.2 (IN), TLS handshake, Server key exchange (12):

* TLSv1.2 (IN), TLS handshake, Server finished (14):

* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):

* TLSv1.2 (OUT), TLS change cipher, Change cipher spec (1):

* TLSv1.2 (OUT), TLS handshake, Finished (20):

* TLSv1.2 (IN), TLS change cipher, Change cipher spec (1):

* TLSv1.2 (IN), TLS handshake, Finished (20):

* SSL connection using TLSv1.2 / ECDHE-RSA-AES256-SHA

* ALPN, server did not agree to a protocol

* Server certificate:

*  subject: C=US; ST=CA; L=SF; O=SFDC;
OU=0:ns.tester;1:mvp;2:mist51;3:na44;4:dev1; CN=origin

*  start date: Jul 26 06:59:41 2022 GMT

*  expire date: Jul 26 06:59:41 2023 GMT

*  subjectAltName: host &quot;origin&quot; matched cert's &quot;origin&quot;

*  issuer: C=US; ST=CA; L=SF; O=SFDC; OU=Edge; CN=ca

*  SSL certificate verify ok.

&gt;<i> GET /cache/0 HTTP/1.1
</I>
&gt;<i> Host: origin
</I>
&gt;<i> User-Agent: curl/7.67.0
</I>
&gt;<i> Accept: */*
</I>
&gt;<i>
</I>
* Mark bundle as not supporting multiuse

&lt; HTTP/1.1 200 OK

&lt; Server: origin

&lt; Date: Thu, 25 May 2023 15:08:57 GMT

&lt; Connection: close

&lt; Content-Type: application/json

&lt; Content-Length: 162

&lt; Cache-Control: public, max-age=0

&lt; Access-Control-Allow-Origin: *

&lt; Access-Control-Allow-Credentials: true

&lt;

{&quot;args&quot;:{},&quot;headers&quot;:{&quot;Accept&quot;:&quot;*/*&quot;,&quot;Host&quot;:&quot;origin&quot;,&quot;User-Agent&quot;:&quot;curl/7.67.0&quot;,&quot;X-Origin-Server&quot;:&quot;origin&quot;},&quot;origin&quot;:&quot;10.80.96.3&quot;,&quot;url&quot;:&quot;
<A HREF="https://origin/cache/0">https://origin/cache/0</A>&quot;}

* Closing connection 0

* TLSv1.2 (OUT), TLS alert, close notify (256):


Squid access logs


[25/May/2023:15:08:57]      31 10.80.96.6:51028 - NONE_NONE/000 0 CONNECT
10.80.96.68:443 tester HIER_NONE/- - - tester 746573746572 dagobah [-] -
[-] - [-] - 0 0 - - [origin]

[25/May/2023:15:08:57]     40 10.80.96.6:51028 - *TCP_TUNNEL/500* 800
CONNECT origin:443 tester HIER_DIRECT/origin 10.80.96.68 - tester
746573746572 dagobah [-] - [-] - [-] - 1969 2769 4 33 [origin]


Can someone please help in this.


Regards

Sachin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20230525/7d8f166a/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20230525/7d8f166a/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025846.html">[squid-users] maintenance period for ngtech www services
</A></li>
	<LI>Next message (by thread): <A HREF="025848.html">[squid-users] TCP_TUNNEL/500 in squid logs in squid 5.9
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25847">[ date ]</a>
              <a href="thread.html#25847">[ thread ]</a>
              <a href="subject.html#25847">[ subject ]</a>
              <a href="author.html#25847">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
