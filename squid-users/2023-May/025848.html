<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] TCP_TUNNEL/500 in squid logs in squid 5.9
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TCP_TUNNEL/500%20in%20squid%20logs%20in%20squid%205.9&In-Reply-To=%3CCALpWAcqnEhk%3DdMsUkm8rcSEeigjAZXktkYT%2B4imU8PiosYH5qA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025847.html">
   <LINK REL="Next"  HREF="025849.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] TCP_TUNNEL/500 in squid logs in squid 5.9</H1>
    <B>sachin gupta</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TCP_TUNNEL/500%20in%20squid%20logs%20in%20squid%205.9&In-Reply-To=%3CCALpWAcqnEhk%3DdMsUkm8rcSEeigjAZXktkYT%2B4imU8PiosYH5qA%40mail.gmail.com%3E"
       TITLE="[squid-users] TCP_TUNNEL/500 in squid logs in squid 5.9">sachin1.g at gmail.com
       </A><BR>
    <I>Fri May 26 12:22:50 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="025847.html">[squid-users] TCP_TUNNEL/500 in squid logs in squid 5.9
</A></li>
        <LI>Next message (by thread): <A HREF="025849.html">[squid-users] Proxy server to support a large number of simultaneous requests
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25848">[ date ]</a>
              <a href="thread.html#25848">[ thread ]</a>
              <a href="subject.html#25848">[ subject ]</a>
              <a href="author.html#25848">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi

I also added some prints in ClientHttpRequest::logRequest  to see if it is
getting 500 from response.

 398     if (const auto reply = findReply()) {

 399

 400         debugs(33, 8, &quot;SACHIN clientLogRequest: status='&quot; &lt;&lt;
reply-&gt;sline.status() &lt;&lt; &quot;'&quot;);

 401         debugs(33, 8, &quot;SACHIN clientLogRequest: body='&quot; &lt;&lt;
reply-&gt;body.content() &lt;&lt; &quot;'&quot;);

 402         al-&gt;http.code = reply-&gt;sline.status();

 403         al-&gt;http.content_type = reply-&gt;content_type.termedBuf();

 404     }

 405

 406     debugs(33, 9, &quot;clientLogRequest: http.code='&quot; &lt;&lt; al-&gt;http.code &lt;&lt;
&quot;'&quot;);



The lines inside if ( 400-401 ) did not get printed but 406 got printed
with status code as 500. I also collected cache.log with debug level as 5
but mailing list is not allowing me to send that in mail.


Any suggestion for this behavior


Regards

Sachin

On Thu, May 25, 2023 at 8:50&#8239;PM sachin gupta &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">sachin1.g at gmail.com</A>&gt; wrote:

&gt;<i> Hi All
</I>&gt;<i>
</I>&gt;<i> We are migrating for squid 4.15 to squid 5.9. We are running our existing
</I>&gt;<i> test suite to check if we pass our sanity testing.
</I>&gt;<i>
</I>&gt;<i> For requests in transparent mode, though request passes and client get
</I>&gt;<i> 200, in squid logs we are getting TCP_TUNNEL/500. We were not getting this
</I>&gt;<i> issue with squid 4.15.
</I>&gt;<i>
</I>&gt;<i> *Client logs*
</I>&gt;<i>
</I>&gt;<i> curl -v <A HREF="https://origin/cache/0">https://origin/cache/0</A>
</I>&gt;<i>
</I>&gt;<i> *   Trying 10.80.96.68:443...
</I>&gt;<i>
</I>&gt;<i> * TCP_NODELAY set
</I>&gt;<i>
</I>&gt;<i> * Connected to origin (10.80.96.68) port 443 (#0)
</I>&gt;<i>
</I>&gt;<i> * ALPN, offering h2
</I>&gt;<i>
</I>&gt;<i> * ALPN, offering http/1.1
</I>&gt;<i>
</I>&gt;<i> * Cipher selection:
</I>&gt;<i> ALL:!EXPORT:!EXPORT40:!EXPORT56:!aNULL:!LOW:!RC4:@STRENGTH
</I>&gt;<i>
</I>&gt;<i> * successfully set certificate verify locations:
</I>&gt;<i>
</I>&gt;<i> *   CAfile: /etc/pki/tls/certs/ca-bundle.crt
</I>&gt;<i>
</I>&gt;<i>   CApath: none
</I>&gt;<i>
</I>&gt;<i> * TLSv1.2 (OUT), TLS header, Certificate Status (22):
</I>&gt;<i>
</I>&gt;<i> * TLSv1.2 (OUT), TLS handshake, Client hello (1):
</I>&gt;<i>
</I>&gt;<i> * TLSv1.2 (IN), TLS handshake, Server hello (2):
</I>&gt;<i>
</I>&gt;<i> * TLSv1.2 (IN), TLS handshake, Certificate (11):
</I>&gt;<i>
</I>&gt;<i> * TLSv1.2 (IN), TLS handshake, Server key exchange (12):
</I>&gt;<i>
</I>&gt;<i> * TLSv1.2 (IN), TLS handshake, Server finished (14):
</I>&gt;<i>
</I>&gt;<i> * TLSv1.2 (OUT), TLS handshake, Client key exchange (16):
</I>&gt;<i>
</I>&gt;<i> * TLSv1.2 (OUT), TLS change cipher, Change cipher spec (1):
</I>&gt;<i>
</I>&gt;<i> * TLSv1.2 (OUT), TLS handshake, Finished (20):
</I>&gt;<i>
</I>&gt;<i> * TLSv1.2 (IN), TLS change cipher, Change cipher spec (1):
</I>&gt;<i>
</I>&gt;<i> * TLSv1.2 (IN), TLS handshake, Finished (20):
</I>&gt;<i>
</I>&gt;<i> * SSL connection using TLSv1.2 / ECDHE-RSA-AES256-SHA
</I>&gt;<i>
</I>&gt;<i> * ALPN, server did not agree to a protocol
</I>&gt;<i>
</I>&gt;<i> * Server certificate:
</I>&gt;<i>
</I>&gt;<i> *  subject: C=US; ST=CA; L=SF; O=SFDC;
</I>&gt;<i> OU=0:ns.tester;1:mvp;2:mist51;3:na44;4:dev1; CN=origin
</I>&gt;<i>
</I>&gt;<i> *  start date: Jul 26 06:59:41 2022 GMT
</I>&gt;<i>
</I>&gt;<i> *  expire date: Jul 26 06:59:41 2023 GMT
</I>&gt;<i>
</I>&gt;<i> *  subjectAltName: host &quot;origin&quot; matched cert's &quot;origin&quot;
</I>&gt;<i>
</I>&gt;<i> *  issuer: C=US; ST=CA; L=SF; O=SFDC; OU=Edge; CN=ca
</I>&gt;<i>
</I>&gt;<i> *  SSL certificate verify ok.
</I>&gt;<i>
</I>&gt;<i> &gt; GET /cache/0 HTTP/1.1
</I>&gt;<i>
</I>&gt;<i> &gt; Host: origin
</I>&gt;<i>
</I>&gt;<i> &gt; User-Agent: curl/7.67.0
</I>&gt;<i>
</I>&gt;<i> &gt; Accept: */*
</I>&gt;<i>
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> * Mark bundle as not supporting multiuse
</I>&gt;<i>
</I>&gt;<i> &lt; HTTP/1.1 200 OK
</I>&gt;<i>
</I>&gt;<i> &lt; Server: origin
</I>&gt;<i>
</I>&gt;<i> &lt; Date: Thu, 25 May 2023 15:08:57 GMT
</I>&gt;<i>
</I>&gt;<i> &lt; Connection: close
</I>&gt;<i>
</I>&gt;<i> &lt; Content-Type: application/json
</I>&gt;<i>
</I>&gt;<i> &lt; Content-Length: 162
</I>&gt;<i>
</I>&gt;<i> &lt; Cache-Control: public, max-age=0
</I>&gt;<i>
</I>&gt;<i> &lt; Access-Control-Allow-Origin: *
</I>&gt;<i>
</I>&gt;<i> &lt; Access-Control-Allow-Credentials: true
</I>&gt;<i>
</I>&gt;<i> &lt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> {&quot;args&quot;:{},&quot;headers&quot;:{&quot;Accept&quot;:&quot;*/*&quot;,&quot;Host&quot;:&quot;origin&quot;,&quot;User-Agent&quot;:&quot;curl/7.67.0&quot;,&quot;X-Origin-Server&quot;:&quot;origin&quot;},&quot;origin&quot;:&quot;10.80.96.3&quot;,&quot;url&quot;:&quot;
</I>&gt;<i> <A HREF="https://origin/cache/0">https://origin/cache/0</A>&quot;}
</I>&gt;<i>
</I>&gt;<i> * Closing connection 0
</I>&gt;<i>
</I>&gt;<i> * TLSv1.2 (OUT), TLS alert, close notify (256):
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Squid access logs
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> [25/May/2023:15:08:57]      31 10.80.96.6:51028 - NONE_NONE/000 0 CONNECT
</I>&gt;<i> 10.80.96.68:443 tester HIER_NONE/- - - tester 746573746572 dagobah [-] -
</I>&gt;<i> [-] - [-] - 0 0 - - [origin]
</I>&gt;<i>
</I>&gt;<i> [25/May/2023:15:08:57]     40 10.80.96.6:51028 - *TCP_TUNNEL/500* 800
</I>&gt;<i> CONNECT origin:443 tester HIER_DIRECT/origin 10.80.96.68 - tester
</I>&gt;<i> 746573746572 dagobah [-] - [-] - [-] - 1969 2769 4 33 [origin]
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Can someone please help in this.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Regards
</I>&gt;<i>
</I>&gt;<i> Sachin
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20230526/a875903b/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20230526/a875903b/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="025847.html">[squid-users] TCP_TUNNEL/500 in squid logs in squid 5.9
</A></li>
	<LI>Next message (by thread): <A HREF="025849.html">[squid-users] Proxy server to support a large number of simultaneous requests
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25848">[ date ]</a>
              <a href="thread.html#25848">[ thread ]</a>
              <a href="subject.html#25848">[ subject ]</a>
              <a href="author.html#25848">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
