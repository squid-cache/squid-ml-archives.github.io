<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Https from sibling peers does not work
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Https%20from%20sibling%20peers%20does%20not%20work&In-Reply-To=%3C8783c476-7389-4700-a872-fcb12a03a649%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026287.html">
   <LINK REL="Next"  HREF="026296.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Https from sibling peers does not work</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Https%20from%20sibling%20peers%20does%20not%20work&In-Reply-To=%3C8783c476-7389-4700-a872-fcb12a03a649%40treenet.co.nz%3E"
       TITLE="[squid-users] Https from sibling peers does not work">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon Nov 27 10:29:23 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="026287.html">[squid-users] Https from sibling peers does not work
</A></li>
        <LI>Next message (by thread): <A HREF="026296.html">[squid-users] SSL Virtual Hosting Problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26291">[ date ]</a>
              <a href="thread.html#26291">[ thread ]</a>
              <a href="subject.html#26291">[ subject ]</a>
              <a href="author.html#26291">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 27/11/23 22:38, Mihkel Tammepuu wrote:
&gt;<i> Hello!
</I>&gt;<i> I am trying to set up a sibling cluster of 4 Squid instances. The purpose of the cluster is redundancy AND sharing cache disk space.
</I>

FWIW, if these are running on the same machine you may find SMP workers 
with rock type cache_dir easier to manage and more efficient with the 
caching than a traditional cluster.



&gt;<i> Everything seems to work fine with http, but with https I cannot see requests being forwarded to siblings.
</I>&gt;<i> Interestingly, when using HTCP, the siblings do get HTCP_CLR requests, but not HTCP_TST requests and https content is NOT loaded from sibling even if it&#8217;s clearly present there.
</I>&gt;<i> I&#8217;m of course using SSL Bump, content from origin servers works fine. I&#8217;ve tried Squid 6.5 and 5.9 with same results.
</I>&gt;<i> What might be wrong? Any way to fix it?
</I>&gt;<i> 
</I>
I assume/suspect you have the traditional cache_peer setup without TLS 
between them.

Squid intentionally does not send decrypted HTTPS traffic over non-TLS 
connections. That includes your cache_peer.

Try adding the &quot;tls&quot; option to your cache_peer lines and ensure they all 
use https_port listening in forward-proxy mode to receive that traffic.


If you need more assistance, please show what your config is. We will 
need the specific details of that to see if any other changes are useful 
and/or advise on further troubleshooting.


HTH
Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="026287.html">[squid-users] Https from sibling peers does not work
</A></li>
	<LI>Next message (by thread): <A HREF="026296.html">[squid-users] SSL Virtual Hosting Problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26291">[ date ]</a>
              <a href="thread.html#26291">[ thread ]</a>
              <a href="subject.html#26291">[ subject ]</a>
              <a href="author.html#26291">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
