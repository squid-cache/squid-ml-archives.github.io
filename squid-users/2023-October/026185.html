<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Unable to start Squid 6.3 &quot;earlyMessages-&gt;size() &lt; 1000&quot;
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Unable%20to%20start%20Squid%206.3%20%22earlyMessages-%3Esize%28%29%0A%20%3C%201000%22&In-Reply-To=%3Cf7dd3b91-7624-8cd1-5fea-0d195b2ddf2a%40articatech.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026184.html">
   <LINK REL="Next"  HREF="026186.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Unable to start Squid 6.3 &quot;earlyMessages-&gt;size() &lt; 1000&quot;</H1>
    <B>David Touzeau</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Unable%20to%20start%20Squid%206.3%20%22earlyMessages-%3Esize%28%29%0A%20%3C%201000%22&In-Reply-To=%3Cf7dd3b91-7624-8cd1-5fea-0d195b2ddf2a%40articatech.com%3E"
       TITLE="[squid-users] Unable to start Squid 6.3 &quot;earlyMessages-&gt;size() &lt; 1000&quot;">david at articatech.com
       </A><BR>
    <I>Mon Oct  2 23:12:08 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="026184.html">[squid-users] Unable to start Squid 6.3 &quot;earlyMessages-&gt;size() &lt; 1000&quot;
</A></li>
        <LI>Next message (by thread): <A HREF="026186.html">[squid-users] squid 5.9 Kerberos authentication problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26185">[ date ]</a>
              <a href="thread.html#26185">[ thread ]</a>
              <a href="subject.html#26185">[ subject ]</a>
              <a href="author.html#26185">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thank you, you've enlightened me;
I had the GlobalWhitelistDSTNet directive declared twice in two 
different includes
This meant that an identical Acl declared in two different places would 
contradict each other on the same addresses and generate mass warnings.

On 02/10/2023 22:01, Alex Rousskov wrote:
&gt;<i>
</I>&gt;&gt;<i> Since Squid 6.x we have this strange behavior on acl dst
</I>&gt;&gt;<i> Many warnings is generated
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 2023/10/02 20:18:50| WARNING: You should probably remove 
</I>&gt;&gt;<i> '64.34.72.226' from the ACL named 'GlobalWhitelistDSTNet'
</I>&gt;&gt;<i> 2023/10/02 20:18:50| WARNING: (B) '64.34.72.226' is a subnetwork of 
</I>&gt;&gt;<i> (A) '64.34.72.226'
</I>&gt;&gt;<i> 2023/10/02 20:18:50| WARNING: because of this '64.34.72.226' is 
</I>&gt;&gt;<i> ignored to keep splay tree searching predictable
</I>&gt;<i>
</I>&gt;&gt;<i> (B) '*64.34.72.226*' is a subnetwork of (A) '*64.34.72.226*' --&gt; 
</I>&gt;&gt;<i> Sure, this is the IP address.
</I>&gt;<i>
</I>&gt;<i> Is it possible that you have two 64.34.72.226 entries in that 
</I>&gt;<i> GlobalWhitelistDSTNet ACL? Perhaps in another included configuration 
</I>&gt;<i> file or something like that?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> You should probably remove '64.34.72.226' from the ACL named 
</I>&gt;&gt;<i> 'GlobalWhitelistDSTNet' --&gt; Why this is only the IP address in the 
</I>&gt;&gt;<i> acl ???
</I>&gt;<i>
</I>&gt;<i> Squid thinks that there is more than one copy of 64.34.72.226 address 
</I>&gt;<i> in GlobalWhitelistDSTNet ACL. It could be Squid bug, of course. Please 
</I>&gt;<i> share a configuration that reproduces the issue or a pointer to 
</I>&gt;<i> compressed &quot;squid -N -X -d9 ...&quot; output while reproducing the problem.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;&gt;<i> 2023/10/02 20:20:09| FATAL: assertion failed: debug.cc:606: 
</I>&gt;&gt;&gt;<i> &quot;earlyMessages-&gt;size() &lt; 1000&quot;
</I>&gt;&gt;&gt;<i> Aborted
</I>&gt;<i>
</I>&gt;<i> This assert is a side effect of the above ACL problem/bug - you 
</I>&gt;<i> probably have many IPs in that ACL and the corresponding WARNINGs 
</I>&gt;<i> exceed Squid hard-coded message accumulation limit. Now that we know 
</I>&gt;<i> how a broken(*) configuration can produce so many early cache.log 
</I>&gt;<i> messages, we should probably modify Squid to quit without asserting, 
</I>&gt;<i> but let's focus on the root cause of your problems -- those WARNING 
</I>&gt;<i> messages.
</I>&gt;<i>
</I>&gt;<i> (*) I am not implying that _your_ configuration is broken.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Cheers,
</I>&gt;<i>
</I>&gt;<i> Alex.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> 2023/10/02 20:18:50| WARNING: (B) '64.34.72.230' is a subnetwork of 
</I>&gt;&gt;<i> (A) '64.34.72.230'
</I>&gt;&gt;<i> 2023/10/02 20:18:50| WARNING: because of this '64.34.72.230' is 
</I>&gt;&gt;<i> ignored to keep splay tree searching predictable
</I>&gt;&gt;<i> 2023/10/02 20:18:50| WARNING: You should probably remove 
</I>&gt;&gt;<i> '64.34.72.230' from the ACL named 'GlobalWhitelistDSTNet'
</I>&gt;&gt;<i> 2023/10/02 20:18:50| WARNING: (B) '64.34.72.230' is a subnetwork of 
</I>&gt;&gt;<i> (A) '64.34.72.230'
</I>&gt;&gt;<i> 2023/10/02 20:18:50| WARNING: because of this '64.34.72.230' is 
</I>&gt;&gt;<i> ignored to keep splay tree searching predictable
</I>&gt;&gt;<i> 2023/10/02 20:18:50| WARNING: You should probably remove 
</I>&gt;&gt;<i> '64.34.72.230' from the ACL named 'GlobalWhitelistDSTNet'
</I>&gt;&gt;<i> 2023/10/02 20:18:50| WARNING: (B) '64.34.72.232' is a subnetwork of 
</I>&gt;&gt;<i> (A) '64.34.72.232'
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> According to all warning, Squid won't start with this error
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> *2023/10/02 20:20:09| FATAL: assertion failed: debug.cc:606: 
</I>&gt;&gt;<i> &quot;earlyMessages-&gt;size() &lt; 1000&quot;**
</I>&gt;&gt;<i> **Aborted*
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> How to avoid this ??
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> -- 
</I>&gt;&gt;<i> David Touzeau - Artica Tech France
</I>&gt;&gt;<i> Development team, level 3 support
</I>&gt;&gt;<i> ----------------------------------
</I>&gt;&gt;<i> P: +33 6 58 44 69 46
</I>&gt;&gt;<i> www:<A HREF="https://wiki.articatech.com">https://wiki.articatech.com</A>
</I>&gt;&gt;<i> www:<A HREF="http://articatech.net">http://articatech.net</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</I>
-- 
David Touzeau - Artica Tech France
Development team, level 3 support
----------------------------------
P: +33 6 58 44 69 46
www:<A HREF="https://wiki.articatech.com">https://wiki.articatech.com</A>
www:<A HREF="http://articatech.net">http://articatech.net</A>  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20231003/9b33eb27/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20231003/9b33eb27/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="026184.html">[squid-users] Unable to start Squid 6.3 &quot;earlyMessages-&gt;size() &lt; 1000&quot;
</A></li>
	<LI>Next message (by thread): <A HREF="026186.html">[squid-users] squid 5.9 Kerberos authentication problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26185">[ date ]</a>
              <a href="thread.html#26185">[ thread ]</a>
              <a href="subject.html#26185">[ subject ]</a>
              <a href="author.html#26185">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
