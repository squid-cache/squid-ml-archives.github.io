<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid 5.9 Kerberos authentication problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%205.9%20Kerberos%20authentication%20problem&In-Reply-To=%3Ce7b203ed-a893-464b-a615-bc9e97a28ccf%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026186.html">
   <LINK REL="Next"  HREF="026188.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid 5.9 Kerberos authentication problem</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%205.9%20Kerberos%20authentication%20problem&In-Reply-To=%3Ce7b203ed-a893-464b-a615-bc9e97a28ccf%40treenet.co.nz%3E"
       TITLE="[squid-users] squid 5.9 Kerberos authentication problem">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Oct  5 12:58:37 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="026186.html">[squid-users] squid 5.9 Kerberos authentication problem
</A></li>
        <LI>Next message (by thread): <A HREF="026188.html">[squid-users] squid 5.9 Kerberos authentication problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26187">[ date ]</a>
              <a href="thread.html#26187">[ thread ]</a>
              <a href="subject.html#26187">[ subject ]</a>
              <a href="author.html#26187">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 5/10/23 19:30, Ludovit Koren wrote:
&gt;<i> 
</I>&gt;<i> Hello,
</I>&gt;<i> 
</I>&gt;<i> I am using squid 5.9 with AD Kerberos authentication and could not solve
</I>&gt;<i> the problem of sending incorrect request according to client
</I>&gt;<i> configuration followed by the correct one, i.e.:
</I>&gt;<i> 
</I>&gt;<i> 1695983264.808      0 x.y.z TCP_DENIED/407 4135 CONNECT th.bing.com:443 - HIER_NONE/- text/html
</I>&gt;<i> 1695983264.834     21 x.y.z TCP_TUNNEL/200 6080 CONNECT th.bing.com:443 <A HREF="https://lists.squid-cache.org/listinfo/squid-users">name at domain</A> FIRSTUP_PARENT/squid-parent -
</I>&gt;<i> 
</I>
This looks fine to me. The first request is sent without credentials, 
then the second contains the correct ones using the correct 
authentication scheme.

TL;DR ... I would only be worried if there were sequences 2+ of these 
407 before the final 200 status.


CONNECT tunnels are typically opened on a brand new TCP connection. Also 
the Negotiate authentication scheme used for Kerberos requires a unique 
token per-connection which is only received in the first HTTP response 
from Squid to client. Meaning the full 2-stage authentication process is 
needed every time for it to figure out how it is supposed to 
authenticate on that TCP connection.

Compared to other HTTP requests which often re-use an already 
authenticated TCP connection. So they get away with assuming the offered 
authentication schemes, and/or Kerberos token, will remain unchanged. 
Allowing the negotiation stage to be skipped.


If you are worried; you can try running the testing/troubleshooting 
checks detailed at 
&lt;<A HREF="https://wiki.squid-cache.org/Features/NegotiateAuthentication#testing">https://wiki.squid-cache.org/Features/NegotiateAuthentication#testing</A>&gt;


&gt;<i> There are some web servers which are not working even when the correct
</I>&gt;<i> request follows afterwards.
</I>&gt;<i> 
</I>
The TCP connection between client and Squid is different (and 
independent) from the TCP connections between Squid and servers.
The authentication you are using is only between client and Squid, it 
has nothing to do with web servers.


Cheers
Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="026186.html">[squid-users] squid 5.9 Kerberos authentication problem
</A></li>
	<LI>Next message (by thread): <A HREF="026188.html">[squid-users] squid 5.9 Kerberos authentication problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26187">[ date ]</a>
              <a href="thread.html#26187">[ thread ]</a>
              <a href="subject.html#26187">[ subject ]</a>
              <a href="author.html#26187">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
