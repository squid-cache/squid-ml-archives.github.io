<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Fwd: Squid does not pass HTTPS traffic transparently
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Fwd%3A%20Squid%20does%20not%20pass%20HTTPS%20traffic%20transparently&In-Reply-To=%3CCAPO8noLawUvm4vBHEWd1yYuTOKg-TbnErad_6j2Oh3y6tpkA6A%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026208.html">
   <LINK REL="Next"  HREF="026205.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Fwd: Squid does not pass HTTPS traffic transparently</H1>
    <B>Bud Miljkovic</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Fwd%3A%20Squid%20does%20not%20pass%20HTTPS%20traffic%20transparently&In-Reply-To=%3CCAPO8noLawUvm4vBHEWd1yYuTOKg-TbnErad_6j2Oh3y6tpkA6A%40mail.gmail.com%3E"
       TITLE="[squid-users] Fwd: Squid does not pass HTTPS traffic transparently">bud_miljkovic at trimble.com
       </A><BR>
    <I>Mon Oct 16 03:41:30 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="026208.html">[squid-users] very poor performance of rock cache ipc
</A></li>
        <LI>Next message (by thread): <A HREF="026205.html">[squid-users] Transparent HTTPS Squid proxy does not work!
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26204">[ date ]</a>
              <a href="thread.html#26204">[ thread ]</a>
              <a href="subject.html#26204">[ subject ]</a>
              <a href="author.html#26204">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Resending it without an image

On Mon, Oct 16, 2023 at 1:59&#8239;PM Bud Miljkovic &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">bud_miljkovic at trimble.com</A>&gt;
wrote:

&gt;<i> Here is my system configuration
</I>&gt;<i>
</I>-
&gt;<i> The setup and the problem
</I>&gt;<i>
</I>&gt;<i>    - The HW box tries to establish an HTTPS transparent connection with a
</I>&gt;<i>    server located within Internet.
</I>&gt;<i>    - It uses the Local Server and send its request via eth0 interface.
</I>&gt;<i>    - The request is Pre-routed from eth0, port 443, to the Transparent
</I>&gt;<i>    Squid proxy (v3.5.25), listening at port 3129.
</I>&gt;<i>    - For testing purposes, the Squid proxy is configured to pass only the
</I>&gt;<i>    HTTPStraffic transparently via the eth1 interface, using sing the
</I>&gt;<i>    `tcp_outgoing_address &lt;ip_addr&gt;` directive.  Please see the attached
</I>&gt;<i>    squid-ota.conf file.
</I>&gt;<i>    - While testing, I am monitoring the eth1 output via tcpdump and I get
</I>&gt;<i>    the following:
</I>&gt;<i>    # tcpdump -i eth1 port 443 -n -X -q
</I>&gt;<i>    tcpdump: verbose output suppressed, use -v or -vv for full protocol
</I>&gt;<i>    decode
</I>&gt;<i>    listening on eth1, link-type EN10MB (Ethernet), capture size 262144
</I>&gt;<i>    bytes
</I>&gt;<i>    -  But nothing is detected!?
</I>&gt;<i>    - From the above it appears that there is no an eth1 output at port
</I>&gt;<i>    443?
</I>&gt;<i>
</I>&gt;<i> I have attached the printouts of the `iptables -nvL` and `iptables -nvL -t
</I>&gt;<i> nat`
</I>&gt;<i>  commands.
</I>&gt;<i>
</I>&gt;<i> Can someone check ut what I have done here and perhaps suggest what could
</I>&gt;<i> be
</I>&gt;<i> wrong in here.
</I>&gt;<i>
</I>&gt;<i> Cheers,
</I>&gt;<i> Bud
</I>&gt;<i> --
</I>&gt;<i> Budimir Miljkovi&#263; BSc E | He
</I>&gt;<i> Senior Development Engineer
</I>&gt;<i> Civil Construction Field Systems
</I>&gt;<i> Trimble
</I>&gt;<i>
</I>&gt;<i> 11-17 Birmingham Drive, Christchurch, Canterbury, 8024
</I>&gt;<i> New Zealand
</I>&gt;<i> +64 3 963-5550 Direct
</I>&gt;<i> +64 21 419-024 Mobile
</I>&gt;<i>
</I>&gt;<i> www.trimble.com
</I>&gt;<i>
</I>&gt;<i> This email may contain confidential information that is intended only for
</I>&gt;<i> the listed recipient(s) of this email. Any unauthorized review, use,
</I>&gt;<i> disclosure or distribution is prohibited. If you believe you have received
</I>&gt;<i> this email in error, please immediately delete this email and any
</I>&gt;<i> attachments, and inform me via reply email.
</I>&gt;<i>
</I>

-- 
Budimir Miljkovi&#263; BSc E | He
Senior Development Engineer
Civil Construction Field Systems
Trimble

11-17 Birmingham Drive, Christchurch, Canterbury, 8024
New Zealand
+64 3 963-5550 Direct
+64 21 419-024 Mobile

www.trimble.com

This email may contain confidential information that is intended only for
the listed recipient(s) of this email. Any unauthorized review, use,
disclosure or distribution is prohibited. If you believe you have received
this email in error, please immediately delete this email and any
attachments, and inform me via reply email.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20231016/b3de9138/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20231016/b3de9138/attachment.htm</A>&gt;
-------------- next part --------------
Chain INPUT (policy DROP 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination         
 8827  680K ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            ctstate RELATED,ESTABLISHED
    7   438 ACCEPT     icmp --  *      *       0.0.0.0/0            0.0.0.0/0            icmptype 8 ctstate NEW
    2   138 ACCEPT     all  --  lo     *       0.0.0.0/0            0.0.0.0/0           
    0     0 DROP       all  --  *      *       0.0.0.0/0            0.0.0.0/0            ctstate INVALID
1218K  299M APP_RULES  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ctstate NEW
1218K  299M OS_RULES   all  --  *      *       0.0.0.0/0            0.0.0.0/0            ctstate NEW
  134 28053 REJECT     udp  --  *      *       0.0.0.0/0            0.0.0.0/0            reject-with icmp-port-unreachable
14014  841K REJECT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            reject-with tcp-reset
    0     0 REJECT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            reject-with icmp-proto-unreachable

Chain FORWARD (policy DROP 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            ctstate RELATED,ESTABLISHED
    0     0 ACCEPT     all  --  wlan1  wlan1   0.0.0.0/0            0.0.0.0/0           
    9   559 REJECT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            reject-with icmp-host-unreachable

Chain OUTPUT (policy ACCEPT 39073 packets, 2757K bytes)
 pkts bytes target     prot opt in     out     source               destination         
  125 11932 ACCEPT     all  --  *      *       10.3.19.92           0.0.0.0/0           

Chain APP_RULES (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 ACCEPT     tcp  --  eth1   *       0.0.0.0/0            0.0.0.0/0            tcp dpt:20
    0     0 ACCEPT     tcp  --  eth1   *       0.0.0.0/0            0.0.0.0/0            tcp dpt:21
    0     0 ACCEPT     tcp  --  eth1   *       0.0.0.0/0            0.0.0.0/0            tcp dpt:80

Chain DEV_RULES (2 references)
 pkts bytes target     prot opt in     out     source               destination         
    5   300 ACCEPT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            tcp dpt:22
    0     0 ACCEPT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            tcp dpt:1534
    0     0 ACCEPT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            tcp dpt:2345
    0     0 ACCEPT     udp  --  *      *       0.0.0.0/0            0.0.0.0/0            udp dpt:1534
    0     0 ACCEPT     udp  --  *      *       0.0.0.0/0            0.0.0.0/0            udp dpt:2345

Chain EXTERNAL_RULES (2 references)
 pkts bytes target     prot opt in     out     source               destination         
1190K  298M DROP       all  --  *      *       0.0.0.0/0            0.0.0.0/0           

Chain INTERNAL_RULES (2 references)
 pkts bytes target     prot opt in     out     source               destination         
13930  794K ACCEPT     udp  --  *      *       0.0.0.0/0            0.0.0.0/0            udp dpt:53
    8  2540 ACCEPT     udp  --  *      *       0.0.0.0/0            0.0.0.0/0            udp dpt:67
    1   328 ACCEPT     udp  --  *      *       0.0.0.0/0            0.0.0.0/0            udp dpt:68
    0     0 ACCEPT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            tcp dpt:80

Chain OS_RULES (1 references)
 pkts bytes target     prot opt in     out     source               destination         
28092 1666K DEV_RULES  all  --  eth0   *       0.0.0.0/0            0.0.0.0/0           
    0     0 DEV_RULES  all  --  wlan1  *       0.0.0.0/0            0.0.0.0/0           
28087 1666K INTERNAL_RULES  all  --  eth0   *       0.0.0.0/0            0.0.0.0/0           
    0     0 INTERNAL_RULES  all  --  wlan1  *       0.0.0.0/0            0.0.0.0/0           
1190K  298M EXTERNAL_RULES  all  --  eth1   *       0.0.0.0/0            0.0.0.0/0           
    0     0 EXTERNAL_RULES  all  --  wlan0  *       0.0.0.0/0            0.0.0.0/0           

-------------- next part --------------
Chain PREROUTING (policy ACCEPT 1234K packets, 306M bytes)
 pkts bytes target     prot opt in     out     source               destination         
   96  5760 REDIRECT   tcp  --  eth0   *       0.0.0.0/0            0.0.0.0/0            tcp dpt:443 redir ports 3129
13943  837K REDIRECT   tcp  --  eth0   *       0.0.0.0/0            0.0.0.0/0            tcp dpt:80 redir ports 3128

Chain INPUT (policy ACCEPT 13972 packets, 798K bytes)
 pkts bytes target     prot opt in     out     source               destination         

Chain OUTPUT (policy ACCEPT 62 packets, 4650 bytes)
 pkts bytes target     prot opt in     out     source               destination         

Chain POSTROUTING (policy ACCEPT 14103 packets, 566K bytes)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 MASQUERADE  all  --  *      eth1    192.168.168.0/24     0.0.0.0/0           
    0     0 MASQUERADE  all  --  *      eth1    192.168.192.0/24     0.0.0.0/0           
    0     0 MASQUERADE  all  --  *      wlan0   192.168.168.0/24     0.0.0.0/0           
    0     0 MASQUERADE  all  --  *      wlan0   192.168.192.0/24     0.0.0.0/0           

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="026208.html">[squid-users] very poor performance of rock cache ipc
</A></li>
	<LI>Next message (by thread): <A HREF="026205.html">[squid-users] Transparent HTTPS Squid proxy does not work!
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26204">[ date ]</a>
              <a href="thread.html#26204">[ thread ]</a>
              <a href="subject.html#26204">[ subject ]</a>
              <a href="author.html#26204">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
