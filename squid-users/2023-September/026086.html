<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20BUG%3A%20assurance%20failed%3A%0A%20tok.skip%28WellKnownUrlPathPrefix%28%29%29&In-Reply-To=%3Cd42a6203-ca8d-4964-b3da-16f9479e17e9%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026085.html">
   <LINK REL="Next"  HREF="026087.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20BUG%3A%20assurance%20failed%3A%0A%20tok.skip%28WellKnownUrlPathPrefix%28%29%29&In-Reply-To=%3Cd42a6203-ca8d-4964-b3da-16f9479e17e9%40measurement-factory.com%3E"
       TITLE="[squid-users] Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Sep 12 14:48:00 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="026085.html">[squid-users] Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
</A></li>
        <LI>Next message (by thread): <A HREF="026087.html">[squid-users] Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26086">[ date ]</a>
              <a href="thread.html#26086">[ thread ]</a>
              <a href="subject.html#26086">[ subject ]</a>
              <a href="author.html#26086">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2023-09-12 10:21, Lou&#269;ansk&#253; Luk&#225;&#353; wrote:
&gt;<i> today I was going to compile a new version of my beloved squid 
</I>&gt;<i> proxy (v6.3 or 6.3-20230903-ra9c06aa6a)
</I>
FWIW, &quot;was going to compile&quot; part does not make it clear (to me) whether 
you did actually compile/test v6.3.


&gt;<i> just to be welcomed by non 
</I>&gt;<i> working older configmgr.cgi and [debian package installed] squidclient 
</I>&gt;<i> (v4.6). After replacing squidclient with (compiled with squid) version 
</I>&gt;<i> 6.3 it's still not working, giving me accesss denied page.
</I>&gt;<i> 
</I>&gt;<i> My cache.log contains these bug info lines:
</I>&gt;<i> 
</I>&gt;<i> 023/09/12 16:07:03 kid3| ERROR: Squid BUG: assurance failed: 
</I>&gt;<i> tok.skip(WellKnownUrlPathPrefix())
</I>&gt;<i>  &#160;&#160;&#160; exception location: cache_manager.cc(193) ParseUrl
</I>

If the above output is from Squid v6.3, then you may have found a v6.3 
problem that we do not know about. Please share the HTTP request that 
triggers the above output.

Otherwise, please try to upgrade to Squid v6.3 because its commit 
6695897 is meant to fix a v6.1 bug with the above symptoms.


Thank you,

Alex.


&gt;<i>  &#160;&#160;&#160; current master transaction: master469155
</I>&gt;<i> 2023/09/12 16:07:03 kid3| ERROR: Squid BUG: assurance failed: 
</I>&gt;<i> tok.skip(WellKnownUrlPathPrefix())
</I>&gt;<i>  &#160;&#160;&#160; exception location: cache_manager.cc(193) ParseUrl
</I>&gt;<i>  &#160;&#160;&#160; current master transaction: master469155
</I>&gt;<i> 
</I>&gt;<i> In the file src/cache_manager.cc there is this
</I>&gt;<i> 
</I>&gt;<i> const SBuf &amp;
</I>&gt;<i> CacheManager::WellKnownUrlPathPrefix()
</I>&gt;<i> {
</I>&gt;<i>  &#160;&#160;&#160; static const SBuf prefix(&quot;/squid-internal-mgr/&quot;);
</I>&gt;<i>  &#160;&#160;&#160; return prefix;
</I>&gt;<i> }
</I>&gt;<i> 
</I>&gt;<i> and on the line 193 is this assure (after tok tokenizer)
</I>&gt;<i> 
</I>&gt;<i>  &#160;Parser::Tokenizer tok(uri.path());
</I>&gt;<i> 
</I>&gt;<i>  &#160;&#160;&#160; Assure(tok.skip(WellKnownUrlPathPrefix()));
</I>&gt;<i> 
</I>&gt;<i> Is there something wrong with my config I should change after 6.2 to 6.3 
</I>&gt;<i> upgrade? I have some classic http_access manager allow ... and 
</I>&gt;<i> http_access manager deny lines. No definition what [acl] manager means.
</I>&gt;<i> 
</I>&gt;<i> I have found some mentions here 
</I>&gt;<i> <A HREF="https://github.com/squid-cache/squid/blob/master/ChangeLog">https://github.com/squid-cache/squid/blob/master/ChangeLog</A> and somewhere 
</I>&gt;<i> inside the commit / review git hub section for squid. But nothing says 
</I>&gt;<i> what to do make it work right. Besides this it seems squid as a proxy 
</I>&gt;<i> works fine...
</I>&gt;<i> 
</I>&gt;<i> Thanks
</I>&gt;<i> 
</I>&gt;<i> Lukas
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="026085.html">[squid-users] Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
</A></li>
	<LI>Next message (by thread): <A HREF="026087.html">[squid-users] Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26086">[ date ]</a>
              <a href="thread.html#26086">[ thread ]</a>
              <a href="subject.html#26086">[ subject ]</a>
              <a href="author.html#26086">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
