<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20BUG%3A%20assurance%20failed%3A%0A%20tok.skip%28WellKnownUrlPathPrefix%28%29%29&In-Reply-To=%3C72DD5D5CF661B5459DC08A060BF26B53C45E64%40kjj-server.KJJ.local%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026087.html">
   <LINK REL="Next"  HREF="026089.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())</H1>
    <B>Lou&#269;ansk&#253; Luk&#225;&#353;</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20BUG%3A%20assurance%20failed%3A%0A%20tok.skip%28WellKnownUrlPathPrefix%28%29%29&In-Reply-To=%3C72DD5D5CF661B5459DC08A060BF26B53C45E64%40kjj-server.KJJ.local%3E"
       TITLE="[squid-users] Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())">Loucansky.Lukas at kjj.cz
       </A><BR>
    <I>Tue Sep 12 17:06:12 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="026087.html">[squid-users] Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
</A></li>
        <LI>Next message (by thread): <A HREF="026089.html">[squid-users] Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26088">[ date ]</a>
              <a href="thread.html#26088">[ thread ]</a>
              <a href="subject.html#26088">[ subject ]</a>
              <a href="author.html#26088">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Is this anyhow interesting?

2023/09/12 18:47:04.267 kid4| 24,8| SBuf.cc(30) SBuf: SBuf15514952 created
2023/09/12 18:47:04.267 kid4| 24,8| SBuf.cc(30) SBuf: SBuf15514953 created
2023/09/12 18:47:04.267 kid4| 24,8| SBuf.cc(30) SBuf: SBuf15514954 created
2023/09/12 18:47:04.267 kid4| 24,7| SBuf.cc(85) assign: assigning SBuf15514952 from SBuf15514912
2023/09/12 18:47:04.267 kid4| 24,8| SBuf.cc(38) SBuf: SBuf15514955 created from id SBuf15514915
2023/09/12 18:47:04.267 kid4| 24,8| SBuf.cc(445) startsWith: SBuf15514955 startsWith SBuf125812, caseSensitive: 0
2023/09/12 18:47:04.267 kid4| 24,8| SBuf.cc(447) startsWith: no, too short
2023/09/12 18:47:04.267 kid4| 24,8| Tokenizer.cc(185) skip: no match, not skipping '/squid-internal-mgr/'
2023/09/12 18:47:04 kid4| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 18:47:04.268 kid4| 24,8| SBuf.cc(70) ~SBuf: SBuf15514955 destructed


BTW debug 24,9 makes pretty big log files... :-)

L

-----P&#367;vodn&#237; zpr&#225;va-----
Od: squid-users za u&#382;ivatele Lou&#269;ansk&#253; Luk&#225;&#353;
Odesl&#225;no: &#250;t 12.9.2023 18:23
Komu: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
P&#345;edm&#283;t: Re: [squid-users] Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
 
Hello Alex - here is the output of squid -v command:

squid -v
Squid Cache: Version 6.3-20230903-ra9c06aa6a
Service Name: squid
no IPV6

This binary uses OpenSSL 1.1.1n  15 Mar 2022. For legal restrictions on distribution see <A HREF="https://www.openssl.org/source/license.html">https://www.openssl.org/source/license.html</A>

configure options:  '--build=x86_64-linux-gnu' '--prefix=/usr' '--includedir=/include' '--mandir=/share/man' '--infodir=/share/info' '--sysconfdir=/etc' '--localstatedir=/var' '--libexecdir=/lib/squid5' '--disable-maintainer-mode' '--disable-silent-rules' '--datadir=/usr/share/squid5' '--sysconfdir=/etc/squid5' '--mandir=/usr/share/man' '--enable-build-info=no IPV6' '--enable-inline' '--enable-arp-acl' '--disable-wccp' '--disable-wccp2' '--disable-htcp--disable-arch-native' '--disable-ipv6' '--enable-optimizations' '--enable-storeio=ufs,aufs,diskd,rock' '--enable-removal-policies=lru,heap' '--enable-delay-pools' '--enable-cache-digests' '--enable-icap-client' '--enable-follow-x-forwarded-for' '--enable-auth-basic=DB,fake,getpwnam,LDAP,NCSA,NIS,PAM,POP3,RADIUS,SASL,SMB' '--enable-auth-digest=file,LDAP' '--enable-auth-negotiate=kerberos,wrapper' '--enable-auth-ntlm=fake,SMB_LM' '--enable-external-acl-helpers=file_userip,kerberos_ldap_group,LDAP_group,session,SQL_session,time_quota,unix_group,wbinfo_group' '--enable-url-rewrite-helpers=fake' '--enable-security-cert-validators=fake' '--enable-storeid-rewrite-helpers=file' '--enable-eui' '--enable-esi' '--enable-icmp' '--enable-zph-qos' '--enable-ecap' '--enable-snmp' '--disable-ident-lookups' '--disable-translation' '--with-swapdir=/var/spool/squid5' '--with-logdir=/var/log/squid5' '--with-pidfile=/var/run/squid5.pid' '--with-large-files' '--with-default-user=proxy' '--with-openssl' '--with-filedescriptors=8192' '--enable-ssl-crtd' '--enable-security-cert-generators' '--enable-security-cert-validators' '--enable-linux-netfilter' '--enable-stacktraces' 'PKG_CONFIG_PATH=:/usr/local/lib/pkgconfig:/usr/lib64/pkgconfig:/usr/share/pkgconfig' 'CFLAGS=-g -O2 -m64 -fPIE -fstack-protector-strong -Wformat -Werror=format-security -Wall' 'LDFLAGS=-fPIE -pie -Wl,-z,relro -Wl,-z,now' 'CPPFLAGS=-D_FORTIFY_SOURCE=2' 'CXXFLAGS=-g -O2 -m64 -fPIE -fstack-protector-strong -Wformat -Werror=format-security' 'build_alias=x86_64-linux-gnu'

Please note two things - I was using 5.x branch for some time (ie. squid5 prefix) and lately did upgrade to 6.x as the developers said 5.x is EOL/not maintained, I do not have native ipv6 so I had some tun6to4 tunel to closed broker - so now I do not have ipv6 connectivity. So I decided to set --disable-ipv6 for now.

I have gcc
 gcc -v
Using built-in specs.
COLLECT_GCC=gcc
COLLECT_LTO_WRAPPER=/usr/lib/gcc/x86_64-linux-gnu/8/lto-wrapper
OFFLOAD_TARGET_NAMES=nvptx-none
OFFLOAD_TARGET_DEFAULT=1
Target: x86_64-linux-gnu
Configured with: ../src/configure -v --with-pkgversion='Debian 8.3.0-6' --with-bugurl=<A HREF="file:///usr/share/doc/gcc-8/README.Bugs">file:///usr/share/doc/gcc-8/README.Bugs</A> --enable-languages=c,ada,c++,go,brig,d,fortran,objc,obj-c++ --prefix=/usr --with-gcc-major-version-only --program-suffix=-8 --program-prefix=x86_64-linux-gnu- --enable-shared --enable-linker-build-id --libexecdir=/usr/lib --without-included-gettext --enable-threads=posix --libdir=/usr/lib --enable-nls --enable-bootstrap --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --with-default-libstdcxx-abi=new --enable-gnu-unique-object --disable-vtable-verify --enable-libmpx --enable-plugin --enable-default-pie --with-system-zlib --with-target-system-zlib --enable-objc-gc=auto --enable-multiarch --disable-werror --with-arch-32=i686 --with-abi=m64 --with-multilib-list=m32,m64,mx32 --enable-multilib --with-tune=generic --enable-offload-targets=nvptx-none --without-cuda-driver --enable-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu
Thread model: posix
gcc version 8.3.0 (Debian 8.3.0-6)

with Debian 10 x64

LL


-----P&#367;vodn&#237; zpr&#225;va-----
Od: squid-users za u&#382;ivatele Alex Rousskov
Odesl&#225;no: &#250;t 12.9.2023 16:48
Komu: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
P&#345;edm&#283;t: Re: [squid-users] Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
 
On 2023-09-12 10:21, Lou&#269;ansk&#253; Luk&#225;&#353; wrote:
&gt;<i> today I was going to compile a new version of my beloved squid 
</I>&gt;<i> proxy (v6.3 or 6.3-20230903-ra9c06aa6a)
</I>
FWIW, &quot;was going to compile&quot; part does not make it clear (to me) whether 
you did actually compile/test v6.3.


&gt;<i> just to be welcomed by non 
</I>&gt;<i> working older configmgr.cgi and [debian package installed] squidclient 
</I>&gt;<i> (v4.6). After replacing squidclient with (compiled with squid) version 
</I>&gt;<i> 6.3 it's still not working, giving me accesss denied page.
</I>&gt;<i> 
</I>&gt;<i> My cache.log contains these bug info lines:
</I>&gt;<i> 
</I>&gt;<i> 023/09/12 16:07:03 kid3| ERROR: Squid BUG: assurance failed: 
</I>&gt;<i> tok.skip(WellKnownUrlPathPrefix())
</I>&gt;<i>  &#160;&#160;&#160; exception location: cache_manager.cc(193) ParseUrl
</I>

If the above output is from Squid v6.3, then you may have found a v6.3 
problem that we do not know about. Please share the HTTP request that 
triggers the above output.

Otherwise, please try to upgrade to Squid v6.3 because its commit 
6695897 is meant to fix a v6.1 bug with the above symptoms.


Thank you,

Alex.


&gt;<i>  &#160;&#160;&#160; current master transaction: master469155
</I>&gt;<i> 2023/09/12 16:07:03 kid3| ERROR: Squid BUG: assurance failed: 
</I>&gt;<i> tok.skip(WellKnownUrlPathPrefix())
</I>&gt;<i>  &#160;&#160;&#160; exception location: cache_manager.cc(193) ParseUrl
</I>&gt;<i>  &#160;&#160;&#160; current master transaction: master469155
</I>&gt;<i> 
</I>&gt;<i> In the file src/cache_manager.cc there is this
</I>&gt;<i> 
</I>&gt;<i> const SBuf &amp;
</I>&gt;<i> CacheManager::WellKnownUrlPathPrefix()
</I>&gt;<i> {
</I>&gt;<i>  &#160;&#160;&#160; static const SBuf prefix(&quot;/squid-internal-mgr/&quot;);
</I>&gt;<i>  &#160;&#160;&#160; return prefix;
</I>&gt;<i> }
</I>&gt;<i> 
</I>&gt;<i> and on the line 193 is this assure (after tok tokenizer)
</I>&gt;<i> 
</I>&gt;<i>  &#160;Parser::Tokenizer tok(uri.path());
</I>&gt;<i> 
</I>&gt;<i>  &#160;&#160;&#160; Assure(tok.skip(WellKnownUrlPathPrefix()));
</I>&gt;<i> 
</I>&gt;<i> Is there something wrong with my config I should change after 6.2 to 6.3 
</I>&gt;<i> upgrade? I have some classic http_access manager allow ... and 
</I>&gt;<i> http_access manager deny lines. No definition what [acl] manager means.
</I>&gt;<i> 
</I>&gt;<i> I have found some mentions here 
</I>&gt;<i> <A HREF="https://github.com/squid-cache/squid/blob/master/ChangeLog">https://github.com/squid-cache/squid/blob/master/ChangeLog</A> and somewhere 
</I>&gt;<i> inside the commit / review git hub section for squid. But nothing says 
</I>&gt;<i> what to do make it work right. Besides this it seems squid as a proxy 
</I>&gt;<i> works fine...
</I>&gt;<i> 
</I>&gt;<i> Thanks
</I>&gt;<i> 
</I>&gt;<i> Lukas
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</I>
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>




-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20230912/2985ad5f/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20230912/2985ad5f/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="026087.html">[squid-users] Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
</A></li>
	<LI>Next message (by thread): <A HREF="026089.html">[squid-users] Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26088">[ date ]</a>
              <a href="thread.html#26088">[ thread ]</a>
              <a href="subject.html#26088">[ subject ]</a>
              <a href="author.html#26088">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
