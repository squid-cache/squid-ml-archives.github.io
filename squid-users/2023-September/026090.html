<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20BUG%3A%20assurance%20failed%3A%0A%20tok.skip%28WellKnownUrlPathPrefix%28%29%29&In-Reply-To=%3C72DD5D5CF661B5459DC08A060BF26B53C45E66%40kjj-server.KJJ.local%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026089.html">
   <LINK REL="Next"  HREF="026093.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())</H1>
    <B>Lou&#269;ansk&#253; Luk&#225;&#353;</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20BUG%3A%20assurance%20failed%3A%0A%20tok.skip%28WellKnownUrlPathPrefix%28%29%29&In-Reply-To=%3C72DD5D5CF661B5459DC08A060BF26B53C45E66%40kjj-server.KJJ.local%3E"
       TITLE="[squid-users] Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())">Loucansky.Lukas at kjj.cz
       </A><BR>
    <I>Tue Sep 12 19:50:42 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="026089.html">[squid-users] Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
</A></li>
        <LI>Next message (by thread): <A HREF="026093.html">[squid-users] Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26090">[ date ]</a>
              <a href="thread.html#26090">[ thread ]</a>
              <a href="subject.html#26090">[ subject ]</a>
              <a href="author.html#26090">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Well there seems to be some recurring pattern of behaviour:

grep tok.skip cache.log


2023/09/12 19:12:03 kid4| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 19:12:03 kid3| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 19:12:03 kid4| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 19:12:03 kid4| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 19:12:04 kid4| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())

2023/09/12 19:17:03 kid4| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 19:17:03 kid4| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 19:17:04 kid4| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 19:17:04 kid3| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 19:17:04 kid4| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())

2023/09/12 19:22:04 kid3| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 19:22:04 kid2| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 19:22:04 kid3| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 19:22:04 kid3| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 19:22:04 kid4| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())

2023/09/12 19:27:04 kid4| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 19:27:04 kid4| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 19:27:04 kid4| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 19:27:04 kid3| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 19:27:04 kid3| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())

2023/09/12 19:32:04 kid2| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 19:32:04 kid3| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 19:32:04 kid4| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 19:32:04 kid2| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 19:32:04 kid3| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())

2023/09/12 19:37:03 kid2| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 19:37:03 kid4| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 19:37:03 kid4| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 19:37:03 kid4| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 19:37:03 kid3| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())

2023/09/12 19:42:03 kid4| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 19:42:03 kid4| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 19:42:03 kid4| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 19:42:03 kid4| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 19:42:03 kid2| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())

2023/09/12 19:47:04 kid3| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 19:47:04 kid3| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 19:47:04 kid3| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 19:47:04 kid2| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 19:47:04 kid3| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())

2023/09/12 19:52:04 kid3| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 19:52:04 kid3| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 19:52:04 kid4| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 19:52:04 kid4| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 19:52:04 kid4| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())

and the same 5 lines at these times:
2023/09/12 19:57:03 kid3| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 20:02:03 kid4| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 20:07:03 kid4| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 20:12:03 kid2| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 20:17:03 kid2| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 20:22:03 kid1| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 20:27:04 kid4| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 20:32:03 kid3| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 20:37:04 kid3| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 20:42:03 kid2| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 20:47:03 kid3| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 20:52:04 kid4| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
2023/09/12 20:57:03 kid3| ERROR: Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())

So we can see it's occurring every 5mins at the same time, every time 5 occurrences. I suppose this is caused by my mrtg script calling squidclient exactly 5 times (to get number of used fd, max currently use fd, mean object size and number of store entries + store entries in memory). 

So, put this aside as the script (running on another computer) uses older squidclient.  I call it like this:
squidclient -h squid_ip -p squid_port -vv mgr:info

Request:
GET cache_<A HREF="object://squid_ip/info">object://squid_ip/info</A> HTTP/1.0
Host: squid_ip
User-Agent: squidclient/4.6
Accept: */*
Connection: close

Sending HTTP request ...
done.
HTTP/1.1 404 Not Found
Server: squid
Mime-Version: 1.0
Date: Tue, 12 Sep 2023 19:09:41 GMT
Content-Type: text/html;charset=utf-8
Content-Length: 13057
X-Squid-Error: ERR_INVALID_URL 0
Cache-Status: proxy;detail=no-cache
Via: 1.1 proxy (squid)
Connection: close

This is obviously calling for url cache_<A HREF="object://squid_ip/info">object://squid_ip/info</A> which I think is obsolete. Now I went with the new squidclient:

./squidclient -h squid_ip -p squid_port -vv mgr:info

Request:
GET <A HREF="http://squid_ip:squid_port/squid-internal-mgr/info">http://squid_ip:squid_port/squid-internal-mgr/info</A> HTTP/1.0
Host: 10.50.1.5:3127
User-Agent: squidclient/6.3
Accept: */*
Connection: close

But it seems squid is then trying to open it's visible_hostname:squid_port/squid-internal-mgr/ and due my DNS setting it is its WAN IP - so it's connecting to its outside IP with its outside IP which is not in the http_access manager allow list (now it is and the newer squidclient works). So maybe I should just start with my DNS and then I will take a look how to implement the new cachemgr.cgi into my old setup...

L




LL


-----P&#367;vodn&#237; zpr&#225;va-----
Od: squid-users za u&#382;ivatele Alex Rousskov
Odesl&#225;no: &#250;t 12.9.2023 19:28
Komu: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
P&#345;edm&#283;t: Re: [squid-users] Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
 
On 2023-09-12 13:06, Lou&#269;ansk&#253; Luk&#225;&#353; wrote:
&gt;<i> Is this anyhow interesting?
</I>
Not really, IMO -- the problem happens earlier. I can confirm that you 
are running v6.3-based code. Let's call that progress :-).

Can you share the a _pointer_ to a compressed ALL,9 cache.log file while 
reproducing the problem using a single transaction?

<A HREF="https://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction">https://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction</A>

Alex.

&gt;<i> 
</I>&gt;<i> 2023/09/12 18:47:04.267 kid4| 24,8| SBuf.cc(30) SBuf: SBuf15514952 created
</I>&gt;<i> 2023/09/12 18:47:04.267 kid4| 24,8| SBuf.cc(30) SBuf: SBuf15514953 created
</I>&gt;<i> 2023/09/12 18:47:04.267 kid4| 24,8| SBuf.cc(30) SBuf: SBuf15514954 created
</I>&gt;<i> 2023/09/12 18:47:04.267 kid4| 24,7| SBuf.cc(85) assign: assigning 
</I>&gt;<i> SBuf15514952 from SBuf15514912
</I>&gt;<i> 2023/09/12 18:47:04.267 kid4| 24,8| SBuf.cc(38) SBuf: SBuf15514955 
</I>&gt;<i> created from id SBuf15514915
</I>&gt;<i> 2023/09/12 18:47:04.267 kid4| 24,8| SBuf.cc(445) startsWith: 
</I>&gt;<i> SBuf15514955 startsWith SBuf125812, caseSensitive: 0
</I>&gt;<i> 2023/09/12 18:47:04.267 kid4| 24,8| SBuf.cc(447) startsWith: no, too short
</I>&gt;<i> 2023/09/12 18:47:04.267 kid4| 24,8| Tokenizer.cc(185) skip: no match, 
</I>&gt;<i> not skipping '/squid-internal-mgr/'
</I>&gt;<i> 2023/09/12 18:47:04 kid4| ERROR: Squid BUG: assurance failed: 
</I>&gt;<i> tok.skip(WellKnownUrlPathPrefix())
</I>&gt;<i> 2023/09/12 18:47:04.268 kid4| 24,8| SBuf.cc(70) ~SBuf: SBuf15514955 
</I>&gt;<i> destructed
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> BTW debug 24,9 makes pretty big log files... :-)
</I>&gt;<i> 
</I>&gt;<i> L
</I>&gt;<i> 
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20230912/1d1dc2a9/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20230912/1d1dc2a9/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="026089.html">[squid-users] Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
</A></li>
	<LI>Next message (by thread): <A HREF="026093.html">[squid-users] Squid BUG: assurance failed: tok.skip(WellKnownUrlPathPrefix())
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26090">[ date ]</a>
              <a href="thread.html#26090">[ thread ]</a>
              <a href="subject.html#26090">[ subject ]</a>
              <a href="author.html#26090">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
