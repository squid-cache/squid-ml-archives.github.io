<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] SIGABRT (coredump) in Ip::Address::getAddrInfo(addrinfo*&amp;, int)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SIGABRT%20%28coredump%29%20in%0A%20Ip%3A%3AAddress%3A%3AgetAddrInfo%28addrinfo%2A%26%2C%20int%29&In-Reply-To=%3Cf8dc78b4-9e6a-4aed-be04-48c0dac40ac8%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026130.html">
   <LINK REL="Next"  HREF="026134.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] SIGABRT (coredump) in Ip::Address::getAddrInfo(addrinfo*&amp;, int)</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SIGABRT%20%28coredump%29%20in%0A%20Ip%3A%3AAddress%3A%3AgetAddrInfo%28addrinfo%2A%26%2C%20int%29&In-Reply-To=%3Cf8dc78b4-9e6a-4aed-be04-48c0dac40ac8%40measurement-factory.com%3E"
       TITLE="[squid-users] SIGABRT (coredump) in Ip::Address::getAddrInfo(addrinfo*&amp;, int)">rousskov at measurement-factory.com
       </A><BR>
    <I>Wed Sep 27 17:15:16 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="026130.html">[squid-users] SIGABRT (coredump) in Ip::Address::getAddrInfo(addrinfo*&amp;, int)
</A></li>
        <LI>Next message (by thread): <A HREF="026134.html">[squid-users] SIGABRT (coredump) in Ip::Address::getAddrInfo(addrinfo*&amp;, int)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26131">[ date ]</a>
              <a href="thread.html#26131">[ thread ]</a>
              <a href="subject.html#26131">[ subject ]</a>
              <a href="author.html#26131">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2023-09-27 11:08, Dmitry Katsubo wrote:

&gt;<i> After upgrading Squid from v4.13-10+deb11u2 (bullseye) to v5.7-2
</I>&gt;<i> (bookworm) I started to get about 5 core dumps per day like below.
</I>
&gt;<i> How can I find out the root of the problem and eliminate it?
</I>

Your Squid is most likely suffering (among other v5 bugs) from Squid Bug
5154: <A HREF="https://bugs.squid-cache.org/show_bug.cgi?id=5154">https://bugs.squid-cache.org/show_bug.cgi?id=5154</A>

There is currently no fix for that bug (that I can recommend without 
serious caveats). There has been significant progress towards a fix, but 
it may have stalled at <A HREF="https://github.com/squid-cache/squid/pull/1421">https://github.com/squid-cache/squid/pull/1421</A>

The best known way to prevent bug 5154 is to enable IPv6 support, but 
that is not feasible in many environments.

Another Squid admin has reported success with an unofficial (and 
probably incomplete) workaround at 
<A HREF="https://lists.squid-cache.org/pipermail/squid-users/2023-September/026103.html">https://lists.squid-cache.org/pipermail/squid-users/2023-September/026103.html</A>


HTH,

Alex.


&gt;<i> 
</I>&gt;<i> # coredumpctl gdb -1 --no-pager
</I>&gt;<i>             PID: 357187 (squid)
</I>&gt;<i>             UID: 13 (proxy)
</I>&gt;<i>             GID: 13 (proxy)
</I>&gt;<i>          Signal: 6 (ABRT)
</I>&gt;<i>       Timestamp: Wed 2023-09-27 11:27:08 CEST (5h 16min ago)
</I>&gt;<i>    Command Line: $'(squid-1)' --kid squid-1 --foreground -sYC
</I>&gt;<i>      Executable: /usr/sbin/squid
</I>&gt;<i>   Control Group: /system.slice/squid.service
</I>&gt;<i>            Unit: squid.service
</I>&gt;<i>           Slice: system.slice
</I>&gt;<i>         Storage: /var/lib/systemd/coredump/core.squid.13.f7e894167d564f788825cae8827bd2df.357187.1695806828000000.zst (present)
</I>&gt;<i>    Size on Disk: 2.5M
</I>&gt;<i>         Message: Process 357187 (squid) of user 13 dumped core.
</I>&gt;<i> 
</I>&gt;<i>                  Module libsystemd.so.0 from deb systemd-252.12-1~deb12u1.amd64
</I>&gt;<i>                  Stack trace of thread 357187:
</I>&gt;<i>                  #0  0x00007f752b2a9d3c n/a (libc.so.6 + 0x8ad3c)
</I>&gt;<i>                  #1  0x00007f752b25af32 raise (libc.so.6 + 0x3bf32)
</I>&gt;<i>                  #2  0x00007f752b245472 abort (libc.so.6 + 0x26472)
</I>&gt;<i>                  #3  0x00007f752b245395 n/a (libc.so.6 + 0x26395)
</I>&gt;<i>                  #4  0x00007f752b253e32 __assert_fail (libc.so.6 + 0x34e32)
</I>&gt;<i>                  #5  0x00005576cf7c0ee4 _ZNK2Ip7Address11getAddrInfoERP8addrinfoi (squid + 0x466ee4)
</I>&gt;<i>                  #6  0x00005576cf7bc3c5 _Z11comm_openexiiRN2Ip7AddressEiPKc (squid + 0x4623c5)
</I>&gt;<i>                  #7  0x00005576cf80fdfe _ZN4Comm10ConnOpener8createFdEv (squid + 0x4b5dfe)
</I>&gt;<i>                  #8  0x00005576cf8109c1 _ZN4Comm10ConnOpener5startEv (squid + 0x4b69c1)
</I>&gt;<i>                  #9  0x00005576cf7ab09c _ZN9JobDialerI8AsyncJobE4dialER9AsyncCall (squid + 0x45109c)
</I>&gt;<i>                  #10 0x00005576cf7a779f _ZN14AsyncCallQueue8fireNextEv (squid + 0x44d79f)
</I>&gt;<i>                  #11 0x00005576cf7a7b52 _ZN14AsyncCallQueue4fireEv (squid + 0x44db52)
</I>&gt;<i>                  #12 0x00005576cf55f689 _ZN9EventLoop7runOnceEv (squid + 0x205689)
</I>&gt;<i>                  #13 0x00005576cf55f778 _ZN9EventLoop3runEv (squid + 0x205778)
</I>&gt;<i>                  #14 0x00005576cf665a50 _Z9SquidMainiPPc (squid + 0x30ba50)
</I>&gt;<i>                  #15 0x00005576cf4fdae1 main (squid + 0x1a3ae1)
</I>&gt;<i>                  #16 0x00007f752b2461ca n/a (libc.so.6 + 0x271ca)
</I>&gt;<i>                  #17 0x00007f752b246285 __libc_start_main (libc.so.6 + 0x27285)
</I>&gt;<i>                  #18 0x00005576cf505cc1 _start (squid + 0x1abcc1)
</I>&gt;<i>                  ELF object binary architecture: AMD x86-64
</I>&gt;<i> 
</I>&gt;<i> GNU gdb (Debian 13.1-3) 13.1
</I>&gt;<i> Reading symbols from /usr/sbin/squid...
</I>&gt;<i> (No debugging symbols found in /usr/sbin/squid)
</I>&gt;<i> [New LWP 357187]
</I>&gt;<i> [Thread debugging using libthread_db enabled]
</I>&gt;<i> Using host libthread_db library &quot;/lib/x86_64-linux-gnu/libthread_db.so.1&quot;.
</I>&gt;<i> Core was generated by `(squid-1) --kid squid-1 --foreground -sYC'.
</I>&gt;<i> Program terminated with signal SIGABRT, Aborted.
</I>&gt;<i> (gdb) bt
</I>&gt;<i> #0  0x00007f752b2a9d3c in ?? () from /lib/x86_64-linux-gnu/libc.so.6
</I>&gt;<i> #1  0x00007f752b25af32 in raise () from /lib/x86_64-linux-gnu/libc.so.6
</I>&gt;<i> #2  0x00007f752b245472 in abort () from /lib/x86_64-linux-gnu/libc.so.6
</I>&gt;<i> #3  0x00007f752b245395 in ?? () from /lib/x86_64-linux-gnu/libc.so.6
</I>&gt;<i> #4  0x00007f752b253e32 in __assert_fail () from /lib/x86_64-linux-gnu/libc.so.6
</I>&gt;<i> #5  0x00005576cf7c0ee4 in Ip::Address::getAddrInfo(addrinfo*&amp;, int) const ()
</I>&gt;<i> #6  0x00005576cf7bc3c5 in comm_openex(int, int, Ip::Address&amp;, int, char const*) ()
</I>&gt;<i> #7  0x00005576cf80fdfe in Comm::ConnOpener::createFd() ()
</I>&gt;<i> #8  0x00005576cf8109c1 in Comm::ConnOpener::start() ()
</I>&gt;<i> #9  0x00005576cf7ab09c in JobDialer&lt;AsyncJob&gt;::dial(AsyncCall&amp;) ()
</I>&gt;<i> #10 0x00005576cf7a779f in AsyncCallQueue::fireNext() ()
</I>&gt;<i> #11 0x00005576cf7a7b52 in AsyncCallQueue::fire() ()
</I>&gt;<i> #12 0x00005576cf55f689 in EventLoop::runOnce() ()
</I>&gt;<i> #13 0x00005576cf55f778 in EventLoop::run() ()
</I>&gt;<i> #14 0x00005576cf665a50 in SquidMain(int, char**) ()
</I>&gt;<i> #15 0x00005576cf4fdae1 in main ()
</I>&gt;<i> (gdb) exit
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="026130.html">[squid-users] SIGABRT (coredump) in Ip::Address::getAddrInfo(addrinfo*&amp;, int)
</A></li>
	<LI>Next message (by thread): <A HREF="026134.html">[squid-users] SIGABRT (coredump) in Ip::Address::getAddrInfo(addrinfo*&amp;, int)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26131">[ date ]</a>
              <a href="thread.html#26131">[ thread ]</a>
              <a href="subject.html#26131">[ subject ]</a>
              <a href="author.html#26131">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
