<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] TLS passthrough
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TLS%20passthrough&In-Reply-To=%3C42994367-b30d-443b-b88c-8df94a5632ff%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026146.html">
   <LINK REL="Next"  HREF="026149.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] TLS passthrough</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TLS%20passthrough&In-Reply-To=%3C42994367-b30d-443b-b88c-8df94a5632ff%40measurement-factory.com%3E"
       TITLE="[squid-users] TLS passthrough">rousskov at measurement-factory.com
       </A><BR>
    <I>Thu Sep 28 14:51:06 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="026146.html">[squid-users] TLS passthrough
</A></li>
        <LI>Next message (by thread): <A HREF="026149.html">[squid-users] TLS passthrough
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26147">[ date ]</a>
              <a href="thread.html#26147">[ thread ]</a>
              <a href="subject.html#26147">[ subject ]</a>
              <a href="author.html#26147">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2023-09-28 09:06, Fernando Giorgetti wrote:
&gt;<i> Hi Matus, do you mean something like a DNAT (iptables) rule?
</I>&gt;<i> If so, I would say, it should work as well.
</I>&gt;<i> 
</I>&gt;<i> But this is an environment I do not control, and I have been told to try
</I>&gt;<i> using an existing squid installation to proxy non-http/TLS data through.
</I>&gt;<i> 
</I>&gt;<i> I appreciate any guidance or recommendation.
</I>

Bugs notwithstanding, Squid can blindly tunnel intercepted (at TCP port 
X) TCP traffic to its intended destination:

     https_port X intercept ssl-bump ...
     ssl_bump splice all


Without interception, then Squid can only tunnel stuff inside HTTP 
CONNECT tunnels (for HTTP CONNECT requests received at TCP port Y):

     http_port Y ssl-bump ...
     ssl_bump splice all


In both cases, Squid does not care about the protocols that tunneled 
traffic is using. It could be HTTP, HTTPS, TLS, or anything else on top 
of TCP.

Your ACLs may differ from &quot;all&quot; in the above sketches, of course, but if 
traffic is not TLS, then you want an &quot;ssl_bump splice&quot; rule that matches 
during SslBump step1. A rule with an &quot;all&quot; ACLs is the simplest example 
of that.


HTH,

Alex.
P.S. I am getting an &quot;Internal Server Error&quot; when following the haproxy 
link in the original question, so I cannot map what that page says to 
the configurations above.


&gt;<i> On Thu, Sep 28, 2023 at 3:41&#8239;AM Matus UHLAR - fantomas wrote:
</I>&gt;<i> 
</I>&gt;<i>     On 27.09.23 16:48, Fernando Giorgetti wrote:
</I>&gt;<i>      &gt;I would like to know if it is possible to set up Squid to perform
</I>&gt;<i>      &gt;TLS passthrough to a given backend, relaying TLS encrypted
</I>&gt;<i>      &gt;traffic to the backend, similarly to what HAProxy does below?
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt;<A HREF="https://www.haproxy.com/documentation/aloha/latest/security/tls/encryption-strategies/#tls-passthrough">https://www.haproxy.com/documentation/aloha/latest/security/tls/encryption-strategies/#tls-passthrough</A> &lt;<A HREF="https://www.haproxy.com/documentation/aloha/latest/security/tls/encryption-strategies/#tls-passthrough">https://www.haproxy.com/documentation/aloha/latest/security/tls/encryption-strategies/#tls-passthrough</A>&gt;
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt;I have tried a few different configurations using reverse proxy,
</I>&gt;<i>      &gt;or peek and splice, but I could not make it work without providing
</I>&gt;<i>      &gt;a valid HTTP request or a CONNECT request.
</I>&gt;<i> 
</I>&gt;<i>     what's the difference between TCP redirect and this?
</I>&gt;<i> 
</I>&gt;<i>     -- 
</I>&gt;<i>     Matus UHLAR - fantomas, <A HREF="https://lists.squid-cache.org/listinfo/squid-users">uhlar at fantomas.sk</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">uhlar at fantomas.sk</A>&gt;
</I>&gt;<i>     ; <A HREF="http://www.fantomas.sk/">http://www.fantomas.sk/</A> &lt;<A HREF="http://www.fantomas.sk/">http://www.fantomas.sk/</A>&gt;
</I>&gt;<i>     Warning: I wish NOT to receive e-mail advertising to this address.
</I>&gt;<i>     Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
</I>&gt;<i>     Depression is merely anger without enthusiasm.
</I>&gt;<i>     _______________________________________________
</I>&gt;<i>     squid-users mailing list
</I>&gt;<i>     <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i>     <A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>     &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="026146.html">[squid-users] TLS passthrough
</A></li>
	<LI>Next message (by thread): <A HREF="026149.html">[squid-users] TLS passthrough
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26147">[ date ]</a>
              <a href="thread.html#26147">[ thread ]</a>
              <a href="subject.html#26147">[ subject ]</a>
              <a href="author.html#26147">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
