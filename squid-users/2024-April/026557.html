<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid cache questions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20cache%20questions&In-Reply-To=%3CA0DD0E1A-A9F5-4258-9AF9-8A46FCDF3427%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026553.html">
   <LINK REL="Next"  HREF="026563.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid cache questions</H1>
    <B>Jonathan Lee</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20cache%20questions&In-Reply-To=%3CA0DD0E1A-A9F5-4258-9AF9-8A46FCDF3427%40gmail.com%3E"
       TITLE="[squid-users] Squid cache questions">jonathanlee571 at gmail.com
       </A><BR>
    <I>Fri Apr  5 22:34:54 UTC 2024</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="026553.html">[squid-users] Squid cache questions
</A></li>
        <LI>Next message (by thread): <A HREF="026563.html">[squid-users] Squid cache questions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26557">[ date ]</a>
              <a href="thread.html#26557">[ thread ]</a>
              <a href="subject.html#26557">[ subject ]</a>
              <a href="author.html#26557">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>if (empty($settings['sslproxy_compatibility_mode']) || ($settings['sslproxy_compatibility_mode'] == 'modern')) {
					// Modern cipher suites
					$sslproxy_cipher = &quot;EECDH+ECDSA+AESGCM:EECDH+aRSA+AESGCM:EECDH+ECDSA+SHA384:EECDH+ECDSA+SHA256:EECDH+aRSA+SHA384:EECDH+aRSA+SHA256:EECDH+aRSA+RC4:EECDH:EDH+aRSA:!RC4:!aNULL:!eNULL:!LOW:!3DES:!SHA1:!MD5:!EXP:!PSK:!SRP:!DSS&quot;;
					$sslproxy_options .= &quot;,NO_TLSv1&quot;;
				} else {
					$sslproxy_cipher = &quot;EECDH+ECDSA+AESGCM:EECDH+aRSA+AESGCM:EECDH+ECDSA+SHA384:EECDH+ECDSA+SHA256:EECDH+aRSA+SHA384:EECDH+aRSA+SHA256:EECDH+aRSA+RC4:EECDH:EDH+aRSA:HIGH:!RC4:!aNULL:!eNULL:!LOW:!3DES:!MD5:!EXP:!PSK:!SRP:!DSS&quot;;
				}

Should the RC4  be removed or allowed?

<A HREF="https://github.com/pfsense/FreeBSD-ports/pull/1365">https://github.com/pfsense/FreeBSD-ports/pull/1365</A>



&gt;<i> On Apr 4, 2024, at 18:17, Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> On 4/04/24 17:48, Jonathan Lee wrote:
</I>&gt;&gt;<i> Is there any particular order to squid configuration??
</I>&gt;<i> 
</I>&gt;<i> Yes. &lt;<A HREF="https://wiki.squid-cache.org/SquidFaq/OrderIsImportant">https://wiki.squid-cache.org/SquidFaq/OrderIsImportant</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> Does this look correct?
</I>&gt;<i> 
</I>&gt;<i> Best way to find out is to run &quot;squid -k parse&quot;, which should be done after upgrades as well to identify and fix changes between versions as we improve the output.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> I actually get allot of hits and it functions amazing, so I wanted to share this in case I could improve something. Is there any issues with security?
</I>&gt;<i> 
</I>&gt;<i> Yes, the obvious one is &quot;DONT_VERIFY_PEER&quot; disabling TLS security entirely on outbound connections. That particular option will prevent you even being told about suspicious activity regarding TLS.
</I>&gt;<i> 
</I>&gt;<i> Also there are a few weird things in your TLS cipher settings, such as this sequence &quot;  EECDH+aRSA+RC4:...:!RC4 &quot;
</I>&gt;<i> Which as I understand, enables the EECDH with RC4 hash, but also forbids all uses of RC4.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> I am concerned that an invasive container could become installed in the cache and data marshal the network card.
</I>&gt;<i> 
</I>&gt;<i> You have a limit of 4 MB for objects allowed to pass through this proxy, exception being objects from domains listed in the &quot;windowsupdate&quot; ACL (not all Windows related) which are allowed up to 512 MB.
</I>&gt;<i> 
</I>&gt;<i> For the general case, any type of file which can store an image of some system is a risk for that type of vulnerability can be cached.
</I>&gt;<i> 
</I>&gt;<i> The place to fix that vulnerability properly is not the cache or Squid. It is the OS permissions allowing non-Squid software access to the cache files and/or directory.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> Here is my config
</I>&gt;&gt;<i> # This file is automatically generated by pfSense
</I>&gt;&gt;<i> # Do not edit manually !
</I>&gt;<i> 
</I>&gt;<i> Since this file is generated by pfsense there is little that can be done about ordering issues and very hard to tell which of the problems below are due to pfsense and which due toy your settings.
</I>&gt;<i> 
</I>&gt;<i> FWIW, there are no major issues, just some lines not being necessary due to setting things to their default values, or just some blocks already denyign things that are blocked previously.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> http_port 192.168.1.1:3128 ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=20MB cert=/usr/local/etc/squid/serverkey.pem cafile=/usr/local/share/certs/ca-root-nss.crt capath=/usr/local/share/certs/ cipher=EECDH+ECDSA+AESGCM:EECDH+aRSA+AESGCM:EECDH+ECDSA+SHA384:EECDH+ECDSA+SHA256:EECDH+aRSA+SHA384:EECDH+aRSA+SHA256:EECDH+aRSA+RC4:EECDH:EDH+aRSA:HIGH:!RC4:!aNULL:!eNULL:!LOW:!3DES:!MD5:!EXP:!PSK:!SRP:!DSS tls-dh=prime256v1:/etc/dh-parameters.2048 options=NO_SSLv3,SINGLE_DH_USE,SINGLE_ECDH_USE
</I>&gt;&gt;<i> http_port 127.0.0.1:3128 intercept ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=20MB cert=/usr/local/etc/squid/serverkey.pem cafile=/usr/local/share/certs/ca-root-nss.crt capath=/usr/local/share/certs/ cipher=EECDH+ECDSA+AESGCM:EECDH+aRSA+AESGCM:EECDH+ECDSA+SHA384:EECDH+ECDSA+SHA256:EECDH+aRSA+SHA384:EECDH+aRSA+SHA256:EECDH+aRSA+RC4:EECDH:EDH+aRSA:HIGH:!RC4:!aNULL:!eNULL:!LOW:!3DES:!MD5:!EXP:!PSK:!SRP:!DSS tls-dh=prime256v1:/etc/dh-parameters.2048 options=NO_SSLv3,SINGLE_DH_USE,SINGLE_ECDH_USE
</I>&gt;&gt;<i> https_port 127.0.0.1:3129 intercept ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=20MB cert=/usr/local/etc/squid/serverkey.pem cafile=/usr/local/share/certs/ca-root-nss.crt capath=/usr/local/share/certs/ cipher=EECDH+ECDSA+AESGCM:EECDH+aRSA+AESGCM:EECDH+ECDSA+SHA384:EECDH+ECDSA+SHA256:EECDH+aRSA+SHA384:EECDH+aRSA+SHA256:EECDH+aRSA+RC4:EECDH:EDH+aRSA:HIGH:!RC4:!aNULL:!eNULL:!LOW:!3DES:!MD5:!EXP:!PSK:!SRP:!DSS tls-dh=prime256v1:/etc/dh-parameters.2048 options=NO_SSLv3,SINGLE_DH_USE,SINGLE_ECDH_USE
</I>&gt;&gt;<i> icp_port 0
</I>&gt;&gt;<i> digest_generation off
</I>&gt;&gt;<i> dns_v4_first on
</I>&gt;&gt;<i> pid_filename /var/run/squid/squid.pid
</I>&gt;&gt;<i> cache_effective_user squid
</I>&gt;&gt;<i> cache_effective_group proxy
</I>&gt;&gt;<i> error_default_language en
</I>&gt;&gt;<i> icon_directory /usr/local/etc/squid/icons
</I>&gt;&gt;<i> visible_hostname ****
</I>&gt;&gt;<i> cache_mgr ****
</I>&gt;&gt;<i> access_log /var/squid/logs/access.log
</I>&gt;&gt;<i> cache_log /var/squid/logs/cache.log
</I>&gt;&gt;<i> cache_store_log none
</I>&gt;&gt;<i> netdb_filename /var/squid/logs/netdb.state
</I>&gt;&gt;<i> pinger_enable on
</I>&gt;&gt;<i> pinger_program /usr/local/libexec/squid/pinger
</I>&gt;&gt;<i> sslcrtd_program /usr/local/libexec/squid/security_file_certgen -s /var/squid/lib/ssl_db -M 4MB -b 2048
</I>&gt;&gt;<i> tls_outgoing_options cafile=/usr/local/share/certs/ca-root-nss.crt
</I>&gt;&gt;<i> tls_outgoing_options capath=/usr/local/share/certs/
</I>&gt;&gt;<i> tls_outgoing_options options=NO_SSLv3,SINGLE_DH_USE,SINGLE_ECDH_USE
</I>&gt;&gt;<i> tls_outgoing_options cipher=EECDH+ECDSA+AESGCM:EECDH+aRSA+AESGCM:EECDH+ECDSA+SHA384:EECDH+ECDSA+SHA256:EECDH+aRSA+SHA384:EECDH+aRSA+SHA256:EECDH+aRSA+RC4:EECDH:EDH+aRSA:HIGH:!RC4:!aNULL:!eNULL:!LOW:!3DES:!MD5:!EXP:!PSK:!SRP:!DSS
</I>&gt;&gt;<i> tls_outgoing_options flags=DONT_VERIFY_PEER
</I>&gt;&gt;<i> sslcrtd_children 10
</I>&gt;&gt;<i> logfile_rotate 0
</I>&gt;&gt;<i> debug_options rotate=0
</I>&gt;&gt;<i> shutdown_lifetime 3 seconds
</I>&gt;&gt;<i> # Allow local network(s) on interface(s)
</I>&gt;&gt;<i> acl localnet src  192.168.1.0/27
</I>&gt;&gt;<i> forwarded_for transparent
</I>&gt;&gt;<i> httpd_suppress_version_string on
</I>&gt;&gt;<i> uri_whitespace strip
</I>&gt;&gt;<i> acl getmethod method GET
</I>&gt;&gt;<i> acl windowsupdate dstdomain windowsupdate.microsoft.com &lt;<A HREF="http://windowsupdate.microsoft.com/">http://windowsupdate.microsoft.com/</A>&gt;
</I>&gt;&gt;<i> acl windowsupdate dstdomain .update.microsoft.com &lt;<A HREF="http://update.microsoft.com/">http://update.microsoft.com/</A>&gt;
</I>&gt;&gt;<i> acl windowsupdate dstdomain download.windowsupdate.com &lt;<A HREF="http://download.windowsupdate.com/">http://download.windowsupdate.com/</A>&gt;
</I>&gt;&gt;<i> acl windowsupdate dstdomain redir.metaservices.microsoft.com &lt;<A HREF="http://redir.metaservices.microsoft.com/">http://redir.metaservices.microsoft.com/</A>&gt;
</I>&gt;&gt;<i> acl windowsupdate dstdomain images.metaservices.microsoft.com &lt;<A HREF="http://images.metaservices.microsoft.com/">http://images.metaservices.microsoft.com/</A>&gt;
</I>&gt;&gt;<i> acl windowsupdate dstdomain c.microsoft.com &lt;<A HREF="http://c.microsoft.com/">http://c.microsoft.com/</A>&gt;
</I>&gt;&gt;<i> acl windowsupdate dstdomain www.download.windowsupdate.com &lt;<A HREF="http://www.download.windowsupdate.com/">http://www.download.windowsupdate.com/</A>&gt;
</I>&gt;&gt;<i> acl windowsupdate dstdomain wustat.windows.com &lt;<A HREF="http://wustat.windows.com/">http://wustat.windows.com/</A>&gt;
</I>&gt;&gt;<i> acl windowsupdate dstdomain crl.microsoft.com &lt;<A HREF="http://crl.microsoft.com/">http://crl.microsoft.com/</A>&gt;
</I>&gt;&gt;<i> acl windowsupdate dstdomain sls.microsoft.com &lt;<A HREF="http://sls.microsoft.com/">http://sls.microsoft.com/</A>&gt;
</I>&gt;&gt;<i> acl windowsupdate dstdomain productactivation.one.microsoft.com &lt;<A HREF="http://productactivation.one.microsoft.com/">http://productactivation.one.microsoft.com/</A>&gt;
</I>&gt;&gt;<i> acl windowsupdate dstdomain ntservicepack.microsoft.com &lt;<A HREF="http://ntservicepack.microsoft.com/">http://ntservicepack.microsoft.com/</A>&gt;
</I>&gt;&gt;<i> acl windowsupdate dstdomain dc1-st.ksn.kaspersky-labs.com &lt;<A HREF="http://dc1-st.ksn.kaspersky-labs.com/">http://dc1-st.ksn.kaspersky-labs.com/</A>&gt;
</I>&gt;&gt;<i> acl windowsupdate dstdomain dc1-file.ksn.kaspersky-labs.com &lt;<A HREF="http://dc1-file.ksn.kaspersky-labs.com/">http://dc1-file.ksn.kaspersky-labs.com/</A>&gt;
</I>&gt;&gt;<i> acl windowsupdate dstdomain dc1.ksn.kaspersky-labs.com &lt;<A HREF="http://dc1.ksn.kaspersky-labs.com/">http://dc1.ksn.kaspersky-labs.com/</A>&gt;
</I>&gt;&gt;<i> acl rewritedoms dstdomain .facebook.com &lt;<A HREF="http://facebook.com/">http://facebook.com/</A>&gt; .akamaihd.net &lt;<A HREF="http://akamaihd.net/">http://akamaihd.net/</A>&gt; .fbcdn.net &lt;<A HREF="http://fbcdn.net/">http://fbcdn.net/</A>&gt; .google.com &lt;<A HREF="http://google.com/">http://google.com/</A>&gt; .static.com &lt;<A HREF="http://static.com/">http://static.com/</A>&gt; .apple.com &lt;<A HREF="http://apple.com/">http://apple.com/</A>&gt; .oracle.com &lt;<A HREF="http://oracle.com/">http://oracle.com/</A>&gt; .sun.com &lt;<A HREF="http://sun.com/">http://sun.com/</A>&gt; .java.com &lt;<A HREF="http://java.com/">http://java.com/</A>&gt; .adobe.com &lt;<A HREF="http://adobe.com/">http://adobe.com/</A>&gt; .steamstatic.com &lt;<A HREF="http://steamstatic.com/">http://steamstatic.com/</A>&gt;.steampowered.com &lt;<A HREF="http://steampowered.com/">http://steampowered.com/</A>&gt; .steamcontent.com &lt;<A HREF="http://steamcontent.com/">http://steamcontent.com/</A>&gt; .google.com &lt;<A HREF="http://google.com/">http://google.com/</A>&gt;
</I>&gt;&gt;<i> store_id_program /usr/local/libexec/squid/storeid_file_rewrite /var/squid/storeid/storeid_rewrite.txt
</I>&gt;&gt;<i> store_id_children 10 startup=5 idle=1 concurrency=0
</I>&gt;&gt;<i> always_direct allow !getmethod
</I>&gt;&gt;<i> store_id_access deny connect
</I>&gt;&gt;<i> store_id_access deny !getmethod
</I>&gt;&gt;<i> store_id_access allow rewritedoms
</I>&gt;&gt;<i> reload_into_ims on
</I>&gt;&gt;<i> max_stale 20 years
</I>&gt;&gt;<i> minimum_expiry_time 0
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> I am not sure how many of these refresh_pattern rules below are written by you, copy-pasted from elsewhere, or added automatically by pfsense. So how you need to fix the problems here is uncertain.
</I>&gt;<i> 
</I>&gt;<i> That said, please consider removing all these override-* and ignore-*.
</I>&gt;<i> &lt;<A HREF="http://www.squid-cache.org/Doc/config/refresh_pattern/">http://www.squid-cache.org/Doc/config/refresh_pattern/</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> refresh_pattern -i squid.internal 10080 80% 79900 override-lastmod override-expire ignore-reload ignore-no-store ignore-must-revalidate ignore-private ignore-auth
</I>&gt;&gt;<i> #APPLE STUFF
</I>&gt;&gt;<i> refresh_pattern -i apple.com/ &lt;<A HREF="http://apple.com/">http://apple.com/</A>&gt;..(cab|exe|msi|msu|msf|asf|wmv|wma|dat|zip|dist)$ 0 80% 43200  refresh-ims
</I>&gt;&gt;<i> #apple update
</I>&gt;&gt;<i> refresh_pattern -i (download|adcdownload).apple.com &lt;<A HREF="http://apple.com/">http://apple.com/</A>&gt;/.*.(pkg|dmg) 4320 100% 43200
</I>&gt;&gt;<i> refresh_pattern -i appldnld.apple.com &lt;<A HREF="http://appldnld.apple.com/">http://appldnld.apple.com/</A>&gt; 129600 100% 129600
</I>&gt;&gt;<i> refresh_pattern -i phobos.apple.com &lt;<A HREF="http://phobos.apple.com/">http://phobos.apple.com/</A>&gt; 129600 100% 129600
</I>&gt;&gt;<i> refresh_pattern -i iosapps.itunes.apple.com &lt;<A HREF="http://iosapps.itunes.apple.com/">http://iosapps.itunes.apple.com/</A>&gt; 129600 100% 129600
</I>&gt;&gt;<i> # Updates: Windows
</I>&gt;&gt;<i> refresh_pattern -i microsoft.com/ &lt;<A HREF="http://microsoft.com/">http://microsoft.com/</A>&gt;..(cab|exe|msi|msu|msf|asf|wma|dat|zip)$ 4320 80% 43200  refresh-ims
</I>&gt;&gt;<i> refresh_pattern -i windowsupdate.com/ &lt;<A HREF="http://windowsupdate.com/">http://windowsupdate.com/</A>&gt;..(cab|exe|msi|msu|msf|asf|wma|wmv)|dat|zip)$ 4320 80% 43200  refresh-ims
</I>&gt;&gt;<i> refresh_pattern -i windows.com/ &lt;<A HREF="http://windows.com/">http://windows.com/</A>&gt;..(cab|exe|msi|msu|msf|asf|wmv|wma|dat|zip)$ 4320 80% 43200  refresh-ims
</I>&gt;&gt;<i> refresh_pattern -i microsoft.com &lt;<A HREF="http://microsoft.com/">http://microsoft.com/</A>&gt;/.*.(cab|exe|ms[i|u|f]|[ap]sf|wm[v|a]|dat|zip) 4320 80% 43200
</I>&gt;&gt;<i> refresh_pattern -i windowsupdate.com &lt;<A HREF="http://windowsupdate.com/">http://windowsupdate.com/</A>&gt;/.*.(cab|exe|ms[i|u|f]|[ap]sf|wm[v|a]|dat|zip) 4320 80% 43200
</I>&gt;&gt;<i> refresh_pattern -i windows.com &lt;<A HREF="http://windows.com/">http://windows.com/</A>&gt;/.*.(cab|exe|ms[i|u|f]|[ap]sf|wm[v|a]|dat|zip) 4320 80% 43200
</I>&gt;&gt;<i> refresh_pattern -i .*windowsupdate.com &lt;<A HREF="http://windowsupdate.com/">http://windowsupdate.com/</A>&gt;/.*.(cab|exe) 259200 100% 259200
</I>&gt;&gt;<i> refresh_pattern -i .*update.microsoft.com &lt;<A HREF="http://update.microsoft.com/">http://update.microsoft.com/</A>&gt;/.*.(cab|exe|dll|msi|psf) 259200 100% 259200
</I>&gt;&gt;<i> refresh_pattern windowsupdate.com &lt;<A HREF="http://windowsupdate.com/">http://windowsupdate.com/</A>&gt;/.*.(cab|exe|dll|msi|psf) 10080 100% 43200
</I>&gt;&gt;<i> refresh_pattern download.microsoft.com &lt;<A HREF="http://download.microsoft.com/">http://download.microsoft.com/</A>&gt;/.*.(cab|exe|dll|msi|psf) 10080 100% 43200
</I>&gt;&gt;<i> refresh_pattern www.microsoft.com &lt;<A HREF="http://www.microsoft.com/">http://www.microsoft.com/</A>&gt;/.*.(cab|exe|dll|msi|psf) 10080 100% 43200
</I>&gt;&gt;<i> refresh_pattern au.download.windowsupdate.com &lt;<A HREF="http://au.download.windowsupdate.com/">http://au.download.windowsupdate.com/</A>&gt;/.*.(cab|exe|dll|msi|psf) 4320 100% 43200
</I>&gt;&gt;<i> refresh_pattern bg.v4.pr.dl.ws.microsoft.com &lt;<A HREF="http://pr.dl.ws.microsoft.com/">http://pr.dl.ws.microsoft.com/</A>&gt;/.*.(cab|exe|dll|msi|psf) 4320 100% 43200
</I>&gt;&gt;<i> #windows update NEW UPDATE 0.04
</I>&gt;&gt;<i> refresh_pattern update.microsoft.com &lt;<A HREF="http://update.microsoft.com/">http://update.microsoft.com/</A>&gt;/.*.(cab|exe) 43200 100% 129600
</I>&gt;&gt;<i> refresh_pattern ([^.]+.)?(download|(windows)?update).(microsoft.)?com/.*.(cab|exe|msi|msp|psf) 4320 100% 43200
</I>&gt;&gt;<i> refresh_pattern update.microsoft.com &lt;<A HREF="http://update.microsoft.com/">http://update.microsoft.com/</A>&gt;/.*.(cab|exe|dll|msi|psf) 10080 100% 43200
</I>&gt;&gt;<i> refresh_pattern -i .update.microsoft.com &lt;<A HREF="http://update.microsoft.com/">http://update.microsoft.com/</A>&gt;/.*.(cab|exe|ms[i|u|f]|[ap]sf|wm[v|a]|dat|zip) 525600 100% 525600
</I>&gt;&gt;<i> refresh_pattern -i .windowsupdate.com &lt;<A HREF="http://windowsupdate.com/">http://windowsupdate.com/</A>&gt;/.*.(cab|exe|ms[i|u|f]|[ap]sf|wm[v|a]|dat|zip) 525600 100% 525600
</I>&gt;&gt;<i> refresh_pattern -i .download.microsoft.com &lt;<A HREF="http://download.microsoft.com/">http://download.microsoft.com/</A>&gt;/.*.(cab|exe|ms[i|u|f]|[ap]sf|wm[v|a]|dat|zip) 525600 100% 525600
</I>&gt;&gt;<i> refresh_pattern -i .ws.microsoft.com &lt;<A HREF="http://ws.microsoft.com/">http://ws.microsoft.com/</A>&gt;/.*.(cab|exe|ms[i|u|f]|[ap]sf|wm[v|a]|dat|zip) 525600 100% 525600
</I>&gt;&gt;<i> refresh_pattern ([^.]+.)?(cs|content[1-9]|hsar|content-origin|client-download).[steampowered|steamcontent].com/.*.* 43200 100% 43200 reload-into-ims ignore-reload ignore-no-store override-expire override-lastmod
</I>&gt;&gt;<i> refresh_pattern ([^.]+.)?.akamai.steamstatic.com &lt;<A HREF="http://akamai.steamstatic.com/">http://akamai.steamstatic.com/</A>&gt;/.*.* 43200 100% 43200 reload-into-ims ignore-reload ignore-no-store override-expire override-lastmod
</I>&gt;&gt;<i> refresh_pattern -i ([^.]+.)?.adobe.com &lt;<A HREF="http://adobe.com/">http://adobe.com/</A>&gt;/.*.(zip|exe) 43200 100% 43200 reload-into-ims ignore-reload ignore-no-store override-expire override-lastmod
</I>&gt;&gt;<i> refresh_pattern -i ([^.]+.)?.java.com &lt;<A HREF="http://java.com/">http://java.com/</A>&gt;/.*.(zip|exe) 43200 100% 43200 reload-into-ims ignore-reload ignore-no-store override-expire override-lastmod
</I>&gt;&gt;<i> refresh_pattern -i ([^.]+.)?.sun.com &lt;<A HREF="http://sun.com/">http://sun.com/</A>&gt;/.*.(zip|exe) 43200 100% 43200 reload-into-ims ignore-reload ignore-no-store override-expire override-lastmod
</I>&gt;&gt;<i> refresh_pattern -i ([^.]+.)?.oracle.com &lt;<A HREF="http://oracle.com/">http://oracle.com/</A>&gt;/.*.(zip|exe|tar.gz) 43200 100% 43200 reload-into-ims ignore-reload ignore-no-store override-expire override-lastmod
</I>&gt;&gt;<i> refresh_pattern -i appldnld.apple.com &lt;<A HREF="http://appldnld.apple.com/">http://appldnld.apple.com/</A>&gt; 43200 100% 43200 ignore-reload ignore-no-store override-expire override-lastmod
</I>&gt;&gt;<i> refresh_pattern -i ([^.]+.)?apple.com &lt;<A HREF="http://apple.com/">http://apple.com/</A>&gt;/.*.(ipa) 43200 100% 43200 ignore-reload ignore-no-store override-expire override-lastmod
</I>&gt;&gt;<i>  refresh_pattern -i ([^.]+.)?.google.com &lt;<A HREF="http://google.com/">http://google.com/</A>&gt;/.*.(exe|crx) 10080 80% 43200 override-expire override-lastmod ignore-no-cache ignore-reload reload-into-ims ignore-private
</I>&gt;&gt;<i> refresh_pattern -i ([^.]+.)?g.static.com &lt;<A HREF="http://g.static.com/">http://g.static.com/</A>&gt;/.*.(exe|crx) 10080 80% 43200 override-expire override-lastmod ignore-no-cache ignore-reload reload-into-ims ignore-private
</I>&gt;&gt;<i> #FACEBOOK
</I>&gt;&gt;<i> refresh_pattern ^http?://*.facebook.com/* &lt;<A HREF="http://facebook.com/*">http://facebook.com/*</A>&gt;  10080 80% 43200 override-expire override-lastmod ignore-no-cache ignore-reload reload-into-ims ignore-private
</I>&gt;&gt;<i> #FACEBOOK IMAGES
</I>&gt;&gt;<i> refresh_pattern -i pixel.facebook.com &lt;<A HREF="http://pixel.facebook.com/">http://pixel.facebook.com/</A>&gt;..(jpg|png|gif|ico|css|js)  10080 80% 43200 override-expire override-lastmod ignore-no-cache ignore-reload reload-into-ims ignore-private
</I>&gt;&gt;<i> refresh_pattern -i .akamaihd.net &lt;<A HREF="http://akamaihd.net/">http://akamaihd.net/</A>&gt;..(jpg|png|gif|ico|css|js) 10080 80% 43200 override-expire override-lastmod ignore-no-cache ignore-reload reload-into-ims ignore-private
</I>&gt;&gt;<i> refresh_pattern -i (facebook.com &lt;<A HREF="http://facebook.com/">http://facebook.com/</A>&gt;).(jpg|png|gif) 10080 80% 43200 store-stale override-expire override-lastmod ignore-no-cache ignore-reload reload-into-ims ignore-private
</I>&gt;&gt;<i> refresh_pattern static.(xx|ak).fbcdn.net &lt;<A HREF="http://fbcdn.net/">http://fbcdn.net/</A>&gt;.(jpg|gif|png) 10080 80% 43200 override-expire override-lastmod ignore-no-cache ignore-reload reload-into-ims ignore-private
</I>&gt;&gt;<i> refresh_pattern ^https?://profile.ak.fbcdn.net &lt;<A HREF="http://profile.ak.fbcdn.net/">http://profile.ak.fbcdn.net/</A>&gt;*.(jpg|gif|png) 10080 80% 43200 override-expire override-lastmod ignore-no-cache ignore-reload reload-into-ims ignore-private
</I>&gt;&gt;<i> #FACEBOOK VIDEO
</I>&gt;&gt;<i> refresh_pattern -i .video.ak.fbcdn.net &lt;<A HREF="http://video.ak.fbcdn.net/">http://video.ak.fbcdn.net/</A>&gt;.*.(mp4|flv|mp3|amf) 10080 80% 43200 override-expire override-lastmod ignore-no-cache ignore-reload reload-into-ims ignore-private
</I>&gt;&gt;<i> refresh_pattern (audio|video)/(webm|mp4) 10080 80% 43200 override-expire override-lastmod ignore-no-cache ignore-reload reload-into-ims ignore-private
</I>&gt;&gt;<i> range_offset_limit 512 MB windowsupdate
</I>&gt;&gt;<i> maximum_object_size 512 MB windowsupdate
</I>&gt;&gt;<i> range_offset_limit 0
</I>&gt;&gt;<i> quick_abort_min -1 KB
</I>&gt;&gt;<i> cache_mem 64 MB
</I>&gt;&gt;<i> maximum_object_size_in_memory 256 KB
</I>&gt;&gt;<i> memory_replacement_policy heap LFUDA
</I>&gt;&gt;<i> cache_replacement_policy heap LFUDA
</I>&gt;&gt;<i> minimum_object_size 0 KB
</I>&gt;&gt;<i> maximum_object_size 4 MB
</I>&gt;&gt;<i> cache_dir diskd /var/squid/cache 64000 256 256
</I>&gt;&gt;<i> offline_mode off
</I>&gt;&gt;<i> cache_swap_low 90
</I>&gt;&gt;<i> cache_swap_high 95
</I>&gt;&gt;<i> acl donotcache dstdomain '/var/squid/acl/donotcache.acl'
</I>&gt;&gt;<i> cache deny donotcache
</I>&gt;&gt;<i> cache allow all
</I>&gt;&gt;<i> # Add any of your own refresh_pattern entries above these.
</I>&gt;&gt;<i> refresh_pattern ^ftp:    1440  20%  10080
</I>&gt;&gt;<i> refresh_pattern ^gopher:  1440  0%  1440
</I>&gt;&gt;<i> refresh_pattern -i (/cgi-bin/|?) 0  0%  0
</I>&gt;&gt;<i> refresh_pattern .    0  20%  4320
</I>&gt;&gt;<i> #Remote proxies
</I>&gt;&gt;<i> # Setup some default acls
</I>&gt;&gt;<i> # ACLs all, manager, localhost, and to_localhost are predefined.
</I>&gt;&gt;<i> acl allsrc src all
</I>&gt;&gt;<i> acl safeports port 21 70 80 210 280 443 488 563 591 631 777 901 8080 3128 3129 1025-65535
</I>&gt;&gt;<i> acl sslports port 443 563 8080 5223 2197
</I>&gt;&gt;<i> acl purge method PURGE
</I>&gt;&gt;<i> acl connect method CONNECT
</I>&gt;&gt;<i> # Define protocols used for redirects
</I>&gt;&gt;<i> acl HTTP proto HTTP
</I>&gt;&gt;<i> acl HTTPS proto HTTPS
</I>&gt;&gt;<i> # SslBump Peek and Splice
</I>&gt;&gt;<i> # <A HREF="http://wiki.squid-cache.org/Features/SslPeekAndSplice">http://wiki.squid-cache.org/Features/SslPeekAndSplice</A>
</I>&gt;&gt;<i> # <A HREF="http://wiki.squid-cache.org/ConfigExamples/Intercept/SslBumpExplicit">http://wiki.squid-cache.org/ConfigExamples/Intercept/SslBumpExplicit</A>
</I>&gt;&gt;<i> # Match against the current step during ssl_bump evaluation [fast]
</I>&gt;&gt;<i> # Never matches and should not be used outside the ssl_bump context.
</I>&gt;&gt;<i> #
</I>&gt;&gt;<i> # At each SslBump step, Squid evaluates ssl_bump directives to find
</I>&gt;&gt;<i> # the next bumping action (e.g., peek or splice). Valid SslBump step
</I>&gt;&gt;<i> # values and the corresponding ssl_bump evaluation moments are:
</I>&gt;&gt;<i> #   SslBump1: After getting TCP-level and HTTP CONNECT info.
</I>&gt;&gt;<i> #   SslBump2: After getting TLS Client Hello info.
</I>&gt;&gt;<i> #   SslBump3: After getting TLS Server Hello info.
</I>&gt;&gt;<i> # These ACLs exist even when 'SSL/MITM Mode' is set to 'Custom' so that
</I>&gt;&gt;<i> # they can be used there for custom configuration.
</I>&gt;&gt;<i> acl step1 at_step SslBump1
</I>&gt;&gt;<i> acl step2 at_step SslBump2
</I>&gt;&gt;<i> acl step3 at_step SslBump3
</I>&gt;&gt;<i> acl banned_hosts src '/var/squid/acl/banned_hosts.acl'
</I>&gt;&gt;<i> acl whitelist dstdom_regex -i '/var/squid/acl/whitelist.acl'
</I>&gt;&gt;<i> acl blacklist dstdom_regex -i '/var/squid/acl/blacklist.acl'
</I>&gt;&gt;<i> http_access allow manager localhost
</I>&gt;&gt;<i> # Allow external cache managers
</I>&gt;&gt;<i> acl ext_manager src 192.168.1.1
</I>&gt;&gt;<i> acl ext_manager src 127.0.0.1
</I>&gt;&gt;<i> http_access allow manager ext_manager
</I>&gt;&gt;<i> http_access deny manager
</I>&gt;&gt;<i> http_access allow purge localhost
</I>&gt;&gt;<i> http_access deny purge
</I>&gt;&gt;<i> http_access deny !safeports
</I>&gt;&gt;<i> http_access deny CONNECT !sslports
</I>&gt;&gt;<i> # Always allow localhost connections
</I>&gt;&gt;<i> http_access allow localhost
</I>&gt;&gt;<i> quick_abort_min 0 KB
</I>&gt;&gt;<i> quick_abort_max 0 KB
</I>&gt;&gt;<i> quick_abort_pct 95
</I>&gt;&gt;<i> request_body_max_size 0 KB
</I>&gt;&gt;<i> delay_pools 1
</I>&gt;&gt;<i> delay_class 1 2
</I>&gt;&gt;<i> delay_parameters 1 -1/-1 -1/-1
</I>&gt;&gt;<i> delay_initial_bucket_level 100
</I>&gt;&gt;<i> delay_access 1 allow allsrc
</I>&gt;&gt;<i> # Reverse Proxy settings
</I>&gt;&gt;<i> deny_info TCP_RESET allsrc
</I>&gt;&gt;<i> # Package Integration
</I>&gt;&gt;<i> url_rewrite_program /usr/local/bin/squidGuard -c /usr/local/etc/squidGuard/squidGuard.conf
</I>&gt;&gt;<i> url_rewrite_bypass off
</I>&gt;&gt;<i> url_rewrite_children 32 startup=8 idle=4 concurrency=0
</I>&gt;<i> 
</I>&gt;<i> Squidguard is very outdated. You should upgrade to its successor ufdbguard if possible.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> # Custom options before auth
</I>&gt;&gt;<i> #host_verify_strict on
</I>&gt;&gt;<i> # These hosts are banned
</I>&gt;&gt;<i> http_access deny banned_hosts
</I>&gt;&gt;<i> # Always allow access to whitelist domains
</I>&gt;&gt;<i> http_access allow whitelist
</I>&gt;&gt;<i> # Block access to blacklist domains
</I>&gt;&gt;<i> http_access deny blacklist
</I>&gt;&gt;<i> # List of domains allowed to logging in to Google services
</I>&gt;&gt;<i> request_header_access X-GoogApps-Allowed-Domains deny all
</I>&gt;&gt;<i> request_header_add X-GoogApps-Allowed-Domains consumer_accounts
</I>&gt;&gt;<i> # Set YouTube safesearch restriction
</I>&gt;&gt;<i> acl youtubedst dstdomain -n www.youtube.com &lt;<A HREF="http://www.youtube.com/">http://www.youtube.com/</A>&gt; m.youtube.com &lt;<A HREF="http://m.youtube.com/">http://m.youtube.com/</A>&gt; youtubei.googleapis.com &lt;<A HREF="http://youtubei.googleapis.com/">http://youtubei.googleapis.com/</A>&gt; youtube.googleapis.com &lt;<A HREF="http://youtube.googleapis.com/">http://youtube.googleapis.com/</A>&gt; www.youtube-nocookie.com &lt;<A HREF="http://www.youtube-nocookie.com/">http://www.youtube-nocookie.com/</A>&gt;
</I>&gt;&gt;<i> request_header_access YouTube-Restrict deny all
</I>&gt;&gt;<i> request_header_add YouTube-Restrict none youtubedst
</I>&gt;&gt;<i> acl sglog url_regex -i sgr=ACCESSDENIED
</I>&gt;&gt;<i> http_access deny sglog
</I>&gt;&gt;<i> # Custom SSL/MITM options before auth
</I>&gt;&gt;<i> acl manager proto cache_object
</I>&gt;&gt;<i> acl localhost src 192.168.1.1/32
</I>&gt;&gt;<i> #cachemgr_passwd disable offline_toggle reconfigure shutdown
</I>&gt;&gt;<i> #cachemgr_passwd secret all
</I>&gt;&gt;<i> acl https_login url_regex -i ^https.*(login|Login).*
</I>&gt;&gt;<i> acl no_miss url_regex -i ^.*gateway.facebook.com/ws/realtime? &lt;<A HREF="http://gateway.facebook.com/ws/realtime?">http://gateway.facebook.com/ws/realtime?</A>&gt;
</I>&gt;&gt;<i> acl no_miss url_regex -i ^.*web-chat-e2ee.facebook.com/ws/chat &lt;<A HREF="http://web-chat-e2ee.facebook.com/ws/chat">http://web-chat-e2ee.facebook.com/ws/chat</A>&gt;	
</I>&gt;&gt;<i> acl CONNECT method CONNECT
</I>&gt;&gt;<i> acl wuCONNECT dstdomain www.update.microsoft.com &lt;<A HREF="http://www.update.microsoft.com/">http://www.update.microsoft.com/</A>&gt;
</I>&gt;&gt;<i> acl wuCONNECT dstdomain sls.microsoft.com &lt;<A HREF="http://sls.microsoft.com/">http://sls.microsoft.com/</A>&gt;
</I>&gt;&gt;<i> http_access allow CONNECT wuCONNECT localnet
</I>&gt;&gt;<i> http_access allow CONNECT wuCONNECT localhost
</I>&gt;&gt;<i> http_access allow windowsupdate localnet
</I>&gt;&gt;<i> http_access allow windowsupdate localhost
</I>&gt;&gt;<i> http_access deny manager
</I>&gt;&gt;<i> acl BrokenButTrustedServers dstdomain '/usr/local/pkg/dstdom.broken'
</I>&gt;&gt;<i> acl DomainMismatch ssl_error SQUID_X509_V_ERR_DOMAIN_MISMATCH
</I>&gt;&gt;<i> sslproxy_cert_error allow BrokenButTrustedServers DomainMismatch
</I>&gt;&gt;<i> sslproxy_cert_error deny all
</I>&gt;&gt;<i> acl splice_only src 192.168.1.8 #Tasha iPhone
</I>&gt;&gt;<i> acl splice_only src 192.168.1.10 #Jon iPhone
</I>&gt;&gt;<i> acl splice_only src 192.168.1.11 #Amazon Fire
</I>&gt;&gt;<i> acl splice_only src 192.168.1.15 #Tasha HP
</I>&gt;&gt;<i> acl splice_only src 192.168.1.16 #iPad
</I>&gt;&gt;<i> acl NoSSLIntercept ssl::server_name_regex -i '/usr/local/pkg/url.nobump'
</I>&gt;&gt;<i> acl markBumped annotate_client bumped=true
</I>&gt;&gt;<i> acl bump_only src 192.168.1.3 #webtv
</I>&gt;&gt;<i> acl bump_only src 192.168.1.4 #toshiba
</I>&gt;&gt;<i> acl bump_only src 192.168.1.5 #imac
</I>&gt;&gt;<i> acl bump_only src 192.168.1.9 #macbook
</I>&gt;&gt;<i> acl bump_only src 192.168.1.13 #dell
</I>&gt;<i> 
</I>&gt;<i> You have a previous &quot;cache allow all&quot;. This below rule does nothing.
</I>&gt;<i> 
</I>&gt;&gt;<i> cache deny https_login
</I>&gt;&gt;<i> ssl_bump peek step1
</I>&gt;&gt;<i> miss_access deny no_miss
</I>&gt;&gt;<i> ssl_bump splice https_login
</I>&gt;&gt;<i> ssl_bump splice splice_only
</I>&gt;&gt;<i> ssl_bump splice NoSSLIntercept
</I>&gt;&gt;<i> ssl_bump bump bump_only markBumped
</I>&gt;&gt;<i> ssl_bump stare all
</I>&gt;&gt;<i> acl markedBumped note bumped true
</I>&gt;&gt;<i> url_rewrite_access deny markedBumped
</I>&gt;&gt;<i> http_access deny all
</I>&gt;&gt;<i> read_ahead_gap 32 KB
</I>&gt;&gt;<i> negative_ttl 1 second
</I>&gt;&gt;<i> connect_timeout 30 seconds
</I>&gt;&gt;<i> request_timeout 60 seconds
</I>&gt;&gt;<i> half_closed_clients off
</I>&gt;&gt;<i> shutdown_lifetime 10 seconds
</I>&gt;&gt;<i> negative_dns_ttl 1 seconds
</I>&gt;&gt;<i> ignore_unknown_nameservers on
</I>&gt;&gt;<i> pipeline_prefetch 100
</I>&gt;&gt;<i> #acl SSLIntercept ssl::server_name_regex -i '/usr/local/pkg/url.bump'
</I>&gt;&gt;<i> #ssl_bump bump SSLIntercept
</I>&gt;<i> 
</I>&gt;<i> You already have an earlier &quot;http_access deny all&quot;. The below lines do nothing.
</I>&gt;<i> 
</I>&gt;&gt;<i> # Setup allowed ACLs
</I>&gt;&gt;<i> # Allow local network(s) on interface(s)
</I>&gt;&gt;<i> http_access allow localnet
</I>&gt;&gt;<i> # Default block all to be sure
</I>&gt;&gt;<i> http_access deny allsrc
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> HTH
</I>&gt;<i> Amos
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20240405/41b0d7a6/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20240405/41b0d7a6/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="026553.html">[squid-users] Squid cache questions
</A></li>
	<LI>Next message (by thread): <A HREF="026563.html">[squid-users] Squid cache questions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26557">[ date ]</a>
              <a href="thread.html#26557">[ thread ]</a>
              <a href="subject.html#26557">[ subject ]</a>
              <a href="author.html#26557">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
