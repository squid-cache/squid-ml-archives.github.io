<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] [External] squid-users Digest, Vol 116, Issue 7
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%5BExternal%5D%20squid-users%20Digest%2C%20Vol%20116%2C%20Issue%207&In-Reply-To=%3CMW5PR14MB5289E10FE67E3888C772A2E6B0062%40MW5PR14MB5289.namprd14.prod.outlook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026585.html">
   <LINK REL="Next"  HREF="026569.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] [External] squid-users Digest, Vol 116, Issue 7</H1>
    <B>Bobby Matznick</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%5BExternal%5D%20squid-users%20Digest%2C%20Vol%20116%2C%20Issue%207&In-Reply-To=%3CMW5PR14MB5289E10FE67E3888C772A2E6B0062%40MW5PR14MB5289.namprd14.prod.outlook.com%3E"
       TITLE="[squid-users] [External] squid-users Digest, Vol 116, Issue 7">bmatznick at pbandt.bank
       </A><BR>
    <I>Wed Apr 10 15:15:30 UTC 2024</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="026585.html">[squid-users] SQUID_TLS_ERR_ACCEPT+TLS_LIB_ERR=A000417+TLS_IO_ERR
</A></li>
        <LI>Next message (by thread): <A HREF="026569.html">[squid-users] [External] squid-users Digest, Vol 116, Issue 7
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26567">[ date ]</a>
              <a href="thread.html#26567">[ thread ]</a>
              <a href="subject.html#26567">[ subject ]</a>
              <a href="author.html#26567">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Question about squid, Debian version 4.13. Looking for a way to log referer's. I see the way that worked up until version 4, seems this does not work anymore. I'm having some trouble finding if anything replaced it or if there's another way to go about this? Here is the old way.
referrer_log /pathname

Thanks for any help you can provide!

Bobby

From: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; On Behalf Of <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-request at lists.squid-cache.org</A>
Sent: Friday, April 5, 2024 6:00 AM
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: [External] squid-users Digest, Vol 116, Issue 7

Caution: This is an external email and has a suspicious subject or content. Please take care when clicking links or opening attachments. When in doubt, contact your IT Department
Send squid-users mailing list submissions to
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;

To subscribe or unsubscribe via the World Wide Web, visit
<A HREF="https://lists.squid-cache.org/listinfo/squid-users&lt;https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users&lt;https://lists.squid-cache.org/listinfo/squid-users</A>&gt;
or, via email, send a message with subject or body 'help' to
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-request at lists.squid-cache.org</A>&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-request at lists.squid-cache.org</A>&gt;

You can reach the person managing the list at
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-owner at lists.squid-cache.org</A>&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-owner at lists.squid-cache.org</A>&gt;

When replying, please edit your Subject line so it is more specific
than &quot;Re: Contents of squid-users digest...&quot;


Today's Topics:

1. Re: Squid cache questions (Amos Jeffries)


----------------------------------------------------------------------

Message: 1
Date: Fri, 5 Apr 2024 14:17:16 +1300
From: Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;&gt;
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
Subject: Re: [squid-users] Squid cache questions
Message-ID: &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">bef43696-be7f-463b-b82e-d4346abba2a5 at treenet.co.nz</A>&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">bef43696-be7f-463b-b82e-d4346abba2a5 at treenet.co.nz</A>&gt;&gt;
Content-Type: text/plain; charset=UTF-8; format=flowed

On 4/04/24 17:48, Jonathan Lee wrote:
&gt;<i> Is there any particular order to squid configuration??
</I>&gt;<i>
</I>
Yes. &lt;<A HREF="https://wiki.squid-cache.org/SquidFaq/OrderIsImportant&lt;https://wiki.squid-cache.org/SquidFaq/OrderIsImportant">https://wiki.squid-cache.org/SquidFaq/OrderIsImportant&lt;https://wiki.squid-cache.org/SquidFaq/OrderIsImportant</A>&gt;&gt;


&gt;<i> Does this look correct?
</I>&gt;<i>
</I>
Best way to find out is to run &quot;squid -k parse&quot;, which should be done
after upgrades as well to identify and fix changes between versions as
we improve the output.


&gt;<i> I actually get allot of hits and it functions amazing, so I wanted to
</I>&gt;<i> share this in case I could improve something. Is there any issues with
</I>&gt;<i> security?
</I>
Yes, the obvious one is &quot;DONT_VERIFY_PEER&quot; disabling TLS security
entirely on outbound connections. That particular option will prevent
you even being told about suspicious activity regarding TLS.

Also there are a few weird things in your TLS cipher settings, such as
this sequence &quot; EECDH+aRSA+RC4:...:!RC4 &quot;
Which as I understand, enables the EECDH with RC4 hash, but also
forbids all uses of RC4.


&gt;<i> I am concerned that an invasive container could become
</I>&gt;<i> installed in the cache and data marshal the network card.
</I>&gt;<i>
</I>
You have a limit of 4 MB for objects allowed to pass through this proxy,
exception being objects from domains listed in the &quot;windowsupdate&quot; ACL
(not all Windows related) which are allowed up to 512 MB.

For the general case, any type of file which can store an image of some
system is a risk for that type of vulnerability can be cached.

The place to fix that vulnerability properly is not the cache or Squid.
It is the OS permissions allowing non-Squid software access to the cache
files and/or directory.



&gt;<i> Here is my config
</I>&gt;<i>
</I>&gt;<i> # This file is automatically generated by pfSense
</I>&gt;<i> # Do not edit manually !
</I>
Since this file is generated by pfsense there is little that can be done
about ordering issues and very hard to tell which of the problems below
are due to pfsense and which due toy your settings.

FWIW, there are no major issues, just some lines not being necessary due
to setting things to their default values, or just some blocks already
denyign things that are blocked previously.


&gt;<i>
</I>&gt;<i> http_port 192.168.1.1:3128 ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=20MB cert=/usr/local/etc/squid/serverkey.pem cafile=/usr/local/share/certs/ca-root-nss.crt capath=/usr/local/share/certs/ cipher=EECDH+ECDSA+AESGCM:EECDH+aRSA+AESGCM:EECDH+ECDSA+SHA384:EECDH+ECDSA+SHA256:EECDH+aRSA+SHA384:EECDH+aRSA+SHA256:EECDH+aRSA+RC4:EECDH:EDH+aRSA:HIGH:!RC4:!aNULL:!eNULL:!LOW:!3DES:!MD5:!EXP:!PSK:!SRP:!DSS tls-dh=prime256v1:/etc/dh-parameters.2048 options=NO_SSLv3,SINGLE_DH_USE,SINGLE_ECDH_USE
</I>&gt;<i>
</I>&gt;<i> http_port 127.0.0.1:3128 intercept ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=20MB cert=/usr/local/etc/squid/serverkey.pem cafile=/usr/local/share/certs/ca-root-nss.crt capath=/usr/local/share/certs/ cipher=EECDH+ECDSA+AESGCM:EECDH+aRSA+AESGCM:EECDH+ECDSA+SHA384:EECDH+ECDSA+SHA256:EECDH+aRSA+SHA384:EECDH+aRSA+SHA256:EECDH+aRSA+RC4:EECDH:EDH+aRSA:HIGH:!RC4:!aNULL:!eNULL:!LOW:!3DES:!MD5:!EXP:!PSK:!SRP:!DSS tls-dh=prime256v1:/etc/dh-parameters.2048 options=NO_SSLv3,SINGLE_DH_USE,SINGLE_ECDH_USE
</I>&gt;<i>
</I>&gt;<i> https_port 127.0.0.1:3129 intercept ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=20MB cert=/usr/local/etc/squid/serverkey.pem cafile=/usr/local/share/certs/ca-root-nss.crt capath=/usr/local/share/certs/ cipher=EECDH+ECDSA+AESGCM:EECDH+aRSA+AESGCM:EECDH+ECDSA+SHA384:EECDH+ECDSA+SHA256:EECDH+aRSA+SHA384:EECDH+aRSA+SHA256:EECDH+aRSA+RC4:EECDH:EDH+aRSA:HIGH:!RC4:!aNULL:!eNULL:!LOW:!3DES:!MD5:!EXP:!PSK:!SRP:!DSS tls-dh=prime256v1:/etc/dh-parameters.2048 options=NO_SSLv3,SINGLE_DH_USE,SINGLE_ECDH_USE
</I>&gt;<i>
</I>&gt;<i> icp_port 0
</I>&gt;<i> digest_generation off
</I>&gt;<i> dns_v4_first on
</I>&gt;<i> pid_filename /var/run/squid/squid.pid
</I>&gt;<i> cache_effective_user squid
</I>&gt;<i> cache_effective_group proxy
</I>&gt;<i> error_default_language en
</I>&gt;<i> icon_directory /usr/local/etc/squid/icons
</I>&gt;<i> visible_hostname ****
</I>&gt;<i> cache_mgr ****
</I>&gt;<i> access_log /var/squid/logs/access.log
</I>&gt;<i> cache_log /var/squid/logs/cache.log
</I>&gt;<i> cache_store_log none
</I>&gt;<i> netdb_filename /var/squid/logs/netdb.state
</I>&gt;<i> pinger_enable on
</I>&gt;<i> pinger_program /usr/local/libexec/squid/pinger
</I>&gt;<i> sslcrtd_program /usr/local/libexec/squid/security_file_certgen -s /var/squid/lib/ssl_db -M 4MB -b 2048
</I>&gt;<i> tls_outgoing_options cafile=/usr/local/share/certs/ca-root-nss.crt
</I>&gt;<i> tls_outgoing_options capath=/usr/local/share/certs/
</I>&gt;<i> tls_outgoing_options options=NO_SSLv3,SINGLE_DH_USE,SINGLE_ECDH_USE
</I>&gt;<i> tls_outgoing_options cipher=EECDH+ECDSA+AESGCM:EECDH+aRSA+AESGCM:EECDH+ECDSA+SHA384:EECDH+ECDSA+SHA256:EECDH+aRSA+SHA384:EECDH+aRSA+SHA256:EECDH+aRSA+RC4:EECDH:EDH+aRSA:HIGH:!RC4:!aNULL:!eNULL:!LOW:!3DES:!MD5:!EXP:!PSK:!SRP:!DSS
</I>&gt;<i> tls_outgoing_options flags=DONT_VERIFY_PEER
</I>&gt;<i> sslcrtd_children 10
</I>&gt;<i>
</I>&gt;<i> logfile_rotate 0
</I>&gt;<i> debug_options rotate=0
</I>&gt;<i> shutdown_lifetime 3 seconds
</I>&gt;<i> # Allow local network(s) on interface(s)
</I>&gt;<i> acl localnet src 192.168.1.0/27&lt;<A HREF="http://192.168.1.0/27">http://192.168.1.0/27</A>&gt;
</I>&gt;<i> forwarded_for transparent
</I>&gt;<i> httpd_suppress_version_string on
</I>&gt;<i> uri_whitespace strip
</I>&gt;<i>
</I>&gt;<i> acl getmethod method GET
</I>&gt;<i>
</I>&gt;<i> acl windowsupdate dstdomain windowsupdate.microsoft.com
</I>&gt;<i> acl windowsupdate dstdomain .update.microsoft.com
</I>&gt;<i> acl windowsupdate dstdomain download.windowsupdate.com
</I>&gt;<i> acl windowsupdate dstdomain redir.metaservices.microsoft.com
</I>&gt;<i> acl windowsupdate dstdomain images.metaservices.microsoft.com
</I>&gt;<i> acl windowsupdate dstdomain c.microsoft.com
</I>&gt;<i> acl windowsupdate dstdomain www.download.windowsupdate.com&lt;<A HREF="http://www.download.windowsupdate.com">http://www.download.windowsupdate.com</A>&gt;
</I>&gt;<i> acl windowsupdate dstdomain wustat.windows.com
</I>&gt;<i> acl windowsupdate dstdomain crl.microsoft.com
</I>&gt;<i> acl windowsupdate dstdomain sls.microsoft.com
</I>&gt;<i> acl windowsupdate dstdomain productactivation.one.microsoft.com
</I>&gt;<i> acl windowsupdate dstdomain ntservicepack.microsoft.com
</I>&gt;<i> acl windowsupdate dstdomain dc1-st.ksn.kaspersky-labs.com
</I>&gt;<i> acl windowsupdate dstdomain dc1-file.ksn.kaspersky-labs.com
</I>&gt;<i> acl windowsupdate dstdomain dc1.ksn.kaspersky-labs.com
</I>&gt;<i>
</I>&gt;<i> acl rewritedoms dstdomain .facebook.com .akamaihd.net .fbcdn.net .google.com .static.com .apple.com .oracle.com .sun.com .java.com .adobe.com .steamstatic.com .steampowered.com .steamcontent.com .google.com
</I>&gt;<i>
</I>&gt;<i> store_id_program /usr/local/libexec/squid/storeid_file_rewrite /var/squid/storeid/storeid_rewrite.txt
</I>&gt;<i> store_id_children 10 startup=5 idle=1 concurrency=0
</I>&gt;<i> always_direct allow !getmethod
</I>&gt;<i> store_id_access deny connect
</I>&gt;<i> store_id_access deny !getmethod
</I>&gt;<i> store_id_access allow rewritedoms
</I>&gt;<i> reload_into_ims on
</I>&gt;<i> max_stale 20 years
</I>&gt;<i> minimum_expiry_time 0
</I>&gt;<i>
</I>

I am not sure how many of these refresh_pattern rules below are written
by you, copy-pasted from elsewhere, or added automatically by pfsense.
So how you need to fix the problems here is uncertain.

That said, please consider removing all these override-* and ignore-*.
&lt;<A HREF="http://www.squid-cache.org/Doc/config/refresh_pattern/&lt;http://www.squid-cache.org/Doc/config/refresh_pattern">http://www.squid-cache.org/Doc/config/refresh_pattern/&lt;http://www.squid-cache.org/Doc/config/refresh_pattern</A>&gt;&gt;


&gt;<i>
</I>&gt;<i> refresh_pattern -i squid.internal 10080 80% 79900 override-lastmod override-expire ignore-reload ignore-no-store ignore-must-revalidate ignore-private ignore-auth
</I>&gt;<i>
</I>&gt;<i> #APPLE STUFF
</I>&gt;<i> refresh_pattern -i apple.com/.&lt;<A HREF="http://apple.com/.">http://apple.com/.</A>&gt;.(cab|exe|msi|msu|msf|asf|wmv|wma|dat|zip|dist)$ 0 80% 43200 refresh-ims
</I>&gt;<i>
</I>&gt;<i> #apple update
</I>&gt;<i> refresh_pattern -i (download|adcdownload)apple.com/.*&lt;<A HREF="http://apple.com/.*">http://apple.com/.*</A>&gt;.(pkg|dmg) 4320 100% 43200
</I>&gt;<i> refresh_pattern -i appldnld.apple.com 129600 100% 129600
</I>&gt;<i> refresh_pattern -i phobos.apple.com 129600 100% 129600
</I>&gt;<i> refresh_pattern -i iosapps.itunes.apple.com 129600 100% 129600
</I>&gt;<i>
</I>&gt;<i> # Updates: Windows
</I>&gt;<i> refresh_pattern -i microsoft.com/.&lt;<A HREF="http://microsoft.com/.">http://microsoft.com/.</A>&gt;.(cab|exe|msi|msu|msf|asf|wma|dat|zip)$ 4320 80% 43200 refresh-ims
</I>&gt;<i> refresh_pattern -i windowsupdate.com/.&lt;<A HREF="http://windowsupdate.com/.">http://windowsupdate.com/.</A>&gt;.(cab|exe|msi|msu|msf|asf|wma|wmv)|dat|zip)$ 4320 80% 43200 refresh-ims
</I>&gt;<i> refresh_pattern -i windows.com/.&lt;<A HREF="http://windows.com/.">http://windows.com/.</A>&gt;.(cab|exe|msi|msu|msf|asf|wmv|wma|dat|zip)$ 4320 80% 43200 refresh-ims
</I>&gt;<i> refresh_pattern -i microsoft.com/.*&lt;<A HREF="http://microsoft.com/.*">http://microsoft.com/.*</A>&gt;.(cab|exe|ms[i|u|f]|[ap]sf|wm[v|a]|dat|zip) 4320 80% 43200
</I>&gt;<i> refresh_pattern -i windowsupdate.com/.*&lt;<A HREF="http://windowsupdate.com/.*">http://windowsupdate.com/.*</A>&gt;.(cab|exe|ms[i|u|f]|[ap]sf|wm[v|a]|dat|zip) 4320 80% 43200
</I>&gt;<i> refresh_pattern -i windows.com/.*&lt;<A HREF="http://windows.com/.*">http://windows.com/.*</A>&gt;.(cab|exe|ms[i|u|f]|[ap]sf|wm[v|a]|dat|zip) 4320 80% 43200
</I>&gt;<i> refresh_pattern -i .*windowsupdate.com/.*&lt;<A HREF="http://windowsupdate.com/.*">http://windowsupdate.com/.*</A>&gt;.(cab|exe) 259200 100% 259200
</I>&gt;<i> refresh_pattern -i .*update.microsoft.com/.*&lt;<A HREF="http://update.microsoft.com/.*">http://update.microsoft.com/.*</A>&gt;.(cab|exe|dll|msi|psf) 259200 100% 259200
</I>&gt;<i> refresh_pattern windowsupdate.com/.*&lt;<A HREF="http://windowsupdate.com/.*">http://windowsupdate.com/.*</A>&gt;.(cab|exe|dll|msi|psf) 10080 100% 43200
</I>&gt;<i> refresh_pattern download.microsoft.com/.*&lt;<A HREF="http://download.microsoft.com/.*">http://download.microsoft.com/.*</A>&gt;.(cab|exe|dll|msi|psf) 10080 100% 43200
</I>&gt;<i> refresh_pattern www.microsoft.com/.*&lt;<A HREF="http://www.microsoft.com/.*">http://www.microsoft.com/.*</A>&gt;.(cab|exe|dll|msi|psf) 10080 100% 43200
</I>&gt;<i> refresh_pattern au.download.windowsupdate.com/.*&lt;<A HREF="http://au.download.windowsupdate.com/.*">http://au.download.windowsupdate.com/.*</A>&gt;.(cab|exe|dll|msi|psf) 4320 100% 43200
</I>&gt;<i> refresh_pattern bg.v4.pr.dl.ws.microsoft.com/.*&lt;<A HREF="http://bg.v4.pr.dl.ws.microsoft.com/.*">http://bg.v4.pr.dl.ws.microsoft.com/.*</A>&gt;.(cab|exe|dll|msi|psf) 4320 100% 43200
</I>&gt;<i> #windows update NEW UPDATE 0.04
</I>&gt;<i> refresh_pattern update.microsoft.com/.*&lt;<A HREF="http://update.microsoft.com/.*">http://update.microsoft.com/.*</A>&gt;.(cab|exe) 43200 100% 129600
</I>&gt;<i> refresh_pattern ([^.]+.)?(download|(windows)?update).(microsoft.)?com/.*.(cab|exe|msi|msp|psf) 4320 100% 43200
</I>&gt;<i> refresh_pattern update.microsoft.com/.*&lt;<A HREF="http://update.microsoft.com/.*">http://update.microsoft.com/.*</A>&gt;.(cab|exe|dll|msi|psf) 10080 100% 43200
</I>&gt;<i> refresh_pattern -i update.microsoft.com/.*&lt;<A HREF="http://update.microsoft.com/.*">http://update.microsoft.com/.*</A>&gt;.(cab|exe|ms[i|u|f]|[ap]sf|wm[v|a]|dat|zip) 525600 100% 525600
</I>&gt;<i> refresh_pattern -i windowsupdate.com/.*&lt;<A HREF="http://windowsupdate.com/.*">http://windowsupdate.com/.*</A>&gt;.(cab|exe|ms[i|u|f]|[ap]sf|wm[v|a]|dat|zip) 525600 100% 525600
</I>&gt;<i> refresh_pattern -i download.microsoft.com/.*&lt;<A HREF="http://download.microsoft.com/.*">http://download.microsoft.com/.*</A>&gt;.(cab|exe|ms[i|u|f]|[ap]sf|wm[v|a]|dat|zip) 525600 100% 525600
</I>&gt;<i> refresh_pattern -i ws.microsoft.com/.*&lt;<A HREF="http://ws.microsoft.com/.*">http://ws.microsoft.com/.*</A>&gt;.(cab|exe|ms[i|u|f]|[ap]sf|wm[v|a]|dat|zip) 525600 100% 525600
</I>&gt;<i>
</I>&gt;<i> refresh_pattern ([^.]+.)?(cs|content[1-9]|hsar|content-origin|client-download).[steampowered|steamcontent].com/.*.* 43200 100% 43200 reload-into-ims ignore-reload ignore-no-store override-expire override-lastmod
</I>&gt;<i> refresh_pattern ([^.]+.)?akamai.steamstatic.com/.*.*&lt;<A HREF="http://akamai.steamstatic.com/.*.*">http://akamai.steamstatic.com/.*.*</A>&gt; 43200 100% 43200 reload-into-ims ignore-reload ignore-no-store override-expire override-lastmod
</I>&gt;<i>
</I>&gt;<i> refresh_pattern -i ([^.]+.)?adobe.com/.*&lt;<A HREF="http://adobe.com/.*">http://adobe.com/.*</A>&gt;.(zip|exe) 43200 100% 43200 reload-into-ims ignore-reload ignore-no-store override-expire override-lastmod
</I>&gt;<i> refresh_pattern -i ([^.]+.)?java.com/.*&lt;<A HREF="http://java.com/.*">http://java.com/.*</A>&gt;.(zip|exe) 43200 100% 43200 reload-into-ims ignore-reload ignore-no-store override-expire override-lastmod
</I>&gt;<i> refresh_pattern -i ([^.]+.)?sun.com/.*&lt;<A HREF="http://sun.com/.*">http://sun.com/.*</A>&gt;.(zip|exe) 43200 100% 43200 reload-into-ims ignore-reload ignore-no-store override-expire override-lastmod
</I>&gt;<i> refresh_pattern -i ([^.]+.)?oracle.com/.*&lt;<A HREF="http://oracle.com/.*">http://oracle.com/.*</A>&gt;.(zip|exe|tar.gz) 43200 100% 43200 reload-into-ims ignore-reload ignore-no-store override-expire override-lastmod
</I>&gt;<i>
</I>&gt;<i> refresh_pattern -i appldnld.apple.com 43200 100% 43200 ignore-reload ignore-no-store override-expire override-lastmod
</I>&gt;<i> refresh_pattern -i ([^.]+.)?apple.com/.*.(ipa)&lt;<A HREF="http://apple.com/.*.(ipa">http://apple.com/.*.(ipa</A>)&gt; 43200 100% 43200 ignore-reload ignore-no-store override-expire override-lastmod
</I>&gt;<i>
</I>&gt;<i> refresh_pattern -i ([^.]+.)?google.com/.*&lt;<A HREF="http://google.com/.*">http://google.com/.*</A>&gt;.(exe|crx) 10080 80% 43200 override-expire override-lastmod ignore-no-cache ignore-reload reload-into-ims ignore-private
</I>&gt;<i> refresh_pattern -i ([^.]+.)?g.static.com/.*&lt;<A HREF="http://g.static.com/.*">http://g.static.com/.*</A>&gt;.(exe|crx) 10080 80% 43200 override-expire override-lastmod ignore-no-cache ignore-reload reload-into-ims ignore-private
</I>&gt;<i>
</I>&gt;<i> #FACEBOOK
</I>&gt;<i> refresh_pattern ^http?://*facebook.com/*&lt;<A HREF="http://facebook.com/*">http://facebook.com/*</A>&gt; 10080 80% 43200 override-expire override-lastmod ignore-no-cache ignore-reload reload-into-ims ignore-private
</I>&gt;<i>
</I>&gt;<i> #FACEBOOK IMAGES
</I>&gt;<i> refresh_pattern -i pixel.facebook.com..(jpg|png|gif|ico|css|js) 10080 80% 43200 override-expire override-lastmod ignore-no-cache ignore-reload reload-into-ims ignore-private
</I>&gt;<i> refresh_pattern -i .akamaihd.net..(jpg|png|gif|ico|css|js) 10080 80% 43200 override-expire override-lastmod ignore-no-cache ignore-reload reload-into-ims ignore-private
</I>&gt;<i> refresh_pattern -i (facebook.com).(jpg|png|gif) 10080 80% 43200 store-stale override-expire override-lastmod ignore-no-cache ignore-reload reload-into-ims ignore-private
</I>&gt;<i> refresh_pattern static.(xx|ak).fbcdn.net.(jpg|gif|png) 10080 80% 43200 override-expire override-lastmod ignore-no-cache ignore-reload reload-into-ims ignore-private
</I>&gt;<i> refresh_pattern ^https?://profile.ak.fbcdn.net*.(jpg|gif|png) 10080 80% 43200 override-expire override-lastmod ignore-no-cache ignore-reload reload-into-ims ignore-private
</I>&gt;<i>
</I>&gt;<i> #FACEBOOK VIDEO
</I>&gt;<i> refresh_pattern -i .video.ak.fbcdn.net.*.(mp4|flv|mp3|amf) 10080 80% 43200 override-expire override-lastmod ignore-no-cache ignore-reload reload-into-ims ignore-private
</I>&gt;<i> refresh_pattern (audio|video)/(webm|mp4) 10080 80% 43200 override-expire override-lastmod ignore-no-cache ignore-reload reload-into-ims ignore-private
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> range_offset_limit 512 MB windowsupdate
</I>&gt;<i> maximum_object_size 512 MB windowsupdate
</I>&gt;<i> range_offset_limit 0
</I>&gt;<i> quick_abort_min -1 KB
</I>&gt;<i>
</I>&gt;<i> cache_mem 64 MB
</I>&gt;<i> maximum_object_size_in_memory 256 KB
</I>&gt;<i> memory_replacement_policy heap LFUDA
</I>&gt;<i> cache_replacement_policy heap LFUDA
</I>&gt;<i> minimum_object_size 0 KB
</I>&gt;<i> maximum_object_size 4 MB
</I>&gt;<i> cache_dir diskd /var/squid/cache 64000 256 256
</I>&gt;<i> offline_mode off
</I>&gt;<i> cache_swap_low 90
</I>&gt;<i> cache_swap_high 95
</I>&gt;<i> acl donotcache dstdomain '/var/squid/acl/donotcache.acl'
</I>&gt;<i> cache deny donotcache
</I>&gt;<i> cache allow all
</I>&gt;<i> # Add any of your own refresh_pattern entries above these.
</I>&gt;<i> refresh_pattern ^ftp: 1440 20% 10080
</I>&gt;<i> refresh_pattern ^gopher: 1440 0% 1440
</I>&gt;<i> refresh_pattern -i (/cgi-bin/|?) 0 0% 0
</I>&gt;<i> refresh_pattern . 0 20% 4320
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> #Remote proxies
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> # Setup some default acls
</I>&gt;<i> # ACLs all, manager, localhost, and to_localhost are predefined.
</I>&gt;<i> acl allsrc src all
</I>&gt;<i> acl safeports port 21 70 80 210 280 443 488 563 591 631 777 901 8080 3128 3129 1025-65535
</I>&gt;<i> acl sslports port 443 563 8080 5223 2197
</I>&gt;<i>
</I>&gt;<i> acl purge method PURGE
</I>&gt;<i> acl connect method CONNECT
</I>&gt;<i>
</I>&gt;<i> # Define protocols used for redirects
</I>&gt;<i> acl HTTP proto HTTP
</I>&gt;<i> acl HTTPS proto HTTPS
</I>&gt;<i>
</I>&gt;<i> # SslBump Peek and Splice
</I>&gt;<i> # <A HREF="http://wiki.squid-cache.org/Features/SslPeekAndSplice&lt;http://wiki.squid-cache.org/Features/SslPeekAndSplice">http://wiki.squid-cache.org/Features/SslPeekAndSplice&lt;http://wiki.squid-cache.org/Features/SslPeekAndSplice</A>&gt;
</I>&gt;<i> # <A HREF="http://wiki.squid-cache.org/ConfigExamples/Intercept/SslBumpExplicit&lt;http://wiki.squid-cache.org/ConfigExamples/Intercept/SslBumpExplicit">http://wiki.squid-cache.org/ConfigExamples/Intercept/SslBumpExplicit&lt;http://wiki.squid-cache.org/ConfigExamples/Intercept/SslBumpExplicit</A>&gt;
</I>&gt;<i> # Match against the current step during ssl_bump evaluation [fast]
</I>&gt;<i> # Never matches and should not be used outside the ssl_bump context.
</I>&gt;<i> #
</I>&gt;<i> # At each SslBump step, Squid evaluates ssl_bump directives to find
</I>&gt;<i> # the next bumping action (e.g., peek or splice). Valid SslBump step
</I>&gt;<i> # values and the corresponding ssl_bump evaluation moments are:
</I>&gt;<i> # SslBump1: After getting TCP-level and HTTP CONNECT info.
</I>&gt;<i> # SslBump2: After getting TLS Client Hello info.
</I>&gt;<i> # SslBump3: After getting TLS Server Hello info.
</I>&gt;<i> # These ACLs exist even when 'SSL/MITM Mode' is set to 'Custom' so that
</I>&gt;<i> # they can be used there for custom configuration.
</I>&gt;<i> acl step1 at_step SslBump1
</I>&gt;<i> acl step2 at_step SslBump2
</I>&gt;<i> acl step3 at_step SslBump3
</I>&gt;<i> acl banned_hosts src '/var/squid/acl/banned_hosts.acl'
</I>&gt;<i> acl whitelist dstdom_regex -i '/var/squid/acl/whitelist.acl'
</I>&gt;<i> acl blacklist dstdom_regex -i '/var/squid/acl/blacklist.acl'
</I>&gt;<i> http_access allow manager localhost
</I>&gt;<i>
</I>&gt;<i> # Allow external cache managers
</I>&gt;<i> acl ext_manager src 192.168.1.1
</I>&gt;<i> acl ext_manager src 127.0.0.1&lt;<A HREF="http://127.0.0.1">http://127.0.0.1</A>&gt;
</I>&gt;<i> http_access allow manager ext_manager
</I>&gt;<i>
</I>&gt;<i> http_access deny manager
</I>&gt;<i> http_access allow purge localhost
</I>&gt;<i> http_access deny purge
</I>&gt;<i> http_access deny !safeports
</I>&gt;<i> http_access deny CONNECT !sslports
</I>&gt;<i>
</I>&gt;<i> # Always allow localhost connections
</I>&gt;<i> http_access allow localhost
</I>&gt;<i>
</I>&gt;<i> quick_abort_min 0 KB
</I>&gt;<i> quick_abort_max 0 KB
</I>&gt;<i> quick_abort_pct 95
</I>&gt;<i> request_body_max_size 0 KB
</I>&gt;<i> delay_pools 1
</I>&gt;<i> delay_class 1 2
</I>&gt;<i> delay_parameters 1 -1/-1 -1/-1
</I>&gt;<i> delay_initial_bucket_level 100
</I>&gt;<i> delay_access 1 allow allsrc
</I>&gt;<i>
</I>&gt;<i> # Reverse Proxy settings
</I>&gt;<i>
</I>&gt;<i> deny_info TCP_RESET allsrc
</I>&gt;<i>
</I>&gt;<i> # Package Integration
</I>&gt;<i> url_rewrite_program /usr/local/bin/squidGuard -c /usr/local/etc/squidGuard/squidGuard.conf
</I>&gt;<i> url_rewrite_bypass off
</I>&gt;<i> url_rewrite_children 32 startup=8 idle=4 concurrency=0
</I>&gt;<i>
</I>
Squidguard is very outdated. You should upgrade to its successor
ufdbguard if possible.



&gt;<i> # Custom options before auth
</I>&gt;<i> #host_verify_strict on
</I>&gt;<i>
</I>&gt;<i> # These hosts are banned
</I>&gt;<i> http_access deny banned_hosts
</I>&gt;<i> # Always allow access to whitelist domains
</I>&gt;<i> http_access allow whitelist
</I>&gt;<i> # Block access to blacklist domains
</I>&gt;<i> http_access deny blacklist
</I>&gt;<i> # List of domains allowed to logging in to Google services
</I>&gt;<i> request_header_access X-GoogApps-Allowed-Domains deny all
</I>&gt;<i> request_header_add X-GoogApps-Allowed-Domains consumer_accounts
</I>&gt;<i> # Set YouTube safesearch restriction
</I>&gt;<i> acl youtubedst dstdomain -n www.youtube.com&lt;<A HREF="http://www.youtube.com">http://www.youtube.com</A>&gt; m.youtube.com youtubei.googleapis.com youtube.googleapis.com www.youtube-nocookie.com&lt;<A HREF="http://www.youtube-nocookie.com">http://www.youtube-nocookie.com</A>&gt;
</I>&gt;<i> request_header_access YouTube-Restrict deny all
</I>&gt;<i> request_header_add YouTube-Restrict none youtubedst
</I>&gt;<i> acl sglog url_regex -i sgr=ACCESSDENIED
</I>&gt;<i> http_access deny sglog
</I>&gt;<i> # Custom SSL/MITM options before auth
</I>&gt;<i> acl manager proto cache_object
</I>&gt;<i> acl localhost src 192.168.1.1/32&lt;<A HREF="http://192.168.1.1/32">http://192.168.1.1/32</A>&gt;
</I>&gt;<i> #cachemgr_passwd disable offline_toggle reconfigure shutdown
</I>&gt;<i> #cachemgr_passwd secret all
</I>&gt;<i> acl https_login url_regex -i ^https.*(login|Login).*
</I>&gt;<i> acl no_miss url_regex -i ^.*gateway.facebook.com/ws/realtime?&lt;<A HREF="http://gateway.facebook.com/ws/realtime?">http://gateway.facebook.com/ws/realtime?</A>&gt;
</I>&gt;<i> acl no_miss url_regex -i ^.*web-chat-e2ee.facebook.com/ws/chat&lt;<A HREF="http://web-chat-e2ee.facebook.com/ws/chat">http://web-chat-e2ee.facebook.com/ws/chat</A>&gt;
</I>&gt;<i> acl CONNECT method CONNECT
</I>&gt;<i> acl wuCONNECT dstdomain www.update.microsoft.com&lt;<A HREF="http://www.update.microsoft.com">http://www.update.microsoft.com</A>&gt;
</I>&gt;<i> acl wuCONNECT dstdomain sls.microsoft.com
</I>&gt;<i> http_access allow CONNECT wuCONNECT localnet
</I>&gt;<i> http_access allow CONNECT wuCONNECT localhost
</I>&gt;<i> http_access allow windowsupdate localnet
</I>&gt;<i> http_access allow windowsupdate localhost
</I>&gt;<i> http_access deny manager
</I>&gt;<i>
</I>&gt;<i> acl BrokenButTrustedServers dstdomain '/usr/local/pkg/dstdom.broken'
</I>&gt;<i> acl DomainMismatch ssl_error SQUID_X509_V_ERR_DOMAIN_MISMATCH
</I>&gt;<i> sslproxy_cert_error allow BrokenButTrustedServers DomainMismatch
</I>&gt;<i> sslproxy_cert_error deny all
</I>&gt;<i>
</I>&gt;<i> acl splice_only src 192.168.1.8 #Tasha iPhone
</I>&gt;<i> acl splice_only src 192.168.1.10 #Jon iPhone
</I>&gt;<i> acl splice_only src 192.168.1.11 #Amazon Fire
</I>&gt;<i> acl splice_only src 192.168.1.15 #Tasha HP
</I>&gt;<i> acl splice_only src 192.168.1.16 #iPad
</I>&gt;<i>
</I>&gt;<i> acl NoSSLIntercept ssl::server_name_regex -i '/usr/local/pkg/url.nobump'
</I>&gt;<i>
</I>&gt;<i> acl markBumped annotate_client bumped=true
</I>&gt;<i> acl bump_only src 192.168.1.3 #webtv
</I>&gt;<i> acl bump_only src 192.168.1.4 #toshiba
</I>&gt;<i> acl bump_only src 192.168.1.5 #imac
</I>&gt;<i> acl bump_only src 192.168.1.9 #macbook
</I>&gt;<i> acl bump_only src 192.168.1.13 #dell
</I>&gt;<i>
</I>
You have a previous &quot;cache allow all&quot;. This below rule does nothing.

&gt;<i> cache deny https_login
</I>&gt;<i>
</I>&gt;<i> ssl_bump peek step1
</I>&gt;<i> miss_access deny no_miss
</I>&gt;<i> ssl_bump splice https_login
</I>&gt;<i> ssl_bump splice splice_only
</I>&gt;<i> ssl_bump splice NoSSLIntercept
</I>&gt;<i> ssl_bump bump bump_only markBumped
</I>&gt;<i> ssl_bump stare all
</I>&gt;<i>
</I>&gt;<i> acl markedBumped note bumped true
</I>&gt;<i> url_rewrite_access deny markedBumped
</I>&gt;<i>
</I>&gt;<i> http_access deny all
</I>&gt;<i> read_ahead_gap 32 KB
</I>&gt;<i> negative_ttl 1 second
</I>&gt;<i> connect_timeout 30 seconds
</I>&gt;<i> request_timeout 60 seconds
</I>&gt;<i> half_closed_clients off
</I>&gt;<i> shutdown_lifetime 10 seconds
</I>&gt;<i> negative_dns_ttl 1 seconds
</I>&gt;<i> ignore_unknown_nameservers on
</I>&gt;<i> pipeline_prefetch 100
</I>&gt;<i>
</I>&gt;<i> #acl SSLIntercept ssl::server_name_regex -i '/usr/local/pkg/url.bump'
</I>&gt;<i> #ssl_bump bump SSLIntercept
</I>&gt;<i>
</I>
You already have an earlier &quot;http_access deny all&quot;. The below lines do
nothing.

&gt;<i> # Setup allowed ACLs
</I>&gt;<i> # Allow local network(s) on interface(s)
</I>&gt;<i> http_access allow localnet
</I>&gt;<i> # Default block all to be sure
</I>&gt;<i> http_access deny allsrc
</I>&gt;<i>
</I>

HTH
Amos


------------------------------

Subject: Digest Footer

_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
<A HREF="https://lists.squid-cache.org/listinfo/squid-users&lt;https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users&lt;https://lists.squid-cache.org/listinfo/squid-users</A>&gt;


------------------------------

End of squid-users Digest, Vol 116, Issue 7
*******************************************
CONFIDENTIALITY NOTICE: The information contained in and attached to this email is intended only for the confidential use of the person or entity to which the email is addressed. This email and any attachments may contain privileged and confidential information. If you are not the intended recipient, you are notified that you received this email in error and that any reading, retention, use or distribution of this email and attachments is strictly prohibited. If you received this email in error, you are requested to immediately notify us by calling 888-728-3550 or by return email and immediately and permanently delete the email and any attachments. Thank you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20240410/80de5108/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20240410/80de5108/attachment.htm</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0.jpg
Type: image/jpeg
Size: 6398 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20240410/80de5108/attachment.jpg">http://lists.squid-cache.org/pipermail/squid-users/attachments/20240410/80de5108/attachment.jpg</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="026585.html">[squid-users] SQUID_TLS_ERR_ACCEPT+TLS_LIB_ERR=A000417+TLS_IO_ERR
</A></li>
	<LI>Next message (by thread): <A HREF="026569.html">[squid-users] [External] squid-users Digest, Vol 116, Issue 7
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26567">[ date ]</a>
              <a href="thread.html#26567">[ thread ]</a>
              <a href="subject.html#26567">[ subject ]</a>
              <a href="author.html#26567">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
