<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] SQUID_TLS_ERR_ACCEPT+TLS_LIB_ERR=A000417+TLS_IO_ERR
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%0A%20SQUID_TLS_ERR_ACCEPT%2BTLS_LIB_ERR%3DA000417%2BTLS_IO_ERR&In-Reply-To=%3CDBCEC9C5-E27E-4807-B6CF-39CF5B32B56F%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026571.html">
   <LINK REL="Next"  HREF="026573.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] SQUID_TLS_ERR_ACCEPT+TLS_LIB_ERR=A000417+TLS_IO_ERR</H1>
    <B>Jonathan Lee</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%0A%20SQUID_TLS_ERR_ACCEPT%2BTLS_LIB_ERR%3DA000417%2BTLS_IO_ERR&In-Reply-To=%3CDBCEC9C5-E27E-4807-B6CF-39CF5B32B56F%40gmail.com%3E"
       TITLE="[squid-users] SQUID_TLS_ERR_ACCEPT+TLS_LIB_ERR=A000417+TLS_IO_ERR">jonathanlee571 at gmail.com
       </A><BR>
    <I>Wed Apr 10 21:26:17 UTC 2024</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="026571.html">[squid-users] SQUID_TLS_ERR_ACCEPT+TLS_LIB_ERR=A000417+TLS_IO_ERR
</A></li>
        <LI>Next message (by thread): <A HREF="026573.html">[squid-users] SQUID_TLS_ERR_ACCEPT+TLS_LIB_ERR=A000417+TLS_IO_ERR
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26572">[ date ]</a>
              <a href="thread.html#26572">[ thread ]</a>
              <a href="subject.html#26572">[ subject ]</a>
              <a href="author.html#26572">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I think they also did fail silently in the older version because the error logs were not present for previous packages that I used. At one point all error logs were removed in a package and I had to create a linker file to see the basic errors. Squid 6.6 comes with the error logs I could not see, previously 5.8 and prior it would create many blank logs that had no information.  

In 5.8 the squid -k parse did not show the 
WARNING: Failed to decode EC parameters '/etc/dh-parameters.2048'. error:1E08010C:DECODER routines::unsupported
However it did show this in 5.8, 5.9,  and now in 6.6 if I delete the options it no longer lists the error.

2024/04/10 14:21:48| ERROR: Unsupported TLS option SINGLE_DH_USE
2024/04/10 14:21:48| ERROR: Unsupported TLS option SINGLE_ECDH_USE
It works I can block URLS that is what I am confused about it shows hit 304 and refreshes in 5.9 however 6.6 it kick abandons my connections 

5.8 is my everything bagel version it just works however like you said is the errors not showing as it is slow at times 


&gt;<i> On Apr 10, 2024, at 14:13, Alex Rousskov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> On 2024-04-10 16:22, Jonathan Lee wrote:
</I>&gt;&gt;<i> Could it be related to this ??
</I>&gt;&gt;<i> &quot;WARNING: Failed to decode EC parameters '/etc/dh-parameters.2048'. error:1E08010C:DECODER routines::unsupported&#8221;
</I>&gt;<i> 
</I>&gt;<i> I do not know the answer to your question. I speculate that it could be related: Depending on various factors, without those DH parameters, Squid may not be able to communicate with clients. See WARNING in tls-dh description in squid.conf.documented.
</I>&gt;<i> 
</I>&gt;<i> I know that others are reporting similar WARNINGs during v6 upgrades and dislike the letters &quot;EC&quot; those messages use. I am not going to debate the best choice of letters for this message, but I can tell you that, in the cases I investigated, the message was caused by a mismatch between squid.conf tls-dh=... option value and DH parameter file contents:
</I>&gt;<i> 
</I>&gt;<i> * To Squid, tls-dh=curve:filename format implies that the keytype is &quot;EC&quot;. These two letters are then fed to an OpenSSL function that configures related TLS state. OpenSSL then fails if tls-dh filename contains DH parameters produced with &quot;openssl dhparam&quot; command. I have seen these failures in tests.
</I>&gt;<i> 
</I>&gt;<i> * To Squid, tls-dh=filename format (i.e. format without the curve name prefix) implies that the keytype is &quot;DC&quot;. These two letters are then fed to an OpenSSL function that configured related TLS state. OpenSSL then probably fails if tls-dh filename contains DH parameters produced with &quot;openssl ecparam&quot; command. I have not tested this use case.
</I>&gt;<i> 
</I>&gt;<i> * The failing checks and their messages are specific to Squids built with OpenSSL v3. It is possible that Squids built with OpenSSL v1 just silently fail (at runtime), but I have not checked that theory.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> FWIW, this poorly categorized message indicates a configuration _error_. AFAICT, Squid code should be adjusted to _quit_ (i.e. reject bad configuration) after discovering this error instead of continuing as if nothing bad happened.
</I>&gt;<i> 
</I>&gt;<i> I recommend addressing the underlying cause, even if this message is unrelated to SQUID_TLS_ERR_ACCEPT+TLS_LIB_ERR=A000417.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> HTH,
</I>&gt;<i> 
</I>&gt;<i> Alex.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;&gt;<i> On Apr 10, 2024, at 08:38, Alex Rousskov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt; wrote:
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> On 2024-04-10 10:50, Jonathan Lee wrote:
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> I am getting the following error in 6.6 after a upgrade from 5.8 does anyone know what this is caused by?
</I>&gt;&gt;&gt;&gt;<i> SQUID_TLS_ERR_ACCEPT+TLS_LIB_ERR=A000417+TLS_IO_ERR
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i>    $ openssl errstr A000417
</I>&gt;&gt;&gt;<i>    error:0A000417:SSL routines::sslv3 alert illegal parameter
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> I think I have seen that error code before, but I do not recall the exact circumstances. Sorry! The error happens when Squid tries to accept (or peek at) a TLS connection from the client. Might be prohibited TLS version/feature, TLS greasing, or non-TLS traffic? Try examining client TLS Hello packet(s) in Wireshark.
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> Alex.
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> 
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20240410/e664f688/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20240410/e664f688/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="026571.html">[squid-users] SQUID_TLS_ERR_ACCEPT+TLS_LIB_ERR=A000417+TLS_IO_ERR
</A></li>
	<LI>Next message (by thread): <A HREF="026573.html">[squid-users] SQUID_TLS_ERR_ACCEPT+TLS_LIB_ERR=A000417+TLS_IO_ERR
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26572">[ date ]</a>
              <a href="thread.html#26572">[ thread ]</a>
              <a href="subject.html#26572">[ subject ]</a>
              <a href="author.html#26572">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
