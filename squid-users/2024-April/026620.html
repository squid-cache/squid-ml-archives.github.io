<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Error during ICAP RESPMOD
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Error%20during%20ICAP%20RESPMOD&In-Reply-To=%3C37699563.3545988.1714008214587%40mail.yahoo.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026619.html">
   <LINK REL="Next"  HREF="026621.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Error during ICAP RESPMOD</H1>
    <B>Arun Kumar</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Error%20during%20ICAP%20RESPMOD&In-Reply-To=%3C37699563.3545988.1714008214587%40mail.yahoo.com%3E"
       TITLE="[squid-users] Error during ICAP RESPMOD">s_p_arun at yahoo.com
       </A><BR>
    <I>Thu Apr 25 01:23:34 UTC 2024</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="026619.html">[squid-users] Error during ICAP RESPMOD
</A></li>
        <LI>Next message (by thread): <A HREF="026621.html">[squid-users] tls_key_log
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26620">[ date ]</a>
              <a href="thread.html#26620">[ thread ]</a>
              <a href="subject.html#26620">[ subject ]</a>
              <a href="author.html#26620">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE> I managed to reproduce the problem in my personal setup. Please find the cache logs when the problem is reproduced. Squid version is 5.8
<A HREF="https://drive.google.com/file/d/19yirXfxKli7NXon4ewiy-v3GpLvECT1i/view?usp=sharing">https://drive.google.com/file/d/19yirXfxKli7NXon4ewiy-v3GpLvECT1i/view?usp=sharing</A>

    On Wednesday, April 24, 2024 at 09:16:23 PM EDT, Arun Kumar &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">s_p_arun at yahoo.com</A>&gt; wrote:  
 
  I managed to reproduce the problem in my personal setup. Please find the cache logs when the problem is reproduced. Squid version is 5.8
cache.zip


|<i>  | 
</I>cache.zip
 |



|<i> 
</I>|<i> 
</I>|<i>  | 
</I>cache.zip


 |

 |

 |






    On Friday, March 22, 2024 at 11:02:51 PM EDT, Alex Rousskov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt; wrote:  
 
 On 2024-03-22 13:11, Arun Kumar wrote:
&gt;<i> The lines above are. The content-length is 138 (8a in hex), but the 
</I>&gt;<i> bytes are 144. Could this be the reason?
</I>&gt;<i> 
</I>&gt;<i> parseMore: have 144 bytes to parse [FD 14;RBG/Comm(14)wr job24]
</I>&gt;<i> parseMore:
</I>&gt;<i> 8a^M
</I>&gt;<i> {&quot;activity&quot;:&quot;Make a simple musical 
</I>&gt;<i> instrument&quot;,&quot;type&quot;:&quot;music&quot;,&quot;participants&quot;:1,&quot;price:0.4,&quot;link&quot;:&quot;&quot;,&quot;key&quot;:&quot;7091374&quot;,&quot;accessibility&quot;:0.25}^M
</I>&gt;<i> parseHeaders: parse ICAP headers
</I>&gt;<i> parsePart: have 144 head bytes to parse; state: 0
</I>&gt;<i> parsePart: head parsing result: 0 detail: 600
</I>

I cannot be sure based on the tiny snippets shared so far, but it 
_looks_ like Squid expected an ICAP response header and got an ICAP 
response body chunk instead. It is also possible that we are looking at 
log lines from two unrelated ICAP transactions, or I am simply 
misinterpreting the snippets.

If you want a more reliable diagnosis, then my earlier recommendation 
regarding sharing (privately if needed) the following information still 
stands:

* compressed ALL,9 cache.log and
* the problematic ICAP response in a raw packet capture format.


HTH,

Alex.


&gt;<i> On Monday, March 18, 2024 at 11:21:02 PM EDT, Alex Rousskov 
</I>&gt;<i> &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On 2024-03-18 18:46, Arun Kumar wrote:
</I>&gt;<i> 
</I>&gt;<i>&#160; &gt; Any idea, the reason for error in ModXact.cc parsePart fuction.
</I>&gt;<i>&#160; &gt; Happening during parsing the response from ICAP
</I>&gt;<i>&#160; &gt;
</I>&gt;<i>&#160; &gt;
</I>&gt;<i>&#160; &gt; parsePart: have 144 head bytes to parse; state: 0
</I>&gt;<i>&#160; &gt; parsePart: head parsing result: 0 detail: 600
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> AFAICT, Squid considers received ICAP response header malformed. More
</I>&gt;<i> than five possible problems/cases may match the above lines. The answer
</I>&gt;<i> to your question (or an additional clue!) is in different debugging
</I>&gt;<i> output, possibly logged somewhere between the two lines quoted above.
</I>&gt;<i> The right debugging lines may be visible in &quot;debug_options ALL,2 58,5,
</I>&gt;<i> 93,5&quot; output, but it is usually best to share compressed ALL,9 logs
</I>&gt;<i> (privately if needed).
</I>&gt;<i> 
</I>&gt;<i> <A HREF="https://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction">https://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction</A> &lt;<A HREF="https://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction">https://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Sharing the problematic ICAP response (header) in a raw packet capture
</I>&gt;<i> format (to preserve important details) may also be very useful.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> HTH,
</I>&gt;<i> 
</I>&gt;<i> Alex.
</I>&gt;<i> 
</I>&gt;<i> 
</I>
    
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20240425/dce138fc/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20240425/dce138fc/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="026619.html">[squid-users] Error during ICAP RESPMOD
</A></li>
	<LI>Next message (by thread): <A HREF="026621.html">[squid-users] tls_key_log
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26620">[ date ]</a>
              <a href="thread.html#26620">[ thread ]</a>
              <a href="subject.html#26620">[ subject ]</a>
              <a href="author.html#26620">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
