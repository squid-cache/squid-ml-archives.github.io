<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid 5.7 FTP upload fails
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%205.7%20FTP%20upload%20fails&In-Reply-To=%3Cb3a43edb-4161-4142-8140-cf369524ccb5%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027028.html">
   <LINK REL="Next"  HREF="027030.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid 5.7 FTP upload fails</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%205.7%20FTP%20upload%20fails&In-Reply-To=%3Cb3a43edb-4161-4142-8140-cf369524ccb5%40measurement-factory.com%3E"
       TITLE="[squid-users] squid 5.7 FTP upload fails">rousskov at measurement-factory.com
       </A><BR>
    <I>Thu Aug  8 17:13:59 UTC 2024</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="027028.html">[squid-users] squid 5.7 FTP upload fails
</A></li>
        <LI>Next message (by thread): <A HREF="027030.html">[squid-users] squid 5.7 FTP upload fails
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27029">[ date ]</a>
              <a href="thread.html#27029">[ thread ]</a>
              <a href="subject.html#27029">[ subject ]</a>
              <a href="author.html#27029">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2024-08-08 10:53, Matus UHLAR - fantomas wrote:
&gt;&gt;<i> On 2024-08-08 06:19, Matus UHLAR - fantomas wrote:
</I>&gt;&gt;&gt;<i> Perhaps configuring proper debug_options, but which?
</I>&gt;<i> 
</I>&gt;<i> On 08.08.24 08:15, Alex Rousskov wrote:
</I>&gt;&gt;<i> Yes, we should escalate triage to debugging log analysis. I am willing 
</I>&gt;&gt;<i> to study your ALL,9 cache.log collected from Squid v6 while 
</I>&gt;&gt;<i> reproducing the problem using a single transaction (or as few 
</I>&gt;&gt;<i> transactions as possible). Please share a pointer to compressed 
</I>&gt;&gt;<i> cache.log file (privately of needed). You probably do not need them, 
</I>&gt;&gt;<i> but there are a few relevant hints at 
</I>&gt;&gt;<i> <A HREF="https://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction">https://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction</A>
</I>
&gt;<i> The bad news is that &quot;debug_options ALL,9&quot; caused test upload to succeed
</I>&gt;<i> (multiple attempts). After commenting it out it fails again.
</I>
You are probably dealing with a race condition of some kind, but I would 
prefer not to speculate about the nature of this bug at this time.

Please try &quot;ALL,3 33,5 9,5&quot;. Slowly decrease &quot;5&quot;s until you can 
reproduce. Share the log from that test.

Please note that we do not need to have a reliable test at this point. 
We only need a single test run that reproduces the problem (with enough 
debugging enabled). Once we know more about the bug, we may be able to 
either fix it or adjust debugging instructions to ease reproduction...


&gt;<i> however the &quot;* We are completely uploaded and fine&quot; message is new here
</I>&gt;<i> (but doesn't appear all the time)
</I>
Ideally, we want debugging cache.log from a failed test without that 
message, but we can start with a test that does have one if that is the 
only one you can produce right now.

Cheers,

Alex.


&gt;<i> I also tried 9,9 without success.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Could errors like this be caused by something like lacking fflush() on 
</I>&gt;<i> socket?
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> # curl -v --no-progress-meter -x 192.168.A.B:3128 -T cruft.out.gz -u 
</I>&gt;<i> &quot;anonymous:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">dummy at example.net</A>&quot; <A HREF="ftp://example.net/incoming/">ftp://example.net/incoming/</A>
</I>&gt;<i> *&#160;&#160; Trying 192.168.A.B:3128...
</I>&gt;<i> * Connected to 192.168.A.B (192.168.A.B) port 3128 (#0)
</I>&gt;<i> * Server auth using Basic with user 'anonymous'
</I>&gt;&gt;<i> PUT 
</I>&gt;&gt;<i> <A HREF="ftp://anonymous:dummy%40example.net@example.net/incoming/cruft.out.gz">ftp://anonymous:dummy%40example.net@example.net/incoming/cruft.out.gz</A> 
</I>&gt;&gt;<i> HTTP/1.1
</I>&gt;&gt;<i> Host: example.net:21
</I>&gt;&gt;<i> Authorization: Basic YW5vbnltb3VzOmR1bW15QGV4YW1wbGUubmV0
</I>&gt;&gt;<i> User-Agent: curl/7.88.1
</I>&gt;&gt;<i> Accept: */*
</I>&gt;&gt;<i> Proxy-Connection: Keep-Alive
</I>&gt;&gt;<i> Content-Length: 10438601
</I>&gt;&gt;<i> Expect: 100-continue
</I>&gt;&gt;<i>
</I>&gt;<i> * Done waiting for 100-continue
</I>&gt;<i> } [65536 bytes data]
</I>&gt;<i> * We are completely uploaded and fine
</I>&gt;<i> * Recv failure: Connection reset by peer
</I>&gt;<i> * Closing connection 0
</I>&gt;<i> curl: (56) Recv failure: Connection reset by peer
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="027028.html">[squid-users] squid 5.7 FTP upload fails
</A></li>
	<LI>Next message (by thread): <A HREF="027030.html">[squid-users] squid 5.7 FTP upload fails
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27029">[ date ]</a>
              <a href="thread.html#27029">[ thread ]</a>
              <a href="subject.html#27029">[ subject ]</a>
              <a href="author.html#27029">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
