<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid 5.7 FTP upload fails
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%205.7%20FTP%20upload%20fails&In-Reply-To=%3C0ebd735b-1655-4cfe-8a83-53e871bd3330%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027030.html">
   <LINK REL="Next"  HREF="027032.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid 5.7 FTP upload fails</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%205.7%20FTP%20upload%20fails&In-Reply-To=%3C0ebd735b-1655-4cfe-8a83-53e871bd3330%40measurement-factory.com%3E"
       TITLE="[squid-users] squid 5.7 FTP upload fails">rousskov at measurement-factory.com
       </A><BR>
    <I>Fri Aug  9 13:51:29 UTC 2024</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="027030.html">[squid-users] squid 5.7 FTP upload fails
</A></li>
        <LI>Next message (by thread): <A HREF="027032.html">[squid-users] squid 5.7 FTP upload fails
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27031">[ date ]</a>
              <a href="thread.html#27031">[ thread ]</a>
              <a href="subject.html#27031">[ subject ]</a>
              <a href="author.html#27031">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2024-08-09 09:03, Matus UHLAR - fantomas wrote:

&gt;<i> FTR, I sent the info privately, but we can continue discussing/solving 
</I>&gt;<i> it here.
</I>
&gt;<i> maybeMakeSpaceAvailable: request buffer full: client_request_buffer_max_size=524288
</I>&gt;<i> ReadNow: ... size 0, retval 0, errno 0
</I>&gt;<i> terminateAll: 1/1 after ERR_CLIENT_GONE/WITH_CLIENT
</I>
AFAICT, you are suffering from a Squid bug that goes back to 2015 commit 
4d1376d7 (that was fixing Squid bug 4206) or even earlier code. Red 
flags were raised back in 2015, but nobody followed through. We need to 
refactor Server::maybeMakeSpaceAvailable()-related code to fix this bug.

FWIW, we did similar work for Squid-to-peer communication in commit 
cc8b26f9 and commit 50c5af88. Similar principles should apply to 
client-Squid communication. Unfortunately, I do not have enough free 
time to volunteer to fix this client-Squid bug now.

At the expense of using more memory for some upload cases, you may be 
able to work around the bug in some (but not all!) cases by making 
client_request_buffer_max_size sufficiently large. For example, setting 
client_request_buffer_max_size to 16 megabytes may allow you to pass the 
test case you have privately shared.


HTH,

Alex.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="027030.html">[squid-users] squid 5.7 FTP upload fails
</A></li>
	<LI>Next message (by thread): <A HREF="027032.html">[squid-users] squid 5.7 FTP upload fails
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27031">[ date ]</a>
              <a href="thread.html#27031">[ thread ]</a>
              <a href="subject.html#27031">[ subject ]</a>
              <a href="author.html#27031">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
