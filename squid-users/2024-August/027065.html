<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Unable to access local addresses
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Unable%20to%20access%20local%20addresses&In-Reply-To=%3C9efc7b92c5b044ccab9f1606654dd3f9%40hexcel.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027060.html">
   <LINK REL="Next"  HREF="027066.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Unable to access local addresses</H1>
    <B>Piana, Josh</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Unable%20to%20access%20local%20addresses&In-Reply-To=%3C9efc7b92c5b044ccab9f1606654dd3f9%40hexcel.com%3E"
       TITLE="[squid-users] Unable to access local addresses">Josh.Piana at hexcel.com
       </A><BR>
    <I>Fri Aug 23 16:07:26 UTC 2024</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="027060.html">[squid-users] squid 6.10 - Debian 12 undefined reference to `EVP_MD_type' in ssl-crtd
</A></li>
        <LI>Next message (by thread): <A HREF="027066.html">[squid-users] Unable to access local addresses
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27065">[ date ]</a>
              <a href="thread.html#27065">[ thread ]</a>
              <a href="subject.html#27065">[ subject ]</a>
              <a href="author.html#27065">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Squid Support,

We upgraded our Squid Web Proxy from 2.5 to 5.5 recently. After working out a few issues with backend services and authentication, our client can finally browse the web and adhere to all of the ACL rules and lists as expected.

The problem we're having now is that we're unable to access local resources on different subnets. For instance, our &quot;main&quot; networks are 10.46.x.x and 10.47.x.x, but the proxy is blocking us when we try to get to 172.26.x.x as well as 10.96.x.x. When comparing our current config to the old, they are very nearly identical, and the old config works with no issue. Is there some change from 2.5 -&gt; 5.5 that would stop some of our allow/deny rules from working as expected? Or maybe I need to open up the ACL's a bit more or define those subnets explicitly now?

I can post our config below, I'll skip the sections that most likely don't pertain to the issue.

##############################################################################
# Authentication
##############################################################################

auth_param negotiate program /usr/lib64/squid/negotiate_kerberos_auth -k /etc/squid/HTTP.keytab -s HTTP/&lt;domain&gt;.ad.&lt;domain&gt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">.com at AD.</A>&lt;domain&gt;.COM
auth_param negotiate children 10
auth_param negotiate keep_alive on
acl kerb-auth proxy_auth REQUIRED

##############################################################################
# Access control - shared/common ACL definitions
##############################################################################

# acl all src all

acl src_self src 127.0.0.0/8
acl src_self src 10.46.11.69

acl dst_self dst 127.0.0.0/8
acl dst_self dst 10.46.11.69

acl from_arc src 10.46.0.0/16
acl from_arc src 10.46.0.0/15

acl local_dst_addr dst 10.0.0.0/8
acl local_dst_addr dst bldg3.&lt;domain&gt;.com
acl local_dst_addr dst bldg5.&lt;domain&gt;.com

# not sure what this does
acl local_dst_dom dstdomain &lt;proxy hostname&gt;

# protocols
acl proto_FTP proto FTP
acl proto_HTTP proto HTTP

# TCP ports for HTTP
acl http_ports port 80
acl http_ports port 81

# TCP ports for HTTPS
acl ssl_ports port 443

acl ssh_ports port 22
acl ftp_ports port 21

# HTTP methods
acl method_CONNECT method CONNECT

# what are these used for?
dsacl methods_std method GET HEAD POST PUT DELETE
acl methods_std method TRACE OPTIONS

#############################################################################
# Access control - general proxy
##############################################################################

http_access deny dst_self
http_access deny src_self
http_access deny !from_arc

http_access       allow local_dst_dom
http_reply_access           allow local_dst_dom

http_access       allow local_dst_addr
http_reply_access           allow local_dst_addr

acl authless_src src &quot;/etc/squid/authless_src&quot;
http_access       allow authless_src
http_reply_access           allow authless_src

acl authless_dst dstdomain &quot;/etc/squid/authless_dst&quot;
http_access       allow authless_dst
http_reply_access           allow authless_dst

acl bad_domains_preauth dstdomain &quot;/etc/squid/bad_domains_preauth&quot;
http_access deny bad_domains_preauth

acl block_user proxy_auth_regex -i &quot;/etc/squid/block_user&quot;
http_access deny block_user

acl bad_exception_urls url_regex -i &quot;/etc/squid/bad_exception_urls&quot;

acl exec_files url_regex -i &quot;/etc/squid/exec_files&quot;
acl exec_users proxy_auth_regex -i &quot;/etc/squid/exec_users&quot;

http_access deny !bad_exception_urls !exec_users exec_files
deny_info ERR_BLOCK_TYPE exec_files

acl mmedia_users proxy_auth_regex -i &quot;/etc/squid/mmedia_users&quot;
acl mmedia_sites dstdomain &quot;/etc/squid/mmedia_sites&quot;

http_access       allow methods_std    proto_HTTP http_ports mmedia_sites mmedia_users
http_reply_access allow methods_std    proto_HTTP http_ports mmedia_sites mmedia_users

http_access       allow method_CONNECT            ssl_ports  mmedia_sites mmedia_users
http_reply_access allow method_CONNECT            ssl_ports  mmedia_sites mmedia_users

acl bad_domains dstdomain &quot;/etc/squid/bad_domains&quot;
http_access deny !bad_exception_urls bad_domains
deny_info ERR_BLOCK_DST         bad_domains

acl bad_domains_regex dstdom_regex -i &quot;/etc/squid/bad_domains_regex&quot;
http_access deny !bad_exception_urls bad_domains_regex
deny_info ERR_BLOCK_DST         bad_domains_regex

acl bad_urls url_regex -i &quot;/etc/squid/bad_urls&quot;
http_access deny !bad_exception_urls bad_urls
deny_info ERR_BLOCK_DST         bad_urls

acl bad_files urlpath_regex -i &quot;/etc/squid/bad_files&quot;
http_access deny !bad_exception_urls bad_files
deny_info ERR_BLOCK_TYPE bad_files

acl bad_types rep_mime_type -i &quot;/etc/squid/bad_types&quot;
http_reply_access deny bad_types !bad_exception_urls
deny_info ERR_BLOCK_TYPE bad_types

acl fsoguest_user proxy_auth_regex -i fsoguest
acl fsoguest_dst dstdomain .opm.gov
acl fsoguest_dst dstdomain .google-analytics.com
acl fsoguest_dst dstdomain pki.google.com
acl fsoguest_dst dstdomain ajax.googleapis.com
acl fsoguest_dst dstdomain fonts.googleapis.com
acl fsoguest_dst dstdomain html5shiv.googlecode.com
acl fsoguest_dst dstdomain fonts.gstatic.com
acl fsoguest_dst dstdomain clients1.google.com
acl fsoguest_dst dstdomain ajax.microsoft.com
acl fsoguest_dst dstdomain ajax.aspnetcdn.com
acl fsoguest_dst dstdomain .geotrust.com
acl fsoguest_dst dstdomain .akamaihd.net
acl fsoguest_dst dstdomain symcd.com
http_access allow methods_std proto_HTTP http_ports fsoguest_dst fsoguest_user
http_access allow method_CONNECT         ssl_ports  fsoguest_dst fsoguest_user
http_access deny fsoguest_user

http_access allow http_ports proto_HTTP methods_std
http_access allow method_CONNECT ssl_ports
http_access deny method_CONNECT

# catch-all
http_access allow ftp_ports proto_FTP
http_access allow kerb-auth
http_access deny all
http_reply_access allow all

##############################################################################
# END OF FILE
##############################################################################
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20240823/59f38198/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20240823/59f38198/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="027060.html">[squid-users] squid 6.10 - Debian 12 undefined reference to `EVP_MD_type' in ssl-crtd
</A></li>
	<LI>Next message (by thread): <A HREF="027066.html">[squid-users] Unable to access local addresses
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27065">[ date ]</a>
              <a href="thread.html#27065">[ thread ]</a>
              <a href="subject.html#27065">[ subject ]</a>
              <a href="author.html#27065">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
