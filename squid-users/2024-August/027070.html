<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid traffic paths
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20traffic%20paths&In-Reply-To=%3Ce2a5b503-e598-4c41-bd65-30d4b35208b8%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027069.html">
   <LINK REL="Next"  HREF="027072.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid traffic paths</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20traffic%20paths&In-Reply-To=%3Ce2a5b503-e598-4c41-bd65-30d4b35208b8%40measurement-factory.com%3E"
       TITLE="[squid-users] Squid traffic paths">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Aug 27 18:29:24 UTC 2024</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="027069.html">[squid-users] Squid traffic paths
</A></li>
        <LI>Next message (by thread): <A HREF="027072.html">[squid-users] Rocky 8 new repo
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27070">[ date ]</a>
              <a href="thread.html#27070">[ thread ]</a>
              <a href="subject.html#27070">[ subject ]</a>
              <a href="author.html#27070">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2024-08-27 14:07, Scott Bates wrote:
&gt;<i> My lab is setup as such:
</I>&gt;<i> Hypervisor host
</I>&gt;<i> Squid VM
</I>&gt;<i> Test VM 1 (windows)
</I>&gt;<i> Test VM 2 (windows)
</I>&gt;<i> Test VM 3 (windows)
</I>&gt;<i> 
</I>&gt;<i> I have my proxies setup in the squid config. On the test vms I have the 
</I>&gt;<i> windows proxy settings pointing to the squid IP and port. If I check the 
</I>&gt;<i> public IP on that vm it shows up as the proxy IP. And in the proxy logs 
</I>&gt;<i> I see traffic going out.
</I>&gt;<i> 
</I>&gt;<i> The issue I'm having is that some external services are seeing the hosts 
</I>&gt;<i> public IP for the test vms and not the proxy ip.
</I>
What protocol do those external services use in problematic use cases? 
Does Squid see the corresponding requests from VMs? Squid can only proxy 
HTTP and FTP...


 &gt; I'm not exactly sure how squid handles all dns traffic.

Squid generates DNS queries (if needed) and, naturally, receives DNS 
answers for the queries it generates. Squid does not receive and, hence, 
does not forward/proxy DNS queries. There is no dns_port option in 
squid.conf; only http(s)_port and ftp_port.

 &gt; never_direct allow port3127_acl
 &gt; never_direct allow all

Pick one. The first (more restrictive) rule is not needed if you are 
going to allow all.


HTH,

Alex.


&gt;<i> Squid config:
</I>&gt;<i> *# First proxy
</I>&gt;<i> http_port 3127
</I>&gt;<i> acl port3127_acl myport 3127
</I>&gt;<i> cache_peer PROXYIP parent 9229 0 proxy-only no-query no-digest 
</I>&gt;<i> login=USERNAME:PASSWORD
</I>&gt;<i> cache_peer_access PROXYIP allow port3127_acl
</I>&gt;<i> cache_peer_access PROXYIP deny all
</I>&gt;<i> never_direct allow port3127_acl
</I>&gt;<i> never_direct allow all
</I>&gt;<i> http_access allow port3127_acl
</I>&gt;<i> # Deny caching on all proxies (optional)
</I>&gt;<i> cache deny all
</I>&gt;<i> # Default access control
</I>&gt;<i> http_access deny all
</I>&gt;<i> dns_nameservers 127.0.0.1
</I>&gt;<i> forwarded_for off
</I>&gt;<i> request_header_access X-Forwarded-For deny all*
</I>&gt;<i> 
</I>&gt;<i> I'm not exactly sure how squid handles all dns traffic. I feel like this 
</I>&gt;<i> might be a dns issue. I tried using google dns and the squid server ip 
</I>&gt;<i> as dns on the test vms but same issue.
</I>&gt;<i> I started to mess around with dnsmasq installed on squid but I'm not 
</I>&gt;<i> sure if I'm going down the right path or not.
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="027069.html">[squid-users] Squid traffic paths
</A></li>
	<LI>Next message (by thread): <A HREF="027072.html">[squid-users] Rocky 8 new repo
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27070">[ date ]</a>
              <a href="thread.html#27070">[ thread ]</a>
              <a href="subject.html#27070">[ subject ]</a>
              <a href="author.html#27070">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
