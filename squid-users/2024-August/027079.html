<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Unable to access internal resources via hostname
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Unable%20to%20access%20internal%20resources%20via%20hostname&In-Reply-To=%3Cfaffca37-fa59-46ff-80e4-245c37fa90b9%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027078.html">
   <LINK REL="Next"  HREF="027080.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Unable to access internal resources via hostname</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Unable%20to%20access%20internal%20resources%20via%20hostname&In-Reply-To=%3Cfaffca37-fa59-46ff-80e4-245c37fa90b9%40measurement-factory.com%3E"
       TITLE="[squid-users] Unable to access internal resources via hostname">rousskov at measurement-factory.com
       </A><BR>
    <I>Wed Aug 28 18:30:54 UTC 2024</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="027078.html">[squid-users] Unable to access internal resources via hostname
</A></li>
        <LI>Next message (by thread): <A HREF="027080.html">[squid-users] Unable to access internal resources via hostname
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27079">[ date ]</a>
              <a href="thread.html#27079">[ thread ]</a>
              <a href="subject.html#27079">[ subject ]</a>
              <a href="author.html#27079">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2024-08-28 14:18, Alex Rousskov wrote:
&gt;<i> On 2024-08-28 11:24, Piana, Josh wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> Here's the log and (I think) relevant ACL's?
</I>&gt;<i> 
</I>&gt;<i> According to your access.log, Squid denies problematic CONNECT requests 
</I>&gt;<i> with HTTP 407 errors responses. Usually, that means those requests match 
</I>&gt;<i> an &quot;http_access deny&quot; rule. Clearly, you expect an &quot;allow&quot; outcome 
</I>&gt;<i> instead, but it is difficult (for me) to figure out where your 
</I>&gt;<i> expectations mismatch reality; there are no rules that explicitly 
</I>&gt;<i> mention hexcelssp domain, for example: Which &quot;http_access allow&quot; rule do 
</I>&gt;<i> you expect those denied requests to match?
</I>
Sorry, I probably misinterpreted those access.log records: It looks like 
the denied (TCP_DENIED/407) access is something you actually expect 
because you want that test request to be authenticated. The client 
supplies the necessary credentials in the second request, and then that 
second request fails with a (rather generic) HTTP 500 error code, 
without contacting the origin server.

I am guessing that you are concerned about that second 
request/transaction rather than the first one.

Squid generates HTTP 500 errors for a variety of different reasons. Are 
there any messages in cache.log (at default debugging level) that 
correspond to these failing test transactions? If there are none, please 
add %err_code/%err_detail to your access_log logformat so that Squid 
logs more information about the problem to access.log (see logformat and 
access_log directives in squid.conf.documented for details).


Thank you,

Alex.



&gt;<i> Also, does mgr:ipcache cache manager query confirm that Squid has read 
</I>&gt;<i> your /etc/hosts file and cached the record you expect it to use?
</I>&gt;<i> 
</I>&gt;<i> Alex.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> -----------------------------------------------------------------------------------------------------------
</I>&gt;&gt;<i> # /var/log/squid/access.log results for internal conflicts
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 28/Aug/2024:10:57:17 -0400.234 10.46.49.190 TCP_DENIED/407 4132 
</I>&gt;&gt;<i> CONNECT hexcelssp:443 - HIER_NONE/- text/html
</I>&gt;&gt;<i> 28/Aug/2024:10:57:17 -0400.253 10.46.49.190 NONE_NONE/500 0 CONNECT 
</I>&gt;&gt;<i> hexcelssp:443 <A HREF="https://lists.squid-cache.org/listinfo/squid-users">JPIANA at AD.</A>&lt;DOMAIN&gt;.COM HIER_NONE/- -
</I>&gt;&gt;<i> 28/Aug/2024:10:57:17 -0400.380 10.46.49.190 TCP_DENIED/407 4132 
</I>&gt;&gt;<i> CONNECT hexcelssp:443 - HIER_NONE/- text/html
</I>&gt;&gt;<i> 28/Aug/2024:10:57:17 -0400.399 10.46.49.190 NONE_NONE/500 0 CONNECT 
</I>&gt;&gt;<i> hexcelssp:443 <A HREF="https://lists.squid-cache.org/listinfo/squid-users">JPIANA at AD.</A>&lt;DOMAIN&gt;.COM HIER_NONE/- -
</I>&gt;&gt;<i> -----------------------------------------------------------------------------------------------------------
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # acl all src all
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> acl src_self src 127.0.0.0/8
</I>&gt;&gt;<i> acl src_self src 10.46.11.69
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> acl dst_self dst 127.0.0.0/8
</I>&gt;&gt;<i> acl dst_self dst 10.46.11.69
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> acl from_arc src 10.46.0.0/15
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> acl local_dst_addr dst 10.0.0.0/8
</I>&gt;&gt;<i> acl local_dst_addr dst 172.0.0.0/8
</I>&gt;&gt;<i> acl local_dst_addr dst bldg3.&lt;domain&gt;.com
</I>&gt;&gt;<i> acl local_dst_addr dst bldg5.&lt;domain&gt;.com
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # these keep URLs of popular local servers from being forwarded
</I>&gt;&gt;<i> acl local_dst_dom dstdomain arcgate
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # allow connects to local destinations without authentication
</I>&gt;&gt;<i> # by domain name from URL
</I>&gt;&gt;<i> http_access&#160;&#160;&#160;&#160;&#160;&#160; allow local_dst_dom
</I>&gt;&gt;<i> http_reply_access allow local_dst_dom
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # by IP address name resolves to
</I>&gt;&gt;<i> http_access&#160;&#160;&#160;&#160;&#160;&#160; allow local_dst_addr
</I>&gt;&gt;<i> http_reply_access allow local_dst_addr
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # allow trusted hosts without authentication
</I>&gt;&gt;<i> # these are just ip's on the 10.46.11.x network
</I>&gt;&gt;<i> acl authless_src src &quot;/etc/squid/authless_src&quot;
</I>&gt;&gt;<i> http_access&#160;&#160;&#160;&#160;&#160;&#160; allow authless_src
</I>&gt;&gt;<i> http_reply_access allow authless_src
</I>&gt;&gt;<i> -----------------------------------------------------------------------------------------------------------
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> -----Original Message-----
</I>&gt;&gt;<i> From: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; On 
</I>&gt;&gt;<i> Behalf Of Matus UHLAR - fantomas
</I>&gt;&gt;<i> Sent: Wednesday, August 28, 2024 10:47 AM
</I>&gt;&gt;<i> To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i> Subject: Re: [squid-users] Unable to access internal resources via 
</I>&gt;&gt;<i> hostname
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Caution: This email originated from outside of Hexcel. Do not click 
</I>&gt;&gt;<i> links or open attachments unless you recognize the sender and know the 
</I>&gt;&gt;<i> content is safe.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On 28.08.24 14:20, Piana, Josh wrote:
</I>&gt;&gt;&gt;<i> Hello Squid Support,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This squid user forum FYI
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> We are unable to get to internal resources via hostname but using the
</I>&gt;&gt;&gt;<i> IP address works fine.&#160; Immediately, I thought this was DNS but when I
</I>&gt;&gt;&gt;<i> checked the /etc/resolv.conf/ file it was pointing correctly to our
</I>&gt;&gt;&gt;<i> Windows DNS server and we can ping all devices using their hostname,
</I>&gt;&gt;&gt;<i> just not when browsing to it.&#160; This leads me to believe something may
</I>&gt;&gt;&gt;<i> be wrong with our squid config.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> hard to guess without seeing logs or ACL's.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> -- 
</I>&gt;&gt;<i> Matus UHLAR - fantomas, <A HREF="https://lists.squid-cache.org/listinfo/squid-users">uhlar at fantomas.sk</A> ; <A HREF="http://www.fantomas.sk/">http://www.fantomas.sk/</A>
</I>&gt;&gt;<i> Warning: I wish NOT to receive e-mail advertising to this address.
</I>&gt;&gt;<i> Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
</I>&gt;&gt;<i> It's now safe to throw off your computer.
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="027078.html">[squid-users] Unable to access internal resources via hostname
</A></li>
	<LI>Next message (by thread): <A HREF="027080.html">[squid-users] Unable to access internal resources via hostname
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27079">[ date ]</a>
              <a href="thread.html#27079">[ thread ]</a>
              <a href="subject.html#27079">[ subject ]</a>
              <a href="author.html#27079">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
