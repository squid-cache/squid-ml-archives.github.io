<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Unable to access internal resources via hostname
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Unable%20to%20access%20internal%20resources%20via%20hostname&In-Reply-To=%3Cc00942c1c8ab46b5b393d70f32346798%40hexcel.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027079.html">
   <LINK REL="Next"  HREF="027082.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Unable to access internal resources via hostname</H1>
    <B>Piana, Josh</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Unable%20to%20access%20internal%20resources%20via%20hostname&In-Reply-To=%3Cc00942c1c8ab46b5b393d70f32346798%40hexcel.com%3E"
       TITLE="[squid-users] Unable to access internal resources via hostname">Josh.Piana at hexcel.com
       </A><BR>
    <I>Wed Aug 28 19:25:52 UTC 2024</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="027079.html">[squid-users] Unable to access internal resources via hostname
</A></li>
        <LI>Next message (by thread): <A HREF="027082.html">[squid-users] Unable to access internal resources via hostname
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27080">[ date ]</a>
              <a href="thread.html#27080">[ thread ]</a>
              <a href="subject.html#27080">[ subject ]</a>
              <a href="author.html#27080">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Alex, 

Thank you for your response! 

Unfortunately, this squid.conf I'm using was put together by one of our technicians that actually knew Linux and was staffed here at this location for nearly 20 years. 

He ran this off of a CentOS box using Squid 2.5 - and it was woefully out of date as you can imagine. I now understand that Squid 5.5, while newer, is actually out of date as well. I regret installing and working off of this because I jused assumed the &quot;yum&quot; install command for the Squid distro would give me the most recent, known-good, software. That's completely on me. From how I understand it, his intentions for internal users accessing internal resources, would skip authentication altogether. 

Here's a small piece, with his notes included, of why I think that. 

------------------------------------------------------------------------------------------------------------------------
# ----------------------------------------------------------------------------
# allow without authentication
# these rules allow certain connects without user authentication
# these allow any protocol/method/etc

#                 ***** IMPORTANT *****
# Adding to these lists also exempts from all content filtering.
# In particular, executables will be allowed to download!
#                 ***** IMPORTANT *****

# allow connects to local destinations without authentication
# by domain name from URL
http_access       allow local_dst_dom
http_reply_access allow local_dst_dom

# by IP address name resolves to
http_access       allow local_dst_addr
http_reply_access allow local_dst_addr
------------------------------------------------------------------------------------------------------------------------

The &quot;http_access allow local_dst_dom&quot; and the following reply statement seems to point toward his intentions when writing this. 

The only thing in the old config this was referencing was this, and to me, it doesn't make sense: 
# acl local_dst_dom dstdomain arcgate

It's worth noting that despite how awkward this seems, it DOES work. On the old web proxy we're currently still running live. 

I've gone as far as swapping out just the authentication settings and keeping the entire old config, but it still doesn't work. 
I've setup a realmd/sssd/kerberos backend instead of Samba/Windbind that the old server uses.

To state the issue we're having again - internal resources connecting to other internal resources fails via hostname, but works when using IP. I was able to troubleshoot and conclude DNS was not the issue, as all other aspects are working as intended and they certainly do use DNS. Also pings resolve using hostname from the new squidbox so that implies that DNS is working as expected. 

Ultimately, here's what I think we want, please feel free to poke holes in it: 
Allow clients who are accessing other internal rersources to be able to browse to it using its hostname, without needing authentication first.

 
I do intend on adding those parameters you mentioned to the logs so I can get better details within. I also need to look into how to use the debugging features, I'm not familiar with it at all.  

I apologize for the wall of text, looking forward to what you guys have to say about this.

Thanks, 
Josh

-----Original Message-----
From: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; On Behalf Of Alex Rousskov
Sent: Wednesday, August 28, 2024 2:31 PM
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] Unable to access internal resources via hostname

Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.


On 2024-08-28 14:18, Alex Rousskov wrote:
&gt;<i> On 2024-08-28 11:24, Piana, Josh wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Here's the log and (I think) relevant ACL's?
</I>&gt;<i>
</I>&gt;<i> According to your access.log, Squid denies problematic CONNECT 
</I>&gt;<i> requests with HTTP 407 errors responses. Usually, that means those 
</I>&gt;<i> requests match an &quot;http_access deny&quot; rule. Clearly, you expect an 
</I>&gt;<i> &quot;allow&quot; outcome instead, but it is difficult (for me) to figure out 
</I>&gt;<i> where your expectations mismatch reality; there are no rules that 
</I>&gt;<i> explicitly mention hexcelssp domain, for example: Which &quot;http_access 
</I>&gt;<i> allow&quot; rule do you expect those denied requests to match?
</I>
Sorry, I probably misinterpreted those access.log records: It looks like the denied (TCP_DENIED/407) access is something you actually expect because you want that test request to be authenticated. The client supplies the necessary credentials in the second request, and then that second request fails with a (rather generic) HTTP 500 error code, without contacting the origin server.

I am guessing that you are concerned about that second request/transaction rather than the first one.

Squid generates HTTP 500 errors for a variety of different reasons. Are there any messages in cache.log (at default debugging level) that correspond to these failing test transactions? If there are none, please add %err_code/%err_detail to your access_log logformat so that Squid logs more information about the problem to access.log (see logformat and access_log directives in squid.conf.documented for details).


Thank you,

Alex.



&gt;<i> Also, does mgr:ipcache cache manager query confirm that Squid has read 
</I>&gt;<i> your /etc/hosts file and cached the record you expect it to use?
</I>&gt;<i>
</I>&gt;<i> Alex.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> ---------------------------------------------------------------------
</I>&gt;&gt;<i> --------------------------------------
</I>&gt;&gt;<i> # /var/log/squid/access.log results for internal conflicts
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 28/Aug/2024:10:57:17 -0400.234 10.46.49.190 TCP_DENIED/407 4132 
</I>&gt;&gt;<i> CONNECT hexcelssp:443 - HIER_NONE/- text/html
</I>&gt;&gt;<i> 28/Aug/2024:10:57:17 -0400.253 10.46.49.190 NONE_NONE/500 0 CONNECT
</I>&gt;&gt;<i> hexcelssp:443 <A HREF="https://lists.squid-cache.org/listinfo/squid-users">JPIANA at AD.</A>&lt;DOMAIN&gt;.COM HIER_NONE/- -
</I>&gt;&gt;<i> 28/Aug/2024:10:57:17 -0400.380 10.46.49.190 TCP_DENIED/407 4132 
</I>&gt;&gt;<i> CONNECT hexcelssp:443 - HIER_NONE/- text/html
</I>&gt;&gt;<i> 28/Aug/2024:10:57:17 -0400.399 10.46.49.190 NONE_NONE/500 0 CONNECT
</I>&gt;&gt;<i> hexcelssp:443 <A HREF="https://lists.squid-cache.org/listinfo/squid-users">JPIANA at AD.</A>&lt;DOMAIN&gt;.COM HIER_NONE/- -
</I>&gt;&gt;<i> ---------------------------------------------------------------------
</I>&gt;&gt;<i> --------------------------------------
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # acl all src all
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> acl src_self src 127.0.0.0/8
</I>&gt;&gt;<i> acl src_self src 10.46.11.69
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> acl dst_self dst 127.0.0.0/8
</I>&gt;&gt;<i> acl dst_self dst 10.46.11.69
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> acl from_arc src 10.46.0.0/15
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> acl local_dst_addr dst 10.0.0.0/8
</I>&gt;&gt;<i> acl local_dst_addr dst 172.0.0.0/8
</I>&gt;&gt;<i> acl local_dst_addr dst bldg3.&lt;domain&gt;.com acl local_dst_addr dst 
</I>&gt;&gt;<i> bldg5.&lt;domain&gt;.com
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # these keep URLs of popular local servers from being forwarded acl 
</I>&gt;&gt;<i> local_dst_dom dstdomain arcgate
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # allow connects to local destinations without authentication # by 
</I>&gt;&gt;<i> domain name from URL
</I>&gt;&gt;<i> http_access       allow local_dst_dom
</I>&gt;&gt;<i> http_reply_access allow local_dst_dom
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # by IP address name resolves to
</I>&gt;&gt;<i> http_access       allow local_dst_addr
</I>&gt;&gt;<i> http_reply_access allow local_dst_addr
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # allow trusted hosts without authentication # these are just ip's on 
</I>&gt;&gt;<i> the 10.46.11.x network acl authless_src src &quot;/etc/squid/authless_src&quot;
</I>&gt;&gt;<i> http_access       allow authless_src
</I>&gt;&gt;<i> http_reply_access allow authless_src
</I>&gt;&gt;<i> ---------------------------------------------------------------------
</I>&gt;&gt;<i> --------------------------------------
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> -----Original Message-----
</I>&gt;&gt;<i> From: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; On 
</I>&gt;&gt;<i> Behalf Of Matus UHLAR - fantomas
</I>&gt;&gt;<i> Sent: Wednesday, August 28, 2024 10:47 AM
</I>&gt;&gt;<i> To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i> Subject: Re: [squid-users] Unable to access internal resources via 
</I>&gt;&gt;<i> hostname
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Caution: This email originated from outside of Hexcel. Do not click 
</I>&gt;&gt;<i> links or open attachments unless you recognize the sender and know 
</I>&gt;&gt;<i> the content is safe.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On 28.08.24 14:20, Piana, Josh wrote:
</I>&gt;&gt;&gt;<i> Hello Squid Support,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This squid user forum FYI
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> We are unable to get to internal resources via hostname but using 
</I>&gt;&gt;&gt;<i> the IP address works fine.  Immediately, I thought this was DNS but 
</I>&gt;&gt;&gt;<i> when I checked the /etc/resolv.conf/ file it was pointing correctly 
</I>&gt;&gt;&gt;<i> to our Windows DNS server and we can ping all devices using their 
</I>&gt;&gt;&gt;<i> hostname, just not when browsing to it.  This leads me to believe 
</I>&gt;&gt;&gt;<i> something may be wrong with our squid config.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> hard to guess without seeing logs or ACL's.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> --
</I>&gt;&gt;<i> Matus UHLAR - fantomas, <A HREF="https://lists.squid-cache.org/listinfo/squid-users">uhlar at fantomas.sk</A> ; 
</I>&gt;&gt;<i> <A HREF="http://www/.">http://www/.</A>
</I>&gt;&gt;<i> fantomas.sk%2F&amp;data=05%7C02%7Cjosh.piana%40hexcel.com%7C2db72264caa04
</I>&gt;&gt;<i> f1fd80d08dcc78f9245%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C6386
</I>&gt;&gt;<i> 04666668859787%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2
</I>&gt;&gt;<i> luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&amp;sdata=Z7cUEdNvInDAJ
</I>&gt;&gt;<i> PwgQJhXWSK3H2mkAPe4CNcfYJFyy6M%3D&amp;reserved=0
</I>&gt;&gt;<i> Warning: I wish NOT to receive e-mail advertising to this address.
</I>&gt;&gt;<i> Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
</I>&gt;&gt;<i> It's now safe to throw off your computer.
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i> <A HREF="https://lis/">https://lis/</A>
</I>&gt;&gt;<i> ts.squid-cache.org%2Flistinfo%2Fsquid-users&amp;data=05%7C02%7Cjosh.piana
</I>&gt;&gt;<i> %40hexcel.com%7C2db72264caa04f1fd80d08dcc78f9245%7C4248050df19546d5ac
</I>&gt;&gt;<i> 9c0c7c52b04cae%7C0%7C0%7C638604666674016161%7CUnknown%7CTWFpbGZsb3d8e
</I>&gt;&gt;<i> yJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0
</I>&gt;&gt;<i> %7C%7C%7C&amp;sdata=%2B%2B7inZxg2LEmB2KFVWmtn64FG8SwHpEZeEyAjhNClnU%3D&amp;re
</I>&gt;&gt;<i> served=0 _______________________________________________
</I>&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i> <A HREF="https://lis/">https://lis/</A>
</I>&gt;&gt;<i> ts.squid-cache.org%2Flistinfo%2Fsquid-users&amp;data=05%7C02%7Cjosh.piana
</I>&gt;&gt;<i> %40hexcel.com%7C2db72264caa04f1fd80d08dcc78f9245%7C4248050df19546d5ac
</I>&gt;&gt;<i> 9c0c7c52b04cae%7C0%7C0%7C638604666674016161%7CUnknown%7CTWFpbGZsb3d8e
</I>&gt;&gt;<i> yJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0
</I>&gt;&gt;<i> %7C%7C%7C&amp;sdata=%2B%2B7inZxg2LEmB2KFVWmtn64FG8SwHpEZeEyAjhNClnU%3D&amp;re
</I>&gt;&gt;<i> served=0
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="https://list/">https://list/</A>
</I>&gt;<i> s.squid-cache.org%2Flistinfo%2Fsquid-users&amp;data=05%7C02%7Cjosh.piana%4
</I>&gt;<i> 0hexcel.com%7C2db72264caa04f1fd80d08dcc78f9245%7C4248050df19546d5ac9c0
</I>&gt;<i> c7c52b04cae%7C0%7C0%7C638604666674016161%7CUnknown%7CTWFpbGZsb3d8eyJWI
</I>&gt;<i> joiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7
</I>&gt;<i> C%7C&amp;sdata=%2B%2B7inZxg2LEmB2KFVWmtn64FG8SwHpEZeEyAjhNClnU%3D&amp;reserved
</I>&gt;<i> =0
</I>
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="027079.html">[squid-users] Unable to access internal resources via hostname
</A></li>
	<LI>Next message (by thread): <A HREF="027082.html">[squid-users] Unable to access internal resources via hostname
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27080">[ date ]</a>
              <a href="thread.html#27080">[ thread ]</a>
              <a href="subject.html#27080">[ subject ]</a>
              <a href="author.html#27080">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
