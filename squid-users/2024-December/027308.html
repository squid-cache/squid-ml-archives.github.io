<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] ssl-bump works, but leads to many client errors being logged (NONE_NONE/200)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ssl-bump%20works%2C%0A%20but%20leads%20to%20many%20client%20errors%20being%20logged%20%28NONE_NONE/200%29&In-Reply-To=%3CHbnh6yS3GpK0Pw8JeF72Ak_IcXaahxcIv2PGUfgtYOY7F888X7r-0xcWpqakYUYo42oWL0-XL9UAX38hwooK1ULWph-2wAvOg6TBY2e4Nac%3D%40proton.me%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027302.html">
   <LINK REL="Next"  HREF="027309.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] ssl-bump works, but leads to many client errors being logged (NONE_NONE/200)</H1>
    <B>R</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ssl-bump%20works%2C%0A%20but%20leads%20to%20many%20client%20errors%20being%20logged%20%28NONE_NONE/200%29&In-Reply-To=%3CHbnh6yS3GpK0Pw8JeF72Ak_IcXaahxcIv2PGUfgtYOY7F888X7r-0xcWpqakYUYo42oWL0-XL9UAX38hwooK1ULWph-2wAvOg6TBY2e4Nac%3D%40proton.me%3E"
       TITLE="[squid-users] ssl-bump works, but leads to many client errors being logged (NONE_NONE/200)">randomrodrick at proton.me
       </A><BR>
    <I>Sat Dec 14 16:26:06 UTC 2024</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="027302.html">[squid-users] Cache peers auth on the fly
</A></li>
        <LI>Next message (by thread): <A HREF="027309.html">[squid-users] ssl-bump works, but leads to many client errors being logged (NONE_NONE/200)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27308">[ date ]</a>
              <a href="thread.html#27308">[ thread ]</a>
              <a href="subject.html#27308">[ subject ]</a>
              <a href="author.html#27308">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

My current goal is to set up a caching instance for https static content with squid 6.12.

ssl-bump is set up according to <A HREF="https://wiki.squid-cache.org/Features/SslBump">https://wiki.squid-cache.org/Features/SslBump</A> and it works fine, at least from the clients' perspectives and without any noticeable issues (e.g. with Firefox or Safari). Sometimes (~5-8% of the total requests) I can even get a few cache hits - including those juicy TCP_MEM_HIT/200s.

What has been bothering me though is the impressive amount of client request errors being logged:

# a few seconds after an instance restart
openvpn-client2:/$ squidclient cache_<A HREF="object://localhost/counters">object://localhost/counters</A> | grep client_http.errors
client_http.errors = 8
openvpn-client2:/$ squidclient cache_<A HREF="object://localhost/counters">object://localhost/counters</A> | grep client_http.errors
client_http.errors = 20

In the access_log, it is possible to see many NONE_NONE/200 being logged for &#8203;**almost every https request**. The amount of logged NONE_NONE/200 seem to vary according to the target website: github.com:443 throws 6-7 errors, while the lists.squid-cache.org throws only one.

As mentioned, everything seems to be fine for the clients (my grafana dashboard disagrees). Switching, for example, the config from:

acl step1 at_step SslBump1
ssl_bump peek step1
ssl_bump bump all

to

ssl_bump peek all
ssl_bump slice all

makes the NONE_NONE/200 disappear from the logs altogether, but that does not meet the initial caching objective.

What do these NONE_NONE/200 mean exactly? How to identify their underlying cause and reduce the total amount of logged errors?

Side question: are there any plans to move from this email-based list to GitHub issues in your repository (<A HREF="https://github.com/squid-cache/squid">https://github.com/squid-cache/squid</A>)?

Thanks and regards,
Rod

---


squid.conf:

cache_effective_user squid
cache_effective_group users
pid_filename /var/run/squid/squid.pid
acl localnet src 0.0.0.1-0.255.255.255 # RFC 1122 &quot;this&quot; network (LAN)
acl localnet src 10.0.0.0/8 # RFC 1918 local private network (LAN)
acl localnet src 100.64.0.0/10 # RFC 6598 shared address space (CGN)
acl localnet src 169.254.0.0/16 # RFC 3927 link-local (directly plugged) machines
acl localnet src 172.16.0.0/12 # RFC 1918 local private network (LAN)
acl localnet src 192.168.0.0/16 # RFC 1918 local private network (LAN)
acl localnet src fc00::/7 # RFC 4193 local private network range
acl localnet src fe80::/10 # RFC 4291 link-local (directly plugged) machines
acl SSL_ports port 443
acl Safe_ports port 80 # http
acl Safe_ports port 21 # ftp
acl Safe_ports port 443 # https
acl Safe_ports port 70 # gopher
acl Safe_ports port 210 # wais
acl Safe_ports port 1025-65535	# unregistered ports
acl Safe_ports port 280 # http-mgmt
acl Safe_ports port 488 # gss-http
acl Safe_ports port 591 # filemaker
acl Safe_ports port 777 # multiling http
acl CONNECT method CONNECT
acl snmppublic snmp_community public
snmp_port 3401
snmp_access allow snmppublic all
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow localhost manager
http_access allow localnet manager
http_access deny manager
http_access allow localnet
http_access allow localhost
http_access deny all
# begin ssl-bump
http_port 3128 \
ssl-bump \
cert=/etc/squid/ssl_cert/myCA.pem \
generate-host-certificates=on \
dynamic_cert_mem_cache_size=40MB
acl step1 at_step SslBump1
ssl_bump peek step1
ssl_bump bump all
sslcrtd_program /usr/lib/squid/security_file_certgen -s /var/lib/squid/ssl_db -M 40MB
sslcrtd_children 5
# end ssl-bump
cache allow all
cache_dir aufs /cache 51200 16 256
cache_mem 2 GB
maximum_object_size_in_memory 512 MB
maximum_object_size 6 GB
cache_swap_low 80
cache_swap_high 95
coredump_dir /cache
acl hasRequest has request
acl hasResponse has response
acl cachemgr1 url_regex ^cache_<A HREF="object://">object://</A>
logformat xsquid %tl %6tr %&gt;a %Ss/%03&gt;Hs %err_code/%err_detail %&lt;st %rm %ru %un %Sh/%&lt;A %mt
access_log daemon:/var/log/squid/access.log logformat=xsquid hasRequest !cachemgr1
refresh_pattern ^ftp: 1440	20%	10080
refresh_pattern ^gopher:	1440	0%	1440
refresh_pattern -i (/cgi-bin/|\?) 0	0%	0
refresh_pattern .jpg 120 50% 86400 override-lastmod override-expire ignore-reload ignore-no-store ignore-private store-stale # just to artificially force some hits
refresh_pattern . 3600	80%	14400
range_offset_limit none
forwarded_for on


access_log:

14/Dec/2024:15:28:14 +0000    122 192.168.1.125 NONE_NONE/200 -/- 0 CONNECT 4chan.org:443 - HIER_DIRECT/4chan.org -
14/Dec/2024:15:28:14 +0000    239 192.168.1.125 TCP_MISS/200 -/- 4876 GET <A HREF="https://4chan.org/">https://4chan.org/</A> - HIER_DIRECT/4chan.org text/html
14/Dec/2024:15:28:14 +0000    145 192.168.1.125 NONE_NONE/200 -/- 0 CONNECT i.4cdn.org:443 - HIER_DIRECT/i.4cdn.org -
14/Dec/2024:15:28:14 +0000    145 192.168.1.125 NONE_NONE/200 -/- 0 CONNECT i.4cdn.org:443 - HIER_DIRECT/i.4cdn.org -
14/Dec/2024:15:28:14 +0000    145 192.168.1.125 NONE_NONE/200 -/- 0 CONNECT i.4cdn.org:443 - HIER_DIRECT/i.4cdn.org -
14/Dec/2024:15:28:14 +0000    144 192.168.1.125 NONE_NONE/200 -/- 0 CONNECT i.4cdn.org:443 - HIER_DIRECT/i.4cdn.org -
14/Dec/2024:15:28:14 +0000    147 192.168.1.125 NONE_NONE/200 -/- 0 CONNECT i.4cdn.org:443 - HIER_DIRECT/i.4cdn.org -
14/Dec/2024:15:28:14 +0000    153 192.168.1.125 NONE_NONE/200 -/- 0 CONNECT i.4cdn.org:443 - HIER_DIRECT/i.4cdn.org -
14/Dec/2024:15:28:14 +0000     60 192.168.1.125 TCP_MISS/200 -/- 9636 GET <A HREF="https://i.4cdn.org/sp/1734116081466614s.jpg">https://i.4cdn.org/sp/1734116081466614s.jpg</A> - HIER_DIRECT/i.4cdn.org image/jpeg
14/Dec/2024:15:28:14 +0000     65 192.168.1.125 TCP_MISS/200 -/- 4521 GET <A HREF="https://i.4cdn.org/a/1734088830105726s.jpg">https://i.4cdn.org/a/1734088830105726s.jpg</A> - HIER_DIRECT/i.4cdn.org image/jpeg
14/Dec/2024:15:28:14 +0000     64 192.168.1.125 TCP_MISS/200 -/- 7356 GET <A HREF="https://i.4cdn.org/v/1734174698931944s.jpg">https://i.4cdn.org/v/1734174698931944s.jpg</A> - HIER_DIRECT/i.4cdn.org image/jpeg
14/Dec/2024:15:28:14 +0000     66 192.168.1.125 TCP_MISS/200 -/- 12559 GET <A HREF="https://i.4cdn.org/vr/1734154519311392s.jpg">https://i.4cdn.org/vr/1734154519311392s.jpg</A> - HIER_DIRECT/i.4cdn.org image/jpeg
14/Dec/2024:15:28:14 +0000     67 192.168.1.125 TCP_MISS/200 -/- 4810 GET <A HREF="https://i.4cdn.org/vg/1734151107375798s.jpg">https://i.4cdn.org/vg/1734151107375798s.jpg</A> - HIER_DIRECT/i.4cdn.org image/jpeg
14/Dec/2024:15:28:14 +0000     77 192.168.1.125 TCP_MISS/200 -/- 5194 GET <A HREF="https://i.4cdn.org/int/1734146907548086s.jpg">https://i.4cdn.org/int/1734146907548086s.jpg</A> - HIER_DIRECT/i.4cdn.org image/jpeg
14/Dec/2024:15:28:14 +0000     74 192.168.1.125 TCP_MISS/200 -/- 8464 GET <A HREF="https://i.4cdn.org/fit/1734081397035134s.jpg">https://i.4cdn.org/fit/1734081397035134s.jpg</A> - HIER_DIRECT/i.4cdn.org image/jpeg
14/Dec/2024:15:28:14 +0000     75 192.168.1.125 TCP_MISS/200 -/- 7634 GET <A HREF="https://i.4cdn.org/co/1734014992706889s.jpg">https://i.4cdn.org/co/1734014992706889s.jpg</A> - HIER_DIRECT/i.4cdn.org image/jpeg
14/Dec/2024:15:28:17 +0000    105 192.168.1.125 NONE_NONE/200 -/- 0 CONNECT boards.4chan.org:443 - HIER_DIRECT/boards.4chan.org -
14/Dec/2024:15:28:17 +0000    117 192.168.1.125 TCP_REFRESH_MODIFIED/200 -/- 21264 GET <A HREF="https://boards.4chan.org/hr/">https://boards.4chan.org/hr/</A> - HIER_DIRECT/boards.4chan.org text/html
14/Dec/2024:15:28:17 +0000    104 192.168.1.125 NONE_NONE/200 -/- 0 CONNECT s.4cdn.org:443 - HIER_DIRECT/s.4cdn.org -
14/Dec/2024:15:28:17 +0000     66 192.168.1.125 TCP_MISS/200 -/- 7329 GET <A HREF="https://s.4cdn.org/image/contest_banners/4da91e15078cd0b401a3df182447d7f6ef53a041.png">https://s.4cdn.org/image/contest_banners/4da91e15078cd0b401a3df182447d7f6ef53a041.png</A> - HIER_DIRECT/s.4cdn.org image/png
14/Dec/2024:15:28:17 +0000     64 192.168.1.125 TCP_MISS/200 -/- 2195 GET <A HREF="https://i.4cdn.org/hr/1734185018492644s.jpg">https://i.4cdn.org/hr/1734185018492644s.jpg</A> - HIER_DIRECT/i.4cdn.org image/jpeg
14/Dec/2024:15:28:17 +0000     64 192.168.1.125 TCP_MISS/200 -/- 2488 GET <A HREF="https://i.4cdn.org/hr/1734184210267895s.jpg">https://i.4cdn.org/hr/1734184210267895s.jpg</A> - HIER_DIRECT/i.4cdn.org image/jpeg
14/Dec/2024:15:28:17 +0000     67 192.168.1.125 TCP_MISS/200 -/- 2743 GET <A HREF="https://i.4cdn.org/hr/1734129280051325s.jpg">https://i.4cdn.org/hr/1734129280051325s.jpg</A> - HIER_DIRECT/i.4cdn.org image/jpeg
14/Dec/2024:15:28:17 +0000     70 192.168.1.125 TCP_MISS/200 -/- 9838 GET <A HREF="https://i.4cdn.org/hr/1729975559696842s.jpg">https://i.4cdn.org/hr/1729975559696842s.jpg</A> - HIER_DIRECT/i.4cdn.org image/jpeg
14/Dec/2024:15:28:17 +0000     68 192.168.1.125 TCP_MISS/200 -/- 8271 GET <A HREF="https://s.4cdn.org/image/title/1.jpg">https://s.4cdn.org/image/title/1.jpg</A> - HIER_DIRECT/s.4cdn.org image/jpeg
14/Dec/2024:15:28:17 +0000     76 192.168.1.125 TCP_MISS/200 -/- 2586 GET <A HREF="https://i.4cdn.org/hr/1734190031181606s.jpg">https://i.4cdn.org/hr/1734190031181606s.jpg</A> - HIER_DIRECT/i.4cdn.org image/jpeg
14/Dec/2024:15:28:17 +0000     98 192.168.1.125 TCP_MISS/200 -/- 8941 GET <A HREF="https://i.4cdn.org/hr/1732533823407555s.jpg">https://i.4cdn.org/hr/1732533823407555s.jpg</A> - HIER_DIRECT/i.4cdn.org image/jpeg
14/Dec/2024:15:28:17 +0000     65 192.168.1.125 TCP_MISS/200 -/- 6828 GET <A HREF="https://i.4cdn.org/hr/1729098446168049s.jpg">https://i.4cdn.org/hr/1729098446168049s.jpg</A> - HIER_DIRECT/i.4cdn.org image/jpeg
14/Dec/2024:15:28:21 +0000     63 192.168.1.125 TCP_MISS/200 -/- 587 HEAD <A HREF="https://i.4cdn.org/hr/1732533823407555.jpg">https://i.4cdn.org/hr/1732533823407555.jpg</A> - HIER_DIRECT/i.4cdn.org image/jpeg
14/Dec/2024:15:28:21 +0000    269 192.168.1.125 TCP_MISS/200 -/- 757840 GET <A HREF="https://i.4cdn.org/hr/1732533823407555.jpg">https://i.4cdn.org/hr/1732533823407555.jpg</A> - HIER_DIRECT/i.4cdn.org image/jpeg
14/Dec/2024:15:28:25 +0000      4 192.168.1.125 TCP_MEM_HIT/200 -/- 757841 GET <A HREF="https://i.4cdn.org/hr/1732533823407555.jpg">https://i.4cdn.org/hr/1732533823407555.jpg</A> - HIER_NONE/- image/jpeg


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="027302.html">[squid-users] Cache peers auth on the fly
</A></li>
	<LI>Next message (by thread): <A HREF="027309.html">[squid-users] ssl-bump works, but leads to many client errors being logged (NONE_NONE/200)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27308">[ date ]</a>
              <a href="thread.html#27308">[ thread ]</a>
              <a href="subject.html#27308">[ subject ]</a>
              <a href="author.html#27308">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
