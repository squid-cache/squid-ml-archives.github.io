<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] SQUID problem with unavailability of Google services
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SQUID%20problem%20with%20unavailability%20of%20Google%0A%20services&In-Reply-To=%3C9CF36145-C25B-427A-B5AC-7652D6F1B355%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027319.html">
   <LINK REL="Next"  HREF="027325.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] SQUID problem with unavailability of Google services</H1>
    <B>Jonathan Lee</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SQUID%20problem%20with%20unavailability%20of%20Google%0A%20services&In-Reply-To=%3C9CF36145-C25B-427A-B5AC-7652D6F1B355%40gmail.com%3E"
       TITLE="[squid-users] SQUID problem with unavailability of Google services">jonathanlee571 at gmail.com
       </A><BR>
    <I>Sat Dec 21 21:01:09 UTC 2024</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="027319.html">[squid-users] SQUID problem with unavailability of Google services
</A></li>
        <LI>Next message (by thread): <A HREF="027325.html">[squid-users] SQUID problem with unavailability of Google services
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27321">[ date ]</a>
              <a href="thread.html#27321">[ thread ]</a>
              <a href="subject.html#27321">[ subject ]</a>
              <a href="author.html#27321">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>You apply it as a custom setting in Squid. I would seek out what header request is failing and start from there to fix your issue. 

Good luck. 


&gt;<i> On Dec 21, 2024, at 12:18, A. Pechenin &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">alexmrrc at gmail.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> OK, but how can ACL data be applied in practice to solve the problem I described?
</I>&gt;<i> 
</I>&gt;<i> &#1089;&#1073;, 21 &#1076;&#1077;&#1082;. 2024&#8239;&#1075;. &#1074; 22:57, Jonathan Lee &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">jonathanlee571 at gmail.com</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">jonathanlee571 at gmail.com</A>&gt;&gt;:
</I>&gt;&gt;<i> You can use the following 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> acl NoSSLIntercept ssl::server_name_regex -i &quot;/usr/local/pkg/reg.url.nobump&quot;
</I>&gt;&gt;<i> acl NoBumpDNS dstdomain &quot;/usr/local/pkg/dns.nobump&quot;
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> I created a regex based no bump file and or use a dns based no bump file to mark splice only sites.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Example of what is in reg.url.nobump file
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> ^((alt[0-9]-mtalk\.)|(mtalk\.)|(mtalk-(staging|dev)\.))google\.com
</I>&gt;&gt;<i> ^((gvt)([0-9]))\.com
</I>&gt;&gt;<i> ^(((clients)[0-9])|accounts)\.google\.(com|us)
</I>&gt;&gt;<i> ^(pki|(crl|ocsp)\.pki)\.google\.com
</I>&gt;&gt;<i> (outlook\.)(office365|office)\.com
</I>&gt;&gt;<i> infinity-c[0-9][0-9]\.youboranqs[0-9][0-9]\.com
</I>&gt;&gt;<i> hulu\.com
</I>&gt;&gt;<i> nflxvideo\.net
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Or example of what could be in dns.nobump
</I>&gt;&gt;<i> .play.google.com &lt;<A HREF="http://play.google.com/">http://play.google.com/</A>&gt;
</I>&gt;&gt;<i> .android.com &lt;<A HREF="http://android.com/">http://android.com/</A>&gt;
</I>&gt;&gt;<i> .google-analytics.com &lt;<A HREF="http://google-analytics.com/">http://google-analytics.com/</A>&gt;
</I>&gt;&gt;<i> .googleusercontent.com &lt;<A HREF="http://googleusercontent.com/">http://googleusercontent.com/</A>&gt;
</I>&gt;&gt;<i> .ggpht.com &lt;<A HREF="http://ggpht.com/">http://ggpht.com/</A>&gt;
</I>&gt;&gt;<i> .dl.google.com &lt;<A HREF="http://dl.google.com/">http://dl.google.com/</A>&gt;
</I>&gt;&gt;<i> .dl-ssl.google.com &lt;<A HREF="http://dl-ssl.google.com/">http://dl-ssl.google.com/</A>&gt;
</I>&gt;&gt;<i> .android.clients.google.com &lt;<A HREF="http://android.clients.google.com/">http://android.clients.google.com/</A>&gt;
</I>&gt;&gt;<i> .omahaproxy.appspot.com &lt;<A HREF="http://omahaproxy.appspot.com/">http://omahaproxy.appspot.com/</A>&gt;
</I>&gt;&gt;<i> .payments.google.com &lt;<A HREF="http://payments.google.com/">http://payments.google.com/</A>&gt;
</I>&gt;&gt;<i> .googleapis.com &lt;<A HREF="http://googleapis.com/">http://googleapis.com/</A>&gt;
</I>&gt;&gt;<i> .notifications.google.com &lt;<A HREF="http://notifications.google.com/">http://notifications.google.com/</A>&gt;
</I>&gt;&gt;<i> .ogs.google.com &lt;<A HREF="http://ogs.google.com/">http://ogs.google.com/</A>&gt;
</I>&gt;&gt;<i> .googleapis.com &lt;<A HREF="http://googleapis.com/">http://googleapis.com/</A>&gt;
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Make sure you follow the enterprise policy for Google Android based products. 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Some sites simply can not and or should not be bumped and you only should look at the get header. 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> From: A. Pechenin &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">alexmrrc at gmail.com</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">alexmrrc at gmail.com</A>&gt;&gt;
</I>&gt;&gt;<i> Sent: Saturday, December 21, 2024 11:46
</I>&gt;&gt;<i> To: Jonathan Lee &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">jonathanlee571 at gmail.com</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">jonathanlee571 at gmail.com</A>&gt;&gt;
</I>&gt;&gt;<i> Cc: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;&gt;
</I>&gt;&gt;<i> Subject: Re: [squid-users] SQUID problem with unavailability of Google services
</I>&gt;&gt;<i>  
</I>&gt;&gt;<i> I apologize for the formatting of the text of the letter?
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> I will be incorrect if I do not say that there are entries in the cache.log, although the IP does not resolve directly to google subdomains, but according to whois, this is the Google LLC farm.
</I>&gt;&gt;<i> 2024/12/21 21:54:57 kid1| conn43356657 local=MYREALIP:53130 remote=142.250.186.142:443 &lt;<A HREF="http://142.250.186.142:443/">http://142.250.186.142:443/</A>&gt; HIER_DIRECT FD 121 flags=1: read/write failure: (60) Operation timed out
</I>&gt;&gt;<i> current master transaction: master13542083
</I>&gt;&gt;<i> 2024/12/21 21:58:29 kid1| conn43398624 local=MYREALIP:58390 remote=142.250.185.238:443 &lt;<A HREF="http://142.250.185.238:443/">http://142.250.185.238:443/</A>&gt; HIER_DIRECT FD 96 flags=1: read/write failure: (60) Operation timed out
</I>&gt;&gt;<i> current master transaction: master13553287
</I>&gt;&gt;<i> 2024/12/21 21:58:30 kid1| conn43398801 local=MYREALIP:58419 remote=172.217.16.206:443 &lt;<A HREF="http://172.217.16.206:443/">http://172.217.16.206:443/</A>&gt; HIER_DIRECT FD 898 flags=1: read/write failure: (60) Operation timed out
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> &#1089;&#1073;, 21 &#1076;&#1077;&#1082;. 2024&#8239;&#1075;. &#1074; 20:43, Jonathan Lee &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">jonathanlee571 at gmail.com</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">jonathanlee571 at gmail.com</A>&gt;&gt;:
</I>&gt;&gt;<i> Have you created a splice only file with lists of items that must be spliced at all times, Google mail ethically should be spliced just as an example. Some know sites must be spliced. 
</I>&gt;&gt;<i> Sent from my iPhone
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> &gt; On Dec 21, 2024, at 09:32, A. Pechenin &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">alexmrrc at gmail.com</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">alexmrrc at gmail.com</A>&gt;&gt; wrote:
</I>&gt;&gt;<i> &gt; 
</I>&gt;&gt;<i> &gt; &#65279;
</I>&gt;&gt;<i> &gt; This week, when connecting users through a proxy server, some Google services became inaccessible, such as Calendar, Translator, user profile.
</I>&gt;&gt;<i> &gt; 
</I>&gt;&gt;<i> &gt; When clicking on the services section in the browser on the Google portal, the page does not open and then a connection error is displayed. When directly going to the calendar section, the connection also hangs for a long time without loading the page. At the same time, the Google home page, mail, search work.
</I>&gt;&gt;<i> &gt; 
</I>&gt;&gt;<i> &gt; Transparent proxying is not used.
</I>&gt;&gt;<i> &gt; Viewing the proxy server logs did not add any understanding, all requests are processed correctly and no errors or prohibitions are observed. There are no other problems with the unavailability of any sites.
</I>&gt;&gt;<i> &gt; 
</I>&gt;&gt;<i> &gt; When connecting directly (bypassing the proxy server), all Google services work completely correctly.
</I>&gt;&gt;<i> &gt; The platform on which the problem was suddenly discovered:
</I>&gt;&gt;<i> &gt; FreeBSD 13.2-RELEASE-p9
</I>&gt;&gt;<i> &gt; Squid 6.6
</I>&gt;&gt;<i> &gt; 
</I>&gt;&gt;<i> &gt; A new separate server was deployed for objectivity and finding the cause, but the problem was also reproduced there, its platform.
</I>&gt;&gt;<i> &gt; FreeBSD 13.4-RELEASE-p2
</I>&gt;&gt;<i> &gt; Squid 6.10
</I>&gt;&gt;<i> &gt; 
</I>&gt;&gt;<i> &gt; I tried using the default configuration file (recommended minimum configuration) to eliminate the problem in my working squid.conf, but the problem remained
</I>&gt;&gt;<i> &gt; 
</I>&gt;&gt;<i> &gt; I repeat, the problem reproduced suddenly, no changes were made to the proxy server configuration on our side, no problems with Google have arisen for many years. What should I pay attention to in the Squid configuration? Any idea
</I>&gt;&gt;<i> &gt; _______________________________________________
</I>&gt;&gt;<i> &gt; squid-users mailing list
</I>&gt;&gt;<i> &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;&gt;<i> &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20241221/fa71923e/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20241221/fa71923e/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="027319.html">[squid-users] SQUID problem with unavailability of Google services
</A></li>
	<LI>Next message (by thread): <A HREF="027325.html">[squid-users] SQUID problem with unavailability of Google services
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27321">[ date ]</a>
              <a href="thread.html#27321">[ thread ]</a>
              <a href="subject.html#27321">[ subject ]</a>
              <a href="author.html#27321">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
