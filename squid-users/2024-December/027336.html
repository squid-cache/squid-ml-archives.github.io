<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Optimization
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Optimization&In-Reply-To=%3C9BFB8724-625D-479A-B8FB-7A4E0C8C1250%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027333.html">
   <LINK REL="Next"  HREF="027337.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Optimization</H1>
    <B>Jonathan Lee</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Optimization&In-Reply-To=%3C9BFB8724-625D-479A-B8FB-7A4E0C8C1250%40gmail.com%3E"
       TITLE="[squid-users] Optimization">jonathanlee571 at gmail.com
       </A><BR>
    <I>Mon Dec 30 16:46:31 UTC 2024</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="027333.html">[squid-users] Squid-internal-mgr/forward help
</A></li>
        <LI>Next message (by thread): <A HREF="027337.html">[squid-users] Optimization
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27336">[ date ]</a>
              <a href="thread.html#27336">[ thread ]</a>
              <a href="subject.html#27336">[ subject ]</a>
              <a href="author.html#27336">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Fellow Squid Users,

I wanted to try to speed up my SSL interception caching, or optimize it 

I have some small issues with some websites loading slowly not really bad just a small lag and I started to play around with 
all-of and any-of to create new concatenated acls. 

I have arp mac addresses being used to check for ip and mac address for approval of proxy use and some other items. 

Does this speed up anything I am trying to get the ssl bump items to have better performance. The splice side is lighting fast again I just wonder if anything can be done to speed up the bump side. I am attempting to combine and concatenate access control lists. 

the Mac address and IP address matching does work it has been for some time I am just attempting a better way to create a better single acl for use with the ssl_bump directive 

Here is the part of my config I am asking about see #!!!!!!!

acl wpad urlpath_regex ^/wpad.dat$
acl wpad urlpath_regex ^/proxy.pac$
acl wpad urlpath_regex ^/wpad.da$
deny_info TCP_RESET wpad
#deny_info 200:/etc/squid/wpad.dat wpad
reply_header_access Content-Type deny wpad
http_access deny wpad
http_access deny !safeports
http_access deny CONNECT !sslports
#http_access allow localhost manager
#http_access deny manager
cachemgr_passwd disable offline_toggle reconfigure shutdown
cachemgr_passwd CLASSIFIED all
eui_lookup on
acl no_miss url_regex -i gateway\.facebook\.com\/ws\/realtime\?
acl no_miss url_regex -i web-chat-e2ee\.facebook\.com\/ws\/chat
acl CONNECT method CONNECT
acl wuCONNECT dstdomain www.update.microsoft.com
acl wuCONNECT dstdomain sls.microsoft.com
http_access allow CONNECT wuCONNECT localnet
http_access allow CONNECT wuCONNECT localhost
http_access allow CONNECT windowsupdate localnet
http_access allow CONNECT windowsupdate localhost
http_access allow CONNECT HttpAccess localnet
http_access allow CONNECT HttpAccess localhost
#http_access deny manager
http_access deny to_ipv6
http_access deny from_ipv6

acl BrokenButTrustedServers dstdomain &quot;/usr/local/pkg/dstdom.broken&quot;
acl DomainMismatch ssl_error SQUID_X509_V_ERR_DOMAIN_MISMATCH
sslproxy_cert_error allow BrokenButTrustedServers DomainMismatch
sslproxy_cert_error deny all

acl splice_only src 192.168.1.8 
acl splice_only src 192.168.1.10 
acl splice_only src 192.168.1.11
acl splice_only src 192.168.1.15
acl splice_only src 192.168.1.16

acl splice_only_mac arp MAC
acl splice_only_mac arp MAC
acl splice_only_mac arp MAC
acl splice_only_mac arp MAC
acl splice_only_mac arp MAC

acl NoSSLIntercept ssl::server_name_regex -i &quot;/usr/local/pkg/reg.url.nobump&quot;
acl NoBumpDNS dstdomain &quot;/usr/local/pkg/dns.nobump&quot;
acl SSL_Intercept_Terminate dstdomain &quot;/usr/local/pkg/url.bump&quot;

#acl markBumped annotate_client bumped=true #TESTING NOT USED
acl active_use annotate_client active=true

acl bump_only src 192.168.1.3
acl bump_only src 192.168.1.4
acl bump_only src 192.168.1.5
#acl bump_only src 192.168.1.6
acl bump_only src 192.168.1.9
acl bump_only src 192.168.1.13

acl bump_only_mac arp MAC
acl bump_only_mac arp MAC
acl bump_only_mac arp MAC
acl bump_only_mac arp MAC
acl bump_only_mac arp MAC
#acl bump_only_mac arp MAC

collapsed_forwarding on
negative_dns_ttl 5 minutes
coredump_dir /label/swap0
read_ahead_gap 64 KB
pipeline_prefetch 100
happy_eyeballs_connect_timeout 10
memory_pools on


#!!!!!!!!
acl splice_group any-of https_login NoBumpDNS NoSSLIntercept #any of the splice lists OR acl ||
acl splice_only_local_group all-of splice_only_mac splice_only #MAC AND IP ADDRESS &amp;&amp;
acl splice_main any-of splice_group splice_only_local_group  #combine to OR acl ||

acl bump_main all-of bump_only_mac bump_only #MAC AND IP ADDRESS &amp;&amp;
#!!!!!!!!



ssl_bump peek step1
ssl_bump terminate SSL_Intercept_Terminate
miss_access deny no_miss active_use

#OLD WAY
#ssl_bump splice https_login active_use 
#ssl_bump splice splice_only_mac splice_only active_use
#ssl_bump splice NoBumpDNS active_use
#ssl_bump splice NoSSLIntercept active_use

#NEW WAY ONE ACL
ssl_bump splice splice_main active_use

#OLD WAY 
#ssl_bump bump bump_only_mac bump_only active_use

#NEW WAY ONE ACL
ssl_bump bump bump_main active_use

acl activated note active_use true
ssl_bump terminate !activated
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="027333.html">[squid-users] Squid-internal-mgr/forward help
</A></li>
	<LI>Next message (by thread): <A HREF="027337.html">[squid-users] Optimization
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27336">[ date ]</a>
              <a href="thread.html#27336">[ thread ]</a>
              <a href="subject.html#27336">[ subject ]</a>
              <a href="author.html#27336">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
