<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Optimization
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Optimization&In-Reply-To=%3C65b6660c-ce86-4ffa-9578-4d23cd37f098%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027337.html">
   <LINK REL="Next"  HREF="027339.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Optimization</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Optimization&In-Reply-To=%3C65b6660c-ce86-4ffa-9578-4d23cd37f098%40measurement-factory.com%3E"
       TITLE="[squid-users] Optimization">rousskov at measurement-factory.com
       </A><BR>
    <I>Mon Dec 30 18:28:31 UTC 2024</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="027337.html">[squid-users] Optimization
</A></li>
        <LI>Next message (by thread): <A HREF="027339.html">[squid-users] Optimization
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27338">[ date ]</a>
              <a href="thread.html#27338">[ thread ]</a>
              <a href="subject.html#27338">[ subject ]</a>
              <a href="author.html#27338">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2024-12-30 11:55, Jonathan Lee wrote:
&gt;<i> what is faster or better for performance? The parsed ssl_bump lists
</I>&gt;<i> or the singular list?
</I>
To remove very distracting noise, I am posting an abridged version of 
your &quot;before&quot; and &quot;after&quot; configurations:

     # before
     ssl_bump splice A
     ssl_bump splice D E
     ssl_bump splice B
     ssl_bump splice C
     ssl_bump bump F G

     # after
     ssl_bump splice AorBorCorDE
     ssl_bump bump FG


The two versions differ only in evaluation order:

     before: ACLs D and E evaluate before ACLs B and C
     after:  ACLs D and E evaluate after ACLs B and C

Which version is faster depends on whether ACLs D and E match (together) 
more often than ACL B or ACL C matches (each) _and_ on the cost of 
evaluating the respective ACLs. I do not have enough information to do 
the math.

If the evaluation order is kept the same, then both configurations 
should have about the same performance. Internally, modern Squid interprets

     directive actionX a
     directive actionX b

almost as if it was written as

     acl AorB any-of a b
     directive actionX AorB

The latter configuration might consume slightly less memory in some 
cases, but that difference in memory consumption is unlikely to have a 
measurable effect on performance in most cases.


HTH,

Alex.

&gt;<i>     acl AorBorC any-of A B C
</I>&gt;<i>     acl DE all-of D E
</I>&gt;<i>     acl AorBorCorDE any-of AorBorC DE
</I>&gt;<i>     acl FG all-of F G
</I>

&gt;<i> ----Parsed&#8212;&#8212;
</I>&gt;<i> acl splice_group any-of https_login NoBumpDNS NoSSLIntercept
</I>&gt;<i> acl splice_only_local_group all-of splice_only_mac splice_only
</I>&gt;<i> acl splice_main any-of splice_group splice_only_local_group
</I>&gt;<i> acl bump_main all-of bump_only_mac bump_only
</I>&gt;<i> 
</I>&gt;<i> ssl_bump peek step1
</I>&gt;<i> ssl_bump terminate SSL_Intercept_Terminate
</I>&gt;<i> ssl_bump splice https_login active_use
</I>&gt;<i> ssl_bump splice splice_only_mac splice_only active_use
</I>&gt;<i> ssl_bump splice NoBumpDNS active_use
</I>&gt;<i> ssl_bump splice NoSSLIntercept active_use
</I>&gt;<i> ssl_bump bump bump_only_mac bump_only active_use
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> -----Concatenated new version&#8212;&#8212;
</I>&gt;<i> acl splice_group any-of https_login NoBumpDNS NoSSLIntercept
</I>&gt;<i> acl splice_only_local_group all-of splice_only_mac splice_only
</I>&gt;<i> acl splice_main any-of splice_group splice_only_local_group
</I>&gt;<i> acl bump_main all-of bump_only_mac bump_only
</I>

&gt;<i> ssl_bump peek step1
</I>&gt;<i> ssl_bump terminate SSL_Intercept_Terminate
</I>&gt;<i> ssl_bump splice splice_main active_use
</I>&gt;<i> ssl_bump bump bump_main active_use
</I>&gt;<i> acl activated note active_use true
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> On Dec 30, 2024, at 08:46, Jonathan Lee &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">jonathanlee571 at gmail.com</A>&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Hello Fellow Squid Users,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I wanted to try to speed up my SSL interception caching, or optimize it
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I have some small issues with some websites loading slowly not really bad just a small lag and I started to play around with
</I>&gt;&gt;<i> all-of and any-of to create new concatenated acls.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I have arp mac addresses being used to check for ip and mac address for approval of proxy use and some other items.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Does this speed up anything I am trying to get the ssl bump items to have better performance. The splice side is lighting fast again I just wonder if anything can be done to speed up the bump side. I am attempting to combine and concatenate access control lists.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> the Mac address and IP address matching does work it has been for some time I am just attempting a better way to create a better single acl for use with the ssl_bump directive
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Here is the part of my config I am asking about see #!!!!!!!
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> acl wpad urlpath_regex ^/wpad.dat$
</I>&gt;&gt;<i> acl wpad urlpath_regex ^/proxy.pac$
</I>&gt;&gt;<i> acl wpad urlpath_regex ^/wpad.da$
</I>&gt;&gt;<i> deny_info TCP_RESET wpad
</I>&gt;&gt;<i> #deny_info 200:/etc/squid/wpad.dat wpad
</I>&gt;&gt;<i> reply_header_access Content-Type deny wpad
</I>&gt;&gt;<i> http_access deny wpad
</I>&gt;&gt;<i> http_access deny !safeports
</I>&gt;&gt;<i> http_access deny CONNECT !sslports
</I>&gt;&gt;<i> #http_access allow localhost manager
</I>&gt;&gt;<i> #http_access deny manager
</I>&gt;&gt;<i> cachemgr_passwd disable offline_toggle reconfigure shutdown
</I>&gt;&gt;<i> cachemgr_passwd CLASSIFIED all
</I>&gt;&gt;<i> eui_lookup on
</I>&gt;&gt;<i> acl no_miss url_regex -i gateway\.facebook\.com\/ws\/realtime\?
</I>&gt;&gt;<i> acl no_miss url_regex -i web-chat-e2ee\.facebook\.com\/ws\/chat
</I>&gt;&gt;<i> acl CONNECT method CONNECT
</I>&gt;&gt;<i> acl wuCONNECT dstdomain www.update.microsoft.com
</I>&gt;&gt;<i> acl wuCONNECT dstdomain sls.microsoft.com
</I>&gt;&gt;<i> http_access allow CONNECT wuCONNECT localnet
</I>&gt;&gt;<i> http_access allow CONNECT wuCONNECT localhost
</I>&gt;&gt;<i> http_access allow CONNECT windowsupdate localnet
</I>&gt;&gt;<i> http_access allow CONNECT windowsupdate localhost
</I>&gt;&gt;<i> http_access allow CONNECT HttpAccess localnet
</I>&gt;&gt;<i> http_access allow CONNECT HttpAccess localhost
</I>&gt;&gt;<i> #http_access deny manager
</I>&gt;&gt;<i> http_access deny to_ipv6
</I>&gt;&gt;<i> http_access deny from_ipv6
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> acl BrokenButTrustedServers dstdomain &quot;/usr/local/pkg/dstdom.broken&quot;
</I>&gt;&gt;<i> acl DomainMismatch ssl_error SQUID_X509_V_ERR_DOMAIN_MISMATCH
</I>&gt;&gt;<i> sslproxy_cert_error allow BrokenButTrustedServers DomainMismatch
</I>&gt;&gt;<i> sslproxy_cert_error deny all
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> acl splice_only src 192.168.1.8
</I>&gt;&gt;<i> acl splice_only src 192.168.1.10
</I>&gt;&gt;<i> acl splice_only src 192.168.1.11
</I>&gt;&gt;<i> acl splice_only src 192.168.1.15
</I>&gt;&gt;<i> acl splice_only src 192.168.1.16
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> acl splice_only_mac arp MAC
</I>&gt;&gt;<i> acl splice_only_mac arp MAC
</I>&gt;&gt;<i> acl splice_only_mac arp MAC
</I>&gt;&gt;<i> acl splice_only_mac arp MAC
</I>&gt;&gt;<i> acl splice_only_mac arp MAC
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> acl NoSSLIntercept ssl::server_name_regex -i &quot;/usr/local/pkg/reg.url.nobump&quot;
</I>&gt;&gt;<i> acl NoBumpDNS dstdomain &quot;/usr/local/pkg/dns.nobump&quot;
</I>&gt;&gt;<i> acl SSL_Intercept_Terminate dstdomain &quot;/usr/local/pkg/url.bump&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> #acl markBumped annotate_client bumped=true #TESTING NOT USED
</I>&gt;&gt;<i> acl active_use annotate_client active=true
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> acl bump_only src 192.168.1.3
</I>&gt;&gt;<i> acl bump_only src 192.168.1.4
</I>&gt;&gt;<i> acl bump_only src 192.168.1.5
</I>&gt;&gt;<i> #acl bump_only src 192.168.1.6
</I>&gt;&gt;<i> acl bump_only src 192.168.1.9
</I>&gt;&gt;<i> acl bump_only src 192.168.1.13
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> acl bump_only_mac arp MAC
</I>&gt;&gt;<i> acl bump_only_mac arp MAC
</I>&gt;&gt;<i> acl bump_only_mac arp MAC
</I>&gt;&gt;<i> acl bump_only_mac arp MAC
</I>&gt;&gt;<i> acl bump_only_mac arp MAC
</I>&gt;&gt;<i> #acl bump_only_mac arp MAC
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> collapsed_forwarding on
</I>&gt;&gt;<i> negative_dns_ttl 5 minutes
</I>&gt;&gt;<i> coredump_dir /label/swap0
</I>&gt;&gt;<i> read_ahead_gap 64 KB
</I>&gt;&gt;<i> pipeline_prefetch 100
</I>&gt;&gt;<i> happy_eyeballs_connect_timeout 10
</I>&gt;&gt;<i> memory_pools on
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> #!!!!!!!!
</I>&gt;&gt;<i> acl splice_group any-of https_login NoBumpDNS NoSSLIntercept #any of the splice lists OR acl ||
</I>&gt;&gt;<i> acl splice_only_local_group all-of splice_only_mac splice_only #MAC AND IP ADDRESS &amp;&amp;
</I>&gt;&gt;<i> acl splice_main any-of splice_group splice_only_local_group  #combine to OR acl ||
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> acl bump_main all-of bump_only_mac bump_only #MAC AND IP ADDRESS &amp;&amp;
</I>&gt;&gt;<i> #!!!!!!!!
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ssl_bump peek step1
</I>&gt;&gt;<i> ssl_bump terminate SSL_Intercept_Terminate
</I>&gt;&gt;<i> miss_access deny no_miss active_use
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> #OLD WAY
</I>&gt;&gt;<i> #ssl_bump splice https_login active_use
</I>&gt;&gt;<i> #ssl_bump splice splice_only_mac splice_only active_use
</I>&gt;&gt;<i> #ssl_bump splice NoBumpDNS active_use
</I>&gt;&gt;<i> #ssl_bump splice NoSSLIntercept active_use
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> #NEW WAY ONE ACL
</I>&gt;&gt;<i> ssl_bump splice splice_main active_use
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> #OLD WAY
</I>&gt;&gt;<i> #ssl_bump bump bump_only_mac bump_only active_use
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> #NEW WAY ONE ACL
</I>&gt;&gt;<i> ssl_bump bump bump_main active_use
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> acl activated note active_use true
</I>&gt;&gt;<i> ssl_bump terminate !activated
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="027337.html">[squid-users] Optimization
</A></li>
	<LI>Next message (by thread): <A HREF="027339.html">[squid-users] Optimization
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27338">[ date ]</a>
              <a href="thread.html#27338">[ thread ]</a>
              <a href="subject.html#27338">[ subject ]</a>
              <a href="author.html#27338">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
