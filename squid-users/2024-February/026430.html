<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] New Squid prefers IPv4
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20New%20Squid%20prefers%20IPv4&In-Reply-To=%3Cupu46n%24ko1%241%40ciao.gmane.io%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026428.html">
   <LINK REL="Next"  HREF="026429.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] New Squid prefers IPv4</H1>
    <B>Rob van der Putten</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20New%20Squid%20prefers%20IPv4&In-Reply-To=%3Cupu46n%24ko1%241%40ciao.gmane.io%3E"
       TITLE="[squid-users] New Squid prefers IPv4">rob at sput.nl
       </A><BR>
    <I>Tue Feb  6 20:18:31 UTC 2024</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="026428.html">[squid-users] New Squid prefers IPv4
</A></li>
        <LI>Next message (by thread): <A HREF="026429.html">[squid-users] New Squid prefers IPv4
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26430">[ date ]</a>
              <a href="thread.html#26430">[ thread ]</a>
              <a href="subject.html#26430">[ subject ]</a>
              <a href="author.html#26430">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi there


On 06/02/2024 16:24, Antony Stone wrote:

&gt;<i> On Tuesday 06 February 2024 at 16:16:24, Rob van der Putten wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On 05/02/2024 18:32, Antony Stone wrote:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I believe ping (ICMP) timings are irrelevant.  The client (squid in this
</I>&gt;&gt;&gt;<i> case) does a DNS lookup for the hostname's A and AAAA records,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> A before AAAA. Bind responds within the same millisecond.
</I>&gt;<i> 
</I>&gt;<i> I think the simultaneity of these lookups is unimportant.
</I>&gt;<i> 
</I>&gt;&gt;&gt;<i> then makes two simultaneous HTTP connections to the server (one IPv4, on
</I>&gt;&gt;&gt;<i> IPv6) and whichever one responds first *by HTTP* is then regarded as being
</I>&gt;&gt;&gt;<i> the best way to route traffic thereafter.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I do not see Squid opening two connections simultaneously and then
</I>&gt;&gt;<i> closing one. It's just one connection.
</I>&gt;<i> 
</I>&gt;<i> Are you sure this is not because Squid has already made earlier connections to
</I>&gt;<i> this name, decided that IPv4 is better, and continues to use that when you are
</I>&gt;<i> now testing it?
</I>&gt;<i> 
</I>&gt;<i> I would expect you to have to start from an &quot;undecided&quot; Squid setup (I have no
</I>&gt;<i> idea where it keeps this informatin for later use, though) to find out whether
</I>&gt;<i> this is what's going on.
</I>
I think i finally have figured this out.
The answer is more or less in netdb.state. I couldn't find the file 
format, so I lookup it up in the source (net_db.cc). It's;

network
pings_sent
pings_recv
hops
rtt
next_ping_time
last_use_time
host name(s)

Squid does send pings. But only once per five minutes per host. Both 
IPv4 and IPv6 (I checked with tcpdump). And then decides on the ping 
results. At least, that's what the contents of netdb.state suggests.


Regards,
Rob



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="026428.html">[squid-users] New Squid prefers IPv4
</A></li>
	<LI>Next message (by thread): <A HREF="026429.html">[squid-users] New Squid prefers IPv4
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26430">[ date ]</a>
              <a href="thread.html#26430">[ thread ]</a>
              <a href="subject.html#26430">[ subject ]</a>
              <a href="author.html#26430">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
