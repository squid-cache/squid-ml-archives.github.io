<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] chunked transfer over sslbump
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20chunked%20transfer%20over%20sslbump&In-Reply-To=%3CDM6PR06MB44255DE559D846418218AB77F16A2%40DM6PR06MB4425.namprd06.prod.outlook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026357.html">
   <LINK REL="Next"  HREF="026360.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] chunked transfer over sslbump</H1>
    <B>Zhang, Jinshu</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20chunked%20transfer%20over%20sslbump&In-Reply-To=%3CDM6PR06MB44255DE559D846418218AB77F16A2%40DM6PR06MB4425.namprd06.prod.outlook.com%3E"
       TITLE="[squid-users] chunked transfer over sslbump">jinshu_zhang at fanniemae.com
       </A><BR>
    <I>Tue Jan  9 16:51:15 UTC 2024</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="026357.html">[squid-users] chunked transfer over sslbump
</A></li>
        <LI>Next message (by thread): <A HREF="026360.html">[squid-users] chunked transfer over sslbump
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26359">[ date ]</a>
              <a href="thread.html#26359">[ thread ]</a>
              <a href="subject.html#26359">[ subject ]</a>
              <a href="author.html#26359">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Alex, good morning. Thank you for your reply. I work together with Arun on this issue. Here is some more detail.

Client got below response headers and body. Masked few details.
Retry seems to fetch data remaining.
Want to point out that removing sslbump everything is working fine, but we wanted to keep it for ICAP scanning.
We tried compiling 6.x in Amazon linux, using latest gcc, but facing similar error - <A HREF="https://lists.squid-cache.org/pipermail/squid-users/2023-July/026016.html">https://lists.squid-cache.org/pipermail/squid-users/2023-July/026016.html</A>

HTTP/1.1 200 OK
Date: Tue, 09 Jan 2024 15:41:33 GMT
Server: Apache/mod_perl/2.0.10 Perl
Content-Type: application/download
X-Cache: MISS from ip-x-y-z
Transfer-Encoding: chunked
Via: xxx (ICAP)
Connection: keep-alive

1000
File-Id: xyz.zip
Local-Path: x/y/z.txt
Content-Size: 2967
&lt; binary content &gt;


Access log(1st attempt):
1704814893.695    138 x.y.0.2 NONE_NONE/200 0 CONNECT a.b.com:443 - FIRSTUP_PARENT/10.x.y.z -
1704814900.491   6779 172.17.0.2 TCP_MISS/200 138996535 POST <A HREF="https://a.b.com/xyz">https://a.b.com/xyz</A> - FIRSTUP_PARENT/10.x.y.z application/download

Retry after 5 mins:
1704815201.530    189 x.y.0.2 NONE_NONE/200 0 CONNECT a.b.com:443 - FIRSTUP_PARENT/10.x.y.z -
1704815208.438   6896 x.y.0.2 TCP_MISS/200 138967930 POST <A HREF="https://a.b.com/xyz">https://a.b.com/xyz</A> - FIRSTUP_PARENT/10.x.y.z application/download

Jinshu Zhang


Fannie Mae Confidential
-----Original Message-----
From: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; On Behalf Of Alex Rousskov
Sent: Tuesday, January 9, 2024 9:53 AM
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: [EXTERNAL] Re: [squid-users] chunked transfer over sslbump


On 2024-01-09 09:13, Arun Kumar wrote:

&gt;<i> I have compiled/installed squid v5.8 in Amazon Linux and configured it
</I>&gt;<i> with sslbump option. Squid is used as proxy to get response from https
</I>&gt;<i> site. When the https site sends chunked response, it appears that the
</I>&gt;<i> first response comes but it get stuck and doesn't receive the full
</I>&gt;<i> response. Appreciate any help.
</I>  There were some recent chunking-related changes in Squid, but none of them is likely to be responsible for the problems you are describing unless the origin server response is very special/unusual.

Does the client in this test get the HTTP response header? Some HTTP response body bytes?

To triage the problem, I recommend sharing the corresponding access.log records (at least). Seeing debugging of the problematic transaction may be very useful (but avoid using production security keys and other sensitive information in such tests):
<A HREF="https://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction">https://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction</A>

Please note that Squid v5 is not officially supported and has more known security vulnerabilities than Squid v6. You should be using Squid v6.


HTH,

Alex.

_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="026357.html">[squid-users] chunked transfer over sslbump
</A></li>
	<LI>Next message (by thread): <A HREF="026360.html">[squid-users] chunked transfer over sslbump
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26359">[ date ]</a>
              <a href="thread.html#26359">[ thread ]</a>
              <a href="subject.html#26359">[ subject ]</a>
              <a href="author.html#26359">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
