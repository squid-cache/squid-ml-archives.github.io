<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] chunked transfer over sslbump
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20chunked%20transfer%20over%20sslbump&In-Reply-To=%3C929108967.11249363.1704896472206%40mail.yahoo.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026360.html">
   <LINK REL="Next"  HREF="026366.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] chunked transfer over sslbump</H1>
    <B>Arun Kumar</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20chunked%20transfer%20over%20sslbump&In-Reply-To=%3C929108967.11249363.1704896472206%40mail.yahoo.com%3E"
       TITLE="[squid-users] chunked transfer over sslbump">s_p_arun at yahoo.com
       </A><BR>
    <I>Wed Jan 10 14:21:12 UTC 2024</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="026360.html">[squid-users] chunked transfer over sslbump
</A></li>
        <LI>Next message (by thread): <A HREF="026366.html">[squid-users] chunked transfer over sslbump
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26364">[ date ]</a>
              <a href="thread.html#26364">[ thread ]</a>
              <a href="subject.html#26364">[ subject ]</a>
              <a href="author.html#26364">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE> i) Retry seems to fetch one chunk of the response and not the complete.ii) Enabling sslbump and turning ICAP off, not helping.&#160;iii)&#160; gcc version is 7.3.1 (Red Hat 7.3.1-17)
Also want to point out that, squid connects to another non-squid proxy to reach internet.cache_peer &lt;proxy_url&gt; parent &lt;port&gt; 0 no-query default
    On Tuesday, January 9, 2024 at 02:18:14 PM EST, Alex Rousskov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt; wrote:  
 
 On 2024-01-09 11:51, Zhang, Jinshu wrote:

&gt;<i> Client got below response headers and body. Masked few details.
</I>
Thank you.


&gt;<i> Retry seems to fetch data remaining.
</I>
I would expect a successful retry to fetch the entire response, not just 
the remaining bytes, but perhaps that is what you meant. Thank you for 
sharing this info.


&gt;<i> Want to point out that removing sslbump everything is working fine,
</I>&gt;<i> but we wanted to keep it for ICAP scanning.
</I>
What if you keep SslBump enabled but disable any ICAP analysis 
(&quot;icap_enable off&quot;)? This test may tell us if the problem is between 
Squid and the origin server or Squid and the ICAP service...


&gt;<i> We tried compiling 6.x in Amazon linux, using latest gcc, but facing similar error - <A HREF="https://lists.squid-cache.org/pipermail/squid-users/2023-July/026016.html">https://lists.squid-cache.org/pipermail/squid-users/2023-July/026016.html</A>
</I>
What is the &quot;latest gcc&quot; version in your environment? I suspect it is 
not the latest GCC version available to folks running Amazon Linux, but 
you may need to install some packages to get a more recent GCC version. 
Unfortunately, I cannot give specific instructions for Amazon Linux 
right now.


HTH,

Alex.


&gt;<i> HTTP/1.1 200 OK
</I>&gt;<i> Date: Tue, 09 Jan 2024 15:41:33 GMT
</I>&gt;<i> Server: Apache/mod_perl/2.0.10 Perl
</I>&gt;<i> Content-Type: application/download
</I>&gt;<i> X-Cache: MISS from ip-x-y-z
</I>&gt;<i> Transfer-Encoding: chunked
</I>&gt;<i> Via: xxx (ICAP)
</I>&gt;<i> Connection: keep-alive
</I>&gt;<i> 
</I>&gt;<i> 1000
</I>&gt;<i> File-Id: xyz.zip
</I>&gt;<i> Local-Path: x/y/z.txt
</I>&gt;<i> Content-Size: 2967
</I>&gt;<i> &lt; binary content &gt;
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Access log(1st attempt):
</I>&gt;<i> 1704814893.695&#160; &#160; 138 x.y.0.2 NONE_NONE/200 0 CONNECT a.b.com:443 - FIRSTUP_PARENT/10.x.y.z -
</I>&gt;<i> 1704814900.491&#160; 6779 172.17.0.2 TCP_MISS/200 138996535 POST <A HREF="https://a.b.com/xyz">https://a.b.com/xyz</A> - FIRSTUP_PARENT/10.x.y.z application/download
</I>&gt;<i> 
</I>&gt;<i> Retry after 5 mins:
</I>&gt;<i> 1704815201.530&#160; &#160; 189 x.y.0.2 NONE_NONE/200 0 CONNECT a.b.com:443 - FIRSTUP_PARENT/10.x.y.z -
</I>&gt;<i> 1704815208.438&#160; 6896 x.y.0.2 TCP_MISS/200 138967930 POST <A HREF="https://a.b.com/xyz">https://a.b.com/xyz</A> - FIRSTUP_PARENT/10.x.y.z application/download
</I>&gt;<i> 
</I>&gt;<i> Jinshu Zhang
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Fannie Mae Confidential
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; On Behalf Of Alex Rousskov
</I>&gt;<i> Sent: Tuesday, January 9, 2024 9:53 AM
</I>&gt;<i> To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> Subject: [EXTERNAL] Re: [squid-users] chunked transfer over sslbump
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On 2024-01-09 09:13, Arun Kumar wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> I have compiled/installed squid v5.8 in Amazon Linux and configured it
</I>&gt;&gt;<i> with sslbump option. Squid is used as proxy to get response from https
</I>&gt;&gt;<i> site. When the https site sends chunked response, it appears that the
</I>&gt;&gt;<i> first response comes but it get stuck and doesn't receive the full
</I>&gt;&gt;<i> response. Appreciate any help.
</I>&gt;<i>&#160; &#160; There were some recent chunking-related changes in Squid, but none of them is likely to be responsible for the problems you are describing unless the origin server response is very special/unusual.
</I>&gt;<i> 
</I>&gt;<i> Does the client in this test get the HTTP response header? Some HTTP response body bytes?
</I>&gt;<i> 
</I>&gt;<i> To triage the problem, I recommend sharing the corresponding access.log records (at least). Seeing debugging of the problematic transaction may be very useful (but avoid using production security keys and other sensitive information in such tests):
</I>&gt;<i> <A HREF="https://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction">https://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction</A>
</I>&gt;<i> 
</I>&gt;<i> Please note that Squid v5 is not officially supported and has more known security vulnerabilities than Squid v6. You should be using Squid v6.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> HTH,
</I>&gt;<i> 
</I>&gt;<i> Alex.
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</I>
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20240110/d1743ba6/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20240110/d1743ba6/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="026360.html">[squid-users] chunked transfer over sslbump
</A></li>
	<LI>Next message (by thread): <A HREF="026366.html">[squid-users] chunked transfer over sslbump
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26364">[ date ]</a>
              <a href="thread.html#26364">[ thread ]</a>
              <a href="subject.html#26364">[ subject ]</a>
              <a href="author.html#26364">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
