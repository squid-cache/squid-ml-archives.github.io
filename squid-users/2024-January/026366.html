<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] chunked transfer over sslbump
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20chunked%20transfer%20over%20sslbump&In-Reply-To=%3Cdf95af22-f03e-48e9-a9a8-9588df436395%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026364.html">
   <LINK REL="Next"  HREF="026370.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] chunked transfer over sslbump</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20chunked%20transfer%20over%20sslbump&In-Reply-To=%3Cdf95af22-f03e-48e9-a9a8-9588df436395%40measurement-factory.com%3E"
       TITLE="[squid-users] chunked transfer over sslbump">rousskov at measurement-factory.com
       </A><BR>
    <I>Wed Jan 10 16:09:45 UTC 2024</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="026364.html">[squid-users] chunked transfer over sslbump
</A></li>
        <LI>Next message (by thread): <A HREF="026370.html">[squid-users] chunked transfer over sslbump
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26366">[ date ]</a>
              <a href="thread.html#26366">[ thread ]</a>
              <a href="subject.html#26366">[ subject ]</a>
              <a href="author.html#26366">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2024-01-10 09:21, Arun Kumar wrote:
&gt;<i> i) Retry seems to fetch one chunk of the response and not the complete.
</I>&gt;<i> ii) Enabling sslbump and turning ICAP off, not helping.
</I>&gt;<i> iii)&#160; gcc version is 7.3.1 (Red Hat 7.3.1-17)
</I>
GCC v7 has insufficient C++17 support. I recommend installing GCC v9 or 
better and then trying with Squid v6.6 or newer.

FWIW, if the problem persists in Squid v6, sharing debugging logs would 
be the next recommended step.


HTH,

Alex.


&gt;<i> Also want to point out that, squid connects to another non-squid proxy 
</I>&gt;<i> to reach internet.
</I>&gt;<i> /cache_peer &lt;proxy_url&gt; parent &lt;port&gt; 0 no-query default/
</I>&gt;<i> 
</I>&gt;<i> On Tuesday, January 9, 2024 at 02:18:14 PM EST, Alex Rousskov wrote:
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On 2024-01-09 11:51, Zhang, Jinshu wrote:
</I>&gt;<i> 
</I>&gt;<i>  &gt; Client got below response headers and body. Masked few details.
</I>&gt;<i> 
</I>&gt;<i> Thank you.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>  &gt; Retry seems to fetch data remaining.
</I>&gt;<i> 
</I>&gt;<i> I would expect a successful retry to fetch the entire response, not just
</I>&gt;<i> the remaining bytes, but perhaps that is what you meant. Thank you for
</I>&gt;<i> sharing this info.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>  &gt; Want to point out that removing sslbump everything is working fine,
</I>&gt;<i>  &gt; but we wanted to keep it for ICAP scanning.
</I>&gt;<i> 
</I>&gt;<i> What if you keep SslBump enabled but disable any ICAP analysis
</I>&gt;<i> (&quot;icap_enable off&quot;)? This test may tell us if the problem is between
</I>&gt;<i> Squid and the origin server or Squid and the ICAP service...
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>  &gt; We tried compiling 6.x in Amazon linux, using latest gcc, but facing 
</I>&gt;<i> similar error - 
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/pipermail/squid-users/2023-July/026016.html">https://lists.squid-cache.org/pipermail/squid-users/2023-July/026016.html</A> &lt;<A HREF="https://lists.squid-cache.org/pipermail/squid-users/2023-July/026016.html">https://lists.squid-cache.org/pipermail/squid-users/2023-July/026016.html</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> What is the &quot;latest gcc&quot; version in your environment? I suspect it is
</I>&gt;<i> not the latest GCC version available to folks running Amazon Linux, but
</I>&gt;<i> you may need to install some packages to get a more recent GCC version.
</I>&gt;<i> Unfortunately, I cannot give specific instructions for Amazon Linux
</I>&gt;<i> right now.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> HTH,
</I>&gt;<i> 
</I>&gt;<i> Alex.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>  &gt; HTTP/1.1 200 OK
</I>&gt;<i>  &gt; Date: Tue, 09 Jan 2024 15:41:33 GMT
</I>&gt;<i>  &gt; Server: Apache/mod_perl/2.0.10 Perl
</I>&gt;<i>  &gt; Content-Type: application/download
</I>&gt;<i>  &gt; X-Cache: MISS from ip-x-y-z
</I>&gt;<i>  &gt; Transfer-Encoding: chunked
</I>&gt;<i>  &gt; Via: xxx (ICAP)
</I>&gt;<i>  &gt; Connection: keep-alive
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt; 1000
</I>&gt;<i>  &gt; File-Id: xyz.zip
</I>&gt;<i>  &gt; Local-Path: x/y/z.txt
</I>&gt;<i>  &gt; Content-Size: 2967
</I>&gt;<i>  &gt; &lt; binary content &gt;
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt; Access log(1st attempt):
</I>&gt;<i>  &gt; 1704814893.695&#160; &#160; 138 x.y.0.2 NONE_NONE/200 0 CONNECT a.b.com:443 - 
</I>&gt;<i> FIRSTUP_PARENT/10.x.y.z -
</I>&gt;<i>  &gt; 1704814900.491&#160; 6779 172.17.0.2 TCP_MISS/200 138996535 POST 
</I>&gt;<i> <A HREF="https://a.b.com/xyz">https://a.b.com/xyz</A> &lt;<A HREF="https://a.b.com/xyz">https://a.b.com/xyz</A>&gt; - FIRSTUP_PARENT/10.x.y.z 
</I>&gt;<i> application/download
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt; Retry after 5 mins:
</I>&gt;<i>  &gt; 1704815201.530&#160; &#160; 189 x.y.0.2 NONE_NONE/200 0 CONNECT a.b.com:443 - 
</I>&gt;<i> FIRSTUP_PARENT/10.x.y.z -
</I>&gt;<i>  &gt; 1704815208.438&#160; 6896 x.y.0.2 TCP_MISS/200 138967930 POST 
</I>&gt;<i> <A HREF="https://a.b.com/xyz">https://a.b.com/xyz</A> &lt;<A HREF="https://a.b.com/xyz">https://a.b.com/xyz</A>&gt; - FIRSTUP_PARENT/10.x.y.z 
</I>&gt;<i> application/download
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt; Jinshu Zhang
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt; Fannie Mae Confidential
</I>&gt;<i>  &gt; -----Original Message-----
</I>&gt;<i>  &gt; From: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A> 
</I>&gt;<i> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt;&gt; On Behalf Of Alex 
</I>&gt;<i> Rousskov
</I>&gt;<i>  &gt; Sent: Tuesday, January 9, 2024 9:53 AM
</I>&gt;<i>  &gt; To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> 
</I>&gt;<i> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i>  &gt; Subject: [EXTERNAL] Re: [squid-users] chunked transfer over sslbump
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt; On 2024-01-09 09:13, Arun Kumar wrote:
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;&gt; I have compiled/installed squid v5.8 in Amazon Linux and configured it
</I>&gt;<i>  &gt;&gt; with sslbump option. Squid is used as proxy to get response from https
</I>&gt;<i>  &gt;&gt; site. When the https site sends chunked response, it appears that the
</I>&gt;<i>  &gt;&gt; first response comes but it get stuck and doesn't receive the full
</I>&gt;<i>  &gt;&gt; response. Appreciate any help.
</I>&gt;<i>  &gt;&#160; &#160; There were some recent chunking-related changes in Squid, but none 
</I>&gt;<i> of them is likely to be responsible for the problems you are describing 
</I>&gt;<i> unless the origin server response is very special/unusual.
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt; Does the client in this test get the HTTP response header? Some HTTP 
</I>&gt;<i> response body bytes?
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt; To triage the problem, I recommend sharing the corresponding 
</I>&gt;<i> access.log records (at least). Seeing debugging of the problematic 
</I>&gt;<i> transaction may be very useful (but avoid using production security keys 
</I>&gt;<i> and other sensitive information in such tests):
</I>&gt;<i>  &gt; 
</I>&gt;<i> <A HREF="https://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction">https://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction</A> &lt;<A HREF="https://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction">https://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction</A>&gt;
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt; Please note that Squid v5 is not officially supported and has more 
</I>&gt;<i> known security vulnerabilities than Squid v6. You should be using Squid v6.
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt; HTH,
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt; Alex.
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt; _______________________________________________
</I>&gt;<i>  &gt; squid-users mailing list
</I>&gt;<i>  &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> 
</I>&gt;<i> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i>  &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A> 
</I>&gt;<i> &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>&gt;
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt; _______________________________________________
</I>&gt;<i>  &gt; squid-users mailing list
</I>&gt;<i>  &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> 
</I>&gt;<i> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i>  &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A> 
</I>&gt;<i> &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A> 
</I>&gt;<i> &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>&gt;
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="026364.html">[squid-users] chunked transfer over sslbump
</A></li>
	<LI>Next message (by thread): <A HREF="026370.html">[squid-users] chunked transfer over sslbump
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26366">[ date ]</a>
              <a href="thread.html#26366">[ thread ]</a>
              <a href="subject.html#26366">[ subject ]</a>
              <a href="author.html#26366">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
