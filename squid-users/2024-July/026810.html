<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid Cache Issues migration from 5.8 to 6.6
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20Cache%20Issues%20migration%20from%205.8%20to%206.6&In-Reply-To=%3C3b237f87-7b8d-4db7-9b8e-b42233a9a288%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026806.html">
   <LINK REL="Next"  HREF="026813.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid Cache Issues migration from 5.8 to 6.6</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20Cache%20Issues%20migration%20from%205.8%20to%206.6&In-Reply-To=%3C3b237f87-7b8d-4db7-9b8e-b42233a9a288%40measurement-factory.com%3E"
       TITLE="[squid-users] Squid Cache Issues migration from 5.8 to 6.6">rousskov at measurement-factory.com
       </A><BR>
    <I>Fri Jul  5 13:33:26 UTC 2024</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="026806.html">[squid-users] Squid Cache Issues migration from 5.8 to 6.6
</A></li>
        <LI>Next message (by thread): <A HREF="026813.html">[squid-users] Squid Cache Issues migration from 5.8 to 6.6
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26810">[ date ]</a>
              <a href="thread.html#26810">[ thread ]</a>
              <a href="subject.html#26810">[ subject ]</a>
              <a href="author.html#26810">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2024-07-04 19:12, Jonathan Lee wrote:
&gt;<i> You also stated .. &quot;&#160;my current working theory suggests that we are 
</I>&gt;<i> looking at a (default) signUntrusted use case.&#8221;
</I>&gt;<i> 
</I>&gt;<i> I noticed for Squid documents that default is now set to off ..
</I>
The http_port option you are looking at now is not the directive I was 
talking about earlier.

 &gt; http_port
&gt;<i>    tls-default-ca[=off]
</I>&gt;<i> 			Whether to use the system Trusted CAs. Default is OFF.
</I>&gt;<i> 
</I>&gt;<i> Would enabling this resolve the problem in Squid 6.6 for error.
</I>

No, the above poorly documented http_port option is for validating 
_client_ certificates. It has been off since Squid v4 AFAICT. Your 
clients are not sending client certificates to Squid.

According to the working theory, the problem we are solving is related 
to server certificates. http_port tls-default-ca option does not affect 
server certificate validation. Server certificate validation should use 
default CAs by default.

Outside of SslBump, server certificate validation is controlled by 
tls_outgoing_options default-ca option. That option defaults to &quot;on&quot;. I 
am not sure whether SslBump honors that directive/option though. There 
are known related bugs in that area. However, we are jumping ahead of 
ourselves. We should confirm the working theory first.

 &gt; The squid.conf.documented lists it incorrectly

Squid has many directives and a directive may have many options. One 
should not use an directive option name instead of a directive name. One 
should not use an option from one directive with another directive. 
Squid naming is often inconsistent; be careful.

* http_port is a directive. tls-default-ca is an option for that 
directive. It is used for client certificate validation. It defaults to 
&quot;off&quot; (because client certificates are rarely signed by well-known 
(a.k.a. &quot;default&quot;) CAs preinstalled in many deployment environments).

* tls_outgoing_options is a directive. default-ca is an option for that 
directive. It is used for server certificate validation outside of 
SslBump contexts (at least!). It defaults to &quot;on&quot; (because server 
certificates are usually signed by well-known (a.k.a. &quot;default&quot;) CAs 
preinstalled in many deployment environments).

AFAICT, the documentation in question is not wrong (but is insufficient).

Again, I do not recommend changing any Squid configuration 
directives/options at this triage state.

Alex.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="026806.html">[squid-users] Squid Cache Issues migration from 5.8 to 6.6
</A></li>
	<LI>Next message (by thread): <A HREF="026813.html">[squid-users] Squid Cache Issues migration from 5.8 to 6.6
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26810">[ date ]</a>
              <a href="thread.html#26810">[ thread ]</a>
              <a href="subject.html#26810">[ subject ]</a>
              <a href="author.html#26810">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
