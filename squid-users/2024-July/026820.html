<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid Cache Issues migration from 5.8 to 6.6
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20Cache%20Issues%20migration%20from%205.8%20to%206.6&In-Reply-To=%3C6C06354C-7CC0-47D9-A50F-66192916AD4D%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026817.html">
   <LINK REL="Next"  HREF="026822.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid Cache Issues migration from 5.8 to 6.6</H1>
    <B>Jonathan Lee</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20Cache%20Issues%20migration%20from%205.8%20to%206.6&In-Reply-To=%3C6C06354C-7CC0-47D9-A50F-66192916AD4D%40gmail.com%3E"
       TITLE="[squid-users] Squid Cache Issues migration from 5.8 to 6.6">jonathanlee571 at gmail.com
       </A><BR>
    <I>Fri Jul  5 17:35:17 UTC 2024</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="026817.html">[squid-users] Squid Cache Issues migration from 5.8 to 6.6
</A></li>
        <LI>Next message (by thread): <A HREF="026822.html">[squid-users] Squid Cache Issues migration from 5.8 to 6.6
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26820">[ date ]</a>
              <a href="thread.html#26820">[ thread ]</a>
              <a href="subject.html#26820">[ subject ]</a>
              <a href="author.html#26820">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Side note: I have just found while analyzing Wireshark packets that this A000417 error only occurs with use of the iMac and the Safari browser, this does not occur on Windows 10 with the Edge browser. 

&gt;<i> On Jul 5, 2024, at 09:02, Jonathan Lee &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">jonathanlee571 at gmail.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> per 
</I>&gt;<i> 
</I>&gt;<i> As the next step in triage, I recommend determining what that CA is in these cases (e.g., by capturing raw TLS packets and matching them with connection information from A000417 error messages in cache.log or %err_detail in access.log).
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> I have Wireshark running do I just look for information with ssl.handshake.type == 1
</I>&gt;<i> 
</I>&gt;<i> Or is there a wireshark particular filter you would like ran to help with isolation?
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> On Jul 5, 2024, at 08:23, Jonathan Lee &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">jonathanlee571 at gmail.com</A>&gt; wrote:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Thanks for the email and support with this. I will get wireshark running on the client and get the info required. Yes the information prior is from the firewall side outside of the proxy testing from the demilitarized zone area. I wanted to test this first to rule that out as it&#8217;s coming in from that first and hits the proxy next
</I>&gt;&gt;<i> Sent from my iPhone
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> On Jul 5, 2024, at 06:33, Alex Rousskov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt; wrote:
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> &#65279;On 2024-07-04 19:12, Jonathan Lee wrote:
</I>&gt;&gt;&gt;&gt;<i> You also stated .. &quot; my current working theory suggests that we are looking at a (default) signUntrusted use case.&#8221;
</I>&gt;&gt;&gt;&gt;<i> I noticed for Squid documents that default is now set to off ..
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> The http_port option you are looking at now is not the directive I was talking about earlier.
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> http_port
</I>&gt;&gt;&gt;&gt;<i> tls-default-ca[=off]
</I>&gt;&gt;&gt;&gt;<i>  Whether to use the system Trusted CAs. Default is OFF.
</I>&gt;&gt;&gt;&gt;<i> Would enabling this resolve the problem in Squid 6.6 for error.
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> No, the above poorly documented http_port option is for validating _client_ certificates. It has been off since Squid v4 AFAICT. Your clients are not sending client certificates to Squid.
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> According to the working theory, the problem we are solving is related to server certificates. http_port tls-default-ca option does not affect server certificate validation. Server certificate validation should use default CAs by default.
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> Outside of SslBump, server certificate validation is controlled by tls_outgoing_options default-ca option. That option defaults to &quot;on&quot;. I am not sure whether SslBump honors that directive/option though. There are known related bugs in that area. However, we are jumping ahead of ourselves. We should confirm the working theory first.
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> The squid.conf.documented lists it incorrectly
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> Squid has many directives and a directive may have many options. One should not use an directive option name instead of a directive name. One should not use an option from one directive with another directive. Squid naming is often inconsistent; be careful.
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> * http_port is a directive. tls-default-ca is an option for that directive. It is used for client certificate validation. It defaults to &quot;off&quot; (because client certificates are rarely signed by well-known (a.k.a. &quot;default&quot;) CAs preinstalled in many deployment environments).
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> * tls_outgoing_options is a directive. default-ca is an option for that directive. It is used for server certificate validation outside of SslBump contexts (at least!). It defaults to &quot;on&quot; (because server certificates are usually signed by well-known (a.k.a. &quot;default&quot;) CAs preinstalled in many deployment environments).
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> AFAICT, the documentation in question is not wrong (but is insufficient).
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> Again, I do not recommend changing any Squid configuration directives/options at this triage state.
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> Alex.
</I>&gt;&gt;&gt;<i> 
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="026817.html">[squid-users] Squid Cache Issues migration from 5.8 to 6.6
</A></li>
	<LI>Next message (by thread): <A HREF="026822.html">[squid-users] Squid Cache Issues migration from 5.8 to 6.6
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26820">[ date ]</a>
              <a href="thread.html#26820">[ thread ]</a>
              <a href="subject.html#26820">[ subject ]</a>
              <a href="author.html#26820">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
