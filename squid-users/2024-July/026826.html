<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid Cache Issues migration from 5.8 to 6.6
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20Cache%20Issues%20migration%20from%205.8%20to%206.6&In-Reply-To=%3C2EEDA700-23AA-4CA0-97D6-AA60122AA0DE%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026825.html">
   <LINK REL="Next"  HREF="026827.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid Cache Issues migration from 5.8 to 6.6</H1>
    <B>Jonathan Lee</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20Cache%20Issues%20migration%20from%205.8%20to%206.6&In-Reply-To=%3C2EEDA700-23AA-4CA0-97D6-AA60122AA0DE%40gmail.com%3E"
       TITLE="[squid-users] Squid Cache Issues migration from 5.8 to 6.6">jonathanlee571 at gmail.com
       </A><BR>
    <I>Fri Jul  5 21:21:39 UTC 2024</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="026825.html">[squid-users] Squid Cache Issues migration from 5.8 to 6.6
</A></li>
        <LI>Next message (by thread): <A HREF="026827.html">[squid-users] Squid Cache Issues migration from 5.8 to 6.6
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26826">[ date ]</a>
              <a href="thread.html#26826">[ thread ]</a>
              <a href="subject.html#26826">[ subject ]</a>
              <a href="author.html#26826">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>output of versions 

Shell Output - openssl ciphers -s -v ECDHE
TLS_AES_256_GCM_SHA384         TLSv1.3 Kx=any      Au=any   Enc=AESGCM(256)            Mac=AEAD
TLS_CHACHA20_POLY1305_SHA256   TLSv1.3 Kx=any      Au=any   Enc=CHACHA20/POLY1305(256) Mac=AEAD
TLS_AES_128_GCM_SHA256         TLSv1.3 Kx=any      Au=any   Enc=AESGCM(128)            Mac=AEAD
ECDHE-ECDSA-AES256-GCM-SHA384  TLSv1.2 Kx=ECDH     Au=ECDSA Enc=AESGCM(256)            Mac=AEAD
ECDHE-RSA-AES256-GCM-SHA384    TLSv1.2 Kx=ECDH     Au=RSA   Enc=AESGCM(256)            Mac=AEAD
ECDHE-ECDSA-CHACHA20-POLY1305  TLSv1.2 Kx=ECDH     Au=ECDSA Enc=CHACHA20/POLY1305(256) Mac=AEAD
ECDHE-RSA-CHACHA20-POLY1305    TLSv1.2 Kx=ECDH     Au=RSA   Enc=CHACHA20/POLY1305(256) Mac=AEAD
ECDHE-ECDSA-AES256-CCM8        TLSv1.2 Kx=ECDH     Au=ECDSA Enc=AESCCM8(256)           Mac=AEAD
ECDHE-ECDSA-AES256-CCM         TLSv1.2 Kx=ECDH     Au=ECDSA Enc=AESCCM(256)            Mac=AEAD
ECDHE-ECDSA-AES128-GCM-SHA256  TLSv1.2 Kx=ECDH     Au=ECDSA Enc=AESGCM(128)            Mac=AEAD
ECDHE-RSA-AES128-GCM-SHA256    TLSv1.2 Kx=ECDH     Au=RSA   Enc=AESGCM(128)            Mac=AEAD
ECDHE-ECDSA-AES128-CCM8        TLSv1.2 Kx=ECDH     Au=ECDSA Enc=AESCCM8(128)           Mac=AEAD
ECDHE-ECDSA-AES128-CCM         TLSv1.2 Kx=ECDH     Au=ECDSA Enc=AESCCM(128)            Mac=AEAD
ECDHE-ECDSA-AES256-SHA384      TLSv1.2 Kx=ECDH     Au=ECDSA Enc=AES(256)               Mac=SHA384
ECDHE-RSA-AES256-SHA384        TLSv1.2 Kx=ECDH     Au=RSA   Enc=AES(256)               Mac=SHA384
ECDHE-ECDSA-CAMELLIA256-SHA384 TLSv1.2 Kx=ECDH     Au=ECDSA Enc=Camellia(256)          Mac=SHA384
ECDHE-RSA-CAMELLIA256-SHA384   TLSv1.2 Kx=ECDH     Au=RSA   Enc=Camellia(256)          Mac=SHA384
ECDHE-ECDSA-AES128-SHA256      TLSv1.2 Kx=ECDH     Au=ECDSA Enc=AES(128)               Mac=SHA256
ECDHE-RSA-AES128-SHA256        TLSv1.2 Kx=ECDH     Au=RSA   Enc=AES(128)               Mac=SHA256
ECDHE-ECDSA-CAMELLIA128-SHA256 TLSv1.2 Kx=ECDH     Au=ECDSA Enc=Camellia(128)          Mac=SHA256
ECDHE-RSA-CAMELLIA128-SHA256   TLSv1.2 Kx=ECDH     Au=RSA   Enc=Camellia(128)          Mac=SHA256
ECDHE-ECDSA-AES256-SHA         TLSv1   Kx=ECDH     Au=ECDSA Enc=AES(256)               Mac=SHA1
ECDHE-RSA-AES256-SHA           TLSv1   Kx=ECDH     Au=RSA   Enc=AES(256)               Mac=SHA1
ECDHE-ECDSA-AES128-SHA         TLSv1   Kx=ECDH     Au=ECDSA Enc=AES(128)               Mac=SHA1
ECDHE-RSA-AES128-SHA           TLSv1   Kx=ECDH     Au=RSA   Enc=AES(128)               Mac=SHA1
So it does support TLSv1.3 Could it be because my certificate authority is type RSA? Disabling TLSv1.3 would fix it again that doesn&#8217;t help me in the future 

openssl req -x509 -new -nodes -key myProxykey.key -sha256 -days 365 -out myProxyca.pem



&gt;<i> On Jul 5, 2024, at 13:54, Jonathan Lee &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">jonathanlee571 at gmail.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> I have also tested in 5.8 and 6.6 both show the same condition, 6.6 shows errors for it however. I have also imported my certificates into wireshark. 
</I>&gt;<i> 
</I>&gt;<i> Just to confirm this is the firewall 192.168.1.1 port 3128 is squid going to iMac that is attempting TSL1.3 I have nosslv3 set also. The firewall is where I grabbed the pcap from 
</I>&gt;<i> Sent from my iPhone
</I>&gt;<i> 
</I>&gt;&gt;<i> On Jul 5, 2024, at 11:52, Jonathan Lee &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">jonathanlee571 at gmail.com</A>&gt; wrote:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> &#65279;If it&#8217;s encrypted at TLS1.3 it should still work with the approved certificate authority as it is imported to my devices I own. I just enable TLS1.3 right?
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> On Jul 5, 2024, at 11:28, &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">jonathanlee571 at gmail.com</A>&gt; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">jonathanlee571 at gmail.com</A>&gt; wrote:
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> The only one I got a certificate from was the non iMac
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> The iMac keeps sending change cipher requests and wants TLS1.3 over and over as soon as a TLS1.2 pops up it works
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> That one has the certificate however that system the Toshiba does not have any issues with this error. I highly suspect that I need to enable TLS1.3 would you agree?
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> -----Original Message-----
</I>&gt;&gt;&gt;<i> From: Alex Rousskov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt;
</I>&gt;&gt;&gt;<i> Sent: Friday, July 5, 2024 11:02 AM
</I>&gt;&gt;&gt;<i> To: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;&gt;&gt;<i> Cc: Jonathan Lee &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">jonathanlee571 at gmail.com</A>&gt;
</I>&gt;&gt;&gt;<i> Subject: Re: [squid-users] Squid Cache Issues migration from 5.8 to 6.6
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> On 2024-07-05 12:02, Jonathan Lee wrote:
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> Alex: I recommend determining what that CA is in these cases (e.g., by capturing raw TLS packets and matching them with connection information from A000417 error messages in cache.log or %err_detail in access.log).
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> I have Wireshark running do I just look for information with
</I>&gt;&gt;&gt;&gt;<i> ssl.handshake.type == 1
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> Or is there a wireshark particular filter you would like ran to help with isolation?
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> Please use Wireshark to determine the name of CA that issued the certificate that Squid sent to the client in the failing test case. If you are not sure, feel free to share issuer and subject fields of all certificates that Squid sent to the client in that test case (there may be two of each if Squid sent two certificates). Or even share a pointer to the entire (compressed) raw test case packet capture in pcap format!
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> These certificates are a part of standard TLS handshake, and Wireshark usually displays their fields when one studies TLS handshake bytes using Wireshark UI.
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> I do not know what filter would work best, but there should be just a handful of TLS handshake packets to examine for the test case, so no filter should be necessary.
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> HTH,
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> Alex.
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> On Jul 5, 2024, at 08:23, Jonathan Lee &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">jonathanlee571 at gmail.com</A>&gt; wrote:
</I>&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> Thanks for the email and support with this. I will get wireshark
</I>&gt;&gt;&gt;&gt;&gt;<i> running on the client and get the info required. Yes the information
</I>&gt;&gt;&gt;&gt;&gt;<i> prior is from the firewall side outside of the proxy testing from the
</I>&gt;&gt;&gt;&gt;&gt;<i> demilitarized zone area. I wanted to test this first to rule that out
</I>&gt;&gt;&gt;&gt;&gt;<i> as it&#8217;s coming in from that first and hits the proxy next Sent from
</I>&gt;&gt;&gt;&gt;&gt;<i> my iPhone
</I>&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> On Jul 5, 2024, at 06:33, Alex Rousskov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt; wrote:
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> &#65279;On 2024-07-04 19:12, Jonathan Lee wrote:
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> You also stated .. &quot; my current working theory suggests that we are looking at a (default) signUntrusted use case.&#8221;
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> I noticed for Squid documents that default is now set to off ..
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> The http_port option you are looking at now is not the directive I was talking about earlier.
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> http_port
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> tls-default-ca[=off]
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> Whether to use the system Trusted CAs. Default is OFF.
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> Would enabling this resolve the problem in Squid 6.6 for error.
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> No, the above poorly documented http_port option is for validating _client_ certificates. It has been off since Squid v4 AFAICT. Your clients are not sending client certificates to Squid.
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> According to the working theory, the problem we are solving is related to server certificates. http_port tls-default-ca option does not affect server certificate validation. Server certificate validation should use default CAs by default.
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> Outside of SslBump, server certificate validation is controlled by tls_outgoing_options default-ca option. That option defaults to &quot;on&quot;. I am not sure whether SslBump honors that directive/option though. There are known related bugs in that area. However, we are jumping ahead of ourselves. We should confirm the working theory first.
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> The squid.conf.documented lists it incorrectly
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> Squid has many directives and a directive may have many options. One should not use an directive option name instead of a directive name. One should not use an option from one directive with another directive. Squid naming is often inconsistent; be careful.
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> * http_port is a directive. tls-default-ca is an option for that directive. It is used for client certificate validation. It defaults to &quot;off&quot; (because client certificates are rarely signed by well-known (a.k.a. &quot;default&quot;) CAs preinstalled in many deployment environments).
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> * tls_outgoing_options is a directive. default-ca is an option for that directive. It is used for server certificate validation outside of SslBump contexts (at least!). It defaults to &quot;on&quot; (because server certificates are usually signed by well-known (a.k.a. &quot;default&quot;) CAs preinstalled in many deployment environments).
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> AFAICT, the documentation in question is not wrong (but is insufficient).
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> Again, I do not recommend changing any Squid configuration directives/options at this triage state.
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> Alex.
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> &lt;tlschange.PNG&gt;
</I>&gt;&gt;<i> 
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20240705/0f6f10a5/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20240705/0f6f10a5/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="026825.html">[squid-users] Squid Cache Issues migration from 5.8 to 6.6
</A></li>
	<LI>Next message (by thread): <A HREF="026827.html">[squid-users] Squid Cache Issues migration from 5.8 to 6.6
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26826">[ date ]</a>
              <a href="thread.html#26826">[ thread ]</a>
              <a href="subject.html#26826">[ subject ]</a>
              <a href="author.html#26826">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
