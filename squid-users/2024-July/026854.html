<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Rewriting HTTP to HTTPS for generic package proxy
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Rewriting%20HTTP%20to%20HTTPS%20for%20generic%20package%20proxy&In-Reply-To=%3C3ea0b87c-fe4a-40c7-8512-369a1299cfad%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026853.html">
   <LINK REL="Next"  HREF="026859.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Rewriting HTTP to HTTPS for generic package proxy</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Rewriting%20HTTP%20to%20HTTPS%20for%20generic%20package%20proxy&In-Reply-To=%3C3ea0b87c-fe4a-40c7-8512-369a1299cfad%40measurement-factory.com%3E"
       TITLE="[squid-users] Rewriting HTTP to HTTPS for generic package proxy">rousskov at measurement-factory.com
       </A><BR>
    <I>Wed Jul 10 12:49:35 UTC 2024</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="026853.html">[squid-users] Rewriting HTTP to HTTPS for generic package proxy
</A></li>
        <LI>Next message (by thread): <A HREF="026859.html">[squid-users] Rewriting HTTP to HTTPS for generic package proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26854">[ date ]</a>
              <a href="thread.html#26854">[ thread ]</a>
              <a href="subject.html#26854">[ subject ]</a>
              <a href="author.html#26854">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2024-07-09 18:25, Fiehe, Christoph wrote:

&gt;<i> I hope that somebody has an idea, what I am doing wrong. 
</I>
AFAICT from the debugging log, it is your parent proxy that returns an 
ERR_SECURE_CONNECT_FAIL error page in response to a seemingly valid 
&quot;HEAD <A HREF="https://...">https://...</A>&quot; request. Can you ask their admin to investigate? You 
may also recommend that they upgrade from Squid v4 that has many known 
security vulnerabiities.

If parent is uncooperative, you can try to reproduce the problem by 
temporary installing your own parent Squid instance and configuring your 
child Squid to use that instead.

HTH,

Alex.
P.S. Unlike Amos, I do not see serious conceptual problems with 
rewriting request target scheme (as a temporary compatibility measure). 
It may not always work, for various reasons, but it does not necessarily 
make things worse (and may make things better).




I try to build a generic package proxy with Squid and need the feature 
to rewrite (not redirect) a HTTP request to a package repository 
transparently to a HTTPS-based package source. I was able to get Jesred 
working and defined the following rewrite rule:
&gt;<i> 
</I>&gt;<i> regex ^http:\/\/download\.docker\.com(.*)$ <A HREF="https://download.docker.com\1">https://download.docker.com\1</A>
</I>&gt;<i> 
</I>&gt;<i> I had to use a parent upstream proxy. In my test case the rule gets applied successfully:
</I>&gt;<i> 
</I>&gt;<i> 1720558404.106 10.2.59.102/molecule-ubuntu-jammy.lx.mycompany.de <A HREF="http://download.docker.com/linux/ubuntu/dists/jammy/InRelease[http://download.docker.com/linux/ubuntu/dists/jammy/InRelease">http://download.docker.com/linux/ubuntu/dists/jammy/InRelease[http://download.docker.com/linux/ubuntu/dists/jammy/InRelease</A>] <A HREF="https://download.docker.com/linux/ubuntu/dists/jammy/InRelease">https://download.docker.com/linux/ubuntu/dists/jammy/InRelease</A> 2
</I>&gt;<i> 
</I>&gt;<i> I have validated that the returned URL is correct and that the resource is accessible via my upstream proxy.
</I>&gt;<i> 
</I>&gt;<i> But at the very end, the client receives a 503 error code. I have set &quot;debug_options ALL,3&quot; and this gives the log:
</I>&gt;<i> 
</I>&gt;<i> [...]
</I>&gt;<i> 2024/07/09 23:35:40.115 kid1| 11,2| client_side.cc(1333) parseHttpRequest: HTTP Client REQUEST:
</I>&gt;<i> ---------
</I>&gt;<i> HEAD <A HREF="http://download.docker.com/linux/ubuntu/dists/jammy/InRelease[http://download.docker.com/linux/ubuntu/dists/jammy/InRelease">http://download.docker.com/linux/ubuntu/dists/jammy/InRelease[http://download.docker.com/linux/ubuntu/dists/jammy/InRelease</A>] HTTP/1.1
</I>&gt;<i> Host: download.docker.com
</I>&gt;<i> User-Agent: curl/7.81.0
</I>&gt;<i> Accept: */*
</I>&gt;<i> Proxy-Connection: Keep-Alive
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> ----------
</I>&gt;<i> 2024/07/09 23:35:40.115 kid1| 33,3| client_side.cc(1364) parseHttpRequest: complete request received. prefix_sz = 174, request-line-size=77, mime-header-size=97, mime header block:
</I>&gt;<i> Host: download.docker.com
</I>&gt;<i> User-Agent: curl/7.81.0
</I>&gt;<i> Accept: */*
</I>&gt;<i> Proxy-Connection: Keep-Alive
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> ----------
</I>&gt;<i> 2024/07/09 23:35:40.115 kid1| 87,3| clientStream.cc(139) clientStreamInsertHead: clientStreamInsertHead: Inserted node 0x5c3ba4154308 with data 0x5c3ba4152950 after head
</I>&gt;<i> 2024/07/09 23:35:40.115 kid1| 5,3| comm.cc(599) commSetConnTimeout: conn9 local=10.2.59.103:8000 remote=10.2.59.102:56466 FD 15 flags=1 timeout 86400
</I>&gt;<i> 2024/07/09 23:35:40.115 kid1| 33,3| client_side.cc(1767) add: 0x5c3ba41518e0*3 to 0/0
</I>&gt;<i> 2024/07/09 23:35:40.115 kid1| 33,3| Pipeline.cc(24) add: Pipeline 0x5c3ba41501f0 add request 1 0x5c3ba41518e0*4
</I>&gt;<i> 2024/07/09 23:35:40.115 kid1| 23,3| Uri.cc(446) parse: Split URL '<A HREF="http://download.docker.com/linux/ubuntu/dists/jammy/InRelease">http://download.docker.com/linux/ubuntu/dists/jammy/InRelease</A>'[<A HREF="http://download.docker.com/linux/ubuntu/dists/jammy/InRelease">http://download.docker.com/linux/ubuntu/dists/jammy/InRelease</A>'] into proto='http', host='download.docker.com', port='80', path='/linux/ubuntu/dists/jammy/InRelease'
</I>&gt;<i> 2024/07/09 23:35:40.115 kid1| 14,3| Address.cc(389) lookupHostIP: Given Non-IP 'download.docker.com': Name or service not known
</I>&gt;<i> 2024/07/09 23:35:40.115 kid1| 33,3| client_side.cc(702) clientSetKeepaliveFlag: http_ver = HTTP/1.1
</I>&gt;<i> 2024/07/09 23:35:40.115 kid1| 33,3| client_side.cc(703) clientSetKeepaliveFlag: method = HEAD
</I>&gt;<i> 2024/07/09 23:35:40.115 kid1| 85,3| client_side_request.cc(122) ClientRequestContext: ClientRequestContext constructed, this=0x5c3ba4154e78
</I>&gt;<i> 2024/07/09 23:35:40.115 kid1| 83,3| client_side_request.cc(1708) doCallouts: Doing calloutContext-&gt;hostHeaderVerify()
</I>&gt;<i> 2024/07/09 23:35:40.115 kid1| 85,3| client_side_request.cc(606) hostHeaderVerify: validate host=download.docker.com, port=0, portStr=NULL
</I>&gt;<i> 2024/07/09 23:35:40.115 kid1| 85,3| client_side_request.cc(620) hostHeaderVerify: validate skipped.
</I>&gt;<i> 2024/07/09 23:35:40.115 kid1| 83,3| client_side_request.cc(1715) doCallouts: Doing calloutContext-&gt;clientAccessCheck()
</I>&gt;<i> 2024/07/09 23:35:40.115 kid1| 28,3| Checklist.cc(69) preCheck: 0x5c3ba41552d8 checking slow rules
</I>&gt;<i> 2024/07/09 23:35:40.115 kid1| 28,3| Ip.cc(538) match: aclIpMatchIp: '10.2.59.102:56466' found
</I>&gt;<i> 2024/07/09 23:35:40.115 kid1| 28,3| Acl.cc(175) matches: checked: all = 1
</I>&gt;<i> 2024/07/09 23:35:40.115 kid1| 28,3| Acl.cc(175) matches: checked: http_access#1 = 1
</I>&gt;<i> 2024/07/09 23:35:40.115 kid1| 28,3| Acl.cc(175) matches: checked: http_access = 1
</I>&gt;<i> 2024/07/09 23:35:40.115 kid1| 28,3| Checklist.cc(62) markFinished: 0x5c3ba41552d8 answer ALLOWED for match
</I>&gt;<i> 2024/07/09 23:35:40.115 kid1| 28,3| Checklist.cc(162) checkCallback: ACLChecklist::checkCallback: 0x5c3ba41552d8 answer=ALLOWED
</I>&gt;<i> 2024/07/09 23:35:40.115 kid1| 85,2| client_side_request.cc(714) clientAccessCheckDone: The request HEAD <A HREF="http://download.docker.com/linux/ubuntu/dists/jammy/InRelease[http://download.docker.com/linux/ubuntu/dists/jammy/InRelease">http://download.docker.com/linux/ubuntu/dists/jammy/InRelease[http://download.docker.com/linux/ubuntu/dists/jammy/InRelease</A>] is ALLOWED; last ACL checked: all
</I>&gt;<i> 2024/07/09 23:35:40.115 kid1| 83,3| AccessCheck.cc(42) Start: adaptation off, skipping
</I>&gt;<i> 2024/07/09 23:35:40.115 kid1| 83,3| client_side_request.cc(1735) doCallouts: Doing calloutContext-&gt;clientRedirectStart()
</I>&gt;<i> 2024/07/09 23:35:40.115 kid1| 78,3| dns_internal.cc(1836) idnsPTRLookup: idnsPTRLookup: buf is 42 bytes for 10.2.59.102, id = 0x8d95
</I>&gt;<i> 2024/07/09 23:35:40.115 kid1| 50,3| comm.cc(927) comm_udp_sendto: comm_udp_sendto: Attempt to send UDP packet to 127.0.0.53:53 using FD 11 using Port 54280
</I>&gt;<i> 2024/07/09 23:35:40 kid1| Starting new redirector helpers...
</I>&gt;<i> current master transaction: master54
</I>&gt;<i> 2024/07/09 23:35:40 kid1| helperOpenServers: Starting 1/3 'jesred' processes
</I>&gt;<i> current master transaction: master54
</I>&gt;<i> 2024/07/09 23:35:40.115 kid1| 51,3| fd.cc(168) fd_open: fd_open() FD 17 IPC UNIX STREAM Parent
</I>&gt;<i> 2024/07/09 23:35:40.115 kid1| 51,3| fd.cc(168) fd_open: fd_open() FD 19 IPC UNIX STREAM Parent
</I>&gt;<i> 2024/07/09 23:35:40.115 kid1| 54,3| ipc.cc(212) ipcCreate: ipcCreate: prfd FD 17
</I>&gt;<i> 2024/07/09 23:35:40.115 kid1| 54,3| ipc.cc(213) ipcCreate: ipcCreate: pwfd FD 17
</I>&gt;<i> 2024/07/09 23:35:40.115 kid1| 54,3| ipc.cc(214) ipcCreate: ipcCreate: crfd FD 19
</I>&gt;<i> 2024/07/09 23:35:40.115 kid1| 54,3| ipc.cc(215) ipcCreate: ipcCreate: cwfd FD 19
</I>&gt;<i> 2024/07/09 23:35:40.116 kid1| 5,3| comm.cc(850) _comm_close: start closing FD 19 by ipc.cc:271
</I>&gt;<i> 2024/07/09 23:35:40.116 kid1| 5,3| comm.cc(586) commUnsetFdTimeout: Remove timeout for FD 19
</I>&gt;<i> 2024/07/09 23:35:40.116 kid1| 21,3| tools.cc(561) leave_suid: leave_suid: PID 503746 called
</I>&gt;<i> 2024/07/09 23:35:40.116 kid1| 21,3| tools.cc(651) no_suid: no_suid: PID 503746 giving up root privileges forever
</I>&gt;<i> 2024/07/09 23:35:40.116 kid1| 5,3| comm.cc(586) commUnsetFdTimeout: Remove timeout for FD 17
</I>&gt;<i> 2024/07/09 23:35:40.117 kid1| 84,3| helper.cc(1310) GetFirstAvailable: GetFirstAvailable: Least-loaded helper is fully loaded!
</I>&gt;<i> 2024/07/09 23:35:40.117 kid1| 51,3| fd.cc(93) fd_close: fd_close FD 19 IPC UNIX STREAM Parent
</I>&gt;<i> 2024/07/09 23:35:40.117 kid1| 78,3| dns_internal.cc(1319) idnsRead: idnsRead: starting with FD 11
</I>&gt;<i> 2024/07/09 23:35:40.117 kid1| 78,3| dns_internal.cc(1365) idnsRead: idnsRead: FD 11: received 92 bytes from 127.0.0.53:53
</I>&gt;<i> 2024/07/09 23:35:40.117 kid1| 78,3| dns_internal.cc(1172) idnsGrokReply: idnsGrokReply: QID 0x8d95, 1 answers
</I>&gt;<i> 2024/07/09 23:35:40.117 kid1| 35,3| fqdncache.cc(336) fqdncacheParse: fqdncacheParse: 1 answers for '10.2.59.102'
</I>&gt;<i> 2024/07/09 23:35:40.117 kid1| 5,3| IoCallback.cc(112) finish: called for conn11 local=[::] remote=[::] FD 17 flags=1 (0, 0)
</I>&gt;<i> 2024/07/09 23:35:40.125 kid1| 5,3| Read.cc(148) HandleRead: FD 17, size 32767, retval 80, errno 0
</I>&gt;<i> 2024/07/09 23:35:40.125 kid1| 5,3| IoCallback.cc(112) finish: called for conn10 local=[::] remote=[::] FD 17 flags=1 (0, 0)
</I>&gt;<i> 2024/07/09 23:35:40.125 kid1| 84,3| helper.cc(1022) helperHandleRead: helperHandleRead: end of reply found
</I>&gt;<i> 2024/07/09 23:35:40.125 kid1| 84,3| Reply.cc(41) finalize: Parsing helper buffer
</I>&gt;<i> 2024/07/09 23:35:40.125 kid1| 84,3| Reply.cc(59) finalize: Buff length is larger than 2
</I>&gt;<i> 2024/07/09 23:35:40.125 kid1| 84,3| Reply.cc(63) finalize: helper Result = OK
</I>&gt;<i> 2024/07/09 23:35:40.125 kid1| 23,3| Uri.cc(446) parse: Split URL '<A HREF="https://download.docker.com/linux/ubuntu/dists/jammy/InRelease">https://download.docker.com/linux/ubuntu/dists/jammy/InRelease</A>'[<A HREF="https://download.docker.com/linux/ubuntu/dists/jammy/InRelease">https://download.docker.com/linux/ubuntu/dists/jammy/InRelease</A>'] into proto='https', host='download.docker.com', port='443', path='/linux/ubuntu/dists/jammy/InRelease'
</I>&gt;<i> 2024/07/09 23:35:40.125 kid1| 14,3| Address.cc(389) lookupHostIP: Given Non-IP 'download.docker.com': Name or service not known
</I>&gt;<i> 2024/07/09 23:35:40.125 kid1| 61,2| client_side_request.cc(1235) clientRedirectDone: URL-rewriter diverts URL from <A HREF="http://download.docker.com/linux/ubuntu/dists/jammy/InRelease[http://download.docker.com/linux/ubuntu/dists/jammy/InRelease">http://download.docker.com/linux/ubuntu/dists/jammy/InRelease[http://download.docker.com/linux/ubuntu/dists/jammy/InRelease</A>] to <A HREF="https://download.docker.com/linux/ubuntu/dists/jammy/InRelease[https://download.docker.com/linux/ubuntu/dists/jammy/InRelease">https://download.docker.com/linux/ubuntu/dists/jammy/InRelease[https://download.docker.com/linux/ubuntu/dists/jammy/InRelease</A>]
</I>&gt;<i> 2024/07/09 23:35:40.125 kid1| 83,3| client_side_request.cc(1743) doCallouts: Doing calloutContext-&gt;clientAccessCheck2()
</I>&gt;<i> 2024/07/09 23:35:40.125 kid1| 85,2| client_side_request.cc(692) clientAccessCheck2: No adapted_http_access configuration. default: ALLOW
</I>&gt;<i> 2024/07/09 23:35:40.125 kid1| 85,2| client_side_request.cc(714) clientAccessCheckDone: The request HEAD <A HREF="https://download.docker.com/linux/ubuntu/dists/jammy/InRelease[https://download.docker.com/linux/ubuntu/dists/jammy/InRelease">https://download.docker.com/linux/ubuntu/dists/jammy/InRelease[https://download.docker.com/linux/ubuntu/dists/jammy/InRelease</A>] is ALLOWED; last ACL checked: all
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 83,3| client_side_request.cc(1761) doCallouts: Doing clientInterpretRequestHeaders()
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 83,3| client_side_request.cc(1770) doCallouts: Doing calloutContext-&gt;checkNoCache()
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 28,3| Checklist.cc(69) preCheck: 0x5c3ba41552d8 checking slow rules
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 28,3| RegexData.cc(50) match: checking '<A HREF="https://download.docker.com/linux/ubuntu/dists/jammy/InRelease">https://download.docker.com/linux/ubuntu/dists/jammy/InRelease</A>'[<A HREF="https://download.docker.com/linux/ubuntu/dists/jammy/InRelease">https://download.docker.com/linux/ubuntu/dists/jammy/InRelease</A>']
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 28,3| Acl.cc(175) matches: checked: no_cache = 0
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 28,3| Acl.cc(175) matches: checked: cache#1 = 0
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 28,3| Ip.cc(538) match: aclIpMatchIp: '10.2.59.102:56466' found
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 28,3| Acl.cc(175) matches: checked: all = 1
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 28,3| Acl.cc(175) matches: checked: cache#2 = 1
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 28,3| Acl.cc(175) matches: checked: cache = 1
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 28,3| Checklist.cc(62) markFinished: 0x5c3ba41552d8 answer ALLOWED for match
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 28,3| Checklist.cc(162) checkCallback: ACLChecklist::checkCallback: 0x5c3ba41552d8 answer=ALLOWED
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 85,3| client_side_request.cc(116) ~ClientRequestContext: ClientRequestContext destructed, this=0x5c3ba4154e78
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 83,3| client_side_request.cc(1855) doCallouts: calling processRequest()
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 87,3| clientStream.cc(178) clientStreamRead: clientStreamRead: Calling 1 with cbdata 0x5c3ba4153e70 from node 0x5c3ba4154308
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 73,3| HttpRequest.cc(742) storeId: sent back effectiveRequestUrl: <A HREF="https://download.docker.com/linux/ubuntu/dists/jammy/InRelease[https://download.docker.com/linux/ubuntu/dists/jammy/InRelease">https://download.docker.com/linux/ubuntu/dists/jammy/InRelease[https://download.docker.com/linux/ubuntu/dists/jammy/InRelease</A>]
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 20,3| Controller.cc(429) peek: DE850794EBC405A27A7718F51795E32A
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 73,3| HttpRequest.cc(742) storeId: sent back effectiveRequestUrl: <A HREF="https://download.docker.com/linux/ubuntu/dists/jammy/InRelease[https://download.docker.com/linux/ubuntu/dists/jammy/InRelease">https://download.docker.com/linux/ubuntu/dists/jammy/InRelease[https://download.docker.com/linux/ubuntu/dists/jammy/InRelease</A>]
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 20,3| Controller.cc(429) peek: D3522EE27FB0ED7004DD594AF7674667
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 85,3| client_side_reply.cc(1523) identifyFoundObject: StoreEntry is NULL - MISS
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 20,3| store.cc(730) storeCreatePureEntry: storeCreateEntry: '<A HREF="https://download.docker.com/linux/ubuntu/dists/jammy/InRelease">https://download.docker.com/linux/ubuntu/dists/jammy/InRelease</A>'[<A HREF="https://download.docker.com/linux/ubuntu/dists/jammy/InRelease">https://download.docker.com/linux/ubuntu/dists/jammy/InRelease</A>']
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 20,3| MemObject.cc(99) MemObject: MemObject constructed, this=0x5c3ba416ef10
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 88,3| MemObject.cc(82) setUris: 0x5c3ba416ef10 storeId: <A HREF="https://download.docker.com/linux/ubuntu/dists/jammy/InRelease[https://download.docker.com/linux/ubuntu/dists/jammy/InRelease">https://download.docker.com/linux/ubuntu/dists/jammy/InRelease[https://download.docker.com/linux/ubuntu/dists/jammy/InRelease</A>]
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 20,3| store.cc(434) lock: storeCreateEntry locked key [null_store_key] e:=V/0x5c3ba416ee90*1
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 20,3| store.cc(536) setPrivateKey: 00 e:=V/0x5c3ba416ee90*1
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 20,3| store.cc(412) hashInsert: StoreEntry::hashInsert: Inserting Entry e:=IV/0x5c3ba416ee90*1 key '020000000000000061AF070001000000'
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 20,3| store.cc(434) lock: store_client locked key 020000000000000061AF070001000000 e:=IV/0x5c3ba416ee90*2
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 90,3| store_client.cc(243) copy: store_client::copy: 020000000000000061AF070001000000, from 0, for length 4096, cb 1, cbdata 0x5c3ba4152dd8
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 20,3| store.cc(434) lock: store_client::copy locked key 020000000000000061AF070001000000 e:=IV/0x5c3ba416ee90*3
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 90,3| store_client.cc(343) storeClientCopy2: storeClientCopy2: 020000000000000061AF070001000000
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 90,3| store_client.cc(390) doCopy: store_client::doCopy: Waiting for more
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 20,3| store.cc(457) unlock: store_client::copy unlocking key 020000000000000061AF070001000000 e:=IV/0x5c3ba416ee90*3
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 17,3| FwdState.cc(373) Start: '<A HREF="https://download.docker.com/linux/ubuntu/dists/jammy/InRelease">https://download.docker.com/linux/ubuntu/dists/jammy/InRelease</A>'[<A HREF="https://download.docker.com/linux/ubuntu/dists/jammy/InRelease">https://download.docker.com/linux/ubuntu/dists/jammy/InRelease</A>']
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 17,2| FwdState.cc(133) FwdState: Forwarding client request conn9 local=10.2.59.103:8000 remote=10.2.59.102:56466 FD 15 flags=1, url=<A HREF="https://download.docker.com/linux/ubuntu/dists/jammy/InRelease[https://download.docker.com/linux/ubuntu/dists/jammy/InRelease">https://download.docker.com/linux/ubuntu/dists/jammy/InRelease[https://download.docker.com/linux/ubuntu/dists/jammy/InRelease</A>]
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 20,3| store.cc(434) lock: FwdState locked key 020000000000000061AF070001000000 e:=IV/0x5c3ba416ee90*3
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 17,3| FwdState.cc(140) FwdState: FwdState constructed, this=0x5c3ba416fa18
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 44,3| peer_select.cc(309) peerSelect: e:=IV/0x5c3ba416ee90*3 <A HREF="https://download.docker.com/linux/ubuntu/dists/jammy/InRelease[https://download.docker.com/linux/ubuntu/dists/jammy/InRelease">https://download.docker.com/linux/ubuntu/dists/jammy/InRelease[https://download.docker.com/linux/ubuntu/dists/jammy/InRelease</A>]
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 20,3| store.cc(434) lock: peerSelect locked key 020000000000000061AF070001000000 e:=IV/0x5c3ba416ee90*4
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 44,3| peer_select.cc(612) selectMore: HEAD download.docker.com
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 44,3| peer_select.cc(626) selectMore: direct = DIRECT_UNKNOWN (never_direct to be checked)
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 28,3| Checklist.cc(69) preCheck: 0x5c3ba4170638 checking slow rules
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 28,3| Ip.cc(538) match: aclIpMatchIp: '10.2.59.102:56466' found
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 28,3| Acl.cc(175) matches: checked: all = 1
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 28,3| Acl.cc(175) matches: checked: never_direct#1 = 1
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 28,3| Acl.cc(175) matches: checked: never_direct = 1
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 28,3| Checklist.cc(62) markFinished: 0x5c3ba4170638 answer ALLOWED for match
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 28,3| Checklist.cc(162) checkCallback: ACLChecklist::checkCallback: 0x5c3ba4170638 answer=ALLOWED
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 44,3| peer_select.cc(345) checkNeverDirectDone: ALLOWED
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 44,3| peer_select.cc(351) checkNeverDirectDone: direct = DIRECT_NO (never_direct allow)
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 44,3| peer_select.cc(612) selectMore: HEAD download.docker.com
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 14,3| ipcache.cc(732) ipcache_gethostbyname: ipcache_gethostbyname: 'download.docker.com', flags=0
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 14,3| Address.cc(389) lookupHostIP: Given Non-IP 'download.docker.com': Name or service not known
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 44,3| peer_select.cc(286) peerSelectIcpPing: <A HREF="https://download.docker.com/linux/ubuntu/dists/jammy/InRelease[https://download.docker.com/linux/ubuntu/dists/jammy/InRelease">https://download.docker.com/linux/ubuntu/dists/jammy/InRelease[https://download.docker.com/linux/ubuntu/dists/jammy/InRelease</A>]
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 15,3| neighbors.cc(283) neighborsCount: neighborsCount: 0
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 44,3| peer_select.cc(297) peerSelectIcpPing: counted 0 neighbors
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 44,3| peer_select.cc(833) selectSomeParent: HEAD download.docker.com
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 15,3| neighbors.cc(350) getRoundRobinParent: returning [nil]
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 15,3| neighbors.cc(403) getWeightedRoundRobinParent: returning [nil]
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 15,3| neighbors.cc(309) getFirstUpParent: returning 212.89.128.96
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 44,3| peer_select.cc(1102) addSelection: adding FIRSTUP_PARENT/212.89.128.96
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 44,3| peer_select.cc(1095) addSelection: skipping ANY_OLD_PARENT/212.89.128.96; have FIRSTUP_PARENT/212.89.128.96
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 15,3| neighbors.cc(493) getDefaultParent: returning 212.89.128.96
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 44,3| peer_select.cc(1095) addSelection: skipping DEFAULT_PARENT/212.89.128.96; have FIRSTUP_PARENT/212.89.128.96
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 44,2| peer_select.cc(460) resolveSelected: Find IP destination for: <A HREF="https://download.docker.com/linux/ubuntu/dists/jammy/InRelease">https://download.docker.com/linux/ubuntu/dists/jammy/InRelease</A>'[<A HREF="https://download.docker.com/linux/ubuntu/dists/jammy/InRelease">https://download.docker.com/linux/ubuntu/dists/jammy/InRelease</A>'] via 212.89.128.96
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 44,2| peer_select.cc(1174) handlePath: PeerSelector1 found conn12 local=0.0.0.0 remote=212.89.128.96:3128 FIRSTUP_PARENT flags=1, destination #1 for <A HREF="https://download.docker.com/linux/ubuntu/dists/jammy/InRelease[https://download.docker.com/linux/ubuntu/dists/jammy/InRelease">https://download.docker.com/linux/ubuntu/dists/jammy/InRelease[https://download.docker.com/linux/ubuntu/dists/jammy/InRelease</A>]
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 44,2| peer_select.cc(1180) handlePath: always_direct = DENIED
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 44,2| peer_select.cc(1181) handlePath: never_direct = ALLOWED
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 44,2| peer_select.cc(1182) handlePath: timedout = 0
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 17,3| FwdState.cc(610) noteDestination: conn12 local=0.0.0.0 remote=212.89.128.96:3128 FIRSTUP_PARENT flags=1
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 17,3| FwdState.cc(1124) connectStart: 1+ paths to <A HREF="https://download.docker.com/linux/ubuntu/dists/jammy/InRelease[https://download.docker.com/linux/ubuntu/dists/jammy/InRelease">https://download.docker.com/linux/ubuntu/dists/jammy/InRelease[https://download.docker.com/linux/ubuntu/dists/jammy/InRelease</A>]
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 44,2| peer_select.cc(479) resolveSelected: PeerSelector1 found all 1 destinations for <A HREF="https://download.docker.com/linux/ubuntu/dists/jammy/InRelease[https://download.docker.com/linux/ubuntu/dists/jammy/InRelease">https://download.docker.com/linux/ubuntu/dists/jammy/InRelease[https://download.docker.com/linux/ubuntu/dists/jammy/InRelease</A>]
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 44,2| peer_select.cc(480) resolveSelected: always_direct = DENIED
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 44,2| peer_select.cc(481) resolveSelected: never_direct = ALLOWED
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 44,2| peer_select.cc(482) resolveSelected: timedout = 0
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 44,3| peer_select.cc(241) ~PeerSelector: <A HREF="https://download.docker.com/linux/ubuntu/dists/jammy/InRelease[https://download.docker.com/linux/ubuntu/dists/jammy/InRelease">https://download.docker.com/linux/ubuntu/dists/jammy/InRelease[https://download.docker.com/linux/ubuntu/dists/jammy/InRelease</A>]
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 20,3| store.cc(457) unlock: peerSelect unlocking key 020000000000000061AF070001000000 e:=p2IV/0x5c3ba416ee90*4
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 48,3| pconn.cc(474) popStored: lookup for key {212.89.128.96:3128} failed.
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 17,3| FwdState.cc(1568) GetMarkingsToServer: from 0.0.0.0 tos 0 netfilter mark 0
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 5,3| ConnOpener.cc(42) ConnOpener: will connect to conn14 local=0.0.0.0 remote=212.89.128.96:3128 FIRSTUP_PARENT flags=1 with 30 timeout
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 50,3| comm.cc(378) comm_openex: comm_openex: Attempt open socket for: 0.0.0.0
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 50,3| comm.cc(420) comm_openex: comm_openex: Opened socket conn15 local=0.0.0.0 remote=[::] FD 19 flags=1 : family=2, type=1, protocol=6
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 51,3| fd.cc(168) fd_open: fd_open() FD 19
</I>&gt;<i> 2024/07/09 23:35:40.126 kid1| 5,3| ConnOpener.cc(312) createFd: conn14 local=0.0.0.0 remote=212.89.128.96:3128 FIRSTUP_PARENT flags=1 will timeout in 30
</I>&gt;<i> 2024/07/09 23:35:40.127 kid1| 17,3| FwdState.cc(1197) dispatch: conn9 local=10.2.59.103:8000 remote=10.2.59.102:56466 FD 15 flags=1: Fetching HEAD <A HREF="https://download.docker.com/linux/ubuntu/dists/jammy/InRelease[https://download.docker.com/linux/ubuntu/dists/jammy/InRelease">https://download.docker.com/linux/ubuntu/dists/jammy/InRelease[https://download.docker.com/linux/ubuntu/dists/jammy/InRelease</A>]
</I>&gt;<i> 2024/07/09 23:35:40.127 kid1| 14,3| Address.cc(389) lookupHostIP: Given Non-IP 'download.docker.com': Name or service not known
</I>&gt;<i> 2024/07/09 23:35:40.127 kid1| 78,3| dns_internal.cc(1793) idnsALookup: idnsALookup: buf is 37 bytes for download.docker.com, id = 0xe779
</I>&gt;<i> 2024/07/09 23:35:40.127 kid1| 50,3| comm.cc(927) comm_udp_sendto: comm_udp_sendto: Attempt to send UDP packet to 127.0.0.53:53 using FD 11 using Port 54280
</I>&gt;<i> 2024/07/09 23:35:40.127 kid1| 78,3| dns_internal.cc(1729) idnsSendSlaveAAAAQuery: buf is 37 bytes for download.docker.com, id = 0x8aee
</I>&gt;<i> 2024/07/09 23:35:40.127 kid1| 50,3| comm.cc(927) comm_udp_sendto: comm_udp_sendto: Attempt to send UDP packet to 127.0.0.53:53 using FD 11 using Port 54280
</I>&gt;<i> 2024/07/09 23:35:40.127 kid1| 11,3| http.cc(2516) httpStart: HEAD <A HREF="https://download.docker.com/linux/ubuntu/dists/jammy/InRelease[https://download.docker.com/linux/ubuntu/dists/jammy/InRelease">https://download.docker.com/linux/ubuntu/dists/jammy/InRelease[https://download.docker.com/linux/ubuntu/dists/jammy/InRelease</A>]
</I>&gt;<i> 2024/07/09 23:35:40.127 kid1| 20,3| store.cc(434) lock: Client locked key 020000000000000061AF070001000000 e:=p2IV/0x5c3ba416ee90*4
</I>&gt;<i> 2024/07/09 23:35:40.127 kid1| 5,3| comm.cc(599) commSetConnTimeout: conn14 local=10.2.59.103:39370 remote=212.89.128.96:3128 FIRSTUP_PARENT FD 19 flags=1 timeout 86400
</I>&gt;<i> 2024/07/09 23:35:40.127 kid1| 22,3| refresh.cc(636) getMaxAge: getMaxAge: '<A HREF="https://download.docker.com/linux/ubuntu/dists/jammy/InRelease">https://download.docker.com/linux/ubuntu/dists/jammy/InRelease</A>'[<A HREF="https://download.docker.com/linux/ubuntu/dists/jammy/InRelease">https://download.docker.com/linux/ubuntu/dists/jammy/InRelease</A>']
</I>&gt;<i> 2024/07/09 23:35:40.127 kid1| 11,2| http.cc(2472) sendRequest: HTTP Server conn14 local=10.2.59.103:39370 remote=212.89.128.96:3128 FIRSTUP_PARENT FD 19 flags=1
</I>&gt;<i> 2024/07/09 23:35:40.127 kid1| 11,2| http.cc(2473) sendRequest: HTTP Server REQUEST:
</I>&gt;<i> ---------
</I>&gt;<i> HEAD <A HREF="https://download.docker.com/linux/ubuntu/dists/jammy/InRelease[https://download.docker.com/linux/ubuntu/dists/jammy/InRelease">https://download.docker.com/linux/ubuntu/dists/jammy/InRelease[https://download.docker.com/linux/ubuntu/dists/jammy/InRelease</A>] HTTP/1.1
</I>&gt;<i> Host: download.docker.com
</I>&gt;<i> User-Agent: curl/7.81.0
</I>&gt;<i> Accept: */*
</I>&gt;<i> Via: 1.1 pkg-proxy (squid/6.6)
</I>&gt;<i> X-Forwarded-For: 10.2.59.102
</I>&gt;<i> Cache-Control: max-age=0
</I>&gt;<i> Connection: keep-alive
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> ----------
</I>&gt;<i> 2024/07/09 23:35:40.127 kid1| 5,3| IoCallback.cc(112) finish: called for conn14 local=10.2.59.103:39370 remote=212.89.128.96:3128 FIRSTUP_PARENT FD 19 flags=1 (0, 0)
</I>&gt;<i> 2024/07/09 23:35:40.127 kid1| 5,3| comm.cc(599) commSetConnTimeout: conn14 local=10.2.59.103:39370 remote=212.89.128.96:3128 FIRSTUP_PARENT FD 19 flags=1 timeout 900
</I>&gt;<i> 2024/07/09 23:35:40.137 kid1| 78,3| dns_internal.cc(1319) idnsRead: idnsRead: starting with FD 11
</I>&gt;<i> 2024/07/09 23:35:40.137 kid1| 78,3| dns_internal.cc(1365) idnsRead: idnsRead: FD 11: received 304 bytes from 127.0.0.53:53
</I>&gt;<i> 2024/07/09 23:35:40.137 kid1| 78,3| dns_internal.cc(1172) idnsGrokReply: idnsGrokReply: QID 0x8aee, 9 answers
</I>&gt;<i> 2024/07/09 23:35:40.137 kid1| 14,3| ipcache.cc(480) ipcacheParse: 9 answers for download.docker.com
</I>&gt;<i> 2024/07/09 23:35:40.137 kid1| 14,3| ipcache.cc(535) addGood: download.docker.com #1 [2600:9000:2490:6c00:3:db06:4200:93a1]
</I>&gt;<i> 2024/07/09 23:35:40.137 kid1| 14,3| ipcache.cc(535) addGood: download.docker.com #2 [2600:9000:2490:a600:3:db06:4200:93a1]
</I>&gt;<i> 2024/07/09 23:35:40.137 kid1| 14,3| ipcache.cc(535) addGood: download.docker.com #3 [2600:9000:2490:9c00:3:db06:4200:93a1]
</I>&gt;<i> 2024/07/09 23:35:40.137 kid1| 14,3| ipcache.cc(535) addGood: download.docker.com #4 [2600:9000:2490:6000:3:db06:4200:93a1]
</I>&gt;<i> 2024/07/09 23:35:40.137 kid1| 14,3| ipcache.cc(535) addGood: download.docker.com #5 [2600:9000:2490:c00:3:db06:4200:93a1]
</I>&gt;<i> 2024/07/09 23:35:40.137 kid1| 14,3| ipcache.cc(535) addGood: download.docker.com #6 [2600:9000:2490:5200:3:db06:4200:93a1]
</I>&gt;<i> 2024/07/09 23:35:40.137 kid1| 14,3| ipcache.cc(535) addGood: download.docker.com #7 [2600:9000:2490:9a00:3:db06:4200:93a1]
</I>&gt;<i> 2024/07/09 23:35:40.137 kid1| 14,3| ipcache.cc(535) addGood: download.docker.com #8 [2600:9000:2490:2c00:3:db06:4200:93a1]
</I>&gt;<i> 2024/07/09 23:35:40.137 kid1| 78,3| dns_internal.cc(1319) idnsRead: idnsRead: starting with FD 11
</I>&gt;<i> 2024/07/09 23:35:40.137 kid1| 78,3| dns_internal.cc(1365) idnsRead: idnsRead: FD 11: received 144 bytes from 127.0.0.53:53
</I>&gt;<i> 2024/07/09 23:35:40.137 kid1| 78,3| dns_internal.cc(1172) idnsGrokReply: idnsGrokReply: QID 0xe779, 5 answers
</I>&gt;<i> 2024/07/09 23:35:40.137 kid1| 14,3| ipcache.cc(480) ipcacheParse: 5 answers for download.docker.com
</I>&gt;<i> 2024/07/09 23:35:40.137 kid1| 14,3| ipcache.cc(535) addGood: download.docker.com #9 108.138.7.33
</I>&gt;<i> 2024/07/09 23:35:40.137 kid1| 14,3| ipcache.cc(535) addGood: download.docker.com #10 108.138.7.18
</I>&gt;<i> 2024/07/09 23:35:40.137 kid1| 14,3| ipcache.cc(535) addGood: download.docker.com #11 108.138.7.88
</I>&gt;<i> 2024/07/09 23:35:40.137 kid1| 14,3| ipcache.cc(535) addGood: download.docker.com #12 108.138.7.48
</I>&gt;<i> 2024/07/09 23:35:40.137 kid1| 14,3| ipcache.cc(586) ipcacheHandleReply: done with download.docker.com: [2600:9000:2490:6c00:3:db06:4200:93a1] #1/12-0
</I>&gt;<i> 2024/07/09 23:35:40.137 kid1| 38,3| net_db.cc(337) netdbSendPing: netdbSendPing: pinging download.docker.com
</I>&gt;<i> 2024/07/09 23:35:40.137 kid1| 37,2| IcmpSquid.cc(88) SendEcho: to [2600:9000:2490:6c00:3:db06:4200:93a1], opcode 3, len 19
</I>&gt;<i> 2024/07/09 23:35:40.137 pinger| 42,2| IcmpPinger.cc(198) Recv: Pass [2600:9000:2490:6c00:3:db06:4200:93a1] off to ICMPv6 module.
</I>&gt;<i> 2024/07/09 23:35:40 pinger| SendEcho ERROR: sending to ICMPv6 packet to [2600:9000:2490:6c00:3:db06:4200:93a1]: (101) Network is unreachable
</I>&gt;<i> 2024/07/09 23:35:40.138 pinger| 42,2| Icmp.cc(90) Log: pingerLog: 1720560940.138021 [2600:9000:2490:6c00:3:db06:4200:93a1] 0
</I>&gt;<i> 2024/07/09 23:35:40.323 kid1| 5,3| IoCallback.cc(112) finish: called for conn14 local=10.2.59.103:39370 remote=212.89.128.96:3128 FIRSTUP_PARENT FD 19 flags=1 (0, 0)
</I>&gt;<i> 2024/07/09 23:35:40.324 kid1| 5,3| Read.cc(93) ReadNow: conn14 local=10.2.59.103:39370 remote=212.89.128.96:3128 FIRSTUP_PARENT FD 19 flags=1, size 65536, retval 348, errno 0
</I>&gt;<i> 2024/07/09 23:35:40.324 kid1| 11,3| http.cc(649) processReplyHeader: processReplyHeader: key '020000000000000061AF070001000000'
</I>&gt;<i> 2024/07/09 23:35:40.324 kid1| 11,2| http.cc(696) processReplyHeader: HTTP Server conn14 local=10.2.59.103:39370 remote=212.89.128.96:3128 FIRSTUP_PARENT FD 19 flags=1
</I>&gt;<i> 2024/07/09 23:35:40.324 kid1| 11,2| http.cc(697) processReplyHeader: HTTP Server RESPONSE:
</I>&gt;<i> ---------
</I>&gt;<i> HTTP/1.1 503 Service Unavailable
</I>&gt;<i> Server: squid/4.10
</I>&gt;<i> Mime-Version: 1.0
</I>&gt;<i> Date: Tue, 09 Jul 2024 21:35:40 GMT
</I>&gt;<i> Content-Type: text/html;charset=utf-8
</I>&gt;<i> Content-Length: 3879
</I>&gt;<i> X-Squid-Error: ERR_SECURE_CONNECT_FAIL 71
</I>&gt;<i> X-Cache: MISS from proxy-srv2
</I>&gt;<i> X-Cache-Lookup: MISS from proxy-srv2:3128
</I>&gt;<i> Via: 1.1 proxy-srv2 (squid/4.10)
</I>&gt;<i> Connection: keep-alive
</I>&gt;<i> 
</I>&gt;<i> ----------
</I>&gt;<i> 2024/07/09 23:35:40.324 kid1| 83,3| AccessCheck.cc(42) Start: adaptation off, skipping
</I>&gt;<i> 2024/07/09 23:35:40.324 kid1| 20,3| store.cc(1693) replaceHttpReply: StoreEntry::replaceHttpReply: <A HREF="https://download.docker.com/linux/ubuntu/dists/jammy/InRelease[https://download.docker.com/linux/ubuntu/dists/jammy/InRelease">https://download.docker.com/linux/ubuntu/dists/jammy/InRelease[https://download.docker.com/linux/ubuntu/dists/jammy/InRelease</A>]
</I>&gt;<i> 2024/07/09 23:35:40.324 kid1| 11,3| http.cc(949) haveParsedReplyHeaders: HTTP CODE: 503
</I>&gt;<i> 
</I>&gt;<i> Has anybody an idea what I can do to solve the issue?
</I>&gt;<i> 
</I>&gt;<i> This is my configuration borrowed from squid-deb-proxy:
</I>&gt;<i> 
</I>&gt;<i> # this file contains private networks (10.0.0.0/8, 172.16.0.0/12,
</I>&gt;<i> # 192.168.0.0/16) by default, you can add/remove additional allowed
</I>&gt;<i> # source networks in it to customize it for your setup
</I>&gt;<i> acl src_networks src &quot;/etc/squid/acl/src-networks.acl&quot;
</I>&gt;<i> 
</I>&gt;<i> # this file contains the archive mirrors by default,
</I>&gt;<i> # if you use a different mirror, add it there
</I>&gt;<i> acl to_archive_mirrors dstdomain &quot;/etc/squid/acl/archive-mirrors.acl&quot;
</I>&gt;<i> 
</I>&gt;<i> # Disable Cache for defined domains
</I>&gt;<i> acl no_cache url_regex &quot;/etc/squid/acl/no-cache.acl&quot;
</I>&gt;<i> 
</I>&gt;<i> # this contains the package blacklist
</I>&gt;<i> acl blockedpkgs urlpath_regex &quot;/etc/squid/pkg-blacklist-regexp.acl&quot;
</I>&gt;<i> 
</I>&gt;<i> # default to a different port than stock squid
</I>&gt;<i> http_port 8000
</I>&gt;<i> 
</I>&gt;<i> # -------------------------------------------------
</I>&gt;<i> # settings below probably do not need customization
</I>&gt;<i> 
</I>&gt;<i> # user visible name
</I>&gt;<i> visible_hostname pkg-proxy
</I>&gt;<i> 
</I>&gt;<i> # we need a big cache, some debs are huge
</I>&gt;<i> maximum_object_size 512 MB
</I>&gt;<i> 
</I>&gt;<i> # use a different dir than stock squid and default to 40G
</I>&gt;<i> cache_dir aufs /var/cache/squid 40000 16 256
</I>&gt;<i> 
</I>&gt;<i> cache_peer 212.89.128.96 parent 3128 0 no-query default
</I>&gt;<i> never_direct allow all
</I>&gt;<i> 
</I>&gt;<i> # use different logs
</I>&gt;<i> cache_access_log /var/log/squid/access.log
</I>&gt;<i> cache_log /var/log/squid/cache.log
</I>&gt;<i> cache_store_log /var/log/squid/store.log
</I>&gt;<i> 
</I>&gt;<i> # tweaks to speed things up
</I>&gt;<i> cache_mem 200 MB
</I>&gt;<i> maximum_object_size_in_memory 10240 KB
</I>&gt;<i> 
</I>&gt;<i> # pid
</I>&gt;<i> pid_filename /var/run/squid.pid
</I>&gt;<i> 
</I>&gt;<i> # refresh pattern for debs and udebs
</I>&gt;<i> refresh_pattern deb$ 129600 100% 129600
</I>&gt;<i> refresh_pattern udeb$ 129600 100% 129600
</I>&gt;<i> refresh_pattern tar.gz$ 129600 100% 129600
</I>&gt;<i> refresh_pattern tar.xz$ 129600 100% 129600
</I>&gt;<i> refresh_pattern tar.bz2$ 129600 100% 129600
</I>&gt;<i> 
</I>&gt;<i> # always refresh Packages and Release files
</I>&gt;<i> refresh_pattern \/(Packages|Sources)(|\.bz2|\.gz|\.xz)$ 0 0% 0 refresh-ims
</I>&gt;<i> refresh_pattern \/Release(|\.gpg)$ 0 0% 0 refresh-ims
</I>&gt;<i> refresh_pattern \/InRelease$ 0 0% 0 refresh-ims
</I>&gt;<i> refresh_pattern \/(Translation-.*)(|\.bz2|\.gz|\.xz)$ 0 0% 0 refresh-ims
</I>&gt;<i> 
</I>&gt;<i> # handle meta-release and changelogs.ubuntu.com special
</I>&gt;<i> # (fine to have this on debian too)
</I>&gt;<i> refresh_pattern changelogs.ubuntu.com\/.* 0 1% 1
</I>&gt;<i> 
</I>&gt;<i> # only allow connects to ports for http, https
</I>&gt;<i> acl SSL_ports port 443 563
</I>&gt;<i> acl Safe_ports port 80
</I>&gt;<i> acl Safe_ports port 443 563
</I>&gt;<i> 
</I>&gt;<i> # only allow ports we trust
</I>&gt;<i> http_access deny !Safe_ports
</I>&gt;<i> 
</I>&gt;<i> # do not allow to download from the pkg blacklist
</I>&gt;<i> http_access deny blockedpkgs
</I>&gt;<i> 
</I>&gt;<i> # allow access only to official archive mirrors
</I>&gt;<i> # uncomment the third and fouth line to permit any unlisted domain
</I>&gt;<i> http_access deny !to_archive_mirrors
</I>&gt;<i> 
</I>&gt;<i> # allow access from our network and localhost
</I>&gt;<i> http_access allow src_networks
</I>&gt;<i> 
</I>&gt;<i> # And finally deny all other access to this proxy
</I>&gt;<i> http_access deny all
</I>&gt;<i> 
</I>&gt;<i> # don't cache domains not listed in the mirrors file
</I>&gt;<i> # uncomment the third and fourth line to cache any unlisted domains
</I>&gt;<i> cache deny no_cache
</I>&gt;<i> 
</I>&gt;<i> # And finally cache everything else
</I>&gt;<i> cache allow all
</I>&gt;<i> 
</I>&gt;<i> url_rewrite_children 3 startup=0 idle=1 concurrency=1
</I>&gt;<i> url_rewrite_program /usr/lib/squid/jesred
</I>&gt;<i> 
</I>&gt;<i> debug_options ALL,3
</I>&gt;<i> 
</I>&gt;<i> Thanks a lot.
</I>&gt;<i> 
</I>&gt;<i> Regards,
</I>&gt;<i> Christoph
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="026853.html">[squid-users] Rewriting HTTP to HTTPS for generic package proxy
</A></li>
	<LI>Next message (by thread): <A HREF="026859.html">[squid-users] Rewriting HTTP to HTTPS for generic package proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26854">[ date ]</a>
              <a href="thread.html#26854">[ thread ]</a>
              <a href="subject.html#26854">[ subject ]</a>
              <a href="author.html#26854">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
