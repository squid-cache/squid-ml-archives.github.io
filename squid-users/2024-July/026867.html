<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Rewriting HTTP to HTTPS for generic package proxy
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Rewriting%20HTTP%20to%20HTTPS%20for%20generic%20package%20proxy&In-Reply-To=%3C2d18e96ef2be492f9deea0b5c07688f5%40eurodata.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026866.html">
   <LINK REL="Next"  HREF="026868.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Rewriting HTTP to HTTPS for generic package proxy</H1>
    <B>Fiehe, Christoph</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Rewriting%20HTTP%20to%20HTTPS%20for%20generic%20package%20proxy&In-Reply-To=%3C2d18e96ef2be492f9deea0b5c07688f5%40eurodata.de%3E"
       TITLE="[squid-users] Rewriting HTTP to HTTPS for generic package proxy">c.fiehe at eurodata.de
       </A><BR>
    <I>Wed Jul 10 20:57:43 UTC 2024</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="026866.html">[squid-users] Rewriting HTTP to HTTPS for generic package proxy
</A></li>
        <LI>Next message (by thread): <A HREF="026868.html">[squid-users] Rewriting HTTP to HTTPS for generic package proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26867">[ date ]</a>
              <a href="thread.html#26867">[ thread ]</a>
              <a href="subject.html#26867">[ subject ]</a>
              <a href="author.html#26867">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>No problem. I am just trying to find something that helps to narrow down the problem. What I want to achieve is, that a client can use HTTP in the LAN, so that Squid can cache distribution packages without making use of SSL intercepting when repos are only accessible via HTTPS. In that case the secure connection must start at the proxy and end on the target server with or without any upstream proxies in betweem. When the proxy has received the payload, it can cache it and send it back to the client via plain HTTP. When a new request for this package arrives, the server can just return the resource from the cache.

We have the following setup:

client -&gt; downstream proxy -&gt; upstream proxy -&gt; <A HREF="https://download.docker.com">https://download.docker.com</A>

Now let us assume the client wants to retrieve the following resource <A HREF="http://download.docker.com/linux/ubuntu/dists/jammy/InRelease">http://download.docker.com/linux/ubuntu/dists/jammy/InRelease</A> from the upstream proxy.

The client initiates a HTTP GET request and sends it to the downstream proxy. Now, the URL gets rewritten. It indicates to use a HTTPS connection instead in order to talk to the target server, in our case the result is <A HREF="https://download.docker.com/linux/ubuntu/dists/jammy/InRelease.">https://download.docker.com/linux/ubuntu/dists/jammy/InRelease.</A> Now comes the critical point: From my understanding &#8211; it may be wrong of course - the downstream server now has to send a CONNECT request to the upstream server to advise him to establish a secure connection to the target server. After creation, the downstream proxy can retrieve the resource and send it back to the client via plain HTTP.

I suppose, that the GnuTLS occurs because of a missing SSL handshake between downstream proxy and download.docker.com.

Do I get something wrong?

Regards,
Christoph


&gt;<i>-----Urspr&#252;ngliche Nachricht-----
</I>&gt;<i>Von: Alex Rousskov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt;
</I>&gt;<i>Gesendet: Mittwoch, 10. Juli 2024 22:15
</I>&gt;<i>An: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i>Cc: Fiehe, Christoph &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">c.fiehe at eurodata.de</A>&gt;
</I>&gt;<i>Betreff: AW: [squid-users] Rewriting HTTP to HTTPS for generic package proxy
</I>&gt;<i>
</I>&gt;<i>On 2024-07-10 15:31, Fiehe, Christoph wrote:
</I>&gt;&gt;<i> The problem is that the proxy just forwards the client GET request to the upstream proxy
</I>&gt;<i>
</I>&gt;<i>Why does sending a GET request to the upstream proxy represent a problem
</I>&gt;<i>in your use case? I cannot find anything in your prior messages on this
</I>&gt;<i>thread that would preclude sending a GET request to the upstream proxy.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> but in that case a CONNECT is required.
</I>&gt;<i>
</I>&gt;<i>Why?
</I>&gt;<i>
</I>&gt;<i>Please do not interpret my response as implying that this &quot;must send
</I>&gt;<i>CONNECT&quot; requirement is wrong (or correct). At this point, I am just
</I>&gt;<i>trying to understand what problem(s) you are trying to solve beyond the
</I>&gt;<i>one you have originally described.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>Thank you,
</I>&gt;<i>
</I>&gt;<i>Alex.
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="026866.html">[squid-users] Rewriting HTTP to HTTPS for generic package proxy
</A></li>
	<LI>Next message (by thread): <A HREF="026868.html">[squid-users] Rewriting HTTP to HTTPS for generic package proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26867">[ date ]</a>
              <a href="thread.html#26867">[ thread ]</a>
              <a href="subject.html#26867">[ subject ]</a>
              <a href="author.html#26867">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
