<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 6.6 error clientProcessHit: Vary object loop!
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%206.6%20error%20clientProcessHit%3A%20Vary%20object%0A%20loop%21&In-Reply-To=%3C150ee779-d0b8-42e2-a44d-55700ef81b2c%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026884.html">
   <LINK REL="Next"  HREF="026896.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 6.6 error clientProcessHit: Vary object loop!</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%206.6%20error%20clientProcessHit%3A%20Vary%20object%0A%20loop%21&In-Reply-To=%3C150ee779-d0b8-42e2-a44d-55700ef81b2c%40treenet.co.nz%3E"
       TITLE="[squid-users] Squid 6.6 error clientProcessHit: Vary object loop!">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Jul 11 20:43:51 UTC 2024</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="026884.html">[squid-users] Squid 6.6 error clientProcessHit: Vary object loop!
</A></li>
        <LI>Next message (by thread): <A HREF="026896.html">[squid-users] Squid 6.6 error clientProcessHit: Vary object loop!
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26888">[ date ]</a>
              <a href="thread.html#26888">[ thread ]</a>
              <a href="subject.html#26888">[ subject ]</a>
              <a href="author.html#26888">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 12/07/24 06:43, Jonathan Lee wrote:
&gt;<i> What is Vary Object loop??
</I>&gt;<i> 
</I>
In HTTP URLs can point at a set or &quot;variants&quot; of a resource.

Squid &quot;Vary Object&quot; is an entry in the cache that is used to represent 
these types of resource.
  When the URL-only is looked up, the &quot;Vary Object&quot; is found and tells 
Squid to perform a second lookup appending certain details to the hash 
key to find the actual object that client needs.

A &quot;Vary Object loop&quot; is when this second lookup finds an object which is 
not the desired variant of that original URL.


You can see this in your first message ...


 &gt;&gt; 10.07.2024 09:56:30	clientProcessHit: Vary object loop!
 &gt;&gt; 10.07.2024 09:56:30	varyEvaluateMatch: Oops. Not a Vary match on
 &gt;&gt; second attempt,

Original request came in for &quot;https%3A%2F%2Fstatic.foxnews.com&quot;

That URL had a cached &quot;Vary Object&quot; saying there were different 
responses to provide depending on the Accept-Encoding header:

Squdi performed a second lookup for:

 &gt;&gt; 'origin=&quot;https%3A%2F%2Fstatic.foxnews.com&quot;, 
accept-encoding=&quot;gzip,%20deflate,%20br,%20zstd&quot;'


... which found a cache entry for this URL:

 &gt;&gt; 
'<A HREF="https://zagent20.h-cdn.com/cmd/get_thumb_info?customer=foxnews&amp;ver=1.165.67&amp;amp;url=https%3A%2F%2F247preview.foxnews.com%2Fhls%2Flive%2F2020027%2Ffncv3preview%2Findex.m3u8">https://zagent20.h-cdn.com/cmd/get_thumb_info?customer=foxnews&amp;ver=1.165.67&amp;url=https%3A%2F%2F247preview.foxnews.com%2Fhls%2Flive%2F2020027%2Ffncv3preview%2Findex.m3u8</A>'


which is not the same URL.



&gt;<i> Does that &#160;mean clear my cache?
</I>
No. But yes.

A quick check of the URLs from your log message with the tool at 
&lt;<A HREF="https://redbot.org/?uri=https://static.foxnews.com/static/orion/styles/css/fox-news/article-new.rs.css">https://redbot.org/?uri=https://static.foxnews.com/static/orion/styles/css/fox-news/article-new.rs.css</A>&gt; 


We can see that:

&quot;
     The resource doesn't send Vary consistently.
     The ETag doesn't change between negotiated representations.
&quot;


You can ignore these log messages.

Or, you can configure Squid not to cache content from this server. If 
you do this, then clearing the cache would stop the log entries continuing.


&gt;<i> Or is that something I am missing has 
</I>&gt;<i> anyone else seen this?
</I>&gt;<i> 
</I>
That origin server is broken. So likely everyone is seeing the same 
problem with that website.


&gt;<i> 11.07.2024 11:36:49	clientProcessHit: Vary object loop!
</I>&gt;<i> 11.07.2024 11:36:49	varyEvaluateMatch: Oops.&#160;Not a Vary match on second 
</I>&gt;<i> attempt, 
</I>&gt;<i> '<A HREF="https://static.foxnews.com/static/orion/styles/css/fox-news/article-new.rs.css9;">https://static.foxnews.com/static/orion/styles/css/fox-news/article-new.rs.css9;</A> 'accept-encoding=&quot;gzip,%20deflate,%20br,%20zstd&quot;'
</I>&gt;<i> 11.07.2024 11:36:49	clientProcessHit: Vary object loop!
</I>&gt;<i> 11.07.2024 11:36:49	varyEvaluateMatch: Oops.&#160;Not a Vary match on second 
</I>&gt;<i> attempt, 
</I>&gt;<i> '<A HREF="https://static.foxnews.com/static/strike/ver/foxnews/loader.global.js">https://static.foxnews.com/static/strike/ver/foxnews/loader.global.js</A>' 
</I>&gt;<i> 'accept-encoding=&quot;gzip,%20deflate,%20br,%20zstd&quot;'
</I>&gt;<i> 31.12.1969 16:00:00	
</I>&lt;snip&gt;


Cheers
Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="026884.html">[squid-users] Squid 6.6 error clientProcessHit: Vary object loop!
</A></li>
	<LI>Next message (by thread): <A HREF="026896.html">[squid-users] Squid 6.6 error clientProcessHit: Vary object loop!
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26888">[ date ]</a>
              <a href="thread.html#26888">[ thread ]</a>
              <a href="subject.html#26888">[ subject ]</a>
              <a href="author.html#26888">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
