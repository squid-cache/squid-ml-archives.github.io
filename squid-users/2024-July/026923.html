<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] TCP_MISS_ABORTED/502
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TCP_MISS_ABORTED/502&In-Reply-To=%3C6712bade-d307-4568-8eb4-14cee7fa997e%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026922.html">
   <LINK REL="Next"  HREF="026931.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] TCP_MISS_ABORTED/502</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TCP_MISS_ABORTED/502&In-Reply-To=%3C6712bade-d307-4568-8eb4-14cee7fa997e%40measurement-factory.com%3E"
       TITLE="[squid-users] TCP_MISS_ABORTED/502">rousskov at measurement-factory.com
       </A><BR>
    <I>Fri Jul 12 18:15:08 UTC 2024</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="026922.html">[squid-users] TCP_MISS_ABORTED/502
</A></li>
        <LI>Next message (by thread): <A HREF="026931.html">[squid-users] TCP_MISS_ABORTED/502
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26923">[ date ]</a>
              <a href="thread.html#26923">[ thread ]</a>
              <a href="subject.html#26923">[ subject ]</a>
              <a href="author.html#26923">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2024-07-12 13:38, Ben Toms wrote:

&gt;<i> Where would I find those headers?
</I>
If you have access to the parent Squid proxy, they will be in its 
debugging cache.log. You can also get them by capturing network packets 
between the parent Squid and origin, but for HTTPS traffic that requires 
giving Wireshark the associated master keys, which may be possible with 
Squid v6, but not trivial (see tls_key_log in Squid; Apache may have 
better support for this). Finally, one can configure Apache to log them 
(sorry, I do not remember the details).

Again, the child Squid does not see these headers yet (AFAICT), so they 
are not the reason things do not currently &quot;work&quot; in your tests.


&gt;<i> Looking at the origin servers apache logs.. it&#8217;s sending a 200 response.
</I>
I am aware. We need the headers that go with that 200 OK response. For 
example, if it has Cache-Control:public, then Squid may be able to cache 
it despite authentication.


HTH,

Alex.


&gt;<i> On Fri, 12 Jul 2024 at 18:26, Alex Rousskov wrote:
</I>&gt;<i> 
</I>&gt;<i>     On 2024-07-12 13:03, Ben Toms wrote:
</I>&gt;<i> 
</I>&gt;<i>      &gt; So the issue seems to be caching content that requires authentication
</I>&gt;<i> 
</I>&gt;<i>     The client is getting an error response from Squid. That error is
</I>&gt;<i>     probably not related to caching decisions. I do not recommend focusing
</I>&gt;<i>     on caching at this stage of triage. I recommend addressing that
</I>&gt;<i>     error first.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>      &gt; The question here is, can squid cache items that require
</I>&gt;<i>     authentication
</I>&gt;<i>      &gt; to access?
</I>&gt;<i> 
</I>&gt;<i>     Yes, in some cases. To know whether your case qualifies, I asked for
</I>&gt;<i>     the
</I>&gt;<i>     response headers. That led to the discovery that there are none (from
</I>&gt;<i>     child Squid point of view). If you really want to investigate the
</I>&gt;<i>     caching angle in parallel with solving ERR_READ_ERROR/WITH_SERVER, then
</I>&gt;<i>     try to obtain HTTP response headers that the origin server responds (to
</I>&gt;<i>     the parent cache) with.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     HTH,
</I>&gt;<i> 
</I>&gt;<i>     Alex.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>      &gt; *From: *Ben Toms &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">ben at macmule.com</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">ben at macmule.com</A>&gt;&gt;
</I>&gt;<i>      &gt; *Date: *Friday, 12 July 2024 at 17:56
</I>&gt;<i>      &gt; *To: *Alex Rousskov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt;&gt;,
</I>&gt;<i>      &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i>     &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;&gt;
</I>&gt;<i>      &gt; *Subject: *Re: [squid-users] TCP_MISS_ABORTED/502
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; So, with the below config:
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; https_port 443 accel protocol=HTTPS
</I>&gt;<i>     tls-cert=/usr/local/squid/client.pem
</I>&gt;<i>      &gt; tls-key=/usr/local/squid/client.key
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; cache_peer public.server.fqdn parent 443 0 no-query originserver
</I>&gt;<i>      &gt; no-digest no-netdb-exchange tls login=PASSTHRU name=myAccel
</I>&gt;<i>      &gt; forceddomain=public.server.fqdn
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; acl our_sites dstdomain local.server.fqdn
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; http_access allow our_sites
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; cache_peer_access myAccel allow our_sites
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; cache_peer_access myAccel deny all
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; cache_dir ufs /usr/local/squid/var/cache 100000 16 256
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; cache_mem 500 MB
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; maximum_object_size_in_memory 50000 KB
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; refresh_pattern .&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 0&#160;&#160;&#160;&#160;&#160;&#160; 20%&#160;&#160;&#160;&#160; 4320
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; debug_options 11,2
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; I can see the below in /var/log/squid/cache.log
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; ----------
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; 2024/07/12 16:49:57.056 kid1| 11,2| http.cc(1263) readReply: conn12
</I>&gt;<i>      &gt; local=client.ip:56670 remote=public.ip.of.public.server:443
</I>&gt;<i>      &gt; FIRSTUP_PARENT FD 14 flags=1: read failure: (0) No error.
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; 2024/07/12 16:49:57.056 kid1| 11,2| Stream.cc(273)
</I>&gt;<i>     sendStartOfMessage:
</I>&gt;<i>      &gt; HTTP Client conn9 local=client.ip:443
</I>&gt;<i>     remote=local.server.ip:59158 FD 13
</I>&gt;<i>      &gt; flags=1
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; 2024/07/12 16:49:57.056 kid1| 11,2| Stream.cc(274)
</I>&gt;<i>     sendStartOfMessage:
</I>&gt;<i>      &gt; HTTP Client REPLY:
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; ---------
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; HTTP/1.1 502 Bad Gateway
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; Server: squid/6.6
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; Mime-Version: 1.0
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; Date: Fri, 12 Jul 2024 16:49:57 GMT
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; Content-Type: text/html;charset=utf-8
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; Content-Length: 3629
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; X-Squid-Error: ERR_READ_ERROR 0
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; Vary: Accept-Language
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; Content-Language: en
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; Cache-Status: local.server;detail=mismatch
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; Via: 1.1 local.server (squid/6.6)
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; Connection: keep-alive
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; ----------
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; The apache server still shows a 200 for the request:
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; [12/Jul/2024:17:49:57 +0100] &quot;GET /path/to/file HTTP/1.1&quot; 200
</I>&gt;<i>     10465 &quot;-&quot;
</I>&gt;<i>      &gt; &quot;curl/8.7.1&quot;
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; And this is when testing via:
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; curl -D - <A HREF="https://local.server.fqdn/path/to/file">https://local.server.fqdn/path/to/file</A>
</I>&gt;<i>     &lt;<A HREF="https://local.server.fqdn/path/to/file">https://local.server.fqdn/path/to/file</A>&gt;
</I>&gt;<i>      &gt; &lt;<A HREF="https://local.server.fqdn/path/to/file">https://local.server.fqdn/path/to/file</A>
</I>&gt;<i>     &lt;<A HREF="https://local.server.fqdn/path/to/file">https://local.server.fqdn/path/to/file</A>&gt;&gt; -H &quot;Authorization: Basic
</I>&gt;<i>      &gt; base64auth&quot; -o /dev/null
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; Regards,
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; Ben.
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; *From: *Alex Rousskov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt;&gt;
</I>&gt;<i>      &gt; *Date: *Friday, 12 July 2024 at 17:36
</I>&gt;<i>      &gt; *To: *Ben Toms &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">ben at macmule.com</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">ben at macmule.com</A>&gt;&gt;,
</I>&gt;<i>     <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i>      &gt; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;&gt;
</I>&gt;<i>      &gt; *Subject: *Re: [squid-users] TCP_MISS_ABORTED/502
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; On 2024-07-12 12:14, Ben Toms wrote:
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt;&gt; Which log should those be found?
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; cache.log (if they are present)
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt;&gt; Can&#8217;t see &#8220;HTTP Server RESPONSE&#8221; in the access.log or cache.log.
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; Sigh. This is one of the reasons I avoid asking folks to study logs
</I>&gt;<i>      &gt; themselves, even ALL,2 logs...
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; If that line is not in cache.log, then child Squid probably did not
</I>&gt;<i>      &gt; receive a response from parent Squid, or could not parse that
</I>&gt;<i>     response.
</I>&gt;<i>      &gt; A full debugging log should give us more information.
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; Alex.
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt;&gt; *From: *squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt;&gt; on
</I>&gt;<i>      &gt;&gt; behalf of Alex Rousskov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt;&gt;
</I>&gt;<i>      &gt;&gt; *Date: *Friday, 12 July 2024 at 17:11
</I>&gt;<i>      &gt;&gt; *To: *<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i>     &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;&gt;
</I>&gt;<i>      &gt;&gt; *Subject: *Re: [squid-users] TCP_MISS_ABORTED/502
</I>&gt;<i>      &gt;&gt;
</I>&gt;<i>      &gt;&gt; On 2024-07-12 11:38, Ben Toms wrote:
</I>&gt;<i>      &gt;&gt;&gt; Think I made the changes Alex requested:
</I>&gt;<i>      &gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt; 12/Jul/2024:15:36:31 +0000.640 local.server.ip
</I>&gt;<i>     TCP_MISS_ABORTED/502 3974
</I>&gt;<i>      &gt;&gt;&gt; GET <A HREF="https://local.server.fqdn/path/to/file">https://local.server.fqdn/path/to/file</A>
</I>&gt;<i>     &lt;<A HREF="https://local.server.fqdn/path/to/file">https://local.server.fqdn/path/to/file</A>&gt;
</I>&gt;<i>      &gt; &lt;<A HREF="https://local.server.fqdn/path/to/file">https://local.server.fqdn/path/to/file</A>
</I>&gt;<i>     &lt;<A HREF="https://local.server.fqdn/path/to/file">https://local.server.fqdn/path/to/file</A>&gt;&gt;
</I>&gt;<i>      &gt;&gt; &lt;<A HREF="https://local.server.fqdn/path/to/file">https://local.server.fqdn/path/to/file</A>
</I>&gt;<i>     &lt;<A HREF="https://local.server.fqdn/path/to/file">https://local.server.fqdn/path/to/file</A>&gt;
</I>&gt;<i>      &gt; &lt;<A HREF="https://local.server.fqdn/path/to/file">https://local.server.fqdn/path/to/file</A>
</I>&gt;<i>     &lt;<A HREF="https://local.server.fqdn/path/to/file">https://local.server.fqdn/path/to/file</A>&gt;&gt;&gt; -
</I>&gt;<i>      &gt;&gt;&gt; FIRSTUP_PARENT/public.ip.of.public.server text/html
</I>&gt;<i>      &gt;&gt;&gt; ERR_READ_ERROR/WITH_SERVER
</I>&gt;<i>      &gt;&gt;
</I>&gt;<i>      &gt;&gt; Thank you for using Squid v6 for this test.
</I>&gt;<i>      &gt;&gt;
</I>&gt;<i>      &gt;&gt; Unfortunately, due to Squid logging bugs, ERR_READ_ERROR/WITH_SERVER
</I>&gt;<i>      &gt;&gt; does not always mean what it says. For example, parent Squid
</I>&gt;<i>     could have
</I>&gt;<i>      &gt;&gt; closed the child-parent connection prematurely, but there could
</I>&gt;<i>     be other
</I>&gt;<i>      &gt;&gt; reasons. A full debugging log should give us more information.
</I>&gt;<i>      &gt;&gt;
</I>&gt;<i>      &gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt; 2024/07/12 14:57:08.678 kid1| 11,2| Stream.cc(274)
</I>&gt;<i>     sendStartOfMessage:
</I>&gt;<i>      &gt;&gt;&gt; HTTP Client REPLY:
</I>&gt;<i>      &gt;&gt;
</I>&gt;<i>      &gt;&gt; This is a child proxy response to the client. We need parent
</I>&gt;<i>     response to
</I>&gt;<i>      &gt;&gt; the child proxy. Look for &quot;HTTP Server RESPONSE&quot; lines instead.
</I>&gt;<i>      &gt;&gt;
</I>&gt;<i>      &gt;&gt;
</I>&gt;<i>      &gt;&gt; HTH,
</I>&gt;<i>      &gt;&gt;
</I>&gt;<i>      &gt;&gt; Alex.
</I>&gt;<i>      &gt;&gt;
</I>&gt;<i>      &gt;&gt;
</I>&gt;<i>      &gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt; ---------
</I>&gt;<i>      &gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt; HTTP/1.1 502 Bad Gateway
</I>&gt;<i>      &gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt; Server: squid/6.6
</I>&gt;<i>      &gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt; Mime-Version: 1.0
</I>&gt;<i>      &gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt; Date: Fri, 12 Jul 2024 14:57:08 GMT
</I>&gt;<i>      &gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt; Content-Type: text/html;charset=utf-8
</I>&gt;<i>      &gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt; Content-Length: 3629
</I>&gt;<i>      &gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt; X-Squid-Error: ERR_READ_ERROR 0
</I>&gt;<i>      &gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt; Vary: Accept-Language
</I>&gt;<i>      &gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt; Content-Language: en
</I>&gt;<i>      &gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt; Cache-Status: squid.host;detail=mismatch
</I>&gt;<i>      &gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt; Via: 1.1 squid.host (squid/6.6)
</I>&gt;<i>      &gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt; Connection: keep-alive
</I>&gt;<i>      &gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt; ----------
</I>&gt;<i>      &gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt; Regards,
</I>&gt;<i>      &gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt; Ben.
</I>&gt;<i>      &gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt; *From: *squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt;&gt; on
</I>&gt;<i>      &gt;&gt;&gt; behalf of Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt; *Date: *Friday, 12 July 2024 at 15:22
</I>&gt;<i>      &gt;&gt;&gt; *To: *<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i>     &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt; *Subject: *Re: [squid-users] TCP_MISS_ABORTED/502
</I>&gt;<i>      &gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt; On 13/07/24 01:52, Alex Rousskov wrote:
</I>&gt;<i>      &gt;&gt;&gt;&gt; On 2024-07-12 08:06, Ben Toms wrote:
</I>&gt;<i>      &gt;&gt;&gt;&gt;&gt; Seems that my issue is similar to -
</I>&gt;<i>      &gt;&gt;&gt;&gt;&gt;
</I>&gt;<i>     <A HREF="https://serverfault.com/questions/1104330/squid-cache-items-behind-basic-authentication">https://serverfault.com/questions/1104330/squid-cache-items-behind-basic-authentication</A> &lt;<A HREF="https://serverfault.com/questions/1104330/squid-cache-items-behind-basic-authentication">https://serverfault.com/questions/1104330/squid-cache-items-behind-basic-authentication</A>&gt; &lt;<A HREF="https://serverfault.com/questions/1104330/squid-cache-items-behind-basic-authentication">https://serverfault.com/questions/1104330/squid-cache-items-behind-basic-authentication</A> &lt;<A HREF="https://serverfault.com/questions/1104330/squid-cache-items-behind-basic-authentication">https://serverfault.com/questions/1104330/squid-cache-items-behind-basic-authentication</A>&gt;&gt; &lt;<A HREF="https://serverfault.com/questions/1104330/squid-cache-items-behind-basic-authentication">https://serverfault.com/questions/1104330/squid-cache-items-behind-basic-authentication</A> &lt;<A HREF="https://serverfault.com/questions/1104330/squid-cache-items-behind-basic-authentication">https://serverfault.com/questions/1104330/squid-cache-items-behind-basic-authentication</A>&gt; &lt;<A HREF="https://serverfault.com/questions/1104330/squid-cache-items-behind-basic-authentication">https://serverfault.com/questions/1104330/squid-cache-items-behind-basic-authentication</A> &lt;<A HREF="https://serverfault.com/questions/1104330/squid-cache-items-behind-basic-authentication">https://serverfault.com/questions/1104330/squid-cache-items-behind-basic-authentication</A>&gt;&gt;&gt; &lt;<A HREF="https://serverfault.com/questions/1104330/squid-cache-items-behind-basic-authentication">https://serverfault.com/questions/1104330/squid-cache-items-behind-basic-authentication</A> &lt;<A HREF="https://serverfault.com/questions/1104330/squid-cache-items-behind-basic-authentication">https://serverfault.com/questions/1104330/squid-cache-items-behind-basic-authentication</A>&gt; &lt;<A HREF="https://serverfault.com/questions/1104330/squid-cache-items-behind-basic-authentication">https://serverfault.com/questions/1104330/squid-cache-items-behind-basic-authentication</A> &lt;<A HREF="https://serverfault.com/questions/1104330/squid-cache-items-behind-basic-authentication">https://serverfault.com/questions/1104330/squid-cache-items-behind-basic-authentication</A>&gt; &lt;<A HREF="https://serverfault.com/questions/1104330/squid-cache-items-behind-basic-authentication">https://serverfault.com/questions/1104330/squid-cache-items-behind-basic-authentication</A> &lt;<A HREF="https://serverfault.com/questions/1104330/squid-cache-items-behind-basic-authentication">https://serverfault.com/questions/1104330/squid-cache-items-behind-basic-authentication</A>&gt;&gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt;&gt; You are facing up to two problems:
</I>&gt;<i>      &gt;&gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt;&gt; 1. Some authenticated responses are not cachable by Squid.
</I>&gt;<i>     Please share
</I>&gt;<i>      &gt;&gt;&gt;&gt; HTTP headers of the response in question.
</I>&gt;<i>      &gt;&gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt; FYI, those can be obtained by configuring squid.conf with
</I>&gt;<i>      &gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt;&#160; &#160;&#160; debug_options 11,2
</I>&gt;<i>      &gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt; Cheers
</I>&gt;<i>      &gt;&gt;&gt; Amos
</I>&gt;<i>      &gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt;&gt; 2. TCP_MISS_ABORTED/502 errors may delete a being-cached
</I>&gt;<i>     response. These
</I>&gt;<i>      &gt;&gt;&gt;&gt; can be bogus errors (essentially Squid logging bugs) or real
</I>&gt;<i>     ones (e.g.,
</I>&gt;<i>      &gt;&gt;&gt;&gt; due to communication bugs, misconfiguration, or compatibility
</I>&gt;<i>     problems).
</I>&gt;<i>      &gt;&gt;&gt;&gt; I recommend adding %err_code/%err_detail to your logformat and
</I>&gt;<i>     sharing
</I>&gt;<i>      &gt;&gt;&gt;&gt; the corresponding access.log lines (obfuscated as needed).
</I>&gt;<i>      &gt;&gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt;&gt; Sharing (privately if needed) a pointer to compressed ALL,9
</I>&gt;<i>     cache.log
</I>&gt;<i>      &gt;&gt;&gt;&gt; while reproducing the issue using a single transaction may
</I>&gt;<i>     help us
</I>&gt;<i>      &gt;&gt;&gt;&gt; resolve all the unknowns:
</I>&gt;<i>      &gt;&gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt;&gt;
</I>&gt;<i>     <A HREF="https://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction">https://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction</A> &lt;<A HREF="https://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction">https://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction</A>&gt; &lt;<A HREF="https://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction">https://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction</A> &lt;<A HREF="https://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction">https://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction</A>&gt;&gt; &lt;<A HREF="https://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction">https://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction</A> &lt;<A HREF="https://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction">https://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction</A>&gt; &lt;<A HREF="https://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction">https://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction</A> &lt;<A HREF="https://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction">https://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction</A>&gt;&gt;&gt; &lt;<A HREF="https://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction">https://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction</A> &lt;<A HREF="https://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction">https://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction</A>&gt; &lt;<A HREF="https://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction">https://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction</A> &lt;<A HREF="https://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction">https://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction</A>&gt; &lt;<A HREF="https://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction">https://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction</A> &lt;<A HREF="https://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction">https://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction</A>&gt;&gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt;&gt; HTH,
</I>&gt;<i>      &gt;&gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt;&gt; Alex.
</I>&gt;<i>      &gt;&gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt; _______________________________________________
</I>&gt;<i>      &gt;&gt;&gt; squid-users mailing list
</I>&gt;<i>      &gt;&gt;&gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i>      &gt;&gt;&gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>     &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>&gt;
</I>&gt;<i>      &gt; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>     &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>&gt;&gt;
</I>&gt;<i>      &gt;&gt; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>     &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>&gt;
</I>&gt;<i>      &gt; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>     &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>&gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>     &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>&gt;
</I>&gt;<i>      &gt;&gt; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>     &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>&gt;
</I>&gt;<i>      &gt; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>     &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>&gt;&gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;&gt; _______________________________________________
</I>&gt;<i>      &gt;&gt;&gt; squid-users mailing list
</I>&gt;<i>      &gt;&gt;&gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i>      &gt;&gt;&gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>     &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>&gt;
</I>&gt;<i>      &gt; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>     &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>&gt;&gt;
</I>&gt;<i>      &gt;&gt; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>     &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>&gt;
</I>&gt;<i>      &gt; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>     &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>&gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;
</I>&gt;<i>      &gt;&gt; _______________________________________________
</I>&gt;<i>      &gt;&gt; squid-users mailing list
</I>&gt;<i>      &gt;&gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i>      &gt;&gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>     &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>&gt;
</I>&gt;<i>      &gt; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>     &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>&gt;&gt;
</I>&gt;<i>      &gt;&gt; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>     &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>&gt;
</I>&gt;<i>      &gt; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>     &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>&gt;&gt;&gt;
</I>&gt;<i>      &gt;&gt;
</I>&gt;<i>      &gt;
</I>&gt;<i> 
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="026922.html">[squid-users] TCP_MISS_ABORTED/502
</A></li>
	<LI>Next message (by thread): <A HREF="026931.html">[squid-users] TCP_MISS_ABORTED/502
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26923">[ date ]</a>
              <a href="thread.html#26923">[ thread ]</a>
              <a href="subject.html#26923">[ subject ]</a>
              <a href="author.html#26923">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
