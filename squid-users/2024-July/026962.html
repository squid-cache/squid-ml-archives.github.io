<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid &quot;make check&quot; error
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20%22make%20check%22%20error&In-Reply-To=%3CCAPnyBTN-Yy4NqraDKTbPDnOmzohVyHmp2jpQ4fxJ_UAy9MYMJA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026961.html">
   <LINK REL="Next"  HREF="026963.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid &quot;make check&quot; error</H1>
    <B>Rafa&#322; Stanilewicz</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20%22make%20check%22%20error&In-Reply-To=%3CCAPnyBTN-Yy4NqraDKTbPDnOmzohVyHmp2jpQ4fxJ_UAy9MYMJA%40mail.gmail.com%3E"
       TITLE="[squid-users] squid &quot;make check&quot; error">rst at fomar.com.pl
       </A><BR>
    <I>Fri Jul 19 09:04:35 UTC 2024</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="026961.html">[squid-users] Squid Version squid-5.7-150400.3.6.1.x86_64 -- Squid is crashing continusly
</A></li>
        <LI>Next message (by thread): <A HREF="026963.html">[squid-users] squid &quot;make check&quot; error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26962">[ date ]</a>
              <a href="thread.html#26962">[ thread ]</a>
              <a href="subject.html#26962">[ subject ]</a>
              <a href="author.html#26962">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Good morning Gentlemen,

that's my first time here, so please forgive me for any mistakes.
I decided to make a test run of Squid 7 on our test server, running Ubuntu
24.04, but stumbled upon some issue during the &quot;make check&quot; step

I downloaded the squid-7.0.0-20240706-r314e430471.tar.bz2,
(BTW - I wanted to verify the signature, but I was not able to find it on
<A HREF="vhttp://www.squid-cache.org/Versions/v7/sig.dyn#SHA1">vhttp://www.squid-cache.org/Versions/v7/sig.dyn#SHA1</A> ),

As a preparation, I ran

apt update &amp;&amp; apt upgrade
aptitude build-dep squid
apt install debhelper-compat libcap2-dev libssl-dev

I configured it with
./configure  --enable-ssl-crtd --with-openssl --prefix=/usr
--localstatedir=/var     --libexecdir=${prefix}/lib/squid
--datadir=${prefix}/share/squid     --sysconfdir=/etc/squid
--with-default-user=proxy     --with-logdir=/var/log/squid
--with-pidfile=/var/run/squid.pid

The process was completed successfully. Then
make
and it finished completely. The last lines of make process:
make[1]: Leaving directory '/root/squid-7.0.0-VCS/tools'
Making all in test-suite
make[1]: Entering directory '/root/squid-7.0.0-VCS/test-suite'
make[1]: Nothing to be done for 'all'.
make[1]: Leaving directory '/root/squid-7.0.0-VCS/test-suite'
make[1]: Entering directory '/root/squid-7.0.0-VCS'
make[1]: Nothing to be done for 'all-am'.

Next step was make check, and it failed with this error:

make[3]: Leaving directory '/root/squid-7.0.0-VCS/lib/ntlmauth'
make[2]: Leaving directory '/root/squid-7.0.0-VCS/lib/ntlmauth'
make[2]: Entering directory '/root/squid-7.0.0-VCS/lib'
make  tests/testRFC1738
make[3]: Entering directory '/root/squid-7.0.0-VCS/lib'
depbase=`echo tests/testRFC1738.o | sed 's|[^/]*$|.deps/&amp;|;s|\.o$||'`;\
g++ -std=c++17 -DHAVE_CONFIG_H
-DDEFAULT_CONFIG_FILE=\&quot;/etc/squid/squid.conf\&quot;
-DDEFAULT_SQUID_DATA_DIR=\&quot;/share/squid\&quot;
-DDEFAULT_SQUID_CONFIG_DIR=\&quot;/etc/squid\&quot;   -I.. -I../include -I../lib
-I../src -I../include    -Wall -Wextra -Wimplicit-fallthrough=5
-Wpointer-arith -Wwrite-strings -Wcomments -Wshadow -Wmissing-declarations
-Woverloaded-virtual -Werror -pipe -D_REENTRANT -g -O2 -march=native -MT
tests/testRFC1738.o -MD -MP -MF $depbase.Tpo -c -o tests/testRFC1738.o
tests/testRFC1738.cc &amp;&amp;\
mv -f $depbase.Tpo $depbase.Po
In file included from tests/testRFC1738.cc:10:
../include/unitTestMain.h:16:10: fatal error:
cppunit/BriefTestProgressListener.h: No such file or directory
   16 | #include &lt;cppunit/BriefTestProgressListener.h&gt;
      |          ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
compilation terminated.
make[3]: *** [Makefile:990: tests/testRFC1738.o] Error 1
make[3]: Leaving directory '/root/squid-7.0.0-VCS/lib'
make[2]: *** [Makefile:1347: check-am] Error 2
make[2]: Leaving directory '/root/squid-7.0.0-VCS/lib'
make[1]: *** [Makefile:1027: check-recursive] Error 1
make[1]: Leaving directory '/root/squid-7.0.0-VCS/lib'
make: *** [Makefile:606: check-recursive] Error 1

I found out that I need to do
apt install libcppunit-dev
So i did it.

I re-ran &quot;make check&quot; , but then things went south completely:
...
make  tests/testRFC1738
make[3]: Entering directory '/root/squid-7.0.0-VCS/lib'
depbase=`echo tests/testRFC1738.o | sed 's|[^/]*$|.deps/&amp;|;s|\.o$||'`;\
g++ -std=c++17 -DHAVE_CONFIG_H
-DDEFAULT_CONFIG_FILE=\&quot;/etc/squid/squid.conf\&quot;
-DDEFAULT_SQUID_DATA_DIR=\&quot;/share/squid\&quot;
-DDEFAULT_SQUID_CONFIG_DIR=\&quot;/etc/squid\&quot;   -I.. -I../include -I../lib
-I../src -I../include    -Wall -Wextra -Wimplicit-fallthrough=5
-Wpointer-arith -Wwrite-strings -Wcomments -Wshadow -Wmissing-declarations
-Woverloaded-virtual -Werror -pipe -D_REENTRANT -g -O2 -march=native -MT
tests/testRFC1738.o -MD -MP -MF $depbase.Tpo -c -o tests/testRFC1738.o
tests/testRFC1738.cc &amp;&amp;\
mv -f $depbase.Tpo $depbase.Po
/bin/bash ../libtool  --tag=CXX   --mode=link g++ -std=c++17 -Wall -Wextra
-Wimplicit-fallthrough=5 -Wpointer-arith -Wwrite-strings -Wcomments
-Wshadow -Wmissing-declarations -Woverloaded-virtual -Werror -pipe
-D_REENTRANT -g -O2 -march=native  -g -o tests/testRFC1738
tests/testRFC1738.o ../lib/libmiscencoding.la ../lib/libmiscutil.la
 ../compat/libcompatsquid.la
libtool: link: g++ -std=c++17 -Wall -Wextra -Wimplicit-fallthrough=5
-Wpointer-arith -Wwrite-strings -Wcomments -Wshadow -Wmissing-declarations
-Woverloaded-virtual -Werror -pipe -D_REENTRANT -g -O2 -march=native -g -o
tests/testRFC1738 tests/testRFC1738.o  ../lib/.libs/libmiscencoding.a
../lib/.libs/libmiscutil.a ../compat/.libs/libcompatsquid.a
/usr/bin/ld: tests/testRFC1738.o: warning: relocation against
`_ZTVN7CppUnit27TestSuiteBuilderContextBaseE' in read-only section
`.text._ZN11TestRfc173815addTestsToSuiteERN7CppUnit27TestSuiteBuilderContextBaseE[_ZN11TestRfc173815addTestsToSuiteERN7CppUnit27TestSuiteBuilderContextBaseE]'
/usr/bin/ld: tests/testRFC1738.o: in function `TestProgram::runTests()':
/root/squid-7.0.0-VCS/lib/../include/unitTestMain.h:61:(.text+0x42b):
undefined reference to
`CppUnit::TestResult::TestResult(CppUnit::SynchronizedObject::SynchronizationObject*)'
/usr/bin/ld:
/root/squid-7.0.0-VCS/lib/../include/unitTestMain.h:64:(.text+0x435):
undefined reference to
`CppUnit::TestResultCollector::TestResultCollector(CppUnit::SynchronizedObject::SynchronizationObject*)'
/usr/bin/ld:
/root/squid-7.0.0-VCS/lib/../include/unitTestMain.h:65:(.text+0x440):
undefined reference to
`CppUnit::TestResult::addListener(CppUnit::TestListener*)'
/usr/bin/ld:
/root/squid-7.0.0-VCS/lib/../include/unitTestMain.h:71:(.text+0x44d):
undefined reference to
`CppUnit::TextTestProgressListener::TextTestProgressListener()'
/usr/bin/ld:
/root/squid-7.0.0-VCS/lib/../include/unitTestMain.h:72:(.text+0x458):
undefined reference to
`CppUnit::TestResult::addListener(CppUnit::TestListener*)'
...
/usr/bin/ld:
tests/testRFC1738.o:(.data.rel.ro._ZTVN7CppUnit10TestCallerI11TestRfc1738EE[_ZTVN7CppUnit10TestCallerI11TestRfc1738EE]+0x68):
undefined reference to `CppUnit::Test::checkIsValidIndex(int) const'
/usr/bin/ld:
tests/testRFC1738.o:(.data.rel.ro._ZTVN7CppUnit10TestCallerI11TestRfc1738EE[_ZTVN7CppUnit10TestCallerI11TestRfc1738EE]+0x70):
undefined reference to `CppUnit::TestLeaf::doGetChildTestAt(int) const'
/usr/bin/ld: warning: creating DT_TEXTREL in a PIE
collect2: error: ld returned 1 exit status
make[3]: *** [Makefile:936: tests/testRFC1738] Error 1
make[3]: Leaving directory '/root/squid-7.0.0-VCS/lib'
make[2]: *** [Makefile:1347: check-am] Error 2
make[2]: Leaving directory '/root/squid-7.0.0-VCS/lib'
make[1]: *** [Makefile:1027: check-recursive] Error 1
make[1]: Leaving directory '/root/squid-7.0.0-VCS/lib'
make: *** [Makefile:606: check-recursive] Error 1

Before I re-compile the whole package and drill down to the configuration
process, let me ask if there is something obvious that I missed, or that
you can see in the process.

I can provide all the logs needed.

Thank you in advance.

Rafal Stanilewicz
-- 
Zanim wydrukujesz, pomy&#347;l o drukarce..
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20240719/82d8b45a/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20240719/82d8b45a/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="026961.html">[squid-users] Squid Version squid-5.7-150400.3.6.1.x86_64 -- Squid is crashing continusly
</A></li>
	<LI>Next message (by thread): <A HREF="026963.html">[squid-users] squid &quot;make check&quot; error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26962">[ date ]</a>
              <a href="thread.html#26962">[ thread ]</a>
              <a href="subject.html#26962">[ subject ]</a>
              <a href="author.html#26962">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
