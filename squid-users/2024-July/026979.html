<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid on Freebsd
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20on%20Freebsd&In-Reply-To=%3Cdff99ccc-4af8-4a9e-9149-b3981238fd86%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026978.html">
   <LINK REL="Next"  HREF="026980.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid on Freebsd</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20on%20Freebsd&In-Reply-To=%3Cdff99ccc-4af8-4a9e-9149-b3981238fd86%40measurement-factory.com%3E"
       TITLE="[squid-users] Squid on Freebsd">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Jul 23 19:22:59 UTC 2024</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="026978.html">[squid-users] Squid on Freebsd
</A></li>
        <LI>Next message (by thread): <A HREF="026980.html">[squid-users] SQUID - WINDBIND - very slow internet speed
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26979">[ date ]</a>
              <a href="thread.html#26979">[ thread ]</a>
              <a href="subject.html#26979">[ subject ]</a>
              <a href="author.html#26979">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2024-07-23 13:34, Anton Kornexl wrote:

&gt;<i> Squid starts, shows a segmentation fault and continues working normally.
</I>&gt;<i> Squid forks a worker child and probably this child works, but the parent 
</I>&gt;<i> process dies with segmentation fault. There is no sign of this 
</I>&gt;<i> segmention fault in the cache log.
</I>
You may catch parent Squid in the act of crashing if you start Squid 
from gdb, but telling gdb which process to watch may not be trivial, and 
I would leave that experiment for later and focus on an easier target first:


&gt;<i> The segmentation fault occurs even when calling squid -k parse.
</I>&gt;<i> 
</I>&gt;<i> Should i try to produce a coredump of a squid -k parse run?
</I>
Yes, please: `gdb --args squid -k parse ...` or a similar command may 
work to tell gdb how to start Squid. After that, inside gdb, a &quot;run&quot; 
command should start Squid and produce a stack trace we need to triage 
this problem further.

Alternatively, enable coredump file generation in your OS (if needed) 
and examine the dump file using gdb as detailed on the same page that 
Francesco has referenced earlier:
<A HREF="https://wiki.squid-cache.org/SquidFaq/BugReporting#crashes-and-core-dumps">https://wiki.squid-cache.org/SquidFaq/BugReporting#crashes-and-core-dumps</A>


HTH,

Alex.


&gt;<i> Am 23.07.2024 09:03 schrieb Francesco Chemolli &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">gkinkie at gmail.com</A>&gt;:
</I>&gt;<i> 
</I>&gt;<i>     Hi Anton,
</I>&gt;<i>      &#160; no, segmentation fault shouldn't happen at any time.
</I>&gt;<i>     Could you try to follow the instructions at
</I>&gt;<i>     <A HREF="https://wiki.squid-cache.org/SquidFaq/BugReporting#crashes-and-core-dumps">https://wiki.squid-cache.org/SquidFaq/BugReporting#crashes-and-core-dumps</A>
</I>&gt;<i>     ?
</I>&gt;<i>     What are the last lines in the cache.log when the segmentation fault
</I>&gt;<i>     happens?
</I>&gt;<i>     Thanks
</I>&gt;<i> 
</I>&gt;<i>     On Tue, Jul 23, 2024 at 3:12&#8239;AM Anton Kornexl
</I>&gt;<i>     &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">anton.kornexl at miex.cc</A>&gt; wrote:
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; Hello,
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; I have tested the two installations further
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; Opnsense 23.x with squid 6.6 on freebsd 13.2-Release-p9 produces the
</I>&gt;<i>      &gt; same segmentation fault, but it does not popup as red window in the
</I>&gt;<i>      &gt; dashboard.
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; I have set &quot;debug_options ALL,5&quot; in squid.conf:
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; I have found the following lines in cache.log (grep _suid cache.log)
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; 2024/07/22 17:26:52.186 kid1| 21,3| tools.cc(625) enter_suid:
</I>&gt;<i>      &gt; enter_suid: PID 29145 taking root privileges
</I>&gt;<i>      &gt; 2024/07/22 17:26:52.186 kid1| 21,31 tools.cc(629) enter_suid:
</I>&gt;<i>      &gt; enter_suid: setresuid failed: (1) Operation not permitted
</I>&gt;<i>      &gt; 2024/07/22 17:26:52.186 kid1| 21,3| tools.cc(561) leave suid: leave
</I>&gt;<i>      &gt; suid: PID 29145 called
</I>&gt;<i>      &gt; 2024/07/22 17:26:52.187 kid1| 21,31 tools.cc(625) enter_suid:
</I>&gt;<i>      &gt; enter_suid: PID 29145 taking root privileges
</I>&gt;<i>      &gt; 2024/07/22 17:26:52.187 kid1| 21,3| tools.cc(629) enter_suid:
</I>&gt;<i>      &gt; enter_suid: setresuid failed: (1) Operation not permitted
</I>&gt;<i>      &gt; 2024/07/22 17:26:52.187 kid1| 21,31 tools.cc(561) leave_suid: leave
</I>&gt;<i>      &gt; suid: PID 29145 called
</I>&gt;<i>      &gt; 2024/07/22 17:26:52.187 kid1| 21,31 tools.cc(625) enter_suid:
</I>&gt;<i>      &gt; enter_suid: PID 29145 taking root privileges
</I>&gt;<i>      &gt; 2024/07/22 17:26:52.187 kid1l 21,31 tools.cc(629) enter_suid:
</I>&gt;<i>      &gt; enter_suid: setresuid failed: (1) Operation not permitted
</I>&gt;<i>      &gt; 2024/07/22 17:26:52.187 kid1| 21,31 tools.cc(561) leave_suid: leave
</I>&gt;<i>      &gt; suid: PID 29145 called
</I>&gt;<i>      &gt; 2024/07/22 17:26:52.187 kid1l 21,31 tools.cc(561) leave_suid:
</I>&gt;<i>      &gt; leave_suid: PID 29648 called
</I>&gt;<i>      &gt; 2024/07/22 17:26:52.187 kid1l 21,31 tools.cc(651) no_suid:
</I>&gt;<i>     no_suid: PID
</I>&gt;<i>      &gt; 29648 giving up root privileges forever
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; maybe this is the cause of the &quot;segmentation fault&quot;.
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; The difference between the installations 23.x and 24.x is the
</I>&gt;<i>     alerting
</I>&gt;<i>      &gt; of this segmentaion fault in the dashboard of opnsense.
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; But what ist the cause of this &quot;Operation not permitted&quot;
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; yours
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; Anton Kornexl
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; Am 22.07.2024 um 11:03 schrieb Anton Kornexl:
</I>&gt;<i>      &gt; &gt;&#160; Hello
</I>&gt;<i>      &gt; &gt;
</I>&gt;<i>      &gt; &gt; i try to use squid (6.10)&#160; with opnsense 24.x on freebsd
</I>&gt;<i>      &gt; &gt; 13-2-Release-p11.
</I>&gt;<i>      &gt; &gt;
</I>&gt;<i>      &gt; &gt; It produces a &quot;segmentation fault&quot; at start and restart but the
</I>&gt;<i>      &gt; &gt; process runs.
</I>&gt;<i>      &gt; &gt;
</I>&gt;<i>      &gt; &gt; The &quot;segmentation fault&quot; occurs even with squid -k parse.
</I>&gt;<i>      &gt; &gt;
</I>&gt;<i>      &gt; &gt; A &quot;service squid reload&quot; runs OK, but a &quot;service squid restart&quot;
</I>&gt;<i>      &gt; &gt; produces this Segmentation fault.
</I>&gt;<i>      &gt; &gt;
</I>&gt;<i>      &gt; &gt; The problem did not exist with opnsense 23.x and an older squid.
</I>&gt;<i>      &gt; &gt;
</I>&gt;<i>      &gt; &gt; How can I debug this error probably in the parse part?
</I>&gt;<i>      &gt; &gt;
</I>&gt;<i>      &gt; &gt; yours
</I>&gt;<i>      &gt; &gt;
</I>&gt;<i>      &gt; &gt; Anton Kornexl
</I>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="026978.html">[squid-users] Squid on Freebsd
</A></li>
	<LI>Next message (by thread): <A HREF="026980.html">[squid-users] SQUID - WINDBIND - very slow internet speed
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26979">[ date ]</a>
              <a href="thread.html#26979">[ thread ]</a>
              <a href="subject.html#26979">[ subject ]</a>
              <a href="author.html#26979">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
