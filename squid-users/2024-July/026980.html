<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] SQUID - WINDBIND - very slow internet speed
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SQUID%20-%20WINDBIND%20-%20very%20slow%20internet%20speed&In-Reply-To=%3C11060a91-e9b8-4755-8e60-fe9bdbce2032%40articatech.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026979.html">
   <LINK REL="Next"  HREF="026981.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] SQUID - WINDBIND - very slow internet speed</H1>
    <B>Andre Bolinhas</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SQUID%20-%20WINDBIND%20-%20very%20slow%20internet%20speed&In-Reply-To=%3C11060a91-e9b8-4755-8e60-fe9bdbce2032%40articatech.com%3E"
       TITLE="[squid-users] SQUID - WINDBIND - very slow internet speed">andre.bolinhas at articatech.com
       </A><BR>
    <I>Tue Jul 23 23:20:00 UTC 2024</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="026979.html">[squid-users] Squid on Freebsd
</A></li>
        <LI>Next message (by thread): <A HREF="026981.html">[squid-users] SQUID - WINDBIND - very slow internet speed
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26980">[ date ]</a>
              <a href="thread.html#26980">[ thread ]</a>
              <a href="subject.html#26980">[ subject ]</a>
              <a href="author.html#26980">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Team.

I'm using SQUID 5.9 + windbindd 4.9.5, the authentication method is NTLM.

Every day, around 5pm, the internet speed becomes very slow, with users 
reporting that websites takes too long to open.

Also, the time that the issue occur is very strange, since is when most 
of the users are not in the office anymore

By doing a deep analyze on Proxy server, I manage to find this error 
that could be related with this issue.

Cache.log
GENSEC login failed: NT_STATUS_LOGON_FAILURE
GENSEC login failed: NT_STATUS_LOGON_FAILURE
GENSEC login failed: NT_STATUS_LOGON_FAILURE
GENSEC login failed: NT_STATUS_LOGON_FAILURE

Windbindd.log
[2024/07/22 17:06:48.220216,&#160; 2] 
../source3/winbindd/winbindd.c:1121(remove_client)
 &#160; final write to client failed: Broken pipe
[2024/07/22 17:06:48.220319,&#160; 0] 
../source3/winbindd/winbindd.c:1246(winbindd_listen_fde_handler)
 &#160; winbindd: Exceeding 500 client connections, no idle connection found
[2024/07/22 17:06:48.261482,&#160; 0] 
../source3/winbindd/winbindd.c:1246(winbindd_listen_fde_handler)
 &#160; winbindd: Exceeding 500 client connections, no idle connection found
[2024/07/22 17:06:48.261857,&#160; 2] 
../source3/winbindd/winbindd.c:1121(remove_client)
 &#160; final write to client failed: Broken pipe
[2024/07/22 17:06:48.261926,&#160; 0] 
../source3/winbindd/winbindd.c:1246(winbindd_listen_fde_handler)
 &#160; winbindd: Exceeding 500 client connections, no idle connection found
[2024/07/22 17:06:48.276216,&#160; 0] 
../source3/winbindd/winbindd.c:1246(winbindd_listen_fde_handler)
 &#160; winbindd: Exceeding 500 client connections, no idle connection found
[2024/07/22 17:06:48.276507,&#160; 2] 
../source3/winbindd/winbindd.c:1121(remove_client)
 &#160; final write to client failed: Broken pipe
[2024/07/22 17:06:48.276568,&#160; 0] 
../source3/winbindd/winbindd.c:1246(winbindd_listen_fde_handler)
 &#160; winbindd: Exceeding 500 client connections, no idle connection found
[2024/07/22 17:09:02.512093,&#160; 1] 
../source4/lib/messaging/messaging.c:83(ping_message)
 &#160; INFO: Received PING message from server 10301 []
[2024/07/22 17:09:02.512159,&#160; 1] ../source3/lib/messages.c:131(ping_message)
 &#160; INFO: Received PING message from PID 10301 []
[2024/07/22 17:11:27.979681,&#160; 1] 
../source3/winbindd/winbindd_util.c:440(trustdom_list_done)
 &#160; trustdom_list_done: Could not receive trusts for domain BANK
[2024/07/22 17:11:27.979756,&#160; 1] 
../source3/winbindd/winbindd_util.c:440(trustdom_list_done)
 &#160; trustdom_list_done: Could not receive trusts for domain HLGROUP
[2024/07/22 17:12:02.612725,&#160; 1] 
../source4/lib/messaging/messaging.c:83(ping_message)
 &#160; INFO: Received PING message from server 4706 []
[2024/07/22 17:12:02.612794,&#160; 1] ../source3/lib/messages.c:131(ping_message)
 &#160; INFO: Received PING message from PID 4706 []
[2024/07/22 17:15:03.307322,&#160; 1] 
../source4/lib/messaging/messaging.c:83(ping_message)
 &#160; INFO: Received PING message from server 13541 []
[2024/07/22 17:15:03.307477,&#160; 1] ../source3/lib/messages.c:131(ping_message)
 &#160; INFO: Received PING message from PID 13541 []
[2024/07/22 17:18:02.603927,&#160; 1] 
../source4/lib/messaging/messaging.c:83(ping_message)
 &#160; INFO: Received PING message from server 27640 []
[2024/07/22 17:18:02.603983,&#160; 1] ../source3/lib/messages.c:131(ping_message)
 &#160; INFO: Received PING message from PID 27640 []

smb.conf
[global]
 &#160;&#160; netbios name&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; = ASP02
 &#160;&#160; log level&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; = 2
 &#160;&#160; workgroup&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; = mydom
 &#160;&#160; kerberos method&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; = dedicated keytab
 &#160;&#160; dedicated keytab file&#160;&#160;&#160;&#160;&#160; = /etc/krb5.keytab
 &#160;&#160; realm&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; = mydom.MY
 &#160;&#160; password server&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; = 10.150.1.62
 &#160;&#160; security&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; = ads
 &#160;&#160; winbind enum groups&#160;&#160;&#160;&#160;&#160;&#160;&#160; = No
 &#160;&#160; winbind enum users&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; = No
 &#160;&#160; idmap config * : backend&#160;&#160; = tdb
 &#160;&#160; idmap config * : range&#160;&#160;&#160;&#160; = 3000-7999
 &#160;&#160; idmap config mydom:backend = ad
 &#160;&#160; idmap config mydom:schema_mode = rfc2307
 &#160;&#160; idmap config mydom:range = 10000-999999
 &#160;&#160; idmap config mydom:unix_nss_info = yes
tls enabled = yes
ldap ssl = start tls
tls keyfile&#160; = tls/key.pem
tls certfile = tls/cert.pem
tls cafile&#160;&#160; = tls/ca.pem
client ldap sasl wrapping = plain
 &#160;&#160; client ntlmv2 auth&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; = Yes
 &#160;&#160; client lanman auth&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; = No
 &#160;&#160; client ldap sasl wrapping&#160; = sign
 &#160;&#160; winbind normalize names&#160;&#160;&#160; = No
 &#160;&#160; winbind separator&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; = /
 &#160;&#160; winbind use default domain = yes
 &#160;&#160; winbind nested groups&#160;&#160;&#160;&#160;&#160; = Yes
 &#160;&#160; winbind reconnect delay&#160;&#160;&#160; = 30
 &#160;&#160; winbind offline logon&#160;&#160;&#160;&#160;&#160; = true
 &#160;&#160; winbind cache time&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; = 1800
 &#160;&#160; winbind refresh tickets&#160;&#160;&#160; = true
 &#160;&#160; winbind refresh tickets&#160;&#160;&#160; = true
 &#160;&#160; winbind max clients&#160;&#160;&#160;&#160;&#160;&#160;&#160; = 500
 &#160;&#160; allow trusted domains&#160;&#160;&#160;&#160;&#160; = Yes
 &#160;&#160; server signing&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; = auto
 &#160;&#160; client signing&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; = auto
 &#160;&#160; lm announce&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; = No
 &#160;&#160; ntlm auth&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; = No
 &#160;&#160; lanman auth&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; = No
 &#160;&#160; preferred master&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; = No
 &#160;&#160; local master&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; = No
 &#160;&#160; wins support&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; = No
 &#160;&#160; encrypt passwords&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; = yes
 &#160;&#160; printing&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; = bsd
 &#160;&#160; load printers&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; = no
 &#160;&#160; socket options&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; = TCP_NODELAY SO_RCVBUF=8192 SO_SNDBUF=8192
 &#160;&#160; min protocol&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; = SMB2
 &#160;&#160; client min protocol &#160;&#160;&#160; &#160;&#160;&#160; &#160;= SMB2
 &#160;&#160; client max protocol &#160;&#160;&#160; &#160;&#160;&#160; &#160;= SMB3
 &#160;&#160; load printers&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; = no
 &#160;&#160; printing&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; = bsd
 &#160;&#160; printcap name&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; = /dev/null
 &#160;&#160; disable spoolss&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; = yes

Squid.conf

# kerberos_conf() LockActiveDirectoryToKerberos = 0

#
#KerbAuthMethod = 0/1 and NOT_NTLM = False
auth_param ntlm program /usr/bin/ntlm_auth&#160; --domain=mydom.MY 
--helper-protocol=squid-2.5-ntlmssp
auth_param ntlm children 500 startup=5 idle=1 concurrency=0 
queue-size=2000 on-persistent-overload=ERR
auth_param ntlm keep_alive off

#
# ads groups OK
#Other settings
auth_param basic credentialsttl 7200 seconds
authenticate_ttl 3600 seconds
authenticate_ip_ttl 1 seconds
authenticate_cache_garbage_interval 3600 seconds

acl authFailed src all
acl AUTHENTICATED proxy_auth REQUIRED
# END NTLM Parameters --------------------------------
# Basic authentication for other browser that did not supports NTLM
auth_param basic program /usr/bin/ntlm_auth 
--helper-protocol=squid-2.5-basic
auth_param basic children 60 startup=2 idle=1
auth_param basic realm Active Directory Basic Identification
auth_param basic credentialsttl 7200 seconds
authenticate_ttl 3600 seconds
authenticate_ip_ttl 1 seconds
authenticate_cache_garbage_interval 3600 seconds

# ldap_auth_ad() EnableAdLDAPAuth = 0 - SKIP

# ads groups OK



# --------------------------------------------------



-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20240724/a1582d52/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20240724/a1582d52/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="026979.html">[squid-users] Squid on Freebsd
</A></li>
	<LI>Next message (by thread): <A HREF="026981.html">[squid-users] SQUID - WINDBIND - very slow internet speed
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26980">[ date ]</a>
              <a href="thread.html#26980">[ thread ]</a>
              <a href="subject.html#26980">[ subject ]</a>
              <a href="author.html#26980">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
