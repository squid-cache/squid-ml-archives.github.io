<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] url_rewrite (with rewrite-url): PinnedConnection failure results in total failure
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20url_rewrite%20%28with%20rewrite-url%29%3A%20PinnedConnection%0A%20failure%20results%20in%20total%20failure&In-Reply-To=%3C71778731-9756-4385-9064-c94e802dba68%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026772.html">
   <LINK REL="Next"  HREF="026776.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] url_rewrite (with rewrite-url): PinnedConnection failure results in total failure</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20url_rewrite%20%28with%20rewrite-url%29%3A%20PinnedConnection%0A%20failure%20results%20in%20total%20failure&In-Reply-To=%3C71778731-9756-4385-9064-c94e802dba68%40measurement-factory.com%3E"
       TITLE="[squid-users] url_rewrite (with rewrite-url): PinnedConnection failure results in total failure">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Jun 18 19:03:47 UTC 2024</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="026772.html">[squid-users] url_rewrite (with rewrite-url): PinnedConnection failure results in total failure
</A></li>
        <LI>Next message (by thread): <A HREF="026776.html">[squid-users] Requesting Help to debug my squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26773">[ date ]</a>
              <a href="thread.html#26773">[ thread ]</a>
              <a href="subject.html#26773">[ subject ]</a>
              <a href="author.html#26773">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2024-06-18 11:34, Andreas Weigel wrote:

&gt;<i> updating from a (security-patched) Squidv4 to Squidv6, problems occurred 
</I>&gt;<i> with regard to url_rewrite Feature used for content-filtering. The 
</I>&gt;<i> external helper uses &quot;OK rewrite-url=&quot; to point to a custom page that 
</I>&gt;<i> Squid used to retrieve and present to the Client. This used to work with 
</I>&gt;<i> SSL-Interception, but it does no longer in Squidv6. It does not matter 
</I>&gt;<i> in that regard if peek+splice or stare+bump is used, Squid always fails 
</I>&gt;<i> with ERR_CANNOT_FORWARD.
</I>
The peek+splice and stare+bump cases are very different with regard to 
how the request destination should be computed (including how pinned 
connection should be reused) IMO. In my response, I will focus on the 
stare+bump case.


&gt;<i> I understand that using the rewrite-url mechanism is discouraged, but 
</I>&gt;<i> would still like to understand if this is intended behavior (and the 
</I>&gt;<i> reasoning behind it) or if this has to be considered a bug.
</I>
Overall, I believe that a Squid admin should be able to rewrite any HTTP 
request (destination). Whether to classify the lack of this 
functionality in current Squid bumping code as a regression bug or a 
missing feature is currently unimportant AFAICT.

Needless to say, using another destination after a Squid-to-server 
connection has been pinned to the client-to-Squid connection is not 
quite compatible with some guarantees implied by &quot;pinning&quot;, so extra 
care should be done when (re)enabling this behavior. I would not be 
surprised if we need to introduce several pinning categories, with 
different guarantees and re-pinning options!

For example, a client pinned to a server after a failed Host validation 
should not be able to send a second request to another destination 
without Squid admin permission. I am not sure how to detect such a 
permission when, say, a URL rewriter simply echoes client-chosen 
destination (possibly trusting Squid to block any requests that are 
attempting to escape their &quot;pinned jail&quot;). Distinguishing &quot;intended&quot; 
destination rewrites from canonicalizing or DNS-resolving echoes may be 
difficult!

It is also not clear whether the originally pinned Squid-to-server 
connection should be preserved in such cases (to be used for future 
non-redirected requests received on the same client-to-Squid connection, 
if any). Again, the correct answer may depend on the &quot;pinning category&quot;.


HTH,

Alex.




&gt;<i> Digging into the codebase, I can see that with v4, Squid first
</I>&gt;<i> checked the validity of any pinned connection and if none is found,
</I>&gt;<i> still retrieves the &quot;replacement page&quot;. It seems that
</I>&gt;<i> daf80700130b6f98256b75c511916d1a79b23597 changed the logic in that
</I>&gt;<i> regard, causing the FwdState to fail hard and not try any of the
</I>&gt;<i> remaining peer options (see log excerpts below), although I can see
</I>&gt;<i> that it added two selections (PINNED and HIER_DIRECT).
</I>
&gt;<i> PS:
</I>&gt;<i> 
</I>&gt;<i> log excerpt from squid-v4.16 (successful rewrite-url)
</I>&gt;<i> 
</I>&gt;<i> 2024/06/14 14:46:30.750 kid1| 61,2| /client_side_request.cc(1266) 
</I>&gt;<i> clientRedirectDone: URL-rewriter diverts URL from <A HREF="https://youtube.com/">https://youtube.com/</A> 
</I>&gt;<i> to 
</I>&gt;<i> <A HREF="http://127.0.0.1:8081/?cat=&amp;cat_all=&amp;action=URLLIST&amp;srv=&amp;url=https%3a%2f%2fyoutube%2ecom%2f&amp;shortener=">http://127.0.0.1:8081/?cat=&amp;cat_all=&amp;action=URLLIST&amp;srv=&amp;url=https%3a%2f%2fyoutube%2ecom%2f&amp;shortener=</A>
</I>&gt;<i> 2024/06/14 14:46:30.750 kid1| 33,5| /store_client.cc(317) doCopy: 
</I>&gt;<i> store_client::doCopy: co: 0, hi: 0
</I>&gt;<i> 2024/06/14 14:46:30.750 kid1| 17,3| /FwdState.cc(340) Start: 
</I>&gt;<i> '<A HREF="http://127.0.0.1:8081/?cat=&amp;cat_all=&amp;action=URLLIST&amp;srv=&amp;url=https%3a%2f%2fyoutube%2ecom%2f&amp;shortener=">http://127.0.0.1:8081/?cat=&amp;cat_all=&amp;action=URLLIST&amp;srv=&amp;url=https%3a%2f%2fyoutube%2ecom%2f&amp;shortener=</A>'
</I>&gt;<i> 2024/06/14 14:46:30.750 kid1| 17,2| /FwdState.cc(142) FwdState: 
</I>&gt;<i> Forwarding client request local=172.217.13.206:443 
</I>&gt;<i> remote=192.168.180.10:33836 FD 11 flags=33, 
</I>&gt;<i> url=<A HREF="http://127.0.0.1:8081/?cat=&amp;cat_all=&amp;action=URLLIST&amp;srv=&amp;url=https%3a%2f%2fyoutube%2ecom%2f">http://127.0.0.1:8081/?cat=&amp;cat_all=&amp;action=URLLIST&amp;srv=&amp;url=https%3a%2f%2fyoutube%2ecom%2f</A>
</I>&gt;<i> 2024/06/14 14:46:30.750 kid1| 17,3| /FwdState.cc(149) FwdState: FwdState 
</I>&gt;<i> constructed, this=0x559ad7e89b88
</I>&gt;<i> 2024/06/14 14:46:30.750 kid1| 44,3| /peer_select.cc(161) peerSelect: 
</I>&gt;<i> e:=XIV/0x559ad7e89500*2 
</I>&gt;<i> <A HREF="http://127.0.0.1:8081/?cat=&amp;cat_all=&amp;action=URLLIST&amp;srv=&amp;url=https%3a%2f%2fyoutube%2ecom%2f&amp;shortener=">http://127.0.0.1:8081/?cat=&amp;cat_all=&amp;action=URLLIST&amp;srv=&amp;url=https%3a%2f%2fyoutube%2ecom%2f&amp;shortener=</A>
</I>&gt;<i> 2024/06/14 14:46:30.750 kid1| 44,3| /peer_select.cc(472) peerSelectFoo: 
</I>&gt;<i> GET 127.0.0.1
</I>&gt;<i> 2024/06/14 14:46:30.750 kid1| 44,3| /peer_select.cc(477) peerSelectFoo: 
</I>&gt;<i> peerSelectFoo: direct = DIRECT_UNKNOWN (always_direct to be checked)
</I>&gt;<i> 2024/06/14 14:46:30.750 kid1| 44,3| /peer_select.cc(218) 
</I>&gt;<i> peerCheckAlwaysDirectDone: peerCheckAlwaysDirectDone: ALLOWED
</I>&gt;<i> 2024/06/14 14:46:30.750 kid1| 44,3| /peer_select.cc(224) 
</I>&gt;<i> peerCheckAlwaysDirectDone: direct = DIRECT_YES (always_direct allow)
</I>&gt;<i> 2024/06/14 14:46:30.750 kid1| 44,3| /peer_select.cc(472) peerSelectFoo: 
</I>&gt;<i> GET 127.0.0.1
</I>&gt;<i> 2024/06/14 14:46:30.750 kid1| 33,7| /client_side.cc(4119) 
</I>&gt;<i> validatePinnedConnection: local=192.168.41.35:47842 
</I>&gt;<i> remote=172.217.13.206:443 FD 13 flags=1
</I>&gt;<i> 2024/06/14 14:46:30.750 kid1| 33,3| /client_side.cc(4154) 
</I>&gt;<i> unpinConnection: local=192.168.41.35:47842 remote=172.217.13.206:443 FD 
</I>&gt;<i> 13 flags=1
</I>&gt;<i> 2024/06/14 14:46:30.750 kid1| 33,5| src/base/AsyncCall.cc(54) cancel: 
</I>&gt;<i> will not call ConnStateData::clientPinnedConnectionClosed [call63] 
</I>&gt;<i> because comm_remove_close_handler
</I>&gt;<i> 2024/06/14 14:46:30.750 kid1| 33,3| src/base/AsyncCall.cc(54) cancel: 
</I>&gt;<i> will not call ConnStateData::clientPinnedConnectionRead [call64] because 
</I>&gt;<i> comm_read_cancel
</I>&gt;<i> 2024/06/14 14:46:30.750 kid1| 33,3| src/base/AsyncCall.cc(54) cancel: 
</I>&gt;<i> will not call ConnStateData::clientPinnedConnectionRead [call64] also 
</I>&gt;<i> because comm_read_cancel
</I>&gt;<i> 2024/06/14 14:46:30.750 kid1| 44,3| /peer_select.cc(978) 
</I>&gt;<i> peerAddFwdServer: adding HIER_DIRECT#127.0.0.1
</I>&gt;<i> 2024/06/14 14:46:30.750 kid1| 44,2| /peer_select.cc(295) 
</I>&gt;<i> peerSelectDnsPaths: Find IP destination for: 
</I>&gt;<i> <A HREF="http://127.0.0.1:8081/?cat=&amp;cat_all=&amp;action=URLLIST&amp;srv=&amp;url=https%3a%2f%2fyoutube%2ecom%2f&amp;shortener=">http://127.0.0.1:8081/?cat=&amp;cat_all=&amp;action=URLLIST&amp;srv=&amp;url=https%3a%2f%2fyoutube%2ecom%2f&amp;shortener=</A>' via 127.0.0.1
</I>&gt;<i> 2024/06/14 14:46:30.750 kid1| 44,2| /peer_select.cc(316) 
</I>&gt;<i> peerSelectDnsPaths: Found sources for 
</I>&gt;<i> '<A HREF="http://127.0.0.1:8081/?cat=&amp;cat_all=&amp;action=URLLIST&amp;srv=&amp;url=https%3a%2f%2fyoutube%2ecom%2f&amp;shortener=">http://127.0.0.1:8081/?cat=&amp;cat_all=&amp;action=URLLIST&amp;srv=&amp;url=https%3a%2f%2fyoutube%2ecom%2f&amp;shortener=</A>'
</I>&gt;<i> 2024/06/14 14:46:30.750 kid1| 44,2| /peer_select.cc(317) 
</I>&gt;<i> peerSelectDnsPaths:&#160;&#160; always_direct = ALLOWED
</I>&gt;<i> 2024/06/14 14:46:30.750 kid1| 44,2| /peer_select.cc(318) 
</I>&gt;<i> peerSelectDnsPaths:&#160;&#160;&#160; never_direct = DENIED
</I>&gt;<i> 2024/06/14 14:46:30.750 kid1| 44,2| /peer_select.cc(322) 
</I>&gt;<i> peerSelectDnsPaths:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; DIRECT = local=0.0.0.0 
</I>&gt;<i> remote=127.0.0.1:8081 flags=1
</I>&gt;<i> 2024/06/14 14:46:30.750 kid1| 44,2| /peer_select.cc(331) 
</I>&gt;<i> peerSelectDnsPaths:&#160;&#160;&#160;&#160;&#160;&#160;&#160; timedout = 0
</I>&gt;<i> 2024/06/14 14:46:30.750 kid1| 17,3| /FwdState.cc(418) 
</I>&gt;<i> startConnectionOrFail: 
</I>&gt;<i> <A HREF="http://127.0.0.1:8081/?cat=&amp;cat_all=&amp;action=URLLIST&amp;srv=&amp;url=https%3a%2f%2fyoutube%2ecom%2f&amp;shortener=">http://127.0.0.1:8081/?cat=&amp;cat_all=&amp;action=URLLIST&amp;srv=&amp;url=https%3a%2f%2fyoutube%2ecom%2f&amp;shortener=</A>
</I>&gt;<i> 2024/06/14 14:46:30.750 kid1| 17,3| /FwdState.cc(832) connectStart: 
</I>&gt;<i> fwdConnectStart: 
</I>&gt;<i> <A HREF="http://127.0.0.1:8081/?cat=&amp;cat_all=&amp;action=URLLIST&amp;srv=&amp;url=https%3a%2f%2fyoutube%2ecom%2f&amp;shortener=">http://127.0.0.1:8081/?cat=&amp;cat_all=&amp;action=URLLIST&amp;srv=&amp;url=https%3a%2f%2fyoutube%2ecom%2f&amp;shortener=</A>
</I>&gt;<i> 2024/06/14 14:46:30.750 kid1| 17,3| src/base/AsyncCall.cc(25) AsyncCall: 
</I>&gt;<i> The AsyncCall fwdConnectDoneWrapper constructed, this=0x559ad7e16a00 
</I>&gt;<i> [call81]
</I>&gt;<i> 2024/06/14 14:46:30.750 kid1| 44,3| /peer_select.cc(103) ~ps_state: 
</I>&gt;<i> <A HREF="http://127.0.0.1:8081/?cat=&amp;cat_all=&amp;action=URLLIST&amp;srv=&amp;url=https%3a%2f%2fyoutube%2ecom%2f&amp;shortener=">http://127.0.0.1:8081/?cat=&amp;cat_all=&amp;action=URLLIST&amp;srv=&amp;url=https%3a%2f%2fyoutube%2ecom%2f&amp;shortener=</A>
</I>&gt;<i> 2024/06/14 14:46:30.750 kid1| 17,3| src/base/AsyncCall.cc(92) 
</I>&gt;<i> ScheduleCall: ../../../squid-4.16/src/comm/ConnOpener.cc(139) will call 
</I>&gt;<i> fwdConnectDoneWrapper(local=127.0.0.1:45660 remote=127.0.0.1:8081 FD 13 
</I>&gt;<i> flags=1, data=0x559ad7e89b88) [call81]
</I>&gt;<i> 2024/06/14 14:46:30.750 kid1| 17,3| src/base/AsyncCallQueue.cc(55) 
</I>&gt;<i> fireNext: entering fwdConnectDoneWrapper(local=127.0.0.1:45660 
</I>&gt;<i> remote=127.0.0.1:8081 FD 13 flags=1, data=0x559ad7e89b88)
</I>&gt;<i> 2024/06/14 14:46:30.750 kid1| 17,3| src/base/AsyncCall.cc(37) make: make 
</I>&gt;<i> call fwdConnectDoneWrapper [call81]
</I>&gt;<i> 2024/06/14 14:46:30.750 kid1| 17,3| /FwdState.cc(706) connectDone: 
</I>&gt;<i> local=127.0.0.1:45660 remote=127.0.0.1:8081 FD 13 flags=1: 
</I>&gt;<i> '<A HREF="http://127.0.0.1:8081/?cat=&amp;cat_all=&amp;action=URLLIST&amp;srv=&amp;url=https%3a%2f%2fyoutube%2ecom%2f&amp;shortener=">http://127.0.0.1:8081/?cat=&amp;cat_all=&amp;action=URLLIST&amp;srv=&amp;url=https%3a%2f%2fyoutube%2ecom%2f&amp;shortener=</A>'
</I>&gt;<i> 
</I>&gt;<i> log excerpt for the same setup from squid-v6.9 (Squid reporting 
</I>&gt;<i> ERR_CANNOT_FORWARD)
</I>&gt;<i> 
</I>&gt;<i> 024/06/14 14:59:40.463 kid1| 61,5| /redirect.cc(83) redirectHandleReply: 
</I>&gt;<i> reply={result=OK, notes={rewrite-url: 
</I>&gt;<i> <A HREF="http://127.0.0.1:8081/?cat=&amp;cat_all=&amp;action=URLLIST&amp;srv=&amp;url=https%3a%2f%2fyoutube%2ecom%2f&amp;shortener=;">http://127.0.0.1:8081/?cat=&amp;cat_all=&amp;action=URLLIST&amp;srv=&amp;url=https%3a%2f%2fyoutube%2ecom%2f&amp;shortener=;</A> cf-info: DENIED,proxy%2dnet%5cnoyoutub
</I>&gt;<i> 2024/06/14 14:59:40.463 kid1| 61,2| /client_side_request.cc(1236) 
</I>&gt;<i> clientRedirectDone: URL-rewriter diverts URL from <A HREF="https://youtube.com/">https://youtube.com/</A> 
</I>&gt;<i> to 
</I>&gt;<i> <A HREF="http://127.0.0.1:8081/?cat=&amp;cat_all=&amp;action=URLLIST&amp;srv=&amp;url=https%3a%2f%2fyoutube%2ecom%2f&amp;shortener=">http://127.0.0.1:8081/?cat=&amp;cat_all=&amp;action=URLLIST&amp;srv=&amp;url=https%3a%2f%2fyoutube%2ecom%2f&amp;shortener=</A>
</I>&gt;<i> 2024/06/14 14:59:40.463 kid1| 33,5| /store_client.cc(374) doCopy: 
</I>&gt;<i> 0x55a9d80fc678 into ioBuf(@0, len=4096, 0x55a9d8127770) hi: 0 objectLen: 
</I>&gt;<i> -1 past_answers: 0
</I>&gt;<i> 2024/06/14 14:59:40.463 kid1| 17,3| /FwdState.cc(373) Start: 
</I>&gt;<i> '<A HREF="http://127.0.0.1:8081/?cat=&amp;cat_all=&amp;action=URLLIST&amp;srv=&amp;url=https%3a%2f%2fyoutube%2ecom%2f&amp;shortener=">http://127.0.0.1:8081/?cat=&amp;cat_all=&amp;action=URLLIST&amp;srv=&amp;url=https%3a%2f%2fyoutube%2ecom%2f&amp;shortener=</A>'
</I>&gt;<i> 2024/06/14 14:59:40.463 kid1| 17,2| /FwdState.cc(133) FwdState: 
</I>&gt;<i> Forwarding client request conn19 local=172.217.13.206:443 
</I>&gt;<i> remote=192.168.180.10:55036 FD 11 flags=33, 
</I>&gt;<i> url=<A HREF="http://127.0.0.1:8081/?cat=&amp;cat_all=&amp;action=URLLIST&amp;srv=&amp;url=https%3a%2f%2fyoutube%2">http://127.0.0.1:8081/?cat=&amp;cat_all=&amp;action=URLLIST&amp;srv=&amp;url=https%3a%2f%2fyoutube%2</A>
</I>&gt;<i> 2024/06/14 14:59:40.463 kid1| 17,3| /FwdState.cc(140) FwdState: FwdState 
</I>&gt;<i> constructed, this=0x55a9d812ceb8
</I>&gt;<i> 2024/06/14 14:59:40.463 kid1| 17,4| src/base/AsyncCall.cc(29) AsyncCall: 
</I>&gt;<i> The AsyncCall FwdState::Abort constructed, this=0x55a9d80fc790 [call90]
</I>&gt;<i> 2024/06/14 14:59:40.463 kid1| 44,3| /peer_select.cc(309) peerSelect: 
</I>&gt;<i> e:=XIV/0x55a9d80fc5f0*3 
</I>&gt;<i> <A HREF="http://127.0.0.1:8081/?cat=&amp;cat_all=&amp;action=URLLIST&amp;srv=&amp;url=https%3a%2f%2fyoutube%2ecom%2f&amp;shortener=">http://127.0.0.1:8081/?cat=&amp;cat_all=&amp;action=URLLIST&amp;srv=&amp;url=https%3a%2f%2fyoutube%2ecom%2f&amp;shortener=</A>
</I>&gt;<i> 2024/06/14 14:59:40.463 kid1| 44,3| /peer_select.cc(612) selectMore: GET 
</I>&gt;<i> 127.0.0.1
</I>&gt;<i> 2024/06/14 14:59:40.463 kid1| 44,3| /peer_select.cc(617) selectMore: 
</I>&gt;<i> direct = DIRECT_UNKNOWN (always_direct to be checked)
</I>&gt;<i> 2024/06/14 14:59:40.463 kid1| 44,3| /peer_select.cc(373) 
</I>&gt;<i> checkAlwaysDirectDone: ALLOWED
</I>&gt;<i> 2024/06/14 14:59:40.463 kid1| 44,3| /peer_select.cc(379) 
</I>&gt;<i> checkAlwaysDirectDone: direct = DIRECT_YES (always_direct allow)
</I>&gt;<i> 2024/06/14 14:59:40.463 kid1| 44,3| /peer_select.cc(612) selectMore: GET 
</I>&gt;<i> 127.0.0.1
</I>&gt;<i> 2024/06/14 14:59:40.463 kid1| 44,3| /peer_select.cc(1102) addSelection: 
</I>&gt;<i> adding PINNED#127.0.0.1
</I>&gt;<i> 2024/06/14 14:59:40.463 kid1| 44,3| /peer_select.cc(1102) addSelection: 
</I>&gt;<i> adding HIER_DIRECT#127.0.0.1
</I>&gt;<i> 2024/06/14 14:59:40.463 kid1| 44,2| /peer_select.cc(1176) handlePath: 
</I>&gt;<i> PeerSelector2 found pinned, destination #1 for 
</I>&gt;<i> <A HREF="http://127.0.0.1:8081/?cat=&amp;cat_all=&amp;action=URLLIST&amp;srv=&amp;url=https%3a%2f%2fyoutube%2ecom%2f&amp;shortener=">http://127.0.0.1:8081/?cat=&amp;cat_all=&amp;action=URLLIST&amp;srv=&amp;url=https%3a%2f%2fyoutube%2ecom%2f&amp;shortener=</A>
</I>&gt;<i> 2024/06/14 14:59:40.463 kid1| 44,2| /peer_select.cc(1180) handlePath:  
</I>&gt;<i>  &#160;always_direct = ALLOWED
</I>&gt;<i> 2024/06/14 14:59:40.463 kid1| 44,2| /peer_select.cc(1181) handlePath:    
</I>&gt;<i> never_direct = DENIED
</I>&gt;<i> 2024/06/14 14:59:40.463 kid1| 44,2| /peer_select.cc(1182) handlePath:  
</I>&gt;<i>  &#160;&#160;&#160;&#160;&#160; timedout = 0
</I>&gt;<i> 2024/06/14 14:59:40.463 kid1| 33,7| /client_side.cc(3954) 
</I>&gt;<i> borrowPinnedConnection: conn30 local=192.168.41.35:50322 
</I>&gt;<i> remote=172.217.13.206:443 ORIGINAL_DST FD 13 flags=1
</I>&gt;<i> 2024/06/14 14:59:40.463 kid1| 33,3| /client_side.cc(3997) 
</I>&gt;<i> unpinConnection: conn30 local=192.168.41.35:50322 
</I>&gt;<i> remote=172.217.13.206:443 ORIGINAL_DST FD 13 flags=1
</I>&gt;<i> 2024/06/14 14:59:40.463 kid1| 33,5| src/base/AsyncCall.cc(58) cancel: 
</I>&gt;<i> will not call ConnStateData::clientPinnedConnectionClosed [call73] 
</I>&gt;<i> because comm_remove_close_handler
</I>&gt;<i> 2024/06/14 14:59:40.463 kid1| 33,3| src/base/AsyncCall.cc(58) cancel: 
</I>&gt;<i> will not call ConnStateData::clientPinnedConnectionRead [call74] because 
</I>&gt;<i> comm_read_cancel
</I>&gt;<i> 2024/06/14 14:59:40.463 kid1| 33,3| src/base/AsyncCall.cc(58) cancel: 
</I>&gt;<i> will not call ConnStateData::clientPinnedConnectionRead [call74] also 
</I>&gt;<i> because comm_read_cancel
</I>&gt;<i> 2024/06/14 14:59:40.465 kid1| 17,3| /FwdState.cc(471) fail: 
</I>&gt;<i> ERR_CANNOT_FORWARD &quot;Service Unavailable&quot;
</I>&gt;<i>          
</I>&gt;<i> <A HREF="http://127.0.0.1:8081/?cat=&amp;cat_all=&amp;action=URLLIST&amp;srv=&amp;url=https%3a%2f%2fyoutube%2ecom%2f&amp;shortener=">http://127.0.0.1:8081/?cat=&amp;cat_all=&amp;action=URLLIST&amp;srv=&amp;url=https%3a%2f%2fyoutube%2ecom%2f&amp;shortener=</A>
</I>&gt;<i> 2024/06/14 14:59:40.465 kid1| 17,3| /FwdState.cc(185) stopAndDestroy: 
</I>&gt;<i> for pinned connection failure
</I>&gt;<i> 2024/06/14 14:59:40.465 kid1| 44,3| /peer_select.cc(1149) 
</I>&gt;<i> interestedInitiator: PeerSelector2 initiator lost interest
</I>&gt;<i> 2024/06/14 14:59:40.465 kid1| 44,3| /peer_select.cc(405) 
</I>&gt;<i> selectionAborted: Aborting peer selection: Initiator gone or lost interest.
</I>&gt;<i> 2024/06/14 14:59:40.465 kid1| 44,3| /peer_select.cc(241) ~PeerSelector: 
</I>&gt;<i> <A HREF="http://127.0.0.1:8081/?cat=&amp;cat_all=&amp;action=URLLIST&amp;srv=&amp;url=https%3a%2f%2fyoutube%2ecom%2f&amp;shortener=">http://127.0.0.1:8081/?cat=&amp;cat_all=&amp;action=URLLIST&amp;srv=&amp;url=https%3a%2f%2fyoutube%2ecom%2f&amp;shortener=</A>
</I>&gt;<i> 2024/06/14 14:59:40.465 kid1| 17,3| /FwdState.cc(310) ~FwdState: 
</I>&gt;<i> FwdState destructor start
</I>&gt;<i> 2024/06/14 14:59:40.466 kid1| 33,5| /store_client.cc(374) doCopy: 
</I>&gt;<i> 0x55a9d80fc678 into ioBuf(@0, len=4096, 0x55a9d8127770) hi: 148495 
</I>&gt;<i> objectLen: -1 past_answers: 0
</I>&gt;<i> 2024/06/14 14:59:40.466 kid1| 33,5| /store_client.cc(422) doCopy: just 
</I>&gt;<i> send HTTP headers: 207
</I>&gt;<i> 2024/06/14 14:59:40.466 kid1| 17,4| src/base/AsyncCall.cc(58) cancel: 
</I>&gt;<i> will not call FwdState::Abort [call90] because FwdState object destructed
</I>&gt;<i> 2024/06/14 14:59:40.466 kid1| 17,3| /FwdState.cc(332) ~FwdState: 
</I>&gt;<i> FwdState destructed, this=0x55a9d812ceb8
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="026772.html">[squid-users] url_rewrite (with rewrite-url): PinnedConnection failure results in total failure
</A></li>
	<LI>Next message (by thread): <A HREF="026776.html">[squid-users] Requesting Help to debug my squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26773">[ date ]</a>
              <a href="thread.html#26773">[ thread ]</a>
              <a href="subject.html#26773">[ subject ]</a>
              <a href="author.html#26773">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
