<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] ACL / http_access rules stop work using Squid 6+
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ACL%20/%20http_access%20rules%20stop%20work%20using%20Squid%206%2B&In-Reply-To=%3C8ff19597-56d6-4214-9c59-14eb4b5a7bfe%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026530.html">
   <LINK REL="Next"  HREF="026536.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] ACL / http_access rules stop work using Squid 6+</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ACL%20/%20http_access%20rules%20stop%20work%20using%20Squid%206%2B&In-Reply-To=%3C8ff19597-56d6-4214-9c59-14eb4b5a7bfe%40measurement-factory.com%3E"
       TITLE="[squid-users] ACL / http_access rules stop work using Squid 6+">rousskov at measurement-factory.com
       </A><BR>
    <I>Mon Mar 25 18:25:49 UTC 2024</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="026530.html">[squid-users] ACL / http_access rules stop work using Squid 6+
</A></li>
        <LI>Next message (by thread): <A HREF="026536.html">[squid-users] ACL / http_access rules stop work using Squid 6+
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26535">[ date ]</a>
              <a href="thread.html#26535">[ thread ]</a>
              <a href="subject.html#26535">[ subject ]</a>
              <a href="author.html#26535">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2024-03-22 09:38, Andre Bolinhas wrote:

&gt;<i> In previous versions of squid, from 3 to 5.9, I use this kind of deny 
</I>&gt;<i> rules and they work like charm
</I>&gt;<i> 
</I>&gt;<i> acl AnnotateRule28 annotate_transaction accessrule=Rule28
</I>&gt;<i> http_access deny HTTP Group38 AnnotateRule28
</I>&gt;<i> 
</I>&gt;<i> This allows me to deny objects without bump / show the error page 
</I>&gt;<i> (deny_info)
</I>&gt;<i> 
</I>&gt;<i> But using squid 6+ this rules stop to work and everything is allowed.
</I>&gt;<i> 
</I>&gt;<i> Example:
</I>&gt;<i> Squid 5.9 (OK)
</I>&gt;<i> <A HREF="https://ibb.co/YdKgL1Y">https://ibb.co/YdKgL1Y</A>
</I>&gt;<i> 
</I>&gt;<i> Squid 6.8 (NOK)
</I>&gt;<i> <A HREF="https://ibb.co/tbyY2GV">https://ibb.co/tbyY2GV</A>
</I>&gt;<i> 
</I>&gt;<i> Sample of both cache.log in debug mode
</I>&gt;<i> 
</I>&gt;<i> <A HREF="https://we.tl/t-T7Nz1rVbVu">https://we.tl/t-T7Nz1rVbVu</A>
</I>

In you v6 logs, most logged transactions are allowed because a rule 
similar to the one reconstructed below is matching:

     http_access allow all AnnotateFinalAllow


There are similar cases in v5 logs as well, but most denied v5 
transactions match the following rule instead (i.e. the one you shared 
above):

     http_access deny HTTP Group38 AnnotateRule28


In your Squid configuration, v6 allow rule is listed much higher than v5 
deny rule (#43 vs #149). I do not see any signs of Group38 or 
AnnotateRule28 ACL evaluation in v6 logs, as if the rule sets are 
different for two different Squid instances. Are you using the same set 
of http_access rules for both Squid versions?

Alex.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="026530.html">[squid-users] ACL / http_access rules stop work using Squid 6+
</A></li>
	<LI>Next message (by thread): <A HREF="026536.html">[squid-users] ACL / http_access rules stop work using Squid 6+
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26535">[ date ]</a>
              <a href="thread.html#26535">[ thread ]</a>
              <a href="subject.html#26535">[ subject ]</a>
              <a href="author.html#26535">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
