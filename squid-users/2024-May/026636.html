<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid TCP_TUNNEL_ABORTED/200
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20TCP_TUNNEL_ABORTED/200&In-Reply-To=%3CCADG8LiXv1ZsY_KyhxOCgfj0oFT0A4oFZsm89uZHk8OAnUKF%2B0g%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026635.html">
   <LINK REL="Next"  HREF="026637.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid TCP_TUNNEL_ABORTED/200</H1>
    <B>Emre Oksum</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20TCP_TUNNEL_ABORTED/200&In-Reply-To=%3CCADG8LiXv1ZsY_KyhxOCgfj0oFT0A4oFZsm89uZHk8OAnUKF%2B0g%40mail.gmail.com%3E"
       TITLE="[squid-users] Squid TCP_TUNNEL_ABORTED/200">emreoksum at gmail.com
       </A><BR>
    <I>Fri May  3 14:29:11 UTC 2024</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="026635.html">[squid-users] Error during ICAP RESPMOD
</A></li>
        <LI>Next message (by thread): <A HREF="026637.html">[squid-users] Squid TCP_TUNNEL_ABORTED/200
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26636">[ date ]</a>
              <a href="thread.html#26636">[ thread ]</a>
              <a href="subject.html#26636">[ subject ]</a>
              <a href="author.html#26636">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE> Hi everyone,

I'm having a issue with Squid Cache 4.10 which I cannot fix for weeks now
and kinda lost at the moment. I will be appreciated if someone can guide me
through the issue I'm having.
I need to create a IPv6 HTTP proxy which should match the entry address to
outgoing TCP address. For example, if user is connecting from fe80:abcd::1
it should exit the HTTP proxy from the same address. We got like 50k
addresses like this at the moment.
The issue is, client connecting to the proxy is receiving &quot;EOF&quot; or
&quot;FLOW_CONTROL_ERROR&quot; on their side. When I test connection by connecting to
whatismyip.com everything works fine and entry IP always matches with
outgoing IP for each of the 50k addresses. Client tells me this problem
occurs both at GET and POST requests with around 10 MB of data.
I initially thought that could be related to server resources being drained
but upon inspecting server resource usage, Squid isn't even topping at 100%
CPU or RAM anytime so not that.

My Squid.conf is like this at the moment:

auth_param basic program /usr/lib/squid/basic_ncsa_auth /etc/squid/passwd
acl auth_users proxy_auth REQUIRED
http_access allow auth_users
http_access deny !auth_users
cache deny all
dns_nameservers &lt;nameservers here&gt;
dns_v4_first off
via off
forwarded_for delete
follow_x_forwarded_for deny all
server_persistent_connections off
max_filedesc 1048576
max_filedescriptors 1048576
workers 8
http_port [::0]:1182
acl binding1 myip  fe80:abcd::1
tcp_outgoing_address  fe80:abcd::1 binding1
acl binding2 myip  fe80:abcd::2
tcp_outgoing_address  fe80:abcd::2 binding2
acl binding3 myip  fe80:abcd::3
tcp_outgoing_address  fe80:abcd::3 binding3
...
...
...
access_log /var/log/squid/access.log squid
cache_store_log none
cache deny all

I've tried to get a PCAP file and realized when client tries to connect
with a new IPv6 address, Squid is not trying to open a new connection
instead tries to resume a previously opened one on a different outgoing
IPv6 address. I set server_persistent_connections off which should have
disabled this behavior but it's still the same. I tried using a newer
version of Squid but it behaved differently and did not follow my outgoing
address specifications and kept connecting on IPv4.

I would be appreciated if someone can help me out here.
Thank you.
Emre
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20240503/1c293605/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20240503/1c293605/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="026635.html">[squid-users] Error during ICAP RESPMOD
</A></li>
	<LI>Next message (by thread): <A HREF="026637.html">[squid-users] Squid TCP_TUNNEL_ABORTED/200
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26636">[ date ]</a>
              <a href="thread.html#26636">[ thread ]</a>
              <a href="subject.html#26636">[ subject ]</a>
              <a href="author.html#26636">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
