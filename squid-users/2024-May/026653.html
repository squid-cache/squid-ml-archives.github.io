<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Linux Noob - Squid Config
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Linux%20Noob%20-%20Squid%20Config&In-Reply-To=%3Cf65b1994-c8a5-4249-931c-8383dc488787%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026651.html">
   <LINK REL="Next"  HREF="026649.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Linux Noob - Squid Config</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Linux%20Noob%20-%20Squid%20Config&In-Reply-To=%3Cf65b1994-c8a5-4249-931c-8383dc488787%40treenet.co.nz%3E"
       TITLE="[squid-users] Linux Noob - Squid Config">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue May  7 17:59:57 UTC 2024</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="026651.html">[squid-users] Linux Noob - Squid Config
</A></li>
        <LI>Next message (by thread): <A HREF="026649.html">[squid-users] Dynamic ACL with local auth
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26653">[ date ]</a>
              <a href="thread.html#26653">[ thread ]</a>
              <a href="subject.html#26653">[ subject ]</a>
              <a href="author.html#26653">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 7/05/24 07:59, Piana, Josh wrote:
&gt;<i> Amos,
</I>&gt;<i> 
</I>&gt;<i> You raise a good point about Kerberos! I was not aware that Squid supported this method. Yes - I think we would preferably use this method, especially because this looks like it's much easier to setup and still checks all the boxes we need for security purposes.
</I>&gt;<i> 
</I>&gt;<i> With that being said, without using NTLM, can we bypass using Samba? We would rather not rely on that resource if possible.
</I>&gt;<i> 
</I>
I'm not sure how much of Samba need to be setup to use the NTLM helper. 
It has been a while since I used it.


&gt;<i> In regards to your responses to all of the lines of code, I'll be going through that seperately and will get back to you if I have any more questions with it. After installing Squid, moving over and updating the old config, and adjusting the parameters you mentioned below, what else is there to do to finish setting up this server? I'm not entirely sure if Apache is needed anymore either. This would simplify and modernize our processes a great deal if this can be remopved as well.
</I>&gt;<i> 
</I>
There is no sign in the squid.conf as to what Apache was being used for.
So that and any other services the old machine had going will still need 
your attention, but they are not related to Squid.


Cheers
Amos


&gt;<i> - Josh
</I>&gt;<i> 
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; On Behalf Of Amos Jeffries
</I>&gt;<i> Sent: Monday, May 6, 2024 12:59 PM
</I>&gt;<i> To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> Subject: Re: [squid-users] Linux Noob - Squid Config
</I>&gt;<i> 
</I>&gt;<i> Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> [ please keep responses on-list to assist any others who encounter the same issues in future ]
</I>&gt;<i> 
</I>&gt;<i> On 4/05/24 08:51, Piana, Josh wrote:
</I>&gt;&gt;<i> Hey Amos,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thank you so much for getting back to me so quickly!
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> To answer your question about NTLM, I meant to say NTLMv2. We're trying to become compliant with newer security standards and this old box in depersate need of some love and updating.
</I>&gt;&gt;<i>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Hmm. My question was more aiming as a yes/no answer.
</I>&gt;<i> 
</I>&gt;<i> Squid can certainly still support NTLM. But if possible going to just Negotiate/Kerberos auth would be a simpler config.
</I>&gt;<i> 
</I>&gt;<i> The /usr/bin/ntlm_auth authenticator you have been using is provided by Samba. So you will need to have Samba installed (yum install samba) and configured the same (or equivalent for its upgrade) as before Squid authentication is usable.
</I>&gt;<i> 
</I>&gt;<i> FYI; Modern Squid start helpers only as-needed. Meaning Squid will startup and run fine without a working auth helper ... until the point where a helper lookup is needed. So you can test Squid with some trivial requests before needing Samba fully working.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> --------------------------------------------------------------
</I>&gt;&gt;<i> Current squid.conf file Output:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> max_filedesc 4096
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> I advise changing this to at least:
</I>&gt;<i> 
</I>&gt;<i>     max_filedescriptors 65536
</I>&gt;<i> 
</I>&gt;<i> Why? Modern web pages can cause clients to open up to a hundred connections to various servers to display a single web page. Each client of those connection consumes 3-4 file descriptors.
</I>&gt;<i> 
</I>&gt;<i> You will also need to check the OS limitation to ensure
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> cache_mgr <A HREF="https://lists.squid-cache.org/listinfo/squid-users">itadmin at ...</A>
</I>&gt;&gt;<i> cache_effective_user squid
</I>&gt;&gt;<i> cache_effective_group squid
</I>&gt;&gt;<i> coredump_dir /opt/squid/var
</I>&gt;&gt;<i> pid_filename /var/run/squid.pid
</I>&gt;&gt;<i> shutdown_lifetime 5 seconds
</I>&gt;&gt;<i> error_directory /usr/local/share/squid/errors/English_CUSTOM
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Check what customizations have been done to the files inside that directory.
</I>&gt;<i> 
</I>&gt;<i> If it is just the new templates for the deny_info lines later in your config; then you can copy those templates to the new machine.
</I>&gt;<i> And create symlnks from the
</I>&gt;<i> 
</I>&gt;<i> I suggest placing the custom error templates in a directory such as /etc/squid/errors/ and a symlink from the /usr/local/share/squid/errors/templates/ directory (or wherever the templates are put by yum install).
</I>&gt;<i>    [ This way upgrades that change the default templates will not erase your ones. At worst you should only have to re-create the symlinks manually. ]
</I>&gt;<i> 
</I>&gt;<i> (If you need it; to learn how to create symlinks type &quot;man ln&quot;.)
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> logfile_rotate 0
</I>&gt;&gt;<i> debug_options ALL,1
</I>&gt;<i> 
</I>&gt;<i> You can remove the above line. It is a default setting.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> buffered_logs on &gt; cache_log /var/log/squid/general&gt; cache_access_log
</I>&gt;&gt;<i> /var/log/squid/access
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> The above two lines should be more like:
</I>&gt;<i> 
</I>&gt;<i>     cache_log /var/log/squid/cache.log
</I>&gt;<i>     access_log daemon:/var/log/squid/access.log
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> cache_store_log none
</I>&gt;&gt;<i> log_mime_hdrs off
</I>&gt;<i> 
</I>&gt;<i> The above two lines can be removed. They are default settings.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> log_fqdn off
</I>&gt;<i> 
</I>&gt;<i> Remove this line. It is not supported in modern Squid.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> strip_query_terms off
</I>&gt;&gt;<i> http_port 10.46.11.20:8080
</I>&gt;&gt;<i> http_port 127.0.0.1:3128
</I>&gt;&gt;<i> icp_port 0
</I>&gt;<i> 
</I>&gt;<i> The above line can be removed. It is a default setting.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> forwarded_for off
</I>&gt;<i> 
</I>&gt;<i> Change that &quot;off&quot; to;
</I>&gt;<i>    * &quot;delete&quot; for complete removal of the header), or
</I>&gt;<i>    * &quot;transparent&quot; for Squid to not add the header.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> ftp_user <A HREF="https://lists.squid-cache.org/listinfo/squid-users">anonftpuser at ...</A>
</I>&gt;&gt;<i> ftp_list_width 32
</I>&gt;&gt;<i> ftp_passive on
</I>&gt;&gt;<i> connect_timeout 30 seconds
</I>&gt;&gt;<i> peer_connect_timeout 20 seconds
</I>&gt;&gt;<i> read_timeout 2 minutes
</I>&gt;&gt;<i> request_timeout 2 minutes
</I>&gt;&gt;<i> persistent_request_timeout 30 seconds
</I>&gt;&gt;<i> cache_dir ufs /var/cache/squid/ufs/squid 16000 64 64
</I>&gt;&gt;<i> cache_replacement_policy heap LFUDA memory_replacement_policy lru
</I>&gt;&gt;<i> cache_mem 200 MB maximum_object_size 32 MB
</I>&gt;&gt;<i> maximum_object_size_in_memory 128 KB quick_abort_min 16 KB
</I>&gt;&gt;<i> quick_abort_max 1 MB quick_abort_pct 90 range_offset_limit 64 KB acl
</I>&gt;&gt;<i> no_cache_url url_regex -i &quot;/etc/squid/no_cache_url&quot;
</I>&gt;&gt;<i> cache deny no_cache_url
</I>&gt;<i> 
</I>&gt;<i> Modern Squid define a set of &quot;refresh_pattern&quot; to fixup messages cacheability inline with HTTP/1.1 caching requirements.
</I>&gt;<i> 
</I>&gt;<i> Please add these lines:
</I>&gt;<i> 
</I>&gt;<i> refresh_pattern ^ftp:           1440    20%     10080
</I>&gt;<i> refresh_pattern ^gopher:        1440    0%      1440
</I>&gt;<i> refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
</I>&gt;<i> refresh_pattern .               0       20%     4320
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> acl blows_chunks dstdomain .blr.com
</I>&gt;&gt;<i> header_access Accept-Encoding deny blows_chunks
</I>&gt;<i> 
</I>&gt;<i> This is something to look into. Be aware of how exactly that server is broken when it receives &quot;Accept-Encoding&quot; headers.
</I>&gt;<i> 
</I>&gt;<i> The old Squid only supported HTTP/1.0. Your new Squid supports HTTP/1.1 which may work better with whatever that server was doing to be considered bad.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> auth_param ntlm program /usr/bin/ntlm_auth
</I>&gt;&gt;<i> --helper-protocol=squid-2.5-ntlmssp
</I>&gt;&gt;<i> auth_param ntlm children 30
</I>&gt;&gt;<i> auth_param ntlm keep_alive on
</I>&gt;&gt;<i> auth_param basic program /usr/bin/ntlm_auth
</I>&gt;&gt;<i> --helper-protocol=squid-2.5-basic auth_param basic children 5
</I>&gt;&gt;<i> auth_param basic realm &quot;...&quot;
</I>&gt;&gt;<i> auth_param basic credentialsttl 2 hours acl authenticated proxy_auth
</I>&gt;&gt;<i> REQUIRED acl all src 0.0.0.0/0.0.0.0
</I>&gt;<i> 
</I>&gt;<i> Remove the above line. The &quot;all&quot; ACL is now built-in.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> acl src_self src 127.0.0.0/255.0.0.0
</I>&gt;&gt;<i> acl src_self src 10.46.11.20
</I>&gt;<i> 
</I>&gt;<i> Modern Squid provide these as a built-in &quot;localhost&quot; ACL.
</I>&gt;<i> 
</I>&gt;<i> To add the machines global IP address as part of localhost, replace the above two lines with:
</I>&gt;<i>     acl localhost src 10.46.11.20/32
</I>&gt;<i> 
</I>&gt;<i> Then replace all uses of &quot;src_self&quot; with &quot;localhost&quot;.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> acl dst_self dst 127.0.0.0/255.0.0.0
</I>&gt;&gt;<i> acl dst_self dst 10.46.11.20
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Modern Squid provide these as a built-in &quot;to_localhost&quot; ACL.
</I>&gt;<i> 
</I>&gt;<i> To add the machines global IP address as part of localhost, replace the above two lines with:
</I>&gt;<i>     acl to_localhost dst 10.46.11.20/32
</I>&gt;<i> 
</I>&gt;<i> Then replace all uses of &quot;dst_self&quot; with &quot;to_localhost&quot;.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> acl from_arc src 10.0.0.0/255.255.0.0
</I>&gt;&gt;<i> acl from_arc src 10.46.0.0/255.254.0.0 acl local_dst_addr dst
</I>&gt;&gt;<i> 10.0.0.0/255.0.0.0
</I>&gt;<i> 
</I>&gt;<i> FYI; while the above is acceptible to Squid. Prefer writing those as CIDR masks instead of NetMask syntax.
</I>&gt;<i> 
</I>&gt;<i>    eg.  10.0.0.0/8
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> acl local_dst_addr dst bldg3.*.com.
</I>&gt;&gt;<i> acl local_dst_addr dst bldg5.*.com.
</I>&gt;&gt;<i> acl local_dst_dom dstdomain arcgate
</I>&gt;<i> 
</I>&gt;<i> The above is not a domain name, nor wildcard domain.
</I>&gt;<i> 
</I>&gt;<i> FYI; Squid will attempt to apply a domain search using the &quot;domain&quot; or &quot;search&quot; as configured in /etc/resolv.conf and resolve arcgate.* in DNS.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> acl proto_FTP proto FTP
</I>&gt;&gt;<i> acl proto_HTTP proto HTTP
</I>&gt;&gt;<i> acl http_ports port 80
</I>&gt;&gt;<i> acl http_ports port 81
</I>&gt;&gt;<i> acl http_ports port 82
</I>&gt;&gt;<i> acl http_ports port 807
</I>&gt;&gt;<i> acl http_ports port 8000
</I>&gt;&gt;<i> acl http_ports port 8001
</I>&gt;&gt;<i> acl http_ports port 8080
</I>&gt;&gt;<i> acl http_ports port 8081
</I>&gt;&gt;<i> acl http_ports port 9000
</I>&gt;&gt;<i> acl ssl_ports port 443
</I>&gt;&gt;<i> acl ssl_ports port 818
</I>&gt;&gt;<i> acl ssl_ports port 4435
</I>&gt;&gt;<i> acl ssl_ports port 9571
</I>&gt;&gt;<i> acl ssl_ports port 9030
</I>&gt;&gt;<i> acl ssl_ports port 4502
</I>&gt;&gt;<i> acl ssl_ports port 8080
</I>&gt;&gt;<i> acl ssl_ports port 8081
</I>&gt;&gt;<i> acl ssh_ports port 22 1776 8217
</I>&gt;&gt;<i> acl ftp_ports port 21
</I>&gt;&gt;<i> acl method_CONNECT method CONNECT
</I>&gt;<i> 
</I>&gt;<i> The &quot;CONNECT&quot; ACL is provided as a built-in.
</I>&gt;<i> 
</I>&gt;<i> Replace all uses of &quot;method_CONNECT&quot; with just &quot;CONNECT&quot; and remove the above line.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> acl methods_std method GET HEAD POST PUT DELETE acl methods_std method
</I>&gt;&gt;<i> TRACE OPTIONS acl purge method PURGE http_access allow purge src_self
</I>&gt;&gt;<i> http_access deny purge
</I>&gt;<i> 
</I>&gt;<i> This purge is something to consider carefully. You should not need to ever use it on a properly working cache that obeys HTTP standard.
</I>&gt;<i> 
</I>&gt;<i> If possible prefer to remove the http_access and acl lines relating to the curstom &quot;PURGE&quot; method. This allows modern Squid to improve performance by not tracking a lot of things.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> acl cache_manager proto cache_object
</I>&gt;<i> 
</I>&gt;<i> The &quot;manager&quot; ACL is provided as built-in by modern Squids, and has a different definition for the latest access mechanism(s).
</I>&gt;<i> 
</I>&gt;<i> Replace all uses of &quot;cache_manager&quot; with &quot;manager&quot; and remove the above line.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> cachemgr_passwd disabled shutdown offline_toggle cachemgr_passwd none
</I>&gt;&gt;<i> all
</I>&gt;<i> 
</I>&gt;&gt;<i> http_access allow cache_manager src_self http_access deny
</I>&gt;&gt;<i> cache_manager
</I>&gt;<i> 
</I>&gt;<i> Per earlier change requests this should become:
</I>&gt;<i> 
</I>&gt;<i>    http_access allow manager localhost
</I>&gt;<i>    http_access deny manager
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> http_access deny dst_self
</I>&gt;&gt;<i> http_access deny src_self
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Per earlier change requests this should become:
</I>&gt;<i> 
</I>&gt;<i>    http_access deny localhost
</I>&gt;<i>    http_access deny to_localhost
</I>&gt;<i> 
</I>&gt;&gt;<i> http_access deny !from_arc
</I>&gt;<i> 
</I>&gt;&gt;<i> http_access       allow local_dst_dom
</I>&gt;&gt;<i> http_reply_access allow local_dst_dom
</I>&gt;<i> 
</I>&gt;&gt;<i> http_access       allow local_dst_addr
</I>&gt;&gt;<i> http_reply_access allow local_dst_addr
</I>&gt;<i> 
</I>&gt;&gt;<i> acl authless_src src &quot;/etc/squid/authless_src&quot;
</I>&gt;&gt;<i> http_access       allow authless_src
</I>&gt;&gt;<i> http_reply_access allow authless_src
</I>&gt;<i> 
</I>&gt;&gt;<i> acl authless_dst dstdomain &quot;/etc/squid/authless_dst&quot;
</I>&gt;&gt;<i> http_access       allow authless_dst
</I>&gt;&gt;<i> http_reply_access allow authless_dst
</I>&gt;<i> 
</I>&gt;&gt;<i> acl bad_domains_preauth dstdomain &quot;/etc/squid/bad_domains_preauth&quot;
</I>&gt;&gt;<i> http_access deny bad_domains_preauth
</I>&gt;<i> 
</I>&gt;&gt;<i> http_access deny !authenticated
</I>&gt;<i> 
</I>&gt;&gt;<i> acl block_user proxy_auth_regex -i &quot;/etc/squid/block_user&quot;
</I>&gt;&gt;<i> http_access deny block_user
</I>&gt;<i> 
</I>&gt;&gt;<i> acl bad_exception_urls url_regex -i &quot;/etc/squid/bad_exception_urls&quot;
</I>&gt;&gt;<i> acl exec_files url_regex -i &quot;/etc/squid/exec_files&quot;
</I>&gt;&gt;<i> acl exec_users proxy_auth_regex -i &quot;/etc/squid/exec_users&quot;
</I>&gt;&gt;<i> http_access deny !bad_exception_urls !exec_users exec_files deny_info
</I>&gt;&gt;<i> ERR_BLOCK_TYPE exec_files
</I>&gt;<i> 
</I>&gt;&gt;<i> acl mmedia_users proxy_auth_regex -i &quot;/etc/squid/mmedia_users&quot;
</I>&gt;&gt;<i> acl mmedia_sites dstdomain &quot;/etc/squid/mmedia_sites&quot;
</I>&gt;&gt;<i> http_access       allow methods_std    proto_HTTP http_ports mmedia_sites mmedia_users
</I>&gt;&gt;<i> http_reply_access allow methods_std    proto_HTTP http_ports mmedia_sites mmedia_users
</I>&gt;<i> 
</I>&gt;&gt;<i> http_access       allow method_CONNECT            ssl_ports  mmedia_sites mmedia_users
</I>&gt;&gt;<i> http_reply_access allow method_CONNECT            ssl_ports  mmedia_sites mmedia_users
</I>&gt;<i> 
</I>&gt;&gt;<i> acl bad_domains dstdomain &quot;/etc/squid/bad_domains&quot;
</I>&gt;&gt;<i> http_access deny !bad_exception_urls bad_domains
</I>&gt;&gt;<i> deny_info ERR_BLOCK_DST       bad_domains
</I>&gt;<i> 
</I>&gt;&gt;<i> acl bad_domains_regex dstdom_regex -i &quot;/etc/squid/bad_domains_regex&quot;
</I>&gt;&gt;<i> http_access deny !bad_exception_urls bad_domains_regex
</I>&gt;&gt;<i> deny_info ERR_BLOCK_DST       bad_domains_regex
</I>&gt;<i> 
</I>&gt;&gt;<i> acl bad_urls url_regex -i &quot;/etc/squid/bad_urls&quot;
</I>&gt;&gt;<i> http_access deny !bad_exception_urls bad_urls
</I>&gt;&gt;<i> deny_info ERR_BLOCK_DST       bad_urls
</I>&gt;<i> 
</I>&gt;&gt;<i> acl bad_files urlpath_regex -i &quot;/etc/squid/bad_files&quot;
</I>&gt;&gt;<i> http_access deny !bad_exception_urls bad_files deny_info
</I>&gt;&gt;<i> ERR_BLOCK_TYPE bad_files
</I>&gt;<i> 
</I>&gt;&gt;<i> acl bad_types rep_mime_type -i &quot;/etc/squid/bad_types&quot;
</I>&gt;&gt;<i> http_reply_access deny bad_types !bad_exception_urls deny_info
</I>&gt;&gt;<i> ERR_BLOCK_TYPE bad_types
</I>&gt;<i> 
</I>&gt;&gt;<i> acl fsoguest_user proxy_auth_regex -i fsoguest acl fsoguest_dst
</I>&gt;&gt;<i> dstdomain .opm.gov acl fsoguest_dst dstdomain .google-analytics.com
</I>&gt;&gt;<i> acl fsoguest_dst dstdomain pki.google.com acl fsoguest_dst dstdomain
</I>&gt;&gt;<i> ajax.googleapis.com acl fsoguest_dst dstdomain fonts.googleapis.com
</I>&gt;&gt;<i> acl fsoguest_dst dstdomain html5shiv.googlecode.com acl fsoguest_dst
</I>&gt;&gt;<i> dstdomain fonts.gstatic.com acl fsoguest_dst dstdomain
</I>&gt;&gt;<i> clients1.google.com acl fsoguest_dst dstdomain ajax.microsoft.com acl
</I>&gt;&gt;<i> fsoguest_dst dstdomain ajax.aspnetcdn.com acl fsoguest_dst dstdomain
</I>&gt;&gt;<i> .geotrust.com acl fsoguest_dst dstdomain .akamaihd.net acl
</I>&gt;&gt;<i> fsoguest_dst dstdomain symcd.com http_access allow methods_std
</I>&gt;&gt;<i> proto_HTTP http_ports fsoguest_dst fsoguest_user
</I>&gt;&gt;<i> http_access allow method_CONNECT         ssl_ports  fsoguest_dst fsoguest_user
</I>&gt;&gt;<i> http_access deny fsoguest_user
</I>&gt;<i> 
</I>&gt;&gt;<i> http_access allow http_ports proto_HTTP methods_std
</I>&gt;<i> 
</I>&gt;&gt;<i> acl ssh_users proxy_auth -i PCADMIN
</I>&gt;&gt;<i> acl ssh_users proxy_auth -i BSCOTT
</I>&gt;&gt;<i> http_access allow method_CONNECT ssh_ports ssh_users
</I>&gt;<i> 
</I>&gt;&gt;<i> acl ssh_dst dst vthm.com
</I>&gt;&gt;<i> http_access allow method_CONNECT ssh_ports ssh_dst
</I>&gt;<i> 
</I>&gt;&gt;<i> acl ftp_dst dst
</I>&gt;&gt;<i> <A HREF="http://www.a/">http://www.a/</A>
</I>&gt;&gt;<i> rc-tech.com%2F&amp;data=05%7C02%7Cjosh.piana%40hexcel.com%7C69861412949747
</I>&gt;&gt;<i> 94b68b08dc6deddb54%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C638506
</I>&gt;&gt;<i> 115567977267%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luM
</I>&gt;&gt;<i> zIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&amp;sdata=Rj6hxBCYCNqITDlpJ
</I>&gt;&gt;<i> QiS%2B8TlfOX6z6DbmVNOfHeD7sU%3D&amp;reserved=0
</I>&gt;<i> 
</I>&gt;<i> I hoep that above line is a typo. A full URL is not valid for a &quot;dst&quot;
</I>&gt;<i> ACL type.
</I>&gt;<i> 
</I>&gt;<i> The &quot;dst&quot; ACL values can be;
</I>&gt;<i>    * a raw-IP, or
</I>&gt;<i>    * a CIDR range, or
</I>&gt;<i>    * a NetMask range (eg A-B/mask), or
</I>&gt;<i>    * a hostname which is resolvable in DNS at Squid startup/reconfigure time.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> acl ftp_dst dst ftp.telemeter.de
</I>&gt;&gt;<i> acl ftp_dst dst ftp.lucasindustries.com acl ftp_dst dst
</I>&gt;&gt;<i> ftp-upload.trendmicro.com http_access allow method_CONNECT ftp_dst
</I>&gt;&gt;<i> http_access allow method_CONNECT ssl_ports http_access deny
</I>&gt;&gt;<i> method_CONNECT
</I>&gt;<i> 
</I>&gt;&gt;<i> http_access allow ftp_ports proto_FTP
</I>&gt;&gt;<i> http_access deny all
</I>&gt;&gt;<i> http_reply_access allow all
</I>&gt;&gt;<i>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> After making the above adjustments with Squid installed you should be aboe to run the command &quot;squid -k parse -f /etc/squid/squid.conf.old&quot; to see what the new Squid thinks of the old configuration.
</I>&gt;<i> 
</I>&gt;<i> Any &quot;ERROR&quot; lines that are displayed by by that command will need fixing before you can use Squid.
</I>&gt;<i> 
</I>&gt;<i> Any &quot;WARNING&quot; or &quot;NOTICE&quot; or &quot;UPGRADE&quot; are things that should be looked into fixing. But not urgent enough to make Squid unusable.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> You may need to run &quot;squid -z -f /etc/squid/squid.conf.old&quot; to create the cache directory.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> When that is fine you can move the /etc/squid/squid.conf.old to replace the /etc/squid/squid.conf and use the OS method for starting Squid.
</I>&gt;<i> 
</I>&gt;<i> Which for RHEL 9 I believe should be:
</I>&gt;<i>      service squid start
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> ... then start testing that what Squid does actually meets your expectations.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> HTH
</I>&gt;<i> Amos
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> --------------------------------------------------------------
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Current Box squid -v Output:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Squid Cache: Version 2.6.STABLE21
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> configure options:  '--build=i386-redhat-linux-gnu' '--host=i386-redhat-linux-gnu' '--target=i386-redhat-linux-gnu' '--program-prefix=' '--prefix=/usr' '--exec-prefix=/usr' '--bindir=/usr/bin' '--sbindir=/usr/sbin' '--sysconfdir=/etc' '--includedir=/usr/include' '--libdir=/usr/lib' '--libexecdir=/usr/libexec' '--sharedstatedir=/usr/com' '--mandir=/usr/share/man' '--infodir=/usr/share/info' '--exec_prefix=/usr' '--bindir=/usr/sbin' '--libexecdir=/usr/lib/squid' '--localstatedir=/var' '--datadir=/usr/share' '--sysconfdir=/etc/squid' '--enable-arp-acl' '--enable-epoll' '--enable-snmp' '--enable-removal-policies=heap,lru' '--enable-storeio=aufs,coss,diskd,null,ufs' '--enable-ssl' '--with-openssl=/usr/kerberos' '--enable-delay-pools' '--enable-linux-netfilter' '--with-pthreads' '--enable-ntlm-auth-helpers=SMB,fakeauth' '--enable-external-acl-helpers=ip_user,ldap_group,unix_group,wbinfo_group' '--enable-auth=basic,digest,ntlm,negotiate' '--enable-negotiate-auth-helpers=squid_kerb_auth' '--enable-digest-auth-helpers=password' '--with-winbind-auth-challenge' '--enable-useragent-log' '--enable-referer-log' '--disable-dependency-tracking' '--enable-cachemgr-hostname=localhost' '--enable-underscores' '--enable-basic-auth-helpers=LDAP,MSNT,NCSA,PAM,SMB,YP,getpwnam,multi-domain-NTLM,SASL' '--enable-cache-digests' '--enable-ident-lookups' '--with-large-files' '--enable-follow-x-forwarded-for' '--enable-wccpv2' '--enable-fd-config' '--with-maxfd=16384' 'build_alias=i386-redhat-linux-gnu' 'host_alias=i386-redhat-linux-gnu' 'target_alias=i386-redhat-linux-gnu' 'CFLAGS=-D_FORTIFY_SOURCE=2 -fPIE -Os -g -pipe -fsigned-char' 'LDFLAGS=-pie'
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> --------------------------------------------------------------
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> New Box squid -v Output:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Squid Cache: Version 5.5
</I>&gt;&gt;<i> Service Name: squid
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This binary uses OpenSSL 3.0.7 1 Nov 2022. For legal restrictions on
</I>&gt;&gt;<i> distribution see
</I>&gt;&gt;<i> <A HREF="https://www/.">https://www/.</A>
</I>&gt;&gt;<i> openssl.org%2Fsource%2Flicense.html&amp;data=05%7C02%7Cjosh.piana%40hexcel
</I>&gt;&gt;<i> .com%7C6986141294974794b68b08dc6deddb54%7C4248050df19546d5ac9c0c7c52b0
</I>&gt;&gt;<i> 4cae%7C0%7C0%7C638506115567977267%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4w
</I>&gt;&gt;<i> LjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&amp;sd
</I>&gt;&gt;<i> ata=SYACR6XE7IVCwGsCWdigcKjas80B5luo%2BHi8F6s5SFo%3D&amp;reserved=0
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> configure options:  '--build=x86_64-redhat-linux-gnu' '--host=x86_64-redhat-linux-gnu' '--program-prefix=' '--prefix=/usr' '--exec-prefix=/usr' '--bindir=/usr/bin' '--sbindir=/usr/sbin' '--sysconfdir=/etc' '--datadir=/usr/share' '--includedir=/usr/include' '--libdir=/usr/lib64' '--libexecdir=/usr/libexec' '--localstatedir=/var' '--sharedstatedir=/var/lib' '--mandir=/usr/share/man' '--infodir=/usr/share/info' '--libexecdir=/usr/lib64/squid' '--datadir=/usr/share/squid' '--sysconfdir=/etc/squid' '--with-logdir=/var/log/squid' '--with-pidfile=/run/squid.pid' '--disable-dependency-tracking' '--enable-eui' '--enable-follow-x-forwarded-for' '--enable-auth' '--enable-auth-basic=DB,fake,getpwnam,LDAP,NCSA,PAM,POP3,RADIUS,SASL,SMB,SMB_LM' '--enable-auth-ntlm=SMB_LM,fake' '--enable-auth-digest=file,LDAP' '--enable-auth-negotiate=kerberos' '--enable-external-acl-helpers=LDAP_group,time_quota,session,unix_group,wbinfo_group,kerberos_ldap_group' '--enable-storeid-rewrite-helpers=file' '--enable-cache-digests' '--enable-cachemgr-hostname=localhost' '--enable-delay-pools' '--enable-epoll' '--enable-icap-client' '--enable-ident-lookups' '--enable-linux-netfilter' '--enable-removal-policies=heap,lru' '--enable-snmp' '--enable-ssl' '--enable-ssl-crtd' '--enable-storeio=aufs,diskd,ufs,rock' '--enable-diskio' '--enable-wccpv2' '--enable-esi' '--enable-ecap' '--with-aio' '--with-default-user=squid' '--with-dl' '--with-openssl' '--with-pthreads' '--disable-arch-native' '--disable-security-cert-validators' '--disable-strict-error-checking' '--with-swapdir=/var/spool/squid' 'build_alias=x86_64-redhat-linux-gnu' 'host_alias=x86_64-redhat-linux-gnu' 'CC=gcc' 'CFLAGS=-O2 -flto=auto -ffat-lto-objects -fexceptions -g -grecord-gcc-switches -pipe -Wall -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -Wp,-D_GLIBCXX_ASSERTIONS -specs=/usr/lib/rpm/redhat/redhat-hardened-cc1 -fstack-protector-strong -specs=/usr/lib/rpm/redhat/redhat-annobin-cc1  -m64 -march=x86-64-v2 -mtune=generic -fasynchronous-unwind-tables -fstack-clash-protection -fcf-protection' 'LDFLAGS=-Wl,-z,relro -Wl,--as-needed  -Wl,-z,now -specs=/usr/lib/rpm/redhat/redhat-hardened-ld -specs=/usr/lib/rpm/redhat/redhat-annobin-cc1 ' 'CXX=g++' 'CXXFLAGS=-O2 -flto=auto -ffat-lto-objects -fexceptions -g -grecord-gcc-switches -pipe -Wall -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -Wp,-D_GLIBCXX_ASSERTIONS -specs=/usr/lib/rpm/redhat/redhat-hardened-cc1 -fstack-protector-strong -specs=/usr/lib/rpm/redhat/redhat-annobin-cc1  -m64 -march=x86-64-v2 -mtune=generic -fasynchronous-unwind-tables -fstack-clash-protection -fcf-protection' 'PKG_CONFIG_PATH=:/usr/lib64/pkgconfig:/usr/share/pkgconfig' 'LT_SYS_LIBRARY_PATH=/usr/lib64:'
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> --------------------------------------------------------------
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> -----Original Message-----
</I>&gt;&gt;<i> From: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; On
</I>&gt;&gt;<i> Behalf Of Amos Jeffries
</I>&gt;&gt;<i> Sent: Friday, May 3, 2024 4:21 PM
</I>&gt;&gt;<i> To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i> Subject: Re: [squid-users] Linux Noob - Squid Config
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> [You don't often get email from <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz.</A> Learn why this
</I>&gt;&gt;<i> is important at <A HREF="https://aka.ms/LearnAboutSenderIdentification">https://aka.ms/LearnAboutSenderIdentification</A> ]
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On 4/05/24 07:59, Piana, Josh wrote:
</I>&gt;&gt;&gt;<i> Hey Everyone.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I apologize in advance for any lack of formality normally shared on
</I>&gt;&gt;&gt;<i> mailing lists such as these, it&#8217;s my first time seeking product
</I>&gt;&gt;&gt;<i> support in this manner.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> NO need to apologize. Help and questions is most of what we do here
</I>&gt;&gt;<i> :-)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I want to start by saying that I&#8217;m new to Linux, been using Windows
</I>&gt;&gt;&gt;<i> environments my entire life. Such is the reason for me reaching out
</I>&gt;&gt;&gt;<i> to you all.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I have been tasked with modernizing a Squid box and feel very
</I>&gt;&gt;&gt;<i> overwhelmed, to say the least.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Current Setup:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> &#232;CentOS 5.0
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> &#232;Squid 2.3
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> &#232;Apache 2.0.46
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> &#232;Samba 3.0.9
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Desired Setup:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> &#232;RHEL 9.2 OS
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> &#232;Needs to qualify for NTLM authentication
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Hmm, does it *have* to be NTLM? that auth protocol was deprecated in 2006.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> &#232;Would like to remove legacy apps/services
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> &#232;Continue to authenticate outgoing communication via AD
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> My question is, how do I get all of these services/apps to work
</I>&gt;&gt;&gt;<i> together? Do I just install the newest versions of each and migrate
</I>&gt;&gt;&gt;<i> the existing config files?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I was hoping for a better understanding on how all of these work
</I>&gt;&gt;&gt;<i> together and exactly how to configure or edit these as needed. I&#8217;ve
</I>&gt;&gt;&gt;<i> gotten as far as installing RHEL 9.2 on a fresh VM Server and trying
</I>&gt;&gt;&gt;<i> as best as I can to learn the basics on Linux and just the general
</I>&gt;&gt;&gt;<i> operation of a Linux ran environment. It feels like trying to ride a
</I>&gt;&gt;&gt;<i> bike with box wheels.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The installation of a basic Squid service for RHEL is easy.
</I>&gt;&gt;<i> Just open a terminal and enter this command:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>       yum install squid
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The next part is going over your old Squid configuration to see how much of it remains necessary or can be updated. It would be useful for the next steps to copy it to the RHEL machine as /etc/squid/squid.conf.old .
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> You can likely find it on the CentOS machine at /etc/squid/squid.conf or /usr/share/squid/etc/squid.conf depending on how that Squid was built.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> If you are able to paste the contents of that file (without the '#'
</I>&gt;&gt;<i> comment or empty lines) here, we can assist with getting the new Squid doing the same or equivalent actions.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Also please paste the output of &quot;squid -v&quot; run on both the old CentOS machine and on the new RHEL.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Cheers
</I>&gt;&gt;<i> Amos
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i> <A HREF="https://list/">https://list/</A>
</I>&gt;&gt;<i> s.squid-cache.org%2Flistinfo%2Fsquid-users&amp;data=05%7C02%7Cjosh.piana%4
</I>&gt;&gt;<i> 0hexcel.com%7C6986141294974794b68b08dc6deddb54%7C4248050df19546d5ac9c0
</I>&gt;&gt;<i> c7c52b04cae%7C0%7C0%7C638506115567977267%7CUnknown%7CTWFpbGZsb3d8eyJWI
</I>&gt;&gt;<i> joiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7
</I>&gt;&gt;<i> C%7C&amp;sdata=tm3ZL54tYg9GI5l1LlqjR9vQN8o%2BRcjshffEoKxMH%2FA%3D&amp;reserved
</I>&gt;&gt;<i> =0
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</I></PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="026651.html">[squid-users] Linux Noob - Squid Config
</A></li>
	<LI>Next message (by thread): <A HREF="026649.html">[squid-users] Dynamic ACL with local auth
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26653">[ date ]</a>
              <a href="thread.html#26653">[ thread ]</a>
              <a href="subject.html#26653">[ subject ]</a>
              <a href="author.html#26653">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
