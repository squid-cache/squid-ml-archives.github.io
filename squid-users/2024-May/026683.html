<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Question: cache_mem share among multiple squid instances with the same service_name in SMP mode
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Question%3A%20cache_mem%20share%20among%20multiple%20squid%0A%20instances%20with%20the%20same%20service_name%20in%20SMP%20mode&In-Reply-To=%3C86bc0358-886c-4471-b5b0-df9f9dd2de80%40fujitsu.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026681.html">
   <LINK REL="Next"  HREF="026684.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Question: cache_mem share among multiple squid instances with the same service_name in SMP mode</H1>
    <B>Zhijian Li (Fujitsu)</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Question%3A%20cache_mem%20share%20among%20multiple%20squid%0A%20instances%20with%20the%20same%20service_name%20in%20SMP%20mode&In-Reply-To=%3C86bc0358-886c-4471-b5b0-df9f9dd2de80%40fujitsu.com%3E"
       TITLE="[squid-users] Question: cache_mem share among multiple squid instances with the same service_name in SMP mode">lizhijian at fujitsu.com
       </A><BR>
    <I>Tue May 21 01:35:03 UTC 2024</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="026681.html">[squid-users] Question: cache_mem share among multiple squid instances with the same service_name in SMP mode
</A></li>
        <LI>Next message (by thread): <A HREF="026684.html">[squid-users] log_referrer question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26683">[ date ]</a>
              <a href="thread.html#26683">[ thread ]</a>
              <a href="subject.html#26683">[ subject ]</a>
              <a href="author.html#26683">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Alex,


On 20/05/2024 22:09, Alex Rousskov wrote:
&gt;<i> On 2024-05-20 03:35, Zhijian Li (Fujitsu) wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> In SMP mode, is it possible that cache_mem can be share among
</I>&gt;&gt;<i> multiple squid instances with the same service_name?
</I>&gt;<i> 
</I>&gt;<i> Short answer: &quot;Do not run multiple SMP Squid instances with the same service_name&quot;.
</I>&gt;<i> 
</I>&gt;<i> SMP Squid cache[1] is not supposed to be shared across Squid instances. Any configurations or actions that result in such sharing are unsupported and may lead to undefined behavior. Squid may not emit warnings or other diagnostics in such unsupported cases -- no Squid code has been written specifically to detect and warn about unsupported memory sharing.
</I>&gt;<i> 
</I>&gt;<i> For example, running multiple identically-built Squid instances on the same &quot;box&quot;[2] with the _same_ service name is unsupported and may lead to undefined behavior, especially if SMP Squid cache[1] is enabled.
</I>&gt;<i> 
</I>&gt;<i> Running multiple identically-built Squid instances on the same &quot;box&quot;[2] with _different_ service names is supported on some OSes because it does not lead to unsupported sharing. In other environments, it may lead to undefined behavior. This limitation is a Squid bug or a missing feature. Developers wishing to remove this limitation should look at shm_portable_segment_name_is_path() description and use case.
</I>&gt;<i> 
</I>
Understood, many thanks for your detailed explanation.


Thanks
Zhijian

&gt;<i> [1]: Here, &quot;SMP Squid cache&quot; applies to both cache_dir storage (on disk and in shared memory) and cache_mem storage (in shared memory). Very similar reasoning applies to non-caching SMP Squid instances as well, but the question was about caching, so I will not detail these other cases.
</I>&gt;<i> 
</I>&gt;<i> [2]: Here, the term &quot;box&quot; is used to mean &quot;isolation environment&quot;: &quot;Same box&quot; means the same OS instance, the same container instance (if containerized), and the same filesystem (i.e. no chroot, jails, or similar isolation tricks for each Squid instance). Various OSes isolate shared memory segments differently, but many use file systems for some shared memory artifacts. If artifacts from different Squid instances clash, Squid behavior is undefined.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> HTH,
</I>&gt;<i> 
</I>&gt;<i> Alex.
</I>&gt;<i> 
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Per SmpScale[1], &quot;memory object cache (in most environments)&quot; can be share among workers
</I>&gt;&gt;<i> Per smp-enabled-squid[2], &quot;Each set of SMP-aware processes will interact only with other processes using the same service name&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> So if i have multiple (SMP mode + same service_name) squid instances, would they share the cache_mem objects.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> [1] <A HREF="https://wiki.squid-cache.org/Features/SmpScale#what-can-workers-share">https://wiki.squid-cache.org/Features/SmpScale#what-can-workers-share</A>
</I>&gt;&gt;<i> [2] <A HREF="https://wiki.squid-cache.org/KnowledgeBase/MultipleInstances#smp-enabled-squid">https://wiki.squid-cache.org/KnowledgeBase/MultipleInstances#smp-enabled-squid</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thanks
</I>&gt;&gt;<i> Zhijian
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</I></PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="026681.html">[squid-users] Question: cache_mem share among multiple squid instances with the same service_name in SMP mode
</A></li>
	<LI>Next message (by thread): <A HREF="026684.html">[squid-users] log_referrer question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26683">[ date ]</a>
              <a href="thread.html#26683">[ thread ]</a>
              <a href="subject.html#26683">[ subject ]</a>
              <a href="author.html#26683">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
