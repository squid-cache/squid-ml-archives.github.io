From ngtech1ltd at gmail.com  Fri Nov  1 07:02:26 2024
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Fri, 1 Nov 2024 09:02:26 +0200
Subject: [squid-users] Squid and AD integration
In-Reply-To: <CADAqQfxKM+wyBP1yfhSaW3_G=_=aw0nnONaFX7AP6CGga2JEKA@mail.gmail.com>
References: <CADAqQfxKM+wyBP1yfhSaW3_G=_=aw0nnONaFX7AP6CGga2JEKA@mail.gmail.com>
Message-ID: <000001db2c2c$03e62840$0bb278c0$@gmail.com>

Hey Ben,

I have tried to implement this in the past but got into some difficulties with this.
If you are willing for us to work together on this in a lab and then publish the results in a video I will be more  then happy to work with you on this.

What do you say?

Eliezer

From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Ben Goz
Sent: Thursday, October 31, 2024 1:27 PM
To: squid-users at lists.squid-cache.org
Subject: [squid-users] Squid and AD integration

By the help of God.

Hi,
I'm trying to make squid integrate with AD server in such a way that the machines logged to the domain will send the current active username to squid and squid will ask the AD for all the groups that this username belongs to.

How can I configure squid to send an authentication challenge that the browser will send the active AD user? And if the machine doesn't connected to the domain it won't popup the login box?
Do I also need to configure the squid server as a trusted server in the domain?

Thanks,
Ben




From ngtech1ltd at gmail.com  Fri Nov  1 07:16:35 2024
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Fri, 1 Nov 2024 09:16:35 +0200
Subject: [squid-users] Fully Automating the Squid-Cache RPMs build and
 Squid-Nuggets beginning
Message-ID: <000101db2c2d$fd1ba740$f752f5c0$@gmail.com>

Hey Everyone,

For quite some time  I have been working on couple tools for squid-cache
build automation.
The corner stone for all of this is at:
https://github.com/elico/squid-latest

which is a repository that hosts the latest version of stable squid URL in
the json file:
https://raw.githubusercontent.com/elico/squid-latest/refs/heads/main/latest.
json

With this in place it's pretty easy to check periodically if there is a
newer version of Squid-Cache and then build and deploy the RPMs for the
different Distributions.
I have also found the right workaround for the EL9 branch build so the
latest version 6.12 is available for all EL8 and EL8 distributions now.

The automation will free some of my time for creating videos about
Squid-Cache series which I wanted to create for some time now.
I am not a professional at webinar creation but I hope that my videos will
give something that is not there already.
The first video in the series "Squid-Nuggets" is here at:
https://www.youtube.com/watch?v=vwzd0bP6tQw

Squid for Web Access Control - Part 1

I am looking for a partner that will help me in couple aspects of this
series.
This work is meant for these who want to volunteer a little bit with the
hope to gain some knowledge.

Please feel free to contact me for any question.


----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com





From yvain.payen at tessi.fr  Thu Nov  7 13:04:27 2024
From: yvain.payen at tessi.fr (Yvain PAYEN)
Date: Thu, 7 Nov 2024 13:04:27 +0000
Subject: [squid-users] Squid and AD integration
In-Reply-To: <CADAqQfxKM+wyBP1yfhSaW3_G=_=aw0nnONaFX7AP6CGga2JEKA@mail.gmail.com>
References: <CADAqQfxKM+wyBP1yfhSaW3_G=_=aw0nnONaFX7AP6CGga2JEKA@mail.gmail.com>
Message-ID: <DB9PR07MB9809069A5BBD7F9AD0BFA0189C5C2@DB9PR07MB9809.eurprd07.prod.outlook.com>

Hi Ben

Here what I was using with squid 3.8 (I now use another proxy solution)
If you don't want the login popup for non domain users, remove the basic auth

# Install samba

# Join proxy to domain
Net ads join ?U username

# Setup krb5.conf
[libdefaults]
        default_realm = MyDomain.loc

[realms]
        MyDomain.loc = {
        kdc = 1.2.3.4
        kdc = 1.2.3.5
        admin_server = 1.2.3.4
        default_domain = TESSI-TECHNO.FR
        }


[domain_realm]
        .MyDomain.loc = MyDomain.loc
        MyDomain.loc = MyDomain.loc

[login]
        krb4_convert = true
        krb4_get_tickets = false


# Add this to squid.conf
auth_param ntlm program /usr/bin/ntlm_auth --helper-protocol=squid-2.5-ntlmssp
auth_param ntlm children 150 startup=0 idle=1
auth_param ntlm keep_alive on

auth_param basic program /usr/bin/ntlm_auth --helper-protocol=squid-2.5-basic
auth_param basic children 75 startup=5 idle=1
auth_param basic realm MyDomain.loc
auth_param basic credentialsttl 2 hours

acl Auth-users proxy_auth REQUIRED
http_access allow Auth-users


Yvain PAYEN

De?: squid-users <squid-users-bounces at lists.squid-cache.org> De la part de Ben Goz
Envoy??: jeudi 31 octobre 2024 12:27
??: squid-users at lists.squid-cache.org
Objet?: [squid-users] Squid and AD integration

? FR : Ce message provient de l'ext?rieur de l'organisation. N'ouvrez pas de liens ou de pi?ces jointes ? moins que vous ne sachiez que le contenu est fiable. ??

By the help of God.

Hi,
I'm trying to make squid integrate with AD server in such a way that the machines logged to the domain will send the current active username to squid and squid will ask the AD for all the groups?that this username belongs to.

How can I configure squid to send an authentication challenge?that the browser will send the active AD user? And if the machine doesn't connected?to the domain it won't popup the login box?
Do I also need to configure the squid server as a trusted server in the domain?

Thanks,
Ben


From Peter.Marko at siemens.com  Thu Nov  7 21:48:27 2024
From: Peter.Marko at siemens.com (Marko, Peter)
Date: Thu, 7 Nov 2024 21:48:27 +0000
Subject: [squid-users] v6.12 build error from release tarball
Message-ID: <AS1PR10MB5697562242FB552C8686C6EEFD5C2@AS1PR10MB5697.EURPRD10.PROD.OUTLOOK.COM>

Dear squid maintainers,

Commit [1] removed directory libltdl/m4 from release tarball by merging
all those files into libltdl/aclocal.m4, however makefiles still
reference it causing following error (in Yocto project):

| autoreconf: Entering directory 'libltdl'
| autoreconf: configure.ac: not using Gettext
| autoreconf: running: aclocal --system-acdir=WORKDIR/recipe-sysroot/usr/share/aclocal/ -I WORKDIR/squid-6.12/acinclude/ -I WORKDIR/recipe-sysroot-native/usr/share/aclocal/ --force -I m4
| aclocal: error: couldn't open directory 'm4': No such file or directory
| autoreconf: error: aclocal failed with exit status: 1

Following change of release tarball will make the build pass:
diff squid-6.12-orig/libltdl/Makefile.am squid-6.12/libltdl/Makefile.am
--- squid-6.12-orig/libltdl/Makefile.am
+++ squid-6.12/libltdl/Makefile.am
@@ -29,7 +29,7 @@
 ## 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
 #####
 
-ACLOCAL_AMFLAGS = -I m4
+ACLOCAL_AMFLAGS =
 AUTOMAKE_OPTIONS = foreign
 AM_CPPFLAGS =
 AM_LDFLAGS =
diff squid-6.12-orig/libltdl/Makefile.in squid-6.12/libltdl/Makefile.in
--- squid-6.12-orig/libltdl/Makefile.in
+++ squid-6.12/libltdl/Makefile.in
@@ -448,7 +448,7 @@ target_alias = @target_alias@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
-ACLOCAL_AMFLAGS = -I m4
+ACLOCAL_AMFLAGS =
 AUTOMAKE_OPTIONS = foreign
 
 # -I$(srcdir) is needed for user that built libltdl with a sub-Automake

I don't know how to fix it in source repository.
Help would be appreciated.

Thanks,
  Peter

[1] https://github.com/squid-cache/squid/commit/b4addc2262e5bee37543f8d1ab9dd98337bafba3


From rousskov at measurement-factory.com  Fri Nov  8 04:27:25 2024
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Thu, 7 Nov 2024 23:27:25 -0500
Subject: [squid-users] v6.12 build error from release tarball
In-Reply-To: <AS1PR10MB5697562242FB552C8686C6EEFD5C2@AS1PR10MB5697.EURPRD10.PROD.OUTLOOK.COM>
References: <AS1PR10MB5697562242FB552C8686C6EEFD5C2@AS1PR10MB5697.EURPRD10.PROD.OUTLOOK.COM>
Message-ID: <e6822e6b-6fe7-4941-a42d-c4a56e575b3b@measurement-factory.com>

On 2024-11-07 16:48, Marko, Peter wrote:

> Commit [1] removed directory libltdl/m4 from release tarball by merging
> all those files into libltdl/aclocal.m4,

Clarification: While commit b4addc22 itself did not remove any 
directories or merged any files, bootstrapping Squid after that commit 
may have such an effect. The exact bootstrapping outcome depends, in 
part, on bootstrapping environment (e.g., installed libtool version)...


> however makefiles still
> reference it causing following error (in Yocto project):

libltdl/Makefile.am that references m4 directory comes from Libtool. 
That particular Makefile.am does not exist in primary Squid sources 
(i.e. what gets committed to the official git repository). It gets 
created (by libtoolize IIRC) during bootstrapping of Squid sources.



> | autoreconf: Entering directory 'libltdl'

To bootstrap Squid, one has to run ./bootstrap.sh instead of autoreconf. 
AFAIK, Squid does not fully support bootstrapping with autoreconf; 
autoreconf fails to do the right thing in some environments. If 
autoreconf had worked for you, it was just temporary luck.

However, _why_ run autoreconf (i.e. bootstrapping Squid) after 
downloading _bootstrapped_ sources?! Clarifying this contradiction may 
help identify and address the underlying problem.


Thank you,

Alex.






> | autoreconf: configure.ac: not using Gettext
> | autoreconf: running: aclocal --system-acdir=WORKDIR/recipe-sysroot/usr/share/aclocal/ -I WORKDIR/squid-6.12/acinclude/ -I WORKDIR/recipe-sysroot-native/usr/share/aclocal/ --force -I m4
> | aclocal: error: couldn't open directory 'm4': No such file or directory
> | autoreconf: error: aclocal failed with exit status: 1
> 
> Following change of release tarball will make the build pass:
> diff squid-6.12-orig/libltdl/Makefile.am squid-6.12/libltdl/Makefile.am
> --- squid-6.12-orig/libltdl/Makefile.am
> +++ squid-6.12/libltdl/Makefile.am
> @@ -29,7 +29,7 @@
>   ## 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
>   #####
>   
> -ACLOCAL_AMFLAGS = -I m4
> +ACLOCAL_AMFLAGS =
>   AUTOMAKE_OPTIONS = foreign
>   AM_CPPFLAGS =
>   AM_LDFLAGS =
> diff squid-6.12-orig/libltdl/Makefile.in squid-6.12/libltdl/Makefile.in
> --- squid-6.12-orig/libltdl/Makefile.in
> +++ squid-6.12/libltdl/Makefile.in
> @@ -448,7 +448,7 @@ target_alias = @target_alias@
>   top_build_prefix = @top_build_prefix@
>   top_builddir = @top_builddir@
>   top_srcdir = @top_srcdir@
> -ACLOCAL_AMFLAGS = -I m4
> +ACLOCAL_AMFLAGS =
>   AUTOMAKE_OPTIONS = foreign
>   
>   # -I$(srcdir) is needed for user that built libltdl with a sub-Automake
> 
> I don't know how to fix it in source repository.
> Help would be appreciated.
> 
> Thanks,
>    Peter
> 
> [1] https://github.com/squid-cache/squid/commit/b4addc2262e5bee37543f8d1ab9dd98337bafba3
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> https://lists.squid-cache.org/listinfo/squid-users



From Peter.Marko at siemens.com  Fri Nov  8 07:33:28 2024
From: Peter.Marko at siemens.com (Marko, Peter)
Date: Fri, 8 Nov 2024 07:33:28 +0000
Subject: [squid-users] v6.12 build error from release tarball
In-Reply-To: <e6822e6b-6fe7-4941-a42d-c4a56e575b3b@measurement-factory.com>
References: <AS1PR10MB5697562242FB552C8686C6EEFD5C2@AS1PR10MB5697.EURPRD10.PROD.OUTLOOK.COM>
 <e6822e6b-6fe7-4941-a42d-c4a56e575b3b@measurement-factory.com>
Message-ID: <AS1PR10MB5697EA7DB22B4BA085E350F8FD5D2@AS1PR10MB5697.EURPRD10.PROD.OUTLOOK.COM>

Hi Alex,

I don't really know autotools and how they are supposed to be used.
This process (using bootstrapped release tarball + running autoreconf) is
the standard way how Yocto project builds autotool based components.
Maybe because release tarballs are bootstrapped with a possibly/usually
different version of libtool and other toolchain parts than are used by Yocto
or because of different configuration options?

Your explanation makes sense to me and I have some idea why this
build problem occurs and have some arguments for my patch within Yocto.

Thanks for your support,
Peter

> -----Original Message-----
> From: Alex Rousskov <rousskov at measurement-factory.com>
> Sent: Friday, November 8, 2024 5:27
> To: squid-users at lists.squid-cache.org
> Cc: Marko, Peter (FT D EU SK BFS1) <Peter.Marko at siemens.com>
> Subject: Re: [squid-users] v6.12 build error from release tarball
> 
> On 2024-11-07 16:48, Marko, Peter wrote:
> 
> > Commit [1] removed directory libltdl/m4 from release tarball by merging
> > all those files into libltdl/aclocal.m4,
> 
> Clarification: While commit b4addc22 itself did not remove any
> directories or merged any files, bootstrapping Squid after that commit
> may have such an effect. The exact bootstrapping outcome depends, in
> part, on bootstrapping environment (e.g., installed libtool version)...
> 
> 
> > however makefiles still
> > reference it causing following error (in Yocto project):
> 
> libltdl/Makefile.am that references m4 directory comes from Libtool.
> That particular Makefile.am does not exist in primary Squid sources
> (i.e. what gets committed to the official git repository). It gets
> created (by libtoolize IIRC) during bootstrapping of Squid sources.
> 
> 
> 
> > | autoreconf: Entering directory 'libltdl'
> 
> To bootstrap Squid, one has to run ./bootstrap.sh instead of autoreconf.
> AFAIK, Squid does not fully support bootstrapping with autoreconf;
> autoreconf fails to do the right thing in some environments. If
> autoreconf had worked for you, it was just temporary luck.
> 
> However, _why_ run autoreconf (i.e. bootstrapping Squid) after
> downloading _bootstrapped_ sources?! Clarifying this contradiction may
> help identify and address the underlying problem.
> 
> 
> Thank you,
> 
> Alex.
> 
> 
> 
> 
> 
> 
> > | autoreconf: configure.ac: not using Gettext
> > | autoreconf: running: aclocal --system-acdir=WORKDIR/recipe-
> sysroot/usr/share/aclocal/ -I WORKDIR/squid-6.12/acinclude/ -I
> WORKDIR/recipe-sysroot-native/usr/share/aclocal/ --force -I m4
> > | aclocal: error: couldn't open directory 'm4': No such file or directory
> > | autoreconf: error: aclocal failed with exit status: 1
> >
> > Following change of release tarball will make the build pass:
> > diff squid-6.12-orig/libltdl/Makefile.am squid-6.12/libltdl/Makefile.am
> > --- squid-6.12-orig/libltdl/Makefile.am
> > +++ squid-6.12/libltdl/Makefile.am
> > @@ -29,7 +29,7 @@
> >   ## 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
> >   #####
> >
> > -ACLOCAL_AMFLAGS = -I m4
> > +ACLOCAL_AMFLAGS =
> >   AUTOMAKE_OPTIONS = foreign
> >   AM_CPPFLAGS =
> >   AM_LDFLAGS =
> > diff squid-6.12-orig/libltdl/Makefile.in squid-6.12/libltdl/Makefile.in
> > --- squid-6.12-orig/libltdl/Makefile.in
> > +++ squid-6.12/libltdl/Makefile.in
> > @@ -448,7 +448,7 @@ target_alias = @target_alias@
> >   top_build_prefix = @top_build_prefix@
> >   top_builddir = @top_builddir@
> >   top_srcdir = @top_srcdir@
> > -ACLOCAL_AMFLAGS = -I m4
> > +ACLOCAL_AMFLAGS =
> >   AUTOMAKE_OPTIONS = foreign
> >
> >   # -I$(srcdir) is needed for user that built libltdl with a sub-Automake
> >
> > I don't know how to fix it in source repository.
> > Help would be appreciated.
> >
> > Thanks,
> >    Peter
> >
> > [1] https://github.com/squid-
> cache/squid/commit/b4addc2262e5bee37543f8d1ab9dd98337bafba3
> > _______________________________________________
> > squid-users mailing list
> > squid-users at lists.squid-cache.org
> > https://lists.squid-cache.org/listinfo/squid-users


From rousskov at measurement-factory.com  Fri Nov  8 14:18:03 2024
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Fri, 8 Nov 2024 09:18:03 -0500
Subject: [squid-users] v6.12 build error from release tarball
In-Reply-To: <AS1PR10MB5697EA7DB22B4BA085E350F8FD5D2@AS1PR10MB5697.EURPRD10.PROD.OUTLOOK.COM>
References: <AS1PR10MB5697562242FB552C8686C6EEFD5C2@AS1PR10MB5697.EURPRD10.PROD.OUTLOOK.COM>
 <e6822e6b-6fe7-4941-a42d-c4a56e575b3b@measurement-factory.com>
 <AS1PR10MB5697EA7DB22B4BA085E350F8FD5D2@AS1PR10MB5697.EURPRD10.PROD.OUTLOOK.COM>
Message-ID: <a06cf2e2-3260-4ce8-92e0-b4833e3deb30@measurement-factory.com>

On 2024-11-08 02:33, Marko, Peter wrote:

> I don't really know autotools and how they are supposed to be used.

We are in the same boat here -- there are a lot of gray areas and dark 
corners with autotools. Bootstrapping of components is one of them, as 
commit 82e18891 message illustrates. And in your particular case, you 
are essentially dealing with bootstrapping a component of a component!

As an additional disclaimer, I know nothing about Yocto :-).


> This process (using bootstrapped release tarball + running autoreconf) is
> the standard way how Yocto project builds autotool based components.

Please consider adjusting Yocto "standard way" to honor and use 
component-supplied bootstrap.sh (instead of autoreconf) when it exists.


> Maybe because release tarballs are bootstrapped with a possibly/usually
> different version of libtool and other toolchain parts than are used by Yocto

Yes, most likely they are, but the differences may not matter to Yocto. 
And if they do matter to Yocto, then Yocto should honor component's way 
of bootstrapping before blindly assuming that autoreconf "works".

> or because of different configuration options?

Squid bootstrapping does not have options, but even if it had them, 
running autoreconf (without options) would probably ignore them, so this 
is probably not about bootstrapping options.


> Your explanation makes sense to me and I have some idea why this
> build problem occurs and have some arguments for my patch within Yocto.

I am very glad to hear that you are making progress.


Good luck,

Alex.


>> -----Original Message-----
>> From: Alex Rousskov <rousskov at measurement-factory.com>
>> Sent: Friday, November 8, 2024 5:27
>> To: squid-users at lists.squid-cache.org
>> Cc: Marko, Peter (FT D EU SK BFS1) <Peter.Marko at siemens.com>
>> Subject: Re: [squid-users] v6.12 build error from release tarball
>>
>> On 2024-11-07 16:48, Marko, Peter wrote:
>>
>>> Commit [1] removed directory libltdl/m4 from release tarball by merging
>>> all those files into libltdl/aclocal.m4,
>>
>> Clarification: While commit b4addc22 itself did not remove any
>> directories or merged any files, bootstrapping Squid after that commit
>> may have such an effect. The exact bootstrapping outcome depends, in
>> part, on bootstrapping environment (e.g., installed libtool version)...
>>
>>
>>> however makefiles still
>>> reference it causing following error (in Yocto project):
>>
>> libltdl/Makefile.am that references m4 directory comes from Libtool.
>> That particular Makefile.am does not exist in primary Squid sources
>> (i.e. what gets committed to the official git repository). It gets
>> created (by libtoolize IIRC) during bootstrapping of Squid sources.
>>
>>
>>
>>> | autoreconf: Entering directory 'libltdl'
>>
>> To bootstrap Squid, one has to run ./bootstrap.sh instead of autoreconf.
>> AFAIK, Squid does not fully support bootstrapping with autoreconf;
>> autoreconf fails to do the right thing in some environments. If
>> autoreconf had worked for you, it was just temporary luck.
>>
>> However, _why_ run autoreconf (i.e. bootstrapping Squid) after
>> downloading _bootstrapped_ sources?! Clarifying this contradiction may
>> help identify and address the underlying problem.
>>
>>
>> Thank you,
>>
>> Alex.
>>
>>
>>
>>
>>
>>
>>> | autoreconf: configure.ac: not using Gettext
>>> | autoreconf: running: aclocal --system-acdir=WORKDIR/recipe-
>> sysroot/usr/share/aclocal/ -I WORKDIR/squid-6.12/acinclude/ -I
>> WORKDIR/recipe-sysroot-native/usr/share/aclocal/ --force -I m4
>>> | aclocal: error: couldn't open directory 'm4': No such file or directory
>>> | autoreconf: error: aclocal failed with exit status: 1
>>>
>>> Following change of release tarball will make the build pass:
>>> diff squid-6.12-orig/libltdl/Makefile.am squid-6.12/libltdl/Makefile.am
>>> --- squid-6.12-orig/libltdl/Makefile.am
>>> +++ squid-6.12/libltdl/Makefile.am
>>> @@ -29,7 +29,7 @@
>>>    ## 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
>>>    #####
>>>
>>> -ACLOCAL_AMFLAGS = -I m4
>>> +ACLOCAL_AMFLAGS =
>>>    AUTOMAKE_OPTIONS = foreign
>>>    AM_CPPFLAGS =
>>>    AM_LDFLAGS =
>>> diff squid-6.12-orig/libltdl/Makefile.in squid-6.12/libltdl/Makefile.in
>>> --- squid-6.12-orig/libltdl/Makefile.in
>>> +++ squid-6.12/libltdl/Makefile.in
>>> @@ -448,7 +448,7 @@ target_alias = @target_alias@
>>>    top_build_prefix = @top_build_prefix@
>>>    top_builddir = @top_builddir@
>>>    top_srcdir = @top_srcdir@
>>> -ACLOCAL_AMFLAGS = -I m4
>>> +ACLOCAL_AMFLAGS =
>>>    AUTOMAKE_OPTIONS = foreign
>>>
>>>    # -I$(srcdir) is needed for user that built libltdl with a sub-Automake
>>>
>>> I don't know how to fix it in source repository.
>>> Help would be appreciated.
>>>
>>> Thanks,
>>>     Peter
>>>
>>> [1] https://github.com/squid-
>> cache/squid/commit/b4addc2262e5bee37543f8d1ab9dd98337bafba3
>>> _______________________________________________
>>> squid-users mailing list
>>> squid-users at lists.squid-cache.org
>>> https://lists.squid-cache.org/listinfo/squid-users
> 



From Josh.Piana at hexcel.com  Tue Nov 12 14:56:59 2024
From: Josh.Piana at hexcel.com (Piana, Josh)
Date: Tue, 12 Nov 2024 14:56:59 +0000
Subject: [squid-users] Access Log Question
Message-ID: <b21c26fdbb5142f094b5bb0444df300f@hexcel.com>

Hello Squid Users,

At some point, the access log has stopped recording which users are trying to access which sites.

I'm currently thinking is could be an issue with log format, Squid not being able to receive the header information, or authentication is being bypassed completely due to our config, for some reason.

Any help would be really appreciated.

Thank you,
Josh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20241112/98c8a3ca/attachment.htm>

From uhlar at fantomas.sk  Tue Nov 12 15:10:04 2024
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Tue, 12 Nov 2024 16:10:04 +0100
Subject: [squid-users] Access Log Question
In-Reply-To: <b21c26fdbb5142f094b5bb0444df300f@hexcel.com>
References: <b21c26fdbb5142f094b5bb0444df300f@hexcel.com>
Message-ID: <ZzNvzCE9MQc3vNjj@fantomas.sk>

On 12.11.24 14:56, Piana, Josh wrote:
> At some point, the access log has stopped recording which users are trying 
> to access which sites.
>
> I'm currently thinking is could be an issue with log format, Squid not 
> being able to receive the header information, or authentication is being 
> bypassed completely due to our config, for some reason.

what is it logging? doest is log "-" instead of usernames?

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
You have the right to remain silent. Anything you say will be misquoted,
then used against you.


From Josh.Piana at hexcel.com  Tue Nov 12 15:16:14 2024
From: Josh.Piana at hexcel.com (Piana, Josh)
Date: Tue, 12 Nov 2024 15:16:14 +0000
Subject: [squid-users] Access Log Question
In-Reply-To: <ZzNvzCE9MQc3vNjj@fantomas.sk>
References: <b21c26fdbb5142f094b5bb0444df300f@hexcel.com>
 <ZzNvzCE9MQc3vNjj@fantomas.sk>
Message-ID: <d07987b1bb384ca2b6fad86e976dcd91@hexcel.com>

Seems like it. 

Example:

12/Nov/2024:09:51:37 -0500.396 10.46.49.135 TCP_TUNNEL/200 23735 CONNECT http://www.safgard.com:443/ - \ HIER_DIRECT/206.188.0.52 - -/-

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Matus UHLAR - fantomas
Sent: Tuesday, November 12, 2024 10:10 AM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Access Log Question

Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.


On 12.11.24 14:56, Piana, Josh wrote:
> At some point, the access log has stopped recording which users are 
> trying to access which sites.
>
> I'm currently thinking is could be an issue with log format, Squid not 
> being able to receive the header information, or authentication is 
> being bypassed completely due to our config, for some reason.

what is it logging? doest is log "-" instead of usernames?

--
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
You have the right to remain silent. Anything you say will be misquoted, then used against you.
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
https://lists.squid-cache.org/listinfo/squid-users


From uhlar at fantomas.sk  Tue Nov 12 15:18:30 2024
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Tue, 12 Nov 2024 16:18:30 +0100
Subject: [squid-users] Access Log Question
In-Reply-To: <d07987b1bb384ca2b6fad86e976dcd91@hexcel.com>
References: <b21c26fdbb5142f094b5bb0444df300f@hexcel.com>
 <ZzNvzCE9MQc3vNjj@fantomas.sk>
 <d07987b1bb384ca2b6fad86e976dcd91@hexcel.com>
Message-ID: <ZzNxxumsPng2MiKY@fantomas.sk>

On 12.11.24 15:16, Piana, Josh wrote:
>Seems like it.
>
>Example:
>
>12/Nov/2024:09:51:37 -0500.396 10.46.49.135 TCP_TUNNEL/200 23735 CONNECT http://www.safgard.com:443/ - \ HIER_DIRECT/206.188.0.52 - -/-

yes, this looks like the username is not known to squid, thus probably 
bypassed authentication.
what type of proxy authentication you use?

>-----Original Message-----
>From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Matus UHLAR - fantomas
>Sent: Tuesday, November 12, 2024 10:10 AM
>To: squid-users at lists.squid-cache.org
>Subject: Re: [squid-users] Access Log Question
>
>Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.
>
>
>On 12.11.24 14:56, Piana, Josh wrote:
>> At some point, the access log has stopped recording which users are
>> trying to access which sites.
>>
>> I'm currently thinking is could be an issue with log format, Squid not
>> being able to receive the header information, or authentication is
>> being bypassed completely due to our config, for some reason.
>
>what is it logging? doest is log "-" instead of usernames?

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Micro$oft random number generator: 0, 0, 0, 4.33e+67, 0, 0, 0...


From Josh.Piana at hexcel.com  Tue Nov 12 15:22:50 2024
From: Josh.Piana at hexcel.com (Piana, Josh)
Date: Tue, 12 Nov 2024 15:22:50 +0000
Subject: [squid-users] Access Log Question
In-Reply-To: <ZzNxxumsPng2MiKY@fantomas.sk>
References: <b21c26fdbb5142f094b5bb0444df300f@hexcel.com>
 <ZzNvzCE9MQc3vNjj@fantomas.sk> <d07987b1bb384ca2b6fad86e976dcd91@hexcel.com>
 <ZzNxxumsPng2MiKY@fantomas.sk>
Message-ID: <0a9c163145e04dfdb5cc6fd55f35e9a7@hexcel.com>

It's setup to use Kerberos. 

I seem to be able to generate tickets by checking klist, and using kinit to authenticate my username with AD. But it looks like the proxy is ignoring it. This could explain why all my proxy_auth ACL's stopped working too. 


Here's my authentication settings:
auth_param negotiate children 10
auth_param negotiate keep_alive on
auth_param basic credentialsttl 2 hours
auth_param basic realm <redacted> Proxy Server

acl kerb-auth proxy_auth REQUIRED

The bottom of my ACL Rules looks like this:
http_access deny !kerb-auth
http_access allow kerb-auth
http_access deny all


-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Matus UHLAR - fantomas
Sent: Tuesday, November 12, 2024 10:19 AM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Access Log Question

Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.


On 12.11.24 15:16, Piana, Josh wrote:
>Seems like it.
>
>Example:
>
>12/Nov/2024:09:51:37 -0500.396 10.46.49.135 TCP_TUNNEL/200 23735 
>CONNECT 
>http://www.sa/
>fgard.com%3A443%2F&data=05%7C02%7Cjosh.piana%40hexcel.com%7C1dd5a668cff
>64041506f08dd032d47f6%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C6386
>70215221064884%7CUnknown%7CTWFpbGZsb3d8eyJFbXB0eU1hcGkiOnRydWUsIlYiOiIw
>LjAuMDAwMCIsIlAiOiJXaW4zMiIsIkFOIjoiTWFpbCIsIldUIjoyfQ%3D%3D%7C0%7C%7C%
>7C&sdata=gmzUs90%2Bccg4xxW8WHB2R4Tyb66r1tfKPdsQL2mHmUE%3D&reserved=0 - 
>\ HIER_DIRECT/206.188.0.52 - -/-

yes, this looks like the username is not known to squid, thus probably bypassed authentication.
what type of proxy authentication you use?

>-----Original Message-----
>From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf 
>Of Matus UHLAR - fantomas
>Sent: Tuesday, November 12, 2024 10:10 AM
>To: squid-users at lists.squid-cache.org
>Subject: Re: [squid-users] Access Log Question
>
>Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.
>
>
>On 12.11.24 14:56, Piana, Josh wrote:
>> At some point, the access log has stopped recording which users are 
>> trying to access which sites.
>>
>> I'm currently thinking is could be an issue with log format, Squid 
>> not being able to receive the header information, or authentication 
>> is being bypassed completely due to our config, for some reason.
>
>what is it logging? doest is log "-" instead of usernames?

--
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Micro$oft random number generator: 0, 0, 0, 4.33e+67, 0, 0, 0...
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
https://lists.squid-cache.org/listinfo/squid-users


From uhlar at fantomas.sk  Tue Nov 12 15:30:27 2024
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Tue, 12 Nov 2024 16:30:27 +0100
Subject: [squid-users] Access Log Question
In-Reply-To: <0a9c163145e04dfdb5cc6fd55f35e9a7@hexcel.com>
References: <b21c26fdbb5142f094b5bb0444df300f@hexcel.com>
 <ZzNvzCE9MQc3vNjj@fantomas.sk>
 <d07987b1bb384ca2b6fad86e976dcd91@hexcel.com>
 <ZzNxxumsPng2MiKY@fantomas.sk>
 <0a9c163145e04dfdb5cc6fd55f35e9a7@hexcel.com>
Message-ID: <ZzN0k6jxl3KdlTcS@fantomas.sk>

On 12.11.24 15:22, Piana, Josh wrote:
>I seem to be able to generate tickets by checking klist, and using kinit to authenticate my username with AD. But it looks like the proxy is ignoring it. This could explain why all my proxy_auth ACL's stopped working too.
>
>
>Here's my authentication settings:
>auth_param negotiate children 10
>auth_param negotiate keep_alive on
>auth_param basic credentialsttl 2 hours
>auth_param basic realm <redacted> Proxy Server
>
>acl kerb-auth proxy_auth REQUIRED
>
>The bottom of my ACL Rules looks like this:
>http_access deny !kerb-auth
>http_access allow kerb-auth
>http_access deny all

The bottom? Are there any ACL rules that allow clients' access before this?
Because ACL rules are processed in the order they are specified.

>-----Original Message-----
>From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Matus UHLAR - fantomas
>Sent: Tuesday, November 12, 2024 10:19 AM
>To: squid-users at lists.squid-cache.org
>Subject: Re: [squid-users] Access Log Question
>
>Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.
>
>
>On 12.11.24 15:16, Piana, Josh wrote:
>>Seems like it.
>>
>>Example:
>>
>>12/Nov/2024:09:51:37 -0500.396 10.46.49.135 TCP_TUNNEL/200 23735
>>CONNECT
>>http://www.sa/
>>fgard.com%3A443%2F&data=05%7C02%7Cjosh.piana%40hexcel.com%7C1dd5a668cff
>>64041506f08dd032d47f6%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C6386
>>70215221064884%7CUnknown%7CTWFpbGZsb3d8eyJFbXB0eU1hcGkiOnRydWUsIlYiOiIw
>>LjAuMDAwMCIsIlAiOiJXaW4zMiIsIkFOIjoiTWFpbCIsIldUIjoyfQ%3D%3D%7C0%7C%7C%
>>7C&sdata=gmzUs90%2Bccg4xxW8WHB2R4Tyb66r1tfKPdsQL2mHmUE%3D&reserved=0 -
>>\ HIER_DIRECT/206.188.0.52 - -/-
>
>yes, this looks like the username is not known to squid, thus probably bypassed authentication.
>what type of proxy authentication you use?
>
>>-----Original Message-----
>>From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf
>>Of Matus UHLAR - fantomas
>>Sent: Tuesday, November 12, 2024 10:10 AM
>>To: squid-users at lists.squid-cache.org
>>Subject: Re: [squid-users] Access Log Question
>>
>>Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.
>>
>>
>>On 12.11.24 14:56, Piana, Josh wrote:
>>> At some point, the access log has stopped recording which users are
>>> trying to access which sites.
>>>
>>> I'm currently thinking is could be an issue with log format, Squid
>>> not being able to receive the header information, or authentication
>>> is being bypassed completely due to our config, for some reason.
>>
>>what is it logging? doest is log "-" instead of usernames?
-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
"To Boot or not to Boot, that's the question." [WD1270 Caviar]


From Josh.Piana at hexcel.com  Tue Nov 12 15:43:06 2024
From: Josh.Piana at hexcel.com (Piana, Josh)
Date: Tue, 12 Nov 2024 15:43:06 +0000
Subject: [squid-users] Access Log Question
In-Reply-To: <ZzN0k6jxl3KdlTcS@fantomas.sk>
References: <b21c26fdbb5142f094b5bb0444df300f@hexcel.com>
 <ZzNvzCE9MQc3vNjj@fantomas.sk> <d07987b1bb384ca2b6fad86e976dcd91@hexcel.com>
 <ZzNxxumsPng2MiKY@fantomas.sk> <0a9c163145e04dfdb5cc6fd55f35e9a7@hexcel.com>
 <ZzN0k6jxl3KdlTcS@fantomas.sk>
Message-ID: <e37bef742abe49e18183d167f2f2c738@hexcel.com>

Yeah, we have a few. 

I'll try to detail them below, I apologize for any formatting weirdness. 

auth_param negotiate program /usr/lib64/squid/negotiate_kerberos_auth -k /etc/squid/HTTP.keytab -s HTTP/arcgate2.ad.arc-tech.com at AD.ARC-TECH.COM
auth_param negotiate children 10
auth_param negotiate keep_alive on
auth_param basic credentialsttl 2 hours
auth_param basic realm ArcTech Proxy Server

acl localhost src 10.46.11.69
acl localhost src 127.0.0.0/8          
acl localnet dst 10.0.0.0/8          
acl localnet dst 172.0.0.0/8           
acl localnet dst bldg3.arc-tech.com.  
acl localnet dst bldg5.arc-tech.com.   

acl SSL_ports port 443          
acl SSL_ports port 5001             
acl SSL_ports port 4434            
acl SSL_ports port 9251            
acl Safe_ports port 21             
acl Safe_ports port 22          
acl Safe_ports port 80           
acl Safe_ports port 443            
acl Safe_ports port 8080         
acl Safe_ports port 8443         
acl Safe_ports port 1025-65535

acl kerb-auth proxy_auth REQUIRED
acl CONNECT method CONNECT
acl local_dst_dom dstdomain arcgate2

http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports

http_access allow local_dst_dom
http_access allow localnet

acl bad_domains_preauth dstdomain "/etc/squid/bad_domains_preauth"
http_access deny bad_domains_preauth

#acl block_user proxy_auth_regex -i "/etc/squid/block_user"
#http_access deny block_user

acl bad_exception_urls url_regex -i "/etc/squid/bad_exception_urls"
http_access allow !bad_exception_urls

acl exec_files url_regex -i "/etc/squid/exec_files"
#acl exec_users proxy_auth_regex -i "/etc/squid/exec_users"
http_access deny !bad_exception_urls exec_files
deny_info ERR_BLOCK_TYPE exec_files

#acl mmedia_users proxy_auth_regex -i "/etc/squid/mmedia_users"
acl mmedia_sites dstdomain "/etc/squid/mmedia_sites"
http_access allow CONNECT safe_ports SSL_ports mmedia_sites

acl bad_domains dstdomain "/etc/squid/bad_domains"
http_access deny !bad_exception_urls bad_domains
deny_info ERR_BLOCK_DST bad_domains

acl bad_domains_regex dstdom_regex -i "/etc/squid/bad_domains_regex"
http_access deny !bad_exception_urls bad_domains_regex
deny_info ERR_BLOCK_DST bad_domains_regex

acl bad_urls url_regex -i "/etc/squid/bad_urls"
http_access deny !bad_exception_urls bad_urls
deny_info ERR_BLOCK_DST bad_urls

acl bad_files urlpath_regex -i "/etc/squid/bad_files"
http_access deny !bad_exception_urls bad_files
deny_info ERR_BLOCK_TYPE bad_files

http_access allow Safe_ports
http_access allow SSL_ports
http_access deny !kerb-auth
http_access allow kerb-auth
http_access deny all



-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Matus UHLAR - fantomas
Sent: Tuesday, November 12, 2024 10:30 AM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Access Log Question

Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.


On 12.11.24 15:22, Piana, Josh wrote:
>I seem to be able to generate tickets by checking klist, and using kinit to authenticate my username with AD. But it looks like the proxy is ignoring it. This could explain why all my proxy_auth ACL's stopped working too.
>
>
>Here's my authentication settings:
>auth_param negotiate children 10
>auth_param negotiate keep_alive on
>auth_param basic credentialsttl 2 hours auth_param basic realm 
><redacted> Proxy Server
>
>acl kerb-auth proxy_auth REQUIRED
>
>The bottom of my ACL Rules looks like this:
>http_access deny !kerb-auth
>http_access allow kerb-auth
>http_access deny all

The bottom? Are there any ACL rules that allow clients' access before this?
Because ACL rules are processed in the order they are specified.

>-----Original Message-----
>From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf 
>Of Matus UHLAR - fantomas
>Sent: Tuesday, November 12, 2024 10:19 AM
>To: squid-users at lists.squid-cache.org
>Subject: Re: [squid-users] Access Log Question
>
>Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.
>
>
>On 12.11.24 15:16, Piana, Josh wrote:
>>Seems like it.
>>
>>Example:
>>
>>12/Nov/2024:09:51:37 -0500.396 10.46.49.135 TCP_TUNNEL/200 23735 
>>CONNECT
>>http://www.s/
>>a%2F&data=05%7C02%7Cjosh.piana%40hexcel.com%7C781d9733572443bebebd08dd
>>032ef2d6%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C6386702223804901
>>51%7CUnknown%7CTWFpbGZsb3d8eyJFbXB0eU1hcGkiOnRydWUsIlYiOiIwLjAuMDAwMCI
>>sIlAiOiJXaW4zMiIsIkFOIjoiTWFpbCIsIldUIjoyfQ%3D%3D%7C0%7C%7C%7C&sdata=J
>>D5bPnmHAzYiBf0GEibkaOIItE5n7G5wQaTzYent9K4%3D&reserved=0
>>fgard.com%3A443%2F&data=05%7C02%7Cjosh.piana%40hexcel.com%7C1dd5a668cf
>>f
>>64041506f08dd032d47f6%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C638
>>6 
>>70215221064884%7CUnknown%7CTWFpbGZsb3d8eyJFbXB0eU1hcGkiOnRydWUsIlYiOiI
>>w 
>>LjAuMDAwMCIsIlAiOiJXaW4zMiIsIkFOIjoiTWFpbCIsIldUIjoyfQ%3D%3D%7C0%7C%7C
>>%
>>7C&sdata=gmzUs90%2Bccg4xxW8WHB2R4Tyb66r1tfKPdsQL2mHmUE%3D&reserved=0 - 
>>\ HIER_DIRECT/206.188.0.52 - -/-
>
>yes, this looks like the username is not known to squid, thus probably bypassed authentication.
>what type of proxy authentication you use?
>
>>-----Original Message-----
>>From: squid-users <squid-users-bounces at lists.squid-cache.org> On 
>>Behalf Of Matus UHLAR - fantomas
>>Sent: Tuesday, November 12, 2024 10:10 AM
>>To: squid-users at lists.squid-cache.org
>>Subject: Re: [squid-users] Access Log Question
>>
>>Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.
>>
>>
>>On 12.11.24 14:56, Piana, Josh wrote:
>>> At some point, the access log has stopped recording which users are 
>>> trying to access which sites.
>>>
>>> I'm currently thinking is could be an issue with log format, Squid 
>>> not being able to receive the header information, or authentication 
>>> is being bypassed completely due to our config, for some reason.
>>
>>what is it logging? doest is log "-" instead of usernames?
--
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
"To Boot or not to Boot, that's the question." [WD1270 Caviar] _______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
https://lists.squid-cache.org/listinfo/squid-users


From Josh.Piana at hexcel.com  Tue Nov 12 20:57:46 2024
From: Josh.Piana at hexcel.com (Piana, Josh)
Date: Tue, 12 Nov 2024 20:57:46 +0000
Subject: [squid-users] Access Log Question
References: <b21c26fdbb5142f094b5bb0444df300f@hexcel.com>
 <ZzNvzCE9MQc3vNjj@fantomas.sk> <d07987b1bb384ca2b6fad86e976dcd91@hexcel.com>
 <ZzNxxumsPng2MiKY@fantomas.sk> <0a9c163145e04dfdb5cc6fd55f35e9a7@hexcel.com>
 <ZzN0k6jxl3KdlTcS@fantomas.sk> 
Message-ID: <8beca80eada64c2a8f560c0da3d47ffa@hexcel.com>

Hello, 

I just reviewed all the steps for authentication Kerberos again. I'm unable to pinpoint any issues at all with the configuration from the keytab file, to the krb5.conf file, to the parameters used in the squid.conf file. And yet, I am surely bypassing the authentication entirely. 

Is there anyone who could help me with this? 

-----Original Message-----
From: Piana, Josh 
Sent: Tuesday, November 12, 2024 10:43 AM
To: squid-users at lists.squid-cache.org
Subject: RE: [squid-users] Access Log Question

Yeah, we have a few. 

I'll try to detail them below, I apologize for any formatting weirdness. 

auth_param negotiate program /usr/lib64/squid/negotiate_kerberos_auth -k /etc/squid/HTTP.keytab -s HTTP/arcgate2.ad.arc-tech.com at AD.ARC-TECH.COM
auth_param negotiate children 10
auth_param negotiate keep_alive on
auth_param basic credentialsttl 2 hours
auth_param basic realm ArcTech Proxy Server

acl localhost src 10.46.11.69
acl localhost src 127.0.0.0/8          
acl localnet dst 10.0.0.0/8          
acl localnet dst 172.0.0.0/8           
acl localnet dst bldg3.arc-tech.com.  
acl localnet dst bldg5.arc-tech.com.   

acl SSL_ports port 443          
acl SSL_ports port 5001             
acl SSL_ports port 4434            
acl SSL_ports port 9251            
acl Safe_ports port 21             
acl Safe_ports port 22          
acl Safe_ports port 80           
acl Safe_ports port 443            
acl Safe_ports port 8080         
acl Safe_ports port 8443         
acl Safe_ports port 1025-65535

acl kerb-auth proxy_auth REQUIRED
acl CONNECT method CONNECT
acl local_dst_dom dstdomain arcgate2

http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports

http_access allow local_dst_dom
http_access allow localnet

acl bad_domains_preauth dstdomain "/etc/squid/bad_domains_preauth"
http_access deny bad_domains_preauth

#acl block_user proxy_auth_regex -i "/etc/squid/block_user"
#http_access deny block_user

acl bad_exception_urls url_regex -i "/etc/squid/bad_exception_urls"
http_access allow !bad_exception_urls

acl exec_files url_regex -i "/etc/squid/exec_files"
#acl exec_users proxy_auth_regex -i "/etc/squid/exec_users"
http_access deny !bad_exception_urls exec_files deny_info ERR_BLOCK_TYPE exec_files

#acl mmedia_users proxy_auth_regex -i "/etc/squid/mmedia_users"
acl mmedia_sites dstdomain "/etc/squid/mmedia_sites"
http_access allow CONNECT safe_ports SSL_ports mmedia_sites

acl bad_domains dstdomain "/etc/squid/bad_domains"
http_access deny !bad_exception_urls bad_domains deny_info ERR_BLOCK_DST bad_domains

acl bad_domains_regex dstdom_regex -i "/etc/squid/bad_domains_regex"
http_access deny !bad_exception_urls bad_domains_regex deny_info ERR_BLOCK_DST bad_domains_regex

acl bad_urls url_regex -i "/etc/squid/bad_urls"
http_access deny !bad_exception_urls bad_urls deny_info ERR_BLOCK_DST bad_urls

acl bad_files urlpath_regex -i "/etc/squid/bad_files"
http_access deny !bad_exception_urls bad_files deny_info ERR_BLOCK_TYPE bad_files

http_access allow Safe_ports
http_access allow SSL_ports
http_access deny !kerb-auth
http_access allow kerb-auth
http_access deny all



-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Matus UHLAR - fantomas
Sent: Tuesday, November 12, 2024 10:30 AM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Access Log Question

Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.


On 12.11.24 15:22, Piana, Josh wrote:
>I seem to be able to generate tickets by checking klist, and using kinit to authenticate my username with AD. But it looks like the proxy is ignoring it. This could explain why all my proxy_auth ACL's stopped working too.
>
>
>Here's my authentication settings:
>auth_param negotiate children 10
>auth_param negotiate keep_alive on
>auth_param basic credentialsttl 2 hours auth_param basic realm 
><redacted> Proxy Server
>
>acl kerb-auth proxy_auth REQUIRED
>
>The bottom of my ACL Rules looks like this:
>http_access deny !kerb-auth
>http_access allow kerb-auth
>http_access deny all

The bottom? Are there any ACL rules that allow clients' access before this?
Because ACL rules are processed in the order they are specified.

>-----Original Message-----
>From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf 
>Of Matus UHLAR - fantomas
>Sent: Tuesday, November 12, 2024 10:19 AM
>To: squid-users at lists.squid-cache.org
>Subject: Re: [squid-users] Access Log Question
>
>Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.
>
>
>On 12.11.24 15:16, Piana, Josh wrote:
>>Seems like it.
>>
>>Example:
>>
>>12/Nov/2024:09:51:37 -0500.396 10.46.49.135 TCP_TUNNEL/200 23735 
>>CONNECT 
>>http://www.s/
>>a%2F&data=05%7C02%7Cjosh.piana%40hexcel.com%7C781d9733572443bebebd08dd
>>032ef2d6%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C6386702223804901
>>51%7CUnknown%7CTWFpbGZsb3d8eyJFbXB0eU1hcGkiOnRydWUsIlYiOiIwLjAuMDAwMCI
>>sIlAiOiJXaW4zMiIsIkFOIjoiTWFpbCIsIldUIjoyfQ%3D%3D%7C0%7C%7C%7C&sdata=J
>>D5bPnmHAzYiBf0GEibkaOIItE5n7G5wQaTzYent9K4%3D&reserved=0
>>fgard.com%3A443%2F&data=05%7C02%7Cjosh.piana%40hexcel.com%7C1dd5a668cf
>>f
>>64041506f08dd032d47f6%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C638
>>6
>>70215221064884%7CUnknown%7CTWFpbGZsb3d8eyJFbXB0eU1hcGkiOnRydWUsIlYiOiI
>>w
>>LjAuMDAwMCIsIlAiOiJXaW4zMiIsIkFOIjoiTWFpbCIsIldUIjoyfQ%3D%3D%7C0%7C%7C
>>%
>>7C&sdata=gmzUs90%2Bccg4xxW8WHB2R4Tyb66r1tfKPdsQL2mHmUE%3D&reserved=0 - 
>>\ HIER_DIRECT/206.188.0.52 - -/-
>
>yes, this looks like the username is not known to squid, thus probably bypassed authentication.
>what type of proxy authentication you use?
>
>>-----Original Message-----
>>From: squid-users <squid-users-bounces at lists.squid-cache.org> On 
>>Behalf Of Matus UHLAR - fantomas
>>Sent: Tuesday, November 12, 2024 10:10 AM
>>To: squid-users at lists.squid-cache.org
>>Subject: Re: [squid-users] Access Log Question
>>
>>Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.
>>
>>
>>On 12.11.24 14:56, Piana, Josh wrote:
>>> At some point, the access log has stopped recording which users are 
>>> trying to access which sites.
>>>
>>> I'm currently thinking is could be an issue with log format, Squid 
>>> not being able to receive the header information, or authentication 
>>> is being bypassed completely due to our config, for some reason.
>>
>>what is it logging? doest is log "-" instead of usernames?
--
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
"To Boot or not to Boot, that's the question." [WD1270 Caviar] _______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
https://lists.squid-cache.org/listinfo/squid-users


From squid3 at treenet.co.nz  Wed Nov 13 04:43:54 2024
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 13 Nov 2024 17:43:54 +1300
Subject: [squid-users] Access Log Question
In-Reply-To: <e37bef742abe49e18183d167f2f2c738@hexcel.com>
References: <b21c26fdbb5142f094b5bb0444df300f@hexcel.com>
 <ZzNvzCE9MQc3vNjj@fantomas.sk> <d07987b1bb384ca2b6fad86e976dcd91@hexcel.com>
 <ZzNxxumsPng2MiKY@fantomas.sk> <0a9c163145e04dfdb5cc6fd55f35e9a7@hexcel.com>
 <ZzN0k6jxl3KdlTcS@fantomas.sk> <e37bef742abe49e18183d167f2f2c738@hexcel.com>
Message-ID: <13223f9a-69cc-4617-a0b2-05686e12671d@treenet.co.nz>



12/Nov/2024:09:51:37 -0500.396 10.46.49.135 TCP_TUNNEL/200 23735 CONNECT 
http://www.safgard.com:443/ - \ HIER_DIRECT/206.188.0.52 - -/-


> acl localnet dst 10.0.0.0/8

...

> http_access allow localnet
> 

.. never gets here.

> http_access deny !kerb-auth
> http_access allow kerb-auth
> http_access deny all
> 


HTH
Amos



From Josh.Piana at hexcel.com  Wed Nov 13 13:00:44 2024
From: Josh.Piana at hexcel.com (Piana, Josh)
Date: Wed, 13 Nov 2024 13:00:44 +0000
Subject: [squid-users] Access Log Question
In-Reply-To: <13223f9a-69cc-4617-a0b2-05686e12671d@treenet.co.nz>
References: <b21c26fdbb5142f094b5bb0444df300f@hexcel.com>
 <ZzNvzCE9MQc3vNjj@fantomas.sk> <d07987b1bb384ca2b6fad86e976dcd91@hexcel.com>
 <ZzNxxumsPng2MiKY@fantomas.sk> <0a9c163145e04dfdb5cc6fd55f35e9a7@hexcel.com>
 <ZzN0k6jxl3KdlTcS@fantomas.sk> <e37bef742abe49e18183d167f2f2c738@hexcel.com>
 <13223f9a-69cc-4617-a0b2-05686e12671d@treenet.co.nz>
Message-ID: <acf2aa1a24e243968e5e7fa66665fa66@hexcel.com>

Amos, 

OH. 

Is this because I'm defining the localnet and then the response rule just allows all traffic from this network? 

My intention was to specify the localnet, then allow traffic from that network as it filters through all the other ACL's. So should I remove the rule entirely or change the order? 

Thanks, 
Josh 

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Amos Jeffries
Sent: Tuesday, November 12, 2024 11:44 PM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Access Log Question

Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.


12/Nov/2024:09:51:37 -0500.396 10.46.49.135 TCP_TUNNEL/200 23735 CONNECT
http://www.safgard.com:443/ - \ HIER_DIRECT/206.188.0.52 - -/-


> acl localnet dst 10.0.0.0/8

...

> http_access allow localnet
>

.. never gets here.

> http_access deny !kerb-auth
> http_access allow kerb-auth
> http_access deny all
>


HTH
Amos

_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
https://lists.squid-cache.org/listinfo/squid-users


From uhlar at fantomas.sk  Wed Nov 13 13:39:57 2024
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Wed, 13 Nov 2024 14:39:57 +0100
Subject: [squid-users] Access Log Question
In-Reply-To: <acf2aa1a24e243968e5e7fa66665fa66@hexcel.com>
References: <b21c26fdbb5142f094b5bb0444df300f@hexcel.com>
 <ZzNvzCE9MQc3vNjj@fantomas.sk>
 <d07987b1bb384ca2b6fad86e976dcd91@hexcel.com>
 <ZzNxxumsPng2MiKY@fantomas.sk>
 <0a9c163145e04dfdb5cc6fd55f35e9a7@hexcel.com>
 <ZzN0k6jxl3KdlTcS@fantomas.sk>
 <e37bef742abe49e18183d167f2f2c738@hexcel.com>
 <13223f9a-69cc-4617-a0b2-05686e12671d@treenet.co.nz>
 <acf2aa1a24e243968e5e7fa66665fa66@hexcel.com>
Message-ID: <ZzSsLedPOb1_PqS4@fantomas.sk>

On 13.11.24 13:00, Piana, Josh wrote:
> Is this because I'm defining the localnet and then the response rule just 
> allows all traffic from this network?
>
> My intention was to specify the localnet, then allow traffic from that 
> network as it filters through all the other ACL's.  So should I remove the 
> rule entirely or change the order?

you did not allow "from that network", you have allowed traffic "to that 
network" because localnet is defined as "dst "
- this may cause confusion, I recomment changing this acl to "to_localnet"

I believe your problem is:

http_access allow !bad_exception_urls

- here you allowed access to anywhere except the URLS in 
/etc/squid/bad_exception_urls, so further http_access rules will get 
evaluated only if someone tried to access URLs in that file.

I guess you want to deny access to them thus use instead:

acl bad_exception_urls url_regex -i "/etc/squid/bad_exception_urls"
http_access deny bad_exception_urls


also note that url_regex rules may be very CPU intensive, you should avoid 
them

>-----Original Message-----
>From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Amos Jeffries
>Sent: Tuesday, November 12, 2024 11:44 PM
>To: squid-users at lists.squid-cache.org
>Subject: Re: [squid-users] Access Log Question
>
>Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.
>
>
>12/Nov/2024:09:51:37 -0500.396 10.46.49.135 TCP_TUNNEL/200 23735 CONNECT
>http://www.safgard.com:443/ - \ HIER_DIRECT/206.188.0.52 - -/-
>
>
>> acl localnet dst 10.0.0.0/8
>
>...
>
>> http_access allow localnet
>>
>
>.. never gets here.
>
>> http_access deny !kerb-auth
>> http_access allow kerb-auth
>> http_access deny all

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Windows 2000: 640 MB ought to be enough for anybody


From squid3 at treenet.co.nz  Wed Nov 13 22:27:34 2024
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 14 Nov 2024 11:27:34 +1300
Subject: [squid-users] Access Log Question
In-Reply-To: <ZzSsLedPOb1_PqS4@fantomas.sk>
References: <b21c26fdbb5142f094b5bb0444df300f@hexcel.com>
 <ZzNvzCE9MQc3vNjj@fantomas.sk> <d07987b1bb384ca2b6fad86e976dcd91@hexcel.com>
 <ZzNxxumsPng2MiKY@fantomas.sk> <0a9c163145e04dfdb5cc6fd55f35e9a7@hexcel.com>
 <ZzN0k6jxl3KdlTcS@fantomas.sk> <e37bef742abe49e18183d167f2f2c738@hexcel.com>
 <13223f9a-69cc-4617-a0b2-05686e12671d@treenet.co.nz>
 <acf2aa1a24e243968e5e7fa66665fa66@hexcel.com> <ZzSsLedPOb1_PqS4@fantomas.sk>
Message-ID: <98f26c69-4457-490b-ac0b-db2b7aff9891@treenet.co.nz>

On 14/11/24 02:39, Matus UHLAR - fantomas wrote:
> On 13.11.24 13:00, Piana, Josh wrote:
>> Is this because I'm defining the localnet and then the response rule 
>> just allows all traffic from this network?
>>
>> My intention was to specify the localnet, then allow traffic from that 
>> network as it filters through all the other ACL's.? So should I remove 
>> the rule entirely or change the order?
> 
> you did not allow "from that network", you have allowed traffic "to that 
> network" because localnet is defined as "dst "
> - this may cause confusion, I recomment changing this acl to "to_localnet"

Ouch. Yes quite right. Thank you Matus.

> 
> I believe your problem is:
> 
> http_access allow !bad_exception_urls
> 
> - here you allowed access to anywhere except the URLS in /etc/squid/ 
> bad_exception_urls, so further http_access rules will get evaluated only 
> if someone tried to access URLs in that file.
> 
> I guess you want to deny access to them thus use instead:
> 
> acl bad_exception_urls url_regex -i "/etc/squid/bad_exception_urls"
> http_access deny bad_exception_urls
> 
> 
> also note that url_regex rules may be very CPU intensive, you should 
> avoid them
> 


Cheers
Amos


From slagauterie at hotmail.com  Thu Nov 14 18:15:06 2024
From: slagauterie at hotmail.com (slagauterie at hotmail.com)
Date: Thu, 14 Nov 2024 19:15:06 +0100
Subject: [squid-users] [SQUID] Some Web Page never complete download
Message-ID: <GVXP189MB20313026A466D661A778C5CCAD5B2@GVXP189MB2031.EURP189.PROD.OUTLOOK.COM>

Hello,

This is my first mail to this list, my apologies if things are not
correct.

I am using squid at home for more than 5 years. Recently I have updated
my version from version 6.0 (early age) to the latest version 6.12.

I am compiling my own binaries and run it in a docker container.

Unfortunately, I am facing an issue with all Squid version above 6.8
(included).

I have some web sites like www.google.com for which my browser never
complete the download of the page. There is a pending request to URIs
like?https://www.google.com/xjs/_/js/k=xjs.s.... and after long time
(timeout) Squid logs a TCP_MISS_ABORTED/200.

I have downgraded till version 6.7, and it works a older version, even
if the same kind of request ends by a NONE_NONE_ABORTED/000. The
request does not stay pending.

I can provide more information if it can help to investigate.

Configuration:
- Squid Version >= 6.8 (Compiled, with bumping configuration and
certificate mimic)
- C-ICAP Version 0.6.3 (Compiled)
- SquidClamAV Version 7.3 (Compiled)
- UfdbGuard Version 1.35.8 (Compiled)

Thank you for your help.

Regards,
Slag


From rousskov at measurement-factory.com  Thu Nov 14 18:31:22 2024
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Thu, 14 Nov 2024 13:31:22 -0500
Subject: [squid-users] [SQUID] Some Web Page never complete download
In-Reply-To: <GVXP189MB20313026A466D661A778C5CCAD5B2@GVXP189MB2031.EURP189.PROD.OUTLOOK.COM>
References: <GVXP189MB20313026A466D661A778C5CCAD5B2@GVXP189MB2031.EURP189.PROD.OUTLOOK.COM>
Message-ID: <6af8824e-bc1f-4c2a-a6ff-f5e4d25b95c2@measurement-factory.com>

On 2024-11-14 13:15, slagauterie at hotmail.com wrote:

> Recently I have updated
> my version from version 6.0 (early age) to the latest version 6.12.

> I have some web sites like www.google.com for which my browser never
> complete the download of the page. There is a pending request to URIs
> like?https://www.google.com/xjs/_/js/k=xjs.s.... and after long time
> (timeout) Squid logs a TCP_MISS_ABORTED/200.

It sounds like you can easily reproduce the problem using a few 
transactions. I recommend collecting full debugging and privately 
sharing a pointer to compressed cache.log for further analysis. You will 
find some relevant hints at

https://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction

HTH,

Alex.


> I have downgraded till version 6.7, and it works a older version, even
> if the same kind of request ends by a NONE_NONE_ABORTED/000. The
> request does not stay pending.
> 
> I can provide more information if it can help to investigate.
> 
> Configuration:
> - Squid Version >= 6.8 (Compiled, with bumping configuration and
> certificate mimic)
> - C-ICAP Version 0.6.3 (Compiled)
> - SquidClamAV Version 7.3 (Compiled)
> - UfdbGuard Version 1.35.8 (Compiled)
> 
> Thank you for your help.
> 
> Regards,
> Slag
> 




From ankor2023 at gmail.com  Fri Nov 15 06:45:00 2024
From: ankor2023 at gmail.com (Andrey K)
Date: Fri, 15 Nov 2024 09:45:00 +0300
Subject: [squid-users] [SQUID] Some Web Page never complete download
In-Reply-To: <6af8824e-bc1f-4c2a-a6ff-f5e4d25b95c2@measurement-factory.com>
References: <GVXP189MB20313026A466D661A778C5CCAD5B2@GVXP189MB2031.EURP189.PROD.OUTLOOK.COM>
 <6af8824e-bc1f-4c2a-a6ff-f5e4d25b95c2@measurement-factory.com>
Message-ID: <CADJd0Y1u3XRoFXQo631X0_gx=-e6PLA1tje66_T-XajtNYzXBA@mail.gmail.com>

Hello, Slag,

The symptoms look like you are suffering from the bug:
https://bugs.squid-cache.org/show_bug.cgi?id=5352

The solution is applying the patch:
https://github.com/measurement-factory/squid/commit/6567eac.patch

Kind regards,
    Ankor.


??, 14 ????. 2024??. ? 21:31, Alex Rousskov <
rousskov at measurement-factory.com>:

> On 2024-11-14 13:15, slagauterie at hotmail.com wrote:
>
> > Recently I have updated
> > my version from version 6.0 (early age) to the latest version 6.12.
>
> > I have some web sites like www.google.com for which my browser never
> > complete the download of the page. There is a pending request to URIs
> > like https://www.google.com/xjs/_/js/k=xjs.s.... and after long time
> > (timeout) Squid logs a TCP_MISS_ABORTED/200.
>
> It sounds like you can easily reproduce the problem using a few
> transactions. I recommend collecting full debugging and privately
> sharing a pointer to compressed cache.log for further analysis. You will
> find some relevant hints at
>
>
> https://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction
>
> HTH,
>
> Alex.
>
>
> > I have downgraded till version 6.7, and it works a older version, even
> > if the same kind of request ends by a NONE_NONE_ABORTED/000. The
> > request does not stay pending.
> >
> > I can provide more information if it can help to investigate.
> >
> > Configuration:
> > - Squid Version >= 6.8 (Compiled, with bumping configuration and
> > certificate mimic)
> > - C-ICAP Version 0.6.3 (Compiled)
> > - SquidClamAV Version 7.3 (Compiled)
> > - UfdbGuard Version 1.35.8 (Compiled)
> >
> > Thank you for your help.
> >
> > Regards,
> > Slag
> >
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> https://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20241115/d02a7408/attachment.htm>

From slagauterie at hotmail.com  Sat Nov 16 11:38:46 2024
From: slagauterie at hotmail.com (slagauterie at hotmail.com)
Date: Sat, 16 Nov 2024 12:38:46 +0100
Subject: [squid-users] [SQUID] Some Web Page never complete download
In-Reply-To: <CADJd0Y1u3XRoFXQo631X0_gx=-e6PLA1tje66_T-XajtNYzXBA@mail.gmail.com>
References: <GVXP189MB20313026A466D661A778C5CCAD5B2@GVXP189MB2031.EURP189.PROD.OUTLOOK.COM>
 <6af8824e-bc1f-4c2a-a6ff-f5e4d25b95c2@measurement-factory.com>
 <CADJd0Y1u3XRoFXQo631X0_gx=-e6PLA1tje66_T-XajtNYzXBA@mail.gmail.com>
Message-ID: <GVXP189MB2031F97C6EB149A67D0DB46BAD252@GVXP189MB2031.EURP189.PROD.OUTLOOK.COM>

Hello Ankor,

thanks for this information regarding the patch.

I have recompiled version 6.12 with this patch, and it solves the issue
as far as I can test.

I plan to publish my Docker file in the future, but it is still in
developement for automatic deployement of a container (need to upgrade
starting script for example).

But all features are working if you give a correct Squid configuration.
If someone is interested, to run Squid v6.xx and some addons (C-Icap
server, UfdbGuard, squidclamav, more coming later) in a Docker
container (easy for testing), you can PM me.

Regards,
Slag

Le vendredi 15 novembre 2024 ? 09:45 +0300, Andrey K a ?crit?:
> Hello, Slag,
> 
> The symptoms look like you are suffering from the bug:
> https://bugs.squid-cache.org/show_bug.cgi?id=5352
> 
> The solution is applying the patch:
> https://github.com/measurement-factory/squid/commit/6567eac.patch
> 
> Kind regards,
> ? ? Ankor.
> ?
> 
> ??, 14 ????. 2024??. ? 21:31, Alex Rousskov
> <rousskov at measurement-factory.com>:
> > On 2024-11-14 13:15, slagauterie at hotmail.com wrote:
> > 
> > > Recently I have updated
> > > my version from version 6.0 (early age) to the latest version
> > > 6.12.
> > 
> > > I have some web sites like www.google.com for which my browser
> > > never
> > > complete the download of the page. There is a pending request to
> > > URIs
> > > like?https://www.google.com/xjs/_/js/k=xjs.s.... and after long
> > > time
> > > (timeout) Squid logs a TCP_MISS_ABORTED/200.
> > 
> > It sounds like you can easily reproduce the problem using a few 
> > transactions. I recommend collecting full debugging and privately 
> > sharing a pointer to compressed cache.log for further analysis. You
> > will 
> > find some relevant hints at
> > 
> > https://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction
> > 
> > HTH,
> > 
> > Alex.
> > 
> > 
> > > I have downgraded till version 6.7, and it works a older version,
> > > even
> > > if the same kind of request ends by a NONE_NONE_ABORTED/000. The
> > > request does not stay pending.
> > > 
> > > I can provide more information if it can help to investigate.
> > > 
> > > Configuration:
> > > - Squid Version >= 6.8 (Compiled, with bumping configuration and
> > > certificate mimic)
> > > - C-ICAP Version 0.6.3 (Compiled)
> > > - SquidClamAV Version 7.3 (Compiled)
> > > - UfdbGuard Version 1.35.8 (Compiled)
> > > 
> > > Thank you for your help.
> > > 
> > > Regards,
> > > Slag
> > > 
> > 
> > 
> > _______________________________________________
> > squid-users mailing list
> > squid-users at lists.squid-cache.org
> > https://lists.squid-cache.org/listinfo/squid-users
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> https://lists.squid-cache.org/listinfo/squid-users


From ngtech1ltd at gmail.com  Sat Nov 16 15:55:59 2024
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Sat, 16 Nov 2024 17:55:59 +0200
Subject: [squid-users] [SQUID] Some Web Page never complete download
In-Reply-To: <GVXP189MB20313026A466D661A778C5CCAD5B2@GVXP189MB2031.EURP189.PROD.OUTLOOK.COM>
References: <GVXP189MB20313026A466D661A778C5CCAD5B2@GVXP189MB2031.EURP189.PROD.OUTLOOK.COM>
Message-ID: <001501db3840$086068c0$19213a40$@gmail.com>

Hey Slag,

I want to understand the setup a bit more then what's written already.
The Squid instance you are using, is it a simple forward proxy or an interception one?
The C-ICAP is used with SquidClamAV? Are there any other C-ICAP functions you are using?
What are you using UfdbGuard for? 

Thanks,
Eliezer

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of slagauterie at hotmail.com
Sent: Thursday, November 14, 2024 8:15 PM
To: squid-users at lists.squid-cache.org
Subject: [squid-users] [SQUID] Some Web Page never complete download

Hello,

This is my first mail to this list, my apologies if things are not correct.

I am using squid at home for more than 5 years. Recently I have updated my version from version 6.0 (early age) to the latest version 6.12.

I am compiling my own binaries and run it in a docker container.

Unfortunately, I am facing an issue with all Squid version above 6.8 (included).

I have some web sites like www.google.com for which my browser never complete the download of the page. There is a pending request to URIs like https://www.google.com/xjs/_/js/k=xjs.s.... and after long time
(timeout) Squid logs a TCP_MISS_ABORTED/200.

I have downgraded till version 6.7, and it works a older version, even if the same kind of request ends by a NONE_NONE_ABORTED/000. The request does not stay pending.

I can provide more information if it can help to investigate.

Configuration:
- Squid Version >= 6.8 (Compiled, with bumping configuration and certificate mimic)
- C-ICAP Version 0.6.3 (Compiled)
- SquidClamAV Version 7.3 (Compiled)
- UfdbGuard Version 1.35.8 (Compiled)

Thank you for your help.

Regards,
Slag
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
https://lists.squid-cache.org/listinfo/squid-users



From slagauterie at hotmail.com  Sat Nov 16 18:07:46 2024
From: slagauterie at hotmail.com (slagauterie at hotmail.com)
Date: Sat, 16 Nov 2024 19:07:46 +0100
Subject: [squid-users] [SQUID] Some Web Page never complete download
In-Reply-To: <001501db3840$086068c0$19213a40$@gmail.com>
References: <GVXP189MB20313026A466D661A778C5CCAD5B2@GVXP189MB2031.EURP189.PROD.OUTLOOK.COM>
 <001501db3840$086068c0$19213a40$@gmail.com>
Message-ID: <GVXP189MB20316DAEBE035C0F4B66F707AD252@GVXP189MB2031.EURP189.PROD.OUTLOOK.COM>

Hello Eliezer,

I use it as a standard forward proxy. I use a proxy.pac file deployed
via DHCP and DNS WPAD entry. This makes it works easily with browsers.

10 years ago, I was doing both, but Squid was running on a DMZ server.
It was also acting as a firewall and other things.

Now, it is only forward. The main purpose is to prevent kids to access
"wrong site" and remove ads.

Regarding C-ICAP, only squidclamav, connected to a dedicated Clamav 
container for virus checking.
Few years ago, ClamAV was in the same container, but for me it breaks a
little bit the "One service" approach of conteiners.
I plan to also use DNSBL. But before, I need to fully understand how it
can help or what it can improve.

Finally, I use ufdbguard instead of squidguard because it is still and
well developed. It is also faster. Its main purpose is for URL
checking. With it I mainly avoid:
- Trackers
- Ads
- Adults
- Violence, aggressive, weapon, etc.
- Warez

The next step will probably be to move ufdbguard out, in its dedicated
container (One service approach).

At the begining, compiling was the main difficulty to produce Docker
images. Then, I learn how to do multi-level image. So I can compile in
one image, and use the result for other images, keeping the final image
as small as possible, without all developper packages.

The main reasons why I currently don't use Squid to intercept are:
- My Docker server is a NAS. So not as powerfull as a real server. I
tend to limit traffic.
- With the bump process and all the TLS approach, too many thing do not
work out of the box for smartphone and their applications... Most of
them are doing Certificate Pinning for example, which is broken by
"standard" bumping and certificate mimic.

Note: I have not yet looked at all C-ICAP modules available. Feel free
to recommend some.

Regards,
Slag

Le samedi 16 novembre 2024 ? 17:55 +0200, ngtech1ltd at gmail.com a
?crit?:
> Hey Slag,
> 
> I want to understand the setup a bit more then what's written
> already.
> The Squid instance you are using, is it a simple forward proxy or an
> interception one?
> The C-ICAP is used with SquidClamAV? Are there any other C-ICAP
> functions you are using?
> What are you using UfdbGuard for? 
> 
> Thanks,
> Eliezer
> 
> -----Original Message-----
> From: squid-users <squid-users-bounces at lists.squid-cache.org> On
> Behalf Of slagauterie at hotmail.com
> Sent: Thursday, November 14, 2024 8:15 PM
> To: squid-users at lists.squid-cache.org
> Subject: [squid-users] [SQUID] Some Web Page never complete download
> 
> Hello,
> 
> This is my first mail to this list, my apologies if things are not
> correct.
> 
> I am using squid at home for more than 5 years. Recently I have
> updated my version from version 6.0 (early age) to the latest version
> 6.12.
> 
> I am compiling my own binaries and run it in a docker container.
> 
> Unfortunately, I am facing an issue with all Squid version above 6.8
> (included).
> 
> I have some web sites like www.google.com?for which my browser never
> complete the download of the page. There is a pending request to URIs
> like https://www.google.com/xjs/_/js/k=xjs.s.... and after long time
> (timeout) Squid logs a TCP_MISS_ABORTED/200.
> 
> I have downgraded till version 6.7, and it works a older version,
> even if the same kind of request ends by a NONE_NONE_ABORTED/000. The
> request does not stay pending.
> 
> I can provide more information if it can help to investigate.
> 
> Configuration:
> - Squid Version >= 6.8 (Compiled, with bumping configuration and
> certificate mimic)
> - C-ICAP Version 0.6.3 (Compiled)
> - SquidClamAV Version 7.3 (Compiled)
> - UfdbGuard Version 1.35.8 (Compiled)
> 
> Thank you for your help.
> 
> Regards,
> Slag
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> https://lists.squid-cache.org/listinfo/squid-users
> 


From ngtech1ltd at gmail.com  Sun Nov 17 23:23:54 2024
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Mon, 18 Nov 2024 01:23:54 +0200
Subject: [squid-users] [SQUID] Some Web Page never complete download
In-Reply-To: <GVXP189MB20316DAEBE035C0F4B66F707AD252@GVXP189MB2031.EURP189.PROD.OUTLOOK.COM>
References: <GVXP189MB20313026A466D661A778C5CCAD5B2@GVXP189MB2031.EURP189.PROD.OUTLOOK.COM>	
 <001501db3840$086068c0$19213a40$@gmail.com>
 <GVXP189MB20316DAEBE035C0F4B66F707AD252@GVXP189MB2031.EURP189.PROD.OUTLOOK.COM>
Message-ID: <013901db3947$c5d0fa70$5172ef50$@gmail.com>

Great to hear all the details.
My general approach is to not intercept if possible.
In my Setup I am using squid only as an assisting software.
I wrote many tools to give squid features which are similar to other products like fortigate and checkpoint.
All the products in the market are using very basic inspections else then PaloAlto.
However, PaloAlto is an overkill for a tiny setup.
I like ufdbguard but I believe that there are other options which can be written in a much simpler way for my needs.
Ufdbguard is a great piece of software but I suggest you to use a DNSBL helper with a caching proxy for public DNS filtering services like cloudflare and others.
This way you don't need to maintain a local copy of the lists else then your custom to your choice.
I have used a set of unbound dns caching containers and a set of external helpers that are querying these caching dns services.
The overall effect is pretty good and the bandwidth worth it compared to the investment in maintaining lists.
Also you can use adguard as a container with specific lists compared to ufdbguard and a helper that runs queries against it.
The overall requirements are a bit higher but you can get clearer picture with statistics.

It would be very nice to try and sit on such a setup in a zoom meeting if it's of any interest for you to show me yours and I will show you mine.

Yours,
Eliezer

-----Original Message-----
From: slagauterie at hotmail.com <slagauterie at hotmail.com> 
Sent: Saturday, November 16, 2024 8:08 PM
To: ngtech1ltd at gmail.com; squid-users at lists.squid-cache.org
Subject: Re: [squid-users] [SQUID] Some Web Page never complete download

Hello Eliezer,

I use it as a standard forward proxy. I use a proxy.pac file deployed via DHCP and DNS WPAD entry. This makes it works easily with browsers.

10 years ago, I was doing both, but Squid was running on a DMZ server.
It was also acting as a firewall and other things.

Now, it is only forward. The main purpose is to prevent kids to access "wrong site" and remove ads.

Regarding C-ICAP, only squidclamav, connected to a dedicated Clamav container for virus checking.
Few years ago, ClamAV was in the same container, but for me it breaks a little bit the "One service" approach of conteiners.
I plan to also use DNSBL. But before, I need to fully understand how it can help or what it can improve.

Finally, I use ufdbguard instead of squidguard because it is still and well developed. It is also faster. Its main purpose is for URL checking. With it I mainly avoid:
- Trackers
- Ads
- Adults
- Violence, aggressive, weapon, etc.
- Warez

The next step will probably be to move ufdbguard out, in its dedicated container (One service approach).

At the begining, compiling was the main difficulty to produce Docker images. Then, I learn how to do multi-level image. So I can compile in one image, and use the result for other images, keeping the final image as small as possible, without all developper packages.

The main reasons why I currently don't use Squid to intercept are:
- My Docker server is a NAS. So not as powerfull as a real server. I tend to limit traffic.
- With the bump process and all the TLS approach, too many thing do not work out of the box for smartphone and their applications... Most of them are doing Certificate Pinning for example, which is broken by "standard" bumping and certificate mimic.

Note: I have not yet looked at all C-ICAP modules available. Feel free to recommend some.

Regards,
Slag

Le samedi 16 novembre 2024 ? 17:55 +0200, ngtech1ltd at gmail.com a ?crit :
> Hey Slag,
> 
> I want to understand the setup a bit more then what's written already.
> The Squid instance you are using, is it a simple forward proxy or an 
> interception one?
> The C-ICAP is used with SquidClamAV? Are there any other C-ICAP 
> functions you are using?
> What are you using UfdbGuard for? 
> 
> Thanks,
> Eliezer
> 
> -----Original Message-----
> From: squid-users <squid-users-bounces at lists.squid-cache.org> On 
> Behalf Of slagauterie at hotmail.com
> Sent: Thursday, November 14, 2024 8:15 PM
> To: squid-users at lists.squid-cache.org
> Subject: [squid-users] [SQUID] Some Web Page never complete download
> 
> Hello,
> 
> This is my first mail to this list, my apologies if things are not 
> correct.
> 
> I am using squid at home for more than 5 years. Recently I have 
> updated my version from version 6.0 (early age) to the latest version 
> 6.12.
> 
> I am compiling my own binaries and run it in a docker container.
> 
> Unfortunately, I am facing an issue with all Squid version above 6.8 
> (included).
> 
> I have some web sites like www.google.com for which my browser never 
> complete the download of the page. There is a pending request to URIs 
> like https://www.google.com/xjs/_/js/k=xjs.s.... and after long time
> (timeout) Squid logs a TCP_MISS_ABORTED/200.
> 
> I have downgraded till version 6.7, and it works a older version, even 
> if the same kind of request ends by a NONE_NONE_ABORTED/000. The 
> request does not stay pending.
> 
> I can provide more information if it can help to investigate.
> 
> Configuration:
> - Squid Version >= 6.8 (Compiled, with bumping configuration and 
> certificate mimic)
> - C-ICAP Version 0.6.3 (Compiled)
> - SquidClamAV Version 7.3 (Compiled)
> - UfdbGuard Version 1.35.8 (Compiled)
> 
> Thank you for your help.
> 
> Regards,
> Slag
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> https://lists.squid-cache.org/listinfo/squid-users
> 



From gaedeb01 at gmail.com  Sun Nov 17 23:41:09 2024
From: gaedeb01 at gmail.com (Gaetano)
Date: Mon, 18 Nov 2024 00:41:09 +0100
Subject: [squid-users] assertion failed: Controller.cc:930: "EX"
Message-ID: <CAJ8z1QXcTizbmc2Uon5XjxQG6mAXrfdUfvU9hhVsps0MomBANw@mail.gmail.com>

Hi all,

We are running three squid proxy 5.5, on three different VMs, same
number of CPUs (4), same memory, and same FS type (xfs) on Alma Linux
9.
All servers are staged with Ansible and they all have the same squid.conf.

workers 4
...
cache_dir ufs /var/spool/squid 512 16 256

One of those servers (always the same) crashes with this assert:
 kid1| assertion failed: Controller.cc:930: "EX"
kid can be from 1 to 4

everytime we enter a simple curl request to localhost proxy and proxy
to an OCSP responder.

Everything works fine when we remove workers as explained in an old
post about ufs and multithreading:
https://lists.squid-cache.org/pipermail/squid-users/2021-November/024285.html

However, why don't the other two proxies suffer from the same issue?

Removing  /var/spool/squid/* (+ squid -z) makes things work for a
little while, then again Empty response from the server (=> assertion
failed: Controller.cc:930: "EX").
So somehow it seems related to the cache and/or the response.

Any ideas that could help to understand the problem?

Thank you!


From rousskov at measurement-factory.com  Mon Nov 18 02:21:05 2024
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Sun, 17 Nov 2024 21:21:05 -0500
Subject: [squid-users] assertion failed: Controller.cc:930: "EX"
In-Reply-To: <CAJ8z1QXcTizbmc2Uon5XjxQG6mAXrfdUfvU9hhVsps0MomBANw@mail.gmail.com>
References: <CAJ8z1QXcTizbmc2Uon5XjxQG6mAXrfdUfvU9hhVsps0MomBANw@mail.gmail.com>
Message-ID: <413952ae-14c3-4800-9928-13b4bbe27c20@measurement-factory.com>

On 2024-11-17 18:41, Gaetano wrote:

> We are running three squid proxy 5.5,

Please note that Squid Project does not support Squid v5. I recommend 
upgrading to Squid v6+ (regardless of what your Linux distribution 
currently ships).


> on three different VMs, same
> number of CPUs (4), same memory, and same FS type (xfs) on Alma Linux
> 9.
> All servers are staged with Ansible and they all have the same squid.conf.
> 
> workers 4
> ...
> cache_dir ufs /var/spool/squid 512 16 256

As you probably know from that earlier thread, this combination is not 
supported and is likely to trigger HTTP violations and undefined 
behavior. The only supported cache_dir type for SMP Squids is rock.


> One of those servers (always the same) crashes with this assert:
>   kid1| assertion failed: Controller.cc:930: "EX"
> kid can be from 1 to 4

BTW, that bogus exception text "EX" is a bug. It was fixed in Squid v6. 
Squid v5.10 has a backport of that fix.


> Everything works fine when we remove workers as explained in an old
> post about ufs and multithreading:
> https://lists.squid-cache.org/pipermail/squid-users/2021-November/024285.html
> 
> However, why don't the other two proxies suffer from the same issue?
> 
> Removing  /var/spool/squid/* (+ squid -z) makes things work for a
> little while, then again Empty response from the server (=> assertion
> failed: Controller.cc:930: "EX").
> So somehow it seems related to the cache and/or the response.
> 
> Any ideas that could help to understand the problem?

I cannot help with understanding why undefined Squid behavior in an 
unsupported configuration manifests itself this particular way, but I 
hope that switching to a supported version and configuration helps avoid 
this problem.


Good luck,

Alex.



From gaedeb01 at gmail.com  Mon Nov 18 08:19:07 2024
From: gaedeb01 at gmail.com (Gaetano)
Date: Mon, 18 Nov 2024 09:19:07 +0100
Subject: [squid-users] assertion failed: Controller.cc:930: "EX"
In-Reply-To: <413952ae-14c3-4800-9928-13b4bbe27c20@measurement-factory.com>
References: <CAJ8z1QXcTizbmc2Uon5XjxQG6mAXrfdUfvU9hhVsps0MomBANw@mail.gmail.com>
 <413952ae-14c3-4800-9928-13b4bbe27c20@measurement-factory.com>
Message-ID: <CAJ8z1QXFeV9ZVBgvY8S_Qa69N3RF+OCiJqWUKfEG3iZRsqzCVQ@mail.gmail.com>

Thank you Alex for your prompt feedback!

Cheers,
Gaetano

On Mon, Nov 18, 2024 at 3:21?AM Alex Rousskov
<rousskov at measurement-factory.com> wrote:
>
> On 2024-11-17 18:41, Gaetano wrote:
>
> > We are running three squid proxy 5.5,
>
> Please note that Squid Project does not support Squid v5. I recommend
> upgrading to Squid v6+ (regardless of what your Linux distribution
> currently ships).
>
>
> > on three different VMs, same
> > number of CPUs (4), same memory, and same FS type (xfs) on Alma Linux
> > 9.
> > All servers are staged with Ansible and they all have the same squid.conf.
> >
> > workers 4
> > ...
> > cache_dir ufs /var/spool/squid 512 16 256
>
> As you probably know from that earlier thread, this combination is not
> supported and is likely to trigger HTTP violations and undefined
> behavior. The only supported cache_dir type for SMP Squids is rock.
>
>
> > One of those servers (always the same) crashes with this assert:
> >   kid1| assertion failed: Controller.cc:930: "EX"
> > kid can be from 1 to 4
>
> BTW, that bogus exception text "EX" is a bug. It was fixed in Squid v6.
> Squid v5.10 has a backport of that fix.
>
>
> > Everything works fine when we remove workers as explained in an old
> > post about ufs and multithreading:
> > https://lists.squid-cache.org/pipermail/squid-users/2021-November/024285.html
> >
> > However, why don't the other two proxies suffer from the same issue?
> >
> > Removing  /var/spool/squid/* (+ squid -z) makes things work for a
> > little while, then again Empty response from the server (=> assertion
> > failed: Controller.cc:930: "EX").
> > So somehow it seems related to the cache and/or the response.
> >
> > Any ideas that could help to understand the problem?
>
> I cannot help with understanding why undefined Squid behavior in an
> unsupported configuration manifests itself this particular way, but I
> hope that switching to a supported version and configuration helps avoid
> this problem.
>
>
> Good luck,
>
> Alex.
>


From martin at hinterlands.org  Mon Nov 18 14:59:32 2024
From: martin at hinterlands.org (Martin A. Brooks)
Date: Mon, 18 Nov 2024 14:59:32 +0000
Subject: [squid-users] squid crash: ERROR: system call failure while
 accepting a TLS connection
Message-ID: <d02dd01b23c6d25d07f1fa454e023bc2@hinterlands.org>

Hi folks,

I am running 3 squid instances behind a load balancer.  It was running 
fine for a couple of weeks but but there were suddenly tens of thousands 
of this sort of message in the log:


squid[507015]: ERROR: system call failure while accepting a TLS 
connection on conn705596 local=[redacted]:3128 remote=[redacted]:34830 
FD 56 flags=1: 0xaaaae5711490*1


The eventually exit looks like this in the log:


squid[507015]: ERROR: system call failure while accepting a TLS 
connection on conn17735186 local=[redacted]:3128 remote=[redacted]:44828 
FD 97 flags=1: 0xaaaae7384760*1
                                                        current master 
transaction: master59891221
squid[507015]: logfileHandleWrite: daemon:/var/log/squid/access.log: 
error writing ((32) Broken pipe)
                                                        connection: 
conn17735104 local=[redacted]:3128 remote=[redacted]:44550 FD 75 flags=1
squid[507015]: Closing HTTP(S) port [::]:3128
                                                        connection: 
conn17735104 local=[redacted]:3128 remote=[redacted]:44550 FD 75 flags=1
squid[507015]: storeDirWriteCleanLogs: Starting...
                                                        connection: 
conn17735104 local=[redacted]:3128 remote=[redacted]:44550 FD 75 flags=1
squid[507015]:   Finished.  Wrote 0 entries.
                                                        connection: 
conn17735104 local=[redacted]:3128 remote=[redacted]:44550 FD 75 flags=1
squid[507015]:   Took 0.00 seconds (  0.00 entries/sec).
                                                        connection: 
conn17735104 local=[redacted]:3128 remote=[redacted]:44550 FD 75 flags=1
squid[507015]: FATAL: I don't handle this error well!
                                                        connection: 
conn17735104 local=[redacted]:3128 remote=[redacted]:44550 FD 75 flags=1
squid[507015]: Squid Cache (Version 5.7): Terminated abnormally.
                                                        connection: 
conn17735104 local=[redacted]:3128 remote=[redacted]:44550 FD 75 flags=1



systemd tried to restart squid a few times, but repeated failures meant 
it eventually gave up. This is squid-openssl as packaged by Debian on 
ARM64:

# squid --version
Squid Cache: Version 5.7
Service Name: squid
Debian linux

This binary uses OpenSSL 3.0.15 3 Sep 2024. configure options:  
'--build=aarch64-linux-gnu' '--prefix=/usr' 
'--includedir=${prefix}/include' '--mandir=${prefix}/share/man' 
'--infodir=${prefix}/share/info' '--sysconfdir=/etc' 
'--localstatedir=/var' '--disable-option-checking' 
'--disable-silent-rules' '--libdir=${prefix}/lib/aarch64-linux-gnu' 
'--runstatedir=/run' '--disable-maintainer-mode' 
'--disable-dependency-tracking' 'BUILDCXXFLAGS=-g -O2 
-ffile-prefix-map=/build/reproducible-path/squid-5.7=. 
-fstack-protector-strong -Wformat -Werror=format-security 
-Wno-error=deprecated-declarations -Wdate-time -D_FORTIFY_SOURCE=2 
-Wl,-z,relro -Wl,-z,now ' 'BUILDCXX=g++' 
'--with-build-environment=default' '--enable-build-info=Debian linux' 
'--datadir=/usr/share/squid' '--sysconfdir=/etc/squid' 
'--libexecdir=/usr/lib/squid' '--mandir=/usr/share/man' 
'--enable-inline' '--disable-arch-native' '--enable-async-io=8' 
'--enable-storeio=ufs,aufs,diskd,rock' 
'--enable-removal-policies=lru,heap' '--enable-delay-pools' 
'--enable-cache-digests' '--enable-icap-client' 
'--enable-follow-x-forwarded-for' 
'--enable-auth-basic=DB,fake,getpwnam,LDAP,NCSA,PAM,POP3,RADIUS,SASL,SMB' 
'--enable-auth-digest=file,LDAP' 
'--enable-auth-negotiate=kerberos,wrapper' 
'--enable-auth-ntlm=fake,SMB_LM' 
'--enable-external-acl-helpers=file_userip,kerberos_ldap_group,LDAP_group,session,SQL_session,time_quota,unix_group,wbinfo_group' 
'--enable-security-cert-validators=fake' 
'--enable-storeid-rewrite-helpers=file' 
'--enable-url-rewrite-helpers=fake' '--enable-eui' '--enable-esi' 
'--enable-icmp' '--enable-zph-qos' '--enable-ecap' 
'--disable-translation' '--with-swapdir=/var/spool/squid' 
'--with-logdir=/var/log/squid' '--with-pidfile=/run/squid.pid' 
'--with-filedescriptors=65536' '--with-large-files' 
'--with-default-user=proxy' '--enable-linux-netfilter' '--with-systemd' 
'--with-openssl' '--enable-ssl-crtd' 'build_alias=aarch64-linux-gnu' 
'CFLAGS=-g -O2 -ffile-prefix-map=/build/reproducible-path/squid-5.7=. 
-fstack-protector-strong -Wformat -Werror=format-security 
-Wno-error=deprecated-declarations' 'LDFLAGS=-Wl,-z,relro -Wl,-z,now ' 
'CPPFLAGS=-Wdate-time -D_FORTIFY_SOURCE=2' 'CXXFLAGS=-g -O2 
-ffile-prefix-map=/build/reproducible-path/squid-5.7=. 
-fstack-protector-strong -Wformat -Werror=format-security 
-Wno-error=deprecated-declarations'


It looks like all three of the squid instances blew up at nearly the 
same time.

Any ideas what could be going on here?


Regards


Martin.


From rousskov at measurement-factory.com  Mon Nov 18 18:03:48 2024
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Mon, 18 Nov 2024 13:03:48 -0500
Subject: [squid-users] squid crash: ERROR: system call failure while
 accepting a TLS connection
In-Reply-To: <d02dd01b23c6d25d07f1fa454e023bc2@hinterlands.org>
References: <d02dd01b23c6d25d07f1fa454e023bc2@hinterlands.org>
Message-ID: <625ce04c-a562-4468-967b-0b9ab50feb85@measurement-factory.com>

On 2024-11-18 09:59, Martin A. Brooks wrote:

> I am running 3 squid instances behind a load balancer.? It was running 
> fine for a couple of weeks but but there were suddenly tens of thousands 
> of this sort of message in the log:

> squid[507015]: ERROR: system call failure while accepting a TLS 
> connection on conn705596 local=[redacted]:3128 remote=[redacted]:34830 
> FD 56 flags=1: 0xaaaae5711490*1

If you upgrade to a supported Squid version (v6+), the trailing hex 
number will be replaced with potentially important error details. I do 
not recall whether Squid handles these particular TLS errors correctly, 
but modern Squids (v6+) have a higher chance of doing so.

To avoid a misunderstanding, while the subject of this email thread says 
"crash", the email describes a controlled/orderly/expected emergency 
exit after a fatal error beyond Squid control.


> squid[507015]: logfileHandleWrite: daemon:/var/log/squid/access.log: 
> error writing ((32) Broken pipe)

I suspect that something has killed (or prevented a restart of) helper 
processes that are responsible for writing access.log entries. Failure 
to log requests is currently fatal ("by design") for Squid, but the true 
problem/trigger lies elsewhere -- why did the helper process die? I 
recommend studying system logs for any unusual preceding 
events/activity/reports. For _example_, it is possible that your system 
ran out of some OS resources and/or is under DoS attack.

To work around logging limitations, you can use stdio module instead of 
"daemon" module. Such a workaround may have performance implications so 
proceed with care.


HTH,

Alex.


>  ?????????????????????????????????????????????????????? connection: 
> conn17735104 local=[redacted]:3128 remote=[redacted]:44550 FD 75 flags=1
> squid[507015]: Closing HTTP(S) port [::]:3128
>  ?????????????????????????????????????????????????????? connection: 
> conn17735104 local=[redacted]:3128 remote=[redacted]:44550 FD 75 flags=1
> squid[507015]: storeDirWriteCleanLogs: Starting...
>  ?????????????????????????????????????????????????????? connection: 
> conn17735104 local=[redacted]:3128 remote=[redacted]:44550 FD 75 flags=1
> squid[507015]:?? Finished.? Wrote 0 entries.
>  ?????????????????????????????????????????????????????? connection: 
> conn17735104 local=[redacted]:3128 remote=[redacted]:44550 FD 75 flags=1
> squid[507015]:?? Took 0.00 seconds (? 0.00 entries/sec).
>  ?????????????????????????????????????????????????????? connection: 
> conn17735104 local=[redacted]:3128 remote=[redacted]:44550 FD 75 flags=1
> squid[507015]: FATAL: I don't handle this error well!
>  ?????????????????????????????????????????????????????? connection: 
> conn17735104 local=[redacted]:3128 remote=[redacted]:44550 FD 75 flags=1
> squid[507015]: Squid Cache (Version 5.7): Terminated abnormally.
>  ?????????????????????????????????????????????????????? connection: 
> conn17735104 local=[redacted]:3128 remote=[redacted]:44550 FD 75 flags=1
> 
> 
> 
> systemd tried to restart squid a few times, but repeated failures meant 
> it eventually gave up. This is squid-openssl as packaged by Debian on 
> ARM64:
> 
> # squid --version
> Squid Cache: Version 5.7
> Service Name: squid
> Debian linux
> 
> This binary uses OpenSSL 3.0.15 3 Sep 2024. configure options: 
> '--build=aarch64-linux-gnu' '--prefix=/usr' 
> '--includedir=${prefix}/include' '--mandir=${prefix}/share/man' 
> '--infodir=${prefix}/share/info' '--sysconfdir=/etc' 
> '--localstatedir=/var' '--disable-option-checking' 
> '--disable-silent-rules' '--libdir=${prefix}/lib/aarch64-linux-gnu' 
> '--runstatedir=/run' '--disable-maintainer-mode' 
> '--disable-dependency-tracking' 'BUILDCXXFLAGS=-g -O2 
> -ffile-prefix-map=/build/reproducible-path/squid-5.7=. 
> -fstack-protector-strong -Wformat -Werror=format-security 
> -Wno-error=deprecated-declarations -Wdate-time -D_FORTIFY_SOURCE=2 
> -Wl,-z,relro -Wl,-z,now ' 'BUILDCXX=g++' 
> '--with-build-environment=default' '--enable-build-info=Debian linux' 
> '--datadir=/usr/share/squid' '--sysconfdir=/etc/squid' 
> '--libexecdir=/usr/lib/squid' '--mandir=/usr/share/man' 
> '--enable-inline' '--disable-arch-native' '--enable-async-io=8' 
> '--enable-storeio=ufs,aufs,diskd,rock' 
> '--enable-removal-policies=lru,heap' '--enable-delay-pools' 
> '--enable-cache-digests' '--enable-icap-client' 
> '--enable-follow-x-forwarded-for' 
> '--enable-auth-basic=DB,fake,getpwnam,LDAP,NCSA,PAM,POP3,RADIUS,SASL,SMB' '--enable-auth-digest=file,LDAP' '--enable-auth-negotiate=kerberos,wrapper' '--enable-auth-ntlm=fake,SMB_LM' '--enable-external-acl-helpers=file_userip,kerberos_ldap_group,LDAP_group,session,SQL_session,time_quota,unix_group,wbinfo_group' '--enable-security-cert-validators=fake' '--enable-storeid-rewrite-helpers=file' '--enable-url-rewrite-helpers=fake' '--enable-eui' '--enable-esi' '--enable-icmp' '--enable-zph-qos' '--enable-ecap' '--disable-translation' '--with-swapdir=/var/spool/squid' '--with-logdir=/var/log/squid' '--with-pidfile=/run/squid.pid' '--with-filedescriptors=65536' '--with-large-files' '--with-default-user=proxy' '--enable-linux-netfilter' '--with-systemd' '--with-openssl' '--enable-ssl-crtd' 'build_alias=aarch64-linux-gnu' 'CFLAGS=-g -O2 -ffile-prefix-map=/build/reproducible-path/squid-5.7=. -fstack-protector-strong -Wformat -Werror=format-security -Wno-error=deprecated-declarations' 'LDFLAGS=-Wl,-z,relro -Wl,-z,now ' 'CPPFLAGS=-Wdate-time -D_FORTIFY_SOURCE=2' 'CXXFLAGS=-g -O2 -ffile-prefix-map=/build/reproducible-path/squid-5.7=. -fstack-protector-strong -Wformat -Werror=format-security -Wno-error=deprecated-declarations'
> 
> 
> It looks like all three of the squid instances blew up at nearly the 
> same time.
> 
> Any ideas what could be going on here?
> 
> 
> Regards
> 
> 
> Martin.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> https://lists.squid-cache.org/listinfo/squid-users


From martin at hinterlands.org  Mon Nov 18 21:29:01 2024
From: martin at hinterlands.org (Martin A. Brooks)
Date: Mon, 18 Nov 2024 21:29:01 +0000
Subject: [squid-users] squid crash: ERROR: system call failure while
 accepting a TLS connection
In-Reply-To: <625ce04c-a562-4468-967b-0b9ab50feb85@measurement-factory.com>
References: <d02dd01b23c6d25d07f1fa454e023bc2@hinterlands.org>
 <625ce04c-a562-4468-967b-0b9ab50feb85@measurement-factory.com>
Message-ID: <4d9acd833409ad14756e46b9c7ceb54a@hinterlands.org>

Hello Alex,

On 2024-11-18 18:03, Alex Rousskov wrote:
> On 2024-11-18 09:59, Martin A. Brooks wrote:
> 
>> I am running 3 squid instances behind a load balancer.? It was running 
>> fine for a couple of weeks but but there were suddenly tens of 
>> thousands of this sort of message in the log:
> 
>> squid[507015]: ERROR: system call failure while accepting a TLS 
>> connection on conn705596 local=[redacted]:3128 remote=[redacted]:34830 
>> FD 56 flags=1: 0xaaaae5711490*1
> 
> If you upgrade to a supported Squid version (v6+), the trailing hex 
> number will be replaced with potentially important error details. I do 
> not recall whether Squid handles these particular TLS errors correctly, 
> but modern Squids (v6+) have a higher chance of doing so.

I somewhat expected "try a newer squid" to be in the suggestions :)


> To avoid a misunderstanding, while the subject of this email thread 
> says "crash", the email describes a controlled/orderly/expected 
> emergency exit after a fatal error beyond Squid control.

Agreed, understood.



> 
> 
>> squid[507015]: logfileHandleWrite: daemon:/var/log/squid/access.log: 
>> error writing ((32) Broken pipe)
> 
> I suspect that something has killed (or prevented a restart of) helper 
> processes that are responsible for writing access.log entries. Failure 
> to log requests is currently fatal ("by design") for Squid, but the 
> true problem/trigger lies elsewhere -- why did the helper process die? 
> I recommend studying system logs for any unusual preceding 
> events/activity/reports. For _example_, it is possible that your system 
> ran out of some OS resources and/or is under DoS attack.


I had a good trawl through the logs, and happened to have some metrics 
running, and I haven't been able to find any suggestion that any of the 
systems ran out of resources.  Disk, memory and CPU all seem fine.

I'll rebuild the systems with a newer squid (probably Ubuntu LTS and 
their shipped package) and see if the problem reoccurs.


Thanks for looking.

Regards

Martin.






From ngtech1ltd at gmail.com  Wed Nov 20 10:01:04 2024
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Wed, 20 Nov 2024 12:01:04 +0200
Subject: [squid-users] ECH Protocol and the complexities that comes with it
Message-ID: <049201db3b33$1d19e9d0$574dbd70$@gmail.com>

Hey,

 

I have started to observe ECH usage in the wild and the next articles about
it:

 

https://blog.cloudflare.com/encrypted-client-hello/

 

https://developers.cloudflare.com/ssl/edge-certificates/ech
<https://developers.cloudflare.com/ssl/edge-certificates/ech/> /

 

 

https://support.mozilla.org/en-US/kb/canary-domain-use-application-dnsnet

 

https://discourse.pi-hole.net/t/support-for-returning-nxdomain-for-use-appli
cation-dns-net-to-disable-firefox-doh/23243

 

 

Anyone have experience with ECH?

 

Thanks,

Eliezer

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20241120/3f15dc26/attachment.htm>

From uhlar at fantomas.sk  Thu Nov 21 12:29:53 2024
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Thu, 21 Nov 2024 13:29:53 +0100
Subject: [squid-users] messages when "squid -k rotate" is run
Message-ID: <Zz8nwaePGn-71IY9@fantomas.sk>

Hello,

I run squid 6 (currently 6.10) on some debian hosts.

when rotating logs in the night, I get mail about cron output:

2024/11/21 00:00:41| Processing Configuration File: /etc/squid/squid.conf (depth 0)
2024/11/21 00:00:41| Processing Configuration File: /etc/squid/conf.d/debian.conf (depth 1)
2024/11/21 00:00:41| Processing Configuration File: /etc/squid/conf.d/ftplog.conf (depth 1)
2024/11/21 00:00:41| Set Current Directory to /var/spool/squid

This did not happen with squid-5.7
- is this a bug or a new feature?

Those messages are sent to stderr, not stdout. 
I can imply redirect the "squid -k rotate" stderr to /dev/null
but I would like to avoid it when possible - if any error happens, I't like 
to know about that.


-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Quantum mechanics: The dreams stuff is made of.


From Ralf.Hildebrandt at charite.de  Thu Nov 21 13:44:23 2024
From: Ralf.Hildebrandt at charite.de (Ralf Hildebrandt)
Date: Thu, 21 Nov 2024 14:44:23 +0100
Subject: [squid-users] Can I force certain destinations to ipv4?
Message-ID: <Zz85N+I/cGhJgSAt@charite.de>

Hi!

Can I force certain destinations to be reached using ipv4 only?

I found this:
https://superuser.com/questions/994728/force-squid-to-connect-to-sites-over-ipv4-rather-than-ipv6

and implemented:

acl apiendpoint dstdomain api.endpoint.example
tcp_outgoing_address 193.175.73.216 apiendpoint

193.175.73.216 being the IP of my squid's extern a interface.
But alas, It doesn't work. Sometimes an ipv4, sometimes an ipv6
address is being used...

Using:
======

# squid --version
Squid Cache: Version 6.12-VCS

more precisely:
squid-6.12-20241031-r3b53538eae

-- 
Ralf Hildebrandt
Charit? - Universit?tsmedizin Berlin
Gesch?ftsbereich IT | Abteilung Netz | Netzwerk-Administration
Invalidenstra?e 120/121 | D-10115 Berlin

Tel. +49 30 450 570 155
ralf.hildebrandt at charite.de
https://www.charite.de


From jonathanlee571 at gmail.com  Thu Nov 21 15:19:10 2024
From: jonathanlee571 at gmail.com (Jonathan Lee)
Date: Thu, 21 Nov 2024 07:19:10 -0800
Subject: [squid-users] Can I force certain destinations to ipv4?
In-Reply-To: <Zz85N+I/cGhJgSAt@charite.de>
References: <Zz85N+I/cGhJgSAt@charite.de>
Message-ID: <B204F75C-C213-4817-B23E-BD0F0B252E5E@gmail.com>

I did this with the local dns. Unbound for example you can set specific items to resolve only ipv4, if Squid points to a dns that provides the resolves for it, it can be controlled on that side, again requires NAT a firewall with ACLs etc 
Sent from my iPhone

> On Nov 21, 2024, at 05:52, Ralf Hildebrandt <Ralf.Hildebrandt at charite.de> wrote:
> 
> ?Hi!
> 
> Can I force certain destinations to be reached using ipv4 only?
> 
> I found this:
> https://superuser.com/questions/994728/force-squid-to-connect-to-sites-over-ipv4-rather-than-ipv6
> 
> and implemented:
> 
> acl apiendpoint dstdomain api.endpoint.example
> tcp_outgoing_address 193.175.73.216 apiendpoint
> 
> 193.175.73.216 being the IP of my squid's extern a interface.
> But alas, It doesn't work. Sometimes an ipv4, sometimes an ipv6
> address is being used...
> 
> Using:
> ======
> 
> # squid --version
> Squid Cache: Version 6.12-VCS
> 
> more precisely:
> squid-6.12-20241031-r3b53538eae
> 
> --
> Ralf Hildebrandt
> Charit? - Universit?tsmedizin Berlin
> Gesch?ftsbereich IT | Abteilung Netz | Netzwerk-Administration
> Invalidenstra?e 120/121 | D-10115 Berlin
> 
> Tel. +49 30 450 570 155
> ralf.hildebrandt at charite.de
> https://www.charite.de
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> https://lists.squid-cache.org/listinfo/squid-users


From Josh.Piana at hexcel.com  Thu Nov 21 15:54:44 2024
From: Josh.Piana at hexcel.com (Piana, Josh)
Date: Thu, 21 Nov 2024 15:54:44 +0000
Subject: [squid-users] krb5.conf Example
Message-ID: <fed933235b98411b9b2f54ce236cb6e2@hexcel.com>

Hey  Squid Users,

Wanted to reach out and see if there was an updated version of the /etc/krb5.conf example file anywhere.

I've been using "wiki.squid-cache.org/ConfigExamples/Authenticate/WindowsActiveDirectory" as a reference point and I'm concerned that the Squid 3, Windows 2003/2008, and such examples might be out of date.

As of right now, my krb5.conf file looks like this:

includedir /etc/krb5.conf.d/
[logging]
    default = FILE:/var/log/krb5libs.log
    kdc = FILE:/var/log/krb5kdc.log
    admin_server = FILE:/var/log/kadmind.log

[libdefaults]
    dns_lookup_realm = true
    ticket_lifetime = 24h
    renew_lifetime = 7d
    forwardable = true
    rdns = true
    pkinit_anchors = FILE:/etc/pki/tls/certs/ca-bundle.crt
    spake_preauth_groups = edwards25519
    dns_canonicalize_hostname = true
    qualify_shortname = ""
    default_realm = AD.ARC-TECH.COM
    default_ccache_name = KEYRING:persistent:%{uid}
    udp_preference_limit = 0

[realms]
# EXAMPLE.COM = {
#     kdc = kerberos.example.com
#     admin_server = kerberos.example.com
# }

[domain_realm]
# .example.com = EXAMPLE.COM
# example.com = EXAMPLE.COM

This config file was done automatically when I joined the Linux Proxy Server to Windows AD using realmD. But I couldn't help but think there's a few things missing. I've been going through our whole Kerberos setup to figure out why Squid isn't using it when directed to in the squid.conf file.

Any help is always appreciated,
Josh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20241121/d2f3711c/attachment.htm>

From ngtech1ltd at gmail.com  Thu Nov 21 21:12:39 2024
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Thu, 21 Nov 2024 23:12:39 +0200
Subject: [squid-users] Can I force certain destinations to ipv4?
In-Reply-To: <B204F75C-C213-4817-B23E-BD0F0B252E5E@gmail.com>
References: <Zz85N+I/cGhJgSAt@charite.de>
 <B204F75C-C213-4817-B23E-BD0F0B252E5E@gmail.com>
Message-ID: <078701db3c5a$19cc1550$4d643ff0$@gmail.com>

Hey,

>From my tests you can use some reject rules on IPV6 in iptables/nftables and this will force squid by itself it use ipv4.
This is a much better approach to my opinion rather then not responding to aaaa queries.

Let me know if you need some help with this.
Eliezer

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Jonathan Lee
Sent: Thursday, November 21, 2024 5:19 PM
To: Ralf Hildebrandt <Ralf.Hildebrandt at charite.de>
Cc: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Can I force certain destinations to ipv4?

I did this with the local dns. Unbound for example you can set specific items to resolve only ipv4, if Squid points to a dns that provides the resolves for it, it can be controlled on that side, again requires NAT a firewall with ACLs etc 
Sent from my iPhone

> On Nov 21, 2024, at 05:52, Ralf Hildebrandt <Ralf.Hildebrandt at charite.de> wrote:
> 
> ?Hi!
> 
> Can I force certain destinations to be reached using ipv4 only?
> 
> I found this:
> https://superuser.com/questions/994728/force-squid-to-connect-to-sites-over-ipv4-rather-than-ipv6
> 
> and implemented:
> 
> acl apiendpoint dstdomain api.endpoint.example
> tcp_outgoing_address 193.175.73.216 apiendpoint
> 
> 193.175.73.216 being the IP of my squid's extern a interface.
> But alas, It doesn't work. Sometimes an ipv4, sometimes an ipv6
> address is being used...
> 
> Using:
> ======
> 
> # squid --version
> Squid Cache: Version 6.12-VCS
> 
> more precisely:
> squid-6.12-20241031-r3b53538eae
> 
> --
> Ralf Hildebrandt
> Charit? - Universit?tsmedizin Berlin
> Gesch?ftsbereich IT | Abteilung Netz | Netzwerk-Administration
> Invalidenstra?e 120/121 | D-10115 Berlin
> 
> Tel. +49 30 450 570 155
> ralf.hildebrandt at charite.de
> https://www.charite.de
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> https://lists.squid-cache.org/listinfo/squid-users
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
https://lists.squid-cache.org/listinfo/squid-users



From rousskov at measurement-factory.com  Thu Nov 21 21:16:32 2024
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Thu, 21 Nov 2024 16:16:32 -0500
Subject: [squid-users] messages when "squid -k rotate" is run
In-Reply-To: <Zz8nwaePGn-71IY9@fantomas.sk>
References: <Zz8nwaePGn-71IY9@fantomas.sk>
Message-ID: <819da5b5-4e2b-4742-a393-a2a6a910e5fb@measurement-factory.com>

On 2024-11-21 07:29, Matus UHLAR - fantomas wrote:
> I run squid 6 (currently 6.10) on some debian hosts.
> 
> when rotating logs in the night, I get mail about cron output:
> 
> 2024/11/21 00:00:41| Processing Configuration File: 
> /etc/squid/squid.conf (depth 0)
> 2024/11/21 00:00:41| Processing Configuration File: 
> /etc/squid/conf.d/debian.conf (depth 1)
> 2024/11/21 00:00:41| Processing Configuration File: 
> /etc/squid/conf.d/ftplog.conf (depth 1)
> 2024/11/21 00:00:41| Set Current Directory to /var/spool/squid
> 
> This did not happen with squid-5.7
> - is this a bug or a new feature?

IIRC, it is a side effect of a bug fix (or a series of bug fixes, to be 
more precise). Earlier, such messages were dropped or went to cache.log 
(violating locking rules and messing up triage of other complicated bugs 
and misconfigurations).


> Those messages are sent to stderr, not stdout. I can imply redirect the 
> "squid -k rotate" stderr to /dev/null
> but I would like to avoid it when possible - if any error happens, I't 
> like to know about that.

If you are OK with not seeing these particular messages in cache.log and 
on stderr, disable their level-1 reporting using cache_log_message 
directive. The ID of those messages is 68 (see doc/debug-messages.dox 
for IDs of other messages that can be controlled in your Squid).

For example:

     cache_log_message id=68 level=2


IIRC: Core developers failed to reach consensus regarding the best level 
for these messages, so their original "important" level (1) was 
preserved. The argument was "folks are quite often mistaken regarding 
what configuration files their Squids are actually using".


If you want Squid to only report errors to stderr, then you will need to 
  wait for (or orchestrate) the corresponding code changes. Currently, 
Squid defines error as a message with an ERROR: or FATAL: prefix. There 
is no Squid code to treat such messages specially though (yet?). For 
more details, please see 
https://github.com/squid-cache/squid/commit/d816f28de8ba817a98a49f9cfd88ddaa334d7aad

You may be able to emulate the above error detection/handling (including 
its risks related to incorrectly unclassified/unprefixed messages) via a 
shell script. For example, something like this might be a good starting 
point:

     squid -k rotate |& grep -E "FATAL:|ERROR:"

or, with added logging of all stderr messages:

     squid -k rotate |& \
         tee squid-last-rotate.log | \
         grep -E "FATAL:|ERROR:"

However, the above sketches need more work/adjustments to preserve 
"squid -k rotate" exit status code!


HTH,

Alex.



From rousskov at measurement-factory.com  Thu Nov 21 21:35:11 2024
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Thu, 21 Nov 2024 16:35:11 -0500
Subject: [squid-users] Can I force certain destinations to ipv4?
In-Reply-To: <Zz85N+I/cGhJgSAt@charite.de>
References: <Zz85N+I/cGhJgSAt@charite.de>
Message-ID: <adffef71-664f-4af5-a470-76814c0b936f@measurement-factory.com>

On 2024-11-21 08:44, Ralf Hildebrandt wrote:

> Can I force certain destinations to be reached using ipv4 only?

Not reliably. IMHO, it is a missing feature (or two).

Various tricks exist, but none of them work well in general, for various 
reasons. See other responses on this thread for some specific tricks.


> I found this:
> https://superuser.com/questions/994728/force-squid-to-connect-to-sites-over-ipv4-rather-than-ipv6
> 
> and implemented:
> 
> acl apiendpoint dstdomain api.endpoint.example
> tcp_outgoing_address 193.175.73.216 apiendpoint
> 
> 193.175.73.216 being the IP of my squid's extern a interface.
> But alas, It doesn't work. Sometimes an ipv4, sometimes an ipv6
> address is being used...

The advice you found and followed is not compatible with how modern 
Squid works: When Squid is about to open a connection to an IPv6 peer, 
Squid ignores all tcp_outgoing_address rules that use IPv4 addresses. In 
other words, tcp_outgoing_address rules select an outgoing address 
_within_ the already determined address family.


HTH,

Alex.



> Using:
> ======
> 
> # squid --version
> Squid Cache: Version 6.12-VCS
> 
> more precisely:
> squid-6.12-20241031-r3b53538eae
> 



From uhlar at fantomas.sk  Fri Nov 22 17:04:43 2024
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Fri, 22 Nov 2024 18:04:43 +0100
Subject: [squid-users] messages when "squid -k rotate" is run
In-Reply-To: <819da5b5-4e2b-4742-a393-a2a6a910e5fb@measurement-factory.com>
References: <Zz8nwaePGn-71IY9@fantomas.sk>
 <819da5b5-4e2b-4742-a393-a2a6a910e5fb@measurement-factory.com>
Message-ID: <Z0C5q2agbVAkt23J@fantomas.sk>

>On 2024-11-21 07:29, Matus UHLAR - fantomas wrote:
>>I run squid 6 (currently 6.10) on some debian hosts.
>>
>>when rotating logs in the night, I get mail about cron output:
>>
>>2024/11/21 00:00:41| Processing Configuration File: 
>>/etc/squid/squid.conf (depth 0)
>>2024/11/21 00:00:41| Processing Configuration File: 
>>/etc/squid/conf.d/debian.conf (depth 1)
>>2024/11/21 00:00:41| Processing Configuration File: 
>>/etc/squid/conf.d/ftplog.conf (depth 1)
>>2024/11/21 00:00:41| Set Current Directory to /var/spool/squid
>>
>>This did not happen with squid-5.7
>>- is this a bug or a new feature?

>IIRC, it is a side effect of a bug fix (or a series of bug fixes, to 
>be more precise). Earlier, such messages were dropped or went to 
>cache.log (violating locking rules and messing up triage of other 
>complicated bugs and misconfigurations).

>>Those messages are sent to stderr, not stdout. I can imply redirect 
>>the "squid -k rotate" stderr to /dev/null
>>but I would like to avoid it when possible - if any error happens, 
>>I't like to know about that.

On 21.11.24 16:16, Alex Rousskov wrote:
>If you are OK with not seeing these particular messages in cache.log 
>and on stderr, disable their level-1 reporting using cache_log_message 
>directive. The ID of those messages is 68 (see doc/debug-messages.dox 
>for IDs of other messages that can be controlled in your Squid).

Only cache.log would be ideal.  However, the description at 
http://www.squid-cache.org/Doc/config/cache_log_message/ is not clear enough 
what exactly that level means, and unfortunately you didn't make id more 
clear.
(the page is mentioning doc/debug-messages.txt btw)

Do I understand it properly that level 1 goes to stderr+cache.log and level 
2 nowhere?

>For example:
>
>    cache_log_message id=68 level=2
>
>
>IIRC: Core developers failed to reach consensus regarding the best 
>level for these messages, so their original "important" level (1) was 
>preserved. The argument was "folks are quite often mistaken regarding 
>what configuration files their Squids are actually using".

That makes sense, kinda.

>If you want Squid to only report errors to stderr, then you will need 
>to  wait for (or orchestrate) the corresponding code changes. 
>Currently, Squid defines error as a message with an ERROR: or FATAL: 
>prefix. There is no Squid code to treat such messages specially though 
>(yet?). For more details, please see https://github.com/squid-cache/squid/commit/d816f28de8ba817a98a49f9cfd88ddaa334d7aad
>
>You may be able to emulate the above error detection/handling 
>(including its risks related to incorrectly unclassified/unprefixed 
>messages) via a shell script. For example, something like this might 
>be a good starting point:
>
>    squid -k rotate |& grep -E "FATAL:|ERROR:"
>
>or, with added logging of all stderr messages:
>
>    squid -k rotate |& \
>        tee squid-last-rotate.log | \
>        grep -E "FATAL:|ERROR:"
>
>However, the above sketches need more work/adjustments to preserve 
>"squid -k rotate" exit status code!

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
M$ Win's are shit, do not use it !


From rousskov at measurement-factory.com  Fri Nov 22 23:29:45 2024
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Fri, 22 Nov 2024 18:29:45 -0500
Subject: [squid-users] messages when "squid -k rotate" is run
In-Reply-To: <Z0C5q2agbVAkt23J@fantomas.sk>
References: <Zz8nwaePGn-71IY9@fantomas.sk>
 <819da5b5-4e2b-4742-a393-a2a6a910e5fb@measurement-factory.com>
 <Z0C5q2agbVAkt23J@fantomas.sk>
Message-ID: <209108fd-4b24-44c8-bb82-6a5c0451d6b2@measurement-factory.com>

On 2024-11-22 12:04, Matus UHLAR - fantomas wrote:
>> On 2024-11-21 07:29, Matus UHLAR - fantomas wrote:
>>> I run squid 6 (currently 6.10) on some debian hosts.
>>>
>>> when rotating logs in the night, I get mail about cron output:
>>>
>>> 2024/11/21 00:00:41| Processing Configuration File: 
>>> /etc/squid/squid.conf (depth 0)
>>> 2024/11/21 00:00:41| Processing Configuration File: 
>>> /etc/squid/conf.d/debian.conf (depth 1)
>>> 2024/11/21 00:00:41| Processing Configuration File: 
>>> /etc/squid/conf.d/ftplog.conf (depth 1)
>>> 2024/11/21 00:00:41| Set Current Directory to /var/spool/squid

>>> Those messages are sent to stderr, not stdout. I can imply redirect 
>>> the "squid -k rotate" stderr to /dev/null
>>> but I would like to avoid it when possible - if any error happens, 
>>> I't like to know about that.

> On 21.11.24 16:16, Alex Rousskov wrote:
>> If you are OK with not seeing these particular messages in cache.log 
>> and on stderr, disable their level-1 reporting using cache_log_message 
>> directive. The ID of those messages is 68 (see doc/debug-messages.dox 
>> for IDs of other messages that can be controlled in your Squid).

> Only cache.log would be ideal. 

Short answer: AFAICT, that ideal is not supported for what you want to do.

Longer answer: The following _combination_ is not supported (yet?) AFAICT:

* Sending only level-0/1 messages to cache.log,
* including a particular level-1 message.
* Sending only level-0/1 messages to stderr,
* except for a particular level-1 message.


> However, the description at 
> http://www.squid-cache.org/Doc/config/cache_log_message/ is not clear 
> enough what exactly that level means,

Documentation improvements are welcome! Existing cache_log_message 
documentation reuses a fairly well-known "debugging level" concept that 
is more-or-less described in debug_options directive documentation. 
cache_log_message docs do refer to debug_options in "level=<number>" 
bullet. I am sure all of this can be significantly improved.


> and unfortunately you didn't make id more clear.

I assume you meant to say "it" (i.e. "level meaning") rather than "id". 
I am sorry that I failed to realize that "level" should be clarified in 
this context. I should have been more careful with my assumptions!


> (the page is mentioning doc/debug-messages.txt btw)

Thank you for reporting that documentation bug. I proposed a fix at
https://github.com/squid-cache/squid/pull/1953


> Do I understand it properly that level 1 goes to stderr+cache.log and 
> level 2 nowhere?

Short answer: Not quite. Assuming an error-free squid executable start 
(e.g., not "squid -k"!) and default debug_options (i.e. "ALL,1"), all 
level-0/1 messages go to cache.log and nothing goes to stderr. Level-2+ 
messages are not logged anywhere.

Longer answer:

Each message has a hard-coded debugging level. Roughly speaking, higher 
levels are used for more frequent messages. Levels above 2 are meant for 
developers (rather than admins). Levels above 1 are not meant for 
sustained production use because they slow Squid down and generate huge 
logs.

* Messages with debugging level L go to cache.log if debug_options allow 
debugging level L. For example, "debug_options ALL,2" would allow 
messages with debugging levels 0, 1, and 2 to be logged to cache.log.

* Messages with debugging level L that are allowed to go to cache.log 
(see above) go to stderr if command line option -d allows them to go to 
stderr. For example, a combination of "debug_options ALL,2" and "-d 1" 
would allow messages with debugging levels 0 and 1 to be logged to stderr.

By default, in error-free cases, when running squid executable that is 
supposed to (eventually) log to cache.log, nothing goes to stderr and 
level-0/1 messages go to cache.log. In such cases, -d value defaults to 
the equivalent of "none". To see stderr output in such cases, one has to 
start squid with -d0 or higher.

When running "squid -k ..." -d defaults to 1 and nothing goes to cache.log.

Sounds complicated? There is also syslog with its own level-related 
policies! :-)


HTH,

Alex.


>> For example:
>>
>> ?? cache_log_message id=68 level=2

>> If you want Squid to only report errors to stderr, then you will need 
>> to? wait for (or orchestrate) the corresponding code changes. 
>> Currently, Squid defines error as a message with an ERROR: or FATAL: 
>> prefix. There is no Squid code to treat such messages specially though 
>> (yet?). For more details, please see 
>> https://github.com/squid-cache/squid/commit/d816f28de8ba817a98a49f9cfd88ddaa334d7aad
>>
>> You may be able to emulate the above error detection/handling 
>> (including its risks related to incorrectly unclassified/unprefixed 
>> messages) via a shell script. For example, something like this might 
>> be a good starting point:
>>
>> ?? squid -k rotate |& grep -E "FATAL:|ERROR:"
>>
>> or, with added logging of all stderr messages:
>>
>> ?? squid -k rotate |& \
>> ?????? tee squid-last-rotate.log | \
>> ?????? grep -E "FATAL:|ERROR:"
>>
>> However, the above sketches need more work/adjustments to preserve 
>> "squid -k rotate" exit status code!
> 



From marko.cupac at mimar.rs  Mon Nov 25 16:35:43 2024
From: marko.cupac at mimar.rs (Marko =?UTF-8?B?Q3VwYcSH?=)
Date: Mon, 25 Nov 2024 17:35:43 +0100
Subject: [squid-users] krb5.conf Example
In-Reply-To: <fed933235b98411b9b2f54ce236cb6e2@hexcel.com>
References: <fed933235b98411b9b2f54ce236cb6e2@hexcel.com>
Message-ID: <20241125173543.77a29ca8@sanri>

On Thu, 21 Nov 2024 15:54:44 +0000
"Piana, Josh" <Josh.Piana at hexcel.com> wrote:

> Hey  Squid Users,
> 
> Wanted to reach out and see if there was an updated version of the
> /etc/krb5.conf example file anywhere.

Mine is as simple as:

[libdefaults]
  default_realm = EXAMPLE.ORG
  dns_lookup_realm = false
  dns_lookup_kdc = true

[domain_realm]
  .example.org = EXAMPLE.ORG

My FreeBSD 14.1 successfully obtains kerberos tickets from WS2019 AD
with above config.


> As of right now, my krb5.conf file looks like this:
> 
> includedir /etc/krb5.conf.d/
> [logging]
>     default = FILE:/var/log/krb5libs.log
>     kdc = FILE:/var/log/krb5kdc.log
>     admin_server = FILE:/var/log/kadmind.log
> 
> [libdefaults]
>     dns_lookup_realm = true
>     ticket_lifetime = 24h
>     renew_lifetime = 7d
>     forwardable = true
>     rdns = true
>     pkinit_anchors = FILE:/etc/pki/tls/certs/ca-bundle.crt
>     spake_preauth_groups = edwards25519
>     dns_canonicalize_hostname = true
>     qualify_shortname = ""
>     default_realm = AD.ARC-TECH.COM
>     default_ccache_name = KEYRING:persistent:%{uid}
>     udp_preference_limit = 0
> 
> [realms]
> # EXAMPLE.COM = {
> #     kdc = kerberos.example.com
> #     admin_server = kerberos.example.com
> # }
> 
> [domain_realm]
> # .example.com = EXAMPLE.COM
> # example.com = EXAMPLE.COM
> 
> This config file was done automatically when I joined the Linux Proxy
> Server to Windows AD using realmD. But I couldn't help but think
> there's a few things missing.

I would say you are missing at least commented records under
[domain_realm]. Can't say if there's something under [libdefaults]
which shouldn't be there (I never used most of the records you have
there).


> I've been going through our whole Kerberos setup to figure out why
> Squid isn't using it when directed to in the squid.conf file.

Have you tested pure kerberos without squid first? Are you successfully
getting tickets with kinit?

```
someuser at somesquid:~ $ kinit domainuser
domainuser at EXAMPLE.ORG's Password:

someuser at somesquid:~ $ klist
Credentials cache: FILE:/tmp/krb5cc_1001
        Principal: domainuser at EXAMPLE.ORG

  Issued                Expires               Principal
Nov 25 17:25:47 2024  Nov 26 03:25:47 2024  krbtgt/EXAMPLE.ORG at EXAMPLE.ORG
```

Best regards,
-- 
Before enlightenment - chop wood, draw water.
After  enlightenment - chop wood, draw water.

Marko Cupa?
https://www.mimar.rs/


From jonathanlee571 at gmail.com  Tue Nov 26 05:53:08 2024
From: jonathanlee571 at gmail.com (Jonathan Lee)
Date: Mon, 25 Nov 2024 21:53:08 -0800
Subject: [squid-users] ACL dstdomain and use of -n
Message-ID: <4B179148-F677-4E07-BA79-D9A15CED06CB@gmail.com>

Hello fellow Squid users,

For acls and use of -n is this considered faster over non use of the flag? What would be better for a system that is using its own DNS? When would we use -n versus when would we not? 

Also with use of caching updates would it be better to use -n ?


Sent from my iPhone

From rousskov at measurement-factory.com  Tue Nov 26 14:05:07 2024
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Tue, 26 Nov 2024 09:05:07 -0500
Subject: [squid-users] ACL dstdomain and use of -n
In-Reply-To: <4B179148-F677-4E07-BA79-D9A15CED06CB@gmail.com>
References: <4B179148-F677-4E07-BA79-D9A15CED06CB@gmail.com>
Message-ID: <c78a208f-bc2b-4dee-81ee-88551d05fab6@measurement-factory.com>

On 2024-11-26 00:53, Jonathan Lee wrote:

   -n Disable lookups and address type conversions.  If lookup or
      conversion is required because the parameter type (IP or
      domain name) does not match the message address type (domain
      name or IP), then the ACL would immediately declare a mismatch
      without any warnings or lookups.

> For acls and use of -n is this considered faster over non use of the
> flag?

When input address does not require a lookup (e.g., because the 
information is currently available in IP or DNS cache), the matching 
speed is the same with or without the -n flag.

In other cases, not doing a lookup is naturally faster than doing it, 
but not doing a lookup may change the match/mismatch outcome, so 
comparing speeds can be misleading. In these cases, the question is kind 
of similar to asking "What is faster, aspirin or guillotine?"


> What would be better for a system that is using its own DNS?

The answer depends on many factors unknown to me, including the cost of 
incorrect (mis)matches and the cost of waiting for DNS lookups. If you 
are not sure about tradeoffs in your environment, my recommendation is 
to avoid -n because -n may change match/mismatch outcome.


> When would we use -n versus when would we not?

We use -n when Squid should not lookup addresses. For example, when we 
want to match transactions targeting domain name X but do not want to 
match transactions targeting IP address Y that happens to resolve to 
domain name X when using a reverse DNS lookup.


> Also with use of caching updates would it be better to use -n ?

I assume you are asking about caching MS Windows updates. I do not know 
the answer to that question, but suspect that the question itself is 
missing essential details to allow for a meaningful answer. If the above 
discussion does not let you answer this question, consider asking a more 
specific question: Name the directive and the ACL while describing what 
you are trying to optimize (i.e. defining "better").


HTH,

Alex.



From jonathanlee571 at gmail.com  Wed Nov 27 08:42:58 2024
From: jonathanlee571 at gmail.com (Jonathan Lee)
Date: Wed, 27 Nov 2024 00:42:58 -0800
Subject: [squid-users] Time stamp shows off by 8 hours
Message-ID: <DF699DA1-ACC6-4C9B-82C4-4AB6B1B21890@gmail.com>

Hello fellow squid users can some please help?

My url errors for time lock outs work perfectly however I have a time stamp issue.

On the bottom of the page 

Generated Wed, 27 Nov 2024 08:38:04 GMT by Lee_Family.home.arpa (squid)

But the time is 00:38:04 it blocks at the correct times I need but the time stamp is off. 

 How do I fix this? 

Sent from my iPhone
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20241127/3eacdfe2/attachment.htm>

From jonathanlee571 at gmail.com  Wed Nov 27 08:44:37 2024
From: jonathanlee571 at gmail.com (Jonathan Lee)
Date: Wed, 27 Nov 2024 00:44:37 -0800
Subject: [squid-users] Time stamp shows off by 8 hours
In-Reply-To: <DF699DA1-ACC6-4C9B-82C4-4AB6B1B21890@gmail.com>
References: <DF699DA1-ACC6-4C9B-82C4-4AB6B1B21890@gmail.com>
Message-ID: <ED7FACFB-9A35-4DDE-9A21-784B568CDC69@gmail.com>

Is this the fix?

%t
local time
%T
UTC


Sent from my iPhone

> On Nov 27, 2024, at 00:43, Jonathan Lee <jonathanlee571 at gmail.com> wrote:
> 
> ?
> Hello fellow squid users can some please help?
> 
> My url errors for time lock outs work perfectly however I have a time stamp issue.
> 
> On the bottom of the page 
> 
> Generated Wed, 27 Nov 2024 08:38:04 GMT by Lee_Family.home.arpa (squid)
> 
> But the time is 00:38:04 it blocks at the correct times I need but the time stamp is off. 
> 
>  How do I fix this? 
> 
> Sent from my iPhone
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20241127/b7602449/attachment.htm>

From Josh.Piana at hexcel.com  Wed Nov 27 14:45:40 2024
From: Josh.Piana at hexcel.com (Piana, Josh)
Date: Wed, 27 Nov 2024 14:45:40 +0000
Subject: [squid-users] krb5.conf Example
In-Reply-To: <20241125173543.77a29ca8@sanri>
References: <fed933235b98411b9b2f54ce236cb6e2@hexcel.com>
 <20241125173543.77a29ca8@sanri>
Message-ID: <22955e2edd8b4490ab270c9ef7464123@hexcel.com>

Marko, 

Thank you for the response. 

I've found there's an issue with the Kerberos setup even besides Squid, so that's probably why Squid cannot utilize the auth_param negotiate parameters I put in place, there's an issue with the back end. 

Thank you for taking the time to respond, I'm working with RedHat support to figure out the Kerberos issues now. PITA. 

Thanks,
Josh

-----Original Message-----
From: Marko Cupa? <marko.cupac at mimar.rs> 
Sent: Monday, November 25, 2024 11:36 AM
To: Piana, Josh <Josh.Piana at hexcel.com>
Cc: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] krb5.conf Example

Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.


On Thu, 21 Nov 2024 15:54:44 +0000
"Piana, Josh" <Josh.Piana at hexcel.com> wrote:

> Hey  Squid Users,
>
> Wanted to reach out and see if there was an updated version of the 
> /etc/krb5.conf example file anywhere.

Mine is as simple as:

[libdefaults]
  default_realm = EXAMPLE.ORG
  dns_lookup_realm = false
  dns_lookup_kdc = true

[domain_realm]
  .example.org = EXAMPLE.ORG

My FreeBSD 14.1 successfully obtains kerberos tickets from WS2019 AD with above config.


> As of right now, my krb5.conf file looks like this:
>
> includedir /etc/krb5.conf.d/
> [logging]
>     default = FILE:/var/log/krb5libs.log
>     kdc = FILE:/var/log/krb5kdc.log
>     admin_server = FILE:/var/log/kadmind.log
>
> [libdefaults]
>     dns_lookup_realm = true
>     ticket_lifetime = 24h
>     renew_lifetime = 7d
>     forwardable = true
>     rdns = true
>     pkinit_anchors = FILE:/etc/pki/tls/certs/ca-bundle.crt
>     spake_preauth_groups = edwards25519
>     dns_canonicalize_hostname = true
>     qualify_shortname = ""
>     default_realm = AD.ARC-TECH.COM
>     default_ccache_name = KEYRING:persistent:%{uid}
>     udp_preference_limit = 0
>
> [realms]
> # EXAMPLE.COM = {
> #     kdc = kerberos.example.com
> #     admin_server = kerberos.example.com
> # }
>
> [domain_realm]
> # .example.com = EXAMPLE.COM
> # example.com = EXAMPLE.COM
>
> This config file was done automatically when I joined the Linux Proxy 
> Server to Windows AD using realmD. But I couldn't help but think 
> there's a few things missing.

I would say you are missing at least commented records under [domain_realm]. Can't say if there's something under [libdefaults] which shouldn't be there (I never used most of the records you have there).


> I've been going through our whole Kerberos setup to figure out why 
> Squid isn't using it when directed to in the squid.conf file.

Have you tested pure kerberos without squid first? Are you successfully getting tickets with kinit?

```
someuser at somesquid:~ $ kinit domainuser
domainuser at EXAMPLE.ORG's Password:

someuser at somesquid:~ $ klist
Credentials cache: FILE:/tmp/krb5cc_1001
        Principal: domainuser at EXAMPLE.ORG

  Issued                Expires               Principal
Nov 25 17:25:47 2024  Nov 26 03:25:47 2024  krbtgt/EXAMPLE.ORG at EXAMPLE.ORG ```

Best regards,
--
Before enlightenment - chop wood, draw water.
After  enlightenment - chop wood, draw water.

Marko Cupa?
https://www.mimar.rs/

From jonathanlee571 at gmail.com  Wed Nov 27 15:39:23 2024
From: jonathanlee571 at gmail.com (Jonathan Lee)
Date: Wed, 27 Nov 2024 07:39:23 -0800
Subject: [squid-users] Time stamp shows off by 8 hours
In-Reply-To: <ED7FACFB-9A35-4DDE-9A21-784B568CDC69@gmail.com>
References: <ED7FACFB-9A35-4DDE-9A21-784B568CDC69@gmail.com>
Message-ID: <4CE907F7-4F54-4B6E-A714-AF43943262F8@gmail.com>

An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20241127/3b0fd373/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: favicon.ico
Type: image/vnd.microsoft.icon
Size: 1406 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20241127/3b0fd373/attachment.ico>

From jonathanlee571 at gmail.com  Wed Nov 27 15:46:32 2024
From: jonathanlee571 at gmail.com (Jonathan Lee)
Date: Wed, 27 Nov 2024 07:46:32 -0800
Subject: [squid-users] Time stamp shows off by 8 hours
In-Reply-To: <4CE907F7-4F54-4B6E-A714-AF43943262F8@gmail.com>
References: <4CE907F7-4F54-4B6E-A714-AF43943262F8@gmail.com>
Message-ID: <4AA18D6B-59BD-4E45-B66A-C5CB74F10429@gmail.com>

An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20241127/2eb8edf8/attachment.htm>

From stu.lists at spacehopper.org  Wed Nov 27 18:23:27 2024
From: stu.lists at spacehopper.org (Stuart Henderson)
Date: Wed, 27 Nov 2024 18:23:27 -0000 (UTC)
Subject: [squid-users] Time stamp shows off by 8 hours
References: <DF699DA1-ACC6-4C9B-82C4-4AB6B1B21890@gmail.com>
 <ED7FACFB-9A35-4DDE-9A21-784B568CDC69@gmail.com>
Message-ID: <slrnvkeosv.27s6.stu.lists@naiad.spacehopper.org>

On 2024-11-27, Jonathan Lee <jonathanlee571 at gmail.com> wrote:
>
> --===============8430038489510697630==
> Content-Type: multipart/alternative; boundary=Apple-Mail-A89EC807-2716-467D-8189-91B2942E0226
> Content-Transfer-Encoding: 7bit
>
>
> --Apple-Mail-A89EC807-2716-467D-8189-91B2942E0226
> Content-Type: text/plain;
> 	charset=utf-8
> Content-Transfer-Encoding: quoted-printable
>
> Is this the fix?
>
> %t
> local time
> %T
> UTC

That is probably "%T - Timestamp in RFC 1123 format"

Are you clock and timezone (/etc/localtime symlink) set correctly?




From jonathanlee571 at gmail.com  Thu Nov 28 00:25:20 2024
From: jonathanlee571 at gmail.com (Jonathan Lee)
Date: Wed, 27 Nov 2024 16:25:20 -0800
Subject: [squid-users] Time stamp shows off by 8 hours
In-Reply-To: <slrnvkeosv.27s6.stu.lists@naiad.spacehopper.org>
References: <slrnvkeosv.27s6.stu.lists@naiad.spacehopper.org>
Message-ID: <BF21B377-642A-4534-A02A-FABE9B375009@gmail.com>

Local is correct and acls that are time based function 
Sent from my iPhone

> On Nov 27, 2024, at 16:22, Stuart Henderson <stu.lists at spacehopper.org> wrote:
> 
> ?On 2024-11-27, Jonathan Lee <jonathanlee571 at gmail.com> wrote:
>> 
>> --===============8430038489510697630==
>> Content-Type: multipart/alternative; boundary=Apple-Mail-A89EC807-2716-467D-8189-91B2942E0226
>> Content-Transfer-Encoding: 7bit
>> 
>> 
>> --Apple-Mail-A89EC807-2716-467D-8189-91B2942E0226
>> Content-Type: text/plain;
>>    charset=utf-8
>> Content-Transfer-Encoding: quoted-printable
>> 
>> Is this the fix?
>> 
>> %t
>> local time
>> %T
>> UTC
> 
> That is probably "%T - Timestamp in RFC 1123 format"
> 
> Are you clock and timezone (/etc/localtime symlink) set correctly?
> 
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> https://lists.squid-cache.org/listinfo/squid-users


From squid3 at treenet.co.nz  Thu Nov 28 01:03:40 2024
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 28 Nov 2024 14:03:40 +1300
Subject: [squid-users] Time stamp shows off by 8 hours
In-Reply-To: <BF21B377-642A-4534-A02A-FABE9B375009@gmail.com>
References: <slrnvkeosv.27s6.stu.lists@naiad.spacehopper.org>
 <BF21B377-642A-4534-A02A-FABE9B375009@gmail.com>
Message-ID: <ef956a38-b110-44dc-8e92-85b1483418de@treenet.co.nz>

Please notice that the Squid page says the displayed time has "GMT" 
timezone.

Apparently you are in timezone UTC-0800. Which means your "local time" 
is hrs different from GMT/UTC.

This is not something to worry about unless your timezone is actually 
not UTC-0800.


HTH
Amos



From jonathanlee571 at gmail.com  Thu Nov 28 02:14:48 2024
From: jonathanlee571 at gmail.com (Jonathan Lee)
Date: Wed, 27 Nov 2024 18:14:48 -0800
Subject: [squid-users] Time stamp shows off by 8 hours
In-Reply-To: <ef956a38-b110-44dc-8e92-85b1483418de@treenet.co.nz>
References: <ef956a38-b110-44dc-8e92-85b1483418de@treenet.co.nz>
Message-ID: <A4381AE5-9983-43F8-9094-E542D4CA321B@gmail.com>

Thanks for the update. 
Sent from my iPhone

> On Nov 27, 2024, at 17:12, Amos Jeffries <squid3 at treenet.co.nz> wrote:
> 
> ?Please notice that the Squid page says the displayed time has "GMT" timezone.
> 
> Apparently you are in timezone UTC-0800. Which means your "local time" is hrs different from GMT/UTC.
> 
> This is not something to worry about unless your timezone is actually not UTC-0800.
> 
> 
> HTH
> Amos
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> https://lists.squid-cache.org/listinfo/squid-users


