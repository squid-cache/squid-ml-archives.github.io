<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] v6.12 build error from release tarball
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20v6.12%20build%20error%20from%20release%20tarball&In-Reply-To=%3Ca06cf2e2-3260-4ce8-92e0-b4833e3deb30%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027246.html">
   <LINK REL="Next"  HREF="027248.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] v6.12 build error from release tarball</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20v6.12%20build%20error%20from%20release%20tarball&In-Reply-To=%3Ca06cf2e2-3260-4ce8-92e0-b4833e3deb30%40measurement-factory.com%3E"
       TITLE="[squid-users] v6.12 build error from release tarball">rousskov at measurement-factory.com
       </A><BR>
    <I>Fri Nov  8 14:18:03 UTC 2024</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="027246.html">[squid-users] v6.12 build error from release tarball
</A></li>
        <LI>Next message (by thread): <A HREF="027248.html">[squid-users] Access Log Question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27247">[ date ]</a>
              <a href="thread.html#27247">[ thread ]</a>
              <a href="subject.html#27247">[ subject ]</a>
              <a href="author.html#27247">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2024-11-08 02:33, Marko, Peter wrote:

&gt;<i> I don't really know autotools and how they are supposed to be used.
</I>
We are in the same boat here -- there are a lot of gray areas and dark 
corners with autotools. Bootstrapping of components is one of them, as 
commit 82e18891 message illustrates. And in your particular case, you 
are essentially dealing with bootstrapping a component of a component!

As an additional disclaimer, I know nothing about Yocto :-).


&gt;<i> This process (using bootstrapped release tarball + running autoreconf) is
</I>&gt;<i> the standard way how Yocto project builds autotool based components.
</I>
Please consider adjusting Yocto &quot;standard way&quot; to honor and use 
component-supplied bootstrap.sh (instead of autoreconf) when it exists.


&gt;<i> Maybe because release tarballs are bootstrapped with a possibly/usually
</I>&gt;<i> different version of libtool and other toolchain parts than are used by Yocto
</I>
Yes, most likely they are, but the differences may not matter to Yocto. 
And if they do matter to Yocto, then Yocto should honor component's way 
of bootstrapping before blindly assuming that autoreconf &quot;works&quot;.

&gt;<i> or because of different configuration options?
</I>
Squid bootstrapping does not have options, but even if it had them, 
running autoreconf (without options) would probably ignore them, so this 
is probably not about bootstrapping options.


&gt;<i> Your explanation makes sense to me and I have some idea why this
</I>&gt;<i> build problem occurs and have some arguments for my patch within Yocto.
</I>
I am very glad to hear that you are making progress.


Good luck,

Alex.


&gt;&gt;<i> -----Original Message-----
</I>&gt;&gt;<i> From: Alex Rousskov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt;
</I>&gt;&gt;<i> Sent: Friday, November 8, 2024 5:27
</I>&gt;&gt;<i> To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i> Cc: Marko, Peter (FT D EU SK BFS1) &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">Peter.Marko at siemens.com</A>&gt;
</I>&gt;&gt;<i> Subject: Re: [squid-users] v6.12 build error from release tarball
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On 2024-11-07 16:48, Marko, Peter wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Commit [1] removed directory libltdl/m4 from release tarball by merging
</I>&gt;&gt;&gt;<i> all those files into libltdl/aclocal.m4,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Clarification: While commit b4addc22 itself did not remove any
</I>&gt;&gt;<i> directories or merged any files, bootstrapping Squid after that commit
</I>&gt;&gt;<i> may have such an effect. The exact bootstrapping outcome depends, in
</I>&gt;&gt;<i> part, on bootstrapping environment (e.g., installed libtool version)...
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> however makefiles still
</I>&gt;&gt;&gt;<i> reference it causing following error (in Yocto project):
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> libltdl/Makefile.am that references m4 directory comes from Libtool.
</I>&gt;&gt;<i> That particular Makefile.am does not exist in primary Squid sources
</I>&gt;&gt;<i> (i.e. what gets committed to the official git repository). It gets
</I>&gt;&gt;<i> created (by libtoolize IIRC) during bootstrapping of Squid sources.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> | autoreconf: Entering directory 'libltdl'
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> To bootstrap Squid, one has to run ./bootstrap.sh instead of autoreconf.
</I>&gt;&gt;<i> AFAIK, Squid does not fully support bootstrapping with autoreconf;
</I>&gt;&gt;<i> autoreconf fails to do the right thing in some environments. If
</I>&gt;&gt;<i> autoreconf had worked for you, it was just temporary luck.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> However, _why_ run autoreconf (i.e. bootstrapping Squid) after
</I>&gt;&gt;<i> downloading _bootstrapped_ sources?! Clarifying this contradiction may
</I>&gt;&gt;<i> help identify and address the underlying problem.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thank you,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Alex.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> | autoreconf: configure.ac: not using Gettext
</I>&gt;&gt;&gt;<i> | autoreconf: running: aclocal --system-acdir=WORKDIR/recipe-
</I>&gt;&gt;<i> sysroot/usr/share/aclocal/ -I WORKDIR/squid-6.12/acinclude/ -I
</I>&gt;&gt;<i> WORKDIR/recipe-sysroot-native/usr/share/aclocal/ --force -I m4
</I>&gt;&gt;&gt;<i> | aclocal: error: couldn't open directory 'm4': No such file or directory
</I>&gt;&gt;&gt;<i> | autoreconf: error: aclocal failed with exit status: 1
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Following change of release tarball will make the build pass:
</I>&gt;&gt;&gt;<i> diff squid-6.12-orig/libltdl/Makefile.am squid-6.12/libltdl/Makefile.am
</I>&gt;&gt;&gt;<i> --- squid-6.12-orig/libltdl/Makefile.am
</I>&gt;&gt;&gt;<i> +++ squid-6.12/libltdl/Makefile.am
</I>&gt;&gt;&gt;<i> @@ -29,7 +29,7 @@
</I>&gt;&gt;&gt;<i>    ## 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
</I>&gt;&gt;&gt;<i>    #####
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> -ACLOCAL_AMFLAGS = -I m4
</I>&gt;&gt;&gt;<i> +ACLOCAL_AMFLAGS =
</I>&gt;&gt;&gt;<i>    AUTOMAKE_OPTIONS = foreign
</I>&gt;&gt;&gt;<i>    AM_CPPFLAGS =
</I>&gt;&gt;&gt;<i>    AM_LDFLAGS =
</I>&gt;&gt;&gt;<i> diff squid-6.12-orig/libltdl/Makefile.in squid-6.12/libltdl/Makefile.in
</I>&gt;&gt;&gt;<i> --- squid-6.12-orig/libltdl/Makefile.in
</I>&gt;&gt;&gt;<i> +++ squid-6.12/libltdl/Makefile.in
</I>&gt;&gt;&gt;<i> @@ -448,7 +448,7 @@ target_alias = @target_alias@
</I>&gt;&gt;&gt;<i>    top_build_prefix = @top_build_prefix@
</I>&gt;&gt;&gt;<i>    top_builddir = @top_builddir@
</I>&gt;&gt;&gt;<i>    top_srcdir = @top_srcdir@
</I>&gt;&gt;&gt;<i> -ACLOCAL_AMFLAGS = -I m4
</I>&gt;&gt;&gt;<i> +ACLOCAL_AMFLAGS =
</I>&gt;&gt;&gt;<i>    AUTOMAKE_OPTIONS = foreign
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>    # -I$(srcdir) is needed for user that built libltdl with a sub-Automake
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I don't know how to fix it in source repository.
</I>&gt;&gt;&gt;<i> Help would be appreciated.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Thanks,
</I>&gt;&gt;&gt;<i>     Peter
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> [1] <A HREF="https://github.com/squid-">https://github.com/squid-</A>
</I>&gt;&gt;<i> cache/squid/commit/b4addc2262e5bee37543f8d1ab9dd98337bafba3
</I>&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="027246.html">[squid-users] v6.12 build error from release tarball
</A></li>
	<LI>Next message (by thread): <A HREF="027248.html">[squid-users] Access Log Question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27247">[ date ]</a>
              <a href="thread.html#27247">[ thread ]</a>
              <a href="subject.html#27247">[ subject ]</a>
              <a href="author.html#27247">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
