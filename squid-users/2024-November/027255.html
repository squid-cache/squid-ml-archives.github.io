<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Access Log Question
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Access%20Log%20Question&In-Reply-To=%3C8beca80eada64c2a8f560c0da3d47ffa%40hexcel.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027259.html">
   <LINK REL="Next"  HREF="027260.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Access Log Question</H1>
    <B>Piana, Josh</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Access%20Log%20Question&In-Reply-To=%3C8beca80eada64c2a8f560c0da3d47ffa%40hexcel.com%3E"
       TITLE="[squid-users] Access Log Question">Josh.Piana at hexcel.com
       </A><BR>
    <I>Tue Nov 12 20:57:46 UTC 2024</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="027259.html">[squid-users] Access Log Question
</A></li>
        <LI>Next message (by thread): <A HREF="027260.html">[squid-users] [SQUID] Some Web Page never complete download
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27255">[ date ]</a>
              <a href="thread.html#27255">[ thread ]</a>
              <a href="subject.html#27255">[ subject ]</a>
              <a href="author.html#27255">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello, 

I just reviewed all the steps for authentication Kerberos again. I'm unable to pinpoint any issues at all with the configuration from the keytab file, to the krb5.conf file, to the parameters used in the squid.conf file. And yet, I am surely bypassing the authentication entirely. 

Is there anyone who could help me with this? 

-----Original Message-----
From: Piana, Josh 
Sent: Tuesday, November 12, 2024 10:43 AM
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: RE: [squid-users] Access Log Question

Yeah, we have a few. 

I'll try to detail them below, I apologize for any formatting weirdness. 

auth_param negotiate program /usr/lib64/squid/negotiate_kerberos_auth -k /etc/squid/HTTP.keytab -s HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">arcgate2.ad.arc-tech.com at AD.ARC-TECH.COM</A>
auth_param negotiate children 10
auth_param negotiate keep_alive on
auth_param basic credentialsttl 2 hours
auth_param basic realm ArcTech Proxy Server

acl localhost src 10.46.11.69
acl localhost src 127.0.0.0/8          
acl localnet dst 10.0.0.0/8          
acl localnet dst 172.0.0.0/8           
acl localnet dst bldg3.arc-tech.com.  
acl localnet dst bldg5.arc-tech.com.   

acl SSL_ports port 443          
acl SSL_ports port 5001             
acl SSL_ports port 4434            
acl SSL_ports port 9251            
acl Safe_ports port 21             
acl Safe_ports port 22          
acl Safe_ports port 80           
acl Safe_ports port 443            
acl Safe_ports port 8080         
acl Safe_ports port 8443         
acl Safe_ports port 1025-65535

acl kerb-auth proxy_auth REQUIRED
acl CONNECT method CONNECT
acl local_dst_dom dstdomain arcgate2

http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports

http_access allow local_dst_dom
http_access allow localnet

acl bad_domains_preauth dstdomain &quot;/etc/squid/bad_domains_preauth&quot;
http_access deny bad_domains_preauth

#acl block_user proxy_auth_regex -i &quot;/etc/squid/block_user&quot;
#http_access deny block_user

acl bad_exception_urls url_regex -i &quot;/etc/squid/bad_exception_urls&quot;
http_access allow !bad_exception_urls

acl exec_files url_regex -i &quot;/etc/squid/exec_files&quot;
#acl exec_users proxy_auth_regex -i &quot;/etc/squid/exec_users&quot;
http_access deny !bad_exception_urls exec_files deny_info ERR_BLOCK_TYPE exec_files

#acl mmedia_users proxy_auth_regex -i &quot;/etc/squid/mmedia_users&quot;
acl mmedia_sites dstdomain &quot;/etc/squid/mmedia_sites&quot;
http_access allow CONNECT safe_ports SSL_ports mmedia_sites

acl bad_domains dstdomain &quot;/etc/squid/bad_domains&quot;
http_access deny !bad_exception_urls bad_domains deny_info ERR_BLOCK_DST bad_domains

acl bad_domains_regex dstdom_regex -i &quot;/etc/squid/bad_domains_regex&quot;
http_access deny !bad_exception_urls bad_domains_regex deny_info ERR_BLOCK_DST bad_domains_regex

acl bad_urls url_regex -i &quot;/etc/squid/bad_urls&quot;
http_access deny !bad_exception_urls bad_urls deny_info ERR_BLOCK_DST bad_urls

acl bad_files urlpath_regex -i &quot;/etc/squid/bad_files&quot;
http_access deny !bad_exception_urls bad_files deny_info ERR_BLOCK_TYPE bad_files

http_access allow Safe_ports
http_access allow SSL_ports
http_access deny !kerb-auth
http_access allow kerb-auth
http_access deny all



-----Original Message-----
From: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; On Behalf Of Matus UHLAR - fantomas
Sent: Tuesday, November 12, 2024 10:30 AM
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] Access Log Question

Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.


On 12.11.24 15:22, Piana, Josh wrote:
&gt;<i>I seem to be able to generate tickets by checking klist, and using kinit to authenticate my username with AD. But it looks like the proxy is ignoring it. This could explain why all my proxy_auth ACL's stopped working too.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>Here's my authentication settings:
</I>&gt;<i>auth_param negotiate children 10
</I>&gt;<i>auth_param negotiate keep_alive on
</I>&gt;<i>auth_param basic credentialsttl 2 hours auth_param basic realm 
</I>&gt;<i>&lt;redacted&gt; Proxy Server
</I>&gt;<i>
</I>&gt;<i>acl kerb-auth proxy_auth REQUIRED
</I>&gt;<i>
</I>&gt;<i>The bottom of my ACL Rules looks like this:
</I>&gt;<i>http_access deny !kerb-auth
</I>&gt;<i>http_access allow kerb-auth
</I>&gt;<i>http_access deny all
</I>
The bottom? Are there any ACL rules that allow clients' access before this?
Because ACL rules are processed in the order they are specified.

&gt;<i>-----Original Message-----
</I>&gt;<i>From: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; On Behalf 
</I>&gt;<i>Of Matus UHLAR - fantomas
</I>&gt;<i>Sent: Tuesday, November 12, 2024 10:19 AM
</I>&gt;<i>To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i>Subject: Re: [squid-users] Access Log Question
</I>&gt;<i>
</I>&gt;<i>Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>On 12.11.24 15:16, Piana, Josh wrote:
</I>&gt;&gt;<i>Seems like it.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Example:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>12/Nov/2024:09:51:37 -0500.396 10.46.49.135 TCP_TUNNEL/200 23735 
</I>&gt;&gt;<i>CONNECT 
</I>&gt;&gt;<i><A HREF="http://www.s/">http://www.s/</A>
</I>&gt;&gt;<i>a%2F&amp;data=05%7C02%7Cjosh.piana%40hexcel.com%7C781d9733572443bebebd08dd
</I>&gt;&gt;<i>032ef2d6%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C6386702223804901
</I>&gt;&gt;<i>51%7CUnknown%7CTWFpbGZsb3d8eyJFbXB0eU1hcGkiOnRydWUsIlYiOiIwLjAuMDAwMCI
</I>&gt;&gt;<i>sIlAiOiJXaW4zMiIsIkFOIjoiTWFpbCIsIldUIjoyfQ%3D%3D%7C0%7C%7C%7C&amp;sdata=J
</I>&gt;&gt;<i>D5bPnmHAzYiBf0GEibkaOIItE5n7G5wQaTzYent9K4%3D&amp;reserved=0
</I>&gt;&gt;<i>fgard.com%3A443%2F&amp;data=05%7C02%7Cjosh.piana%40hexcel.com%7C1dd5a668cf
</I>&gt;&gt;<i>f
</I>&gt;&gt;<i>64041506f08dd032d47f6%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C638
</I>&gt;&gt;<i>6
</I>&gt;&gt;<i>70215221064884%7CUnknown%7CTWFpbGZsb3d8eyJFbXB0eU1hcGkiOnRydWUsIlYiOiI
</I>&gt;&gt;<i>w
</I>&gt;&gt;<i>LjAuMDAwMCIsIlAiOiJXaW4zMiIsIkFOIjoiTWFpbCIsIldUIjoyfQ%3D%3D%7C0%7C%7C
</I>&gt;&gt;<i>%
</I>&gt;&gt;<i>7C&amp;sdata=gmzUs90%2Bccg4xxW8WHB2R4Tyb66r1tfKPdsQL2mHmUE%3D&amp;reserved=0 - 
</I>&gt;&gt;<i>\ HIER_DIRECT/206.188.0.52 - -/-
</I>&gt;<i>
</I>&gt;<i>yes, this looks like the username is not known to squid, thus probably bypassed authentication.
</I>&gt;<i>what type of proxy authentication you use?
</I>&gt;<i>
</I>&gt;&gt;<i>-----Original Message-----
</I>&gt;&gt;<i>From: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; On 
</I>&gt;&gt;<i>Behalf Of Matus UHLAR - fantomas
</I>&gt;&gt;<i>Sent: Tuesday, November 12, 2024 10:10 AM
</I>&gt;&gt;<i>To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i>Subject: Re: [squid-users] Access Log Question
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>On 12.11.24 14:56, Piana, Josh wrote:
</I>&gt;&gt;&gt;<i> At some point, the access log has stopped recording which users are 
</I>&gt;&gt;&gt;<i> trying to access which sites.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I'm currently thinking is could be an issue with log format, Squid 
</I>&gt;&gt;&gt;<i> not being able to receive the header information, or authentication 
</I>&gt;&gt;&gt;<i> is being bypassed completely due to our config, for some reason.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>what is it logging? doest is log &quot;-&quot; instead of usernames?
</I>--
Matus UHLAR - fantomas, <A HREF="https://lists.squid-cache.org/listinfo/squid-users">uhlar at fantomas.sk</A> ; <A HREF="http://www.fantomas.sk/">http://www.fantomas.sk/</A>
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
&quot;To Boot or not to Boot, that's the question.&quot; [WD1270 Caviar] _______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="027259.html">[squid-users] Access Log Question
</A></li>
	<LI>Next message (by thread): <A HREF="027260.html">[squid-users] [SQUID] Some Web Page never complete download
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27255">[ date ]</a>
              <a href="thread.html#27255">[ thread ]</a>
              <a href="subject.html#27255">[ subject ]</a>
              <a href="author.html#27255">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
