<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] messages when &quot;squid -k rotate&quot; is run
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20messages%20when%20%22squid%20-k%20rotate%22%20is%20run&In-Reply-To=%3C819da5b5-4e2b-4742-a393-a2a6a910e5fb%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027274.html">
   <LINK REL="Next"  HREF="027281.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] messages when &quot;squid -k rotate&quot; is run</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20messages%20when%20%22squid%20-k%20rotate%22%20is%20run&In-Reply-To=%3C819da5b5-4e2b-4742-a393-a2a6a910e5fb%40measurement-factory.com%3E"
       TITLE="[squid-users] messages when &quot;squid -k rotate&quot; is run">rousskov at measurement-factory.com
       </A><BR>
    <I>Thu Nov 21 21:16:32 UTC 2024</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="027274.html">[squid-users] messages when &quot;squid -k rotate&quot; is run
</A></li>
        <LI>Next message (by thread): <A HREF="027281.html">[squid-users] messages when &quot;squid -k rotate&quot; is run
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27279">[ date ]</a>
              <a href="thread.html#27279">[ thread ]</a>
              <a href="subject.html#27279">[ subject ]</a>
              <a href="author.html#27279">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2024-11-21 07:29, Matus UHLAR - fantomas wrote:
&gt;<i> I run squid 6 (currently 6.10) on some debian hosts.
</I>&gt;<i> 
</I>&gt;<i> when rotating logs in the night, I get mail about cron output:
</I>&gt;<i> 
</I>&gt;<i> 2024/11/21 00:00:41| Processing Configuration File: 
</I>&gt;<i> /etc/squid/squid.conf (depth 0)
</I>&gt;<i> 2024/11/21 00:00:41| Processing Configuration File: 
</I>&gt;<i> /etc/squid/conf.d/debian.conf (depth 1)
</I>&gt;<i> 2024/11/21 00:00:41| Processing Configuration File: 
</I>&gt;<i> /etc/squid/conf.d/ftplog.conf (depth 1)
</I>&gt;<i> 2024/11/21 00:00:41| Set Current Directory to /var/spool/squid
</I>&gt;<i> 
</I>&gt;<i> This did not happen with squid-5.7
</I>&gt;<i> - is this a bug or a new feature?
</I>
IIRC, it is a side effect of a bug fix (or a series of bug fixes, to be 
more precise). Earlier, such messages were dropped or went to cache.log 
(violating locking rules and messing up triage of other complicated bugs 
and misconfigurations).


&gt;<i> Those messages are sent to stderr, not stdout. I can imply redirect the 
</I>&gt;<i> &quot;squid -k rotate&quot; stderr to /dev/null
</I>&gt;<i> but I would like to avoid it when possible - if any error happens, I't 
</I>&gt;<i> like to know about that.
</I>
If you are OK with not seeing these particular messages in cache.log and 
on stderr, disable their level-1 reporting using cache_log_message 
directive. The ID of those messages is 68 (see doc/debug-messages.dox 
for IDs of other messages that can be controlled in your Squid).

For example:

     cache_log_message id=68 level=2


IIRC: Core developers failed to reach consensus regarding the best level 
for these messages, so their original &quot;important&quot; level (1) was 
preserved. The argument was &quot;folks are quite often mistaken regarding 
what configuration files their Squids are actually using&quot;.


If you want Squid to only report errors to stderr, then you will need to 
  wait for (or orchestrate) the corresponding code changes. Currently, 
Squid defines error as a message with an ERROR: or FATAL: prefix. There 
is no Squid code to treat such messages specially though (yet?). For 
more details, please see 
<A HREF="https://github.com/squid-cache/squid/commit/d816f28de8ba817a98a49f9cfd88ddaa334d7aad">https://github.com/squid-cache/squid/commit/d816f28de8ba817a98a49f9cfd88ddaa334d7aad</A>

You may be able to emulate the above error detection/handling (including 
its risks related to incorrectly unclassified/unprefixed messages) via a 
shell script. For example, something like this might be a good starting 
point:

     squid -k rotate |&amp; grep -E &quot;FATAL:|ERROR:&quot;

or, with added logging of all stderr messages:

     squid -k rotate |&amp; \
         tee squid-last-rotate.log | \
         grep -E &quot;FATAL:|ERROR:&quot;

However, the above sketches need more work/adjustments to preserve 
&quot;squid -k rotate&quot; exit status code!


HTH,

Alex.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="027274.html">[squid-users] messages when &quot;squid -k rotate&quot; is run
</A></li>
	<LI>Next message (by thread): <A HREF="027281.html">[squid-users] messages when &quot;squid -k rotate&quot; is run
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27279">[ date ]</a>
              <a href="thread.html#27279">[ thread ]</a>
              <a href="subject.html#27279">[ subject ]</a>
              <a href="author.html#27279">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
