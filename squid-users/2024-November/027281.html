<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] messages when &quot;squid -k rotate&quot; is run
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20messages%20when%20%22squid%20-k%20rotate%22%20is%20run&In-Reply-To=%3CZ0C5q2agbVAkt23J%40fantomas.sk%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027279.html">
   <LINK REL="Next"  HREF="027282.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] messages when &quot;squid -k rotate&quot; is run</H1>
    <B>Matus UHLAR - fantomas</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20messages%20when%20%22squid%20-k%20rotate%22%20is%20run&In-Reply-To=%3CZ0C5q2agbVAkt23J%40fantomas.sk%3E"
       TITLE="[squid-users] messages when &quot;squid -k rotate&quot; is run">uhlar at fantomas.sk
       </A><BR>
    <I>Fri Nov 22 17:04:43 UTC 2024</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="027279.html">[squid-users] messages when &quot;squid -k rotate&quot; is run
</A></li>
        <LI>Next message (by thread): <A HREF="027282.html">[squid-users] messages when &quot;squid -k rotate&quot; is run
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27281">[ date ]</a>
              <a href="thread.html#27281">[ thread ]</a>
              <a href="subject.html#27281">[ subject ]</a>
              <a href="author.html#27281">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i>On 2024-11-21 07:29, Matus UHLAR - fantomas wrote:
</I>&gt;&gt;<i>I run squid 6 (currently 6.10) on some debian hosts.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>when rotating logs in the night, I get mail about cron output:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>2024/11/21 00:00:41| Processing Configuration File: 
</I>&gt;&gt;<i>/etc/squid/squid.conf (depth 0)
</I>&gt;&gt;<i>2024/11/21 00:00:41| Processing Configuration File: 
</I>&gt;&gt;<i>/etc/squid/conf.d/debian.conf (depth 1)
</I>&gt;&gt;<i>2024/11/21 00:00:41| Processing Configuration File: 
</I>&gt;&gt;<i>/etc/squid/conf.d/ftplog.conf (depth 1)
</I>&gt;&gt;<i>2024/11/21 00:00:41| Set Current Directory to /var/spool/squid
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>This did not happen with squid-5.7
</I>&gt;&gt;<i>- is this a bug or a new feature?
</I>
&gt;<i>IIRC, it is a side effect of a bug fix (or a series of bug fixes, to 
</I>&gt;<i>be more precise). Earlier, such messages were dropped or went to 
</I>&gt;<i>cache.log (violating locking rules and messing up triage of other 
</I>&gt;<i>complicated bugs and misconfigurations).
</I>
&gt;&gt;<i>Those messages are sent to stderr, not stdout. I can imply redirect 
</I>&gt;&gt;<i>the &quot;squid -k rotate&quot; stderr to /dev/null
</I>&gt;&gt;<i>but I would like to avoid it when possible - if any error happens, 
</I>&gt;&gt;<i>I't like to know about that.
</I>
On 21.11.24 16:16, Alex Rousskov wrote:
&gt;<i>If you are OK with not seeing these particular messages in cache.log 
</I>&gt;<i>and on stderr, disable their level-1 reporting using cache_log_message 
</I>&gt;<i>directive. The ID of those messages is 68 (see doc/debug-messages.dox 
</I>&gt;<i>for IDs of other messages that can be controlled in your Squid).
</I>
Only cache.log would be ideal.  However, the description at 
<A HREF="http://www.squid-cache.org/Doc/config/cache_log_message/">http://www.squid-cache.org/Doc/config/cache_log_message/</A> is not clear enough 
what exactly that level means, and unfortunately you didn't make id more 
clear.
(the page is mentioning doc/debug-messages.txt btw)

Do I understand it properly that level 1 goes to stderr+cache.log and level 
2 nowhere?

&gt;<i>For example:
</I>&gt;<i>
</I>&gt;<i>    cache_log_message id=68 level=2
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>IIRC: Core developers failed to reach consensus regarding the best 
</I>&gt;<i>level for these messages, so their original &quot;important&quot; level (1) was 
</I>&gt;<i>preserved. The argument was &quot;folks are quite often mistaken regarding 
</I>&gt;<i>what configuration files their Squids are actually using&quot;.
</I>
That makes sense, kinda.

&gt;<i>If you want Squid to only report errors to stderr, then you will need 
</I>&gt;<i>to  wait for (or orchestrate) the corresponding code changes. 
</I>&gt;<i>Currently, Squid defines error as a message with an ERROR: or FATAL: 
</I>&gt;<i>prefix. There is no Squid code to treat such messages specially though 
</I>&gt;<i>(yet?). For more details, please see <A HREF="https://github.com/squid-cache/squid/commit/d816f28de8ba817a98a49f9cfd88ddaa334d7aad">https://github.com/squid-cache/squid/commit/d816f28de8ba817a98a49f9cfd88ddaa334d7aad</A>
</I>&gt;<i>
</I>&gt;<i>You may be able to emulate the above error detection/handling 
</I>&gt;<i>(including its risks related to incorrectly unclassified/unprefixed 
</I>&gt;<i>messages) via a shell script. For example, something like this might 
</I>&gt;<i>be a good starting point:
</I>&gt;<i>
</I>&gt;<i>    squid -k rotate |&amp; grep -E &quot;FATAL:|ERROR:&quot;
</I>&gt;<i>
</I>&gt;<i>or, with added logging of all stderr messages:
</I>&gt;<i>
</I>&gt;<i>    squid -k rotate |&amp; \
</I>&gt;<i>        tee squid-last-rotate.log | \
</I>&gt;<i>        grep -E &quot;FATAL:|ERROR:&quot;
</I>&gt;<i>
</I>&gt;<i>However, the above sketches need more work/adjustments to preserve 
</I>&gt;<i>&quot;squid -k rotate&quot; exit status code!
</I>
-- 
Matus UHLAR - fantomas, <A HREF="https://lists.squid-cache.org/listinfo/squid-users">uhlar at fantomas.sk</A> ; <A HREF="http://www.fantomas.sk/">http://www.fantomas.sk/</A>
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
M$ Win's are shit, do not use it !

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="027279.html">[squid-users] messages when &quot;squid -k rotate&quot; is run
</A></li>
	<LI>Next message (by thread): <A HREF="027282.html">[squid-users] messages when &quot;squid -k rotate&quot; is run
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27281">[ date ]</a>
              <a href="thread.html#27281">[ thread ]</a>
              <a href="subject.html#27281">[ subject ]</a>
              <a href="author.html#27281">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
