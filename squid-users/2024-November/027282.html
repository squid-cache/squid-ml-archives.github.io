<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] messages when &quot;squid -k rotate&quot; is run
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20messages%20when%20%22squid%20-k%20rotate%22%20is%20run&In-Reply-To=%3C209108fd-4b24-44c8-bb82-6a5c0451d6b2%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027281.html">
   <LINK REL="Next"  HREF="027275.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] messages when &quot;squid -k rotate&quot; is run</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20messages%20when%20%22squid%20-k%20rotate%22%20is%20run&In-Reply-To=%3C209108fd-4b24-44c8-bb82-6a5c0451d6b2%40measurement-factory.com%3E"
       TITLE="[squid-users] messages when &quot;squid -k rotate&quot; is run">rousskov at measurement-factory.com
       </A><BR>
    <I>Fri Nov 22 23:29:45 UTC 2024</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="027281.html">[squid-users] messages when &quot;squid -k rotate&quot; is run
</A></li>
        <LI>Next message (by thread): <A HREF="027275.html">[squid-users] Can I force certain destinations to ipv4?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27282">[ date ]</a>
              <a href="thread.html#27282">[ thread ]</a>
              <a href="subject.html#27282">[ subject ]</a>
              <a href="author.html#27282">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2024-11-22 12:04, Matus UHLAR - fantomas wrote:
&gt;&gt;<i> On 2024-11-21 07:29, Matus UHLAR - fantomas wrote:
</I>&gt;&gt;&gt;<i> I run squid 6 (currently 6.10) on some debian hosts.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> when rotating logs in the night, I get mail about cron output:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> 2024/11/21 00:00:41| Processing Configuration File: 
</I>&gt;&gt;&gt;<i> /etc/squid/squid.conf (depth 0)
</I>&gt;&gt;&gt;<i> 2024/11/21 00:00:41| Processing Configuration File: 
</I>&gt;&gt;&gt;<i> /etc/squid/conf.d/debian.conf (depth 1)
</I>&gt;&gt;&gt;<i> 2024/11/21 00:00:41| Processing Configuration File: 
</I>&gt;&gt;&gt;<i> /etc/squid/conf.d/ftplog.conf (depth 1)
</I>&gt;&gt;&gt;<i> 2024/11/21 00:00:41| Set Current Directory to /var/spool/squid
</I>
&gt;&gt;&gt;<i> Those messages are sent to stderr, not stdout. I can imply redirect 
</I>&gt;&gt;&gt;<i> the &quot;squid -k rotate&quot; stderr to /dev/null
</I>&gt;&gt;&gt;<i> but I would like to avoid it when possible - if any error happens, 
</I>&gt;&gt;&gt;<i> I't like to know about that.
</I>
&gt;<i> On 21.11.24 16:16, Alex Rousskov wrote:
</I>&gt;&gt;<i> If you are OK with not seeing these particular messages in cache.log 
</I>&gt;&gt;<i> and on stderr, disable their level-1 reporting using cache_log_message 
</I>&gt;&gt;<i> directive. The ID of those messages is 68 (see doc/debug-messages.dox 
</I>&gt;&gt;<i> for IDs of other messages that can be controlled in your Squid).
</I>
&gt;<i> Only cache.log would be ideal. 
</I>
Short answer: AFAICT, that ideal is not supported for what you want to do.

Longer answer: The following _combination_ is not supported (yet?) AFAICT:

* Sending only level-0/1 messages to cache.log,
* including a particular level-1 message.
* Sending only level-0/1 messages to stderr,
* except for a particular level-1 message.


&gt;<i> However, the description at 
</I>&gt;<i> <A HREF="http://www.squid-cache.org/Doc/config/cache_log_message/">http://www.squid-cache.org/Doc/config/cache_log_message/</A> is not clear 
</I>&gt;<i> enough what exactly that level means,
</I>
Documentation improvements are welcome! Existing cache_log_message 
documentation reuses a fairly well-known &quot;debugging level&quot; concept that 
is more-or-less described in debug_options directive documentation. 
cache_log_message docs do refer to debug_options in &quot;level=&lt;number&gt;&quot; 
bullet. I am sure all of this can be significantly improved.


&gt;<i> and unfortunately you didn't make id more clear.
</I>
I assume you meant to say &quot;it&quot; (i.e. &quot;level meaning&quot;) rather than &quot;id&quot;. 
I am sorry that I failed to realize that &quot;level&quot; should be clarified in 
this context. I should have been more careful with my assumptions!


&gt;<i> (the page is mentioning doc/debug-messages.txt btw)
</I>
Thank you for reporting that documentation bug. I proposed a fix at
<A HREF="https://github.com/squid-cache/squid/pull/1953">https://github.com/squid-cache/squid/pull/1953</A>


&gt;<i> Do I understand it properly that level 1 goes to stderr+cache.log and 
</I>&gt;<i> level 2 nowhere?
</I>
Short answer: Not quite. Assuming an error-free squid executable start 
(e.g., not &quot;squid -k&quot;!) and default debug_options (i.e. &quot;ALL,1&quot;), all 
level-0/1 messages go to cache.log and nothing goes to stderr. Level-2+ 
messages are not logged anywhere.

Longer answer:

Each message has a hard-coded debugging level. Roughly speaking, higher 
levels are used for more frequent messages. Levels above 2 are meant for 
developers (rather than admins). Levels above 1 are not meant for 
sustained production use because they slow Squid down and generate huge 
logs.

* Messages with debugging level L go to cache.log if debug_options allow 
debugging level L. For example, &quot;debug_options ALL,2&quot; would allow 
messages with debugging levels 0, 1, and 2 to be logged to cache.log.

* Messages with debugging level L that are allowed to go to cache.log 
(see above) go to stderr if command line option -d allows them to go to 
stderr. For example, a combination of &quot;debug_options ALL,2&quot; and &quot;-d 1&quot; 
would allow messages with debugging levels 0 and 1 to be logged to stderr.

By default, in error-free cases, when running squid executable that is 
supposed to (eventually) log to cache.log, nothing goes to stderr and 
level-0/1 messages go to cache.log. In such cases, -d value defaults to 
the equivalent of &quot;none&quot;. To see stderr output in such cases, one has to 
start squid with -d0 or higher.

When running &quot;squid -k ...&quot; -d defaults to 1 and nothing goes to cache.log.

Sounds complicated? There is also syslog with its own level-related 
policies! :-)


HTH,

Alex.


&gt;&gt;<i> For example:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &#160;&#160; cache_log_message id=68 level=2
</I>
&gt;&gt;<i> If you want Squid to only report errors to stderr, then you will need 
</I>&gt;&gt;<i> to&#160; wait for (or orchestrate) the corresponding code changes. 
</I>&gt;&gt;<i> Currently, Squid defines error as a message with an ERROR: or FATAL: 
</I>&gt;&gt;<i> prefix. There is no Squid code to treat such messages specially though 
</I>&gt;&gt;<i> (yet?). For more details, please see 
</I>&gt;&gt;<i> <A HREF="https://github.com/squid-cache/squid/commit/d816f28de8ba817a98a49f9cfd88ddaa334d7aad">https://github.com/squid-cache/squid/commit/d816f28de8ba817a98a49f9cfd88ddaa334d7aad</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> You may be able to emulate the above error detection/handling 
</I>&gt;&gt;<i> (including its risks related to incorrectly unclassified/unprefixed 
</I>&gt;&gt;<i> messages) via a shell script. For example, something like this might 
</I>&gt;&gt;<i> be a good starting point:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &#160;&#160; squid -k rotate |&amp; grep -E &quot;FATAL:|ERROR:&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> or, with added logging of all stderr messages:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &#160;&#160; squid -k rotate |&amp; \
</I>&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160; tee squid-last-rotate.log | \
</I>&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160; grep -E &quot;FATAL:|ERROR:&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> However, the above sketches need more work/adjustments to preserve 
</I>&gt;&gt;<i> &quot;squid -k rotate&quot; exit status code!
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="027281.html">[squid-users] messages when &quot;squid -k rotate&quot; is run
</A></li>
	<LI>Next message (by thread): <A HREF="027275.html">[squid-users] Can I force certain destinations to ipv4?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27282">[ date ]</a>
              <a href="thread.html#27282">[ thread ]</a>
              <a href="subject.html#27282">[ subject ]</a>
              <a href="author.html#27282">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
