From 0xff1f at gmail.com  Tue Oct  1 15:49:40 2024
From: 0xff1f at gmail.com (Dr.X)
Date: Tue, 1 Oct 2024 15:49:40 +0000
Subject: [squid-users] Could we have variables in squid conf file ?
In-Reply-To: <5f2a8855-a478-4478-9d37-d7a0cfeb5a09@measurement-factory.com>
References: <CA+KaO5oUV8rQM6W-JN4xTAnRApLj0uBNLmiw7zzm6QyTtXyRuw@mail.gmail.com>
 <5f2a8855-a478-4478-9d37-d7a0cfeb5a09@measurement-factory.com>
Message-ID: <DU0PR10MB680372954AFF43F3EF33357FF7772@DU0PR10MB6803.EURPRD10.PROD.OUTLOOK.COM>

Hello Guys ,
Just wondering if I can have in squid.conf like :

export FRONTEND='1.2.3.4'
export Folder=?rtx21?
export SUBSESSIONS=20

http_port {FRONTEND}:3128
auth_param basic program /lib/stinger/basic_ncsa_auth /etc/stinger/squid_user{Folder}

But the way above did not work and seems not recognized by squid .

My question is , Is it possible that I identify a variable and give it a value like string , number and call it in another place in squid.conf file ?


Using squid 5.x

Thanks


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20241001/634743bf/attachment.htm>

From jonathanlee571 at gmail.com  Tue Oct  1 16:05:56 2024
From: jonathanlee571 at gmail.com (Jonathan Lee)
Date: Tue, 1 Oct 2024 09:05:56 -0700
Subject: [squid-users] Wpad
Message-ID: <C798FF8B-EA80-4FDF-83C4-2FEF9522008B@gmail.com>

Hello fellow squid users,

Can you please help? I am attempting to run wpad on the same machine as squid however port 80 443 is blocked, I have a url redirect 192.168.1.1/wpad.dat to https://192.168.1.1:8080/wpad.dat this is done with use of squid guard, however you must disable bypass for 192.168.1.1 on squid. Squid resides on 192.168.1.1:3128,

It works on the iMac for auto config proxy I can access the url file within the redirect.

My question is how can this be managed directly with squid custom config ?? Is there a way to have squid manage a simple wpad? 
Sent from my iPhone

From rousskov at measurement-factory.com  Tue Oct  1 16:06:57 2024
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Tue, 1 Oct 2024 12:06:57 -0400
Subject: [squid-users] Could we have variables in squid conf file ?
In-Reply-To: <DU0PR10MB680372954AFF43F3EF33357FF7772@DU0PR10MB6803.EURPRD10.PROD.OUTLOOK.COM>
References: <CA+KaO5oUV8rQM6W-JN4xTAnRApLj0uBNLmiw7zzm6QyTtXyRuw@mail.gmail.com>
 <5f2a8855-a478-4478-9d37-d7a0cfeb5a09@measurement-factory.com>
 <DU0PR10MB680372954AFF43F3EF33357FF7772@DU0PR10MB6803.EURPRD10.PROD.OUTLOOK.COM>
Message-ID: <d1fa6d76-3d47-48d9-b02b-b53338e10fda@measurement-factory.com>

On 2024-10-01 11:49, Dr.X wrote:

> Just wondering if I can have in squid.conf like :
> 
> export FRONTEND='1.2.3.4'
> http_port {FRONTEND}:3128
> 
> But the way above did not work and seems not recognized by squid .
> 
> My question is , Is it possible that I identify a variable and give it a 
> value like string , number and call it in another place in squid.conf file ?


No, squid.conf does not support such variables (yet?). Needless to say, 
you can emulate that functionality using a custom preprocessor.


HTH,

Alex.



From uhlar at fantomas.sk  Tue Oct  1 16:09:43 2024
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Tue, 1 Oct 2024 18:09:43 +0200
Subject: [squid-users] Could we have variables in squid conf file ?
In-Reply-To: <d1fa6d76-3d47-48d9-b02b-b53338e10fda@measurement-factory.com>
References: <CA+KaO5oUV8rQM6W-JN4xTAnRApLj0uBNLmiw7zzm6QyTtXyRuw@mail.gmail.com>
 <5f2a8855-a478-4478-9d37-d7a0cfeb5a09@measurement-factory.com>
 <DU0PR10MB680372954AFF43F3EF33357FF7772@DU0PR10MB6803.EURPRD10.PROD.OUTLOOK.COM>
 <d1fa6d76-3d47-48d9-b02b-b53338e10fda@measurement-factory.com>
Message-ID: <Zvwex0u3UVU4S3wV@fantomas.sk>

>On 2024-10-01 11:49, Dr.X wrote:
>>Just wondering if I can have in squid.conf like :
>>
>>export FRONTEND='1.2.3.4'
>>http_port {FRONTEND}:3128
>>
>>But the way above did not work and seems not recognized by squid .
>>
>>My question is , Is it possible that I identify a variable and give 
>>it a value like string , number and call it in another place in 
>>squid.conf file ?

On 01.10.24 12:06, Alex Rousskov wrote:
>No, squid.conf does not support such variables (yet?). Needless to 
>say, you can emulate that functionality using a custom preprocessor.

I used to define host names (available in /etc/hosts) for directives like 
this one.

I am not sure if http_port supports this but you should be able to check.

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Fighting for peace is like fucking for virginity...


From rousskov at measurement-factory.com  Wed Oct  2 21:30:49 2024
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Wed, 2 Oct 2024 17:30:49 -0400
Subject: [squid-users] Squid + ecap + clamav
In-Reply-To: <55796866-6d4e-4652-892b-ce5422449b76@netfence.it>
References: <55796866-6d4e-4652-892b-ce5422449b76@netfence.it>
Message-ID: <c0e177dc-0ff6-44dd-a579-24098f223c9f@measurement-factory.com>

On 2024-09-29 12:40, Andrea Venturoli wrote:

> I've been using Squid + C-icap + SquidClamAV + ClamAV for a long time in 
> order to filter web content.
> However this has lately been troublesome, leading to occasional 
> hard-to-diagnose temporary failures ("ICAP protocol error").

> So I'm pondering moving from ICAP to eCAP, like described here:
>> https://wiki.squid-cache.org/ConfigExamples/ContentAdaptation/EcapForClamav

eCAP and ICAP options offer different tradeoffs (i.e. have a different 
set of pros and cons).


> According to that page there are no disadvantages wrt to the previous 
> config.

Disadvantages of using eCAP+ClamAV adapter include being dependent on a 
relatively old libecap and ClamAV eCAP adapter implementation. If things 
go wrong or if you want new features, fewer folks would be able to help 
you compared to a better known ICAP protocol and (more recently updated) 
c-icap server.


> However, I tried compiling the eCAP ClamAV adapter, but the code looks 
> very outdated WRT to C++ standards

Yes, both libecap and eCAP ClamAV adapter were last updated in 2015.


> and possibly 
> also to ClamAV (giving compiling errors due to missing symbols).

If libclamav API has changed in backward incompatible ways, then eCAP 
ClamAV adapter source code would have to be updated to reflect those API 
changes. Unfortunately, I have not recorded what ClamAV version we were 
using when eCAP ClamAV adapter was developed.


> Is this info still relevant?
 > Is this something worth investigating or is it outdated/deprecated?


I would treat that ConfigExamples page as an old configuration example 
that probably worked for the author when that page was written years 
ago. It can be used as a starting point for getting things working in 
your environment. Nothing more, nothing less.


HTH,

Alex.



From squid3 at treenet.co.nz  Thu Oct  3 03:51:41 2024
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 3 Oct 2024 16:51:41 +1300
Subject: [squid-users] Wpad
In-Reply-To: <C798FF8B-EA80-4FDF-83C4-2FEF9522008B@gmail.com>
References: <C798FF8B-EA80-4FDF-83C4-2FEF9522008B@gmail.com>
Message-ID: <a98dbcb0-8a1e-445e-aba2-2e7b54429817@treenet.co.nz>

On 2/10/24 05:05, Jonathan Lee wrote:
> Hello fellow squid users,
> 
> Can you please help? I am attempting to run wpad on the same machine as squid however port 80 443 is blocked, I have a url redirect 192.168.1.1/wpad.dat to https://192.168.1.1:8080/wpad.dat this is done with use of squid guard, however you must disable bypass for 192.168.1.1 on squid. Squid resides on 192.168.1.1:3128,
> 
> It works on the iMac for auto config proxy I can access the url file within the redirect.
> 
> My question is how can this be managed directly with squid custom config ?? Is there a way to have squid manage a simple wpad?


   acl wpad urlpath_regex ^/wpad.dat$
   deny_info 200:/etc/squid/wpad.dat wpad
   http_access deny wpad

   reply_header_access Content-Type deny wpad
   reply_header_replace Content-Type application/x-ns-proxy-autoconfig



HTH
Amos


From jonathanlee571 at gmail.com  Thu Oct  3 13:24:35 2024
From: jonathanlee571 at gmail.com (Jonathan Lee)
Date: Thu, 3 Oct 2024 06:24:35 -0700
Subject: [squid-users] Wpad
In-Reply-To: <a98dbcb0-8a1e-445e-aba2-2e7b54429817@treenet.co.nz>
References: <a98dbcb0-8a1e-445e-aba2-2e7b54429817@treenet.co.nz>
Message-ID: <4C2F9BEC-56F5-4739-8781-1B2382D0030B@gmail.com>

Thanks Jeffries 

Jonathan Lee
Sent from my iPhone

> On Oct 3, 2024, at 01:07, Amos Jeffries <squid3 at treenet.co.nz> wrote:
> 
> ?On 2/10/24 05:05, Jonathan Lee wrote:
>> Hello fellow squid users,
>> Can you please help? I am attempting to run wpad on the same machine as squid however port 80 443 is blocked, I have a url redirect 192.168.1.1/wpad.dat to https://192.168.1.1:8080/wpad.dat this is done with use of squid guard, however you must disable bypass for 192.168.1.1 on squid. Squid resides on 192.168.1.1:3128,
>> It works on the iMac for auto config proxy I can access the url file within the redirect.
>> My question is how can this be managed directly with squid custom config ?? Is there a way to have squid manage a simple wpad?
> 
> 
>  acl wpad urlpath_regex ^/wpad.dat$
>  deny_info 200:/etc/squid/wpad.dat wpad
>  http_access deny wpad
> 
>  reply_header_access Content-Type deny wpad
>  reply_header_replace Content-Type application/x-ns-proxy-autoconfig
> 
> 
> 
> HTH
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> https://lists.squid-cache.org/listinfo/squid-users


From ml at netfence.it  Thu Oct  3 14:12:03 2024
From: ml at netfence.it (Andrea Venturoli)
Date: Thu, 3 Oct 2024 16:12:03 +0200
Subject: [squid-users] Squid + ecap + clamav
In-Reply-To: <c0e177dc-0ff6-44dd-a579-24098f223c9f@measurement-factory.com>
References: <55796866-6d4e-4652-892b-ce5422449b76@netfence.it>
 <c0e177dc-0ff6-44dd-a579-24098f223c9f@measurement-factory.com>
Message-ID: <fa66f968-a30d-431d-bd46-e0130b7e91a4@netfence.it>

On 10/2/24 23:30, Alex Rousskov wrote:


> Disadvantages of using eCAP+ClamAV adapter include being dependent on a 
> relatively old libecap and ClamAV eCAP adapter implementation.

Ah!
I got it all wrong then... I thought ICAP was older and eCAP was meant 
to replace it.
Thanks for clarifying.



> I would treat that ConfigExamples page as an old configuration example 
> that probably worked for the author when that page was written years 
> ago. It can be used as a starting point for getting things working in 
> your environment. Nothing more, nothing less.

Thanks again.
I guess the way to go is try to fix the troubles with my current 
architecture, then.
I'll write a separate message for that.



  bye
	av.


From rousskov at measurement-factory.com  Thu Oct  3 14:54:47 2024
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Thu, 3 Oct 2024 10:54:47 -0400
Subject: [squid-users] Squid + ecap + clamav
In-Reply-To: <fa66f968-a30d-431d-bd46-e0130b7e91a4@netfence.it>
References: <55796866-6d4e-4652-892b-ce5422449b76@netfence.it>
 <c0e177dc-0ff6-44dd-a579-24098f223c9f@measurement-factory.com>
 <fa66f968-a30d-431d-bd46-e0130b7e91a4@netfence.it>
Message-ID: <ab2e6458-6235-404e-a013-a607e4bfef44@measurement-factory.com>

On 2024-10-03 10:12, Andrea Venturoli wrote:
> On 10/2/24 23:30, Alex Rousskov wrote:
>> Disadvantages of using eCAP+ClamAV adapter include being dependent on 
>> a relatively old libecap and ClamAV eCAP adapter implementation.
> 
> I got it all wrong then... I thought ICAP was older and eCAP was meant 
> to replace it.

ICAP _is_ older than eCAP.

eCAP goals did not include ICAP replacement IIRC. eCAP solves certain 
ICAP performance problems by replacing communication over TCP 
connections with function calls. Some environments are better off with 
eCAP; others with ICAP. There are many tradeoffs. I wish we had time to 
improve eCAP, but it is being successfully used in some current 
production environments despite its outdated code.


Cheers,

Alex.



From ml at netfence.it  Thu Oct  3 15:10:52 2024
From: ml at netfence.it (Andrea Venturoli)
Date: Thu, 3 Oct 2024 17:10:52 +0200
Subject: [squid-users] Squid + c-icap + SquidClamav + ClamAV
Message-ID: <13f99390-2bfb-4d86-a319-684700b900b8@netfence.it>

Hello.

I've got several machines with the following software:
FreeBSD 13.3, 13.4 or 14.1
Squid 6.10
c-icap 0.5.12
SquidClamav 7.3
ClamA: 1.3.2

This combination usually works pretty well, but it occasionally chokes, 
with the client seeing:
> ICAP protocol error
> The system returned: [No Error]

Out of 10 installations, 7 works perfecly (at least that I know), a 
couple very seldom have shown this error, but on one it's very frequent.



I checked the logs:
_ i think Squid's access log shows a NONE_NONE/500 code at the time of 
the error: I personally can't get anything useful from this, but maybe 
someone with better insight can tell?
_ cache.log does not seem to show anything related;
_ neither c-icap's, nor ClamAV's logs show anything useful.



I already applied the following patch:
https://github.com/measurement-factory/squid/commit/6567eac.patch

On one host that had always worked perfeclty, but suddenly had started 
giving this trouble several time per hours, it almost solved (i.e. I 
think the error was seen once in the latest few months).
However, it didn't help on the most problematic host.



Any idea on what to check or try? Any other known bug? Any way to get 
better logs?


  bye & Thanks
	av.


From rousskov at measurement-factory.com  Thu Oct  3 16:29:56 2024
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Thu, 3 Oct 2024 12:29:56 -0400
Subject: [squid-users] Squid + c-icap + SquidClamav + ClamAV
In-Reply-To: <13f99390-2bfb-4d86-a319-684700b900b8@netfence.it>
References: <13f99390-2bfb-4d86-a319-684700b900b8@netfence.it>
Message-ID: <54a91d66-ae7c-4a02-945d-a23744391e91@measurement-factory.com>

On 2024-10-03 11:10, Andrea Venturoli wrote:

 > Out of 10 installations, ... on one it's very frequent.

 > Any idea on what to check or try? ... Any way to get better logs?

Since the problem is frequent on that one host, I recommend privately 
sharing[1] a pointer to compressed debugging cache.log collected while 
the problem was happening. Either set debug_options to ALL,9 or use a 
pair of "squid -k debug" commands to start/stop debugging. More hints at
https://wiki.squid-cache.org/SquidFaq/BugReporting#debugging-a-single-transaction

It is enough to record one or two problematic cases.

Please make sure to patch your Squid with 6567eac.patch you reference 
below before collecting those logs -- we do not want to analyze a 
known/fixed bug.


HTH,

Alex.

[1]: You can share that sample with me or anybody you trust (who can 
analyze Squid debugging logs and is willing to help you).


> I've got several machines with the following software:
> FreeBSD 13.3, 13.4 or 14.1
> Squid 6.10
> c-icap 0.5.12
> SquidClamav 7.3
> ClamA: 1.3.2
> 
> This combination usually works pretty well, but it occasionally chokes, 
> with the client seeing:
>> ICAP protocol error
>> The system returned: [No Error]
> 
> Out of 10 installations, 7 works perfecly (at least that I know), a 
> couple very seldom have shown this error, but on one it's very frequent.
> 
> 
> 
> I checked the logs:
> _ i think Squid's access log shows a NONE_NONE/500 code at the time of 
> the error: I personally can't get anything useful from this, but maybe 
> someone with better insight can tell?
> _ cache.log does not seem to show anything related;
> _ neither c-icap's, nor ClamAV's logs show anything useful.
> 
> 
> 
> I already applied the following patch:
> https://github.com/measurement-factory/squid/commit/6567eac.patch
> 
> On one host that had always worked perfeclty, but suddenly had started 
> giving this trouble several time per hours, it almost solved (i.e. I 
> think the error was seen once in the latest few months).
> However, it didn't help on the most problematic host.
> 
> 
> 
> Any idea on what to check or try? Any other known bug? Any way to get 
> better logs?
> 
> 
>  ?bye & Thanks
>  ????av.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> https://lists.squid-cache.org/listinfo/squid-users



From ml at netfence.it  Thu Oct  3 17:21:42 2024
From: ml at netfence.it (Andrea Venturoli)
Date: Thu, 3 Oct 2024 19:21:42 +0200
Subject: [squid-users] Squid + c-icap + SquidClamav + ClamAV
In-Reply-To: <54a91d66-ae7c-4a02-945d-a23744391e91@measurement-factory.com>
References: <13f99390-2bfb-4d86-a319-684700b900b8@netfence.it>
 <54a91d66-ae7c-4a02-945d-a23744391e91@measurement-factory.com>
Message-ID: <2973621e-d6ff-4d6e-833a-d56d0da80685@netfence.it>

On 10/3/24 18:29, Alex Rousskov wrote:

> Since the problem is frequent on that one host, I recommend privately 
> sharing[1] a pointer to compressed debugging cache.log collected while 
 > ...

I'll try ASAP.



> It is enough to record one or two problematic cases.

If only it was so easy to know in advance when the problem would occur :)
I guess I'll need to trim the logs afterwards...




> Please make sure to patch your Squid with 6567eac.patch you reference 
> below

Sure.
I referenced because I have already applied it.


  bye & Thanks
	av.


From rousskov at measurement-factory.com  Thu Oct  3 21:52:11 2024
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Thu, 3 Oct 2024 17:52:11 -0400
Subject: [squid-users] Questions about Squid configuration
In-Reply-To: <CAK0+96fzSV2GC0b8ETW5NqnQru4=kRJHo9WR04kiUtwHmciCxg@mail.gmail.com>
References: <CAK0+96e5Wpq3LpE4pf8k38nUpsmg+nyyocbOmnXS6=fqR+3C0g@mail.gmail.com>
 <add1024b-da05-46ba-9574-fd8048ec4fa1@measurement-factory.com>
 <CAK0+96eD+B2c_Fa3TpjE5E89WPsY-VaNadDSHK1ritgemkjrTw@mail.gmail.com>
 <c6889a69-d559-4180-ae27-5083e850329b@measurement-factory.com>
 <CAK0+96dnXhvu6LyCrULcWfO0uxAiDDKaMm3Kj6a2BkS69yR5Hw@mail.gmail.com>
 <0be99458-53b3-4f37-a86f-48f20c1abe9d@measurement-factory.com>
 <CAK0+96fzSV2GC0b8ETW5NqnQru4=kRJHo9WR04kiUtwHmciCxg@mail.gmail.com>
Message-ID: <d87dd344-2ccc-4534-93fc-d22e24a1757b@measurement-factory.com>

On 2024-09-25 01:57, ?? wrote:

> We then added the following settings that were in the existing Squid proxy
> 
> # SSL_BUMP
> acl allowed_https_sites ssl::server_name "/etc/squid/whitelist"
> acl allowed_https_sites ssl::server_name "/etc/squid/whitelist_transparent"
> acl allowed_https_sites ssl::server_name "/etc/squid/whitelist_https"
> acl allowed_https_sites ssl::server_name
> "/etc/squid/whitelist_transparent_https"
> sslcrtd_program [sslcrtd-program-setting]
> 
> acl step1 at_step SslBump1
> acl step2 at_step SslBump2
> acl step3 at_step SslBump3
> 
> ssl_bump peek step1 all
> ssl_bump peek step2 allowed_https_sites
> ssl_bump splice step3 allowed_https_sites
> ssl_bump terminate step2 all
> 
> Then I verified the 4 patterns again and all of them gave me 403 Forbidden...
> Even the following pattern which is allowed in whitelist.
>> 1. successful communication of a valid request to an allowed site
>> curl https://pypi.org/ -v --cacert squid.crt -k
> 
> After checking access-transparent.log and cache.log, it appears that
> pypi.org is comparing inspections by IP and not by domain.

AFAICT, you expect allowed_https_sites ACL to match the above 
intercepted pypi request and, hence, to be allowed by the following 
http_access rule:

     http_access allow allowed_https_sites https_port

Since you are intercepting traffic, at SslBump step1, Squid only sees 
TCP-level information extracted from the intercepted connection. There 
are no domain names. There is no HTTP-level information at that time. 
See "Step 1:" at https://wiki.squid-cache.org/Features/SslPeekAndSplice

When evaluating that dstdomain ACL (allowed_https_sites), Squid will 
attempt to convert the intended destination IP address of the 
intercepted TCP connection to a domain name and will compare the result 
of that conversion to allowed_https_sites entries. Evidently, either 
that reverse DNS lookup fails in your case, or the result (is not 
"pypi.org" and) does not match any allowed_https_sites names.

Since no other "http_access allow" rule matches the fake CONNECT at 
SslBump step1, the transaction is denied by the first "http_access deny 
all" rule (BTW, you can remove the second one -- it is unreachable).


> How do I modify the configuration to allow this correctly by domain?

It is difficult for me to answer this loaded question in a meaningful 
way. At SslBump step1, Squid gets an IP address. Squid has to either 
allow or deny that request based on available information. You have 
several options, including:

A. During SslBump step1, deny access based on IP addresses by adding 
appropriate dst ACLs that would be checked by http_access rules.

B. During SslBump step1, allow fake CONNECT requests to any IP address 
while making sure that you deny what needs to be denied at step2 or step3.


Needless to say, for an http_access rule to only apply during SslBump 
step1 it has to have an "SslBump1" ACL name. For example, the following 
rule allows any(*) fake CONNECT request during SslBump step1:

     # Allow all fake CONNECTs on intercepted connections until
     # we have a chance to extract TLS SNI information (step2).
     http_access allow step1 https_port


(*) any request that was not denied by earlier rules, of course


> Also, to begin with, these settings follow the existing squid proxy
> created by my predecessor, so I don't know what they are for...
> What are the disadvantages of removing these settings?

If you remove all ssl_bump rules, then Squid will not examine traffic 
inside intercepted TCP/TLS connections. Thus, TLS clients will be able 
to request/do anything (if their intercepted TCP connections are allowed 
using TCP-level information). Whether that effect is a "disadvantage" is 
your call.


HTH,

Alex.



From seitzbg at gmail.com  Wed Oct  9 19:40:02 2024
From: seitzbg at gmail.com (Bryan Seitz)
Date: Wed, 9 Oct 2024 15:40:02 -0400
Subject: [squid-users] Squid 6.10 SSL-Bump Woes
Message-ID: <CA+uwrTRnXSAVZ60RhfDvFS18aDZDUFZCWDKnUUd1KGE=wZL0pA@mail.gmail.com>

I have the following configuration:

http_port 3128 ssl-bump generate-host-certificates=on
tls-cert=/etc/squid/ssl/myCA.pem
ssl_bump bump all

# BMCs return Cache-Control: private
reply_header_access Cache-Control deny all
reply_header_add Cache-Control  "public, max-age=1800"

follow_x_forwarded_for allow all
http_access allow all
include /etc/squid/conf.d/*.conf
host_verify_strict off
tls_outgoing_options min-version=1.0
flags=DONT_VERIFY_PEER,DONT_VERIFY_DOMAIN
sslproxy_cert_error allow all

sslcrtd_program /usr/lib/squid/security_file_certgen -s
/var/spool/squid/ssl_db -M 4MB
sslcrtd_children 5

cache_mem 8192 MB
cache_dir rock /cm/squid/squid 8192

buffered_logs on
access_log daemon:/var/log/squid/access.log logformat=squid
logfile_daemon /usr/lib/squid/log_file_daemon
cache_store_log daemon:/var/log/squid/store.log
log_mime_hdrs on
coredump_dir /var/spool/squid
shutdown_lifetime 2 seconds
max_filedesc 4096
workers 4


A curl will note the resource is stale (with new host), but I never get a
cache hit on subsequent retries:

Store log:

1728502393.992 RELEASE -1 FFFFFFFF 02000000000000003A632F0003000000  200
1728502382        -1        -1 application/json 1182/1182 GET
https://10.170.31.77/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics
1728502395.674 RELEASE -1 FFFFFFFF 02000000000000003B632F0002000000  200
1728502384        -1        -1 application/json 1182/1182 GET
https://10.170.31.77/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics
1728502408.317 RELEASE 00 00056924 04000000000000003C632F0001000000  200
1728420588        -1 1728422388 application/json 1189/1189 GET
https://10.170.31.81/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics
1728502408.318 RELEASE -1 FFFFFFFF 03000000000000003C632F0001000000  200
1728502404        -1        -1 application/json 1179/1179 GET
https://10.170.31.81/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics
1728502417.161 RELEASE -1 FFFFFFFF 05000000000000003C632F0001000000  200
1728502413        -1        -1 application/json 1179/1179 GET
https://10.170.31.81/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics

Response headers:

HTTP/1.1 200 Connection established

HTTP/1.1 200 OK
Link: <http://redfish.dmtf.org/schemas/v1/Z.v1_5_2.json>; rel=describedby
Allow: GET
Content-Length: 1179
Content-Type: application/json; charset=UTF-8
Strict-Transport-Security: max-age=31536000; includeSubdomains
X-XSS-Protection: 1; mode=block
Content-Security-Policy: default-src 'self';connect-src 'self' ws:
wss:;frame-src 'self';img-src 'self' data:;object-src 'self';font-src
'self' data:;script-src 'self' 'unsafe-inline' 'unsafe-eval';style-src
'self' 'unsafe-inline';worker-src 'self' blob:;
X-Frame-Options: SAMEORIGIN
X-Content-Type-Options: nosniff
OData-Version: 4.0
Date: Wed, 09 Oct 2024 19:35:50 GMT
Cache-Status: squid;detail=mismatch
Via: 1.1 squid (squid/6.10)
Connection: keep-alive
Cache-Control: public, max-age=1800

If I use a cache peer with MITMPROXY, squid will cache the results however
this is inefficient and slow.

-- 
Bryan Seitz
seitzbg at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20241009/f00d2a4e/attachment.htm>

From Josh.Piana at hexcel.com  Wed Oct  9 19:59:07 2024
From: Josh.Piana at hexcel.com (Piana, Josh)
Date: Wed, 9 Oct 2024 19:59:07 +0000
Subject: [squid-users] Unable to access a device over port 4434
Message-ID: <cc3be63a93bd478b8dee1e2b529540dc@hexcel.com>

Hello Squid users,

I'm running into an issue wherein, when using Squid proxy, I'm unable to get to one of our management devices from port 4434.

I've already verified that this device is not blocking access from the proxy directly, and should be allowed to get to the access page.

-          When reviewing the access logs, I can see that we're running into a generic 503 error

-          When browsing to this page, it will attempt to load for about 30 seconds, and then fail

-          The webpage response is a generic "The system returned: (110) Connection timed out"

-          When we forgo the proxy, we can access it without an issue

This device is located on a 172.0.0.0/8 internal network.

-          Other devices which do NOT use this port are accessible

-          Changing the access port is not an option (not up to me)

Access Log entry:
09/Oct/2024:15:54:21 -0400.758 10.46.49.190 TCP_MISS/503 4448 GET http://172.27.46.253:4434/ jpiana \ HIER_DIRECT/172.27.46.253 text/html ERR_CONNECT_FAIL/WITH_SERVER

Please see below for relevant squid.conf rules:

auth_param basic program /usr/lib64/squid/basic_pam_auth
auth_param negotiate children 10
auth_param negotiate keep_alive on
auth_param basic credentialsttl 1 week
acl kerb-auth proxy_auth REQUIRED

acl src_self src 10.46.11.69            # proxy IP Address
acl localnet src 10.0.0.0/8              # hexcel networks
acl localnet src 172.0.0.0/8           # internal management network

acl SSL_ports port 443
acl Safe_ports port 21                    # ftp
acl Safe_ports port 22                    # ssh
acl Safe_ports port 80                    # http
acl Safe_ports port 443                  # https
acl Safe_ports port 4434                # firewall management port
acl Safe_ports port 8080                # http alternative
acl Safe_ports port 8443                # https alternative
acl Safe_ports port 1025-65535  # unregistered ports

# deny requests to certain unsafe ports
http_access deny !Safe_ports

# deny CONNECT to other than secure SSL ports
http_access deny CONNECT !SSL_ports

# only allow cachemgr access from localhost
http_access allow localhost manager
http_access deny manager

# this only allows changes to be made on the host itself
http_access allow localhost

# keep this deny here because other ACL's may unintentionally allow access
http_access deny to_localhost

# allow safe ports to CONNECT
http_access allow Safe_ports

# allow localnet parameter to CONNECT
http_access allow localnet

# allow authenticated users
http_access allow kerb-auth

# deny any request we missed in the above
http_access deny all
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20241009/ab826a9a/attachment.htm>

From kinkie at squid-cache.org  Wed Oct  9 20:33:47 2024
From: kinkie at squid-cache.org (Francesco Chemolli)
Date: Wed, 9 Oct 2024 21:33:47 +0100
Subject: [squid-users] Squid Project Status with regard to "Joshua 55"
 vulnerabilities
Message-ID: <CA+Y8hcMDHDMB+NjFrcAyWxdcq5mbF-XV3o8h4YmtLUVbNa04Zg@mail.gmail.com>

The Squid Project apologizes for being late in responding to the
publication of 55 vulnerabilities disclosed by Joshua Rogers of Opera Software
at https://megamansec.github.io/Squid-Security-Audit/

We thank Joshua for discovering these bugs and sharing their details with us.
The surprise publication caught us off guard, but Squid
developers had worked on addressing some of the disclosed vulnerabilities
since before that publication. This message summarizes Squid's status on
October 9th, 2024.

As of Squid v6.8, the vast majority of high-impact vulnerabilities have been
addressed. The following disclosed vulnerabilities are still present:


### Vulnerability ?strlen(NULL) Crash Using Digest Authentication?

This vulnerability is still present in Squid v6.11. A fix is expected in Squid
v6.12, due any day now.
Digest authentication is disabled by default; the current workaround is
to avoid Digest authentication.

To verify whether your Squid configuration is vulnerable, check whether it
contains "auth_param? directive. Configurations with auth_param directives
mentioning "digest" scheme may be vulnerable.


### pipeline_prefetch (HTTP pipelining of client-to-Squid requests)

All reported pipelining-related vulnerabilities may still be present in Squid
v6. Pipelining code will probably be removed in master branch and become
unavailable in Squid v7. Pipelining is disabled by default.

If you do not need pipelining (or do not know for sure that you need it), do
not enable that performance optimization.

To verify whether your Squid configuration is vulnerable, check whether it
contains a pipeline_prefetch directive. Configurations containing a
pipeline_prefetch directive set to a positive value may be vulnerable.


### ESI (Edge Side Includes)

Most reported ESI-related vulnerabilities are still present in Squid v6. ESI
code has been removed in the master branch and will not be available
in Squid v7.
ESI is disabled in the default build starting with Squid v6.10. In earlier
versions, ESI code is enabled by default, but the risk is moderate because
exploiting this family of vulnerabilities requires Squid to be
configured as a reverse proxy for a malicious origin server.

If you do not need ESI (or do not know whether you need it), disable it with
`--disable-esi` (default for Squid v6.10 and later).

To verify whether your Squid build is vulnerable, run `squid -v`. Squid v6.9
and earlier versions may be vulnerable unless the output contains
`--disable-esi`. Squid v6.10 and later versions may be vulnerable if the
output contains `--enable-esi`.


### Squid v5

Some fixes were backported to Squid v5, but we lack the resources necessary to
support that old version. Folks running Squid v5 and earlier versions should
either upgrade to the latest v6 release or rely on their
integrator/distributor for support.

-- 
    Francesco Chemolli
    Squid Software Foundation


From uhlar at fantomas.sk  Thu Oct 10 07:20:50 2024
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Thu, 10 Oct 2024 09:20:50 +0200
Subject: [squid-users] Unable to access a device over port 4434
In-Reply-To: <cc3be63a93bd478b8dee1e2b529540dc@hexcel.com>
References: <cc3be63a93bd478b8dee1e2b529540dc@hexcel.com>
Message-ID: <ZweAUvyJWT-EkNOb@fantomas.sk>

On 09.10.24 19:59, Piana, Josh wrote:
>I'm running into an issue wherein, when using Squid proxy, I'm unable to get to one of our management devices from port 4434.
>
>I've already verified that this device is not blocking access from the proxy directly, and should be allowed to get to the access page.
>
>-          When reviewing the access logs, I can see that we're running into a generic 503 error
>
>-          When browsing to this page, it will attempt to load for about 30 seconds, and then fail
>
>-          The webpage response is a generic "The system returned: (110) Connection timed out"
>
>-          When we forgo the proxy, we can access it without an issue
>
>This device is located on a 172.0.0.0/8 internal network.
>
>-          Other devices which do NOT use this port are accessible
>
>-          Changing the access port is not an option (not up to me)
>
>Access Log entry:
>09/Oct/2024:15:54:21 -0400.758 10.46.49.190 TCP_MISS/503 4448 GET http://172.27.46.253:4434/ jpiana \ HIER_DIRECT/172.27.46.253 text/html ERR_CONNECT_FAIL/WITH_SERVER


I guess the correct URL is: http://172.27.46.253:4434/jpiana

have you tried running following directly from the squid machine?

wget -Y off http://172.27.46.253:4434/jpiana


Because ERR_CONNECT_FAIL/WITH_SERVER and "Connection timed out" both say 
that the squid was unable to open connection to server.

which is not a squid issue but network connection issue.
-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
LSD will make your ECS screen display 16.7 million colors


From rousskov at measurement-factory.com  Thu Oct 10 16:35:44 2024
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Thu, 10 Oct 2024 12:35:44 -0400
Subject: [squid-users] Squid 6.10 SSL-Bump Woes
In-Reply-To: <CA+uwrTRnXSAVZ60RhfDvFS18aDZDUFZCWDKnUUd1KGE=wZL0pA@mail.gmail.com>
References: <CA+uwrTRnXSAVZ60RhfDvFS18aDZDUFZCWDKnUUd1KGE=wZL0pA@mail.gmail.com>
Message-ID: <c8448d78-0ce5-413b-9bb3-16b680015659@measurement-factory.com>

On 2024-10-09 15:40, Bryan Seitz wrote:

 > SSL-Bump Woes

AFAICT, the problem you are trying to solve is not caused by SslBump.


 > reply_header_access Cache-Control deny all
 > reply_header_add Cache-Control  "public, max-age=1800"

The above directives are applied to responses that Squid sends to 
clients. These post-cache response modification directives have no 
effect on Squid response caching decisions (which are done earlier, 
pre-cache, while looking at the virgin or adapted response received from 
the origin server of cache_peer).

FWIW, this caveat is documented in reply_header_add description, but 
documentation improvements are welcome:

> This option adds header fields to outgoing HTTP responses (i.e., response
> headers delivered by Squid to the client). This option has no effect on
> cache hit detection. The equivalent adaptation vectoring point in
> ICAP terminology is post-cache RESPMOD.


To allow Squid to violate HTTP caching rules when deciding whether to a 
cache a response, see refresh_pattern options (e.g., "ignore-private").
http://www.squid-cache.org/Doc/config/refresh_pattern/


HTH,

Alex.


> I have the following configuration:
> 
> http_port 3128 ssl-bump generate-host-certificates=on 
> tls-cert=/etc/squid/ssl/myCA.pem
> ssl_bump bump all
> 
> # BMCs return Cache-Control: private
> reply_header_access Cache-Control deny all
> reply_header_add Cache-Control ?"public, max-age=1800"
> 
> follow_x_forwarded_for allow all
> http_access allow all
> include /etc/squid/conf.d/*.conf
> host_verify_strict off
> tls_outgoing_options min-version=1.0 
> flags=DONT_VERIFY_PEER,DONT_VERIFY_DOMAIN
> sslproxy_cert_error allow all
> 
> sslcrtd_program /usr/lib/squid/security_file_certgen -s 
> /var/spool/squid/ssl_db -M 4MB
> sslcrtd_children 5
> 
> cache_mem 8192 MB
> cache_dir rock /cm/squid/squid 8192
> 
> buffered_logs on
> access_log daemon:/var/log/squid/access.log logformat=squid
> logfile_daemon /usr/lib/squid/log_file_daemon
> cache_store_log daemon:/var/log/squid/store.log
> log_mime_hdrs on
> coredump_dir /var/spool/squid
> shutdown_lifetime 2 seconds
> max_filedesc 4096
> workers 4
> 
> 
> A curl will note the resource is stale (with new host), but I never get 
> a cache hit on subsequent retries:
> 
> Store log:
> 
> 1728502393.992 RELEASE -1 FFFFFFFF 02000000000000003A632F0003000000 ?200 
> 1728502382 ? ? ? ?-1 ? ? ? ?-1 application/json 1182/1182 GET 
> https://10.170.31.77/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics <https://10.170.31.77/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics>
> 1728502395.674 RELEASE -1 FFFFFFFF 02000000000000003B632F0002000000 ?200 
> 1728502384 ? ? ? ?-1 ? ? ? ?-1 application/json 1182/1182 GET 
> https://10.170.31.77/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics <https://10.170.31.77/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics>
> 1728502408.317 RELEASE 00 00056924 04000000000000003C632F0001000000 ?200 
> 1728420588 ? ? ? ?-1 1728422388 application/json 1189/1189 GET 
> https://10.170.31.81/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics <https://10.170.31.81/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics>
> 1728502408.318 RELEASE -1 FFFFFFFF 03000000000000003C632F0001000000 ?200 
> 1728502404 ? ? ? ?-1 ? ? ? ?-1 application/json 1179/1179 GET 
> https://10.170.31.81/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics <https://10.170.31.81/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics>
> 1728502417.161 RELEASE -1 FFFFFFFF 05000000000000003C632F0001000000 ?200 
> 1728502413 ? ? ? ?-1 ? ? ? ?-1 application/json 1179/1179 GET 
> https://10.170.31.81/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics <https://10.170.31.81/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics>
> 
> Response headers:
> 
> HTTP/1.1 200 Connection established
> 
> HTTP/1.1 200 OK
> Link: <http://redfish.dmtf.org/schemas/v1/Z.v1_5_2.json 
> <http://redfish.dmtf.org/schemas/v1/Z.v1_5_2.json>>; rel=describedby
> Allow: GET
> Content-Length: 1179
> Content-Type: application/json; charset=UTF-8
> Strict-Transport-Security: max-age=31536000; includeSubdomains
> X-XSS-Protection: 1; mode=block
> Content-Security-Policy: default-src 'self';connect-src 'self' ws: 
> wss:;frame-src 'self';img-src 'self' data:;object-src 'self';font-src 
> 'self' data:;script-src 'self' 'unsafe-inline' 'unsafe-eval';style-src 
> 'self' 'unsafe-inline';worker-src 'self' blob:;
> X-Frame-Options: SAMEORIGIN
> X-Content-Type-Options: nosniff
> OData-Version: 4.0
> Date: Wed, 09 Oct 2024 19:35:50 GMT
> Cache-Status: squid;detail=mismatch
> Via: 1.1 squid (squid/6.10)
> Connection: keep-alive
> Cache-Control: public, max-age=1800
> 
> If I use a cache peer with MITMPROXY, squid will cache the results 
> however this is inefficient and slow.
> 
> -- 
> Bryan Seitz
> seitzbg at gmail.com <mailto:seitzbg at gmail.com>
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> https://lists.squid-cache.org/listinfo/squid-users



From Josh.Piana at hexcel.com  Thu Oct 10 18:21:09 2024
From: Josh.Piana at hexcel.com (Piana, Josh)
Date: Thu, 10 Oct 2024 18:21:09 +0000
Subject: [squid-users] Unable to access a device over port 4434
In-Reply-To: <ZweAUvyJWT-EkNOb@fantomas.sk>
References: <cc3be63a93bd478b8dee1e2b529540dc@hexcel.com>
 <ZweAUvyJWT-EkNOb@fantomas.sk>
Message-ID: <73682cf79e0546b4b4c1faa35d034614@hexcel.com>

Hello Matus, 

I apologize, I was unable to read any of the links that were responded with because our environment appended the " eur02.safelinks.protection.outlook.com..." Outlook protection. Did you see that as well on your side? When I did click the links to view them is just stated as failed. 

What I gather from what you said was that, it's not likely Squid is the issue. Even when we bypass Squid it does work. FWIW, it's possible that there is some other network problem coming into play here on our side. Though I did try to verify there's now blockages from the firewall, the networks, the traffic, etc. 

I suppose from here I'll try to troubleshoot other things. 

Alternatively, do you think I should try to create an ACL which bypasses any filters or rules to that network? 

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Matus UHLAR - fantomas
Sent: Thursday, October 10, 2024 3:21 AM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Unable to access a device over port 4434

Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.


On 09.10.24 19:59, Piana, Josh wrote:
>I'm running into an issue wherein, when using Squid proxy, I'm unable to get to one of our management devices from port 4434.
>
>I've already verified that this device is not blocking access from the proxy directly, and should be allowed to get to the access page.
>
>-          When reviewing the access logs, I can see that we're running into a generic 503 error
>
>-          When browsing to this page, it will attempt to load for about 30 seconds, and then fail
>
>-          The webpage response is a generic "The system returned: (110) Connection timed out"
>
>-          When we forgo the proxy, we can access it without an issue
>
>This device is located on a 172.0.0.0/8 internal network.
>
>-          Other devices which do NOT use this port are accessible
>
>-          Changing the access port is not an option (not up to me)
>
>Access Log entry:
>09/Oct/2024:15:54:21 -0400.758 10.46.49.190 TCP_MISS/503 4448 GET 
>http://172.0.0.27/
>.46.253%3A4434%2F&data=05%7C02%7Cjosh.piana%40hexcel.com%7Cad6b9a6df5da
>44a2b73508dce8fc1971%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C63864
>1416681623895%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luM
>zIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=G%2FrqNK0o%2Bdk0ia
>zrnMhbyTvL0RmZAK27lulhMBhPMDU%3D&reserved=0 jpiana \ 
>HIER_DIRECT/172.27.46.253 text/html ERR_CONNECT_FAIL/WITH_SERVER


I guess the correct URL is: http://172.27.46.253:4434/jpiana

have you tried running following directly from the squid machine?

wget -Y off http://172.27.46.253:4434/jpiana


Because ERR_CONNECT_FAIL/WITH_SERVER and "Connection timed out" both say that the squid was unable to open connection to server.

which is not a squid issue but network connection issue.
--
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
LSD will make your ECS screen display 16.7 million colors _______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
https://lists.squid-cache.org/listinfo/squid-users


From seitzbg at gmail.com  Thu Oct 10 22:08:03 2024
From: seitzbg at gmail.com (Bryan Seitz)
Date: Thu, 10 Oct 2024 18:08:03 -0400
Subject: [squid-users] Squid 6.10 SSL-Bump Woes
In-Reply-To: <c8448d78-0ce5-413b-9bb3-16b680015659@measurement-factory.com>
References: <CA+uwrTRnXSAVZ60RhfDvFS18aDZDUFZCWDKnUUd1KGE=wZL0pA@mail.gmail.com>
 <c8448d78-0ce5-413b-9bb3-16b680015659@measurement-factory.com>
Message-ID: <CA+uwrTQ9MpOydEptrLSsRtuWGtEk4BwyBOc=Z6fL-hVNxzg47w@mail.gmail.com>

I removed the header mods and changed the refresh pattern to:

refresh_pattern .               15      20%     1800    override-expire
ignore-no-cache ignore-no-store ignore-private

And I always get TCP_MISS.  Any other thoughts?

Thanks!

On Thu, Oct 10, 2024 at 12:35?PM Alex Rousskov <
rousskov at measurement-factory.com> wrote:

> On 2024-10-09 15:40, Bryan Seitz wrote:
>
>  > SSL-Bump Woes
>
> AFAICT, the problem you are trying to solve is not caused by SslBump.
>
>
>  > reply_header_access Cache-Control deny all
>  > reply_header_add Cache-Control  "public, max-age=1800"
>
> The above directives are applied to responses that Squid sends to
> clients. These post-cache response modification directives have no
> effect on Squid response caching decisions (which are done earlier,
> pre-cache, while looking at the virgin or adapted response received from
> the origin server of cache_peer).
>
> FWIW, this caveat is documented in reply_header_add description, but
> documentation improvements are welcome:
>
> > This option adds header fields to outgoing HTTP responses (i.e., response
> > headers delivered by Squid to the client). This option has no effect on
> > cache hit detection. The equivalent adaptation vectoring point in
> > ICAP terminology is post-cache RESPMOD.
>
>
> To allow Squid to violate HTTP caching rules when deciding whether to a
> cache a response, see refresh_pattern options (e.g., "ignore-private").
> http://www.squid-cache.org/Doc/config/refresh_pattern/
>
>
> HTH,
>
> Alex.
>
>
> > I have the following configuration:
> >
> > http_port 3128 ssl-bump generate-host-certificates=on
> > tls-cert=/etc/squid/ssl/myCA.pem
> > ssl_bump bump all
> >
> > # BMCs return Cache-Control: private
> > reply_header_access Cache-Control deny all
> > reply_header_add Cache-Control  "public, max-age=1800"
> >
> > follow_x_forwarded_for allow all
> > http_access allow all
> > include /etc/squid/conf.d/*.conf
> > host_verify_strict off
> > tls_outgoing_options min-version=1.0
> > flags=DONT_VERIFY_PEER,DONT_VERIFY_DOMAIN
> > sslproxy_cert_error allow all
> >
> > sslcrtd_program /usr/lib/squid/security_file_certgen -s
> > /var/spool/squid/ssl_db -M 4MB
> > sslcrtd_children 5
> >
> > cache_mem 8192 MB
> > cache_dir rock /cm/squid/squid 8192
> >
> > buffered_logs on
> > access_log daemon:/var/log/squid/access.log logformat=squid
> > logfile_daemon /usr/lib/squid/log_file_daemon
> > cache_store_log daemon:/var/log/squid/store.log
> > log_mime_hdrs on
> > coredump_dir /var/spool/squid
> > shutdown_lifetime 2 seconds
> > max_filedesc 4096
> > workers 4
> >
> >
> > A curl will note the resource is stale (with new host), but I never get
> > a cache hit on subsequent retries:
> >
> > Store log:
> >
> > 1728502393.992 RELEASE -1 FFFFFFFF 02000000000000003A632F0003000000  200
> > 1728502382        -1        -1 application/json 1182/1182 GET
> >
> https://10.170.31.77/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics
> <
> https://10.170.31.77/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics
> >
> > 1728502395.674 RELEASE -1 FFFFFFFF 02000000000000003B632F0002000000  200
> > 1728502384        -1        -1 application/json 1182/1182 GET
> >
> https://10.170.31.77/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics
> <
> https://10.170.31.77/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics
> >
> > 1728502408.317 RELEASE 00 00056924 04000000000000003C632F0001000000  200
> > 1728420588        -1 1728422388 application/json 1189/1189 GET
> >
> https://10.170.31.81/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics
> <
> https://10.170.31.81/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics
> >
> > 1728502408.318 RELEASE -1 FFFFFFFF 03000000000000003C632F0001000000  200
> > 1728502404        -1        -1 application/json 1179/1179 GET
> >
> https://10.170.31.81/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics
> <
> https://10.170.31.81/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics
> >
> > 1728502417.161 RELEASE -1 FFFFFFFF 05000000000000003C632F0001000000  200
> > 1728502413        -1        -1 application/json 1179/1179 GET
> >
> https://10.170.31.81/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics
> <
> https://10.170.31.81/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics
> >
> >
> > Response headers:
> >
> > HTTP/1.1 200 Connection established
> >
> > HTTP/1.1 200 OK
> > Link: <http://redfish.dmtf.org/schemas/v1/Z.v1_5_2.json
> > <http://redfish.dmtf.org/schemas/v1/Z.v1_5_2.json>>; rel=describedby
> > Allow: GET
> > Content-Length: 1179
> > Content-Type: application/json; charset=UTF-8
> > Strict-Transport-Security: max-age=31536000; includeSubdomains
> > X-XSS-Protection: 1; mode=block
> > Content-Security-Policy: default-src 'self';connect-src 'self' ws:
> > wss:;frame-src 'self';img-src 'self' data:;object-src 'self';font-src
> > 'self' data:;script-src 'self' 'unsafe-inline' 'unsafe-eval';style-src
> > 'self' 'unsafe-inline';worker-src 'self' blob:;
> > X-Frame-Options: SAMEORIGIN
> > X-Content-Type-Options: nosniff
> > OData-Version: 4.0
> > Date: Wed, 09 Oct 2024 19:35:50 GMT
> > Cache-Status: squid;detail=mismatch
> > Via: 1.1 squid (squid/6.10)
> > Connection: keep-alive
> > Cache-Control: public, max-age=1800
> >
> > If I use a cache peer with MITMPROXY, squid will cache the results
> > however this is inefficient and slow.
> >
> > --
> > Bryan Seitz
> > seitzbg at gmail.com <mailto:seitzbg at gmail.com>
> >
> > _______________________________________________
> > squid-users mailing list
> > squid-users at lists.squid-cache.org
> > https://lists.squid-cache.org/listinfo/squid-users
>
>

-- 
Bryan Seitz
seitzbg at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20241010/049e262d/attachment.htm>

From jonathanlee571 at gmail.com  Fri Oct 11 00:48:43 2024
From: jonathanlee571 at gmail.com (Jonathan Lee)
Date: Thu, 10 Oct 2024 17:48:43 -0700
Subject: [squid-users] Squid 6.10 SSL-Bump Woes
In-Reply-To: <CA+uwrTQ9MpOydEptrLSsRtuWGtEk4BwyBOc=Z6fL-hVNxzg47w@mail.gmail.com>
References: <CA+uwrTQ9MpOydEptrLSsRtuWGtEk4BwyBOc=Z6fL-hVNxzg47w@mail.gmail.com>
Message-ID: <F991CDF8-4B50-4440-BAA9-95AE4F698155@gmail.com>

An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20241010/97b15683/attachment.htm>

From squid3 at treenet.co.nz  Fri Oct 11 01:09:03 2024
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 11 Oct 2024 14:09:03 +1300
Subject: [squid-users] Squid 6.10 SSL-Bump Woes
In-Reply-To: <CA+uwrTQ9MpOydEptrLSsRtuWGtEk4BwyBOc=Z6fL-hVNxzg47w@mail.gmail.com>
References: <CA+uwrTRnXSAVZ60RhfDvFS18aDZDUFZCWDKnUUd1KGE=wZL0pA@mail.gmail.com>
 <c8448d78-0ce5-413b-9bb3-16b680015659@measurement-factory.com>
 <CA+uwrTQ9MpOydEptrLSsRtuWGtEk4BwyBOc=Z6fL-hVNxzg47w@mail.gmail.com>
Message-ID: <f994f59a-3a1a-4cb6-9e98-fb186109f879@treenet.co.nz>

On 11/10/24 11:08, Bryan Seitz wrote:
> I removed the header mods and changed the refresh pattern to:
> 
> refresh_pattern . ? ? ? ? ? ? ? 15 ? ? ?20% ? ? 1800 ? ?override-expire 
> ignore-no-cache ignore-no-store ignore-private
> 
> And I always get TCP_MISS.? Any other thoughts?

Ah, I believe it would be best to get a baseline of what Squid default 
behaviour is like in your environment. So we can identify what/how you 
need to improve it.


Firstly, FYI; this is what those controls **actually** do in current 
Squid ..

  * override-expires ... forces Squid to handle all responses to act as 
if they received "Cache-Control: max-age=900" (15 min) ... store, but 
revalidate 180+ seconds (20% of 15min) later.
   Result: Anything that could cache longer than 15min becomes a 
REFRESH_MISS or MISS, instead of HIT.
   Squid default: **do** cache. Revalidate
     * after("Date"+"CC: max-age=N") timestamp, otherwise
     * after "Expires" timestamp, otherwise
     * after ("Date" +1800 minutes) timestamp.

  * ignore-no-cache ... the standardized "CC: no-cache" is badly named, 
it tells Squid what **can** be cached.
   Result: Squid will discard many stored objects and perform a MISS 
instead.
   Squid default: **do** cache "CC:private" responses, revalidate on 
HIT. Log as REFRESH.

  * ignore-no-store ... force everything marked "CC: no-store" to be stored.
  Result: cache fills with non-reusable objects. Leaving not much room 
for actual HIT objects.
   Squid default: store only objects with can result in more HITs.

  * ignore-private ... force everything with "CC: private" to be discarded.
   Result: same as "ignore-no-store".
   Squid default: **do** cache "CC:private" responses, revalidate on HIT.

Note that both HIT and REFRESH mean the object **was** cached.


You said that the access.log now contains MISS. Would that be just 
"MISS" or "REFRESH" + "MISS" (actually a HIT, but a new object was given 
by the server and replaced the pre-stored object).


Can you show a pair of request headers from the client, with matching 
response from the server?  You can use "debug_options 11,2" in recent 
Squid versions to get a cache.log trace of the HTTP transactions.

That might help us spot something more specific. The config change makes 
the earlier given ones obsolete.


HTH
Amos




From squid3 at treenet.co.nz  Fri Oct 11 01:25:21 2024
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 11 Oct 2024 14:25:21 +1300
Subject: [squid-users] Unable to access a device over port 4434
In-Reply-To: <73682cf79e0546b4b4c1faa35d034614@hexcel.com>
References: <cc3be63a93bd478b8dee1e2b529540dc@hexcel.com>
 <ZweAUvyJWT-EkNOb@fantomas.sk> <73682cf79e0546b4b4c1faa35d034614@hexcel.com>
Message-ID: <f650f52c-4bab-4ef0-93c0-04139efa6f79@treenet.co.nz>

On 11/10/24 07:21, Piana, Josh wrote:
> Hello Matus,
> 
> I apologize, I was unable to read any of the links that were responded with because our environment appended the " eur02.safelinks.protection.outlook.com..." Outlook protection. Did you see that as well on your side? When I did click the links to view them is just stated as failed.
> 
> What I gather from what you said was that, it's not likely Squid is the issue. Even when we bypass Squid it does work. FWIW, it's possible that there is some other network problem coming into play here on our side. Though I did try to verify there's now blockages from the firewall, the networks, the traffic, etc.


FTR; the critical detail in what Matus wrote was that the "wget" (or 
curl if you prefer) connection test **must** be performed
  A) on the Squid machine,
  B) using the same low-privileges user account that Squid runs with,
  D) to the same server IP address Squid is trying to contact.

That ensures the TCP connection privileges are as close to identical to 
what Squid is doing.

Running it from another machine and/or user account may encounter 
different firewall or routing behaviour that hides the real issue.

If that test provides a successful TCP connection, *and* HTTP response 
message the next step is to


Also, FYI; your custom change to the timestamp has somehow lost the 
"duration" value, so I/we cannot tell if this was a probable TCP FIN/RST 
(hint of firewall problem) or a SYN+ACK timeout (hint of routing problem).


HTH
Amos




> 
> I suppose from here I'll try to troubleshoot other things.
> 
> Alternatively, do you think I should try to create an ACL which bypasses any filters or rules to that network?
> 
> -----Original Message-----
> From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Matus UHLAR - fantomas
> Sent: Thursday, October 10, 2024 3:21 AM
> To: squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] Unable to access a device over port 4434
> 
> Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.
> 
> 
> On 09.10.24 19:59, Piana, Josh wrote:
>> I'm running into an issue wherein, when using Squid proxy, I'm unable to get to one of our management devices from port 4434.
>>
>> I've already verified that this device is not blocking access from the proxy directly, and should be allowed to get to the access page.
>>
>> -          When reviewing the access logs, I can see that we're running into a generic 503 error
>>
>> -          When browsing to this page, it will attempt to load for about 30 seconds, and then fail
>>
>> -          The webpage response is a generic "The system returned: (110) Connection timed out"
>>
>> -          When we forgo the proxy, we can access it without an issue
>>
>> This device is located on a 172.0.0.0/8 internal network.
>>
>> -          Other devices which do NOT use this port are accessible
>>
>> -          Changing the access port is not an option (not up to me)
>>
>> Access Log entry:
>> 09/Oct/2024:15:54:21 -0400.758 10.46.49.190 TCP_MISS/503 4448 GET
>> http://172.0.0.27/
>> .46.253%3A4434%2F&data=05%7C02%7Cjosh.piana%40hexcel.com%7Cad6b9a6df5da
>> 44a2b73508dce8fc1971%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C63864
>> 1416681623895%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luM
>> zIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=G%2FrqNK0o%2Bdk0ia
>> zrnMhbyTvL0RmZAK27lulhMBhPMDU%3D&reserved=0 jpiana \
>> HIER_DIRECT/172.27.46.253 text/html ERR_CONNECT_FAIL/WITH_SERVER
> 
> 
> I guess the correct URL is: http://172.27.46.253:4434/jpiana
> 
> have you tried running following directly from the squid machine?
> 
> wget -Y off http://172.27.46.253:4434/jpiana
> 
> 
> Because ERR_CONNECT_FAIL/WITH_SERVER and "Connection timed out" both say that the squid was unable to open connection to server.
> 
> which is not a squid issue but network connection issue.
> --
> Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
> Warning: I wish NOT to receive e-mail advertising to this address.
> Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
> LSD will make your ECS screen display 16.7 million colors _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> https://lists.squid-cache.org/listinfo/squid-users
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> https://lists.squid-cache.org/listinfo/squid-users



From seitzbg at gmail.com  Fri Oct 11 01:47:14 2024
From: seitzbg at gmail.com (Bryan Seitz)
Date: Thu, 10 Oct 2024 21:47:14 -0400
Subject: [squid-users] Squid 6.10 SSL-Bump Woes
In-Reply-To: <F991CDF8-4B50-4440-BAA9-95AE4F698155@gmail.com>
References: <CA+uwrTQ9MpOydEptrLSsRtuWGtEk4BwyBOc=Z6fL-hVNxzg47w@mail.gmail.com>
 <F991CDF8-4B50-4440-BAA9-95AE4F698155@gmail.com>
Message-ID: <dbae55d0-b5f5-4009-b2b9-02c76e43632d@Spark>

I fetched the object 10x all were RELEASE in store.log and a MISS. I even cleared the rock DB file and bounced Squid.

Bryan Seitz
On Oct 10, 2024 at 8:48?PM -0400, Jonathan Lee <jonathanlee571 at gmail.com>, wrote:
> Give it time to cache miss means it stored items
> Sent from my iPhone
>
> > On Oct 10, 2024, at 15:27, Bryan Seitz <seitzbg at gmail.com> wrote:
> >
> > I removed the header mods and changed the refresh pattern to:
> >
> > refresh_pattern . ? ? ? ? ? ? ? 15 ? ? ?20% ? ? 1800 ? ?override-expire ignore-no-cache ignore-no-store ignore-private
> >
> > And I always get TCP_MISS.? Any other thoughts?
> >
> > Thanks!
> >
> > > On Thu, Oct 10, 2024 at 12:35?PM Alex Rousskov <rousskov at measurement-factory.com> wrote:
> > > > On 2024-10-09 15:40, Bryan Seitz wrote:
> > > >
> > > > ?> SSL-Bump Woes
> > > >
> > > > AFAICT, the problem you are trying to solve is not caused by SslBump.
> > > >
> > > >
> > > > ?> reply_header_access Cache-Control deny all
> > > > ?> reply_header_add Cache-Control? "public, max-age=1800"
> > > >
> > > > The above directives are applied to responses that Squid sends to
> > > > clients. These post-cache response modification directives have no
> > > > effect on Squid response caching decisions (which are done earlier,
> > > > pre-cache, while looking at the virgin or adapted response received from
> > > > the origin server of cache_peer).
> > > >
> > > > FWIW, this caveat is documented in reply_header_add description, but
> > > > documentation improvements are welcome:
> > > >
> > > > > This option adds header fields to outgoing HTTP responses (i.e., response
> > > > > headers delivered by Squid to the client). This option has no effect on
> > > > > cache hit detection. The equivalent adaptation vectoring point in
> > > > > ICAP terminology is post-cache RESPMOD.
> > > >
> > > >
> > > > To allow Squid to violate HTTP caching rules when deciding whether to a
> > > > cache a response, see refresh_pattern options (e.g., "ignore-private").
> > > > http://www.squid-cache.org/Doc/config/refresh_pattern/
> > > >
> > > >
> > > > HTH,
> > > >
> > > > Alex.
> > > >
> > > >
> > > > > I have the following configuration:
> > > > >
> > > > > http_port 3128 ssl-bump generate-host-certificates=on
> > > > > tls-cert=/etc/squid/ssl/myCA.pem
> > > > > ssl_bump bump all
> > > > >
> > > > > # BMCs return Cache-Control: private
> > > > > reply_header_access Cache-Control deny all
> > > > > reply_header_add Cache-Control ?"public, max-age=1800"
> > > > >
> > > > > follow_x_forwarded_for allow all
> > > > > http_access allow all
> > > > > include /etc/squid/conf.d/*.conf
> > > > > host_verify_strict off
> > > > > tls_outgoing_options min-version=1.0
> > > > > flags=DONT_VERIFY_PEER,DONT_VERIFY_DOMAIN
> > > > > sslproxy_cert_error allow all
> > > > >
> > > > > sslcrtd_program /usr/lib/squid/security_file_certgen -s
> > > > > /var/spool/squid/ssl_db -M 4MB
> > > > > sslcrtd_children 5
> > > > >
> > > > > cache_mem 8192 MB
> > > > > cache_dir rock /cm/squid/squid 8192
> > > > >
> > > > > buffered_logs on
> > > > > access_log daemon:/var/log/squid/access.log logformat=squid
> > > > > logfile_daemon /usr/lib/squid/log_file_daemon
> > > > > cache_store_log daemon:/var/log/squid/store.log
> > > > > log_mime_hdrs on
> > > > > coredump_dir /var/spool/squid
> > > > > shutdown_lifetime 2 seconds
> > > > > max_filedesc 4096
> > > > > workers 4
> > > > >
> > > > >
> > > > > A curl will note the resource is stale (with new host), but I never get
> > > > > a cache hit on subsequent retries:
> > > > >
> > > > > Store log:
> > > > >
> > > > > 1728502393.992 RELEASE -1 FFFFFFFF 02000000000000003A632F0003000000 ?200
> > > > > 1728502382 ? ? ? ?-1 ? ? ? ?-1 application/json 1182/1182 GET
> > > > > https://10.170.31.77/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics <https://10.170.31.77/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics>
> > > > > 1728502395.674 RELEASE -1 FFFFFFFF 02000000000000003B632F0002000000 ?200
> > > > > 1728502384 ? ? ? ?-1 ? ? ? ?-1 application/json 1182/1182 GET
> > > > > https://10.170.31.77/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics <https://10.170.31.77/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics>
> > > > > 1728502408.317 RELEASE 00 00056924 04000000000000003C632F0001000000 ?200
> > > > > 1728420588 ? ? ? ?-1 1728422388 application/json 1189/1189 GET
> > > > > https://10.170.31.81/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics <https://10.170.31.81/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics>
> > > > > 1728502408.318 RELEASE -1 FFFFFFFF 03000000000000003C632F0001000000 ?200
> > > > > 1728502404 ? ? ? ?-1 ? ? ? ?-1 application/json 1179/1179 GET
> > > > > https://10.170.31.81/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics <https://10.170.31.81/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics>
> > > > > 1728502417.161 RELEASE -1 FFFFFFFF 05000000000000003C632F0001000000 ?200
> > > > > 1728502413 ? ? ? ?-1 ? ? ? ?-1 application/json 1179/1179 GET
> > > > > https://10.170.31.81/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics <https://10.170.31.81/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics>
> > > > >
> > > > > Response headers:
> > > > >
> > > > > HTTP/1.1 200 Connection established
> > > > >
> > > > > HTTP/1.1 200 OK
> > > > > Link: <http://redfish.dmtf.org/schemas/v1/Z.v1_5_2.json
> > > > > <http://redfish.dmtf.org/schemas/v1/Z.v1_5_2.json>>; rel=describedby
> > > > > Allow: GET
> > > > > Content-Length: 1179
> > > > > Content-Type: application/json; charset=UTF-8
> > > > > Strict-Transport-Security: max-age=31536000; includeSubdomains
> > > > > X-XSS-Protection: 1; mode=block
> > > > > Content-Security-Policy: default-src 'self';connect-src 'self' ws:
> > > > > wss:;frame-src 'self';img-src 'self' data:;object-src 'self';font-src
> > > > > 'self' data:;script-src 'self' 'unsafe-inline' 'unsafe-eval';style-src
> > > > > 'self' 'unsafe-inline';worker-src 'self' blob:;
> > > > > X-Frame-Options: SAMEORIGIN
> > > > > X-Content-Type-Options: nosniff
> > > > > OData-Version: 4.0
> > > > > Date: Wed, 09 Oct 2024 19:35:50 GMT
> > > > > Cache-Status: squid;detail=mismatch
> > > > > Via: 1.1 squid (squid/6.10)
> > > > > Connection: keep-alive
> > > > > Cache-Control: public, max-age=1800
> > > > >
> > > > > If I use a cache peer with MITMPROXY, squid will cache the results
> > > > > however this is inefficient and slow.
> > > > >
> > > > > --
> > > > > Bryan Seitz
> > > > > seitzbg at gmail.com <mailto:seitzbg at gmail.com>
> > > > >
> > > > > _______________________________________________
> > > > > squid-users mailing list
> > > > > squid-users at lists.squid-cache.org
> > > > > https://lists.squid-cache.org/listinfo/squid-users
> > > >
> >
> >
> > --
> > Bryan Seitz
> > seitzbg at gmail.com
> > _______________________________________________
> > squid-users mailing list
> > squid-users at lists.squid-cache.org
> > https://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20241010/11b5a4ac/attachment.htm>

From rousskov at measurement-factory.com  Fri Oct 11 14:56:34 2024
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Fri, 11 Oct 2024 10:56:34 -0400
Subject: [squid-users] Squid 6.10 SSL-Bump Woes
In-Reply-To: <F991CDF8-4B50-4440-BAA9-95AE4F698155@gmail.com>
References: <CA+uwrTQ9MpOydEptrLSsRtuWGtEk4BwyBOc=Z6fL-hVNxzg47w@mail.gmail.com>
 <F991CDF8-4B50-4440-BAA9-95AE4F698155@gmail.com>
Message-ID: <cdcff8ef-9f11-4d1c-b750-860953fa7415@measurement-factory.com>

On 2024-10-10 20:48, Jonathan Lee wrote:
> miss means it stored items

Just to correct a misunderstanding: A cache miss does _not_ imply that 
Squid stored the response.

Alex.


>> On Oct 10, 2024, at 15:27, Bryan Seitz <seitzbg at gmail.com> wrote:
>>
>> ?
>> I removed the header mods and changed the refresh pattern to:
>>
>> refresh_pattern . ? ? ? ? ? ? ? 15 ? ? ?20% ? ? 1800   
>> ?override-expire ignore-no-cache ignore-no-store ignore-private
>>
>> And I always get TCP_MISS.? Any other thoughts?
>>
>> Thanks!
>>
>> On Thu, Oct 10, 2024 at 12:35?PM Alex Rousskov 
>> <rousskov at measurement-factory.com 
>> <mailto:rousskov at measurement-factory.com>> wrote:
>>
>>     On 2024-10-09 15:40, Bryan Seitz wrote:
>>
>>     ?> SSL-Bump Woes
>>
>>     AFAICT, the problem you are trying to solve is not caused by SslBump.
>>
>>
>>     ?> reply_header_access Cache-Control deny all
>>     ?> reply_header_add Cache-Control? "public, max-age=1800"
>>
>>     The above directives are applied to responses that Squid sends to
>>     clients. These post-cache response modification directives have no
>>     effect on Squid response caching decisions (which are done earlier,
>>     pre-cache, while looking at the virgin or adapted response
>>     received from
>>     the origin server of cache_peer).
>>
>>     FWIW, this caveat is documented in reply_header_add description, but
>>     documentation improvements are welcome:
>>
>>     > This option adds header fields to outgoing HTTP responses (i.e.,
>>     response
>>     > headers delivered by Squid to the client). This option has no
>>     effect on
>>     > cache hit detection. The equivalent adaptation vectoring point in
>>     > ICAP terminology is post-cache RESPMOD.
>>
>>
>>     To allow Squid to violate HTTP caching rules when deciding whether
>>     to a
>>     cache a response, see refresh_pattern options (e.g.,
>>     "ignore-private").
>>     http://www.squid-cache.org/Doc/config/refresh_pattern/
>>     <http://www.squid-cache.org/Doc/config/refresh_pattern/>
>>
>>
>>     HTH,
>>
>>     Alex.
>>
>>
>>     > I have the following configuration:
>>     >
>>     > http_port 3128 ssl-bump generate-host-certificates=on
>>     > tls-cert=/etc/squid/ssl/myCA.pem
>>     > ssl_bump bump all
>>     >
>>     > # BMCs return Cache-Control: private
>>     > reply_header_access Cache-Control deny all
>>     > reply_header_add Cache-Control ?"public, max-age=1800"
>>     >
>>     > follow_x_forwarded_for allow all
>>     > http_access allow all
>>     > include /etc/squid/conf.d/*.conf
>>     > host_verify_strict off
>>     > tls_outgoing_options min-version=1.0
>>     > flags=DONT_VERIFY_PEER,DONT_VERIFY_DOMAIN
>>     > sslproxy_cert_error allow all
>>     >
>>     > sslcrtd_program /usr/lib/squid/security_file_certgen -s
>>     > /var/spool/squid/ssl_db -M 4MB
>>     > sslcrtd_children 5
>>     >
>>     > cache_mem 8192 MB
>>     > cache_dir rock /cm/squid/squid 8192
>>     >
>>     > buffered_logs on
>>     > access_log daemon:/var/log/squid/access.log logformat=squid
>>     > logfile_daemon /usr/lib/squid/log_file_daemon
>>     > cache_store_log daemon:/var/log/squid/store.log
>>     > log_mime_hdrs on
>>     > coredump_dir /var/spool/squid
>>     > shutdown_lifetime 2 seconds
>>     > max_filedesc 4096
>>     > workers 4
>>     >
>>     >
>>     > A curl will note the resource is stale (with new host), but I
>>     never get
>>     > a cache hit on subsequent retries:
>>     >
>>     > Store log:
>>     >
>>     > 1728502393.992 RELEASE -1 FFFFFFFF
>>     02000000000000003A632F0003000000 ?200
>>     > 1728502382 ? ? ? ?-1 ? ? ? ?-1 application/json 1182/1182 GET
>>     >
>>     https://10.170.31.77/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics <https://10.170.31.77/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics> <https://10.170.31.77/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics <https://10.170.31.77/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics>>
>>     > 1728502395.674 RELEASE -1 FFFFFFFF
>>     02000000000000003B632F0002000000 ?200
>>     > 1728502384 ? ? ? ?-1 ? ? ? ?-1 application/json 1182/1182 GET
>>     >
>>     https://10.170.31.77/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics <https://10.170.31.77/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics> <https://10.170.31.77/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics <https://10.170.31.77/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics>>
>>     > 1728502408.317 RELEASE 00 00056924
>>     04000000000000003C632F0001000000 ?200
>>     > 1728420588 ? ? ? ?-1 1728422388 application/json 1189/1189 GET
>>     >
>>     https://10.170.31.81/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics <https://10.170.31.81/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics> <https://10.170.31.81/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics <https://10.170.31.81/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics>>
>>     > 1728502408.318 RELEASE -1 FFFFFFFF
>>     03000000000000003C632F0001000000 ?200
>>     > 1728502404 ? ? ? ?-1 ? ? ? ?-1 application/json 1179/1179 GET
>>     >
>>     https://10.170.31.81/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics <https://10.170.31.81/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics> <https://10.170.31.81/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics <https://10.170.31.81/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics>>
>>     > 1728502417.161 RELEASE -1 FFFFFFFF
>>     05000000000000003C632F0001000000 ?200
>>     > 1728502413 ? ? ? ?-1 ? ? ? ?-1 application/json 1179/1179 GET
>>     >
>>     https://10.170.31.81/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics <https://10.170.31.81/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics> <https://10.170.31.81/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics <https://10.170.31.81/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics>>
>>     >
>>     > Response headers:
>>     >
>>     > HTTP/1.1 200 Connection established
>>     >
>>     > HTTP/1.1 200 OK
>>     > Link: <http://redfish.dmtf.org/schemas/v1/Z.v1_5_2.json
>>     <http://redfish.dmtf.org/schemas/v1/Z.v1_5_2.json>
>>     > <http://redfish.dmtf.org/schemas/v1/Z.v1_5_2.json
>>     <http://redfish.dmtf.org/schemas/v1/Z.v1_5_2.json>>>; rel=describedby
>>     > Allow: GET
>>     > Content-Length: 1179
>>     > Content-Type: application/json; charset=UTF-8
>>     > Strict-Transport-Security: max-age=31536000; includeSubdomains
>>     > X-XSS-Protection: 1; mode=block
>>     > Content-Security-Policy: default-src 'self';connect-src 'self' ws:
>>     > wss:;frame-src 'self';img-src 'self' data:;object-src
>>     'self';font-src
>>     > 'self' data:;script-src 'self' 'unsafe-inline'
>>     'unsafe-eval';style-src
>>     > 'self' 'unsafe-inline';worker-src 'self' blob:;
>>     > X-Frame-Options: SAMEORIGIN
>>     > X-Content-Type-Options: nosniff
>>     > OData-Version: 4.0
>>     > Date: Wed, 09 Oct 2024 19:35:50 GMT
>>     > Cache-Status: squid;detail=mismatch
>>     > Via: 1.1 squid (squid/6.10)
>>     > Connection: keep-alive
>>     > Cache-Control: public, max-age=1800
>>     >
>>     > If I use a cache peer with MITMPROXY, squid will cache the results
>>     > however this is inefficient and slow.
>>     >
>>     > --
>>     > Bryan Seitz
>>     > seitzbg at gmail.com <mailto:seitzbg at gmail.com>
>>     <mailto:seitzbg at gmail.com <mailto:seitzbg at gmail.com>>
>>     >
>>     > _______________________________________________
>>     > squid-users mailing list
>>     > squid-users at lists.squid-cache.org
>>     <mailto:squid-users at lists.squid-cache.org>
>>     > https://lists.squid-cache.org/listinfo/squid-users
>>     <https://lists.squid-cache.org/listinfo/squid-users>
>>
>>
>>
>> -- 
>> Bryan Seitz
>> seitzbg at gmail.com <mailto:seitzbg at gmail.com>
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> https://lists.squid-cache.org/listinfo/squid-users



From seitzbg at gmail.com  Fri Oct 11 18:10:16 2024
From: seitzbg at gmail.com (Bryan Seitz)
Date: Fri, 11 Oct 2024 14:10:16 -0400
Subject: [squid-users] Squid 6.10 SSL-Bump Woes
In-Reply-To: <f994f59a-3a1a-4cb6-9e98-fb186109f879@treenet.co.nz>
References: <CA+uwrTRnXSAVZ60RhfDvFS18aDZDUFZCWDKnUUd1KGE=wZL0pA@mail.gmail.com>
 <c8448d78-0ce5-413b-9bb3-16b680015659@measurement-factory.com>
 <CA+uwrTQ9MpOydEptrLSsRtuWGtEk4BwyBOc=Z6fL-hVNxzg47w@mail.gmail.com>
 <f994f59a-3a1a-4cb6-9e98-fb186109f879@treenet.co.nz>
Message-ID: <CA+uwrTQVt6hpyw+M=Fg4GUjYH=u8ZbLV0s=fYtU3Uov+D-HP2w@mail.gmail.com>

root at squid:~# curl -i --insecure --proxy http://squid:3128/ "
https://10.170.31.75/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics
"
HTTP/1.1 200 Connection established

HTTP/1.1 200 OK
Link: <http://redfish.dmtf.org/schemas/v1/Z.v1_5_2.json>; rel=describedby
Allow: GET
Content-Length: 1173
Content-Type: application/json; charset=UTF-8
Strict-Transport-Security: max-age=31536000; includeSubdomains
X-XSS-Protection: 1; mode=block
Content-Security-Policy: default-src 'self';connect-src 'self' ws:
wss:;frame-src 'self';img-src 'self' data:;object-src 'self';font-src
'self' data:;script-src 'self' 'unsafe-inline' 'unsafe-eval';style-src
'self' 'unsafe-inline';worker-src 'self' blob:;
X-Frame-Options: SAMEORIGIN
X-Content-Type-Options: nosniff
OData-Version: 4.0
Date: Fri, 11 Oct 2024 18:03:49 GMT
Cache-Status: squid;detail=mismatch
Via: 1.1 squid (squid/6.10)
Connection: keep-alive
Cache-Control: public, max-age=1800

Second run:

curl -i --insecure --proxy http://squid:3128/ "
https://10.170.31.75/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics
"
HTTP/1.1 200 Connection established

HTTP/1.1 200 OK
Link: <http://redfish.dmtf.org/schemas/v1/Z.v1_5_2.json>; rel=describedby
Allow: GET
Content-Length: 1173
Content-Type: application/json; charset=UTF-8
Strict-Transport-Security: max-age=31536000; includeSubdomains
X-XSS-Protection: 1; mode=block
Content-Security-Policy: default-src 'self';connect-src 'self' ws:
wss:;frame-src 'self';img-src 'self' data:;object-src 'self';font-src
'self' data:;script-src 'self' 'unsafe-inline' 'unsafe-eval';style-src
'self' 'unsafe-inline';worker-src 'self' blob:;
X-Frame-Options: SAMEORIGIN
X-Content-Type-Options: nosniff
OData-Version: 4.0
Date: Fri, 11 Oct 2024 18:05:16 GMT
Cache-Status: squid;detail=mismatch
Via: 1.1 squid (squid/6.10)
Connection: keep-alive
Cache-Control: public, max-age=1800

Logs:

1728669831.300     40 10.65.34.5 NONE_NONE/200 0 CONNECT 10.170.31.75:443 -
HIER_NONE/- - [Host: 10.170.31.75:443\r\nUser-Agent:
curl/7.81.0\r\nProxy-Connection: Keep-Alive\r\n] [HTTP/1.1 200 Connection
established\r\n\r\n]
1728669831.847    546 10.65.34.5 TCP_MISS/200 2000 GET
https://10.170.31.75/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics
- HIER_DIRECT/10.170.31.75 application/json [Host:
10.170.31.75\r\nUser-Agent: curl/7.81.0\r\nAccept: */*\r\n] [HTTP/1.1 200
OK\r\nLink: <http://redfish.dmtf.org/schemas/v1/Z.v1_5_2.json>;
rel=describedby\r\nAllow: GET\r\nContent-Length: 1173\r\nContent-Type:
application/json; charset=UTF-8\r\nStrict-Transport-Security:
max-age=31536000; includeSubdomains\r\nX-XSS-Protection: 1;
mode=block\r\nContent-Security-Policy: default-src 'self';connect-src
'self' ws: wss:;frame-src 'self';img-src 'self' data:;object-src
'self';font-src 'self' data:;script-src 'self' 'unsafe-inline'
'unsafe-eval';style-src 'self' 'unsafe-inline';worker-src 'self'
blob:;\r\nX-Frame-Options: SAMEORIGIN\r\nX-Content-Type-Options:
nosniff\r\nOData-Version: 4.0\r\nDate: Fri, 11 Oct 2024 18:03:49
GMT\r\nCache-Status: squid;detail=mismatch\r\nVia: 1.1 squid
squid/6.10)\r\nConnection: keep-alive\r\nCache-Control: public,
max-age=1800\r\n\r\n]
1728669917.657     39 10.65.34.5 NONE_NONE/200 0 CONNECT 10.170.31.75:443 -
HIER_NONE/- - [Host: 10.170.31.75:443\r\nUser-Agent:
curl/7.81.0\r\nProxy-Connection: Keep-Alive\r\n] [HTTP/1.1 200 Connection
established\r\n\r\n]
1728669918.269    611 10.65.34.5 TCP_MISS/200 2000 GET
https://10.170.31.75/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics
- HIER_DIRECT/10.170.31.75 application/json [Host:
10.170.31.75\r\nUser-Agent: curl/7.81.0\r\nAccept: */*\r\n] [HTTP/1.1 200
OK\r\nLink: <http://redfish.dmtf.org/schemas/v1/Z.v1_5_2.json>;
rel=describedby\r\nAllow: GET\r\nContent-Length: 1173\r\nContent-Type:
application/json; charset=UTF-8\r\nStrict-Transport-Security:
max-age=31536000; includeSubdomains\r\nX-XSS-Protection: 1;
mode=block\r\nContent-Security-Policy: default-src 'self';connect-src
'self' ws: wss:;frame-src 'self';img-src 'self' data:;object-src
'self';font-src 'self' data:;script-src 'self' 'unsafe-inline'
'unsafe-eval';style-src 'self' 'unsafe-inline';worker-src 'self'
blob:;\r\nX-Frame-Options: SAMEORIGIN\r\nX-Content-Type-Options:
nosniff\r\nOData-Version: 4.0\r\nDate: Fri, 11 Oct 2024 18:05:16
GMT\r\nCache-Status: squid;detail=mismatch\r\nVia: 1.1 squid
(squid/6.10)\r\nConnection: keep-alive\r\nCache-Control: public,
max-age=1800\r\n\r\n]

1728669831.847 RELEASE -1 FFFFFFFF 020000000000000031450B0001000000  200
1728669829        -1        -1 application/json 1173/1173 GET
https://10.170.31.75/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics
1728669918.269 RELEASE -1 FFFFFFFF 02000000000000002E450B0004000000  200
1728669916        -1        -1 application/json 1173/1173 GET
https://10.170.31.75/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics

Cache log:
https://p.bsd-unix.net/?bfc9a1568c49f0b6#89PnEqmjNr7iLh1ZYTLVbgbt4FouhW2RekSxeaZ3xZZs

Happy to jump on irc/discord/matrix/whatever for help if easier to debug!

Thanks!

On Fri, Oct 11, 2024 at 4:17?AM Amos Jeffries <squid3 at treenet.co.nz> wrote:

> On 11/10/24 11:08, Bryan Seitz wrote:
> > I removed the header mods and changed the refresh pattern to:
> >
> > refresh_pattern .               15      20%     1800    override-expire
> > ignore-no-cache ignore-no-store ignore-private
> >
> > And I always get TCP_MISS.  Any other thoughts?
>
> Ah, I believe it would be best to get a baseline of what Squid default
> behaviour is like in your environment. So we can identify what/how you
> need to improve it.
>
>
> Firstly, FYI; this is what those controls **actually** do in current
> Squid ..
>
>   * override-expires ... forces Squid to handle all responses to act as
> if they received "Cache-Control: max-age=900" (15 min) ... store, but
> revalidate 180+ seconds (20% of 15min) later.
>    Result: Anything that could cache longer than 15min becomes a
> REFRESH_MISS or MISS, instead of HIT.
>    Squid default: **do** cache. Revalidate
>      * after("Date"+"CC: max-age=N") timestamp, otherwise
>      * after "Expires" timestamp, otherwise
>      * after ("Date" +1800 minutes) timestamp.
>
>   * ignore-no-cache ... the standardized "CC: no-cache" is badly named,
> it tells Squid what **can** be cached.
>    Result: Squid will discard many stored objects and perform a MISS
> instead.
>    Squid default: **do** cache "CC:private" responses, revalidate on
> HIT. Log as REFRESH.
>
>   * ignore-no-store ... force everything marked "CC: no-store" to be
> stored.
>   Result: cache fills with non-reusable objects. Leaving not much room
> for actual HIT objects.
>    Squid default: store only objects with can result in more HITs.
>
>   * ignore-private ... force everything with "CC: private" to be discarded.
>    Result: same as "ignore-no-store".
>    Squid default: **do** cache "CC:private" responses, revalidate on HIT.
>
> Note that both HIT and REFRESH mean the object **was** cached.
>
>
> You said that the access.log now contains MISS. Would that be just
> "MISS" or "REFRESH" + "MISS" (actually a HIT, but a new object was given
> by the server and replaced the pre-stored object).
>
>
> Can you show a pair of request headers from the client, with matching
> response from the server?  You can use "debug_options 11,2" in recent
> Squid versions to get a cache.log trace of the HTTP transactions.
>
> That might help us spot something more specific. The config change makes
> the earlier given ones obsolete.
>
>
> HTH
> Amos
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> https://lists.squid-cache.org/listinfo/squid-users
>


-- 
Bryan Seitz
seitzbg at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20241011/9a23d151/attachment.htm>

From seitzbg at gmail.com  Fri Oct 11 23:48:35 2024
From: seitzbg at gmail.com (Bryan Seitz)
Date: Fri, 11 Oct 2024 19:48:35 -0400
Subject: [squid-users] Squid 6.10 SSL-Bump Woes
In-Reply-To: <f994f59a-3a1a-4cb6-9e98-fb186109f879@treenet.co.nz>
References: <CA+uwrTRnXSAVZ60RhfDvFS18aDZDUFZCWDKnUUd1KGE=wZL0pA@mail.gmail.com>
 <c8448d78-0ce5-413b-9bb3-16b680015659@measurement-factory.com>
 <CA+uwrTQ9MpOydEptrLSsRtuWGtEk4BwyBOc=Z6fL-hVNxzg47w@mail.gmail.com>
 <f994f59a-3a1a-4cb6-9e98-fb186109f879@treenet.co.nz>
Message-ID: <74575885-4a3e-4cfe-ba81-a4d0cbf47671@Spark>

? ?I wanted to note that since these are BMCs they require basic auth headers to return their response. I noticed that the ignore-auth option was removed awhile ago.??Is my only option to go back to Squid 3.5 ?

TIA,

Bryan Seitz
On Oct 11, 2024 at 4:17?AM -0400, Amos Jeffries <squid3 at treenet.co.nz>, wrote:
> On 11/10/24 11:08, Bryan Seitz wrote:
> > I removed the header mods and changed the refresh pattern to:
> >
> > refresh_pattern . ? ? ? ? ? ? ? 15 ? ? ?20% ? ? 1800 ? ?override-expire
> > ignore-no-cache ignore-no-store ignore-private
> >
> > And I always get TCP_MISS.? Any other thoughts?
>
> Ah, I believe it would be best to get a baseline of what Squid default
> behaviour is like in your environment. So we can identify what/how you
> need to improve it.
>
>
> Firstly, FYI; this is what those controls **actually** do in current
> Squid ..
>
> * override-expires ... forces Squid to handle all responses to act as
> if they received "Cache-Control: max-age=900" (15 min) ... store, but
> revalidate 180+ seconds (20% of 15min) later.
> Result: Anything that could cache longer than 15min becomes a
> REFRESH_MISS or MISS, instead of HIT.
> Squid default: **do** cache. Revalidate
> * after("Date"+"CC: max-age=N") timestamp, otherwise
> * after "Expires" timestamp, otherwise
> * after ("Date" +1800 minutes) timestamp.
>
> * ignore-no-cache ... the standardized "CC: no-cache" is badly named,
> it tells Squid what **can** be cached.
> Result: Squid will discard many stored objects and perform a MISS
> instead.
> Squid default: **do** cache "CC:private" responses, revalidate on
> HIT. Log as REFRESH.
>
> * ignore-no-store ... force everything marked "CC: no-store" to be stored.
> Result: cache fills with non-reusable objects. Leaving not much room
> for actual HIT objects.
> Squid default: store only objects with can result in more HITs.
>
> * ignore-private ... force everything with "CC: private" to be discarded.
> Result: same as "ignore-no-store".
> Squid default: **do** cache "CC:private" responses, revalidate on HIT.
>
> Note that both HIT and REFRESH mean the object **was** cached.
>
>
> You said that the access.log now contains MISS. Would that be just
> "MISS" or "REFRESH" + "MISS" (actually a HIT, but a new object was given
> by the server and replaced the pre-stored object).
>
>
> Can you show a pair of request headers from the client, with matching
> response from the server? You can use "debug_options 11,2" in recent
> Squid versions to get a cache.log trace of the HTTP transactions.
>
> That might help us spot something more specific. The config change makes
> the earlier given ones obsolete.
>
>
> HTH
> Amos
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> https://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20241011/97cd09cc/attachment.htm>

From squid3 at treenet.co.nz  Sun Oct 13 04:31:45 2024
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sun, 13 Oct 2024 17:31:45 +1300
Subject: [squid-users] Squid 6.10 SSL-Bump Woes
In-Reply-To: <CA+uwrTQVt6hpyw+M=Fg4GUjYH=u8ZbLV0s=fYtU3Uov+D-HP2w@mail.gmail.com>
References: <CA+uwrTRnXSAVZ60RhfDvFS18aDZDUFZCWDKnUUd1KGE=wZL0pA@mail.gmail.com>
 <c8448d78-0ce5-413b-9bb3-16b680015659@measurement-factory.com>
 <CA+uwrTQ9MpOydEptrLSsRtuWGtEk4BwyBOc=Z6fL-hVNxzg47w@mail.gmail.com>
 <f994f59a-3a1a-4cb6-9e98-fb186109f879@treenet.co.nz>
 <CA+uwrTQVt6hpyw+M=Fg4GUjYH=u8ZbLV0s=fYtU3Uov+D-HP2w@mail.gmail.com>
Message-ID: <cca630fa-ae50-4c65-a029-63c75cbb8cc6@treenet.co.nz>


Okay, I am seeing the server response is marked "private" and 7hrs old 
(25200sec).

Replacing the Cache-Control header using "max-age=1800" is not having 
noticeable effect because 25200sec is already past the 1800sec limit.


What you need to do there instead is:

  1) remove the config changing Cache-Control header.

  2) modify the "refresh_pattern . " line to be this:

  refresh_pattern . 0 20% 4320 ignore-private reload-into-ims


Your Squid should then cache the server response and treat the "private" 
as if it were a "must-revalidate".


Please do that then provide a new cache.log trace for us to see how the 
server handles a revalidation check.


Amos



From squid3 at treenet.co.nz  Sun Oct 13 04:34:30 2024
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sun, 13 Oct 2024 17:34:30 +1300
Subject: [squid-users] Squid 6.10 SSL-Bump Woes
In-Reply-To: <74575885-4a3e-4cfe-ba81-a4d0cbf47671@Spark>
References: <CA+uwrTRnXSAVZ60RhfDvFS18aDZDUFZCWDKnUUd1KGE=wZL0pA@mail.gmail.com>
 <c8448d78-0ce5-413b-9bb3-16b680015659@measurement-factory.com>
 <CA+uwrTQ9MpOydEptrLSsRtuWGtEk4BwyBOc=Z6fL-hVNxzg47w@mail.gmail.com>
 <f994f59a-3a1a-4cb6-9e98-fb186109f879@treenet.co.nz>
 <74575885-4a3e-4cfe-ba81-a4d0cbf47671@Spark>
Message-ID: <c89376c8-79d4-42d9-8985-2d332995e8f3@treenet.co.nz>

On 12/10/24 12:48, Bryan Seitz wrote:
>  ? ?I wanted to note that since these are BMCs they require basic auth 
> headers to return their response. I noticed that the ignore-auth option 
> was removed awhile ago.??Is my only option to go back to Squid 3.5 ?
> 

Squid supports caching of authenticated traffic now.
The authentication is also purely between Squid and the server, so is 
not relevant to the cacheability of these responses.


HTH
Amos



From seitzbg at gmail.com  Mon Oct 14 18:35:46 2024
From: seitzbg at gmail.com (Bryan Seitz)
Date: Mon, 14 Oct 2024 14:35:46 -0400
Subject: [squid-users] Squid 6.10 SSL-Bump Woes
In-Reply-To: <cca630fa-ae50-4c65-a029-63c75cbb8cc6@treenet.co.nz>
References: <CA+uwrTRnXSAVZ60RhfDvFS18aDZDUFZCWDKnUUd1KGE=wZL0pA@mail.gmail.com>
 <c8448d78-0ce5-413b-9bb3-16b680015659@measurement-factory.com>
 <CA+uwrTQ9MpOydEptrLSsRtuWGtEk4BwyBOc=Z6fL-hVNxzg47w@mail.gmail.com>
 <f994f59a-3a1a-4cb6-9e98-fb186109f879@treenet.co.nz>
 <CA+uwrTQVt6hpyw+M=Fg4GUjYH=u8ZbLV0s=fYtU3Uov+D-HP2w@mail.gmail.com>
 <cca630fa-ae50-4c65-a029-63c75cbb8cc6@treenet.co.nz>
Message-ID: <e6e63deb-e3fb-4658-ad5d-906a7b386b14@Spark>

Still no hits with:

refresh_pattern . 0 20% 4320 ignore-private reload-into-ims
debug_options 11,2

Cache log: https://p.bsd-unix.net/?32d7b024a87ab761#Bo4xhz1NVZmPffosydDV61Wp533wqTxcW8C4iFT4oaQ
Store log: https://p.bsd-unix.net/?884a46ba914bf600#HDqP2Hdt68DmhSyHEDvdxxndJNBioqGM6Fe1fsENWWug

If I am missing debug lmk.??Still to note, these servers require basic auth. I saw Squid 3.5 had ignore-auth but it was removed for 4. Is that my issue ?

Bryan Seitz
On Oct 13, 2024 at 12:32?AM -0400, Amos Jeffries <squid3 at treenet.co.nz>, wrote:
>
> Okay, I am seeing the server response is marked "private" and 7hrs old
> (25200sec).
>
> Replacing the Cache-Control header using "max-age=1800" is not having
> noticeable effect because 25200sec is already past the 1800sec limit.
>
>
> What you need to do there instead is:
>
> 1) remove the config changing Cache-Control header.
>
> 2) modify the "refresh_pattern . " line to be this:
>
> refresh_pattern . 0 20% 4320 ignore-private reload-into-ims
>
>
> Your Squid should then cache the server response and treat the "private"
> as if it were a "must-revalidate".
>
>
> Please do that then provide a new cache.log trace for us to see how the
> server handles a revalidation check.
>
>
> Amos
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> https://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20241014/03d71968/attachment.htm>

From seitzbg at gmail.com  Mon Oct 14 18:40:01 2024
From: seitzbg at gmail.com (Bryan Seitz)
Date: Mon, 14 Oct 2024 14:40:01 -0400
Subject: [squid-users] Squid 6.10 SSL-Bump Woes
In-Reply-To: <e6e63deb-e3fb-4658-ad5d-906a7b386b14@Spark>
References: <CA+uwrTRnXSAVZ60RhfDvFS18aDZDUFZCWDKnUUd1KGE=wZL0pA@mail.gmail.com>
 <c8448d78-0ce5-413b-9bb3-16b680015659@measurement-factory.com>
 <CA+uwrTQ9MpOydEptrLSsRtuWGtEk4BwyBOc=Z6fL-hVNxzg47w@mail.gmail.com>
 <f994f59a-3a1a-4cb6-9e98-fb186109f879@treenet.co.nz>
 <CA+uwrTQVt6hpyw+M=Fg4GUjYH=u8ZbLV0s=fYtU3Uov+D-HP2w@mail.gmail.com>
 <cca630fa-ae50-4c65-a029-63c75cbb8cc6@treenet.co.nz>
 <e6e63deb-e3fb-4658-ad5d-906a7b386b14@Spark>
Message-ID: <a3b6d171-1fdf-4796-9f71-05258c4c3b7e@Spark>

One of the endpoints on these BMCs does not require auth and Squid is caching that.
It will not cache the endpoints that require auth.??I want it to do this, is there a way?
(This is literally for metrics, not private data)

Bryan Seitz
On Oct 14, 2024 at 2:35?PM -0400, Bryan Seitz <seitzbg at gmail.com>, wrote:
> Still no hits with:
>
> refresh_pattern . 0 20% 4320 ignore-private reload-into-ims
> debug_options 11,2
>
> Cache log: https://p.bsd-unix.net/?32d7b024a87ab761#Bo4xhz1NVZmPffosydDV61Wp533wqTxcW8C4iFT4oaQ
> Store log: https://p.bsd-unix.net/?884a46ba914bf600#HDqP2Hdt68DmhSyHEDvdxxndJNBioqGM6Fe1fsENWWug
>
> If I am missing debug lmk.??Still to note, these servers require basic auth. I saw Squid 3.5 had ignore-auth but it was removed for 4. Is that my issue ?
>
> Bryan Seitz
> On Oct 13, 2024 at 12:32?AM -0400, Amos Jeffries <squid3 at treenet.co.nz>, wrote:
> >
> > Okay, I am seeing the server response is marked "private" and 7hrs old
> > (25200sec).
> >
> > Replacing the Cache-Control header using "max-age=1800" is not having
> > noticeable effect because 25200sec is already past the 1800sec limit.
> >
> >
> > What you need to do there instead is:
> >
> > 1) remove the config changing Cache-Control header.
> >
> > 2) modify the "refresh_pattern . " line to be this:
> >
> > refresh_pattern . 0 20% 4320 ignore-private reload-into-ims
> >
> >
> > Your Squid should then cache the server response and treat the "private"
> > as if it were a "must-revalidate".
> >
> >
> > Please do that then provide a new cache.log trace for us to see how the
> > server handles a revalidation check.
> >
> >
> > Amos
> >
> > _______________________________________________
> > squid-users mailing list
> > squid-users at lists.squid-cache.org
> > https://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20241014/785f955b/attachment.htm>

From seitzbg at gmail.com  Tue Oct 15 17:35:38 2024
From: seitzbg at gmail.com (Bryan Seitz)
Date: Tue, 15 Oct 2024 13:35:38 -0400
Subject: [squid-users] Squid 6.10 SSL-Bump Woes
In-Reply-To: <c89376c8-79d4-42d9-8985-2d332995e8f3@treenet.co.nz>
References: <CA+uwrTRnXSAVZ60RhfDvFS18aDZDUFZCWDKnUUd1KGE=wZL0pA@mail.gmail.com>
 <c8448d78-0ce5-413b-9bb3-16b680015659@measurement-factory.com>
 <CA+uwrTQ9MpOydEptrLSsRtuWGtEk4BwyBOc=Z6fL-hVNxzg47w@mail.gmail.com>
 <f994f59a-3a1a-4cb6-9e98-fb186109f879@treenet.co.nz>
 <74575885-4a3e-4cfe-ba81-a4d0cbf47671@Spark>
 <c89376c8-79d4-42d9-8985-2d332995e8f3@treenet.co.nz>
Message-ID: <d6dff9bc-a0ec-4522-9873-b90cb9f082a9@Spark>

It caches the non Auth requests fine. It won?t cache the Auth endpoints. Is there a config I?m missing ?


TIA,

Bryan Seitz
On Oct 13, 2024 at 12:42?AM -0400, Amos Jeffries <squid3 at treenet.co.nz>, wrote:
> On 12/10/24 12:48, Bryan Seitz wrote:
> > ? ?I wanted to note that since these are BMCs they require basic auth
> > headers to return their response. I noticed that the ignore-auth option
> > was removed awhile ago.??Is my only option to go back to Squid 3.5 ?
> >
>
> Squid supports caching of authenticated traffic now.
> The authentication is also purely between Squid and the server, so is
> not relevant to the cacheability of these responses.
>
>
> HTH
> Amos
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> https://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20241015/ad7657ea/attachment.htm>

From Josh.Piana at hexcel.com  Tue Oct 15 20:39:04 2024
From: Josh.Piana at hexcel.com (Piana, Josh)
Date: Tue, 15 Oct 2024 20:39:04 +0000
Subject: [squid-users] Unable to access a device over port 4434
In-Reply-To: <f650f52c-4bab-4ef0-93c0-04139efa6f79@treenet.co.nz>
References: <cc3be63a93bd478b8dee1e2b529540dc@hexcel.com>
 <ZweAUvyJWT-EkNOb@fantomas.sk> <73682cf79e0546b4b4c1faa35d034614@hexcel.com>
 <f650f52c-4bab-4ef0-93c0-04139efa6f79@treenet.co.nz>
Message-ID: <2b1a9d31a33f460bae39c990467e3a59@hexcel.com>

Amos, 

Thank you for getting back to me and clarifying. 

I ran this command:
#wget -Y off 172.27.46.253

Response:
--2024-10-15 16:36:15--  http://172.27.46.253/
Connecting to 172.27.46.253:80... connected.
HTTP request sent, awaiting response... 301 Moved Permanently
Location: https://172.27.46.253/ [following]
--2024-10-15 16:36:15--  https://172.27.46.253/
Connecting to 172.27.46.253:443... connected.
ERROR: The certificate of '172.27.46.253' is not trusted.
ERROR: The certificate of '172.27.46.253' doesn't have a known issuer.
The certificate's owner does not match hostname '172.27.46.253'

When I tried using port 4434, the wget command just times out. 

So with the errors given, would that stop us from connecting to it? Typically with sites with trust issues or certification issues, you can still bypass it. We'd like to do the same here if applicable. 

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Amos Jeffries
Sent: Thursday, October 10, 2024 9:25 PM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Unable to access a device over port 4434

Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.


On 11/10/24 07:21, Piana, Josh wrote:
> Hello Matus,
>
> I apologize, I was unable to read any of the links that were responded with because our environment appended the " eur02.safelinks.protection.outlook.com..." Outlook protection. Did you see that as well on your side? When I did click the links to view them is just stated as failed.
>
> What I gather from what you said was that, it's not likely Squid is the issue. Even when we bypass Squid it does work. FWIW, it's possible that there is some other network problem coming into play here on our side. Though I did try to verify there's now blockages from the firewall, the networks, the traffic, etc.


FTR; the critical detail in what Matus wrote was that the "wget" (or curl if you prefer) connection test **must** be performed
  A) on the Squid machine,
  B) using the same low-privileges user account that Squid runs with,
  D) to the same server IP address Squid is trying to contact.

That ensures the TCP connection privileges are as close to identical to what Squid is doing.

Running it from another machine and/or user account may encounter different firewall or routing behaviour that hides the real issue.

If that test provides a successful TCP connection, *and* HTTP response message the next step is to


Also, FYI; your custom change to the timestamp has somehow lost the "duration" value, so I/we cannot tell if this was a probable TCP FIN/RST (hint of firewall problem) or a SYN+ACK timeout (hint of routing problem).


HTH
Amos




>
> I suppose from here I'll try to troubleshoot other things.
>
> Alternatively, do you think I should try to create an ACL which bypasses any filters or rules to that network?
>
> -----Original Message-----
> From: squid-users <squid-users-bounces at lists.squid-cache.org> On 
> Behalf Of Matus UHLAR - fantomas
> Sent: Thursday, October 10, 2024 3:21 AM
> To: squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] Unable to access a device over port 4434
>
> Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.
>
>
> On 09.10.24 19:59, Piana, Josh wrote:
>> I'm running into an issue wherein, when using Squid proxy, I'm unable to get to one of our management devices from port 4434.
>>
>> I've already verified that this device is not blocking access from the proxy directly, and should be allowed to get to the access page.
>>
>> -          When reviewing the access logs, I can see that we're running into a generic 503 error
>>
>> -          When browsing to this page, it will attempt to load for about 30 seconds, and then fail
>>
>> -          The webpage response is a generic "The system returned: (110) Connection timed out"
>>
>> -          When we forgo the proxy, we can access it without an issue
>>
>> This device is located on a 172.0.0.0/8 internal network.
>>
>> -          Other devices which do NOT use this port are accessible
>>
>> -          Changing the access port is not an option (not up to me)
>>
>> Access Log entry:
>> 09/Oct/2024:15:54:21 -0400.758 10.46.49.190 TCP_MISS/503 4448 GET
>> http://0.0.0.172/.
>> 0.0.27%2F&data=05%7C02%7Cjosh.piana%40hexcel.com%7C1b118e55c63c42ed3d
>> e908dce99396c5%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C638642067
>> 356048064%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzI
>> iLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=JIO8AKoz7QPe1%2BDG
>> Mza7mltOnSfvf2eHAEfubJx%2FLaY%3D&reserved=0
>> .46.253%3A4434%2F&data=05%7C02%7Cjosh.piana%40hexcel.com%7Cad6b9a6df5
>> da
>> 44a2b73508dce8fc1971%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C638
>> 64 
>> 1416681623895%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2l
>> uM 
>> zIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=G%2FrqNK0o%2Bdk0
>> ia
>> zrnMhbyTvL0RmZAK27lulhMBhPMDU%3D&reserved=0 jpiana \
>> HIER_DIRECT/172.27.46.253 text/html ERR_CONNECT_FAIL/WITH_SERVER
>
>
> I guess the correct URL is: 
> http://172.0.0.2/
> 7.46.253%3A4434%2Fjpiana&data=05%7C02%7Cjosh.piana%40hexcel.com%7C1b11
> 8e55c63c42ed3de908dce99396c5%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C
> 0%7C638642067356204330%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJ
> QIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=nRShvvJ
> uN7mqiILEdnHF6POw6I9kOZh0fX9QiO87bXY%3D&reserved=0
>
> have you tried running following directly from the squid machine?
>
> wget -Y off 
> http://172.0.0.2/
> 7.46.253%3A4434%2Fjpiana&data=05%7C02%7Cjosh.piana%40hexcel.com%7C1b11
> 8e55c63c42ed3de908dce99396c5%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C
> 0%7C638642067356204330%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJ
> QIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=nRShvvJ
> uN7mqiILEdnHF6POw6I9kOZh0fX9QiO87bXY%3D&reserved=0
>
>
> Because ERR_CONNECT_FAIL/WITH_SERVER and "Connection timed out" both say that the squid was unable to open connection to server.
>
> which is not a squid issue but network connection issue.
> --
> Matus UHLAR - fantomas, uhlar at fantomas.sk ; 
> http://www.f/
> antomas.sk%2F&data=05%7C02%7Cjosh.piana%40hexcel.com%7C1b118e55c63c42e
> d3de908dce99396c5%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C6386420
> 67356204330%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMz
> IiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=3YtZi3tFr1hAIGEd4X
> %2BlV%2BHBkp9Dpo8vFOpqHGZjJE4%3D&reserved=0
> Warning: I wish NOT to receive e-mail advertising to this address.
> Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
> LSD will make your ECS screen display 16.7 million colors 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> https://list/
> s.squid-cache.org%2Flistinfo%2Fsquid-users&data=05%7C02%7Cjosh.piana%4
> 0hexcel.com%7C1b118e55c63c42ed3de908dce99396c5%7C4248050df19546d5ac9c0
> c7c52b04cae%7C0%7C0%7C638642067356204330%7CUnknown%7CTWFpbGZsb3d8eyJWI
> joiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7
> C%7C&sdata=88Who2EDEIVOofkEfXOiH9XQ0xldGyAfXe%2Fer48pH%2B8%3D&reserved
> =0 _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> https://list/
> s.squid-cache.org%2Flistinfo%2Fsquid-users&data=05%7C02%7Cjosh.piana%4
> 0hexcel.com%7C1b118e55c63c42ed3de908dce99396c5%7C4248050df19546d5ac9c0
> c7c52b04cae%7C0%7C0%7C638642067356204330%7CUnknown%7CTWFpbGZsb3d8eyJWI
> joiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7
> C%7C&sdata=88Who2EDEIVOofkEfXOiH9XQ0xldGyAfXe%2Fer48pH%2B8%3D&reserved
> =0

_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
https://lists.squid-cache.org/listinfo/squid-users


From uhlar at fantomas.sk  Wed Oct 16 11:55:35 2024
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Wed, 16 Oct 2024 13:55:35 +0200
Subject: [squid-users] Unable to access a device over port 4434
In-Reply-To: <2b1a9d31a33f460bae39c990467e3a59@hexcel.com>
References: <cc3be63a93bd478b8dee1e2b529540dc@hexcel.com>
 <ZweAUvyJWT-EkNOb@fantomas.sk>
 <73682cf79e0546b4b4c1faa35d034614@hexcel.com>
 <f650f52c-4bab-4ef0-93c0-04139efa6f79@treenet.co.nz>
 <2b1a9d31a33f460bae39c990467e3a59@hexcel.com>
Message-ID: <Zw-pt5UQjo8U3rr9@fantomas.sk>

On 15.10.24 20:39, Piana, Josh wrote:
>Thank you for getting back to me and clarifying.
>
>I ran this command:
>#wget -Y off 172.27.46.253
>
>Response:
>--2024-10-15 16:36:15--  http://172.27.46.253/
>Connecting to 172.27.46.253:80... connected.
>HTTP request sent, awaiting response... 301 Moved Permanently
>Location: https://172.27.46.253/ [following]
>--2024-10-15 16:36:15--  https://172.27.46.253/
>Connecting to 172.27.46.253:443... connected.
>ERROR: The certificate of '172.27.46.253' is not trusted.
>ERROR: The certificate of '172.27.46.253' doesn't have a known issuer.
>The certificate's owner does not match hostname '172.27.46.253'
>
>When I tried using port 4434, the wget command just times out.

this means that your squid machine is apparently blocked from connecting to 
remote host on port 4434.

Either that host blocked connections from your squid machine, or your squid 
machine (or any device on your network) has firewall rule that prevent this.

This it not a squid error. 

Do you have local firewall on your squid machine?


>So with the errors given, would that stop us from connecting to it?  
> Typically with sites with trust issues or certification issues, you can 
> still bypass it.  We'd like to do the same here if applicable.

>On 11/10/24 07:21, Piana, Josh wrote:
>> I apologize, I was unable to read any of the links that were responded 
>> with because our environment appended the " 
>> eur02.safelinks.protection.outlook.com..." Outlook protection.  Did you 
>> see that as well on your side?  When I did click the links to view them 
>> is just stated as failed.
>>
>> What I gather from what you said was that, it's not likely Squid is the 
>> issue.  Even when we bypass Squid it does work.  FWIW, it's possible that 
>> there is some other network problem coming into play here on our side.  
>> Though I did try to verify there's now blockages from the firewall, the 
>> networks, the traffic, etc.


>FTR; the critical detail in what Matus wrote was that the "wget" (or curl if you prefer) connection test **must** be performed
>  A) on the Squid machine,
>  B) using the same low-privileges user account that Squid runs with,
>  D) to the same server IP address Squid is trying to contact.
>
>That ensures the TCP connection privileges are as close to identical to what Squid is doing.
>
>Running it from another machine and/or user account may encounter different 
> firewall or routing behaviour that hides the real issue.
>
>If that test provides a successful TCP connection, *and* HTTP response message the next step is to
>
>
>Also, FYI; your custom change to the timestamp has somehow lost the 
> "duration" value, so I/we cannot tell if this was a probable TCP FIN/RST 
> (hint of firewall problem) or a SYN+ACK timeout (hint of routing problem).

>> I suppose from here I'll try to troubleshoot other things.
>>
>> Alternatively, do you think I should try to create an ACL which bypasses any filters or rules to that network?
>>
>> -----Original Message-----
>> From: squid-users <squid-users-bounces at lists.squid-cache.org> On
>> Behalf Of Matus UHLAR - fantomas
>> Sent: Thursday, October 10, 2024 3:21 AM
>> To: squid-users at lists.squid-cache.org
>> Subject: Re: [squid-users] Unable to access a device over port 4434
>>
>> Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.
>>
>>
>> On 09.10.24 19:59, Piana, Josh wrote:
>>> I'm running into an issue wherein, when using Squid proxy, I'm unable to get to one of our management devices from port 4434.
>>>
>>> I've already verified that this device is not blocking access from the proxy directly, and should be allowed to get to the access page.
>>>
>>> -          When reviewing the access logs, I can see that we're running into a generic 503 error
>>>
>>> -          When browsing to this page, it will attempt to load for about 30 seconds, and then fail
>>>
>>> -          The webpage response is a generic "The system returned: (110) Connection timed out"
>>>
>>> -          When we forgo the proxy, we can access it without an issue
>>>
>>> This device is located on a 172.0.0.0/8 internal network.
>>>
>>> -          Other devices which do NOT use this port are accessible
>>>
>>> -          Changing the access port is not an option (not up to me)
>>>
>>> Access Log entry:
>>> 09/Oct/2024:15:54:21 -0400.758 10.46.49.190 TCP_MISS/503 4448 GET
>>> http://0.0.0.172/.
>>> 0.0.27%2F&data=05%7C02%7Cjosh.piana%40hexcel.com%7C1b118e55c63c42ed3d
>>> e908dce99396c5%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C638642067
>>> 356048064%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzI
>>> iLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=JIO8AKoz7QPe1%2BDG
>>> Mza7mltOnSfvf2eHAEfubJx%2FLaY%3D&reserved=0
>>> .46.253%3A4434%2F&data=05%7C02%7Cjosh.piana%40hexcel.com%7Cad6b9a6df5
>>> da
>>> 44a2b73508dce8fc1971%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C638
>>> 64
>>> 1416681623895%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2l
>>> uM
>>> zIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=G%2FrqNK0o%2Bdk0
>>> ia
>>> zrnMhbyTvL0RmZAK27lulhMBhPMDU%3D&reserved=0 jpiana \
>>> HIER_DIRECT/172.27.46.253 text/html ERR_CONNECT_FAIL/WITH_SERVER
>>
>>
>> I guess the correct URL is:
>> http://172.0.0.2/
>> 7.46.253%3A4434%2Fjpiana&data=05%7C02%7Cjosh.piana%40hexcel.com%7C1b11
>> 8e55c63c42ed3de908dce99396c5%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C
>> 0%7C638642067356204330%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJ
>> QIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=nRShvvJ
>> uN7mqiILEdnHF6POw6I9kOZh0fX9QiO87bXY%3D&reserved=0
>>
>> have you tried running following directly from the squid machine?
>>
>> wget -Y off
>> http://172.0.0.2/
>> 7.46.253%3A4434%2Fjpiana&data=05%7C02%7Cjosh.piana%40hexcel.com%7C1b11
>> 8e55c63c42ed3de908dce99396c5%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C
>> 0%7C638642067356204330%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJ
>> QIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=nRShvvJ
>> uN7mqiILEdnHF6POw6I9kOZh0fX9QiO87bXY%3D&reserved=0
>>
>>
>> Because ERR_CONNECT_FAIL/WITH_SERVER and "Connection timed out" both say that the squid was unable to open connection to server.
>>
>> which is not a squid issue but network connection issue.

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
"Two words: Windows survives." - Craig Mundie, Microsoft senior strategist
"So does syphillis. Good thing we have penicillin." - Matthew Alton


From Josh.Piana at hexcel.com  Wed Oct 16 13:43:06 2024
From: Josh.Piana at hexcel.com (Piana, Josh)
Date: Wed, 16 Oct 2024 13:43:06 +0000
Subject: [squid-users] Unable to access a device over port 4434
In-Reply-To: <Zw-pt5UQjo8U3rr9@fantomas.sk>
References: <cc3be63a93bd478b8dee1e2b529540dc@hexcel.com>
 <ZweAUvyJWT-EkNOb@fantomas.sk> <73682cf79e0546b4b4c1faa35d034614@hexcel.com>
 <f650f52c-4bab-4ef0-93c0-04139efa6f79@treenet.co.nz>
 <2b1a9d31a33f460bae39c990467e3a59@hexcel.com> <Zw-pt5UQjo8U3rr9@fantomas.sk>
Message-ID: <b4d6d64d33554466853576912b371437@hexcel.com>

Hello Matus, 

I have the firewalld service disabled. I'm running RHEL 9.4, if that helps at all. 

Would a PAC file make a difference in the connection to the firewall? When comparing our old squidbox to the one I'm setting up, that's one of the outliers. 

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Matus UHLAR - fantomas
Sent: Wednesday, October 16, 2024 7:56 AM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Unable to access a device over port 4434

Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.


On 15.10.24 20:39, Piana, Josh wrote:
>Thank you for getting back to me and clarifying.
>
>I ran this command:
>#wget -Y off 172.27.46.253
>
>Response:
>--2024-10-15 16:36:15--  
>http://172.0.0.27/
>.46.253%2F&data=05%7C02%7Cjosh.piana%40hexcel.com%7Cbe640e58abb84d3ec7f
>708dcedd977d5%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C638646765494
>659492%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJB
>TiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=sCSTJ4aE8Rl8UXz64cq6m%2Fl
>1h0YgtzDXjRrTJj3nmZk%3D&reserved=0
>Connecting to 172.27.46.253:80... connected.
>HTTP request sent, awaiting response... 301 Moved Permanently
>Location: 
>https://172.0.0.2/
>7.46.253%2F&data=05%7C02%7Cjosh.piana%40hexcel.com%7Cbe640e58abb84d3ec7
>f708dcedd977d5%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C63864676549
>4815710%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJ
>BTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=WnX0ke65H2V2wvpUUClPa86W
>VcspT6kL3oLDWE4cGHk%3D&reserved=0 [following]
>--2024-10-15 16:36:15--  
>https://172.0.0.2/
>7.46.253%2F&data=05%7C02%7Cjosh.piana%40hexcel.com%7Cbe640e58abb84d3ec7
>f708dcedd977d5%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C63864676549
>4815710%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJ
>BTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=WnX0ke65H2V2wvpUUClPa86W
>VcspT6kL3oLDWE4cGHk%3D&reserved=0
>Connecting to 172.27.46.253:443... connected.
>ERROR: The certificate of '172.27.46.253' is not trusted.
>ERROR: The certificate of '172.27.46.253' doesn't have a known issuer.
>The certificate's owner does not match hostname '172.27.46.253'
>
>When I tried using port 4434, the wget command just times out.

this means that your squid machine is apparently blocked from connecting to remote host on port 4434.

Either that host blocked connections from your squid machine, or your squid machine (or any device on your network) has firewall rule that prevent this.

This it not a squid error.

Do you have local firewall on your squid machine?


>So with the errors given, would that stop us from connecting to it?
> Typically with sites with trust issues or certification issues, you 
>can  still bypass it.  We'd like to do the same here if applicable.

>On 11/10/24 07:21, Piana, Josh wrote:
>> I apologize, I was unable to read any of the links that were 
>> responded with because our environment appended the "
>> eur02.safelinks.protection.outlook.com..." Outlook protection.  Did 
>> you see that as well on your side?  When I did click the links to 
>> view them is just stated as failed.
>>
>> What I gather from what you said was that, it's not likely Squid is 
>> the issue.  Even when we bypass Squid it does work.  FWIW, it's 
>> possible that there is some other network problem coming into play here on our side.
>> Though I did try to verify there's now blockages from the firewall, 
>> the networks, the traffic, etc.


>FTR; the critical detail in what Matus wrote was that the "wget" (or 
>curl if you prefer) connection test **must** be performed
>  A) on the Squid machine,
>  B) using the same low-privileges user account that Squid runs with,
>  D) to the same server IP address Squid is trying to contact.
>
>That ensures the TCP connection privileges are as close to identical to what Squid is doing.
>
>Running it from another machine and/or user account may encounter 
>different  firewall or routing behaviour that hides the real issue.
>
>If that test provides a successful TCP connection, *and* HTTP response 
>message the next step is to
>
>
>Also, FYI; your custom change to the timestamp has somehow lost the  
>"duration" value, so I/we cannot tell if this was a probable TCP 
>FIN/RST  (hint of firewall problem) or a SYN+ACK timeout (hint of routing problem).

>> I suppose from here I'll try to troubleshoot other things.
>>
>> Alternatively, do you think I should try to create an ACL which bypasses any filters or rules to that network?
>>
>> -----Original Message-----
>> From: squid-users <squid-users-bounces at lists.squid-cache.org> On 
>> Behalf Of Matus UHLAR - fantomas
>> Sent: Thursday, October 10, 2024 3:21 AM
>> To: squid-users at lists.squid-cache.org
>> Subject: Re: [squid-users] Unable to access a device over port 4434
>>
>> Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.
>>
>>
>> On 09.10.24 19:59, Piana, Josh wrote:
>>> I'm running into an issue wherein, when using Squid proxy, I'm unable to get to one of our management devices from port 4434.
>>>
>>> I've already verified that this device is not blocking access from the proxy directly, and should be allowed to get to the access page.
>>>
>>> -          When reviewing the access logs, I can see that we're running into a generic 503 error
>>>
>>> -          When browsing to this page, it will attempt to load for about 30 seconds, and then fail
>>>
>>> -          The webpage response is a generic "The system returned: (110) Connection timed out"
>>>
>>> -          When we forgo the proxy, we can access it without an issue
>>>
>>> This device is located on a 172.0.0.0/8 internal network.
>>>
>>> -          Other devices which do NOT use this port are accessible
>>>
>>> -          Changing the access port is not an option (not up to me)
>>>
>>> Access Log entry:
>>> 09/Oct/2024:15:54:21 -0400.758 10.46.49.190 TCP_MISS/503 4448 GET 
>>> http://0.0.0.172/.
>>> 0.0.27%2F&data=05%7C02%7Cjosh.piana%40hexcel.com%7C1b118e55c63c42ed3
>>> d
>>> e908dce99396c5%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C63864206
>>> 7 
>>> 356048064%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMz
>>> I 
>>> iLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=JIO8AKoz7QPe1%2BD
>>> G
>>> Mza7mltOnSfvf2eHAEfubJx%2FLaY%3D&reserved=0
>>> .46.253%3A4434%2F&data=05%7C02%7Cjosh.piana%40hexcel.com%7Cad6b9a6df
>>> 5
>>> da
>>> 44a2b73508dce8fc1971%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C63
>>> 8
>>> 64
>>> 1416681623895%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2
>>> l
>>> uM
>>> zIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=G%2FrqNK0o%2Bdk
>>> 0
>>> ia
>>> zrnMhbyTvL0RmZAK27lulhMBhPMDU%3D&reserved=0 jpiana \
>>> HIER_DIRECT/172.27.46.253 text/html ERR_CONNECT_FAIL/WITH_SERVER
>>
>>
>> I guess the correct URL is:
>> http://0.0.0.172/.
>> 0.0.2%2F&data=05%7C02%7Cjosh.piana%40hexcel.com%7Cbe640e58abb84d3ec7f
>> 708dcedd977d5%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C6386467654
>> 94971970%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIi
>> LCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=VCIibDWPw4CffgvrVmn
>> JBf3lzGIYjpRxRq7%2Bbai4dCM%3D&reserved=0
>> 7.46.253%3A4434%2Fjpiana&data=05%7C02%7Cjosh.piana%40hexcel.com%7C1b1
>> 1 
>> 8e55c63c42ed3de908dce99396c5%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7
>> C 
>> 0%7C638642067356204330%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLC
>> J 
>> QIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=nRShvv
>> J
>> uN7mqiILEdnHF6POw6I9kOZh0fX9QiO87bXY%3D&reserved=0
>>
>> have you tried running following directly from the squid machine?
>>
>> wget -Y off
>> http://0.0.0.172/.
>> 0.0.2%2F&data=05%7C02%7Cjosh.piana%40hexcel.com%7Cbe640e58abb84d3ec7f
>> 708dcedd977d5%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C6386467654
>> 94971970%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIi
>> LCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=VCIibDWPw4CffgvrVmn
>> JBf3lzGIYjpRxRq7%2Bbai4dCM%3D&reserved=0
>> 7.46.253%3A4434%2Fjpiana&data=05%7C02%7Cjosh.piana%40hexcel.com%7C1b1
>> 1 
>> 8e55c63c42ed3de908dce99396c5%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7
>> C 
>> 0%7C638642067356204330%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLC
>> J 
>> QIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=nRShvv
>> J
>> uN7mqiILEdnHF6POw6I9kOZh0fX9QiO87bXY%3D&reserved=0
>>
>>
>> Because ERR_CONNECT_FAIL/WITH_SERVER and "Connection timed out" both say that the squid was unable to open connection to server.
>>
>> which is not a squid issue but network connection issue.

--
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
"Two words: Windows survives." - Craig Mundie, Microsoft senior strategist "So does syphillis. Good thing we have penicillin." - Matthew Alton _______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
https://lists.squid-cache.org/listinfo/squid-users


From uhlar at fantomas.sk  Wed Oct 16 14:21:56 2024
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Wed, 16 Oct 2024 16:21:56 +0200
Subject: [squid-users] Unable to access a device over port 4434
In-Reply-To: <b4d6d64d33554466853576912b371437@hexcel.com>
References: <cc3be63a93bd478b8dee1e2b529540dc@hexcel.com>
 <ZweAUvyJWT-EkNOb@fantomas.sk>
 <73682cf79e0546b4b4c1faa35d034614@hexcel.com>
 <f650f52c-4bab-4ef0-93c0-04139efa6f79@treenet.co.nz>
 <2b1a9d31a33f460bae39c990467e3a59@hexcel.com>
 <Zw-pt5UQjo8U3rr9@fantomas.sk>
 <b4d6d64d33554466853576912b371437@hexcel.com>
Message-ID: <Zw_MBIExnUM7c02X@fantomas.sk>

On 16.10.24 13:43, Piana, Josh wrote:
>I have the firewalld service disabled. I'm running RHEL 9.4, if that helps at all.

try running:
	iptables -L -n -v
	iptables -t nat -L -n -v
or
	nft list tables
	nft list table ip filter
	
to see if you have any rules that block outgoing traffic.

Perhaps you can check

sysctl net.ipv4.tcp_ecn

and set it to '0' if it helps.

>Would a PAC file make a difference in the connection to the firewall? When comparing our old squidbox to the one I'm setting up, that's one of the outliers.
>
>-----Original Message-----
>From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Matus UHLAR - fantomas
>Sent: Wednesday, October 16, 2024 7:56 AM
>To: squid-users at lists.squid-cache.org
>Subject: Re: [squid-users] Unable to access a device over port 4434
>
>Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.
>
>
>On 15.10.24 20:39, Piana, Josh wrote:
>>Thank you for getting back to me and clarifying.
>>
>>I ran this command:
>>#wget -Y off 172.27.46.253
>>
>>Response:
>>--2024-10-15 16:36:15--
>>http://172.0.0.27/
>>.46.253%2F&data=05%7C02%7Cjosh.piana%40hexcel.com%7Cbe640e58abb84d3ec7f
>>708dcedd977d5%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C638646765494
>>659492%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJB
>>TiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=sCSTJ4aE8Rl8UXz64cq6m%2Fl
>>1h0YgtzDXjRrTJj3nmZk%3D&reserved=0
>>Connecting to 172.27.46.253:80... connected.
>>HTTP request sent, awaiting response... 301 Moved Permanently
>>Location:
>>https://172.0.0.2/
>>7.46.253%2F&data=05%7C02%7Cjosh.piana%40hexcel.com%7Cbe640e58abb84d3ec7
>>f708dcedd977d5%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C63864676549
>>4815710%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJ
>>BTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=WnX0ke65H2V2wvpUUClPa86W
>>VcspT6kL3oLDWE4cGHk%3D&reserved=0 [following]
>>--2024-10-15 16:36:15--
>>https://172.0.0.2/
>>7.46.253%2F&data=05%7C02%7Cjosh.piana%40hexcel.com%7Cbe640e58abb84d3ec7
>>f708dcedd977d5%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C63864676549
>>4815710%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJ
>>BTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=WnX0ke65H2V2wvpUUClPa86W
>>VcspT6kL3oLDWE4cGHk%3D&reserved=0
>>Connecting to 172.27.46.253:443... connected.
>>ERROR: The certificate of '172.27.46.253' is not trusted.
>>ERROR: The certificate of '172.27.46.253' doesn't have a known issuer.
>>The certificate's owner does not match hostname '172.27.46.253'
>>
>>When I tried using port 4434, the wget command just times out.
>
>this means that your squid machine is apparently blocked from connecting to remote host on port 4434.
>
>Either that host blocked connections from your squid machine, or your squid machine (or any device on your network) has firewall rule that prevent this.
>
>This it not a squid error.
>
>Do you have local firewall on your squid machine?
>
>
>>So with the errors given, would that stop us from connecting to it?
>> Typically with sites with trust issues or certification issues, you
>>can  still bypass it.  We'd like to do the same here if applicable.
>
>>On 11/10/24 07:21, Piana, Josh wrote:
>>> I apologize, I was unable to read any of the links that were
>>> responded with because our environment appended the "
>>> eur02.safelinks.protection.outlook.com..." Outlook protection.  Did
>>> you see that as well on your side?  When I did click the links to
>>> view them is just stated as failed.
>>>
>>> What I gather from what you said was that, it's not likely Squid is
>>> the issue.  Even when we bypass Squid it does work.  FWIW, it's
>>> possible that there is some other network problem coming into play here on our side.
>>> Though I did try to verify there's now blockages from the firewall,
>>> the networks, the traffic, etc.
>
>
>>FTR; the critical detail in what Matus wrote was that the "wget" (or
>>curl if you prefer) connection test **must** be performed
>>  A) on the Squid machine,
>>  B) using the same low-privileges user account that Squid runs with,
>>  D) to the same server IP address Squid is trying to contact.
>>
>>That ensures the TCP connection privileges are as close to identical to what Squid is doing.
>>
>>Running it from another machine and/or user account may encounter
>>different  firewall or routing behaviour that hides the real issue.
>>
>>If that test provides a successful TCP connection, *and* HTTP response
>>message the next step is to
>>
>>
>>Also, FYI; your custom change to the timestamp has somehow lost the
>>"duration" value, so I/we cannot tell if this was a probable TCP
>>FIN/RST  (hint of firewall problem) or a SYN+ACK timeout (hint of routing problem).
>
>>> I suppose from here I'll try to troubleshoot other things.
>>>
>>> Alternatively, do you think I should try to create an ACL which bypasses any filters or rules to that network?
>>>
>>> -----Original Message-----
>>> From: squid-users <squid-users-bounces at lists.squid-cache.org> On
>>> Behalf Of Matus UHLAR - fantomas
>>> Sent: Thursday, October 10, 2024 3:21 AM
>>> To: squid-users at lists.squid-cache.org
>>> Subject: Re: [squid-users] Unable to access a device over port 4434
>>>
>>> Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.
>>>
>>>
>>> On 09.10.24 19:59, Piana, Josh wrote:
>>>> I'm running into an issue wherein, when using Squid proxy, I'm unable to get to one of our management devices from port 4434.
>>>>
>>>> I've already verified that this device is not blocking access from the proxy directly, and should be allowed to get to the access page.
>>>>
>>>> -          When reviewing the access logs, I can see that we're running into a generic 503 error
>>>>
>>>> -          When browsing to this page, it will attempt to load for about 30 seconds, and then fail
>>>>
>>>> -          The webpage response is a generic "The system returned: (110) Connection timed out"
>>>>
>>>> -          When we forgo the proxy, we can access it without an issue
>>>>
>>>> This device is located on a 172.0.0.0/8 internal network.
>>>>
>>>> -          Other devices which do NOT use this port are accessible
>>>>
>>>> -          Changing the access port is not an option (not up to me)
>>>>
>>>> Access Log entry:
>>>> 09/Oct/2024:15:54:21 -0400.758 10.46.49.190 TCP_MISS/503 4448 GET
>>>> http://0.0.0.172/.
>>>> 0.0.27%2F&data=05%7C02%7Cjosh.piana%40hexcel.com%7C1b118e55c63c42ed3
>>>> d
>>>> e908dce99396c5%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C63864206
>>>> 7
>>>> 356048064%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMz
>>>> I
>>>> iLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=JIO8AKoz7QPe1%2BD
>>>> G
>>>> Mza7mltOnSfvf2eHAEfubJx%2FLaY%3D&reserved=0
>>>> .46.253%3A4434%2F&data=05%7C02%7Cjosh.piana%40hexcel.com%7Cad6b9a6df
>>>> 5
>>>> da
>>>> 44a2b73508dce8fc1971%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C63
>>>> 8
>>>> 64
>>>> 1416681623895%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2
>>>> l
>>>> uM
>>>> zIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=G%2FrqNK0o%2Bdk
>>>> 0
>>>> ia
>>>> zrnMhbyTvL0RmZAK27lulhMBhPMDU%3D&reserved=0 jpiana \
>>>> HIER_DIRECT/172.27.46.253 text/html ERR_CONNECT_FAIL/WITH_SERVER
>>>
>>>
>>> I guess the correct URL is:
>>> http://0.0.0.172/.
>>> 0.0.2%2F&data=05%7C02%7Cjosh.piana%40hexcel.com%7Cbe640e58abb84d3ec7f
>>> 708dcedd977d5%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C6386467654
>>> 94971970%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIi
>>> LCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=VCIibDWPw4CffgvrVmn
>>> JBf3lzGIYjpRxRq7%2Bbai4dCM%3D&reserved=0
>>> 7.46.253%3A4434%2Fjpiana&data=05%7C02%7Cjosh.piana%40hexcel.com%7C1b1
>>> 1
>>> 8e55c63c42ed3de908dce99396c5%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7
>>> C
>>> 0%7C638642067356204330%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLC
>>> J
>>> QIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=nRShvv
>>> J
>>> uN7mqiILEdnHF6POw6I9kOZh0fX9QiO87bXY%3D&reserved=0
>>>
>>> have you tried running following directly from the squid machine?
>>>
>>> wget -Y off
>>> http://0.0.0.172/.
>>> 0.0.2%2F&data=05%7C02%7Cjosh.piana%40hexcel.com%7Cbe640e58abb84d3ec7f
>>> 708dcedd977d5%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C6386467654
>>> 94971970%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIi
>>> LCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=VCIibDWPw4CffgvrVmn
>>> JBf3lzGIYjpRxRq7%2Bbai4dCM%3D&reserved=0
>>> 7.46.253%3A4434%2Fjpiana&data=05%7C02%7Cjosh.piana%40hexcel.com%7C1b1
>>> 1
>>> 8e55c63c42ed3de908dce99396c5%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7
>>> C
>>> 0%7C638642067356204330%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLC
>>> J
>>> QIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=nRShvv
>>> J
>>> uN7mqiILEdnHF6POw6I9kOZh0fX9QiO87bXY%3D&reserved=0
>>>
>>>
>>> Because ERR_CONNECT_FAIL/WITH_SERVER and "Connection timed out" both say that the squid was unable to open connection to server.
>>>
>>> which is not a squid issue but network connection issue.
>
>--
>Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
>Warning: I wish NOT to receive e-mail advertising to this address.
>Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
>"Two words: Windows survives." - Craig Mundie, Microsoft senior strategist "So does syphillis. Good thing we have penicillin." - Matthew Alton _______________________________________________
>squid-users mailing list
>squid-users at lists.squid-cache.org
>https://lists.squid-cache.org/listinfo/squid-users
>_______________________________________________
>squid-users mailing list
>squid-users at lists.squid-cache.org
>https://lists.squid-cache.org/listinfo/squid-users

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Your mouse has moved. Windows NT will now restart for changes to take
to take effect. [OK]


From Josh.Piana at hexcel.com  Wed Oct 16 16:10:32 2024
From: Josh.Piana at hexcel.com (Piana, Josh)
Date: Wed, 16 Oct 2024 16:10:32 +0000
Subject: [squid-users] Unable to access a device over port 4434
In-Reply-To: <Zw_MBIExnUM7c02X@fantomas.sk>
References: <cc3be63a93bd478b8dee1e2b529540dc@hexcel.com>
 <ZweAUvyJWT-EkNOb@fantomas.sk> <73682cf79e0546b4b4c1faa35d034614@hexcel.com>
 <f650f52c-4bab-4ef0-93c0-04139efa6f79@treenet.co.nz>
 <2b1a9d31a33f460bae39c990467e3a59@hexcel.com> <Zw-pt5UQjo8U3rr9@fantomas.sk>
 <b4d6d64d33554466853576912b371437@hexcel.com> <Zw_MBIExnUM7c02X@fantomas.sk>
Message-ID: <60dad2ee1466406aa4670483fdeb84e2@hexcel.com>

Hello, 

After running the below commands, I did restart squid and tested again. No luck. 

Here's the outputs:

# iptables -L -n -v
Chain INPUT (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination

Chain FORWARD (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination

Chain OUTPUT (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination

# iptables -t nat -L -n -v
Chain PREROUTING (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination

Chain INPUT (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination

Chain OUTPUT (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination

Chain POSTROUTING (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination

# nft list tables
No output 

# nft list table ip filter
Error: No such file or directory
list table ip filter
              ^^^^^^
# they also recommended changing sysctl "net.ipv4.tcp_ecn" to '0'
# sysctl net.ipv4.tcp_ecn=0

# confirm 
# sysctl net.ipv4.tcp_ecn
net.ipv4.tcp_ecn = 0

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Matus UHLAR - fantomas
Sent: Wednesday, October 16, 2024 10:22 AM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Unable to access a device over port 4434

Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.


On 16.10.24 13:43, Piana, Josh wrote:
>I have the firewalld service disabled. I'm running RHEL 9.4, if that helps at all.

try running:
        iptables -L -n -v
        iptables -t nat -L -n -v
or
        nft list tables
        nft list table ip filter

to see if you have any rules that block outgoing traffic.

Perhaps you can check

sysctl net.ipv4.tcp_ecn

and set it to '0' if it helps.

>Would a PAC file make a difference in the connection to the firewall? When comparing our old squidbox to the one I'm setting up, that's one of the outliers.
>
>-----Original Message-----
>From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf 
>Of Matus UHLAR - fantomas
>Sent: Wednesday, October 16, 2024 7:56 AM
>To: squid-users at lists.squid-cache.org
>Subject: Re: [squid-users] Unable to access a device over port 4434
>
>Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.
>
>
>On 15.10.24 20:39, Piana, Josh wrote:
>>Thank you for getting back to me and clarifying.
>>
>>I ran this command:
>>#wget -Y off 172.27.46.253
>>
>>Response:
>>--2024-10-15 16:36:15--
>>http://172.0.0.0/
>>.0.27%2F&data=05%7C02%7Cjosh.piana%40hexcel.com%7Cd2249de85af44bb88a54
>>08dcedede8ac%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C638646853309
>>547280%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJ
>>BTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=uWbfuyJ3g2FpvW5zYMENOxT
>>oBtJ1MqGcfTgIcXqGEio%3D&reserved=0
>>.46.253%2F&data=05%7C02%7Cjosh.piana%40hexcel.com%7Cbe640e58abb84d3ec7
>>f
>>708dcedd977d5%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C63864676549
>>4 
>>659492%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJ
>>B 
>>TiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=sCSTJ4aE8Rl8UXz64cq6m%2F
>>l
>>1h0YgtzDXjRrTJj3nmZk%3D&reserved=0
>>Connecting to 172.27.46.253:80... connected.
>>HTTP request sent, awaiting response... 301 Moved Permanently
>>Location:
>>https://0.0.0.172/.
>>0.0.2%2F&data=05%7C02%7Cjosh.piana%40hexcel.com%7Cd2249de85af44bb88a54
>>08dcedede8ac%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C638646853309
>>547280%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJ
>>BTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=oEZ%2BRcksjEMiCcf6pyLHV
>>f3Jf6MfA164yIiQL3Q9vcg%3D&reserved=0
>>7.46.253%2F&data=05%7C02%7Cjosh.piana%40hexcel.com%7Cbe640e58abb84d3ec
>>7
>>f708dcedd977d5%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C6386467654
>>9 
>>4815710%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLC
>>J 
>>BTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=WnX0ke65H2V2wvpUUClPa86
>>W
>>VcspT6kL3oLDWE4cGHk%3D&reserved=0 [following]
>>--2024-10-15 16:36:15--
>>https://0.0.0.172/.
>>0.0.2%2F&data=05%7C02%7Cjosh.piana%40hexcel.com%7Cd2249de85af44bb88a54
>>08dcedede8ac%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C638646853309
>>547280%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJ
>>BTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=oEZ%2BRcksjEMiCcf6pyLHV
>>f3Jf6MfA164yIiQL3Q9vcg%3D&reserved=0
>>7.46.253%2F&data=05%7C02%7Cjosh.piana%40hexcel.com%7Cbe640e58abb84d3ec
>>7
>>f708dcedd977d5%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C6386467654
>>9 
>>4815710%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLC
>>J 
>>BTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=WnX0ke65H2V2wvpUUClPa86
>>W
>>VcspT6kL3oLDWE4cGHk%3D&reserved=0
>>Connecting to 172.27.46.253:443... connected.
>>ERROR: The certificate of '172.27.46.253' is not trusted.
>>ERROR: The certificate of '172.27.46.253' doesn't have a known issuer.
>>The certificate's owner does not match hostname '172.27.46.253'
>>
>>When I tried using port 4434, the wget command just times out.
>
>this means that your squid machine is apparently blocked from connecting to remote host on port 4434.
>
>Either that host blocked connections from your squid machine, or your squid machine (or any device on your network) has firewall rule that prevent this.
>
>This it not a squid error.
>
>Do you have local firewall on your squid machine?
>
>
>>So with the errors given, would that stop us from connecting to it?
>> Typically with sites with trust issues or certification issues, you 
>>can  still bypass it.  We'd like to do the same here if applicable.
>
>>On 11/10/24 07:21, Piana, Josh wrote:
>>> I apologize, I was unable to read any of the links that were 
>>> responded with because our environment appended the "
>>> eur02.safelinks.protection.outlook.com..." Outlook protection.  Did 
>>> you see that as well on your side?  When I did click the links to 
>>> view them is just stated as failed.
>>>
>>> What I gather from what you said was that, it's not likely Squid is 
>>> the issue.  Even when we bypass Squid it does work.  FWIW, it's 
>>> possible that there is some other network problem coming into play here on our side.
>>> Though I did try to verify there's now blockages from the firewall, 
>>> the networks, the traffic, etc.
>
>
>>FTR; the critical detail in what Matus wrote was that the "wget" (or 
>>curl if you prefer) connection test **must** be performed
>>  A) on the Squid machine,
>>  B) using the same low-privileges user account that Squid runs with,
>>  D) to the same server IP address Squid is trying to contact.
>>
>>That ensures the TCP connection privileges are as close to identical to what Squid is doing.
>>
>>Running it from another machine and/or user account may encounter 
>>different  firewall or routing behaviour that hides the real issue.
>>
>>If that test provides a successful TCP connection, *and* HTTP response 
>>message the next step is to
>>
>>
>>Also, FYI; your custom change to the timestamp has somehow lost the 
>>"duration" value, so I/we cannot tell if this was a probable TCP 
>>FIN/RST  (hint of firewall problem) or a SYN+ACK timeout (hint of routing problem).
>
>>> I suppose from here I'll try to troubleshoot other things.
>>>
>>> Alternatively, do you think I should try to create an ACL which bypasses any filters or rules to that network?
>>>
>>> -----Original Message-----
>>> From: squid-users <squid-users-bounces at lists.squid-cache.org> On 
>>> Behalf Of Matus UHLAR - fantomas
>>> Sent: Thursday, October 10, 2024 3:21 AM
>>> To: squid-users at lists.squid-cache.org
>>> Subject: Re: [squid-users] Unable to access a device over port 4434
>>>
>>> Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.
>>>
>>>
>>> On 09.10.24 19:59, Piana, Josh wrote:
>>>> I'm running into an issue wherein, when using Squid proxy, I'm unable to get to one of our management devices from port 4434.
>>>>
>>>> I've already verified that this device is not blocking access from the proxy directly, and should be allowed to get to the access page.
>>>>
>>>> -          When reviewing the access logs, I can see that we're running into a generic 503 error
>>>>
>>>> -          When browsing to this page, it will attempt to load for about 30 seconds, and then fail
>>>>
>>>> -          The webpage response is a generic "The system returned: (110) Connection timed out"
>>>>
>>>> -          When we forgo the proxy, we can access it without an issue
>>>>
>>>> This device is located on a 172.0.0.0/8 internal network.
>>>>
>>>> -          Other devices which do NOT use this port are accessible
>>>>
>>>> -          Changing the access port is not an option (not up to me)
>>>>
>>>> Access Log entry:
>>>> 09/Oct/2024:15:54:21 -0400.758 10.46.49.190 TCP_MISS/503 4448 GET 
>>>> http://0.0.0.172/.
>>>> 0.0.27%2F&data=05%7C02%7Cjosh.piana%40hexcel.com%7C1b118e55c63c42ed
>>>> 3
>>>> d
>>>> e908dce99396c5%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C6386420
>>>> 6
>>>> 7
>>>> 356048064%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luM
>>>> z
>>>> I
>>>> iLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=JIO8AKoz7QPe1%2B
>>>> D
>>>> G
>>>> Mza7mltOnSfvf2eHAEfubJx%2FLaY%3D&reserved=0
>>>> .46.253%3A4434%2F&data=05%7C02%7Cjosh.piana%40hexcel.com%7Cad6b9a6d
>>>> f
>>>> 5
>>>> da
>>>> 44a2b73508dce8fc1971%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C6
>>>> 3
>>>> 8
>>>> 64
>>>> 1416681623895%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV
>>>> 2
>>>> l
>>>> uM
>>>> zIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=G%2FrqNK0o%2Bd
>>>> k
>>>> 0
>>>> ia
>>>> zrnMhbyTvL0RmZAK27lulhMBhPMDU%3D&reserved=0 jpiana \
>>>> HIER_DIRECT/172.27.46.253 text/html ERR_CONNECT_FAIL/WITH_SERVER
>>>
>>>
>>> I guess the correct URL is:
>>> http://0.0.0.172/.
>>> 0.0.2%2F&data=05%7C02%7Cjosh.piana%40hexcel.com%7Cbe640e58abb84d3ec7
>>> f
>>> 708dcedd977d5%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C638646765
>>> 4 
>>> 94971970%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzI
>>> i 
>>> LCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=VCIibDWPw4CffgvrVm
>>> n
>>> JBf3lzGIYjpRxRq7%2Bbai4dCM%3D&reserved=0
>>> 7.46.253%3A4434%2Fjpiana&data=05%7C02%7Cjosh.piana%40hexcel.com%7C1b
>>> 1
>>> 1
>>> 8e55c63c42ed3de908dce99396c5%7C4248050df19546d5ac9c0c7c52b04cae%7C0%
>>> 7
>>> C
>>> 0%7C638642067356204330%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiL
>>> C
>>> J
>>> QIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=nRShv
>>> v
>>> J
>>> uN7mqiILEdnHF6POw6I9kOZh0fX9QiO87bXY%3D&reserved=0
>>>
>>> have you tried running following directly from the squid machine?
>>>
>>> wget -Y off
>>> http://0.0.0.172/.
>>> 0.0.2%2F&data=05%7C02%7Cjosh.piana%40hexcel.com%7Cbe640e58abb84d3ec7
>>> f
>>> 708dcedd977d5%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C638646765
>>> 4 
>>> 94971970%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzI
>>> i 
>>> LCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=VCIibDWPw4CffgvrVm
>>> n
>>> JBf3lzGIYjpRxRq7%2Bbai4dCM%3D&reserved=0
>>> 7.46.253%3A4434%2Fjpiana&data=05%7C02%7Cjosh.piana%40hexcel.com%7C1b
>>> 1
>>> 1
>>> 8e55c63c42ed3de908dce99396c5%7C4248050df19546d5ac9c0c7c52b04cae%7C0%
>>> 7
>>> C
>>> 0%7C638642067356204330%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiL
>>> C
>>> J
>>> QIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=nRShv
>>> v
>>> J
>>> uN7mqiILEdnHF6POw6I9kOZh0fX9QiO87bXY%3D&reserved=0
>>>
>>>
>>> Because ERR_CONNECT_FAIL/WITH_SERVER and "Connection timed out" both say that the squid was unable to open connection to server.
>>>
>>> which is not a squid issue but network connection issue.
>
>--
>Matus UHLAR - fantomas, uhlar at fantomas.sk ; 
>http://www.fa/
>ntomas.sk%2F&data=05%7C02%7Cjosh.piana%40hexcel.com%7Cd2249de85af44bb88
>a5408dcedede8ac%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C6386468533
>09703536%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLC
>JBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=T19avBdAJ6vkjjhR6dd18%2
>FML8ACfEgRrAqYl57NrCPQ%3D&reserved=0
>Warning: I wish NOT to receive e-mail advertising to this address.
>Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
>"Two words: Windows survives." - Craig Mundie, Microsoft senior 
>strategist "So does syphillis. Good thing we have penicillin." - 
>Matthew Alton _______________________________________________
>squid-users mailing list
>squid-users at lists.squid-cache.org
>https://lists/
>.squid-cache.org%2Flistinfo%2Fsquid-users&data=05%7C02%7Cjosh.piana%40h
>excel.com%7Cd2249de85af44bb88a5408dcedede8ac%7C4248050df19546d5ac9c0c7c
>52b04cae%7C0%7C0%7C638646853309703536%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiM
>C4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&
>sdata=vCYNM0Z%2F%2F63m%2FkEbw2MB76%2FLD4K8EjEDYcX8R7qubSU%3D&reserved=0
>_______________________________________________
>squid-users mailing list
>squid-users at lists.squid-cache.org
>https://lists/
>.squid-cache.org%2Flistinfo%2Fsquid-users&data=05%7C02%7Cjosh.piana%40h
>excel.com%7Cd2249de85af44bb88a5408dcedede8ac%7C4248050df19546d5ac9c0c7c
>52b04cae%7C0%7C0%7C638646853309703536%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiM
>C4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&
>sdata=vCYNM0Z%2F%2F63m%2FkEbw2MB76%2FLD4K8EjEDYcX8R7qubSU%3D&reserved=0

--
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Your mouse has moved. Windows NT will now restart for changes to take to take effect. [OK] _______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
https://lists.squid-cache.org/listinfo/squid-users


From uhlar at fantomas.sk  Wed Oct 16 18:00:11 2024
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Wed, 16 Oct 2024 20:00:11 +0200
Subject: [squid-users] Unable to access a device over port 4434
In-Reply-To: <60dad2ee1466406aa4670483fdeb84e2@hexcel.com>
References: <cc3be63a93bd478b8dee1e2b529540dc@hexcel.com>
 <ZweAUvyJWT-EkNOb@fantomas.sk>
 <73682cf79e0546b4b4c1faa35d034614@hexcel.com>
 <f650f52c-4bab-4ef0-93c0-04139efa6f79@treenet.co.nz>
 <2b1a9d31a33f460bae39c990467e3a59@hexcel.com>
 <Zw-pt5UQjo8U3rr9@fantomas.sk>
 <b4d6d64d33554466853576912b371437@hexcel.com>
 <Zw_MBIExnUM7c02X@fantomas.sk>
 <60dad2ee1466406aa4670483fdeb84e2@hexcel.com>
Message-ID: <Zw__K0IL7tE_3xJb@fantomas.sk>

On 16.10.24 16:10, Piana, Josh wrote:
>After running the below commands, I did restart squid and tested again. No luck.
>
>Here's the outputs:
>
># iptables -L -n -v

>Chain OUTPUT (policy ACCEPT 0 packets, 0 bytes)
> pkts bytes target     prot opt in     out     source               destination

># iptables -t nat -L -n -v
>Chain OUTPUT (policy ACCEPT 0 packets, 0 bytes)
> pkts bytes target     prot opt in     out     source               destination

># nft list tables
>No output
>
># nft list table ip filter
>Error: No such file or directory
>list table ip filter

Sorry, should've been "nft list table filter" but it really looks like you
have completely no firewall locally.

Do you have any firewall in front of your server?
Can you change your quid server's IP address you use to connect to internet?



># they also recommended changing sysctl "net.ipv4.tcp_ecn" to '0'
># sysctl net.ipv4.tcp_ecn=0
>
># confirm
># sysctl net.ipv4.tcp_ecn
>net.ipv4.tcp_ecn = 0
-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Linux is like a teepee: no Windows, no Gates and an apache inside...


From Josh.Piana at hexcel.com  Wed Oct 16 20:03:30 2024
From: Josh.Piana at hexcel.com (Piana, Josh)
Date: Wed, 16 Oct 2024 20:03:30 +0000
Subject: [squid-users] Unable to access a device over port 4434
In-Reply-To: <Zw__K0IL7tE_3xJb@fantomas.sk>
References: <cc3be63a93bd478b8dee1e2b529540dc@hexcel.com>
 <ZweAUvyJWT-EkNOb@fantomas.sk> <73682cf79e0546b4b4c1faa35d034614@hexcel.com>
 <f650f52c-4bab-4ef0-93c0-04139efa6f79@treenet.co.nz>
 <2b1a9d31a33f460bae39c990467e3a59@hexcel.com> <Zw-pt5UQjo8U3rr9@fantomas.sk>
 <b4d6d64d33554466853576912b371437@hexcel.com> <Zw_MBIExnUM7c02X@fantomas.sk>
 <60dad2ee1466406aa4670483fdeb84e2@hexcel.com> <Zw__K0IL7tE_3xJb@fantomas.sk>
Message-ID: <a7f8f86b1b0c4cfb812909bbcf64fdbd@hexcel.com>

We do have a firewall in front of the Squid server. 

We're using a Checkpoint firewall but I've been told, a few times, that the firewall is not blocking traffic coming from the proxy. 

Squid's IP address is statically set and connected to one of our VLANS which hosts the majority of our servers. We're not likely to change that. 

We have the Web Proxy at 10.46.11.69 and the firewall listens for port 8080. 

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Matus UHLAR - fantomas
Sent: Wednesday, October 16, 2024 2:00 PM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Unable to access a device over port 4434

Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.


On 16.10.24 16:10, Piana, Josh wrote:
>After running the below commands, I did restart squid and tested again. No luck.
>
>Here's the outputs:
>
># iptables -L -n -v

>Chain OUTPUT (policy ACCEPT 0 packets, 0 bytes)
> pkts bytes target     prot opt in     out     source               destination

># iptables -t nat -L -n -v
>Chain OUTPUT (policy ACCEPT 0 packets, 0 bytes)
> pkts bytes target     prot opt in     out     source               destination

># nft list tables
>No output
>
># nft list table ip filter
>Error: No such file or directory
>list table ip filter

Sorry, should've been "nft list table filter" but it really looks like you have completely no firewall locally.

Do you have any firewall in front of your server?
Can you change your quid server's IP address you use to connect to internet?



># they also recommended changing sysctl "net.ipv4.tcp_ecn" to '0'
># sysctl net.ipv4.tcp_ecn=0
>
># confirm
># sysctl net.ipv4.tcp_ecn
>net.ipv4.tcp_ecn = 0
--
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Linux is like a teepee: no Windows, no Gates and an apache inside...
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
https://lists.squid-cache.org/listinfo/squid-users


From squid3 at treenet.co.nz  Thu Oct 17 03:45:28 2024
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 17 Oct 2024 16:45:28 +1300
Subject: [squid-users] Unable to access a device over port 4434
In-Reply-To: <2b1a9d31a33f460bae39c990467e3a59@hexcel.com>
References: <cc3be63a93bd478b8dee1e2b529540dc@hexcel.com>
 <ZweAUvyJWT-EkNOb@fantomas.sk> <73682cf79e0546b4b4c1faa35d034614@hexcel.com>
 <f650f52c-4bab-4ef0-93c0-04139efa6f79@treenet.co.nz>
 <2b1a9d31a33f460bae39c990467e3a59@hexcel.com>
Message-ID: <62587d0c-60a0-4ef4-a6ae-8b91f28665fe@treenet.co.nz>

On 16/10/24 09:39, Piana, Josh wrote:
> Amos,
> 
> Thank you for getting back to me and clarifying.
> 
> I ran this command:
> #wget -Y off 172.27.46.253
> 
> Response:
> --2024-10-15 16:36:15--  http://172.27.46.253/
> Connecting to 172.27.46.253:80... connected.
> HTTP request sent, awaiting response... 301 Moved Permanently
> Location: https://172.27.46.253/ [following]
> --2024-10-15 16:36:15--  https://172.27.46.253/
> Connecting to 172.27.46.253:443... connected.

The TCP here is fully working, on both ports.

The followup hang you mentioned was likely due to a mistake in your 
followup test (that extra '4' typo?).


> ERROR: The certificate of '172.27.46.253' is not trusted.
> ERROR: The certificate of '172.27.46.253' doesn't have a known issuer.
> The certificate's owner does not match hostname '172.27.46.253'
> 

There you go. Two problems to resolve.

First Problem;  unknown "Issuer" (aka root or intermediate CA certificate).

Please use this to find out what details need to be retrieved:
   wget -v --no-proxy https://172.27.46.253/


Find the public CA certificate for the missing "Issuer".

Further tests with wget should use:
   wget -v --no-proxy \
     --ca-certificate=/path/to/server.ca https://172.27.46.253/

When wget test shows trust of the server certificate working, Squid 
should be configured to use it for checking too:
    tsl_outgoing_options ca=/path/to/server.ca
or
   cache_peer 172.27.46.253 443 0 originserver tls-ca=/path/to/server.ca


Second Problem;  mismatch between "172.27.46.253" and "Owner" (or 
maybe"SubjectAltName" fields).

The wget output when troubleshooting for the first problem should give 
more hints about what this means.



> So with the errors given, would that stop us from connecting to it? Typically with sites with trust issues or certification issues, you can still bypass it. We'd like to do the same here if applicable.

One could, but your wget command does not.


FYI, It is also a bad idea to bypass unless you really have to. 
Especially bad to bypass unknown amount of things when trying to 
identify reasons for failure.


Amos



From uhlar at fantomas.sk  Thu Oct 17 06:44:57 2024
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Thu, 17 Oct 2024 08:44:57 +0200
Subject: [squid-users] Unable to access a device over port 4434
In-Reply-To: <a7f8f86b1b0c4cfb812909bbcf64fdbd@hexcel.com>
References: <ZweAUvyJWT-EkNOb@fantomas.sk>
 <73682cf79e0546b4b4c1faa35d034614@hexcel.com>
 <f650f52c-4bab-4ef0-93c0-04139efa6f79@treenet.co.nz>
 <2b1a9d31a33f460bae39c990467e3a59@hexcel.com>
 <Zw-pt5UQjo8U3rr9@fantomas.sk>
 <b4d6d64d33554466853576912b371437@hexcel.com>
 <Zw_MBIExnUM7c02X@fantomas.sk>
 <60dad2ee1466406aa4670483fdeb84e2@hexcel.com>
 <Zw__K0IL7tE_3xJb@fantomas.sk>
 <a7f8f86b1b0c4cfb812909bbcf64fdbd@hexcel.com>
Message-ID: <ZxCyaZNYDO81vvhT@fantomas.sk>

On 16.10.24 20:03, Piana, Josh wrote:
> We do have a firewall in front of the Squid server.
>
> We're using a Checkpoint firewall but I've been told, a few times, that the 
> firewall is not blocking traffic coming from the proxy.

I guess that the whole problem lies in your network.

172.27.46.253 is in private IP range, so this address is pointing to device in 
your network. 

Is it behing firewall, NAT, load balancer?


-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
I wonder how much deeper the ocean would be without sponges.


From Josh.Piana at hexcel.com  Thu Oct 17 20:40:09 2024
From: Josh.Piana at hexcel.com (Piana, Josh)
Date: Thu, 17 Oct 2024 20:40:09 +0000
Subject: [squid-users] Unable to access a device over port 4434
In-Reply-To: <62587d0c-60a0-4ef4-a6ae-8b91f28665fe@treenet.co.nz>
References: <cc3be63a93bd478b8dee1e2b529540dc@hexcel.com>
 <ZweAUvyJWT-EkNOb@fantomas.sk> <73682cf79e0546b4b4c1faa35d034614@hexcel.com>
 <f650f52c-4bab-4ef0-93c0-04139efa6f79@treenet.co.nz>
 <2b1a9d31a33f460bae39c990467e3a59@hexcel.com>
 <62587d0c-60a0-4ef4-a6ae-8b91f28665fe@treenet.co.nz>
Message-ID: <68690f01df244effa28aef1cd7454a16@hexcel.com>

Hey Amos, 

Thanks for replying. 

To clarify on the test, port 4434 is the port that was assigned to get access to that device, one of our firewalls. 

I looked at the old Squid config that we have, and it seems this was setup in a way that internal networks were not being passed through the proxy. This was done be either an ACL, or the PAC file, is what we're thinking. The issue is, we don't exactly know how to implement the PAC file on our new Squid box. 

With that said, I agree with your statement that its difficult to troubleshoot an issue as opposed to go around it. Unfortunately, that's how it was done before and that's the direction our current management is going again. So I need to reconfigure the squid.conf file to ignore internal traffic, networks, and IP's, and only web filter and proxy internet connections. We can't just copy the old config because it doesn't carry over 1:1, and its an old version from 2.5. 

Is there additional testing I could do or anything I should know to make this happen? 

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Amos Jeffries
Sent: Wednesday, October 16, 2024 11:45 PM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Unable to access a device over port 4434

Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.


On 16/10/24 09:39, Piana, Josh wrote:
> Amos,
>
> Thank you for getting back to me and clarifying.
>
> I ran this command:
> #wget -Y off 172.27.46.253
>
> Response:
> --2024-10-15 16:36:15--  
> http://172.0.0.2/
> 7.46.253%2F&data=05%7C02%7Cjosh.piana%40hexcel.com%7Cf595ea81629e4e5db
> 45f08dcee5e2c12%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C638647335
> 455212558%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIi
> LCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=ZfzWSAFz5VpiHcYtQy4p
> c%2BHj08G%2FvUSWdLaU2RckxlA%3D&reserved=0
> Connecting to 172.27.46.253:80... connected.
> HTTP request sent, awaiting response... 301 Moved Permanently
> Location: 
> https://0.0.0.172/.
> 27.46.253%2F&data=05%7C02%7Cjosh.piana%40hexcel.com%7Cf595ea81629e4e5d
> b45f08dcee5e2c12%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C63864733
> 5458181374%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzI
> iLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=z%2F5YhuDe5d2cz6KUm
> TbGhMV6Dpgs3T%2B%2BrlqRewDCmCM%3D&reserved=0 [following]
> --2024-10-15 16:36:15--  
> https://0.0.0.172/.
> 27.46.253%2F&data=05%7C02%7Cjosh.piana%40hexcel.com%7Cf595ea81629e4e5d
> b45f08dcee5e2c12%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C63864733
> 5458181374%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzI
> iLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=z%2F5YhuDe5d2cz6KUm
> TbGhMV6Dpgs3T%2B%2BrlqRewDCmCM%3D&reserved=0
> Connecting to 172.27.46.253:443... connected.

The TCP here is fully working, on both ports.

The followup hang you mentioned was likely due to a mistake in your followup test (that extra '4' typo?).


> ERROR: The certificate of '172.27.46.253' is not trusted.
> ERROR: The certificate of '172.27.46.253' doesn't have a known issuer.
> The certificate's owner does not match hostname '172.27.46.253'
>

There you go. Two problems to resolve.

First Problem;  unknown "Issuer" (aka root or intermediate CA certificate).

Please use this to find out what details need to be retrieved:
   wget -v --no-proxy https://172.27.46.253/


Find the public CA certificate for the missing "Issuer".

Further tests with wget should use:
   wget -v --no-proxy \
     --ca-certificate=/path/to/server.ca https://172.27.46.253/

When wget test shows trust of the server certificate working, Squid should be configured to use it for checking too:
    tsl_outgoing_options ca=/path/to/server.ca or
   cache_peer 172.27.46.253 443 0 originserver tls-ca=/path/to/server.ca


Second Problem;  mismatch between "172.27.46.253" and "Owner" (or maybe"SubjectAltName" fields).

The wget output when troubleshooting for the first problem should give more hints about what this means.



> So with the errors given, would that stop us from connecting to it? Typically with sites with trust issues or certification issues, you can still bypass it. We'd like to do the same here if applicable.

One could, but your wget command does not.


FYI, It is also a bad idea to bypass unless you really have to.
Especially bad to bypass unknown amount of things when trying to identify reasons for failure.


Amos

_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
https://lists.squid-cache.org/listinfo/squid-users


From squid3 at treenet.co.nz  Fri Oct 18 05:59:05 2024
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 18 Oct 2024 18:59:05 +1300
Subject: [squid-users] Unable to access a device over port 4434
In-Reply-To: <68690f01df244effa28aef1cd7454a16@hexcel.com>
References: <cc3be63a93bd478b8dee1e2b529540dc@hexcel.com>
 <ZweAUvyJWT-EkNOb@fantomas.sk> <73682cf79e0546b4b4c1faa35d034614@hexcel.com>
 <f650f52c-4bab-4ef0-93c0-04139efa6f79@treenet.co.nz>
 <2b1a9d31a33f460bae39c990467e3a59@hexcel.com>
 <62587d0c-60a0-4ef4-a6ae-8b91f28665fe@treenet.co.nz>
 <68690f01df244effa28aef1cd7454a16@hexcel.com>
Message-ID: <2d7b5dac-be33-48dc-be37-b4682023811f@treenet.co.nz>

Ah, okay. I see.


So what you need with Squid is a cache_peer, relaying relevant traffic 
to that device.

   # details of how Squid should connect to the device
   cache_peer 172.27.46.253 parent 4434 0 originserver \
      tls-cert=/path/to/server.ca

   # which traffic to relay there
   acl foo dstdomain foo.example.com
   cache_peer_access 172.27.46.253 allow foo
   never_direct allow foo

   # permission for clients to make requests that reach that device
   http_access allow localnet foo


Add more ACL conditions as needed to restrict the http_access line to 
the appropriate clients.


Cheers
Amos


On 18/10/24 09:40, Piana, Josh wrote:
> Hey Amos,
> 
> Thanks for replying.
> 
> To clarify on the test, port 4434 is the port that was assigned to get access to that device, one of our firewalls.
> 
> I looked at the old Squid config that we have, and it seems this was setup in a way that internal networks were not being passed through the proxy. This was done be either an ACL, or the PAC file, is what we're thinking. The issue is, we don't exactly know how to implement the PAC file on our new Squid box.
> 
> With that said, I agree with your statement that its difficult to troubleshoot an issue as opposed to go around it. Unfortunately, that's how it was done before and that's the direction our current management is going again. So I need to reconfigure the squid.conf file to ignore internal traffic, networks, and IP's, and only web filter and proxy internet connections. We can't just copy the old config because it doesn't carry over 1:1, and its an old version from 2.5.
> 
> Is there additional testing I could do or anything I should know to make this happen?
> 
> -----Original Message-----
> From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Amos Jeffries
> Sent: Wednesday, October 16, 2024 11:45 PM
> To: squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] Unable to access a device over port 4434
> 
> Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.
> 
> 
> On 16/10/24 09:39, Piana, Josh wrote:
>> Amos,
>>
>> Thank you for getting back to me and clarifying.
>>
>> I ran this command:
>> #wget -Y off 172.27.46.253
>>
>> Response:
>> --2024-10-15 16:36:15--
>> http://172.0.0.2/
>> 7.46.253%2F&data=05%7C02%7Cjosh.piana%40hexcel.com%7Cf595ea81629e4e5db
>> 45f08dcee5e2c12%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C638647335
>> 455212558%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIi
>> LCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=ZfzWSAFz5VpiHcYtQy4p
>> c%2BHj08G%2FvUSWdLaU2RckxlA%3D&reserved=0
>> Connecting to 172.27.46.253:80... connected.
>> HTTP request sent, awaiting response... 301 Moved Permanently
>> Location:
>> https://0.0.0.172/.
>> 27.46.253%2F&data=05%7C02%7Cjosh.piana%40hexcel.com%7Cf595ea81629e4e5d
>> b45f08dcee5e2c12%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C63864733
>> 5458181374%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzI
>> iLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=z%2F5YhuDe5d2cz6KUm
>> TbGhMV6Dpgs3T%2B%2BrlqRewDCmCM%3D&reserved=0 [following]
>> --2024-10-15 16:36:15--
>> https://0.0.0.172/.
>> 27.46.253%2F&data=05%7C02%7Cjosh.piana%40hexcel.com%7Cf595ea81629e4e5d
>> b45f08dcee5e2c12%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C63864733
>> 5458181374%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzI
>> iLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=z%2F5YhuDe5d2cz6KUm
>> TbGhMV6Dpgs3T%2B%2BrlqRewDCmCM%3D&reserved=0
>> Connecting to 172.27.46.253:443... connected.
> 
> The TCP here is fully working, on both ports.
> 
> The followup hang you mentioned was likely due to a mistake in your followup test (that extra '4' typo?).
> 
> 
>> ERROR: The certificate of '172.27.46.253' is not trusted.
>> ERROR: The certificate of '172.27.46.253' doesn't have a known issuer.
>> The certificate's owner does not match hostname '172.27.46.253'
>>
> 
> There you go. Two problems to resolve.
> 
> First Problem;  unknown "Issuer" (aka root or intermediate CA certificate).
> 
> Please use this to find out what details need to be retrieved:
>     wget -v --no-proxy https://172.27.46.253/
> 
> 
> Find the public CA certificate for the missing "Issuer".
> 
> Further tests with wget should use:
>     wget -v --no-proxy \
>       --ca-certificate=/path/to/server.ca https://172.27.46.253/
> 
> When wget test shows trust of the server certificate working, Squid should be configured to use it for checking too:
>      tsl_outgoing_options ca=/path/to/server.ca or
>     cache_peer 172.27.46.253 443 0 originserver tls-ca=/path/to/server.ca
> 
> 
> Second Problem;  mismatch between "172.27.46.253" and "Owner" (or maybe"SubjectAltName" fields).
> 
> The wget output when troubleshooting for the first problem should give more hints about what this means.
> 
> 
> 
>> So with the errors given, would that stop us from connecting to it? Typically with sites with trust issues or certification issues, you can still bypass it. We'd like to do the same here if applicable.
> 
> One could, but your wget command does not.
> 
> 
> FYI, It is also a bad idea to bypass unless you really have to.
> Especially bad to bypass unknown amount of things when trying to identify reasons for failure.
> 
> 
> Amos
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> https://lists.squid-cache.org/listinfo/squid-users
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> https://lists.squid-cache.org/listinfo/squid-users



From uhlar at fantomas.sk  Fri Oct 18 07:33:53 2024
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Fri, 18 Oct 2024 09:33:53 +0200
Subject: [squid-users] Unable to access a device over port 4434
In-Reply-To: <2d7b5dac-be33-48dc-be37-b4682023811f@treenet.co.nz>
 <68690f01df244effa28aef1cd7454a16@hexcel.com>
Message-ID: <ZxIPYQMOCd78heY3@fantomas.sk>

On 17.10.24 20:40, Piana, Josh wrote:
> To clarify on the test, port 4434 is the port that was assigned to get 
> access to that device, one of our firewalls.
>
> I looked at the old Squid config that we have, and it seems this was setup 
> in a way that internal networks were not being passed through the proxy.  
> This was done be either an ACL, or the PAC file, is what we're thinking.  

The exemption has to be done through the PAC file, because once the 
browser's request reaches the proxy, it's impossible to go back and tell 
browser to go direct.

> The issue is, we don't exactly know how to implement the PAC file on our 
> new Squid box.

the PAC file has to be provided ideally via HTTP, I'm not sure whether squid 
has that functionality.

I guess a HTTP server was running on your old server, providing the PAC 
file.

> With that said, I agree with your statement that its difficult to 
> troubleshoot an issue as opposed to go around it.  Unfortunately, that's 
> how it was done before and that's the direction our current management is 
> going again.  So I need to reconfigure the squid.conf file to ignore 
> internal traffic, networks, and IP's, and only web filter and proxy 
> internet connections.  We can't just copy the old config because it 
> doesn't carry over 1:1, and its an old version from 2.5.

Once more, you can't ignore squid to be ignored by browsers, because squid 
can only do anything when it's accessed by browsers, when it's already too 
late.  Either browsers must go around the proxy (PAC or WPAD), or the proxy 
must be allowed to reach destination server.

Install apache server to the machine and configure it to serve the PAC>

On 18.10.24 18:59, Amos Jeffries wrote:
>So what you need with Squid is a cache_peer, relaying relevant traffic 
>to that device.

Amos, are you sure this can work in the case described?

>  # details of how Squid should connect to the device
>  cache_peer 172.27.46.253 parent 4434 0 originserver \
>     tls-cert=/path/to/server.ca
>
>  # which traffic to relay there
>  acl foo dstdomain foo.example.com
>  cache_peer_access 172.27.46.253 allow foo
>  never_direct allow foo
>
>  # permission for clients to make requests that reach that device
>  http_access allow localnet foo
>
>
>Add more ACL conditions as needed to restrict the http_access line to 
>the appropriate clients.


-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
How does cat play with mouse? cat /dev/mouse


From Josh.Piana at hexcel.com  Fri Oct 18 19:52:45 2024
From: Josh.Piana at hexcel.com (Piana, Josh)
Date: Fri, 18 Oct 2024 19:52:45 +0000
Subject: [squid-users] Unable to access a device over port 4434
In-Reply-To: <ZxIPYQMOCd78heY3@fantomas.sk>
References: <2d7b5dac-be33-48dc-be37-b4682023811f@treenet.co.nz>
 <68690f01df244effa28aef1cd7454a16@hexcel.com> <ZxIPYQMOCd78heY3@fantomas.sk>
Message-ID: <21116e3c66fe45678dcd8960eb0456fc@hexcel.com>

Hey guys, 

Thank you for the feedback in regards to the PAC file and the "cache_peer" directive. 

It looks like we're moving forward with the PAC file. So I need to introduce Apache onto my squidbox now. 

On a separate note, what would cause me to need to authenticate everytime I open a new browser? My credentials are supposed to last a week. 

Here's my authentication config: 

#####
auth_param basic program /usr/lib64/squid/basic_pam_auth
auth_param negotiate children 10
auth_param negotiate keep_alive on
auth_param basic credentialsttl 1 week
acl kerb-auth proxy_auth REQUIRED
#####

-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Matus UHLAR - fantomas
Sent: Friday, October 18, 2024 3:34 AM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Unable to access a device over port 4434

Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.


On 17.10.24 20:40, Piana, Josh wrote:
> To clarify on the test, port 4434 is the port that was assigned to get 
> access to that device, one of our firewalls.
>
> I looked at the old Squid config that we have, and it seems this was 
> setup in a way that internal networks were not being passed through the proxy.
> This was done be either an ACL, or the PAC file, is what we're thinking.

The exemption has to be done through the PAC file, because once the browser's request reaches the proxy, it's impossible to go back and tell browser to go direct.

> The issue is, we don't exactly know how to implement the PAC file on 
> our new Squid box.

the PAC file has to be provided ideally via HTTP, I'm not sure whether squid has that functionality.

I guess a HTTP server was running on your old server, providing the PAC file.

> With that said, I agree with your statement that its difficult to 
> troubleshoot an issue as opposed to go around it.  Unfortunately, 
> that's how it was done before and that's the direction our current 
> management is going again.  So I need to reconfigure the squid.conf 
> file to ignore internal traffic, networks, and IP's, and only web 
> filter and proxy internet connections.  We can't just copy the old 
> config because it doesn't carry over 1:1, and its an old version from 2.5.

Once more, you can't ignore squid to be ignored by browsers, because squid can only do anything when it's accessed by browsers, when it's already too late.  Either browsers must go around the proxy (PAC or WPAD), or the proxy must be allowed to reach destination server.

Install apache server to the machine and configure it to serve the PAC>

On 18.10.24 18:59, Amos Jeffries wrote:
>So what you need with Squid is a cache_peer, relaying relevant traffic 
>to that device.

Amos, are you sure this can work in the case described?

>  # details of how Squid should connect to the device  cache_peer 
> 172.27.46.253 parent 4434 0 originserver \
>     tls-cert=/path/to/server.ca
>
>  # which traffic to relay there
>  acl foo dstdomain foo.example.com
>  cache_peer_access 172.27.46.253 allow foo  never_direct allow foo
>
>  # permission for clients to make requests that reach that device  
> http_access allow localnet foo
>
>
>Add more ACL conditions as needed to restrict the http_access line to 
>the appropriate clients.


--
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
How does cat play with mouse? cat /dev/mouse _______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
https://lists.squid-cache.org/listinfo/squid-users


From seitzbg at gmail.com  Mon Oct 21 19:56:18 2024
From: seitzbg at gmail.com (Bryan Seitz)
Date: Mon, 21 Oct 2024 15:56:18 -0400
Subject: [squid-users] Squid 6.10 SSL-Bump Woes
In-Reply-To: <c89376c8-79d4-42d9-8985-2d332995e8f3@treenet.co.nz>
References: <CA+uwrTRnXSAVZ60RhfDvFS18aDZDUFZCWDKnUUd1KGE=wZL0pA@mail.gmail.com>
 <c8448d78-0ce5-413b-9bb3-16b680015659@measurement-factory.com>
 <CA+uwrTQ9MpOydEptrLSsRtuWGtEk4BwyBOc=Z6fL-hVNxzg47w@mail.gmail.com>
 <f994f59a-3a1a-4cb6-9e98-fb186109f879@treenet.co.nz>
 <74575885-4a3e-4cfe-ba81-a4d0cbf47671@Spark>
 <c89376c8-79d4-42d9-8985-2d332995e8f3@treenet.co.nz>
Message-ID: <23f34794-dda2-4ae4-ab3e-9bed6142e4d6@Spark>

Any ideas as to why Squid will not cache my authenticated origin
server replies ?

Bryan Seitz
On Oct 13, 2024 at 12:42?AM -0400, Amos Jeffries <squid3 at treenet.co.nz>, wrote:
> On 12/10/24 12:48, Bryan Seitz wrote:
> > ? ?I wanted to note that since these are BMCs they require basic auth
> > headers to return their response. I noticed that the ignore-auth option
> > was removed awhile ago.??Is my only option to go back to Squid 3.5 ?
> >
>
> Squid supports caching of authenticated traffic now.
> The authentication is also purely between Squid and the server, so is
> not relevant to the cacheability of these responses.
>
>
> HTH
> Amos
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> https://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20241021/a2959718/attachment.htm>

From uhlar at fantomas.sk  Tue Oct 22 08:20:17 2024
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Tue, 22 Oct 2024 10:20:17 +0200
Subject: [squid-users] NTRIP protocol through proxy
Message-ID: <ZxdgQeY2_piNH2me@fantomas.sk>

Hello,

We have customer who communicates using NTRIP protocol through proxy.

I have noticed that the client connects using GET protocol, while server
responds with ICY respone, which indicated the icecast protocol that should
be supported by SQUID since version 3.1
http://www.squid-cache.org/Versions/v3/3.1/RELEASENOTES.html#ss2.11

Customer reports that this does not work. While it is apparently not problem
of squid, I still would like to ask

- does anyone have experience with using squid for NTRIP communication?

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Microsoft dick is soft to do no harm


From squid3 at treenet.co.nz  Tue Oct 22 10:05:05 2024
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 22 Oct 2024 23:05:05 +1300
Subject: [squid-users] Unable to access a device over port 4434
In-Reply-To: <21116e3c66fe45678dcd8960eb0456fc@hexcel.com>
References: <2d7b5dac-be33-48dc-be37-b4682023811f@treenet.co.nz>
 <68690f01df244effa28aef1cd7454a16@hexcel.com> <ZxIPYQMOCd78heY3@fantomas.sk>
 <21116e3c66fe45678dcd8960eb0456fc@hexcel.com>
Message-ID: <3c5a0eca-8c69-49f2-9a90-8ef28fc172f8@treenet.co.nz>

On 19/10/24 08:52, Piana, Josh wrote:
> 
> On a separate note, what would cause me to need to authenticate everytime I open a new browser? My credentials are supposed to last a week.
> 

HTTP requires every request to be authenticated.

I assume you mean a popup appears? that would be a Browser decision.
To save across Browser being restarted your credentials need to be added 
to their "Password Manager".


> Here's my authentication config:
> 
> #####
> auth_param basic program /usr/lib64/squid/basic_pam_auth
> auth_param negotiate children 10
> auth_param negotiate keep_alive on
> auth_param basic credentialsttl 1 week> acl kerb-auth proxy_auth REQUIRED
> #####


FYI: Configuring "auth_param negotiate" without an "auth_param negotiate 
program ..." line does nothing.


Amos



From Josh.Piana at hexcel.com  Tue Oct 22 12:34:34 2024
From: Josh.Piana at hexcel.com (Piana, Josh)
Date: Tue, 22 Oct 2024 12:34:34 +0000
Subject: [squid-users] Unable to access a device over port 4434
In-Reply-To: <3c5a0eca-8c69-49f2-9a90-8ef28fc172f8@treenet.co.nz>
References: <2d7b5dac-be33-48dc-be37-b4682023811f@treenet.co.nz>
 <68690f01df244effa28aef1cd7454a16@hexcel.com> <ZxIPYQMOCd78heY3@fantomas.sk>
 <21116e3c66fe45678dcd8960eb0456fc@hexcel.com>
 <3c5a0eca-8c69-49f2-9a90-8ef28fc172f8@treenet.co.nz>
Message-ID: <2abd07c7204e42ec9c93e11a68785443@hexcel.com>

Amos, 

Thank you for the update in regards to the credentials. 

I looked into it a bit more to and it helped clear my misunderstanding. 

The credentialstls configuration directive only controls how often these credentials are internally verified by Squid. It means that if the browser is closed and then opened and the browser pops up credential dialog, then it has nothing to do with Squid. It means that the browser does not know what credentials it should pass to the proxy and therefore asks to enter them. The credentialsttl configuration directive means, how often the password should be "verified" after the last successful verification.

I reviewed my authentication config and changed it. 

Is this correct? We have a this setup via realmD, sssd, using Kerberos authentication. 

auth_param basic program /usr/lib64/squid/basic_pam_auth

auth_param basic children 10

auth_param basic keep_alive on

auth_param basic credentialsttl 2 hours

auth_param basic realm <redacted>



-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Amos Jeffries
Sent: Tuesday, October 22, 2024 6:05 AM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Unable to access a device over port 4434

Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.


On 19/10/24 08:52, Piana, Josh wrote:
>
> On a separate note, what would cause me to need to authenticate everytime I open a new browser? My credentials are supposed to last a week.
>

HTTP requires every request to be authenticated.

I assume you mean a popup appears? that would be a Browser decision.
To save across Browser being restarted your credentials need to be added to their "Password Manager".


> Here's my authentication config:
>
> #####
> auth_param basic program /usr/lib64/squid/basic_pam_auth auth_param 
> negotiate children 10 auth_param negotiate keep_alive on auth_param 
> basic credentialsttl 1 week> acl kerb-auth proxy_auth REQUIRED #####


FYI: Configuring "auth_param negotiate" without an "auth_param negotiate program ..." line does nothing.


Amos

_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
https://lists.squid-cache.org/listinfo/squid-users


From squid3 at treenet.co.nz  Tue Oct 22 16:10:35 2024
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 23 Oct 2024 05:10:35 +1300
Subject: [squid-users] Unable to access a device over port 4434
In-Reply-To: <2abd07c7204e42ec9c93e11a68785443@hexcel.com>
References: <2d7b5dac-be33-48dc-be37-b4682023811f@treenet.co.nz>
 <68690f01df244effa28aef1cd7454a16@hexcel.com> <ZxIPYQMOCd78heY3@fantomas.sk>
 <21116e3c66fe45678dcd8960eb0456fc@hexcel.com>
 <3c5a0eca-8c69-49f2-9a90-8ef28fc172f8@treenet.co.nz>
 <2abd07c7204e42ec9c93e11a68785443@hexcel.com>
Message-ID: <2f226ee3-b342-4ad3-bfdf-811d995e34ef@treenet.co.nz>

On 23/10/24 01:34, Piana, Josh wrote:
> Amos,
> 
> Thank you for the update in regards to the credentials.
> 
> I looked into it a bit more to and it helped clear my misunderstanding.
> 
> The credentialstls configuration directive only controls how often these credentials are internally verified by Squid. It means that if the browser is closed and then opened and the browser pops up credential dialog, then it has nothing to do with Squid. It means that the browser does not know what credentials it should pass to the proxy and therefore asks to enter them. The credentialsttl configuration directive means, how often the password should be "verified" after the last successful verification.

Correct.


> 
> I reviewed my authentication config and changed it.
> 
> Is this correct? We have a this setup via realmD, sssd, using Kerberos authentication.
> 
> auth_param basic program /usr/lib64/squid/basic_pam_auth
> 
> auth_param basic children 10
> 
> auth_param basic keep_alive on

Per the docs "For Basic and Digest this parameter is ignored."

> 
> auth_param basic credentialsttl 2 hours
> 
> auth_param basic realm <redacted>
> 

If that works for your needs it is good.

HTH
Amos


From squid3 at treenet.co.nz  Tue Oct 22 16:16:09 2024
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 23 Oct 2024 05:16:09 +1300
Subject: [squid-users] NTRIP protocol through proxy
In-Reply-To: <ZxdgQeY2_piNH2me@fantomas.sk>
References: <ZxdgQeY2_piNH2me@fantomas.sk>
Message-ID: <3084827f-6002-4224-8b29-8b82d59e7f8f@treenet.co.nz>

On 22/10/24 21:20, Matus UHLAR - fantomas wrote:
> Hello,
> 
> We have customer who communicates using NTRIP protocol through proxy.
> 
> I have noticed that the client connects using GET protocol, while server
> responds with ICY respone, which indicated the icecast protocol that should
> be supported by SQUID since version 3.1
> http://www.squid-cache.org/Versions/v3/3.1/RELEASENOTES.html#ss2.11
> 
> Customer reports that this does not work. While it is apparently not 
> problem
> of squid, I still would like to ask
> 
> - does anyone have experience with using squid for NTRIP communication?
> 

Not NTRIP specifically. The documentation for it specifies that it "uses 
HTTP/1.1", so should work for Squid.

If you can obtain a "debug_options 11,2" trace of the messages going 
through it may help track down what specifically is not working.


On the ICY topic, it was definitely working as of v3.4. The client I had 
using ICY no longer does. So I would not be surprised if something got 
broken more recently without being noticed.


Cheers
Amos



From Josh.Piana at hexcel.com  Thu Oct 24 19:53:18 2024
From: Josh.Piana at hexcel.com (Piana, Josh)
Date: Thu, 24 Oct 2024 19:53:18 +0000
Subject: [squid-users] proxy_auth_regex
Message-ID: <d450806e84f1439cb82e0fd071e6ec99@hexcel.com>

Hey Squid users,

Running into an issue I'm trying to figure out.

We have a few acl directives using "proxy_auth_regex -i" and when I have these active, it blocks any proxy connection with an HTTP 407 error, according to the logs.

Here's an example:
# block certain user IDs from using proxy server
#acl block_user proxy_auth_regex -i "/etc/squid/block_user"
#http_access deny block_user

What's supposed to happen with this ACL, is that any username we have on that list is to be blocked from internet access. But it seems to be blocking known good usernames too. I'm not sure where to go from here, we would like to use these ACL's but for right now I have these rules commented out.

Here's a few other rules we have that have the same issue:
# executable blocking
# reference this list for extensions to block
acl exec_files url_regex -i "/etc/squid/exec_files"

# ignore these usernames from being blocked
#acl exec_users proxy_auth_regex -i "/etc/squid/exec_users"

# combine the rules
#http_access deny !bad_exception_urls !exec_users exec_files
#deny_info ERR_BLOCK_TYPE exec_files

>From what you can see above, we have "acl exec_files url_regex -i /etc/squid/exec_files" uncommented, but it's not active because the "http_access directive" had to be commented out because it includes the other statements that include "proxy_auth_regex -i" which block all internet access as well.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20241024/d417b627/attachment.htm>

From rousskov at measurement-factory.com  Thu Oct 24 20:13:18 2024
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Thu, 24 Oct 2024 16:13:18 -0400
Subject: [squid-users] proxy_auth_regex
In-Reply-To: <d450806e84f1439cb82e0fd071e6ec99@hexcel.com>
References: <d450806e84f1439cb82e0fd071e6ec99@hexcel.com>
Message-ID: <d7848963-b7d7-45a2-a676-c12f4044ccc0@measurement-factory.com>

On 2024-10-24 15:53, Piana, Josh wrote:
> Hey Squid users,
> 
> Running into an issue I?m trying to figure out.
> 
> We have a few acl directives using ?proxy_auth_regex ?i? and when I have 
> these active, it blocks any proxy connection with an HTTP 407 error, 
> according to the logs.
> 
> Here?s an example:
> 
> # block certain user IDs from using proxy server
> 
> #acl block_user proxy_auth_regex -i "/etc/squid/block_user"
> 
> #http_access deny block_user
> 
> What?s supposed to happen with this ACL, is that any username we have on 
> that list is to be blocked from internet access. But it seems to be 
> blocking known good usernames too. I?m not sure where to go from here

After asking for one with a 407 response, does Squid ever receive a 
"good username" from the client? Do you see a username in client HTTP 
request headers or access.log records containing %un field?

Perhaps the client refuses to authenticate its requests because Squid 
intercepts TLS client connections rather than receiving HTTP CONNECT 
requests from the client? Have you tested this with plain text traffic?

Alex.


> we would like to use these ACL?s but for right now I have these rules 
> commented out.
> 
> Here's a few other rules we have that have the same issue:
> 
> # executable blocking
> 
> # reference this list for extensions to block
> 
> acl exec_files url_regex -i "/etc/squid/exec_files"
> 
> # ignore these usernames from being blocked
> 
> #acl exec_users proxy_auth_regex -i "/etc/squid/exec_users"
> 
> # combine the rules
> 
> #http_access deny !bad_exception_urls !exec_users exec_files
> 
> #deny_info ERR_BLOCK_TYPE exec_files
> 
>  From what you can see above, we have ?acl exec_files url_regex -i 
> /etc/squid/exec_files" uncommented, but it?s not active because the 
> ?http_access directive? had to be commented out because it includes the 
> other statements that include ?proxy_auth_regex ?i? which block all 
> internet access as well.
> 
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> https://lists.squid-cache.org/listinfo/squid-users



From Josh.Piana at hexcel.com  Thu Oct 24 20:23:13 2024
From: Josh.Piana at hexcel.com (Piana, Josh)
Date: Thu, 24 Oct 2024 20:23:13 +0000
Subject: [squid-users] proxy_auth_regex
In-Reply-To: <d7848963-b7d7-45a2-a676-c12f4044ccc0@measurement-factory.com>
References: <d450806e84f1439cb82e0fd071e6ec99@hexcel.com>
 <d7848963-b7d7-45a2-a676-c12f4044ccc0@measurement-factory.com>
Message-ID: <1d43b17c9ca14400a0d0edbcd0cb33f5@hexcel.com>

Alex, 

From what I can tell, squid does not receive a good username. When I check the access logs, I receive something like this:
24/Oct/2024:16:01:08 -0400.334 10.46.49.190 TCP_DENIED/407 7821 CONNECT www.google.com:443 - \ HIER_NONE/- text/html ERR_CACHE_ACCESS_DENIED/-

However, I think some of my log information may be missing. I believe you mentioned it before, so I'll show you what I'm using for our custom log directive. Maybe we can fix this too? What I originally tried to do with this was just get "human readable" time stamps:
logformat custom %tl.%03tu %>a %Ss/%03>Hs %<st %rm %ru %[un \ %Sh/%<a %mt %err_code/%err_detail

In regards to the TLS connectors vs HTTP CONNECT requests, that is a great point. I'm not sure if that is the case, but is "proxy_auth_regex" not compatible with certain things? How would you recommend I test plain http traffic?


-----Original Message-----
From: Alex Rousskov <rousskov at measurement-factory.com> 
Sent: Thursday, October 24, 2024 4:13 PM
To: Piana, Josh <Josh.Piana at hexcel.com>; squid-users at lists.squid-cache.org
Subject: Re: [squid-users] proxy_auth_regex

Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.


On 2024-10-24 15:53, Piana, Josh wrote:
> Hey Squid users,
>
> Running into an issue I?m trying to figure out.
>
> We have a few acl directives using ?proxy_auth_regex ?i? and when I 
> have these active, it blocks any proxy connection with an HTTP 407 
> error, according to the logs.
>
> Here?s an example:
>
> # block certain user IDs from using proxy server
>
> #acl block_user proxy_auth_regex -i "/etc/squid/block_user"
>
> #http_access deny block_user
>
> What?s supposed to happen with this ACL, is that any username we have 
> on that list is to be blocked from internet access. But it seems to be 
> blocking known good usernames too. I?m not sure where to go from here

After asking for one with a 407 response, does Squid ever receive a "good username" from the client? Do you see a username in client HTTP request headers or access.log records containing %un field?

Perhaps the client refuses to authenticate its requests because Squid intercepts TLS client connections rather than receiving HTTP CONNECT requests from the client? Have you tested this with plain text traffic?

Alex.


> we would like to use these ACL?s but for right now I have these rules 
> commented out.
>
> Here's a few other rules we have that have the same issue:
>
> # executable blocking
>
> # reference this list for extensions to block
>
> acl exec_files url_regex -i "/etc/squid/exec_files"
>
> # ignore these usernames from being blocked
>
> #acl exec_users proxy_auth_regex -i "/etc/squid/exec_users"
>
> # combine the rules
>
> #http_access deny !bad_exception_urls !exec_users exec_files
>
> #deny_info ERR_BLOCK_TYPE exec_files
>
>  From what you can see above, we have ?acl exec_files url_regex -i 
> /etc/squid/exec_files" uncommented, but it?s not active because the 
> ?http_access directive? had to be commented out because it includes 
> the other statements that include ?proxy_auth_regex ?i? which block 
> all internet access as well.
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Flist
> s.squid-cache.org%2Flistinfo%2Fsquid-users&data=05%7C02%7CJosh.Piana%4
> 0hexcel.com%7C7fb1087ae57b47c397a408dcf4684eaf%7C4248050df19546d5ac9c0
> c7c52b04cae%7C0%7C0%7C638653976041876515%7CUnknown%7CTWFpbGZsb3d8eyJWI
> joiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7
> C%7C&sdata=D6d%2BXvUp%2FHTvsqC5oneWw%2FdYNWYkmsQUz0lKHLzRk0o%3D&reserv
> ed=0


From rousskov at measurement-factory.com  Thu Oct 24 20:45:46 2024
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Thu, 24 Oct 2024 16:45:46 -0400
Subject: [squid-users] proxy_auth_regex
In-Reply-To: <1d43b17c9ca14400a0d0edbcd0cb33f5@hexcel.com>
References: <d450806e84f1439cb82e0fd071e6ec99@hexcel.com>
 <d7848963-b7d7-45a2-a676-c12f4044ccc0@measurement-factory.com>
 <1d43b17c9ca14400a0d0edbcd0cb33f5@hexcel.com>
Message-ID: <23a68428-70cd-401a-b5d3-c47a22c95850@measurement-factory.com>

On 2024-10-24 16:23, Piana, Josh wrote:

> From what I can tell, squid does not receive a good username. When I check the access logs, I receive something like this:

> 24/Oct/2024:16:01:08 -0400.334 10.46.49.190 TCP_DENIED/407 7821 CONNECT www.google.com:443 - \ HIER_NONE/- text/html ERR_CACHE_ACCESS_DENIED/-

Please check CONNECT request headers in packet captures or cache.log 
with debug_options set to ALL,2. If client does not send any user 
credentials to Squid, then Squid should request them (with a 407 CONNECT 
response containing appropriate headers).


> In regards to the TLS connectors vs HTTP CONNECT requests ...
 > I'm not sure if that is the case

Does the problematic test transaction arrive at http_port or https_port?


 > is "proxy_auth_regex" not compatible with certain things?

Nearly every Squid configuration option is not compatible with certain 
things.


 > How would you recommend I test plain http traffic?

I would start with

     curl --verbose ... http://example.com/

or a similar request (add proxy/other options instead of "..." as needed).

Alex.



> However, I think some of my log information may be missing. I believe you mentioned it before, so I'll show you what I'm using for our custom log directive. Maybe we can fix this too? What I originally tried to do with this was just get "human readable" time stamps:
> logformat custom %tl.%03tu %>a %Ss/%03>Hs %<st %rm %ru %[un \ %Sh/%<a %mt %err_code/%err_detail
> 
> In regards to the TLS connectors vs HTTP CONNECT requests, that is a great point. I'm not sure if that is the case, but is "proxy_auth_regex" not compatible with certain things? How would you recommend I test plain http traffic?
> 
> 
> -----Original Message-----
> From: Alex Rousskov <rousskov at measurement-factory.com>
> Sent: Thursday, October 24, 2024 4:13 PM
> To: Piana, Josh <Josh.Piana at hexcel.com>; squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] proxy_auth_regex
> 
> Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.
> 
> 
> On 2024-10-24 15:53, Piana, Josh wrote:
>> Hey Squid users,
>>
>> Running into an issue I?m trying to figure out.
>>
>> We have a few acl directives using ?proxy_auth_regex ?i? and when I
>> have these active, it blocks any proxy connection with an HTTP 407
>> error, according to the logs.
>>
>> Here?s an example:
>>
>> # block certain user IDs from using proxy server
>>
>> #acl block_user proxy_auth_regex -i "/etc/squid/block_user"
>>
>> #http_access deny block_user
>>
>> What?s supposed to happen with this ACL, is that any username we have
>> on that list is to be blocked from internet access. But it seems to be
>> blocking known good usernames too. I?m not sure where to go from here
> 
> After asking for one with a 407 response, does Squid ever receive a "good username" from the client? Do you see a username in client HTTP request headers or access.log records containing %un field?
> 
> Perhaps the client refuses to authenticate its requests because Squid intercepts TLS client connections rather than receiving HTTP CONNECT requests from the client? Have you tested this with plain text traffic?
> 
> Alex.
> 
> 
>> we would like to use these ACL?s but for right now I have these rules
>> commented out.
>>
>> Here's a few other rules we have that have the same issue:
>>
>> # executable blocking
>>
>> # reference this list for extensions to block
>>
>> acl exec_files url_regex -i "/etc/squid/exec_files"
>>
>> # ignore these usernames from being blocked
>>
>> #acl exec_users proxy_auth_regex -i "/etc/squid/exec_users"
>>
>> # combine the rules
>>
>> #http_access deny !bad_exception_urls !exec_users exec_files
>>
>> #deny_info ERR_BLOCK_TYPE exec_files
>>
>>   From what you can see above, we have ?acl exec_files url_regex -i
>> /etc/squid/exec_files" uncommented, but it?s not active because the
>> ?http_access directive? had to be commented out because it includes
>> the other statements that include ?proxy_auth_regex ?i? which block
>> all internet access as well.
>>
>>
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Flist
>> s.squid-cache.org%2Flistinfo%2Fsquid-users&data=05%7C02%7CJosh.Piana%4
>> 0hexcel.com%7C7fb1087ae57b47c397a408dcf4684eaf%7C4248050df19546d5ac9c0
>> c7c52b04cae%7C0%7C0%7C638653976041876515%7CUnknown%7CTWFpbGZsb3d8eyJWI
>> joiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7
>> C%7C&sdata=D6d%2BXvUp%2FHTvsqC5oneWw%2FdYNWYkmsQUz0lKHLzRk0o%3D&reserv
>> ed=0
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> https://lists.squid-cache.org/listinfo/squid-users



From Josh.Piana at hexcel.com  Fri Oct 25 15:54:08 2024
From: Josh.Piana at hexcel.com (Piana, Josh)
Date: Fri, 25 Oct 2024 15:54:08 +0000
Subject: [squid-users] proxy_auth_regex
In-Reply-To: <23a68428-70cd-401a-b5d3-c47a22c95850@measurement-factory.com>
References: <d450806e84f1439cb82e0fd071e6ec99@hexcel.com>
 <d7848963-b7d7-45a2-a676-c12f4044ccc0@measurement-factory.com>
 <1d43b17c9ca14400a0d0edbcd0cb33f5@hexcel.com>
 <23a68428-70cd-401a-b5d3-c47a22c95850@measurement-factory.com>
Message-ID: <3e0e4e52c1f948278e55946847752b39@hexcel.com>

Alex, 

I just turned on debugging All, 2 and will be checking the cache.log soon. 

> Does the problematic test transaction arrive at http_port or https_port?
It happens on both. To test http I used "neverssl.com". For https I tried many. 

I'm thinking the issue might be related to my "CONNECT" parameters. 
I'm using " acl CONNECT method CONNECT" but this might be too limiting? 

I'll get back to you with cache.log things soon. 

-----Original Message-----
From: Alex Rousskov <rousskov at measurement-factory.com> 
Sent: Thursday, October 24, 2024 4:46 PM
To: Piana, Josh <Josh.Piana at hexcel.com>; squid-users at lists.squid-cache.org
Subject: Re: [squid-users] proxy_auth_regex

Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.


On 2024-10-24 16:23, Piana, Josh wrote:

> From what I can tell, squid does not receive a good username. When I check the access logs, I receive something like this:

> 24/Oct/2024:16:01:08 -0400.334 10.46.49.190 TCP_DENIED/407 7821 
> CONNECT 
> http://www.g/
> oogle.com%3A443%2F&data=05%7C02%7CJosh.Piana%40hexcel.com%7C29bbc9983f
> 2742ff81e108dcf46cd820%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C63
> 8653995560620056%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV
> 2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C60000%7C%7C%7C&sdata=W%2BZDXkp
> r6hr5wvICtWMUGsugzHqz7%2BHS7UEKX7N5CPI%3D&reserved=0 - \ HIER_NONE/- 
> text/html ERR_CACHE_ACCESS_DENIED/-

Please check CONNECT request headers in packet captures or cache.log with debug_options set to ALL,2. If client does not send any user credentials to Squid, then Squid should request them (with a 407 CONNECT response containing appropriate headers).


> In regards to the TLS connectors vs HTTP CONNECT requests ...
 > I'm not sure if that is the case

Does the problematic test transaction arrive at http_port or https_port?


 > is "proxy_auth_regex" not compatible with certain things?

Nearly every Squid configuration option is not compatible with certain things.


 > How would you recommend I test plain http traffic?

I would start with

     curl --verbose ... http://example.com/

or a similar request (add proxy/other options instead of "..." as needed).

Alex.



> However, I think some of my log information may be missing. I believe you mentioned it before, so I'll show you what I'm using for our custom log directive. Maybe we can fix this too? What I originally tried to do with this was just get "human readable" time stamps:
> logformat custom %tl.%03tu %>a %Ss/%03>Hs %<st %rm %ru %[un \ %Sh/%<a 
> %mt %err_code/%err_detail
>
> In regards to the TLS connectors vs HTTP CONNECT requests, that is a great point. I'm not sure if that is the case, but is "proxy_auth_regex" not compatible with certain things? How would you recommend I test plain http traffic?
>
>
> -----Original Message-----
> From: Alex Rousskov <rousskov at measurement-factory.com>
> Sent: Thursday, October 24, 2024 4:13 PM
> To: Piana, Josh <Josh.Piana at hexcel.com>; 
> squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] proxy_auth_regex
>
> Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.
>
>
> On 2024-10-24 15:53, Piana, Josh wrote:
>> Hey Squid users,
>>
>> Running into an issue I?m trying to figure out.
>>
>> We have a few acl directives using ?proxy_auth_regex ?i? and when I 
>> have these active, it blocks any proxy connection with an HTTP 407 
>> error, according to the logs.
>>
>> Here?s an example:
>>
>> # block certain user IDs from using proxy server
>>
>> #acl block_user proxy_auth_regex -i "/etc/squid/block_user"
>>
>> #http_access deny block_user
>>
>> What?s supposed to happen with this ACL, is that any username we have 
>> on that list is to be blocked from internet access. But it seems to 
>> be blocking known good usernames too. I?m not sure where to go from 
>> here
>
> After asking for one with a 407 response, does Squid ever receive a "good username" from the client? Do you see a username in client HTTP request headers or access.log records containing %un field?
>
> Perhaps the client refuses to authenticate its requests because Squid intercepts TLS client connections rather than receiving HTTP CONNECT requests from the client? Have you tested this with plain text traffic?
>
> Alex.
>
>
>> we would like to use these ACL?s but for right now I have these rules 
>> commented out.
>>
>> Here's a few other rules we have that have the same issue:
>>
>> # executable blocking
>>
>> # reference this list for extensions to block
>>
>> acl exec_files url_regex -i "/etc/squid/exec_files"
>>
>> # ignore these usernames from being blocked
>>
>> #acl exec_users proxy_auth_regex -i "/etc/squid/exec_users"
>>
>> # combine the rules
>>
>> #http_access deny !bad_exception_urls !exec_users exec_files
>>
>> #deny_info ERR_BLOCK_TYPE exec_files
>>
>>   From what you can see above, we have ?acl exec_files url_regex -i 
>> /etc/squid/exec_files" uncommented, but it?s not active because the 
>> ?http_access directive? had to be commented out because it includes 
>> the other statements that include ?proxy_auth_regex ?i? which block 
>> all internet access as well.
>>
>>
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> https://lis/
>> t%2F&data=05%7C02%7CJosh.Piana%40hexcel.com%7C29bbc9983f2742ff81e108d
>> cf46cd820%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C63865399556062
>> 0056%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJB
>> TiI6Ik1haWwiLCJXVCI6Mn0%3D%7C60000%7C%7C%7C&sdata=PCQLdRbIhLqZa1TDHvK
>> 3tJ4%2Ft7KciRwqiLysnAUxzcE%3D&reserved=0
>> s.squid-cache.org%2Flistinfo%2Fsquid-users&data=05%7C02%7CJosh.Piana%
>> 4
>> 0hexcel.com%7C7fb1087ae57b47c397a408dcf4684eaf%7C4248050df19546d5ac9c
>> 0 
>> c7c52b04cae%7C0%7C0%7C638653976041876515%7CUnknown%7CTWFpbGZsb3d8eyJW
>> I
>> joiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%
>> 7 
>> C%7C&sdata=D6d%2BXvUp%2FHTvsqC5oneWw%2FdYNWYkmsQUz0lKHLzRk0o%3D&reser
>> v
>> ed=0
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> https://list/
> s.squid-cache.org%2Flistinfo%2Fsquid-users&data=05%7C02%7CJosh.Piana%4
> 0hexcel.com%7C29bbc9983f2742ff81e108dcf46cd820%7C4248050df19546d5ac9c0
> c7c52b04cae%7C0%7C0%7C638653995560776281%7CUnknown%7CTWFpbGZsb3d8eyJWI
> joiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C60000%
> 7C%7C%7C&sdata=oAOv7ObjGY%2FIMJOAC0LdMf0eJ1wzpn6P0Q5tCNOvSTY%3D&reserv
> ed=0


From Josh.Piana at hexcel.com  Fri Oct 25 17:19:07 2024
From: Josh.Piana at hexcel.com (Piana, Josh)
Date: Fri, 25 Oct 2024 17:19:07 +0000
Subject: [squid-users] proxy_auth_regex
In-Reply-To: <23a68428-70cd-401a-b5d3-c47a22c95850@measurement-factory.com>
References: <d450806e84f1439cb82e0fd071e6ec99@hexcel.com>
 <d7848963-b7d7-45a2-a676-c12f4044ccc0@measurement-factory.com>
 <1d43b17c9ca14400a0d0edbcd0cb33f5@hexcel.com>
 <23a68428-70cd-401a-b5d3-c47a22c95850@measurement-factory.com>
Message-ID: <4938cd77148f4507a187a7e96035813e@hexcel.com>

Hey Alex, 

Here's a quick glimpse at what the cache.log is saying. 

2024/10/25 11:49:18 kid1| ERROR: Negotiate Authentication validating user. Result: {result=BH, notes={message: gss_acquire_cred() failed: No credentials were supplied, or the credentials were unavailable or inaccessible. No principal in keytab matches desired name; }}
    current master transaction: master293

2024/10/25 11:49:18 kid1| Starting new negotiateauthenticator helpers...
    current master transaction: master1444

2024/10/25 11:49:18 kid1| helperOpenServers: Starting 1/10 'negotiate_kerberos_auth' processes
    current master transaction: master1444

2024/10/25 11:49:18 kid1| Starting new negotiateauthenticator helpers...
    current master transaction: master1445

2024/10/25 11:49:18 kid1| helperOpenServers: Starting 1/10 'negotiate_kerberos_auth' processes
    current master transaction: master1445

2024/10/25 11:49:18 kid1| ERROR: Negotiate Authentication validating user. Result: {result=BH, notes={message: gss_acquire_cred() failed: No credentials were supplied, or the credentials were unavailable or inaccessible. No principal in keytab matches desired name; }}
    current master transaction: master1082

-----Original Message-----
From: Alex Rousskov <rousskov at measurement-factory.com> 
Sent: Thursday, October 24, 2024 4:46 PM
To: Piana, Josh <Josh.Piana at hexcel.com>; squid-users at lists.squid-cache.org
Subject: Re: [squid-users] proxy_auth_regex

Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.


On 2024-10-24 16:23, Piana, Josh wrote:

> From what I can tell, squid does not receive a good username. When I check the access logs, I receive something like this:

> 24/Oct/2024:16:01:08 -0400.334 10.46.49.190 TCP_DENIED/407 7821 
> CONNECT 
> http://www.g/
> oogle.com%3A443%2F&data=05%7C02%7CJosh.Piana%40hexcel.com%7C29bbc9983f
> 2742ff81e108dcf46cd820%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C63
> 8653995560620056%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV
> 2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C60000%7C%7C%7C&sdata=W%2BZDXkp
> r6hr5wvICtWMUGsugzHqz7%2BHS7UEKX7N5CPI%3D&reserved=0 - \ HIER_NONE/- 
> text/html ERR_CACHE_ACCESS_DENIED/-

Please check CONNECT request headers in packet captures or cache.log with debug_options set to ALL,2. If client does not send any user credentials to Squid, then Squid should request them (with a 407 CONNECT response containing appropriate headers).


> In regards to the TLS connectors vs HTTP CONNECT requests ...
 > I'm not sure if that is the case

Does the problematic test transaction arrive at http_port or https_port?


 > is "proxy_auth_regex" not compatible with certain things?

Nearly every Squid configuration option is not compatible with certain things.


 > How would you recommend I test plain http traffic?

I would start with

     curl --verbose ... http://example.com/

or a similar request (add proxy/other options instead of "..." as needed).

Alex.



> However, I think some of my log information may be missing. I believe you mentioned it before, so I'll show you what I'm using for our custom log directive. Maybe we can fix this too? What I originally tried to do with this was just get "human readable" time stamps:
> logformat custom %tl.%03tu %>a %Ss/%03>Hs %<st %rm %ru %[un \ %Sh/%<a 
> %mt %err_code/%err_detail
>
> In regards to the TLS connectors vs HTTP CONNECT requests, that is a great point. I'm not sure if that is the case, but is "proxy_auth_regex" not compatible with certain things? How would you recommend I test plain http traffic?
>
>
> -----Original Message-----
> From: Alex Rousskov <rousskov at measurement-factory.com>
> Sent: Thursday, October 24, 2024 4:13 PM
> To: Piana, Josh <Josh.Piana at hexcel.com>; 
> squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] proxy_auth_regex
>
> Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.
>
>
> On 2024-10-24 15:53, Piana, Josh wrote:
>> Hey Squid users,
>>
>> Running into an issue I?m trying to figure out.
>>
>> We have a few acl directives using ?proxy_auth_regex ?i? and when I 
>> have these active, it blocks any proxy connection with an HTTP 407 
>> error, according to the logs.
>>
>> Here?s an example:
>>
>> # block certain user IDs from using proxy server
>>
>> #acl block_user proxy_auth_regex -i "/etc/squid/block_user"
>>
>> #http_access deny block_user
>>
>> What?s supposed to happen with this ACL, is that any username we have 
>> on that list is to be blocked from internet access. But it seems to 
>> be blocking known good usernames too. I?m not sure where to go from 
>> here
>
> After asking for one with a 407 response, does Squid ever receive a "good username" from the client? Do you see a username in client HTTP request headers or access.log records containing %un field?
>
> Perhaps the client refuses to authenticate its requests because Squid intercepts TLS client connections rather than receiving HTTP CONNECT requests from the client? Have you tested this with plain text traffic?
>
> Alex.
>
>
>> we would like to use these ACL?s but for right now I have these rules 
>> commented out.
>>
>> Here's a few other rules we have that have the same issue:
>>
>> # executable blocking
>>
>> # reference this list for extensions to block
>>
>> acl exec_files url_regex -i "/etc/squid/exec_files"
>>
>> # ignore these usernames from being blocked
>>
>> #acl exec_users proxy_auth_regex -i "/etc/squid/exec_users"
>>
>> # combine the rules
>>
>> #http_access deny !bad_exception_urls !exec_users exec_files
>>
>> #deny_info ERR_BLOCK_TYPE exec_files
>>
>>   From what you can see above, we have ?acl exec_files url_regex -i 
>> /etc/squid/exec_files" uncommented, but it?s not active because the 
>> ?http_access directive? had to be commented out because it includes 
>> the other statements that include ?proxy_auth_regex ?i? which block 
>> all internet access as well.
>>
>>
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> https://lis/
>> t%2F&data=05%7C02%7CJosh.Piana%40hexcel.com%7C29bbc9983f2742ff81e108d
>> cf46cd820%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C63865399556062
>> 0056%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJB
>> TiI6Ik1haWwiLCJXVCI6Mn0%3D%7C60000%7C%7C%7C&sdata=PCQLdRbIhLqZa1TDHvK
>> 3tJ4%2Ft7KciRwqiLysnAUxzcE%3D&reserved=0
>> s.squid-cache.org%2Flistinfo%2Fsquid-users&data=05%7C02%7CJosh.Piana%
>> 4
>> 0hexcel.com%7C7fb1087ae57b47c397a408dcf4684eaf%7C4248050df19546d5ac9c
>> 0 
>> c7c52b04cae%7C0%7C0%7C638653976041876515%7CUnknown%7CTWFpbGZsb3d8eyJW
>> I
>> joiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%
>> 7 
>> C%7C&sdata=D6d%2BXvUp%2FHTvsqC5oneWw%2FdYNWYkmsQUz0lKHLzRk0o%3D&reser
>> v
>> ed=0
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> https://list/
> s.squid-cache.org%2Flistinfo%2Fsquid-users&data=05%7C02%7CJosh.Piana%4
> 0hexcel.com%7C29bbc9983f2742ff81e108dcf46cd820%7C4248050df19546d5ac9c0
> c7c52b04cae%7C0%7C0%7C638653995560776281%7CUnknown%7CTWFpbGZsb3d8eyJWI
> joiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C60000%
> 7C%7C%7C&sdata=oAOv7ObjGY%2FIMJOAC0LdMf0eJ1wzpn6P0Q5tCNOvSTY%3D&reserv
> ed=0


From rousskov at measurement-factory.com  Fri Oct 25 17:31:56 2024
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Fri, 25 Oct 2024 13:31:56 -0400
Subject: [squid-users] proxy_auth_regex
In-Reply-To: <4938cd77148f4507a187a7e96035813e@hexcel.com>
References: <d450806e84f1439cb82e0fd071e6ec99@hexcel.com>
 <d7848963-b7d7-45a2-a676-c12f4044ccc0@measurement-factory.com>
 <1d43b17c9ca14400a0d0edbcd0cb33f5@hexcel.com>
 <23a68428-70cd-401a-b5d3-c47a22c95850@measurement-factory.com>
 <4938cd77148f4507a187a7e96035813e@hexcel.com>
Message-ID: <04263c79-844b-4dbf-b211-90c475d77b3a@measurement-factory.com>

On 2024-10-25 13:19, Piana, Josh wrote:

> 2024/10/25 11:49:18 kid1| ERROR: Negotiate Authentication validating
> user. Result: {result=BH, notes={message: gss_acquire_cred() failed:
> No credentials were supplied, or the credentials were unavailable or
> inaccessible. No principal in keytab matches desired name; }}

Most likely, this is the error you need to fix first. I know almost 
nothing about Kerberos, but it looks like your authentication helper 
and/or its environment is not configured correctly.

Others may be able to guide you from here, but that BH (i.e. Broken 
Helper) problem may not be specific to any HTTP(S) transaction that 
Squid is handling. If you can test your authentication helper in 
isolation by starting it from the command line and feeding it helper 
commands, do that.

Alex.


> -----Original Message-----
> From: Alex Rousskov <rousskov at measurement-factory.com>
> Sent: Thursday, October 24, 2024 4:46 PM
> To: Piana, Josh <Josh.Piana at hexcel.com>; squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] proxy_auth_regex
> 
> Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.
> 
> 
> On 2024-10-24 16:23, Piana, Josh wrote:
> 
>>  From what I can tell, squid does not receive a good username. When I check the access logs, I receive something like this:
> 
>> 24/Oct/2024:16:01:08 -0400.334 10.46.49.190 TCP_DENIED/407 7821
>> CONNECT
>> http://www.g/
>> oogle.com%3A443%2F&data=05%7C02%7CJosh.Piana%40hexcel.com%7C29bbc9983f
>> 2742ff81e108dcf46cd820%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C63
>> 8653995560620056%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV
>> 2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C60000%7C%7C%7C&sdata=W%2BZDXkp
>> r6hr5wvICtWMUGsugzHqz7%2BHS7UEKX7N5CPI%3D&reserved=0 - \ HIER_NONE/-
>> text/html ERR_CACHE_ACCESS_DENIED/-
> 
> Please check CONNECT request headers in packet captures or cache.log with debug_options set to ALL,2. If client does not send any user credentials to Squid, then Squid should request them (with a 407 CONNECT response containing appropriate headers).
> 
> 
>> In regards to the TLS connectors vs HTTP CONNECT requests ...
>   > I'm not sure if that is the case
> 
> Does the problematic test transaction arrive at http_port or https_port?
> 
> 
>   > is "proxy_auth_regex" not compatible with certain things?
> 
> Nearly every Squid configuration option is not compatible with certain things.
> 
> 
>   > How would you recommend I test plain http traffic?
> 
> I would start with
> 
>       curl --verbose ... http://example.com/
> 
> or a similar request (add proxy/other options instead of "..." as needed).
> 
> Alex.
> 
> 
> 
>> However, I think some of my log information may be missing. I believe you mentioned it before, so I'll show you what I'm using for our custom log directive. Maybe we can fix this too? What I originally tried to do with this was just get "human readable" time stamps:
>> logformat custom %tl.%03tu %>a %Ss/%03>Hs %<st %rm %ru %[un \ %Sh/%<a
>> %mt %err_code/%err_detail
>>
>> In regards to the TLS connectors vs HTTP CONNECT requests, that is a great point. I'm not sure if that is the case, but is "proxy_auth_regex" not compatible with certain things? How would you recommend I test plain http traffic?
>>
>>
>> -----Original Message-----
>> From: Alex Rousskov <rousskov at measurement-factory.com>
>> Sent: Thursday, October 24, 2024 4:13 PM
>> To: Piana, Josh <Josh.Piana at hexcel.com>;
>> squid-users at lists.squid-cache.org
>> Subject: Re: [squid-users] proxy_auth_regex
>>
>> Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.
>>
>>
>> On 2024-10-24 15:53, Piana, Josh wrote:
>>> Hey Squid users,
>>>
>>> Running into an issue I?m trying to figure out.
>>>
>>> We have a few acl directives using ?proxy_auth_regex ?i? and when I
>>> have these active, it blocks any proxy connection with an HTTP 407
>>> error, according to the logs.
>>>
>>> Here?s an example:
>>>
>>> # block certain user IDs from using proxy server
>>>
>>> #acl block_user proxy_auth_regex -i "/etc/squid/block_user"
>>>
>>> #http_access deny block_user
>>>
>>> What?s supposed to happen with this ACL, is that any username we have
>>> on that list is to be blocked from internet access. But it seems to
>>> be blocking known good usernames too. I?m not sure where to go from
>>> here
>>
>> After asking for one with a 407 response, does Squid ever receive a "good username" from the client? Do you see a username in client HTTP request headers or access.log records containing %un field?
>>
>> Perhaps the client refuses to authenticate its requests because Squid intercepts TLS client connections rather than receiving HTTP CONNECT requests from the client? Have you tested this with plain text traffic?
>>
>> Alex.
>>
>>
>>> we would like to use these ACL?s but for right now I have these rules
>>> commented out.
>>>
>>> Here's a few other rules we have that have the same issue:
>>>
>>> # executable blocking
>>>
>>> # reference this list for extensions to block
>>>
>>> acl exec_files url_regex -i "/etc/squid/exec_files"
>>>
>>> # ignore these usernames from being blocked
>>>
>>> #acl exec_users proxy_auth_regex -i "/etc/squid/exec_users"
>>>
>>> # combine the rules
>>>
>>> #http_access deny !bad_exception_urls !exec_users exec_files
>>>
>>> #deny_info ERR_BLOCK_TYPE exec_files
>>>
>>>    From what you can see above, we have ?acl exec_files url_regex -i
>>> /etc/squid/exec_files" uncommented, but it?s not active because the
>>> ?http_access directive? had to be commented out because it includes
>>> the other statements that include ?proxy_auth_regex ?i? which block
>>> all internet access as well.
>>>
>>>
>>> _______________________________________________
>>> squid-users mailing list
>>> squid-users at lists.squid-cache.org
>>> https://lis/
>>> t%2F&data=05%7C02%7CJosh.Piana%40hexcel.com%7C29bbc9983f2742ff81e108d
>>> cf46cd820%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C63865399556062
>>> 0056%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJB
>>> TiI6Ik1haWwiLCJXVCI6Mn0%3D%7C60000%7C%7C%7C&sdata=PCQLdRbIhLqZa1TDHvK
>>> 3tJ4%2Ft7KciRwqiLysnAUxzcE%3D&reserved=0
>>> s.squid-cache.org%2Flistinfo%2Fsquid-users&data=05%7C02%7CJosh.Piana%
>>> 4
>>> 0hexcel.com%7C7fb1087ae57b47c397a408dcf4684eaf%7C4248050df19546d5ac9c
>>> 0
>>> c7c52b04cae%7C0%7C0%7C638653976041876515%7CUnknown%7CTWFpbGZsb3d8eyJW
>>> I
>>> joiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%
>>> 7
>>> C%7C&sdata=D6d%2BXvUp%2FHTvsqC5oneWw%2FdYNWYkmsQUz0lKHLzRk0o%3D&reser
>>> v
>>> ed=0
>>
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> https://list/
>> s.squid-cache.org%2Flistinfo%2Fsquid-users&data=05%7C02%7CJosh.Piana%4
>> 0hexcel.com%7C29bbc9983f2742ff81e108dcf46cd820%7C4248050df19546d5ac9c0
>> c7c52b04cae%7C0%7C0%7C638653995560776281%7CUnknown%7CTWFpbGZsb3d8eyJWI
>> joiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C60000%
>> 7C%7C%7C&sdata=oAOv7ObjGY%2FIMJOAC0LdMf0eJ1wzpn6P0Q5tCNOvSTY%3D&reserv
>> ed=0
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> https://lists.squid-cache.org/listinfo/squid-users



From testgm926 at gmail.com  Fri Oct 25 18:28:01 2024
From: testgm926 at gmail.com (GM Test)
Date: Fri, 25 Oct 2024 19:28:01 +0100
Subject: [squid-users] Square Bracket in LogFormat
Message-ID: <CACJp8e10JecEH3S+B5CLT8tNwyxPzCZqaaKjg-s7YFog22d9qA@mail.gmail.com>

Hello,

I'm not sure if this is the right place to ask this question but in
the *logformat
*command, I cannot seem to work out what the square bracket is for?

For example:

logformat squid %ts.%03tu %6tr %>a %Ss/%03>Hs %<st %rm %ru %[un %Sh/%<a %mt


http://www.squid-cache.org/Doc/config/logformat/

Would anyone be able to tell me?

Many thanks,
lan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20241025/d78ee37d/attachment.htm>

From rousskov at measurement-factory.com  Fri Oct 25 21:02:04 2024
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Fri, 25 Oct 2024 17:02:04 -0400
Subject: [squid-users] Square Bracket in LogFormat
In-Reply-To: <CACJp8e10JecEH3S+B5CLT8tNwyxPzCZqaaKjg-s7YFog22d9qA@mail.gmail.com>
References: <CACJp8e10JecEH3S+B5CLT8tNwyxPzCZqaaKjg-s7YFog22d9qA@mail.gmail.com>
Message-ID: <7fdb736b-64de-489d-807c-fa6029c371bc@measurement-factory.com>

On 2024-10-25 14:28, GM Test wrote:

> I'm not sure if this is the right place to ask this question

Yes, it is.

> but in the 
> *logformat *command, I cannot seem to work out what the square bracket 
> is for?

When used at the beginning of a logformat %code name, a single square 
bracket character specifies a particular encoding algorithm for that 
%code values. To find documentation for that encoding, search for the 
words "Custom Squid encoding where percent" in recent 
squid.conf.documented or at

http://www.squid-cache.org/Doc/config/logformat

HTH,

Alex.

> 
> For example:
> 
>     logformat squid %ts.%03tu %6tr %>a %Ss/%03>Hs %<st %rm %ru %[un
>     %Sh/%<a %mt
> 
> 
> http://www.squid-cache.org/Doc/config/logformat/ 
> <http://www.squid-cache.org/Doc/config/logformat/>
> 
> Would anyone be able to tell me?
> 
> Many thanks,
> lan
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> https://lists.squid-cache.org/listinfo/squid-users



From erikschulz184 at gmail.com  Fri Oct 25 22:18:25 2024
From: erikschulz184 at gmail.com (Erik Schulz)
Date: Sat, 26 Oct 2024 00:18:25 +0200
Subject: [squid-users] Help regarding access controls for TLS connections
Message-ID: <CAE5KivgFh1FAqCYctV4soqORLpUzk1FOMkGVb_1T0N=15WtdGg@mail.gmail.com>

Hello!

I would like to use squid as an egress proxy, to prevent unauthorized egress.

Let's say that the only allowed egress is 'example.com'.
I can define acl along the lines of:
```
acl allowed_domains ssl::server_name .example.com
http_access allow allowed_domains
```

But can someone help me understand what actually happens?
I want to avoid any DNS egress attack.
The client does not have DNS access.
Am I correct that the client can use HTTPS_PROXY without DNS, such
that the proxy will perform the DNS lookup?

Can you help me understand how the acl checks the server_name?
In order to connect to the server, it must perform a DNS lookup, which
causes a leak.
So the ACL must validate the server_name without a DNS lookup, and
since the server IP is therefore unknown, without connecting to the
server or verifying against its certificate.
I'm assuming the hostname is known in the CONNECT phase of the request?
Is it possible to check against the connect hostname only?

The docs say that
> "The ACL computes server name(s) using such information sources as CONNECT request URI, TLS client SNI, and TLS server certificate subject (CN and SubjectAltName). The computed server name(s) usually change with each SslBump step"

I find this concerning, because I assume the client could perform a
request with an IP, and a forged SNI name that passes the acl.
So I would like to only allow requests that declare FQDN hostname, and
reject IP hostnames.

And, only perform validation against the CONNECT request URI.

Is that possible?

Thanks for any clarification!
/Erik


From ngtech1ltd at gmail.com  Sun Oct 27 20:19:49 2024
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Sun, 27 Oct 2024 22:19:49 +0200
Subject: [squid-users] Rocky Linux 9 and other EL9 RPMs release
Message-ID: <051f01db28ad$939e9b20$badbd160$@gmail.com>

Hey List,

It took me quite a while to find out the reason why only on EL9 based
distributions I couldn't build the RPMs.
I have found that the LTO (Linking Time Optimization) is enabled by default
in rpmbuild on EL9 and this caused squid to fail the build.
This issue existed in the past(V4) and was resolved some time ago(V5) but
now it appear to exist again.
I have built the RPMS for:
* Rocky Linux
* Oracle Enterprise Linux
* Alma Linux

I have not tested the builds yet but since only the LTO is the difference it
should be fine.
I will test the build of Rocky Linux 9 in my production environment in the
next few weeks.

I have worked for quite some time on the Squid Nuggets series with the hope
to release couple technical videos on the internals of SquidGuard
to give new programmers a nice open project for fun.

The repos are at:
https://www.ngtech.co.il/repo/

https://www.ngtech.co.il/repo/rocky/9/

https://www.ngtech.co.il/repo/alma/9/

https://www.ngtech.co.il/repo/oracle/9/

Let me know if you need some help with the packages.

----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com





From rousskov at measurement-factory.com  Sun Oct 27 23:14:27 2024
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Sun, 27 Oct 2024 19:14:27 -0400
Subject: [squid-users] Help regarding access controls for TLS connections
In-Reply-To: <CAE5KivgFh1FAqCYctV4soqORLpUzk1FOMkGVb_1T0N=15WtdGg@mail.gmail.com>
References: <CAE5KivgFh1FAqCYctV4soqORLpUzk1FOMkGVb_1T0N=15WtdGg@mail.gmail.com>
Message-ID: <fb0b75ba-44d9-4552-8ddf-18c42cb3b8de@measurement-factory.com>

On 2024-10-25 18:18, Erik Schulz wrote:

> I would like to use squid as an egress proxy, to prevent unauthorized egress.
> 
> Let's say that the only allowed egress is 'example.com'.
> I can define acl along the lines of:
> ```
> acl allowed_domains ssl::server_name .example.com
> http_access allow allowed_domains
> ```

> But can someone help me understand what actually happens?

A lot of thing happens, including: After parsing received HTTP(S) or FTP 
request, Squid checks http_access rules and either allows or denies the 
request. For HTTPS requests that are subject to ssl_bump rules, that 
processing happens multiple times, at various SslBump steps, as detailed 
at https://wiki.squid-cache.org/Features/SslPeekAndSplice

N.B. http_access check is a part of "Callout Sequence" referenced on the 
above page in step1 and step2. There are some bugs in the current Squid 
implementation of that document, but it is still a useful starting point.


> I want to avoid any DNS egress attack.

How do you define "DNS egress attack"? To the extent possible, please 
answer in terms of what Squid should or should not do with traffic Squid 
receives.


> The client does not have DNS access.
> Am I correct that the client can use HTTPS_PROXY without DNS, such
> that the proxy will perform the DNS lookup?

If you do not control the client, then you should assume that it can 
send any request to/through Squid. This includes sending an HTTPS 
requests without using DNS. Whether the proxy receiving the request is 
going to perform a DNS lookup is a separate question. Many factors 
affect that proxy decision.


> Can you help me understand how the acl checks the server_name?

You already know how server_name documentation answers this question. It 
is not clear to me what undocumented aspects you want to know about. 
Could you please clarify by asking a more specific question?


> In order to connect to the server, it must perform a DNS lookup, which
> causes a leak.

Sorry, I am not sure what "it" is in this context, but, as you probably 
already know from the same docs, "Unlike dstdomain, [ssl::server_name] 
ACL does not perform DNS lookups."

If Squid needs to connect to server X, and X is a domain name, Squid 
will (in most cases) attempt to resolve X to get server IP address(es), 
but that attempt happens before and/or after Sqiud evaluates 
ssl::server_name ACL.


> So the ACL must validate the server_name without a DNS lookup, and
> since the server IP is therefore unknown, without connecting to the
> server or verifying against its certificate.

During server_name ACL evaluation, Squid does not attempt to connection 
to any other server or service. The ACL match/mismatch decision is made 
by comparing various strings using either domain comparison function 
(for server_name) or regex evaluation (for server_name_regex).

The server IP address may or may not be known at ssl::server_name 
evaluation time.


> I'm assuming the hostname is known in the CONNECT phase of the request?

Assuming that CONNECT request has arrived at http_port, the answer 
depends on many factors, possibly including:

* whether the client supplied a hostname in CONNECT request headers;
* whether the client supplied a hostname in TLS SNI field;
* whether the CONNECT request is subject to ssl_bump rules;
* whether Squid is opening a tunnel to an origin server or cache_peer

> Is it possible to check against the connect hostname only?

Without SslBump, "dstdomain -n" would probably do that. With SslBump, 
"dstdomain -n" would probably do that during SslBump step1 (and step2 if 
client does not supply TLS SNI). All this needs careful testing though; 
there are many configuration parameters and request specifics at play here!


> The docs say that
>> "The ACL computes server name(s) using such information sources as CONNECT request URI, TLS client SNI, and TLS server certificate subject (CN and SubjectAltName). The computed server name(s) usually change with each SslBump step"
> 
> I find this concerning, because I assume the client could perform a
> request with an IP, and a forged SNI name that passes the acl.
> So I would like to only allow requests that declare FQDN hostname, and
> reject IP hostnames.

You probably can use dstdomain_reject to reject IP-based hostnames, but 
it may not be easy to do it reliably using regular expressions because 
IP addresses come in many forms. Squid is probably missing an 
"dst_is_ip" or similar ACL(s) to make such checks reliable.


> And, only perform validation against the CONNECT request URI.

See above regarding using "dstdomain -n" for this.


HTH,

Alex.



From erikschulz184 at gmail.com  Mon Oct 28 15:47:10 2024
From: erikschulz184 at gmail.com (Erik Schulz)
Date: Mon, 28 Oct 2024 16:47:10 +0100
Subject: [squid-users] Help regarding access controls for TLS connections
In-Reply-To: <fb0b75ba-44d9-4552-8ddf-18c42cb3b8de@measurement-factory.com>
References: <CAE5KivgFh1FAqCYctV4soqORLpUzk1FOMkGVb_1T0N=15WtdGg@mail.gmail.com>
 <fb0b75ba-44d9-4552-8ddf-18c42cb3b8de@measurement-factory.com>
Message-ID: <CAE5KivggGuNE8S7Hjs_gX0qMLUwJF2XOO0ixGyrOE46YWn_VEA@mail.gmail.com>

Hi Alex,

Thank you for your detailed response!

I realized later that I was applying 'localnet' rules before the
dstdomain rules, which was the cause of the unauthorized dns lookup.
By rearranging the rules, such that `dstdomain -n` rules are tested
first, there is no dns lookup. Well, I do see a reverse dns lookup for
the client's ip, that I can't explain, but even if that is the case,
it would require client IP spoofing. But I don't understand why the
reverse lookup happens. I'm only testing `src`, not `srcdomain`.
----
# deny if not authenticated
auth_param basic program /usr/lib/squid/basic_ncsa_auth /etc/squid/passwd
acl authenticated proxy_auth REQUIRED
http_access deny !authenticated

# deny if not allowed domains
acl user_user2 proxy_auth user2
acl allowed_domains2 dstdomain -n .example.com
http_access deny user_user2 !allowed_domains2

# deny public ip
acl localnet_src src 0.0.0.1-0.255.255.255
acl localnet_src src 10.0.0.0/8
acl localnet_src src 100.64.0.0/10
acl localnet_src src 169.254.0.0/16
acl localnet_src src 172.16.0.0/12
acl localnet_src src 192.168.0.0/16
acl localnet_src src fc00::/7
acl localnet_src src fe80::/10
http_access deny !localnet_src

# deny local destination (resolved hostname)
acl localnet_dst dst 0.0.0.1-0.255.255.255
acl localnet_dst dst 10.0.0.0/8
acl localnet_dst dst 100.64.0.0/10
acl localnet_dst dst 169.254.0.0/16
acl localnet_dst dst 172.16.0.0/12
acl localnet_dst dst 192.168.0.0/16
acl localnet_dst dst fc00::/7
acl localnet_dst dst fe80::/10
http_access deny localnet_dst

acl Safe_ports port 80
acl Safe_ports port 443
http_access deny !Safe_ports

cache deny all

http_access allow
----

Regarding what DNS egress attack is:
The use of a forward proxy ("egress controller") is to prevent
unauthorized egress, i.e. leaking any data, including TLS or CA
private keys, which can be relatively few bytes.
Unauthorized DNS egress is low bandwidth, but that doesn't matter.
Here is a ChatGPT explanation of what a DNS egress attack is:
---
A DNS egress attack exploits DNS queries to stealthily extract
sensitive information from within a network. Here?s how it operates
and why it?s effective:
- DNS as a Covert Channel: DNS requests are typically unfiltered and
allowed through most firewalls. Attackers use DNS requests to
exfiltrate data by embedding information in DNS queries, which often
bypasses traditional egress filters.
- Steganography in DNS Requests: Attackers encode sensitive
information (like passwords or encryption keys) into DNS request
subdomains. For example, a query like data1234.attacker.com can encode
data (data1234) before resolving to the attacker-controlled domain.
- Recursive Resolver Complicity: Since DNS queries are recursively
resolved, intermediate DNS resolvers help propagate the data-laden
requests to the final DNS server controlled by the attacker. This adds
complexity to tracking and blocking the egress path.
- Low Detectability: Normal DNS queries blend into typical network
traffic, making these attacks hard to detect, especially if small
amounts of data are exfiltrated over time.
- Mitigation Gaps: Most firewalls overlook the payload within DNS
queries, focusing instead on blocking IPs or domains, which doesn't
stop the encoding of sensitive data in the DNS request itself.
- DNS data egress attacks are potent because they exploit a
foundational internet protocol for covert data transmission. Solutions
demand vigilant DNS traffic analysis and strict egress filtering
policies.
---

On Mon, Oct 28, 2024 at 12:14?AM Alex Rousskov
<rousskov at measurement-factory.com> wrote:
>
> On 2024-10-25 18:18, Erik Schulz wrote:
>
> > I would like to use squid as an egress proxy, to prevent unauthorized egress.
> >
> > Let's say that the only allowed egress is 'example.com'.
> > I can define acl along the lines of:
> > ```
> > acl allowed_domains ssl::server_name .example.com
> > http_access allow allowed_domains
> > ```
>
> > But can someone help me understand what actually happens?
>
> A lot of thing happens, including: After parsing received HTTP(S) or FTP
> request, Squid checks http_access rules and either allows or denies the
> request. For HTTPS requests that are subject to ssl_bump rules, that
> processing happens multiple times, at various SslBump steps, as detailed
> at https://wiki.squid-cache.org/Features/SslPeekAndSplice
>
> N.B. http_access check is a part of "Callout Sequence" referenced on the
> above page in step1 and step2. There are some bugs in the current Squid
> implementation of that document, but it is still a useful starting point.
>
>
> > I want to avoid any DNS egress attack.
>
> How do you define "DNS egress attack"? To the extent possible, please
> answer in terms of what Squid should or should not do with traffic Squid
> receives.
>
>
> > The client does not have DNS access.
> > Am I correct that the client can use HTTPS_PROXY without DNS, such
> > that the proxy will perform the DNS lookup?
>
> If you do not control the client, then you should assume that it can
> send any request to/through Squid. This includes sending an HTTPS
> requests without using DNS. Whether the proxy receiving the request is
> going to perform a DNS lookup is a separate question. Many factors
> affect that proxy decision.
>
>
> > Can you help me understand how the acl checks the server_name?
>
> You already know how server_name documentation answers this question. It
> is not clear to me what undocumented aspects you want to know about.
> Could you please clarify by asking a more specific question?
>
>
> > In order to connect to the server, it must perform a DNS lookup, which
> > causes a leak.
>
> Sorry, I am not sure what "it" is in this context, but, as you probably
> already know from the same docs, "Unlike dstdomain, [ssl::server_name]
> ACL does not perform DNS lookups."
>
> If Squid needs to connect to server X, and X is a domain name, Squid
> will (in most cases) attempt to resolve X to get server IP address(es),
> but that attempt happens before and/or after Sqiud evaluates
> ssl::server_name ACL.
>
>
> > So the ACL must validate the server_name without a DNS lookup, and
> > since the server IP is therefore unknown, without connecting to the
> > server or verifying against its certificate.
>
> During server_name ACL evaluation, Squid does not attempt to connection
> to any other server or service. The ACL match/mismatch decision is made
> by comparing various strings using either domain comparison function
> (for server_name) or regex evaluation (for server_name_regex).
>
> The server IP address may or may not be known at ssl::server_name
> evaluation time.
>
>
> > I'm assuming the hostname is known in the CONNECT phase of the request?
>
> Assuming that CONNECT request has arrived at http_port, the answer
> depends on many factors, possibly including:
>
> * whether the client supplied a hostname in CONNECT request headers;
> * whether the client supplied a hostname in TLS SNI field;
> * whether the CONNECT request is subject to ssl_bump rules;
> * whether Squid is opening a tunnel to an origin server or cache_peer
>
> > Is it possible to check against the connect hostname only?
>
> Without SslBump, "dstdomain -n" would probably do that. With SslBump,
> "dstdomain -n" would probably do that during SslBump step1 (and step2 if
> client does not supply TLS SNI). All this needs careful testing though;
> there are many configuration parameters and request specifics at play here!
>
>
> > The docs say that
> >> "The ACL computes server name(s) using such information sources as CONNECT request URI, TLS client SNI, and TLS server certificate subject (CN and SubjectAltName). The computed server name(s) usually change with each SslBump step"
> >
> > I find this concerning, because I assume the client could perform a
> > request with an IP, and a forged SNI name that passes the acl.
> > So I would like to only allow requests that declare FQDN hostname, and
> > reject IP hostnames.
>
> You probably can use dstdomain_reject to reject IP-based hostnames, but
> it may not be easy to do it reliably using regular expressions because
> IP addresses come in many forms. Squid is probably missing an
> "dst_is_ip" or similar ACL(s) to make such checks reliable.
>
>
> > And, only perform validation against the CONNECT request URI.
>
> See above regarding using "dstdomain -n" for this.
>
>
> HTH,
>
> Alex.
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> https://lists.squid-cache.org/listinfo/squid-users


From rousskov at measurement-factory.com  Mon Oct 28 16:05:28 2024
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Mon, 28 Oct 2024 12:05:28 -0400
Subject: [squid-users] Help regarding access controls for TLS connections
In-Reply-To: <CAE5KivggGuNE8S7Hjs_gX0qMLUwJF2XOO0ixGyrOE46YWn_VEA@mail.gmail.com>
References: <CAE5KivgFh1FAqCYctV4soqORLpUzk1FOMkGVb_1T0N=15WtdGg@mail.gmail.com>
 <fb0b75ba-44d9-4552-8ddf-18c42cb3b8de@measurement-factory.com>
 <CAE5KivggGuNE8S7Hjs_gX0qMLUwJF2XOO0ixGyrOE46YWn_VEA@mail.gmail.com>
Message-ID: <4a203e80-bfd3-46d9-8d39-2719691b14da@measurement-factory.com>

On 2024-10-28 11:47, Erik Schulz wrote:

> I realized later that I was applying 'localnet' rules before the
> dstdomain rules, which was the cause of the unauthorized dns lookup.
> By rearranging the rules, such that `dstdomain -n` rules are tested
> first, there is no dns lookup.

Glad you are making progress!


> Well, I do see a reverse dns lookup for
> the client's ip, that I can't explain, but even if that is the case,
> it would require client IP spoofing. But I don't understand why the
> reverse lookup happens. I'm only testing `src`, not `srcdomain`.

Check access_log (including its default in your Squid build). Some of 
the logformat %codes require reverse DNS lookups (e.g., %<A). Same for 
icap_log and some other logs, but they are not enabled by default IIRC.

If logs are not to blame directly, check whether your Squid code has the 
equivalent of the following commit (available in v6+ but not in v5 
AFAICT): 
https://github.com/squid-cache/squid/commit/a8c7a1107de9d9365dfe10749821f74aeedac777


If you want to preclude Squid from making prohibited DNS queries, the 
safest bet may be in configuring Squid to use a DNS resolver (running on 
the same box as Squid) that does not make prohibited DNS queries.  And 
whenever that resolver receives a prohibited DNS query, investigate what 
triggered it -- there may be more bugs in Squid that result in unwanted 
DNS queries. Belt and suspenders...


HTH,

Alex.


> ----
> # deny if not authenticated
> auth_param basic program /usr/lib/squid/basic_ncsa_auth /etc/squid/passwd
> acl authenticated proxy_auth REQUIRED
> http_access deny !authenticated
> 
> # deny if not allowed domains
> acl user_user2 proxy_auth user2
> acl allowed_domains2 dstdomain -n .example.com
> http_access deny user_user2 !allowed_domains2
> 
> # deny public ip
> acl localnet_src src 0.0.0.1-0.255.255.255
> acl localnet_src src 10.0.0.0/8
> acl localnet_src src 100.64.0.0/10
> acl localnet_src src 169.254.0.0/16
> acl localnet_src src 172.16.0.0/12
> acl localnet_src src 192.168.0.0/16
> acl localnet_src src fc00::/7
> acl localnet_src src fe80::/10
> http_access deny !localnet_src
> 
> # deny local destination (resolved hostname)
> acl localnet_dst dst 0.0.0.1-0.255.255.255
> acl localnet_dst dst 10.0.0.0/8
> acl localnet_dst dst 100.64.0.0/10
> acl localnet_dst dst 169.254.0.0/16
> acl localnet_dst dst 172.16.0.0/12
> acl localnet_dst dst 192.168.0.0/16
> acl localnet_dst dst fc00::/7
> acl localnet_dst dst fe80::/10
> http_access deny localnet_dst
> 
> acl Safe_ports port 80
> acl Safe_ports port 443
> http_access deny !Safe_ports
> 
> cache deny all
> 
> http_access allow
> ----
> 
> Regarding what DNS egress attack is:
> The use of a forward proxy ("egress controller") is to prevent
> unauthorized egress, i.e. leaking any data, including TLS or CA
> private keys, which can be relatively few bytes.
> Unauthorized DNS egress is low bandwidth, but that doesn't matter.
> Here is a ChatGPT explanation of what a DNS egress attack is:
> ---
> A DNS egress attack exploits DNS queries to stealthily extract
> sensitive information from within a network. Here?s how it operates
> and why it?s effective:
> - DNS as a Covert Channel: DNS requests are typically unfiltered and
> allowed through most firewalls. Attackers use DNS requests to
> exfiltrate data by embedding information in DNS queries, which often
> bypasses traditional egress filters.
> - Steganography in DNS Requests: Attackers encode sensitive
> information (like passwords or encryption keys) into DNS request
> subdomains. For example, a query like data1234.attacker.com can encode
> data (data1234) before resolving to the attacker-controlled domain.
> - Recursive Resolver Complicity: Since DNS queries are recursively
> resolved, intermediate DNS resolvers help propagate the data-laden
> requests to the final DNS server controlled by the attacker. This adds
> complexity to tracking and blocking the egress path.
> - Low Detectability: Normal DNS queries blend into typical network
> traffic, making these attacks hard to detect, especially if small
> amounts of data are exfiltrated over time.
> - Mitigation Gaps: Most firewalls overlook the payload within DNS
> queries, focusing instead on blocking IPs or domains, which doesn't
> stop the encoding of sensitive data in the DNS request itself.
> - DNS data egress attacks are potent because they exploit a
> foundational internet protocol for covert data transmission. Solutions
> demand vigilant DNS traffic analysis and strict egress filtering
> policies.
> ---
> 
> On Mon, Oct 28, 2024 at 12:14?AM Alex Rousskov
> <rousskov at measurement-factory.com> wrote:
>>
>> On 2024-10-25 18:18, Erik Schulz wrote:
>>
>>> I would like to use squid as an egress proxy, to prevent unauthorized egress.
>>>
>>> Let's say that the only allowed egress is 'example.com'.
>>> I can define acl along the lines of:
>>> ```
>>> acl allowed_domains ssl::server_name .example.com
>>> http_access allow allowed_domains
>>> ```
>>
>>> But can someone help me understand what actually happens?
>>
>> A lot of thing happens, including: After parsing received HTTP(S) or FTP
>> request, Squid checks http_access rules and either allows or denies the
>> request. For HTTPS requests that are subject to ssl_bump rules, that
>> processing happens multiple times, at various SslBump steps, as detailed
>> at https://wiki.squid-cache.org/Features/SslPeekAndSplice
>>
>> N.B. http_access check is a part of "Callout Sequence" referenced on the
>> above page in step1 and step2. There are some bugs in the current Squid
>> implementation of that document, but it is still a useful starting point.
>>
>>
>>> I want to avoid any DNS egress attack.
>>
>> How do you define "DNS egress attack"? To the extent possible, please
>> answer in terms of what Squid should or should not do with traffic Squid
>> receives.
>>
>>
>>> The client does not have DNS access.
>>> Am I correct that the client can use HTTPS_PROXY without DNS, such
>>> that the proxy will perform the DNS lookup?
>>
>> If you do not control the client, then you should assume that it can
>> send any request to/through Squid. This includes sending an HTTPS
>> requests without using DNS. Whether the proxy receiving the request is
>> going to perform a DNS lookup is a separate question. Many factors
>> affect that proxy decision.
>>
>>
>>> Can you help me understand how the acl checks the server_name?
>>
>> You already know how server_name documentation answers this question. It
>> is not clear to me what undocumented aspects you want to know about.
>> Could you please clarify by asking a more specific question?
>>
>>
>>> In order to connect to the server, it must perform a DNS lookup, which
>>> causes a leak.
>>
>> Sorry, I am not sure what "it" is in this context, but, as you probably
>> already know from the same docs, "Unlike dstdomain, [ssl::server_name]
>> ACL does not perform DNS lookups."
>>
>> If Squid needs to connect to server X, and X is a domain name, Squid
>> will (in most cases) attempt to resolve X to get server IP address(es),
>> but that attempt happens before and/or after Sqiud evaluates
>> ssl::server_name ACL.
>>
>>
>>> So the ACL must validate the server_name without a DNS lookup, and
>>> since the server IP is therefore unknown, without connecting to the
>>> server or verifying against its certificate.
>>
>> During server_name ACL evaluation, Squid does not attempt to connection
>> to any other server or service. The ACL match/mismatch decision is made
>> by comparing various strings using either domain comparison function
>> (for server_name) or regex evaluation (for server_name_regex).
>>
>> The server IP address may or may not be known at ssl::server_name
>> evaluation time.
>>
>>
>>> I'm assuming the hostname is known in the CONNECT phase of the request?
>>
>> Assuming that CONNECT request has arrived at http_port, the answer
>> depends on many factors, possibly including:
>>
>> * whether the client supplied a hostname in CONNECT request headers;
>> * whether the client supplied a hostname in TLS SNI field;
>> * whether the CONNECT request is subject to ssl_bump rules;
>> * whether Squid is opening a tunnel to an origin server or cache_peer
>>
>>> Is it possible to check against the connect hostname only?
>>
>> Without SslBump, "dstdomain -n" would probably do that. With SslBump,
>> "dstdomain -n" would probably do that during SslBump step1 (and step2 if
>> client does not supply TLS SNI). All this needs careful testing though;
>> there are many configuration parameters and request specifics at play here!
>>
>>
>>> The docs say that
>>>> "The ACL computes server name(s) using such information sources as CONNECT request URI, TLS client SNI, and TLS server certificate subject (CN and SubjectAltName). The computed server name(s) usually change with each SslBump step"
>>>
>>> I find this concerning, because I assume the client could perform a
>>> request with an IP, and a forged SNI name that passes the acl.
>>> So I would like to only allow requests that declare FQDN hostname, and
>>> reject IP hostnames.
>>
>> You probably can use dstdomain_reject to reject IP-based hostnames, but
>> it may not be easy to do it reliably using regular expressions because
>> IP addresses come in many forms. Squid is probably missing an
>> "dst_is_ip" or similar ACL(s) to make such checks reliable.
>>
>>
>>> And, only perform validation against the CONNECT request URI.
>>
>> See above regarding using "dstdomain -n" for this.
>>
>>
>> HTH,
>>
>> Alex.
>>
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> https://lists.squid-cache.org/listinfo/squid-users



From Josh.Piana at hexcel.com  Mon Oct 28 19:08:25 2024
From: Josh.Piana at hexcel.com (Piana, Josh)
Date: Mon, 28 Oct 2024 19:08:25 +0000
Subject: [squid-users] FW:  proxy_auth_regex
References: <d450806e84f1439cb82e0fd071e6ec99@hexcel.com>
 <d7848963-b7d7-45a2-a676-c12f4044ccc0@measurement-factory.com>
 <1d43b17c9ca14400a0d0edbcd0cb33f5@hexcel.com>
 <23a68428-70cd-401a-b5d3-c47a22c95850@measurement-factory.com> 
Message-ID: <542659309cf7486b80d19a6207848825@hexcel.com>

Hey Alex, 

Here's a quick glimpse at what the cache.log is saying. 

2024/10/25 11:49:18 kid1| ERROR: Negotiate Authentication validating user. Result: {result=BH, notes={message: gss_acquire_cred() failed: No credentials were supplied, or the credentials were unavailable or inaccessible. No principal in keytab matches desired name; }}
    current master transaction: master293

2024/10/25 11:49:18 kid1| Starting new negotiateauthenticator helpers...
    current master transaction: master1444

2024/10/25 11:49:18 kid1| helperOpenServers: Starting 1/10 'negotiate_kerberos_auth' processes
    current master transaction: master1444

2024/10/25 11:49:18 kid1| Starting new negotiateauthenticator helpers...
    current master transaction: master1445

2024/10/25 11:49:18 kid1| helperOpenServers: Starting 1/10 'negotiate_kerberos_auth' processes
    current master transaction: master1445

2024/10/25 11:49:18 kid1| ERROR: Negotiate Authentication validating user. Result: {result=BH, notes={message: gss_acquire_cred() failed: No credentials were supplied, or the credentials were unavailable or inaccessible. No principal in keytab matches desired name; }}
    current master transaction: master1082

-----Original Message-----
From: Alex Rousskov <rousskov at measurement-factory.com>
Sent: Thursday, October 24, 2024 4:46 PM
To: Piana, Josh <Josh.Piana at hexcel.com>; squid-users at lists.squid-cache.org
Subject: Re: [squid-users] proxy_auth_regex

Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.


On 2024-10-24 16:23, Piana, Josh wrote:

> From what I can tell, squid does not receive a good username. When I check the access logs, I receive something like this:

> 24/Oct/2024:16:01:08 -0400.334 10.46.49.190 TCP_DENIED/407 7821 
> CONNECT 
> http://www.g/
> oogle.com%3A443%2F&data=05%7C02%7CJosh.Piana%40hexcel.com%7C29bbc9983f
> 2742ff81e108dcf46cd820%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C63
> 8653995560620056%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV
> 2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C60000%7C%7C%7C&sdata=W%2BZDXkp
> r6hr5wvICtWMUGsugzHqz7%2BHS7UEKX7N5CPI%3D&reserved=0 - \ HIER_NONE/- 
> text/html ERR_CACHE_ACCESS_DENIED/-

Please check CONNECT request headers in packet captures or cache.log with debug_options set to ALL,2. If client does not send any user credentials to Squid, then Squid should request them (with a 407 CONNECT response containing appropriate headers).


> In regards to the TLS connectors vs HTTP CONNECT requests ...
 > I'm not sure if that is the case

Does the problematic test transaction arrive at http_port or https_port?


 > is "proxy_auth_regex" not compatible with certain things?

Nearly every Squid configuration option is not compatible with certain things.


 > How would you recommend I test plain http traffic?

I would start with

     curl --verbose ... http://example.com/

or a similar request (add proxy/other options instead of "..." as needed).

Alex.



> However, I think some of my log information may be missing. I believe you mentioned it before, so I'll show you what I'm using for our custom log directive. Maybe we can fix this too? What I originally tried to do with this was just get "human readable" time stamps:
> logformat custom %tl.%03tu %>a %Ss/%03>Hs %<st %rm %ru %[un \ %Sh/%<a 
> %mt %err_code/%err_detail
>
> In regards to the TLS connectors vs HTTP CONNECT requests, that is a great point. I'm not sure if that is the case, but is "proxy_auth_regex" not compatible with certain things? How would you recommend I test plain http traffic?
>
>
> -----Original Message-----
> From: Alex Rousskov <rousskov at measurement-factory.com>
> Sent: Thursday, October 24, 2024 4:13 PM
> To: Piana, Josh <Josh.Piana at hexcel.com>; 
> squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] proxy_auth_regex
>
> Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.
>
>
> On 2024-10-24 15:53, Piana, Josh wrote:
>> Hey Squid users,
>>
>> Running into an issue I?m trying to figure out.
>>
>> We have a few acl directives using ?proxy_auth_regex ?i? and when I 
>> have these active, it blocks any proxy connection with an HTTP 407 
>> error, according to the logs.
>>
>> Here?s an example:
>>
>> # block certain user IDs from using proxy server
>>
>> #acl block_user proxy_auth_regex -i "/etc/squid/block_user"
>>
>> #http_access deny block_user
>>
>> What?s supposed to happen with this ACL, is that any username we have 
>> on that list is to be blocked from internet access. But it seems to 
>> be blocking known good usernames too. I?m not sure where to go from 
>> here
>
> After asking for one with a 407 response, does Squid ever receive a "good username" from the client? Do you see a username in client HTTP request headers or access.log records containing %un field?
>
> Perhaps the client refuses to authenticate its requests because Squid intercepts TLS client connections rather than receiving HTTP CONNECT requests from the client? Have you tested this with plain text traffic?
>
> Alex.
>
>
>> we would like to use these ACL?s but for right now I have these rules 
>> commented out.
>>
>> Here's a few other rules we have that have the same issue:
>>
>> # executable blocking
>>
>> # reference this list for extensions to block
>>
>> acl exec_files url_regex -i "/etc/squid/exec_files"
>>
>> # ignore these usernames from being blocked
>>
>> #acl exec_users proxy_auth_regex -i "/etc/squid/exec_users"
>>
>> # combine the rules
>>
>> #http_access deny !bad_exception_urls !exec_users exec_files
>>
>> #deny_info ERR_BLOCK_TYPE exec_files
>>
>>   From what you can see above, we have ?acl exec_files url_regex -i 
>> /etc/squid/exec_files" uncommented, but it?s not active because the 
>> ?http_access directive? had to be commented out because it includes 
>> the other statements that include ?proxy_auth_regex ?i? which block 
>> all internet access as well.
>>
>>
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> https://lis/
>> t%2F&data=05%7C02%7CJosh.Piana%40hexcel.com%7C29bbc9983f2742ff81e108d
>> cf46cd820%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C63865399556062
>> 0056%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJB
>> TiI6Ik1haWwiLCJXVCI6Mn0%3D%7C60000%7C%7C%7C&sdata=PCQLdRbIhLqZa1TDHvK
>> 3tJ4%2Ft7KciRwqiLysnAUxzcE%3D&reserved=0
>> s.squid-cache.org%2Flistinfo%2Fsquid-users&data=05%7C02%7CJosh.Piana%
>> 4
>> 0hexcel.com%7C7fb1087ae57b47c397a408dcf4684eaf%7C4248050df19546d5ac9c
>> 0
>> c7c52b04cae%7C0%7C0%7C638653976041876515%7CUnknown%7CTWFpbGZsb3d8eyJW
>> I
>> joiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%
>> 7
>> C%7C&sdata=D6d%2BXvUp%2FHTvsqC5oneWw%2FdYNWYkmsQUz0lKHLzRk0o%3D&reser
>> v
>> ed=0
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> https://list/
> s.squid-cache.org%2Flistinfo%2Fsquid-users&data=05%7C02%7CJosh.Piana%4
> 0hexcel.com%7C29bbc9983f2742ff81e108dcf46cd820%7C4248050df19546d5ac9c0
> c7c52b04cae%7C0%7C0%7C638653995560776281%7CUnknown%7CTWFpbGZsb3d8eyJWI
> joiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C60000%
> 7C%7C%7C&sdata=oAOv7ObjGY%2FIMJOAC0LdMf0eJ1wzpn6P0Q5tCNOvSTY%3D&reserv
> ed=0


From rousskov at measurement-factory.com  Mon Oct 28 19:17:13 2024
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Mon, 28 Oct 2024 15:17:13 -0400
Subject: [squid-users] FW: proxy_auth_regex
In-Reply-To: <542659309cf7486b80d19a6207848825@hexcel.com>
References: <d450806e84f1439cb82e0fd071e6ec99@hexcel.com>
 <d7848963-b7d7-45a2-a676-c12f4044ccc0@measurement-factory.com>
 <1d43b17c9ca14400a0d0edbcd0cb33f5@hexcel.com>
 <23a68428-70cd-401a-b5d3-c47a22c95850@measurement-factory.com>
 <542659309cf7486b80d19a6207848825@hexcel.com>
Message-ID: <0b8969d6-17a6-459f-8191-2e08742c86c3@measurement-factory.com>

On 2024-10-28 15:08, Piana, Josh wrote:

> 2024/10/25 11:49:18 kid1| ERROR: Negotiate Authentication validating user. Result: {result=BH, notes={message: gss_acquire_cred() failed: No credentials were supplied, or the credentials were unavailable or inaccessible. No principal in keytab matches desired name; }}

Yes, I have already responded to email with that information. Please 
continue that thread: 
https://lists.squid-cache.org/pipermail/squid-users/2024-October/027224.html

Alex.

> -----Original Message-----
> From: Alex Rousskov <rousskov at measurement-factory.com>
> Sent: Thursday, October 24, 2024 4:46 PM
> To: Piana, Josh <Josh.Piana at hexcel.com>; squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] proxy_auth_regex
> 
> Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.
> 
> 
> On 2024-10-24 16:23, Piana, Josh wrote:
> 
>>  From what I can tell, squid does not receive a good username. When I check the access logs, I receive something like this:
> 
>> 24/Oct/2024:16:01:08 -0400.334 10.46.49.190 TCP_DENIED/407 7821
>> CONNECT
>> http://www.g/
>> oogle.com%3A443%2F&data=05%7C02%7CJosh.Piana%40hexcel.com%7C29bbc9983f
>> 2742ff81e108dcf46cd820%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C63
>> 8653995560620056%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV
>> 2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C60000%7C%7C%7C&sdata=W%2BZDXkp
>> r6hr5wvICtWMUGsugzHqz7%2BHS7UEKX7N5CPI%3D&reserved=0 - \ HIER_NONE/-
>> text/html ERR_CACHE_ACCESS_DENIED/-
> 
> Please check CONNECT request headers in packet captures or cache.log with debug_options set to ALL,2. If client does not send any user credentials to Squid, then Squid should request them (with a 407 CONNECT response containing appropriate headers).
> 
> 
>> In regards to the TLS connectors vs HTTP CONNECT requests ...
>   > I'm not sure if that is the case
> 
> Does the problematic test transaction arrive at http_port or https_port?
> 
> 
>   > is "proxy_auth_regex" not compatible with certain things?
> 
> Nearly every Squid configuration option is not compatible with certain things.
> 
> 
>   > How would you recommend I test plain http traffic?
> 
> I would start with
> 
>       curl --verbose ... http://example.com/
> 
> or a similar request (add proxy/other options instead of "..." as needed).
> 
> Alex.
> 
> 
> 
>> However, I think some of my log information may be missing. I believe you mentioned it before, so I'll show you what I'm using for our custom log directive. Maybe we can fix this too? What I originally tried to do with this was just get "human readable" time stamps:
>> logformat custom %tl.%03tu %>a %Ss/%03>Hs %<st %rm %ru %[un \ %Sh/%<a
>> %mt %err_code/%err_detail
>>
>> In regards to the TLS connectors vs HTTP CONNECT requests, that is a great point. I'm not sure if that is the case, but is "proxy_auth_regex" not compatible with certain things? How would you recommend I test plain http traffic?
>>
>>
>> -----Original Message-----
>> From: Alex Rousskov <rousskov at measurement-factory.com>
>> Sent: Thursday, October 24, 2024 4:13 PM
>> To: Piana, Josh <Josh.Piana at hexcel.com>;
>> squid-users at lists.squid-cache.org
>> Subject: Re: [squid-users] proxy_auth_regex
>>
>> Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.
>>
>>
>> On 2024-10-24 15:53, Piana, Josh wrote:
>>> Hey Squid users,
>>>
>>> Running into an issue I?m trying to figure out.
>>>
>>> We have a few acl directives using ?proxy_auth_regex ?i? and when I
>>> have these active, it blocks any proxy connection with an HTTP 407
>>> error, according to the logs.
>>>
>>> Here?s an example:
>>>
>>> # block certain user IDs from using proxy server
>>>
>>> #acl block_user proxy_auth_regex -i "/etc/squid/block_user"
>>>
>>> #http_access deny block_user
>>>
>>> What?s supposed to happen with this ACL, is that any username we have
>>> on that list is to be blocked from internet access. But it seems to
>>> be blocking known good usernames too. I?m not sure where to go from
>>> here
>>
>> After asking for one with a 407 response, does Squid ever receive a "good username" from the client? Do you see a username in client HTTP request headers or access.log records containing %un field?
>>
>> Perhaps the client refuses to authenticate its requests because Squid intercepts TLS client connections rather than receiving HTTP CONNECT requests from the client? Have you tested this with plain text traffic?
>>
>> Alex.
>>
>>
>>> we would like to use these ACL?s but for right now I have these rules
>>> commented out.
>>>
>>> Here's a few other rules we have that have the same issue:
>>>
>>> # executable blocking
>>>
>>> # reference this list for extensions to block
>>>
>>> acl exec_files url_regex -i "/etc/squid/exec_files"
>>>
>>> # ignore these usernames from being blocked
>>>
>>> #acl exec_users proxy_auth_regex -i "/etc/squid/exec_users"
>>>
>>> # combine the rules
>>>
>>> #http_access deny !bad_exception_urls !exec_users exec_files
>>>
>>> #deny_info ERR_BLOCK_TYPE exec_files
>>>
>>>    From what you can see above, we have ?acl exec_files url_regex -i
>>> /etc/squid/exec_files" uncommented, but it?s not active because the
>>> ?http_access directive? had to be commented out because it includes
>>> the other statements that include ?proxy_auth_regex ?i? which block
>>> all internet access as well.
>>>
>>>
>>> _______________________________________________
>>> squid-users mailing list
>>> squid-users at lists.squid-cache.org
>>> https://lis/
>>> t%2F&data=05%7C02%7CJosh.Piana%40hexcel.com%7C29bbc9983f2742ff81e108d
>>> cf46cd820%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C63865399556062
>>> 0056%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJB
>>> TiI6Ik1haWwiLCJXVCI6Mn0%3D%7C60000%7C%7C%7C&sdata=PCQLdRbIhLqZa1TDHvK
>>> 3tJ4%2Ft7KciRwqiLysnAUxzcE%3D&reserved=0
>>> s.squid-cache.org%2Flistinfo%2Fsquid-users&data=05%7C02%7CJosh.Piana%
>>> 4
>>> 0hexcel.com%7C7fb1087ae57b47c397a408dcf4684eaf%7C4248050df19546d5ac9c
>>> 0
>>> c7c52b04cae%7C0%7C0%7C638653976041876515%7CUnknown%7CTWFpbGZsb3d8eyJW
>>> I
>>> joiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%
>>> 7
>>> C%7C&sdata=D6d%2BXvUp%2FHTvsqC5oneWw%2FdYNWYkmsQUz0lKHLzRk0o%3D&reser
>>> v
>>> ed=0
>>
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> https://list/
>> s.squid-cache.org%2Flistinfo%2Fsquid-users&data=05%7C02%7CJosh.Piana%4
>> 0hexcel.com%7C29bbc9983f2742ff81e108dcf46cd820%7C4248050df19546d5ac9c0
>> c7c52b04cae%7C0%7C0%7C638653995560776281%7CUnknown%7CTWFpbGZsb3d8eyJWI
>> joiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C60000%
>> 7C%7C%7C&sdata=oAOv7ObjGY%2FIMJOAC0LdMf0eJ1wzpn6P0Q5tCNOvSTY%3D&reserv
>> ed=0
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> https://lists.squid-cache.org/listinfo/squid-users



From Josh.Piana at hexcel.com  Mon Oct 28 20:35:32 2024
From: Josh.Piana at hexcel.com (Piana, Josh)
Date: Mon, 28 Oct 2024 20:35:32 +0000
Subject: [squid-users] proxy_auth_regex
In-Reply-To: <23a68428-70cd-401a-b5d3-c47a22c95850@measurement-factory.com>
References: <d450806e84f1439cb82e0fd071e6ec99@hexcel.com>
 <d7848963-b7d7-45a2-a676-c12f4044ccc0@measurement-factory.com>
 <1d43b17c9ca14400a0d0edbcd0cb33f5@hexcel.com>
 <23a68428-70cd-401a-b5d3-c47a22c95850@measurement-factory.com>
Message-ID: <dc9e60d731fe4000b1e0a1077754de9b@hexcel.com>

Hey everyone, 

Continuing to look into this further. 

TL;DR, anytime I turn on one of our ACL's that have "proxy_auth_regex", I'm unable to access the internet through the proxy at all. 

Here's an example of one of our rules: 

# block certain user IDs from using proxy server
acl block_user proxy_auth_regex -i "/etc/squid/block_user"
http_access deny block_user

I'm testing with an account that is not on the "block_user" list. Yet, when I browse to known good sites, I'm met with a generic webpage error, and not a squid error. The generic error, using Firefox, is "The proxy server is refusing connections". Yet, activating that ACL should not have this behavior. Only if a username that's a part of the block_user list is on there. This is the same for the 3 other rules we're using " proxy_auth_regex" for. Which leads me to believe we're not able to pass what the directive is asking for. 

The issue is, I'm having trouble pinpointing it. 

I went here, on the Squid config pages and looked into it further:
https://www.squid-cache.org/Doc/config/acl/

I read the notes for this directive but I'm still a bit confused on where the issue is. Authentication seems to be working, but it's like this term either doesn't pass the credentials along, or it's expecting some other response. Is there anyone that could help me figure out what the issue is with this? 

Thank you, 
Josh 

-----Original Message-----
From: Alex Rousskov <rousskov at measurement-factory.com> 
Sent: Thursday, October 24, 2024 4:46 PM
To: Piana, Josh <Josh.Piana at hexcel.com>; squid-users at lists.squid-cache.org
Subject: Re: [squid-users] proxy_auth_regex

Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.


On 2024-10-24 16:23, Piana, Josh wrote:

> From what I can tell, squid does not receive a good username. When I check the access logs, I receive something like this:

> 24/Oct/2024:16:01:08 -0400.334 10.46.49.190 TCP_DENIED/407 7821 
> CONNECT 
> http://www.g/
> oogle.com%3A443%2F&data=05%7C02%7CJosh.Piana%40hexcel.com%7C29bbc9983f
> 2742ff81e108dcf46cd820%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C63
> 8653995560620056%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV
> 2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C60000%7C%7C%7C&sdata=W%2BZDXkp
> r6hr5wvICtWMUGsugzHqz7%2BHS7UEKX7N5CPI%3D&reserved=0 - \ HIER_NONE/- 
> text/html ERR_CACHE_ACCESS_DENIED/-

Please check CONNECT request headers in packet captures or cache.log with debug_options set to ALL,2. If client does not send any user credentials to Squid, then Squid should request them (with a 407 CONNECT response containing appropriate headers).


> In regards to the TLS connectors vs HTTP CONNECT requests ...
 > I'm not sure if that is the case

Does the problematic test transaction arrive at http_port or https_port?


 > is "proxy_auth_regex" not compatible with certain things?

Nearly every Squid configuration option is not compatible with certain things.


 > How would you recommend I test plain http traffic?

I would start with

     curl --verbose ... http://example.com/

or a similar request (add proxy/other options instead of "..." as needed).

Alex.



> However, I think some of my log information may be missing. I believe you mentioned it before, so I'll show you what I'm using for our custom log directive. Maybe we can fix this too? What I originally tried to do with this was just get "human readable" time stamps:
> logformat custom %tl.%03tu %>a %Ss/%03>Hs %<st %rm %ru %[un \ %Sh/%<a 
> %mt %err_code/%err_detail
>
> In regards to the TLS connectors vs HTTP CONNECT requests, that is a great point. I'm not sure if that is the case, but is "proxy_auth_regex" not compatible with certain things? How would you recommend I test plain http traffic?
>
>
> -----Original Message-----
> From: Alex Rousskov <rousskov at measurement-factory.com>
> Sent: Thursday, October 24, 2024 4:13 PM
> To: Piana, Josh <Josh.Piana at hexcel.com>; 
> squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] proxy_auth_regex
>
> Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.
>
>
> On 2024-10-24 15:53, Piana, Josh wrote:
>> Hey Squid users,
>>
>> Running into an issue I?m trying to figure out.
>>
>> We have a few acl directives using ?proxy_auth_regex ?i? and when I 
>> have these active, it blocks any proxy connection with an HTTP 407 
>> error, according to the logs.
>>
>> Here?s an example:
>>
>> # block certain user IDs from using proxy server
>>
>> #acl block_user proxy_auth_regex -i "/etc/squid/block_user"
>>
>> #http_access deny block_user
>>
>> What?s supposed to happen with this ACL, is that any username we have 
>> on that list is to be blocked from internet access. But it seems to 
>> be blocking known good usernames too. I?m not sure where to go from 
>> here
>
> After asking for one with a 407 response, does Squid ever receive a "good username" from the client? Do you see a username in client HTTP request headers or access.log records containing %un field?
>
> Perhaps the client refuses to authenticate its requests because Squid intercepts TLS client connections rather than receiving HTTP CONNECT requests from the client? Have you tested this with plain text traffic?
>
> Alex.
>
>
>> we would like to use these ACL?s but for right now I have these rules 
>> commented out.
>>
>> Here's a few other rules we have that have the same issue:
>>
>> # executable blocking
>>
>> # reference this list for extensions to block
>>
>> acl exec_files url_regex -i "/etc/squid/exec_files"
>>
>> # ignore these usernames from being blocked
>>
>> #acl exec_users proxy_auth_regex -i "/etc/squid/exec_users"
>>
>> # combine the rules
>>
>> #http_access deny !bad_exception_urls !exec_users exec_files
>>
>> #deny_info ERR_BLOCK_TYPE exec_files
>>
>>   From what you can see above, we have ?acl exec_files url_regex -i 
>> /etc/squid/exec_files" uncommented, but it?s not active because the 
>> ?http_access directive? had to be commented out because it includes 
>> the other statements that include ?proxy_auth_regex ?i? which block 
>> all internet access as well.
>>
>>
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> https://lis/
>> t%2F&data=05%7C02%7CJosh.Piana%40hexcel.com%7C29bbc9983f2742ff81e108d
>> cf46cd820%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C63865399556062
>> 0056%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJB
>> TiI6Ik1haWwiLCJXVCI6Mn0%3D%7C60000%7C%7C%7C&sdata=PCQLdRbIhLqZa1TDHvK
>> 3tJ4%2Ft7KciRwqiLysnAUxzcE%3D&reserved=0
>> s.squid-cache.org%2Flistinfo%2Fsquid-users&data=05%7C02%7CJosh.Piana%
>> 4
>> 0hexcel.com%7C7fb1087ae57b47c397a408dcf4684eaf%7C4248050df19546d5ac9c
>> 0 
>> c7c52b04cae%7C0%7C0%7C638653976041876515%7CUnknown%7CTWFpbGZsb3d8eyJW
>> I
>> joiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%
>> 7 
>> C%7C&sdata=D6d%2BXvUp%2FHTvsqC5oneWw%2FdYNWYkmsQUz0lKHLzRk0o%3D&reser
>> v
>> ed=0
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> https://list/
> s.squid-cache.org%2Flistinfo%2Fsquid-users&data=05%7C02%7CJosh.Piana%4
> 0hexcel.com%7C29bbc9983f2742ff81e108dcf46cd820%7C4248050df19546d5ac9c0
> c7c52b04cae%7C0%7C0%7C638653995560776281%7CUnknown%7CTWFpbGZsb3d8eyJWI
> joiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C60000%
> 7C%7C%7C&sdata=oAOv7ObjGY%2FIMJOAC0LdMf0eJ1wzpn6P0Q5tCNOvSTY%3D&reserv
> ed=0


From rousskov at measurement-factory.com  Mon Oct 28 23:09:03 2024
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Mon, 28 Oct 2024 19:09:03 -0400
Subject: [squid-users] proxy_auth_regex
In-Reply-To: <dc9e60d731fe4000b1e0a1077754de9b@hexcel.com>
References: <d450806e84f1439cb82e0fd071e6ec99@hexcel.com>
 <d7848963-b7d7-45a2-a676-c12f4044ccc0@measurement-factory.com>
 <1d43b17c9ca14400a0d0edbcd0cb33f5@hexcel.com>
 <23a68428-70cd-401a-b5d3-c47a22c95850@measurement-factory.com>
 <dc9e60d731fe4000b1e0a1077754de9b@hexcel.com>
Message-ID: <8ac4926f-e751-4d85-86f8-32beaa30dd07@measurement-factory.com>

On 2024-10-28 16:35, Piana, Josh wrote:

> TL;DR, anytime I turn on one of our ACL's that have
> "proxy_auth_regex", I'm unable to access the internet through the
> proxy at all.

Hello Josh,

     Your Squid authentication helper probably does not work. Until that 
problem is fixed, you will not be able to use authentication ACLs 
reliably or at all, as detailed at 
https://lists.squid-cache.org/pipermail/squid-users/2024-October/027224.html

Alex.


> Here's an example of one of our rules:
> 
> # block certain user IDs from using proxy server
> acl block_user proxy_auth_regex -i "/etc/squid/block_user"
> http_access deny block_user
> 
> I'm testing with an account that is not on the "block_user" list. Yet, when I browse to known good sites, I'm met with a generic webpage error, and not a squid error. The generic error, using Firefox, is "The proxy server is refusing connections". Yet, activating that ACL should not have this behavior. Only if a username that's a part of the block_user list is on there. This is the same for the 3 other rules we're using " proxy_auth_regex" for. Which leads me to believe we're not able to pass what the directive is asking for.
> 
> The issue is, I'm having trouble pinpointing it.
> 
> I went here, on the Squid config pages and looked into it further:
> https://www.squid-cache.org/Doc/config/acl/
> 
> I read the notes for this directive but I'm still a bit confused on where the issue is. Authentication seems to be working, but it's like this term either doesn't pass the credentials along, or it's expecting some other response. Is there anyone that could help me figure out what the issue is with this?
> 
> Thank you,
> Josh
> 
> -----Original Message-----
> From: Alex Rousskov <rousskov at measurement-factory.com>
> Sent: Thursday, October 24, 2024 4:46 PM
> To: Piana, Josh <Josh.Piana at hexcel.com>; squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] proxy_auth_regex
> 
> Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.
> 
> 
> On 2024-10-24 16:23, Piana, Josh wrote:
> 
>>  From what I can tell, squid does not receive a good username. When I check the access logs, I receive something like this:
> 
>> 24/Oct/2024:16:01:08 -0400.334 10.46.49.190 TCP_DENIED/407 7821
>> CONNECT
>> http://www.g/
>> oogle.com%3A443%2F&data=05%7C02%7CJosh.Piana%40hexcel.com%7C29bbc9983f
>> 2742ff81e108dcf46cd820%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C63
>> 8653995560620056%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV
>> 2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C60000%7C%7C%7C&sdata=W%2BZDXkp
>> r6hr5wvICtWMUGsugzHqz7%2BHS7UEKX7N5CPI%3D&reserved=0 - \ HIER_NONE/-
>> text/html ERR_CACHE_ACCESS_DENIED/-
> 
> Please check CONNECT request headers in packet captures or cache.log with debug_options set to ALL,2. If client does not send any user credentials to Squid, then Squid should request them (with a 407 CONNECT response containing appropriate headers).
> 
> 
>> In regards to the TLS connectors vs HTTP CONNECT requests ...
>   > I'm not sure if that is the case
> 
> Does the problematic test transaction arrive at http_port or https_port?
> 
> 
>   > is "proxy_auth_regex" not compatible with certain things?
> 
> Nearly every Squid configuration option is not compatible with certain things.
> 
> 
>   > How would you recommend I test plain http traffic?
> 
> I would start with
> 
>       curl --verbose ... http://example.com/
> 
> or a similar request (add proxy/other options instead of "..." as needed).
> 
> Alex.
> 
> 
> 
>> However, I think some of my log information may be missing. I believe you mentioned it before, so I'll show you what I'm using for our custom log directive. Maybe we can fix this too? What I originally tried to do with this was just get "human readable" time stamps:
>> logformat custom %tl.%03tu %>a %Ss/%03>Hs %<st %rm %ru %[un \ %Sh/%<a
>> %mt %err_code/%err_detail
>>
>> In regards to the TLS connectors vs HTTP CONNECT requests, that is a great point. I'm not sure if that is the case, but is "proxy_auth_regex" not compatible with certain things? How would you recommend I test plain http traffic?
>>
>>
>> -----Original Message-----
>> From: Alex Rousskov <rousskov at measurement-factory.com>
>> Sent: Thursday, October 24, 2024 4:13 PM
>> To: Piana, Josh <Josh.Piana at hexcel.com>;
>> squid-users at lists.squid-cache.org
>> Subject: Re: [squid-users] proxy_auth_regex
>>
>> Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.
>>
>>
>> On 2024-10-24 15:53, Piana, Josh wrote:
>>> Hey Squid users,
>>>
>>> Running into an issue I?m trying to figure out.
>>>
>>> We have a few acl directives using ?proxy_auth_regex ?i? and when I
>>> have these active, it blocks any proxy connection with an HTTP 407
>>> error, according to the logs.
>>>
>>> Here?s an example:
>>>
>>> # block certain user IDs from using proxy server
>>>
>>> #acl block_user proxy_auth_regex -i "/etc/squid/block_user"
>>>
>>> #http_access deny block_user
>>>
>>> What?s supposed to happen with this ACL, is that any username we have
>>> on that list is to be blocked from internet access. But it seems to
>>> be blocking known good usernames too. I?m not sure where to go from
>>> here
>>
>> After asking for one with a 407 response, does Squid ever receive a "good username" from the client? Do you see a username in client HTTP request headers or access.log records containing %un field?
>>
>> Perhaps the client refuses to authenticate its requests because Squid intercepts TLS client connections rather than receiving HTTP CONNECT requests from the client? Have you tested this with plain text traffic?
>>
>> Alex.
>>
>>
>>> we would like to use these ACL?s but for right now I have these rules
>>> commented out.
>>>
>>> Here's a few other rules we have that have the same issue:
>>>
>>> # executable blocking
>>>
>>> # reference this list for extensions to block
>>>
>>> acl exec_files url_regex -i "/etc/squid/exec_files"
>>>
>>> # ignore these usernames from being blocked
>>>
>>> #acl exec_users proxy_auth_regex -i "/etc/squid/exec_users"
>>>
>>> # combine the rules
>>>
>>> #http_access deny !bad_exception_urls !exec_users exec_files
>>>
>>> #deny_info ERR_BLOCK_TYPE exec_files
>>>
>>>    From what you can see above, we have ?acl exec_files url_regex -i
>>> /etc/squid/exec_files" uncommented, but it?s not active because the
>>> ?http_access directive? had to be commented out because it includes
>>> the other statements that include ?proxy_auth_regex ?i? which block
>>> all internet access as well.
>>>
>>>
>>> _______________________________________________
>>> squid-users mailing list
>>> squid-users at lists.squid-cache.org
>>> https://lis/
>>> t%2F&data=05%7C02%7CJosh.Piana%40hexcel.com%7C29bbc9983f2742ff81e108d
>>> cf46cd820%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C63865399556062
>>> 0056%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJB
>>> TiI6Ik1haWwiLCJXVCI6Mn0%3D%7C60000%7C%7C%7C&sdata=PCQLdRbIhLqZa1TDHvK
>>> 3tJ4%2Ft7KciRwqiLysnAUxzcE%3D&reserved=0
>>> s.squid-cache.org%2Flistinfo%2Fsquid-users&data=05%7C02%7CJosh.Piana%
>>> 4
>>> 0hexcel.com%7C7fb1087ae57b47c397a408dcf4684eaf%7C4248050df19546d5ac9c
>>> 0
>>> c7c52b04cae%7C0%7C0%7C638653976041876515%7CUnknown%7CTWFpbGZsb3d8eyJW
>>> I
>>> joiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%
>>> 7
>>> C%7C&sdata=D6d%2BXvUp%2FHTvsqC5oneWw%2FdYNWYkmsQUz0lKHLzRk0o%3D&reser
>>> v
>>> ed=0
>>
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> https://list/
>> s.squid-cache.org%2Flistinfo%2Fsquid-users&data=05%7C02%7CJosh.Piana%4
>> 0hexcel.com%7C29bbc9983f2742ff81e108dcf46cd820%7C4248050df19546d5ac9c0
>> c7c52b04cae%7C0%7C0%7C638653995560776281%7CUnknown%7CTWFpbGZsb3d8eyJWI
>> joiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C60000%
>> 7C%7C%7C&sdata=oAOv7ObjGY%2FIMJOAC0LdMf0eJ1wzpn6P0Q5tCNOvSTY%3D&reserv
>> ed=0
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> https://lists.squid-cache.org/listinfo/squid-users



From rafael.akchurin at diladele.com  Tue Oct 29 19:11:33 2024
From: rafael.akchurin at diladele.com (Rafael Akchurin)
Date: Tue, 29 Oct 2024 19:11:33 +0000
Subject: [squid-users] Ubuntu 22.04 LTS repository for Squid 6.12 (rebuilt
 from sources in Debian)
Message-ID: <DBAPR04MB7351F5C4D0231D0906BDFF828F4B2@DBAPR04MB7351.eurprd04.prod.outlook.com>

Hello everyone,

Online repository with latest Squid 6.12 (rebuilt from sources in Debian) for Ubuntu 22.04 LTS 64-bit is available at https://squid612.diladele.com/.
Github repo https://github.com/diladele/squid-ubuntu/tree/feature-squid612/src/ubuntu22 contains all the scripts we used to make this compilation (note that scripts are not in master but in feature-squid612 just because we will only use it in Web Safety 9.4 which is being developed now).

Here are simple instructions how to use the repo. For more information see readme at https://github.com/diladele/squid-ubuntu .

# add diladele apt key
wget -qO - https://packages.diladele.com/diladele_pub.asc | sudo apt-key add -

# add new repo
echo "deb https://squid612.diladele.com/ubuntu/ jammy main" \
    > /etc/apt/sources.list.d/squid612.diladele.com.list

# and install
apt-get update && apt-get install -y \
    squid-common \
    squid-openssl \
    squidclient \
    libecap3 libecap3-dev

# optional ? switch to openssl based squid
update-alternatives --set squid /usr/sbin/squid-openssl

This version of Squid will be part of Web Safety 9.4 coming out in the beginning of 2025.  If you have some spare time and are interested in Admin UI for Squid and ICAP web filtering, consider downloading a Web Safety appliance for VMware ESXi/vSphere<https://packages.diladele.com/websafety-va/9.3/websafety.zip> , Microsoft Hyper-V<https://packages.diladele.com/websafety-va/9.3/websafety-hyperv.zip> , Proxmox<https://packages.diladele.com/websafety-va/9.3/websafety-proxmox.zip> or even deploy it directly on Microsoft Azure<https://azuremarketplace.microsoft.com/en-us/marketplace/apps/diladele.websafety> and Amazon AWS<https://aws.amazon.com/marketplace/pp/prodview-ixvbzugrltcqq>.

Hope you will find this useful.

Best regards,
Rafael Akchurin
Diladele B.V.


-------------- next part --------------
A non-text attachment was scrubbed...
Name: winmail.dat
Type: application/ms-tnef
Size: 20188 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20241029/3f17e41f/attachment.bin>

From jonathanlee571 at gmail.com  Thu Oct 31 00:46:03 2024
From: jonathanlee571 at gmail.com (Jonathan Lee)
Date: Thu, 31 Oct 2024 00:46:03 +0000
Subject: [squid-users] reflecting on Squid Project Status with regard to
 "Joshua 55" vulnerabilities
In-Reply-To: <DS0PR19MB72706097F504D721C364F3B5A7552@DS0PR19MB7270.namprd19.prod.outlook.com>
References: <CA+Y8hcMDHDMB+NjFrcAyWxdcq5mbF-XV3o8h4YmtLUVbNa04Zg@mail.gmail.com>
 <DS0PR19MB7270CCF7460BCDBACD3EDBE1A7552@DS0PR19MB7270.namprd19.prod.outlook.com>
 <DS0PR19MB72706097F504D721C364F3B5A7552@DS0PR19MB7270.namprd19.prod.outlook.com>
Message-ID: <DS0PR19MB727014F97F98C2563FF19262A7552@DS0PR19MB7270.namprd19.prod.outlook.com>

Hello, thank you for the update Francesso, there is also some chatter about bugs within the Netgate community. Is this also related to the fixes in V7 (please see Redmine attached)?

I  admit, I have a bias and assumption that that Big-Tech does not like Squid functional, and that most of what is listed below was done within a political aspect to generate a confusion within the firewall community. So much so that the package was considered an issue and Netgate started to recommend Squid's removal. I have stood by this package and continue to, as it works beautifully.

This Redmine should have been more concise and simplified within its notes, it seems to just generate confusion.  I do not have issues like this and that is where I start to question what this is related to.  Can Someone please respond to this Redmine for verification that has a higher-level knowledge about Squid? I hate to see this removed for some simple reason like a PHP issue that causes configuration issues.

Bug #14390: Squid: SECURITY ALERT: Host header forgery detected - pfSense Packages - pfSense bugtracker<https://redmine.pfsense.org/issues/14390>
Bug #14390: Squid: SECURITY ALERT: Host header forgery detected - pfSense Packages - pfSense bugtracker<https://redmine.pfsense.org/issues/14390>
Redmine
redmine.pfsense.org

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20241031/fa9ecd14/attachment.htm>

From ben.goz87 at gmail.com  Thu Oct 31 11:26:53 2024
From: ben.goz87 at gmail.com (Ben Goz)
Date: Thu, 31 Oct 2024 13:26:53 +0200
Subject: [squid-users] Squid and AD integration
Message-ID: <CADAqQfxKM+wyBP1yfhSaW3_G=_=aw0nnONaFX7AP6CGga2JEKA@mail.gmail.com>

By the help of God.

Hi,
I'm trying to make squid integrate with AD server in such a way that the
machines logged to the domain will send the current active username to
squid and squid will ask the AD for all the groups that this username
belongs to.

How can I configure squid to send an authentication challenge that the
browser will send the active AD user? And if the machine doesn't
connected to the domain it won't popup the login box?
Do I also need to configure the squid server as a trusted server in the
domain?

Thanks,
Ben
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20241031/6534e504/attachment.htm>

From rousskov at measurement-factory.com  Thu Oct 31 14:40:50 2024
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Thu, 31 Oct 2024 10:40:50 -0400
Subject: [squid-users] Redmine Bug #14390: Squid: SECURITY ALERT: Host
 header forgery detected
In-Reply-To: <DS0PR19MB727014F97F98C2563FF19262A7552@DS0PR19MB7270.namprd19.prod.outlook.com>
References: <CA+Y8hcMDHDMB+NjFrcAyWxdcq5mbF-XV3o8h4YmtLUVbNa04Zg@mail.gmail.com>
 <DS0PR19MB7270CCF7460BCDBACD3EDBE1A7552@DS0PR19MB7270.namprd19.prod.outlook.com>
 <DS0PR19MB72706097F504D721C364F3B5A7552@DS0PR19MB7270.namprd19.prod.outlook.com>
 <DS0PR19MB727014F97F98C2563FF19262A7552@DS0PR19MB7270.namprd19.prod.outlook.com>
Message-ID: <d0201455-fe6f-4664-991e-3aa6d746516b@measurement-factory.com>

On 2024-10-30 20:46, Jonathan Lee wrote:
> Hello, thank you for the update Francesso, there is also some chatter 
> about bugs within the Netgate community. Is this also related?to the 
> fixes in V7 (please see Redmine attached)?

AFAICT, Redmine Bug #14390 is pretty much unrelated to "Joshua 55" 
vulnerabilities.


> This Redmine should have been more concise and simplified within its 
> notes, it seems to just generate confusion.? I do not have issues like 
> this and that is where I start to question what this is related to.? Can 
> Someone please respond to this Redmine for verification that has a 
> higher-level knowledge about Squid?

FWIW, I did not find Redmine Bug #14390 particularly confusing: Folks 
are having problems with a particular Squid functionality. Those 
problems are known within Squid community. Unfortunately, nobody who can 
address them stepped up to properly address them (so far; for various 
reasons). Comment #15 looks like an out-of-bug-scope distraction to me; 
I am not sure what should be "verified", but Redmine users are welcome 
to seek Squid help here (and some of them may have already).


> I hate to see this removed for some 
> simple reason like a PHP issue that causes configuration issues.

AFAICT, Redmine Bug #14390 is not specific to PHP clients, and there are 
no good configuration-only solutions for the problem that bug identifies.


HTH,

Alex.

> Bug #14390: Squid: SECURITY ALERT: Host header forgery detected - 
> pfSense Packages - pfSense bugtracker 
> <https://redmine.pfsense.org/issues/14390>



From ngtech1ltd at gmail.com  Thu Oct 31 21:19:21 2024
From: ngtech1ltd at gmail.com (NgTech LTD)
Date: Thu, 31 Oct 2024 23:19:21 +0200
Subject: [squid-users] reflecting on Squid Project Status with regard to
 "Joshua 55" vulnerabilities
In-Reply-To: <DS0PR19MB727014F97F98C2563FF19262A7552@DS0PR19MB7270.namprd19.prod.outlook.com>
References: <CA+Y8hcMDHDMB+NjFrcAyWxdcq5mbF-XV3o8h4YmtLUVbNa04Zg@mail.gmail.com>
 <DS0PR19MB7270CCF7460BCDBACD3EDBE1A7552@DS0PR19MB7270.namprd19.prod.outlook.com>
 <DS0PR19MB72706097F504D721C364F3B5A7552@DS0PR19MB7270.namprd19.prod.outlook.com>
 <DS0PR19MB727014F97F98C2563FF19262A7552@DS0PR19MB7270.namprd19.prod.outlook.com>
Message-ID: <CABA8h=RYP48kWxbw+eXG9CxLRGDRKE=HJn7FDtZGUXRuEi-R3A@mail.gmail.com>

Hey Jonathan,

I cannot speak for the whole squid community, however if someone in the
pfsense community doesn't want to maintain and or use squid it's his own
choice.
If there is an issue it can be researched and there so much information
about this specific "issue" that it's weird nobody bothered to respond the
issue.

The reason for the log output is widely known and there are couple ways to
resolve this.
I wrote a patch to override this behaviour in the past but I am no longer
supporting this.
The main reason for me not supporting overriding this fix is since there
are many bad actors which are using squid for their own gain while
sacrificing some internet connectivity security aspects.
It is recommended to use a shared dns service for both the clients and the
proxy server to avoid such issues.

My general recommendation is to use squid on a linux based os if possible.

There are other firewall projects which might be a better choice for your
use case if you really need the proxy.
In my setup I am using Mikrotik as a router and firewall for a 1gbps line
and a tiny x86 server for all other services.
It's more efficient and practical compared to netgate in my scenario.

Yours,
Eliezer

?????? ??? ??, 31 ????? 2024, 21:32, ??? Jonathan Lee ?<
jonathanlee571 at gmail.com>:

> Hello, thank you for the update Francesso, there is also some chatter
> about bugs within the Netgate community. Is this also related to the fixes
> in V7 (please see Redmine attached)?
>
> I  admit, I have a bias and assumption that that Big-Tech does not like
> Squid functional, and that most of what is listed below was done within a
> political aspect to generate a confusion within the firewall community. So
> much so that the package was considered an issue and Netgate started to
> recommend Squid's removal. I have stood by this package and continue to, as
> it works beautifully.
>
> This Redmine should have been more concise and simplified within its
> notes, it seems to just generate confusion.  I do not have issues like this
> and that is where I start to question what this is related to.  Can Someone
> please respond to this Redmine for verification that has a higher-level
> knowledge about Squid? I hate to see this removed for some simple reason
> like a PHP issue that causes configuration issues.
>
> Bug #14390: Squid: SECURITY ALERT: Host header forgery detected - pfSense
> Packages - pfSense bugtracker <https://redmine.pfsense.org/issues/14390>
> Bug #14390: Squid: SECURITY ALERT: Host header forgery detected - pfSense
> Packages - pfSense bugtracker <https://redmine.pfsense.org/issues/14390>
> Redmine
> redmine.pfsense.org
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> https://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20241031/b366b0ab/attachment.htm>

