<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 6.10 SSL-Bump Woes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%206.10%20SSL-Bump%20Woes&In-Reply-To=%3CCA%2BuwrTQVt6hpyw%2BM%3DFg4GUjYH%3Du8ZbLV0s%3DfYtU3Uov%2BD-HP2w%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027188.html">
   <LINK REL="Next"  HREF="027194.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 6.10 SSL-Bump Woes</H1>
    <B>Bryan Seitz</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%206.10%20SSL-Bump%20Woes&In-Reply-To=%3CCA%2BuwrTQVt6hpyw%2BM%3DFg4GUjYH%3Du8ZbLV0s%3DfYtU3Uov%2BD-HP2w%40mail.gmail.com%3E"
       TITLE="[squid-users] Squid 6.10 SSL-Bump Woes">seitzbg at gmail.com
       </A><BR>
    <I>Fri Oct 11 18:10:16 UTC 2024</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="027188.html">[squid-users] Squid 6.10 SSL-Bump Woes
</A></li>
        <LI>Next message (by thread): <A HREF="027194.html">[squid-users] Squid 6.10 SSL-Bump Woes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27192">[ date ]</a>
              <a href="thread.html#27192">[ thread ]</a>
              <a href="subject.html#27192">[ subject ]</a>
              <a href="author.html#27192">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at squid</A>:~# curl -i --insecure --proxy <A HREF="http://squid:3128/">http://squid:3128/</A> &quot;
<A HREF="https://10.170.31.75/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics">https://10.170.31.75/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics</A>
&quot;
HTTP/1.1 200 Connection established

HTTP/1.1 200 OK
Link: &lt;<A HREF="http://redfish.dmtf.org/schemas/v1/Z.v1_5_2.json">http://redfish.dmtf.org/schemas/v1/Z.v1_5_2.json</A>&gt;; rel=describedby
Allow: GET
Content-Length: 1173
Content-Type: application/json; charset=UTF-8
Strict-Transport-Security: max-age=31536000; includeSubdomains
X-XSS-Protection: 1; mode=block
Content-Security-Policy: default-src 'self';connect-src 'self' ws:
wss:;frame-src 'self';img-src 'self' data:;object-src 'self';font-src
'self' data:;script-src 'self' 'unsafe-inline' 'unsafe-eval';style-src
'self' 'unsafe-inline';worker-src 'self' blob:;
X-Frame-Options: SAMEORIGIN
X-Content-Type-Options: nosniff
OData-Version: 4.0
Date: Fri, 11 Oct 2024 18:03:49 GMT
Cache-Status: squid;detail=mismatch
Via: 1.1 squid (squid/6.10)
Connection: keep-alive
Cache-Control: public, max-age=1800

Second run:

curl -i --insecure --proxy <A HREF="http://squid:3128/">http://squid:3128/</A> &quot;
<A HREF="https://10.170.31.75/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics">https://10.170.31.75/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics</A>
&quot;
HTTP/1.1 200 Connection established

HTTP/1.1 200 OK
Link: &lt;<A HREF="http://redfish.dmtf.org/schemas/v1/Z.v1_5_2.json">http://redfish.dmtf.org/schemas/v1/Z.v1_5_2.json</A>&gt;; rel=describedby
Allow: GET
Content-Length: 1173
Content-Type: application/json; charset=UTF-8
Strict-Transport-Security: max-age=31536000; includeSubdomains
X-XSS-Protection: 1; mode=block
Content-Security-Policy: default-src 'self';connect-src 'self' ws:
wss:;frame-src 'self';img-src 'self' data:;object-src 'self';font-src
'self' data:;script-src 'self' 'unsafe-inline' 'unsafe-eval';style-src
'self' 'unsafe-inline';worker-src 'self' blob:;
X-Frame-Options: SAMEORIGIN
X-Content-Type-Options: nosniff
OData-Version: 4.0
Date: Fri, 11 Oct 2024 18:05:16 GMT
Cache-Status: squid;detail=mismatch
Via: 1.1 squid (squid/6.10)
Connection: keep-alive
Cache-Control: public, max-age=1800

Logs:

1728669831.300     40 10.65.34.5 NONE_NONE/200 0 CONNECT 10.170.31.75:443 -
HIER_NONE/- - [Host: 10.170.31.75:443\r\nUser-Agent:
curl/7.81.0\r\nProxy-Connection: Keep-Alive\r\n] [HTTP/1.1 200 Connection
established\r\n\r\n]
1728669831.847    546 10.65.34.5 TCP_MISS/200 2000 GET
<A HREF="https://10.170.31.75/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics">https://10.170.31.75/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics</A>
- HIER_DIRECT/10.170.31.75 application/json [Host:
10.170.31.75\r\nUser-Agent: curl/7.81.0\r\nAccept: */*\r\n] [HTTP/1.1 200
OK\r\nLink: &lt;<A HREF="http://redfish.dmtf.org/schemas/v1/Z.v1_5_2.json">http://redfish.dmtf.org/schemas/v1/Z.v1_5_2.json</A>&gt;;
rel=describedby\r\nAllow: GET\r\nContent-Length: 1173\r\nContent-Type:
application/json; charset=UTF-8\r\nStrict-Transport-Security:
max-age=31536000; includeSubdomains\r\nX-XSS-Protection: 1;
mode=block\r\nContent-Security-Policy: default-src 'self';connect-src
'self' ws: wss:;frame-src 'self';img-src 'self' data:;object-src
'self';font-src 'self' data:;script-src 'self' 'unsafe-inline'
'unsafe-eval';style-src 'self' 'unsafe-inline';worker-src 'self'
blob:;\r\nX-Frame-Options: SAMEORIGIN\r\nX-Content-Type-Options:
nosniff\r\nOData-Version: 4.0\r\nDate: Fri, 11 Oct 2024 18:03:49
GMT\r\nCache-Status: squid;detail=mismatch\r\nVia: 1.1 squid
squid/6.10)\r\nConnection: keep-alive\r\nCache-Control: public,
max-age=1800\r\n\r\n]
1728669917.657     39 10.65.34.5 NONE_NONE/200 0 CONNECT 10.170.31.75:443 -
HIER_NONE/- - [Host: 10.170.31.75:443\r\nUser-Agent:
curl/7.81.0\r\nProxy-Connection: Keep-Alive\r\n] [HTTP/1.1 200 Connection
established\r\n\r\n]
1728669918.269    611 10.65.34.5 TCP_MISS/200 2000 GET
<A HREF="https://10.170.31.75/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics">https://10.170.31.75/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics</A>
- HIER_DIRECT/10.170.31.75 application/json [Host:
10.170.31.75\r\nUser-Agent: curl/7.81.0\r\nAccept: */*\r\n] [HTTP/1.1 200
OK\r\nLink: &lt;<A HREF="http://redfish.dmtf.org/schemas/v1/Z.v1_5_2.json">http://redfish.dmtf.org/schemas/v1/Z.v1_5_2.json</A>&gt;;
rel=describedby\r\nAllow: GET\r\nContent-Length: 1173\r\nContent-Type:
application/json; charset=UTF-8\r\nStrict-Transport-Security:
max-age=31536000; includeSubdomains\r\nX-XSS-Protection: 1;
mode=block\r\nContent-Security-Policy: default-src 'self';connect-src
'self' ws: wss:;frame-src 'self';img-src 'self' data:;object-src
'self';font-src 'self' data:;script-src 'self' 'unsafe-inline'
'unsafe-eval';style-src 'self' 'unsafe-inline';worker-src 'self'
blob:;\r\nX-Frame-Options: SAMEORIGIN\r\nX-Content-Type-Options:
nosniff\r\nOData-Version: 4.0\r\nDate: Fri, 11 Oct 2024 18:05:16
GMT\r\nCache-Status: squid;detail=mismatch\r\nVia: 1.1 squid
(squid/6.10)\r\nConnection: keep-alive\r\nCache-Control: public,
max-age=1800\r\n\r\n]

1728669831.847 RELEASE -1 FFFFFFFF 020000000000000031450B0001000000  200
1728669829        -1        -1 application/json 1173/1173 GET
<A HREF="https://10.170.31.75/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics">https://10.170.31.75/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics</A>
1728669918.269 RELEASE -1 FFFFFFFF 02000000000000002E450B0004000000  200
1728669916        -1        -1 application/json 1173/1173 GET
<A HREF="https://10.170.31.75/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics">https://10.170.31.75/redfish/v1/Oem/Supermicro/HGX_H100/Systems/HGX_Baseboard_0/Processors/GPU_SXM_4/ProcessorMetrics</A>

Cache log:
<A HREF="https://p.bsd-unix.net/?bfc9a1568c49f0b6#89PnEqmjNr7iLh1ZYTLVbgbt4FouhW2RekSxeaZ3xZZs">https://p.bsd-unix.net/?bfc9a1568c49f0b6#89PnEqmjNr7iLh1ZYTLVbgbt4FouhW2RekSxeaZ3xZZs</A>

Happy to jump on irc/discord/matrix/whatever for help if easier to debug!

Thanks!

On Fri, Oct 11, 2024 at 4:17&#8239;AM Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; wrote:

&gt;<i> On 11/10/24 11:08, Bryan Seitz wrote:
</I>&gt;<i> &gt; I removed the header mods and changed the refresh pattern to:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; refresh_pattern .               15      20%     1800    override-expire
</I>&gt;<i> &gt; ignore-no-cache ignore-no-store ignore-private
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; And I always get TCP_MISS.  Any other thoughts?
</I>&gt;<i>
</I>&gt;<i> Ah, I believe it would be best to get a baseline of what Squid default
</I>&gt;<i> behaviour is like in your environment. So we can identify what/how you
</I>&gt;<i> need to improve it.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Firstly, FYI; this is what those controls **actually** do in current
</I>&gt;<i> Squid ..
</I>&gt;<i>
</I>&gt;<i>   * override-expires ... forces Squid to handle all responses to act as
</I>&gt;<i> if they received &quot;Cache-Control: max-age=900&quot; (15 min) ... store, but
</I>&gt;<i> revalidate 180+ seconds (20% of 15min) later.
</I>&gt;<i>    Result: Anything that could cache longer than 15min becomes a
</I>&gt;<i> REFRESH_MISS or MISS, instead of HIT.
</I>&gt;<i>    Squid default: **do** cache. Revalidate
</I>&gt;<i>      * after(&quot;Date&quot;+&quot;CC: max-age=N&quot;) timestamp, otherwise
</I>&gt;<i>      * after &quot;Expires&quot; timestamp, otherwise
</I>&gt;<i>      * after (&quot;Date&quot; +1800 minutes) timestamp.
</I>&gt;<i>
</I>&gt;<i>   * ignore-no-cache ... the standardized &quot;CC: no-cache&quot; is badly named,
</I>&gt;<i> it tells Squid what **can** be cached.
</I>&gt;<i>    Result: Squid will discard many stored objects and perform a MISS
</I>&gt;<i> instead.
</I>&gt;<i>    Squid default: **do** cache &quot;CC:private&quot; responses, revalidate on
</I>&gt;<i> HIT. Log as REFRESH.
</I>&gt;<i>
</I>&gt;<i>   * ignore-no-store ... force everything marked &quot;CC: no-store&quot; to be
</I>&gt;<i> stored.
</I>&gt;<i>   Result: cache fills with non-reusable objects. Leaving not much room
</I>&gt;<i> for actual HIT objects.
</I>&gt;<i>    Squid default: store only objects with can result in more HITs.
</I>&gt;<i>
</I>&gt;<i>   * ignore-private ... force everything with &quot;CC: private&quot; to be discarded.
</I>&gt;<i>    Result: same as &quot;ignore-no-store&quot;.
</I>&gt;<i>    Squid default: **do** cache &quot;CC:private&quot; responses, revalidate on HIT.
</I>&gt;<i>
</I>&gt;<i> Note that both HIT and REFRESH mean the object **was** cached.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> You said that the access.log now contains MISS. Would that be just
</I>&gt;<i> &quot;MISS&quot; or &quot;REFRESH&quot; + &quot;MISS&quot; (actually a HIT, but a new object was given
</I>&gt;<i> by the server and replaced the pre-stored object).
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Can you show a pair of request headers from the client, with matching
</I>&gt;<i> response from the server?  You can use &quot;debug_options 11,2&quot; in recent
</I>&gt;<i> Squid versions to get a cache.log trace of the HTTP transactions.
</I>&gt;<i>
</I>&gt;<i> That might help us spot something more specific. The config change makes
</I>&gt;<i> the earlier given ones obsolete.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> HTH
</I>&gt;<i> Amos
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>

-- 
Bryan Seitz
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">seitzbg at gmail.com</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20241011/9a23d151/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20241011/9a23d151/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="027188.html">[squid-users] Squid 6.10 SSL-Bump Woes
</A></li>
	<LI>Next message (by thread): <A HREF="027194.html">[squid-users] Squid 6.10 SSL-Bump Woes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27192">[ date ]</a>
              <a href="thread.html#27192">[ thread ]</a>
              <a href="subject.html#27192">[ subject ]</a>
              <a href="author.html#27192">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
