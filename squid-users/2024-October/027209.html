<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Unable to access a device over port 4434
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Unable%20to%20access%20a%20device%20over%20port%204434&In-Reply-To=%3C2d7b5dac-be33-48dc-be37-b4682023811f%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027208.html">
   <LINK REL="Next"  HREF="027210.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Unable to access a device over port 4434</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Unable%20to%20access%20a%20device%20over%20port%204434&In-Reply-To=%3C2d7b5dac-be33-48dc-be37-b4682023811f%40treenet.co.nz%3E"
       TITLE="[squid-users] Unable to access a device over port 4434">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Oct 18 05:59:05 UTC 2024</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="027208.html">[squid-users] Unable to access a device over port 4434
</A></li>
        <LI>Next message (by thread): <A HREF="027210.html">[squid-users] Unable to access a device over port 4434
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27209">[ date ]</a>
              <a href="thread.html#27209">[ thread ]</a>
              <a href="subject.html#27209">[ subject ]</a>
              <a href="author.html#27209">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Ah, okay. I see.


So what you need with Squid is a cache_peer, relaying relevant traffic 
to that device.

   # details of how Squid should connect to the device
   cache_peer 172.27.46.253 parent 4434 0 originserver \
      tls-cert=/path/to/server.ca

   # which traffic to relay there
   acl foo dstdomain foo.example.com
   cache_peer_access 172.27.46.253 allow foo
   never_direct allow foo

   # permission for clients to make requests that reach that device
   http_access allow localnet foo


Add more ACL conditions as needed to restrict the http_access line to 
the appropriate clients.


Cheers
Amos


On 18/10/24 09:40, Piana, Josh wrote:
&gt;<i> Hey Amos,
</I>&gt;<i> 
</I>&gt;<i> Thanks for replying.
</I>&gt;<i> 
</I>&gt;<i> To clarify on the test, port 4434 is the port that was assigned to get access to that device, one of our firewalls.
</I>&gt;<i> 
</I>&gt;<i> I looked at the old Squid config that we have, and it seems this was setup in a way that internal networks were not being passed through the proxy. This was done be either an ACL, or the PAC file, is what we're thinking. The issue is, we don't exactly know how to implement the PAC file on our new Squid box.
</I>&gt;<i> 
</I>&gt;<i> With that said, I agree with your statement that its difficult to troubleshoot an issue as opposed to go around it. Unfortunately, that's how it was done before and that's the direction our current management is going again. So I need to reconfigure the squid.conf file to ignore internal traffic, networks, and IP's, and only web filter and proxy internet connections. We can't just copy the old config because it doesn't carry over 1:1, and its an old version from 2.5.
</I>&gt;<i> 
</I>&gt;<i> Is there additional testing I could do or anything I should know to make this happen?
</I>&gt;<i> 
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; On Behalf Of Amos Jeffries
</I>&gt;<i> Sent: Wednesday, October 16, 2024 11:45 PM
</I>&gt;<i> To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> Subject: Re: [squid-users] Unable to access a device over port 4434
</I>&gt;<i> 
</I>&gt;<i> Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On 16/10/24 09:39, Piana, Josh wrote:
</I>&gt;&gt;<i> Amos,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thank you for getting back to me and clarifying.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I ran this command:
</I>&gt;&gt;<i> #wget -Y off 172.27.46.253
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Response:
</I>&gt;&gt;<i> --2024-10-15 16:36:15--
</I>&gt;&gt;<i> <A HREF="http://172.0.0.2/">http://172.0.0.2/</A>
</I>&gt;&gt;<i> 7.46.253%2F&amp;data=05%7C02%7Cjosh.piana%40hexcel.com%7Cf595ea81629e4e5db
</I>&gt;&gt;<i> 45f08dcee5e2c12%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C638647335
</I>&gt;&gt;<i> 455212558%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIi
</I>&gt;&gt;<i> LCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&amp;sdata=ZfzWSAFz5VpiHcYtQy4p
</I>&gt;&gt;<i> c%2BHj08G%2FvUSWdLaU2RckxlA%3D&amp;reserved=0
</I>&gt;&gt;<i> Connecting to 172.27.46.253:80... connected.
</I>&gt;&gt;<i> HTTP request sent, awaiting response... 301 Moved Permanently
</I>&gt;&gt;<i> Location:
</I>&gt;&gt;<i> <A HREF="https://0.0.0.172/.">https://0.0.0.172/.</A>
</I>&gt;&gt;<i> 27.46.253%2F&amp;data=05%7C02%7Cjosh.piana%40hexcel.com%7Cf595ea81629e4e5d
</I>&gt;&gt;<i> b45f08dcee5e2c12%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C63864733
</I>&gt;&gt;<i> 5458181374%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzI
</I>&gt;&gt;<i> iLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&amp;sdata=z%2F5YhuDe5d2cz6KUm
</I>&gt;&gt;<i> TbGhMV6Dpgs3T%2B%2BrlqRewDCmCM%3D&amp;reserved=0 [following]
</I>&gt;&gt;<i> --2024-10-15 16:36:15--
</I>&gt;&gt;<i> <A HREF="https://0.0.0.172/.">https://0.0.0.172/.</A>
</I>&gt;&gt;<i> 27.46.253%2F&amp;data=05%7C02%7Cjosh.piana%40hexcel.com%7Cf595ea81629e4e5d
</I>&gt;&gt;<i> b45f08dcee5e2c12%7C4248050df19546d5ac9c0c7c52b04cae%7C0%7C0%7C63864733
</I>&gt;&gt;<i> 5458181374%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzI
</I>&gt;&gt;<i> iLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&amp;sdata=z%2F5YhuDe5d2cz6KUm
</I>&gt;&gt;<i> TbGhMV6Dpgs3T%2B%2BrlqRewDCmCM%3D&amp;reserved=0
</I>&gt;&gt;<i> Connecting to 172.27.46.253:443... connected.
</I>&gt;<i> 
</I>&gt;<i> The TCP here is fully working, on both ports.
</I>&gt;<i> 
</I>&gt;<i> The followup hang you mentioned was likely due to a mistake in your followup test (that extra '4' typo?).
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> ERROR: The certificate of '172.27.46.253' is not trusted.
</I>&gt;&gt;<i> ERROR: The certificate of '172.27.46.253' doesn't have a known issuer.
</I>&gt;&gt;<i> The certificate's owner does not match hostname '172.27.46.253'
</I>&gt;&gt;<i>
</I>&gt;<i> 
</I>&gt;<i> There you go. Two problems to resolve.
</I>&gt;<i> 
</I>&gt;<i> First Problem;  unknown &quot;Issuer&quot; (aka root or intermediate CA certificate).
</I>&gt;<i> 
</I>&gt;<i> Please use this to find out what details need to be retrieved:
</I>&gt;<i>     wget -v --no-proxy <A HREF="https://172.27.46.253/">https://172.27.46.253/</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Find the public CA certificate for the missing &quot;Issuer&quot;.
</I>&gt;<i> 
</I>&gt;<i> Further tests with wget should use:
</I>&gt;<i>     wget -v --no-proxy \
</I>&gt;<i>       --ca-certificate=/path/to/server.ca <A HREF="https://172.27.46.253/">https://172.27.46.253/</A>
</I>&gt;<i> 
</I>&gt;<i> When wget test shows trust of the server certificate working, Squid should be configured to use it for checking too:
</I>&gt;<i>      tsl_outgoing_options ca=/path/to/server.ca or
</I>&gt;<i>     cache_peer 172.27.46.253 443 0 originserver tls-ca=/path/to/server.ca
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Second Problem;  mismatch between &quot;172.27.46.253&quot; and &quot;Owner&quot; (or maybe&quot;SubjectAltName&quot; fields).
</I>&gt;<i> 
</I>&gt;<i> The wget output when troubleshooting for the first problem should give more hints about what this means.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> So with the errors given, would that stop us from connecting to it? Typically with sites with trust issues or certification issues, you can still bypass it. We'd like to do the same here if applicable.
</I>&gt;<i> 
</I>&gt;<i> One could, but your wget command does not.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> FYI, It is also a bad idea to bypass unless you really have to.
</I>&gt;<i> Especially bad to bypass unknown amount of things when trying to identify reasons for failure.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Amos
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="027208.html">[squid-users] Unable to access a device over port 4434
</A></li>
	<LI>Next message (by thread): <A HREF="027210.html">[squid-users] Unable to access a device over port 4434
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27209">[ date ]</a>
              <a href="thread.html#27209">[ thread ]</a>
              <a href="subject.html#27209">[ subject ]</a>
              <a href="author.html#27209">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
