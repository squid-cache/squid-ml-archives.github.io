<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] proxy_auth_regex
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20proxy_auth_regex&In-Reply-To=%3Cd7848963-b7d7-45a2-a676-c12f4044ccc0%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027218.html">
   <LINK REL="Next"  HREF="027220.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] proxy_auth_regex</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20proxy_auth_regex&In-Reply-To=%3Cd7848963-b7d7-45a2-a676-c12f4044ccc0%40measurement-factory.com%3E"
       TITLE="[squid-users] proxy_auth_regex">rousskov at measurement-factory.com
       </A><BR>
    <I>Thu Oct 24 20:13:18 UTC 2024</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="027218.html">[squid-users] proxy_auth_regex
</A></li>
        <LI>Next message (by thread): <A HREF="027220.html">[squid-users] proxy_auth_regex
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27219">[ date ]</a>
              <a href="thread.html#27219">[ thread ]</a>
              <a href="subject.html#27219">[ subject ]</a>
              <a href="author.html#27219">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2024-10-24 15:53, Piana, Josh wrote:
&gt;<i> Hey Squid users,
</I>&gt;<i> 
</I>&gt;<i> Running into an issue I&#8217;m trying to figure out.
</I>&gt;<i> 
</I>&gt;<i> We have a few acl directives using &#8220;proxy_auth_regex &#8211;i&#8221; and when I have 
</I>&gt;<i> these active, it blocks any proxy connection with an HTTP 407 error, 
</I>&gt;<i> according to the logs.
</I>&gt;<i> 
</I>&gt;<i> Here&#8217;s an example:
</I>&gt;<i> 
</I>&gt;<i> # block certain user IDs from using proxy server
</I>&gt;<i> 
</I>&gt;<i> #acl block_user proxy_auth_regex -i &quot;/etc/squid/block_user&quot;
</I>&gt;<i> 
</I>&gt;<i> #http_access deny block_user
</I>&gt;<i> 
</I>&gt;<i> What&#8217;s supposed to happen with this ACL, is that any username we have on 
</I>&gt;<i> that list is to be blocked from internet access. But it seems to be 
</I>&gt;<i> blocking known good usernames too. I&#8217;m not sure where to go from here
</I>
After asking for one with a 407 response, does Squid ever receive a 
&quot;good username&quot; from the client? Do you see a username in client HTTP 
request headers or access.log records containing %un field?

Perhaps the client refuses to authenticate its requests because Squid 
intercepts TLS client connections rather than receiving HTTP CONNECT 
requests from the client? Have you tested this with plain text traffic?

Alex.


&gt;<i> we would like to use these ACL&#8217;s but for right now I have these rules 
</I>&gt;<i> commented out.
</I>&gt;<i> 
</I>&gt;<i> Here's a few other rules we have that have the same issue:
</I>&gt;<i> 
</I>&gt;<i> # executable blocking
</I>&gt;<i> 
</I>&gt;<i> # reference this list for extensions to block
</I>&gt;<i> 
</I>&gt;<i> acl exec_files url_regex -i &quot;/etc/squid/exec_files&quot;
</I>&gt;<i> 
</I>&gt;<i> # ignore these usernames from being blocked
</I>&gt;<i> 
</I>&gt;<i> #acl exec_users proxy_auth_regex -i &quot;/etc/squid/exec_users&quot;
</I>&gt;<i> 
</I>&gt;<i> # combine the rules
</I>&gt;<i> 
</I>&gt;<i> #http_access deny !bad_exception_urls !exec_users exec_files
</I>&gt;<i> 
</I>&gt;<i> #deny_info ERR_BLOCK_TYPE exec_files
</I>&gt;<i> 
</I>&gt;<i>  From what you can see above, we have &#8220;acl exec_files url_regex -i 
</I>&gt;<i> /etc/squid/exec_files&quot; uncommented, but it&#8217;s not active because the 
</I>&gt;<i> &#8220;http_access directive&#8221; had to be commented out because it includes the 
</I>&gt;<i> other statements that include &#8220;proxy_auth_regex &#8211;i&#8221; which block all 
</I>&gt;<i> internet access as well.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="027218.html">[squid-users] proxy_auth_regex
</A></li>
	<LI>Next message (by thread): <A HREF="027220.html">[squid-users] proxy_auth_regex
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27219">[ date ]</a>
              <a href="thread.html#27219">[ thread ]</a>
              <a href="subject.html#27219">[ subject ]</a>
              <a href="author.html#27219">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
