<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Help regarding access controls for TLS connections
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Help%20regarding%20access%20controls%20for%20TLS%20connections&In-Reply-To=%3CCAE5KivgFh1FAqCYctV4soqORLpUzk1FOMkGVb_1T0N%3D15WtdGg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027226.html">
   <LINK REL="Next"  HREF="027229.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Help regarding access controls for TLS connections</H1>
    <B>Erik Schulz</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Help%20regarding%20access%20controls%20for%20TLS%20connections&In-Reply-To=%3CCAE5KivgFh1FAqCYctV4soqORLpUzk1FOMkGVb_1T0N%3D15WtdGg%40mail.gmail.com%3E"
       TITLE="[squid-users] Help regarding access controls for TLS connections">erikschulz184 at gmail.com
       </A><BR>
    <I>Fri Oct 25 22:18:25 UTC 2024</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="027226.html">[squid-users] Square Bracket in LogFormat
</A></li>
        <LI>Next message (by thread): <A HREF="027229.html">[squid-users] Help regarding access controls for TLS connections
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27227">[ date ]</a>
              <a href="thread.html#27227">[ thread ]</a>
              <a href="subject.html#27227">[ subject ]</a>
              <a href="author.html#27227">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello!

I would like to use squid as an egress proxy, to prevent unauthorized egress.

Let's say that the only allowed egress is 'example.com'.
I can define acl along the lines of:
```
acl allowed_domains ssl::server_name .example.com
http_access allow allowed_domains
```

But can someone help me understand what actually happens?
I want to avoid any DNS egress attack.
The client does not have DNS access.
Am I correct that the client can use HTTPS_PROXY without DNS, such
that the proxy will perform the DNS lookup?

Can you help me understand how the acl checks the server_name?
In order to connect to the server, it must perform a DNS lookup, which
causes a leak.
So the ACL must validate the server_name without a DNS lookup, and
since the server IP is therefore unknown, without connecting to the
server or verifying against its certificate.
I'm assuming the hostname is known in the CONNECT phase of the request?
Is it possible to check against the connect hostname only?

The docs say that
&gt;<i> &quot;The ACL computes server name(s) using such information sources as CONNECT request URI, TLS client SNI, and TLS server certificate subject (CN and SubjectAltName). The computed server name(s) usually change with each SslBump step&quot;
</I>
I find this concerning, because I assume the client could perform a
request with an IP, and a forged SNI name that passes the acl.
So I would like to only allow requests that declare FQDN hostname, and
reject IP hostnames.

And, only perform validation against the CONNECT request URI.

Is that possible?

Thanks for any clarification!
/Erik

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="027226.html">[squid-users] Square Bracket in LogFormat
</A></li>
	<LI>Next message (by thread): <A HREF="027229.html">[squid-users] Help regarding access controls for TLS connections
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27227">[ date ]</a>
              <a href="thread.html#27227">[ thread ]</a>
              <a href="subject.html#27227">[ subject ]</a>
              <a href="author.html#27227">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
