<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid appears to be ignoring url_rewrite_program
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20appears%20to%20be%20ignoring%20url_rewrite_program&In-Reply-To=%3Ccd01227c-cced-4450-8392-6e4c0e2ac2dc%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027144.html">
   <LINK REL="Next"  HREF="027148.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid appears to be ignoring url_rewrite_program</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20appears%20to%20be%20ignoring%20url_rewrite_program&In-Reply-To=%3Ccd01227c-cced-4450-8392-6e4c0e2ac2dc%40measurement-factory.com%3E"
       TITLE="[squid-users] Squid appears to be ignoring url_rewrite_program">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Sep 17 14:13:31 UTC 2024</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="027144.html">[squid-users] Squid appears to be ignoring url_rewrite_program
</A></li>
        <LI>Next message (by thread): <A HREF="027148.html">[squid-users] Squid appears to be ignoring url_rewrite_program
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27145">[ date ]</a>
              <a href="thread.html#27145">[ thread ]</a>
              <a href="subject.html#27145">[ subject ]</a>
              <a href="author.html#27145">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2024-09-17 09:34, Martin A. Brooks wrote:
&gt;<i> Proxied HTTPS requests use 
</I>&gt;<i> CONNECT and, for whatever reason, this appears to bypass the url 
</I>&gt;<i> rewriter.
</I>
What makes you think that CONNECT requests are not sent to the rewriter? 
In my quick-and-dirty tests, Squid does send CONNECT request targets to 
the URL rewriter program and honors rewriter's rewrite-url=... response. 
For example, I see the new target logged to access.log.

Please keep in mind that changing CONNECT target has no effect on the 
received origin server response if the new target resolves to the same 
or equivalent IP address as the original target (and the port is 
unchanged): The origin server does not get a CONNECT request. It gets a 
TCP connection from Squid. The bytes on that connection come from the 
client (e.g., browser) rather than Squid! Those bytes contain original 
(not rewritten) TLS and HTTP details. By default, Squid works as a blind 
TCP tunnel when handling CONNECT requests.


&gt;<i> I'm looking in to it some more but, given that a very large 
</I>&gt;<i> part of the world is HTTPS these days, it may be that I need to look at 
</I>&gt;<i> another option for this requirement.
</I>
If your rewriter helper is using url=... instead of rewrite-url=... 
responses, then please note that popular browsers do not honor redirect 
responses to their HTTP CONNECT requests -- they have chosen not to 
trust the proxy to make those kind of decisions.

Most likely, if you need to redirect https traffic, you have to bump(*) 
it; if you cannot bump in your environment, then you cannot redirect 
https using an HTTP proxy.

(*) See ssl_bump directive and the following URL, but keep in mind that 
bumping is naturally full of bad side effects and corner cases:
<A HREF="https://wiki.squid-cache.org/Features/SslPeekAndSplice">https://wiki.squid-cache.org/Features/SslPeekAndSplice</A>


HTH,

Alex.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="027144.html">[squid-users] Squid appears to be ignoring url_rewrite_program
</A></li>
	<LI>Next message (by thread): <A HREF="027148.html">[squid-users] Squid appears to be ignoring url_rewrite_program
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27145">[ date ]</a>
              <a href="thread.html#27145">[ thread ]</a>
              <a href="subject.html#27145">[ subject ]</a>
              <a href="author.html#27145">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
