<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Questions about Squid configuration
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Questions%20about%20Squid%20configuration&In-Reply-To=%3CCAK0%2B96fzSV2GC0b8ETW5NqnQru4%3DkRJHo9WR04kiUtwHmciCxg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027121.html">
   <LINK REL="Next"  HREF="027113.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Questions about Squid configuration</H1>
    <B>&#12395;&#12400;</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Questions%20about%20Squid%20configuration&In-Reply-To=%3CCAK0%2B96fzSV2GC0b8ETW5NqnQru4%3DkRJHo9WR04kiUtwHmciCxg%40mail.gmail.com%3E"
       TITLE="[squid-users] Questions about Squid configuration">taku0919.taku at gmail.com
       </A><BR>
    <I>Wed Sep 25 05:57:11 UTC 2024</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="027121.html">[squid-users] Questions about Squid configuration
</A></li>
        <LI>Next message (by thread): <A HREF="027113.html">[squid-users] RFC: Removal of ESI Support from Squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27152">[ date ]</a>
              <a href="thread.html#27152">[ thread ]</a>
              <a href="subject.html#27152">[ subject ]</a>
              <a href="author.html#27152">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Dear Alex.

Thank you for your advice!

&#65310;Do you run these &quot;curl&quot; commands on the same box that runs Squid?
No, we have a Squid validation environment on an AWS EC2 instance,
and the instance for Squid and the instance for running curl commands
are separate.

&#65310;However, you may want to double check whether rejecting requests with an
&#65310;empty Host header is actually necessary in your environment. Perhaps
&#65310;they can be considered valid (which is what Squid does by default)?
Thank you.
Indeed we do not want to explicitly reject empty Host headers, we just
want to reject malformed requests.
Therefore, we will not add an explicit rejection setting.

&#65310;I recommend deleting the above http_access rule. AFAICT, you only want
&#65310;to allow valid requests targeting specific/allowed sites. You already
&#65310;have other rules for that. The above &quot;all HTTPS&quot; rule is too broad and
&#65310;is seemingly unnecessary.

&#65310;I also recommend deleting a similar rule that allows all port-80
&#65310;requests, for similar reasons:
&#65310;     acl http_port port 80
&#65310;     http_access allow http_port


&#65310;If you think you do need those two broad rules, please clarify what you
&#65310;think you need them for. In other words, what tests would break if you
&#65310;remove them?
I did not need these rules, so I removed them and verified STEP 2
again and everything passed!
Thank you so much for your help!!

We then added the following settings that were in the existing Squid proxy
*The entire configuration is attached to this email.

# SSL_BUMP
acl allowed_https_sites ssl::server_name &quot;/etc/squid/whitelist&quot;
acl allowed_https_sites ssl::server_name &quot;/etc/squid/whitelist_transparent&quot;
acl allowed_https_sites ssl::server_name &quot;/etc/squid/whitelist_https&quot;
acl allowed_https_sites ssl::server_name
&quot;/etc/squid/whitelist_transparent_https&quot;
sslcrtd_program [sslcrtd-program-setting]

acl step1 at_step SslBump1
acl step2 at_step SslBump2
acl step3 at_step SslBump3

ssl_bump peek step1 all
ssl_bump peek step2 allowed_https_sites
ssl_bump splice step3 allowed_https_sites
ssl_bump terminate step2 all

Then I verified the 4 patterns again and all of them gave me 403 Forbidden...
Even the following pattern which is allowed in whitelist.
&gt;<i> 1. successful communication of a valid request to an allowed site
</I>&gt;<i> [command]
</I>&gt;<i> curl <A HREF="https://pypi.org/">https://pypi.org/</A> -v --cacert squid.crt -k
</I>
After checking access-transparent.log and cache.log, it appears that
pypi.org is comparing inspections by IP and not by domain.
How do I modify the configuration to allow this correctly by domain?
Also, to begin with, these settings follow the existing squid proxy
created by my predecessor, so I don't know what they are for...
What are the disadvantages of removing these settings?

Thank you in advance.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: squid-transparent.conf
Type: application/octet-stream
Size: 4468 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20240925/9c7ef510/attachment.obj">http://lists.squid-cache.org/pipermail/squid-users/attachments/20240925/9c7ef510/attachment.obj</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="027121.html">[squid-users] Questions about Squid configuration
</A></li>
	<LI>Next message (by thread): <A HREF="027113.html">[squid-users] RFC: Removal of ESI Support from Squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27152">[ date ]</a>
              <a href="thread.html#27152">[ thread ]</a>
              <a href="subject.html#27152">[ subject ]</a>
              <a href="author.html#27152">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
