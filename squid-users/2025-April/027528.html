<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] cacheNumbObject unreasonably small with rock cache
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20cacheNumbObject%20unreasonably%20small%20with%20rock%20cache&In-Reply-To=%3Cb5995f78-8f29-4872-9567-de111f8a78f4%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027527.html">
   <LINK REL="Next"  HREF="027529.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] cacheNumbObject unreasonably small with rock cache</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20cacheNumbObject%20unreasonably%20small%20with%20rock%20cache&In-Reply-To=%3Cb5995f78-8f29-4872-9567-de111f8a78f4%40measurement-factory.com%3E"
       TITLE="[squid-users] cacheNumbObject unreasonably small with rock cache">rousskov at measurement-factory.com
       </A><BR>
    <I>Wed Apr  2 15:21:15 UTC 2025</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="027527.html">[squid-users] cacheNumbObject unreasonably small with rock cache
</A></li>
        <LI>Next message (by thread): <A HREF="027529.html">[squid-users] cacheNumbObject unreasonably small with rock cache
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27528">[ date ]</a>
              <a href="thread.html#27528">[ thread ]</a>
              <a href="subject.html#27528">[ subject ]</a>
              <a href="author.html#27528">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2025-04-02 10:45, Dave Dykstra wrote:

&gt;<i> We're trying rock cache for the first time, on squid 6.13.  The
</I>&gt;<i> machine is quite large and heavily used, with 10 workers configured,
</I>&gt;<i> 140G of shared memory cache, and 500G of rock cache configured.
</I>&gt;<i> However, the cacheNumObject SNMP counter is staying quite steadily at
</I>&gt;<i> around only 570 even as the cache grows.  Currently du shows the rock
</I>&gt;<i> file taking 40G, and the mgr:storedir statistics show 448k entries.
</I>
I assume you are asking about an SNMP measurement that Squid MIB file 
calls cacheNumObjCount (node 1.3.6.1.4.1.3495.1.3.1).

Today, that measurement reports the number of StoreEntry objects 
currently in use. You should see similar stats on the &quot;StoreEntry&quot; line 
in &quot;Internal Data Structures&quot; section of mgr:info cache manager report.

Roughly speaking:

* For UFS-based caches and non-SMP memory caches, that number is often 
(but not always!) close to the number of cached objects because these 
caches create a StoreEntry object for every object stored in the cache. 
That is how these stores index cached content.

* For rock caches and SMP memory caches, that number is usually very 
different from the number of cached objects because these caches do not 
create StoreEntry objects when indexing cached content.

* StoreEntry objects are not limited to caches. Many transactions, 
including many transactions that do not retrieve cache hits and do not 
store cache misses create StoreEntry objects. In related Squid 
terminology, &quot;Store&quot; is not just &quot;cache&quot;, but a more general medium for 
passing HTTP responses around.

I have not checked all the necessary details, but I suspect that SNMP 
code needs to be fixed to report the same stats that are currently 
available on &quot;on-disk objects&quot; line in &quot;Internal Data Structures&quot; 
section of mgr:info cache manager report.

I hope that mgr:storedir statistics that you have mentioned also 
reflects the actual disk cache usage, at least for rock caches.


HTH,

Alex.

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="027527.html">[squid-users] cacheNumbObject unreasonably small with rock cache
</A></li>
	<LI>Next message (by thread): <A HREF="027529.html">[squid-users] cacheNumbObject unreasonably small with rock cache
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27528">[ date ]</a>
              <a href="thread.html#27528">[ thread ]</a>
              <a href="subject.html#27528">[ subject ]</a>
              <a href="author.html#27528">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
