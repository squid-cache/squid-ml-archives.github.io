<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Error determining LDAP server type: Timed out
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Error%20determining%20LDAP%20server%20type%3A%20Timed%20out&In-Reply-To=%3CCADCk2kpNAoDXrx1CkPkiYRM5p-VU8hMBz%3DJLnBeQ2g1S9nGgiA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027530.html">
   <LINK REL="Next"  HREF="027535.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Error determining LDAP server type: Timed out</H1>
    <B>Reinhard Westerholt</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Error%20determining%20LDAP%20server%20type%3A%20Timed%20out&In-Reply-To=%3CCADCk2kpNAoDXrx1CkPkiYRM5p-VU8hMBz%3DJLnBeQ2g1S9nGgiA%40mail.gmail.com%3E"
       TITLE="[squid-users] Error determining LDAP server type: Timed out">reinhard.westerholt at gmail.com
       </A><BR>
    <I>Mon Apr  7 18:42:51 UTC 2025</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="027530.html">[squid-users] cacheNumbObject unreasonably small with rock cache
</A></li>
        <LI>Next message (by thread): <A HREF="027535.html">[squid-users] Error determining LDAP server type: Timed out
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27531">[ date ]</a>
              <a href="thread.html#27531">[ thread ]</a>
              <a href="subject.html#27531">[ subject ]</a>
              <a href="author.html#27531">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello everybody,

I have configured Squid to use Kerberos authentication and employed
ext_kerberos_ldap_group_acl to limit HTTP access. This setup works fine in
most cases. However, randomly (and rarely), there seems to be an issue with
the LDAP query, causing the Active Directory groups to fail to resolve,
which subsequently denies user access. When this occurs, the issue persists
for about an hour. I suspect this might be due to caching or TTL.

Here is a relevant part of the configuration:

auth_param negotiate program /usr/lib/squid/negotiate_kerberos_auth -s
HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">server.fqdn at domain</A>
auth_param negotiate children 500
auth_param negotiate keep_alive on

external_acl_type INetAccess ttl=3600 children-max=1000 %LOGIN
/usr/lib/squid/ext_kerberos_ldap_group_acl -g &quot;INetAccess&quot; -a -i -l
<A HREF="ldap://server.fqdn:389">ldap://server.fqdn:389</A> -D &quot;DOMAIN&quot;


The debug output from `ext_kerberos_ldap_group_acl` appears as follows when
the error occurs:
support_resolv.cc(445): pid=2574238 :2025/04/07 13:49:52|
kerberos_ldap_group: DEBUG: Host: DOMAIN Port: -1 Priority: -2 Weight: -2
support_ldap.cc(1066): pid=2574238 :2025/04/07 13:49:52|
kerberos_ldap_group: DEBUG: Setting up connection to LDAP server
server.fqdn:389
support_ldap.cc(1079): pid=2574238 :2025/04/07 13:49:52|
kerberos_ldap_group: DEBUG: Bind to LDAP server with SASL/GSSAPI
support_ldap.cc(1097): pid=2574238 :2025/04/07 13:49:55|
kerberos_ldap_group: DEBUG: Successfully initialized connection to LDAP
server server.fqdn:389
support_ldap.cc(314): pid=2574238 :2025/04/07 13:49:55|
kerberos_ldap_group: DEBUG: Search LDAP server with bind path &quot;&quot; and
filter: (objectclass=*)
support_ldap.cc(336): pid=2574238 :2025/04/07 13:50:25|
kerberos_ldap_group: DEBUG: Did not find LDAP entry for subschemasubentry
support_ldap.cc(339): pid=2574238 :2025/04/07 13:50:25|
kerberos_ldap_group: DEBUG: Determined LDAP server not as an Active
Directory server
support_ldap.cc(1213): pid=2574238 :2025/04/07 13:50:25|
kerberos_ldap_group: ERROR: Error determining LDAP server type: Timed out


I manually attempted to retrieve the subschemasubentry using ldapsearch. As
far as I can see, there is no issue, or I could not reproduce the problem
manually via ldapsearch.

Does anyone have any ideas on how to further debug this issue?
Additionally, are there any recommendations regarding the TTL value? If I
reduce the TTL, the duration of the issue might be shorter for individual
users.

Thanks in advance.

Kind regards,
Reinhard Westerholt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20250407/9fbba259/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20250407/9fbba259/attachment.htm</A>&gt;
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="027530.html">[squid-users] cacheNumbObject unreasonably small with rock cache
</A></li>
	<LI>Next message (by thread): <A HREF="027535.html">[squid-users] Error determining LDAP server type: Timed out
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27531">[ date ]</a>
              <a href="thread.html#27531">[ thread ]</a>
              <a href="subject.html#27531">[ subject ]</a>
              <a href="author.html#27531">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
