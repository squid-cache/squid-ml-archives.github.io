<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] connect with http and https protocols
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20connect%20with%20http%20and%20https%20protocols&In-Reply-To=%3Cd3069202-5c59-4613-bfcb-532730948640%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027550.html">
   <LINK REL="Next"  HREF="027553.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] connect with http and https protocols</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20connect%20with%20http%20and%20https%20protocols&In-Reply-To=%3Cd3069202-5c59-4613-bfcb-532730948640%40measurement-factory.com%3E"
       TITLE="[squid-users] connect with http and https protocols">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Apr 29 13:50:09 UTC 2025</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="027550.html">[squid-users] connect with http and https protocols
</A></li>
        <LI>Next message (by thread): <A HREF="027553.html">[squid-users] connect with http and https protocols
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27551">[ date ]</a>
              <a href="thread.html#27551">[ thread ]</a>
              <a href="subject.html#27551">[ subject ]</a>
              <a href="author.html#27551">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2025-04-29 02:54, Renzo Marengo wrote:
&gt;<i> When client uses CONNECT directive I understand that proxy establishes 
</I>&gt;<i> tunnel to destination host on specified port
</I>
Yes, the proxy establishes a TCP tunnel with the destination.


&gt;<i> 1. I don't understand if this occurs both in presence of http and https 
</I>&gt;<i> requests, The request (using CONNECT method) can be http or https ?
</I>
I do not know how _you_ define &quot;http&quot; and &quot;https&quot; in this context, but 
CONNECT request may be received on a plain text connection (i.e. a 
connection to an http_port), on an encrypted connection (i.e. a TLS 
connection to an https_port), and even inside a bumped TLS connection 
(on either port; e.g., a CONNECT request received inside a bumped 
CONNECT tunnel)!


&gt;<i> 2.&#160; if In both cases CONNECT method is invoked but how I can discover 
</I>&gt;<i> protocol (http, https) looking for inside access.log ?
</I>
If you are not telling Squid to bump the corresponding CONNECT tunnel 
using ssl_bump, then you cannot discover the protocol inside that 
tunnel. Squid is just shoveling opaque bytes using TCP in that (default) 
case.

If Squid successfully bumps the corresponding CONNECT tunnel, then the 
protocol inside that tunnel is HTTPS or, more precise, TLS-encrypted 
HTTP/0 or HTTP/1 transactions. You should see those decrypted 
transactions in access.log, logged with the same 
%transport::&gt;connection_id as the CONNECT transaction.

If Squid attempts to bump the corresponding CONNECT tunnel, and that 
tunnel starts with a TLS handshake, then you may be able to recover the 
underlying protocol from ALPN extension in %&gt;handshake.

See logformat directive for the above %code documentation:
<A HREF="https://www.squid-cache.org/Doc/config/logformat/">https://www.squid-cache.org/Doc/config/logformat/</A>


HTH,

Alex.

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="027550.html">[squid-users] connect with http and https protocols
</A></li>
	<LI>Next message (by thread): <A HREF="027553.html">[squid-users] connect with http and https protocols
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27551">[ date ]</a>
              <a href="thread.html#27551">[ thread ]</a>
              <a href="subject.html#27551">[ subject ]</a>
              <a href="author.html#27551">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
