<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] 2FA with Google Authenticator and squid login
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%202FA%20with%20Google%20Authenticator%20and%20squid%20login&In-Reply-To=%3C0c72c673-15d6-42d3-8d34-7bd1cfa12ebc%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027413.html">
   <LINK REL="Next"  HREF="027409.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] 2FA with Google Authenticator and squid login</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%202FA%20with%20Google%20Authenticator%20and%20squid%20login&In-Reply-To=%3C0c72c673-15d6-42d3-8d34-7bd1cfa12ebc%40treenet.co.nz%3E"
       TITLE="[squid-users] 2FA with Google Authenticator and squid login">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon Feb  3 07:58:14 UTC 2025</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="027413.html">[squid-users] 2FA with Google Authenticator and squid login
</A></li>
        <LI>Next message (by thread): <A HREF="027409.html">[squid-users] squid_icap to icap to system_2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27414">[ date ]</a>
              <a href="thread.html#27414">[ thread ]</a>
              <a href="subject.html#27414">[ subject ]</a>
              <a href="author.html#27414">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 3/02/25 18:25, NgTech LTD wrote:
&gt;<i> What i was talking about is using both the auth helper and the external 
</I>&gt;<i> ack helper.
</I>

Using an ACL helper is just extra complication that is not needed and 
the &quot;Keep It Simple&quot; (KIS) principle of design is very important for 
security systems.


For &quot;global&quot; access you can authorize OR authenticate. Doing &quot;validate + 
authorize + authorize&quot; is pointless for this use-case.

You only need to add authorization on top of authentication (eg user 
login + group access) if you have some non-global resources/area needing 
special authorization that is not granted by just the login.



At the lowest-level of operations:
  * the auth_param helper performs security action &quot;Validate&quot;. The 
http_access rules you use to call it perform security action &quot;Authorize&quot;.

  * the external ACL helper performs &quot;nothing&quot;[0] as far as Squid is 
concerned. The http_access rules you use to call it perform security 
action &quot;Authorize&quot;.

[0] It could actually be doing anything, but Squid cannot know what. In 
particular it does **not** trigger Squid to apply any HTTP 
authentication-related security requirements on the HTTP request/reply 
handling (where the HTTP headers used by auth_param does trigger those) 
- which can potentially be **extremely** dangerous.



&gt;<i> The password is static but the authorization itself is done via some 
</I>&gt;<i> push or another totp method that will authorize the login for a specific 
</I>&gt;<i> amount of time.
</I>

Sure. But you do not need an external ACL for that.

In my earlier suggested design the altered ERR_* page has a HTML form 
for POST'ing the 2FA token somewhere directly from the clients Browser 
to a server. That other service is what grants the &quot;Valid&quot; status to 
complete the 2FA login.


**IF** that POST goes through Squid it should use an unrelated TCP 
connection and/or HTTPS security - so there is no way for Squid or any 
other service than your auth server to know which previous client login 
it applies to.



&gt;<i> And indeed it will kind of degrade the connection to 1fa for a period of 
</I>&gt;<i> time, but, it will protect against couple specific attacks.
</I>&gt;<i> So, if the proxy connection is encrypted inside a tunnel then it's ok.
</I>

To be 2FA by definition the entire process has to happen over two 
distinct channels, each being used to pass a different token (a.k.a. 
&quot;factor&quot;).

case 1: client does not send any user+pass at all:

  channel 1: client -&gt; Squid : (no login)
	  : Squid-&gt;client   : 401 login required

  channel 2: auth server -&gt; email : token

  channel 1: client -&gt; Squid : POST username + pass + token
	  : Squid-&gt;client   : 200 login confirmed,



case 2: client sends login details, but no 2FA yet:

  channel 1: client -&gt; Squid : HTTP username + pass
	  : Squid-&gt;client   : 401 login required

  channel 2: auth server -&gt; email : token

  channel 1: client -&gt; Squid : POST username + pass + token
	  : Squid-&gt;client   : 200 login confirmed,


NB: in both cases you could do a 307 redirect back to the original 
requested URL if it is known at that late stage.



&gt;<i> 
</I>&gt;<i> As for a directly accessible proxy over plain http, it will be 
</I>&gt;<i> vulnerable to many auth attacks..
</I>
This is not relevant. Any login system faces the same risks of attack 
floods.And the &quot;plain HTTP&quot; is not required. It is only part of this 
discussion because Squid is an HTTP proxy. Thus messages are interpreted 
by Squid as HTTP regardless if they were received as &quot;plain&quot; or HTTPS.


HTH
Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="027413.html">[squid-users] 2FA with Google Authenticator and squid login
</A></li>
	<LI>Next message (by thread): <A HREF="027409.html">[squid-users] squid_icap to icap to system_2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27414">[ date ]</a>
              <a href="thread.html#27414">[ thread ]</a>
              <a href="subject.html#27414">[ subject ]</a>
              <a href="author.html#27414">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
