<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Need clarifications on custom log timestamps
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Need%20clarifications%20on%20custom%20log%20timestamps&In-Reply-To=%3Cc6adf5db-11e2-456c-9df1-1e1ac3072f9a%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027449.html">
   <LINK REL="Next"  HREF="027463.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Need clarifications on custom log timestamps</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Need%20clarifications%20on%20custom%20log%20timestamps&In-Reply-To=%3Cc6adf5db-11e2-456c-9df1-1e1ac3072f9a%40measurement-factory.com%3E"
       TITLE="[squid-users] Need clarifications on custom log timestamps">rousskov at measurement-factory.com
       </A><BR>
    <I>Wed Feb 19 16:39:34 UTC 2025</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="027449.html">[squid-users] Need clarifications on custom log timestamps
</A></li>
        <LI>Next message (by thread): <A HREF="027463.html">[squid-users] Need clarifications on custom log timestamps
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27450">[ date ]</a>
              <a href="thread.html#27450">[ thread ]</a>
              <a href="subject.html#27450">[ subject ]</a>
              <a href="author.html#27450">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2025-02-19 06:26, BENJAMIN DELANNOY wrote:

&gt;<i> For %&lt;pt : &quot;The timer starts when the last request byte is sent to the 
</I>&gt;<i> next hop and stops when the last response byte is received.&quot;&#160; Are we 
</I>&gt;<i> talking of last request / last response of a single TCP connection on 
</I>&gt;<i> server side ?
</I>
I believe the short answer is &quot;no&quot;: If Squid uses multiple TCP 
Squid-peer connections to forward a single client request, then the last 
connection used for that request forwarding should determine overall 
transaction outcome and %&lt;pt values in access.log.


&gt;<i> Do we agree that we are purely talking about 
</I>&gt;<i> request/response on HTTP, and thus this time does not take into account 
</I>&gt;<i> the time spent with SSL negotiation&#160;/ squid actions before ?
</I>
I believe the short answer is &quot;yes&quot;: Today, %&lt;pt timer starts after the 
HTTP (or FTP) request is written to the peer, so TLS handshake (if any) 
would happen before that timer starts. AFAIK, Squid does not support 
0-RTT TLS.


&gt;<i> For %&lt;tt : I understand that all the time spent&#160;sending&#160;requests &amp; 
</I>&gt;<i> waiting responses from the Origin are added. It would also means that if 
</I>&gt;<i> I subtract this timer to %tr, I would have only the ClientSide time 
</I>&gt;<i> before first packet is sent to Origin by the squid &amp; after the last 
</I>&gt;<i> packet is received from the Origin ?
</I>
Yes, but &quot;before&quot; and &quot;after&quot; can be misleading here (in general) 
because there may be periods of time when Squid is _not_ talking to a 
peer but is working on what you call &quot;ClientSide&quot;. For example, there is 
code that decides whether to revalidate a received peer response. From 
Squid point of view, that code runs on &quot;ClientSide&quot; -- %&lt;tt timers may 
be stopped when that code runs. Since you are not caching, that 
particular code is not relevant to you.

Also, please keep in mind that a slow client may effectively stall 
Squid-to-peer I/O by not consuming response data fast enough, filling 
Squid response buffers (see read_ahead_gap). If one only looks at &quot;%tr - 
%&lt;tt&quot; difference in such cases, one would observe near-0 values and may 
mistakenly conclude that the slow client is super fast!



&gt;<i> Actually, what I want&#160;to monitor, is the time between the first client 
</I>&gt;<i> packet received on the Squid and the time the squid makes its choice :
</I>&gt;<i> - based on SNI for SSL Splice
</I>&gt;<i> - based on HTTP ACL (HTTP traffic or HTTPS traffic with SSL Bump)
</I>&gt;<i> Based on this, I would be able to check if a squid server is taking too 
</I>&gt;<i> much time making a decision.
</I>&gt;<i> 
</I>&gt;<i> Is this something feasible?
</I>
Please detail what you mean by &quot;choice&quot; or &quot;decision&quot;. For example, do 
you want to stop the timer when Squid makes its final http_access decision?


Thank you,

Alex.


&gt;<i> On Mon, Feb 17, 2025 at 4:47&#8239;PM Alex Rousskov wrote:
</I>&gt;<i> 
</I>&gt;<i>     On 2025-02-17 10:02, BENJAMIN DELANNOY wrote:
</I>&gt;<i> 
</I>&gt;<i>      &gt; I try to figure out what is exactly measured with the &lt;pt &amp; &lt;tt
</I>&gt;<i>     timings.
</I>&gt;<i>      &gt; I don't get what are the difference between them, what is the
</I>&gt;<i>     difference
</I>&gt;<i>      &gt; between &quot;peer response time&quot; &amp; &quot;time spent forwarding to origin
</I>&gt;<i>      &gt; servers&quot;,
</I>&gt;<i> 
</I>&gt;<i>     Have you seen %&lt;pt and %&lt;tt descriptions at [1]? %&lt;tt description was
</I>&gt;<i>     updated in August 2024, and squid.conf.documented in Squid v6 and
</I>&gt;<i>     earlier does not have those documentation updates (and the
</I>&gt;<i>     corresponding
</I>&gt;<i>     bug fixes)...
</I>&gt;<i> 
</I>&gt;<i>     [1] <A HREF="http://www.squid-cache.org/Doc/config/logformat/">http://www.squid-cache.org/Doc/config/logformat/</A>
</I>&gt;<i>     &lt;<A HREF="http://www.squid-cache.org/Doc/config/logformat/">http://www.squid-cache.org/Doc/config/logformat/</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>      &gt; what is the &quot;last I/O with the last peer&quot;, etc.
</I>&gt;<i> 
</I>&gt;<i>     When forwarding a single client request, Squid may talk to multiple
</I>&gt;<i>     cache_peer and origin server addresses (collectively called &quot;peers&quot;).
</I>&gt;<i>     Talking to a given peer may include multiple socket reading and writing
</I>&gt;<i>     (i.e. I/O) events. Does this clarify?
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>      &gt; For information, I aim to calculate the time spent on the
</I>&gt;<i>     client-side &amp;
</I>&gt;<i>      &gt; by squid processing time,&#160; excluding the server-side time spent
</I>&gt;<i>     (=what I
</I>&gt;<i>      &gt; don't manage).
</I>&gt;<i> 
</I>&gt;<i>     This kind of calculation is a common need. Please keep in mind that
</I>&gt;<i>     Squid may spend time on the client side (e.g., awaiting the next
</I>&gt;<i>     request
</I>&gt;<i>     body byte) while also spending time on the server side (e.g., awaiting
</I>&gt;<i>     the next response body byte), complicating things.
</I>&gt;<i> 
</I>&gt;<i>     If existing %codes are not enough, please detail your needs in terms of
</I>&gt;<i>     events that Squid can recognize (e.g., receiving the first response
</I>&gt;<i>     header byte or sending the last request body byte).
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     HTH,
</I>&gt;<i> 
</I>&gt;<i>     Alex.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>      &gt; We do not use squid for caching but only for http &amp; ssl
</I>&gt;<i>     proxy/filtering.
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; Thanks a lot !
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; Cordialement, Regards,
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; Benjamin DELANNOY
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; Cloud Network Engineer
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; NETWORK SOLUTIONS - GTDP
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; Mobile +33 (0)6 16 98 23 72
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; 135 rue Sadi Carnot &#8226; CS 00001 &#8226; 59790 Ronchin &#8226; FRANCE
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; positivetech.adeo.com &lt;<A HREF="http://positivetech.adeo.com">http://positivetech.adeo.com</A>&gt;
</I>&gt;<i>     &lt;<A HREF="https://positivetech.adeo.com/">https://positivetech.adeo.com/</A> &lt;<A HREF="https://positivetech.adeo.com/">https://positivetech.adeo.com/</A>&gt;&gt;
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; adeolinkedin &lt;<A HREF="https://www.linkedin.com/company/groupe-adeo">https://www.linkedin.com/company/groupe-adeo</A>
</I>&gt;<i>     &lt;<A HREF="https://www.linkedin.com/company/groupe-adeo">https://www.linkedin.com/company/groupe-adeo</A>&gt;&gt;
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; _______________________________________________
</I>&gt;<i>      &gt; squid-users mailing list
</I>&gt;<i>      &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i>      &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>     &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>&gt;
</I>&gt;<i> 
</I>&gt;<i>     _______________________________________________
</I>&gt;<i>     squid-users mailing list
</I>&gt;<i>     <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i>     <A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>     &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>&gt;
</I>&gt;<i> 
</I>
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="027449.html">[squid-users] Need clarifications on custom log timestamps
</A></li>
	<LI>Next message (by thread): <A HREF="027463.html">[squid-users] Need clarifications on custom log timestamps
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27450">[ date ]</a>
              <a href="thread.html#27450">[ thread ]</a>
              <a href="subject.html#27450">[ subject ]</a>
              <a href="author.html#27450">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
