<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Need clarifications on custom log timestamps
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Need%20clarifications%20on%20custom%20log%20timestamps&In-Reply-To=%3CCAPUgoGtZPb3rpufJDrxKpFr6KL9MAEY_dprxTx-UufqUmFs6oQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027450.html">
   <LINK REL="Next"  HREF="027468.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Need clarifications on custom log timestamps</H1>
    <B>BENJAMIN DELANNOY</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Need%20clarifications%20on%20custom%20log%20timestamps&In-Reply-To=%3CCAPUgoGtZPb3rpufJDrxKpFr6KL9MAEY_dprxTx-UufqUmFs6oQ%40mail.gmail.com%3E"
       TITLE="[squid-users] Need clarifications on custom log timestamps">benjamin.delannoy at adeo.com
       </A><BR>
    <I>Tue Feb 25 11:33:24 UTC 2025</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="027450.html">[squid-users] Need clarifications on custom log timestamps
</A></li>
        <LI>Next message (by thread): <A HREF="027468.html">[squid-users] Need clarifications on custom log timestamps
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27463">[ date ]</a>
              <a href="thread.html#27463">[ thread ]</a>
              <a href="subject.html#27463">[ subject ]</a>
              <a href="author.html#27463">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> Please detail what you mean by &quot;choice&quot; or &quot;decision&quot;. For example, do
</I>&gt;<i> you want to stop the timer when Squid makes its final http_access
</I>decision?

I mean I want to monitor the latency on what I could manage : the
communication between client &amp; squid, the time squid uses to process
requests. But not the time spent by the destination server as I don't
manage it.
This could be multiple monitors if 1 is too complicated or not possible. So
yes for example a timer that stop when Squid makes its final http_access
decision (in case of http or bumped https) or its final ssl_bump splice
decision.

Thanks a lot for your time !


Cordialement, Regards,


Benjamin DELANNOY

On Wed, Feb 19, 2025 at 5:39&#8239;PM Alex Rousskov &lt;
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt; wrote:

&gt;<i> On 2025-02-19 06:26, BENJAMIN DELANNOY wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; For %&lt;pt : &quot;The timer starts when the last request byte is sent to the
</I>&gt;<i> &gt; next hop and stops when the last response byte is received.&quot;  Are we
</I>&gt;<i> &gt; talking of last request / last response of a single TCP connection on
</I>&gt;<i> &gt; server side ?
</I>&gt;<i>
</I>&gt;<i> I believe the short answer is &quot;no&quot;: If Squid uses multiple TCP
</I>&gt;<i> Squid-peer connections to forward a single client request, then the last
</I>&gt;<i> connection used for that request forwarding should determine overall
</I>&gt;<i> transaction outcome and %&lt;pt values in access.log.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; Do we agree that we are purely talking about
</I>&gt;<i> &gt; request/response on HTTP, and thus this time does not take into account
</I>&gt;<i> &gt; the time spent with SSL negotiation / squid actions before ?
</I>&gt;<i>
</I>&gt;<i> I believe the short answer is &quot;yes&quot;: Today, %&lt;pt timer starts after the
</I>&gt;<i> HTTP (or FTP) request is written to the peer, so TLS handshake (if any)
</I>&gt;<i> would happen before that timer starts. AFAIK, Squid does not support
</I>&gt;<i> 0-RTT TLS.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; For %&lt;tt : I understand that all the time spent sending requests &amp;
</I>&gt;<i> &gt; waiting responses from the Origin are added. It would also means that if
</I>&gt;<i> &gt; I subtract this timer to %tr, I would have only the ClientSide time
</I>&gt;<i> &gt; before first packet is sent to Origin by the squid &amp; after the last
</I>&gt;<i> &gt; packet is received from the Origin ?
</I>&gt;<i>
</I>&gt;<i> Yes, but &quot;before&quot; and &quot;after&quot; can be misleading here (in general)
</I>&gt;<i> because there may be periods of time when Squid is _not_ talking to a
</I>&gt;<i> peer but is working on what you call &quot;ClientSide&quot;. For example, there is
</I>&gt;<i> code that decides whether to revalidate a received peer response. From
</I>&gt;<i> Squid point of view, that code runs on &quot;ClientSide&quot; -- %&lt;tt timers may
</I>&gt;<i> be stopped when that code runs. Since you are not caching, that
</I>&gt;<i> particular code is not relevant to you.
</I>&gt;<i>
</I>&gt;<i> Also, please keep in mind that a slow client may effectively stall
</I>&gt;<i> Squid-to-peer I/O by not consuming response data fast enough, filling
</I>&gt;<i> Squid response buffers (see read_ahead_gap). If one only looks at &quot;%tr -
</I>&gt;<i> %&lt;tt&quot; difference in such cases, one would observe near-0 values and may
</I>&gt;<i> mistakenly conclude that the slow client is super fast!
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; Actually, what I want to monitor, is the time between the first client
</I>&gt;<i> &gt; packet received on the Squid and the time the squid makes its choice :
</I>&gt;<i> &gt; - based on SNI for SSL Splice
</I>&gt;<i> &gt; - based on HTTP ACL (HTTP traffic or HTTPS traffic with SSL Bump)
</I>&gt;<i> &gt; Based on this, I would be able to check if a squid server is taking too
</I>&gt;<i> &gt; much time making a decision.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Is this something feasible?
</I>&gt;<i>
</I>&gt;<i> Please detail what you mean by &quot;choice&quot; or &quot;decision&quot;. For example, do
</I>&gt;<i> you want to stop the timer when Squid makes its final http_access decision?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thank you,
</I>&gt;<i>
</I>&gt;<i> Alex.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; On Mon, Feb 17, 2025 at 4:47&#8239;PM Alex Rousskov wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     On 2025-02-17 10:02, BENJAMIN DELANNOY wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;      &gt; I try to figure out what is exactly measured with the &lt;pt &amp; &lt;tt
</I>&gt;<i> &gt;     timings.
</I>&gt;<i> &gt;      &gt; I don't get what are the difference between them, what is the
</I>&gt;<i> &gt;     difference
</I>&gt;<i> &gt;      &gt; between &quot;peer response time&quot; &amp; &quot;time spent forwarding to origin
</I>&gt;<i> &gt;      &gt; servers&quot;,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     Have you seen %&lt;pt and %&lt;tt descriptions at [1]? %&lt;tt description was
</I>&gt;<i> &gt;     updated in August 2024, and squid.conf.documented in Squid v6 and
</I>&gt;<i> &gt;     earlier does not have those documentation updates (and the
</I>&gt;<i> &gt;     corresponding
</I>&gt;<i> &gt;     bug fixes)...
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     [1] <A HREF="http://www.squid-cache.org/Doc/config/logformat/">http://www.squid-cache.org/Doc/config/logformat/</A>
</I>&gt;<i> &gt;     &lt;<A HREF="http://www.squid-cache.org/Doc/config/logformat/">http://www.squid-cache.org/Doc/config/logformat/</A>&gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;      &gt; what is the &quot;last I/O with the last peer&quot;, etc.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     When forwarding a single client request, Squid may talk to multiple
</I>&gt;<i> &gt;     cache_peer and origin server addresses (collectively called &quot;peers&quot;).
</I>&gt;<i> &gt;     Talking to a given peer may include multiple socket reading and
</I>&gt;<i> writing
</I>&gt;<i> &gt;     (i.e. I/O) events. Does this clarify?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;      &gt; For information, I aim to calculate the time spent on the
</I>&gt;<i> &gt;     client-side &amp;
</I>&gt;<i> &gt;      &gt; by squid processing time,  excluding the server-side time spent
</I>&gt;<i> &gt;     (=what I
</I>&gt;<i> &gt;      &gt; don't manage).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     This kind of calculation is a common need. Please keep in mind that
</I>&gt;<i> &gt;     Squid may spend time on the client side (e.g., awaiting the next
</I>&gt;<i> &gt;     request
</I>&gt;<i> &gt;     body byte) while also spending time on the server side (e.g.,
</I>&gt;<i> awaiting
</I>&gt;<i> &gt;     the next response body byte), complicating things.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     If existing %codes are not enough, please detail your needs in terms
</I>&gt;<i> of
</I>&gt;<i> &gt;     events that Squid can recognize (e.g., receiving the first response
</I>&gt;<i> &gt;     header byte or sending the last request body byte).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     HTH,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     Alex.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;      &gt; We do not use squid for caching but only for http &amp; ssl
</I>&gt;<i> &gt;     proxy/filtering.
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt; Thanks a lot !
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt; Cordialement, Regards,
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt; Benjamin DELANNOY
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt; Cloud Network Engineer
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt; NETWORK SOLUTIONS - GTDP
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt; Mobile +33 (0)6 16 98 23 72
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt; 135 rue Sadi Carnot &#8226; CS 00001 &#8226; 59790 Ronchin &#8226; FRANCE
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt; positivetech.adeo.com &lt;<A HREF="http://positivetech.adeo.com">http://positivetech.adeo.com</A>&gt;
</I>&gt;<i> &gt;     &lt;<A HREF="https://positivetech.adeo.com/">https://positivetech.adeo.com/</A> &lt;<A HREF="https://positivetech.adeo.com/">https://positivetech.adeo.com/</A>&gt;&gt;
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt; adeolinkedin &lt;<A HREF="https://www.linkedin.com/company/groupe-adeo">https://www.linkedin.com/company/groupe-adeo</A>
</I>&gt;<i> &gt;     &lt;<A HREF="https://www.linkedin.com/company/groupe-adeo">https://www.linkedin.com/company/groupe-adeo</A>&gt;&gt;
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt;
</I>&gt;<i> &gt;      &gt; _______________________________________________
</I>&gt;<i> &gt;      &gt; squid-users mailing list
</I>&gt;<i> &gt;      &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> &gt;     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i> &gt;      &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> &gt;     &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>&gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     _______________________________________________
</I>&gt;<i> &gt;     squid-users mailing list
</I>&gt;<i> &gt;     <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> &gt;     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i> &gt;     <A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> &gt;     &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>&gt;
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20250225/d759fb9e/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20250225/d759fb9e/attachment.htm</A>&gt;
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="027450.html">[squid-users] Need clarifications on custom log timestamps
</A></li>
	<LI>Next message (by thread): <A HREF="027468.html">[squid-users] Need clarifications on custom log timestamps
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27463">[ date ]</a>
              <a href="thread.html#27463">[ thread ]</a>
              <a href="subject.html#27463">[ subject ]</a>
              <a href="author.html#27463">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
