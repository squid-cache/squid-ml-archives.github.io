<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] disable/block ipv6 requests
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20disable/block%20ipv6%20requests&In-Reply-To=%3CZ78DlZHsY8S-E1d7%40fantomas.sk%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027469.html">
   <LINK REL="Next"  HREF="027471.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] disable/block ipv6 requests</H1>
    <B>Matus UHLAR - fantomas</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20disable/block%20ipv6%20requests&In-Reply-To=%3CZ78DlZHsY8S-E1d7%40fantomas.sk%3E"
       TITLE="[squid-users] disable/block ipv6 requests">uhlar at fantomas.sk
       </A><BR>
    <I>Wed Feb 26 12:05:41 UTC 2025</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="027469.html">[squid-users] Clients Header User-Agent replace?
</A></li>
        <LI>Next message (by thread): <A HREF="027471.html">[squid-users] disable/block ipv6 requests
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27470">[ date ]</a>
              <a href="thread.html#27470">[ thread ]</a>
              <a href="subject.html#27470">[ subject ]</a>
              <a href="author.html#27470">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

I maintain a few servers that currently do not have IPv6 connectivity.

Until we fix this, I'd like squid to avoid considering using ipv6, 
because even if any ipv6 attempt failed, there still were some being made
... at least I assume so from squid logs:

1740062747.503      0 192.0.2.1 NONE_NONE/503 0 CONNECT ad.turn.com:443 - HIER_DIRECT/2001:678:cb4:bbbb::11 -

As I understand it, I can build squid without ipv6 support. 
Is there any other way to disable outgoing ipv6 communication?


 From what I read in archives using &quot;acl&quot; makes no sense, as it decides 
whether to block request or not:
<A HREF="https://marc.info/?l=squid-users&amp;m=168180685516039&amp;w=2">https://marc.info/?l=squid-users&amp;m=168180685516039&amp;w=2</A>

...and the directive dns_v4_first is long obsolete:
<A HREF="https://marc.info/?l=squid-users&amp;m=168181162219573&amp;w=2">https://marc.info/?l=squid-users&amp;m=168181162219573&amp;w=2</A>


What I have tried:

1. disabling ipv6 by setting (linux) 
net.ipv6.conf.all.disable_ipv6=1

but in logs squid complains:

2025/02/24 00:00:10| WARNING: BCP 177 violation. Detected non-functional IPv6 loopback.

2. reboot linux kernel with option &quot;ipv6.disable=1&quot;

(at least the ipv6 attempts stopped)

After either of last two attempts, squid seems to crash too often. 

#4  0x00007f028a174eb2 in __assert_fail () from /lib/x86_64-linux-gnu/libc.so.6
#5  0x0000564f2a77e824 in Ip::Address::getAddrInfo(addrinfo*&amp;, int) const ()

I have squid 5.7 on Debian 12

-- 
Matus UHLAR - fantomas, <A HREF="https://lists.squid-cache.org/listinfo/squid-users">uhlar at fantomas.sk</A> ; <A HREF="http://www.fantomas.sk/">http://www.fantomas.sk/</A>
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
I'm not interested in your website anymore.
If you need cookies, bake them yourself.
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="027469.html">[squid-users] Clients Header User-Agent replace?
</A></li>
	<LI>Next message (by thread): <A HREF="027471.html">[squid-users] disable/block ipv6 requests
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27470">[ date ]</a>
              <a href="thread.html#27470">[ thread ]</a>
              <a href="subject.html#27470">[ subject ]</a>
              <a href="author.html#27470">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
