<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] StoreID Question
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20StoreID%20Question&In-Reply-To=%3CCALmccy7OZL-dvjUD7cHfRPZxRhSA%3DEgrRR94BVCkcqMg0QNpvA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027348.html">
   <LINK REL="Next"  HREF="027349.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] StoreID Question</H1>
    <B>Robin Wood</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20StoreID%20Question&In-Reply-To=%3CCALmccy7OZL-dvjUD7cHfRPZxRhSA%3DEgrRR94BVCkcqMg0QNpvA%40mail.gmail.com%3E"
       TITLE="[squid-users] StoreID Question">squid at digi.ninja
       </A><BR>
    <I>Wed Jan  1 08:27:36 UTC 2025</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="027348.html">[squid-users] Thoughts on caching aspx jsp asp cgi-bin
</A></li>
        <LI>Next message (by thread): <A HREF="027349.html">[squid-users] StoreID Question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27346">[ date ]</a>
              <a href="thread.html#27346">[ thread ]</a>
              <a href="subject.html#27346">[ subject ]</a>
              <a href="author.html#27346">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I've not got time to read your whole email, but you are asking about
regular expressions.

^http:\/\/[^\.]+\.dl\.sourceforge\.net\/(.*)
<A HREF="http://dl.sourceforge.net.squid.internal/$1">http://dl.sourceforge.net.squid.internal/$1</A>

What this means is to match the first URL and &quot;capture&quot; the bit at the end,
the bit in brackets. This then gets rewritten to the second URL with the
captured bit added on to the end, that is $1. If you captured two things in
brackets the first would be $1, the second $2.

Do some reading on regex and regular expressions. The basics are relatively
easy to understand, beyond that, it can get very complicated very quickly.

Robin

On Tue, 31 Dec 2024, 23:05 Jonathan Lee, &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">jonathanlee571 at gmail.com</A>&gt; wrote:

&gt;<i> *Hello Fellow Squid Users,*
</I>&gt;<i>
</I>&gt;<i> *Can you please help? I have been researching this for a long time and
</I>&gt;<i> cannot find any information on this &quot;what is the $ mean&#8221; within StoreID?*
</I>&gt;<i>
</I>&gt;<i> *Below is my failed attempt to make StoreID work correctly. Sorry it's a
</I>&gt;<i> mess. I have since disabled my customized StoreID patterns because it
</I>&gt;<i> caused issues. My question is with regard to the $number part of the
</I>&gt;<i> program. I disabled all the facebook and all my tests because my photos
</I>&gt;<i> where showing up wrong and it would duplicate itself over everything, I
</I>&gt;<i> would have to clear the cache and change items and try again below is my
</I>&gt;<i> failed attempt to get it to work correctly. *
</I>&gt;<i>
</I>&gt;<i> *It did work sometimes however I would get issues the longer it went on
</I>&gt;<i> for. I decided to stop the trial and testing of it because it was driving
</I>&gt;<i> me crazy. It is a great puzzle to solve. Does anyone have any tips? I have
</I>&gt;<i> some Squid text books like the Squid the definitive guide, and The Squid
</I>&gt;<i> Proxy Server 3.1 guide still nothing really explains StoreID outside of the
</I>&gt;<i> Squid website. Yes the website comes with a great database that does work,
</I>&gt;<i> I tested some database items with Ubuntu updates inside of VMs and it
</I>&gt;<i> worked and reserved them to other machines asking for the same update. So
</I>&gt;<i> in my quest I thought can I also do this with Facebook&#8230; (I do not recommend
</I>&gt;<i> you try it) or something else, Youtube. *
</I>&gt;<i>
</I>&gt;<i> *This is the Text file I have been testing and it was a failed test
</I>&gt;<i> outside of Ubuntu updates however I do not use that OS anymore so it is
</I>&gt;<i> removed I think I had the $ wrong I have no info on what it does some are 1
</I>&gt;<i> some are 5 some are doubles $ and another of them:*
</I>&gt;<i>
</I>&gt;<i> *^https?:\/\/(fbcdn|scontent).*(akamaihd|fbcdn)\.net\/.*\/v\/.*\/(.*\.mp4)
</I>&gt;<i> <A HREF="http://facebook.squid.internal/$3">http://facebook.squid.internal/$3</A> &lt;<A HREF="http://facebook.squid.internal/$3">http://facebook.squid.internal/$3</A>&gt;*
</I>&gt;<i> *^https?:\/\/fbcdn\-(static|profile)\-a\.akamaihd\.net\/static\-ak\/rsrc\.php\/((?!.*\.(?:js|css|swf)).*)
</I>&gt;<i> <A HREF="http://facebook.squid.internal/static/$2">http://facebook.squid.internal/static/$2</A>
</I>&gt;<i> &lt;<A HREF="http://facebook.squid.internal/static/$2">http://facebook.squid.internal/static/$2</A>&gt;*
</I>&gt;<i> *^https?:\/\/(fbcdn|scontent).*(akamaihd|fbcdn)\.net\/(h|s)(profile|photos).*\/(.*\.(png|gif|jpg))(\?.+)?
</I>&gt;<i> <A HREF="http://facebook.squid.internal/$5">http://facebook.squid.internal/$5</A> &lt;<A HREF="http://facebook.squid.internal/$5">http://facebook.squid.internal/$5</A>&gt;*
</I>&gt;<i> *^https?:\/\/fbstatic\-a\.akamaihd\.net\/rsrc\.php\/((?!.*\.(?:js|css|swf)).*)
</I>&gt;<i> <A HREF="http://facebook.squid.internal/static/$1">http://facebook.squid.internal/static/$1</A>
</I>&gt;<i> &lt;<A HREF="http://facebook.squid.internal/static/$1">http://facebook.squid.internal/static/$1</A>&gt;*
</I>&gt;<i> *^http:\/\/.*[steampowered|steamcontent]\.com\/([^?]*)
</I>&gt;<i> <A HREF="http://steamupdates.squid.internal/$1">http://steamupdates.squid.internal/$1</A>
</I>&gt;<i> &lt;<A HREF="http://steamupdates.squid.internal/$1">http://steamupdates.squid.internal/$1</A>&gt;*
</I>&gt;<i> *^https?\:\/\/download\.oracle\.com\/((otn\-pub|otn)\/[\d\w]+\/[\d\w]+\/[\w\d\-]+\/[\w\d\-]+\.(exe|dmg|rpm|msi|tar\.(gz|Z)))\?
</I>&gt;<i> <A HREF="http://java.oracle.otn.ngtech.squid.internal/$1">http://java.oracle.otn.ngtech.squid.internal/$1</A>
</I>&gt;<i> &lt;<A HREF="http://java.oracle.otn.ngtech.squid.internal/$1">http://java.oracle.otn.ngtech.squid.internal/$1</A>&gt;*
</I>&gt;<i> *^https?\:\/\/([\d\w\-]+)\.oracle\.com\/(([\d\w]+)\/[\d\w]+\/[\d\w]+\/([\d\w\-]+)\/([\d\w]+\/)?[\d\w\-\.\_]+\.(dmg|msi|exe|tar\.gz|tar\.Z))\?
</I>&gt;<i> <A HREF="http://java.oracle.download.ngtech.squid.internal/$2">http://java.oracle.download.ngtech.squid.internal/$2</A>
</I>&gt;<i> &lt;<A HREF="http://java.oracle.download.ngtech.squid.internal/$2">http://java.oracle.download.ngtech.squid.internal/$2</A>&gt;*
</I>&gt;<i> *^http:\/\/[^\.]+\.phobos\.apple\.com\/(.*)
</I>&gt;<i> <A HREF="http://appupdates.apple.squid.internal/$1">http://appupdates.apple.squid.internal/$1</A>
</I>&gt;<i> &lt;<A HREF="http://appupdates.apple.squid.internal/$1">http://appupdates.apple.squid.internal/$1</A>&gt;*
</I>&gt;<i> *^http:\/\/[^\.]+\.c\.android\.clients\.google\.com\/(.*)
</I>&gt;<i> <A HREF="http://androidupdates.google.squid.internal/$1">http://androidupdates.google.squid.internal/$1</A>
</I>&gt;<i> &lt;<A HREF="http://androidupdates.google.squid.internal/$1">http://androidupdates.google.squid.internal/$1</A>&gt;*
</I>&gt;<i>
</I>&gt;<i> *My question here is:*
</I>&gt;<i> *What does this $3 mean within the the store id program?*
</I>&gt;<i>
</I>&gt;<i> *This is the config and refresh patterns that I was learning with for
</I>&gt;<i> Squid StoreID. Much of it is &#8220;#&#8221;ed out but this is what I was using:*
</I>&gt;<i>
</I>&gt;<i> *#store_id_program /usr/local/libexec/squid/storeid_file_rewrite
</I>&gt;<i> /var/squid/storeid/storeid_rewrite.txt*
</I>&gt;<i> *#store_id_children 10 startup=5 idle=1 concurrency=0*
</I>&gt;<i> *#always_direct allow all*
</I>&gt;<i> *#store_id_access deny connect*
</I>&gt;<i> *#store_id_access deny !getmethod*
</I>&gt;<i> *#store_id_access allow rewritedoms*
</I>&gt;<i> *#store_id_access deny all*
</I>&gt;<i>
</I>&gt;<i> *refresh_all_ims on*
</I>&gt;<i> *reload_into_ims on*
</I>&gt;<i> *max_stale 20 years*
</I>&gt;<i> *minimum_expiry_time 0*
</I>&gt;<i>
</I>&gt;<i> *#refresh_pattern -i ^http.*squid\.internal.* 43200 100% 79900
</I>&gt;<i> override-expire override-lastmod ignore-reload ignore-no-store
</I>&gt;<i> ignore-must-revalidate ignore-private ignore-auth*
</I>&gt;<i>
</I>&gt;<i> *#FACEBOOK*
</I>&gt;<i> *#refresh_pattern ^https.*.facebook.com/* &lt;<A HREF="http://facebook.com/*">http://facebook.com/*</A>&gt; 10080
</I>&gt;<i> 80% 43200*
</I>&gt;<i>
</I>&gt;<i> *#FACEBOOK IMAGES  *
</I>&gt;<i> *#refresh_pattern -i pixel.facebook.com..(jpg|png|gif|ico|css|js|jpg?)
</I>&gt;<i> 10080 80% 43200*
</I>&gt;<i> *#refresh_pattern -i .akamaihd.net..(jpg|png|gif|ico|css|js|jpg?) 10080
</I>&gt;<i> 80% 43200 *
</I>&gt;<i> *#refresh_pattern -i facebook.com.(jpg|png|gif|jpg?) 10080 80% 43200
</I>&gt;<i> store-stale*
</I>&gt;<i> *#refresh_pattern static.(xx|ak).fbcdn.net.(jpg|gif|png|jpg?) 10080 80%
</I>&gt;<i> 43200*
</I>&gt;<i> *#refresh_pattern ^https.*profile.ak.fbcdn.net.*(jpg|gif|png|jpg?) 10080
</I>&gt;<i> 80% 43200*
</I>&gt;<i> *#refresh_pattern ^https.*fbcdn.net.*(jpg|gif|png|jpg?) 10080 80% 43200*
</I>&gt;<i>
</I>&gt;<i> *#FACEBOOK VIDEO*
</I>&gt;<i> *#refresh_pattern -i .video.ak.fbcdn.net.*.(mp4|flv|mp3|amf) 10080 80%
</I>&gt;<i> 43200*
</I>&gt;<i> *#refresh_pattern (audio|video)/(webm|mp4) 10080 80% 43200*
</I>&gt;<i>
</I>&gt;<i> *#APPLE STUFF*
</I>&gt;<i> *#refresh_pattern -i
</I>&gt;<i> apple.com/..(cab|exe|msi|msu|msf|asf|wmv|wma|dat|zip|dist)$
</I>&gt;<i> &lt;<A HREF="http://apple.com/..(cab%7Cexe%7Cmsi%7Cmsu%7Cmsf%7Casf%7Cwmv%7Cwma%7Cdat%7Czip%7Cdist">http://apple.com/..(cab%7Cexe%7Cmsi%7Cmsu%7Cmsf%7Casf%7Cwmv%7Cwma%7Cdat%7Czip%7Cdist</A>)$&gt;
</I>&gt;<i> 0 80% 43200  refresh-ims*
</I>&gt;<i>
</I>&gt;<i> *#apple update*
</I>&gt;<i> *#refresh_pattern -i (download|adcdownload).apple.com/.*\.(pkg|dmg)
</I>&gt;<i> &lt;<A HREF="http://apple.com/.*%5C.(pkg%7Cdmg">http://apple.com/.*%5C.(pkg%7Cdmg</A>)&gt; 4320 100% 43200*
</I>&gt;<i> *#refresh_pattern -i appldnld\.apple\.com 129600 100% 129600*
</I>&gt;<i> *#refresh_pattern -i phobos\.apple\.com 129600 100% 129600*
</I>&gt;<i> *#refresh_pattern -i iosapps\.itunes\.apple\.com 129600 100% 129600*
</I>&gt;<i>
</I>&gt;<i> *refresh_pattern -i
</I>&gt;<i> windowsupdate.com/.*\.(cab|exe|ms[i|u|f|p]|[ap]sf|wm[v|a]|dat|zip|psf)
</I>&gt;<i> &lt;<A HREF="http://windowsupdate.com/.*%5C.(cab%7Cexe%7Cms%5Bi%7Cu%7Cf%7Cp%5D%7C%5Bap%5Dsf%7Cwm%5Bv%7Ca%5D%7Cdat%7Czip%7Cpsf">http://windowsupdate.com/.*%5C.(cab%7Cexe%7Cms%5Bi%7Cu%7Cf%7Cp%5D%7C%5Bap%5Dsf%7Cwm%5Bv%7Ca%5D%7Cdat%7Czip%7Cpsf</A>)&gt;
</I>&gt;<i> 43200 80% 129600 reload-into-ims*
</I>&gt;<i> *refresh_pattern -i
</I>&gt;<i> microsoft.com/.*\.(cab|exe|ms[i|u|f|p]|[ap]sf|wm[v|a]|dat|zip|psf)
</I>&gt;<i> &lt;<A HREF="http://microsoft.com/.*%5C.(cab%7Cexe%7Cms%5Bi%7Cu%7Cf%7Cp%5D%7C%5Bap%5Dsf%7Cwm%5Bv%7Ca%5D%7Cdat%7Czip%7Cpsf">http://microsoft.com/.*%5C.(cab%7Cexe%7Cms%5Bi%7Cu%7Cf%7Cp%5D%7C%5Bap%5Dsf%7Cwm%5Bv%7Ca%5D%7Cdat%7Czip%7Cpsf</A>)&gt;
</I>&gt;<i> 43200 80% 129600 reload-into-ims*
</I>&gt;<i> *refresh_pattern -i
</I>&gt;<i> windows.com/.*\.(cab|exe|ms[i|u|f|p]|[ap]sf|wm[v|a]|dat|zip|psf)
</I>&gt;<i> &lt;<A HREF="http://windows.com/.*%5C.(cab%7Cexe%7Cms%5Bi%7Cu%7Cf%7Cp%5D%7C%5Bap%5Dsf%7Cwm%5Bv%7Ca%5D%7Cdat%7Czip%7Cpsf">http://windows.com/.*%5C.(cab%7Cexe%7Cms%5Bi%7Cu%7Cf%7Cp%5D%7C%5Bap%5Dsf%7Cwm%5Bv%7Ca%5D%7Cdat%7Czip%7Cpsf</A>)&gt;
</I>&gt;<i> 43200 80% 129600 reload-into-ims*
</I>&gt;<i> *refresh_pattern -i
</I>&gt;<i> microsoft.com.akadns.net/.*\.(cab|exe|ms[i|u|f|p]|[ap]sf|wm[v|a]|dat|zip|psf)
</I>&gt;<i> &lt;<A HREF="http://microsoft.com.akadns.net/.*%5C.(cab%7Cexe%7Cms%5Bi%7Cu%7Cf%7Cp%5D%7C%5Bap%5Dsf%7Cwm%5Bv%7Ca%5D%7Cdat%7Czip%7Cpsf">http://microsoft.com.akadns.net/.*%5C.(cab%7Cexe%7Cms%5Bi%7Cu%7Cf%7Cp%5D%7C%5Bap%5Dsf%7Cwm%5Bv%7Ca%5D%7Cdat%7Czip%7Cpsf</A>)&gt;
</I>&gt;<i> 43200 80% 129600 reload-into-ims*
</I>&gt;<i> *refresh_pattern -i
</I>&gt;<i> deploy.akamaitechnologies.com/.*\.(cab|exe|ms[i|u|f|p]|[ap]sf|wm[v|a]|dat|zip|psf)
</I>&gt;<i> &lt;<A HREF="http://deploy.akamaitechnologies.com/.*%5C.(cab%7Cexe%7Cms%5Bi%7Cu%7Cf%7Cp%5D%7C%5Bap%5Dsf%7Cwm%5Bv%7Ca%5D%7Cdat%7Czip%7Cpsf">http://deploy.akamaitechnologies.com/.*%5C.(cab%7Cexe%7Cms%5Bi%7Cu%7Cf%7Cp%5D%7C%5Bap%5Dsf%7Cwm%5Bv%7Ca%5D%7Cdat%7Czip%7Cpsf</A>)&gt;
</I>&gt;<i> 43200 80% 129600 reload-into-ims*
</I>&gt;<i>
</I>&gt;<i> *# Updates: Windows*
</I>&gt;<i> *#refresh_pattern -i
</I>&gt;<i> microsoft.com/..(cab|exe|msi|msu|msf|asf|wma|dat|zip)$
</I>&gt;<i> &lt;<A HREF="http://microsoft.com/..(cab%7Cexe%7Cmsi%7Cmsu%7Cmsf%7Casf%7Cwma%7Cdat%7Czip">http://microsoft.com/..(cab%7Cexe%7Cmsi%7Cmsu%7Cmsf%7Casf%7Cwma%7Cdat%7Czip</A>)$&gt;
</I>&gt;<i> 4320 80% 43200  refresh-ims*
</I>&gt;<i> *refresh_pattern -i
</I>&gt;<i> windowsupdate.com/..(cab|exe|msi|msu|msf|asf|wma|wmv)|dat|zip)$
</I>&gt;<i> &lt;<A HREF="http://windowsupdate.com/..(cab%7Cexe%7Cmsi%7Cmsu%7Cmsf%7Casf%7Cwma%7Cwmv">http://windowsupdate.com/..(cab%7Cexe%7Cmsi%7Cmsu%7Cmsf%7Casf%7Cwma%7Cwmv</A>)%7Cdat%7Czip)$&gt;
</I>&gt;<i> 4320 80% 43200  refresh-ims*
</I>&gt;<i> *#refresh_pattern -i
</I>&gt;<i> windows.com/..(cab|exe|msi|msu|msf|asf|wmv|wma|dat|zip)$
</I>&gt;<i> &lt;<A HREF="http://windows.com/..(cab%7Cexe%7Cmsi%7Cmsu%7Cmsf%7Casf%7Cwmv%7Cwma%7Cdat%7Czip">http://windows.com/..(cab%7Cexe%7Cmsi%7Cmsu%7Cmsf%7Casf%7Cwmv%7Cwma%7Cdat%7Czip</A>)$&gt;
</I>&gt;<i> 4320 80% 43200  refresh-ims*
</I>&gt;<i> *#refresh_pattern -i
</I>&gt;<i> microsoft.com/.*\.(cab|exe|ms[i|u|f]|[ap]sf|wm[v|a]|dat|zip)
</I>&gt;<i> &lt;<A HREF="http://microsoft.com/.*%5C.(cab%7Cexe%7Cms%5Bi%7Cu%7Cf%5D%7C%5Bap%5Dsf%7Cwm%5Bv%7Ca%5D%7Cdat%7Czip">http://microsoft.com/.*%5C.(cab%7Cexe%7Cms%5Bi%7Cu%7Cf%5D%7C%5Bap%5Dsf%7Cwm%5Bv%7Ca%5D%7Cdat%7Czip</A>)&gt;
</I>&gt;<i> 4320 80% 43200 *
</I>&gt;<i> *#refresh_pattern -i
</I>&gt;<i> windowsupdate.com/.*\.(cab|exe|ms[i|u|f]|[ap]sf|wm[v|a]|dat|zip)
</I>&gt;<i> &lt;<A HREF="http://windowsupdate.com/.*%5C.(cab%7Cexe%7Cms%5Bi%7Cu%7Cf%5D%7C%5Bap%5Dsf%7Cwm%5Bv%7Ca%5D%7Cdat%7Czip">http://windowsupdate.com/.*%5C.(cab%7Cexe%7Cms%5Bi%7Cu%7Cf%5D%7C%5Bap%5Dsf%7Cwm%5Bv%7Ca%5D%7Cdat%7Czip</A>)&gt;
</I>&gt;<i> 4320 80% 43200 *
</I>&gt;<i> *#refresh_pattern -i
</I>&gt;<i> windows.com/.*\.(cab|exe|ms[i|u|f]|[ap]sf|wm[v|a]|dat|zip)
</I>&gt;<i> &lt;<A HREF="http://windows.com/.*%5C.(cab%7Cexe%7Cms%5Bi%7Cu%7Cf%5D%7C%5Bap%5Dsf%7Cwm%5Bv%7Ca%5D%7Cdat%7Czip">http://windows.com/.*%5C.(cab%7Cexe%7Cms%5Bi%7Cu%7Cf%5D%7C%5Bap%5Dsf%7Cwm%5Bv%7Ca%5D%7Cdat%7Czip</A>)&gt;
</I>&gt;<i> 4320 80% 43200 *
</I>&gt;<i> *#refresh_pattern -i .*windowsupdate.com/.*\.(cab|exe)
</I>&gt;<i> &lt;<A HREF="http://windowsupdate.com/.*%5C.(cab%7Cexe">http://windowsupdate.com/.*%5C.(cab%7Cexe</A>)&gt; 259200 100% 259200   *
</I>&gt;<i> *#refresh_pattern -i .*update.microsoft.com/.*\.(cab|exe|dll|msi|psf)
</I>&gt;<i> &lt;<A HREF="http://update.microsoft.com/.*%5C.(cab%7Cexe%7Cdll%7Cmsi%7Cpsf">http://update.microsoft.com/.*%5C.(cab%7Cexe%7Cdll%7Cmsi%7Cpsf</A>)&gt; 259200
</I>&gt;<i> 100% 259200   *
</I>&gt;<i> *#refresh_pattern windowsupdate.com/.*\.(cab|exe|dll|msi|psf)
</I>&gt;<i> &lt;<A HREF="http://windowsupdate.com/.*%5C.(cab%7Cexe%7Cdll%7Cmsi%7Cpsf">http://windowsupdate.com/.*%5C.(cab%7Cexe%7Cdll%7Cmsi%7Cpsf</A>)&gt; 10080 100%
</I>&gt;<i> 43200 *
</I>&gt;<i> *#refresh_pattern download.microsoft.com/.*\.(cab|exe|dll|msi|psf)
</I>&gt;<i> &lt;<A HREF="http://download.microsoft.com/.*%5C.(cab%7Cexe%7Cdll%7Cmsi%7Cpsf">http://download.microsoft.com/.*%5C.(cab%7Cexe%7Cdll%7Cmsi%7Cpsf</A>)&gt; 10080
</I>&gt;<i> 100% 43200 *
</I>&gt;<i> *#refresh_pattern www.microsoft.com/.*\.(cab|exe|dll|msi|psf)
</I>&gt;<i> &lt;<A HREF="http://www.microsoft.com/.*%5C.(cab%7Cexe%7Cdll%7Cmsi%7Cpsf">http://www.microsoft.com/.*%5C.(cab%7Cexe%7Cdll%7Cmsi%7Cpsf</A>)&gt; 10080 100%
</I>&gt;<i> 43200 *
</I>&gt;<i> *#refresh_pattern au.download.windowsupdate.com/.*\.(cab|exe|dll|msi|psf)
</I>&gt;<i> &lt;<A HREF="http://au.download.windowsupdate.com/.*%5C.(cab%7Cexe%7Cdll%7Cmsi%7Cpsf">http://au.download.windowsupdate.com/.*%5C.(cab%7Cexe%7Cdll%7Cmsi%7Cpsf</A>)&gt;
</I>&gt;<i> 4320 100% 43200 *
</I>&gt;<i> *#refresh_pattern bg.v4.pr.dl.ws.microsoft.com/.*\.(cab|exe|dll|msi|psf)
</I>&gt;<i> &lt;<A HREF="http://bg.v4.pr.dl.ws.microsoft.com/.*%5C.(cab%7Cexe%7Cdll%7Cmsi%7Cpsf">http://bg.v4.pr.dl.ws.microsoft.com/.*%5C.(cab%7Cexe%7Cdll%7Cmsi%7Cpsf</A>)&gt;
</I>&gt;<i> 4320 100% 43200*
</I>&gt;<i> *#windows update NEW UPDATE 0.04*
</I>&gt;<i> *#refresh_pattern update.microsoft.com/.*\.(cab|exe)
</I>&gt;<i> &lt;<A HREF="http://update.microsoft.com/.*%5C.(cab%7Cexe">http://update.microsoft.com/.*%5C.(cab%7Cexe</A>)&gt; 43200 100% 129600    *
</I>&gt;<i> *#refresh_pattern
</I>&gt;<i> ([^.]+\.)?(download|(windows)?update)\.(microsoft\.)?com/.*\.(cab|exe|msi|msp|psf)
</I>&gt;<i> 4320 100% 43200  *
</I>&gt;<i> *#refresh_pattern update.microsoft.com/.*\.(cab|exe|dll|msi|psf)
</I>&gt;<i> &lt;<A HREF="http://update.microsoft.com/.*%5C.(cab%7Cexe%7Cdll%7Cmsi%7Cpsf">http://update.microsoft.com/.*%5C.(cab%7Cexe%7Cdll%7Cmsi%7Cpsf</A>)&gt; 10080
</I>&gt;<i> 100% 43200 *
</I>&gt;<i> *#refresh_pattern -i
</I>&gt;<i> \.update.microsoft.com/.*\.(cab|exe|ms[i|u|f]|[ap]sf|wm[v|a]|dat|zip)
</I>&gt;<i> &lt;<A HREF="http://update.microsoft.com/.*%5C.(cab%7Cexe%7Cms%5Bi%7Cu%7Cf%5D%7C%5Bap%5Dsf%7Cwm%5Bv%7Ca%5D%7Cdat%7Czip">http://update.microsoft.com/.*%5C.(cab%7Cexe%7Cms%5Bi%7Cu%7Cf%5D%7C%5Bap%5Dsf%7Cwm%5Bv%7Ca%5D%7Cdat%7Czip</A>)&gt;
</I>&gt;<i> 525600 100% 525600       *
</I>&gt;<i> *#refresh_pattern -i
</I>&gt;<i> \.windowsupdate.com/.*\.(cab|exe|ms[i|u|f]|[ap]sf|wm[v|a]|dat|zip)
</I>&gt;<i> &lt;<A HREF="http://windowsupdate.com/.*%5C.(cab%7Cexe%7Cms%5Bi%7Cu%7Cf%5D%7C%5Bap%5Dsf%7Cwm%5Bv%7Ca%5D%7Cdat%7Czip">http://windowsupdate.com/.*%5C.(cab%7Cexe%7Cms%5Bi%7Cu%7Cf%5D%7C%5Bap%5Dsf%7Cwm%5Bv%7Ca%5D%7Cdat%7Czip</A>)&gt;
</I>&gt;<i> 525600 100% 525600       *
</I>&gt;<i> *#refresh_pattern -i
</I>&gt;<i> \.download.microsoft.com/.*\.(cab|exe|ms[i|u|f]|[ap]sf|wm[v|a]|dat|zip)
</I>&gt;<i> &lt;<A HREF="http://download.microsoft.com/.*%5C.(cab%7Cexe%7Cms%5Bi%7Cu%7Cf%5D%7C%5Bap%5Dsf%7Cwm%5Bv%7Ca%5D%7Cdat%7Czip">http://download.microsoft.com/.*%5C.(cab%7Cexe%7Cms%5Bi%7Cu%7Cf%5D%7C%5Bap%5Dsf%7Cwm%5Bv%7Ca%5D%7Cdat%7Czip</A>)&gt;
</I>&gt;<i> 525600 100% 525600       *
</I>&gt;<i> *#refresh_pattern -i
</I>&gt;<i> \.ws.microsoft.com/.*\.(cab|exe|ms[i|u|f]|[ap]sf|wm[v|a]|dat|zip)
</I>&gt;<i> &lt;<A HREF="http://ws.microsoft.com/.*%5C.(cab%7Cexe%7Cms%5Bi%7Cu%7Cf%5D%7C%5Bap%5Dsf%7Cwm%5Bv%7Ca%5D%7Cdat%7Czip">http://ws.microsoft.com/.*%5C.(cab%7Cexe%7Cms%5Bi%7Cu%7Cf%5D%7C%5Bap%5Dsf%7Cwm%5Bv%7Ca%5D%7Cdat%7Czip</A>)&gt;
</I>&gt;<i> 525600 100% 525600       *
</I>&gt;<i>
</I>&gt;<i> *#refresh_pattern
</I>&gt;<i> ([^.]+\.)?(cs|content[1-9]|hsar|content-origin|client-download).[steampowered|steamcontent].com/.*\.*
</I>&gt;<i> 43200 100% 43200     *
</I>&gt;<i> *#refresh_pattern ([^.]+\.)?.akamai.steamstatic.com/.*\.*
</I>&gt;<i> &lt;<A HREF="http://akamai.steamstatic.com/.*%5C.*">http://akamai.steamstatic.com/.*%5C.*</A>&gt; 43200 100% 43200*
</I>&gt;<i>
</I>&gt;<i> *#refresh_pattern -i ([^.]+\.)?.adobe.com/.*\.(zip|exe)
</I>&gt;<i> &lt;<A HREF="http://adobe.com/.*%5C.(zip%7Cexe">http://adobe.com/.*%5C.(zip%7Cexe</A>)&gt; 43200 100% 43200*
</I>&gt;<i> *#refresh_pattern -i ([^.]+\.)?.java.com/.*\.(zip|exe)
</I>&gt;<i> &lt;<A HREF="http://java.com/.*%5C.(zip%7Cexe">http://java.com/.*%5C.(zip%7Cexe</A>)&gt; 43200 100% 43200*
</I>&gt;<i> *#refresh_pattern -i ([^.]+\.)?.sun.com/.*\.(zip|exe)
</I>&gt;<i> &lt;<A HREF="http://sun.com/.*%5C.(zip%7Cexe">http://sun.com/.*%5C.(zip%7Cexe</A>)&gt; 43200 100% 43200*
</I>&gt;<i> *#refresh_pattern -i ([^.]+\.)?.oracle.com/.*\.(zip|exe|tar.gz)
</I>&gt;<i> &lt;<A HREF="http://oracle.com/.*%5C.(zip%7Cexe%7Ctar.gz">http://oracle.com/.*%5C.(zip%7Cexe%7Ctar.gz</A>)&gt; 43200 100% 43200*
</I>&gt;<i>
</I>&gt;<i> *#refresh_pattern -i appldnld\.apple\.com 43200 100% 43200*
</I>&gt;<i> *#refresh_pattern -i ([^.]+\.)?apple.com/.*\.(ipa)
</I>&gt;<i> &lt;<A HREF="http://apple.com/.*%5C.(ipa">http://apple.com/.*%5C.(ipa</A>)&gt; 43200 100% 43200*
</I>&gt;<i>
</I>&gt;<i> *#refresh_pattern -i ([^.]+\.)?.google.com/.*\.(exe|crx)
</I>&gt;<i> &lt;<A HREF="http://google.com/.*%5C.(exe%7Ccrx">http://google.com/.*%5C.(exe%7Ccrx</A>)&gt; 10080 80% 43200*
</I>&gt;<i> *#refresh_pattern -i ([^.]+\.)?g.static.com/.*\.(exe|crx)
</I>&gt;<i> &lt;<A HREF="http://g.static.com/.*%5C.(exe%7Ccrx">http://g.static.com/.*%5C.(exe%7Ccrx</A>)&gt; 10080 80% 43200*
</I>&gt;<i>
</I>&gt;<i> *acl https_login url_regex -i ^https.*(login|Login).**
</I>&gt;<i> *cache deny https_login*
</I>&gt;<i>
</I>&gt;<i> *#range_offset_limit 512 MB windowsupdate*
</I>&gt;<i> *range_offset_limit 0 !windowsupdate*
</I>&gt;<i> *quick_abort_min -1 KB*
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *Store ID program:*
</I>&gt;<i>
</I>&gt;<i> *I am using the built in program attached here..*
</I>&gt;<i> */usr/local/libexec/squid/storeid_file_rewrite*
</I>&gt;<i> *#!/usr/local/bin/perl*
</I>&gt;<i>
</I>&gt;<i> *use strict;*
</I>&gt;<i> *use warnings;*
</I>&gt;<i> *use Pod::Usage;*
</I>&gt;<i>
</I>&gt;<i> *=pod*
</I>&gt;<i>
</I>&gt;<i> *=head1 NAME*
</I>&gt;<i>
</I>&gt;<i> * storeid_file_rewrite - File based Store-ID helper for Squid*
</I>&gt;<i>
</I>&gt;<i> *=head1 SYNOPSIS*
</I>&gt;<i>
</I>&gt;<i> * storeid_file_rewrite filepath*
</I>&gt;<i>
</I>&gt;<i> *=head1 DESCRIPTION*
</I>&gt;<i>
</I>&gt;<i> *This program acts as a store_id helper program, rewriting URLs passed*
</I>&gt;<i> *by Squid into storage-ids that can be used to achieve better caching*
</I>&gt;<i> *for websites that use different URLs for the same content.*
</I>&gt;<i>
</I>&gt;<i> *It takes a text file with two tab separated columns.*
</I>&gt;<i> *Column 1: Regular expression to match against the URL*
</I>&gt;<i> *Column 2: Rewrite rule to generate a Store-ID*
</I>&gt;<i> *Eg:*
</I>&gt;<i> *^http:\/\/[^\.]+\.dl\.sourceforge\.net\/(.*)
</I>&gt;<i>  <A HREF="http://dl.sourceforge.net.squid.internal/$1">http://dl.sourceforge.net.squid.internal/$1</A>
</I>&gt;<i> &lt;<A HREF="http://dl.sourceforge.net.squid.internal/$1">http://dl.sourceforge.net.squid.internal/$1</A>&gt;*
</I>&gt;<i>
</I>&gt;<i> *Rewrite rules are matched in the same order as they appear in the rules
</I>&gt;<i> file.*
</I>&gt;<i> *So for best performance, sort it in order of frequency of occurrence.*
</I>&gt;<i>
</I>&gt;<i> *This program will automatically detect the existence of a concurrency
</I>&gt;<i> channel-ID and adjust appropriately.*
</I>&gt;<i> *It may be used with any value 0 or above for the store_id_children
</I>&gt;<i> concurrency= parameter.*
</I>&gt;<i>
</I>&gt;<i> *=head1 OPTIONS*
</I>&gt;<i>
</I>&gt;<i> *The only command line parameter this helper takes is the regex rules file
</I>&gt;<i> name.*
</I>&gt;<i>
</I>&gt;<i> *=head1 AUTHOR*
</I>&gt;<i>
</I>&gt;<i> *This program and documentation was written by I&lt;Alan Mizrahi
</I>&gt;<i> &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">alan at mizrahi.com.ve</A> &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">alan at mizrahi.com.ve</A>&gt;&gt;&gt;*
</I>&gt;<i>
</I>&gt;<i> *Based on prior work by I&lt;Eliezer Croitoru &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>
</I>&gt;<i> &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&gt;&gt;&gt;*
</I>&gt;<i>
</I>&gt;<i> *=head1 COPYRIGHT*
</I>&gt;<i>
</I>&gt;<i> * * Copyright (C) 1996-2023 The Squid Software Foundation and contributors*
</I>&gt;<i> * **
</I>&gt;<i> * * Squid software is distributed under GPLv2+ license and includes*
</I>&gt;<i> * * contributions from numerous individuals and organizations.*
</I>&gt;<i> * * Please see the COPYING and CONTRIBUTORS files for details.*
</I>&gt;<i>
</I>&gt;<i> * Copyright (C) 2013 Alan Mizrahi &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">alan at mizrahi.com.ve</A>
</I>&gt;<i> &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">alan at mizrahi.com.ve</A>&gt;&gt;*
</I>&gt;<i> * Based on code from Eliezer Croitoru &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>
</I>&gt;<i> &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&gt;&gt;*
</I>&gt;<i>
</I>&gt;<i> * This program is free software; you can redistribute it and/or modify*
</I>&gt;<i> * it under the terms of the GNU General Public License as published by*
</I>&gt;<i> * the Free Software Foundation; either version 2 of the License, or*
</I>&gt;<i> * (at your option) any later version.*
</I>&gt;<i>
</I>&gt;<i> * This program is distributed in the hope that it will be useful,*
</I>&gt;<i> * but WITHOUT ANY WARRANTY; without even the implied warranty of*
</I>&gt;<i> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the*
</I>&gt;<i> * GNU General Public License for more details.*
</I>&gt;<i>
</I>&gt;<i> * You should have received a copy of the GNU General Public License*
</I>&gt;<i> * along with this program; if not, write to the Free Software*
</I>&gt;<i> * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
</I>&gt;<i> &lt;<A HREF="https://www.google.com/maps/search/59+Temple+Place,+Suite+330,+Boston,+MA++02111-1307,+USA?entry=gmail&amp;source=g">https://www.google.com/maps/search/59+Temple+Place,+Suite+330,+Boston,+MA++02111-1307,+USA?entry=gmail&amp;source=g</A>&gt; 02111-1307,
</I>&gt;<i> USA
</I>&gt;<i> &lt;<A HREF="https://www.google.com/maps/search/59+Temple+Place,+Suite+330,+Boston,+MA++02111-1307,+USA?entry=gmail&amp;source=g">https://www.google.com/maps/search/59+Temple+Place,+Suite+330,+Boston,+MA++02111-1307,+USA?entry=gmail&amp;source=g</A>&gt;.*
</I>&gt;<i>
</I>&gt;<i> *=head1 QUESTIONS*
</I>&gt;<i>
</I>&gt;<i> *Questions on the usage of this program can be sent to the I&lt;Squid Users
</I>&gt;<i> mailing list &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;&gt;&gt;*
</I>&gt;<i>
</I>&gt;<i> *=head1 REPORTING BUGS*
</I>&gt;<i>
</I>&gt;<i> *Bug reports need to be made in English.*
</I>&gt;<i> *See <A HREF="http://wiki.squid-cache.org/SquidFaq/BugReporting">http://wiki.squid-cache.org/SquidFaq/BugReporting</A>
</I>&gt;<i> &lt;<A HREF="http://wiki.squid-cache.org/SquidFaq/BugReporting">http://wiki.squid-cache.org/SquidFaq/BugReporting</A>&gt; for details of what you
</I>&gt;<i> need to include with your bug report.*
</I>&gt;<i>
</I>&gt;<i> *Report bugs or bug fixes using <A HREF="http://bugs.squid-cache.org/">http://bugs.squid-cache.org/</A>
</I>&gt;<i> &lt;<A HREF="http://bugs.squid-cache.org/">http://bugs.squid-cache.org/</A>&gt;*
</I>&gt;<i>
</I>&gt;<i> *Report serious security bugs to I&lt;Squid Bugs
</I>&gt;<i> &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-bugs at lists.squid-cache.org</A> &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-bugs at lists.squid-cache.org</A>&gt;&gt;&gt;*
</I>&gt;<i>
</I>&gt;<i> *Report ideas for new improvements to the I&lt;Squid Developers mailing list
</I>&gt;<i> &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-dev at lists.squid-cache.org</A> &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-dev at lists.squid-cache.org</A>&gt;&gt;&gt;*
</I>&gt;<i>
</I>&gt;<i> *=head1 SEE ALSO*
</I>&gt;<i>
</I>&gt;<i> *squid (8), GPL (7),*
</I>&gt;<i>
</I>&gt;<i> *The Squid wiki <A HREF="http://wiki.squid-cache.org/Features/StoreID">http://wiki.squid-cache.org/Features/StoreID</A>
</I>&gt;<i> &lt;<A HREF="http://wiki.squid-cache.org/Features/StoreID">http://wiki.squid-cache.org/Features/StoreID</A>&gt;*
</I>&gt;<i>
</I>&gt;<i> *The Squid Configuration Manual <A HREF="http://www.squid-cache.org/Doc/config/">http://www.squid-cache.org/Doc/config/</A>
</I>&gt;<i> &lt;<A HREF="http://www.squid-cache.org/Doc/config/">http://www.squid-cache.org/Doc/config/</A>&gt;*
</I>&gt;<i>
</I>&gt;<i> *=cut*
</I>&gt;<i>
</I>&gt;<i> *my @rules; # array of [regex, replacement string]*
</I>&gt;<i>
</I>&gt;<i> *die &quot;Usage: $0 &lt;rewrite-file&gt;\n&quot; unless $#ARGV == 0;*
</I>&gt;<i>
</I>&gt;<i> *# read config file*
</I>&gt;<i> *open RULES, $ARGV[0] or die &quot;Error opening $ARGV[0]: $!&quot;;*
</I>&gt;<i> *while (&lt;RULES&gt;) {*
</I>&gt;<i> *    chomp;*
</I>&gt;<i> *    next if /^\s*#?$/;*
</I>&gt;<i> *    if (/^\s*([^\t]+?)\s*\t+\s*([^\t]+?)\s*$/) {*
</I>&gt;<i> *        push(@rules, [qr/$1/, $2]);*
</I>&gt;<i> *    } else {*
</I>&gt;<i> *        print STDERR &quot;$0: Parse error in $ARGV[0] (line $.)\n&quot;;*
</I>&gt;<i> *    }*
</I>&gt;<i> *}*
</I>&gt;<i> *close RULES;*
</I>&gt;<i>
</I>&gt;<i> *$|=1;*
</I>&gt;<i> *# read urls from squid and do the replacement*
</I>&gt;<i> *URL: while (&lt;STDIN&gt;) {*
</I>&gt;<i> *    chomp;*
</I>&gt;<i> *    last if $_ eq 'quit';*
</I>&gt;<i>
</I>&gt;<i> *    my $channel = &quot;&quot;;*
</I>&gt;<i> *    if (s/^(\d+\s+)//o) {*
</I>&gt;<i> *        $channel = $1;*
</I>&gt;<i> *    }*
</I>&gt;<i>
</I>&gt;<i> *    foreach my $rule (@rules) {*
</I>&gt;<i> *        if (my @match = /$rule-&gt;[0]/) {*
</I>&gt;<i> *            $_ = $rule-&gt;[1];*
</I>&gt;<i>
</I>&gt;<i> *            for (my $i=1; $i&lt;=scalar(@match); $i++) {*
</I>&gt;<i> *                s/\$$i/$match[$i-1]/g;*
</I>&gt;<i> *            }*
</I>&gt;<i> *            print $channel, &quot;OK store-id=$_\n&quot;;*
</I>&gt;<i> *            next URL;*
</I>&gt;<i> *        }*
</I>&gt;<i> *    }*
</I>&gt;<i> *    print $channel, &quot;ERR\n&quot;;*
</I>&gt;<i> *}*
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20250101/a0d20cb7/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20250101/a0d20cb7/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="027348.html">[squid-users] Thoughts on caching aspx jsp asp cgi-bin
</A></li>
	<LI>Next message (by thread): <A HREF="027349.html">[squid-users] StoreID Question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27346">[ date ]</a>
              <a href="thread.html#27346">[ thread ]</a>
              <a href="subject.html#27346">[ subject ]</a>
              <a href="author.html#27346">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
