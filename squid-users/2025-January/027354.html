<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] pipeline_prefetch directive
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20pipeline_prefetch%20directive&In-Reply-To=%3CCA%2BY8hcNm_FqcoBR3u%3DgHeUSs%2BLpQ7JEOErNGaQd0LvZYBo2oxA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027353.html">
   <LINK REL="Next"  HREF="027355.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] pipeline_prefetch directive</H1>
    <B>Francesco Chemolli</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20pipeline_prefetch%20directive&In-Reply-To=%3CCA%2BY8hcNm_FqcoBR3u%3DgHeUSs%2BLpQ7JEOErNGaQd0LvZYBo2oxA%40mail.gmail.com%3E"
       TITLE="[squid-users] pipeline_prefetch directive">gkinkie at gmail.com
       </A><BR>
    <I>Fri Jan  3 09:52:40 UTC 2025</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="027353.html">[squid-users] pipeline_prefetch directive
</A></li>
        <LI>Next message (by thread): <A HREF="027355.html">[squid-users] pipeline_prefetch directive
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27354">[ date ]</a>
              <a href="thread.html#27354">[ thread ]</a>
              <a href="subject.html#27354">[ subject ]</a>
              <a href="author.html#27354">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Fri, Jan 3, 2025 at 8:23&#8239;AM Jonathan Lee &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">jonathanlee571 at gmail.com</A>&gt;
wrote:

&gt;<i> Hello fellow Squid Users,
</I>&gt;<i>
</I>&gt;<i> I understand this directive is removed in Squid7 again I am still trying
</I>&gt;<i> to understand more about what it did and does in the older versions of
</I>&gt;<i> software.
</I>&gt;<i>
</I>&gt;<i> pipeline_prefetch historically was on or off for settings however today it
</I>&gt;<i> is n+1 or a numerical value for the variable n.
</I>&gt;<i>
</I>&gt;<i> My question is after many trial and errors what is a good range to use for
</I>&gt;<i> a 4GB memory system,
</I>&gt;<i>
</I>&gt;<i> I have attempted many different n values some being 100, 200, 300, 5, 10
</I>&gt;<i> etc it appears to work well with 100 or maybe it was my other changes with
</I>&gt;<i> using the directive read_ahead_gap 64 KB and testing 16 and 32
</I>&gt;<i>
</I>&gt;<i> what is a good solid go go juice number for pipeline_prefetch? I do notice
</I>&gt;<i> massive increases in facebook loads when I have it at 100 however decreased
</I>&gt;<i> performance with news websites. It is like a can&#8217;t win directive for me.
</I>&gt;<i> Finally I thought best to ask.
</I>

HTTP is a request-response protocol, and HTTP/1.1 uses a single TCP
connection to issue several requests via the &quot;keep-alive&quot; feature.

The way it is supposed to work is:
- client opens TCP connection
- client sends request #1 on connection
- server sends response #1 on connection
- client sends request #2 on connection
- server sends response #2 on connection
- ...
- client or server closes TCP connection

There are several reasons why a connection might be closed. Among them,
axplicit decision by the client or server for instance due to wanting to
terminate the process to avoid leaking too much memory, or an inactivity
timeout, or because the server doesn't know in advance how long a response
is going to be, so the only way to terminate the response is by closing the
connection.

Sometimes however the client knows in advance several resources it wants to
fetch, and sometimes it will perform these requests optimistically, without
waiting for the previous responses. The flow in this case can look like:
- client opens TCP connection
- client sends request #1 on connection
- client sends request #2 on connection
- server sends response #1 on connection
- server sends response #2 on connection
- ...
- client or server closes TCP connection

pipeline_prefetch instructs squid to try and detect these events, and to
optimistically start processing requests before having completed the
previous responses. This can in theory help reduce page rendering latency,
but it comes with several drawbacks:
- the feature triggers bugs in Squid - see
<A HREF="https://joshua.hu/squid-security-audit-35-0days-45-exploits">https://joshua.hu/squid-security-audit-35-0days-45-exploits</A>
- the feature can actually harm performance: if squid needs to close the
TCP connection at the end of response #1, but has already downloaded
uncacheable content for request #2, that content has to be discarded
- modern web clients adopt complex optimization strategies when picking
what resources to download, making this optimization less and less relevant
- that's the reason why it was dropped as a feature: its benefit is
doubtful, the drawbacks are known and measurable, the complexity it adds to
squid is significant. We developers would rather clean the slate and work
on supporting http/2 which makes this whole problem go away


&gt;<i> I do understand it is no longer recommended to be used this is simply for
</I>&gt;<i> speed and the system is secure behind a firewall.
</I>

I'd just recommend to not use it :)

--
    Francesco
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20250103/335957ac/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20250103/335957ac/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="027353.html">[squid-users] pipeline_prefetch directive
</A></li>
	<LI>Next message (by thread): <A HREF="027355.html">[squid-users] pipeline_prefetch directive
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27354">[ date ]</a>
              <a href="thread.html#27354">[ thread ]</a>
              <a href="subject.html#27354">[ subject ]</a>
              <a href="author.html#27354">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
