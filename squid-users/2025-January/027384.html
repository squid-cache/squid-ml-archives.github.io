<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Cache dir
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Cache%20dir&In-Reply-To=%3CCA%2BY8hcOYcrKcFdYFOf9YUuSFgDua7tGbwtWEHd0UG7mc9wOu7A%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027377.html">
   <LINK REL="Next"  HREF="027385.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Cache dir</H1>
    <B>Francesco Chemolli</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Cache%20dir&In-Reply-To=%3CCA%2BY8hcOYcrKcFdYFOf9YUuSFgDua7tGbwtWEHd0UG7mc9wOu7A%40mail.gmail.com%3E"
       TITLE="[squid-users] Cache dir">gkinkie at gmail.com
       </A><BR>
    <I>Sat Jan 11 13:24:43 UTC 2025</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="027377.html">[squid-users] Cache dir
</A></li>
        <LI>Next message (by thread): <A HREF="027385.html">[squid-users] Cache dir
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27384">[ date ]</a>
              <a href="thread.html#27384">[ thread ]</a>
              <a href="subject.html#27384">[ subject ]</a>
              <a href="author.html#27384">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Fri, Jan 10, 2025 at 5:39&#8239;PM Jonathan Lee &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">jonathanlee571 at gmail.com</A>&gt;
wrote:

&gt;<i> Thanks for the reply
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> What OS are you using? How many CPU cores do you want to dedicate to
</I>&gt;<i> Squid? How much memory?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I am using FreeBSD variant 4GB ram 2 CPUs pfSense plus
</I>&gt;<i>
</I>&gt;<i> Starting CPU 1 (1)
</I>&gt;<i> FreeBSD/SMP: Multiprocessor System Detected: 2 CPUs
</I>&gt;<i> cpulist0: &lt;Open Firmware CPU Group&gt; on ofwbus0
</I>&gt;<i> cpu0: &lt;Open Firmware CPU&gt; on cpulist0
</I>&gt;<i> cpu1: &lt;Open Firmware CPU&gt; on cpulist0
</I>&gt;<i> e6000sw0: CPU port at 5
</I>&gt;<i> CPU 0: ARM Cortex-A53 r0p4 affinity: 0
</I>&gt;<i> CPU 1: ARM Cortex-A53 r0p4 affinity: 1
</I>&gt;<i> I do not know how to dedicate specific CPU cores to Squid I do not think I
</I>&gt;<i> can with pfSense plus.
</I>&gt;<i>
</I>
It's more about how many squid workers to start. Then the OS will do the
allocation


&gt;<i> What filesystem are you using? For modern filesystems (ext4, btrfs, apfs)
</I>&gt;<i> this parameter is much less meaningful than 10 years ago as they store
</I>&gt;<i> directories as trees instead of lists.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> =&gt;        1  250069679  ada0  MBR  (119G)
</I>&gt;<i>           1     532480     1  efi  (260M)
</I>&gt;<i>      532481     131072     2  fat32  (64M)
</I>&gt;<i>      663553  249406127     3  freebsd  [active]  (119G)
</I>&gt;<i>
</I>&gt;<i> =&gt;        0  249406127  ada0s3  BSD  (119G)
</I>&gt;<i>           0         16          - free -  (8.0K)
</I>&gt;<i>          16  235528175       1  freebsd-zfs  (112G)
</I>&gt;<i>   235528191   13877248       2  freebsd-swap  (6.6G)
</I>&gt;<i>   249405439        688          - free -  (344K)
</I>&gt;<i>
</I>&gt;<i> =&gt;       40  500118112  nda0  GPT  (238G)
</I>&gt;<i>          40       2008        - free -  (1.0M)
</I>&gt;<i>        2048   16777216     1  freebsd-swap  (8.0G)
</I>&gt;<i>    16779264  482344960     2  freebsd-ufs  (230G)
</I>&gt;<i>   499124224     993928        - free -  (485M)
</I>&gt;<i>
</I>&gt;<i> ada0 is for the host os
</I>&gt;<i> nda0 is my cache is uses freebsd-ufs I use the command *mount_msdosfs
</I>&gt;<i> /dev/nda0p2 /nvme/**LOGS_Octane*
</I>&gt;<i>
</I>
huh? From the output above, it would seem that nda0 is using FreeBD UFS,
not msdos.
Might be related to the partition table type you're using? I'm not a
freebsd expert tho


&gt;<i> The only way to mount the NVMe drive I have found is with mount_msdosfs
</I>&gt;<i> maybe this causes a slow down I do not know but I can write and save to the
</I>&gt;<i> drive this way. it is on nda0p2 230GB
</I>&gt;<i>
</I>&gt;<i> Geom name: nda0
</I>&gt;<i> modified: false
</I>&gt;<i> state: OK
</I>&gt;<i> fwheads: 255
</I>&gt;<i> fwsectors: 63
</I>&gt;<i> last: 500118151
</I>&gt;<i> first: 40
</I>&gt;<i> entries: 128
</I>&gt;<i> scheme: GPT
</I>&gt;<i> Providers:
</I>&gt;<i> 1. Name: nda0p1
</I>&gt;<i>    Mediasize: 8589934592 (8.0G)
</I>&gt;<i>    Sectorsize: 512
</I>&gt;<i>    Stripesize: 0
</I>&gt;<i>    Stripeoffset: 1048576
</I>&gt;<i>    Mode: r1w1e2
</I>&gt;<i>    efimedia: HD(1,GPT,04d31fb2-c0fd-11ef-8536-90ec770dda25,0x800,0x1000000)
</I>&gt;<i>    rawuuid: 04d31fb2-c0fd-11ef-8536-90ec770dda25
</I>&gt;<i>    rawtype: 516e7cb5-6ecf-11d6-8ff8-00022d09712b
</I>&gt;<i>    label: swapUSB
</I>&gt;<i>    length: 8589934592
</I>&gt;<i>    offset: 1048576
</I>&gt;<i>    type: freebsd-swap
</I>&gt;<i>    index: 1
</I>&gt;<i>    end: 16779263
</I>&gt;<i>    start: 2048
</I>&gt;<i> 2. Name: nda0p2
</I>&gt;<i>    Mediasize: 246960619520 (230G)
</I>&gt;<i>    Sectorsize: 512
</I>&gt;<i>    Stripesize: 0
</I>&gt;<i>    Stripeoffset: 8590983168
</I>&gt;<i>    Mode: r1w1e1
</I>&gt;<i>    efimedia: HD(2,GPT,d84dfc00-cb1c-11ef-afd9-90ec770dda25,0x1000800,0x1cc00000)
</I>&gt;<i>    rawuuid: d84dfc00-cb1c-11ef-afd9-90ec770dda25
</I>&gt;<i>    rawtype: 516e7cb6-6ecf-11d6-8ff8-00022d09712b
</I>&gt;<i>    label: LOG
</I>&gt;<i>    length: 246960619520
</I>&gt;<i>    offset: 8590983168
</I>&gt;<i>    type: freebsd-ufs
</I>&gt;<i>    index: 2
</I>&gt;<i>    end: 499124223
</I>&gt;<i>    start: 16779264
</I>&gt;<i> Consumers:
</I>&gt;<i> 1. Name: nda0
</I>&gt;<i>    Mediasize: 256060514304 (238G)
</I>&gt;<i>    Sectorsize: 512
</I>&gt;<i>    Mode: r2w2e5
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> my memory replacement policy is LRU for memory cache it seems to run
</I>&gt;&gt;<i> better with that, my options for memory replacement policy are HEAP GDSF I
</I>&gt;&gt;<i> assume any HEAP will require more memory, HEAP LFUDF, HEAP LRU and just LRU.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I think so but shouldn't be significantly more
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Should I change Memory Replacement Policy from LRU to HEAP LRU? I have
</I>&gt;<i> tried every one again there is also the Cache Replacement Policy: Currently
</I>&gt;<i> set to HEAP LFUDA Should memory replacement policy and cache replacement
</I>&gt;<i> policy both be the same, and or does one cause any performance issues
</I>&gt;<i> with the other?
</I>&gt;<i>
</I>
They should not be too different in terms of memory useage.


&gt;<i>
</I>&gt;<i> Current Config
</I>&gt;<i>
</I>&gt;<i> # This file is automatically generated by pfSense
</I>&gt;<i> # Do not edit manually !
</I>&gt;<i>
</I>&gt;<i> http_port 192.168.1.1:3128 ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=20MB cert=/usr/local/etc/squid/serverkey.pem cafile=/usr/local/share/certs/ca-root-nss.crt capath=/usr/local/share/certs/ cipher=EECDH+ECDSA+AESGCM:EECDH+aRSA+AESGCM:EECDH+ECDSA+SHA384:EECDH+ECDSA+SHA256:EECDH+aRSA+SHA384:EECDH+aRSA+SHA256:EECDH+aRSA+RC4:EECDH:EDH+aRSA:HIGH:!RC4:!aNULL:!eNULL:!LOW:!3DES:!MD5:!EXP:!PSK:!SRP:!DSS tls-dh=prime256v1:/etc/dh-parameters.2048 options=NO_SSLv3,SINGLE_DH_USE,SINGLE_ECDH_USE
</I>&gt;<i>
</I>&gt;<i> http_port 127.0.0.1:3128 intercept ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=20MB cert=/usr/local/etc/squid/serverkey.pem cafile=/usr/local/share/certs/ca-root-nss.crt capath=/usr/local/share/certs/ cipher=EECDH+ECDSA+AESGCM:EECDH+aRSA+AESGCM:EECDH+ECDSA+SHA384:EECDH+ECDSA+SHA256:EECDH+aRSA+SHA384:EECDH+aRSA+SHA256:EECDH+aRSA+RC4:EECDH:EDH+aRSA:HIGH:!RC4:!aNULL:!eNULL:!LOW:!3DES:!MD5:!EXP:!PSK:!SRP:!DSS tls-dh=prime256v1:/etc/dh-parameters.2048 options=NO_SSLv3,SINGLE_DH_USE,SINGLE_ECDH_USE
</I>&gt;<i>
</I>&gt;<i> https_port 127.0.0.1:3129 intercept ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=20MB cert=/usr/local/etc/squid/serverkey.pem cafile=/usr/local/share/certs/ca-root-nss.crt capath=/usr/local/share/certs/ cipher=EECDH+ECDSA+AESGCM:EECDH+aRSA+AESGCM:EECDH+ECDSA+SHA384:EECDH+ECDSA+SHA256:EECDH+aRSA+SHA384:EECDH+aRSA+SHA256:EECDH+aRSA+RC4:EECDH:EDH+aRSA:HIGH:!RC4:!aNULL:!eNULL:!LOW:!3DES:!MD5:!EXP:!PSK:!SRP:!DSS tls-dh=prime256v1:/etc/dh-parameters.2048 options=NO_SSLv3,SINGLE_DH_USE,SINGLE_ECDH_USE
</I>&gt;<i>
</I>&gt;<i> icp_port 0
</I>&gt;<i> digest_generation off
</I>&gt;<i> dns_v4_first on
</I>&gt;<i> pid_filename /var/run/squid/squid.pid
</I>&gt;<i> cache_effective_user squid
</I>&gt;<i> cache_effective_group proxy
</I>&gt;<i> error_default_language en
</I>&gt;<i> icon_directory /usr/local/etc/squid/icons
</I>&gt;<i> visible_hostname Lee_Family.home.arpa
</I>&gt;<i> cache_mgr <A HREF="https://lists.squid-cache.org/listinfo/squid-users">jonathanlee571 at gmail.com</A>
</I>&gt;<i> access_log /nvme/LOGS_Optane/Squid_Logs/access.log
</I>&gt;<i> cache_log /nvme/LOGS_Optane/Squid_Logs/cache.log
</I>&gt;<i> cache_store_log none
</I>&gt;<i> netdb_filename /nvme/LOGS_Optane/Squid_Logs/netdb.state
</I>&gt;<i> pinger_enable on
</I>&gt;<i> pinger_program /usr/local/libexec/squid/pinger
</I>&gt;<i> sslcrtd_program /usr/local/libexec/squid/security_file_certgen -s /var/squid/lib/ssl_db -M 4MB -b 2048
</I>&gt;<i> tls_outgoing_options cafile=/usr/local/share/certs/ca-root-nss.crt
</I>&gt;<i> tls_outgoing_options capath=/usr/local/share/certs/
</I>&gt;<i> tls_outgoing_options options=NO_SSLv3,SINGLE_DH_USE,SINGLE_ECDH_USE
</I>&gt;<i> tls_outgoing_options cipher=EECDH+ECDSA+AESGCM:EECDH+aRSA+AESGCM:EECDH+ECDSA+SHA384:EECDH+ECDSA+SHA256:EECDH+aRSA+SHA384:EECDH+aRSA+SHA256:EECDH+aRSA+RC4:EECDH:EDH+aRSA:HIGH:!RC4:!aNULL:!eNULL:!LOW:!3DES:!MD5:!EXP:!PSK:!SRP:!DSS
</I>&gt;<i> sslcrtd_children 10
</I>&gt;<i>
</I>&gt;<i> logfile_rotate 10
</I>&gt;<i> debug_options rotate=10
</I>&gt;<i> shutdown_lifetime 3 seconds
</I>&gt;<i> # Allow local network(s) on interface(s)
</I>&gt;<i> acl localnet src  192.168.1.0/27
</I>&gt;<i> forwarded_for delete
</I>&gt;<i> via off
</I>&gt;<i> httpd_suppress_version_string on
</I>&gt;<i> uri_whitespace strip
</I>&gt;<i>
</I>&gt;<i> acl block_hours time 00:30-05:00
</I>&gt;<i> ssl_bump terminate all block_hours
</I>&gt;<i> http_access deny all block_hours
</I>&gt;<i> icp_port 0
</I>&gt;<i> htcp_port 0
</I>&gt;<i> snmp_port 0
</I>&gt;<i> icp_access deny all
</I>&gt;<i> htcp_access deny all
</I>&gt;<i> snmp_access deny all
</I>&gt;<i> acl getmethod method GET
</I>&gt;<i> acl to_ipv6 dst ipv6
</I>&gt;<i> acl from_ipv6 src ipv6
</I>&gt;<i>
</I>&gt;<i> #tls_outgoing_options cipher=HIGH:MEDIUM:!RC4:!aNULL:!eNULL:!LOW:!3DES:!MD5:!EXP:!PSK:!SRP:!DSS
</I>&gt;<i> tls_outgoing_options options=NO_SSLv3,NO_TLSv1,NO_TLSv1_1,NO_TICKET,SINGLE_DH_USE,SINGLE_ECDH_USE
</I>&gt;<i> #tls_outgoing_options default-ca=on
</I>&gt;<i>
</I>&gt;<i> acl HttpAccess dstdomain '/usr/local/pkg/http.access'
</I>&gt;<i> acl windowsupdate dstdomain '/usr/local/pkg/windowsupdate'
</I>&gt;<i> #acl rewritedoms dstdomain '/usr/local/pkg/desdom'
</I>&gt;<i>
</I>&gt;<i> #store_id_program /usr/local/libexec/squid/storeid_file_rewrite /var/squid/storeid/storeid_rewrite.txt
</I>&gt;<i> #store_id_children 10 startup=5 idle=1 concurrency=0
</I>&gt;<i> #always_direct allow all
</I>&gt;<i> #store_id_access deny connect
</I>&gt;<i> #store_id_access deny !getmethod
</I>&gt;<i> #store_id_access allow rewritedoms
</I>&gt;<i> #store_id_access deny all
</I>&gt;<i>
</I>&gt;<i> refresh_all_ims on
</I>&gt;<i> reload_into_ims on
</I>&gt;<i> max_stale 20 years
</I>&gt;<i> minimum_expiry_time 0
</I>&gt;<i>
</I>&gt;<i> #refresh_pattern -i ^http.*squid.internal.* 43200 100% 79900 override-expire override-lastmod ignore-reload ignore-no-store ignore-must-revalidate ignore-private ignore-auth
</I>&gt;<i>
</I>&gt;<i> refresh_pattern -i windowsupdate.com/.*.(cab|exe|ms[i|u|f|p]|[ap]sf|wm[v|a]|dat|zip|psf) &lt;<A HREF="http://windowsupdate.com/.*.(cab%7Cexe%7Cms%5Bi%7Cu%7Cf%7Cp%5D%7C%5Bap%5Dsf%7Cwm%5Bv%7Ca%5D%7Cdat%7Czip%7Cpsf">http://windowsupdate.com/.*.(cab%7Cexe%7Cms%5Bi%7Cu%7Cf%7Cp%5D%7C%5Bap%5Dsf%7Cwm%5Bv%7Ca%5D%7Cdat%7Czip%7Cpsf</A>)&gt; 43200 80% 129600 reload-into-ims
</I>&gt;<i> refresh_pattern -i microsoft.com/.*.(cab|exe|ms[i|u|f|p]|[ap]sf|wm[v|a]|dat|zip|psf) &lt;<A HREF="http://microsoft.com/.*.(cab%7Cexe%7Cms%5Bi%7Cu%7Cf%7Cp%5D%7C%5Bap%5Dsf%7Cwm%5Bv%7Ca%5D%7Cdat%7Czip%7Cpsf">http://microsoft.com/.*.(cab%7Cexe%7Cms%5Bi%7Cu%7Cf%7Cp%5D%7C%5Bap%5Dsf%7Cwm%5Bv%7Ca%5D%7Cdat%7Czip%7Cpsf</A>)&gt; 43200 80% 129600 reload-into-ims
</I>&gt;<i> refresh_pattern -i windows.com/.*.(cab|exe|ms[i|u|f|p]|[ap]sf|wm[v|a]|dat|zip|psf) &lt;<A HREF="http://windows.com/.*.(cab%7Cexe%7Cms%5Bi%7Cu%7Cf%7Cp%5D%7C%5Bap%5Dsf%7Cwm%5Bv%7Ca%5D%7Cdat%7Czip%7Cpsf">http://windows.com/.*.(cab%7Cexe%7Cms%5Bi%7Cu%7Cf%7Cp%5D%7C%5Bap%5Dsf%7Cwm%5Bv%7Ca%5D%7Cdat%7Czip%7Cpsf</A>)&gt; 43200 80% 129600 reload-into-ims
</I>&gt;<i> refresh_pattern -i microsoft.com.akadns.net/.*.(cab|exe|ms[i|u|f|p]|[ap]sf|wm[v|a]|dat|zip|psf) &lt;<A HREF="http://microsoft.com.akadns.net/.*.(cab%7Cexe%7Cms%5Bi%7Cu%7Cf%7Cp%5D%7C%5Bap%5Dsf%7Cwm%5Bv%7Ca%5D%7Cdat%7Czip%7Cpsf">http://microsoft.com.akadns.net/.*.(cab%7Cexe%7Cms%5Bi%7Cu%7Cf%7Cp%5D%7C%5Bap%5Dsf%7Cwm%5Bv%7Ca%5D%7Cdat%7Czip%7Cpsf</A>)&gt; 43200 80% 129600 reload-into-ims
</I>&gt;<i> refresh_pattern -i deploy.akamaitechnologies.com/.*.(cab|exe|ms[i|u|f|p]|[ap]sf|wm[v|a]|dat|zip|psf) &lt;<A HREF="http://deploy.akamaitechnologies.com/.*.(cab%7Cexe%7Cms%5Bi%7Cu%7Cf%7Cp%5D%7C%5Bap%5Dsf%7Cwm%5Bv%7Ca%5D%7Cdat%7Czip%7Cpsf">http://deploy.akamaitechnologies.com/.*.(cab%7Cexe%7Cms%5Bi%7Cu%7Cf%7Cp%5D%7C%5Bap%5Dsf%7Cwm%5Bv%7Ca%5D%7Cdat%7Czip%7Cpsf</A>)&gt; 43200 80% 129600 reload-into-ims
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> acl https_login url_regex -i ^https.*(login|Login).*
</I>&gt;<i> cache deny https_login
</I>&gt;<i>
</I>&gt;<i> #range_offset_limit 512 MB windowsupdate
</I>&gt;<i> range_offset_limit 0 !windowsupdate
</I>&gt;<i> quick_abort_min -1 KB
</I>&gt;<i> cache_mem 64 MB
</I>&gt;<i> maximum_object_size_in_memory 256 KB
</I>&gt;<i> memory_replacement_policy lru
</I>&gt;<i> cache_replacement_policy heap LFUDA
</I>&gt;<i> minimum_object_size 0 KB
</I>&gt;<i> maximum_object_size 512 MBcache_dir aufs /nvme/LOGS_Optane/Squid_Cache 32000 16 256
</I>&gt;<i> offline_mode off
</I>&gt;<i> cache_swap_low 90
</I>&gt;<i> cache_swap_high 95
</I>&gt;<i> acl donotcache dstdomain '/var/squid/acl/donotcache.acl'
</I>&gt;<i> cache deny donotcache
</I>&gt;<i> cache allow all
</I>&gt;<i> # Add any of your own refresh_pattern entries above these.
</I>&gt;<i> refresh_pattern ^ftp:    1440  20%  10080
</I>&gt;<i> refresh_pattern ^gopher:  1440  0%  1440
</I>&gt;<i> refresh_pattern -i (/cgi-bin/|?) 0  0%  0
</I>&gt;<i> refresh_pattern .    0  20%  4320
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> #Remote proxies
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> # Setup some default acls
</I>&gt;<i> # ACLs all, manager, localhost, and to_localhost are predefined.
</I>&gt;<i> acl allsrc src all
</I>&gt;<i> acl safeports port 21 70 80 210 280 443 488 563 591 631 777 901 8080 3128 3129 1025-65535
</I>&gt;<i> acl sslports port 443 563 8080 5223 2197
</I>&gt;<i>
</I>&gt;<i> acl purge method PURGE
</I>&gt;<i> acl connect method CONNECT
</I>&gt;<i>
</I>&gt;<i> # Define protocols used for redirects
</I>&gt;<i> acl HTTP proto HTTP
</I>&gt;<i> acl HTTPS proto HTTPS
</I>&gt;<i>
</I>&gt;<i> # SslBump Peek and Splice
</I>&gt;<i> # <A HREF="http://wiki.squid-cache.org/Features/SslPeekAndSplice">http://wiki.squid-cache.org/Features/SslPeekAndSplice</A>
</I>&gt;<i> # <A HREF="http://wiki.squid-cache.org/ConfigExamples/Intercept/SslBumpExplicit">http://wiki.squid-cache.org/ConfigExamples/Intercept/SslBumpExplicit</A>
</I>&gt;<i> # Match against the current step during ssl_bump evaluation [fast]
</I>&gt;<i> # Never matches and should not be used outside the ssl_bump context.
</I>&gt;<i> #
</I>&gt;<i> # At each SslBump step, Squid evaluates ssl_bump directives to find
</I>&gt;<i> # the next bumping action (e.g., peek or splice). Valid SslBump step
</I>&gt;<i> # values and the corresponding ssl_bump evaluation moments are:
</I>&gt;<i> #   SslBump1: After getting TCP-level and HTTP CONNECT info.
</I>&gt;<i> #   SslBump2: After getting TLS Client Hello info.
</I>&gt;<i> #   SslBump3: After getting TLS Server Hello info.
</I>&gt;<i> # These ACLs exist even when 'SSL/MITM Mode' is set to 'Custom' so that
</I>&gt;<i> # they can be used there for custom configuration.
</I>&gt;<i> acl step1 at_step SslBump1
</I>&gt;<i> acl step2 at_step SslBump2
</I>&gt;<i> acl step3 at_step SslBump3
</I>&gt;<i> acl banned_hosts src '/var/squid/acl/banned_hosts.acl'
</I>&gt;<i> acl blacklist dstdom_regex -i '/var/squid/acl/blacklist.acl'
</I>&gt;<i> http_access allow manager localhost
</I>&gt;<i>
</I>&gt;<i> http_access deny manager
</I>&gt;<i> http_access allow purge localhost
</I>&gt;<i> http_access deny purge
</I>&gt;<i> http_access deny !safeports
</I>&gt;<i> http_access deny CONNECT !sslports
</I>&gt;<i>
</I>&gt;<i> # Always allow localhost connections
</I>&gt;<i> http_access allow localhost
</I>&gt;<i>
</I>&gt;<i> quick_abort_min 0 KB
</I>&gt;<i> quick_abort_max 0 KB
</I>&gt;<i> quick_abort_pct 95
</I>&gt;<i> request_body_max_size 0 KBdelay_pools 1
</I>&gt;<i> delay_class 1 2
</I>&gt;<i> delay_parameters 1 -1/-1 -1/-1
</I>&gt;<i> delay_initial_bucket_level 100
</I>&gt;<i> delay_access 1 allow allsrc
</I>&gt;<i>
</I>&gt;<i> # Reverse Proxy settings
</I>&gt;<i>
</I>&gt;<i> deny_info TCP_RESET allsrc
</I>&gt;<i>
</I>&gt;<i> # Package Integration
</I>&gt;<i> url_rewrite_program /usr/local/bin/squidGuard -c /usr/local/etc/squidGuard/squidGuard.conf
</I>&gt;<i> url_rewrite_bypass off
</I>&gt;<i> url_rewrite_children 25 startup=12 idle=8 concurrency=0
</I>&gt;<i>
</I>&gt;<i> # Custom options before auth
</I>&gt;<i> #host_verify_strict on
</I>&gt;<i>
</I>&gt;<i> # These hosts are banned
</I>&gt;<i> http_access deny banned_hosts
</I>&gt;<i> # Block access to blacklist domains
</I>&gt;<i> http_access deny blacklist
</I>&gt;<i> # List of domains allowed to logging in to Google services
</I>&gt;<i> request_header_access X-GoogApps-Allowed-Domains deny all
</I>&gt;<i> request_header_add X-GoogApps-Allowed-Domains consumer_accounts
</I>&gt;<i> # Set YouTube safesearch restriction
</I>&gt;<i> acl youtubedst dstdomain -n www.youtube.com m.youtube.com youtubei.googleapis.com youtube.googleapis.com www.youtube-nocookie.com
</I>&gt;<i> request_header_access YouTube-Restrict deny all
</I>&gt;<i> request_header_add YouTube-Restrict none youtubedst
</I>&gt;<i> # Custom SSL/MITM options before auth
</I>&gt;<i> acl wpad urlpath_regex ^/wpad.dat$
</I>&gt;<i> acl wpad urlpath_regex ^/proxy.pac$
</I>&gt;<i> acl wpad urlpath_regex ^/wpad.da$
</I>&gt;<i> deny_info TCP_RESET wpad
</I>&gt;<i> #deny_info 200:/etc/squid/wpad.dat wpad
</I>&gt;<i> reply_header_access Content-Type deny wpad
</I>&gt;<i> http_access deny wpad
</I>&gt;<i> http_access deny !safeports
</I>&gt;<i> http_access deny CONNECT !sslports
</I>&gt;<i> cachemgr_passwd disable offline_toggle reconfigure shutdown
</I>&gt;<i> cachemgr_passwd redacted all
</I>&gt;<i> eui_lookup on
</I>&gt;<i> acl no_miss url_regex -i gateway.facebook.com/ws/realtime?
</I>&gt;<i> acl no_miss url_regex -i web-chat-e2ee.facebook.com/ws/chat
</I>&gt;<i> acl CONNECT method CONNECT
</I>&gt;<i> acl wuCONNECT dstdomain www.update.microsoft.com
</I>&gt;<i> acl wuCONNECT dstdomain sls.microsoft.com
</I>&gt;<i> http_access allow CONNECT wuCONNECT localnet
</I>&gt;<i> http_access allow CONNECT wuCONNECT localhost
</I>&gt;<i> http_access allow CONNECT windowsupdate localnet
</I>&gt;<i> http_access allow CONNECT windowsupdate localhost
</I>&gt;<i> http_access allow CONNECT HttpAccess localnet
</I>&gt;<i> http_access allow CONNECT HttpAccess localhost
</I>&gt;<i> http_access deny to_ipv6
</I>&gt;<i> http_access deny from_ipv6
</I>&gt;<i>
</I>&gt;<i> acl BrokenButTrustedServers dstdomain '/usr/local/pkg/dstdom.broken'
</I>&gt;<i> acl DomainMismatch ssl_error SQUID_X509_V_ERR_DOMAIN_MISMATCH
</I>&gt;<i> sslproxy_cert_error allow BrokenButTrustedServers DomainMismatch
</I>&gt;<i> sslproxy_cert_error deny all
</I>&gt;<i>
</I>&gt;<i> acl splice_only_ip src 192.168.1.8
</I>&gt;<i> acl splice_only_ip src 192.168.1.10
</I>&gt;<i> acl splice_only_ip src 192.168.1.11
</I>&gt;<i> acl splice_only_ip src 192.168.1.15
</I>&gt;<i> acl splice_only_ip src 192.168.1.16
</I>&gt;<i> :::: = redacted mac address
</I>&gt;<i> acl splice_only_mac arp :::::
</I>&gt;<i> acl splice_only_mac arp :::::
</I>&gt;<i> acl splice_only_mac arp :::::
</I>&gt;<i> acl splice_only_mac arp :::::
</I>&gt;<i> acl splice_only_mac arp :::::
</I>&gt;<i>
</I>&gt;<i> acl NoSSLIntercept ssl::server_name_regex -i '/usr/local/pkg/reg.url.nobump'
</I>&gt;<i> acl NoBumpDNS dstdomain -n '/usr/local/pkg/dns.nobump'
</I>&gt;<i> acl SSL_Intercept_Terminate dstdomain -n '/usr/local/pkg/url.bump'
</I>&gt;<i>
</I>&gt;<i> acl active_use annotate_client active=true
</I>&gt;<i>
</I>&gt;<i> acl bump_only_ip src 192.168.1.3
</I>&gt;<i> acl bump_only_ip src 192.168.1.4
</I>&gt;<i> acl bump_only_ip src 192.168.1.5
</I>&gt;<i> #acl bump_only_ip src 192.168.1.6
</I>&gt;<i> acl bump_only_ip src 192.168.1.9
</I>&gt;<i> acl bump_only_ip src 192.168.1.13
</I>&gt;<i>
</I>&gt;<i> acl bump_only_mac arp :::::
</I>&gt;<i> acl bump_only_mac arp :::::
</I>&gt;<i> acl bump_only_mac arp :::::
</I>&gt;<i> acl bump_only_mac arp :::::
</I>&gt;<i> acl bump_only_mac arp :::::
</I>&gt;<i> #acl bump_only_mac arp :::::
</I>&gt;<i>
</I>&gt;<i> coredump_dir /nvme/LOGS_Optane/Squid_Dump
</I>&gt;<i>
</I>&gt;<i> acl splice_group any-of https_login NoBumpDNS NoSSLIntercept
</I>&gt;<i> acl splice_only_local_group all-of splice_only_mac splice_only_ip
</I>&gt;<i> acl splice_main any-of splice_group splice_only_local_group
</I>&gt;<i> acl bump_main all-of bump_only_mac bump_only_ip
</I>&gt;<i>
</I>&gt;<i> ssl_bump peek step1
</I>&gt;<i> ssl_bump terminate SSL_Intercept_Terminate
</I>&gt;<i> miss_access deny no_miss active_use
</I>&gt;<i> ssl_bump splice splice_main active_use
</I>&gt;<i> ssl_bump bump bump_main active_use
</I>&gt;<i> acl activated note active_use true
</I>&gt;<i> ssl_bump terminate !activated
</I>&gt;<i>
</I>&gt;<i> # Setup allowed ACLs
</I>&gt;<i> # Allow local network(s) on interface(s)
</I>&gt;<i> http_access allow localnet
</I>&gt;<i> # Default block all to be sure
</I>&gt;<i> http_access deny allsrc
</I>&gt;<i>
</I>&gt;<i> Does delay pool setting cause any issues? They seem to be default values
</I>&gt;<i> one pool.
</I>&gt;<i>
</I>
If you need them, you need them.
There doesn't seem to be anything obviously wrong with the highlighted
parts of your config, except maybe that the memory cache is tiny.
How much RAM is the OS reporting that squid is using after a few hours or
days of use?


-- 
    Francesco
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20250111/e71ccd49/attachment-0001.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20250111/e71ccd49/attachment-0001.htm</A>&gt;
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="027377.html">[squid-users] Cache dir
</A></li>
	<LI>Next message (by thread): <A HREF="027385.html">[squid-users] Cache dir
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27384">[ date ]</a>
              <a href="thread.html#27384">[ thread ]</a>
              <a href="subject.html#27384">[ subject ]</a>
              <a href="author.html#27384">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
