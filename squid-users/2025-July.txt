From mab_itsystem at machaero.com  Thu Jul 10 10:39:31 2025
From: mab_itsystem at machaero.com (MAB IT System)
Date: Thu, 10 Jul 2025 12:39:31 +0200
Subject: [squid-users] (no subject)
Message-ID: <CAELz2Fa=rrgJ-9P24XDNxrP=uPNNHa4RTBLd3znn5dADXaTmBg@mail.gmail.com>

Dear Squid team,

I?m currently working on deploying Squid as a transparent proxy using
WCCPv2 with a Cisco ASA firewall.

The ASA selects a router ID x.x.x.x automatically and uses GRE
encapsulation. However, in my Squid configuration, I?m using
wccp2_forwarding_method gre.

I?ve confirmed that:
- UDP traffic on port 2048 between Squid and the ASA is working correctly.
- Squid receives WCCP messages (`HERE_I_AM`, `I_SEE_YOU`) but logs errors
like:
  `ERROR: Ignoring WCCPv2 message: check failed: duplicate security
definition`
- ASA logs show that Squid is visible but marked as ?NOT Usable? and gets
0% hash allocation.
- I?m running Squid version 5.9 on Linux Ubuntu.

Questions:
1. Is there a known issue when using `wccp2_forwarding_method gre` with
devices that support GRE?
2. Could Squid gracefully fallback or detect ASA?s redirect mode
automatically?
3. Is there a specific Squid version better suited for WCCPv2 with GRE only?

Any insights, suggestions, or recommended configuration would be greatly
appreciated.

Thank you for your support and great work on Squid.

Best regards,
Assoham AWOUTOU
MACHAERO

-- 
******************************************************************************
The information contained herein may be company confidential and 
proprietary. The information is intended only for the use of the named 
individual or entity. If you are not the intended recipient, the employee 
or agent responsible for delivering it to the intended recipient, you are 
hereby notified that any use, dissemination, distribution or copying of 
this communication is strictly prohibited. If you have received this 
communication in error, please notify the sender (and delete it from your 
systems) immediately. The information herein is not warranted to be free of 
virus or any other defect that may affect the recipient's computer system 
and it is your responsibility to carry out appropriate virus checks of this 
email and attachments (if any).
******************************************************************************
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20250710/733aee7d/attachment.htm>

From rousskov at measurement-factory.com  Thu Jul 10 16:16:51 2025
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Thu, 10 Jul 2025 12:16:51 -0400
Subject: [squid-users] WCCP: duplicate security definition
In-Reply-To: <CAELz2Fa=rrgJ-9P24XDNxrP=uPNNHa4RTBLd3znn5dADXaTmBg@mail.gmail.com>
References: <CAELz2Fa=rrgJ-9P24XDNxrP=uPNNHa4RTBLd3znn5dADXaTmBg@mail.gmail.com>
Message-ID: <b83a0c90-f9a7-4394-a4e5-eb9ad15aaf67@measurement-factory.com>

On 2025-07-10 06:39, MAB IT System wrote:
> Dear Squid team,
> 
> I?m currently working on deploying Squid as a transparent proxy using 
> WCCPv2 with a Cisco ASA firewall.
> 
> The ASA selects a router ID x.x.x.x automatically and uses GRE 
> encapsulation. However, in my Squid configuration, I?m using 
> wccp2_forwarding_method gre.
> 
> I?ve confirmed that:
> - UDP traffic on port 2048 between Squid and the ASA is working correctly.
> - Squid receives WCCP messages (`HERE_I_AM`, `I_SEE_YOU`) but logs 
> errors like:
>  ? `ERROR: Ignoring WCCPv2 message: check failed: duplicate security 
> definition`

You are probably suffering from Squid Bug 5179:
https://bugs.squid-cache.org/show_bug.cgi?id=5179

FWIW, there is a (currently dorman) PR with a proposed fix draft:
https://github.com/squid-cache/squid/pull/970


> Any insights, suggestions, or recommended configuration would be greatly 
> appreciated.

Squid WCCP code has many problems. AFAICT, no Squid developer is 
currently focusing on addressing them.


HTH,

Alex.


> - ASA logs show that Squid is visible but marked as ?NOT Usable? and 
> gets 0% hash allocation.
> - I?m running Squid version 5.9 on Linux Ubuntu.
> 
> Questions:
> 1. Is there a known issue when using `wccp2_forwarding_method gre` with 
> devices that support GRE?
> 2. Could Squid gracefully fallback or detect ASA?s redirect mode 
> automatically?
> 3. Is there a specific Squid version better suited for WCCPv2 with GRE only?
> 
> Any insights, suggestions, or recommended configuration would be greatly 
> appreciated.
> 
> Thank you for your support and great work on Squid.
> 
> Best regards,
> Assoham AWOUTOU
> MACHAERO
> 
> 
> ******************************************************************************
> The information contained herein may be company confidential and 
> proprietary. The information is intended only for the use of the named 
> individual or entity. If you are not the intended recipient, the 
> employee or agent responsible for delivering it to the intended 
> recipient, you are hereby notified that any use, dissemination, 
> distribution or copying of this communication is strictly prohibited. If 
> you have received this communication in error, please notify the sender 
> (and delete it from your systems) immediately. The information herein is 
> not warranted to be free of virus or any other defect that may affect 
> the recipient's computer system and it is your responsibility to carry 
> out appropriate virus checks of this email and attachments (if any).
> ******************************************************************************
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> https://lists.squid-cache.org/listinfo/squid-users


From paolo.prinx at gmail.com  Fri Jul 11 09:54:09 2025
From: paolo.prinx at gmail.com (paolo.prinx at gmail.com)
Date: Fri, 11 Jul 2025 09:54:09 +0000 (UTC)
Subject: [squid-users] DNS round-robin behaviour
In-Reply-To: <1026668535.2215882.1720781888145@mail.yahoo.com>
References: <1026668535.2215882.1720781888145.ref@mail.yahoo.com>
 <1026668535.2215882.1720781888145@mail.yahoo.com>
Message-ID: <1891163573.286493.1752227649937@mail.yahoo.com>

 Hello all,? ? quick question, how does Squid behave when it receives a DNS response containing multiple IP addresses? Does it pick a random one in the list, or does it stick to a certain order?
In our config, we have squid pointing to a pool of dnsdist resolvers, that implement a local packet cache with a 300-second TTL. We are seeing unbalanced traffic distributions, was wondering if there is anything we should configure on the Squid side, or if we should instead look to change the responses returned by the DNS resolver.
Any suggestion??
Thanks again

  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20250711/3ef3841c/attachment.htm>

From squid3 at treenet.co.nz  Fri Jul 11 12:07:06 2025
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 12 Jul 2025 00:07:06 +1200
Subject: [squid-users] DNS round-robin behaviour
In-Reply-To: <1891163573.286493.1752227649937@mail.yahoo.com>
References: <1026668535.2215882.1720781888145.ref@mail.yahoo.com>
 <1026668535.2215882.1720781888145@mail.yahoo.com>
 <1891163573.286493.1752227649937@mail.yahoo.com>
Message-ID: <2929e2b6-26e3-48ab-b57c-1f659c6a13fa@treenet.co.nz>

pPS, Please start a new thread for each topic.

On 11/07/25 21:54, paolo.prinx wrote:
> Hello all,
>  ? ? quick question, how does Squid behave when it receives a DNS 
> response containing multiple IP addresses? Does it pick a random one in 
> the list, or does it stick to a certain order?

The order given by DNS is the order used. Except that when both are 
available IPv6 are preferred over IPv4.


> 
> In our config, we have squid pointing to a pool of dnsdist resolvers, 
> that implement a local packet cache with a 300-second TTL. We are seeing 
> unbalanced traffic distributions, was wondering if there is anything we 
> should configure on the Squid side, or if we should instead look to 
> change the responses returned by the DNS resolver.
> 
> Any suggestion?
> 

DNS alone is not sufficient to balance traffic. There are many factors 
involved including HTTP multiplexing, pipelines, variability of message 
sizes, and network RTT on each connection.

The best way to balance traffic is with proper QoS tools. DNS and HTTP 
proxy are optimized towards service speed - not load redundancy (which 
actually reduces peak performance).


HTH
Amos


From rousskov at measurement-factory.com  Fri Jul 11 13:09:42 2025
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Fri, 11 Jul 2025 09:09:42 -0400
Subject: [squid-users] DNS round-robin behaviour
In-Reply-To: <1891163573.286493.1752227649937@mail.yahoo.com>
References: <1026668535.2215882.1720781888145.ref@mail.yahoo.com>
 <1026668535.2215882.1720781888145@mail.yahoo.com>
 <1891163573.286493.1752227649937@mail.yahoo.com>
Message-ID: <04dada29-a190-46da-a3e7-967741c87eee@measurement-factory.com>

On 2025-07-11 05:54, paolo.prinx at gmail.com wrote:

> how does Squid behave when it receives a DNS 
> response containing multiple IP addresses? Does it pick a random one in 
> the list, or does it stick to a certain order?

Modern Squids usually use the first received IPv4 address for all 
transactions going to the corresponding host. Other received IPv4 
addresses are used (in the order they were received, wrapping up in a 
round-robin fashion) only if the current address is marked as "bad" due 
to errors when trying to establish a TCP connection to that host.

The same is true for received IPv6 addresses.

When both IPv4 and IPv6 addresses were received prior to the connection 
opening attempt, the first received address is used in error-free cases. 
Squid sends DNS A query immediately followed by a DNS AAAA query (where 
supported), so there may be bias towards IPv4 addresses if answers to 
DNS queries usually come in the order the queries were sent.


> In our config, we have squid pointing to a pool of dnsdist resolvers, 
> that implement a local packet cache with a 300-second TTL. We are seeing 
> unbalanced traffic distributions, was wondering if there is anything we 
> should configure on the Squid side, or if we should instead look to 
> change the responses returned by the DNS resolver.

I would not try to balance load using DNS. If you want to do it using 
Squid, then using round-robin or a similar cache_peer selection method 
may be worth investigating/testing.


HTH,

Alex.


From rob at sput.nl  Sat Jul 12 08:22:59 2025
From: rob at sput.nl (Rob van der Putten)
Date: Sat, 12 Jul 2025 10:22:59 +0200
Subject: [squid-users] DNS round-robin behaviour
In-Reply-To: <2929e2b6-26e3-48ab-b57c-1f659c6a13fa@treenet.co.nz>
References: <1026668535.2215882.1720781888145.ref@mail.yahoo.com>
 <1026668535.2215882.1720781888145@mail.yahoo.com>
 <1891163573.286493.1752227649937@mail.yahoo.com>
 <2929e2b6-26e3-48ab-b57c-1f659c6a13fa@treenet.co.nz>
Message-ID: <104t613$qmi$1@ciao.gmane.io>

Hi there


On 11/07/2025 14:07, Amos Jeffries wrote:

> pPS, Please start a new thread for each topic.
> 
> On 11/07/25 21:54, paolo.prinx wrote:
>> Hello all,
>> ?? ? quick question, how does Squid behave when it receives a DNS 
>> response containing multiple IP addresses? Does it pick a random one 
>> in the list, or does it stick to a certain order?
> 
> The order given by DNS is the order used. Except that when both are 
> available IPv6 are preferred over IPv4.

This does not apply to Squid 5 and higher.
IPv4 addresses get recycled a lot. And with recycling comes the 
reputation of the previous user. Complete with blacklisting and outdated 
GeoIP info. So an IPv4 preference is bad news.
To the Squid maintainers: Please, please, please restore the IPv6 
preference.
A 'quick' DNS based 'fix' here:
http://www.sput.nl/software/squid/squid-prefer-ipv6.html

> 
>>
>> In our config, we have squid pointing to a pool of dnsdist resolvers, 
>> that implement a local packet cache with a 300-second TTL. We are 
>> seeing unbalanced traffic distributions, was wondering if there is 
>> anything we should configure on the Squid side, or if we should 
>> instead look to change the responses returned by the DNS resolver.
>>
>> Any suggestion?
>>
> 
> DNS alone is not sufficient to balance traffic. There are many factors 
> involved including HTTP multiplexing, pipelines, variability of message 
> sizes, and network RTT on each connection.
> 
> The best way to balance traffic is with proper QoS tools. DNS and HTTP 
> proxy are optimized towards service speed - not load redundancy (which 
> actually reduces peak performance).

Regards,
Rob



From ankor2023 at gmail.com  Mon Jul 14 09:38:30 2025
From: ankor2023 at gmail.com (Andrey K)
Date: Mon, 14 Jul 2025 12:38:30 +0300
Subject: [squid-users] squid-7.0.2 can't configure with LDAP-helpers
Message-ID: <CADJd0Y14tk42W4nDkTpcraJ1Ucru_oWEXVbo5BiYXnDsNL_SbA@mail.gmail.com>

Hello,

I tried to build squid-7.0.2, but ./configure failed if I use:
--enable-auth-basic=*LDAP*,SMB,SMB_LM
--enable-auth-negotiate=kerberos,wrapper --enable-auth-ntlm=SMB_LM
--enable-external-acl-helpers=*kerberos_ldap_group*,wbinfo_group

configure: Authentication support enabled: yes
configure: checking auth/basic helpers: LDAP SMB SMB_LM
configure: error: required helper auth/basic/LDAP ... found but cannot be
built

configure: checking acl/external helpers: kerberos_ldap_group wbinfo_group
configure: error: required helper acl/external/kerberos_ldap_group ...
found but cannot be built

When I remove the LDAP and kerberos_ldap_group options,  ./configure passes
smoothly.

I did not observe a similar problem in the Squid-6.

I am building Squid on an OEL-8 Linux with installed openldap-devel
and openldap packages.

Kind regards,
     Ankor.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20250714/4f7cef8f/attachment.htm>

From gkinkie at gmail.com  Mon Jul 14 15:10:04 2025
From: gkinkie at gmail.com (Francesco Chemolli)
Date: Mon, 14 Jul 2025 16:10:04 +0100
Subject: [squid-users] squid-7.0.2 can't configure with LDAP-helpers
In-Reply-To: <CADJd0Y14tk42W4nDkTpcraJ1Ucru_oWEXVbo5BiYXnDsNL_SbA@mail.gmail.com>
References: <CADJd0Y14tk42W4nDkTpcraJ1Ucru_oWEXVbo5BiYXnDsNL_SbA@mail.gmail.com>
Message-ID: <CA+Y8hcOtak4Ka_6CXNv1s1iv1tdS8G4idROS-v_2vhXV=qLp+Q@mail.gmail.com>

Hi Ankor,
  it's really hard to help you with this little context. The main
reason why both these helpers may fail to build is because the LDAP
libraries were not found on the system. Would you mind running on your
system:

$ ./configure --enable-auth-basic=LDAP,SMB,SMB_LM
--enable-auth-negotiate=kerberos,wrapper --enable-auth-ntlm=SMB_LM
--enable-external-acl-helpers=kerberos_ldap_group,wbinfo_group
>/tmp/configure.log 2>&1 && grep -i ldap /tmp/configure.log

and sharing the output from that command?

On Mon, Jul 14, 2025 at 10:38?AM Andrey K <ankor2023 at gmail.com> wrote:
>
> Hello,
>
> I tried to build squid-7.0.2, but ./configure failed if I use:
> --enable-auth-basic=LDAP,SMB,SMB_LM --enable-auth-negotiate=kerberos,wrapper --enable-auth-ntlm=SMB_LM --enable-external-acl-helpers=kerberos_ldap_group,wbinfo_group
>
> configure: Authentication support enabled: yes
> configure: checking auth/basic helpers: LDAP SMB SMB_LM
> configure: error: required helper auth/basic/LDAP ... found but cannot be built
>
> configure: checking acl/external helpers: kerberos_ldap_group wbinfo_group
> configure: error: required helper acl/external/kerberos_ldap_group ... found but cannot be built
>
> When I remove the LDAP and kerberos_ldap_group options,  ./configure passes smoothly.
>
> I did not observe a similar problem in the Squid-6.
>
> I am building Squid on an OEL-8 Linux with installed openldap-devel and openldap packages.
>
> Kind regards,
>      Ankor.
>
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> https://lists.squid-cache.org/listinfo/squid-users



-- 
    Francesco

From kinkie at squid-cache.org  Mon Jul 14 21:02:56 2025
From: kinkie at squid-cache.org (Francesco Chemolli)
Date: Mon, 14 Jul 2025 22:02:56 +0100
Subject: [squid-users] Squid version 7.1 is available
Message-ID: <CA+Y8hcNMDt-ZOLPNoBTJNAPWqsWGJYTmjRq-rKUYjfAK0QEL7Q@mail.gmail.com>

The Squid HTTP Proxy team is very pleased to announce the availability
of the Squid-7.1 release!

This release is, we believe, stable enough for general production use.
We encourage all users of any previous major version of Squid to upgrade to it,
as well as users of beta version 7.0.X.

It can be downloaded from GitHub, at
https://github.com/squid-cache/squid/releases/tag/SQUID_7_1


Since version 6, Squid offers:
 * better support for overlapping IP ranges and wildcard domains in acl
 * countless security, portability, and documentation fixes

Since version 6, some previously deprecated features have been removed:
 * Edge Side Includes (ESI)
 * access to the cache manager using the cache_object:// scheme - use
http instead
 * the squdclient tool - use curl
http://<squid-address>/squid-internal-mgr/menu instead
 * the cachemgr.cgi tool
 * the purge tool - use the http PURGE method instead
 * Ident protocol support
 * basic_smb_lm_auth and ntlm_smb_lm_auth helpers - use Samba's
ntlm_auth instead

Further details can be found in the release notes and in the changelog

Please remember to run "squid -k parse" when testing the upgrade to a new
version of Squid. It will audit your configuration files and report
any identifiable issues the new release will have in your installation
before you "press go".

If you encounter any issues with this release please file a bug report at
https://bugs.squid-cache.org/

--
    Francesco Chemolli

From ankor2023 at gmail.com  Tue Jul 15 03:05:36 2025
From: ankor2023 at gmail.com (Andrey K)
Date: Tue, 15 Jul 2025 06:05:36 +0300
Subject: [squid-users] squid-7.0.2 can't configure with LDAP-helpers
In-Reply-To: <CA+Y8hcOtak4Ka_6CXNv1s1iv1tdS8G4idROS-v_2vhXV=qLp+Q@mail.gmail.com>
References: <CADJd0Y14tk42W4nDkTpcraJ1Ucru_oWEXVbo5BiYXnDsNL_SbA@mail.gmail.com>
 <CA+Y8hcOtak4Ka_6CXNv1s1iv1tdS8G4idROS-v_2vhXV=qLp+Q@mail.gmail.com>
Message-ID: <CADJd0Y0RRwY8TLhcB4quuTc7mFbOHomupMugFX1XS+Usx_eYXA@mail.gmail.com>

Hello, Francesco,

Thank you for the help.

Full logs of the configure command are available at the link:
https://drive.google.com/file/d/1wxAmtK2PDTuS41vvM0kuAS-1TtlzZKFl/view?usp=sharing

Here is a short excerpt on the LDAP filter:
cat /tmp/configure.log | grep -i ldap
checking for LIBLDAP... no
checking for ldap.h... yes
checking for mozldap/ldap.h... no
checking for LDAP... 1
checking for OpenLDAP... 1
checking for Sun LDAP SDK... 0
checking for Mozilla LDAP SDK... 0
checking for LDAP_OPT_DEBUG_LEVEL... 1
checking for LDAP_SCOPE_DEFAULT... 1
checking for LDAP_REBIND_PROC... 1
checking for LDAP_REBINDPROC_CALLBACK... 0
checking for LDAP_REBIND_FUNCTION... 0
checking for LDAP_URL_LUD_SCHEME... 0
checking for ldapssl_client_init in -lldap... no
checking for library containing ldap_url_desc2str... no
checking for library containing ldap_url_parse... no
checking for library containing ldap_start_tls_s... no
configure: Library 'ldap' support: no (auto)
configure: checking auth/basic helpers: LDAP SMB SMB_LM
configure: error: required helper auth/basic/LDAP ... found but cannot be
built

Kind regards,
      Ankor.


??, 14 ???. 2025??. ? 18:10, Francesco Chemolli <gkinkie at gmail.com>:

> Hi Ankor,
>   it's really hard to help you with this little context. The main
> reason why both these helpers may fail to build is because the LDAP
> libraries were not found on the system. Would you mind running on your
> system:
>
> $ ./configure --enable-auth-basic=LDAP,SMB,SMB_LM
> --enable-auth-negotiate=kerberos,wrapper --enable-auth-ntlm=SMB_LM
> --enable-external-acl-helpers=kerberos_ldap_group,wbinfo_group
> >/tmp/configure.log 2>&1 && grep -i ldap /tmp/configure.log
>
> and sharing the output from that command?
>
> On Mon, Jul 14, 2025 at 10:38?AM Andrey K <ankor2023 at gmail.com> wrote:
> >
> > Hello,
> >
> > I tried to build squid-7.0.2, but ./configure failed if I use:
> > --enable-auth-basic=LDAP,SMB,SMB_LM
> --enable-auth-negotiate=kerberos,wrapper --enable-auth-ntlm=SMB_LM
> --enable-external-acl-helpers=kerberos_ldap_group,wbinfo_group
> >
> > configure: Authentication support enabled: yes
> > configure: checking auth/basic helpers: LDAP SMB SMB_LM
> > configure: error: required helper auth/basic/LDAP ... found but cannot
> be built
> >
> > configure: checking acl/external helpers: kerberos_ldap_group
> wbinfo_group
> > configure: error: required helper acl/external/kerberos_ldap_group ...
> found but cannot be built
> >
> > When I remove the LDAP and kerberos_ldap_group options,  ./configure
> passes smoothly.
> >
> > I did not observe a similar problem in the Squid-6.
> >
> > I am building Squid on an OEL-8 Linux with installed openldap-devel and
> openldap packages.
> >
> > Kind regards,
> >      Ankor.
> >
> >
> >
> > _______________________________________________
> > squid-users mailing list
> > squid-users at lists.squid-cache.org
> > https://lists.squid-cache.org/listinfo/squid-users
>
>
>
> --
>     Francesco
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20250715/4addd340/attachment.htm>

From ankor2023 at gmail.com  Tue Jul 15 06:13:46 2025
From: ankor2023 at gmail.com (Andrey K)
Date: Tue, 15 Jul 2025 09:13:46 +0300
Subject: [squid-users] squid-7.0.2 can't configure with LDAP-helpers
In-Reply-To: <CADJd0Y0RRwY8TLhcB4quuTc7mFbOHomupMugFX1XS+Usx_eYXA@mail.gmail.com>
References: <CADJd0Y14tk42W4nDkTpcraJ1Ucru_oWEXVbo5BiYXnDsNL_SbA@mail.gmail.com>
 <CA+Y8hcOtak4Ka_6CXNv1s1iv1tdS8G4idROS-v_2vhXV=qLp+Q@mail.gmail.com>
 <CADJd0Y0RRwY8TLhcB4quuTc7mFbOHomupMugFX1XS+Usx_eYXA@mail.gmail.com>
Message-ID: <CADJd0Y2oP9++qdw99kgJYHWs_4T8RApUnjj2C1pRmqYb-C-Row@mail.gmail.com>

Hello, Francesco,

I have also run a configure script with the same arguments on the Squid
6.13 sources.
It finished without errors.

The link to the 6.13 logs:
https://drive.google.com/file/d/16DY4uCM5cAbsNC8NcaoM8YB6GT8oUW3-/view?usp=sharing
The excerpt on the LDAP filter:

grep -i ldap /tmp/configure.6.13.log
checking for LIBLDAP... no
checking for ldap_init in -lldap... yes
checking ldap.h usability... yes
checking ldap.h presence... yes
checking for ldap.h... yes
checking mozldap/ldap.h usability... no
checking mozldap/ldap.h presence... no
checking for mozldap/ldap.h... no
checking for LDAP... 1
checking for OpenLDAP... 1
checking for Sun LDAP SDK... 0
checking for Mozilla LDAP SDK... 0
checking for LDAP_OPT_DEBUG_LEVEL... 1
checking for LDAP_SCOPE_DEFAULT... 1
checking for LDAP_REBIND_PROC... 1
checking for LDAP_REBINDPROC_CALLBACK... 0
checking for LDAP_REBIND_FUNCTION... 0
checking for LDAP_URL_LUD_SCHEME... 0
checking for ldapssl_client_init in -lldap... no
checking for library containing ldap_url_desc2str... -lldap
checking for library containing ldap_url_parse... none required
checking for library containing ldap_start_tls_s... none required
configure: checking auth/basic helpers: LDAP SMB SMB_LM
checking for ldap.h... (cached) yes
checking winldap.h usability... no
checking winldap.h presence... no
checking for winldap.h... no
configure: auth/basic helpers to be built:  LDAP SMB SMB_LM
configure: checking auth/digest helpers: LDAP eDirectory file
checking for ldap.h... (cached) yes
checking for winldap.h... (cached) no
checking for ldap.h... (cached) yes
checking for winldap.h... (cached) no
configure: auth/digest helpers to be built:  LDAP eDirectory file
configure: checking acl/external helpers: kerberos_ldap_group wbinfo_group
configure: acl/external helpers to be built:  kerberos_ldap_group
wbinfo_group
config.status: creating src/acl/external/kerberos_ldap_group/Makefile
config.status: creating src/acl/external/LDAP_group/Makefile
config.status: creating src/auth/basic/LDAP/Makefile
config.status: creating src/auth/digest/LDAP/Makefile
configure: running /bin/sh ./configure --disable-option-checking
'--prefix=/usr/local/squid'  '--enable-auth-basic=LDAP,SMB,SMB_LM'
'--enable-auth-negotiate=kerberos,wrapper' '--enable-auth-ntlm=SMB_LM'
'--enable-external-acl-helpers=kerberos_ldap_group,wbinfo_group'
--cache-file=/dev/null --srcdir=.


Kind regards,
     Ankor.





??, 15 ???. 2025??. ? 06:05, Andrey K <ankor2023 at gmail.com>:

> Hello, Francesco,
>
> Thank you for the help.
>
> Full logs of the configure command are available at the link:
> https://drive.google.com/file/d/1wxAmtK2PDTuS41vvM0kuAS-1TtlzZKFl/view?usp=sharing
>
> Here is a short excerpt on the LDAP filter:
> cat /tmp/configure.log | grep -i ldap
> checking for LIBLDAP... no
> checking for ldap.h... yes
> checking for mozldap/ldap.h... no
> checking for LDAP... 1
> checking for OpenLDAP... 1
> checking for Sun LDAP SDK... 0
> checking for Mozilla LDAP SDK... 0
> checking for LDAP_OPT_DEBUG_LEVEL... 1
> checking for LDAP_SCOPE_DEFAULT... 1
> checking for LDAP_REBIND_PROC... 1
> checking for LDAP_REBINDPROC_CALLBACK... 0
> checking for LDAP_REBIND_FUNCTION... 0
> checking for LDAP_URL_LUD_SCHEME... 0
> checking for ldapssl_client_init in -lldap... no
> checking for library containing ldap_url_desc2str... no
> checking for library containing ldap_url_parse... no
> checking for library containing ldap_start_tls_s... no
> configure: Library 'ldap' support: no (auto)
> configure: checking auth/basic helpers: LDAP SMB SMB_LM
> configure: error: required helper auth/basic/LDAP ... found but cannot be
> built
>
> Kind regards,
>       Ankor.
>
>
> ??, 14 ???. 2025??. ? 18:10, Francesco Chemolli <gkinkie at gmail.com>:
>
>> Hi Ankor,
>>   it's really hard to help you with this little context. The main
>> reason why both these helpers may fail to build is because the LDAP
>> libraries were not found on the system. Would you mind running on your
>> system:
>>
>> $ ./configure --enable-auth-basic=LDAP,SMB,SMB_LM
>> --enable-auth-negotiate=kerberos,wrapper --enable-auth-ntlm=SMB_LM
>> --enable-external-acl-helpers=kerberos_ldap_group,wbinfo_group
>> >/tmp/configure.log 2>&1 && grep -i ldap /tmp/configure.log
>>
>> and sharing the output from that command?
>>
>> On Mon, Jul 14, 2025 at 10:38?AM Andrey K <ankor2023 at gmail.com> wrote:
>> >
>> > Hello,
>> >
>> > I tried to build squid-7.0.2, but ./configure failed if I use:
>> > --enable-auth-basic=LDAP,SMB,SMB_LM
>> --enable-auth-negotiate=kerberos,wrapper --enable-auth-ntlm=SMB_LM
>> --enable-external-acl-helpers=kerberos_ldap_group,wbinfo_group
>> >
>> > configure: Authentication support enabled: yes
>> > configure: checking auth/basic helpers: LDAP SMB SMB_LM
>> > configure: error: required helper auth/basic/LDAP ... found but cannot
>> be built
>> >
>> > configure: checking acl/external helpers: kerberos_ldap_group
>> wbinfo_group
>> > configure: error: required helper acl/external/kerberos_ldap_group ...
>> found but cannot be built
>> >
>> > When I remove the LDAP and kerberos_ldap_group options,  ./configure
>> passes smoothly.
>> >
>> > I did not observe a similar problem in the Squid-6.
>> >
>> > I am building Squid on an OEL-8 Linux with installed openldap-devel and
>> openldap packages.
>> >
>> > Kind regards,
>> >      Ankor.
>> >
>> >
>> >
>> > _______________________________________________
>> > squid-users mailing list
>> > squid-users at lists.squid-cache.org
>> > https://lists.squid-cache.org/listinfo/squid-users
>>
>>
>>
>> --
>>     Francesco
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20250715/fb356296/attachment-0001.htm>

From gkinkie at gmail.com  Tue Jul 15 07:41:48 2025
From: gkinkie at gmail.com (Francesco Chemolli)
Date: Tue, 15 Jul 2025 08:41:48 +0100
Subject: [squid-users] squid-7.0.2 can't configure with LDAP-helpers
In-Reply-To: <CADJd0Y2oP9++qdw99kgJYHWs_4T8RApUnjj2C1pRmqYb-C-Row@mail.gmail.com>
References: <CADJd0Y14tk42W4nDkTpcraJ1Ucru_oWEXVbo5BiYXnDsNL_SbA@mail.gmail.com>
 <CA+Y8hcOtak4Ka_6CXNv1s1iv1tdS8G4idROS-v_2vhXV=qLp+Q@mail.gmail.com>
 <CADJd0Y0RRwY8TLhcB4quuTc7mFbOHomupMugFX1XS+Usx_eYXA@mail.gmail.com>
 <CADJd0Y2oP9++qdw99kgJYHWs_4T8RApUnjj2C1pRmqYb-C-Row@mail.gmail.com>
Message-ID: <CA+Y8hcMuZZq9re7jML-dyUNmLE4Fb-ZK3FNJQdUoM1XR6g=pPQ@mail.gmail.com>

Hi Andrey,
  looking at the code changes, the main reason I can see is that
pkg-config needs to be present and working in order to Squid the
libraries it needs.
Could you try running

pkg-config --libs ldap

on your system?

On Tue, Jul 15, 2025 at 7:13?AM Andrey K <ankor2023 at gmail.com> wrote:
>
> Hello, Francesco,
>
> I have also run a configure script with the same arguments on the Squid 6.13 sources.
> It finished without errors.
>
> The link to the 6.13 logs: https://drive.google.com/file/d/16DY4uCM5cAbsNC8NcaoM8YB6GT8oUW3-/view?usp=sharing
> The excerpt on the LDAP filter:
>
> grep -i ldap /tmp/configure.6.13.log
> checking for LIBLDAP... no
> checking for ldap_init in -lldap... yes
> checking ldap.h usability... yes
> checking ldap.h presence... yes
> checking for ldap.h... yes
> checking mozldap/ldap.h usability... no
> checking mozldap/ldap.h presence... no
> checking for mozldap/ldap.h... no
> checking for LDAP... 1
> checking for OpenLDAP... 1
> checking for Sun LDAP SDK... 0
> checking for Mozilla LDAP SDK... 0
> checking for LDAP_OPT_DEBUG_LEVEL... 1
> checking for LDAP_SCOPE_DEFAULT... 1
> checking for LDAP_REBIND_PROC... 1
> checking for LDAP_REBINDPROC_CALLBACK... 0
> checking for LDAP_REBIND_FUNCTION... 0
> checking for LDAP_URL_LUD_SCHEME... 0
> checking for ldapssl_client_init in -lldap... no
> checking for library containing ldap_url_desc2str... -lldap
> checking for library containing ldap_url_parse... none required
> checking for library containing ldap_start_tls_s... none required
> configure: checking auth/basic helpers: LDAP SMB SMB_LM
> checking for ldap.h... (cached) yes
> checking winldap.h usability... no
> checking winldap.h presence... no
> checking for winldap.h... no
> configure: auth/basic helpers to be built:  LDAP SMB SMB_LM
> configure: checking auth/digest helpers: LDAP eDirectory file
> checking for ldap.h... (cached) yes
> checking for winldap.h... (cached) no
> checking for ldap.h... (cached) yes
> checking for winldap.h... (cached) no
> configure: auth/digest helpers to be built:  LDAP eDirectory file
> configure: checking acl/external helpers: kerberos_ldap_group wbinfo_group
> configure: acl/external helpers to be built:  kerberos_ldap_group wbinfo_group
> config.status: creating src/acl/external/kerberos_ldap_group/Makefile
> config.status: creating src/acl/external/LDAP_group/Makefile
> config.status: creating src/auth/basic/LDAP/Makefile
> config.status: creating src/auth/digest/LDAP/Makefile
> configure: running /bin/sh ./configure --disable-option-checking '--prefix=/usr/local/squid'  '--enable-auth-basic=LDAP,SMB,SMB_LM' '--enable-auth-negotiate=kerberos,wrapper' '--enable-auth-ntlm=SMB_LM' '--enable-external-acl-helpers=kerberos_ldap_group,wbinfo_group' --cache-file=/dev/null --srcdir=.
>
>
> Kind regards,
>      Ankor.
>
>
>
>
>
> ??, 15 ???. 2025??. ? 06:05, Andrey K <ankor2023 at gmail.com>:
>>
>> Hello, Francesco,
>>
>> Thank you for the help.
>>
>> Full logs of the configure command are available at the link: https://drive.google.com/file/d/1wxAmtK2PDTuS41vvM0kuAS-1TtlzZKFl/view?usp=sharing
>>
>> Here is a short excerpt on the LDAP filter:
>> cat /tmp/configure.log | grep -i ldap
>> checking for LIBLDAP... no
>> checking for ldap.h... yes
>> checking for mozldap/ldap.h... no
>> checking for LDAP... 1
>> checking for OpenLDAP... 1
>> checking for Sun LDAP SDK... 0
>> checking for Mozilla LDAP SDK... 0
>> checking for LDAP_OPT_DEBUG_LEVEL... 1
>> checking for LDAP_SCOPE_DEFAULT... 1
>> checking for LDAP_REBIND_PROC... 1
>> checking for LDAP_REBINDPROC_CALLBACK... 0
>> checking for LDAP_REBIND_FUNCTION... 0
>> checking for LDAP_URL_LUD_SCHEME... 0
>> checking for ldapssl_client_init in -lldap... no
>> checking for library containing ldap_url_desc2str... no
>> checking for library containing ldap_url_parse... no
>> checking for library containing ldap_start_tls_s... no
>> configure: Library 'ldap' support: no (auto)
>> configure: checking auth/basic helpers: LDAP SMB SMB_LM
>> configure: error: required helper auth/basic/LDAP ... found but cannot be built
>>
>> Kind regards,
>>       Ankor.
>>
>>
>> ??, 14 ???. 2025??. ? 18:10, Francesco Chemolli <gkinkie at gmail.com>:
>>>
>>> Hi Ankor,
>>>   it's really hard to help you with this little context. The main
>>> reason why both these helpers may fail to build is because the LDAP
>>> libraries were not found on the system. Would you mind running on your
>>> system:
>>>
>>> $ ./configure --enable-auth-basic=LDAP,SMB,SMB_LM
>>> --enable-auth-negotiate=kerberos,wrapper --enable-auth-ntlm=SMB_LM
>>> --enable-external-acl-helpers=kerberos_ldap_group,wbinfo_group
>>> >/tmp/configure.log 2>&1 && grep -i ldap /tmp/configure.log
>>>
>>> and sharing the output from that command?
>>>
>>> On Mon, Jul 14, 2025 at 10:38?AM Andrey K <ankor2023 at gmail.com> wrote:
>>> >
>>> > Hello,
>>> >
>>> > I tried to build squid-7.0.2, but ./configure failed if I use:
>>> > --enable-auth-basic=LDAP,SMB,SMB_LM --enable-auth-negotiate=kerberos,wrapper --enable-auth-ntlm=SMB_LM --enable-external-acl-helpers=kerberos_ldap_group,wbinfo_group
>>> >
>>> > configure: Authentication support enabled: yes
>>> > configure: checking auth/basic helpers: LDAP SMB SMB_LM
>>> > configure: error: required helper auth/basic/LDAP ... found but cannot be built
>>> >
>>> > configure: checking acl/external helpers: kerberos_ldap_group wbinfo_group
>>> > configure: error: required helper acl/external/kerberos_ldap_group ... found but cannot be built
>>> >
>>> > When I remove the LDAP and kerberos_ldap_group options,  ./configure passes smoothly.
>>> >
>>> > I did not observe a similar problem in the Squid-6.
>>> >
>>> > I am building Squid on an OEL-8 Linux with installed openldap-devel and openldap packages.
>>> >
>>> > Kind regards,
>>> >      Ankor.
>>> >
>>> >
>>> >
>>> > _______________________________________________
>>> > squid-users mailing list
>>> > squid-users at lists.squid-cache.org
>>> > https://lists.squid-cache.org/listinfo/squid-users
>>>
>>>
>>>
>>> --
>>>     Francesco



-- 
    Francesco

From ankor2023 at gmail.com  Tue Jul 15 09:41:56 2025
From: ankor2023 at gmail.com (Andrey K)
Date: Tue, 15 Jul 2025 12:41:56 +0300
Subject: [squid-users] squid-7.0.2 can't configure with LDAP-helpers
In-Reply-To: <CA+Y8hcMuZZq9re7jML-dyUNmLE4Fb-ZK3FNJQdUoM1XR6g=pPQ@mail.gmail.com>
References: <CADJd0Y14tk42W4nDkTpcraJ1Ucru_oWEXVbo5BiYXnDsNL_SbA@mail.gmail.com>
 <CA+Y8hcOtak4Ka_6CXNv1s1iv1tdS8G4idROS-v_2vhXV=qLp+Q@mail.gmail.com>
 <CADJd0Y0RRwY8TLhcB4quuTc7mFbOHomupMugFX1XS+Usx_eYXA@mail.gmail.com>
 <CADJd0Y2oP9++qdw99kgJYHWs_4T8RApUnjj2C1pRmqYb-C-Row@mail.gmail.com>
 <CA+Y8hcMuZZq9re7jML-dyUNmLE4Fb-ZK3FNJQdUoM1XR6g=pPQ@mail.gmail.com>
Message-ID: <CADJd0Y3R2Hu0soXCqn0fccp2zs5dv4S7a6i=w8LAmNkUN+2TjA@mail.gmail.com>

Hello, Francesco,

The output of the command:
pkg-config --libs ldap
Package ldap was not found in the pkg-config search path.
Perhaps you should add the directory containing `ldap.pc'
to the PKG_CONFIG_PATH environment variable
Package 'ldap', required by 'virtual:world', not found

However, the libldap is installed in the system as a part of the openldap
package:
locate libldap
/usr/lib64/libldap-2.4.so.2
/usr/lib64/libldap-2.4.so.2.10.9
/usr/lib64/libldap.so
/usr/lib64/libldap_r-2.4.so.2
/usr/lib64/libldap_r-2.4.so.2.10.9
/usr/lib64/libldap_r.so

There is no ldap.pc file in the standard OEL openldap packages:
openldap-devel-2.4.46-18.el8.x86_64
openldap-2.4.46-18.el8.x86_64


Kind regards,
    Ankor



??, 15 ???. 2025??. ? 10:42, Francesco Chemolli <gkinkie at gmail.com>:

> Hi Andrey,
>   looking at the code changes, the main reason I can see is that
> pkg-config needs to be present and working in order to Squid the
> libraries it needs.
> Could you try running
>
> pkg-config --libs ldap
>
> on your system?
>
> On Tue, Jul 15, 2025 at 7:13?AM Andrey K <ankor2023 at gmail.com> wrote:
> >
> > Hello, Francesco,
> >
> > I have also run a configure script with the same arguments on the Squid
> 6.13 sources.
> > It finished without errors.
> >
> > The link to the 6.13 logs:
> https://drive.google.com/file/d/16DY4uCM5cAbsNC8NcaoM8YB6GT8oUW3-/view?usp=sharing
> > The excerpt on the LDAP filter:
> >
> > grep -i ldap /tmp/configure.6.13.log
> > checking for LIBLDAP... no
> > checking for ldap_init in -lldap... yes
> > checking ldap.h usability... yes
> > checking ldap.h presence... yes
> > checking for ldap.h... yes
> > checking mozldap/ldap.h usability... no
> > checking mozldap/ldap.h presence... no
> > checking for mozldap/ldap.h... no
> > checking for LDAP... 1
> > checking for OpenLDAP... 1
> > checking for Sun LDAP SDK... 0
> > checking for Mozilla LDAP SDK... 0
> > checking for LDAP_OPT_DEBUG_LEVEL... 1
> > checking for LDAP_SCOPE_DEFAULT... 1
> > checking for LDAP_REBIND_PROC... 1
> > checking for LDAP_REBINDPROC_CALLBACK... 0
> > checking for LDAP_REBIND_FUNCTION... 0
> > checking for LDAP_URL_LUD_SCHEME... 0
> > checking for ldapssl_client_init in -lldap... no
> > checking for library containing ldap_url_desc2str... -lldap
> > checking for library containing ldap_url_parse... none required
> > checking for library containing ldap_start_tls_s... none required
> > configure: checking auth/basic helpers: LDAP SMB SMB_LM
> > checking for ldap.h... (cached) yes
> > checking winldap.h usability... no
> > checking winldap.h presence... no
> > checking for winldap.h... no
> > configure: auth/basic helpers to be built:  LDAP SMB SMB_LM
> > configure: checking auth/digest helpers: LDAP eDirectory file
> > checking for ldap.h... (cached) yes
> > checking for winldap.h... (cached) no
> > checking for ldap.h... (cached) yes
> > checking for winldap.h... (cached) no
> > configure: auth/digest helpers to be built:  LDAP eDirectory file
> > configure: checking acl/external helpers: kerberos_ldap_group
> wbinfo_group
> > configure: acl/external helpers to be built:  kerberos_ldap_group
> wbinfo_group
> > config.status: creating src/acl/external/kerberos_ldap_group/Makefile
> > config.status: creating src/acl/external/LDAP_group/Makefile
> > config.status: creating src/auth/basic/LDAP/Makefile
> > config.status: creating src/auth/digest/LDAP/Makefile
> > configure: running /bin/sh ./configure --disable-option-checking
> '--prefix=/usr/local/squid'  '--enable-auth-basic=LDAP,SMB,SMB_LM'
> '--enable-auth-negotiate=kerberos,wrapper' '--enable-auth-ntlm=SMB_LM'
> '--enable-external-acl-helpers=kerberos_ldap_group,wbinfo_group'
> --cache-file=/dev/null --srcdir=.
> >
> >
> > Kind regards,
> >      Ankor.
> >
> >
> >
> >
> >
> > ??, 15 ???. 2025??. ? 06:05, Andrey K <ankor2023 at gmail.com>:
> >>
> >> Hello, Francesco,
> >>
> >> Thank you for the help.
> >>
> >> Full logs of the configure command are available at the link:
> https://drive.google.com/file/d/1wxAmtK2PDTuS41vvM0kuAS-1TtlzZKFl/view?usp=sharing
> >>
> >> Here is a short excerpt on the LDAP filter:
> >> cat /tmp/configure.log | grep -i ldap
> >> checking for LIBLDAP... no
> >> checking for ldap.h... yes
> >> checking for mozldap/ldap.h... no
> >> checking for LDAP... 1
> >> checking for OpenLDAP... 1
> >> checking for Sun LDAP SDK... 0
> >> checking for Mozilla LDAP SDK... 0
> >> checking for LDAP_OPT_DEBUG_LEVEL... 1
> >> checking for LDAP_SCOPE_DEFAULT... 1
> >> checking for LDAP_REBIND_PROC... 1
> >> checking for LDAP_REBINDPROC_CALLBACK... 0
> >> checking for LDAP_REBIND_FUNCTION... 0
> >> checking for LDAP_URL_LUD_SCHEME... 0
> >> checking for ldapssl_client_init in -lldap... no
> >> checking for library containing ldap_url_desc2str... no
> >> checking for library containing ldap_url_parse... no
> >> checking for library containing ldap_start_tls_s... no
> >> configure: Library 'ldap' support: no (auto)
> >> configure: checking auth/basic helpers: LDAP SMB SMB_LM
> >> configure: error: required helper auth/basic/LDAP ... found but cannot
> be built
> >>
> >> Kind regards,
> >>       Ankor.
> >>
> >>
> >> ??, 14 ???. 2025??. ? 18:10, Francesco Chemolli <gkinkie at gmail.com>:
> >>>
> >>> Hi Ankor,
> >>>   it's really hard to help you with this little context. The main
> >>> reason why both these helpers may fail to build is because the LDAP
> >>> libraries were not found on the system. Would you mind running on your
> >>> system:
> >>>
> >>> $ ./configure --enable-auth-basic=LDAP,SMB,SMB_LM
> >>> --enable-auth-negotiate=kerberos,wrapper --enable-auth-ntlm=SMB_LM
> >>> --enable-external-acl-helpers=kerberos_ldap_group,wbinfo_group
> >>> >/tmp/configure.log 2>&1 && grep -i ldap /tmp/configure.log
> >>>
> >>> and sharing the output from that command?
> >>>
> >>> On Mon, Jul 14, 2025 at 10:38?AM Andrey K <ankor2023 at gmail.com> wrote:
> >>> >
> >>> > Hello,
> >>> >
> >>> > I tried to build squid-7.0.2, but ./configure failed if I use:
> >>> > --enable-auth-basic=LDAP,SMB,SMB_LM
> --enable-auth-negotiate=kerberos,wrapper --enable-auth-ntlm=SMB_LM
> --enable-external-acl-helpers=kerberos_ldap_group,wbinfo_group
> >>> >
> >>> > configure: Authentication support enabled: yes
> >>> > configure: checking auth/basic helpers: LDAP SMB SMB_LM
> >>> > configure: error: required helper auth/basic/LDAP ... found but
> cannot be built
> >>> >
> >>> > configure: checking acl/external helpers: kerberos_ldap_group
> wbinfo_group
> >>> > configure: error: required helper acl/external/kerberos_ldap_group
> ... found but cannot be built
> >>> >
> >>> > When I remove the LDAP and kerberos_ldap_group options,  ./configure
> passes smoothly.
> >>> >
> >>> > I did not observe a similar problem in the Squid-6.
> >>> >
> >>> > I am building Squid on an OEL-8 Linux with installed openldap-devel
> and openldap packages.
> >>> >
> >>> > Kind regards,
> >>> >      Ankor.
> >>> >
> >>> >
> >>> >
> >>> > _______________________________________________
> >>> > squid-users mailing list
> >>> > squid-users at lists.squid-cache.org
> >>> > https://lists.squid-cache.org/listinfo/squid-users
> >>>
> >>>
> >>>
> >>> --
> >>>     Francesco
>
>
>
> --
>     Francesco
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20250715/f3f26955/attachment-0001.htm>

From ankor2023 at gmail.com  Tue Jul 15 10:26:47 2025
From: ankor2023 at gmail.com (Andrey K)
Date: Tue, 15 Jul 2025 13:26:47 +0300
Subject: [squid-users] squid-7.0.2 can't configure with LDAP-helpers
In-Reply-To: <CADJd0Y3R2Hu0soXCqn0fccp2zs5dv4S7a6i=w8LAmNkUN+2TjA@mail.gmail.com>
References: <CADJd0Y14tk42W4nDkTpcraJ1Ucru_oWEXVbo5BiYXnDsNL_SbA@mail.gmail.com>
 <CA+Y8hcOtak4Ka_6CXNv1s1iv1tdS8G4idROS-v_2vhXV=qLp+Q@mail.gmail.com>
 <CADJd0Y0RRwY8TLhcB4quuTc7mFbOHomupMugFX1XS+Usx_eYXA@mail.gmail.com>
 <CADJd0Y2oP9++qdw99kgJYHWs_4T8RApUnjj2C1pRmqYb-C-Row@mail.gmail.com>
 <CA+Y8hcMuZZq9re7jML-dyUNmLE4Fb-ZK3FNJQdUoM1XR6g=pPQ@mail.gmail.com>
 <CADJd0Y3R2Hu0soXCqn0fccp2zs5dv4S7a6i=w8LAmNkUN+2TjA@mail.gmail.com>
Message-ID: <CADJd0Y3-SQQZ9uQ5V+vxc7-As5Xya5edLWVe53+j7nXLS_LALw@mail.gmail.com>

Hello, Francesco,

I found that ldap.pc has been added to the openldap package since version
2.5.
Should I manually add the file from version 2.6 to my host?

Kind regards,
    Ankor.

??, 15 ???. 2025??. ? 12:41, Andrey K <ankor2023 at gmail.com>:

> Hello, Francesco,
>
> The output of the command:
> pkg-config --libs ldap
> Package ldap was not found in the pkg-config search path.
> Perhaps you should add the directory containing `ldap.pc'
> to the PKG_CONFIG_PATH environment variable
> Package 'ldap', required by 'virtual:world', not found
>
> However, the libldap is installed in the system as a part of the openldap
> package:
> locate libldap
> /usr/lib64/libldap-2.4.so.2
> /usr/lib64/libldap-2.4.so.2.10.9
> /usr/lib64/libldap.so
> /usr/lib64/libldap_r-2.4.so.2
> /usr/lib64/libldap_r-2.4.so.2.10.9
> /usr/lib64/libldap_r.so
>
> There is no ldap.pc file in the standard OEL openldap packages:
> openldap-devel-2.4.46-18.el8.x86_64
> openldap-2.4.46-18.el8.x86_64
>
>
> Kind regards,
>     Ankor
>
>
>
> ??, 15 ???. 2025??. ? 10:42, Francesco Chemolli <gkinkie at gmail.com>:
>
>> Hi Andrey,
>>   looking at the code changes, the main reason I can see is that
>> pkg-config needs to be present and working in order to Squid the
>> libraries it needs.
>> Could you try running
>>
>> pkg-config --libs ldap
>>
>> on your system?
>>
>> On Tue, Jul 15, 2025 at 7:13?AM Andrey K <ankor2023 at gmail.com> wrote:
>> >
>> > Hello, Francesco,
>> >
>> > I have also run a configure script with the same arguments on the Squid
>> 6.13 sources.
>> > It finished without errors.
>> >
>> > The link to the 6.13 logs:
>> https://drive.google.com/file/d/16DY4uCM5cAbsNC8NcaoM8YB6GT8oUW3-/view?usp=sharing
>> > The excerpt on the LDAP filter:
>> >
>> > grep -i ldap /tmp/configure.6.13.log
>> > checking for LIBLDAP... no
>> > checking for ldap_init in -lldap... yes
>> > checking ldap.h usability... yes
>> > checking ldap.h presence... yes
>> > checking for ldap.h... yes
>> > checking mozldap/ldap.h usability... no
>> > checking mozldap/ldap.h presence... no
>> > checking for mozldap/ldap.h... no
>> > checking for LDAP... 1
>> > checking for OpenLDAP... 1
>> > checking for Sun LDAP SDK... 0
>> > checking for Mozilla LDAP SDK... 0
>> > checking for LDAP_OPT_DEBUG_LEVEL... 1
>> > checking for LDAP_SCOPE_DEFAULT... 1
>> > checking for LDAP_REBIND_PROC... 1
>> > checking for LDAP_REBINDPROC_CALLBACK... 0
>> > checking for LDAP_REBIND_FUNCTION... 0
>> > checking for LDAP_URL_LUD_SCHEME... 0
>> > checking for ldapssl_client_init in -lldap... no
>> > checking for library containing ldap_url_desc2str... -lldap
>> > checking for library containing ldap_url_parse... none required
>> > checking for library containing ldap_start_tls_s... none required
>> > configure: checking auth/basic helpers: LDAP SMB SMB_LM
>> > checking for ldap.h... (cached) yes
>> > checking winldap.h usability... no
>> > checking winldap.h presence... no
>> > checking for winldap.h... no
>> > configure: auth/basic helpers to be built:  LDAP SMB SMB_LM
>> > configure: checking auth/digest helpers: LDAP eDirectory file
>> > checking for ldap.h... (cached) yes
>> > checking for winldap.h... (cached) no
>> > checking for ldap.h... (cached) yes
>> > checking for winldap.h... (cached) no
>> > configure: auth/digest helpers to be built:  LDAP eDirectory file
>> > configure: checking acl/external helpers: kerberos_ldap_group
>> wbinfo_group
>> > configure: acl/external helpers to be built:  kerberos_ldap_group
>> wbinfo_group
>> > config.status: creating src/acl/external/kerberos_ldap_group/Makefile
>> > config.status: creating src/acl/external/LDAP_group/Makefile
>> > config.status: creating src/auth/basic/LDAP/Makefile
>> > config.status: creating src/auth/digest/LDAP/Makefile
>> > configure: running /bin/sh ./configure --disable-option-checking
>> '--prefix=/usr/local/squid'  '--enable-auth-basic=LDAP,SMB,SMB_LM'
>> '--enable-auth-negotiate=kerberos,wrapper' '--enable-auth-ntlm=SMB_LM'
>> '--enable-external-acl-helpers=kerberos_ldap_group,wbinfo_group'
>> --cache-file=/dev/null --srcdir=.
>> >
>> >
>> > Kind regards,
>> >      Ankor.
>> >
>> >
>> >
>> >
>> >
>> > ??, 15 ???. 2025??. ? 06:05, Andrey K <ankor2023 at gmail.com>:
>> >>
>> >> Hello, Francesco,
>> >>
>> >> Thank you for the help.
>> >>
>> >> Full logs of the configure command are available at the link:
>> https://drive.google.com/file/d/1wxAmtK2PDTuS41vvM0kuAS-1TtlzZKFl/view?usp=sharing
>> >>
>> >> Here is a short excerpt on the LDAP filter:
>> >> cat /tmp/configure.log | grep -i ldap
>> >> checking for LIBLDAP... no
>> >> checking for ldap.h... yes
>> >> checking for mozldap/ldap.h... no
>> >> checking for LDAP... 1
>> >> checking for OpenLDAP... 1
>> >> checking for Sun LDAP SDK... 0
>> >> checking for Mozilla LDAP SDK... 0
>> >> checking for LDAP_OPT_DEBUG_LEVEL... 1
>> >> checking for LDAP_SCOPE_DEFAULT... 1
>> >> checking for LDAP_REBIND_PROC... 1
>> >> checking for LDAP_REBINDPROC_CALLBACK... 0
>> >> checking for LDAP_REBIND_FUNCTION... 0
>> >> checking for LDAP_URL_LUD_SCHEME... 0
>> >> checking for ldapssl_client_init in -lldap... no
>> >> checking for library containing ldap_url_desc2str... no
>> >> checking for library containing ldap_url_parse... no
>> >> checking for library containing ldap_start_tls_s... no
>> >> configure: Library 'ldap' support: no (auto)
>> >> configure: checking auth/basic helpers: LDAP SMB SMB_LM
>> >> configure: error: required helper auth/basic/LDAP ... found but cannot
>> be built
>> >>
>> >> Kind regards,
>> >>       Ankor.
>> >>
>> >>
>> >> ??, 14 ???. 2025??. ? 18:10, Francesco Chemolli <gkinkie at gmail.com>:
>> >>>
>> >>> Hi Ankor,
>> >>>   it's really hard to help you with this little context. The main
>> >>> reason why both these helpers may fail to build is because the LDAP
>> >>> libraries were not found on the system. Would you mind running on your
>> >>> system:
>> >>>
>> >>> $ ./configure --enable-auth-basic=LDAP,SMB,SMB_LM
>> >>> --enable-auth-negotiate=kerberos,wrapper --enable-auth-ntlm=SMB_LM
>> >>> --enable-external-acl-helpers=kerberos_ldap_group,wbinfo_group
>> >>> >/tmp/configure.log 2>&1 && grep -i ldap /tmp/configure.log
>> >>>
>> >>> and sharing the output from that command?
>> >>>
>> >>> On Mon, Jul 14, 2025 at 10:38?AM Andrey K <ankor2023 at gmail.com>
>> wrote:
>> >>> >
>> >>> > Hello,
>> >>> >
>> >>> > I tried to build squid-7.0.2, but ./configure failed if I use:
>> >>> > --enable-auth-basic=LDAP,SMB,SMB_LM
>> --enable-auth-negotiate=kerberos,wrapper --enable-auth-ntlm=SMB_LM
>> --enable-external-acl-helpers=kerberos_ldap_group,wbinfo_group
>> >>> >
>> >>> > configure: Authentication support enabled: yes
>> >>> > configure: checking auth/basic helpers: LDAP SMB SMB_LM
>> >>> > configure: error: required helper auth/basic/LDAP ... found but
>> cannot be built
>> >>> >
>> >>> > configure: checking acl/external helpers: kerberos_ldap_group
>> wbinfo_group
>> >>> > configure: error: required helper acl/external/kerberos_ldap_group
>> ... found but cannot be built
>> >>> >
>> >>> > When I remove the LDAP and kerberos_ldap_group options,
>> ./configure passes smoothly.
>> >>> >
>> >>> > I did not observe a similar problem in the Squid-6.
>> >>> >
>> >>> > I am building Squid on an OEL-8 Linux with installed openldap-devel
>> and openldap packages.
>> >>> >
>> >>> > Kind regards,
>> >>> >      Ankor.
>> >>> >
>> >>> >
>> >>> >
>> >>> > _______________________________________________
>> >>> > squid-users mailing list
>> >>> > squid-users at lists.squid-cache.org
>> >>> > https://lists.squid-cache.org/listinfo/squid-users
>> >>>
>> >>>
>> >>>
>> >>> --
>> >>>     Francesco
>>
>>
>>
>> --
>>     Francesco
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20250715/a709356a/attachment.htm>

From ankor2023 at gmail.com  Tue Jul 15 10:49:02 2025
From: ankor2023 at gmail.com (Andrey K)
Date: Tue, 15 Jul 2025 13:49:02 +0300
Subject: [squid-users] squid-7.0.2 can't configure with LDAP-helpers
In-Reply-To: <CADJd0Y3-SQQZ9uQ5V+vxc7-As5Xya5edLWVe53+j7nXLS_LALw@mail.gmail.com>
References: <CADJd0Y14tk42W4nDkTpcraJ1Ucru_oWEXVbo5BiYXnDsNL_SbA@mail.gmail.com>
 <CA+Y8hcOtak4Ka_6CXNv1s1iv1tdS8G4idROS-v_2vhXV=qLp+Q@mail.gmail.com>
 <CADJd0Y0RRwY8TLhcB4quuTc7mFbOHomupMugFX1XS+Usx_eYXA@mail.gmail.com>
 <CADJd0Y2oP9++qdw99kgJYHWs_4T8RApUnjj2C1pRmqYb-C-Row@mail.gmail.com>
 <CA+Y8hcMuZZq9re7jML-dyUNmLE4Fb-ZK3FNJQdUoM1XR6g=pPQ@mail.gmail.com>
 <CADJd0Y3R2Hu0soXCqn0fccp2zs5dv4S7a6i=w8LAmNkUN+2TjA@mail.gmail.com>
 <CADJd0Y3-SQQZ9uQ5V+vxc7-As5Xya5edLWVe53+j7nXLS_LALw@mail.gmail.com>
Message-ID: <CADJd0Y0qGWfB_XZ+iE6dKso3-6jGSgbLKc0yz-DY60M1HUu_Jw@mail.gmail.com>

Hello, Francesco,

I created two files manually:
*cat /usr/lib64/pkgconfig/ldap.pc*
prefix=/usr
exec_prefix=/usr
includedir=/usr/include
libdir=/usr/lib64

Name: ldap (OpenLDAP)
Description: OpenLDAP Lightweight Directory Access Protocol library
URL: https://www.openldap.org
Version: 2.4.46
Requires: lber
Cflags: -I${includedir}
Libs: -L${libdir} -lldap
Libs.private: -levent  -lsasl2 -lssl -lcrypto


*cat /usr/lib64/pkgconfig/lber.pc*
prefix=/usr
exec_prefix=/usr
includedir=/usr/include
libdir=/usr/lib64

Name: lber (OpenLDAP)
Description: OpenLDAP Lightweight ASN.1 Basic Encoding Rules library
URL: https://www.openldap.org
Version: 2.4.46
Cflags: -I${includedir}
Libs: -L${libdir} -llber
Libs.private: -levent


Now the configure script works well.

Thank you for the help.

Kind regards,
      Ankor.




??, 15 ???. 2025??. ? 13:26, Andrey K <ankor2023 at gmail.com>:

> Hello, Francesco,
>
> I found that ldap.pc has been added to the openldap package since version
> 2.5.
> Should I manually add the file from version 2.6 to my host?
>
> Kind regards,
>     Ankor.
>
> ??, 15 ???. 2025??. ? 12:41, Andrey K <ankor2023 at gmail.com>:
>
>> Hello, Francesco,
>>
>> The output of the command:
>> pkg-config --libs ldap
>> Package ldap was not found in the pkg-config search path.
>> Perhaps you should add the directory containing `ldap.pc'
>> to the PKG_CONFIG_PATH environment variable
>> Package 'ldap', required by 'virtual:world', not found
>>
>> However, the libldap is installed in the system as a part of the openldap
>> package:
>> locate libldap
>> /usr/lib64/libldap-2.4.so.2
>> /usr/lib64/libldap-2.4.so.2.10.9
>> /usr/lib64/libldap.so
>> /usr/lib64/libldap_r-2.4.so.2
>> /usr/lib64/libldap_r-2.4.so.2.10.9
>> /usr/lib64/libldap_r.so
>>
>> There is no ldap.pc file in the standard OEL openldap packages:
>> openldap-devel-2.4.46-18.el8.x86_64
>> openldap-2.4.46-18.el8.x86_64
>>
>>
>> Kind regards,
>>     Ankor
>>
>>
>>
>> ??, 15 ???. 2025??. ? 10:42, Francesco Chemolli <gkinkie at gmail.com>:
>>
>>> Hi Andrey,
>>>   looking at the code changes, the main reason I can see is that
>>> pkg-config needs to be present and working in order to Squid the
>>> libraries it needs.
>>> Could you try running
>>>
>>> pkg-config --libs ldap
>>>
>>> on your system?
>>>
>>> On Tue, Jul 15, 2025 at 7:13?AM Andrey K <ankor2023 at gmail.com> wrote:
>>> >
>>> > Hello, Francesco,
>>> >
>>> > I have also run a configure script with the same arguments on the
>>> Squid 6.13 sources.
>>> > It finished without errors.
>>> >
>>> > The link to the 6.13 logs:
>>> https://drive.google.com/file/d/16DY4uCM5cAbsNC8NcaoM8YB6GT8oUW3-/view?usp=sharing
>>> > The excerpt on the LDAP filter:
>>> >
>>> > grep -i ldap /tmp/configure.6.13.log
>>> > checking for LIBLDAP... no
>>> > checking for ldap_init in -lldap... yes
>>> > checking ldap.h usability... yes
>>> > checking ldap.h presence... yes
>>> > checking for ldap.h... yes
>>> > checking mozldap/ldap.h usability... no
>>> > checking mozldap/ldap.h presence... no
>>> > checking for mozldap/ldap.h... no
>>> > checking for LDAP... 1
>>> > checking for OpenLDAP... 1
>>> > checking for Sun LDAP SDK... 0
>>> > checking for Mozilla LDAP SDK... 0
>>> > checking for LDAP_OPT_DEBUG_LEVEL... 1
>>> > checking for LDAP_SCOPE_DEFAULT... 1
>>> > checking for LDAP_REBIND_PROC... 1
>>> > checking for LDAP_REBINDPROC_CALLBACK... 0
>>> > checking for LDAP_REBIND_FUNCTION... 0
>>> > checking for LDAP_URL_LUD_SCHEME... 0
>>> > checking for ldapssl_client_init in -lldap... no
>>> > checking for library containing ldap_url_desc2str... -lldap
>>> > checking for library containing ldap_url_parse... none required
>>> > checking for library containing ldap_start_tls_s... none required
>>> > configure: checking auth/basic helpers: LDAP SMB SMB_LM
>>> > checking for ldap.h... (cached) yes
>>> > checking winldap.h usability... no
>>> > checking winldap.h presence... no
>>> > checking for winldap.h... no
>>> > configure: auth/basic helpers to be built:  LDAP SMB SMB_LM
>>> > configure: checking auth/digest helpers: LDAP eDirectory file
>>> > checking for ldap.h... (cached) yes
>>> > checking for winldap.h... (cached) no
>>> > checking for ldap.h... (cached) yes
>>> > checking for winldap.h... (cached) no
>>> > configure: auth/digest helpers to be built:  LDAP eDirectory file
>>> > configure: checking acl/external helpers: kerberos_ldap_group
>>> wbinfo_group
>>> > configure: acl/external helpers to be built:  kerberos_ldap_group
>>> wbinfo_group
>>> > config.status: creating src/acl/external/kerberos_ldap_group/Makefile
>>> > config.status: creating src/acl/external/LDAP_group/Makefile
>>> > config.status: creating src/auth/basic/LDAP/Makefile
>>> > config.status: creating src/auth/digest/LDAP/Makefile
>>> > configure: running /bin/sh ./configure --disable-option-checking
>>> '--prefix=/usr/local/squid'  '--enable-auth-basic=LDAP,SMB,SMB_LM'
>>> '--enable-auth-negotiate=kerberos,wrapper' '--enable-auth-ntlm=SMB_LM'
>>> '--enable-external-acl-helpers=kerberos_ldap_group,wbinfo_group'
>>> --cache-file=/dev/null --srcdir=.
>>> >
>>> >
>>> > Kind regards,
>>> >      Ankor.
>>> >
>>> >
>>> >
>>> >
>>> >
>>> > ??, 15 ???. 2025??. ? 06:05, Andrey K <ankor2023 at gmail.com>:
>>> >>
>>> >> Hello, Francesco,
>>> >>
>>> >> Thank you for the help.
>>> >>
>>> >> Full logs of the configure command are available at the link:
>>> https://drive.google.com/file/d/1wxAmtK2PDTuS41vvM0kuAS-1TtlzZKFl/view?usp=sharing
>>> >>
>>> >> Here is a short excerpt on the LDAP filter:
>>> >> cat /tmp/configure.log | grep -i ldap
>>> >> checking for LIBLDAP... no
>>> >> checking for ldap.h... yes
>>> >> checking for mozldap/ldap.h... no
>>> >> checking for LDAP... 1
>>> >> checking for OpenLDAP... 1
>>> >> checking for Sun LDAP SDK... 0
>>> >> checking for Mozilla LDAP SDK... 0
>>> >> checking for LDAP_OPT_DEBUG_LEVEL... 1
>>> >> checking for LDAP_SCOPE_DEFAULT... 1
>>> >> checking for LDAP_REBIND_PROC... 1
>>> >> checking for LDAP_REBINDPROC_CALLBACK... 0
>>> >> checking for LDAP_REBIND_FUNCTION... 0
>>> >> checking for LDAP_URL_LUD_SCHEME... 0
>>> >> checking for ldapssl_client_init in -lldap... no
>>> >> checking for library containing ldap_url_desc2str... no
>>> >> checking for library containing ldap_url_parse... no
>>> >> checking for library containing ldap_start_tls_s... no
>>> >> configure: Library 'ldap' support: no (auto)
>>> >> configure: checking auth/basic helpers: LDAP SMB SMB_LM
>>> >> configure: error: required helper auth/basic/LDAP ... found but
>>> cannot be built
>>> >>
>>> >> Kind regards,
>>> >>       Ankor.
>>> >>
>>> >>
>>> >> ??, 14 ???. 2025??. ? 18:10, Francesco Chemolli <gkinkie at gmail.com>:
>>> >>>
>>> >>> Hi Ankor,
>>> >>>   it's really hard to help you with this little context. The main
>>> >>> reason why both these helpers may fail to build is because the LDAP
>>> >>> libraries were not found on the system. Would you mind running on
>>> your
>>> >>> system:
>>> >>>
>>> >>> $ ./configure --enable-auth-basic=LDAP,SMB,SMB_LM
>>> >>> --enable-auth-negotiate=kerberos,wrapper --enable-auth-ntlm=SMB_LM
>>> >>> --enable-external-acl-helpers=kerberos_ldap_group,wbinfo_group
>>> >>> >/tmp/configure.log 2>&1 && grep -i ldap /tmp/configure.log
>>> >>>
>>> >>> and sharing the output from that command?
>>> >>>
>>> >>> On Mon, Jul 14, 2025 at 10:38?AM Andrey K <ankor2023 at gmail.com>
>>> wrote:
>>> >>> >
>>> >>> > Hello,
>>> >>> >
>>> >>> > I tried to build squid-7.0.2, but ./configure failed if I use:
>>> >>> > --enable-auth-basic=LDAP,SMB,SMB_LM
>>> --enable-auth-negotiate=kerberos,wrapper --enable-auth-ntlm=SMB_LM
>>> --enable-external-acl-helpers=kerberos_ldap_group,wbinfo_group
>>> >>> >
>>> >>> > configure: Authentication support enabled: yes
>>> >>> > configure: checking auth/basic helpers: LDAP SMB SMB_LM
>>> >>> > configure: error: required helper auth/basic/LDAP ... found but
>>> cannot be built
>>> >>> >
>>> >>> > configure: checking acl/external helpers: kerberos_ldap_group
>>> wbinfo_group
>>> >>> > configure: error: required helper acl/external/kerberos_ldap_group
>>> ... found but cannot be built
>>> >>> >
>>> >>> > When I remove the LDAP and kerberos_ldap_group options,
>>> ./configure passes smoothly.
>>> >>> >
>>> >>> > I did not observe a similar problem in the Squid-6.
>>> >>> >
>>> >>> > I am building Squid on an OEL-8 Linux with installed
>>> openldap-devel and openldap packages.
>>> >>> >
>>> >>> > Kind regards,
>>> >>> >      Ankor.
>>> >>> >
>>> >>> >
>>> >>> >
>>> >>> > _______________________________________________
>>> >>> > squid-users mailing list
>>> >>> > squid-users at lists.squid-cache.org
>>> >>> > https://lists.squid-cache.org/listinfo/squid-users
>>> >>>
>>> >>>
>>> >>>
>>> >>> --
>>> >>>     Francesco
>>>
>>>
>>>
>>> --
>>>     Francesco
>>>
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20250715/d6c32ac0/attachment-0001.htm>

From squid3 at treenet.co.nz  Tue Jul 15 10:58:40 2025
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 15 Jul 2025 22:58:40 +1200
Subject: [squid-users] squid-7.0.2 can't configure with LDAP-helpers
In-Reply-To: <CADJd0Y3R2Hu0soXCqn0fccp2zs5dv4S7a6i=w8LAmNkUN+2TjA@mail.gmail.com>
References: <CADJd0Y14tk42W4nDkTpcraJ1Ucru_oWEXVbo5BiYXnDsNL_SbA@mail.gmail.com>
 <CA+Y8hcOtak4Ka_6CXNv1s1iv1tdS8G4idROS-v_2vhXV=qLp+Q@mail.gmail.com>
 <CADJd0Y0RRwY8TLhcB4quuTc7mFbOHomupMugFX1XS+Usx_eYXA@mail.gmail.com>
 <CADJd0Y2oP9++qdw99kgJYHWs_4T8RApUnjj2C1pRmqYb-C-Row@mail.gmail.com>
 <CA+Y8hcMuZZq9re7jML-dyUNmLE4Fb-ZK3FNJQdUoM1XR6g=pPQ@mail.gmail.com>
 <CADJd0Y3R2Hu0soXCqn0fccp2zs5dv4S7a6i=w8LAmNkUN+2TjA@mail.gmail.com>
Message-ID: <b27f4fef-6fbd-49b8-86f1-b2492b355c1f@treenet.co.nz>

On 15/07/25 21:41, Andrey K wrote:
> Hello, Francesco,
> 
> The output of the command:
> pkg-config --libs ldap
> Package ldap was not found in the pkg-config search path.
> Perhaps you should add the directory containing `ldap.pc'
> to the PKG_CONFIG_PATH environment variable
> Package 'ldap', required by 'virtual:world', not found
> 
> However, the libldap is installed in the system as a part of the 
> openldap package:
> locate libldap
> /usr/lib64/libldap-2.4.so.2
> /usr/lib64/libldap-2.4.so.2.10.9
> /usr/lib64/libldap.so
> /usr/lib64/libldap_r-2.4.so.2
> /usr/lib64/libldap_r-2.4.so.2.10.9
> /usr/lib64/libldap_r.so
> 
> There is no?ldap.pc file in the standard OEL openldap packages:
> openldap-devel-2.4.46-18.el8.x86_64
> openldap-2.4.46-18.el8.x86_64
> 

I think the issue is that the ldap.pc was added in openldap 2.5. Your 
version is just a bit older.


This build option should work for your older OpenLDAP install:

   ./configure --with-ldap=/usr


Cheers
Amos


From ankor2023 at gmail.com  Tue Jul 15 11:28:37 2025
From: ankor2023 at gmail.com (Andrey K)
Date: Tue, 15 Jul 2025 14:28:37 +0300
Subject: [squid-users] squid-7.0.2 can't configure with LDAP-helpers
In-Reply-To: <b27f4fef-6fbd-49b8-86f1-b2492b355c1f@treenet.co.nz>
References: <CADJd0Y14tk42W4nDkTpcraJ1Ucru_oWEXVbo5BiYXnDsNL_SbA@mail.gmail.com>
 <CA+Y8hcOtak4Ka_6CXNv1s1iv1tdS8G4idROS-v_2vhXV=qLp+Q@mail.gmail.com>
 <CADJd0Y0RRwY8TLhcB4quuTc7mFbOHomupMugFX1XS+Usx_eYXA@mail.gmail.com>
 <CADJd0Y2oP9++qdw99kgJYHWs_4T8RApUnjj2C1pRmqYb-C-Row@mail.gmail.com>
 <CA+Y8hcMuZZq9re7jML-dyUNmLE4Fb-ZK3FNJQdUoM1XR6g=pPQ@mail.gmail.com>
 <CADJd0Y3R2Hu0soXCqn0fccp2zs5dv4S7a6i=w8LAmNkUN+2TjA@mail.gmail.com>
 <b27f4fef-6fbd-49b8-86f1-b2492b355c1f@treenet.co.nz>
Message-ID: <CADJd0Y1DtQiRJ2v6Q4Y5b8dF+8gTy5b_RiUDvPAnF4VJ=q8=Jw@mail.gmail.com>

Hello, Amos,

Thank you for the help.

> This build option should work for your older OpenLDAP install:
>
 >  ./configure --with-ldap=/usr

Unfortunately, the trick with the option --with-ldap=/usr doesn't seem to
be working.
I tried:
./configure --enable-auth-basic=LDAP,SMB,SMB_LM
--enable-auth-negotiate=kerberos,wrapper --enable-auth-ntlm=SMB_LM
--enable-external-acl-helpers=kerberos_ldap_group,wbinfo_group
--with-ldap=/usr

./configure --enable-auth-basic=LDAP,SMB,SMB_LM
--enable-auth-negotiate=kerberos,wrapper --enable-auth-ntlm=SMB_LM
--enable-external-acl-helpers=kerberos_ldap_group,wbinfo_group
--with-ldap=/usr/lib64

Kind regards,
     Ankor.



??, 15 ???. 2025??. ? 13:58, Amos Jeffries <squid3 at treenet.co.nz>:

> On 15/07/25 21:41, Andrey K wrote:
> > Hello, Francesco,
> >
> > The output of the command:
> > pkg-config --libs ldap
> > Package ldap was not found in the pkg-config search path.
> > Perhaps you should add the directory containing `ldap.pc'
> > to the PKG_CONFIG_PATH environment variable
> > Package 'ldap', required by 'virtual:world', not found
> >
> > However, the libldap is installed in the system as a part of the
> > openldap package:
> > locate libldap
> > /usr/lib64/libldap-2.4.so.2
> > /usr/lib64/libldap-2.4.so.2.10.9
> > /usr/lib64/libldap.so
> > /usr/lib64/libldap_r-2.4.so.2
> > /usr/lib64/libldap_r-2.4.so.2.10.9
> > /usr/lib64/libldap_r.so
> >
> > There is no ldap.pc file in the standard OEL openldap packages:
> > openldap-devel-2.4.46-18.el8.x86_64
> > openldap-2.4.46-18.el8.x86_64
> >
>
> I think the issue is that the ldap.pc was added in openldap 2.5. Your
> version is just a bit older.
>
>
> This build option should work for your older OpenLDAP install:
>
>    ./configure --with-ldap=/usr
>
>
> Cheers
> Amos
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> https://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20250715/420c40a5/attachment.htm>

From wong237ma at yahoo.com  Fri Jul 18 02:43:39 2025
From: wong237ma at yahoo.com (wong237ma at yahoo.com)
Date: Fri, 18 Jul 2025 02:43:39 +0000 (UTC)
Subject: [squid-users] User got domain login dialog box prompt,
 when number of user more than 250++
In-Reply-To: <c79872ea-d664-4669-8636-75be3fc6b6c0@treenet.co.nz>
References: <2072256482.50777.1749802092237.ref@mail.yahoo.com>
 <2072256482.50777.1749802092237@mail.yahoo.com>
 <730d4b29-07cf-4957-a48b-d50b5e4c3216@treenet.co.nz>
 <1512835743.441693.1750047935683@mail.yahoo.com>
 <a1076844-1c2e-4479-80ad-2a13d997f6a2@treenet.co.nz>
 <1683469084.717849.1750155677332@mail.yahoo.com>
 <c79872ea-d664-4669-8636-75be3fc6b6c0@treenet.co.nz>
Message-ID: <297615008.320512.1752806619032@mail.yahoo.com>

 Hi All,
To who are familiar or experts in squid-cache, Please contact me, I need help to advise on Active Directory Authentication.
Thanks.
    On Thursday, June 19, 2025 at 10:22:45 PM GMT+8, Amos Jeffries <squid3 at treenet.co.nz> wrote:  
 
 On 17/06/25 22:21, wong237ma wrote:
> Hi Amos,
> 
> can help to give configure example for external helper 
> ext_kerberos_ldap_group_acl, since this help is faster compare to 
> ext_wbinfo_group_acl.
> 

Sorry I'm not that familiar with those particular helpers.
Others here may be able to help, or online manuals for them.

Cheers
Amos

_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
https://lists.squid-cache.org/listinfo/squid-users
  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20250718/c0ad407a/attachment.htm>

From jonathanlee571 at gmail.com  Sat Jul 19 06:10:13 2025
From: jonathanlee571 at gmail.com (Jonathan Lee)
Date: Fri, 18 Jul 2025 23:10:13 -0700
Subject: [squid-users] make clean install issue with squid 7
Message-ID: <3875E7CB-A7C3-4932-BF26-6EF661BCD3E4@gmail.com>

Hello fellow Squid community members,

Has anyone seen this before??? I have the packages installed created symbolic links to them created additional info int he makefile to address it and it keeps failing here, any idea what I did wrong?

checking
"whether X509_get0_signature() accepts const parameters"
yes
checking whether the TXT_DB use OPENSSL_PSTRING data member... yes checking whether the squid workaround for buggy versions of sk_OPENSSL_PSTRING_v alue should used... no
checking whether the workaround for OpenSSL IMPLEMENT_LHASH_
macros should used
... yes
configure: OpenSSL library support: yes -Icrypto -lss1
checking tor LibMll_Kkbs... no configure: Library '
mit-krb5' support: no (auto)
?/configure: LIBHEIMDAL_KRB5_PATH+=-L/usr/lib: not found /configure: LIBHEIMDAL_KRB5_CFLAGS+=-I/usr/include: not found checking for LIBHEIMDAL_KRB5... ??
configure: error: Required library 'heimdal-krb5' not found ===) Script "configure" failed unexpectedly
Please report the problem to timp87 at gmail.com maintainer] and attach the
"/usr/ports/www/squid/uork/squid-7.1/config.log" including the output of the failure of your make command. Also, it might be a good idea to provide an overview of all packages installed on your system de.g. a /usr/local/sbin/pkg-static info -g -Ea).
*** Error code 1
Stop.
makel11: stopped in /usr/ports/www/squid
*** Error code 1
Stop.
make: stopped in /usr/ports/www/squid

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20250718/42332916/attachment.htm>

From jonathanlee571 at gmail.com  Sat Jul 19 06:21:44 2025
From: jonathanlee571 at gmail.com (Jonathan Lee)
Date: Fri, 18 Jul 2025 23:21:44 -0700
Subject: [squid-users] make clean install issue with squid 7
In-Reply-To: <3875E7CB-A7C3-4932-BF26-6EF661BCD3E4@gmail.com>
References: <3875E7CB-A7C3-4932-BF26-6EF661BCD3E4@gmail.com>
Message-ID: <710ADBFE-500C-4A25-A529-4E9F1148436F@gmail.com>

Current Issue with my test VM

Goal: Test Squid 7.1 port update (for your PR) on FreeBSD/pfSense build environment.

I switched the distfile to Squid 7.1 (squid-7.1.tar.xz from GitHub).

Normal port patches were broken; you removed some / all of files/.

I reached the configure phase but now configure bombs out on Heimdal (Kerberos) detection:

vbnet

configure: error: Required library 'heimdal-krb5' not found
I installed heimdal and verified:

Headers in /usr/local/include/heimdal/krb5.h

Libraries in /usr/local/lib/heimdal/libkrb5.so

I tried adding CPPFLAGS, LDFLAGS, KRB5_CONFIG, --with-krb5=/usr/local, and even considered symlinks. Still failing.



Root Causes (Likely)

Squid 7.1?s configure expects Heimdal base layout (as on some systems) and doesn?t search the nested /usr/local/include/heimdal.

A FreeBSD port patch previously adjusted detection (now removed).

The environment variables are being overwritten/reset by the ports framework or by a patch/configure macro.

The configure script wants MIT krb5, not Heimdal, but is forcing a Heimdal-style variable path names.

There is a logic mismatch in configure: it tries both MIT and Heimdal probes and mis-parses results because expected macros aren?t defined (look in config.log for failing test programs).


> On Jul 18, 2025, at 23:10, Jonathan Lee <jonathanlee571 at gmail.com> wrote:
> 
> Hello fellow Squid community members,
> 
> Has anyone seen this before??? I have the packages installed created symbolic links to them created additional info int he makefile to address it and it keeps failing here, any idea what I did wrong?
> 
> checking
> "whether X509_get0_signature() accepts const parameters"
> yes
> checking whether the TXT_DB use OPENSSL_PSTRING data member... yes checking whether the squid workaround for buggy versions of sk_OPENSSL_PSTRING_v alue should used... no
> checking whether the workaround for OpenSSL IMPLEMENT_LHASH_
> macros should used
> ... yes
> configure: OpenSSL library support: yes -Icrypto -lss1
> checking tor LibMll_Kkbs... no configure: Library '
> mit-krb5' support: no (auto)
> ?/configure: LIBHEIMDAL_KRB5_PATH+=-L/usr/lib: not found /configure: LIBHEIMDAL_KRB5_CFLAGS+=-I/usr/include: not found checking for LIBHEIMDAL_KRB5... ??
> configure: error: Required library 'heimdal-krb5' not found ===) Script "configure" failed unexpectedly
> Please report the problem to timp87 at gmail.com maintainer] and attach the
> "/usr/ports/www/squid/uork/squid-7.1/config.log" including the output of the failure of your make command. Also, it might be a good idea to provide an overview of all packages installed on your system de.g. a /usr/local/sbin/pkg-static info -g -Ea).
> *** Error code 1
> Stop.
> makel11: stopped in /usr/ports/www/squid
> *** Error code 1
> Stop.
> make: stopped in /usr/ports/www/squid
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20250718/8cd70cc5/attachment-0001.htm>

From squid3 at treenet.co.nz  Sat Jul 19 13:46:40 2025
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sun, 20 Jul 2025 01:46:40 +1200
Subject: [squid-users] make clean install issue with squid 7
In-Reply-To: <710ADBFE-500C-4A25-A529-4E9F1148436F@gmail.com>
References: <3875E7CB-A7C3-4932-BF26-6EF661BCD3E4@gmail.com>
 <710ADBFE-500C-4A25-A529-4E9F1148436F@gmail.com>
Message-ID: <ab575c4c-392d-4b36-ab8e-a811b44a7b29@treenet.co.nz>

On 19/07/25 18:21, Jonathan Lee wrote:
> 
>     I reached the |configure|?phase but now *configure bombs out on
>     Heimdal (Kerberos) detection*:
> 
>     vbnet
> 
>     |configure: error: Required library 'heimdal-krb5' not found |
> 
>   *
> 
>     I installed |heimdal|?and verified:
> 
>         Headers in |/usr/local/include/heimdal/krb5.h|
> 
>         Libraries in |/usr/local/lib/heimdal/libkrb5.so|
> 

Squid now requires pkg-config for autodetection of a lot of libraries.

Does your version of Heimdal provide a *.pc file for pkg-config?

If it does you may need to use something like:

   ./configure PKG_CONFIG_PATH=/usr/local/heimdal/krb5.pc

OR,

   ./configure --with-heimdal-krb5=/usr/local

   This is the intended way going forward.
   But still experimental and YMMV.

OR,

  ./configure \
     CXXFLAGS="-I/usr/local/include" \
     LDFLAGS="-L/usr/local/lib"

OR,

   maybe reduce the ./configure settings to avoid the components that 
make it a requirement (eg the kerberos helpers).


Cheers
Amos


From jonathanlee571 at gmail.com  Sat Jul 19 15:37:07 2025
From: jonathanlee571 at gmail.com (Jonathan Lee)
Date: Sat, 19 Jul 2025 08:37:07 -0700
Subject: [squid-users] make clean install issue with squid 7
In-Reply-To: <ab575c4c-392d-4b36-ab8e-a811b44a7b29@treenet.co.nz>
References: <3875E7CB-A7C3-4932-BF26-6EF661BCD3E4@gmail.com>
 <710ADBFE-500C-4A25-A529-4E9F1148436F@gmail.com>
 <ab575c4c-392d-4b36-ab8e-a811b44a7b29@treenet.co.nz>
Message-ID: <2D945FB6-3C3A-4F31-A139-CDB0E803367F@gmail.com>

I think we found the problem ? the existing ports made heimdal-krb5.pc file has typos and incorrect paths, which is why pkg-config might have issues not working. For example:

libdir=/usr/local/lib/heindal (should be heimdal).

includedir=/usr/local/include/heindal (should be heimdal).

Libs: -L$ilibdirt -1krb5 (typos in $libdir and -lkrb5).

Extra -I flags like -Icom_err which don?t make sense.



> On Jul 19, 2025, at 06:46, Amos Jeffries <squid3 at treenet.co.nz> wrote:
> 
> On 19/07/25 18:21, Jonathan Lee wrote:
>>    I reached the |configure| phase but now *configure bombs out on
>>    Heimdal (Kerberos) detection*:
>>    vbnet
>>    |configure: error: Required library 'heimdal-krb5' not found |
>>  *
>>    I installed |heimdal| and verified:
>>        Headers in |/usr/local/include/heimdal/krb5.h|
>>        Libraries in |/usr/local/lib/heimdal/libkrb5.so|
> 
> Squid now requires pkg-config for autodetection of a lot of libraries.
> 
> Does your version of Heimdal provide a *.pc file for pkg-config?
> 
> If it does you may need to use something like:
> 
>  ./configure PKG_CONFIG_PATH=/usr/local/heimdal/krb5.pc
> 
> OR,
> 
>  ./configure --with-heimdal-krb5=/usr/local
> 
>  This is the intended way going forward.
>  But still experimental and YMMV.
> 
> OR,
> 
> ./configure \
>    CXXFLAGS="-I/usr/local/include" \
>    LDFLAGS="-L/usr/local/lib"
> 
> OR,
> 
>  maybe reduce the ./configure settings to avoid the components that make it a requirement (eg the kerberos helpers).
> 
> 
> Cheers
> Amos
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> https://lists.squid-cache.org/listinfo/squid-users

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20250719/22484c8b/attachment.htm>

From squid3 at treenet.co.nz  Mon Jul 21 00:45:07 2025
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Mon, 21 Jul 2025 12:45:07 +1200
Subject: [squid-users] make clean install issue with squid 7
In-Reply-To: <2D945FB6-3C3A-4F31-A139-CDB0E803367F@gmail.com>
References: <3875E7CB-A7C3-4932-BF26-6EF661BCD3E4@gmail.com>
 <710ADBFE-500C-4A25-A529-4E9F1148436F@gmail.com>
 <ab575c4c-392d-4b36-ab8e-a811b44a7b29@treenet.co.nz>
 <2D945FB6-3C3A-4F31-A139-CDB0E803367F@gmail.com>
Message-ID: <3c6e6dc7-24c4-40f5-9a02-5624f95ee2e3@treenet.co.nz>


On 20/07/25 03:37, Jonathan Lee wrote:
> I think we found the problem ? the existing ports made |heimdal-krb5.pc| 
>  ?file has *typos and incorrect paths*, which is why |pkg-config|?might 
> have issues not?working.


Ouch. Thanks for the feedback, I will add a few checks to our code to 
work around these for next Squid's.


Did you try any of the alternatives I gave and to what results?


Cheers
Amos


From jonathanlee571 at gmail.com  Mon Jul 21 00:59:25 2025
From: jonathanlee571 at gmail.com (Jonathan Lee)
Date: Sun, 20 Jul 2025 17:59:25 -0700
Subject: [squid-users] make clean install issue with squid 7
In-Reply-To: <3c6e6dc7-24c4-40f5-9a02-5624f95ee2e3@treenet.co.nz>
References: <3875E7CB-A7C3-4932-BF26-6EF661BCD3E4@gmail.com>
 <710ADBFE-500C-4A25-A529-4E9F1148436F@gmail.com>
 <ab575c4c-392d-4b36-ab8e-a811b44a7b29@treenet.co.nz>
 <2D945FB6-3C3A-4F31-A139-CDB0E803367F@gmail.com>
 <3c6e6dc7-24c4-40f5-9a02-5624f95ee2e3@treenet.co.nz>
Message-ID: <C0020418-929D-4629-B76A-2447AB10A25B@gmail.com>

sorry that was a typo I am still working on it. I am doing make configure right now 

> On Jul 20, 2025, at 17:45, Amos Jeffries <squid3 at treenet.co.nz> wrote:
> 
> 
> On 20/07/25 03:37, Jonathan Lee wrote:
>> I think we found the problem ? the existing ports made |heimdal-krb5.pc|   file has *typos and incorrect paths*, which is why |pkg-config| might have issues not working.
> 
> 
> Ouch. Thanks for the feedback, I will add a few checks to our code to work around these for next Squid's.
> 
> 
> Did you try any of the alternatives I gave and to what results?
> 
> 
> Cheers
> Amos
> 


From squid3 at treenet.co.nz  Mon Jul 21 03:11:45 2025
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Mon, 21 Jul 2025 15:11:45 +1200
Subject: [squid-users] make clean install issue with squid 7
In-Reply-To: <C0020418-929D-4629-B76A-2447AB10A25B@gmail.com>
References: <3875E7CB-A7C3-4932-BF26-6EF661BCD3E4@gmail.com>
 <710ADBFE-500C-4A25-A529-4E9F1148436F@gmail.com>
 <ab575c4c-392d-4b36-ab8e-a811b44a7b29@treenet.co.nz>
 <2D945FB6-3C3A-4F31-A139-CDB0E803367F@gmail.com>
 <3c6e6dc7-24c4-40f5-9a02-5624f95ee2e3@treenet.co.nz>
 <C0020418-929D-4629-B76A-2447AB10A25B@gmail.com>
Message-ID: <031f6d1c-caa7-45f3-87e3-093f5195615f@treenet.co.nz>

Okay, no worries.

I have opened https://github.com/squid-cache/squid/pull/2123 to 
workaround the issues at our end based upon your feedback so far. The 
diff/patch should work for v7 as well, but requires a full 
./bootstrap.sh on the sources.

HTH
Amos


On 21/07/25 12:59, Jonathan Lee wrote:
> sorry that was a typo I am still working on it. I am doing make configure right now
> 
>> On Jul 20, 2025, at 17:45, Amos Jeffries wrote:
>>
>>
>> On 20/07/25 03:37, Jonathan Lee wrote:
>>> I think we found the problem ? the existing ports made |heimdal-krb5.pc|   file has *typos and incorrect paths*, which is why |pkg-config| might have issues not working.
>>
>>
>> Ouch. Thanks for the feedback, I will add a few checks to our code to work around these for next Squid's.
>>
>>
>> Did you try any of the alternatives I gave and to what results?
>>
>>
>> Cheers
>> Amos
>>
> 


From jonathanlee571 at gmail.com  Mon Jul 21 05:24:39 2025
From: jonathanlee571 at gmail.com (Jonathan Lee)
Date: Sun, 20 Jul 2025 22:24:39 -0700
Subject: [squid-users] make clean install issue with squid 7
In-Reply-To: <031f6d1c-caa7-45f3-87e3-093f5195615f@treenet.co.nz>
References: <031f6d1c-caa7-45f3-87e3-093f5195615f@treenet.co.nz>
Message-ID: <73A20FB6-1998-43A8-8EBB-C4161D4833C2@gmail.com>

Thank you 
Sent from my iPhone

> On Jul 20, 2025, at 20:11, Amos Jeffries <squid3 at treenet.co.nz> wrote:
> 
> ?Okay, no worries.
> 
> I have opened https://github.com/squid-cache/squid/pull/2123 to workaround the issues at our end based upon your feedback so far. The diff/patch should work for v7 as well, but requires a full ./bootstrap.sh on the sources.
> 
> HTH
> Amos
> 
> 
>> On 21/07/25 12:59, Jonathan Lee wrote:
>> sorry that was a typo I am still working on it. I am doing make configure right now
>>>> On Jul 20, 2025, at 17:45, Amos Jeffries wrote:
>>> 
>>> 
>>> On 20/07/25 03:37, Jonathan Lee wrote:
>>>> I think we found the problem ? the existing ports made |heimdal-krb5.pc|   file has *typos and incorrect paths*, which is why |pkg-config| might have issues not working.
>>> 
>>> 
>>> Ouch. Thanks for the feedback, I will add a few checks to our code to work around these for next Squid's.
>>> 
>>> 
>>> Did you try any of the alternatives I gave and to what results?
>>> 
>>> 
>>> Cheers
>>> Amos
>>> 
> 

From jonathanlee571 at gmail.com  Mon Jul 21 05:24:39 2025
From: jonathanlee571 at gmail.com (Jonathan Lee)
Date: Sun, 20 Jul 2025 22:24:39 -0700
Subject: [squid-users] make clean install issue with squid 7
In-Reply-To: <031f6d1c-caa7-45f3-87e3-093f5195615f@treenet.co.nz>
References: <031f6d1c-caa7-45f3-87e3-093f5195615f@treenet.co.nz>
Message-ID: <73A20FB6-1998-43A8-8EBB-C4161D4833C2@gmail.com>

Thank you 
Sent from my iPhone

> On Jul 20, 2025, at 20:11, Amos Jeffries <squid3 at treenet.co.nz> wrote:
> 
> ?Okay, no worries.
> 
> I have opened https://github.com/squid-cache/squid/pull/2123 to workaround the issues at our end based upon your feedback so far. The diff/patch should work for v7 as well, but requires a full ./bootstrap.sh on the sources.
> 
> HTH
> Amos
> 
> 
>> On 21/07/25 12:59, Jonathan Lee wrote:
>> sorry that was a typo I am still working on it. I am doing make configure right now
>>>> On Jul 20, 2025, at 17:45, Amos Jeffries wrote:
>>> 
>>> 
>>> On 20/07/25 03:37, Jonathan Lee wrote:
>>>> I think we found the problem ? the existing ports made |heimdal-krb5.pc|   file has *typos and incorrect paths*, which is why |pkg-config| might have issues not working.
>>> 
>>> 
>>> Ouch. Thanks for the feedback, I will add a few checks to our code to work around these for next Squid's.
>>> 
>>> 
>>> Did you try any of the alternatives I gave and to what results?
>>> 
>>> 
>>> Cheers
>>> Amos
>>> 
> 

From mab_itsystem at machaero.com  Tue Jul 22 12:48:09 2025
From: mab_itsystem at machaero.com (MAB IT System)
Date: Tue, 22 Jul 2025 14:48:09 +0200
Subject: [squid-users] =?utf-8?q?WCCP_and_SSL-Bump_with_Squid_3=2E5_?=
	=?utf-8?q?=E2=80=94_HTTPS_traffic_not_reaching_Squid?=
Message-ID: <CAELz2FYSDAYbDbucTnzigTmQjk8sAXR5qJExkxSA8cpdSzZ+ng@mail.gmail.com>

Hello everyone,

I am currently deploying Squid 3.5.12 on Ubuntu Xenial for URL filtering
over multiple VLANs using WCCP.

*Context:*

   -

   HTTP traffic is successfully redirected from my Cisco router to Squid
   via WCCP (Service 0).
   -

   HTTPS traffic is redirected via WCCP (Service 70), GRE tunnel works,
   redirection appears fine on the router side.
   -

   On my Squid box, iptables properly redirects:
   -

      TCP 80 ? 3127 (intercept)
      -

      TCP 443 ? 3128 (ssl-bump)
      -

   My Squid config listens properly on 3127 and 3128 with ssl-bump.

*Problem:*

   -

   HTTP filtering works perfectly via WCCP.
   -

   HTTPS connections show *no traffic hitting Squid's 3128 port* (confirmed
   via access.log and ss -tulnp).
   -

   Yet WCCP router counters show packets being redirected for HTTPS.
   -

   If I manually configure the proxy on a browser, both HTTP and HTTPS are
   filtered correctly.
   -

   If I disable ssl-bump and WCCP for HTTPS, normal navigation resumes.

*iptables NAT rules:*

REDIRECT tcp -- gre1 * 0.0.0.0/0 0.0.0.0/0 tcp dpt:80 redir ports 3127
REDIRECT tcp -- gre1 * 0.0.0.0/0 0.0.0.0/0 tcp dpt:443 redir ports 3128

Squid config (extract):

  http_port 3127 intercept
http_port 3128 ssl-bump cert=/etc/squid/ssl_sert/myCA.pem
key=/etc/squid/ssl_sert/ca-key.pem generate-host-certificates=on
dynamic_cert_mem_cache_size=4MB
sslcrtd_program /usr/libexec/ssl_crtd -s /var/lib/ssl_db -M 4MB

acl step1 at_step SslBump1
ssl_bump peek step1
ssl_bump bump all

*Questions:*

   1.

   Why does HTTPS via WCCP not reach Squid 3128 (ssl-bump) while HTTP works
   fine?
   2.

   Is my WCCP setup wrong for HTTPS? I use service ID 70 with destination
   port 443.
   3.

   Could the lack of DNS resolution or browser certificate trust cause the
   traffic not to appear at all in Squid logs?
   4.

   Am I missing something obvious between the router WCCP and Squid?s
   ssl-bump setup?

Thank you in advance for any suggestions or troubleshooting steps.

Best regards,

Assoham

-- 
******************************************************************************
The information contained herein may be company confidential and 
proprietary. The information is intended only for the use of the named 
individual or entity. If you are not the intended recipient, the employee 
or agent responsible for delivering it to the intended recipient, you are 
hereby notified that any use, dissemination, distribution or copying of 
this communication is strictly prohibited. If you have received this 
communication in error, please notify the sender (and delete it from your 
systems) immediately. The information herein is not warranted to be free of 
virus or any other defect that may affect the recipient's computer system 
and it is your responsibility to carry out appropriate virus checks of this 
email and attachments (if any).
******************************************************************************
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20250722/c1bc018e/attachment.htm>

From squid3 at treenet.co.nz  Tue Jul 22 14:24:31 2025
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 23 Jul 2025 02:24:31 +1200
Subject: [squid-users] =?utf-8?q?WCCP_and_SSL-Bump_with_Squid_3=2E5_?=
 =?utf-8?q?=E2=80=94_HTTPS_traffic_not_reaching_Squid?=
In-Reply-To: <CAELz2FYSDAYbDbucTnzigTmQjk8sAXR5qJExkxSA8cpdSzZ+ng@mail.gmail.com>
References: <CAELz2FYSDAYbDbucTnzigTmQjk8sAXR5qJExkxSA8cpdSzZ+ng@mail.gmail.com>
Message-ID: <4d29dfee-8447-4652-8181-b56b581038a7@treenet.co.nz>

On 23/07/25 00:48, MAB IT System wrote:
> Hello everyone,
> 
> I am currently deploying Squid 3.5.12 on Ubuntu Xenial for URL filtering 
> over multiple VLANs using WCCP.
> 

Please consider an upgrade. That versino of Squid has been out of 
support for many years now, and even your Ubuntu Xenial is nearing the 
end of their LTS.


> *Context:*
> 
>   *
> 
>     HTTP traffic is successfully redirected from my Cisco router to
>     Squid via WCCP (Service 0).
> 
>   *
> 
>     HTTPS traffic is redirected via WCCP (Service 70), GRE tunnel works,
>     redirection appears fine on the router side.
> 

FWIW, I'm not sure if they need different services. WCCP is just a way 
to automatically manage routing of traffic towards Squid. Since both 
ports are going to the same proxy in theory they should just be diverted 
the same way.


>   *
> 
>     On my Squid box, iptables properly redirects:
> 
>       o
> 
>         TCP 80 ? 3127 (intercept)
> 
>       o
> 
>         TCP 443 ? 3128 (ssl-bump)
> 


That should be "intercept ssl-bump" for NAT intercept + TLS handling


Please consider a different port than 3128 for the HTTPS traffic 
interception. It is a well-known port for Squid and has known malware 
attacks against broken intercept configurations.



> *Problem:*
> 
>   *
> 
>     HTTP filtering works perfectly via WCCP.
> 
>   *
> 
>     HTTPS connections show *no traffic hitting Squid's 3128 port*
>     (confirmed via |access.log| and |ss -tulnp|).
> 
>   *
> 
>     Yet WCCP router counters show packets being redirected for HTTPS.
> 

Are they making it out of the GRE tunnel so iptables can do its NAT thing?


>   *
> 
>     If I manually configure the proxy on a browser, both HTTP and HTTPS
>     are filtered correctly.
> 

That indicates that you are missing the required iptables mangle table 
rules to prevent direct connections from clients to your NAT intercept 
ports. That is a major security vulnerability (CVE-2009-0801).


>   *
> 
>     If I disable ssl-bump and WCCP for HTTPS, normal navigation resumes.
> 
> *iptables NAT rules:*
> 
> REDIRECT tcp -- gre1 * 0.0.0.0/0 0.0.0.0/0 tcp dpt:80 redir ports 3127
> REDIRECT tcp -- gre1 * 0.0.0.0/0 0.0.0.0/0 tcp dpt:443 redir ports 3128
> 

This is not iptables interface syntax, looks like a management tool.
What do these columns mean?


You also seem to be missing MASQUERADE rules to handle the return 
packets SYN+ACK etc. This makes it odd that HTTP was working.



> Squid config (extract):
> 
>  ? http_port 3127 intercept
> 
> http_port 3128 ssl-bump cert=/etc/squid/ssl_sert/myCA.pem key=/etc/ 
> squid/ssl_sert/ca-key.pem generate-host-certificates=on 
> dynamic_cert_mem_cache_size=4MB
> sslcrtd_program /usr/libexec/ssl_crtd -s /var/lib/ssl_db -M 4MB
> 
> acl step1 at_step SslBump1
> ssl_bump peek step1
> ssl_bump bump all
> 

FYI, bump at step2 is quite dangerous. Prefer doing peek-stare-bump for 
the relevant steps 1-2-3. With a whitelist doing splice at step 2 or 3 
for things that you find cannot be bumped.

   acl whitelist ssl_server_name ...
   acl step1 at_step SslBump1
   acl step2 at_step SslBump2

   ssl_bump peek step1
   ssl_bump splice whitelist
   ssl_bump stare step2
   ssl_bump bump all



> *Questions:*
> 
>  1.
> 
>     Why does HTTPS via WCCP not reach Squid 3128 (ssl-bump) while HTTP
>     works fine?
> 

Insufficient details. You will have to do packet traces of what is going 
to through the GRE interface to answer that.


>  2.
> 
>     Is my WCCP setup wrong for HTTPS? I use service ID 70 with
>     destination port 443.
> 

See above. If WCCP is sending the port 443 packets through GRE it is 
fine. If not, then something is broken there.

Though from what you said it seems like the packets are going missing 
somewhere before/after the GRE tunnel.


>  3.
> 
>     Could the lack of DNS resolution or browser certificate trust cause
>     the traffic not to appear at all in Squid logs?
> 

No. In these cases, Squid would still receive the traffic and log errors.


>  4.
> 
>     Am I missing something obvious between the router WCCP and Squid?s
>     ssl-bump setup?
> 
AFAICS the obvious config issues (mentioned above) would not cause 
missing packets.


HTH
Amos

From jonathanlee571 at gmail.com  Tue Jul 22 21:30:51 2025
From: jonathanlee571 at gmail.com (Jonathan Lee)
Date: Tue, 22 Jul 2025 14:30:51 -0700
Subject: [squid-users] make clean install issue with squid 7
In-Reply-To: <73A20FB6-1998-43A8-8EBB-C4161D4833C2@gmail.com>
References: <031f6d1c-caa7-45f3-87e3-093f5195615f@treenet.co.nz>
 <73A20FB6-1998-43A8-8EBB-C4161D4833C2@gmail.com>
Message-ID: <A9D98C34-2D9E-4B53-8978-2324530BCD4B@gmail.com>

Hello fellow Squid users.

Can you please help? I have located a possible issue with Squid 7.X downloaded from the following URL https://github.com/squid-cache/squid/releases/tag/SQUID_7_1 I found is the SMB_LM even when you disable smb with make config it still is listed in the Makefile even with "make rmconfig" it still lists it the make config does not remove the SMB_LM from the Makefile when you run it. 

BASIC_AUTH+=  DB NCSA PAM POPS RADIUS fake getpwnam
I?m attempting to build Squid 7.1 from the FreeBSD ports tree (/usr/ports/www/squid), but the build consistently fails during the configure step with the error:

configure: checking auth/basic helpers: LDAP SASL SMB DB NCSA PAM POP3 RADIUS SMB_LM fake getpwnam NIS
configure: error: SMB_LM not found in ./src/auth/basic
I have installed Samba 4.20 (samba420-4.20.7-7) and confirmed that the required libraries (libsmbclient, etc.) are present. I have also tried disabling the SMB_LM helper via make config (and even using make rmconfig to reset options), but the build process still attempts to compile auth/basic/SMB_LM. Even after editing the Makefile to remove SMB_LM from BASIC_AUTH, the port continues to fail at the configure stage.

It seems the Squid 7.x port is hardcoding SMB_LM support, ignoring the port options. Could this be a bug in the port's Makefile or auth/basic/Makefile.in? My environment is FreeBSD 14.3, and I?ve confirmed that all required dependencies are up to date.

Can you confirm whether the SMB_LM helper is required in Squid 7.1, or if there is a recommended way to disable it for builds that don?t require NTLM/SMB authentication?

It will complete the "make install clean" only if you manually remove the SMB_LM from BASIC_AUTH in the Makefile. 

Jonathan Lee


> On Jul 20, 2025, at 22:24, Jonathan Lee <jonathanlee571 at gmail.com> wrote:
> 
> Thank you 
> Sent from my iPhone
> 
>> On Jul 20, 2025, at 20:11, Amos Jeffries <squid3 at treenet.co.nz> wrote:
>> 
>> ?Okay, no worries.
>> 
>> I have opened https://github.com/squid-cache/squid/pull/2123 to workaround the issues at our end based upon your feedback so far. The diff/patch should work for v7 as well, but requires a full ./bootstrap.sh on the sources.
>> 
>> HTH
>> Amos
>> 
>> 
>>> On 21/07/25 12:59, Jonathan Lee wrote:
>>> sorry that was a typo I am still working on it. I am doing make configure right now
>>>>> On Jul 20, 2025, at 17:45, Amos Jeffries wrote:
>>>> 
>>>> 
>>>> On 20/07/25 03:37, Jonathan Lee wrote:
>>>>> I think we found the problem ? the existing ports made |heimdal-krb5.pc|   file has *typos and incorrect paths*, which is why |pkg-config| might have issues not working.
>>>> 
>>>> 
>>>> Ouch. Thanks for the feedback, I will add a few checks to our code to work around these for next Squid's.
>>>> 
>>>> 
>>>> Did you try any of the alternatives I gave and to what results?
>>>> 
>>>> 
>>>> Cheers
>>>> Amos
>>>> 
>> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20250722/f9ebd05b/attachment-0001.htm>

From gkinkie at gmail.com  Tue Jul 22 21:50:58 2025
From: gkinkie at gmail.com (Francesco Chemolli)
Date: Tue, 22 Jul 2025 23:50:58 +0200
Subject: [squid-users] make clean install issue with squid 7
In-Reply-To: <A9D98C34-2D9E-4B53-8978-2324530BCD4B@gmail.com>
References: <031f6d1c-caa7-45f3-87e3-093f5195615f@treenet.co.nz>
 <73A20FB6-1998-43A8-8EBB-C4161D4833C2@gmail.com>
 <A9D98C34-2D9E-4B53-8978-2324530BCD4B@gmail.com>
Message-ID: <CA+Y8hcNFu8r9yp6UeEVip9h3KLb3NKU-ciFNfO7kYe_hj+z1_w@mail.gmail.com>

On Tue, Jul 22, 2025 at 10:31?PM Jonathan Lee <jonathanlee571 at gmail.com>
wrote:
>
> Hello fellow Squid users.
>
> Can you please help? I have located a possible issue with Squid 7.X
downloaded from the following URL
https://github.com/squid-cache/squid/releases/tag/SQUID_7_1 I found is the
SMB_LM even when you disable smb with make config it still is listed in the
Makefile even with "make rmconfig" it still lists it the make config does
not remove the SMB_LM from the Makefile when you run it.

What file have you downloaded exactly? There's several offered there.

Are you sure you did "make config"? When I try to reproduce I get:

? pwd
/Users/kinkie/src/squid/v7
? make config
make: *** No rule to make target `config'.  Stop.
? make rmconfig
                                                                        2 ?
make: *** No rule to make target `rmconfig'.  Stop.


>
> BASIC_AUTH+=  DB NCSA PAM POPS RADIUS fake getpwnam
>
> I?m attempting to build Squid 7.1 from the FreeBSD ports tree
(/usr/ports/www/squid), but the build consistently fails during the
configure step with the error:
>
> configure: checking auth/basic helpers: LDAP SASL SMB DB NCSA PAM POP3
RADIUS SMB_LM fake getpwnam NIS
> configure: error: SMB_LM not found in ./src/auth/basic

Could it be that the problem is with the freebsd port?
What version of freebsd are you using?  I have recently tested a build on
13.5, 14.2, and 15.0 at
https://github.com/squid-platform-test/squid/actions/runs/16234098625 and
it worked


> I have installed Samba 4.20 (samba420-4.20.7-7) and confirmed that the
required libraries (libsmbclient, etc.) are present. I have also tried
disabling the SMB_LM helper via make config (and even using make rmconfig
to reset options), but the build process still attempts to compile
auth/basic/SMB_LM. Even after editing the Makefile to remove SMB_LM from
BASIC_AUTH, the port continues to fail at the configure stage.

SMB_LM (aka basic_smb_lm_auth) is no longer provided with squid 7.1, from
commit 1ce586101b

> It seems the Squid 7.x port is hardcoding SMB_LM support, ignoring the
port options. Could this be a bug in the port's Makefile or
auth/basic/Makefile.in? My environment is FreeBSD 14.3, and I?ve confirmed
that all required dependencies are up to date.

That?s likely the port?s Makefile hardcoding helpers.

> Can you confirm whether the SMB_LM helper is required in Squid 7.1, or if
there is a recommended way to disable it for builds that don?t require
NTLM/SMB authentication?

It isn?t required. It has been deprecated for a while, in fact

>
> It will complete the "make install clean" only if you manually remove the
SMB_LM from BASIC_AUTH in the Makefile.

Is that the port?s makefile? If so it is indeed a port problem, and the
port?s makefile needs to be updated

>
> Jonathan Lee
>
>
> On Jul 20, 2025, at 22:24, Jonathan Lee <jonathanlee571 at gmail.com> wrote:
>
> Thank you
> Sent from my iPhone
>
> On Jul 20, 2025, at 20:11, Amos Jeffries <squid3 at treenet.co.nz> wrote:
>
> ?Okay, no worries.
>
> I have opened https://github.com/squid-cache/squid/pull/2123 to
workaround the issues at our end based upon your feedback so far. The
diff/patch should work for v7 as well, but requires a full ./bootstrap.sh
on the sources.
>
> HTH
> Amos
>
>
> On 21/07/25 12:59, Jonathan Lee wrote:
> sorry that was a typo I am still working on it. I am doing make configure
right now
>
> On Jul 20, 2025, at 17:45, Amos Jeffries wrote:
>
>
>
> On 20/07/25 03:37, Jonathan Lee wrote:
>
> I think we found the problem ? the existing ports made |heimdal-krb5.pc|
 file has *typos and incorrect paths*, which is why |pkg-config| might have
issues not working.
>
>
>
> Ouch. Thanks for the feedback, I will add a few checks to our code to
work around these for next Squid's.
>
>
> Did you try any of the alternatives I gave and to what results?
>
>
> Cheers
> Amos
>
>
>


-- 
    Francesco
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20250722/4de6c2ae/attachment.htm>

From jonathanlee571 at gmail.com  Tue Jul 22 22:10:06 2025
From: jonathanlee571 at gmail.com (Jonathan Lee)
Date: Tue, 22 Jul 2025 15:10:06 -0700
Subject: [squid-users] make clean install issue with squid 7
In-Reply-To: <CA+Y8hcNFu8r9yp6UeEVip9h3KLb3NKU-ciFNfO7kYe_hj+z1_w@mail.gmail.com>
References: <031f6d1c-caa7-45f3-87e3-093f5195615f@treenet.co.nz>
 <73A20FB6-1998-43A8-8EBB-C4161D4833C2@gmail.com>
 <A9D98C34-2D9E-4B53-8978-2324530BCD4B@gmail.com>
 <CA+Y8hcNFu8r9yp6UeEVip9h3KLb3NKU-ciFNfO7kYe_hj+z1_w@mail.gmail.com>
Message-ID: <30D4D48F-6009-4ABD-B3EE-6AF6911B953E@gmail.com>

https://github.com/squid-cache/squid/releases/download/SQUID_7_1/squid-7.1.tar.xz

Yes I have done the make config it is building fully now only after I manually adapted the Makefile make config would not fix the issue with SMB

> On Jul 22, 2025, at 14:50, Francesco Chemolli <gkinkie at gmail.com> wrote:
> 
> 
> 
> On Tue, Jul 22, 2025 at 10:31?PM Jonathan Lee <jonathanlee571 at gmail.com <mailto:jonathanlee571 at gmail.com>> wrote:
> >
> > Hello fellow Squid users.
> >
> > Can you please help? I have located a possible issue with Squid 7.X downloaded from the following URL https://github.com/squid-cache/squid/releases/tag/SQUID_7_1 I found is the SMB_LM even when you disable smb with make config it still is listed in the Makefile even with "make rmconfig" it still lists it the make config does not remove the SMB_LM from the Makefile when you run it.
> 
> What file have you downloaded exactly? There's several offered there.
> 
> Are you sure you did "make config"? When I try to reproduce I get:
> 
> ? pwd
> /Users/kinkie/src/squid/v7
> ? make config
> make: *** No rule to make target `config'.  Stop.
> ? make rmconfig                                                                                                                                    2 ?
> make: *** No rule to make target `rmconfig'.  Stop.
> 
> 
> >
> > BASIC_AUTH+=  DB NCSA PAM POPS RADIUS fake getpwnam
> >
> > I?m attempting to build Squid 7.1 from the FreeBSD ports tree (/usr/ports/www/squid), but the build consistently fails during the configure step with the error:
> >
> > configure: checking auth/basic helpers: LDAP SASL SMB DB NCSA PAM POP3 RADIUS SMB_LM fake getpwnam NIS
> > configure: error: SMB_LM not found in ./src/auth/basic
> 
> Could it be that the problem is with the freebsd port?
> What version of freebsd are you using?  I have recently tested a build on 13.5, 14.2, and 15.0 at https://github.com/squid-platform-test/squid/actions/runs/16234098625 and it worked
> 
> 
> > I have installed Samba 4.20 (samba420-4.20.7-7) and confirmed that the required libraries (libsmbclient, etc.) are present. I have also tried disabling the SMB_LM helper via make config (and even using make rmconfig to reset options), but the build process still attempts to compile auth/basic/SMB_LM. Even after editing the Makefile to remove SMB_LM from BASIC_AUTH, the port continues to fail at the configure stage.
> 
> SMB_LM (aka basic_smb_lm_auth) is no longer provided with squid 7.1, from commit 1ce586101b
> 
> > It seems the Squid 7.x port is hardcoding SMB_LM support, ignoring the port options. Could this be a bug in the port's Makefile or auth/basic/Makefile.in? My environment is FreeBSD 14.3, and I?ve confirmed that all required dependencies are up to date.
> 
> That?s likely the port?s Makefile hardcoding helpers. 
> 
> > Can you confirm whether the SMB_LM helper is required in Squid 7.1, or if there is a recommended way to disable it for builds that don?t require NTLM/SMB authentication?
> 
> It isn?t required. It has been deprecated for a while, in fact
> 
> >
> > It will complete the "make install clean" only if you manually remove the SMB_LM from BASIC_AUTH in the Makefile.
> 
> Is that the port?s makefile? If so it is indeed a port problem, and the port?s makefile needs to be updated
> 
> >
> > Jonathan Lee
> >
> >
> > On Jul 20, 2025, at 22:24, Jonathan Lee <jonathanlee571 at gmail.com <mailto:jonathanlee571 at gmail.com>> wrote:
> >
> > Thank you
> > Sent from my iPhone
> >
> > On Jul 20, 2025, at 20:11, Amos Jeffries <squid3 at treenet.co.nz <mailto:squid3 at treenet.co.nz>> wrote:
> >
> > ?Okay, no worries.
> >
> > I have opened https://github.com/squid-cache/squid/pull/2123 to workaround the issues at our end based upon your feedback so far. The diff/patch should work for v7 as well, but requires a full ./bootstrap.sh on the sources.
> >
> > HTH
> > Amos
> >
> >
> > On 21/07/25 12:59, Jonathan Lee wrote:
> > sorry that was a typo I am still working on it. I am doing make configure right now
> >
> > On Jul 20, 2025, at 17:45, Amos Jeffries wrote:
> >
> >
> >
> > On 20/07/25 03:37, Jonathan Lee wrote:
> >
> > I think we found the problem ? the existing ports made |heimdal-krb5.pc|   file has *typos and incorrect paths*, which is why |pkg-config| might have issues not working.
> >
> >
> >
> > Ouch. Thanks for the feedback, I will add a few checks to our code to work around these for next Squid's.
> >
> >
> > Did you try any of the alternatives I gave and to what results?
> >
> >
> > Cheers
> > Amos
> >
> >
> >
> 
> 
> -- 
>     Francesco

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20250722/798618a2/attachment-0001.htm>

From jonathanlee571 at gmail.com  Tue Jul 22 22:13:23 2025
From: jonathanlee571 at gmail.com (Jonathan Lee)
Date: Tue, 22 Jul 2025 15:13:23 -0700
Subject: [squid-users] make clean install issue with squid 7
In-Reply-To: <30D4D48F-6009-4ABD-B3EE-6AF6911B953E@gmail.com>
References: <031f6d1c-caa7-45f3-87e3-093f5195615f@treenet.co.nz>
 <73A20FB6-1998-43A8-8EBB-C4161D4833C2@gmail.com>
 <A9D98C34-2D9E-4B53-8978-2324530BCD4B@gmail.com>
 <CA+Y8hcNFu8r9yp6UeEVip9h3KLb3NKU-ciFNfO7kYe_hj+z1_w@mail.gmail.com>
 <30D4D48F-6009-4ABD-B3EE-6AF6911B953E@gmail.com>
Message-ID: <FF0C86E9-E63F-4D54-B6C5-60C1B59C3606@gmail.com>

It states on the GitHub?. shouldn't the make config remove this automatically ?? My path to install was to download the ports and after change the makefile to point to your new version did a make makesum to fix the distrofile info and after make install clean and it will fail until you address the manual removal of the static SMB_LM
"- Remove basic_smb_lm_auth and ntlm_smb_lm_auth helpers? 

> On Jul 22, 2025, at 15:10, Jonathan Lee <jonathanlee571 at gmail.com> wrote:
> 
> https://github.com/squid-cache/squid/releases/download/SQUID_7_1/squid-7.1.tar.xz
> 
> Yes I have done the make config it is building fully now only after I manually adapted the Makefile make config would not fix the issue with SMB
> 
>> On Jul 22, 2025, at 14:50, Francesco Chemolli <gkinkie at gmail.com> wrote:
>> 
>> 
>> 
>> On Tue, Jul 22, 2025 at 10:31?PM Jonathan Lee <jonathanlee571 at gmail.com <mailto:jonathanlee571 at gmail.com>> wrote:
>> >
>> > Hello fellow Squid users.
>> >
>> > Can you please help? I have located a possible issue with Squid 7.X downloaded from the following URL https://github.com/squid-cache/squid/releases/tag/SQUID_7_1 I found is the SMB_LM even when you disable smb with make config it still is listed in the Makefile even with "make rmconfig" it still lists it the make config does not remove the SMB_LM from the Makefile when you run it.
>> 
>> What file have you downloaded exactly? There's several offered there.
>> 
>> Are you sure you did "make config"? When I try to reproduce I get:
>> 
>> ? pwd
>> /Users/kinkie/src/squid/v7
>> ? make config
>> make: *** No rule to make target `config'.  Stop.
>> ? make rmconfig                                                                                                                                    2 ?
>> make: *** No rule to make target `rmconfig'.  Stop.
>> 
>> 
>> >
>> > BASIC_AUTH+=  DB NCSA PAM POPS RADIUS fake getpwnam
>> >
>> > I?m attempting to build Squid 7.1 from the FreeBSD ports tree (/usr/ports/www/squid), but the build consistently fails during the configure step with the error:
>> >
>> > configure: checking auth/basic helpers: LDAP SASL SMB DB NCSA PAM POP3 RADIUS SMB_LM fake getpwnam NIS
>> > configure: error: SMB_LM not found in ./src/auth/basic
>> 
>> Could it be that the problem is with the freebsd port?
>> What version of freebsd are you using?  I have recently tested a build on 13.5, 14.2, and 15.0 at https://github.com/squid-platform-test/squid/actions/runs/16234098625 and it worked
>> 
>> 
>> > I have installed Samba 4.20 (samba420-4.20.7-7) and confirmed that the required libraries (libsmbclient, etc.) are present. I have also tried disabling the SMB_LM helper via make config (and even using make rmconfig to reset options), but the build process still attempts to compile auth/basic/SMB_LM. Even after editing the Makefile to remove SMB_LM from BASIC_AUTH, the port continues to fail at the configure stage.
>> 
>> SMB_LM (aka basic_smb_lm_auth) is no longer provided with squid 7.1, from commit 1ce586101b
>> 
>> > It seems the Squid 7.x port is hardcoding SMB_LM support, ignoring the port options. Could this be a bug in the port's Makefile or auth/basic/Makefile.in? My environment is FreeBSD 14.3, and I?ve confirmed that all required dependencies are up to date.
>> 
>> That?s likely the port?s Makefile hardcoding helpers. 
>> 
>> > Can you confirm whether the SMB_LM helper is required in Squid 7.1, or if there is a recommended way to disable it for builds that don?t require NTLM/SMB authentication?
>> 
>> It isn?t required. It has been deprecated for a while, in fact
>> 
>> >
>> > It will complete the "make install clean" only if you manually remove the SMB_LM from BASIC_AUTH in the Makefile.
>> 
>> Is that the port?s makefile? If so it is indeed a port problem, and the port?s makefile needs to be updated
>> 
>> >
>> > Jonathan Lee
>> >
>> >
>> > On Jul 20, 2025, at 22:24, Jonathan Lee <jonathanlee571 at gmail.com <mailto:jonathanlee571 at gmail.com>> wrote:
>> >
>> > Thank you
>> > Sent from my iPhone
>> >
>> > On Jul 20, 2025, at 20:11, Amos Jeffries <squid3 at treenet.co.nz <mailto:squid3 at treenet.co.nz>> wrote:
>> >
>> > ?Okay, no worries.
>> >
>> > I have opened https://github.com/squid-cache/squid/pull/2123 to workaround the issues at our end based upon your feedback so far. The diff/patch should work for v7 as well, but requires a full ./bootstrap.sh on the sources.
>> >
>> > HTH
>> > Amos
>> >
>> >
>> > On 21/07/25 12:59, Jonathan Lee wrote:
>> > sorry that was a typo I am still working on it. I am doing make configure right now
>> >
>> > On Jul 20, 2025, at 17:45, Amos Jeffries wrote:
>> >
>> >
>> >
>> > On 20/07/25 03:37, Jonathan Lee wrote:
>> >
>> > I think we found the problem ? the existing ports made |heimdal-krb5.pc|   file has *typos and incorrect paths*, which is why |pkg-config| might have issues not working.
>> >
>> >
>> >
>> > Ouch. Thanks for the feedback, I will add a few checks to our code to work around these for next Squid's.
>> >
>> >
>> > Did you try any of the alternatives I gave and to what results?
>> >
>> >
>> > Cheers
>> > Amos
>> >
>> >
>> >
>> 
>> 
>> -- 
>>     Francesco
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20250722/f911f9fc/attachment.htm>

From squid3 at treenet.co.nz  Tue Jul 22 23:05:15 2025
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 23 Jul 2025 11:05:15 +1200
Subject: [squid-users] make clean install issue with squid 7
In-Reply-To: <30D4D48F-6009-4ABD-B3EE-6AF6911B953E@gmail.com>
References: <031f6d1c-caa7-45f3-87e3-093f5195615f@treenet.co.nz>
 <73A20FB6-1998-43A8-8EBB-C4161D4833C2@gmail.com>
 <A9D98C34-2D9E-4B53-8978-2324530BCD4B@gmail.com>
 <CA+Y8hcNFu8r9yp6UeEVip9h3KLb3NKU-ciFNfO7kYe_hj+z1_w@mail.gmail.com>
 <30D4D48F-6009-4ABD-B3EE-6AF6911B953E@gmail.com>
Message-ID: <ef0f4f79-7a9b-4642-8b32-8f3e5e352553@treenet.co.nz>

I am not seeing it in those tarballs, just some documentation that did 
not get dropped yet:

  ./squid-7.1/CREDITS
  ./squid-7.1/doc/release-notes/release-7.html
  ./squid-7.1/RELEASENOTES.html



Running the release ./configure produces the correct output:

  configure: checking auth/basic helpers: DB LDAP NCSA NIS PAM POP3 
RADIUS SASL SMB SSPI fake getpwnam



FTR; Please notice that:

   "SMB" is NTLM from the Windows NT / 2000 / XP
     - LMCompatibilityLevel registry settings are set to 2 or 3
     - deprecated 2025
     - still supported by Squid


   "SMB_LM" is LanManager, LM, LANMAN and NTLMv1 from DOS / Windows 3.1 
/ Win95 / Win98 / Win98 SE
     - deprecated 2006
     - LMCompatibilityLevel registry settings are set to 1
     - dropped by Squid


They are not the same type of credentials encoding. Hence the 
LMCompatibilityLevel values, and different helpers.


HTH
Amos


On 23/07/25 10:10, Jonathan Lee wrote:
> github.com <https://github.com/squid-cache/squid/releases/download/ 
> SQUID_7_1/squid-7.1.tar.xz>
> 	<https://github.com/squid-cache/squid/releases/download/SQUID_7_1/ 
> squid-7.1.tar.xz>
> 
> <https://github.com/squid-cache/squid/releases/download/SQUID_7_1/ 
> squid-7.1.tar.xz>
> 
> 
> Yes I have done the make config it is building fully now only after I 
> manually adapted the Makefile make config would not fix the issue with SMB
> 
>> On Jul 22, 2025, at 14:50, Francesco Chemolli <gkinkie at gmail.com> wrote:
>>
>>
>>
>> On Tue, Jul 22, 2025 at 10:31?PM Jonathan Lee 
>> <jonathanlee571 at gmail.com <mailto:jonathanlee571 at gmail.com>> wrote:
>> >
>> > Hello fellow Squid users.
>> >
>> > Can you please help? I have located a possible issue with Squid 7.X 
>> downloaded from the following URL https://github.com/squid-cache/ 
>> squid/releases/tag/SQUID_7_1 <https://github.com/squid-cache/squid/ 
>> releases/tag/SQUID_7_1> I found is the SMB_LM even when you disable 
>> smb with make config it still is listed in the Makefile even with 
>> "make rmconfig" it still lists it the make config does not remove the 
>> SMB_LM from the Makefile when you run it.
>>
>> What file have you downloaded exactly? There's several offered there.
>>
>> Are you sure you did "make config"? When I try to reproduce I get:
>>
>> ? pwd
>> /Users/kinkie/src/squid/v7
>> ? make config
>> make: *** No rule to make target `config'.? Stop.
>> ? make rmconfig                                                        
>>                                                                       
>> ? ? ? 2 ?
>> make: *** No rule to make target `rmconfig'.? Stop.
>>
>>
>> >
>> > BASIC_AUTH+=? DB NCSA PAM POPS RADIUS fake getpwnam
>> >
>> > I?m attempting to build Squid 7.1 from the FreeBSD ports tree (/usr/ 
>> ports/www/squid), but the build consistently fails during the 
>> configure step with the error:
>> >
>> > configure: checking auth/basic helpers: LDAP SASL SMB DB NCSA PAM 
>> POP3 RADIUS SMB_LM fake getpwnam NIS
>> > configure: error: SMB_LM not found in ./src/auth/basic
>>
>> Could it be that the problem is with the freebsd port?
>> What version of freebsd are you using?? I have recently tested a build 
>> on 13.5, 14.2, and 15.0 at https://github.com/squid-platform-test/ 
>> squid/actions/runs/16234098625 <https://github.com/squid-platform- 
>> test/squid/actions/runs/16234098625> and it worked
>>
>>
>> > I have installed Samba 4.20 (samba420-4.20.7-7) and confirmed that 
>> the required libraries (libsmbclient, etc.) are present. I have also 
>> tried disabling the SMB_LM helper via make config (and even using make 
>> rmconfig to reset options), but the build process still attempts to 
>> compile auth/basic/SMB_LM. Even after editing the Makefile to remove 
>> SMB_LM from BASIC_AUTH, the port continues to fail at the configure stage.
>>
>> SMB_LM (aka basic_smb_lm_auth) is no longer provided with squid 7.1, 
>> from commit 1ce586101b
>>
>> > It seems the Squid 7.x port is hardcoding SMB_LM support, ignoring 
>> the port options. Could this be a bug in the port's Makefile or auth/ 
>> basic/Makefile.in? My environment is FreeBSD 14.3, and I?ve confirmed 
>> that all required dependencies are up to date.
>>
>> That?s likely the port?s Makefile hardcoding helpers.
>>
>> > Can you confirm whether the SMB_LM helper is required in Squid 7.1, 
>> or if there is a recommended way to disable it for builds that don?t 
>> require NTLM/SMB authentication?
>>
>> It isn?t required. It has been deprecated for a while, in fact
>>
>> >
>> > It will complete the "make install clean" only if you manually 
>> remove the SMB_LM from BASIC_AUTH in the Makefile.
>>
>> Is that the port?s makefile? If so it is indeed a port problem, and 
>> the port?s makefile needs to be updated
>>
>> >
>> > Jonathan Lee
>> >
>> >
>> > On Jul 20, 2025, at 22:24, Jonathan Lee <jonathanlee571 at gmail.com 
>> <mailto:jonathanlee571 at gmail.com>> wrote:
>> >
>> > Thank you
>> > Sent from my iPhone
>> >
>> > On Jul 20, 2025, at 20:11, Amos Jeffries <squid3 at treenet.co.nz 
>> <mailto:squid3 at treenet.co.nz>> wrote:
>> >
>> > ?Okay, no worries.
>> >
>> > I have opened https://github.com/squid-cache/squid/pull/2123 
>> <https://github.com/squid-cache/squid/pull/2123> to workaround the 
>> issues at our end based upon your feedback so far. The diff/patch 
>> should work for v7 as well, but requires a full ./bootstrap.sh on the 
>> sources.
>> >
>> > HTH
>> > Amos
>> >
>> >
>> > On 21/07/25 12:59, Jonathan Lee wrote:
>> > sorry that was a typo I am still working on it. I am doing make 
>> configure right now
>> >
>> > On Jul 20, 2025, at 17:45, Amos Jeffries wrote:
>> >
>> >
>> >
>> > On 20/07/25 03:37, Jonathan Lee wrote:
>> >
>> > I think we found the problem ? the existing ports made |heimdal- 
>> krb5.pc|? ?file has *typos and incorrect paths*, which is why |pkg- 
>> config| might have issues not working.
>> >
>> >
>> >
>> > Ouch. Thanks for the feedback, I will add a few checks to our code 
>> to work around these for next Squid's.
>> >
>> >
>> > Did you try any of the alternatives I gave and to what results?
>> >
>> >
>> > Cheers
>> > Amos
>> >
>> >
>> >
>>
>>
>> -- 
>> ? ? Francesco
> 


From squid3 at treenet.co.nz  Tue Jul 22 23:15:53 2025
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 23 Jul 2025 11:15:53 +1200
Subject: [squid-users] make clean install issue with squid 7
In-Reply-To: <FF0C86E9-E63F-4D54-B6C5-60C1B59C3606@gmail.com>
References: <031f6d1c-caa7-45f3-87e3-093f5195615f@treenet.co.nz>
 <73A20FB6-1998-43A8-8EBB-C4161D4833C2@gmail.com>
 <A9D98C34-2D9E-4B53-8978-2324530BCD4B@gmail.com>
 <CA+Y8hcNFu8r9yp6UeEVip9h3KLb3NKU-ciFNfO7kYe_hj+z1_w@mail.gmail.com>
 <30D4D48F-6009-4ABD-B3EE-6AF6911B953E@gmail.com>
 <FF0C86E9-E63F-4D54-B6C5-60C1B59C3606@gmail.com>
Message-ID: <232fad29-cbd6-411e-8bf7-0b4c5740e1bf@treenet.co.nz>

On 23/07/25 10:13, Jonathan Lee wrote:
> It states on the GitHub?. shouldn't the make config remove this 
> automatically ?? My path to install was to download the ports and after 
> change the makefile to point to your new version

There is your problem. The BSD ports file is not part of our release and 
needs more changes to build the Squid v7 series.

Specifically check the parameters it is passing to our ./configure 
script. All the options mentioned in our RELEASENOTES.html will need 
attention and/or changes.

If the ports Makefile is doing anything with squid.conf or patching our 
code, those parts will need checking as well.


Cheers
Amos


From jonathanlee571 at gmail.com  Wed Jul 23 01:05:27 2025
From: jonathanlee571 at gmail.com (Jonathan Lee)
Date: Tue, 22 Jul 2025 18:05:27 -0700
Subject: [squid-users] make clean install issue with squid 7
In-Reply-To: <ef0f4f79-7a9b-4642-8b32-8f3e5e352553@treenet.co.nz>
References: <031f6d1c-caa7-45f3-87e3-093f5195615f@treenet.co.nz>
 <73A20FB6-1998-43A8-8EBB-C4161D4833C2@gmail.com>
 <A9D98C34-2D9E-4B53-8978-2324530BCD4B@gmail.com>
 <CA+Y8hcNFu8r9yp6UeEVip9h3KLb3NKU-ciFNfO7kYe_hj+z1_w@mail.gmail.com>
 <30D4D48F-6009-4ABD-B3EE-6AF6911B953E@gmail.com>
 <ef0f4f79-7a9b-4642-8b32-8f3e5e352553@treenet.co.nz>
Message-ID: <6D3A131F-AF95-4CEA-A04E-1366C7A0D0CC@gmail.com>

Thanks! I was under the impression that, to test this with pfSense development, I needed to use the specific adapted Makefile with the new URL. So, I installed FreeBSD along with the ports, then used Git to access my PR with the adapted Makefile to see if I could adjust it to work with Squid 7 and update the pfSense repository to use the new version. That?s why I approached it this way. Again, extracting the tarball directly works perfectly. I was using this PR for that purpose https://github.com/pfsense/FreeBSD-ports/pull/1420 Again this would force me to use the ports that pfsense is using. First time doing this after taking my computer science class that went over git and makefiles so I am a bit new on how to compile an update over the top of the ports file and not the snap ports file. 

Jonathan Lee



> On Jul 22, 2025, at 16:05, Amos Jeffries <squid3 at treenet.co.nz> wrote:
> 
> I am not seeing it in those tarballs, just some documentation that did not get dropped yet:
> 
> ./squid-7.1/CREDITS
> ./squid-7.1/doc/release-notes/release-7.html
> ./squid-7.1/RELEASENOTES.html
> 
> 
> 
> Running the release ./configure produces the correct output:
> 
> configure: checking auth/basic helpers: DB LDAP NCSA NIS PAM POP3 RADIUS SASL SMB SSPI fake getpwnam
> 
> 
> 
> FTR; Please notice that:
> 
>  "SMB" is NTLM from the Windows NT / 2000 / XP
>    - LMCompatibilityLevel registry settings are set to 2 or 3
>    - deprecated 2025
>    - still supported by Squid
> 
> 
>  "SMB_LM" is LanManager, LM, LANMAN and NTLMv1 from DOS / Windows 3.1 / Win95 / Win98 / Win98 SE
>    - deprecated 2006
>    - LMCompatibilityLevel registry settings are set to 1
>    - dropped by Squid
> 
> 
> They are not the same type of credentials encoding. Hence the LMCompatibilityLevel values, and different helpers.
> 
> 
> HTH
> Amos
> 
> 
> On 23/07/25 10:10, Jonathan Lee wrote:
>> github.com <https://github.com/squid-cache/squid/releases/download/ SQUID_7_1/squid-7.1.tar.xz>
>> 	<https://github.com/squid-cache/squid/releases/download/SQUID_7_1/ squid-7.1.tar.xz>
>> <https://github.com/squid-cache/squid/releases/download/SQUID_7_1/ squid-7.1.tar.xz>
>> Yes I have done the make config it is building fully now only after I manually adapted the Makefile make config would not fix the issue with SMB
>>> On Jul 22, 2025, at 14:50, Francesco Chemolli <gkinkie at gmail.com> wrote:
>>> 
>>> 
>>> 
>>> On Tue, Jul 22, 2025 at 10:31?PM Jonathan Lee <jonathanlee571 at gmail.com <mailto:jonathanlee571 at gmail.com>> wrote:
>>> >
>>> > Hello fellow Squid users.
>>> >
>>> > Can you please help? I have located a possible issue with Squid 7.X downloaded from the following URL https://github.com/squid-cache/ squid/releases/tag/SQUID_7_1 <https://github.com/squid-cache/squid/ releases/tag/SQUID_7_1> I found is the SMB_LM even when you disable smb with make config it still is listed in the Makefile even with "make rmconfig" it still lists it the make config does not remove the SMB_LM from the Makefile when you run it.
>>> 
>>> What file have you downloaded exactly? There's several offered there.
>>> 
>>> Are you sure you did "make config"? When I try to reproduce I get:
>>> 
>>> ? pwd
>>> /Users/kinkie/src/squid/v7
>>> ? make config
>>> make: *** No rule to make target `config'.  Stop.
>>> ? make rmconfig                                                                                                                                    2 ?
>>> make: *** No rule to make target `rmconfig'.  Stop.
>>> 
>>> 
>>> >
>>> > BASIC_AUTH+=  DB NCSA PAM POPS RADIUS fake getpwnam
>>> >
>>> > I?m attempting to build Squid 7.1 from the FreeBSD ports tree (/usr/ ports/www/squid), but the build consistently fails during the configure step with the error:
>>> >
>>> > configure: checking auth/basic helpers: LDAP SASL SMB DB NCSA PAM POP3 RADIUS SMB_LM fake getpwnam NIS
>>> > configure: error: SMB_LM not found in ./src/auth/basic
>>> 
>>> Could it be that the problem is with the freebsd port?
>>> What version of freebsd are you using?  I have recently tested a build on 13.5, 14.2, and 15.0 at https://github.com/squid-platform-test/ squid/actions/runs/16234098625 <https://github.com/squid-platform- test/squid/actions/runs/16234098625> and it worked
>>> 
>>> 
>>> > I have installed Samba 4.20 (samba420-4.20.7-7) and confirmed that the required libraries (libsmbclient, etc.) are present. I have also tried disabling the SMB_LM helper via make config (and even using make rmconfig to reset options), but the build process still attempts to compile auth/basic/SMB_LM. Even after editing the Makefile to remove SMB_LM from BASIC_AUTH, the port continues to fail at the configure stage.
>>> 
>>> SMB_LM (aka basic_smb_lm_auth) is no longer provided with squid 7.1, from commit 1ce586101b
>>> 
>>> > It seems the Squid 7.x port is hardcoding SMB_LM support, ignoring the port options. Could this be a bug in the port's Makefile or auth/ basic/Makefile.in? My environment is FreeBSD 14.3, and I?ve confirmed that all required dependencies are up to date.
>>> 
>>> That?s likely the port?s Makefile hardcoding helpers.
>>> 
>>> > Can you confirm whether the SMB_LM helper is required in Squid 7.1, or if there is a recommended way to disable it for builds that don?t require NTLM/SMB authentication?
>>> 
>>> It isn?t required. It has been deprecated for a while, in fact
>>> 
>>> >
>>> > It will complete the "make install clean" only if you manually remove the SMB_LM from BASIC_AUTH in the Makefile.
>>> 
>>> Is that the port?s makefile? If so it is indeed a port problem, and the port?s makefile needs to be updated
>>> 
>>> >
>>> > Jonathan Lee
>>> >
>>> >
>>> > On Jul 20, 2025, at 22:24, Jonathan Lee <jonathanlee571 at gmail.com <mailto:jonathanlee571 at gmail.com>> wrote:
>>> >
>>> > Thank you
>>> > Sent from my iPhone
>>> >
>>> > On Jul 20, 2025, at 20:11, Amos Jeffries <squid3 at treenet.co.nz <mailto:squid3 at treenet.co.nz>> wrote:
>>> >
>>> > ?Okay, no worries.
>>> >
>>> > I have opened https://github.com/squid-cache/squid/pull/2123 <https://github.com/squid-cache/squid/pull/2123> to workaround the issues at our end based upon your feedback so far. The diff/patch should work for v7 as well, but requires a full ./bootstrap.sh on the sources.
>>> >
>>> > HTH
>>> > Amos
>>> >
>>> >
>>> > On 21/07/25 12:59, Jonathan Lee wrote:
>>> > sorry that was a typo I am still working on it. I am doing make configure right now
>>> >
>>> > On Jul 20, 2025, at 17:45, Amos Jeffries wrote:
>>> >
>>> >
>>> >
>>> > On 20/07/25 03:37, Jonathan Lee wrote:
>>> >
>>> > I think we found the problem ? the existing ports made |heimdal- krb5.pc|   file has *typos and incorrect paths*, which is why |pkg- config| might have issues not working.
>>> >
>>> >
>>> >
>>> > Ouch. Thanks for the feedback, I will add a few checks to our code to work around these for next Squid's.
>>> >
>>> >
>>> > Did you try any of the alternatives I gave and to what results?
>>> >
>>> >
>>> > Cheers
>>> > Amos
>>> >
>>> >
>>> >
>>> 
>>> 
>>> -- 
>>>     Francesco
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20250722/780cfceb/attachment.htm>

From Mark.Cairney at ed.ac.uk  Thu Jul 24 14:38:56 2025
From: Mark.Cairney at ed.ac.uk (Mark Cairney)
Date: Thu, 24 Jul 2025 15:38:56 +0100
Subject: [squid-users] Configuring multiple hosts in LDAP URIs and using DN
Message-ID: <328124df-8cdb-4f56-847d-3e033acd61ad@ed.ac.uk>

Hi,

Thanks for the tip about the reverse DNS. I now have the 
Kerberos/Negotiate auth working now that the reverse DNS lookup matches.

For HA/resiliency I'd like to be able to point the fallback LDAP basic 
auth + group lookup at multiple AD/LDAP servers.

I notice both basic_ldap_auth and ext_ldap_group_acl use the -H flag for 
LDAP URIs but I've been having problems getting it to work with anything 
other than a single named host. Specifying multiple hosts e.g. -H 
ldap://server1.domain:389 ldap://server2.domain:389 appears to work for 
a while but eventually starts failing with 'couldn't connect to LDAP 
server' errors and it appears to always hit the 1st named host.

I've also tried using a DN as described in the ldapsearch documentation:

"????????????? Specify? URI(s)? referring to the ldap server(s); a list 
of URI,
 ????????????? separated by whitespace or commas is expected; only the? 
proto?
 ????????????? col/host/port? fields? are? allowed.?? As? an exception,? 
if no
 ????????????? host/port is specified, but a DN is, the DN is used to? 
look? up
 ????????????? the? corresponding? host(s) using the DNS SRV records, 
according
 ????????????? to RFC 2782.? The DN must be a non-empty sequence of 
AVAs? whose
 ????????????? attribute? type? is "dc" (domain component), and must be 
escaped
 ????????????? according to RFC 2396"


This works if I use ldapsearch e.g.

ldapsearch -b "dc=ed,dc=ac,dc=uk" -D "CN=squiduser,DC=domain,DC=local" 
-y /etc/squid/ldap_password 
"(&(objectClass=person)(sAMAccountName=mcairney))" -Z -H 
ldap:///dc%3Ddomain%2Cdc%3Dlocal

But if I use this LDAP URI with basic_ldap_auth I get? 'Could not 
Activate TLS connection' errors and no clues in the logs/debug output.

Is this a known limitation of the squid utilities? If so, what are other 
people doing to provide HA/failover with their LDAP hosts (the only 
examples I can find in man pages/tutorials are the straightforward 
single LDAP host scenario).


Kind regards,

Mark


-- 
/****************************

Mark Cairney
ITI Enterprise Services
Information Services
University of Edinburgh

Tel: 0131 650 6565
Email: Mark.Cairney at ed.ac.uk

*******************************/

The University of Edinburgh is a charitable body, registered in Scotland, with registration number SC005336.


From squid.org at bloms.de  Fri Jul 25 09:13:25 2025
From: squid.org at bloms.de (Dieter Bloms)
Date: Fri, 25 Jul 2025 11:13:25 +0200
Subject: [squid-users] is tls_outgoing_options cipher ignored in squid 7.1?
Message-ID: <2gwoh5u5unrx7edbe256zkecxcjoeikggwasv4zvjne5xh3whg@adef3rnpdwer>

Hello,

I'am running squid on debian bookworm with all patches.
I configured the following ciphers:

tls_outgoing_options cipher=TLSv1.2:!CBC:!kRSA:!DSS:!PSK:!aNULL:!ARIA:!CAMELLIA:!AESCCM:!SHA256:!SHA384 at SECLEVEL=2

With squid 6.13 I get the following ciphers list with the ssllab browser test: https://clienttest.ssllabs.com:8443/ssltest/viewMyClient.html

TLS_AES_256_GCM_SHA384 
TLS_CHACHA20_POLY1305_SHA256 
TLS_AES_128_GCM_SHA256 (0x1301)   
TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384 
TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 
TLS_DHE_RSA_WITH_AES_256_GCM_SHA384 
TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256 
TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256 
TLS_DHE_RSA_WITH_CHACHA20_POLY1305_SHA256 
TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256 
TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 
TLS_DHE_RSA_WITH_AES_128_GCM_SHA256 
TLS_EMPTY_RENEGOTIATION_INFO_SCSV 

which look good to me, but when I run squid 7.1 on the same system with
the same config I get the following list:

TLS_AES_256_GCM_SHA384 
TLS_CHACHA20_POLY1305_SHA256 
TLS_AES_128_GCM_SHA256 
TLS_RSA_WITH_AES_128_CBC_SHA 
TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA 
TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA 
TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256 
TLS_RSA_WITH_AES_256_CBC_SHA 
TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 
TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256 
TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384 
TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 
TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256 
TLS_RSA_WITH_AES_256_GCM_SHA384 
TLS_RSA_WITH_AES_128_GCM_SHA256 
TLS_EMPTY_RENEGOTIATION_INFO_SCSV 

which includes some weak ciphers like:
TLS_RSA_WITH_AES_128_CBC_SHA
TLS_RSA_WITH_AES_256_GCM_SHA384
...

is this a bug, a feature or a mistake on my side?

-- 
regards

  Dieter

--
I do not get viruses because I do not use MS software.
If you use Outlook then please do not put my email address in your
address-book so that WHEN you get a virus it won't use my address in the
>From field.

From uhlar at fantomas.sk  Fri Jul 25 12:43:06 2025
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Fri, 25 Jul 2025 14:43:06 +0200
Subject: [squid-users] server-side FTP support
Message-ID: <aIN72o1ZPg9UmUlv@fantomas.sk>

Hello,

I see that squid has FTP support for some time:

#  TAG: ftp_port
#       Enables Native FTP proxy by specifying the socket address where Squid
#       listens for FTP client requests. See http_port directive for various
#       ways to specify the listening address and mode.


But I can't see any options related to PASV and PORT session setup.

 From what I saw in sources (with my limited knowledge of C++) it seems that 
squid tries to pass 

Can I cofnigure/limit these ports somehow?

e.g. disabling PORT/EPRT and limiting PASV to ports e.g.  32736-32767

Recompiling squid is possible for me

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
I don't have lysdexia. The Dog wouldn't allow that.

From rafael.akchurin at diladele.com  Fri Jul 25 17:37:29 2025
From: rafael.akchurin at diladele.com (Rafael Akchurin)
Date: Fri, 25 Jul 2025 17:37:29 +0000
Subject: [squid-users] Ubuntu 24.04 LTS repository for Squid 7.1 (rebuilt
 from sources in Debian)
Message-ID: <AM0PR0402MB357034DF650C8846E3673FAF8F59A@AM0PR0402MB3570.eurprd04.prod.outlook.com>

Hello everyone,

Online repository with latest Squid 7.1 (rebuilt from sources in Debian) for Ubuntu 24.04 LTS 64-bit is available at https://squid71.diladele.com/ .
Github repo https://github.com/diladele/squid-ubuntu contains all scripts we used to make this compilation.

Here are simple instructions how to use the repo. For more information see readme at https://github.com/diladele/squid-ubuntu  .


# add diladele apt key
wget -qO - https://packages.diladele.com/diladele_pub.asc | sudo apt-key add -

# add new repo
echo "deb https://squid71.diladele.com/ubuntu/ noble main" \
    > /etc/apt/sources.list.d/squid71.diladele.com.list

# and install
apt update && apt install -y \
    squid-common \
    squid-openssl \
    libecap3 libecap3-dev


This version of Squid will be part of Web Safety 9.6 being released during September 2025.  If you have some spare time and are interested in Admin UI for Squid and ICAP web filtering, consider downloading a Web Safety appliance<https://diladele.com/websafety/download.html> for VMware ESXi/vSphere , Microsoft Hyper-V, Proxmox or even deploy it directly on Microsoft Azure and Amazon AWS.

Hope you will find this useful.

Best regards,
Rafael Akchurin
Diladele B.V.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20250725/8929e503/attachment.htm>

From rousskov at measurement-factory.com  Fri Jul 25 21:25:53 2025
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Fri, 25 Jul 2025 17:25:53 -0400
Subject: [squid-users] server-side FTP support
In-Reply-To: <aIN72o1ZPg9UmUlv@fantomas.sk>
References: <aIN72o1ZPg9UmUlv@fantomas.sk>
Message-ID: <971f9131-610e-4389-a9fc-3070ebab7a33@measurement-factory.com>

On 2025-07-25 08:43, Matus UHLAR - fantomas wrote:

> I see that squid has FTP support for some time:
> 
> #? TAG: ftp_port ...

> But I can't see any options related to PASV and PORT session setup.
> 
> From what I saw in sources (with my limited knowledge of C++) it seems 
> that squid tries to pass


Squid FTP server (i.e. the functionality behind ftp_port) tries to 
support both passive and active data transfers. FTP client decides what 
mode to use by sending either FTP PORT or FTP PASV command.


> Can I cofnigure/limit these ports somehow?
> 
> e.g. disabling PORT/EPRT and limiting PASV to ports e.g.? 32736-32767

I hope that the answer to your question is "yes", but I have not checked 
any details or tested the current implementation; IIRC,

* You can deny PORT/EPRT commands using http_access rules. See 
squid.conf.documented paragraph that is quoted at the end of this email. 
In cache.log, you can see HTTP-like messages (that your http_access 
rules will need to match) using debug_options set to "ALL,2" or "ALL,1 
9,2". Look for "FTP Client REQUEST" phrases.

* You can control PASV port range using your OS settings for ephemeral 
port ranges (e.g., net.ipv4.ip_local_port_range and friends on Linux).


HTH,

Alex.

> 	Native FTP commands accepted at ftp_port are internally converted or
> 	wrapped into HTTP-like messages. The same happens to Native FTP
> 	responses received from FTP origin servers. Those HTTP-like messages
> 	are shoveled through regular access control and adaptation layers
> 	between the FTP client and the FTP origin server. This allows Squid to
> 	examine, adapt, block, and log FTP exchanges. Squid reuses most HTTP
> 	mechanisms when shoveling wrapped FTP messages. For example,
> 	http_access and adaptation_access directives are used.





From rousskov at measurement-factory.com  Fri Jul 25 21:44:24 2025
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Fri, 25 Jul 2025 17:44:24 -0400
Subject: [squid-users] is tls_outgoing_options cipher ignored in squid
 7.1?
In-Reply-To: <2gwoh5u5unrx7edbe256zkecxcjoeikggwasv4zvjne5xh3whg@adef3rnpdwer>
References: <2gwoh5u5unrx7edbe256zkecxcjoeikggwasv4zvjne5xh3whg@adef3rnpdwer>
Message-ID: <cc290c7e-e894-4b4a-8035-539192364272@measurement-factory.com>

On 2025-07-25 05:13, Dieter Bloms wrote:
> Hello,
> 
> I'am running squid on debian bookworm with all patches.
> I configured the following ciphers:
> 
> tls_outgoing_options cipher=TLSv1.2:!CBC:!kRSA:!DSS:!PSK:!aNULL:!ARIA:!CAMELLIA:!AESCCM:!SHA256:!SHA384 at SECLEVEL=2
> 
> With squid 6.13 I get the following ciphers list with the ssllab browser test: https://clienttest.ssllabs.com:8443/ssltest/viewMyClient.html
> 
> TLS_AES_256_GCM_SHA384
> TLS_CHACHA20_POLY1305_SHA256
> TLS_AES_128_GCM_SHA256 (0x1301)
> TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
> TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
> TLS_DHE_RSA_WITH_AES_256_GCM_SHA384
> TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256
> TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256
> TLS_DHE_RSA_WITH_CHACHA20_POLY1305_SHA256
> TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256
> TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
> TLS_DHE_RSA_WITH_AES_128_GCM_SHA256
> TLS_EMPTY_RENEGOTIATION_INFO_SCSV
> 
> which look good to me, but when I run squid 7.1 on the same system with
> the same config I get the following list:
> 
> TLS_AES_256_GCM_SHA384
> TLS_CHACHA20_POLY1305_SHA256
> TLS_AES_128_GCM_SHA256
> TLS_RSA_WITH_AES_128_CBC_SHA
> TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA
> TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA
> TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256
> TLS_RSA_WITH_AES_256_CBC_SHA
> TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
> TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256
> TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
> TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
> TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256
> TLS_RSA_WITH_AES_256_GCM_SHA384
> TLS_RSA_WITH_AES_128_GCM_SHA256
> TLS_EMPTY_RENEGOTIATION_INFO_SCSV
> 
> which includes some weak ciphers like:
> TLS_RSA_WITH_AES_128_CBC_SHA
> TLS_RSA_WITH_AES_256_GCM_SHA384
> ...
> 
> is this a bug, a feature or a mistake on my side?

Based on the information above, I cannot answer your question, but Squid 
should honor tls_outgoing_options except when peeking at or splicing TLS 
connections using the corresponding ssl_bump features. I know that at 
least some portions of tls_outgoing_options code worked when we were 
adding support for tls_outgoing_options_for_retries in 2023 (Draft PR 
#1456).

If you suspect a bug, please file a bug report after double checking 
that both tests use the same OpenSSL library and that there are no 
potentially related errors or warnings reported by either Squid at 
startup. In your bug report, if any, please share relevant parts of 
ssl_bump configuration (if you are using that feature for the affected 
connections).


Cheers,

Alex.


From jonathanlee571 at gmail.com  Sat Jul 26 03:46:49 2025
From: jonathanlee571 at gmail.com (Jonathan Lee)
Date: Fri, 25 Jul 2025 20:46:49 -0700
Subject: [squid-users] Squid and X10 light control
Message-ID: <CDBE27CA-213C-4E85-9450-9D34CC33941C@gmail.com>

Is there any 1990s era X10 protocol control interface with Squid ? This is purely a question and answer I am not using X10 my alarm has X10 control but it requires the interface box. It was essentially signal over AC that would control the lighting and appliances. 
Sent from my iPhone

From squid3 at treenet.co.nz  Sat Jul 26 05:01:37 2025
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 26 Jul 2025 17:01:37 +1200
Subject: [squid-users] Squid and X10 light control
In-Reply-To: <CDBE27CA-213C-4E85-9450-9D34CC33941C@gmail.com>
References: <CDBE27CA-213C-4E85-9450-9D34CC33941C@gmail.com>
Message-ID: <ffe9234a-2570-47ed-8a3c-c8c5474b75d2@treenet.co.nz>

On 26/07/25 15:46, Jonathan Lee wrote:
> Is there any 1990s era X10 protocol control interface with Squid ? This is purely a question and answer I am not using X10 my alarm has X10 control but it requires the interface box. It was essentially signal over AC that would control the lighting and appliances.


That would be a no. In the OSI protocol model X10 would be Layer 1. 
Squid is for protocols at Layers 3+.


Cheers
Amos


