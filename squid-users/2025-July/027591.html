<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] DNS round-robin behaviour
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20DNS%20round-robin%20behaviour&In-Reply-To=%3C04dada29-a190-46da-a3e7-967741c87eee%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027592.html">
   <LINK REL="Next"  HREF="027593.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] DNS round-robin behaviour</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20DNS%20round-robin%20behaviour&In-Reply-To=%3C04dada29-a190-46da-a3e7-967741c87eee%40measurement-factory.com%3E"
       TITLE="[squid-users] DNS round-robin behaviour">rousskov at measurement-factory.com
       </A><BR>
    <I>Fri Jul 11 13:09:42 UTC 2025</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="027592.html">[squid-users] DNS round-robin behaviour
</A></li>
        <LI>Next message (by thread): <A HREF="027593.html">[squid-users] squid-7.0.2 can't configure with LDAP-helpers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27591">[ date ]</a>
              <a href="thread.html#27591">[ thread ]</a>
              <a href="subject.html#27591">[ subject ]</a>
              <a href="author.html#27591">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2025-07-11 05:54, <A HREF="https://lists.squid-cache.org/listinfo/squid-users">paolo.prinx at gmail.com</A> wrote:

&gt;<i> how does Squid behave when it receives a DNS 
</I>&gt;<i> response containing multiple IP addresses? Does it pick a random one in 
</I>&gt;<i> the list, or does it stick to a certain order?
</I>
Modern Squids usually use the first received IPv4 address for all 
transactions going to the corresponding host. Other received IPv4 
addresses are used (in the order they were received, wrapping up in a 
round-robin fashion) only if the current address is marked as &quot;bad&quot; due 
to errors when trying to establish a TCP connection to that host.

The same is true for received IPv6 addresses.

When both IPv4 and IPv6 addresses were received prior to the connection 
opening attempt, the first received address is used in error-free cases. 
Squid sends DNS A query immediately followed by a DNS AAAA query (where 
supported), so there may be bias towards IPv4 addresses if answers to 
DNS queries usually come in the order the queries were sent.


&gt;<i> In our config, we have squid pointing to a pool of dnsdist resolvers, 
</I>&gt;<i> that implement a local packet cache with a 300-second TTL. We are seeing 
</I>&gt;<i> unbalanced traffic distributions, was wondering if there is anything we 
</I>&gt;<i> should configure on the Squid side, or if we should instead look to 
</I>&gt;<i> change the responses returned by the DNS resolver.
</I>
I would not try to balance load using DNS. If you want to do it using 
Squid, then using round-robin or a similar cache_peer selection method 
may be worth investigating/testing.


HTH,

Alex.

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="027592.html">[squid-users] DNS round-robin behaviour
</A></li>
	<LI>Next message (by thread): <A HREF="027593.html">[squid-users] squid-7.0.2 can't configure with LDAP-helpers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27591">[ date ]</a>
              <a href="thread.html#27591">[ thread ]</a>
              <a href="subject.html#27591">[ subject ]</a>
              <a href="author.html#27591">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
