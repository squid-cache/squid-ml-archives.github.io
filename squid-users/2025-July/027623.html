<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Configuring multiple hosts in LDAP URIs and using DN
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Configuring%20multiple%20hosts%20in%20LDAP%20URIs%20and%20using%20DN&In-Reply-To=%3C328124df-8cdb-4f56-847d-3e033acd61ad%40ed.ac.uk%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027615.html">
   <LINK REL="Next"  HREF="027624.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Configuring multiple hosts in LDAP URIs and using DN</H1>
    <B>Mark Cairney</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Configuring%20multiple%20hosts%20in%20LDAP%20URIs%20and%20using%20DN&In-Reply-To=%3C328124df-8cdb-4f56-847d-3e033acd61ad%40ed.ac.uk%3E"
       TITLE="[squid-users] Configuring multiple hosts in LDAP URIs and using DN">Mark.Cairney at ed.ac.uk
       </A><BR>
    <I>Thu Jul 24 14:38:56 UTC 2025</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="027615.html">[squid-users] WCCP and SSL-Bump with Squid 3.5 &#8212; HTTPS traffic not reaching Squid
</A></li>
        <LI>Next message (by thread): <A HREF="027624.html">[squid-users] is tls_outgoing_options cipher ignored in squid 7.1?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27623">[ date ]</a>
              <a href="thread.html#27623">[ thread ]</a>
              <a href="subject.html#27623">[ subject ]</a>
              <a href="author.html#27623">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

Thanks for the tip about the reverse DNS. I now have the 
Kerberos/Negotiate auth working now that the reverse DNS lookup matches.

For HA/resiliency I'd like to be able to point the fallback LDAP basic 
auth + group lookup at multiple AD/LDAP servers.

I notice both basic_ldap_auth and ext_ldap_group_acl use the -H flag for 
LDAP URIs but I've been having problems getting it to work with anything 
other than a single named host. Specifying multiple hosts e.g. -H 
<A HREF="ldap://server1.domain:389">ldap://server1.domain:389</A> <A HREF="ldap://server2.domain:389">ldap://server2.domain:389</A> appears to work for 
a while but eventually starts failing with 'couldn't connect to LDAP 
server' errors and it appears to always hit the 1st named host.

I've also tried using a DN as described in the ldapsearch documentation:

&quot;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Specify&#160; URI(s)&#160; referring to the ldap server(s); a list 
of URI,
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; separated by whitespace or commas is expected; only the&#160; 
proto&#8208;
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; col/host/port&#160; fields&#160; are&#160; allowed.&#160;&#160; As&#160; an exception,&#160; 
if no
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; host/port is specified, but a DN is, the DN is used to&#160; 
look&#160; up
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; the&#160; corresponding&#160; host(s) using the DNS SRV records, 
according
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; to RFC 2782.&#160; The DN must be a non-empty sequence of 
AVAs&#160; whose
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; attribute&#160; type&#160; is &quot;dc&quot; (domain component), and must be 
escaped
 &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; according to RFC 2396&quot;


This works if I use ldapsearch e.g.

ldapsearch -b &quot;dc=ed,dc=ac,dc=uk&quot; -D &quot;CN=squiduser,DC=domain,DC=local&quot; 
-y /etc/squid/ldap_password 
&quot;(&amp;(objectClass=person)(sAMAccountName=mcairney))&quot; -Z -H 
<A HREF="ldap:///dc%3Ddomain%2Cdc%3Dlocal">ldap:///dc%3Ddomain%2Cdc%3Dlocal</A>

But if I use this LDAP URI with basic_ldap_auth I get&#160; 'Could not 
Activate TLS connection' errors and no clues in the logs/debug output.

Is this a known limitation of the squid utilities? If so, what are other 
people doing to provide HA/failover with their LDAP hosts (the only 
examples I can find in man pages/tutorials are the straightforward 
single LDAP host scenario).


Kind regards,

Mark


-- 
/****************************

Mark Cairney
ITI Enterprise Services
Information Services
University of Edinburgh

Tel: 0131 650 6565
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">Mark.Cairney at ed.ac.uk</A>

*******************************/

The University of Edinburgh is a charitable body, registered in Scotland, with registration number SC005336.

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="027615.html">[squid-users] WCCP and SSL-Bump with Squid 3.5 &#8212; HTTPS traffic not reaching Squid
</A></li>
	<LI>Next message (by thread): <A HREF="027624.html">[squid-users] is tls_outgoing_options cipher ignored in squid 7.1?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27623">[ date ]</a>
              <a href="thread.html#27623">[ thread ]</a>
              <a href="subject.html#27623">[ subject ]</a>
              <a href="author.html#27623">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
