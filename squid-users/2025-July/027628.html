<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] is tls_outgoing_options cipher ignored in squid 7.1?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20is%20tls_outgoing_options%20cipher%20ignored%20in%20squid%0A%207.1%3F&In-Reply-To=%3Ccc290c7e-e894-4b4a-8035-539192364272%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027624.html">
   <LINK REL="Next"  HREF="027625.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] is tls_outgoing_options cipher ignored in squid 7.1?</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20is%20tls_outgoing_options%20cipher%20ignored%20in%20squid%0A%207.1%3F&In-Reply-To=%3Ccc290c7e-e894-4b4a-8035-539192364272%40measurement-factory.com%3E"
       TITLE="[squid-users] is tls_outgoing_options cipher ignored in squid 7.1?">rousskov at measurement-factory.com
       </A><BR>
    <I>Fri Jul 25 21:44:24 UTC 2025</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="027624.html">[squid-users] is tls_outgoing_options cipher ignored in squid 7.1?
</A></li>
        <LI>Next message (by thread): <A HREF="027625.html">[squid-users] server-side FTP support
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27628">[ date ]</a>
              <a href="thread.html#27628">[ thread ]</a>
              <a href="subject.html#27628">[ subject ]</a>
              <a href="author.html#27628">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2025-07-25 05:13, Dieter Bloms wrote:
&gt;<i> Hello,
</I>&gt;<i> 
</I>&gt;<i> I'am running squid on debian bookworm with all patches.
</I>&gt;<i> I configured the following ciphers:
</I>&gt;<i> 
</I>&gt;<i> tls_outgoing_options cipher=TLSv1.2:!CBC:!kRSA:!DSS:!PSK:!aNULL:!ARIA:!CAMELLIA:!AESCCM:!SHA256:!<A HREF="https://lists.squid-cache.org/listinfo/squid-users">SHA384 at SECLEVEL</A>=2
</I>&gt;<i> 
</I>&gt;<i> With squid 6.13 I get the following ciphers list with the ssllab browser test: <A HREF="https://clienttest.ssllabs.com:8443/ssltest/viewMyClient.html">https://clienttest.ssllabs.com:8443/ssltest/viewMyClient.html</A>
</I>&gt;<i> 
</I>&gt;<i> TLS_AES_256_GCM_SHA384
</I>&gt;<i> TLS_CHACHA20_POLY1305_SHA256
</I>&gt;<i> TLS_AES_128_GCM_SHA256 (0x1301)
</I>&gt;<i> TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
</I>&gt;<i> TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
</I>&gt;<i> TLS_DHE_RSA_WITH_AES_256_GCM_SHA384
</I>&gt;<i> TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256
</I>&gt;<i> TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256
</I>&gt;<i> TLS_DHE_RSA_WITH_CHACHA20_POLY1305_SHA256
</I>&gt;<i> TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256
</I>&gt;<i> TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
</I>&gt;<i> TLS_DHE_RSA_WITH_AES_128_GCM_SHA256
</I>&gt;<i> TLS_EMPTY_RENEGOTIATION_INFO_SCSV
</I>&gt;<i> 
</I>&gt;<i> which look good to me, but when I run squid 7.1 on the same system with
</I>&gt;<i> the same config I get the following list:
</I>&gt;<i> 
</I>&gt;<i> TLS_AES_256_GCM_SHA384
</I>&gt;<i> TLS_CHACHA20_POLY1305_SHA256
</I>&gt;<i> TLS_AES_128_GCM_SHA256
</I>&gt;<i> TLS_RSA_WITH_AES_128_CBC_SHA
</I>&gt;<i> TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA
</I>&gt;<i> TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA
</I>&gt;<i> TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256
</I>&gt;<i> TLS_RSA_WITH_AES_256_CBC_SHA
</I>&gt;<i> TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
</I>&gt;<i> TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256
</I>&gt;<i> TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
</I>&gt;<i> TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
</I>&gt;<i> TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256
</I>&gt;<i> TLS_RSA_WITH_AES_256_GCM_SHA384
</I>&gt;<i> TLS_RSA_WITH_AES_128_GCM_SHA256
</I>&gt;<i> TLS_EMPTY_RENEGOTIATION_INFO_SCSV
</I>&gt;<i> 
</I>&gt;<i> which includes some weak ciphers like:
</I>&gt;<i> TLS_RSA_WITH_AES_128_CBC_SHA
</I>&gt;<i> TLS_RSA_WITH_AES_256_GCM_SHA384
</I>&gt;<i> ...
</I>&gt;<i> 
</I>&gt;<i> is this a bug, a feature or a mistake on my side?
</I>
Based on the information above, I cannot answer your question, but Squid 
should honor tls_outgoing_options except when peeking at or splicing TLS 
connections using the corresponding ssl_bump features. I know that at 
least some portions of tls_outgoing_options code worked when we were 
adding support for tls_outgoing_options_for_retries in 2023 (Draft PR 
#1456).

If you suspect a bug, please file a bug report after double checking 
that both tests use the same OpenSSL library and that there are no 
potentially related errors or warnings reported by either Squid at 
startup. In your bug report, if any, please share relevant parts of 
ssl_bump configuration (if you are using that feature for the affected 
connections).


Cheers,

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="027624.html">[squid-users] is tls_outgoing_options cipher ignored in squid 7.1?
</A></li>
	<LI>Next message (by thread): <A HREF="027625.html">[squid-users] server-side FTP support
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27628">[ date ]</a>
              <a href="thread.html#27628">[ thread ]</a>
              <a href="subject.html#27628">[ subject ]</a>
              <a href="author.html#27628">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
