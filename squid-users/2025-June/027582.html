<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Kerberos Auth weirdness/inconsistency when using CNAMEs/Round-robin DNS
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Kerberos%20Auth%20weirdness/inconsistency%20when%20using%0A%20CNAMEs/Round-robin%20DNS&In-Reply-To=%3Cff89be51-4159-480c-a108-c725c1abbe44%40ed.ac.uk%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027576.html">
   <LINK REL="Next"  HREF="027583.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Kerberos Auth weirdness/inconsistency when using CNAMEs/Round-robin DNS</H1>
    <B>Mark Cairney</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Kerberos%20Auth%20weirdness/inconsistency%20when%20using%0A%20CNAMEs/Round-robin%20DNS&In-Reply-To=%3Cff89be51-4159-480c-a108-c725c1abbe44%40ed.ac.uk%3E"
       TITLE="[squid-users] Kerberos Auth weirdness/inconsistency when using CNAMEs/Round-robin DNS">Mark.Cairney at ed.ac.uk
       </A><BR>
    <I>Mon Jun 23 10:15:43 UTC 2025</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="027576.html">[squid-users] Kerberos Auth weirdness/inconsistency when using CNAMEs/Round-robin DNS
</A></li>
        <LI>Next message (by thread): <A HREF="027583.html">[squid-users] Kerberos Auth weirdness/inconsistency when using CNAMEs/Round-robin DNS
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27582">[ date ]</a>
              <a href="thread.html#27582">[ thread ]</a>
              <a href="subject.html#27582">[ subject ]</a>
              <a href="author.html#27582">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

Thanks- that make sense and as a result I've set the reverse DNS on the 
2 hosts to the round-robin DNS name.

RE: the KVNO drift issue, one suggestion was to delete the existing 
machine account(s) from AD and use ktpass and set the kvno to 0.

I'd previously used msktutil (as suggested on 
<A HREF="https://wiki.squid-cache.org/ConfigExamples/Authenticate/WindowsActiveDirectory">https://wiki.squid-cache.org/ConfigExamples/Authenticate/WindowsActiveDirectory</A>) 
with the 'dont-expire-password' flag i.e:

msktutil -c -h test-squid-cluster.dyn.zone -b 'OU=Managed-Linux-Servers' 
--computer-name TESTSQUID -s HTTP/test-squid-cluster.dyn.zone -k 
/etc/squid/HTTP.keytab --server domain.controller --realm REALM 
--use-service-account --dont-expire-password --upn 
HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">test-squid-cluster.dyn.zone at REALM</A>

Which is more likely to be reliable (unfortunately I have to use MS AD 
as the whole purpose of this proxy is to allow Windows clients to use an 
authenticated proxy).

Kind regards,

Mark

On 19/06/2025 15:21, Amos Jeffries wrote:
&gt;<i> [You don't often get email from <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz.</A> Learn why this 
</I>&gt;<i> is important at <A HREF="https://aka.ms/LearnAboutSenderIdentification">https://aka.ms/LearnAboutSenderIdentification</A> ]
</I>&gt;<i>
</I>&gt;<i> On 18/06/25 20:49, Mark Cairney wrote:
</I>&gt;&gt;<i> Hi,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I&#8217;ve been trying to get Kerberos Authentication against AD working but
</I>&gt;&gt;<i> have been seeing inconsistent results/behaviour across multiple Oses and
</I>&gt;&gt;<i> I&#8217;m not sure if the issue lies with the DNS configuration, Kerberos
</I>&gt;&gt;<i> itself or with the Squid config:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> THE DNS setup is as follows:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> test.squid.cluster. 3600 IN&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; CNAME test-squid-
</I>&gt;&gt;<i> cluster.dyn-zone.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> test-squid-cluster.dyn-zone. 60 IN A 1.2.3.4
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Where 1.2.3.4 is the IP of one of the servers in the cluster. The
</I>&gt;&gt;<i> intention is to have multiple Squid servers behind a single DNS name for
</I>&gt;&gt;<i> high-availability.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> FYI, you cannot have multiple CNAME for test.squid.cluster pointing at
</I>&gt;<i> different Squid server names. So this should not be a problem.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> In Kerberos:
</I>&gt;<i> * Setup your keytab entry for HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">test-squid-cluster.dyn-zone at REALM.</A>
</I>&gt;<i> * export the HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">test-squid-cluster.dyn-zone at REALM</A> keytab to each proxy
</I>&gt;<i>
</I>&gt;<i> In DNS:
</I>&gt;<i> * Add as many proxy as you want to test-squid-cluster.dyn-zone with A or
</I>&gt;<i> AAAA records in DNS.
</I>&gt;<i> * point any domains you want those proxy to be acting as a CDN to
</I>&gt;<i> test-squid-cluster.dyn-zone using CNAME in DNS.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Cheers
</I>&gt;<i> Amos
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A> 
</I>&gt;<i>
</I>
-- 
/****************************

Mark Cairney
ITI Enterprise Services
Information Services
University of Edinburgh

Tel: 0131 650 6565
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">Mark.Cairney at ed.ac.uk</A>

*******************************/

The University of Edinburgh is a charitable body, registered in Scotland, with registration number SC005336.

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="027576.html">[squid-users] Kerberos Auth weirdness/inconsistency when using CNAMEs/Round-robin DNS
</A></li>
	<LI>Next message (by thread): <A HREF="027583.html">[squid-users] Kerberos Auth weirdness/inconsistency when using CNAMEs/Round-robin DNS
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27582">[ date ]</a>
              <a href="thread.html#27582">[ thread ]</a>
              <a href="subject.html#27582">[ subject ]</a>
              <a href="author.html#27582">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
