<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] windows updates
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20windows%20updates&In-Reply-To=%3CLV8PR13MB6557CCD08E037732B6ACAEF881C92%40LV8PR13MB6557.namprd13.prod.outlook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027482.html">
   <LINK REL="Next"  HREF="027505.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] windows updates</H1>
    <B>Doug Tucker</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20windows%20updates&In-Reply-To=%3CLV8PR13MB6557CCD08E037732B6ACAEF881C92%40LV8PR13MB6557.namprd13.prod.outlook.com%3E"
       TITLE="[squid-users] windows updates">doug.tucker at navigaglobal.com
       </A><BR>
    <I>Mon Mar  3 23:57:24 UTC 2025</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="027482.html">[squid-users] web page not updated
</A></li>
        <LI>Next message (by thread): <A HREF="027505.html">[squid-users] windows updates
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27484">[ date ]</a>
              <a href="thread.html#27484">[ thread ]</a>
              <a href="subject.html#27484">[ subject ]</a>
              <a href="author.html#27484">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I have read through everything I can find on this subject but still cannot seem to get around the issue of windows updates not working through the squid transparent proxy.  No matter what I try I continue to see this in the cache log and windows update will not connect.

2025/03/03 23:26:55 kid5| Error negotiating SSL on FD 25: error:14090086:SSL routines:ssl3_get_server_certificate:certificate verify failed (1/-1/0)

I tried adding the info from the following doc to no avail.

<A HREF="https://wiki.squid-cache.org/SquidFaq/WindowsUpdate">https://wiki.squid-cache.org/SquidFaq/WindowsUpdate</A>


The relevant parts of my squid.conf:

#Handling HTTPS requests
https_port 3130 cert=/etc/squid/ssl/squid.pem ssl-bump intercept
acl SSL_port port 443
http_access allow SSL_port
acl allowed_https_sites ssl::server_name &quot;/etc/squid/allowed-sites.txt&quot;
acl step1 at_step SslBump1
acl step2 at_step SslBump2
acl step3 at_step SslBump3
ssl_bump peek step1 all
ssl_bump peek step2 allowed_https_sites
ssl_bump splice step3 allowed_https_sites
ssl_bump terminate step2 all

#windows update
acl DiscoverSNIHost at_step SslBump1
acl NoSSLIntercept ssl::server_name_regex -i &quot;/etc/squid/url.nobump&quot;
ssl_bump splice NoSSLIntercept
ssl_bump peek DiscoverSNIHost
ssl_bump bump all

I ran tcpdump and added every url i could find to the allowed-sites.txt and added the 2 sites recommended tot he url.nobump.  If anyone has gotten this to work any help would be appreciated.







Doug Tucker
Sr. Director of Networking and Linux Operations

o: 817.975.5832
e: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">doug.tucker at navigaglobal.com</A>


Newscycle Solutions is now Naviga. Learn more.


CONFIDENTIALITY NOTICE: The contents of this email message and any attachments are intended solely for the addressee(s) and may contain confidential and/or privileged information and may be legally protected from disclosure. If you are not the intended recipient of this message or their agent, or if this message has been addressed to you in error, please immediately alert the sender by reply email and then delete this message and any attachments. If you are not the intended recipient, you are hereby notified that any use, dissemination, copying, or storage of this message or its attachments is strictly prohibite

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20250303/0c332d07/attachment-0001.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20250303/0c332d07/attachment-0001.htm</A>&gt;
</PRE>



















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="027482.html">[squid-users] web page not updated
</A></li>
	<LI>Next message (by thread): <A HREF="027505.html">[squid-users] windows updates
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27484">[ date ]</a>
              <a href="thread.html#27484">[ thread ]</a>
              <a href="subject.html#27484">[ subject ]</a>
              <a href="author.html#27484">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
