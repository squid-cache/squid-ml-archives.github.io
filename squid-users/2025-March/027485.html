<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] ACL block_user List
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ACL%20block_user%20List&In-Reply-To=%3Ce7fd33c02baa47649f464dc99cb659f1%40hexcel.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027480.html">
   <LINK REL="Next"  HREF="027488.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] ACL block_user List</H1>
    <B>Piana, Josh</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ACL%20block_user%20List&In-Reply-To=%3Ce7fd33c02baa47649f464dc99cb659f1%40hexcel.com%3E"
       TITLE="[squid-users] ACL block_user List">Josh.Piana at hexcel.com
       </A><BR>
    <I>Tue Mar  4 21:42:20 UTC 2025</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="027480.html">[squid-users] ACL block_user List
</A></li>
        <LI>Next message (by thread): <A HREF="027488.html">[squid-users] ACL block_user List
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27485">[ date ]</a>
              <a href="thread.html#27485">[ thread ]</a>
              <a href="subject.html#27485">[ subject ]</a>
              <a href="author.html#27485">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey Amos, 

I apologize to show one issue, but now reference another. We decided to not use the &quot;block_user&quot; list as it&#8217;s a bit dated. A similar issue is happening now with our &quot;mmedia_users&quot; list. It just doesn't seem to work the way its intended. 

Users on this list are supposed to be allowed special access to sites we typically block. Such as Youtube, Reddit, Facebook, etc. Well as of right now, any changes made to the list don't seem to impact the user having access to those sites or not. 

Here's how we have it written:

# these override the general blacklists by explicitly allowing things
# exempts users from content blocking in this list
acl mmedia_users proxy_auth_regex -i &quot;/etc/squid/mmedia_users&quot;

# allow exempted users to the sites in this list
acl mmedia_sites dstdomain &quot;/etc/squid/mmedia_sites&quot;

# allow mmedia user to access a mmedia site, via appropriate protocols
http_access allow mmedia_sites mmedia_users

So if the user is on the &quot;mmedia_users&quot; list, they can access sites that are a part of the &quot;mmedia_sites&quot; list. 





-----Original Message-----
From: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; On Behalf Of Amos Jeffries
Sent: Saturday, March 1, 2025 3:31 AM
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] ACL block_user List

Caution: This email originated from outside of Hexcel. Do not click links or open attachments unless you recognize the sender and know the content is safe.


On 1/03/25 03:54, Piana, Josh wrote:
&gt;<i> Hello,
</I>&gt;<i>
</I>&gt;<i> I am attempting to setup an ACL block list based on usernames from a 
</I>&gt;<i> windows AD environment.
</I>&gt;<i>
</I>&gt;<i> When I have this added to my squid.conf file, all outbound connections 
</I>&gt;<i> stop working:
</I>&gt;<i>
</I>&gt;<i> acl block_user proxy_auth_regex -i &quot;/etc/squid/block_user&quot;
</I>&gt;<i>
</I>&gt;<i> http_access deny block_user
</I>&gt;<i>
</I>&gt;<i> I have also tried &#8220;!block_user&#8221;.
</I>
Was that &quot;NOT MATCHING block_user&quot; condition used with allow or deny action?

What prior or followup http_access lines are processed when that ACL check results in &quot;need login&quot; due to lack of username value?

&gt;<i>
</I>&gt;<i> As you can see, I have it set so if a Windows username is on the 
</I>&gt;<i> &#8220;block_user&#8221; list, Squid will deny internet access to that user.
</I>&gt;<i> Unfortunately, this doesn&#8217;t work in practice. I have a working 
</I>&gt;<i> Kerberos back-end setup, handling authentication. What am I doing 
</I>&gt;<i> wrong with this setup?
</I>&gt;<i>
</I>
1) The block_user ACL you have defined is a Regular Expression test against the username, not a check of the exact username. So you need to be very careful of the specific regex patterns you are using.

(If you want me to check validity, you can post to be directly here, do not post actual value to this public list).

2) The block_user ACL implicitly requires authentication to have been performed before it can perform its check. Check your auth_param settings, and prior proxy_auth type ACL that perform the login.


HTH
Amos
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">https://lists.squid-cache.org/listinfo/squid-users</A>
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="027480.html">[squid-users] ACL block_user List
</A></li>
	<LI>Next message (by thread): <A HREF="027488.html">[squid-users] ACL block_user List
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27485">[ date ]</a>
              <a href="thread.html#27485">[ thread ]</a>
              <a href="subject.html#27485">[ subject ]</a>
              <a href="author.html#27485">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
