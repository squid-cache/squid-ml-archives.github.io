[From nobody Thu Jan  9 08:27:11 2025
X-Envelope-From: &lt;squid@visolve.com&gt;
X-Envelope-To: &lt;squid-users@lists.squid-cache.org&gt;
Received: from mail.visolve.com (unknown)
 by lists.squid-cache.org(Postfix 2.11.0/8.13.0) with SMTP id unknown
 Sat, 04 Oct 2014 11:12:45 +0000 (envelope-from &lt;squid@visolve.com&gt;
Received: from ViMF (mail.visolve.com [173.11.74.250])
 by mail.visolve.com (Postfix) with ESMTPA id 2CEB240F5
 for &lt;squid-users@lists.squid-cache.org&gt;; Sat,  4 Oct 2014 04:12:41 -0700 (PDT)
Received: from [192.168.34.128] ([182.73.50.82] helo=[192.168.34.128]) by
 ViMF with ESMTP (ASSP 1.9); 4 Oct 2014 04:12:34 -0700
Message-ID: &lt;542FD522.3030003@visolve.com&gt;
Date: Sat, 04 Oct 2014 16:38:18 +0530
From: Visolve Squid &lt;squid@visolve.com&gt;
User-Agent: Mozilla/5.0 (Windows NT 6.1;
 rv:24.0) Gecko/20100101 Thunderbird/24.1.0
MIME-Version: 1.0
To: squid-users@lists.squid-cache.org
Subject: Re: [squid-users] redirect all ports to squid
References: &lt;DUB123-DS15337FBB7B90E43B736C7EB3BB0@phx.gbl&gt;
In-Reply-To: &lt;DUB123-DS15337FBB7B90E43B736C7EB3BB0@phx.gbl&gt;
Content-Type: multipart/alternative;
 boundary=&quot;------------050308090901070909080800&quot;

This is a multi-part message in MIME format.
--------------050308090901070909080800
Content-Type: text/plain; charset=UTF-8; format=flowed
Content-Transfer-Encoding: 7bit

Hi,

Yes, we can redirect the ports to squid through our firewall rules.

Check below lines to redirect the ports.
We have some different methods to do.
1. In first Method:
     First, we need to machine that squid will be running on, You do not 
need iptables or any special kernel options on this machine, just squid. 
You *will*, however, need the 'http_accel' options as described above.

     You'll want to use the following set of commands on iptables-box:

  * iptables -t nat -A PREROUTING -i eth0 -s ! *squid-box* -p tcp
    --dport 80 -j DNAT --to *squid-box*:3128
  * iptables -t nat -A POSTROUTING -o eth0 -s *local-network* -d
    *squid-box* -j SNAT --to *iptables-box*
  * iptables -A FORWARD -s *local-network* -d *squid-box* -i eth0 -o
    eth0 -p tcp --dport 3128 -j ACCEPT

2. And have another method:

  * iptables -t mangle -A PREROUTING -j ACCEPT -p tcp --dport 80 -s
    *squid-box*
  * iptables -t mangle -A PREROUTING -j MARK --set-mark 3 -p tcp --dport 80
  * ip rule add fwmark 3 table 2
  * ip route add default via *squid-box* dev eth1 table 2

         (OR)

     iptables -A PREROUTING -t nat -i eth0 -p tcp --dport 80 -j REDIRECT 
--to-port 3128

Regards,
Visolve Squid

On 9/30/2014 10:11 PM, hadi wrote:
&gt; It's possible to redirect all ports to squid ? thru iptables ?
&gt; For example port 25 smtp,143 imap, etc...
&gt; Can squid handle that. In transparent mode.
&gt;
&gt;
&gt; _______________________________________________
&gt; squid-users mailing list
&gt; squid-users@lists.squid-cache.org
&gt; http://lists.squid-cache.org/listinfo/squid-users


--------------050308090901070909080800
Content-Type: text/html; charset=UTF-8
Content-Transfer-Encoding: 8bit

&lt;html&gt;
  &lt;head&gt;
    &lt;meta content=&quot;text/html; charset=UTF-8&quot; http-equiv=&quot;Content-Type&quot;&gt;
  &lt;/head&gt;
  &lt;body bgcolor=&quot;#FFFFFF&quot; text=&quot;#000000&quot;&gt;
    Hi,&lt;br&gt;
    &lt;br&gt;
    Yes, we can redirect the ports to squid through our firewall rules.&lt;br&gt;
    &lt;br&gt;
    Check below lines to redirect the ports.&lt;br&gt;
    We have some different methods to do.&lt;br&gt;
    1. In first Method:&lt;br&gt;
        First, we need to machine that squid will be running on, You do
    not need iptables or any special kernel options on this machine,
    just squid. You *will*, however, need the 'http_accel' options as
    described above.&lt;br&gt;
    &lt;br&gt;
        You'll want to use the following set of commands on
    iptables-box:
    &lt;ul&gt;
      &lt;li&gt;iptables -t nat -A PREROUTING -i eth0 -s ! &lt;b&gt;squid-box&lt;/b&gt;
        -p tcp --dport 80 -j DNAT --to &lt;b&gt;squid-box&lt;/b&gt;:3128&lt;/li&gt;
      &lt;li&gt;iptables -t nat -A POSTROUTING -o eth0 -s &lt;b&gt;local-network&lt;/b&gt;
        -d &lt;b&gt;squid-box&lt;/b&gt; -j SNAT --to &lt;b&gt;iptables-box&lt;/b&gt;&lt;/li&gt;
      &lt;li&gt;iptables -A FORWARD -s &lt;b&gt;local-network&lt;/b&gt; -d &lt;b&gt;squid-box&lt;/b&gt;
        -i eth0 -o eth0 -p tcp --dport 3128 -j ACCEPT&lt;/li&gt;
    &lt;/ul&gt;
    &lt;p&gt;2. And have another method:&lt;br&gt;
    &lt;/p&gt;
    &lt;ul&gt;
      &lt;li&gt;iptables -t mangle -A PREROUTING -j ACCEPT -p tcp --dport 80
        -s &lt;b&gt;squid-box&lt;/b&gt;&lt;/li&gt;
      &lt;li&gt;iptables -t mangle -A PREROUTING -j MARK --set-mark 3 -p tcp
        --dport 80&lt;/li&gt;
      &lt;li&gt;ip rule add fwmark 3 table 2&lt;/li&gt;
      &lt;li&gt;ip route add default via &lt;b&gt;squid-box&lt;/b&gt; dev eth1 table 2&lt;/li&gt;
    &lt;/ul&gt;
    &lt;p&gt;        (OR)&lt;/p&gt;
    &lt;p&gt;    iptables -A PREROUTING -t nat -i eth0 -p tcp --dport 80 -j
      REDIRECT --to-port 3128&lt;/p&gt;
    Regards,&lt;br&gt;
    Visolve Squid&lt;br&gt;
    &lt;br&gt;
    &lt;div class=&quot;moz-cite-prefix&quot;&gt;On 9/30/2014 10:11 PM, hadi wrote:&lt;br&gt;
    &lt;/div&gt;
    &lt;blockquote cite=&quot;mid:DUB123-DS15337FBB7B90E43B736C7EB3BB0@phx.gbl&quot;
      type=&quot;cite&quot;&gt;
      &lt;pre wrap=&quot;&quot;&gt;It's possible to redirect all ports to squid ? thru iptables ?
For example port 25 smtp,143 imap, etc...
Can squid handle that. In transparent mode.

&lt;/pre&gt;
    &lt;/blockquote&gt;
    &lt;blockquote cite=&quot;mid:DUB123-DS15337FBB7B90E43B736C7EB3BB0@phx.gbl&quot;
      type=&quot;cite&quot;&gt;
      &lt;fieldset class=&quot;mimeAttachmentHeader&quot;&gt;&lt;/fieldset&gt;
      &lt;br&gt;
      &lt;pre wrap=&quot;&quot;&gt;_______________________________________________
squid-users mailing list
&lt;a class=&quot;moz-txt-link-abbreviated&quot; href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;
&lt;a class=&quot;moz-txt-link-freetext&quot; href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;
&lt;/pre&gt;
    &lt;/blockquote&gt;
    &lt;br&gt;
  &lt;/body&gt;
&lt;/html&gt;

--------------050308090901070909080800--
]