<tt>
&lt;html&gt;<br>
&nbsp;&nbsp;&lt;head&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;content=&quot;text/html;&nbsp;charset=UTF-8&quot;&nbsp;http-equiv=&quot;Content-Type&quot;&gt;<br>
&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&lt;body&nbsp;bgcolor=&quot;#FFFFFF&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Hi,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Yes,&nbsp;we&nbsp;can&nbsp;redirect&nbsp;the&nbsp;ports&nbsp;to&nbsp;squid&nbsp;through&nbsp;our&nbsp;firewall&nbsp;rules.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Check&nbsp;below&nbsp;lines&nbsp;to&nbsp;redirect&nbsp;the&nbsp;ports.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;We&nbsp;have&nbsp;some&nbsp;different&nbsp;methods&nbsp;to&nbsp;do.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;1.&nbsp;In&nbsp;first&nbsp;Method:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;   &nbsp;First,&nbsp;we&nbsp;need&nbsp;to&nbsp;machine&nbsp;that&nbsp;squid&nbsp;will&nbsp;be&nbsp;running&nbsp;on,&nbsp;You&nbsp;do<br>
&nbsp;&nbsp;&nbsp;&nbsp;not&nbsp;need&nbsp;iptables&nbsp;or&nbsp;any&nbsp;special&nbsp;kernel&nbsp;options&nbsp;on&nbsp;this&nbsp;machine,<br>
&nbsp;&nbsp;&nbsp;&nbsp;just&nbsp;squid.&nbsp;You&nbsp;*will*,&nbsp;however,&nbsp;need&nbsp;the&nbsp;'http_accel'&nbsp;options&nbsp;as<br>
&nbsp;&nbsp;&nbsp;&nbsp;described&nbsp;above.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;   &nbsp;You'll&nbsp;want&nbsp;to&nbsp;use&nbsp;the&nbsp;following&nbsp;set&nbsp;of&nbsp;commands&nbsp;on<br>
&nbsp;&nbsp;&nbsp;&nbsp;iptables-box:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;ul&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;li&gt;iptables&nbsp;-t&nbsp;nat&nbsp;-A&nbsp;PREROUTING&nbsp;-i&nbsp;eth0&nbsp;-s&nbsp;!&nbsp;&lt;b&gt;squid-box&lt;/b&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-p&nbsp;tcp&nbsp;--dport&nbsp;80&nbsp;-j&nbsp;DNAT&nbsp;--to&nbsp;&lt;b&gt;squid-box&lt;/b&gt;:3128&lt;/li&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;li&gt;iptables&nbsp;-t&nbsp;nat&nbsp;-A&nbsp;POSTROUTING&nbsp;-o&nbsp;eth0&nbsp;-s&nbsp;&lt;b&gt;local-network&lt;/b&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-d&nbsp;&lt;b&gt;squid-box&lt;/b&gt;&nbsp;-j&nbsp;SNAT&nbsp;--to&nbsp;&lt;b&gt;iptables-box&lt;/b&gt;&lt;/li&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;li&gt;iptables&nbsp;-A&nbsp;FORWARD&nbsp;-s&nbsp;&lt;b&gt;local-network&lt;/b&gt;&nbsp;-d&nbsp;&lt;b&gt;squid-box&lt;/b&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-i&nbsp;eth0&nbsp;-o&nbsp;eth0&nbsp;-p&nbsp;tcp&nbsp;--dport&nbsp;3128&nbsp;-j&nbsp;ACCEPT&lt;/li&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/ul&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;2.&nbsp;And&nbsp;have&nbsp;another&nbsp;method:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;ul&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;li&gt;iptables&nbsp;-t&nbsp;mangle&nbsp;-A&nbsp;PREROUTING&nbsp;-j&nbsp;ACCEPT&nbsp;-p&nbsp;tcp&nbsp;--dport&nbsp;80<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-s&nbsp;&lt;b&gt;squid-box&lt;/b&gt;&lt;/li&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;li&gt;iptables&nbsp;-t&nbsp;mangle&nbsp;-A&nbsp;PREROUTING&nbsp;-j&nbsp;MARK&nbsp;--set-mark&nbsp;3&nbsp;-p&nbsp;tcp<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--dport&nbsp;80&lt;/li&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;li&gt;ip&nbsp;rule&nbsp;add&nbsp;fwmark&nbsp;3&nbsp;table&nbsp;2&lt;/li&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;li&gt;ip&nbsp;route&nbsp;add&nbsp;default&nbsp;via&nbsp;&lt;b&gt;squid-box&lt;/b&gt;&nbsp;dev&nbsp;eth1&nbsp;table&nbsp;2&lt;/li&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/ul&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;   &nbsp;   &nbsp;(OR)&lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;   &nbsp;iptables&nbsp;-A&nbsp;PREROUTING&nbsp;-t&nbsp;nat&nbsp;-i&nbsp;eth0&nbsp;-p&nbsp;tcp&nbsp;--dport&nbsp;80&nbsp;-j<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REDIRECT&nbsp;--to-port&nbsp;3128&lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Regards,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Visolve&nbsp;Squid&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;class=&quot;moz-cite-prefix&quot;&gt;On&nbsp;9/30/2014&nbsp;10:11&nbsp;PM,&nbsp;hadi&nbsp;wrote:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;cite=&quot;mid:DUB123-DS15337FBB7B90E43B736C7EB3BB0@phx.gbl&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;It's&nbsp;possible&nbsp;to&nbsp;redirect&nbsp;all&nbsp;ports&nbsp;to&nbsp;squid&nbsp;?&nbsp;thru&nbsp;iptables&nbsp;?<br>
For&nbsp;example&nbsp;port&nbsp;25&nbsp;smtp,143&nbsp;imap,&nbsp;etc...<br>
Can&nbsp;squid&nbsp;handle&nbsp;that.&nbsp;In&nbsp;transparent&nbsp;mode.<br>
<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;cite=&quot;mid:DUB123-DS15337FBB7B90E43B736C7EB3BB0@phx.gbl&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;_______________________________________________<br>
squid-users&nbsp;mailing&nbsp;list<br>
&lt;a&nbsp;class=&quot;moz-txt-link-abbreviated&quot;&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;<br>
&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
