<tt>
&lt;html&gt;<br>
&lt;head&gt;<br>
&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=iso-8859-1&quot;&gt;<br>
&lt;style&nbsp;type=&quot;text/css&quot;&nbsp;style=&quot;display:none&quot;&gt;&lt;!--&nbsp;p&nbsp;{&nbsp;margin-top:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;}--&gt;&lt;/style&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;dir=&quot;ltr&quot;&nbsp;style=&quot;font-size:12pt;color:#000000;background-color:#FFFFFF;font-family:Calibri,Arial,Helvetica,sans-serif;&quot;&gt;<br>
&lt;p&gt;Hello&nbsp;Strudel,&lt;br&gt;<br>
&lt;/p&gt;<br>
&lt;p&gt;&lt;br&gt;<br>
&lt;/p&gt;<br>
&lt;p&gt;Please&nbsp;remove&nbsp;the&nbsp;'&lt;span&nbsp;style=&quot;color:&nbsp;rgb(33,&nbsp;33,&nbsp;33);&nbsp;font-family:&nbsp;Calibri,&nbsp;Arial,&nbsp;Helvetica,&nbsp;sans-serif;&nbsp;font-size:&nbsp;15.5555562973022px;&nbsp;background-color:&nbsp;rgb(255,&nbsp;255,&nbsp;255);&quot;&gt;ssl_bump&nbsp;client-first&nbsp;all&lt;/span&gt;'&nbsp;directive&nbsp;from&nbsp;your&nbsp;squid.conf&nbsp;because&nbsp;the<br>
&nbsp;'&lt;span&nbsp;style=&quot;color:&nbsp;rgb(33,&nbsp;33,&nbsp;33);&nbsp;font-family:&nbsp;Calibri,&nbsp;Arial,&nbsp;Helvetica,&nbsp;sans-serif;&nbsp;font-size:&nbsp;15.5555562973022px;&nbsp;background-color:&nbsp;rgb(255,&nbsp;255,&nbsp;255);&quot;&gt;include&nbsp;&quot;/opt/qlproxy/etc/squid/squid.acl&quot;'&nbsp;already&nbsp;contains&nbsp;'&lt;/span&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;12pt;&quot;&gt;ssl_bump<br>
&nbsp;server-first&nbsp;all'&nbsp;(or&nbsp;should&nbsp;contain).&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;12pt;&quot;&gt;&lt;br&gt;<br>
&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;12pt;&quot;&gt;This&nbsp;file&nbsp;is&nbsp;generated&nbsp;from&nbsp;Web&nbsp;UI&nbsp;of&nbsp;Diladele&nbsp;when&nbsp;you&nbsp;click&nbsp;the&nbsp;&quot;enable&nbsp;ssh&nbsp;filteiring&nbsp;for&nbsp;all&nbsp;sites&quot;&nbsp;settings.&nbsp;By&nbsp;default&nbsp;though&nbsp;it&nbsp;is&nbsp;set&nbsp;to&nbsp;'off'&nbsp;to&nbsp;comply&nbsp;with&nbsp;legal&nbsp;regulations&nbsp;in&nbsp;some&nbsp;countries.&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;12pt;&quot;&gt;&lt;br&gt;<br>
&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;12pt;&quot;&gt;It&nbsp;would&nbsp;also&nbsp;be&nbsp;nice&nbsp;if&nbsp;you&nbsp;could&nbsp;post&nbsp;the&nbsp;contents&nbsp;of&nbsp;it&nbsp;either&nbsp;here&nbsp;or&nbsp;in&nbsp;private&nbsp;e-mail&nbsp;to&nbsp;me&nbsp;not&nbsp;to&nbsp;pollute&nbsp;the&nbsp;overall&nbsp;discussion.&nbsp;&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;12pt;&quot;&gt;&lt;br&gt;<br>
&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;12pt;&quot;&gt;Best&nbsp;regards,&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;12pt;&quot;&gt;Rafael&nbsp;Akchurin&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;12pt;&quot;&gt;Diladele&nbsp;B.V.&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;12pt;&quot;&gt;&lt;br&gt;<br>
&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;12pt;&quot;&gt;&lt;br&gt;<br>
&lt;/span&gt;&lt;/p&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(33,&nbsp;33,&nbsp;33);&quot;&gt;<br>
&lt;hr&nbsp;tabindex=&quot;-1&quot;&nbsp;style=&quot;display:inline-block;&nbsp;width:98%&quot;&gt;<br>
&lt;div&nbsp;id=&quot;divRplyFwdMsg&quot;&nbsp;dir=&quot;ltr&quot;&gt;&lt;font&nbsp;face=&quot;Calibri,&nbsp;sans-serif&quot;&nbsp;color=&quot;#000000&quot;&nbsp;style=&quot;font-size:11pt&quot;&gt;&lt;b&gt;From:&lt;/b&gt;&nbsp;squid-users&nbsp;&lt;squid-users-bounces@lists.squid-cache.org&gt;&nbsp;on&nbsp;behalf&nbsp;of&nbsp;apfelstrudel&nbsp;&lt;apfelstrudel@op.pl&gt;&lt;br&gt;<br>
&lt;b&gt;Sent:&lt;/b&gt;&nbsp;Thursday,&nbsp;October&nbsp;16,&nbsp;2014&nbsp;10:13&nbsp;AM&lt;br&gt;<br>
&lt;b&gt;To:&lt;/b&gt;&nbsp;squid-users@squid-cache.org&lt;br&gt;<br>
&lt;b&gt;Subject:&lt;/b&gt;&nbsp;[squid-users]&nbsp;ssl-bump&nbsp;doesn't&nbsp;decrypt&nbsp;https&nbsp;traffic&nbsp;-&nbsp;please&nbsp;help&lt;/font&gt;<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;<br>
&lt;div&gt;Hello.&lt;/div&gt;<br>
&lt;div&gt;I&nbsp;am&nbsp;trying&nbsp;to&nbsp;get&nbsp;ssl-bump&nbsp;to&nbsp;decrypt&nbsp;https&nbsp;traffic&nbsp;transparently&nbsp;so&nbsp;that&nbsp;I&nbsp;could&nbsp;filter&nbsp;out&nbsp;adult&nbsp;videos&nbsp;from&nbsp;youtube&nbsp;and&nbsp;to&nbsp;globally&nbsp;enforce&nbsp;google&nbsp;safesearch&nbsp;on&nbsp;my&nbsp;network&nbsp;with&nbsp;diladele&nbsp;web&nbsp;safety.&nbsp;I&nbsp;also&nbsp;want&nbsp;to&nbsp;run&nbsp;dansguardian&nbsp;to&nbsp;filter&nbsp;http.&nbsp;I<br>
&nbsp;managed&nbsp;to&nbsp;pass&nbsp;https&nbsp;traffic&nbsp;transparently&nbsp;to&nbsp;squid&nbsp;but&nbsp;ssl-bump&nbsp;doesn't&nbsp;decrypt&nbsp;it.&nbsp;In&nbsp;logs&nbsp;I&nbsp;can&nbsp;see&nbsp;the&nbsp;https&nbsp;websites&nbsp;but&nbsp;in&nbsp;an&nbsp;encrypted&nbsp;form&nbsp;of&nbsp;website's.ip.address:port&nbsp;(45.231.21.56:443&nbsp;for&nbsp;example)&nbsp;instead&nbsp;of&nbsp;https&nbsp;url&nbsp;(like&nbsp;https://youtube.com).<br>
&nbsp;That&nbsp;means&nbsp;that&nbsp;traffic&nbsp;is&nbsp;still&nbsp;encrypted&nbsp;and&nbsp;because&nbsp;of&nbsp;that,&nbsp;diladele&nbsp;can't&nbsp;filter&nbsp;https.&nbsp;The&nbsp;squid&nbsp;is&nbsp;installed&nbsp;on&nbsp;an&nbsp;eee&nbsp;pc&nbsp;netbook&nbsp;with&nbsp;fedora&nbsp;20&nbsp;installed.&nbsp;This&nbsp;machine&nbsp;is&nbsp;also&nbsp;my&nbsp;router&nbsp;and&nbsp;a&nbsp;network&nbsp;gateway.&nbsp;172.16.34.254&nbsp;is&nbsp;the&nbsp;ip&nbsp;on&nbsp;which&nbsp;the&nbsp;netbook<br>
&nbsp;&quot;sees&quot;&nbsp;the&nbsp;internal&nbsp;network,&nbsp;which&nbsp;consists&nbsp;of:&nbsp;1&nbsp;tp-link&nbsp;router&nbsp;directly&nbsp;connected&nbsp;to&nbsp;the&nbsp;eee.&nbsp;Thas&nbsp;router&nbsp;is&nbsp;connected&nbsp;wirelessly&nbsp;(Wi-Fi&nbsp;antenna)&nbsp;to&nbsp;the&nbsp;second&nbsp;TP-Link&nbsp;router&nbsp;(bridge)&nbsp;in&nbsp;my&nbsp;house.&nbsp;The&nbsp;bridge&nbsp;router&nbsp;is&nbsp;then&nbsp;connected&nbsp;by&nbsp;an&nbsp;ethernet&nbsp;cable<br>
&nbsp;to&nbsp;another&nbsp;router&nbsp;to&nbsp;which&nbsp;my&nbsp;devices&nbsp;finally&nbsp;(phone,&nbsp;tablet,&nbsp;pc,&nbsp;printer)&nbsp;connect.&nbsp;So&nbsp;in&nbsp;summary:&nbsp;&nbsp;My&nbsp;device&nbsp;(PC,&nbsp;tablet,&nbsp;phone)&nbsp;----&gt;&nbsp;Router&nbsp;(Netgear)&nbsp;&nbsp;----&gt;&nbsp;TP-Link&nbsp;Bridge&nbsp;Router&nbsp;------&gt;&nbsp;Router&nbsp;(TP-Link)&nbsp;----&gt;&nbsp;Network&nbsp;gateway/router&nbsp;(eee&nbsp;pc&nbsp;running&nbsp;fedora<br>
&nbsp;20)&nbsp;with&nbsp;squid&nbsp;installed.&nbsp;With&nbsp;the&nbsp;current&nbsp;configuration&nbsp;dansguardian&nbsp;works&nbsp;(http),&nbsp;diladele&nbsp;web&nbsp;safety&nbsp;works&nbsp;(only&nbsp;http)&nbsp;and&nbsp;the&nbsp;https&nbsp;traffic&nbsp;is&nbsp;passed&nbsp;transparently&nbsp;through&nbsp;squid,&nbsp;but&nbsp;not&nbsp;decrypted:&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
&lt;div&gt;172.16.34.253&nbsp;TCP_MISS/301&nbsp;848&nbsp;GET&nbsp;http://pl-pl.facebook.com/&nbsp;-&nbsp;HIER_DIRECT/31.13.93.97&nbsp;text/html&lt;br&gt;<br>
172.16.34.254&nbsp;TCP_MISS/200&nbsp;50622&nbsp;CONNECT&nbsp;2.22.52.26:443&nbsp;-&nbsp;HIER_DIRECT/2.22.52.26&nbsp;-&nbsp;&nbsp;&lt;-----&nbsp;this&nbsp;should&nbsp;be&nbsp;https://pl-pl.facebook.com&nbsp;but&nbsp;ssl-bump&nbsp;doesn't&nbsp;decrypt&nbsp;traffic.&lt;br&gt;<br>
&nbsp;&lt;/div&gt;<br>
&lt;div&gt;The&nbsp;IP&nbsp;addresses&nbsp;on&nbsp;the&nbsp;beginning&nbsp;of&nbsp;each&nbsp;line&nbsp;are&nbsp;different&nbsp;because&nbsp;http&nbsp;requests&nbsp;go&nbsp;from&nbsp;dansguardian&nbsp;internally.&nbsp;The&nbsp;https&nbsp;requests&nbsp;go&nbsp;directly&nbsp;from&nbsp;my&nbsp;internal&nbsp;network.&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
&lt;div&gt;Here's&nbsp;my&nbsp;squid.conf:&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
acl&nbsp;localnet&nbsp;src&nbsp;10.0.0.0/8&nbsp;#&nbsp;RFC1918&nbsp;possible&nbsp;internal&nbsp;network&lt;br&gt;<br>
acl&nbsp;localnet&nbsp;src&nbsp;172.16.0.0/12&nbsp;#&nbsp;RFC1918&nbsp;possible&nbsp;internal&nbsp;network&lt;br&gt;<br>
acl&nbsp;localnet&nbsp;src&nbsp;192.168.0.0/16&nbsp;#&nbsp;RFC1918&nbsp;possible&nbsp;internal&nbsp;network&lt;br&gt;<br>
acl&nbsp;localnet&nbsp;src&nbsp;fc00::/7&nbsp;#&nbsp;RFC&nbsp;4193&nbsp;local&nbsp;private&nbsp;network&nbsp;range&lt;br&gt;<br>
acl&nbsp;localnet&nbsp;src&nbsp;fe80::/10&nbsp;#&nbsp;RFC&nbsp;4291&nbsp;link-local&nbsp;(directly&nbsp;plugged)&nbsp;machines&lt;br&gt;<br>
acl&nbsp;to_localhost&nbsp;dst&nbsp;127.0.0.1/8&lt;br&gt;<br>
&lt;br&gt;<br>
acl&nbsp;SSL_ports&nbsp;port&nbsp;443&lt;br&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;80&nbsp;#&nbsp;http&lt;br&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;21&nbsp;#&nbsp;ftp&lt;br&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;443&nbsp;#&nbsp;https&lt;br&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;70&nbsp;#&nbsp;gopher&lt;br&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;210&nbsp;#&nbsp;wais&lt;br&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;1025-65535&nbsp;#&nbsp;unregistered&nbsp;ports&lt;br&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;280&nbsp;#&nbsp;http-mgmt&lt;br&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;488&nbsp;#&nbsp;gss-http&lt;br&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;591&nbsp;#&nbsp;filemaker&lt;br&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;777&nbsp;#&nbsp;multiling&nbsp;http&lt;br&gt;<br>
acl&nbsp;CONNECT&nbsp;method&nbsp;CONNECT&lt;br&gt;<br>
&lt;br&gt;<br>
#&nbsp;Deny&nbsp;requests&nbsp;to&nbsp;certain&nbsp;unsafe&nbsp;ports&lt;br&gt;<br>
http_access&nbsp;deny&nbsp;!Safe_ports&lt;br&gt;<br>
&lt;br&gt;<br>
#&nbsp;Deny&nbsp;CONNECT&nbsp;to&nbsp;other&nbsp;than&nbsp;secure&nbsp;SSL&nbsp;ports&lt;br&gt;<br>
http_access&nbsp;deny&nbsp;CONNECT&nbsp;!SSL_ports&lt;br&gt;<br>
&lt;br&gt;<br>
#&nbsp;Only&nbsp;allow&nbsp;cachemgr&nbsp;access&nbsp;from&nbsp;localhost&lt;br&gt;<br>
http_access&nbsp;allow&nbsp;localhost&nbsp;manager&lt;br&gt;<br>
http_access&nbsp;deny&nbsp;manager&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;http_access&nbsp;allow&nbsp;localnet&lt;br&gt;<br>
http_access&nbsp;allow&nbsp;localhost&lt;br&gt;<br>
&lt;br&gt;<br>
#&nbsp;And&nbsp;finally&nbsp;deny&nbsp;all&nbsp;other&nbsp;access&nbsp;to&nbsp;this&nbsp;proxy&lt;br&gt;<br>
http_access&nbsp;allow&nbsp;all&lt;br&gt;<br>
http_access&nbsp;allow&nbsp;CONNECT&lt;br&gt;<br>
http_access&nbsp;allow&nbsp;to_localhost&lt;br&gt;<br>
&lt;br&gt;<br>
include&nbsp;&quot;/opt/qlproxy/etc/squid/squid.acl&quot;&lt;br&gt;<br>
&lt;br&gt;<br>
#&nbsp;Squid&nbsp;normally&nbsp;listens&nbsp;to&nbsp;port&nbsp;3128&lt;br&gt;<br>
#&nbsp;Dansguardian's&nbsp;port:&lt;br&gt;<br>
http_port&nbsp;3125&lt;br&gt;<br>
#&nbsp;HTTPS&nbsp;ports,&nbsp;required&nbsp;by&nbsp;diladele&nbsp;web&nbsp;safety:&lt;br&gt;<br>
http_port&nbsp;3126&nbsp;intercept&lt;br&gt;<br>
https_port&nbsp;3127&nbsp;transparent&nbsp;ssl-bump&nbsp;generate-host-certificates=on&nbsp;dynamic_cert_mem_cache_size=4MB&nbsp;cert=/opt/qlproxy/etc/myca.pem&lt;br&gt;<br>
http_port&nbsp;3128&nbsp;ssl-bump&nbsp;generate-host-certificates=on&nbsp;dynamic_cert_mem_cache_size=4MB&nbsp;cert=/opt/qlproxy/etc/myca.pem&lt;br&gt;<br>
always_direct&nbsp;allow&nbsp;all&lt;br&gt;<br>
ssl_bump&nbsp;client-first&nbsp;all&lt;br&gt;<br>
&lt;br&gt;<br>
#ceritiface&nbsp;storage&nbsp;manager&lt;br&gt;<br>
sslcrtd_program&nbsp;/usr/lib/squid/ssl_crtd&nbsp;-s&nbsp;/var/spool/squid_ssldb&nbsp;-M&nbsp;4MB&lt;br&gt;<br>
&lt;br&gt;<br>
#&nbsp;Uncomment&nbsp;and&nbsp;adjust&nbsp;the&nbsp;following&nbsp;to&nbsp;add&nbsp;a&nbsp;disk&nbsp;cache&nbsp;directory.&lt;br&gt;<br>
#cache_dir&nbsp;ufs&nbsp;/var/spool/squid&nbsp;100&nbsp;16&nbsp;256&lt;br&gt;<br>
&lt;br&gt;<br>
#&nbsp;Leave&nbsp;coredumps&nbsp;in&nbsp;the&nbsp;first&nbsp;cache&nbsp;dir&lt;br&gt;<br>
coredump_dir&nbsp;/var/spool/squid&lt;br&gt;<br>
&lt;br&gt;<br>
refresh_pattern&nbsp;^ftp:&nbsp;1440&nbsp;20%&nbsp;1008&lt;/div&gt;<br>
&lt;div&gt;refresh_pattern&nbsp;^gopher:&nbsp;1440&nbsp;0%&nbsp;1440&lt;br&gt;<br>
refresh_pattern&nbsp;-i&nbsp;(/cgi-bin/|\?)&nbsp;0&nbsp;0%&nbsp;0&lt;br&gt;<br>
refresh_pattern&nbsp;.&nbsp;0&nbsp;20%&nbsp;4320&lt;br&gt;<br>
&lt;br&gt;<br>
#&nbsp;Squid-Diladele&nbsp;integration:&lt;br&gt;<br>
icap_enable&nbsp;on&lt;br&gt;<br>
icap_preview_enable&nbsp;on&lt;br&gt;<br>
icap_preview_size&nbsp;4096&lt;br&gt;<br>
icap_persistent_connections&nbsp;on&lt;br&gt;<br>
icap_send_client_ip&nbsp;on&lt;br&gt;<br>
icap_send_client_username&nbsp;on&lt;br&gt;<br>
icap_client_username_header&nbsp;X-Client-Username&lt;br&gt;<br>
icap_service&nbsp;qlproxy1&nbsp;reqmod_precache&nbsp;bypass=0&nbsp;icap://127.0.0.1:1344/reqmod&lt;br&gt;<br>
icap_service&nbsp;qlproxy2&nbsp;respmod_precache&nbsp;bypass=0&nbsp;icap://127.0.0.1:1344/respmod&lt;br&gt;<br>
acl&nbsp;qlproxy_icap_edomains&nbsp;dstdomain&nbsp;&quot;/opt/qlproxy/etc/squid/icap_exclusions_domains.conf&quot;&lt;br&gt;<br>
acl&nbsp;qlproxy_icap_etypes&nbsp;rep_mime_type&nbsp;&quot;/opt/qlproxy/etc/squid/icap_exclusions_contenttypes.conf&quot;&lt;br&gt;<br>
adaptation_access&nbsp;qlproxy1&nbsp;deny&nbsp;qlproxy_icap_edomains&lt;br&gt;<br>
adaptation_access&nbsp;qlproxy2&nbsp;deny&nbsp;qlproxy_icap_edomains&lt;br&gt;<br>
adaptation_access&nbsp;qlproxy2&nbsp;deny&nbsp;qlproxy_icap_etypes&lt;br&gt;<br>
adaptation_access&nbsp;qlproxy1&nbsp;allow&nbsp;all&lt;br&gt;<br>
adaptation_access&nbsp;qlproxy2&nbsp;allow&nbsp;all&lt;/div&gt;<br>
&lt;div&gt;#squid&nbsp;shutdown&nbsp;faster&lt;br&gt;<br>
shutdown_lifetime&nbsp;3&nbsp;seconds&lt;br&gt;<br>
--------------------------------------------------&lt;/div&gt;<br>
&lt;div&gt;And&nbsp;here&nbsp;are&nbsp;my&nbsp;iptables:&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
&lt;div&gt;*filter&lt;br&gt;<br>
:INPUT&nbsp;DROP&nbsp;[0:0]&lt;br&gt;<br>
:FORWARD&nbsp;ACCEPT&nbsp;[0:0]&lt;br&gt;<br>
:OUTPUT&nbsp;ACCEPT&nbsp;[0:0]&lt;br&gt;<br>
-A&nbsp;INPUT&nbsp;-p&nbsp;icmp&nbsp;-j&nbsp;ACCEPT&lt;br&gt;<br>
-A&nbsp;INPUT&nbsp;-i&nbsp;lo&nbsp;-j&nbsp;ACCEPT&lt;br&gt;<br>
#&nbsp;ssh&lt;br&gt;<br>
-A&nbsp;INPUT&nbsp;-p&nbsp;tcp&nbsp;-m&nbsp;tcp&nbsp;--dport&nbsp;22&nbsp;-j&nbsp;ACCEPT&lt;br&gt;<br>
#&nbsp;dansguardian&lt;br&gt;<br>
-A&nbsp;INPUT&nbsp;-i&nbsp;p33p1&nbsp;-p&nbsp;tcp&nbsp;--dport&nbsp;8080&nbsp;-j&nbsp;ACCEPT&lt;br&gt;<br>
#&nbsp;squid&nbsp;https&lt;br&gt;<br>
-A&nbsp;INPUT&nbsp;-i&nbsp;p33p1&nbsp;-p&nbsp;tcp&nbsp;--dport&nbsp;3128&nbsp;-j&nbsp;ACCEPT&lt;br&gt;<br>
#&nbsp;3127&nbsp;-&nbsp;for&nbsp;intercepted&nbsp;https&nbsp;traffic&nbsp;for&nbsp;Squid&lt;br&gt;<br>
-A&nbsp;INPUT&nbsp;-i&nbsp;p33p1&nbsp;-p&nbsp;tcp&nbsp;--dport&nbsp;3127&nbsp;-j&nbsp;ACCEPT&lt;br&gt;<br>
#&nbsp;squid&nbsp;-&nbsp;allow&nbsp;the&nbsp;redirected&nbsp;trafiic&nbsp;from&nbsp;port&nbsp;443&nbsp;to&nbsp;3128&lt;br&gt;<br>
-A&nbsp;INPUT&nbsp;-m&nbsp;mark&nbsp;--mark&nbsp;1&nbsp;-j&nbsp;DROP&lt;br&gt;<br>
#&nbsp;squid&nbsp;-&nbsp;block&nbsp;direct&nbsp;connections&nbsp;to&nbsp;port&nbsp;3128&lt;br&gt;<br>
-A&nbsp;INPUT&nbsp;-i&nbsp;p33p1&nbsp;-p&nbsp;tcp&nbsp;--dport&nbsp;3128&nbsp;-j&nbsp;REJECT&lt;br&gt;<br>
#&nbsp;connected&nbsp;streams&lt;br&gt;<br>
-A&nbsp;INPUT&nbsp;-m&nbsp;state&nbsp;--state&nbsp;RELATED,ESTABLISHED&nbsp;-j&nbsp;ACCEPT&lt;br&gt;<br>
#-A&nbsp;INPUT&nbsp;-j&nbsp;LOG&nbsp;--log-prefix&nbsp;&quot;DROPPED_INPUT:&nbsp;&quot;&lt;br&gt;<br>
COMMIT&lt;br&gt;<br>
*nat&lt;br&gt;<br>
:OUTPUT&nbsp;ACCEPT&nbsp;[0:0]&lt;br&gt;<br>
:PREROUTING&nbsp;ACCEPT&nbsp;[0:0]&lt;br&gt;<br>
:POSTROUTING&nbsp;ACCEPT&nbsp;[0:0]&lt;br&gt;<br>
#&nbsp;all&nbsp;queries&nbsp;go&nbsp;to&nbsp;opendsns&nbsp;familyshield:&lt;br&gt;<br>
-A&nbsp;PREROUTING&nbsp;-p&nbsp;udp&nbsp;-i&nbsp;p33p1&nbsp;--dport&nbsp;53&nbsp;-j&nbsp;DNAT&nbsp;--to-destination&nbsp;208.67.222.123:53&lt;br&gt;<br>
#&nbsp;redirection&nbsp;of&nbsp;internal&nbsp;network's&nbsp;http&nbsp;traffic&nbsp;to&nbsp;dansguardian:&lt;br&gt;<br>
-A&nbsp;PREROUTING&nbsp;-p&nbsp;tcp&nbsp;-m&nbsp;tcp&nbsp;-i&nbsp;p33p1&nbsp;-s&nbsp;172.16.34.254/32&nbsp;--dport&nbsp;80&nbsp;-j&nbsp;REDIRECT&nbsp;--to-ports&nbsp;8080&lt;br&gt;<br>
#&nbsp;https&nbsp;redirection&nbsp;to&nbsp;squid&lt;/div&gt;<br>
&lt;div&gt;-A&nbsp;PREROUTING&nbsp;-p&nbsp;tcp&nbsp;-m&nbsp;tcp&nbsp;-i&nbsp;p33p1&nbsp;-s&nbsp;172.16.34.254/32&nbsp;--dport&nbsp;443&nbsp;-j&nbsp;REDIRECT&nbsp;--to-ports&nbsp;3127&lt;/div&gt;<br>
&lt;div&gt;#NAT&lt;br&gt;<br>
-A&nbsp;POSTROUTING&nbsp;-s&nbsp;172.16.34.252/30&nbsp;-j&nbsp;MASQUERADE&lt;br&gt;<br>
COMMIT&lt;br&gt;<br>
*mangle&lt;br&gt;<br>
:INPUT&nbsp;ACCEPT&nbsp;[0:0]&lt;br&gt;<br>
:FORWARD&nbsp;ACCEPT&nbsp;[0:0]&lt;br&gt;<br>
:OUTPUT&nbsp;ACCEPT&nbsp;[0:0]&lt;br&gt;<br>
:POSTROUTING&nbsp;ACCEPT&nbsp;[0:0]&lt;br&gt;<br>
:PREROUTING&nbsp;ACCEPT&nbsp;[0:0]&lt;br&gt;<br>
-A&nbsp;PREROUTING&nbsp;-p&nbsp;tcp&nbsp;-m&nbsp;tcp&nbsp;-i&nbsp;p33p1&nbsp;--dport&nbsp;3128&nbsp;-j&nbsp;MARK&nbsp;--set-mark&nbsp;1&lt;br&gt;<br>
-A&nbsp;PREROUTING&nbsp;-p&nbsp;tcp&nbsp;--dport&nbsp;80&nbsp;-s&nbsp;127.0.0.1&nbsp;-j&nbsp;ACCEPT&lt;br&gt;<br>
-A&nbsp;PREROUTING&nbsp;-p&nbsp;tcp&nbsp;--dport&nbsp;80&nbsp;-s&nbsp;172.16.34.253&nbsp;-j&nbsp;ACCEPT&lt;br&gt;<br>
COMMIT&lt;br&gt;<br>
#&nbsp;Completed&lt;/div&gt;<br>
&lt;div&gt;I&nbsp;also&nbsp;tried&nbsp;running&nbsp;squid&nbsp;with&nbsp;the&nbsp;squid&nbsp;-d&nbsp;10&nbsp;command&nbsp;but&nbsp;no&nbsp;errors&nbsp;were&nbsp;found:&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
&lt;div&gt;2014/10/16&nbsp;10:08:46&nbsp;kid1|&nbsp;HTCP&nbsp;Disabled.&lt;br&gt;<br>
2014/10/16&nbsp;10:08:46&nbsp;kid1|&nbsp;Squid&nbsp;plugin&nbsp;modules&nbsp;loaded:&nbsp;0&lt;br&gt;<br>
2014/10/16&nbsp;10:08:46&nbsp;kid1|&nbsp;Adaptation&nbsp;support&nbsp;is&nbsp;on&lt;br&gt;<br>
2014/10/16&nbsp;10:08:46&nbsp;kid1|&nbsp;Accepting&nbsp;HTTP&nbsp;Socket&nbsp;connections&nbsp;at&nbsp;local=[::]:3125&nbsp;remote=[::]&nbsp;FD&nbsp;21&nbsp;flags=9&lt;br&gt;<br>
2014/10/16&nbsp;10:08:46&nbsp;kid1|&nbsp;Accepting&nbsp;NAT&nbsp;intercepted&nbsp;HTTP&nbsp;Socket&nbsp;connections&nbsp;at&nbsp;local=0.0.0.0:3126&nbsp;remote=[::]&nbsp;FD&nbsp;22&nbsp;flags=41&lt;br&gt;<br>
2014/10/16&nbsp;10:08:46&nbsp;kid1|&nbsp;Accepting&nbsp;SSL&nbsp;bumped&nbsp;HTTP&nbsp;Socket&nbsp;connections&nbsp;at&nbsp;local=[::]:3128&nbsp;remote=[::]&nbsp;FD&nbsp;23&nbsp;flags=9&lt;br&gt;<br>
2014/10/16&nbsp;10:08:46&nbsp;kid1|&nbsp;Accepting&nbsp;NAT&nbsp;intercepted&nbsp;SSL&nbsp;bumped&nbsp;HTTPS&nbsp;Socket&nbsp;connections&nbsp;at&nbsp;local=0.0.0.0:3127&nbsp;remote=[::]&nbsp;FD&nbsp;24&nbsp;flags=41&lt;br&gt;<br>
2014/10/16&nbsp;10:08:47&nbsp;kid1|&nbsp;storeLateRelease:&nbsp;released&nbsp;0&nbsp;objects&lt;/div&gt;<br>
&lt;div&gt;How&nbsp;can&nbsp;I&nbsp;get&nbsp;squid&nbsp;to&nbsp;decrypt&nbsp;https&nbsp;traffic&nbsp;with&nbsp;this&nbsp;configuration?&nbsp;Any&nbsp;help&nbsp;will&nbsp;be&nbsp;much&nbsp;appreciated.&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
