<tt>
&lt;font&nbsp;face=&quot;Default&nbsp;Sans&nbsp;Serif,Verdana,Arial,Helvetica,sans-serif&quot;&nbsp;size=&quot;2&quot;&gt;<br>
&nbsp;&lt;span&gt;I've&nbsp;had&nbsp;nearly&nbsp;the&nbsp;same&nbsp;Problem.&nbsp;5&nbsp;Server&nbsp;with&nbsp;squid&nbsp;3.4.X&nbsp;and&nbsp;high&nbsp;load&nbsp;till&nbsp;deadlock&nbsp;on&nbsp;squid.&nbsp;Then&nbsp;version&nbsp;changed&nbsp;to&nbsp;3.3.13&nbsp;and&nbsp;the&nbsp;load&nbsp;so&nbsp;low&nbsp;that&nbsp;I&nbsp;only&nbsp;need&nbsp;3&nbsp;Server&nbsp;with&nbsp;reserve.&lt;br&gt;<br>
Enviroment:&nbsp;5000&nbsp;User,&nbsp;no&nbsp;logging,&nbsp;no&nbsp;caching&nbsp;on&nbsp;the&nbsp;disk,&nbsp;NTLM-Auth&lt;br&gt;<br>
&lt;br&gt;&lt;br&gt;&lt;br&gt;Mit&nbsp;freundlichen&nbsp;Grüßen&nbsp;/&nbsp;Kind&nbsp;regards&lt;br&gt;&lt;br&gt;Mr.&nbsp;Andreas&nbsp;Reschke&lt;br&gt;<br>
&lt;/span&gt;&lt;br&gt;&lt;font&nbsp;color=&quot;#990099&quot;&gt;-----&quot;squid-users&quot;&nbsp;&lt;squid-users-bounces@lists.squid-cache.org&gt;&nbsp;schrieb:&nbsp;-----&lt;/font&gt;<br>
&lt;div&nbsp;style=&quot;padding-left:5px;&quot;&gt;&lt;div&nbsp;style=&quot;padding-right:0px;padding-left:5px;border-left:solid&nbsp;black&nbsp;2px;&quot;&gt;<br>
An:&nbsp;squid-users@lists.squid-cache.org&lt;br&gt;Von:&nbsp;Eliezer&nbsp;Croitoru&nbsp;&lt;eliezer@ngtech.co.il&gt;<br>
&lt;br&gt;Gesendet&nbsp;von:&nbsp;&quot;squid-users&quot;&nbsp;&lt;squid-users-bounces@lists.squid-cache.org&gt;<br>
&lt;br&gt;Datum:&nbsp;23.10.2014&nbsp;11:19&lt;br&gt;Betreff:&nbsp;Re:&nbsp;[squid-users]&nbsp;3.3.x&nbsp;-&gt;&nbsp;3.4.x:&nbsp;huge&nbsp;performance&nbsp;regression&lt;br&gt;<br>
&lt;br&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&nbsp;New,Courier,monospace&quot;&nbsp;size=&quot;2&quot;&gt;-----BEGIN&nbsp;PGP&nbsp;SIGNED&nbsp;MESSAGE-----&lt;br&gt;<br>
Hash:&nbsp;SHA1&lt;br&gt;&lt;br&gt;Hey,&lt;br&gt;&lt;br&gt;What&nbsp;is&nbsp;the&nbsp;network&nbsp;load?&nbsp;how&nbsp;many&nbsp;users?&lt;br&gt;<br>
Have&nbsp;you&nbsp;been&nbsp;using&nbsp;workers&nbsp;at&nbsp;all&nbsp;in&nbsp;the&nbsp;past?&lt;br&gt;Can&nbsp;you&nbsp;see&nbsp;the&nbsp;avg&nbsp;requests&nbsp;per&nbsp;second&nbsp;on&nbsp;the&nbsp;cache&nbsp;manager&nbsp;page?&lt;br&gt;<br>
&lt;br&gt;Eliezer&lt;br&gt;&lt;br&gt;On&nbsp;10/22/2014&nbsp;09:02&nbsp;AM,&nbsp;Eugene&nbsp;M.&nbsp;Zheganin&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;Hi.&lt;br&gt;&gt;&nbsp;&lt;br&gt;&gt;&nbsp;I&nbsp;was&nbsp;using&nbsp;the&nbsp;3.4.x&nbsp;branch&nbsp;for&nbsp;quite&nbsp;some&nbsp;time,&nbsp;it&nbsp;was&nbsp;working&lt;br&gt;<br>
&gt;&nbsp;just&nbsp;fine&nbsp;on&nbsp;small&nbsp;installations.&nbsp;Yesterday&nbsp;I&nbsp;upgraded&nbsp;my&nbsp;largest&lt;br&gt;<br>
&gt;&nbsp;cache&nbsp;installation&nbsp;from&nbsp;3.3.13&nbsp;to&nbsp;3.4.8&nbsp;(same&nbsp;config,&nbsp;diskd,&lt;br&gt;&gt;&nbsp;NTLM/GSS-SPNEGO&nbsp;auth&nbsp;helpers,&nbsp;external&nbsp;helpers).&nbsp;Today&nbsp;morning&nbsp;I&lt;br&gt;<br>
&gt;&nbsp;noticed&nbsp;that&nbsp;squid&nbsp;is&nbsp;spiking&nbsp;to&nbsp;100%&nbsp;of&nbsp;CPU&nbsp;and&nbsp;almost&nbsp;isn't&lt;br&gt;&gt;&nbsp;serving&nbsp;any&nbsp;traffic.&nbsp;Restart&nbsp;didn't&nbsp;help,&nbsp;squid&nbsp;is&nbsp;serving&nbsp;pages&nbsp;&lt;br&gt;<br>
&gt;&nbsp;while&nbsp;continuing&nbsp;to&nbsp;consume&nbsp;CPU,&nbsp;load&nbsp;grows,&nbsp;until&nbsp;it's&nbsp;at&nbsp;100%,&lt;br&gt;<br>
&gt;&nbsp;and&nbsp;after&nbsp;some&nbsp;time&nbsp;my&nbsp;users&nbsp;are&nbsp;unable&nbsp;to&nbsp;open&nbsp;any&nbsp;page&nbsp;from&lt;br&gt;&gt;&nbsp;Internet.&nbsp;This&nbsp;is&nbsp;sad,&nbsp;so&nbsp;I&nbsp;downgraded&nbsp;to&nbsp;3.3.13.&nbsp;CPU&nbsp;consumption&lt;br&gt;<br>
&gt;&nbsp;went&nbsp;back&nbsp;to&nbsp;20-35%&nbsp;and&nbsp;everything&nbsp;is&nbsp;back&nbsp;to&nbsp;normal.&lt;br&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;In&nbsp;order&nbsp;to&nbsp;understand&nbsp;what's&nbsp;happening&nbsp;I&nbsp;did&nbsp;some&nbsp;dtrace&nbsp;profiling&lt;br&gt;<br>
&gt;&nbsp;to&nbsp;see&nbsp;what&nbsp;is&nbsp;squid&nbsp;busy&nbsp;with,&nbsp;taking&nbsp;the&nbsp;consideration,&nbsp;that&lt;br&gt;<br>
&gt;&nbsp;measuring&nbsp;the&nbsp;same&nbsp;amount&nbsp;of&nbsp;connect()/socket()&nbsp;syscalls&nbsp;should&lt;br&gt;<br>
&gt;&nbsp;give&nbsp;same&nbsp;amount&nbsp;of&nbsp;squid&nbsp;work,&nbsp;but&nbsp;the&nbsp;results&nbsp;were&nbsp;totally&lt;br&gt;&gt;&nbsp;different&nbsp;on&nbsp;one&nbsp;number&nbsp;of&nbsp;such&nbsp;syscalls.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;&gt;&nbsp;Anyone&nbsp;to&nbsp;comment&nbsp;?&lt;br&gt;&gt;&nbsp;&lt;br&gt;&gt;&nbsp;Thanks.&nbsp;Eugene.&nbsp;_______________________________________________&nbsp;&lt;br&gt;<br>
&gt;&nbsp;squid-users&nbsp;mailing&nbsp;list&nbsp;squid-users@lists.squid-cache.org&nbsp;&lt;br&gt;&gt;&nbsp;&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&gt;<br>
http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;&gt;&nbsp;&lt;br&gt;&lt;br&gt;-----BEGIN&nbsp;PGP&nbsp;SIGNATURE-----&lt;br&gt;<br>
Version:&nbsp;GnuPG&nbsp;v1&lt;br&gt;&lt;br&gt;iQEcBAEBAgAGBQJUSMf7AAoJENxnfXtQ8ZQU/KwH/icRcMBoEA4Y8u3/inbnvSiT&lt;br&gt;<br>
CMPX6On9CO+RJeXlDGcAMfbYofZixB8zR5BuBTOsNS35moqCtHmlzZYtoGxkLGLx&lt;br&gt;RU6KKEhLGuGNyFCnyQx/oh9hcG90PSnaFnsp0m3vClcFtxv3kcdn944VS8hPtKWC&lt;br&gt;<br>
MQw7G8KzXwu7RmTaP5nk+EGNX3JAn8GlQaINX6G4zKeujqwrK954KORPMt0S53iQ&lt;br&gt;P7k6rq+ckPDgTIHuK4L+eMCka22y0z2FTo41jxSXK7J6w3GnWUsvwA22yYo6BV1h&lt;br&gt;<br>
+4DjvvtoJA3nNuFtXYxXCcBLMXcwk953o2uQKGkqOmlLGg660Bu9tCTBFAvaQsg=&lt;br&gt;=79iu&lt;br&gt;<br>
-----END&nbsp;PGP&nbsp;SIGNATURE-----&lt;br&gt;_______________________________________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;squid-users@lists.squid-cache.org&lt;br&gt;&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&gt;<br>
http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;/squid-users-bounces@lists.squid-cache.org&gt;<br>
&lt;/eliezer@ngtech.co.il&gt;&lt;/div&gt;&lt;/div&gt;&lt;/font&gt;<br>
<br>

</tt>
