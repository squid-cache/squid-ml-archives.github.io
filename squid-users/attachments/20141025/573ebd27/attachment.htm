<tt>
&lt;div&nbsp;class=&quot;markdown&quot;&gt;<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;Hi&nbsp;Carlos,&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;Yeah,&nbsp;the&nbsp;Windows&nbsp;7&nbsp;machine&nbsp;is&nbsp;part&nbsp;of&nbsp;the&nbsp;domain.&nbsp;As&nbsp;for&nbsp;basic&nbsp;auth,&nbsp;I'll&nbsp;look&nbsp;into&nbsp;setting&nbsp;that&nbsp;up&nbsp;too,&nbsp;although&nbsp;we&nbsp;were&nbsp;hoping&nbsp;to&nbsp;forgo&nbsp;it&nbsp;entirely.&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;On&nbsp;25&nbsp;Oct&nbsp;2014,&nbsp;at&nbsp;3:00,&nbsp;Carlos&nbsp;Defoe&nbsp;wrote:&lt;/p&gt;<br>
<br>
&lt;blockquote&gt;<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;Windows&nbsp;7&nbsp;inside&nbsp;the&nbsp;domain?&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;Anyway,&nbsp;you&nbsp;should&nbsp;configure&nbsp;a&nbsp;basic&nbsp;auth&nbsp;scheme&nbsp;as&nbsp;a&nbsp;second&nbsp;fallback.&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;On&nbsp;Fri,&nbsp;Oct&nbsp;24,&nbsp;2014&nbsp;at&nbsp;9:26&nbsp;PM,&nbsp;Markus&nbsp;Moeller&nbsp;&lt;a&nbsp;href=&quot;mailto:huaraz@moeller.plus.com&quot;&gt;huaraz@moeller.plus.com&lt;/a&gt;&lt;br&gt;<br>
wrote:&lt;/p&gt;<br>
<br>
&lt;blockquote&gt;<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;Hi&nbsp;Pedro,&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;How&nbsp;did&nbsp;you&nbsp;create&nbsp;your&nbsp;keytab&nbsp;?&nbsp;&nbsp;What&nbsp;does&nbsp;klist&nbsp;â€“ekt&nbsp;&lt;squid.keytab&gt;&nbsp;show&lt;br&gt;<br>
(&nbsp;I&nbsp;assume&nbsp;you&nbsp;use&nbsp;MIT&nbsp;Kerberos)&nbsp;?&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;Markus&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;&quot;Pedro&nbsp;Lobo&quot;&nbsp;&lt;a&nbsp;href=&quot;mailto:palobo@gmail.com&quot;&gt;palobo@gmail.com&lt;/a&gt;&nbsp;wrote&nbsp;in&nbsp;message&lt;br&gt;<br>
news:40E1E0E7-50C6-4117-94AA-50B06573430A@gmail.com...&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;Hi&nbsp;Squid&nbsp;Gurus,&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;I'm&nbsp;at&nbsp;my&nbsp;wit's&nbsp;end&nbsp;and&nbsp;in&nbsp;dire&nbsp;need&nbsp;of&nbsp;some&nbsp;squid&nbsp;expertise.&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;We've&nbsp;got&nbsp;a&nbsp;production&nbsp;environment&nbsp;with&nbsp;a&nbsp;couple&nbsp;of&nbsp;squid&nbsp;2.7&nbsp;servers&lt;br&gt;<br>
using&nbsp;NTLM&nbsp;and&nbsp;basic&nbsp;authentication.&nbsp;Recently&nbsp;though,&nbsp;we&nbsp;decided&nbsp;to&nbsp;upgrade&lt;br&gt;<br>
and&nbsp;I'm&nbsp;now&nbsp;setting&nbsp;up&nbsp;squid&nbsp;3.3&nbsp;with&nbsp;Kerberos&nbsp;and&nbsp;NTLM&nbsp;Fallback.&nbsp;I've&lt;br&gt;<br>
followed&nbsp;just&nbsp;about&nbsp;every&nbsp;guide&nbsp;I&nbsp;could&nbsp;find&nbsp;and&nbsp;in&nbsp;my&nbsp;testing&nbsp;environment,&lt;br&gt;<br>
things&nbsp;were&nbsp;working&nbsp;great.&nbsp;Now&nbsp;that&nbsp;I've&nbsp;hooked&nbsp;it&nbsp;up&nbsp;to&nbsp;the&nbsp;main&nbsp;domain,&lt;br&gt;<br>
things&nbsp;are&nbsp;awry.&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;If&nbsp;I&nbsp;use&nbsp;a&nbsp;machine&nbsp;that's&nbsp;not&nbsp;part&nbsp;of&nbsp;the&nbsp;domain,&nbsp;NTLM&nbsp;kicks&nbsp;in&nbsp;and&nbsp;I&nbsp;can&lt;br&gt;<br>
surf&nbsp;the&nbsp;web&nbsp;fine.&nbsp;If&nbsp;I&nbsp;use&nbsp;a&nbsp;Windows&nbsp;XP&nbsp;or&nbsp;Windows&nbsp;Server&nbsp;2003,&nbsp;kerberos&lt;br&gt;<br>
works&nbsp;just&nbsp;fine,&nbsp;however,&nbsp;if&nbsp;I&nbsp;use&nbsp;a&nbsp;machine&nbsp;Windows&nbsp;7,&nbsp;8&nbsp;or&nbsp;2008&nbsp;server,&nbsp;I&lt;br&gt;<br>
keep&nbsp;getting&nbsp;a&nbsp;popup&nbsp;asking&nbsp;me&nbsp;to&nbsp;authenticate&nbsp;and&nbsp;even&nbsp;then,&nbsp;it's&nbsp;and&lt;br&gt;<br>
endless&nbsp;loop&nbsp;until&nbsp;it&nbsp;fails.&nbsp;My&nbsp;cache.log&nbsp;is&nbsp;littered&nbsp;with:&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;negotiate_kerberos_auth.cc(200):&nbsp;pid=1607&nbsp;:2014/10/24&nbsp;23:03:01|&nbsp;negotiate_kerberos_auth:&nbsp;ERROR:&nbsp;gss_accept_sec_context()&nbsp;failed:&nbsp;Unspecified&nbsp;GSS&nbsp;failure.&nbsp;&nbsp;Minor&nbsp;code&nbsp;may&nbsp;provide&nbsp;more&nbsp;information.&lt;br&gt;<br>
2014/10/24&nbsp;23:03:01|&nbsp;ERROR:&nbsp;Negotiate&nbsp;Authentication&nbsp;validating&nbsp;user.&nbsp;Error&nbsp;returned&nbsp;'BH&nbsp;gss_accept_sec_context()&nbsp;failed:&nbsp;Unspecified&nbsp;GSS&nbsp;failure.&nbsp;&nbsp;Minor&nbsp;code&nbsp;may&nbsp;provide&nbsp;more&nbsp;information.&nbsp;'&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;The&nbsp;odd&nbsp;thing,&nbsp;is&nbsp;that&nbsp;this&nbsp;has&nbsp;worked&nbsp;before.&nbsp;Help&nbsp;me&nbsp;Obi&nbsp;Wan...&nbsp;You're&lt;br&gt;<br>
my&nbsp;only&nbsp;hope!&nbsp;:)&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;&lt;em&gt;Current&nbsp;Setup&lt;/em&gt;&lt;br&gt;<br>
Squid&nbsp;3.3&nbsp;running&nbsp;on&nbsp;Ubuntu&nbsp;14.04&nbsp;server.&nbsp;It's&nbsp;connected&nbsp;to&nbsp;a&nbsp;2003&nbsp;server&lt;br&gt;<br>
with&nbsp;function&nbsp;level&nbsp;2000&nbsp;(I&nbsp;know,&nbsp;we're&nbsp;trying&nbsp;to&nbsp;fase&nbsp;out&nbsp;the&nbsp;older&lt;br&gt;<br>
servers).&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;&lt;em&gt;krb5.conf&lt;/em&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;[libdefaults]&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;default_realm&nbsp;=&nbsp;FAKE.NET&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;dns_lookup_kdc&nbsp;=&nbsp;yes&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;dns_lookup_realm&nbsp;=&nbsp;yes&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;ticket_lifetime&nbsp;=&nbsp;24h&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;default_keytab_name&nbsp;=&nbsp;/etc/squid3/PROXY.keytab&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;;&nbsp;for&nbsp;Windows&nbsp;2003&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;default_tgs_enctypes&nbsp;=&nbsp;rc4-hmac&nbsp;des-cbc-crc&nbsp;des-cbc-md5&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;default_tkt_enctypes&nbsp;=&nbsp;rc4-hmac&nbsp;des-cbc-crc&nbsp;des-cbc-md5&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;permitted_enctypes&nbsp;=&nbsp;rc4-hmac&nbsp;des-cbc-crc&nbsp;des-cbc-md5&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;[realms]&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;FAKE.NET&nbsp;=&nbsp;{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kdc&nbsp;=&nbsp;srv01.fake.net&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kdc&nbsp;=&nbsp;srv02.fake.net&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kdc&nbsp;=&nbsp;srv03.fake.net&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;admin_server&nbsp;=&nbsp;srv01.fake.net&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default_domain&nbsp;=&nbsp;fake.net&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;}&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;[domain_realm]&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;.fake.net&nbsp;=&nbsp;FAKE.NET&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;fake.net&nbsp;=&nbsp;FAKE.NET&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;[logging]&lt;br&gt;<br>
kdc&nbsp;=&nbsp;FILE:/var/log/kdc.log&lt;br&gt;<br>
admin_server&nbsp;=&nbsp;FILE:/var/log/kadmin.log&lt;br&gt;<br>
default&nbsp;=&nbsp;FILE:/var/log/krb5lib.log&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;&lt;em&gt;squid.conf&lt;/em&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;auth_param&nbsp;negotiate&nbsp;program&nbsp;/usr/lib/squid3/negotiate_kerberos_auth&nbsp;-d&nbsp;-r&nbsp;-s&nbsp;HTTP/proxy01tst.fake.net&lt;br&gt;<br>
auth_param&nbsp;negotiate&nbsp;children&nbsp;20&nbsp;startup=0&nbsp;idle=1&lt;br&gt;<br>
auth_param&nbsp;negotiate&nbsp;keep_alive&nbsp;off&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;auth_param&nbsp;ntlm&nbsp;program&nbsp;/usr/bin/ntlm_auth&nbsp;--diagnostics&nbsp;--helper-protocol=squid-2.5-ntlmssp&nbsp;--domain=FAKE.NET&lt;br&gt;<br>
auth_param&nbsp;ntlm&nbsp;children&nbsp;10&lt;br&gt;<br>
auth_param&nbsp;ntlm&nbsp;keep_alive&nbsp;off&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;Cheers,&lt;br&gt;<br>
Pedro&lt;/p&gt;<br>
<br>
&lt;hr&gt;<br>
<br>
&lt;hr&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;/p&gt;<br>
<br>
&lt;hr&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;/p&gt;<br>
&lt;/blockquote&gt;<br>
<br>
&lt;hr&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;/p&gt;<br>
&lt;/blockquote&gt;<br>
<br>
&lt;/div&gt;
</tt>
