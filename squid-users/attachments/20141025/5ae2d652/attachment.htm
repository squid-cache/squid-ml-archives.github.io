<tt>
&lt;HTML&nbsp;xmlns:o&gt;&lt;HEAD&gt;&lt;/HEAD&gt;<br>
&lt;BODY&nbsp;dir=ltr&gt;<br>
&lt;DIV&nbsp;dir=ltr&gt;<br>
&lt;DIV&nbsp;style=&quot;FONT-SIZE:&nbsp;12pt;&nbsp;FONT-FAMILY:&nbsp;'Calibri';&nbsp;COLOR:&nbsp;#000000&quot;&gt;<br>
&lt;DIV&gt;Hi&nbsp;Pedro,&lt;/DIV&gt;<br>
&lt;DIV&gt;&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;How&nbsp;did&nbsp;you&nbsp;create&nbsp;your&nbsp;keytab&nbsp;?&nbsp;&nbsp;What&nbsp;does&nbsp;klist&nbsp;–ekt&nbsp;<br>
&lt;squid.keytab&gt;&nbsp;show&nbsp;(&nbsp;I&nbsp;assume&nbsp;you&nbsp;use&nbsp;MIT&nbsp;Kerberos)&nbsp;?&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;Markus&lt;/DIV&gt;<br>
&lt;DIV&gt;&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&nbsp;<br>
style=&quot;BORDER-TOP-COLOR:&nbsp;#000000;&nbsp;BORDER-BOTTOM-COLOR:&nbsp;#000000;&nbsp;PADDING-LEFT:&nbsp;5px;&nbsp;MARGIN-LEFT:&nbsp;5px;&nbsp;BORDER-LEFT:&nbsp;#000000&nbsp;4px&nbsp;solid;&nbsp;BORDER-RIGHT-COLOR:&nbsp;#000000&quot;&gt;<br>
&lt;DIV&nbsp;<br>
style=&quot;FONT-SIZE:&nbsp;small;&nbsp;FONT-FAMILY:&nbsp;'Calibri';&nbsp;FONT-WEIGHT:&nbsp;normal;&nbsp;COLOR:&nbsp;#000000;&nbsp;FONT-STYLE:&nbsp;normal;&nbsp;TEXT-DECORATION:&nbsp;none;&nbsp;DISPLAY:&nbsp;inline&quot;&gt;<br>
&lt;DIV&gt;&quot;Pedro&nbsp;Lobo&quot;&nbsp;&lt;palobo@gmail.com&gt;&nbsp;wrote&nbsp;in&nbsp;message&nbsp;<br>
news:40E1E0E7-50C6-4117-94AA-50B06573430A@gmail.com...&lt;/DIV&gt;&lt;/DIV&gt;&lt;/DIV&gt;<br>
&lt;DIV&nbsp;<br>
style=&quot;BORDER-TOP-COLOR:&nbsp;#000000;&nbsp;BORDER-BOTTOM-COLOR:&nbsp;#000000;&nbsp;PADDING-LEFT:&nbsp;5px;&nbsp;MARGIN-LEFT:&nbsp;5px;&nbsp;BORDER-LEFT:&nbsp;#000000&nbsp;4px&nbsp;solid;&nbsp;BORDER-RIGHT-COLOR:&nbsp;#000000&quot;&gt;<br>
&lt;DIV&nbsp;<br>
style=&quot;FONT-SIZE:&nbsp;small;&nbsp;FONT-FAMILY:&nbsp;'Calibri';&nbsp;FONT-WEIGHT:&nbsp;normal;&nbsp;COLOR:&nbsp;#000000;&nbsp;FONT-STYLE:&nbsp;normal;&nbsp;TEXT-DECORATION:&nbsp;none;&nbsp;DISPLAY:&nbsp;inline&quot;&gt;<br>
&lt;DIV&nbsp;class=markdown&gt;<br>
&lt;P&gt;Hi&nbsp;Squid&nbsp;Gurus,&lt;/P&gt;<br>
&lt;P&gt;I'm&nbsp;at&nbsp;my&nbsp;wit's&nbsp;end&nbsp;and&nbsp;in&nbsp;dire&nbsp;need&nbsp;of&nbsp;some&nbsp;squid&nbsp;expertise.&lt;/P&gt;<br>
&lt;P&gt;We've&nbsp;got&nbsp;a&nbsp;production&nbsp;environment&nbsp;with&nbsp;a&nbsp;couple&nbsp;of&nbsp;squid&nbsp;2.7&nbsp;servers&nbsp;using&nbsp;<br>
NTLM&nbsp;and&nbsp;basic&nbsp;authentication.&nbsp;Recently&nbsp;though,&nbsp;we&nbsp;decided&nbsp;to&nbsp;upgrade&nbsp;and&nbsp;I'm&nbsp;<br>
now&nbsp;setting&nbsp;up&nbsp;squid&nbsp;3.3&nbsp;with&nbsp;Kerberos&nbsp;and&nbsp;NTLM&nbsp;Fallback.&nbsp;I've&nbsp;followed&nbsp;just&nbsp;<br>
about&nbsp;every&nbsp;guide&nbsp;I&nbsp;could&nbsp;find&nbsp;and&nbsp;in&nbsp;my&nbsp;testing&nbsp;environment,&nbsp;things&nbsp;were&nbsp;<br>
working&nbsp;great.&nbsp;Now&nbsp;that&nbsp;I've&nbsp;hooked&nbsp;it&nbsp;up&nbsp;to&nbsp;the&nbsp;main&nbsp;domain,&nbsp;things&nbsp;are&nbsp;<br>
awry.&lt;/P&gt;<br>
&lt;P&gt;If&nbsp;I&nbsp;use&nbsp;a&nbsp;machine&nbsp;that's&nbsp;not&nbsp;part&nbsp;of&nbsp;the&nbsp;domain,&nbsp;NTLM&nbsp;kicks&nbsp;in&nbsp;and&nbsp;I&nbsp;can&nbsp;<br>
surf&nbsp;the&nbsp;web&nbsp;fine.&nbsp;If&nbsp;I&nbsp;use&nbsp;a&nbsp;Windows&nbsp;XP&nbsp;or&nbsp;Windows&nbsp;Server&nbsp;2003,&nbsp;kerberos&nbsp;works&nbsp;<br>
just&nbsp;fine,&nbsp;however,&nbsp;if&nbsp;I&nbsp;use&nbsp;a&nbsp;machine&nbsp;Windows&nbsp;7,&nbsp;8&nbsp;or&nbsp;2008&nbsp;server,&nbsp;I&nbsp;keep&nbsp;<br>
getting&nbsp;a&nbsp;popup&nbsp;asking&nbsp;me&nbsp;to&nbsp;authenticate&nbsp;and&nbsp;even&nbsp;then,&nbsp;it's&nbsp;and&nbsp;endless&nbsp;loop&nbsp;<br>
until&nbsp;it&nbsp;fails.&nbsp;My&nbsp;cache.log&nbsp;is&nbsp;littered&nbsp;with:&lt;/P&gt;&lt;PRE&gt;&lt;CODE&gt;negotiate_kerberos_auth.cc(200):&nbsp;pid=1607&nbsp;:2014/10/24&nbsp;23:03:01|&nbsp;negotiate_kerberos_auth:&nbsp;ERROR:&nbsp;gss_accept_sec_context()&nbsp;failed:&nbsp;Unspecified&nbsp;GSS&nbsp;failure.&nbsp;&nbsp;Minor&nbsp;code&nbsp;may&nbsp;provide&nbsp;more&nbsp;information.<br>
2014/10/24&nbsp;23:03:01|&nbsp;ERROR:&nbsp;Negotiate&nbsp;Authentication&nbsp;validating&nbsp;user.&nbsp;Error&nbsp;returned&nbsp;'BH&nbsp;gss_accept_sec_context()&nbsp;failed:&nbsp;Unspecified&nbsp;GSS&nbsp;failure.&nbsp;&nbsp;Minor&nbsp;code&nbsp;may&nbsp;provide&nbsp;more&nbsp;information.&nbsp;'<br>
&lt;/CODE&gt;&lt;/PRE&gt;<br>
&lt;P&gt;The&nbsp;odd&nbsp;thing,&nbsp;is&nbsp;that&nbsp;this&nbsp;has&nbsp;worked&nbsp;before.&nbsp;Help&nbsp;me&nbsp;Obi&nbsp;Wan...&nbsp;You're&nbsp;my&nbsp;<br>
only&nbsp;hope!&nbsp;:)&lt;/P&gt;<br>
&lt;P&gt;&lt;STRONG&gt;Current&nbsp;Setup&lt;/STRONG&gt;&lt;BR&gt;Squid&nbsp;3.3&nbsp;running&nbsp;on&nbsp;Ubuntu&nbsp;14.04&nbsp;server.&nbsp;<br>
It's&nbsp;connected&nbsp;to&nbsp;a&nbsp;2003&nbsp;server&nbsp;with&nbsp;function&nbsp;level&nbsp;2000&nbsp;(I&nbsp;know,&nbsp;we're&nbsp;trying&nbsp;<br>
to&nbsp;fase&nbsp;out&nbsp;the&nbsp;older&nbsp;servers).&lt;/P&gt;<br>
&lt;P&gt;&lt;STRONG&gt;krb5.conf&lt;/STRONG&gt;&lt;/P&gt;&lt;PRE&gt;&lt;CODE&gt;&nbsp;[libdefaults]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default_realm&nbsp;=&nbsp;FAKE.NET<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dns_lookup_kdc&nbsp;=&nbsp;yes<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dns_lookup_realm&nbsp;=&nbsp;yes<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ticket_lifetime&nbsp;=&nbsp;24h<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default_keytab_name&nbsp;=&nbsp;/etc/squid3/PROXY.keytab<br>
<br>
;&nbsp;for&nbsp;Windows&nbsp;2003<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default_tgs_enctypes&nbsp;=&nbsp;rc4-hmac&nbsp;des-cbc-crc&nbsp;des-cbc-md5<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default_tkt_enctypes&nbsp;=&nbsp;rc4-hmac&nbsp;des-cbc-crc&nbsp;des-cbc-md5<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;permitted_enctypes&nbsp;=&nbsp;rc4-hmac&nbsp;des-cbc-crc&nbsp;des-cbc-md5<br>
<br>
[realms]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FAKE.NET&nbsp;=&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kdc&nbsp;=&nbsp;srv01.fake.net<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kdc&nbsp;=&nbsp;srv02.fake.net<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kdc&nbsp;=&nbsp;srv03.fake.net<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;admin_server&nbsp;=&nbsp;srv01.fake.net<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default_domain&nbsp;=&nbsp;fake.net<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
[domain_realm]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.fake.net&nbsp;=&nbsp;FAKE.NET<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fake.net&nbsp;=&nbsp;FAKE.NET<br>
<br>
<br>
[logging]<br>
&nbsp;&nbsp;kdc&nbsp;=&nbsp;FILE:/var/log/kdc.log<br>
&nbsp;&nbsp;admin_server&nbsp;=&nbsp;FILE:/var/log/kadmin.log<br>
&nbsp;&nbsp;default&nbsp;=&nbsp;FILE:/var/log/krb5lib.log<br>
&lt;/CODE&gt;&lt;/PRE&gt;<br>
&lt;P&gt;&lt;STRONG&gt;squid.conf&lt;/STRONG&gt;&lt;/P&gt;&lt;PRE&gt;&lt;CODE&gt;auth_param&nbsp;negotiate&nbsp;program&nbsp;/usr/lib/squid3/negotiate_kerberos_auth&nbsp;-d&nbsp;-r&nbsp;-s&nbsp;HTTP/proxy01tst.fake.net<br>
auth_param&nbsp;negotiate&nbsp;children&nbsp;20&nbsp;startup=0&nbsp;idle=1<br>
auth_param&nbsp;negotiate&nbsp;keep_alive&nbsp;off<br>
<br>
auth_param&nbsp;ntlm&nbsp;program&nbsp;/usr/bin/ntlm_auth&nbsp;--diagnostics&nbsp;--helper-protocol=squid-2.5-ntlmssp&nbsp;--domain=FAKE.NET<br>
auth_param&nbsp;ntlm&nbsp;children&nbsp;10<br>
auth_param&nbsp;ntlm&nbsp;keep_alive&nbsp;off<br>
&lt;/CODE&gt;&lt;/PRE&gt;<br>
&lt;P&gt;Cheers,&lt;BR&gt;Pedro&lt;/P&gt;&lt;/DIV&gt;<br>
&lt;P&gt;Cumprimentos&nbsp;&lt;BR&gt;Pedro&nbsp;Lobo&nbsp;&lt;BR&gt;&lt;B&gt;Solutions&nbsp;Architect&nbsp;|&nbsp;System&nbsp;Engineer&lt;/B&gt;&nbsp;<br>
&lt;/P&gt;<br>
&lt;P&gt;&lt;A&nbsp;href=&quot;mailto:pedro.lobo@pt.clara.net&quot;&gt;pedro.lobo@pt.clara.net&lt;/A&gt;&nbsp;<br>
&lt;BR&gt;Tlm.:&nbsp;+351&nbsp;939&nbsp;528&nbsp;827&nbsp;|&nbsp;Tel.:&nbsp;+351&nbsp;214&nbsp;127&nbsp;314&nbsp;&lt;/P&gt;<br>
&lt;P&gt;Claranet&nbsp;Portugal&nbsp;&lt;BR&gt;Ed.&nbsp;Parque&nbsp;Expo&nbsp;&lt;BR&gt;Av.&nbsp;D.&nbsp;João&nbsp;II,&nbsp;1.07-2.1,&nbsp;4º&nbsp;Piso&nbsp;<br>
&lt;BR&gt;1998-014&nbsp;Lisboa&nbsp;&lt;BR&gt;&lt;A&nbsp;title=http://www.claranet.pt/&nbsp;<br>
href=&quot;http://www.claranet.pt/&quot;&gt;www.claranet.pt&nbsp;&lt;/A&gt;&lt;/P&gt;<br>
&lt;TABLE&nbsp;style=&quot;COLOR:&nbsp;#000000&quot;&nbsp;cellSpacing=0&nbsp;cellPadding=0&nbsp;border=0&gt;<br>
&nbsp;&nbsp;&lt;TBODY&gt;<br>
&nbsp;&nbsp;&lt;TR&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;TD&nbsp;style=&quot;PADDING-BOTTOM:&nbsp;4px&quot;&nbsp;vAlign=bottom&gt;&lt;A&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;href=&quot;http://www.claranet.pt/&quot;&gt;&lt;IMG&nbsp;id=Picture_x0020_21&nbsp;border=0&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alt=http://www.claranet.co.uk/sites/claranet.co.uk/files/u3/claranet_logo.png&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;src=&quot;http://www.claranet.co.uk/sites/claranet.co.uk/files/u3/claranet_logo.png&quot;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;width=126&nbsp;height=26&gt;&nbsp;&lt;/A&gt;&lt;/TD&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;TD&nbsp;style=&quot;PADDING-BOTTOM:&nbsp;4px&quot;&nbsp;vAlign=bottom&gt;&lt;A&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;href=&quot;http://www.linkedin.com/groups?home=&amp;gid=3746436&quot;&gt;&lt;IMG&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id=Picture_x0020_22&nbsp;border=0&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alt=http://www.claranet.co.uk/sites/claranet.co.uk/files/u3/email-linkedin-icon.png&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;src=&quot;http://www.claranet.co.uk/sites/claranet.co.uk/files/u3/email-linkedin-icon.png&quot;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;width=30&nbsp;height=17&gt;&nbsp;&lt;/A&gt;&lt;/TD&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;TD&nbsp;style=&quot;PADDING-BOTTOM:&nbsp;4px&quot;&nbsp;vAlign=bottom&gt;&lt;A&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;href=&quot;https://twitter.com/Claranet_PT&quot;&gt;&lt;IMG&nbsp;id=Picture_x0020_3&nbsp;border=0&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alt=http://www.claranet.co.uk/sites/claranet.co.uk/files/u3/email-twitter-icon.png&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;src=&quot;http://www.claranet.co.uk/sites/claranet.co.uk/files/u3/email-twitter-icon.png&quot;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;width=26&nbsp;height=17&gt;&nbsp;&lt;/A&gt;&lt;/TD&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;TD&nbsp;style=&quot;PADDING-BOTTOM:&nbsp;4px&quot;&nbsp;vAlign=bottom&gt;&lt;A&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;href=&quot;http://www.youtube.com/user/ClaranetPT&quot;&gt;&lt;IMG&nbsp;id=Picture_x0020_4&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;border=0&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alt=http://www.claranet.co.uk/sites/claranet.co.uk/files/u3/email-youtube-icon.png&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;src=&quot;http://www.claranet.co.uk/sites/claranet.co.uk/files/u3/email-youtube-icon.png&quot;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;width=26&nbsp;height=17&gt;&nbsp;&lt;/A&gt;&lt;/TD&gt;&lt;/TR&gt;&lt;/TBODY&gt;&lt;/TABLE&gt;<br>
&lt;P&gt;&lt;SPAN&nbsp;<br>
style=&quot;FONT-SIZE:&nbsp;10pt;&nbsp;FONT-FAMILY:&nbsp;arial&nbsp;,sans-serif;&nbsp;COLOR:&nbsp;#1f497d&quot;&gt;&lt;A&nbsp;<br>
href=&quot;http://www.claranet.pt/sites/claranet.pt/files/u6/magic_quadrant_for_cloudenab_260243.pdf&quot;&gt;&lt;IMG&nbsp;<br>
id=Picture_x0020_0&nbsp;border=0&nbsp;alt=&quot;GARTNER&nbsp;BANNER&quot;&nbsp;src=&quot;http://lobo.li/N7Q8+&quot;&nbsp;<br>
width=324&nbsp;height=41&gt;&nbsp;&lt;/A&gt;&lt;/SPAN&gt;&lt;/P&gt;<br>
&lt;P&gt;&lt;SPAN&nbsp;style=&quot;COLOR:&nbsp;#909090&quot;&gt;Empresa&nbsp;certificada&nbsp;ISO&nbsp;9001,&nbsp;ISO&nbsp;20000&nbsp;e&nbsp;ISO&nbsp;<br>
27001&nbsp;&lt;o:p&gt;&lt;/o:p&gt;&lt;/SPAN&gt;&lt;/P&gt;<br>
&lt;P&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/P&gt;<br>
&lt;DIV&gt;&lt;/DIV&gt;<br>
&lt;DIV&nbsp;class=markdown&gt;&lt;/DIV&gt;<br>
&lt;P&gt;<br>
&lt;HR&gt;<br>
_______________________________________________&lt;BR&gt;squid-users&nbsp;mailing&nbsp;<br>
list&lt;BR&gt;squid-users@lists.squid-cache.org&lt;BR&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;BR&gt;&lt;/DIV&gt;&lt;/DIV&gt;&lt;/DIV&gt;&lt;/DIV&gt;&lt;/BODY&gt;&lt;/HTML&gt;<br>

</tt>
