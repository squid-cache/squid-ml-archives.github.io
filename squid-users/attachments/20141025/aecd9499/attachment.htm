<tt>
&lt;div&nbsp;class=&quot;markdown&quot;&gt;<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;Hi&nbsp;Dan,&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;Well&nbsp;now&nbsp;I&nbsp;feel&nbsp;incredibly&nbsp;stupid!!!&nbsp;Just&nbsp;checked&nbsp;and&nbsp;it&nbsp;seems&nbsp;something&nbsp;must've&nbsp;changed&nbsp;the&nbsp;permissions&nbsp;on&nbsp;my&nbsp;keytab&nbsp;file&nbsp;(I&nbsp;did&nbsp;mention&nbsp;it&nbsp;was&nbsp;working&nbsp;at&nbsp;one&nbsp;time).&nbsp;For&nbsp;some&nbsp;odd&nbsp;reason,&nbsp;although&nbsp;squid&nbsp;user&nbsp;and&nbsp;group&nbsp;both&nbsp;owned&nbsp;the&nbsp;key&nbsp;tab&nbsp;file,&nbsp;only&nbsp;user&nbsp;had&nbsp;read&nbsp;permissions.&nbsp;I&nbsp;haven't&nbsp;yet&nbsp;figured&nbsp;out&nbsp;what&nbsp;might&nbsp;have&nbsp;changed&nbsp;those&nbsp;permissions&nbsp;(maybe&nbsp;some&nbsp;troubleshooting&nbsp;I&nbsp;did&nbsp;earlier),&nbsp;but&nbsp;fixing&nbsp;the&nbsp;permissions&nbsp;seems&nbsp;to&nbsp;have&nbsp;sorted&nbsp;the&nbsp;problem.&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;Thanks&nbsp;everybody&nbsp;for&nbsp;your&nbsp;help.&nbsp;Have&nbsp;a&nbsp;great&nbsp;weekend!&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;Cheers,&lt;br&gt;<br>
Pedro&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;Monday&nbsp;I'll&nbsp;do&nbsp;a&nbsp;little&nbsp;more&nbsp;testing&nbsp;with&nbsp;the&nbsp;pilot&nbsp;group,&nbsp;but&nbsp;at&nbsp;least&nbsp;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;On&nbsp;25&nbsp;Oct&nbsp;2014,&nbsp;at&nbsp;10:41,&nbsp;Dan&nbsp;Charlesworth&nbsp;wrote:&lt;/p&gt;<br>
<br>
&lt;blockquote&gt;<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;I&nbsp;was&nbsp;recently&nbsp;receiving&nbsp;this&nbsp;(incredibly&nbsp;vague)&nbsp;error.&nbsp;Turns&nbsp;out&nbsp;my&nbsp;squid&nbsp;user&nbsp;didn’t&nbsp;have&nbsp;permission&nbsp;to&nbsp;read&nbsp;the&nbsp;keytab.&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;On&nbsp;Sat,&nbsp;Oct&nbsp;25,&nbsp;2014&nbsp;at&nbsp;8:37&nbsp;PM,&nbsp;Pedro&nbsp;Lobo&nbsp;&lt;a&nbsp;href=&quot;mailto:palobo@gmail.com&quot;&gt;palobo@gmail.com&lt;/a&gt;&nbsp;wrote:&lt;/p&gt;<br>
<br>
&lt;blockquote&gt;<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;Hi&nbsp;Markus,&lt;br&gt;<br>
I&nbsp;used&nbsp;msktutil&nbsp;to&nbsp;create&nbsp;the&nbsp;keytab.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;msktutil&nbsp;-c&nbsp;-s&nbsp;HTTP/proxy01tst.fake.net&nbsp;-h&nbsp;proxy01tst.fake.net&nbsp;-k&lt;br&gt;<br>
/etc/squid3/PROXY.keytab&nbsp;--computer-name&nbsp;proxy01-tst&nbsp;--upn&lt;br&gt;<br>
HTTP/proxy01tst.fake.net&nbsp;--server&nbsp;srv01.fake.net&nbsp;--verbose&lt;br&gt;<br>
Output&nbsp;of&nbsp;klist&nbsp;-ekt:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;10/24/2014&nbsp;22:59:50&nbsp;proxy01-tst$@FAKE.NET&nbsp;(arcfour-hmac)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;10/24/2014&nbsp;22:59:50&nbsp;proxy01-tst$@FAKE.NET&lt;br&gt;<br>
(aes128-cts-hmac-sha1-96)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;10/24/2014&nbsp;22:59:50&nbsp;proxy01-tst$@FAKE.NET&lt;br&gt;<br>
(aes256-cts-hmac-sha1-96)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;10/24/2014&nbsp;22:59:50&nbsp;HTTP/&lt;a&nbsp;href=&quot;mailto:proxy01tst.FAKE.net@FAKE.NET&quot;&gt;proxy01tst.FAKE.net@FAKE.NET&lt;/a&gt;&lt;br&gt;<br>
(arcfour-hmac)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;10/24/2014&nbsp;22:59:50&nbsp;HTTP/&lt;a&nbsp;href=&quot;mailto:proxy01tst.FAKE.net@FAKE.NET&quot;&gt;proxy01tst.FAKE.net@FAKE.NET&lt;/a&gt;&lt;br&gt;<br>
(aes128-cts-hmac-sha1-96)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;10/24/2014&nbsp;22:59:50&nbsp;HTTP/&lt;a&nbsp;href=&quot;mailto:proxy01tst.FAKE.net@FAKE.NET&quot;&gt;proxy01tst.FAKE.net@FAKE.NET&lt;/a&gt;&lt;br&gt;<br>
(aes256-cts-hmac-sha1-96)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;10/24/2014&nbsp;22:59:50&nbsp;host/&lt;a&nbsp;href=&quot;mailto:proxy01tst.FAKE.net@FAKE.NET&quot;&gt;proxy01tst.FAKE.net@FAKE.NET&lt;/a&gt;&lt;br&gt;<br>
(arcfour-hmac)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;10/24/2014&nbsp;22:59:50&nbsp;host/&lt;a&nbsp;href=&quot;mailto:proxy01tst.FAKE.net@FAKE.NET&quot;&gt;proxy01tst.FAKE.net@FAKE.NET&lt;/a&gt;&lt;br&gt;<br>
(aes128-cts-hmac-sha1-96)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;10/24/2014&nbsp;22:59:50&nbsp;host/&lt;a&nbsp;href=&quot;mailto:proxy01tst.FAKE.net@FAKE.NET&quot;&gt;proxy01tst.FAKE.net@FAKE.NET&lt;/a&gt;&lt;br&gt;<br>
(aes256-cts-hmac-sha1-96)&lt;br&gt;<br>
Yep,&nbsp;using&nbsp;MIT&nbsp;Kerberos&lt;br&gt;<br>
Thanks&nbsp;in&nbsp;advance&nbsp;for&nbsp;any&nbsp;help.&lt;br&gt;<br>
Cheers,&lt;br&gt;<br>
Pedro&lt;br&gt;<br>
On&nbsp;25&nbsp;Oct&nbsp;2014,&nbsp;at&nbsp;1:26,&nbsp;Markus&nbsp;Moeller&nbsp;wrote:&lt;/p&gt;<br>
<br>
&lt;blockquote&gt;<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;Hi&nbsp;Pedro,&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;How&nbsp;did&nbsp;you&nbsp;create&nbsp;your&nbsp;keytab&nbsp;?&nbsp;&nbsp;What&nbsp;does&nbsp;klist&nbsp;–ekt&lt;br&gt;<br>
&lt;squid.keytab&gt;&nbsp;show&nbsp;(&nbsp;I&nbsp;assume&nbsp;you&nbsp;use&nbsp;MIT&nbsp;Kerberos)&nbsp;?&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;Markus&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;&quot;Pedro&nbsp;Lobo&quot;&nbsp;&lt;a&nbsp;href=&quot;mailto:palobo@gmail.com&quot;&gt;palobo@gmail.com&lt;/a&gt;&nbsp;wrote&nbsp;in&nbsp;message&lt;br&gt;<br>
news:40E1E0E7-50C6-4117-94AA-50B06573430A@gmail.com...&lt;br&gt;<br>
Hi&nbsp;Squid&nbsp;Gurus,&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;I'm&nbsp;at&nbsp;my&nbsp;wit's&nbsp;end&nbsp;and&nbsp;in&nbsp;dire&nbsp;need&nbsp;of&nbsp;some&nbsp;squid&nbsp;expertise.&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;We've&nbsp;got&nbsp;a&nbsp;production&nbsp;environment&nbsp;with&nbsp;a&nbsp;couple&nbsp;of&nbsp;squid&nbsp;2.7&nbsp;servers&lt;br&gt;<br>
using&nbsp;NTLM&nbsp;and&nbsp;basic&nbsp;authentication.&nbsp;Recently&nbsp;though,&nbsp;we&nbsp;decided&nbsp;to&lt;br&gt;<br>
upgrade&nbsp;and&nbsp;I'm&nbsp;now&nbsp;setting&nbsp;up&nbsp;squid&nbsp;3.3&nbsp;with&nbsp;Kerberos&nbsp;and&nbsp;NTLM&lt;br&gt;<br>
Fallback.&nbsp;I've&nbsp;followed&nbsp;just&nbsp;about&nbsp;every&nbsp;guide&nbsp;I&nbsp;could&nbsp;find&nbsp;and&nbsp;in&nbsp;my&lt;br&gt;<br>
testing&nbsp;environment,&nbsp;things&nbsp;were&nbsp;working&nbsp;great.&nbsp;Now&nbsp;that&nbsp;I've&nbsp;hooked&lt;br&gt;<br>
it&nbsp;up&nbsp;to&nbsp;the&nbsp;main&nbsp;domain,&nbsp;things&nbsp;are&nbsp;awry.&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;If&nbsp;I&nbsp;use&nbsp;a&nbsp;machine&nbsp;that's&nbsp;not&nbsp;part&nbsp;of&nbsp;the&nbsp;domain,&nbsp;NTLM&nbsp;kicks&nbsp;in&nbsp;and&nbsp;I&lt;br&gt;<br>
can&nbsp;surf&nbsp;the&nbsp;web&nbsp;fine.&nbsp;If&nbsp;I&nbsp;use&nbsp;a&nbsp;Windows&nbsp;XP&nbsp;or&nbsp;Windows&nbsp;Server&nbsp;2003,&lt;br&gt;<br>
kerberos&nbsp;works&nbsp;just&nbsp;fine,&nbsp;however,&nbsp;if&nbsp;I&nbsp;use&nbsp;a&nbsp;machine&nbsp;Windows&nbsp;7,&nbsp;8&nbsp;or&lt;br&gt;<br>
2008&nbsp;server,&nbsp;I&nbsp;keep&nbsp;getting&nbsp;a&nbsp;popup&nbsp;asking&nbsp;me&nbsp;to&nbsp;authenticate&nbsp;and&nbsp;even&lt;br&gt;<br>
then,&nbsp;it's&nbsp;and&nbsp;endless&nbsp;loop&nbsp;until&nbsp;it&nbsp;fails.&nbsp;My&nbsp;cache.log&nbsp;is&nbsp;littered&lt;br&gt;<br>
with:&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;negotiate_kerberos_auth.cc(200):&nbsp;pid=1607&nbsp;:2014/10/24&nbsp;23:03:01|&lt;br&gt;<br>
negotiate_kerberos_auth:&nbsp;ERROR:&nbsp;gss_accept_sec_context()&nbsp;failed:&lt;br&gt;<br>
Unspecified&nbsp;GSS&nbsp;failure.&nbsp;&nbsp;Minor&nbsp;code&nbsp;may&nbsp;provide&nbsp;more&nbsp;information.&lt;br&gt;<br>
2014/10/24&nbsp;23:03:01|&nbsp;ERROR:&nbsp;Negotiate&nbsp;Authentication&nbsp;validating&nbsp;user.&lt;br&gt;<br>
Error&nbsp;returned&nbsp;'BH&nbsp;gss_accept_sec_context()&nbsp;failed:&nbsp;Unspecified&nbsp;GSS&lt;br&gt;<br>
failure.&nbsp;&nbsp;Minor&nbsp;code&nbsp;may&nbsp;provide&nbsp;more&nbsp;information.&nbsp;'&lt;br&gt;<br>
The&nbsp;odd&nbsp;thing,&nbsp;is&nbsp;that&nbsp;this&nbsp;has&nbsp;worked&nbsp;before.&nbsp;Help&nbsp;me&nbsp;Obi&nbsp;Wan...&lt;br&gt;<br>
You're&nbsp;my&nbsp;only&nbsp;hope!&nbsp;:)&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;Current&nbsp;Setup&lt;br&gt;<br>
Squid&nbsp;3.3&nbsp;running&nbsp;on&nbsp;Ubuntu&nbsp;14.04&nbsp;server.&nbsp;It's&nbsp;connected&nbsp;to&nbsp;a&nbsp;2003&lt;br&gt;<br>
server&nbsp;with&nbsp;function&nbsp;level&nbsp;2000&nbsp;(I&nbsp;know,&nbsp;we're&nbsp;trying&nbsp;to&nbsp;fase&nbsp;out&nbsp;the&lt;br&gt;<br>
older&nbsp;servers).&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;krb5.conf&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;[libdefaults]&lt;br&gt;<br>
&nbsp;default_realm&nbsp;=&nbsp;FAKE.NET&lt;br&gt;<br>
&nbsp;dns_lookup_kdc&nbsp;=&nbsp;yes&lt;br&gt;<br>
&nbsp;dns_lookup_realm&nbsp;=&nbsp;yes&lt;br&gt;<br>
&nbsp;ticket_lifetime&nbsp;=&nbsp;24h&lt;br&gt;<br>
&nbsp;default_keytab_name&nbsp;=&nbsp;/etc/squid3/PROXY.keytab&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;;&nbsp;for&nbsp;Windows&nbsp;2003&lt;br&gt;<br>
&nbsp;default_tgs_enctypes&nbsp;=&nbsp;rc4-hmac&nbsp;des-cbc-crc&nbsp;des-cbc-md5&lt;br&gt;<br>
&nbsp;default_tkt_enctypes&nbsp;=&nbsp;rc4-hmac&nbsp;des-cbc-crc&nbsp;des-cbc-md5&lt;br&gt;<br>
&nbsp;permitted_enctypes&nbsp;=&nbsp;rc4-hmac&nbsp;des-cbc-crc&nbsp;des-cbc-md5&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;[realms]&lt;br&gt;<br>
&nbsp;FAKE.NET&nbsp;=&nbsp;{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kdc&nbsp;=&nbsp;srv01.fake.net&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kdc&nbsp;=&nbsp;srv02.fake.net&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kdc&nbsp;=&nbsp;srv03.fake.net&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;admin_server&nbsp;=&nbsp;srv01.fake.net&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default_domain&nbsp;=&nbsp;fake.net&lt;br&gt;<br>
&nbsp;}&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;[domain_realm]&lt;br&gt;<br>
&nbsp;.fake.net&nbsp;=&nbsp;FAKE.NET&lt;br&gt;<br>
&nbsp;fake.net&nbsp;=&nbsp;FAKE.NET&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;[logging]&lt;br&gt;<br>
kdc&nbsp;=&nbsp;FILE:/var/log/kdc.log&lt;br&gt;<br>
admin_server&nbsp;=&nbsp;FILE:/var/log/kadmin.log&lt;br&gt;<br>
default&nbsp;=&nbsp;FILE:/var/log/krb5lib.log&lt;br&gt;<br>
squid.conf&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;auth_param&nbsp;negotiate&nbsp;program&nbsp;/usr/lib/squid3/negotiate_kerberos_auth&lt;br&gt;<br>
-d&nbsp;-r&nbsp;-s&nbsp;HTTP/proxy01tst.fake.net&lt;br&gt;<br>
auth_param&nbsp;negotiate&nbsp;children&nbsp;20&nbsp;startup=0&nbsp;idle=1&lt;br&gt;<br>
auth_param&nbsp;negotiate&nbsp;keep_alive&nbsp;off&lt;/p&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;auth_param&nbsp;ntlm&nbsp;program&nbsp;/usr/bin/ntlm_auth&nbsp;--diagnostics&lt;br&gt;<br>
--helper-protocol=squid-2.5-ntlmssp&nbsp;--domain=FAKE.NET&lt;br&gt;<br>
auth_param&nbsp;ntlm&nbsp;children&nbsp;10&lt;br&gt;<br>
auth_param&nbsp;ntlm&nbsp;keep_alive&nbsp;off&lt;br&gt;<br>
Cheers,&lt;br&gt;<br>
Pedro&lt;/p&gt;<br>
<br>
&lt;hr&gt;<br>
<br>
&lt;hr&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;/p&gt;<br>
<br>
&lt;hr&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;/p&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/blockquote&gt;<br>
<br>
&lt;p&nbsp;dir=&quot;auto&quot;&gt;squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;/p&gt;<br>
&lt;/blockquote&gt;<br>
<br>
&lt;/div&gt;
</tt>
