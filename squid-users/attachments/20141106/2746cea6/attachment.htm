<tt>
&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;div&nbsp;style=&quot;font-family:&nbsp;Verdana;font-size:&nbsp;12.0px;&quot;&gt;&lt;div&gt;I&#39;ve&nbsp;searched&nbsp;through&nbsp;the&nbsp;internets&nbsp;and&nbsp;tried&nbsp;various&nbsp;things...&nbsp;to&nbsp;no&nbsp;avail.&nbsp;Hopefully&nbsp;someone&nbsp;here&nbsp;can&nbsp;point&nbsp;me&nbsp;in&nbsp;the&nbsp;right&nbsp;direction.&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;I&nbsp;am&nbsp;sitting&nbsp;behind&nbsp;a&nbsp;proxy,&nbsp;which&nbsp;accepts&nbsp;http/https.&nbsp;Everything&nbsp;else&nbsp;is&nbsp;blocked.&nbsp;If&nbsp;I&nbsp;instruct&nbsp;my&nbsp;browser&nbsp;to&nbsp;use&nbsp;this&nbsp;proxy,&lt;/div&gt;<br>
<br>
&lt;div&gt;everything&nbsp;works&nbsp;dandy.&nbsp;Both&nbsp;http&nbsp;and&nbsp;https.&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;The&nbsp;problem&nbsp;is,&nbsp;I&nbsp;have&nbsp;a&nbsp;few&nbsp;apps&nbsp;that&nbsp;don&#39;t&nbsp;have&nbsp;an&nbsp;option&nbsp;to&nbsp;set&nbsp;proxy.&nbsp;So,&nbsp;my&nbsp;idea&nbsp;was&nbsp;to&nbsp;set&nbsp;up&nbsp;squid&nbsp;on&nbsp;the&nbsp;local&nbsp;machine&lt;/div&gt;<br>
<br>
&lt;div&gt;that&nbsp;would&nbsp;transparently&nbsp;redirect&nbsp;http/https&nbsp;to&nbsp;the&nbsp;proxy.&nbsp;Eg&nbsp;something&nbsp;like&nbsp;this:&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;[&nbsp;local_box:&nbsp;app&nbsp;(http&nbsp;or&nbsp;https)&nbsp;---&gt;&nbsp;squid&nbsp;]&nbsp;&nbsp;&nbsp;-----&gt;&nbsp;&nbsp;&nbsp;[&nbsp;the_proxy&nbsp;]&nbsp;&nbsp;&nbsp;-----&gt;&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;&nbsp;-----&gt;&nbsp;&nbsp;&nbsp;[&nbsp;internets&nbsp;]&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;I&nbsp;have&nbsp;no&nbsp;control&nbsp;of&nbsp;the&nbsp;proxy,&nbsp;nor&nbsp;do&nbsp;I&nbsp;know&nbsp;what&nbsp;goes&nbsp;on&nbsp;after&nbsp;it.&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;I&nbsp;have&nbsp;the&nbsp;following&nbsp;iptables&nbsp;rules:&lt;/div&gt;<br>
<br>
&lt;div&gt;<br>
&lt;div&gt;*nat&lt;br/&gt;<br>
:PREROUTING&nbsp;ACCEPT&nbsp;[1:89]&lt;br/&gt;<br>
:INPUT&nbsp;ACCEPT&nbsp;[1:89]&lt;br/&gt;<br>
:OUTPUT&nbsp;ACCEPT&nbsp;[549:34321]&lt;br/&gt;<br>
:POSTROUTING&nbsp;ACCEPT&nbsp;[624:38821]&lt;br/&gt;<br>
-A&nbsp;OUTPUT&nbsp;-p&nbsp;tcp&nbsp;-m&nbsp;tcp&nbsp;--dport&nbsp;80&nbsp;-j&nbsp;REDIRECT&nbsp;--to-ports&nbsp;3129&lt;br/&gt;<br>
-A&nbsp;OUTPUT&nbsp;-p&nbsp;tcp&nbsp;-m&nbsp;tcp&nbsp;--dport&nbsp;443&nbsp;-j&nbsp;REDIRECT&nbsp;--to-ports&nbsp;3130&lt;br/&gt;<br>
COMMIT&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;And&nbsp;my&nbsp;squid.conf&nbsp;is&nbsp;mostly&nbsp;garden&nbsp;variety:&lt;/div&gt;<br>
<br>
&lt;div&gt;<br>
&lt;div&gt;acl&nbsp;localnet&nbsp;src&nbsp;10.0.0.0/8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;RFC1918&nbsp;possible&nbsp;internal&nbsp;network&lt;br/&gt;<br>
acl&nbsp;localnet&nbsp;src&nbsp;172.16.0.0/12&nbsp;&nbsp;#&nbsp;RFC1918&nbsp;possible&nbsp;internal&nbsp;network&lt;br/&gt;<br>
acl&nbsp;localnet&nbsp;src&nbsp;192.168.0.0/16&nbsp;#&nbsp;RFC1918&nbsp;possible&nbsp;internal&nbsp;network&lt;/div&gt;<br>
<br>
&lt;div&gt;acl&nbsp;SSL_ports&nbsp;port&nbsp;443&lt;br/&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;80&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;http&lt;br/&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;21&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;ftp&lt;br/&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;443&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;https&lt;br/&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;70&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;gopher&lt;br/&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;210&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;wais&lt;br/&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;1025-65535&nbsp;&nbsp;#&nbsp;unregistered&nbsp;ports&lt;br/&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;280&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;http-mgmt&lt;br/&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;488&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;gss-http&lt;br/&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;591&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;filemaker&lt;br/&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;777&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;multiling&nbsp;http&lt;br/&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;901&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;SWAT&lt;br/&gt;<br>
acl&nbsp;CONNECT&nbsp;method&nbsp;CONNECT&lt;/div&gt;<br>
<br>
&lt;div&gt;http_access&nbsp;deny&nbsp;!Safe_ports&lt;br/&gt;<br>
http_access&nbsp;deny&nbsp;CONNECT&nbsp;!SSL_ports&lt;/div&gt;<br>
<br>
&lt;div&gt;http_access&nbsp;allow&nbsp;localhost&nbsp;manager&lt;br/&gt;<br>
http_access&nbsp;deny&nbsp;manager&lt;/div&gt;<br>
<br>
&lt;div&gt;http_access&nbsp;allow&nbsp;localnet&lt;br/&gt;<br>
http_access&nbsp;allow&nbsp;localhost&lt;/div&gt;<br>
<br>
&lt;div&gt;http_access&nbsp;deny&nbsp;all&lt;/div&gt;<br>
<br>
&lt;div&gt;coredump_dir&nbsp;/var/cache/squid<br>
&lt;div&gt;refresh_pattern&nbsp;^ftp:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1440&nbsp;&nbsp;&nbsp;&nbsp;20%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10080&lt;/div&gt;<br>
<br>
&lt;div&gt;refresh_pattern&nbsp;^gopher:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1440&nbsp;&nbsp;&nbsp;&nbsp;0%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1440&lt;br/&gt;<br>
refresh_pattern&nbsp;-i&nbsp;(/cgi-bin/&#124;&#92;?)&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&lt;br/&gt;<br>
refresh_pattern&nbsp;.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;20%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4320&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;cache&nbsp;deny&nbsp;all&lt;/div&gt;<br>
&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;cache_peer&nbsp;proxy&nbsp;parent&nbsp;3128&nbsp;0&nbsp;no-query&nbsp;no-digest&nbsp;default&lt;br/&gt;<br>
never_direct&nbsp;allow&nbsp;all&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;http_port&nbsp;3128&lt;br/&gt;<br>
http_port&nbsp;3129&nbsp;intercept&lt;br/&gt;<br>
https_port&nbsp;3130&nbsp;intercept&nbsp;ssl-bump&nbsp;generate-host-certificates=on&nbsp;cert=/etc/ssl/squid/cert.pem&nbsp;key=/etc/ssl/squid/key.pem&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;I&#39;ve&nbsp;generated&nbsp;the&nbsp;certs&nbsp;and&nbsp;ran&nbsp;ssl_crtd&nbsp;to&nbsp;init&nbsp;ssl&nbsp;db&nbsp;dirs.&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;To&nbsp;verify&nbsp;squid&nbsp;is&nbsp;working,&nbsp;I&#39;ve&nbsp;changed&nbsp;my&nbsp;browser&nbsp;proxy&nbsp;settings&nbsp;to&nbsp;127.0.0.1:3128&nbsp;for&nbsp;http&nbsp;and&nbsp;https.&lt;/div&gt;<br>
<br>
&lt;div&gt;Everything&nbsp;works&nbsp;like&nbsp;a&nbsp;charm.&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;This&nbsp;is&nbsp;where&nbsp;the&nbsp;&quot;fun&quot;&nbsp;begins:&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;==========&lt;/div&gt;<br>
<br>
&lt;div&gt;Without&nbsp;the&nbsp;proxy&nbsp;settings&nbsp;http&nbsp;also&nbsp;works&nbsp;just&nbsp;fine&nbsp;--&nbsp;in&nbsp;both&nbsp;the&nbsp;browser&nbsp;and&nbsp;wget&nbsp;command.&nbsp;Https&nbsp;on&nbsp;the&nbsp;other&nbsp;hand&nbsp;is&nbsp;fubar.&lt;/div&gt;<br>
<br>
&lt;div&gt;In&nbsp;the&nbsp;browser&nbsp;I&nbsp;get&nbsp;&quot;Unsupported&nbsp;Request&nbsp;Method&nbsp;and&nbsp;Protocol&quot;&nbsp;error&nbsp;(after&nbsp;accepting&nbsp;the&nbsp;&quot;invalid&quot;&nbsp;certificate).&lt;/div&gt;<br>
<br>
&lt;div&gt;With&nbsp;wget&nbsp;I&nbsp;get:&lt;/div&gt;<br>
<br>
&lt;div&gt;<br>
&lt;div&gt;local_box&nbsp;[~]&nbsp;wget&nbsp;https://google.com&nbsp;--no-check-certificate&lt;br/&gt;<br>
--2014-11-05&nbsp;20:21:12--&nbsp;&nbsp;https://google.com/&lt;br/&gt;<br>
Resolving&nbsp;google.com...&nbsp;74.125.196.138,&nbsp;74.125.196.139,&nbsp;74.125.196.101,&nbsp;...&lt;br/&gt;<br>
Connecting&nbsp;to&nbsp;google.com&#124;74.125.196.138&#124;:443...&nbsp;connected.&lt;br/&gt;<br>
WARNING:&nbsp;cannot&nbsp;verify&nbsp;google.com&#39;s&nbsp;certificate,&nbsp;issued&nbsp;by&nbsp;&lsquo;/C=AU/ST=Some-State/O=Internet&nbsp;Widgits&nbsp;Pty&nbsp;Ltd&rsquo;:&lt;br/&gt;<br>
&nbsp;&nbsp;Self-signed&nbsp;certificate&nbsp;encountered.&lt;br/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;WARNING:&nbsp;certificate&nbsp;common&nbsp;name&nbsp;&lsquo;&rsquo;&nbsp;doesn&#39;t&nbsp;match&nbsp;requested&nbsp;host&nbsp;name&nbsp;&lsquo;google.com&rsquo;.&lt;br/&gt;<br>
HTTP&nbsp;request&nbsp;sent,&nbsp;awaiting&nbsp;response...&nbsp;501&nbsp;Not&nbsp;Implemented&lt;br/&gt;<br>
2014-11-05&nbsp;20:21:12&nbsp;ERROR&nbsp;501:&nbsp;Not&nbsp;Implemented.&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;<br>
&lt;div&gt;access.log&nbsp;says:&lt;/div&gt;<br>
<br>
&lt;div&gt;1415236731.852&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;19&nbsp;10.0.0.13&nbsp;TCP_MISS/501&nbsp;4255&nbsp;GET&nbsp;https://www.google.com/&nbsp;-&nbsp;FIRSTUP_PARENT/10.64.252.14&nbsp;text/html&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;==========&lt;/div&gt;<br>
&lt;/div&gt;<br>
<br>
&lt;div&gt;If&nbsp;I&nbsp;add&nbsp;&#39;ssl_bump&nbsp;server-first&nbsp;all&#39;&nbsp;to&nbsp;squid.conf.&nbsp;Whenever&nbsp;I&nbsp;try&nbsp;to&nbsp;pull&nbsp;up&nbsp;an&nbsp;https&nbsp;page,&nbsp;it&nbsp;barfs&nbsp;with:&lt;/div&gt;<br>
<br>
&lt;div&gt;<br>
&lt;div&gt;2014/11/05&nbsp;20:22:28&#124;&nbsp;assertion&nbsp;failed:&nbsp;forward.cc:785:&nbsp;&quot;peer-&gt;use_ssl&quot;&lt;br/&gt;<br>
Aborted&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;==========&lt;/div&gt;<br>
<br>
&lt;div&gt;If&nbsp;I&nbsp;change&nbsp;it&nbsp;to&nbsp;&#39;ssl_bump&nbsp;client-first&nbsp;all&#39;,&nbsp;I&nbsp;get&nbsp;&quot;Unable&nbsp;to&nbsp;forward&nbsp;this&nbsp;request&nbsp;at&nbsp;this&nbsp;time&quot;&nbsp;in&nbsp;the&nbsp;browser.&lt;/div&gt;<br>
<br>
&lt;div&gt;And&nbsp;wget&nbsp;says:&lt;/div&gt;<br>
<br>
&lt;div&gt;<br>
&lt;div&gt;local_box&nbsp;[~]&nbsp;wget&nbsp;https://google.com&nbsp;--no-check-certificate&lt;br/&gt;<br>
--2014-11-05&nbsp;20:26:53--&nbsp;&nbsp;https://google.com/&lt;br/&gt;<br>
Resolving&nbsp;google.com...&nbsp;74.125.196.101,&nbsp;74.125.196.100,&nbsp;74.125.196.139,&nbsp;...&lt;br/&gt;<br>
Connecting&nbsp;to&nbsp;google.com&#124;74.125.196.101&#124;:443...&nbsp;connected.&lt;br/&gt;<br>
WARNING:&nbsp;cannot&nbsp;verify&nbsp;google.com&#39;s&nbsp;certificate,&nbsp;issued&nbsp;by&nbsp;&lsquo;/C=AU/ST=Some-State/O=Internet&nbsp;Widgits&nbsp;Pty&nbsp;Ltd&rsquo;:&lt;br/&gt;<br>
&nbsp;&nbsp;Self-signed&nbsp;certificate&nbsp;encountered.&lt;br/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;WARNING:&nbsp;certificate&nbsp;common&nbsp;name&nbsp;&lsquo;74.125.196.101&rsquo;&nbsp;doesn&#39;t&nbsp;match&nbsp;requested&nbsp;host&nbsp;name&nbsp;&lsquo;google.com&rsquo;.&lt;br/&gt;<br>
HTTP&nbsp;request&nbsp;sent,&nbsp;awaiting&nbsp;response...&nbsp;503&nbsp;Service&nbsp;Unavailable&lt;br/&gt;<br>
2014-11-05&nbsp;20:26:53&nbsp;ERROR&nbsp;503:&nbsp;Service&nbsp;Unavailable.&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;access.log&nbsp;says:&lt;/div&gt;<br>
<br>
&lt;div&gt;1415237271.133&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;10.0.0.13&nbsp;TCP_MISS/503&nbsp;3840&nbsp;GET&nbsp;https://google.com/&nbsp;-&nbsp;FIRSTUP_PARENT/10.64.252.14&nbsp;text/html&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;==========&lt;/div&gt;<br>
<br>
&lt;div&gt;And&nbsp;so&nbsp;after&nbsp;endless&nbsp;searching&nbsp;and&nbsp;searching&nbsp;and&nbsp;trying&nbsp;various&nbsp;things&nbsp;I&nbsp;came&nbsp;here.&nbsp;Could&nbsp;please&nbsp;help&nbsp;me&nbsp;figure&nbsp;out&nbsp;why&nbsp;it&nbsp;is&nbsp;not&nbsp;working?&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;Thank&nbsp;you.&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;-D&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;<br>
<br>

</tt>
