[From nobody Thu Jan  9 08:27:16 2025
X-Envelope-From: &lt;cassiano@polaco.pro.br&gt;
X-Envelope-To: &lt;squid-users@squid-cache.org&gt;
Received: from mail-ie0-f178.google.com (unknown)
 by lists.squid-cache.org(Postfix 2.11.0/8.13.0) with SMTP id unknown
 Tue, 18 Nov 2014 18:36:39 +0000
 (envelope-from &lt;cassiano@polaco.pro.br&gt;
Received: by mail-ie0-f178.google.com with SMTP id tp5so5175334ieb.9
 for &lt;squid-users@squid-cache.org&gt;; Tue, 18 Nov 2014 10:35:38 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20130820;
 h=x-gm-message-state:mime-version:in-reply-to:references:date
 :message-id:subject:from:to:content-type;
 bh=m7w5q/2NMy21086kknKI9lLXQdrVuNJKn+x3GToiXVU=;
 b=Cr4zn/vdK/ckq7OYSjW5co9iR3SvueHAWM7UW8KX5BlACMG50jiy14dwsF/gzE5w+m
 N2TlMd/VhozDzvQmgrqECOaa3YTLqR/Ui5jcn6wdUSXPk6tWsxb1d7cVwutc9hF3JiSc
 ja321vzyULLHXr84BUJMerDCllE2KXL7ydFDYhUgkxIruzPDlZkcFHTth4KoUHNrS5bi
 z9Fu7NWFQUWZ9yzvUlJwBfWd+kRSd+0rNTo2RJ62CLqJH1QjtYpnzaw913ATbo1opSqJ
 V8gRoxyksMFNzUUpqbzaCoTrVkuzrf19lVNqjE3gLiw66utlHjZZhFEdw78LFp7PXel2
 GAKw==
X-Gm-Message-State: ALoCoQlSE+1Dyj9cKnwn+XrzKl4oPV6lXyCrw1Y74UQYaDNGt7No7wc6L5F3qXNQvpFcJZj+97VJ
MIME-Version: 1.0
X-Received: by 10.107.128.138 with SMTP id k10mr4521336ioi.69.1416335738740;
 Tue, 18 Nov 2014 10:35:38 -0800 (PST)
Received: by 10.107.6.193 with HTTP; Tue, 18 Nov 2014 10:35:38 -0800 (PST)
X-Originating-IP: [187.113.211.85]
In-Reply-To: &lt;546B8FA1.6050200@cronomagic.com&gt;
References: &lt;546B890E.7000605@cronomagic.com&gt;
 &lt;CAOoxthMPmo6DTtppXR11wJ=dSH0Z0Z4aEpQ8gUpZdzKQNVqJYA@mail.gmail.com&gt;
 &lt;546B8FA1.6050200@cronomagic.com&gt;
Date: Tue, 18 Nov 2014 16:35:38 -0200
Message-ID: &lt;CAOoxthN-69bw7NifP_7zKqU3Z2V5sY0NWmUy49v5sfbDG++Nxg@mail.gmail.com&gt;
Subject: Re: [squid-users] squid-3.4.8 intercept
From: Cassiano Martin &lt;cassiano@polaco.pro.br&gt;
To: Frank &lt;frank@cronomagic.com&gt;, 
 &quot;squid-users@squid-cache.org&quot; &lt;squid-users@squid-cache.org&gt;
Content-Type: text/plain; charset=UTF-8

&gt;From what I know, localnet resumes to 10.x.x.x 172.16.x.x and
192.168.x.x RFC net ranges. You might try creating a new ACL and allow
it.

acl mynet src 66.159.32.0/24
http_access allow mynet

and check your browser, you should point it to port 3128 and not 3129,
which is set to iptables intercept mode only.

2014-11-18 16:27 GMT-02:00 Frank &lt;frank@cronomagic.com&gt;:
&gt;    Hi,
&gt;
&gt;     Thank you for answering me.
&gt;
&gt; Yup I tried that too.  You can see there is a # in front of it and the allow
&gt; all is above it.
&gt; I tried both allow all and allow my network (# removed) 66.159.32.0/24.
&gt;
&gt; acl localnet src 66.159.32.0/24
&gt;
&gt;
&gt; But i would figure that
&gt;
&gt; acl localnet src all
&gt;
&gt; Should allow everything??
&gt;
&gt;
&gt; On 14-11-18 01:14 PM, Cassiano Martin wrote:
&gt;
&gt; Thats because you have not set your local network to squid. You have
&gt; to allow your network  range 66.159.32.0/24
&gt;
&gt; 2014-11-18 15:59 GMT-02:00 Frank &lt;frank@cronomagic.com&gt;:
&gt;
&gt;     Hi,
&gt;
&gt;     Since upgrading from 3.1.22 to 3.4.8 I have been unable to get the
&gt; transparent mode
&gt; to accept my IP.  I am seeing permission denied in the transaction when I do
&gt; a packet dump.
&gt; I have read the documentation making changes for 3.4.8.
&gt; I even allowed everything and no go.
&gt;
&gt; I also compiled squid and here is my configure script:
&gt;
&gt; ./configure \
&gt;   --prefix=/usr/share/squid-3.4.8  \
&gt;   --libdir=/usr/lib${LIBDIRSUFFIX} \
&gt;   --sysconfdir=/etc/squid \
&gt;   --localstatedir=/var/log/squid \
&gt;   --datadir=/usr/share/squid-3.4.8 \
&gt;   --with-pidfile=/var/run/squid/squid.pid \
&gt;   --mandir=/usr/man \
&gt;   --with-logdir=/var/log/squid \
&gt;   --enable-snmp \
&gt;   --enable-ipf-transparent \
&gt;   --enable-ipfw-transparent
&gt; #  --enable-auth=&quot;basic&quot; \
&gt; #  --enable-basic-auth-helpers=&quot;NCSA&quot; \
&gt; #  --enable-linux-netfilter \
&gt; #  --enable-async-io \
&gt; #  --disable-strict-error-checking
&gt;
&gt; My machine the browser is on:
&gt;
&gt; 66.159.32.31
&gt;
&gt; The machine that is running squid:
&gt;
&gt; 66.159.47.22
&gt;
&gt; Here is my squid.conf
&gt;
&gt; ===================================================================================
&gt;
&gt; #
&gt; # Recommended minimum configuration:
&gt; #
&gt;
&gt; cache_effective_user  squid
&gt; cache_effective_group  squid
&gt;
&gt; # Example rule allowing access from your local networks.
&gt; # Adapt to list your (internal) IP networks from where browsing
&gt; # should be allowed
&gt; acl localnet src all    # RFC1918 possible internal network
&gt; #acl localnet src 66.159.32.0/24        # RFC1918 possible internal network
&gt; #acl localnet src 108.161.167.0/24      # RFC1918 possible internal network
&gt; #acl localnet src 66.159.47.0/24        # RFC1918 possible internal network
&gt; #acl localnet src 127.0.0.0/24  # RFC1918 possible internal network
&gt;
&gt; acl SSL_ports port 443
&gt; acl Safe_ports port 80          # http
&gt; acl Safe_ports port 21          # ftp
&gt; acl Safe_ports port 443         # https
&gt; acl Safe_ports port 70          # gopher
&gt; acl Safe_ports port 210         # wais
&gt; acl Safe_ports port 1025-65535  # unregistered ports
&gt; acl Safe_ports port 280         # http-mgmt
&gt; acl Safe_ports port 488         # gss-http
&gt; acl Safe_ports port 591         # filemaker
&gt; acl Safe_ports port 777         # multiling http
&gt; acl CONNECT method CONNECT
&gt;
&gt; #
&gt; # Recommended minimum Access Permission configuration:
&gt; #
&gt; # Deny requests to certain unsafe ports
&gt; ########http_access deny !Safe_ports
&gt;
&gt; # Deny CONNECT to other than secure SSL ports
&gt; ###########http_access deny CONNECT !SSL_ports
&gt;
&gt; # Only allow cachemgr access from localhost
&gt; ###############http_access allow localhost manager
&gt;
&gt; ###############http_access deny manager
&gt;
&gt; # We strongly recommend the following be uncommented to protect innocent
&gt; # web applications running on the proxy server who think the only
&gt; # one who can access services on &quot;localhost&quot; is a local user
&gt; ############http_access deny to_localhost
&gt;
&gt; #
&gt; # INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
&gt; #
&gt; # Example rule allowing access from your local networks.
&gt; # Adapt localnet in the ACL section to list your (internal) IP networks
&gt; # from where browsing should be allowed
&gt;
&gt; http_access allow localnet
&gt; http_access allow localhost
&gt;
&gt; # And finally deny all other access to this proxy
&gt; #http_access deny all
&gt; http_access allow all
&gt;
&gt; # Squid normally listens to port 3128
&gt; http_port 3128
&gt; http_port 3129 intercept
&gt;
&gt; always_direct allow all
&gt;
&gt; # Uncomment and adjust the following to add a disk cache directory.
&gt; cache_dir ufs /usr/share/squid/cache 100 32 512
&gt;
&gt; # Leave coredumps in the first cache dir
&gt; coredump_dir /var/log/squid/cache/squid
&gt;
&gt; #
&gt; # Add any of your own refresh_pattern entries above these.
&gt; #
&gt; refresh_pattern ^ftp:           1440    20%     10080
&gt; refresh_pattern ^gopher:        1440    0%      1440
&gt; refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
&gt; refresh_pattern .               0       20%     4320
&gt;
&gt; ==================================================================================
&gt;
&gt; And I have configured my browser to use HTTP Proxy 66.159.47.22 Port 3129
&gt;
&gt; I also setup iptables on my machine as follows and that didn't work either.
&gt; Same permission
&gt; denied.
&gt;
&gt;
&gt; /sbin/iptables -t nat -A OUTPUT -p tcp -s 66.159.32.31 --dport 80 -j DNAT
&gt; --to 66.159.47.22:3129
&gt;
&gt; Let me know if further info is needed.   Any help would be greatly
&gt; appreciated.
&gt;
&gt; --
&gt; Regards,
&gt; Frank Torontour
&gt; Network Administrator
&gt; frank@cronomagic.com
&gt; 514-341-1579 EXT-214
&gt; 1-800-427-6012 Ext-214
&gt;
&gt;
&gt; _______________________________________________
&gt; squid-users mailing list
&gt; squid-users@lists.squid-cache.org
&gt; http://lists.squid-cache.org/listinfo/squid-users
&gt;
&gt;
&gt; --
&gt; Regards,
&gt; Frank Torontour
&gt; Network Administrator
&gt; frank@cronomagic.com
&gt; 514-341-1579 EXT-214
&gt; 1-800-427-6012 Ext-214
]