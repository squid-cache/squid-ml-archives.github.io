<tt>
&lt;html&gt;<br>
&nbsp;&nbsp;&lt;head&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;http-equiv=&quot;content-type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&gt;<br>
&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&lt;body&nbsp;text=&quot;#000000&quot;&nbsp;bgcolor=&quot;#FFFFFF&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;   &nbsp;Hi,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;   &nbsp;Since&nbsp;upgrading&nbsp;from&nbsp;3.1.22&nbsp;to&nbsp;3.4.8&nbsp;I&nbsp;have&nbsp;been&nbsp;unable&nbsp;to&nbsp;get<br>
&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;transparent&nbsp;mode&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;accept&nbsp;my&nbsp;IP. &nbsp;I&nbsp;am&nbsp;seeing&nbsp;permission&nbsp;denied&nbsp;in&nbsp;the&nbsp;transaction<br>
&nbsp;&nbsp;&nbsp;&nbsp;when&nbsp;I&nbsp;do&nbsp;a&nbsp;packet&nbsp;dump.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;I&nbsp;have&nbsp;read&nbsp;the&nbsp;documentation&nbsp;making&nbsp;changes&nbsp;for&nbsp;3.4.8.&nbsp; &nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;I&nbsp;even&nbsp;allowed&nbsp;everything&nbsp;and&nbsp;no&nbsp;go.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;I&nbsp;also&nbsp;compiled&nbsp;squid&nbsp;and&nbsp;here&nbsp;is&nbsp;my&nbsp;configure&nbsp;script:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;./configure&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;--prefix=/usr/share/squid-3.4.8 &nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;--libdir=/usr/lib${LIBDIRSUFFIX}&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;--sysconfdir=/etc/squid&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;--localstatedir=/var/log/squid&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;--datadir=/usr/share/squid-3.4.8&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;--with-pidfile=/var/run/squid/squid.pid&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;--mandir=/usr/man&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;--with-logdir=/var/log/squid&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;--enable-snmp&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;--enable-ipf-transparent&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;--enable-ipfw-transparent&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;# &nbsp;--enable-auth=&quot;basic&quot;&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;# &nbsp;--enable-basic-auth-helpers=&quot;NCSA&quot;&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;# &nbsp;--enable-linux-netfilter&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;# &nbsp;--enable-async-io&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;# &nbsp;--disable-strict-error-checking&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;My&nbsp;machine&nbsp;the&nbsp;browser&nbsp;is&nbsp;on:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;66.159.32.31&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;machine&nbsp;that&nbsp;is&nbsp;running&nbsp;squid:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;66.159.47.22&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Here&nbsp;is&nbsp;my&nbsp;squid.conf&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
===================================================================================&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Recommended&nbsp;minimum&nbsp;configuration:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;cache_effective_user &nbsp;squid&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;cache_effective_group &nbsp;squid&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Example&nbsp;rule&nbsp;allowing&nbsp;access&nbsp;from&nbsp;your&nbsp;local&nbsp;networks.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Adapt&nbsp;to&nbsp;list&nbsp;your&nbsp;(internal)&nbsp;IP&nbsp;networks&nbsp;from&nbsp;where&nbsp;browsing&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;should&nbsp;be&nbsp;allowed&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;acl&nbsp;localnet&nbsp;src&nbsp;all   &nbsp;#&nbsp;RFC1918&nbsp;possible&nbsp;internal&nbsp;network&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#acl&nbsp;localnet&nbsp;src&nbsp;66.159.32.0/24       &nbsp;#&nbsp;RFC1918&nbsp;possible&nbsp;internal<br>
&nbsp;&nbsp;&nbsp;&nbsp;network&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#acl&nbsp;localnet&nbsp;src&nbsp;108.161.167.0/24     &nbsp;#&nbsp;RFC1918&nbsp;possible&nbsp;internal<br>
&nbsp;&nbsp;&nbsp;&nbsp;network&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#acl&nbsp;localnet&nbsp;src&nbsp;66.159.47.0/24       &nbsp;#&nbsp;RFC1918&nbsp;possible&nbsp;internal<br>
&nbsp;&nbsp;&nbsp;&nbsp;network&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#acl&nbsp;localnet&nbsp;src&nbsp;127.0.0.0/24 &nbsp;#&nbsp;RFC1918&nbsp;possible&nbsp;internal&nbsp;network&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;acl&nbsp;SSL_ports&nbsp;port&nbsp;443&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;80         &nbsp;#&nbsp;http&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;21         &nbsp;#&nbsp;ftp&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;443        &nbsp;#&nbsp;https&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;70         &nbsp;#&nbsp;gopher&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;210        &nbsp;#&nbsp;wais&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;1025-65535 &nbsp;#&nbsp;unregistered&nbsp;ports&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;280        &nbsp;#&nbsp;http-mgmt&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;488        &nbsp;#&nbsp;gss-http&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;591        &nbsp;#&nbsp;filemaker&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;777        &nbsp;#&nbsp;multiling&nbsp;http&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;acl&nbsp;CONNECT&nbsp;method&nbsp;CONNECT&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Recommended&nbsp;minimum&nbsp;Access&nbsp;Permission&nbsp;configuration:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Deny&nbsp;requests&nbsp;to&nbsp;certain&nbsp;unsafe&nbsp;ports&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;########http_access&nbsp;deny&nbsp;!Safe_ports&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Deny&nbsp;CONNECT&nbsp;to&nbsp;other&nbsp;than&nbsp;secure&nbsp;SSL&nbsp;ports&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;###########http_access&nbsp;deny&nbsp;CONNECT&nbsp;!SSL_ports&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Only&nbsp;allow&nbsp;cachemgr&nbsp;access&nbsp;from&nbsp;localhost&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;###############http_access&nbsp;allow&nbsp;localhost&nbsp;manager&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;###############http_access&nbsp;deny&nbsp;manager&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;We&nbsp;strongly&nbsp;recommend&nbsp;the&nbsp;following&nbsp;be&nbsp;uncommented&nbsp;to&nbsp;protect<br>
&nbsp;&nbsp;&nbsp;&nbsp;innocent&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;web&nbsp;applications&nbsp;running&nbsp;on&nbsp;the&nbsp;proxy&nbsp;server&nbsp;who&nbsp;think&nbsp;the&nbsp;only&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;one&nbsp;who&nbsp;can&nbsp;access&nbsp;services&nbsp;on&nbsp;&quot;localhost&quot;&nbsp;is&nbsp;a&nbsp;local&nbsp;user&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;############http_access&nbsp;deny&nbsp;to_localhost&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;INSERT&nbsp;YOUR&nbsp;OWN&nbsp;RULE(S)&nbsp;HERE&nbsp;TO&nbsp;ALLOW&nbsp;ACCESS&nbsp;FROM&nbsp;YOUR&nbsp;CLIENTS&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Example&nbsp;rule&nbsp;allowing&nbsp;access&nbsp;from&nbsp;your&nbsp;local&nbsp;networks.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Adapt&nbsp;localnet&nbsp;in&nbsp;the&nbsp;ACL&nbsp;section&nbsp;to&nbsp;list&nbsp;your&nbsp;(internal)&nbsp;IP<br>
&nbsp;&nbsp;&nbsp;&nbsp;networks&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;from&nbsp;where&nbsp;browsing&nbsp;should&nbsp;be&nbsp;allowed&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;http_access&nbsp;allow&nbsp;localnet&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;http_access&nbsp;allow&nbsp;localhost&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;And&nbsp;finally&nbsp;deny&nbsp;all&nbsp;other&nbsp;access&nbsp;to&nbsp;this&nbsp;proxy&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#http_access&nbsp;deny&nbsp;all&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;http_access&nbsp;allow&nbsp;all&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Squid&nbsp;normally&nbsp;listens&nbsp;to&nbsp;port&nbsp;3128&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;http_port&nbsp;3128 &nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;http_port&nbsp;3129&nbsp;intercept&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;always_direct&nbsp;allow&nbsp;all&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Uncomment&nbsp;and&nbsp;adjust&nbsp;the&nbsp;following&nbsp;to&nbsp;add&nbsp;a&nbsp;disk&nbsp;cache&nbsp;directory.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;cache_dir&nbsp;ufs&nbsp;/usr/share/squid/cache&nbsp;100&nbsp;32&nbsp;512&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Leave&nbsp;coredumps&nbsp;in&nbsp;the&nbsp;first&nbsp;cache&nbsp;dir&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;coredump_dir&nbsp;/var/log/squid/cache/squid&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Add&nbsp;any&nbsp;of&nbsp;your&nbsp;own&nbsp;refresh_pattern&nbsp;entries&nbsp;above&nbsp;these.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;refresh_pattern&nbsp;^ftp:          &nbsp;1440   &nbsp;20%    &nbsp;10080&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;refresh_pattern&nbsp;^gopher:       &nbsp;1440   &nbsp;0%     &nbsp;1440&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;refresh_pattern&nbsp;-i&nbsp;(/cgi-bin/|\?)&nbsp;0    &nbsp;0%     &nbsp;0&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;refresh_pattern&nbsp;.              &nbsp;0      &nbsp;20%    &nbsp;4320&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
==================================================================================&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;class=&quot;moz-signature&quot;&nbsp;cols=&quot;72&quot;&gt;&lt;big&gt;And&nbsp;I&nbsp;have&nbsp;configured&nbsp;my&nbsp;browser&nbsp;to&nbsp;use&nbsp;HTTP&nbsp;Proxy&nbsp;66.159.47.22&nbsp;Port&nbsp;3129&lt;/big&gt;<br>
<br>
&lt;big&gt;I&nbsp;also&nbsp;setup&nbsp;iptables&nbsp;on&nbsp;my&nbsp;machine&nbsp;as&nbsp;follows&nbsp;and&nbsp;that&nbsp;didn't&nbsp;work&nbsp;either.&nbsp;Same&nbsp;permission<br>
denied.&lt;/big&gt;<br>
<br>
<br>
&lt;big&gt;/sbin/iptables&nbsp;-t&nbsp;nat&nbsp;-A&nbsp;OUTPUT&nbsp;-p&nbsp;tcp&nbsp;-s&nbsp;66.159.32.31&nbsp;--dport&nbsp;80&nbsp;-j&nbsp;DNAT&nbsp;--to&nbsp;66.159.47.22:3129<br>
<br>
Let&nbsp;me&nbsp;know&nbsp;if&nbsp;further&nbsp;info&nbsp;is&nbsp;needed.&nbsp;&nbsp;&nbsp;Any&nbsp;help&nbsp;would&nbsp;be&nbsp;greatly&nbsp;appreciated.<br>
&lt;/big&gt;<br>
--&nbsp;<br>
Regards,<br>
Frank&nbsp;Torontour<br>
Network&nbsp;Administrator<br>
&lt;a&nbsp;class=&quot;moz-txt-link-abbreviated&quot;&nbsp;href=&quot;mailto:frank@cronomagic.com&quot;&gt;frank@cronomagic.com&lt;/a&gt;<br>
514-341-1579&nbsp;EXT-214<br>
1-800-427-6012&nbsp;Ext-214&lt;/pre&gt;<br>
&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
