<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;div&gt;Hi&nbsp;again,&lt;br&gt;&lt;br&gt;Solved&nbsp;by&nbsp;using&nbsp;%&lt;{Content-Type}&nbsp;log&nbsp;format&nbsp;instead&nbsp;of&nbsp;the&nbsp;one&nbsp;with&nbsp;an&nbsp;additional&nbsp;h&nbsp;with&nbsp;it&nbsp;(recommend&nbsp;while&nbsp;running&nbsp;squid&nbsp;-k&nbsp;parse).&lt;br&gt;&lt;/div&gt;Actually&nbsp;is&nbsp;a&nbsp;bug&nbsp;in&nbsp;the&nbsp;code&nbsp;handling&nbsp;the&nbsp;parsing&nbsp;of&nbsp;the&nbsp;external&nbsp;acl&#39;s&nbsp;but&nbsp;here&nbsp;is&nbsp;not&nbsp;the&nbsp;place&nbsp;to&nbsp;discuss&nbsp;it,&nbsp;i&nbsp;will&nbsp;open&nbsp;a&nbsp;new&nbsp;one&nbsp;bug&nbsp;report&nbsp;asap&nbsp;on&nbsp;&lt;a&nbsp;href=&quot;http://bugs.squid-cache.org&quot;&gt;bugs.squid-cache.org&lt;/a&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;Kindest&nbsp;Regards&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;2014-11-20&nbsp;13:35&nbsp;GMT-06:00&nbsp;Jorge&nbsp;Iván&nbsp;Burgos&nbsp;Aguilar&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:jorgeburgos@inaipyucatan.org.mx&quot;&nbsp;target=&quot;_blank&quot;&gt;jorgeburgos@inaipyucatan.org.mx&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;Hi,&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;First&nbsp;of&nbsp;all&nbsp;my&nbsp;setup&nbsp;information&lt;br&gt;&lt;/div&gt;&lt;div&gt;Distribution:&nbsp;CentOS&nbsp;Linux&nbsp;release&nbsp;7.0.1406&nbsp;(Core)&lt;br&gt;&lt;/div&gt;&lt;div&gt;Kernel&nbsp;Version:&nbsp;Linux&nbsp;3.10.0-123.8.1.el7.x86_64&nbsp;x86_64&lt;br&gt;RPM&nbsp;Package&nbsp;Version:&nbsp;squid-3.3.8-12.el7_0.x86_64&lt;br&gt;&lt;/div&gt;&lt;div&gt;Squid&nbsp;Cache:&nbsp;Version&nbsp;3.3.8&lt;br&gt;configure&nbsp;options: &nbsp;&#39;--build=x86_64-redhat-linux-gnu&#39;&nbsp;&#39;--host=x86_64-redhat-linux-gnu&#39;&nbsp;&#39;--program-prefix=&#39;&nbsp;&#39;--prefix=/usr&#39;&nbsp;&#39;--exec-prefix=/usr&#39;&nbsp;&#39;--bindir=/usr/bin&#39;&nbsp;&#39;--sbindir=/usr/sbin&#39;&nbsp;&#39;--sysconfdir=/etc&#39;&nbsp;&#39;--datadir=/usr/share&#39;&nbsp;&#39;--includedir=/usr/include&#39;&nbsp;&#39;--libdir=/usr/lib64&#39;&nbsp;&#39;--libexecdir=/usr/libexec&#39;&nbsp;&#39;--sharedstatedir=/var/lib&#39;&nbsp;&#39;--mandir=/usr/share/man&#39;&nbsp;&#39;--infodir=/usr/share/info&#39;&nbsp;&#39;--disable-strict-error-checking&#39;&nbsp;&#39;--exec_prefix=/usr&#39;&nbsp;&#39;--libexecdir=/usr/lib64/squid&#39;&nbsp;&#39;--localstatedir=/var&#39;&nbsp;&#39;--datadir=/usr/share/squid&#39;&nbsp;&#39;--sysconfdir=/etc/squid&#39;&nbsp;&#39;--with-logdir=$(localstatedir)/log/squid&#39;&nbsp;&#39;--with-pidfile=$(localstatedir)/run/squid.pid&#39;&nbsp;&#39;--disable-dependency-tracking&#39;&nbsp;&#39;--enable-eui&#39;&nbsp;&#39;--enable-follow-x-forwarded-for&#39;&nbsp;&#39;--enable-auth&#39;&nbsp;&#39;--enable-auth-basic=DB,LDAP,MSNT,MSNT-multi-domain,NCSA,NIS,PAM,POP3,RADIUS,SASL,SMB,getpwnam&#39;&nbsp;&#39;--enable-auth-ntlm=smb_lm,fake&#39;&nbsp;&#39;--enable-auth-digest=file,LDAP,eDirectory&#39;&nbsp;&#39;--enable-auth-negotiate=kerberos&#39;&nbsp;&#39;--enable-external-acl-helpers=file_userip,LDAP_group,time_quota,session,unix_group,wbinfo_group&#39;&nbsp;&#39;--enable-cache-digests&#39;&nbsp;&#39;--enable-cachemgr-hostname=localhost&#39;&nbsp;&#39;--enable-delay-pools&#39;&nbsp;&#39;--enable-epoll&#39;&nbsp;&#39;--enable-icap-client&#39;&nbsp;&#39;--enable-ident-lookups&#39;&nbsp;&#39;--enable-linux-netfilter&#39;&nbsp;&#39;--enable-removal-policies=heap,lru&#39;&nbsp;&#39;--enable-snmp&#39;&nbsp;&#39;--enable-ssl&#39;&nbsp;&#39;--enable-ssl-crtd&#39;&nbsp;&#39;--enable-storeio=aufs,diskd,ufs&#39;&nbsp;&#39;--enable-wccpv2&#39;&nbsp;&#39;--enable-esi&#39;&nbsp;&#39;--enable-ecap&#39;&nbsp;&#39;--with-aio&#39;&nbsp;&#39;--with-default-user=squid&#39;&nbsp;&#39;--with-filedescriptors=16384&#39;&nbsp;&#39;--with-dl&#39;&nbsp;&#39;--with-openssl&#39;&nbsp;&#39;--with-pthreads&#39;&nbsp;&#39;build_alias=x86_64-redhat-linux-gnu&#39;&nbsp;&#39;host_alias=x86_64-redhat-linux-gnu&#39;&nbsp;&#39;CFLAGS=-O2&nbsp;-g&nbsp;-pipe&nbsp;-Wall&nbsp;-Wp,-D_FORTIFY_SOURCE=2&nbsp;-fexceptions&nbsp;-fstack-protector-strong&nbsp;--param=ssp-buffer-size=4&nbsp;-grecord-gcc-switches  &nbsp;-m64&nbsp;-mtune=generic&nbsp;-fpie&#39;&nbsp;&#39;LDFLAGS=-Wl,-z,relro &nbsp;-pie&nbsp;-Wl,-z,relro&nbsp;-Wl,-z,now&#39;&nbsp;&#39;CXXFLAGS=-O2&nbsp;-g&nbsp;-pipe&nbsp;-Wall&nbsp;-Wp,-D_FORTIFY_SOURCE=2&nbsp;-fexceptions&nbsp;-fstack-protector-strong&nbsp;--param=ssp-buffer-size=4&nbsp;-grecord-gcc-switches  &nbsp;-m64&nbsp;-mtune=generic&nbsp;-fpie&#39;&nbsp;&#39;PKG_CONFIG_PATH=%{_PKG_CONFIG_PATH}:/usr/lib64/pkgconfig:/usr/share/pkgconfig&#39;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;I&#39;m&nbsp;currently&nbsp;working&nbsp;in&nbsp;a&nbsp;external&nbsp;acl&nbsp;(python&nbsp;based)&nbsp;to&nbsp;get&nbsp;the&nbsp;Source&nbsp;IP&nbsp;and&nbsp;the&nbsp;HTTP&nbsp;Reply&nbsp;Content-Type&nbsp;header&lt;br&gt;&lt;/div&gt;&lt;div&gt;in&nbsp;order&nbsp;to&nbsp;make&nbsp;a&nbsp;mime&nbsp;based&nbsp;filter&nbsp;based&nbsp;on&nbsp;the&nbsp;source&nbsp;ip&nbsp;(client&nbsp;ip)&nbsp;with&nbsp;a&nbsp;database&nbsp;backend.&lt;br&gt;&lt;/div&gt;&lt;div&gt;As&nbsp;the&nbsp;documentation&nbsp;for&nbsp;external_acl_type[1]&nbsp;says,&nbsp;i&nbsp;just&nbsp;need&nbsp;to&nbsp;use&nbsp;the&nbsp;format&nbsp;%&lt;{Header},&nbsp;for&nbsp;my&nbsp;specific&lt;br&gt;need&nbsp;it&nbsp;should&nbsp;be%&lt;h{Content-Type}&nbsp;(added&nbsp;the&nbsp;&quot;h&quot;&nbsp;because&nbsp;after&nbsp;running&nbsp;squid&nbsp;-k&nbsp;parse&nbsp;it&nbsp;states&nbsp;that&nbsp;i&nbsp;should&nbsp;use&lt;br&gt;this&nbsp;form&nbsp;instead&nbsp;of&nbsp;the&nbsp;one&nbsp;described&nbsp;in&nbsp;the&nbsp;documentation).&lt;br&gt;&lt;/div&gt;&lt;div&gt;But&nbsp;after&nbsp;some&nbsp;testing&nbsp;it&nbsp;doesn&#39;t&nbsp;work...&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;So&nbsp;m&nbsp;defining&nbsp;it&nbsp;in&nbsp;squid.conf&nbsp;like&nbsp;(Lower&nbsp;TTL&#39;s&nbsp;only&nbsp;for&nbsp;testing&nbsp;purposes):&lt;br&gt;------&nbsp;relevant&nbsp;lines&nbsp;/etc/squid/squid.conf&nbsp;------&lt;br&gt;external_acl_type&nbsp;testfilter&nbsp;ttl=120&nbsp;negative_ttl=120&nbsp;children-max=5&nbsp;children-idle=1&nbsp;ipv4&nbsp;%SRC&nbsp;%&lt;h{Content-Type}&nbsp;/usr/bin/python&nbsp;-u&nbsp;/external_acl/test.py&lt;br&gt;acl&nbsp;test_filter&nbsp;external&nbsp;testfilter&lt;br&gt;http_reply_access&nbsp;deny&nbsp;test_filter&lt;br&gt;------&nbsp;relevant&nbsp;lines&nbsp;/etc/squid/squid.conf&nbsp;------&lt;br&gt;&lt;br&gt;&lt;/div&gt;Considering&nbsp;that&nbsp;testfilter&nbsp;is&nbsp;simple&nbsp;a&nbsp;python&nbsp;script&nbsp;to&nbsp;log&nbsp;everything&nbsp;to&nbsp;%ea:&lt;br&gt;------&nbsp;/external_acl/test.py&nbsp;------&lt;br&gt;#!/usr/bin/python&nbsp;-u&lt;br&gt;import&nbsp;sys&lt;br&gt;from&nbsp;urllib&nbsp;import&nbsp;quote&lt;br&gt;&lt;br&gt;EOF&nbsp;=&nbsp;False&lt;br&gt;while&nbsp;not&nbsp;EOF:&lt;br&gt;   &nbsp;line&nbsp;=&nbsp;sys.stdin.readline()&lt;br&gt;   &nbsp;if&nbsp;not&nbsp;line:&lt;br&gt;       &nbsp;EOF&nbsp;=&nbsp;True&lt;br&gt;       &nbsp;continue&lt;br&gt;   &nbsp;&lt;br&gt;   &nbsp;sys.stdout.write(&#39;{0}&nbsp;log={1}\n&#39;.format(&#39;ERR&#39;,&nbsp;quote(line)))&lt;br&gt;&lt;br&gt;------&nbsp;/external_acl/test.py&nbsp;------&lt;br&gt;&lt;br&gt;&lt;/div&gt;After&nbsp;configuring&nbsp;the&nbsp;logs&nbsp;everything&nbsp;is&nbsp;working&nbsp;fine&nbsp;except&nbsp;that&nbsp;the&nbsp;Content-Type&nbsp;is&nbsp;never&nbsp;presented&nbsp;to&nbsp;the&nbsp;external&nbsp;ACL&lt;br&gt;it&nbsp;always&nbsp;show&nbsp;&quot;-&quot;&nbsp;instead&nbsp;of&nbsp;text/html&nbsp;as&nbsp;you&nbsp;can&nbsp;see&nbsp;in&nbsp;this&nbsp;example&nbsp;log&nbsp;line&nbsp;(squid&nbsp;format&nbsp;+&nbsp;%ea):&lt;br&gt;1416507449.579   &nbsp;814&nbsp;10.0.0.100&nbsp;TCP_MISS/200&nbsp;8823&nbsp;GET&nbsp;&lt;a&nbsp;href=&quot;http://www.squid-cache.org/&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.squid-cache.org/&lt;/a&gt;&nbsp;-&nbsp;HIER_DIRECT/&lt;a&nbsp;href=&quot;http://77.93.254.178&quot;&nbsp;target=&quot;_blank&quot;&gt;77.93.254.178&lt;/a&gt;&nbsp;text/html&nbsp;10.0.0.100%20-%0A&lt;br&gt;&lt;br&gt;&lt;/div&gt;After&nbsp;testing&nbsp;with&nbsp;other&nbsp;reply&nbsp;headers,&nbsp;not&nbsp;a&nbsp;single&nbsp;one&nbsp;is&nbsp;working&nbsp;(even&nbsp;the&nbsp;very&nbsp;common&nbsp;date&nbsp;or&nbsp;server&nbsp;reply&nbsp;header)&nbsp;all&nbsp;send&nbsp;the&nbsp;same&nbsp;&quot;-&quot;&lt;br&gt;to&nbsp;the&nbsp;external_acl.&lt;br&gt;&lt;br&gt;&lt;/div&gt;So&nbsp;someone&nbsp;here&nbsp;managed&nbsp;to&nbsp;workout&nbsp;this?&nbsp;or&nbsp;have&nbsp;a&nbsp;different&nbsp;solution&nbsp;for&nbsp;the&nbsp;same&nbsp;problem?&nbsp;or&nbsp;is&nbsp;it&nbsp;bug&nbsp;in&nbsp;squid?&nbsp;or&nbsp;in&nbsp;the&nbsp;package&nbsp;provided&nbsp;by&nbsp;centos?&lt;br&gt;&lt;br&gt;&lt;/div&gt;Kindest&nbsp;Regards&lt;br&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;[1]&nbsp;&lt;a&nbsp;href=&quot;http://www.squid-cache.org/Versions/v3/3.3/cfgman/external_acl_type.html&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.squid-cache.org/Versions/v3/3.3/cfgman/external_acl_type.html&lt;/a&gt;&lt;span&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;--&nbsp;&lt;br&gt;&lt;div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Jorge&nbsp;Iván&nbsp;Burgos&nbsp;Aguilar&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;br&gt;--&nbsp;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_signature&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Jorge&nbsp;Iván&nbsp;Burgos&nbsp;Aguilar&lt;br&gt;Instituto&nbsp;Estatal&nbsp;de&nbsp;Acceso&nbsp;a&nbsp;la&nbsp;Información&nbsp;Pública&nbsp;del&nbsp;Estado&nbsp;de&nbsp;Yucatán&lt;br&gt;&lt;a&nbsp;href=&quot;http://www.inaipyucatan.org.mx&quot;&nbsp;target=&quot;_blank&quot;&gt;www.inaipyucatan.org.mx&lt;/a&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/div&gt;<br>

</tt>
