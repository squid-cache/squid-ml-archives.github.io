<tt>
<br>
&lt;HTML&gt;&lt;BODY&gt;&lt;div&gt;Hello&nbsp;Amos!&lt;br&gt;Glad&nbsp;to&nbsp;get&nbsp;your&nbsp;answer!&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1.&nbsp;I&nbsp;have&nbsp;tried&nbsp;to&nbsp;use&nbsp;%&gt;p&nbsp;specifier&nbsp;for&nbsp;adaptation_meta&nbsp;directive.&nbsp;But&nbsp;it&nbsp;seems&nbsp;does&nbsp;not&nbsp;work&nbsp;that&nbsp;way&nbsp;I&nbsp;used&nbsp;it.&lt;/div&gt;&lt;div&gt;I&nbsp;specified&nbsp;it&nbsp;in&nbsp;squid.conf:&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;adaptation_meta&nbsp;X-CLIENT-SRCPORT&nbsp;%&gt;p&lt;br&gt;&lt;br&gt;&lt;/div&gt;I&nbsp;found&nbsp;that&nbsp;specifier&nbsp;ony&nbsp;in&nbsp;logformat.&nbsp;May&nbsp;be&nbsp;you&nbsp;mixed&nbsp;it&nbsp;up?&lt;br&gt;&lt;br&gt;2.&nbsp;About&nbsp;mapping&nbsp;port&nbsp;transparently.&nbsp;How&nbsp;does&nbsp;it&nbsp;help&nbsp;to&nbsp;get&nbsp;(at&nbsp;least)&nbsp;mapped&nbsp;port&nbsp;number&nbsp;in&nbsp;ICAP?&lt;br&gt;&lt;br&gt;3.&nbsp;I&nbsp;would&nbsp;like&nbsp;to&nbsp;track&nbsp;any&nbsp;software.&nbsp;Especially&nbsp;software&nbsp;which&nbsp;use&nbsp;&quot;User&nbsp;Agent&quot;&nbsp;field&nbsp;not&nbsp;&lt;span&nbsp;id=&quot;result_box&quot;&nbsp;class=&quot;short_text&quot;&nbsp;lang=&quot;en&quot;&gt;&lt;span&nbsp;class=&quot;hps&nbsp;alt-edited&quot;&gt;legitimately&nbsp;or&nbsp;event&nbsp;does&nbsp;not&nbsp;fill&nbsp;it&nbsp;at&nbsp;all.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;--&lt;br&gt;/BR,&nbsp;Alexander&lt;br&gt;&lt;br&gt;Mon,&nbsp;15&nbsp;Dec&nbsp;2014&nbsp;17:32:34&nbsp;+1300&nbsp;от&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;squid3@treenet.co.nz&gt;:&lt;br&gt;<br>
&lt;blockquote&nbsp;style=&quot;border-left:1px&nbsp;solid&nbsp;#0857A6;&nbsp;margin:10px;&nbsp;padding:0&nbsp;0&nbsp;0&nbsp;10px;&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;id=&quot;&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
<br>
<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
<br>
<br>
<br>
&lt;div&nbsp;class=&quot;js-helper&nbsp;js-readmsg-msg&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;style&nbsp;type=&quot;text/css&quot;&gt;&lt;/style&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;base&nbsp;target=&quot;_self&quot;&nbsp;href=&quot;https://e.mail.ru/&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;id=&quot;style_14186180160000000316_BODY&quot;&gt;-----BEGIN&nbsp;PGP&nbsp;SIGNED&nbsp;MESSAGE-----&lt;br&gt;<br>
Hash:&nbsp;SHA1&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;13/12/2014&nbsp;9:09&nbsp;a.m.,&nbsp;Александр&nbsp;Бубнов&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;do&nbsp;not&nbsp;need&nbsp;to&nbsp;map&nbsp;it&nbsp;back&nbsp;remotely.&nbsp;I&nbsp;just&nbsp;need&nbsp;to&nbsp;know&nbsp;it.&nbsp;One&lt;br&gt;<br>
&gt;&nbsp;of&nbsp;my&nbsp;applications&nbsp;collects&nbsp;logs&nbsp;about&nbsp;all&nbsp;connections&nbsp;on&nbsp;a&nbsp;desktop&lt;br&gt;<br>
&gt;&nbsp;PC&nbsp;and&nbsp;another&nbsp;(ICAP&nbsp;server)&nbsp;collects&nbsp;what&nbsp;that&nbsp;applications&nbsp;sends&lt;br&gt;<br>
&gt;&nbsp;to&nbsp;the&nbsp;Internet.&nbsp;And&nbsp;to&nbsp;know&nbsp;that&nbsp;traffic&nbsp;belongs&nbsp;to&nbsp;certain&lt;br&gt;<br>
&gt;&nbsp;application&nbsp;I&nbsp;need&nbsp;to&nbsp;know&nbsp;port&nbsp;of&nbsp;the&nbsp;application&nbsp;on&nbsp;a&nbsp;desktop&lt;br&gt;<br>
&gt;&nbsp;PC.&lt;br&gt;<br>
&lt;br&gt;<br>
You&nbsp;could&nbsp;try&nbsp;using&nbsp;the&nbsp;adaptation_meta&nbsp;directive&nbsp;to&nbsp;add&nbsp;a&nbsp;custom&lt;br&gt;<br>
header&nbsp;with&nbsp;%&gt;p&nbsp;as&nbsp;the&nbsp;value&nbsp;parameter.&nbsp;I'm&nbsp;not&nbsp;sure&nbsp;if&nbsp;that&nbsp;will&nbsp;send&lt;br&gt;<br>
a&nbsp;port&nbsp;number&nbsp;though.&lt;br&gt;<br>
&nbsp;&nbsp;&lt;a&nbsp;href=&quot;http://www.squid-cache.org/Doc/config/adaptation_meta/&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.squid-cache.org/Doc/config/adaptation_meta/&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
There&nbsp;is&nbsp;near&nbsp;zero&nbsp;reliability&nbsp;that&nbsp;the&nbsp;port&nbsp;number&nbsp;outgoing&nbsp;from&nbsp;the&lt;br&gt;<br>
client&nbsp;is&nbsp;the&nbsp;same&nbsp;number&nbsp;incoming&nbsp;to&nbsp;Squid.&nbsp;There&nbsp;are&nbsp;numerous&lt;br&gt;<br>
potential&nbsp;layers&nbsp;of&nbsp;protocol&nbsp;and&nbsp;machinery&nbsp;re-numbering&nbsp;ports&lt;br&gt;<br>
transparently&nbsp;between&nbsp;any&nbsp;two&nbsp;devices.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;name&nbsp;of&nbsp;the&nbsp;client&nbsp;application&nbsp;is&nbsp;supposed&nbsp;to&nbsp;be&nbsp;sent&nbsp;in&nbsp;the&lt;br&gt;<br>
User-Agent:&nbsp;HTTP&nbsp;header&nbsp;which&nbsp;gets&nbsp;delivered&nbsp;to&nbsp;ICAP&nbsp;already.&nbsp;For&nbsp;most&lt;br&gt;<br>
legitimate&nbsp;uses&nbsp;of&nbsp;agent-sniffing&nbsp;UA&nbsp;header&nbsp;+&nbsp;IP&nbsp;is&nbsp;sufficient&lt;br&gt;<br>
information.&lt;br&gt;<br>
&lt;br&gt;<br>
Amos&lt;br&gt;<br>
&lt;br&gt;<br>
-----BEGIN&nbsp;PGP&nbsp;SIGNATURE-----&lt;br&gt;<br>
Version:&nbsp;GnuPG&nbsp;v2.0.22&nbsp;(MingW32)&lt;br&gt;<br>
&lt;br&gt;<br>
iQEcBAEBAgAGBQJUjmRiAAoJELJo5wb/XPRj9skH/i6rlp7XmNptgfn/VgKtgH+v&lt;br&gt;<br>
D22idQBsXyTC00LN2UQssz6Hrpk7nvK96dKObtSppJQ8Xtu1NrrPG1uSq1plRgBT&lt;br&gt;<br>
d5EXRYnAMttTbI5KVDdXW6IsFSjTkL2Hr1m244BEv7SRUBNaa67XPpDjucoIX2kP&lt;br&gt;<br>
8eIKZrB32jaW3/t2VDIl67iRKOZQh3DZfFqFrU6BgZCrLXjZXU/629+KBVnvNg/A&lt;br&gt;<br>
TEnYXDBOSRwRVsWuLK/o0bZFI7y6wp0jtRT1ETliUpmdbGKKPSnMWLym2FX5VI+d&lt;br&gt;<br>
8B1BSzbjEAP+sWex2oKE5Z7+FQ+eSf2tYLvS15fqAHe09hKqpJTMur4cumdkRM0=&lt;br&gt;<br>
=LgMG&lt;br&gt;<br>
-----END&nbsp;PGP&nbsp;SIGNATURE-----&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;/compose?To=squid%2dusers@lists.squid%2dcache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;base&nbsp;target=&quot;_self&quot;&nbsp;href=&quot;https://e.mail.ru/&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&lt;/div&gt;<br>
<br>
<br>
&lt;/div&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/BODY&gt;&lt;/HTML&gt;<br>

</tt>
