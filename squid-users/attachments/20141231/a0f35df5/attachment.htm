<tt>
&lt;html&gt;<br>
&nbsp;&nbsp;&lt;head&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&nbsp;http-equiv=&quot;Content-Type&quot;&gt;<br>
&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&lt;body&nbsp;bgcolor=&quot;#FFFFFF&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;-----BEGIN&nbsp;PGP&nbsp;SIGNED&nbsp;MESSAGE-----&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Hash:&nbsp;SHA1&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp; &lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;To&nbsp;finalize&nbsp;a&nbsp;solution,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;see&nbsp;the&nbsp;our&nbsp;favorite:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://www.squid-cache.org/mail-archive/squid-users/201406/0369.html&quot;&gt;http://www.squid-cache.org/mail-archive/squid-users/201406/0369.html&lt;/a&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Why&nbsp;use&nbsp;iptables,&nbsp;ipfilter,Cisco,&nbsp;etc?!&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Only&nbsp;Squid,&nbsp;only&nbsp;hardcore!&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Revert&nbsp;cisco&nbsp;config&nbsp;back:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;R2911(config)#no&nbsp;access-list&nbsp;121&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;R2911(config)#access-list&nbsp;121&nbsp;remark&nbsp;ACL&nbsp;for&nbsp;HTTPS&nbsp;WCCP&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;R2911(config)#access-list&nbsp;121&nbsp;remark&nbsp;Squid&nbsp;proxies&nbsp;bypass&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;R2911(config)#access-list&nbsp;121&nbsp;deny  &nbsp;ip&nbsp;host&nbsp;192.168.200.3&nbsp;any&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;R2911(config)#access-list&nbsp;121&nbsp;deny  &nbsp;ip&nbsp;host&nbsp;192.168.100.251&nbsp;any&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;R2911(config)#access-list&nbsp;121&nbsp;remark&nbsp;Videoserver&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;R2911(config)#access-list&nbsp;121&nbsp;deny  &nbsp;ip&nbsp;host&nbsp;192.168.200.5&nbsp;any&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;R2911(config)#access-list&nbsp;121&nbsp;remark&nbsp;LAN&nbsp;clients&nbsp;proxy&nbsp;port&nbsp;443&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;R2911(config)#access-list&nbsp;121&nbsp;permit&nbsp;tcp&nbsp;192.168.0.0&nbsp;0.0.255.255&nbsp;any<br>
&nbsp;&nbsp;&nbsp;&nbsp;eq&nbsp;443&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;R2911(config)#access-list&nbsp;121&nbsp;remark&nbsp;all&nbsp;others&nbsp;bypass&nbsp;WCCP&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;R2911(config)#access-list&nbsp;121&nbsp;deny  &nbsp;ip&nbsp;any&nbsp;any&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;R2911(config)#^Z&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;R2911#wr&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Building&nbsp;configuration...&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;[OK]&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Write&nbsp;acl&nbsp;file&nbsp;with&nbsp;IP/net&nbsp;with&nbsp;SSL&nbsp;Pinning:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;root&nbsp;@&nbsp;ktulhu&nbsp;/usr/local/squid/etc&nbsp;#&nbsp;cat&nbsp;dst.nobump&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;BCC&nbsp;bypass&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;91.198.63.0/24&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Salyk&nbsp;bypass&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;212.154.165.148/32&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;WU&nbsp;bypass&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;191.232.0.0/13&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;65.52.0.0/14&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Symantec&nbsp;bypass&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;195.215.221.99/32&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;195.215.221.104/32&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;213.248.114.172/32&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;213.248.114.173/32&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;213.248.114.174/32&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;213.248.114.175/32&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;77.67.22.168/32&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;77.67.22.171/32&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;77.67.22.173/32&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;213.248.114.171/32&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Add&nbsp;needful&nbsp;nets/apps&nbsp;to&nbsp;acl&nbsp;by&nbsp;your&nbsp;taste.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Add&nbsp;to&nbsp;squid&nbsp;config:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;SSL&nbsp;bump&nbsp;acl&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;acl&nbsp;net_bump&nbsp;src&nbsp;&quot;/usr/local/squid/etc/net.bump&quot;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;HTTP-use&nbsp;443&nbsp;port&nbsp;apps&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;acl&nbsp;url_nobump&nbsp;dstdom_regex&nbsp;\.icq\.*&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;SSL&nbsp;Pinning&nbsp;servers.&nbsp;Only&nbsp;ip-based&nbsp;dst&nbsp;acl!&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;acl&nbsp;dst_nobump&nbsp;dst&nbsp;&quot;/usr/local/squid/etc/dst.nobump&quot;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;SSL&nbsp;bump&nbsp;rules&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;sslproxy_cert_error&nbsp;allow&nbsp;all&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;ssl_bump&nbsp;none&nbsp;localhost&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;ssl_bump&nbsp;none&nbsp;url_nobump&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;ssl_bump&nbsp;none&nbsp;dst_nobump&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;ssl_bump&nbsp;server-first&nbsp;net_bump&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Yahooo!&nbsp;The&nbsp;same&nbsp;result&nbsp;with&nbsp;Squid&nbsp;only!&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;30.12.2014&nbsp;23:39,&nbsp;Rafael&nbsp;Akchurin&nbsp;пишет:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&nbsp;style=&quot;white-space:&nbsp;pre;&quot;&gt;&gt;&nbsp;SSL&nbsp;Pinning&lt;/span&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;-----BEGIN&nbsp;PGP&nbsp;SIGNATURE-----<br>
&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Version:&nbsp;GnuPG&nbsp;v2<br>
&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp; &lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;iQEcBAEBAgAGBQJUowfzAAoJENNXIZxhPexGQjgH/2a6Ec4VMKgwKdgR+HPJYRj3<br>
&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;eOmmO8E3LAwkQpDnUNfBl057tKSdPTq5Y1Fo0SJrs0yczvc7w2nt7G01adCajxgT<br>
&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Zj91d77aNxXoE730I6rnL8vAg4gvWVYdJufJstTQuToJW31SYMlEkzZfY38suRTs<br>
&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;GQRAaQ+hYY4trqE7f5BlQHdChMwIb6pxQoE2PJ+8SzkuBr4E68fJlqECz8zXxs8Z<br>
&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Mb+R3OCA18YKpr+6nU3dM58B3FDvWTj/NuIib2PgvIGR2Xsrrrr2GPms2x6QKg5v<br>
&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;ivlmYD5cYWz3F+8htv7mFovSxp32cKb6+Vfxk45yGEA2+z9VziGE1G7KF4WgKGM=<br>
&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;=1ux+<br>
&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;-----END&nbsp;PGP&nbsp;SIGNATURE-----<br>
&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
