<tt>
&lt;html&gt;<br>
&nbsp;&nbsp;&lt;head&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&nbsp;http-equiv=&quot;Content-Type&quot;&gt;<br>
&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&lt;body&nbsp;bgcolor=&quot;#FFFFFF&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;-----BEGIN&nbsp;PGP&nbsp;SIGNED&nbsp;MESSAGE-----&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Hash:&nbsp;SHA1&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp; &lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Core&nbsp;dumps&nbsp;is&nbsp;configured&nbsp;after&nbsp;OS&nbsp;installation&nbsp;-&nbsp;over&nbsp;4&nbsp;years&nbsp;ago.<br>
&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;another&nbsp;processes&nbsp;they&nbsp;produces&nbsp;ok.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;System&nbsp;has&nbsp;modular&nbsp;mebugger&nbsp;(MDB),&nbsp;but&nbsp;this&nbsp;is&nbsp;production&nbsp;system&nbsp;and<br>
&nbsp;&nbsp;&nbsp;&nbsp;undesirable&nbsp;to&nbsp;run&nbsp;key&nbsp;service&nbsp;under&nbsp;debugger.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;same&nbsp;time&nbsp;this&nbsp;case&nbsp;is&nbsp;difficult&nbsp;to&nbsp;reproduce&nbsp;on&nbsp;test&nbsp;system.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Looks&nbsp;like&nbsp;assertion&nbsp;produces&nbsp;one&nbsp;of&nbsp;clients&nbsp;within&nbsp;irregular<br>
&nbsp;&nbsp;&nbsp;&nbsp;intervals.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;I'll&nbsp;try&nbsp;to&nbsp;use&nbsp;DTrace&nbsp;to&nbsp;catch&nbsp;assertion&nbsp;live.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;15.01.2015&nbsp;19:14,&nbsp;Amos&nbsp;Jeffries&nbsp;пишет:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&nbsp;style=&quot;white-space:&nbsp;pre;&quot;&gt;&gt;&nbsp;On&nbsp;16/01/2015&nbsp;1:50&nbsp;a.m.,&nbsp;Yuri<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Voinov&nbsp;wrote:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&nbsp;Hi&nbsp;gents,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&nbsp;Sometimes&nbsp;I&nbsp;have&nbsp;too&nbsp;much&nbsp;assertions:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&nbsp;2015/01/08&nbsp;09:40:39&nbsp;kid1|&nbsp;assertion&nbsp;failed:&nbsp;comm.cc:178:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&nbsp;&quot;fd_table[conn-&gt;fd].halfClosedReader&nbsp;!=&nbsp;NULL&quot;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&nbsp;Core&nbsp;dump&nbsp;not&nbsp;produced&nbsp;but&nbsp;Squid&nbsp;restarts.&nbsp;So,&nbsp;I&nbsp;can't<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;get&nbsp;stack&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&nbsp;trace.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&nbsp;When&nbsp;I&nbsp;set&nbsp;hals_closed_clients&nbsp;to&nbsp;on,&nbsp;I've&nbsp;got&nbsp;much&nbsp;more&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&nbsp;assertions:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&nbsp;2015/01/15&nbsp;18:41:31&nbsp;kid1|&nbsp;assertion&nbsp;failed:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;comm.cc:1823:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&nbsp;&quot;isOpen(fd)&nbsp;&amp;&amp;&nbsp;!commHasHalfClosedMonitor(fd)&quot;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&nbsp;What&nbsp;can&nbsp;be&nbsp;wrong?&nbsp;This&nbsp;is&nbsp;very&nbsp;annoying&nbsp;behaviour.&nbsp;Also<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memory&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&nbsp;cache&nbsp;is&nbsp;often&nbsp;cold&nbsp;after&nbsp;restarts&nbsp;and&nbsp;hit&nbsp;ratio&nbsp;is<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;degrades.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&nbsp;This&nbsp;looks&nbsp;similar&nbsp;adaptation&nbsp;bug&nbsp;4057,&nbsp;but&nbsp;it&nbsp;is&nbsp;closed<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in&nbsp;3.4.11.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&nbsp;This&nbsp;behaviour&nbsp;depends&nbsp;half-closed&nbsp;connections,&nbsp;but&nbsp;how?&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&nbsp;And&nbsp;how&nbsp;to&nbsp;troubleshoot?&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;A)&nbsp;running&nbsp;Squid&nbsp;under&nbsp;GDB.&nbsp;There&nbsp;are&nbsp;instructions&nbsp;in&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-rfc2396E&quot;&nbsp;href=&quot;http://wiki.squid-cache.org/SquidFaq/BugReporting&quot;&gt;&lt;http://wiki.squid-cache.org/SquidFaq/BugReporting&gt;&lt;/a&gt;&nbsp;on<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;how&nbsp;to&nbsp;do&nbsp;that&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;even&nbsp;if&nbsp;you&nbsp;are&nbsp;debugging&nbsp;a&nbsp;production&nbsp;server&nbsp;that&nbsp;needs&nbsp;no<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;downtime.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;OR,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;B)&nbsp;finding&nbsp;out&nbsp;how&nbsp;to&nbsp;enable&nbsp;core&nbsp;dumps&nbsp;in&nbsp;your&nbsp;OS.&nbsp;The<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertion&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;handling&nbsp;calls&nbsp;abort()&nbsp;which&nbsp;will&nbsp;generate&nbsp;a&nbsp;core&nbsp;file&nbsp;if&nbsp;the<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OS&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;allows&nbsp;them&nbsp;to&nbsp;be&nbsp;created.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;Amos&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;_______________________________________________&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-abbreviated&quot;&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;/span&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;-----BEGIN&nbsp;PGP&nbsp;SIGNATURE-----<br>
&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Version:&nbsp;GnuPG&nbsp;v2<br>
&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp; &lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;iQEcBAEBAgAGBQJUt79kAAoJENNXIZxhPexGu3wH/28qhMz9SRRdv4M/NnZascGH<br>
&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;J2pgn03D7RI7C/rHY0fn9TeojoTFE1WLNEBkj+n3ufU7jp44eBZ1X1ZImS1Of/jc<br>
&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;5qmKaWc9vAIfRjX1J5Wvyn0Z6p5P0HqBO7WLE6kSBK6M+s9JkcCC49zZS0qp+pOd<br>
&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;U5tuNT1CqX3B1VkdDLbBMDxxGDKTTTt76CRhiF5bn/8GfdTL2/aPrhEpiKzRBK3W<br>
&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;b0azWyIKs39QzWwPTbkFk47Xidz3xFFXAl0bGuWnJg38fgRW/S6tlHUu8J0n+PCO<br>
&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;e4rXODf/X1EADWIZJMe7tUoKgk5o3AUSm4ZgnggMQj4y+MQFw//xrkczSVoJCOM=<br>
&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;=RvbX<br>
&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;-----END&nbsp;PGP&nbsp;SIGNATURE-----<br>
&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
