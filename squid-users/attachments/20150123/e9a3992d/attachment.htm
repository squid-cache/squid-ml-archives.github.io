<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;23&nbsp;January&nbsp;2015&nbsp;at&nbsp;16:07,&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&nbsp;target=&quot;_blank&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;-----BEGIN&nbsp;PGP&nbsp;SIGNED&nbsp;MESSAGE-----&lt;br&gt;<br>
Hash:&nbsp;SHA1&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;On&nbsp;24/01/2015&nbsp;1:47&nbsp;a.m.,&nbsp;Yuri&nbsp;Voinov&nbsp;wrote:&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Once&nbsp;more.&nbsp;You&nbsp;CANNOT&nbsp;have&nbsp;neither&nbsp;web-server&nbsp;nor&nbsp;other&nbsp;service&lt;br&gt;<br>
&gt;&nbsp;with&nbsp;listening&nbsp;port&nbsp;80&nbsp;on&nbsp;the&nbsp;same&nbsp;host&nbsp;as&nbsp;transparent&nbsp;Squid&nbsp;proxy.&lt;br&gt;<br>
&gt;&nbsp;This&nbsp;is&nbsp;one&nbsp;and&nbsp;only&nbsp;reason&nbsp;you&nbsp;have&nbsp;looping.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;That&nbsp;is&nbsp;not&nbsp;correct.&nbsp;It&nbsp;can&nbsp;be&nbsp;done,&nbsp;but&nbsp;depends&nbsp;on&nbsp;how&nbsp;the&nbsp;firewall&lt;br&gt;<br>
operates&nbsp;and&nbsp;what&nbsp;ruleset&nbsp;is&nbsp;used.&lt;br&gt;<br>
&lt;br&gt;<br>
One&nbsp;has&nbsp;to&nbsp;intercept&nbsp;traffic&nbsp;transiting&nbsp;the&nbsp;machine,&nbsp;but&nbsp;ignore&lt;br&gt;<br>
traffic&nbsp;destined&nbsp;*to*&nbsp;or&nbsp;*from*&nbsp;the&nbsp;local&nbsp;machines&nbsp;running&nbsp;processes.&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;&quot;&gt;&lt;br&gt;<br>
&gt;&nbsp;Look.&nbsp;On&nbsp;my&nbsp;transparent&nbsp;3.4.11&nbsp;(which&nbsp;was&nbsp;early&nbsp;2.7)&nbsp;IPFilter&lt;br&gt;<br>
&gt;&nbsp;redirects&nbsp;80&nbsp;port&nbsp;to&nbsp;proxy.&nbsp;My&nbsp;web&nbsp;server&nbsp;on&nbsp;the&nbsp;same&nbsp;host&nbsp;listens&lt;br&gt;<br>
&gt;&nbsp;only&nbsp;8080,&nbsp;8088&nbsp;and&nbsp;8888&nbsp;ports.&nbsp;No&nbsp;one&nbsp;service&nbsp;except&nbsp;NAT&nbsp;is&nbsp;using&lt;br&gt;<br>
&gt;&nbsp;80&nbsp;port.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;And&nbsp;finally&nbsp;I&nbsp;have&nbsp;no&nbsp;looping&nbsp;4&nbsp;years.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Obvious,&nbsp;is&nbsp;it?&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;Maybe&nbsp;there&nbsp;was,&nbsp;maybe&nbsp;there&nbsp;wasn&#39;t.&lt;br&gt;<br>
&lt;br&gt;<br>
Squid-2.7&nbsp;ignored&nbsp;a&nbsp;lot&nbsp;of&nbsp;NAT&nbsp;related&nbsp;errors&nbsp;and&nbsp;even&nbsp;silently&nbsp;did&lt;br&gt;<br>
some&nbsp;Very&nbsp;Bad&nbsp;Things(tm)&nbsp;-&nbsp;none&nbsp;of&nbsp;which&nbsp;Squid-3.2+&nbsp;will&nbsp;allow&nbsp;to&lt;br&gt;<br>
happen&nbsp;anymore.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Odhiambo:&lt;br&gt;<br>
I&nbsp;suspect&nbsp;it&nbsp;might&nbsp;be&nbsp;related&nbsp;to&nbsp;your&nbsp;use&nbsp;of&nbsp;&quot;rdr&quot;&nbsp;firewall&nbsp;rules.&nbsp;In&lt;br&gt;<br>
OpenBSD&nbsp;PF&nbsp;at&nbsp;least&nbsp;rdr&nbsp;rules&nbsp;do&nbsp;not&nbsp;work&nbsp;properly&nbsp;and&nbsp;divert-to&nbsp;rules&lt;br&gt;<br>
needs&nbsp;to&nbsp;be&nbsp;used&nbsp;instead&nbsp;(divert-to&nbsp;can&nbsp;be&nbsp;used&nbsp;for&nbsp;either&nbsp;TPROXY&nbsp;or&lt;br&gt;<br>
NAT&nbsp;Squid&nbsp;listening&nbsp;ports&nbsp;on&nbsp;BSD).&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;/div&gt;I&nbsp;am&nbsp;thinking&nbsp;Squid-3.2+&nbsp;is&nbsp;evil&nbsp;:-)&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;Anyway,&nbsp;my&nbsp;PF&nbsp;rules&nbsp;are&nbsp;here&nbsp;: &lt;a&nbsp;href=&quot;http://pastebin.com/pKv1jN2v&quot;&gt;http://pastebin.com/pKv1jN2v&lt;/a&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;And&nbsp;my&nbsp;IPFilter&nbsp;rules&nbsp;are&nbsp;here: &lt;a&nbsp;href=&quot;http://pastebin.com/JQ77X01H&quot;&gt;http://pastebin.com/JQ77X01H&lt;/a&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;I&nbsp;need&nbsp;to&nbsp;figure&nbsp;out&nbsp;why&nbsp;squid&nbsp;is&nbsp;DENYing&nbsp;all&nbsp;access&nbsp;..&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;--&nbsp;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_signature&quot;&gt;Best&nbsp;regards,&lt;br&gt;Odhiambo&nbsp;WASHINGTON,&lt;br&gt;Nairobi,KE&lt;br&gt;+254733744121/+254722743223&lt;br&gt;&quot;I&nbsp;can&#39;t&nbsp;hear&nbsp;you&nbsp;--&nbsp;I&#39;m&nbsp;using&nbsp;the&nbsp;scrambler.&quot;&lt;br&gt;&lt;/div&gt;<br>
&lt;/div&gt;&lt;/div&gt;<br>

</tt>
