<tt>
&lt;html&gt;<br>
&lt;head&gt;<br>
&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=iso-8859-1&quot;&gt;<br>
&lt;style&nbsp;type=&quot;text/css&quot;&nbsp;style=&quot;display:none&quot;&gt;&lt;!--&nbsp;p&nbsp;{&nbsp;margin-top:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;}--&gt;&lt;/style&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;dir=&quot;ltr&quot;&gt;<br>
&lt;div&nbsp;id=&quot;divtagdefaultwrapper&quot;&nbsp;style=&quot;font-size:12pt;color:#000000;background-color:#FFFFFF;font-family:Calibri,Arial,Helvetica,sans-serif;&quot;&gt;<br>
&lt;p&gt;Hello&nbsp;Daniel,&nbsp;Yuri&lt;br&gt;<br>
&lt;/p&gt;<br>
&lt;p&gt;&lt;br&gt;<br>
&lt;/p&gt;<br>
&lt;p&gt;May&nbsp;be&nbsp;you&nbsp;could&nbsp;dump&nbsp;your&nbsp;whole&nbsp;squid.conf&nbsp;here&nbsp;(please&nbsp;remove&nbsp;any&nbsp;sensitive&nbsp;details).&lt;br&gt;<br>
&lt;/p&gt;<br>
&lt;p&gt;I&nbsp;still&nbsp;cannot&nbsp;understand&nbsp;once&nbsp;Squid&nbsp;has&nbsp;the&nbsp;target&nbsp;server&nbsp;hostname&nbsp;from&nbsp;SNI&nbsp;-&nbsp;where&nbsp;is&nbsp;the&nbsp;acl/rule&nbsp;in&nbsp;squid.conf&nbsp;that&nbsp;can&nbsp;be&nbsp;used&nbsp;with&nbsp;this&nbsp;info&nbsp;present?&lt;br&gt;<br>
&lt;/p&gt;<br>
&lt;p&gt;&lt;br&gt;<br>
&lt;/p&gt;<br>
&lt;p&gt;Best&nbsp;regards,&lt;br&gt;<br>
&lt;/p&gt;<br>
&lt;p&gt;Rafael&lt;br&gt;<br>
&lt;/p&gt;<br>
&lt;p&gt;&lt;br&gt;<br>
&lt;/p&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(33,&nbsp;33,&nbsp;33);&quot;&gt;<br>
&lt;hr&nbsp;tabindex=&quot;-1&quot;&nbsp;style=&quot;display:inline-block;&nbsp;width:98%&quot;&gt;<br>
&lt;div&nbsp;id=&quot;divRplyFwdMsg&quot;&nbsp;dir=&quot;ltr&quot;&gt;&lt;font&nbsp;face=&quot;Calibri,&nbsp;sans-serif&quot;&nbsp;color=&quot;#000000&quot;&nbsp;style=&quot;font-size:11pt&quot;&gt;&lt;b&gt;From:&lt;/b&gt;&nbsp;squid-users&nbsp;&lt;squid-users-bounces@lists.squid-cache.org&gt;&nbsp;on&nbsp;behalf&nbsp;of&nbsp;Daniel&nbsp;Greenwald&nbsp;&lt;dig@digcorp.net&gt;&lt;br&gt;<br>
&lt;b&gt;Sent:&lt;/b&gt;&nbsp;Monday,&nbsp;January&nbsp;26,&nbsp;2015&nbsp;5:39&nbsp;AM&lt;br&gt;<br>
&lt;b&gt;To:&lt;/b&gt;&nbsp;Yuri&nbsp;Voinov&lt;br&gt;<br>
&lt;b&gt;Cc:&lt;/b&gt;&nbsp;squid-users@lists.squid-cache.org&lt;br&gt;<br>
&lt;b&gt;Subject:&lt;/b&gt;&nbsp;Re:&nbsp;[squid-users]&nbsp;Why&nbsp;3.5.0.4&nbsp;generates&nbsp;mimicked&nbsp;certs&nbsp;with&nbsp;server&nbsp;IP&nbsp;only&nbsp;when&nbsp;bumping?&lt;/font&gt;<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;<br>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;<br>
&lt;div&gt;<br>
&lt;div&gt;Thank&nbsp;you&nbsp;Amos,&lt;br&gt;<br>
&lt;/div&gt;<br>
Based&nbsp;on&nbsp;your&nbsp;explanation&nbsp;I&nbsp;was&nbsp;able&nbsp;to&nbsp;make&nbsp;bumping&nbsp;work&nbsp;for&nbsp;transparent&nbsp;with&nbsp;no&nbsp;browser&nbsp;errors&nbsp;in&nbsp;3.5.1&nbsp;by&nbsp;using&nbsp;the&nbsp;following.&nbsp;If&nbsp;I&nbsp;understand&nbsp;correctly,&nbsp;this&nbsp;is&nbsp;actually&nbsp;whats&nbsp;required&nbsp;to&nbsp;mimic&nbsp;the&nbsp;behavior&nbsp;of&nbsp;pre&nbsp;3.5&nbsp;(sslbump&nbsp;server-first&nbsp;all)&nbsp;:&lt;br&gt;<br>
&lt;br&gt;<br>
acl&nbsp;step1&nbsp;at_step&nbsp;SslBump1&lt;br&gt;<br>
acl&nbsp;step2&nbsp;at_step&nbsp;SslBump2&lt;br&gt;<br>
ssl_bump&nbsp;peek&nbsp;step1&nbsp;all&lt;br&gt;<br>
ssl_bump&nbsp;server-first&nbsp;step2&nbsp;all&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;<br>
Hope&nbsp;that&nbsp;helps&nbsp;Yuri&nbsp;or&nbsp;any&nbsp;one&nbsp;else&nbsp;with&nbsp;this&nbsp;issue.&nbsp;&lt;br&gt;<br>
&lt;br&gt;<br>
PS&nbsp;So&nbsp;far&nbsp;this&nbsp;is&nbsp;working&nbsp;great&nbsp;for&nbsp;eg&nbsp;&lt;a&nbsp;href=&quot;http://gmail.com&quot;&gt;gmail.com&lt;/a&gt;&nbsp;which&nbsp;in&nbsp;previous&nbsp;version&nbsp;would&nbsp;throw&nbsp;browser&nbsp;errors!&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;br&nbsp;clear=&quot;all&quot;&gt;<br>
&lt;div&gt;<br>
&lt;div&nbsp;class=&quot;gmail_signature&quot;&gt;-----------&lt;br&gt;<br>
Daniel&nbsp;I&nbsp;Greenwald&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Fri,&nbsp;Jan&nbsp;9,&nbsp;2015&nbsp;at&nbsp;2:51&nbsp;PM,&nbsp;Yuri&nbsp;Voinov&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;<br>
&lt;&lt;a&nbsp;href=&quot;mailto:yvoinov@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;yvoinov@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;&nbsp;border-left:1px&nbsp;#ccc&nbsp;solid;&nbsp;padding-left:1ex&quot;&gt;<br>
&lt;span&nbsp;class=&quot;&quot;&gt;&lt;br&gt;<br>
-----BEGIN&nbsp;PGP&nbsp;SIGNED&nbsp;MESSAGE-----&lt;br&gt;<br>
Hash:&nbsp;SHA1&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;How&nbsp;can&nbsp;that&nbsp;be?&lt;br&gt;<br>
&lt;br&gt;<br>
All&nbsp;HSTS&nbsp;sites&nbsp;cry&nbsp;with&nbsp;3.5&nbsp;bump&nbsp;option&nbsp;-&nbsp;they&nbsp;don't&nbsp;like&nbsp;host&nbsp;IP&nbsp;as&nbsp;CN,&lt;br&gt;<br>
other&nbsp;sites&nbsp;behaviour&nbsp;depending&nbsp;they&nbsp;(and&nbsp;browsers)&nbsp;settings.&lt;br&gt;<br>
&lt;br&gt;<br>
Is&nbsp;it&nbsp;possible&nbsp;to&nbsp;keep&nbsp;server-first&nbsp;behaviour&nbsp;in&nbsp;3.5.x&nbsp;?&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;&quot;&gt;&lt;br&gt;<br>
WBR,&nbsp;Yuri&lt;br&gt;<br>
&lt;br&gt;<br>
09.01.2015&nbsp;16:57,&nbsp;Amos&nbsp;Jeffries&nbsp;&#1087;&#1080;&#1096;&#1077;&#1090;:&lt;br&gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&gt;&nbsp;On&nbsp;9/01/2015&nbsp;11:45&nbsp;p.m.,&nbsp;Yuri&nbsp;Voinov&nbsp;wrote:&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;I&nbsp;have&nbsp;working&nbsp;production&nbsp;3.4.10&nbsp;with&nbsp;working&nbsp;ssl&nbsp;bumping.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;Config&nbsp;was&nbsp;the&nbsp;same&nbsp;as&nbsp;working&nbsp;3.4.10.&nbsp;I've&nbsp;just&nbsp;want&nbsp;to&nbsp;take&nbsp;a&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;look&nbsp;on&nbsp;new&nbsp;release.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;in&nbsp;squid.documented&nbsp;said,&nbsp;than&nbsp;backward&nbsp;compatibility&nbsp;server-first&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;and&nbsp;none&nbsp;options&nbsp;for&nbsp;ssl_bump&nbsp;are&nbsp;kept.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;But:&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;Neither&nbsp;works&nbsp;with&nbsp;old&nbsp;syntax,&nbsp;nor&nbsp;new.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;Looks&nbsp;like&nbsp;target&nbsp;https&nbsp;hosts&nbsp;not&nbsp;resolved&nbsp;and&nbsp;bump&nbsp;got&nbsp;only&nbsp;IP.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;The&nbsp;config&nbsp;values&nbsp;are&nbsp;still&nbsp;accepted,&nbsp;but&nbsp;there&nbsp;is&nbsp;an&nbsp;extra&nbsp;bumping&lt;br&gt;<br>
&gt;&nbsp;stage&nbsp;now&nbsp;before&nbsp;the&nbsp;SNI&nbsp;is&nbsp;available.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;You&nbsp;are&nbsp;wanting&nbsp;to&nbsp;peek&nbsp;at&nbsp;stage&nbsp;1&nbsp;(to&nbsp;get&nbsp;the&nbsp;client&nbsp;SNI&nbsp;details)&nbsp;and&lt;br&gt;<br>
&gt;&nbsp;server-first/splice&nbsp;at&nbsp;stage&nbsp;2&nbsp;(using&nbsp;the&nbsp;domain).&nbsp;Otherwise&nbsp;All&nbsp;Squid&lt;br&gt;<br>
&gt;&nbsp;works&nbsp;with&nbsp;when&nbsp;intercepting&nbsp;are&nbsp;the&nbsp;TCP&nbsp;IPs.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Amos&lt;br&gt;<br>
-----BEGIN&nbsp;PGP&nbsp;SIGNATURE-----&lt;br&gt;<br>
Version:&nbsp;GnuPG&nbsp;v2&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;iQEcBAEBAgAGBQJUsDE9AAoJENNXIZxhPexGl&#43;MH/2wEV5rEDSb6eQ5KRbHI8ZJ4&lt;br&gt;<br>
WV0fdTg7yFR&#43;bfWCUYzjVovQhrx0gaIFLNWvuwDbc62zJJnvADQuAzu7chouafkP&lt;br&gt;<br>
wpGuBjjp3jYZWa1TlZN4XoDeK2THswXau/5kY9P7IKKAJu9VjhjII803ywn5C8DW&lt;br&gt;<br>
48NQWU0Uhs86Tr6XAuaRzUYZK6lht0VcJFKiftmKmOE7Rl7&#43;Yy/Kak1zXxLh8mzX&lt;br&gt;<br>
a8N0DSsSlBqIm7s8yngwWQuf8rQ0tlwrKWNSpCL3xD6Wk0MFwhRqe6Vbncj4sbff&lt;br&gt;<br>
p0OifMf0YD5sbytsUq4OO5HOdO7WPu&#43;foB2AMKSiou5cDMqz5Vcnw0mD35t25Fg=&lt;br&gt;<br>
=OEZu&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;HOEnZb&quot;&gt;<br>
&lt;div&nbsp;class=&quot;h5&quot;&gt;-----END&nbsp;PGP&nbsp;SIGNATURE-----&lt;br&gt;<br>
&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/div&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
