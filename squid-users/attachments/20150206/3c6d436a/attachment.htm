<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Dear&nbsp;all,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;isn&#39;t&nbsp;entirely&nbsp;a&nbsp;squid&nbsp;question&nbsp;but&nbsp;more&nbsp;like&nbsp;a&nbsp;&quot;transparent&nbsp;proxying&quot;&nbsp;question&nbsp;(which&nbsp;I&#39;m&nbsp;hoping&nbsp;you&nbsp;guys&nbsp;will&nbsp;be&nbsp;able&nbsp;to&nbsp;help&nbsp;me&nbsp;with)...&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;As&nbsp;I&nbsp;started&nbsp;playing&nbsp;around&nbsp;with&nbsp;transparent&nbsp;ssl&nbsp;proxying,&nbsp;I&nbsp;learned&nbsp;that&nbsp;Chrome&nbsp;uses&nbsp;an&nbsp;alternate&nbsp;communication&nbsp;(UDP&nbsp;based)&nbsp;protocol&nbsp;called&nbsp;QUIC.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;When&nbsp;the&nbsp;browser&nbsp;uses&nbsp;that&nbsp;protocol,&nbsp;Squid&nbsp;obviously&nbsp;isn&#39;t&nbsp;used&nbsp;as&nbsp;a&nbsp;proxy,&nbsp;so&nbsp;I&#39;m&nbsp;trying&nbsp;to&nbsp;block&nbsp;QUIC&nbsp;traffic&nbsp;to&nbsp;force&nbsp;the&nbsp;browsers&nbsp;to&nbsp;fall&nbsp;back&nbsp;to&nbsp;HTTP/HTTPS.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;At&nbsp;first,&nbsp;I&nbsp;found&nbsp;out&nbsp;that&nbsp;QUIC&nbsp;communicates&nbsp;over&nbsp;UDP&nbsp;443&nbsp;but,&nbsp;since&nbsp;blocking&nbsp;traffic&nbsp;from&nbsp;going&nbsp;out&nbsp;on&nbsp;that&nbsp;port&nbsp;didn&#39;t&nbsp;seem&nbsp;to&nbsp;work,&nbsp;I&nbsp;decided&nbsp;to&nbsp;use&nbsp;&lt;a&nbsp;href=&quot;https://technet.microsoft.com/en-us/sysinternals/bb897437.aspx&quot;&gt;TCPView&lt;/a&gt;&nbsp;(on&nbsp;the&nbsp;client&nbsp;computer)&nbsp;and&nbsp;look&nbsp;at&nbsp;tcpdump&nbsp;to&nbsp;try&nbsp;and&nbsp;figure&nbsp;out&nbsp;what&nbsp;other&nbsp;ports&nbsp;does&nbsp;it&nbsp;use...&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;After&nbsp;looking&nbsp;at&nbsp;TCPView,&nbsp;I&nbsp;was&nbsp;able&nbsp;to&nbsp;see&nbsp;traffic&nbsp;going&nbsp;out&nbsp;on:&lt;/div&gt;&lt;div&gt;tcp&nbsp;80&lt;/div&gt;&lt;div&gt;tcp&nbsp;443&lt;/div&gt;&lt;div&gt;tcp&nbsp;5228&lt;/div&gt;&lt;div&gt;udp&nbsp;80&lt;br&gt;&lt;/div&gt;&lt;div&gt;udp&nbsp;443&lt;/div&gt;&lt;div&gt;udp&nbsp;5353&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;...so&nbsp;I&nbsp;tried&nbsp;to&nbsp;block&nbsp;traffic&nbsp;going&nbsp;out&nbsp;on&nbsp;those&nbsp;ports:&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;root@appliance:~#&nbsp;cat&nbsp;/etc/iptables/rules.v4&nbsp;|&nbsp;grep&nbsp;-i&nbsp;forward&lt;/div&gt;&lt;div&gt;:FORWARD&nbsp;DROP&nbsp;[41:4010]&lt;/div&gt;&lt;div&gt;-A&nbsp;FORWARD&nbsp;-i&nbsp;br0&nbsp;-p&nbsp;tcp&nbsp;-m&nbsp;tcp&nbsp;--dport&nbsp;5228&nbsp;-j&nbsp;REJECT&nbsp;--reject-with&nbsp;icmp-port-unreachable&lt;/div&gt;&lt;div&gt;-A&nbsp;FORWARD&nbsp;-i&nbsp;br0&nbsp;-p&nbsp;udp&nbsp;-m&nbsp;udp&nbsp;--dport&nbsp;5353&nbsp;-j&nbsp;REJECT&nbsp;--reject-with&nbsp;icmp-port-unreachable&lt;/div&gt;&lt;div&gt;-A&nbsp;FORWARD&nbsp;-i&nbsp;br0&nbsp;-p&nbsp;udp&nbsp;-m&nbsp;udp&nbsp;--dport&nbsp;80&nbsp;-j&nbsp;REJECT&nbsp;--reject-with&nbsp;icmp-port-unreachable&lt;/div&gt;&lt;div&gt;-A&nbsp;FORWARD&nbsp;-i&nbsp;br0&nbsp;-p&nbsp;udp&nbsp;-m&nbsp;udp&nbsp;--dport&nbsp;443&nbsp;-j&nbsp;REJECT&nbsp;--reject-with&nbsp;icmp-port-unreachable&lt;/div&gt;&lt;/div&gt;&lt;div&gt;root@appliance:~#&nbsp;iptables&nbsp;-L&lt;/div&gt;&lt;div&gt;Chain&nbsp;INPUT&nbsp;(policy&nbsp;ACCEPT)&lt;/div&gt;&lt;div&gt;target&nbsp; &nbsp; &nbsp;prot&nbsp;opt&nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Chain&nbsp;FORWARD&nbsp;(policy&nbsp;ACCEPT)&lt;/div&gt;&lt;div&gt;target&nbsp; &nbsp; &nbsp;prot&nbsp;opt&nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&lt;/div&gt;&lt;div&gt;REJECT&nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tcp&nbsp;dpt:5228&nbsp;reject-with&nbsp;icmp-port-unreachable&lt;/div&gt;&lt;div&gt;REJECT&nbsp; &nbsp; &nbsp;udp&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;udp&nbsp;dpt:mdns&nbsp;reject-with&nbsp;icmp-port-unreachable&lt;/div&gt;&lt;div&gt;REJECT&nbsp; &nbsp; &nbsp;udp&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;udp&nbsp;dpt:http&nbsp;reject-with&nbsp;icmp-port-unreachable&lt;/div&gt;&lt;div&gt;REJECT&nbsp; &nbsp; &nbsp;udp&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;udp&nbsp;dpt:https&nbsp;reject-with&nbsp;icmp-port-unreachable&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Chain&nbsp;OUTPUT&nbsp;(policy&nbsp;ACCEPT)&lt;/div&gt;&lt;div&gt;target&nbsp; &nbsp; &nbsp;prot&nbsp;opt&nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&lt;/div&gt;&lt;div&gt;root@appliance:~#&nbsp;iptables&nbsp;-L&nbsp;-n&nbsp;-v&lt;/div&gt;&lt;div&gt;Chain&nbsp;INPUT&nbsp;(policy&nbsp;ACCEPT&nbsp;6182&nbsp;packets,&nbsp;2536K&nbsp;bytes)&lt;/div&gt;&lt;div&gt; pkts&nbsp;bytes&nbsp;target&nbsp; &nbsp; &nbsp;prot&nbsp;opt&nbsp;in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Chain&nbsp;FORWARD&nbsp;(policy&nbsp;ACCEPT&nbsp;1343&nbsp;packets,&nbsp;160K&nbsp;bytes)&lt;/div&gt;&lt;div&gt; pkts&nbsp;bytes&nbsp;target&nbsp; &nbsp; &nbsp;prot&nbsp;opt&nbsp;in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&lt;/div&gt;&lt;div&gt; &nbsp; 18&nbsp; &nbsp;912&nbsp;REJECT&nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; br0&nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;&lt;a&nbsp;href=&quot;http://0.0.0.0/0&quot;&gt;0.0.0.0/0&lt;/a&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;a&nbsp;href=&quot;http://0.0.0.0/0&quot;&gt;0.0.0.0/0&lt;/a&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tcp&nbsp;dpt:5228&nbsp;reject-with&nbsp;icmp-port-unreachable&lt;/div&gt;&lt;div&gt; &nbsp;100&nbsp;30714&nbsp;REJECT&nbsp; &nbsp; &nbsp;udp&nbsp; --&nbsp; br0&nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;&lt;a&nbsp;href=&quot;http://0.0.0.0/0&quot;&gt;0.0.0.0/0&lt;/a&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;a&nbsp;href=&quot;http://0.0.0.0/0&quot;&gt;0.0.0.0/0&lt;/a&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; udp&nbsp;dpt:5353&nbsp;reject-with&nbsp;icmp-port-unreachable&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp;0&nbsp;REJECT&nbsp; &nbsp; &nbsp;udp&nbsp; --&nbsp; br0&nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;&lt;a&nbsp;href=&quot;http://0.0.0.0/0&quot;&gt;0.0.0.0/0&lt;/a&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;a&nbsp;href=&quot;http://0.0.0.0/0&quot;&gt;0.0.0.0/0&lt;/a&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; udp&nbsp;dpt:80&nbsp;reject-with&nbsp;icmp-port-unreachable&lt;/div&gt;&lt;div&gt; &nbsp; 73&nbsp;87052&nbsp;REJECT&nbsp; &nbsp; &nbsp;udp&nbsp; --&nbsp; br0&nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;&lt;a&nbsp;href=&quot;http://0.0.0.0/0&quot;&gt;0.0.0.0/0&lt;/a&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;a&nbsp;href=&quot;http://0.0.0.0/0&quot;&gt;0.0.0.0/0&lt;/a&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; udp&nbsp;dpt:443&nbsp;reject-with&nbsp;icmp-port-unreachable&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Chain&nbsp;OUTPUT&nbsp;(policy&nbsp;ACCEPT&nbsp;6913&nbsp;packets,&nbsp;2386K&nbsp;bytes)&lt;/div&gt;&lt;div&gt; pkts&nbsp;bytes&nbsp;target&nbsp; &nbsp; &nbsp;prot&nbsp;opt&nbsp;in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&lt;/div&gt;&lt;div&gt;root@appliance:~#&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;problem&nbsp;is&nbsp;that,&nbsp;although&nbsp;the&nbsp;rules&nbsp;seem&nbsp;to&nbsp;successfully&nbsp;be&nbsp;triggered,&nbsp;the&nbsp;only&nbsp;way&nbsp;I&nbsp;can&nbsp;successfully&nbsp;BLOCK&nbsp;QUIC&nbsp;traffic&nbsp;and&nbsp;make&nbsp;the&nbsp;browser&nbsp;fallback&nbsp;to&nbsp;HTTP/HTTPS&nbsp;is&nbsp;by&nbsp;setting&nbsp;a&nbsp;default&nbsp;FORWARD&nbsp;policy&nbsp;to&nbsp;DROP:&lt;/div&gt;&lt;div&gt;&lt;b&gt;iptables&nbsp;-P&nbsp;FORWARD&nbsp;DROP&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What&nbsp;I&nbsp;conclude&nbsp;from&nbsp;this&nbsp;is&nbsp;that&nbsp;there&nbsp;MUST&nbsp;be&nbsp;some&nbsp;more&nbsp;FORWARD&nbsp;traffic&nbsp;being&nbsp;originated&nbsp;at&nbsp;Chrome&nbsp;that&nbsp;I&nbsp;have&nbsp;no&nbsp;idea&nbsp;how&nbsp;to&nbsp;catch&nbsp;and&nbsp;filter.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So&nbsp;my&nbsp;question&nbsp;is:&nbsp;&lt;b&gt;how&nbsp;can&nbsp;I&nbsp;completely&nbsp;block&nbsp;QUIC&nbsp;so&nbsp;I&nbsp;can&nbsp;guarantee&nbsp;my&nbsp;traffic&nbsp;will&nbsp;always&nbsp;be&nbsp;redirected&nbsp;to&nbsp;Squid?&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks&nbsp;in&nbsp;advance,&lt;/div&gt;&lt;div&gt;Luis&lt;/div&gt;&lt;/div&gt;<br>

</tt>
