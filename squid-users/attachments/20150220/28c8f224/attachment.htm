<tt>
&lt;html&gt;<br>
&nbsp;&nbsp;&lt;head&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;http-equiv=&quot;content-type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&gt;<br>
&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&lt;body&nbsp;text=&quot;#000000&quot;&nbsp;bgcolor=&quot;#FFFFFF&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Hello&nbsp;list.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;I&nbsp;described&nbsp;this&nbsp;issue&nbsp;a&nbsp;few&nbsp;days&nbsp;ago&nbsp;on&nbsp;IRC&nbsp;and&nbsp;no-one&nbsp;could&nbsp;help<br>
&nbsp;&nbsp;&nbsp;&nbsp;me,&nbsp;so&nbsp;I&nbsp;am&nbsp;now&nbsp;turning&nbsp;to&nbsp;you.&nbsp;Here's&nbsp;my&nbsp;problem:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;I&nbsp;run&nbsp;two&nbsp;squid&nbsp;servers,&nbsp;siblings&nbsp;with&nbsp;each&nbsp;other,&nbsp;let's&nbsp;call&nbsp;them&nbsp;A<br>
&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;B.&nbsp;When&nbsp;clients&nbsp;send&nbsp;requests&nbsp;to&nbsp;A,&nbsp;and&nbsp;A&nbsp;thinks&nbsp;B&nbsp;has&nbsp;the<br>
&nbsp;&nbsp;&nbsp;&nbsp;resource&nbsp;cached,&nbsp;but&nbsp;in&nbsp;reality&nbsp;B&nbsp;doesn't,&nbsp;the&nbsp;client&nbsp;will&nbsp;get&nbsp;a&nbsp;504<br>
&nbsp;&nbsp;&nbsp;&nbsp;error&nbsp;with&nbsp;the&nbsp;message:&nbsp;“Valid&nbsp;document&nbsp;was&nbsp;not&nbsp;found&nbsp;in&nbsp;the&nbsp;cache<br>
&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;‘only-if-cached’&nbsp;directive&nbsp;was&nbsp;specified.”&nbsp;Vice&nbsp;versa&nbsp;if&nbsp;clients<br>
&nbsp;&nbsp;&nbsp;&nbsp;send&nbsp;requests&nbsp;to&nbsp;B.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;I&nbsp;believe&nbsp;that&nbsp;A&nbsp;should&nbsp;catch&nbsp;this&nbsp;error&nbsp;and&nbsp;fetch&nbsp;the&nbsp;resource<br>
&nbsp;&nbsp;&nbsp;&nbsp;directly,&nbsp;but&nbsp;instead&nbsp;it&nbsp;forwards&nbsp;it&nbsp;to&nbsp;the&nbsp;client,&nbsp;and&nbsp;I&nbsp;cannot<br>
&nbsp;&nbsp;&nbsp;&nbsp;figure&nbsp;out&nbsp;why.&nbsp;I&nbsp;am&nbsp;not&nbsp;using&nbsp;allow-miss.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;What&nbsp;confuses&nbsp;me&nbsp;even&nbsp;more&nbsp;is&nbsp;that&nbsp;this&nbsp;didn't&nbsp;happen&nbsp;a&nbsp;month&nbsp;ago,<br>
&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;the&nbsp;same&nbsp;setup.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Below&nbsp;is&nbsp;my&nbsp;squid.conf&nbsp;for&nbsp;A.&nbsp;The&nbsp;squid.conf&nbsp;for&nbsp;B&nbsp;is&nbsp;the&nbsp;same,&nbsp;but<br>
&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;B&nbsp;swapped&nbsp;for&nbsp;A&nbsp;in&nbsp;the&nbsp;cache_peer&nbsp;directive.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;http-equiv=&quot;content-type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-style:&nbsp;normal;&nbsp;font-variant:&nbsp;normal;&nbsp;font-weight:&nbsp;normal;&nbsp;letter-spacing:&nbsp;normal;&nbsp;line-height:&nbsp;normal;&nbsp;orphans:&nbsp;auto;&nbsp;text-align:&nbsp;start;&nbsp;text-indent:&nbsp;0px;&nbsp;text-transform:&nbsp;none;&nbsp;widows:&nbsp;1;&nbsp;word-spacing:&nbsp;0px;&nbsp;-webkit-text-stroke-width:&nbsp;0px;&nbsp;word-wrap:&nbsp;break-word;&nbsp;white-space:&nbsp;pre-wrap;&quot;&gt;acl&nbsp;localnet&nbsp;src&nbsp;10.0.0.0/8<br>
acl&nbsp;localnet&nbsp;src&nbsp;fc00::/7<br>
acl&nbsp;localnet&nbsp;src&nbsp;fe80::/10<br>
<br>
http_access&nbsp;allow&nbsp;localhost&nbsp;manager<br>
http_access&nbsp;deny&nbsp;manager<br>
http_access&nbsp;allow&nbsp;localnet<br>
http_access&nbsp;allow&nbsp;localhost<br>
http_access&nbsp;deny&nbsp;all<br>
http_port&nbsp;3128<br>
<br>
icp_access&nbsp;allow&nbsp;localnet<br>
icp_access&nbsp;allow&nbsp;localhost<br>
icp_access&nbsp;deny&nbsp;all<br>
icp_port&nbsp;3130<br>
<br>
cache_dir&nbsp;aufs&nbsp;/var/cache/squid&nbsp;16000&nbsp;64&nbsp;256<br>
<br>
coredump_dir&nbsp;/var/cache/squid<br>
<br>
refresh_pattern&nbsp;^ftp:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1440&nbsp;&nbsp;&nbsp;&nbsp;20%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10080<br>
refresh_pattern&nbsp;^gopher:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1440&nbsp;&nbsp;&nbsp;&nbsp;0%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1440<br>
refresh_pattern&nbsp;-i&nbsp;(/cgi-bin/|\?)&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0<br>
refresh_pattern&nbsp;.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;20%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4320<br>
<br>
cache_peer&nbsp;B&nbsp;sibling&nbsp;3128&nbsp;3130&lt;/pre&gt;<br>
&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
