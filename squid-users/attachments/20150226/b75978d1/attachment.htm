<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;I&nbsp;am&nbsp;building&nbsp;a&nbsp;simple&nbsp;linux&nbsp;firewall&nbsp;router&nbsp;with&nbsp;eth1&nbsp;LAN&nbsp;port&nbsp;and&nbsp;eth0&nbsp;WAN&nbsp;port.&nbsp;I&nbsp;have&nbsp;squid3&nbsp;running&nbsp;on&nbsp;it&nbsp;that&nbsp;I&nbsp;have&nbsp;built&nbsp;with&nbsp;netfilter&nbsp;enabled.&nbsp;The&nbsp;linux&nbsp;version&nbsp;running&nbsp;on&nbsp;the&nbsp;firewall&nbsp;is&nbsp;debian&nbsp;wheezy&nbsp;which&nbsp;has&nbsp;iptables&nbsp;with&nbsp;TPROXY&nbsp;and&nbsp;socket&nbsp;support. &lt;/span&gt;&lt;div&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;By&nbsp;setting&nbsp;up&nbsp;the&nbsp;iptables&nbsp;to&nbsp;send&nbsp;traffic&nbsp;to&nbsp;squid3&nbsp;using&nbsp;the&nbsp;original&nbsp;nat&nbsp;prerouting&nbsp;REDIRECT&nbsp;method&nbsp;everything&nbsp;works&nbsp;fine&nbsp;but&nbsp;I&nbsp;can&#39;t&nbsp;get&nbsp;the&nbsp;TPROXY&nbsp;method&nbsp;to&nbsp;work.&nbsp;I&nbsp;followed&nbsp;all&nbsp;the&nbsp;steps&nbsp;outlined&nbsp;in &lt;a&nbsp;href=&quot;http://wiki.squid-cache.org/Features/Tproxy4&quot;&nbsp;target=&quot;_blank&quot;&gt;http://wiki.squid-cache.org/Features/Tproxy4&lt;/a&gt; but&nbsp;no&nbsp;traffic&nbsp;gets&nbsp;to&nbsp;squid3.&nbsp;In&nbsp;fact&nbsp;all&nbsp;HTTP&nbsp;traffic&nbsp;goes&nbsp;into&nbsp;some&nbsp;hole&nbsp;as&nbsp;soon&nbsp;as&nbsp;I&nbsp;issue&nbsp;the&nbsp;following&nbsp;two&nbsp;routing&nbsp;commands&nbsp;- &lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;ip&nbsp;rule&nbsp;add&nbsp;fwmark&nbsp;1&nbsp;lookup&nbsp;100&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;ip&nbsp;route&nbsp;add&nbsp;local &lt;a&nbsp;href=&quot;http://0.0.0.0/0&quot;&nbsp;target=&quot;_blank&quot;&gt;0.0.0.0/0&lt;/a&gt; dev&nbsp;lo&nbsp;table&nbsp;100&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;Without&nbsp;these&nbsp;two&nbsp;commands&nbsp;the&nbsp;HTTP&nbsp;traffic&nbsp;goes&nbsp;through&nbsp;but&nbsp;never&nbsp;gets&nbsp;routed&nbsp;to&nbsp;squid3.&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;I&nbsp;think&nbsp;the&nbsp;&quot;ip&nbsp;route&quot;&nbsp;command&nbsp;is&nbsp;the&nbsp;culprit&nbsp;but&nbsp;I&nbsp;don&#39;t&nbsp;know&nbsp;why&nbsp;or&nbsp;how&nbsp;to&nbsp;change&nbsp;it? &lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;Any&nbsp;suggestions,&nbsp;help&nbsp;would&nbsp;be&nbsp;much&nbsp;appreciated. &lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;Thanks,&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;carvaka&lt;/div&gt;&lt;/div&gt;<br>

</tt>
