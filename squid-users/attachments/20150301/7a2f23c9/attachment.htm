<tt>
&lt;html&gt;&lt;body&gt;<br>
&lt;p&gt;&lt;font&nbsp;size=&quot;2&quot;&nbsp;face=&quot;sans-serif&quot;&gt;That's&nbsp;good&nbsp;to&nbsp;know.&lt;/font&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;font&nbsp;size=&quot;2&quot;&nbsp;face=&quot;sans-serif&quot;&gt;With&nbsp;a&nbsp;transparent&nbsp;interception&nbsp;SSL-bump&nbsp;enabled&nbsp;Squid,&nbsp;I&nbsp;suppose&nbsp;I&nbsp;do&nbsp;not&nbsp;have&nbsp;to&nbsp;explicitly&lt;/font&gt;&lt;br&gt;<br>
&lt;font&nbsp;size=&quot;2&quot;&nbsp;face=&quot;sans-serif&quot;&gt;configure&nbsp;anything&nbsp;in&nbsp;my&nbsp;https&nbsp;client,&nbsp;and&nbsp;that&nbsp;Squid&nbsp;must&nbsp;listen&nbsp;on&nbsp;the&nbsp;port&nbsp;my&nbsp;client&nbsp;is&nbsp;trying&nbsp;to&lt;/font&gt;&lt;br&gt;<br>
&lt;font&nbsp;size=&quot;2&quot;&nbsp;face=&quot;sans-serif&quot;&gt;connect&nbsp;to&nbsp;(443)&nbsp;and&nbsp;that&nbsp;my&nbsp;squid.conf&nbsp;file&nbsp;must&nbsp;look&nbsp;something&nbsp;like&nbsp;this:&lt;/font&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;tt&gt;&lt;font&nbsp;size=&quot;3&quot;&gt;http_port&nbsp;443&nbsp;ssl-bump&nbsp;cert=/usr/local/squid3/etc/site_priv+pub.pem&lt;/font&gt;&lt;/tt&gt;&lt;font&nbsp;size=&quot;2&quot;&nbsp;face=&quot;sans-serif&quot;&gt;&lt;br&gt;<br>
&lt;/font&gt;&lt;br&gt;<br>
&lt;font&nbsp;size=&quot;2&quot;&nbsp;face=&quot;sans-serif&quot;&gt;where&nbsp;cert&nbsp;points&nbsp;to&nbsp;the&nbsp;location&nbsp;of&nbsp;a&nbsp;certificate&nbsp;designed&nbsp;to&nbsp;look&nbsp;like&nbsp;the&nbsp;certificate&nbsp;of&nbsp;the&nbsp;actual&nbsp;destination&nbsp;server&nbsp;(my&nbsp;reverse&nbsp;proxy).&lt;/font&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;font&nbsp;size=&quot;2&quot;&nbsp;face=&quot;sans-serif&quot;&gt;In&nbsp;this&nbsp;case&nbsp;there&nbsp;is&nbsp;no&nbsp;http&nbsp;and&nbsp;no&nbsp;HTTP&nbsp;CONNECT&nbsp;required?&lt;/font&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;img&nbsp;width=&quot;16&quot;&nbsp;height=&quot;16&quot;&nbsp;src=&quot;cid:1__=08BBF768DFF169CE8f9e8a93df938@us.ibm.com&quot;&nbsp;border=&quot;0&quot;&nbsp;alt=&quot;Inactive&nbsp;hide&nbsp;details&nbsp;for&nbsp;Yuri&nbsp;Voinov&nbsp;---03/01/2015&nbsp;12:52:26&nbsp;PM--------BEGIN&nbsp;PGP&nbsp;SIGNED&nbsp;MESSAGE-----&nbsp;Hash:&nbsp;SHA1&quot;&gt;&lt;font&nbsp;size=&quot;2&quot;&nbsp;color=&quot;#424282&quot;&nbsp;face=&quot;sans-serif&quot;&gt;Yuri&nbsp;Voinov&nbsp;---03/01/2015&nbsp;12:52:26&nbsp;PM--------BEGIN&nbsp;PGP&nbsp;SIGNED&nbsp;MESSAGE-----&nbsp;Hash:&nbsp;SHA1&lt;/font&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;font&nbsp;size=&quot;1&quot;&nbsp;color=&quot;#5F5F5F&quot;&nbsp;face=&quot;sans-serif&quot;&gt;From:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/font&gt;&lt;font&nbsp;size=&quot;1&quot;&nbsp;face=&quot;sans-serif&quot;&gt;Yuri&nbsp;Voinov&nbsp;&lt;yvoinov@gmail.com&gt;&lt;/font&gt;&lt;br&gt;<br>
&lt;font&nbsp;size=&quot;1&quot;&nbsp;color=&quot;#5F5F5F&quot;&nbsp;face=&quot;sans-serif&quot;&gt;To:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/font&gt;&lt;font&nbsp;size=&quot;1&quot;&nbsp;face=&quot;sans-serif&quot;&gt;Julianne&nbsp;Bielski/Raleigh/IBM@IBMUS&lt;/font&gt;&lt;br&gt;<br>
&lt;font&nbsp;size=&quot;1&quot;&nbsp;color=&quot;#5F5F5F&quot;&nbsp;face=&quot;sans-serif&quot;&gt;Cc:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/font&gt;&lt;font&nbsp;size=&quot;1&quot;&nbsp;face=&quot;sans-serif&quot;&gt;squid-users@lists.squid-cache.org,&nbsp;squid-users&nbsp;&lt;squid-users-bounces@lists.squid-cache.org&gt;&lt;/font&gt;&lt;br&gt;<br>
&lt;font&nbsp;size=&quot;1&quot;&nbsp;color=&quot;#5F5F5F&quot;&nbsp;face=&quot;sans-serif&quot;&gt;Date:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/font&gt;&lt;font&nbsp;size=&quot;1&quot;&nbsp;face=&quot;sans-serif&quot;&gt;03/01/2015&nbsp;12:52&nbsp;PM&lt;/font&gt;&lt;br&gt;<br>
&lt;font&nbsp;size=&quot;1&quot;&nbsp;color=&quot;#5F5F5F&quot;&nbsp;face=&quot;sans-serif&quot;&gt;Subject:&nbsp;&nbsp;&nbsp;&lt;/font&gt;&lt;font&nbsp;size=&quot;1&quot;&nbsp;face=&quot;sans-serif&quot;&gt;Re:&nbsp;[squid-users]&nbsp;question&nbsp;about&nbsp;encrypted&nbsp;connection&nbsp;between&nbsp;https&nbsp;client&nbsp;and&nbsp;Squid&lt;/font&gt;&lt;br&gt;<br>
&lt;hr&nbsp;width=&quot;100%&quot;&nbsp;size=&quot;2&quot;&nbsp;align=&quot;left&quot;&nbsp;noshade&nbsp;style=&quot;color:#8091A5;&nbsp;&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;tt&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;-----BEGIN&nbsp;PGP&nbsp;SIGNED&nbsp;MESSAGE-----&lt;br&gt;<br>
Hash:&nbsp;SHA1&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
01.03.15&nbsp;23:45,&nbsp;Julianne&nbsp;Bielski&nbsp;пишет:&lt;br&gt;<br>
&gt;&nbsp;Normally&nbsp;my&nbsp;infrastructure&nbsp;looks&nbsp;like:&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;client&nbsp;&nbsp;--&nbsp;HTTP&nbsp;CONNECT&nbsp;(not&nbsp;encrypted)&nbsp;&nbsp;---&gt;&nbsp;proxy&nbsp;client&nbsp;------&lt;br&gt;<br>
&gt;&nbsp;TCP&nbsp;tunnel&nbsp;---&gt;&nbsp;proxy&nbsp;---&nbsp;TCP&nbsp;tunnel&nbsp;---&gt;&nbsp;reverse&nbsp;proxy&nbsp;client&nbsp;---&lt;br&gt;<br>
&gt;&nbsp;HTTPS&nbsp;application&nbsp;payload&nbsp;---------------&gt;&nbsp;reverse&nbsp;proxy&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Now&nbsp;I&nbsp;need&nbsp;it&nbsp;to&nbsp;look&nbsp;like:&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;client&nbsp;--------&nbsp;HTTPS&nbsp;application&nbsp;payload&nbsp;----&gt;&nbsp;proxy&nbsp;&nbsp;----&nbsp;HTTPS&nbsp;&lt;br&gt;<br>
&gt;&nbsp;application&nbsp;payload&nbsp;&nbsp;----&gt;&nbsp;reverse&nbsp;proxy&lt;br&gt;<br>
&lt;br&gt;<br>
No&nbsp;problem.&nbsp;This&nbsp;will&nbsp;work&nbsp;-&nbsp;and&nbsp;with&nbsp;only&nbsp;one&nbsp;encryption&nbsp;on&nbsp;every&lt;br&gt;<br>
stage.&nbsp;Proxy&nbsp;can&nbsp;pass&nbsp;both&nbsp;-&nbsp;CONNECT&nbsp;with&nbsp;tunneling&nbsp;to&nbsp;reverse&nbsp;proxy,&lt;br&gt;<br>
or&nbsp;bumped&nbsp;HTTPS&nbsp;connection.&lt;br&gt;<br>
&lt;br&gt;<br>
In&nbsp;my&nbsp;installation&nbsp;this&nbsp;scheme&nbsp;is&nbsp;works&nbsp;with&nbsp;most&nbsp;Web-sites&nbsp;uses&lt;br&gt;<br>
reverse&nbsp;proxies.&nbsp;I&nbsp;use&nbsp;transparent&nbsp;interception&nbsp;SSL-bump&nbsp;enabled&nbsp;Squid.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;From:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Yuri&nbsp;Voinov&nbsp;&lt;yvoinov@gmail.com&gt;&nbsp;To:&lt;br&gt;<br>
&gt;&nbsp;squid-users@lists.squid-cache.org&nbsp;Date:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;03/01/2015&nbsp;12:26&nbsp;PM&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Subject:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Re:&nbsp;[squid-users]&nbsp;question&nbsp;about&nbsp;encrypted&nbsp;connection&lt;br&gt;<br>
&gt;&nbsp;between&nbsp;https&nbsp;client&nbsp;and&nbsp;Squid&nbsp;Sent&nbsp;by:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;squid-users&quot;&lt;br&gt;<br>
&gt;&nbsp;&lt;squid-users-bounces@lists.squid-cache.org&gt;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;01.03.15&nbsp;23:18,&nbsp;Julianne&nbsp;Bielski&nbsp;пишет:&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;I&nbsp;have&nbsp;an&nbsp;https&nbsp;client&nbsp;(not&nbsp;a&nbsp;browser)&nbsp;that&nbsp;normally&nbsp;connects&nbsp;to&lt;br&gt;<br>
&gt;&gt;&nbsp;a&nbsp;reverse&nbsp;proxy.&nbsp;When&nbsp;it&nbsp;needs&nbsp;to&nbsp;go&nbsp;through&nbsp;a&nbsp;forward&nbsp;proxy,&nbsp;it&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;requests&nbsp;a&nbsp;CONNECT&nbsp;tunnel.&nbsp;I&nbsp;now&nbsp;have&nbsp;a&nbsp;requirement&nbsp;to&nbsp;also&nbsp;be&lt;br&gt;<br>
&gt;&gt;&nbsp;able&nbsp;to&nbsp;encrypt&nbsp;the&nbsp;connection&nbsp;between&nbsp;my&nbsp;client&nbsp;and&nbsp;the&nbsp;forward&lt;br&gt;<br>
&gt;&gt;&nbsp;proxy,&nbsp;and&nbsp;I&nbsp;think&nbsp;this&nbsp;is&nbsp;possible&nbsp;using&nbsp;Squid&nbsp;and&nbsp;the&lt;br&gt;<br>
&gt;&gt;&nbsp;https_port&nbsp;directive&nbsp;(??)&lt;br&gt;<br>
&gt;&nbsp;Yep.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;My&nbsp;question&nbsp;is,&nbsp;will&nbsp;my&nbsp;https&nbsp;client&nbsp;now&nbsp;have&nbsp;to&nbsp;decrypt&nbsp;twice?&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;Once&nbsp;for&nbsp;the&nbsp;connection&nbsp;with&nbsp;the&nbsp;forward&nbsp;proxy&nbsp;and&nbsp;once&nbsp;for&nbsp;the&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;connection&nbsp;with&nbsp;the&nbsp;reverse&nbsp;proxy?&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Re-encryption&nbsp;will&nbsp;performs&nbsp;only&nbsp;in&nbsp;case&nbsp;SSL-bumped&nbsp;connections.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;But&nbsp;now&nbsp;I&nbsp;still&nbsp;can't&nbsp;imagine&nbsp;your&nbsp;infrastructure&nbsp;and&nbsp;how&nbsp;it&nbsp;must&lt;br&gt;<br>
&gt;&nbsp;work.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;Also,&nbsp;must&nbsp;my&nbsp;https&nbsp;client&nbsp;still&nbsp;send&nbsp;a&nbsp;CONNECT&nbsp;message&nbsp;to&lt;br&gt;<br>
&gt;&gt;&nbsp;Squid,&nbsp;or&nbsp;does&nbsp;it&nbsp;just&nbsp;connect&nbsp;to&nbsp;Squid's&nbsp;https_port&nbsp;at&nbsp;the&nbsp;TCP&lt;br&gt;<br>
&gt;&gt;&nbsp;level,&nbsp;perform&nbsp;the&nbsp;SSL&nbsp;handshake,&nbsp;and&nbsp;then&nbsp;open&nbsp;a&nbsp;TCP&nbsp;connection&lt;br&gt;<br>
&gt;&gt;&nbsp;to&nbsp;the&nbsp;reverse&nbsp;proxy?&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Still&nbsp;want&nbsp;to&nbsp;take&nbsp;a&nbsp;look&nbsp;on&nbsp;your&nbsp;infrastructure&nbsp;scheme.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;Thanks,&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;J.&nbsp;Bielski&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;_______________________________________________&nbsp;squid-users&lt;br&gt;<br>
&gt;&gt;&nbsp;mailing&nbsp;list&nbsp;squid-users@lists.squid-cache.org&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;/font&gt;&lt;/tt&gt;&lt;tt&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;/font&gt;&lt;/tt&gt;&lt;tt&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;_______________________________________________&nbsp;squid-users&nbsp;mailing&lt;br&gt;<br>
&gt;&nbsp;list&nbsp;squid-users@lists.squid-cache.org&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;/font&gt;&lt;/tt&gt;&lt;tt&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;/font&gt;&lt;/tt&gt;&lt;tt&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
-----BEGIN&nbsp;PGP&nbsp;SIGNATURE-----&lt;br&gt;<br>
Version:&nbsp;GnuPG&nbsp;v2&lt;br&gt;<br>
&lt;br&gt;<br>
iQEcBAEBAgAGBQJU81GrAAoJENNXIZxhPexGPwkIAJrQAngPDCkylOCIb/IqYlkp&lt;br&gt;<br>
JmCW/lr2JFcH48Zr954hi7six/uduwfNeTtZsd2Cz8JVW3pqQSIrleuF0B7/7C5H&lt;br&gt;<br>
K+mDN6fQ3yQv9EjWTP1cRRdr+/OXQyWOPLoACUCz52SRvwAt1SnY9malavmnJPHS&lt;br&gt;<br>
Aoj+vGTKSM4IasULA0Vnjm3gRjN6BWrUqoXZm1ODygflGXSJnqdm+8t9RhZIHcsl&lt;br&gt;<br>
E1p9Q/hB1IJPrZU67YtgLHgg0MkOcQQzcJ/jzlPnlfOAFt0MPy8mC03YkcV4888a&lt;br&gt;<br>
KHKXElzUbCDziSbG+L5Fz2zuLlQXoDc0ZqHSSB8iNYuB5UWpSZLXWXJ55yiDUBI=&lt;br&gt;<br>
=xwxI&lt;br&gt;<br>
-----END&nbsp;PGP&nbsp;SIGNATURE-----&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/font&gt;&lt;/tt&gt;&lt;br&gt;<br>
&lt;/body&gt;&lt;/html&gt;
</tt>
