<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;Hi&nbsp;all,&nbsp;can&nbsp;anyone&nbsp;verify&nbsp;if&nbsp;this&nbsp;is&nbsp;correct,&nbsp;need&nbsp;to&nbsp;make&nbsp;ure&nbsp;that&nbsp;users&nbsp;will&nbsp;be&nbsp;able&nbsp;to&nbsp;access&nbsp;the&nbsp;internet&nbsp;via&nbsp;the&nbsp;squid.&lt;br&gt;&lt;br&gt;&lt;/div&gt;Running&nbsp;FreeBSD&nbsp;with&nbsp;a&nbsp;single&nbsp;interface&nbsp;with&nbsp;Squid-3.5.2&nbsp;&lt;br&gt;&lt;br&gt;Policy&nbsp;based&nbsp;routing&nbsp;on&nbsp;Cisco&nbsp;with&nbsp;the&nbsp;following:&lt;br&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(0,0,0)&quot;&gt;&lt;span&nbsp;style=&quot;font-size:11pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(255,0,0)&quot;&gt;&lt;span&nbsp;style=&quot;font-size:11pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;&quot;&gt;interface&nbsp;GigabitEthernet0/0/1.1&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(255,0,0)&quot;&gt;&lt;span&nbsp;style=&quot;font-size:11pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;&quot;&gt;&nbsp;encapsulation&nbsp;dot1Q&nbsp;1&nbsp;native&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(255,0,0)&quot;&gt;&lt;span&nbsp;style=&quot;font-size:11pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;&quot;&gt;&nbsp;ip&nbsp;address&nbsp;10.0.0.9&nbsp;255.255.255.0&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(255,0,0)&quot;&gt;&lt;span&nbsp;style=&quot;font-size:11pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;&quot;&gt;&nbsp;no&nbsp;ip&nbsp;redirects&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(255,0,0)&quot;&gt;&lt;span&nbsp;style=&quot;font-size:11pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;&quot;&gt;&nbsp;no&nbsp;ip&nbsp;unreachables&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(255,0,0)&quot;&gt;&lt;span&nbsp;style=&quot;font-size:11pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;&quot;&gt;&nbsp;ip&nbsp;nat&nbsp;inside&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(255,0,0)&quot;&gt;&lt;span&nbsp;style=&quot;font-size:11pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;&quot;&gt;&nbsp;standby&nbsp;1&nbsp;ip&nbsp;10.0.0.10&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(255,0,0)&quot;&gt;&lt;span&nbsp;style=&quot;font-size:11pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;&quot;&gt;&nbsp;standby&nbsp;1&nbsp;priority&nbsp;120&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(255,0,0)&quot;&gt;&lt;span&nbsp;style=&quot;font-size:11pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;&quot;&gt;&nbsp;standby&nbsp;1&nbsp;preempt&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(255,0,0)&quot;&gt;&lt;span&nbsp;style=&quot;font-size:11pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;&quot;&gt;&nbsp;standby&nbsp;1&nbsp;name&nbsp;HSRP&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(255,0,0)&quot;&gt;&lt;span&nbsp;style=&quot;font-size:11pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;&quot;&gt;&nbsp;ip&nbsp;policy&nbsp;route-map&nbsp;CFLOW&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(255,0,0)&quot;&gt;&lt;span&nbsp;style=&quot;font-size:11pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;&quot;&gt; &lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(255,0,0)&quot;&gt;&lt;span&nbsp;style=&quot;font-size:11pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;&quot;&gt;ip&nbsp;access-list&nbsp;extended&nbsp;REDIRECT&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(255,0,0)&quot;&gt;&lt;span&nbsp;style=&quot;font-size:11pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;&quot;&gt;&nbsp;deny  &nbsp;tcp&nbsp;host&nbsp;10.0.0.24&nbsp;any&nbsp;eq&nbsp;www&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(255,0,0)&quot;&gt;&lt;span&nbsp;style=&quot;font-size:11pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;&quot;&gt;&nbsp;permit&nbsp;tcp&nbsp;host&nbsp;10.0.0.23&nbsp;any&nbsp;eq&nbsp;www&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(255,0,0)&quot;&gt;&lt;span&nbsp;style=&quot;font-size:11pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;&quot;&gt; &lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(255,0,0)&quot;&gt;&lt;span&nbsp;style=&quot;font-size:11pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;&quot;&gt;route-map&nbsp;CFLOW&nbsp;permit&nbsp;10&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(255,0,0)&quot;&gt;&lt;span&nbsp;style=&quot;font-size:11pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;&quot;&gt;&nbsp;match&nbsp;ip&nbsp;address&nbsp;REDIRECT&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;span&nbsp;style=&quot;color:rgb(255,0,0)&quot;&gt;&lt;span&nbsp;style=&quot;font-size:11pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;&quot;&gt;&nbsp;set&nbsp;ip&nbsp;next-hop&nbsp;10.0.0.24&lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;span&nbsp;style=&quot;font-size:11pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;color:red&quot;&gt;&lt;font&nbsp;color=&quot;#000000&quot;&gt;In&nbsp;my&nbsp;/etc/pf.conf&lt;br&gt;rdr&nbsp;pass&nbsp;inet&nbsp;proto&nbsp;tcp&nbsp;from&nbsp;&lt;a&nbsp;href=&quot;http://10.0.0.0/8&quot;&gt;10.0.0.0/8&lt;/a&gt;&nbsp;to&nbsp;any&nbsp;port&nbsp;80&nbsp;-&gt;&nbsp;10.0.0.24&nbsp;port&nbsp;3129&lt;br&gt;&lt;br&gt;#&nbsp;block&nbsp;in&lt;br&gt;pass&nbsp;in&nbsp;log&nbsp;quick&nbsp;on&nbsp;bge0&lt;br&gt;pass&nbsp;out&nbsp;log&nbsp;quick&nbsp;on&nbsp;bge0&lt;br&gt;pass&nbsp;out&nbsp;keep&nbsp;state&lt;br&gt;&lt;br&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;span&nbsp;style=&quot;font-size:11pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;color:red&quot;&gt;&lt;font&nbsp;color=&quot;#000000&quot;&gt;and&nbsp;finally&nbsp;in&nbsp;my&nbsp;squid.conf:&lt;br&gt;http_port&nbsp;3128&lt;br&gt;http_port&nbsp;3129&nbsp;intercept&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;span&nbsp;style=&quot;font-size:11pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;color:red&quot;&gt;&lt;font&nbsp;color=&quot;#000000&quot;&gt;And&nbsp;for&nbsp;testing&nbsp;purposes&nbsp;from&nbsp;the&nbsp;squid&nbsp;server:&lt;br&gt; ./squidclient&nbsp;-h&nbsp;10.0.0.24&nbsp;-p&nbsp;3128&nbsp;&lt;a&nbsp;href=&quot;http://www.freebsd.org/&quot;&gt;http://www.freebsd.org/&lt;/a&gt;&lt;br&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-size:11pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;color:red&quot;&gt;&lt;font&nbsp;color=&quot;#000000&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-size:11pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;color:red&quot;&gt;&lt;font&nbsp;color=&quot;#000000&quot;&gt;If&nbsp;I&nbsp;replace&nbsp;-p&nbsp;3128&nbsp;with&nbsp;-p&nbsp;80,&nbsp;I&nbsp;get&nbsp;a&nbsp;access&nbsp;denied,&nbsp;and&nbsp;if&nbsp;I&nbsp;omit&nbsp;the&nbsp;-p&nbsp;3128&nbsp;completely,&nbsp;I&nbsp;can&nbsp;access&nbsp;the&nbsp;websites.&lt;br&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-size:11pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;color:red&quot;&gt;&lt;font&nbsp;color=&quot;#000000&quot;&gt;&lt;br&gt;tcpdump&nbsp;with&nbsp;(-p&nbsp;3128)&lt;br&gt;&lt;br&gt;13:15:02.681106&nbsp;IP&nbsp;ISN-PHC-CACHE.44017&nbsp;&gt;&nbsp;wfe0.ysv.freebsd.org.http:&nbsp;Flags&nbsp;[.],&nbsp;ack&nbsp;17377,&nbsp;win&nbsp;1018,&nbsp;options&nbsp;[nop,nop,TS&nbsp;val&nbsp;985588797&nbsp;ecr&nbsp;1054387720],&nbsp;length&nbsp;0&lt;br&gt;13:15:02.681421&nbsp;IP&nbsp;wfe0.ysv.freebsd.org.http&nbsp;&gt;&nbsp;ISN-PHC-CACHE.44017:&nbsp;Flags&nbsp;[.],&nbsp;seq&nbsp;17377:18825,&nbsp;ack&nbsp;289,&nbsp;win&nbsp;1040,&nbsp;options&nbsp;[nop,nop,TS&nbsp;val&nbsp;1054387720&nbsp;ecr&nbsp;985588501],&nbsp;length&nbsp;1448&lt;br&gt;13:15:02.681575&nbsp;IP&nbsp;wfe0.ysv.freebsd.org.http&nbsp;&gt;&nbsp;ISN-PHC-CACHE.44017:&nbsp;Flags&nbsp;[.],&nbsp;seq&nbsp;18825:20273,&nbsp;ack&nbsp;289,&nbsp;win&nbsp;1040,&nbsp;options&nbsp;[nop,nop,TS&nbsp;val&nbsp;1054387720&nbsp;ecr&nbsp;985588501],&nbsp;length&nbsp;1448&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;span&nbsp;style=&quot;font-size:11pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;color:red&quot;&gt;&lt;font&nbsp;color=&quot;#000000&quot;&gt;Did&nbsp;I&nbsp;miss&nbsp;anything?&lt;br&gt;&lt;br&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;span&nbsp;style=&quot;font-size:11pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;color:red&quot;&gt;&lt;font&nbsp;color=&quot;#000000&quot;&gt;Thanks&lt;br&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;span&nbsp;style=&quot;font-size:11pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;color:red&quot;&gt;&lt;font&nbsp;color=&quot;#000000&quot;&gt;Monah&lt;br&gt;&lt;/font&gt;&lt;/span&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-size:11pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;color:red&quot;&gt;&lt;font&nbsp;color=&quot;#000000&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
