<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;I&nbsp;forgot&nbsp;to&nbsp;paste&nbsp;my&nbsp;pf.conf&lt;br&gt;&lt;br&gt;#&nbsp;rdr&nbsp;pass&nbsp;inet&nbsp;proto&nbsp;tcp&nbsp;from&nbsp;&lt;a&nbsp;href=&quot;http://10.0.0.9/32&quot;&gt;10.0.0.9/32&lt;/a&gt;&nbsp;to&nbsp;any&nbsp;port&nbsp;80&nbsp;-&gt;&nbsp;10.0.0.24&nbsp;port&nbsp;3128&lt;br&gt;#&nbsp;nat&nbsp;on&nbsp;bge0&nbsp;inet&nbsp;from&nbsp;any&nbsp;to&nbsp;port&nbsp;80&nbsp;-&gt;&nbsp;bge0&lt;br&gt;rdr&nbsp;pass&nbsp;inet&nbsp;proto&nbsp;tcp&nbsp;from&nbsp;10.0.0.23&nbsp;to&nbsp;any&nbsp;port&nbsp;80&nbsp;-&gt;&nbsp;10.0.0.24&nbsp;port&nbsp;3129&lt;br&gt;#&nbsp;pass&nbsp;on&nbsp;bge0&nbsp;inet&nbsp;proto&nbsp;tcp&nbsp;from&nbsp;bge0&nbsp;to&nbsp;bge0&nbsp;port&nbsp;3128&lt;br&gt;&lt;br&gt;#&nbsp;block&nbsp;in&lt;br&gt;pass&nbsp;in&nbsp;log&nbsp;quick&nbsp;on&nbsp;bge0&lt;br&gt;pass&nbsp;out&nbsp;log&nbsp;quick&nbsp;on&nbsp;bge0&lt;br&gt;pass&nbsp;out&nbsp;keep&nbsp;state&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Sat,&nbsp;Mar&nbsp;7,&nbsp;2015&nbsp;at&nbsp;8:24&nbsp;AM,&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&nbsp;target=&quot;_blank&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;On&nbsp;8/03/2015&nbsp;1:09&nbsp;a.m.,&nbsp;Monah&nbsp;Baki&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;Forgot&nbsp;to&nbsp;paste&nbsp;my&nbsp;test.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Basically&nbsp;from&nbsp;my&nbsp;squid&nbsp;server:&lt;br&gt;<br>
&gt;&nbsp;root@ISN-PHC-CACHE:/cache/squid/bin&nbsp;#&nbsp;./squidclient&nbsp;-h&nbsp;&lt;a&nbsp;href=&quot;http://www.cnn.com&quot;&nbsp;target=&quot;_blank&quot;&gt;www.cnn.com&lt;/a&gt;&nbsp;-H&lt;br&gt;<br>
&gt;&nbsp;&#39;Host:&nbsp;&lt;a&nbsp;href=&quot;http://www.cnn.com&quot;&nbsp;target=&quot;_blank&quot;&gt;www.cnn.com&lt;/a&gt;\n&#39;&nbsp;-p&nbsp;80&lt;br&gt;<br>
&gt;&nbsp;HTTP/1.1&nbsp;302&nbsp;Found&lt;br&gt;<br>
&gt;&nbsp;Server:&nbsp;Varnish&lt;br&gt;<br>
&gt;&nbsp;Retry-After:&nbsp;0&lt;br&gt;<br>
&gt;&nbsp;Content-Length:&nbsp;0&lt;br&gt;<br>
&gt;&nbsp;Location:&nbsp;&lt;a&nbsp;href=&quot;http://edition.cnn.com80&quot;&nbsp;target=&quot;_blank&quot;&gt;http://edition.cnn.com80&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;Um,&nbsp;that&nbsp;redirect&nbsp;URL&nbsp;is&nbsp;invalid.&nbsp;This&nbsp;Varnish&nbsp;is&nbsp;outputting&nbsp;garbage.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
However,&nbsp;this&nbsp;test&nbsp;result&nbsp;does&nbsp;prove&nbsp;that&nbsp;output&nbsp;traffic&nbsp;from&nbsp;your&nbsp;Squid&lt;br&gt;<br>
should&nbsp;be&nbsp;fine.&nbsp;The&nbsp;test&nbsp;connecting&nbsp;to&nbsp;your&nbsp;port&nbsp;3128&nbsp;should&nbsp;confirm&lt;br&gt;<br>
that&nbsp;by&nbsp;getting&nbsp;the&nbsp;same&nbsp;or&nbsp;very&nbsp;similar&nbsp;result&nbsp;for&nbsp;normal&nbsp;traffic.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
So&nbsp;the&nbsp;problem&nbsp;is&nbsp;on&nbsp;the&nbsp;input.&nbsp;It&nbsp;could&nbsp;still&nbsp;be&nbsp;at&nbsp;the&nbsp;client&nbsp;end,&nbsp;or&lt;br&gt;<br>
in&nbsp;the&nbsp;NAT&nbsp;redirection.&lt;br&gt;<br>
&lt;br&gt;<br>
One&nbsp;thing&nbsp;I&#39;ve&nbsp;not&nbsp;seen&nbsp;clarified&nbsp;in&nbsp;the&nbsp;discussion&nbsp;is&nbsp;which&nbsp;machine&nbsp;the&lt;br&gt;<br>
NAT&nbsp;rules&nbsp;have&nbsp;been&nbsp;placed&nbsp;(Squid&nbsp;box?&nbsp;or&nbsp;router?).&nbsp;Sorry&nbsp;if&nbsp;I&nbsp;missed&nbsp;that.&lt;br&gt;<br>
Â The&nbsp;NAT&nbsp;operation&nbsp;MUST&nbsp;be&nbsp;done&nbsp;on&nbsp;the&nbsp;Squid&nbsp;box&nbsp;or&nbsp;the&nbsp;local&nbsp;machines&lt;br&gt;<br>
NAT&nbsp;system&nbsp;tells&nbsp;it&nbsp;the&nbsp;client&nbsp;was&nbsp;connecting&nbsp;to&nbsp;connect&nbsp;to&lt;br&gt;<br>
itself/Squid:3129&nbsp;(which&nbsp;is&nbsp;the&nbsp;forwarding&nbsp;loop).&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;router&nbsp;looks&nbsp;liek&nbsp;a&nbsp;Cisco&nbsp;device,&nbsp;so&nbsp;it&nbsp;must&nbsp;do&nbsp;L2&nbsp;routing&lt;br&gt;<br>
redirection&nbsp;or&nbsp;WCCP&nbsp;to&nbsp;deliver&nbsp;packets&nbsp;to&nbsp;the&nbsp;Squid&nbsp;machine&nbsp;without&lt;br&gt;<br>
having&nbsp;altered&nbsp;their&nbsp;IP:port&nbsp;details&nbsp;in&nbsp;any&nbsp;way.&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;<br>
Amos&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
