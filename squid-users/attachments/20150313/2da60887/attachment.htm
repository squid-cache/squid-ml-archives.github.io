<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;am&nbsp;also&nbsp;having&nbsp;similar&nbsp;environment&nbsp;with&nbsp;squid&nbsp;(version&nbsp;3.5.2&nbsp;-20150218-r13758)&nbsp;and&nbsp;openssl&nbsp;1.0.1k,&nbsp;but&nbsp;for&nbsp;me&nbsp;only&nbsp;small&nbsp;number&nbsp;of&nbsp;https&nbsp;sites&nbsp;are&nbsp;working&nbsp;with&nbsp;peek&nbsp;and&nbsp;splice.&nbsp;For&nbsp;eg:-&nbsp;,&nbsp;I&nbsp;can&nbsp;access&nbsp;&lt;a&nbsp;href=&quot;https://www.google.com&quot;&gt;https://www.google.com&lt;/a&gt;&nbsp;but&nbsp;not&nbsp;&lt;a&nbsp;href=&quot;https://ssllabs.com&quot;&gt;https://ssllabs.com&lt;/a&gt;&nbsp;and&nbsp;lot&nbsp;of&nbsp;other&nbsp;https&nbsp;domains,&nbsp;giving&nbsp;&quot;Error<br>
negotiating&nbsp;SSL&nbsp;on&nbsp;FD&nbsp;15:&nbsp;error:140920E3:SSL<br>
routines:SSL3_GET_SERVER_HELLO:parse&nbsp;tlsext&nbsp;(1/-1/0)&nbsp;&quot;&nbsp;in&nbsp;the&nbsp;cache.log&nbsp;file. &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Also&nbsp;I&nbsp;could&nbsp;see&nbsp;a&nbsp;bunch&nbsp;of&nbsp;other&nbsp;error&nbsp;messages&nbsp;in&nbsp;the&nbsp;cache.log&nbsp;files&nbsp;relating&nbsp;to&nbsp;openssl&nbsp;(like&nbsp;&quot;Error&nbsp;negotiating&nbsp;SSL&nbsp;on&nbsp;FD&nbsp;21:&nbsp;error:14094085:SSL&nbsp;routines:SSL3_READ_BYTES:ccs&nbsp;received&nbsp;early&nbsp;(1/-1/0)&quot;&nbsp;,&nbsp;&quot;Error&nbsp;verifying&nbsp;certificates&nbsp;&quot;&nbsp;etc)&nbsp; when&nbsp;tried&nbsp;to&nbsp;access&nbsp;sites&nbsp;like&nbsp;&lt;a&nbsp;href=&quot;https://www.facebook.com&quot;&gt;https://www.facebook.com&lt;/a&gt;,&nbsp;&lt;a&nbsp;href=&quot;https://www.yahoo.com&quot;&gt;https://www.yahoo.com&lt;/a&gt;&nbsp;etc&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Squid&nbsp;is&nbsp;running&nbsp;on&nbsp;a&nbsp;CentOS&nbsp;7&nbsp;x64&nbsp;box&nbsp;and&nbsp;Workstation&nbsp;is&nbsp;Win7&nbsp;with&nbsp;Firefox&nbsp;and&nbsp;Chrome.&nbsp;I&nbsp;tried&nbsp;configuring&nbsp;openssl&nbsp;with&nbsp;disabling&nbsp;certain&nbsp;options&nbsp;with&nbsp;no-nextprotoneg&nbsp; and&nbsp;no-ec&nbsp;as&nbsp;well&nbsp;as&nbsp;with&nbsp;recent&nbsp;openssl&nbsp;version1.0.2&nbsp;,&nbsp;but&nbsp;without&nbsp;any&nbsp;success.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Below&nbsp;is&nbsp;my&nbsp;squid&nbsp;config&nbsp;file.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;acl&nbsp;localnet&nbsp;src&nbsp;&lt;a&nbsp;href=&quot;http://10.0.0.0/8&quot;&gt;10.0.0.0/8&lt;/a&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;#&nbsp;RFC1918&nbsp;possible&nbsp;internal&nbsp;network&lt;/div&gt;&lt;div&gt;acl&nbsp;localnet&nbsp;src&nbsp;&lt;a&nbsp;href=&quot;http://172.16.0.0/12&quot;&gt;172.16.0.0/12&lt;/a&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&lt;/span&gt;#&nbsp;RFC1918&nbsp;possible&nbsp;internal&nbsp;network&lt;/div&gt;&lt;div&gt;acl&nbsp;localnet&nbsp;src&nbsp;&lt;a&nbsp;href=&quot;http://192.168.0.0/16&quot;&gt;192.168.0.0/16&lt;/a&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;#&nbsp;RFC1918&nbsp;possible&nbsp;internal&nbsp;network&lt;/div&gt;&lt;div&gt;acl&nbsp;localnet&nbsp;src&nbsp;fc00::/7&nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;RFC&nbsp;4193&nbsp;local&nbsp;private&nbsp;network&nbsp;range&lt;/div&gt;&lt;div&gt;acl&nbsp;localnet&nbsp;src&nbsp;fe80::/10&nbsp; &nbsp; &nbsp; #&nbsp;RFC&nbsp;4291&nbsp;link-local&nbsp;(directly&nbsp;plugged)&nbsp;machines&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;acl&nbsp;SSL_ports&nbsp;port&nbsp;443&lt;/div&gt;&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;80&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;#&nbsp;http&lt;/div&gt;&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;21&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;#&nbsp;ftp&lt;/div&gt;&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;443&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;#&nbsp;https&lt;/div&gt;&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;70&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;#&nbsp;gopher&lt;/div&gt;&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;210&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;#&nbsp;wais&lt;/div&gt;&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;1025-65535&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;#&nbsp;unregistered&nbsp;ports&lt;/div&gt;&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;280&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;#&nbsp;http-mgmt&lt;/div&gt;&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;488&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;#&nbsp;gss-http&lt;/div&gt;&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;591&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;#&nbsp;filemaker&lt;/div&gt;&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;777&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;#&nbsp;multiling&nbsp;http&lt;/div&gt;&lt;div&gt;acl&nbsp;CONNECT&nbsp;method&nbsp;CONNECT&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#&lt;/div&gt;&lt;div&gt;#&nbsp;Recommended&nbsp;minimum&nbsp;Access&nbsp;Permission&nbsp;configuration:&lt;/div&gt;&lt;div&gt;#&lt;/div&gt;&lt;div&gt;#&nbsp;Deny&nbsp;requests&nbsp;to&nbsp;certain&nbsp;unsafe&nbsp;ports&lt;/div&gt;&lt;div&gt;http_access&nbsp;deny&nbsp;!Safe_ports&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#&nbsp;Deny&nbsp;CONNECT&nbsp;to&nbsp;other&nbsp;than&nbsp;secure&nbsp;SSL&nbsp;ports&lt;/div&gt;&lt;div&gt;http_access&nbsp;deny&nbsp;CONNECT&nbsp;!SSL_ports&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#&nbsp;Only&nbsp;allow&nbsp;cachemgr&nbsp;access&nbsp;from&nbsp;localhost&lt;/div&gt;&lt;div&gt;http_access&nbsp;allow&nbsp;localhost&nbsp;manager&lt;/div&gt;&lt;div&gt;http_access&nbsp;deny&nbsp;manager&lt;/div&gt;&lt;div&gt;http_access&nbsp;allow&nbsp;localnet&lt;/div&gt;&lt;div&gt;http_access&nbsp;allow&nbsp;localhost&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#&nbsp;And&nbsp;finally&nbsp;deny&nbsp;all&nbsp;other&nbsp;access&nbsp;to&nbsp;this&nbsp;proxy&lt;/div&gt;&lt;div&gt;http_access&nbsp;deny&nbsp;all&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;ssl_bump&nbsp;peek&nbsp;all&lt;/div&gt;&lt;div&gt;ssl_bump&nbsp;splice&nbsp;all&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#&nbsp;Squid&nbsp;normally&nbsp;listens&nbsp;to&nbsp;port&nbsp;3128&lt;/div&gt;&lt;div&gt;http_port&nbsp;&lt;WAN&nbsp;Interface&nbsp;IP&gt;:3128&lt;/div&gt;&lt;div&gt;http_port&nbsp;&lt;WAN&nbsp;Interface&nbsp;IP&gt;:3129&nbsp;intercept&lt;/div&gt;&lt;div&gt;https_port&nbsp;&lt;WAN&nbsp;Interface&nbsp;IP&gt;:3130&nbsp;intercept&nbsp;ssl-bump&nbsp;cert=/tmp/sslcertificates/server.cert.pem&nbsp;key=/tmp/sslcertificates/server.key.pem&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Does&nbsp;this&nbsp;has&nbsp;to&nbsp;do&nbsp;anything&nbsp;specific&nbsp;to&nbsp;my&nbsp;environment&nbsp;or&nbsp;the&nbsp;config&nbsp;options?&nbsp;Any&nbsp;help&nbsp;on&nbsp;this&nbsp;is&nbsp;highly&nbsp;appreciated.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks&nbsp;in&nbsp;advance,&lt;/div&gt;&lt;div&gt;John&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Tue,&nbsp;Mar&nbsp;10,&nbsp;2015&nbsp;at&nbsp;10:42&nbsp;PM,&nbsp;Roel&nbsp;van&nbsp;Meer&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:roel@1afa.com&quot;&nbsp;target=&quot;_blank&quot;&gt;roel@1afa.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;Roel&nbsp;van&nbsp;Meer&nbsp;writes:&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&gt;&gt;&nbsp;&gt;&nbsp;I&#39;m&nbsp;using&nbsp;squid&nbsp;3.5.2&nbsp;built&nbsp;with&nbsp;openssl&nbsp;0.9.8zc&nbsp;on&nbsp;Slackware&nbsp;13.1.&lt;br&gt;<br>
&gt;&gt;&nbsp;&gt;&nbsp;Traffic&nbsp;is&nbsp;redirected&nbsp;from&nbsp;port&nbsp;443&nbsp;top&nbsp;3130&nbsp;with&nbsp;iptables.&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;...&nbsp;and&nbsp;with&nbsp;an&nbsp;older&nbsp;version&nbsp;of&nbsp;OpenSSL&nbsp;missing&nbsp;many&nbsp;of&nbsp;the&nbsp;last&nbsp;few&lt;br&gt;<br>
&gt;&gt;&nbsp;years&nbsp;worth&nbsp;of&nbsp;TLS&nbsp;crypto&nbsp;features.&nbsp;IIRC&nbsp;the&nbsp;library&nbsp;releases&nbsp;are&nbsp;now&nbsp;up&lt;br&gt;<br>
&gt;&gt;&nbsp;to&nbsp;1.1.*&nbsp;or&nbsp;something.&nbsp;Its&nbsp;best&nbsp;to&nbsp;keep&nbsp;that&nbsp;kind&nbsp;of&nbsp;thing&nbsp;operating&nbsp;the&lt;br&gt;<br>
&gt;&gt;&nbsp;latest&nbsp;versions.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;know&nbsp;it&nbsp;missing&nbsp;the&nbsp;latest&nbsp;features,&nbsp;but&nbsp;security&nbsp;patches&nbsp;are&lt;br&gt;<br>
&gt;&nbsp;backported.&nbsp;And&nbsp;I&nbsp;know&nbsp;it&nbsp;is&nbsp;old,&nbsp;but&nbsp;it&#39;s&nbsp;what&nbsp;I&nbsp;have&nbsp;to&nbsp;work&nbsp;with&lt;br&gt;<br>
&gt;&nbsp;now.Do&nbsp;you&nbsp;think&nbsp;it&nbsp;might&nbsp;be&nbsp;the&nbsp;cause&nbsp;of&nbsp;the&nbsp;problem&nbsp;I&#39;m&nbsp;having&nbsp;with&lt;br&gt;<br>
&gt;&nbsp;peek/splice,&nbsp;or&nbsp;was&nbsp;it&nbsp;a&nbsp;general&nbsp;recommendation?&lt;br&gt;<br>
&lt;br&gt;<br>
Its&nbsp;a&nbsp;potential&nbsp;source&nbsp;of&nbsp;problems.&nbsp;Chrome&nbsp;is&nbsp;very&nbsp;much&nbsp;on&nbsp;the&nbsp;front&lt;br&gt;<br>
line&nbsp;of&nbsp;the&nbsp;arms&nbsp;race&nbsp;attempting&nbsp;to&nbsp;stop&nbsp;things&nbsp;like&nbsp;SSL-Bump&nbsp;working.&lt;br&gt;<br>
Firefox&nbsp;implement&nbsp;their&nbsp;own&nbsp;crypto&nbsp;library&nbsp;which&nbsp;tracks&nbsp;the&nbsp;latest&nbsp;TLS&lt;br&gt;<br>
features&nbsp;at&nbsp;a&nbsp;similar&nbsp;speed&nbsp;of&nbsp;development.&lt;br&gt;<br>
OpenSSL&nbsp;will&nbsp;be&nbsp;perpetually&nbsp;behind&nbsp;both&nbsp;of&nbsp;them,&nbsp;but&nbsp;at&nbsp;least&nbsp;the&nbsp;latest&lt;br&gt;<br>
one(s)&nbsp;have&nbsp;better&nbsp;chances&nbsp;not&nbsp;to&nbsp;be&nbsp;advertising&nbsp;features&nbsp;they&nbsp;reject&nbsp;in&lt;br&gt;<br>
&quot;considered&nbsp;harmful&quot;&nbsp;grounds.&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
I&#39;ll&nbsp;have&nbsp;a&nbsp;go&nbsp;then&nbsp;at&nbsp;trying&nbsp;with&nbsp;a&nbsp;newer&nbsp;openssl&nbsp;and&nbsp;the&nbsp;patches&nbsp;from&nbsp;thethread&nbsp;you&nbsp;mentioned.&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
With&nbsp;Squid&nbsp;3.5.2&nbsp;built&nbsp;with&nbsp;openssl&nbsp;1.0.1k&nbsp;I&nbsp;can&nbsp;splice&nbsp;https&nbsp;connections&nbsp;with&nbsp;no&nbsp;trouble.&nbsp;Tested&nbsp;with&nbsp;Lync,&nbsp;Chrome,&nbsp;Firefox,&nbsp;and&nbsp;IE.&lt;br&gt;<br>
&lt;br&gt;<br>
So&nbsp;you&nbsp;were&nbsp;right.&nbsp;:)&nbsp;Thanks&nbsp;a&nbsp;lot&nbsp;for&nbsp;pointing&nbsp;me&nbsp;in&nbsp;the&nbsp;right&nbsp;direction!&lt;br&gt;<br>
&lt;br&gt;<br>
Cheers,&lt;br&gt;<br>
&lt;br&gt;<br>
Roel&lt;br&gt;<br>
______________________________&lt;u&gt;&lt;/u&gt;_________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.&lt;u&gt;&lt;/u&gt;org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/&lt;u&gt;&lt;/u&gt;listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
