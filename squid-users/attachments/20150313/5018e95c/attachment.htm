<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;Hi&nbsp;All,&lt;br&gt;&lt;br&gt;&lt;/div&gt;Installed&nbsp;squid&nbsp;on&nbsp;CentOS&nbsp;6.6&nbsp;and&nbsp;it&#39;s&nbsp;working,&nbsp;but&nbsp;mY&nbsp;access.log&nbsp;shows&nbsp;all&nbsp;TCP_MISS&nbsp;and&nbsp;no&nbsp;TCP_HIT.&nbsp;The&nbsp;following&nbsp;config:&lt;br&gt;&lt;br&gt;&lt;/div&gt;squid.conf&lt;br&gt;#&nbsp;Squid&nbsp;normally&nbsp;listens&nbsp;to&nbsp;port&nbsp;3128&lt;br&gt;http_port&nbsp;3128&lt;br&gt;http_port&nbsp;3129&nbsp;intercept&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;iptables&lt;br&gt;&lt;br&gt;#&nbsp;Generated&nbsp;by&nbsp;iptables-save&nbsp;v1.4.7&nbsp;on&nbsp;Fri&nbsp;Mar&nbsp;13&nbsp;16:04:02&nbsp;2015&lt;br&gt;*nat&lt;br&gt;:PREROUTING&nbsp;ACCEPT&nbsp;[10:2031]&lt;br&gt;:POSTROUTING&nbsp;ACCEPT&nbsp;[0:0]&lt;br&gt;:OUTPUT&nbsp;ACCEPT&nbsp;[0:0]&lt;br&gt;-A&nbsp;PREROUTING&nbsp;-s&nbsp;&lt;a&nbsp;href=&quot;http://147.245.252.13/32&quot;&gt;147.245.252.13/32&lt;/a&gt;&nbsp;-p&nbsp;tcp&nbsp;-m&nbsp;tcp&nbsp;--dport&nbsp;80&nbsp;-j&nbsp;ACCEPT&nbsp;&lt;br&gt;-A&nbsp;PREROUTING&nbsp;-s&nbsp;&lt;a&nbsp;href=&quot;http://10.0.0.24/32&quot;&gt;10.0.0.24/32&lt;/a&gt;&nbsp;-p&nbsp;tcp&nbsp;-m&nbsp;tcp&nbsp;--dport&nbsp;80&nbsp;-j&nbsp;ACCEPT&nbsp;&lt;br&gt;-A&nbsp;PREROUTING&nbsp;-s&nbsp;&lt;a&nbsp;href=&quot;http://147.245.252.13/32&quot;&gt;147.245.252.13/32&lt;/a&gt;&nbsp;-p&nbsp;tcp&nbsp;-m&nbsp;tcp&nbsp;--dport&nbsp;80&nbsp;-j&nbsp;ACCEPT&nbsp;&lt;br&gt;-A&nbsp;PREROUTING&nbsp;-p&nbsp;tcp&nbsp;-m&nbsp;tcp&nbsp;--dport&nbsp;80&nbsp;-j&nbsp;REDIRECT&nbsp;--to-ports&nbsp;3129&lt;br&gt;-A&nbsp;POSTROUTING&nbsp;-j&nbsp;MASQUERADE&nbsp;&lt;br&gt;COMMIT&lt;br&gt;#&nbsp;Completed&nbsp;on&nbsp;Fri&nbsp;Mar&nbsp;13&nbsp;16:04:02&nbsp;2015&lt;br&gt;#&nbsp;Generated&nbsp;by&nbsp;iptables-save&nbsp;v1.4.7&nbsp;on&nbsp;Fri&nbsp;Mar&nbsp;13&nbsp;16:04:02&nbsp;2015&lt;br&gt;*filter&lt;br&gt;:INPUT&nbsp;ACCEPT&nbsp;[0:0]&lt;br&gt;:FORWARD&nbsp;ACCEPT&nbsp;[0:0]&lt;br&gt;:OUTPUT&nbsp;ACCEPT&nbsp;[1818:649971]&lt;br&gt;-A&nbsp;INPUT&nbsp;-m&nbsp;state&nbsp;--state&nbsp;RELATED,ESTABLISHED&nbsp;-j&nbsp;ACCEPT&nbsp;&lt;br&gt;-A&nbsp;INPUT&nbsp;-p&nbsp;icmp&nbsp;-j&nbsp;REJECT&nbsp;--reject-with&nbsp;icmp-port-unreachable&nbsp;&lt;br&gt;-A&nbsp;INPUT&nbsp;-i&nbsp;lo&nbsp;-j&nbsp;ACCEPT&nbsp;&lt;br&gt;-A&nbsp;INPUT&nbsp;-p&nbsp;tcp&nbsp;-m&nbsp;state&nbsp;--state&nbsp;NEW&nbsp;-m&nbsp;tcp&nbsp;--dport&nbsp;22&nbsp;-j&nbsp;ACCEPT&nbsp;&lt;br&gt;-A&nbsp;INPUT&nbsp;-i&nbsp;eth0&nbsp;-p&nbsp;tcp&nbsp;-m&nbsp;tcp&nbsp;--dport&nbsp;3129&nbsp;-m&nbsp;state&nbsp;--state&nbsp;NEW,ESTABLISHED&nbsp;-j&nbsp;ACCEPT&nbsp;&lt;br&gt;-A&nbsp;INPUT&nbsp;-i&nbsp;eth0&nbsp;-p&nbsp;tcp&nbsp;-m&nbsp;tcp&nbsp;--dport&nbsp;80&nbsp;-m&nbsp;state&nbsp;--state&nbsp;NEW,ESTABLISHED&nbsp;-j&nbsp;ACCEPT&nbsp;&lt;br&gt;-A&nbsp;INPUT&nbsp;-j&nbsp;REJECT&nbsp;--reject-with&nbsp;icmp-host-prohibited&nbsp;&lt;br&gt;-A&nbsp;FORWARD&nbsp;-j&nbsp;REJECT&nbsp;--reject-with&nbsp;icmp-host-prohibited&nbsp;&lt;br&gt;COMMIT&lt;br&gt;#&nbsp;Completed&nbsp;on&nbsp;Fri&nbsp;Mar&nbsp;13&nbsp;16:04:02&nbsp;2015&lt;br&gt;#&nbsp;Generated&nbsp;by&nbsp;iptables-save&nbsp;v1.4.7&nbsp;on&nbsp;Fri&nbsp;Mar&nbsp;13&nbsp;16:04:02&nbsp;2015&lt;br&gt;*mangle&lt;br&gt;:PREROUTING&nbsp;ACCEPT&nbsp;[68:6199]&lt;br&gt;:INPUT&nbsp;ACCEPT&nbsp;[68:6199]&lt;br&gt;:FORWARD&nbsp;ACCEPT&nbsp;[0:0]&lt;br&gt;:OUTPUT&nbsp;ACCEPT&nbsp;[26:3064]&lt;br&gt;:POSTROUTING&nbsp;ACCEPT&nbsp;[26:3064]&lt;br&gt;-A&nbsp;PREROUTING&nbsp;-p&nbsp;tcp&nbsp;-m&nbsp;tcp&nbsp;--dport&nbsp;3129&nbsp;-j&nbsp;DROP&nbsp;&lt;br&gt;COMMIT&lt;br&gt;#&nbsp;Completed&nbsp;on&nbsp;Fri&nbsp;Mar&nbsp;13&nbsp;16:04:02&nbsp;2015&lt;br&gt;&lt;br&gt;&lt;div&gt; &lt;br&gt;&lt;/div&gt;&lt;div&gt;Accessing&nbsp;sites,&nbsp;shows&nbsp;the&nbsp;IP&nbsp;address&nbsp;of&nbsp;the&nbsp;proxy&nbsp;147.245.252.13.&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Am&nbsp;I&nbsp;missing&nbsp;something&nbsp;in&nbsp;IPTables&nbsp;that&nbsp;it&nbsp;is&nbsp;not&nbsp;caching?&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks&lt;br&gt;&lt;/div&gt;&lt;div&gt;Monah&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Fri,&nbsp;Mar&nbsp;6,&nbsp;2015&nbsp;at&nbsp;11:26&nbsp;PM,&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&nbsp;target=&quot;_blank&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;On&nbsp;6/03/2015&nbsp;1:19&nbsp;a.m.,&nbsp;Monah&nbsp;Baki&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;Hi&nbsp;all,&nbsp;can&nbsp;anyone&nbsp;verify&nbsp;if&nbsp;this&nbsp;is&nbsp;correct,&nbsp;need&nbsp;to&nbsp;make&nbsp;ure&nbsp;that&nbsp;users&lt;br&gt;<br>
&gt;&nbsp;will&nbsp;be&nbsp;able&nbsp;to&nbsp;access&nbsp;the&nbsp;internet&nbsp;via&nbsp;the&nbsp;squid.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Running&nbsp;FreeBSD&nbsp;with&nbsp;a&nbsp;single&nbsp;interface&nbsp;with&nbsp;Squid-3.5.2&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Policy&nbsp;based&nbsp;routing&nbsp;on&nbsp;Cisco&nbsp;with&nbsp;the&nbsp;following:&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;interface&nbsp;GigabitEthernet0/0/1.1&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;encapsulation&nbsp;dot1Q&nbsp;1&nbsp;native&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;ip&nbsp;address&nbsp;10.0.0.9&nbsp;255.255.255.0&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;no&nbsp;ip&nbsp;redirects&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;no&nbsp;ip&nbsp;unreachables&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;ip&nbsp;nat&nbsp;inside&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;standby&nbsp;1&nbsp;ip&nbsp;10.0.0.10&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;standby&nbsp;1&nbsp;priority&nbsp;120&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;standby&nbsp;1&nbsp;preempt&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;standby&nbsp;1&nbsp;name&nbsp;HSRP&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;ip&nbsp;policy&nbsp;route-map&nbsp;CFLOW&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;ip&nbsp;access-list&nbsp;extended&nbsp;REDIRECT&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;deny &nbsp; tcp&nbsp;host&nbsp;10.0.0.24&nbsp;any&nbsp;eq&nbsp;www&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;permit&nbsp;tcp&nbsp;host&nbsp;10.0.0.23&nbsp;any&nbsp;eq&nbsp;www&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;route-map&nbsp;CFLOW&nbsp;permit&nbsp;10&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;match&nbsp;ip&nbsp;address&nbsp;REDIRECT&lt;br&gt;<br>
&gt;&nbsp;set&nbsp;ip&nbsp;next-hop&nbsp;10.0.0.24&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;In&nbsp;my&nbsp;/etc/pf.conf&lt;br&gt;<br>
&gt;&nbsp;rdr&nbsp;pass&nbsp;inet&nbsp;proto&nbsp;tcp&nbsp;from&nbsp;&lt;a&nbsp;href=&quot;http://10.0.0.0/8&quot;&nbsp;target=&quot;_blank&quot;&gt;10.0.0.0/8&lt;/a&gt;&nbsp;to&nbsp;any&nbsp;port&nbsp;80&nbsp;-&gt;&nbsp;10.0.0.24&nbsp;port&lt;br&gt;<br>
&gt;&nbsp;3129&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;#&nbsp;block&nbsp;in&lt;br&gt;<br>
&gt;&nbsp;pass&nbsp;in&nbsp;log&nbsp;quick&nbsp;on&nbsp;bge0&lt;br&gt;<br>
&gt;&nbsp;pass&nbsp;out&nbsp;log&nbsp;quick&nbsp;on&nbsp;bge0&lt;br&gt;<br>
&gt;&nbsp;pass&nbsp;out&nbsp;keep&nbsp;state&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;and&nbsp;finally&nbsp;in&nbsp;my&nbsp;squid.conf:&lt;br&gt;<br>
&gt;&nbsp;http_port&nbsp;3128&lt;br&gt;<br>
&gt;&nbsp;http_port&nbsp;3129&nbsp;intercept&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;And&nbsp;for&nbsp;testing&nbsp;purposes&nbsp;from&nbsp;the&nbsp;squid&nbsp;server:&lt;br&gt;<br>
&gt; &nbsp;./squidclient&nbsp;-h&nbsp;10.0.0.24&nbsp;-p&nbsp;3128&nbsp;&lt;a&nbsp;href=&quot;http://www.freebsd.org/&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.freebsd.org/&lt;/a&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;If&nbsp;I&nbsp;replace&nbsp;-p&nbsp;3128&nbsp;with&nbsp;-p&nbsp;80,&nbsp;I&nbsp;get&nbsp;a&nbsp;access&nbsp;denied,&nbsp;and&nbsp;if&nbsp;I&nbsp;omit&nbsp;the&lt;br&gt;<br>
&gt;&nbsp;-p&nbsp;3128&nbsp;completely,&nbsp;I&nbsp;can&nbsp;access&nbsp;the&nbsp;websites.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;If&nbsp;you&nbsp;omit&nbsp;the&nbsp;-p&nbsp;entirely&nbsp;squidclient&nbsp;assumes&nbsp;&quot;-p&nbsp;3128&quot;&nbsp;(the&nbsp;proxy&lt;br&gt;<br>
default&nbsp;listening&nbsp;port),&nbsp;so&nbsp;it&nbsp;works&nbsp;exactly&nbsp;the&nbsp;same&nbsp;as&nbsp;if&nbsp;you&nbsp;had&nbsp;used&lt;br&gt;<br>
-p&nbsp;3128&nbsp;explicitly.&lt;br&gt;<br>
&lt;br&gt;<br>
If&nbsp;you&nbsp;use&nbsp;-p&nbsp;80&nbsp;you&nbsp;also&nbsp;need&nbsp;to&nbsp;change&nbsp;the&nbsp;pther&nbsp;parameters&nbsp;so&nbsp;they&lt;br&gt;<br>
generate&nbsp;port-80&nbsp;syntax&nbsp;message:&lt;br&gt;<br>
 -&nbsp;the&nbsp;-h&nbsp;with&nbsp;IP&nbsp;or&nbsp;hostname&nbsp;of&nbsp;the&nbsp;remote&nbsp;web&nbsp;server,&nbsp;and&lt;br&gt;<br>
 -&nbsp;the&nbsp;URL&nbsp;parameters&nbsp;being&nbsp;a&nbsp;relative&nbsp;URL,&nbsp;and&lt;br&gt;<br>
 -&nbsp;the&nbsp;-j&nbsp;parameter&nbsp;with&nbsp;Host:&nbsp;header&nbsp;domain&nbsp;name&nbsp;of&nbsp;the&nbsp;server&lt;br&gt;<br>
...&lt;br&gt;<br>
 eg.&lt;br&gt;<br>
 squidclient&nbsp;-h&nbsp;&lt;a&nbsp;href=&quot;http://www.freebsd.org&quot;&nbsp;target=&quot;_blank&quot;&gt;www.freebsd.org&lt;/a&gt;&nbsp;-j&nbsp;&lt;a&nbsp;href=&quot;http://www.freebsd.org&quot;&nbsp;target=&quot;_blank&quot;&gt;www.freebsd.org&lt;/a&gt;&nbsp;-p&nbsp;80&nbsp;/&lt;br&gt;<br>
&lt;br&gt;<br>
NP:&nbsp;if&nbsp;your&nbsp;squidclient&nbsp;is&nbsp;too&nbsp;old&nbsp;to&nbsp;support&nbsp;-j,&nbsp;use&nbsp;this&nbsp;instead:&lt;br&gt;<br>
 &nbsp;-H&nbsp;&#39;Host:&nbsp;&lt;a&nbsp;href=&quot;http://www.freebsd.org&quot;&nbsp;target=&quot;_blank&quot;&gt;www.freebsd.org&lt;/a&gt;\n&#39;&lt;br&gt;<br>
&lt;br&gt;<br>
 **&nbsp;this&nbsp;test&nbsp;should&nbsp;work&nbsp;from&nbsp;the&nbsp;squid&nbsp;box&nbsp;without&nbsp;having&nbsp;gone&nbsp;through&lt;br&gt;<br>
the&nbsp;proxy.&nbsp;Only&nbsp;from&nbsp;the&nbsp;client&nbsp;machine&nbsp;should&nbsp;it&nbsp;work&nbsp;*with*&nbsp;NAT&lt;br&gt;<br>
passing&nbsp;it&nbsp;through&nbsp;the&nbsp;proxy.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Using&nbsp;a&nbsp;proxy&nbsp;syntax&nbsp;message&nbsp;sent&nbsp;directly&nbsp;to&nbsp;the&nbsp;proxy&nbsp;receiving&nbsp;port,&lt;br&gt;<br>
or&nbsp;with&nbsp;the&nbsp;proxy&nbsp;as&nbsp;receiving&nbsp;IP&nbsp;on&nbsp;port&nbsp;80&nbsp;(NAT&#39;ed&nbsp;to&nbsp;Squid)&nbsp;is&nbsp;a&lt;br&gt;<br>
guaranted&nbsp;forwarding&nbsp;loop&nbsp;failure.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
That&nbsp;doesn&#39;t&nbsp;fix&nbsp;your&nbsp;clients&nbsp;issue,&nbsp;but&nbsp;hopefully&nbsp;makes&nbsp;it&nbsp;clear&nbsp;that&lt;br&gt;<br>
the&nbsp;above&nbsp;desribed&nbsp;test&nbsp;is&nbsp;broken&nbsp;enough&nbsp;to&nbsp;prevent&nbsp;you&nbsp;identifying&nbsp;when&lt;br&gt;<br>
the&nbsp;client&nbsp;issue&nbsp;is&nbsp;fixed&nbsp;if&nbsp;that&nbsp;happens&nbsp;on&nbsp;some&nbsp;change.&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;<br>
Amos&lt;br&gt;<br>
&lt;/font&gt;&lt;/span&gt;&lt;div&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;_______________________________________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
