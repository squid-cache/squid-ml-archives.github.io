<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;pre&nbsp;class=&quot;&quot;&nbsp;id=&quot;comment_text_2&quot;&nbsp;style=&quot;white-space:pre-wrap;width:50em;color:rgb(0,0,0)&quot;&gt;Also&nbsp;this&nbsp;issue&nbsp;is&nbsp;no&nbsp;more&nbsp;appearing&nbsp;if&nbsp;I&nbsp;peek&nbsp;step&nbsp;1&nbsp;alone&nbsp;and&nbsp;splice&nbsp;the&nbsp;remaining&nbsp;ones.<br>
<br>
acl&nbsp;step1&nbsp;at_step&nbsp;&nbsp;SslBump1<br>
acl&nbsp;step2&nbsp;at_step&nbsp;&nbsp;SslBump2<br>
acl&nbsp;step3&nbsp;at_step&nbsp;&nbsp;SslBump3<br>
<br>
<br>
ssl_bump&nbsp;peek&nbsp;step1&nbsp;all<br>
ssl_bump&nbsp;splice&nbsp;all<br>
<br>
So&nbsp;I&nbsp;guess&nbsp;the&nbsp;issue&nbsp;is&nbsp;with&nbsp;the&nbsp;PeerConnector&nbsp;module&nbsp;where&nbsp;SSL_connect&nbsp;method&nbsp;is&nbsp;being&nbsp;used&nbsp;to&nbsp;connect&nbsp;and&nbsp;parse&nbsp;the&nbsp;server&nbsp;certificate.&lt;/pre&gt;&lt;pre&nbsp;class=&quot;&quot;&nbsp;id=&quot;comment_text_2&quot;&nbsp;style=&quot;white-space:pre-wrap;width:50em;color:rgb(0,0,0)&quot;&gt;&lt;br&gt;&lt;/pre&gt;&lt;pre&nbsp;class=&quot;&quot;&nbsp;id=&quot;comment_text_2&quot;&nbsp;style=&quot;white-space:pre-wrap;width:50em;color:rgb(0,0,0)&quot;&gt;I&nbsp;had&nbsp;added&nbsp;this&nbsp;as&nbsp;a&nbsp;bug&nbsp;as&nbsp;well.&lt;/pre&gt;&lt;pre&nbsp;class=&quot;&quot;&nbsp;id=&quot;comment_text_2&quot;&nbsp;style=&quot;white-space:pre-wrap;width:50em;color:rgb(0,0,0)&quot;&gt;&lt;a&nbsp;href=&quot;http://bugs.squid-cache.org/show_bug.cgi?id=4202&quot;&gt;http://bugs.squid-cache.org/show_bug.cgi?id=4202&lt;/a&gt;&lt;/pre&gt;&lt;pre&nbsp;class=&quot;&quot;&nbsp;id=&quot;comment_text_2&quot;&nbsp;style=&quot;white-space:pre-wrap;width:50em;color:rgb(0,0,0)&quot;&gt;Regards,<br>
John&lt;/pre&gt;<br>
<br>
<br>
<br>
<br>
<br>
&lt;div&nbsp;lang=&quot;EN-US&quot;&nbsp;link=&quot;#0563C1&quot;&nbsp;vlink=&quot;#954F72&quot;&gt;<br>
&lt;div&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(31,73,125)&quot;&gt;&lt;u&gt;&lt;/u&gt; &lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(31,73,125)&quot;&gt;&lt;u&gt;&lt;/u&gt; &lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;<br>
&lt;div&gt;<br>
&lt;div&nbsp;style=&quot;border-style:solid&nbsp;none&nbsp;none;border-top-color:rgb(225,225,225);border-top-width:1pt;padding:3pt&nbsp;0in&nbsp;0in&quot;&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;b&gt;From:&lt;/b&gt;&nbsp;John&nbsp;Killimangalam&nbsp;Jacob&nbsp;&lt;br&gt;<br>
&lt;b&gt;Sent:&lt;/b&gt;&nbsp;Monday,&nbsp;February&nbsp;16,&nbsp;2015&nbsp;11:25&nbsp;AM&lt;br&gt;<br>
&lt;b&gt;To:&lt;/b&gt;&nbsp;&#39;&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&#39;&lt;br&gt;<br>
&lt;b&gt;Subject:&lt;/b&gt;&nbsp;Error&nbsp;when&nbsp;using&nbsp;peek/splice/terminate&nbsp;with&nbsp;Squid&nbsp;3.5.1&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/p&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;u&gt;&lt;/u&gt; &lt;u&gt;&lt;/u&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(31,73,125)&quot;&gt;Hi&nbsp;All,&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(31,73,125)&quot;&gt;&lt;u&gt;&lt;/u&gt; &lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(31,73,125)&quot;&gt;I&nbsp;am&nbsp;trying&nbsp;to&nbsp;configure&nbsp;an&nbsp;intercept&nbsp;proxy&nbsp;with&nbsp;peek/splice/terminate&nbsp;features&nbsp;in&nbsp;Squid&nbsp;3.5.1&nbsp;on&nbsp;CentOS&nbsp;7&nbsp;-&nbsp;64&nbsp;bit.&nbsp;I&nbsp;wanted&nbsp;to&nbsp;peak&nbsp;at&nbsp;steps&nbsp;1&nbsp;and&nbsp;step&nbsp;2&nbsp;and&nbsp;to&nbsp;decide&nbsp;on&nbsp;terminate&nbsp;on&nbsp;step&nbsp;3&nbsp;based&nbsp;on&nbsp;the&nbsp;SNI<br>
&nbsp;and&nbsp;server&nbsp;certificate&nbsp;values.&nbsp;It&nbsp;is&nbsp;working&nbsp;only&nbsp;for&nbsp;&lt;a&nbsp;href=&quot;https://www.google.com&quot;&nbsp;target=&quot;_blank&quot;&gt;<br>
https://www.google.com&lt;/a&gt;,&nbsp;but&nbsp;lot&nbsp;of&nbsp;other&nbsp;ssl&nbsp;sites&nbsp;(likes&nbsp;of&nbsp;&lt;a&nbsp;href=&quot;https://www.yahoo.com&quot;&nbsp;target=&quot;_blank&quot;&gt;<br>
https://www.yahoo.com&lt;/a&gt;&nbsp;etc)&nbsp;are&nbsp;not&nbsp;getting&nbsp;loaded&nbsp;logging&nbsp;an&nbsp;“&nbsp;&lt;i&gt;Error&nbsp;negotiating&nbsp;SSL&nbsp;on&nbsp;FD&nbsp;36:&nbsp;error:140920E3:SSL&nbsp;routines:SSL3_GET_SERVER_HELLO:parse&nbsp;tlsext&nbsp; &lt;/i&gt;“<br>
&lt;i&gt; &lt;/i&gt;in&nbsp;the&nbsp;cache.log&nbsp;(trying&nbsp;the&nbsp;same&nbsp;sites&nbsp;using&nbsp;openssl&nbsp;s_client&nbsp;command&nbsp;works).&nbsp;I&nbsp;was&nbsp;wondering&nbsp;if&nbsp;it&nbsp;has&nbsp;to&nbsp;do&nbsp;anything&nbsp;with&nbsp;my&nbsp;config&nbsp;or&nbsp;open&nbsp;ssl&nbsp;(version&nbsp;1.0.1e)&nbsp;or&nbsp;anything&nbsp;else.&nbsp;The&nbsp;web&nbsp;sites&nbsp;are&nbsp;being&nbsp;accessed&nbsp;from&nbsp;a&nbsp;windows&nbsp;7&nbsp;workstation&nbsp;with<br>
&nbsp;IE&nbsp;8&nbsp;and&nbsp;Firefox&nbsp;35.0.1&nbsp;.&nbsp;Below&nbsp;is&nbsp;the&nbsp;squid.config&nbsp;section&nbsp;for&nbsp;peek&nbsp;and&nbsp;splice&nbsp;I&nbsp;am&nbsp;using.&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(31,73,125)&quot;&gt;&lt;u&gt;&lt;/u&gt; &lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;i&gt;&lt;span&nbsp;style=&quot;color:rgb(31,73,125)&quot;&gt;acl&nbsp;step1&nbsp;at_step &nbsp;SslBump1&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/i&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;i&gt;&lt;span&nbsp;style=&quot;color:rgb(31,73,125)&quot;&gt;acl&nbsp;step2&nbsp;at_step &nbsp;SslBump2&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/i&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;i&gt;&lt;span&nbsp;style=&quot;color:rgb(31,73,125)&quot;&gt;acl&nbsp;step3&nbsp;at_step &nbsp;SslBump3&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/i&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;i&gt;&lt;span&nbsp;style=&quot;color:rgb(31,73,125)&quot;&gt;&lt;u&gt;&lt;/u&gt; &lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/i&gt;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0in&nbsp;0in&nbsp;0.0001pt&quot;&gt;&lt;i&gt;&lt;span&nbsp;style=&quot;font-size:11pt;font-family:Calibri,sans-serif;color:rgb(31,73,125)&quot;&gt;external_acl_type&nbsp;SSL_URL_Filter&nbsp;%SRC&nbsp;%ssl::&gt;sni&nbsp;%ssl::&lt;cert_subject&nbsp;&lt;/path/to/urlfilterscript&gt;&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/i&gt;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0in&nbsp;0in&nbsp;0.0001pt&quot;&gt;&lt;i&gt;&lt;span&nbsp;style=&quot;font-size:11pt;font-family:Calibri,sans-serif;color:rgb(31,73,125)&quot;&gt;acl&nbsp;URL_Allowed&nbsp;external&nbsp;SSL_URL_Filter&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/i&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;i&gt;&lt;span&nbsp;style=&quot;color:rgb(31,73,125)&quot;&gt;&lt;u&gt;&lt;/u&gt; &lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/i&gt;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0in&nbsp;0in&nbsp;0.0001pt&quot;&gt;&lt;i&gt;&lt;span&nbsp;style=&quot;font-size:11pt;font-family:Calibri,sans-serif;color:rgb(31,73,125)&quot;&gt;ssl_bump&nbsp;peek&nbsp;step1&nbsp;all&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/i&gt;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0in&nbsp;0in&nbsp;0.0001pt&quot;&gt;&lt;i&gt;&lt;span&nbsp;style=&quot;font-size:11pt;font-family:Calibri,sans-serif;color:rgb(31,73,125)&quot;&gt;ssl_bump&nbsp;peek&nbsp;step2&nbsp;all &lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/i&gt;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0in&nbsp;0in&nbsp;0.0001pt&quot;&gt;&lt;i&gt;&lt;span&nbsp;style=&quot;font-size:11pt;font-family:Calibri,sans-serif;color:rgb(31,73,125)&quot;&gt;ssl_bump&nbsp;terminate&nbsp;step3&nbsp;!URL_Allowed&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/i&gt;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0in&nbsp;0in&nbsp;0.0001pt&quot;&gt;&lt;i&gt;&lt;span&nbsp;style=&quot;font-size:11pt;font-family:Calibri,sans-serif;color:rgb(31,73,125)&quot;&gt;ssl_bump&nbsp;splice&nbsp;step3&nbsp;all&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/i&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;i&gt;&lt;span&nbsp;style=&quot;color:rgb(31,73,125)&quot;&gt;&lt;u&gt;&lt;/u&gt; &lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/i&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;i&gt;&lt;span&nbsp;style=&quot;color:rgb(31,73,125)&quot;&gt;#&nbsp;Squid&nbsp;normally&nbsp;listens&nbsp;to&nbsp;port&nbsp;3128&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/i&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;i&gt;&lt;span&nbsp;style=&quot;color:rgb(31,73,125)&quot;&gt;http_port&nbsp;3128&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/i&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;i&gt;&lt;span&nbsp;style=&quot;color:rgb(31,73,125)&quot;&gt;http_port&nbsp;3129&nbsp;intercept&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/i&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;i&gt;&lt;span&nbsp;style=&quot;color:rgb(31,73,125)&quot;&gt;https_port&nbsp;3130&nbsp;intercept&nbsp;ssl-bump&nbsp;cert=/tmp/sslcertificates/server.cert.pem&nbsp;key=/tmp/sslcertificates/server.key.pem&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/i&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(31,73,125)&quot;&gt;&lt;u&gt;&lt;/u&gt; &lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(31,73,125)&quot;&gt;Thanks&nbsp;in&nbsp;Advance,&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(31,73,125)&quot;&gt;John&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
