<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;Hi&nbsp;everyone&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;I&#39;ve&nbsp;been&nbsp;trying&nbsp;to&nbsp;make&nbsp;a&nbsp;traffic&nbsp;load&nbsp;balancing&nbsp;between&nbsp;two&nbsp;links&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;based&nbsp;on&nbsp;username&nbsp;using&nbsp;tcp_outgoing_address&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;My&nbsp;squid&nbsp;setup&nbsp;only&nbsp;use&nbsp;authorization&nbsp;with&nbsp;an&nbsp;external_acl&nbsp;which&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;returns&nbsp;the&nbsp;username&nbsp;based&nbsp;on&nbsp;the&nbsp;client&nbsp;ip.&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;In&nbsp;my&nbsp;first&nbsp;failure&nbsp;trying&nbsp;to&nbsp;setup&nbsp;this,&nbsp;I&nbsp;found&nbsp;(with&nbsp;the&nbsp;help&nbsp;of&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;Amos)&nbsp;that&nbsp;tcp_outgoing_address&nbsp;only&nbsp;works&nbsp;with&nbsp;fast&nbsp;acls,&nbsp;so&nbsp;ext_user&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;acl&nbsp;doesn&#39;t&nbsp;work&nbsp;there,&nbsp;Amos&nbsp;recommend&nbsp;me&nbsp;to&nbsp;use&nbsp;NOTE&nbsp;acl&nbsp;for&nbsp;matching&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;annotations&nbsp;in&nbsp;transactions,&nbsp;at&nbsp;first&nbsp;it&nbsp;looks&nbsp;to&nbsp;work&nbsp;fine&nbsp;but&nbsp;now&nbsp;I&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;am&nbsp;realizing&nbsp;that&nbsp;only&nbsp;a&nbsp;very&nbsp;small&nbsp;part&nbsp;of&nbsp;the&nbsp;traffic&nbsp;is&nbsp;been&nbsp;going&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;through&nbsp;the&nbsp;correct&nbsp;link.&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;I&nbsp;can&#39;t&nbsp;find&nbsp;any&nbsp;good&nbsp;documentation&nbsp;related&nbsp;to&nbsp;note&nbsp;acl&nbsp;with&nbsp;some&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;samples&nbsp;or&nbsp;cases&nbsp;of&nbsp;usage,&nbsp;so&nbsp;I&nbsp;hope&nbsp;some&nbsp;one&nbsp;can&nbsp;correct&nbsp;my&nbsp;config&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;and/or&nbsp;point&nbsp;me&nbsp;the&nbsp;right&nbsp;direction&nbsp;to&nbsp;achieve&nbsp;this.&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;Inside&nbsp;my&nbsp;external&nbsp;acl&nbsp;I&nbsp;mark&nbsp;some&nbsp;users&nbsp;like&nbsp;this.&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;//&nbsp;if&nbsp;username&nbsp;is&nbsp;one&nbsp;of&nbsp;fast&nbsp;users&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;fwrite(STDOUT,&nbsp;&quot;OK&nbsp;user=$username&nbsp;clt_conn_tag=55\n&quot;);&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;So&nbsp;theoretically&nbsp;both&nbsp;user&nbsp;and&nbsp;clt_conn_tag&nbsp;values&nbsp;can&nbsp;be&nbsp;matched&nbsp;with&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;NOTE&nbsp;ACL,&nbsp;as&nbsp;far&nbsp;as&nbsp;i&nbsp;know,&nbsp;I&nbsp;use&nbsp;also&nbsp;clt_conn_tag&nbsp;for&nbsp;testing&nbsp;but&nbsp;it&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;should&nbsp;be&nbsp;enough&nbsp;with&nbsp;user&nbsp;mark.&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;#this&nbsp;is&nbsp;fast&nbsp;users&nbsp;declaration&nbsp;tests&nbsp;ive&nbsp;tried&nbsp;with&nbsp;both&nbsp;commented&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;and&nbsp;uncommented&nbsp;acl.&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;acl&nbsp;nodo_users&nbsp;ext_user&nbsp;&quot;/etc/squid3/users/nodo_users&quot;&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;#acl&nbsp;fast_users&nbsp;note&nbsp;clt_conn_tag&nbsp;55&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;acl&nbsp;fast_users&nbsp;note&nbsp;user&nbsp;&quot;/etc/squid3/users/nodo_users&quot;&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;nodo_users&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;fast&nbsp;users,Â &nbsp;the&nbsp;tcp_outgoing_address&nbsp;is&nbsp;used&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;like&nbsp;this&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;#fast&nbsp;link&nbsp;for&nbsp;fast&nbsp;users&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;tcp_outgoing_address&nbsp;xx.xx.xx.01&nbsp;fast_users&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;#&nbsp;default&nbsp;slow&nbsp;link&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;tcp_outgoing_address&nbsp;xx.xx.xx.02&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;Traffic&nbsp;of&nbsp;fast&nbsp;users&nbsp;is&nbsp;intermitent&nbsp;between&nbsp;the&nbsp;two&nbsp;links&nbsp;and&nbsp;much&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;more&nbsp;using&nbsp;the&nbsp;slow&nbsp;link&nbsp;than&nbsp;the&nbsp;fast&nbsp;link&nbsp;(opposite&nbsp;than&nbsp;expected).&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;External&nbsp;ACL&nbsp;TTL&nbsp;is&nbsp;3&nbsp;sec,&nbsp;so&nbsp;I&nbsp;asume&nbsp;that&nbsp;the&nbsp;correct&nbsp;balancing&nbsp;is&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;made&nbsp;only&nbsp;when&nbsp;squid&nbsp;checks&nbsp;de&nbsp;acl&nbsp;and&nbsp;mark&nbsp;the&nbsp;request,&nbsp;but&nbsp;this&nbsp;mark&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;isnt&nbsp;persistent.&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;Please,&nbsp;any&nbsp;help&nbsp;with&nbsp;this&nbsp;will&nbsp;be&nbsp;appreciated.&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;br&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;Thanks&lt;/span&gt;&lt;div&nbsp;class=&quot;&quot;&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;&lt;div&nbsp;id=&quot;:2yn&quot;&nbsp;class=&quot;&quot;&nbsp;tabindex=&quot;0&quot;&gt;&lt;img&nbsp;class=&quot;&quot;&nbsp;src=&quot;https://ssl.gstatic.com/ui/v1/icons/mail/images/cleardot.gif&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
