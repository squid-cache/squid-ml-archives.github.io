<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;I&nbsp;think,&nbsp;in&nbsp;the&nbsp;sslbump&nbsp;mode,&nbsp;if&nbsp;PROXY&nbsp;protocol&nbsp;is&nbsp;enabled,&nbsp;client&nbsp;cannot&nbsp;set&nbsp;up&nbsp;the&nbsp;SSL&nbsp;tunnel&nbsp;with&nbsp;squid&nbsp;after&nbsp;CONNECT&nbsp;call&nbsp;succeeds.&nbsp;I&nbsp;remember&nbsp;that&nbsp;HAProxy&nbsp;will&nbsp;send&nbsp;PROXY&nbsp;protocol&nbsp;line&nbsp;during&nbsp;ssl&nbsp;negotiation.&nbsp;If&nbsp;squid&nbsp;does&nbsp;not&nbsp;parse&nbsp;the&nbsp;PROXY&nbsp;protocol&nbsp;header&nbsp;during&nbsp;SSL&nbsp;negotiation,&nbsp;this&nbsp;will&nbsp;cause&nbsp;the&nbsp;problem.&lt;br&gt;&lt;br&gt;&lt;/div&gt;Alex&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Mon,&nbsp;Apr&nbsp;13,&nbsp;2015&nbsp;at&nbsp;7:56&nbsp;PM,&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&nbsp;target=&quot;_blank&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;On&nbsp;14/04/2015&nbsp;4:47&nbsp;a.m.,&nbsp;Yuhua&nbsp;Wu&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;For&nbsp;example,&nbsp;is&nbsp;this&nbsp;configuration&nbsp;supported?&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;http_port&nbsp;3129&nbsp;require-proxy-header&nbsp;ssl-bump&nbsp;……&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;By&nbsp;the&nbsp;way,&nbsp;we&nbsp;added&nbsp;acl&nbsp;rules:&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;frontend&nbsp;src&nbsp;&lt;a&nbsp;href=&quot;http://10.0.0.0/8&quot;&nbsp;target=&quot;_blank&quot;&gt;10.0.0.0/8&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;proxy_protocol_access&nbsp;allow&nbsp;frontend&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Alex&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;Yes&nbsp;that&nbsp;should&nbsp;work.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;&lt;a&nbsp;href=&quot;http://www.squid-cache.org/Versions/v3/3.5/RELEASENOTES.html#ss2.7&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.squid-cache.org/Versions/v3/3.5/RELEASENOTES.html#ss2.7&lt;/a&gt;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
Your&nbsp;above&nbsp;config&nbsp;example&nbsp;decrypts&nbsp;the&nbsp;traffic&nbsp;through&nbsp;the&nbsp;following&nbsp;layers:&lt;br&gt;<br>
 &nbsp;HTTPS&nbsp;over&nbsp;HTTP/1.x&nbsp;over&nbsp;PROXY/TCP&nbsp;...&lt;br&gt;<br>
&lt;br&gt;<br>
As&nbsp;you&nbsp;can&nbsp;see&nbsp;the&nbsp;PROXY&nbsp;and&nbsp;HTTPS&nbsp;layers&nbsp;are&nbsp;separate&nbsp;protocols&nbsp;that&lt;br&gt;<br>
dont&nbsp;interact.&lt;br&gt;<br>
&lt;br&gt;<br>
Amos&lt;br&gt;<br>
&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
