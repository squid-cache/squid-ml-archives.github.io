<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;Hi&nbsp;Amos,&lt;br&gt;&lt;br&gt;&lt;/div&gt;regrets,&nbsp;I&nbsp;am&nbsp;late.&nbsp;&lt;br&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;21&nbsp;April&nbsp;2015&nbsp;at&nbsp;09:15,&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&nbsp;target=&quot;_blank&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;On&nbsp;20/04/2015&nbsp;7:31&nbsp;p.m.,&nbsp;Jagannath&nbsp;Naidu&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;Hi,&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;am&nbsp;having&nbsp;this&nbsp;issue&nbsp;very&nbsp;frequently.&nbsp;Please&nbsp;help&nbsp;on&nbsp;this.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;get&nbsp;these&nbsp;errors&nbsp;randomly,&nbsp;mostly&nbsp;when&nbsp;usage&nbsp;is&nbsp;at&nbsp;very&nbsp;peak.&nbsp;(800&nbsp;users)&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;/var/log/squid/cache.log&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;2015/04/20&nbsp;12:37:40|&nbsp;externalAclLookup:&nbsp;&#39;wbinfo_group_helper&#39;&nbsp;queue&lt;br&gt;<br>
&gt;&nbsp;overload&nbsp;(ch=0x7fc99e2ce518)&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;What&nbsp;do&nbsp;you&nbsp;think&nbsp;&quot;overload&quot;&nbsp;means?&lt;br&gt;<br>
 The&nbsp;helper&nbsp;is&nbsp;unable&nbsp;to&nbsp;cope&nbsp;with&nbsp;the&nbsp;traffic&nbsp;load&nbsp;being&nbsp;passed&nbsp;to&nbsp;it.&lt;br&gt;<br>
&lt;br&gt;<br>
Here&nbsp;is&nbsp;the&nbsp;biggest&nbsp;hint:&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;&quot;&gt;&gt;&lt;br&gt;<br>
&gt;&nbsp;in&nbsp;/var/log/messages, &nbsp;I&nbsp;get&nbsp;the&nbsp;following&nbsp;errors&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;pr&nbsp;20&nbsp;12:59:15&nbsp;GGNPROXY01&nbsp;winbindd[1910]: &nbsp; winbindd:&nbsp;Exceeding&nbsp;200&nbsp;client&lt;br&gt;<br>
&gt;&nbsp;connections,&nbsp;no&nbsp;idle&nbsp;connection&nbsp;found&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&gt;&nbsp;Then&nbsp;squid&nbsp;stops&nbsp;working.&nbsp;For&nbsp;squid&nbsp;to&nbsp;start&nbsp;work&nbsp;again,&nbsp;I&nbsp;have&nbsp;to&nbsp;dlete&lt;br&gt;<br>
&gt;&nbsp;the&nbsp;cache&nbsp;and&nbsp;restart&nbsp;the&nbsp;squid&nbsp;&quot;squid&nbsp;-k&nbsp;reconfigure&quot;,&nbsp;and&nbsp;then&nbsp;squid&lt;br&gt;<br>
&gt;&nbsp;restart.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;What&nbsp;Squid&nbsp;version&nbsp;are&nbsp;you&nbsp;using?&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;div&gt;my&nbsp;squid&nbsp;version &nbsp;squid-3.1.10-19.el6_4.x86_64&lt;br&gt;&lt;br&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;squid.conf&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;max_filedesc&nbsp;17192&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;manager&nbsp;proto&nbsp;cache_object&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;localhost&nbsp;src&nbsp;&lt;a&nbsp;href=&quot;http://172.16.50.61/24&quot;&nbsp;target=&quot;_blank&quot;&gt;172.16.50.61/24&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;div&gt;changed&nbsp;to&nbsp;&quot;acl&nbsp;localhost&nbsp;src&nbsp;&lt;span&nbsp;class=&quot;&quot;&gt;172.16.50.6&lt;u&gt;1&lt;/u&gt;&quot;&nbsp;&lt;/span&gt;already&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;<br>
&lt;/span&gt;You&nbsp;have&nbsp;an&nbsp;entire&nbsp;/24&nbsp;(256&nbsp;IPs)&nbsp;assigned&nbsp;to&nbsp;this&nbsp;machine?&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;think&nbsp;you&nbsp;need&nbsp;to&nbsp;remove&nbsp;that&nbsp;&quot;/24&quot;&nbsp;part&nbsp;if&nbsp;the&nbsp;*.61&nbsp;is&nbsp;the&nbsp;local&lt;br&gt;<br>
machines&nbsp;*public*&nbsp;IP.&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;allow&nbsp;manager&nbsp;localhost&lt;br&gt;<br>
&gt;&nbsp;dns_nameservers&nbsp;172.16.3.34&nbsp;10.1.2.91&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;allowips&nbsp;src&nbsp;172.16.58.187&nbsp;172.16.16.192&nbsp;172.16.58.113&nbsp;172.16.58.63&lt;br&gt;<br>
&gt;&nbsp;172.16.58.98&nbsp;172.16.60.244&nbsp;172.16.58.165&nbsp;172.16.58.157&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;allow&nbsp;allowips&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;auth_param&nbsp;basic&nbsp;realm&nbsp;Squid&nbsp;proxy-caching&nbsp;web&nbsp;server&lt;br&gt;<br>
&gt;&nbsp;auth_param&nbsp;basic&nbsp;credentialsttl&nbsp;2&nbsp;hours&nbsp;external_acl_type&nbsp;nt_group&nbsp;ttl=0&lt;br&gt;<br>
&gt;&nbsp;children=60&nbsp;%LOGIN&nbsp;/usr/lib64/squid/&lt;a&nbsp;href=&quot;http://wbinfo_group.pl&quot;&nbsp;target=&quot;_blank&quot;&gt;wbinfo_group.pl&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;The&nbsp;above&nbsp;two&nbsp;very&nbsp;mangled&nbsp;config&nbsp;lines&nbsp;are&nbsp;useless.&nbsp;Remove&nbsp;them.&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;localnet&nbsp;src&nbsp;&lt;a&nbsp;href=&quot;http://172.16.0.0/24&quot;&nbsp;target=&quot;_blank&quot;&gt;172.16.0.0/24&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;changed&nbsp;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
Its&nbsp;a&nbsp;bit&nbsp;strange&nbsp;that&nbsp;none&nbsp;of&nbsp;the&nbsp;localhost&nbsp;machine&nbsp;IPs&lt;br&gt;<br>
(172.16.50.0-172.16.50.255)&nbsp;are&nbsp;part&nbsp;of&nbsp;the&nbsp;LAN&nbsp;its&nbsp;plugged&nbsp;into&lt;br&gt;<br>
172.16.0.0-172.16.0.255.&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;localnet&nbsp;src&nbsp;fc00::/7&nbsp;#&nbsp;RFC&nbsp;4193&nbsp;local&nbsp;private&nbsp;network&nbsp;range&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;localnet&nbsp;src&nbsp;fe80::/10&nbsp;#&nbsp;RFC&nbsp;4291&nbsp;link-local&nbsp;(directly&nbsp;plugged)&nbsp;machines&lt;br&gt;<br>
&gt;&nbsp;auth_param&nbsp;ntlm&nbsp;program&nbsp;/usr/bin/ntlm_auth&nbsp;--diagnostics&lt;br&gt;<br>
&gt;&nbsp;--helper-protocol=squid-2.5-ntlmssp&nbsp;--domain=&lt;a&nbsp;href=&quot;http://HTMEDIA.NET&quot;&nbsp;target=&quot;_blank&quot;&gt;HTMEDIA.NET&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;Okay&nbsp;you&nbsp;have&nbsp;configured&nbsp;NTLM...&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;&quot;&gt;&lt;br&gt;<br>
&gt;&nbsp;auth_param&nbsp;ntlm&nbsp;program&nbsp;/usr/bin/ntlm_auth&lt;br&gt;<br>
&gt;&nbsp;--helper-protocol=squid-2.5-ntlmssp&nbsp;--domain=&lt;a&nbsp;href=&quot;http://HTMEDIA.NET&quot;&nbsp;target=&quot;_blank&quot;&gt;HTMEDIA.NET&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;...&nbsp;but&nbsp;twice.&nbsp;With&nbsp;different&nbsp;settings.&nbsp;Only&nbsp;these&nbsp;last&nbsp;ones&nbsp;will&nbsp;have&lt;br&gt;<br>
any&nbsp;effect.&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;auth_param&nbsp;ntlm&nbsp;children&nbsp;600&lt;br&gt;<br>
&gt;&nbsp;auth_param&nbsp;ntlm&nbsp;keep_alive&nbsp;off&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;auth_param&nbsp;negotiate&nbsp;children&nbsp;150&lt;br&gt;<br>
&gt;&nbsp;auth_param&nbsp;negotiate&nbsp;keep_alive&nbsp;off&lt;br&gt;<br>
&gt;&nbsp;visible_hostname&nbsp;&lt;a&nbsp;href=&quot;http://GGNPROXY01.HTMEDIA.NET&quot;&nbsp;target=&quot;_blank&quot;&gt;GGNPROXY01.HTMEDIA.NET&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;external_acl_type&nbsp;wbinfo_group_helper&nbsp;ttl=0&nbsp;children=40&nbsp;%LOGIN&lt;br&gt;<br>
&gt;&nbsp;/usr/lib64/squid/&lt;a&nbsp;href=&quot;http://wbinfo_group.pl&quot;&nbsp;target=&quot;_blank&quot;&gt;wbinfo_group.pl&lt;/a&gt;&nbsp;-d&lt;br&gt;<br>
&gt;&nbsp;auth_param&nbsp;negotiate&nbsp;keep_alive&nbsp;off&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;You&nbsp;have&nbsp;several&nbsp;useless&nbsp;configuration&nbsp;lines&nbsp;for&nbsp;Negotiate&nbsp;auth&nbsp;which&nbsp;is&lt;br&gt;<br>
not&nbsp;being&nbsp;used&nbsp;in&nbsp;any&nbsp;way.&nbsp;Remove&nbsp;those.&lt;br&gt;<br>
&lt;div&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;8080&nbsp;#https&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;SSL_ports&nbsp;port&nbsp;443&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;80 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;http&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;21 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;ftp&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;443&nbsp;#&nbsp;https&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;70 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;gopher&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;210 &nbsp; &nbsp; &nbsp; &nbsp; #&nbsp;wais&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;1025-65535 &nbsp;#&nbsp;unregistered&nbsp;ports&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;280 &nbsp; &nbsp; &nbsp; &nbsp; #&nbsp;http-mgmt&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;488 &nbsp; &nbsp; &nbsp; &nbsp; #&nbsp;gss-http&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;591 &nbsp; &nbsp; &nbsp; &nbsp; #&nbsp;filemaker&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;777 &nbsp; &nbsp; &nbsp; &nbsp; #&nbsp;multiling&nbsp;http&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;CONNECT&nbsp;method&nbsp;CONNECT&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;auth&nbsp;proxy_auth&nbsp;REQUIRED&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;google&nbsp;dstdomain&nbsp;-i&nbsp;&quot;/etc/squid/&lt;a&nbsp;href=&quot;http://google_site.com&quot;&nbsp;target=&quot;_blank&quot;&gt;google_site.com&lt;/a&gt;&quot;&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;allow&nbsp;google&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;sq1&nbsp;external&nbsp;wbinfo_group_helper&nbsp;&quot;/etc/squid/HT/sq1&quot;&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;sq2&nbsp;external&nbsp;wbinfo_group_helper&nbsp;&quot;/etc/squid/HT/sq2&quot;&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;sq3&nbsp;external&nbsp;wbinfo_group_helper&nbsp;&quot;/etc/squid/HT/sq3&quot;&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;sq4&nbsp;external&nbsp;wbinfo_group_helper&nbsp;&quot;/etc/squid/HT/sq4&quot;&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;sq5&nbsp;external&nbsp;wbinfo_group_helper&nbsp;&quot;/etc/squid/HT/sq5&quot;&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;pro1&nbsp;external&nbsp;wbinfo_group_helper&nbsp;&quot;/etc/squid/HT/pro1&quot;&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;pro2&nbsp;external&nbsp;wbinfo_group_helper&nbsp;&quot;/etc/squid/HT/pro2&quot;&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;pro3&nbsp;external&nbsp;wbinfo_group_helper&nbsp;&quot;/etc/squid/HT/pro3&quot;&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;pro4&nbsp;external&nbsp;wbinfo_group_helper&nbsp;&quot;/etc/squid/HT/pro4&quot;&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;pro5&nbsp;external&nbsp;wbinfo_group_helper&nbsp;&quot;/etc/squid/HT/pro5&quot;&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;pro6&nbsp;external&nbsp;wbinfo_group_helper&nbsp;&quot;/etc/squid/HT/pro6&quot;&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;webvip&nbsp;external&nbsp;wbinfo_group_helper&nbsp;&quot;/etc/squid/HT/webvip&quot;&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;allgroup&nbsp;external&nbsp;wbinfo_group_helper&nbsp;&quot;/etc/squid/HT/allgreop&quot;&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;restricted&nbsp;external&nbsp;wbinfo_group_helper&nbsp;&quot;/etc/squid/HT/restricted&quot;&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;ad_auth&nbsp;proxy_auth&nbsp;REQUIRE&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;You&nbsp;already&nbsp;have&nbsp;an&nbsp;ACL&nbsp;named&nbsp;&quot;auth&quot;&nbsp;which&nbsp;performs&nbsp;authentication.&lt;br&gt;<br>
The&nbsp;above&nbsp;line&nbsp;is&nbsp;not&nbsp;useful.&nbsp;Remove&nbsp;it&nbsp;and&nbsp;replace&nbsp;all&nbsp;uses&nbsp;of&lt;br&gt;<br>
&quot;ad_auth&quot;&nbsp;ACL&nbsp;with&nbsp;&quot;auth&quot;&nbsp;ACL.&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;&quot;&gt;&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;allowwebsites&nbsp;dstdomain&nbsp;-i&nbsp;&quot;/blacklists/allowedwebsite/domains&quot;&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;allowwebsites_url&nbsp;url_regex&nbsp;-i&nbsp;&quot;/blacklists/allowedwebsite/url&quot;&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;allow&nbsp;allowwebsites&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;allow&nbsp;allowwebsites_url&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;shopping&nbsp;dstdomain&nbsp;-i&nbsp;&quot;/etc/squid/shopping.txt&quot;&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;social_networking&nbsp;dstdomain&nbsp;-i&nbsp;&quot;/blacklists/social/social.networking&quot;&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;youtube&nbsp;dstdomain&nbsp;-i&nbsp;.&lt;a&nbsp;href=&quot;http://youtube.com&quot;&nbsp;target=&quot;_blank&quot;&gt;youtube.com&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;allow&nbsp;Safe_ports&nbsp;pro1&nbsp;pro2&nbsp;pro3&nbsp;pro4&nbsp;pro5&nbsp;pro6&nbsp;webvip&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;Incorrect&nbsp;use&nbsp;of&nbsp;&quot;Safe_ports&quot;&nbsp;security&nbsp;check.&nbsp;Correct&nbsp;usage&nbsp;is&nbsp;to&nbsp;deny&lt;br&gt;<br>
access&nbsp;to&nbsp;all&nbsp;*unsafe*&nbsp;ports.&nbsp;They&nbsp;are&nbsp;unsafe&nbsp;because&nbsp;HTTP&nbsp;can&nbsp;be&lt;br&gt;<br>
smuggled&nbsp;within&nbsp;the&nbsp;ports&nbsp;native&nbsp;protocol&nbsp;to&nbsp;attack&nbsp;your&nbsp;proxy.&lt;br&gt;<br>
&lt;br&gt;<br>
Once&nbsp;the&nbsp;correct&nbsp;security&nbsp;protections&nbsp;for&nbsp;Safe_port&nbsp;and&nbsp;CONNECT&nbsp;tunnels&lt;br&gt;<br>
have&nbsp;been&nbsp;moved&nbsp;up&nbsp;the&nbsp;top&nbsp;remove&nbsp;the&nbsp;&quot;Safe_ports&quot;&nbsp;check&nbsp;from&nbsp;this&nbsp;line.&lt;br&gt;<br>
&lt;br&gt;<br>
This&nbsp;line&nbsp;is&nbsp;also&nbsp;very&nbsp;odd&nbsp;in&nbsp;another&nbsp;way.&nbsp;ACL&nbsp;tests&nbsp;in&nbsp;a&nbsp;single&nbsp;line&lt;br&gt;<br>
are&nbsp;AND&#39;ed&nbsp;together&nbsp;-&nbsp;so&nbsp;this&nbsp;means&nbsp;the&nbsp;request&nbsp;must&nbsp;be&nbsp;from&nbsp;a&nbsp;user&nbsp;who&nbsp;is:&lt;br&gt;<br>
 &nbsp;authenticated&nbsp;AND&nbsp;a&nbsp;member&nbsp;of&nbsp;group&nbsp;pro1&nbsp;AND&nbsp;pro2&nbsp;AND&nbsp;pro3&nbsp;AND&nbsp;pro4&lt;br&gt;<br>
AND&nbsp;pro5&nbsp;AND&nbsp;pro6&nbsp;AND&nbsp;webvip&lt;br&gt;<br>
&lt;br&gt;<br>
This&nbsp;hints&nbsp;at&nbsp;what&nbsp;your&nbsp;main&nbsp;helper&nbsp;problem&nbsp;is.&nbsp;The&nbsp;above&nbsp;line&nbsp;requires&lt;br&gt;<br>
7&nbsp;group&nbsp;helper&nbsp;lookups&nbsp;*per&nbsp;request*.&nbsp;The&nbsp;winbind&nbsp;helper&nbsp;has&nbsp;a&nbsp;maximum&lt;br&gt;<br>
of&nbsp;200&nbsp;simultaneous&nbsp;connections.&nbsp;This&nbsp;line&nbsp;alone&nbsp;will&nbsp;limit&nbsp;your&nbsp;proxy&lt;br&gt;<br>
just&nbsp;under&nbsp;30&nbsp;new&nbsp;visitors&nbsp;per&nbsp;second&nbsp;(that&nbsp;becomes&nbsp;60&nbsp;lookups/sec&lt;br&gt;<br>
before&nbsp;queue&nbsp;overload).&lt;br&gt;<br>
 The&nbsp;helper&nbsp;result&nbsp;caching&nbsp;will&nbsp;help&nbsp;a&nbsp;lot,&nbsp;but&nbsp;you&nbsp;also&nbsp;have&nbsp;a&nbsp;LOT&nbsp;of&lt;br&gt;<br>
other&nbsp;group&nbsp;checks&nbsp;being&nbsp;made&nbsp;and&nbsp;800&nbsp;users.&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;allow&nbsp;youtube&nbsp;pro5&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;allow&nbsp;youtube&nbsp;pro6&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;allow&nbsp;youtube&nbsp;webvip&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;deny&nbsp;youtube&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;allow&nbsp;shopping&nbsp;pro5&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;allow&nbsp;shopping&nbsp;pro6&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;allow&nbsp;shopping&nbsp;webvip&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;deny&nbsp;shopping&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;Optimization&nbsp;hint:&lt;br&gt;<br>
 &quot;youtube&quot;&nbsp;and&nbsp;&quot;shopping&quot;&nbsp;have&nbsp;the&nbsp;same&nbsp;allow/deny&nbsp;criteria.&nbsp;It&nbsp;would&nbsp;be&lt;br&gt;<br>
worth&nbsp;combining&nbsp;them&nbsp;into&nbsp;one&nbsp;ACL.&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;&quot;&gt;&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;allow&nbsp;social_networking&nbsp;pro2&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;allow&nbsp;social_networking&nbsp;pro4&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;allow&nbsp;social_networking&nbsp;pro6&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;allow&nbsp;social_networking&nbsp;webvip&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;deny&nbsp;social_networking&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;porn_site1 &nbsp; dstdomain&nbsp;&quot;/etc/squid/blacklists/porn/domains.txt&quot;&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;porn_site2 &nbsp; dstdom_regex&nbsp;-i&nbsp;&quot;/etc/squid/blacklists/porn/expressions&quot;&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;porn_site3 &nbsp; dstdom_regex&nbsp;-i&nbsp;&quot;/etc/squid/blacklists/porn/urls.txt&quot;&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;audio_video1 &nbsp; dstdomain&nbsp;&quot;/etc/squid/blacklists/audio-video/urls.txt&quot;&lt;br&gt;<br>
&gt;&nbsp;######################&nbsp;THERE&nbsp;ARE&nbsp;TOO&nbsp;MANY&nbsp;acls&nbsp;and&nbsp;http_access&nbsp;,&nbsp;so&nbsp;not&lt;br&gt;<br>
&gt;&nbsp;bothering&nbsp;with&nbsp;vast&nbsp;linux&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;I&nbsp;will&nbsp;bet&nbsp;a&nbsp;lot&nbsp;of&nbsp;those&nbsp;ACLs&nbsp;are&nbsp;also&nbsp;calling&nbsp;the&nbsp;group&nbsp;helper&nbsp;too&nbsp;yes?&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;&quot;&gt;&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;allow&nbsp;liquorinfo&nbsp;webvip&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;deny&nbsp;liquorinfo&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;allow&nbsp;ad_auth&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;allow&nbsp;auth&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;Once&nbsp;you&nbsp;have&nbsp;removed&nbsp;ad_auth&nbsp;ACL,&nbsp;this&nbsp;becomes:&lt;br&gt;<br>
 http_access&nbsp;allow&nbsp;auth&lt;br&gt;<br>
 http_access&nbsp;allow&nbsp;auth&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;hope&nbsp;you&nbsp;can&nbsp;see&nbsp;how&nbsp;redundant&nbsp;that&nbsp;is.&lt;br&gt;<br>
&lt;br&gt;<br>
Also,&nbsp;its&nbsp;very&nbsp;likely&nbsp;that&nbsp;the&nbsp;&quot;allow&nbsp;auth&quot;&nbsp;is&nbsp;a&nbsp;useless&nbsp;operation&nbsp;after&lt;br&gt;<br>
a&nbsp;great&nbsp;many&nbsp;group&nbsp;checks&nbsp;have&nbsp;also&nbsp;performed&nbsp;authentication.&nbsp;That&nbsp;&quot;TOO&lt;br&gt;<br>
MANY&nbsp;acls&nbsp;and&nbsp;https_access&quot;&nbsp;list&nbsp;you&nbsp;omitted&nbsp;will&nbsp;be&nbsp;needed&nbsp;to&nbsp;determine&lt;br&gt;<br>
that.&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;allow&nbsp;sq1&nbsp;sq2&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;NTLMUsers&nbsp;proxy_auth&nbsp;REQUIRED&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;You&nbsp;already&nbsp;have&nbsp;an&nbsp;ACL&nbsp;named&nbsp;&quot;auth&quot;&nbsp;which&nbsp;performs&nbsp;authentication.&lt;br&gt;<br>
The&nbsp;above&nbsp;line&nbsp;is&nbsp;not&nbsp;being&nbsp;used&nbsp;in&nbsp;any&nbsp;way.&nbsp;Remove&nbsp;it.&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;&quot;&gt;&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;deny&nbsp;!Safe_ports&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;deny&nbsp;CONNECT&nbsp;!SSL_ports&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;These&nbsp;are&nbsp;basic&nbsp;security&nbsp;protection&nbsp;against&nbsp;Denial&nbsp;of&nbsp;Service&nbsp;and&nbsp;other&lt;br&gt;<br>
types&nbsp;of&nbsp;protocol&nbsp;smuggling&nbsp;attacks.&nbsp;They&nbsp;only&nbsp;work&nbsp;when&nbsp;they&nbsp;are&nbsp;used&lt;br&gt;<br>
*above*&nbsp;your&nbsp;custom&nbsp;&quot;allow&quot;&nbsp;rules.&lt;br&gt;<br>
&lt;br&gt;<br>
Move&nbsp;these&nbsp;two&nbsp;lines&nbsp;above&nbsp;your&nbsp;&quot;http_access&nbsp;allow&nbsp;google&quot;&nbsp;line.&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;http_port&nbsp;8080&lt;br&gt;<br>
&gt;&nbsp;hierarchy_stoplist&nbsp;cgi-bin&nbsp;?&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;The&nbsp;above&nbsp;line&nbsp;is&nbsp;not&nbsp;useful&nbsp;these&nbsp;days.&nbsp;Remove&nbsp;it.&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;&quot;&gt;&lt;br&gt;<br>
&gt;&nbsp;cache_effective_user&nbsp;squid&lt;br&gt;<br>
&gt;&nbsp;cache_dir&nbsp;aufs&nbsp;/var/spool/squid&nbsp;20384&nbsp;32&nbsp;512&lt;br&gt;<br>
&gt;&nbsp;cache_mem&nbsp;50&nbsp;MB&lt;br&gt;<br>
&gt;&nbsp;cache_replacement_policy&nbsp;heap&nbsp;LFUDA&lt;br&gt;<br>
&gt;&nbsp;cache_swap_low&nbsp;85&lt;br&gt;<br>
&gt;&nbsp;cache_swap_high&nbsp;95&lt;br&gt;<br>
&gt;&nbsp;maximum_object_size&nbsp;5&nbsp;MB&lt;br&gt;<br>
&gt;&nbsp;maximum_object_size_in_memory&nbsp;50&nbsp;KB&lt;br&gt;<br>
&gt;&nbsp;ipcache_size&nbsp;5240&lt;br&gt;<br>
&gt;&nbsp;ipcache_low&nbsp;90&lt;br&gt;<br>
&gt;&nbsp;ipcache_high&nbsp;95&lt;br&gt;<br>
&gt;&nbsp;cache_mgr&nbsp;amit&lt;/span&gt;&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;SSL_ports&nbsp;port&nbsp;443&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;above&nbsp;is&nbsp;a&nbsp;duplicate&nbsp;config&nbsp;line.&nbsp;Remove&nbsp;it.&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;&quot;&gt;&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;allow&nbsp;CONNECT&nbsp;SSL_ports&lt;br&gt;<br>
&gt;&nbsp;coredump_dir&nbsp;/var/spool/squid&lt;br&gt;<br>
&gt;&nbsp;refresh_pattern&nbsp;^ftp: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1440 &nbsp; &nbsp;20% &nbsp; &nbsp; 10080&lt;br&gt;<br>
&gt;&nbsp;refresh_pattern&nbsp;^gopher: &nbsp; &nbsp; &nbsp; &nbsp;1440 &nbsp; &nbsp;0% &nbsp; &nbsp; &nbsp;1440&lt;br&gt;<br>
&gt;&nbsp;refresh_pattern&nbsp;-i&nbsp;(/cgi-bin/|\?)&nbsp;0 &nbsp; &nbsp; 0% &nbsp; &nbsp; &nbsp;0&lt;br&gt;<br>
&gt;&nbsp;refresh_pattern&nbsp;. &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; &nbsp; 20% &nbsp; &nbsp; 4320&lt;br&gt;<br>
&gt;&nbsp;url_rewrite_program&nbsp;/usr/local/bin/squidGuard&nbsp;-c&lt;br&gt;<br>
&gt;&nbsp;/usr/local/squidGuard/squidGuard.conf&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;Now,&nbsp;as&nbsp;to&nbsp;solving&nbsp;your&nbsp;problem:&lt;br&gt;<br>
&lt;br&gt;<br>
1)&nbsp;Clean&nbsp;up&nbsp;your&nbsp;config.&nbsp;Reduce&nbsp;the&nbsp;amount&nbsp;of&nbsp;redundant&nbsp;or&nbsp;unused&lt;br&gt;<br>
things.&nbsp;I&#39;ve&nbsp;mentioned&nbsp;a&nbsp;few&nbsp;above.&lt;br&gt;<br>
&lt;br&gt;<br>
2)&nbsp;Run&nbsp;&quot;squid&nbsp;-k&nbsp;parse&quot;&nbsp;and&nbsp;fix&nbsp;any&nbsp;other&nbsp;problems&nbsp;it&nbsp;highlights.&lt;br&gt;<br>
&lt;br&gt;<br>
3)&nbsp;optimize&nbsp;your&nbsp;ACls&nbsp;and&nbsp;http_access&nbsp;rules.&nbsp;I&#39;ve&nbsp;mentioned&nbsp;a&nbsp;few,&nbsp;such&lt;br&gt;<br>
as&nbsp;moving&nbsp;the&nbsp;main&nbsp;security&nbsp;checks&nbsp;to&nbsp;the&nbsp;top&nbsp;so&nbsp;DoS&nbsp;traffic&nbsp;does&nbsp;not&lt;br&gt;<br>
put&nbsp;load&nbsp;on&nbsp;the&nbsp;helpers&nbsp;and&nbsp;other&nbsp;ACLs.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;believe&nbsp;though&nbsp;that&nbsp;you&nbsp;will&nbsp;probably&nbsp;find&nbsp;Squid&nbsp;works&nbsp;much&nbsp;better&lt;br&gt;<br>
having&nbsp;the&nbsp;following&nbsp;access&nbsp;controls&nbsp;pattern:&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;&quot;&gt;&quot;&lt;br&gt;<br>
 http_access&nbsp;deny&nbsp;!Safe_ports&lt;br&gt;<br>
 http_access&nbsp;deny&nbsp;CONNECT&nbsp;!SSL_ports&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt; #&nbsp;if&nbsp;they&nbsp;are&nbsp;not&nbsp;authenticated,&nbsp;they&nbsp;will&nbsp;not&nbsp;be&nbsp;in&nbsp;a&nbsp;group&lt;br&gt;<br>
 http_access&nbsp;deny&nbsp;!auth&lt;br&gt;<br>
&lt;br&gt;<br>
 #&nbsp;assuming&nbsp;that&nbsp;webvip&nbsp;are&nbsp;the&nbsp;group&nbsp;with&nbsp;full&nbsp;access?&lt;br&gt;<br>
 http_access&nbsp;allow&nbsp;webvip&lt;br&gt;<br>
&lt;br&gt;<br>
 #&nbsp;your&nbsp;long&nbsp;list&nbsp;of&nbsp;per-site&nbsp;group&nbsp;check&nbsp;ACLs&nbsp;go&nbsp;here&lt;br&gt;<br>
 ...&lt;br&gt;<br>
&lt;br&gt;<br>
 #&nbsp;this&nbsp;is&nbsp;where&nbsp;defining&nbsp;the&nbsp;LAN&nbsp;ranges&nbsp;correctly&nbsp;comes&nbsp;in.&lt;br&gt;<br>
 #&nbsp;note&nbsp;that&nbsp;users&nbsp;have&nbsp;authenticated&nbsp;simply&nbsp;to&nbsp;get&nbsp;near&nbsp;here&lt;br&gt;<br>
 http_access&nbsp;allow&nbsp;localnet&lt;br&gt;<br>
 http_access&nbsp;deny&nbsp;all&lt;br&gt;<br>
&quot;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
4)&nbsp;consider&nbsp;an&nbsp;upgrade&nbsp;to&nbsp;Squid&nbsp;3.4+.&nbsp;The&nbsp;&quot;notes&quot;&nbsp;ACL&nbsp;type&nbsp;offers&nbsp;much&lt;br&gt;<br>
more&nbsp;efficient&nbsp;ACL&nbsp;testing&nbsp;with&nbsp;a&nbsp;custom&nbsp;group&nbsp;lookup&nbsp;helper.&nbsp;The&nbsp;all-of&lt;br&gt;<br>
and&nbsp;any-of&nbsp;ACL&nbsp;types&nbsp;can&nbsp;also&nbsp;much&nbsp;reduce&nbsp;your&nbsp;http_access&nbsp;lines.&lt;br&gt;<br>
&lt;br&gt;<br>
HTH&lt;br&gt;<br>
Amos&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;Thank&nbsp;you&nbsp;Amos,&nbsp;I&nbsp;will&nbsp;check&nbsp;and&nbsp;will&nbsp;update&nbsp;the&nbsp;list.&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;br&gt;--&nbsp;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_signature&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Thanks&nbsp;&amp;&nbsp;Regards&lt;br&gt;&lt;br&gt;&lt;span&gt;B&nbsp;Jagannath&lt;/span&gt;&lt;br&gt;&lt;div&gt;Keen&nbsp;&amp;&nbsp;Able&nbsp;Computers&nbsp;Pvt.&nbsp;Ltd.&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
