<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.0&nbsp;TRANSITIONAL//EN&quot;&gt;<br>
&lt;HTML&gt;<br>
&lt;HEAD&gt;<br>
&nbsp;&nbsp;&lt;META&nbsp;HTTP-EQUIV=&quot;Content-Type&quot;&nbsp;CONTENT=&quot;text/html;&nbsp;CHARSET=UTF-8&quot;&gt;<br>
&nbsp;&nbsp;&lt;META&nbsp;NAME=&quot;GENERATOR&quot;&nbsp;CONTENT=&quot;GtkHTML/4.6.6&quot;&gt;<br>
&lt;/HEAD&gt;<br>
&lt;BODY&gt;<br>
Hey&nbsp;all.&lt;BR&gt;<br>
&lt;BR&gt;<br>
Topic&nbsp;says&nbsp;it....I'm&nbsp;running&nbsp;squid-3.5.3-20150420-r13802&nbsp;and&nbsp;wanted&nbsp;to&nbsp;see&nbsp;if&nbsp;there's&nbsp;anything&nbsp;glaring&nbsp;that&nbsp;I'm&nbsp;missing/have&nbsp;misconfigured.&nbsp;&nbsp;My&nbsp;setup&nbsp;is&nbsp;squid&nbsp;is&nbsp;running&nbsp;on&nbsp;a&nbsp;router,&nbsp;one&nbsp;nic&nbsp;external,&nbsp;one&nbsp;nic&nbsp;internal.&nbsp;&nbsp;This&nbsp;is&nbsp;running&nbsp;as&nbsp;a&nbsp;transparent&nbsp;proxy&nbsp;with&nbsp;iptables&nbsp;doing&nbsp;a&nbsp;redirect&nbsp;to&nbsp;ports&nbsp;3128&nbsp;and&nbsp;3129.&nbsp;&nbsp;Config&nbsp;below:&lt;BR&gt;<br>
&lt;BR&gt;<br>
#############################################################&lt;BR&gt;<br>
acl&nbsp;localnet&nbsp;src&nbsp;192.168.1.0/24&lt;BR&gt;<br>
&lt;BR&gt;<br>
acl&nbsp;SSL_ports&nbsp;port&nbsp;443&lt;BR&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;80&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;http&lt;BR&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;443&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;https&lt;BR&gt;<br>
&lt;BR&gt;<br>
acl&nbsp;CONNECT&nbsp;method&nbsp;CONNECT&lt;BR&gt;<br>
acl&nbsp;broken_sites&nbsp;dst&nbsp;96.16.0.0/15&lt;BR&gt;<br>
&lt;others&nbsp;redacted&gt;&lt;BR&gt;<br>
acl&nbsp;broken_sites&nbsp;dst&nbsp;54.160.0.0/12&lt;BR&gt;<br>
acl&nbsp;allowed_sites&nbsp;url_regex&nbsp;&quot;/opt/etc/squid/url.txt&quot;&lt;BR&gt;<br>
acl&nbsp;all_others&nbsp;dst&nbsp;all&lt;BR&gt;<br>
acl&nbsp;SSL&nbsp;method&nbsp;CONNECT&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;BR&gt;<br>
http_access&nbsp;deny&nbsp;!Safe_ports&lt;BR&gt;<br>
http_access&nbsp;deny&nbsp;CONNECT&nbsp;!SSL_ports&lt;BR&gt;<br>
&lt;BR&gt;<br>
http_access&nbsp;allow&nbsp;manager&nbsp;localhost&lt;BR&gt;<br>
http_access&nbsp;deny&nbsp;manager&lt;BR&gt;<br>
&lt;BR&gt;<br>
http_access&nbsp;allow&nbsp;allowed_sites&lt;BR&gt;<br>
http_access&nbsp;allow&nbsp;broken_sites&lt;BR&gt;<br>
&lt;BR&gt;<br>
http_access&nbsp;deny&nbsp;all_others&nbsp;&lt;BR&gt;<br>
http_access&nbsp;allow&nbsp;localnet&lt;BR&gt;<br>
http_access&nbsp;allow&nbsp;localhost&lt;BR&gt;<br>
&lt;BR&gt;<br>
http_access&nbsp;deny&nbsp;all&lt;BR&gt;<br>
icp_access&nbsp;deny&nbsp;all&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;BR&gt;<br>
sslproxy_cert_error&nbsp;allow&nbsp;broken_sites&lt;BR&gt;<br>
sslproxy_cert_error&nbsp;deny&nbsp;all&lt;BR&gt;<br>
&lt;BR&gt;<br>
sslproxy_options&nbsp;ALL&lt;BR&gt;<br>
acl&nbsp;p3129&nbsp;myportname&nbsp;3129&lt;BR&gt;<br>
acl&nbsp;step1&nbsp;at_step&nbsp;SslBump1&lt;BR&gt;<br>
ssl_bump&nbsp;peek&nbsp;step1&lt;BR&gt;<br>
#ssl_bump&nbsp;splice&nbsp;broken_sites&lt;BR&gt;<br>
ssl_bump&nbsp;bump&nbsp;p3129&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;BR&gt;<br>
http_port&nbsp;192.168.1.253:3128&nbsp;intercept&nbsp;&lt;BR&gt;<br>
https_port&nbsp;192.168.1.253:3129&nbsp;intercept&nbsp;ssl-bump&nbsp;cert=/opt/sslsplit/sslsplit.crt&nbsp;key=/opt/sslsplit/sslsplitca.key&nbsp;cafile=/opt/sslsplit/sslsplitca.pem&nbsp;generate-host-certificates=on&nbsp;dynamic_cert_mem_cache_size=4MB&nbsp;sslflags=NO_SESSION_REUSE&lt;BR&gt;<br>
&lt;BR&gt;<br>
always_direct&nbsp;allow&nbsp;all&lt;BR&gt;<br>
&lt;BR&gt;<br>
logformat&nbsp;common&nbsp;%&gt;a&nbsp;%[ui&nbsp;%[un&nbsp;[%tl]&nbsp;&quot;%rm&nbsp;%ru&nbsp;HTTP/%rv&quot;&nbsp;%&gt;Hs&nbsp;%&lt;st&nbsp;%Ss:%Sh&nbsp;%ssl::&gt;cert_subject&lt;BR&gt;<br>
&lt;BR&gt;<br>
access_log&nbsp;syslog:daemon.info&nbsp;common&lt;BR&gt;<br>
&lt;BR&gt;<br>
refresh_pattern&nbsp;^ftp:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1440&nbsp;&nbsp;&nbsp;&nbsp;20%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10080&lt;BR&gt;<br>
refresh_pattern&nbsp;^gopher:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1440&nbsp;&nbsp;&nbsp;&nbsp;0%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1440&lt;BR&gt;<br>
refresh_pattern&nbsp;-i&nbsp;(cgi-bin|\?)&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&lt;BR&gt;<br>
refresh_pattern&nbsp;.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;20%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4320&lt;BR&gt;<br>
&lt;BR&gt;<br>
icp_port&nbsp;3130&lt;BR&gt;<br>
&lt;BR&gt;<br>
coredump_dir&nbsp;/opt/var&lt;BR&gt;<br>
#############################################################&lt;BR&gt;<br>
&lt;BR&gt;<br>
My&nbsp;goal&nbsp;has&nbsp;been&nbsp;to&nbsp;at&nbsp;least&nbsp;get&nbsp;the&nbsp;domain&nbsp;logged&nbsp;on&nbsp;any&nbsp;https&nbsp;access,&nbsp;but&nbsp;alas&nbsp;some&nbsp;sites&nbsp;show:&lt;BR&gt;<br>
&lt;BR&gt;<br>
Apr&nbsp;24&nbsp;06:39:32&nbsp;gateway&nbsp;(squid-1):&nbsp;192.168.1.101&nbsp;-&nbsp;-&nbsp;[24/Apr/2015:06:39:32&nbsp;-0600]&nbsp;&quot;CONNECT&nbsp;216.58.216.162:443&nbsp;HTTP/1.1&quot;&nbsp;200&nbsp;401&nbsp;TCP_TUNNEL:ORIGINAL_DST&nbsp;-&lt;BR&gt;<br>
&lt;BR&gt;<br>
Thanks&nbsp;for&nbsp;the&nbsp;look&nbsp;see...trying&nbsp;to&nbsp;keep&nbsp;current.&lt;BR&gt;<br>
&lt;BR&gt;<br>
James<br>
&lt;/BODY&gt;<br>
&lt;/HTML&gt;<br>

</tt>
