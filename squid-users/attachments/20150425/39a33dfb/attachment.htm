<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.0&nbsp;TRANSITIONAL//EN&quot;&gt;<br>
&lt;HTML&gt;<br>
&lt;HEAD&gt;<br>
&nbsp;&nbsp;&lt;META&nbsp;HTTP-EQUIV=&quot;Content-Type&quot;&nbsp;CONTENT=&quot;text/html;&nbsp;CHARSET=UTF-8&quot;&gt;<br>
&nbsp;&nbsp;&lt;META&nbsp;NAME=&quot;GENERATOR&quot;&nbsp;CONTENT=&quot;GtkHTML/4.6.6&quot;&gt;<br>
&lt;/HEAD&gt;<br>
&lt;BODY&gt;<br>
On&nbsp;Sat,&nbsp;2015-04-25&nbsp;at&nbsp;14:25&nbsp;+1200,&nbsp;Amos&nbsp;Jeffries&nbsp;wrote:<br>
&lt;BLOCKQUOTE&nbsp;TYPE=CITE&gt;<br>
&lt;PRE&gt;<br>
On&nbsp;25/04/2015&nbsp;12:50&nbsp;a.m.,&nbsp;James&nbsp;Lay&nbsp;wrote:<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;Hey&nbsp;all.&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;Topic&nbsp;says&nbsp;it....I'm&nbsp;running&nbsp;squid-3.5.3-20150420-r13802&nbsp;and&nbsp;wanted&nbsp;to&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;see&nbsp;if&nbsp;there's&nbsp;anything&nbsp;glaring&nbsp;that&nbsp;I'm&nbsp;missing/have&nbsp;misconfigured.&nbsp;&nbsp;My&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;setup&nbsp;is&nbsp;squid&nbsp;is&nbsp;running&nbsp;on&nbsp;a&nbsp;router,&nbsp;one&nbsp;nic&nbsp;external,&nbsp;one&nbsp;nic&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;internal.&nbsp;&nbsp;This&nbsp;is&nbsp;running&nbsp;as&nbsp;a&nbsp;transparent&nbsp;proxy&nbsp;with&nbsp;iptables&nbsp;doing&nbsp;a&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;redirect&nbsp;to&nbsp;ports&nbsp;3128&nbsp;and&nbsp;3129.&nbsp;&nbsp;Config&nbsp;below:&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;#############################################################&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;acl&nbsp;localnet&nbsp;src&nbsp;192.168.1.0/24&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;acl&nbsp;SSL_ports&nbsp;port&nbsp;443&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;80&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;http&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;443&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;https&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;acl&nbsp;CONNECT&nbsp;method&nbsp;CONNECT&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;acl&nbsp;broken_sites&nbsp;dst&nbsp;96.16.0.0/15&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;others&nbsp;redacted&gt;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;acl&nbsp;broken_sites&nbsp;dst&nbsp;54.160.0.0/12&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;acl&nbsp;allowed_sites&nbsp;url_regex&nbsp;&quot;/opt/etc/squid/url.txt&quot;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;acl&nbsp;all_others&nbsp;dst&nbsp;all&lt;/FONT&gt;<br>
<br>
Using&nbsp;&quot;dst&nbsp;all&quot;&nbsp;is&nbsp;very&nbsp;inefficient.&nbsp;It&nbsp;requires&nbsp;Squid&nbsp;to&nbsp;perform&nbsp;DNS<br>
lookups&nbsp;just&nbsp;to&nbsp;answer&nbsp;&quot;yes&quot;.&nbsp;Unless&nbsp;there&nbsp;is&nbsp;some&nbsp;unusual&nbsp;reason<br>
requiring&nbsp;that&nbsp;you&nbsp;might&nbsp;as&nbsp;well&nbsp;use&nbsp;the&nbsp;provided&nbsp;&quot;all&quot;&nbsp;ACL&nbsp;for&nbsp;faster<br>
operation.<br>
<br>
<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;acl&nbsp;SSL&nbsp;method&nbsp;CONNECT&lt;/FONT&gt;<br>
<br>
This&nbsp;is&nbsp;a&nbsp;bit&nbsp;dangerous.&nbsp;CONNECT&nbsp;does&nbsp;not&nbsp;necessarily&nbsp;mean&nbsp;SSL&nbsp;-&nbsp;even<br>
with&nbsp;the&nbsp;port&nbsp;443&nbsp;restriction.&nbsp;&nbsp;CONNECT&nbsp;could&nbsp;as&nbsp;easily&nbsp;contain&nbsp;a&nbsp;tunnel<br>
to&nbsp;email&nbsp;server&nbsp;and&nbsp;be&nbsp;pumping&nbsp;spam,&nbsp;or&nbsp;literally&nbsp;any&nbsp;other&nbsp;type&nbsp;of<br>
traffic&nbsp;to&nbsp;any&nbsp;other&nbsp;server.&nbsp;Spam&nbsp;emails,&nbsp;FTP,&nbsp;BitTorrent,&nbsp;and&nbsp;Skype&nbsp;are<br>
pretty&nbsp;popular&nbsp;protocols&nbsp;seen&nbsp;with&nbsp;CONNECT.<br>
<br>
So&nbsp;you&nbsp;can&nbsp;easily&nbsp;mistake&nbsp;security&nbsp;rules&nbsp;about&nbsp;SSL&nbsp;and&nbsp;create&nbsp;allow<br>
policies&nbsp;that&nbsp;make&nbsp;you&nbsp;vulnerable&nbsp;to&nbsp;some&nbsp;nasty&nbsp;attacks.<br>
<br>
Its&nbsp;also&nbsp;a&nbsp;redundant&nbsp;ACL&nbsp;definition&nbsp;with&nbsp;the&nbsp;default&nbsp;CONNECT&nbsp;ACL&nbsp;earlier.<br>
<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;http_access&nbsp;deny&nbsp;!Safe_ports&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;http_access&nbsp;deny&nbsp;CONNECT&nbsp;!SSL_ports&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;http_access&nbsp;allow&nbsp;manager&nbsp;localhost&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;http_access&nbsp;deny&nbsp;manager&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;http_access&nbsp;allow&nbsp;allowed_sites&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;http_access&nbsp;allow&nbsp;broken_sites&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;http_access&nbsp;deny&nbsp;all_others&nbsp;&lt;/FONT&gt;<br>
<br>
The&nbsp;above&nbsp;being&nbsp;equivalent&nbsp;to&nbsp;&quot;deny&nbsp;all&quot;&nbsp;makes&nbsp;the&nbsp;below&nbsp;rules&nbsp;not&nbsp;do<br>
anything.&nbsp;I&nbsp;dont&nbsp;know&nbsp;yoru&nbsp;policy,&nbsp;maybe&nbsp;you&nbsp;did.<br>
<br>
Consider&nbsp;whether&nbsp;that&nbsp;is&nbsp;what&nbsp;you&nbsp;expected/wanted&nbsp;to&nbsp;happen.<br>
<br>
<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;http_access&nbsp;allow&nbsp;localnet&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;http_access&nbsp;allow&nbsp;localhost&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;http_access&nbsp;deny&nbsp;all&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;icp_access&nbsp;deny&nbsp;all&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;sslproxy_cert_error&nbsp;allow&nbsp;broken_sites&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;sslproxy_cert_error&nbsp;deny&nbsp;all&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;sslproxy_options&nbsp;ALL&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;acl&nbsp;p3129&nbsp;myportname&nbsp;3129&lt;/FONT&gt;<br>
<br>
This&nbsp;name&nbsp;&quot;3129&quot;&nbsp;does&nbsp;not&nbsp;match&nbsp;any&nbsp;listening&nbsp;port&nbsp;name.&nbsp;See&nbsp;below...<br>
<br>
<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;acl&nbsp;step1&nbsp;at_step&nbsp;SslBump1&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;ssl_bump&nbsp;peek&nbsp;step1&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;#ssl_bump&nbsp;splice&nbsp;broken_sites&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;ssl_bump&nbsp;bump&nbsp;p3129&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;http_port&nbsp;192.168.1.253:3128&nbsp;intercept&nbsp;&lt;/FONT&gt;<br>
<br>
...&nbsp;in&nbsp;the&nbsp;absence&nbsp;of&nbsp;a&nbsp;name=&nbsp;parameter&nbsp;the&nbsp;default&nbsp;name&nbsp;for&nbsp;tis&nbsp;port&nbsp;is<br>
&quot;192.168.1.253:3128&quot;.<br>
<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;https_port&nbsp;192.168.1.253:3129&nbsp;intercept&nbsp;ssl-bump&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;cert=/opt/sslsplit/sslsplit.crt&nbsp;key=/opt/sslsplit/sslsplitca.key&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;cafile=/opt/sslsplit/sslsplitca.pem&nbsp;generate-host-certificates=on&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;dynamic_cert_mem_cache_size=4MB&nbsp;sslflags=NO_SESSION_REUSE&lt;/FONT&gt;<br>
<br>
...&nbsp;in&nbsp;the&nbsp;absence&nbsp;of&nbsp;a&nbsp;name=&nbsp;parameter&nbsp;the&nbsp;default&nbsp;name&nbsp;for&nbsp;tis&nbsp;port&nbsp;is<br>
&quot;192.168.1.253:3129&quot;.<br>
<br>
Do&nbsp;you&nbsp;see&nbsp;the&nbsp;pattern?<br>
&nbsp;set&nbsp;the&nbsp;name=&nbsp;parameter&nbsp;eplicitly&nbsp;or&nbsp;it&nbsp;becomes&nbsp;teh&nbsp;*string*&nbsp;value&nbsp;of<br>
the&nbsp;host:port&nbsp;field.<br>
<br>
<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;always_direct&nbsp;allow&nbsp;all&lt;/FONT&gt;<br>
<br>
Has&nbsp;no&nbsp;use&nbsp;in&nbsp;your&nbsp;config.<br>
<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;logformat&nbsp;common&nbsp;%&gt;a&nbsp;%[ui&nbsp;%[un&nbsp;[%tl]&nbsp;&quot;%rm&nbsp;%ru&nbsp;HTTP/%rv&quot;&nbsp;%&gt;Hs&nbsp;%&lt;st&nbsp;%Ss:%&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;Sh&nbsp;%ssl::&gt;cert_subject&lt;/FONT&gt;<br>
<br>
Bad:&nbsp;do&nbsp;not&nbsp;re-define&nbsp;built&nbsp;in&nbsp;format&nbsp;definitions&nbsp;please.<br>
<br>
Either&nbsp;use&nbsp;the&nbsp;provided&nbsp;format,&nbsp;or&nbsp;use&nbsp;a&nbsp;different&nbsp;name&nbsp;if&nbsp;you&nbsp;need&nbsp;the<br>
custom&nbsp;one.<br>
<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;access_log&nbsp;syslog:daemon.info&nbsp;common&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;refresh_pattern&nbsp;^ftp:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1440&nbsp;&nbsp;&nbsp;&nbsp;20%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10080&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;refresh_pattern&nbsp;^gopher:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1440&nbsp;&nbsp;&nbsp;&nbsp;0%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1440&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;refresh_pattern&nbsp;-i&nbsp;(cgi-bin|\?)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;refresh_pattern&nbsp;.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;20%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4320&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;icp_port&nbsp;3130&lt;/FONT&gt;<br>
<br>
You&nbsp;are&nbsp;initializing&nbsp;ICP&nbsp;port,&nbsp;but&nbsp;also&nbsp;configured&nbsp;&quot;icp_access&nbsp;deny&nbsp;all&quot;.<br>
<br>
To&nbsp;disble&nbsp;ICP&nbsp;leave&nbsp;remove&nbsp;the&nbsp;icp_*&nbsp;directives&nbsp;from&nbsp;your&nbsp;config.<br>
<br>
To&nbsp;enable&nbsp;ICP,&nbsp;configure&nbsp;the&nbsp;icp_access&nbsp;to&nbsp;allow&nbsp;some&nbsp;sources&nbsp;to&nbsp;make<br>
queries.<br>
<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;coredump_dir&nbsp;/opt/var&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;#############################################################&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;My&nbsp;goal&nbsp;has&nbsp;been&nbsp;to&nbsp;at&nbsp;least&nbsp;get&nbsp;the&nbsp;domain&nbsp;logged&nbsp;on&nbsp;any&nbsp;https&nbsp;access,&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;but&nbsp;alas&nbsp;some&nbsp;sites&nbsp;show:&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;Apr&nbsp;24&nbsp;06:39:32&nbsp;gateway&nbsp;(squid-1):&nbsp;192.168.1.101&nbsp;-&nbsp;-&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;[24/Apr/2015:06:39:32&nbsp;-0600]&nbsp;&quot;CONNECT&nbsp;216.58.216.162:443&nbsp;HTTP/1.1&quot;&nbsp;200&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;401&nbsp;TCP_TUNNEL:ORIGINAL_DST&nbsp;-&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
<br>
With&nbsp;interception&nbsp;+&nbsp;your&nbsp;custom&nbsp;rule&nbsp;using&nbsp;%ru&nbsp;you&nbsp;should&nbsp;always&nbsp;see<br>
raw-IP:port.&nbsp;If&nbsp;you&nbsp;see&nbsp;a&nbsp;TLS&nbsp;SNI&nbsp;domain&nbsp;in&nbsp;there&nbsp;*that*&nbsp;is&nbsp;a&nbsp;bug.&nbsp;&quot;%ru&quot;<br>
is&nbsp;explicitly&nbsp;asking&nbsp;for&nbsp;the&nbsp;client-presented&nbsp;CONNECT&nbsp;*URL*,&nbsp;not&nbsp;the<br>
server&nbsp;details.<br>
<br>
<br>
That&nbsp;&quot;TCP_TUNNEL&quot;&nbsp;will&nbsp;always&nbsp;happen&nbsp;whenever&nbsp;the&nbsp;protocol&nbsp;found&nbsp;on&nbsp;port<br>
443&nbsp;is&nbsp;not&nbsp;HTTPS.<br>
<br>
Amos<br>
_______________________________________________<br>
squid-users&nbsp;mailing&nbsp;list<br>
&lt;A&nbsp;HREF=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/A&gt;<br>
&lt;A&nbsp;HREF=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/A&gt;<br>
&lt;/PRE&gt;<br>
&lt;/BLOCKQUOTE&gt;<br>
&lt;BR&gt;<br>
Thank&nbsp;you&nbsp;Amos...that's&nbsp;extremely&nbsp;helpful.&lt;BR&gt;<br>
&lt;BR&gt;<br>
James<br>
&lt;/BODY&gt;<br>
&lt;/HTML&gt;<br>

</tt>
