<tt>
<br>
&lt;span&nbsp;id=&quot;mailbox-conversation&quot;&gt;&lt;div&gt;I&nbsp;mentioned&nbsp;last&nbsp;time&nbsp;that&nbsp;we&nbsp;had&nbsp;to&nbsp;x2&nbsp;all&nbsp;our&nbsp;delay_parameter’s&nbsp;bytes&nbsp;because&nbsp;of&nbsp;a&nbsp;weird&nbsp;bug&nbsp;where&nbsp;squid&nbsp;would&nbsp;apply&nbsp;it&nbsp;at&nbsp;half&nbsp;speed&nbsp;for&nbsp;no&nbsp;reason.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt;It&nbsp;just&nbsp;occurred&nbsp;to&nbsp;me&nbsp;that&nbsp;(obviously)&nbsp;this&nbsp;is&nbsp;why&nbsp;HTTPS&nbsp;downloads&nbsp;are&nbsp;going&nbsp;too&nbsp;fast;&nbsp;because&nbsp;this&nbsp;bug&nbsp;must&nbsp;only&nbsp;affect&nbsp;HTTP&nbsp;traffic.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt;So&nbsp;HTTPS&nbsp;downloads&nbsp;are&nbsp;going&nbsp;at&nbsp;the&nbsp;actual&nbsp;speed&nbsp;we’ve&nbsp;specified&nbsp;and&nbsp;HTTP&nbsp;is&nbsp;going&nbsp;at&nbsp;half&nbsp;that.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt;Therefore,&nbsp;we&nbsp;should&nbsp;be&nbsp;able&nbsp;to&nbsp;work&nbsp;around&nbsp;it&nbsp;by&nbsp;setting&nbsp;different&nbsp;delay_parameters&nbsp;for&nbsp;HTTP&nbsp;and&nbsp;HTTPS&nbsp;requests.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt;So&nbsp;my&nbsp;question&nbsp;is,&nbsp;how&nbsp;best&nbsp;to&nbsp;target&nbsp;only&nbsp;those&nbsp;requests?&nbsp;By&nbsp;the&nbsp;CONNECT&nbsp;method?&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt;P.S.&nbsp;This&nbsp;bug&nbsp;is&nbsp;still&nbsp;present&nbsp;in&nbsp;the&nbsp;latest&nbsp;Squid&nbsp;3.5&nbsp;HEAD.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&nbsp;class=&quot;mailbox_signature&quot;&gt;<br>
&lt;br&gt; &lt;/div&gt;<br>
&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;p&gt;On&nbsp;Mon,&nbsp;Apr&nbsp;20,&nbsp;2015&nbsp;at&nbsp;11:44&nbsp;AM,&nbsp;dan@getbusi.com&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:dan@getbusi.com&quot;&nbsp;target=&quot;_blank&quot;&gt;dan@getbusi.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;/p&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;&lt;div&gt;<br>
&lt;span&nbsp;id=&quot;mailbox-conversation&quot;&gt;&lt;div&gt;Thanks&nbsp;Amos&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt;Sorry&nbsp;if&nbsp;that&nbsp;wasn’t&nbsp;clear,&nbsp;but&nbsp;yeah,&nbsp;7&nbsp;KB/s&nbsp;was&nbsp;the&nbsp;desired&nbsp;speed&nbsp;in&nbsp;that&nbsp;test. &lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt;I&nbsp;was&nbsp;testing&nbsp;against&nbsp;an&nbsp;ISO&nbsp;in&nbsp;an&nbsp;S3&nbsp;bucket&nbsp;of&nbsp;ours.&nbsp;I&nbsp;would&nbsp;start&nbsp;the&nbsp;download&nbsp;using&nbsp;http://&nbsp;and&nbsp;get&nbsp;7&nbsp;KB/s&nbsp;(great).&nbsp;Then&nbsp;cancel&nbsp;it&nbsp;and&nbsp;edit&nbsp;the&nbsp;URL&nbsp;to&nbsp;https://&nbsp;and&nbsp;get&nbsp;~90&nbsp;KB/s.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt;Oh,&nbsp;and&nbsp;I&nbsp;almost&nbsp;forgot:&nbsp;(I&nbsp;can’t&nbsp;remember&nbsp;whether&nbsp;this&nbsp;has&nbsp;been&nbsp;reported&nbsp;but)&nbsp;there’s&nbsp;also&nbsp;a&nbsp;problem&nbsp;with&nbsp;delay_parameters,&nbsp;such&nbsp;that&nbsp;our&nbsp;software&nbsp;has&nbsp;to&nbsp;x2&nbsp;any&nbsp;restriction&nbsp;that’s&nbsp;configured&nbsp;when&nbsp;generating&nbsp;the&nbsp;squid&nbsp;config.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt;So,&nbsp;if&nbsp;I&nbsp;want&nbsp;to&nbsp;configure&nbsp;a&nbsp;56&nbsp;kbps&nbsp;restriction&nbsp;our&nbsp;software&nbsp;actually&nbsp;writes:&lt;/div&gt;<br>
&lt;div&gt;<br>
&lt;div&nbsp;id=&quot;mb-reply&quot;&gt;delay_parameters&nbsp;1&nbsp;-1/-1&nbsp;14336/14336&lt;/div&gt;<br>
&lt;div&nbsp;id=&quot;mb-reply&quot;&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;div&nbsp;id=&quot;mb-reply&quot;&gt;In&nbsp;order&nbsp;to&nbsp;achieve&nbsp;the&nbsp;correct&nbsp;limit&nbsp;(7&nbsp;KB/s).&nbsp;Not&nbsp;sure&nbsp;if&nbsp;that&nbsp;could&nbsp;be&nbsp;related&nbsp;to&nbsp;this&nbsp;at&nbsp;all.&lt;/div&gt;<br>
&lt;div&nbsp;id=&quot;mb-reply&quot;&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;div&nbsp;id=&quot;mb-reply&quot;&gt;P.S.&nbsp;We’re&nbsp;pretty&nbsp;fond&nbsp;of&nbsp;delay_pools&nbsp;and&nbsp;their&nbsp;simplicity—including&nbsp;the&nbsp;fact&nbsp;that&nbsp;it&nbsp;can&nbsp;all&nbsp;be&nbsp;handled&nbsp;by&nbsp;Squid&nbsp;without&nbsp;any&nbsp;lower-level&nbsp;networking&nbsp;concerns.&lt;/div&gt;<br>
&lt;/div&gt;&lt;/span&gt;&lt;div&nbsp;class=&quot;mailbox_signature&quot;&gt;<br>
&lt;br&gt; &lt;/div&gt;<br>
&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;<br>
&lt;p&gt;On&nbsp;Mon,&nbsp;Apr&nbsp;20,&nbsp;2015&nbsp;at&nbsp;1:25&nbsp;AM,&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;/p&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;&lt;p&gt;On&nbsp;17/04/2015&nbsp;1:30&nbsp;p.m.,&nbsp;djch&nbsp;wrote:&lt;br&gt;&gt;&nbsp;I&nbsp;just&nbsp;wanted&nbsp;to&nbsp;revive&nbsp;this&nbsp;thread&nbsp;to&nbsp;note&nbsp;that:&lt;br&gt;&gt;&nbsp;&lt;br&gt;&gt;&nbsp;-&nbsp;Delay&nbsp;pools&nbsp;apply&nbsp;just&nbsp;fine&nbsp;to&nbsp;HTTPS&nbsp;requests&nbsp;in&nbsp;Squid&nbsp;2.7.&lt;br&gt;&gt;&nbsp;-&nbsp;Delay&nbsp;pools&nbsp;in&nbsp;Squid&nbsp;3.4.x&nbsp;are&nbsp;also&nbsp;applied&nbsp;to&nbsp;HTTPS&nbsp;but&nbsp;the&nbsp;speed&nbsp;is&nbsp;not&lt;br&gt;&gt;&nbsp;correct.&nbsp;&lt;br&gt;&gt;&nbsp;&nbsp;&nbsp;-&nbsp;If&nbsp;I&nbsp;apply&nbsp;a&nbsp;56&nbsp;Kbps&nbsp;limit&nbsp;the&nbsp;HTTP&nbsp;download&nbsp;tops&nbsp;out&nbsp;at&nbsp;~7&nbsp;KB/s.&lt;br&gt;&lt;br&gt;That&nbsp;*is*&nbsp;correct.&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;56K&nbsp;*bits*&nbsp;/sec&nbsp;==&nbsp;7K&nbsp;*Bytes*&nbsp;/sec.&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;7x8&nbsp;=&nbsp;56&lt;br&gt;&lt;br&gt;&lt;br&gt;&gt;&nbsp;If&nbsp;I&lt;br&gt;&gt;&nbsp;download&nbsp;the&nbsp;same&nbsp;file&nbsp;from&nbsp;the&nbsp;same&nbsp;server&nbsp;via&nbsp;HTTPS&nbsp;it&nbsp;tops&nbsp;out&nbsp;at&lt;br&gt;&gt;&nbsp;~90KB/s.&nbsp;If&nbsp;I&nbsp;download&nbsp;the&nbsp;same&nbsp;file&nbsp;over&nbsp;HTTPS&nbsp;with&nbsp;no&nbsp;delay&nbsp;pools&lt;br&gt;&gt;&nbsp;configured&nbsp;it&nbsp;tops&nbsp;at&nbsp;around&nbsp;3MB/s.&lt;br&gt;&lt;br&gt;Are&nbsp;you&nbsp;sure&nbsp;thats&nbsp;actually&nbsp;HTTPS&nbsp;?&lt;br&gt;&lt;br&gt;CONNECT&nbsp;tunnels&nbsp;these&nbsp;days&nbsp;could&nbsp;contain&nbsp;HTTP/2,&nbsp;SPDY,&nbsp;WebSockets&nbsp;or&lt;br&gt;data&nbsp;in&nbsp;some&nbsp;other&nbsp;(compressed?)&nbsp;format.&nbsp;Any&nbsp;of&nbsp;which&nbsp;achieve&nbsp;faster&lt;br&gt;percieved&nbsp;&quot;download&quot;&nbsp;than&nbsp;HTTP&nbsp;using&nbsp;the&nbsp;same&nbsp;basic&nbsp;bytes/sec&nbsp;data&nbsp;rate.&lt;br&gt;&lt;br&gt;NP:&nbsp;squid-2.7&nbsp;contains&nbsp;a&nbsp;CONNECT&nbsp;bug&nbsp;that&nbsp;prevents&nbsp;SPDY&nbsp;HTTP/2&nbsp;and&lt;br&gt;Websockets&nbsp;working&nbsp;properly.&lt;br&gt;&lt;br&gt;&gt;&nbsp;&lt;br&gt;&gt;&nbsp;So&nbsp;I&nbsp;guess&nbsp;that&nbsp;would&nbsp;make&nbsp;this&nbsp;a&nbsp;bug?&nbsp;Which&nbsp;I&nbsp;assume&nbsp;nobody&nbsp;wants&nbsp;to&nbsp;fix&lt;br&gt;&gt;&nbsp;'cause&nbsp;they're&nbsp;going&nbsp;to&nbsp;be&nbsp;deprecated&nbsp;at&nbsp;some&nbsp;point&nbsp;soon?&lt;br&gt;&gt;&nbsp;&lt;br&gt;&lt;br&gt;Its&nbsp;a&nbsp;matter&nbsp;of&nbsp;interest.&nbsp;With&nbsp;FOSS&nbsp;you&nbsp;have&nbsp;to&nbsp;cause&nbsp;someone&nbsp;to&nbsp;be&lt;br&gt;interested&nbsp;in&nbsp;fixing&nbsp;the&nbsp;bug.&nbsp;Best&nbsp;way&nbsp;to&nbsp;do&nbsp;that&nbsp;is&nbsp;to&nbsp;fix&nbsp;it&nbsp;yourself&lt;br&gt;and&nbsp;present&nbsp;a&nbsp;patch&nbsp;and&nbsp;get&nbsp;it&nbsp;through&nbsp;review&nbsp;to&nbsp;merge.&nbsp;Second&nbsp;best&nbsp;is&lt;br&gt;to&nbsp;find&nbsp;someone&nbsp;to&nbsp;pay&nbsp;to&nbsp;do&nbsp;all&nbsp;that.&nbsp;Or&nbsp;you&nbsp;can&nbsp;join&nbsp;the&nbsp;many&nbsp;people&lt;br&gt;who&nbsp;opted&nbsp;just&nbsp;to&nbsp;wait&nbsp;and&nbsp;pray&nbsp;someone&nbsp;else&nbsp;will&nbsp;give&nbsp;it&nbsp;to&nbsp;them&nbsp;free&lt;br&gt;one&nbsp;day.&lt;br&gt;&lt;br&gt;There&nbsp;is&nbsp;another&nbsp;option&nbsp;with&nbsp;delay&nbsp;pools.&nbsp;The&nbsp;pooling&nbsp;system&nbsp;is&nbsp;*just*&nbsp;a&lt;br&gt;packet&nbsp;rate&nbsp;limiting&nbsp;system.&nbsp;The&nbsp;OS&nbsp;these&nbsp;days&nbsp;have&nbsp;several&nbsp;such&nbsp;QoS&lt;br&gt;systems&nbsp;built&nbsp;in&nbsp;that&nbsp;work&nbsp;far&nbsp;better&nbsp;than&nbsp;Squid&nbsp;algorithms&nbsp;(admittedly&lt;br&gt;not&nbsp;on&nbsp;a&nbsp;HTTP&nbsp;per-message&nbsp;basis).&nbsp;If&nbsp;you&nbsp;want&nbsp;total&nbsp;traffic&nbsp;control&nbsp;give&lt;br&gt;those&nbsp;a&nbsp;try.&lt;br&gt;&lt;br&gt;Amos&lt;br&gt;&lt;br&gt;&lt;br&gt;_______________________________________________&lt;br&gt;squid-users&nbsp;mailing&nbsp;list&lt;br&gt;squid-users@lists.squid-cache.org&lt;br&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;br&gt;&lt;/p&gt;&lt;/blockquote&gt;<br>
&lt;/div&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;
</tt>
