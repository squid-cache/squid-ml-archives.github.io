<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;I&nbsp;have&nbsp;still&nbsp;been&nbsp;trying&nbsp;to&nbsp;get&nbsp;peek&nbsp;and&nbsp;splice&nbsp;to&nbsp;work.&nbsp;Specifically&nbsp;I&nbsp;want&nbsp;to&nbsp;allow&nbsp;the&nbsp;admins&nbsp;of&nbsp;our&nbsp;firewall&nbsp;distro&nbsp;to&nbsp;enter&nbsp;websites&nbsp;that&nbsp;they&nbsp;do&nbsp;not&nbsp;want&nbsp;to&nbsp;bump&nbsp;on&nbsp;the&nbsp;squid&nbsp;UI&nbsp;page.&nbsp;I&nbsp;have&nbsp;been&nbsp;fiddling&nbsp;with&nbsp;info&nbsp;that&nbsp;Amos&nbsp;and&nbsp;Nathan&nbsp;have&nbsp;provided&nbsp;me&nbsp;but&nbsp;with&nbsp;no&nbsp;success&nbsp;so&nbsp;far.&nbsp;Here&nbsp;is&nbsp;a&nbsp;snippet&nbsp;of&nbsp;squid.conf&nbsp;with&nbsp;most&nbsp;of&nbsp;the&nbsp;pertinent&nbsp;SSL&nbsp;configuration.&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;blockquote&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;40px;border:none;padding:0px&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;i&gt;http_access&nbsp;allow&nbsp;localhostgreen&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;http_access&nbsp;allow&nbsp;CONNECT&nbsp;localhostgreen&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&lt;br&gt;&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;#&nbsp;http_port&nbsp;and&nbsp;https_port&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;#----------------------------------------------------------------------------&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&lt;br&gt;&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;http_port&nbsp;&lt;a&nbsp;href=&quot;http://192.168.100.1:800&quot;&gt;192.168.100.1:800&lt;/a&gt;&nbsp;intercept&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;https_port&nbsp;&lt;a&nbsp;href=&quot;http://192.168.100.1:808&quot;&gt;192.168.100.1:808&lt;/a&gt;&nbsp;intercept&nbsp;ssl-bump&nbsp;generate-host-certificates=on&nbsp;dynamic_cert_mem_cache_size=4MB&nbsp;cert=/var/smoothwall/mods/proxy/ssl_cert/squidCA.pem&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&lt;br&gt;&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;http_port&nbsp;&lt;a&nbsp;href=&quot;http://127.0.0.1:800&quot;&gt;127.0.0.1:800&lt;/a&gt;&nbsp;intercept&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&lt;br&gt;&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;sslproxy_cert_error&nbsp;allow&nbsp;all&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;sslproxy_flags&nbsp;DONT_VERIFY_PEER&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;sslproxy_session_cache_size&nbsp;4&nbsp;MB&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&lt;br&gt;&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;ssl_bump&nbsp;none&nbsp;localhostgreen&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&lt;br&gt;&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;external_acl_type&nbsp;sni&nbsp;ttl=30&nbsp;concurrency=60&nbsp;children-max=3&nbsp;children-startup=1&nbsp;%ssl::&gt;sni&nbsp;/var/smoothwall/mods/proxy/libexec/bumphelper&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&lt;br&gt;&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;acl&nbsp;sni_exclusions&nbsp;external&nbsp;sni&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;acl&nbsp;tcp_level&nbsp;at_step&nbsp;SslBump1&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;acl&nbsp;client_hello_peeked&nbsp;at_step&nbsp;SslBump2&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&lt;br&gt;&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;ssl_bump&nbsp;none&nbsp;localhostgreen&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&lt;br&gt;&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;ssl_bump&nbsp;peek&nbsp;tcp_level&nbsp;all&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;ssl_bump&nbsp;splice&nbsp;client_hello_peeked&nbsp;sni_exclusions&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;ssl_bump&nbsp;bump&nbsp;all&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&lt;br&gt;&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;sslcrtd_program&nbsp;/var/smoothwall/mods/proxy/libexec/ssl_crtd&nbsp;-s&nbsp;/var/smoothwall/mods/proxy/lib/ssl_db&nbsp;-M&nbsp;4MB&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;sslcrtd_children&nbsp;5&lt;/i&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;These&nbsp;were&nbsp;provided&nbsp;by&nbsp;Nathan&nbsp;to&nbsp;try.&nbsp;He&nbsp;also&nbsp;provided&nbsp;an&nbsp;example&nbsp;helper&nbsp;script&nbsp;in&nbsp;python&nbsp;to&nbsp;try,&nbsp;but&nbsp;our&nbsp;distro&nbsp;doesn&#39;t&nbsp;grok&nbsp;python&nbsp;so&nbsp;I&nbsp;tried&nbsp;to&nbsp;get&nbsp;it&nbsp;translated&nbsp;to&nbsp;perl&nbsp;and&nbsp;this&nbsp;what&nbsp;I&nbsp;came&nbsp;up&nbsp;with.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;blockquote&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;40px;border:none;padding:0px&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;i&gt;#!/usr/bin/perl&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&lt;br&gt;&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;#&nbsp;run&nbsp;loop&nbsp;until&nbsp;an&nbsp;empty&nbsp;read,&nbsp;which&nbsp;indicates&nbsp;the&nbsp;process&nbsp;should&nbsp;shut&nbsp;down.&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&lt;br&gt;&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;while&nbsp;(&lt;STDIN&gt;)&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;{&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt; &nbsp;my&nbsp;($concurrency_id,&nbsp;$sni)&nbsp;=&nbsp;split;&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&lt;br&gt;&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt; &nbsp;if&nbsp;($sni&nbsp;eq&nbsp;&#39;&lt;a&nbsp;href=&quot;http://wellsfargo.com&quot;&gt;wellsfargo.com&lt;/a&gt;&#39;)&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt; &nbsp;{&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt; &nbsp; &nbsp; print&nbsp;&quot;$concurreny_id&nbsp;OK\n&quot;;&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt; &nbsp;}&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt; &nbsp;else&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt; &nbsp;{&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt; &nbsp; &nbsp; print&nbsp;&quot;$concurreny_id&nbsp;ERR\n&quot;;&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt; &nbsp;}&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;}&lt;/i&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;When&nbsp;I&nbsp;start&nbsp;Squid&nbsp;with&nbsp;this&nbsp;configuration,&nbsp;the&nbsp;helper&nbsp;script&nbsp;&quot;bumphelper&quot;&nbsp;gets&nbsp;loaded&nbsp;as&nbsp;a&nbsp;process&nbsp;along&nbsp;with&nbsp;squid&nbsp;and&nbsp;ssl_crtd.&nbsp;When&nbsp;I&nbsp;try&nbsp;to&nbsp;browse&nbsp;any&nbsp;SSL&nbsp;websites&nbsp;there&nbsp;is&nbsp;no&nbsp;connection&nbsp;and&nbsp;it&nbsp;times&nbsp;out.&nbsp;HTTP&nbsp;browsing&nbsp;is&nbsp;fine.&nbsp;When&nbsp;I&nbsp;remove&nbsp;those&nbsp;peek&nbsp;and&nbsp;splice&nbsp;related&nbsp;lines&nbsp;and&nbsp;add&nbsp;&quot;ssl_bump&nbsp;server-first&nbsp;all&quot;&nbsp;back&nbsp;to&nbsp;squid&nbsp;conf&nbsp;then&nbsp;bumping&nbsp;of&nbsp;SSL&nbsp;sites&nbsp;is&nbsp;successful.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;suspect&nbsp;my&nbsp;&quot;bumphelper&quot;&nbsp;script&nbsp;is&nbsp;not&nbsp;doing&nbsp;what&nbsp;I&nbsp;intend&nbsp;it&nbsp;to&nbsp;do.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Suggestions&nbsp;very&nbsp;welcome.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Stan&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
