<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.0&nbsp;TRANSITIONAL//EN&quot;&gt;<br>
&lt;HTML&gt;<br>
&lt;HEAD&gt;<br>
&nbsp;&nbsp;&lt;META&nbsp;HTTP-EQUIV=&quot;Content-Type&quot;&nbsp;CONTENT=&quot;text/html;&nbsp;CHARSET=UTF-8&quot;&gt;<br>
&nbsp;&nbsp;&lt;META&nbsp;NAME=&quot;GENERATOR&quot;&nbsp;CONTENT=&quot;GtkHTML/4.6.6&quot;&gt;<br>
&lt;/HEAD&gt;<br>
&lt;BODY&gt;<br>
So&nbsp;following&nbsp;advice&nbsp;and&nbsp;instructions&nbsp;on&nbsp;this&nbsp;page:&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;A&nbsp;HREF=&quot;http://wiki.squid-cache.org/Features/DynamicSslCert&quot;&gt;http://wiki.squid-cache.org/Features/DynamicSslCert&lt;/A&gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
I&nbsp;have&nbsp;set&nbsp;up&nbsp;my&nbsp;lab&nbsp;with&nbsp;explicit&nbsp;proxy&nbsp;by&nbsp;exporting&nbsp;http_proxy&nbsp;and&nbsp;https_proxy.&nbsp;&nbsp;After&nbsp;creating&nbsp;the&nbsp;self-signed&nbsp;root&nbsp;CA&nbsp;certificate&nbsp;above&nbsp;and&nbsp;creating&nbsp;the&nbsp;.der&nbsp;file&nbsp;for&nbsp;the&nbsp;client,&nbsp;here&nbsp;are&nbsp;my&nbsp;results:&lt;BR&gt;<br>
&lt;BR&gt;<br>
&gt;From&nbsp;the&nbsp;squid&nbsp;side:&lt;BR&gt;<br>
&lt;TT&gt;2015/05/25&nbsp;10:02:20.161|&nbsp;Using&nbsp;certificate&nbsp;in&nbsp;/opt/etc/squid/certs/SquidCA.pem&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;2015/05/25&nbsp;10:02:20.170|&nbsp;support.cc(1743)&nbsp;readSslX509CertificatesChain:&nbsp;Certificate&nbsp;is&nbsp;self-signed,&nbsp;will&nbsp;not&nbsp;be&nbsp;chained&lt;/TT&gt;&lt;BR&gt;<br>
I&nbsp;get&nbsp;the&nbsp;below&nbsp;when&nbsp;I&nbsp;don't&nbsp;specify&nbsp;a&nbsp;CA&nbsp;with&nbsp;curl,&nbsp;otherwise&nbsp;when&nbsp;I&nbsp;do&nbsp;I&nbsp;get&nbsp;no&nbsp;error:&lt;BR&gt;<br>
&lt;TT&gt;2015/05/25&nbsp;09:21:02.229|&nbsp;Error&nbsp;negotiating&nbsp;SSL&nbsp;connection&nbsp;on&nbsp;FD&nbsp;12:&nbsp;error:14094418:SSL&nbsp;routines:SSL3_READ_BYTES:tlsv1&nbsp;alert&nbsp;unknown&nbsp;ca&nbsp;(1/0)&lt;/TT&gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
And&nbsp;from&nbsp;the&nbsp;client&nbsp;side:&lt;BR&gt;<br>
&lt;TT&gt;root@kali:~/test#&nbsp;curl&nbsp;-v&nbsp;&lt;A&nbsp;HREF=&quot;https://mail.slave-tothe-box.net&quot;&gt;https://mail.slave-tothe-box.net&lt;/A&gt;&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;*&nbsp;About&nbsp;to&nbsp;connect()&nbsp;to&nbsp;proxy&nbsp;192.168.1.9&nbsp;port&nbsp;3129&nbsp;(#0)&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;*&nbsp;&nbsp;&nbsp;Trying&nbsp;192.168.1.9...&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;*&nbsp;connected&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;*&nbsp;Connected&nbsp;to&nbsp;192.168.1.9&nbsp;(192.168.1.9)&nbsp;port&nbsp;3129&nbsp;(#0)&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;*&nbsp;Establish&nbsp;HTTP&nbsp;proxy&nbsp;tunnel&nbsp;to&nbsp;mail.slave-tothe-box.net:443&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;&gt;&nbsp;CONNECT&nbsp;mail.slave-tothe-box.net:443&nbsp;HTTP/1.1&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;&gt;&nbsp;Host:&nbsp;mail.slave-tothe-box.net:443&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;&gt;&nbsp;User-Agent:&nbsp;curl/7.26.0&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;&gt;&nbsp;Proxy-Connection:&nbsp;Keep-Alive&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;&gt;&nbsp;&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;*&nbsp;Easy&nbsp;mode&nbsp;waiting&nbsp;response&nbsp;from&nbsp;proxy&nbsp;CONNECT&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;&lt;&nbsp;HTTP/1.1&nbsp;200&nbsp;Connection&nbsp;established&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;&lt;&nbsp;&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;*&nbsp;Proxy&nbsp;replied&nbsp;OK&nbsp;to&nbsp;CONNECT&nbsp;request&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;*&nbsp;successfully&nbsp;set&nbsp;certificate&nbsp;verify&nbsp;locations:&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;*&nbsp;&nbsp;&nbsp;CAfile:&nbsp;none&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;&nbsp;&nbsp;CApath:&nbsp;/etc/ssl/certs&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;*&nbsp;SSLv3,&nbsp;TLS&nbsp;handshake,&nbsp;Client&nbsp;hello&nbsp;(1):&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;*&nbsp;SSLv3,&nbsp;TLS&nbsp;handshake,&nbsp;Server&nbsp;hello&nbsp;(2):&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;*&nbsp;SSLv3,&nbsp;TLS&nbsp;handshake,&nbsp;CERT&nbsp;(11):&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;*&nbsp;SSLv3,&nbsp;TLS&nbsp;alert,&nbsp;Server&nbsp;hello&nbsp;(2):&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;*&nbsp;SSL&nbsp;certificate&nbsp;problem:&nbsp;self&nbsp;signed&nbsp;certificate&nbsp;in&nbsp;certificate&nbsp;chain&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;*&nbsp;Closing&nbsp;connection&nbsp;#0&lt;/TT&gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
And&nbsp;testing&nbsp;with&nbsp;specifying&nbsp;the&nbsp;.der&nbsp;file:&lt;BR&gt;<br>
&lt;TT&gt;root@kali:~/test#&nbsp;curl&nbsp;--cacert&nbsp;/etc/ssl/certs/SquidCA.der&nbsp;-v&nbsp;&lt;A&nbsp;HREF=&quot;https://mail.slave-tothe-box.net&quot;&gt;https://mail.slave-tothe-box.net&lt;/A&gt;&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;*&nbsp;About&nbsp;to&nbsp;connect()&nbsp;to&nbsp;proxy&nbsp;192.168.1.9&nbsp;port&nbsp;3129&nbsp;(#0)&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;*&nbsp;&nbsp;&nbsp;Trying&nbsp;192.168.1.9...&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;*&nbsp;connected&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;*&nbsp;Connected&nbsp;to&nbsp;192.168.1.9&nbsp;(192.168.1.9)&nbsp;port&nbsp;3129&nbsp;(#0)&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;*&nbsp;Establish&nbsp;HTTP&nbsp;proxy&nbsp;tunnel&nbsp;to&nbsp;mail.slave-tothe-box.net:443&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;&gt;&nbsp;CONNECT&nbsp;mail.slave-tothe-box.net:443&nbsp;HTTP/1.1&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;&gt;&nbsp;Host:&nbsp;mail.slave-tothe-box.net:443&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;&gt;&nbsp;User-Agent:&nbsp;curl/7.26.0&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;&gt;&nbsp;Proxy-Connection:&nbsp;Keep-Alive&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;&gt;&nbsp;&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;*&nbsp;Easy&nbsp;mode&nbsp;waiting&nbsp;response&nbsp;from&nbsp;proxy&nbsp;CONNECT&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;&lt;&nbsp;HTTP/1.1&nbsp;200&nbsp;Connection&nbsp;established&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;&lt;&nbsp;&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;*&nbsp;Proxy&nbsp;replied&nbsp;OK&nbsp;to&nbsp;CONNECT&nbsp;request&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;*&nbsp;error&nbsp;setting&nbsp;certificate&nbsp;verify&nbsp;locations:&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;&nbsp;&nbsp;CAfile:&nbsp;/etc/ssl/certs/SquidCA.der&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;&nbsp;&nbsp;CApath:&nbsp;/etc/ssl/certs&lt;/TT&gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;TT&gt;*&nbsp;Closing&nbsp;connection&nbsp;#0&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;curl:&nbsp;(77)&nbsp;error&nbsp;setting&nbsp;certificate&nbsp;verify&nbsp;locations:&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;&nbsp;&nbsp;CAfile:&nbsp;/etc/ssl/certs/SquidCA.der&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;&nbsp;&nbsp;CApath:&nbsp;/etc/ssl/certs&lt;/TT&gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;BR&gt;<br>
I&nbsp;can&nbsp;confirm&nbsp;that&nbsp;the&nbsp;server&nbsp;is&nbsp;using&nbsp;a&nbsp;bona-fide&nbsp;certificate&nbsp;issued&nbsp;from&nbsp;StartSSL&nbsp;and&nbsp;works,&nbsp;so&nbsp;at&nbsp;this&nbsp;point&nbsp;I'm&nbsp;open&nbsp;to&nbsp;suggestions.&nbsp;&nbsp;Thank&nbsp;you.&lt;BR&gt;<br>
&lt;BR&gt;<br>
James<br>
&lt;/BODY&gt;<br>
&lt;/HTML&gt;<br>

</tt>
