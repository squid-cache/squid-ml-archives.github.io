<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;OK&nbsp;-&nbsp;got&nbsp;it&nbsp;working...&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;added&nbsp;the&nbsp;lines:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;1&quot;&gt;external_acl_type&nbsp;userlookup&nbsp;ttl=60&nbsp;concurrency=1&nbsp;%SRC&nbsp;/opt/squid354/libexec/ext_sql_session_acl&nbsp;-dsn&nbsp;DBI:mysql:database=pf&nbsp;--user&nbsp;root&nbsp;--password&nbsp;xxx&nbsp;--table  currentUsers&nbsp;--uidcol&nbsp;ip&nbsp; --usercol&nbsp;uid&nbsp;--tagcol&nbsp;ip&nbsp;--persist &lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;1&quot;&gt;acl&nbsp;userlookup&nbsp;external&nbsp;userlookup&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;1&quot;&gt;http_access&nbsp;allow&nbsp;localnet&nbsp;userlookup&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;1&quot;&gt;http_access&nbsp;allow&nbsp;localnet&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Now&nbsp;I&nbsp;get&nbsp;this&nbsp;in&nbsp;my&nbsp;logfiles:&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;1&quot;&gt;10.15.228.12&nbsp;-&nbsp;0001&nbsp;[26/May/2015:12:56:23&nbsp;+0100]&nbsp;&quot;POST&nbsp;&lt;a&nbsp;href=&quot;http://www.bing.com/fd/ls/lsp.aspx&quot;&gt;http://www.bing.com/fd/ls/lsp.aspx&lt;/a&gt;&nbsp;HTTP/1.1&quot;&nbsp;204&nbsp;391&nbsp;TCP_MISS:ORIGINAL_DST&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&#39;ll&nbsp;write&nbsp;all&nbsp;this&nbsp;up&nbsp;somewhere,&nbsp;as&nbsp;variations&nbsp;on&nbsp;what&nbsp;I&nbsp;have&nbsp;here&nbsp;is&nbsp;what&nbsp;people&nbsp;are&nbsp;always&nbsp;asking&nbsp;for:&lt;/div&gt;&lt;div&gt;-&nbsp;Users&nbsp;log&nbsp;in&nbsp;via&nbsp;a&nbsp;web&nbsp;page,&nbsp;not&nbsp;a&nbsp;407&nbsp;popup&nbsp;box&lt;/div&gt;&lt;div&gt;-&nbsp;Authenticates&nbsp;to&nbsp;AD&lt;/div&gt;&lt;div&gt;-&nbsp;Users&nbsp;are&nbsp;filtered&nbsp;depending&nbsp;on&nbsp;who&nbsp;they&nbsp;are&nbsp;(via&nbsp;squidGuard)&lt;/div&gt;&lt;div&gt;-&nbsp;Logs&nbsp;activity&nbsp;against&nbsp;users&lt;/div&gt;&lt;div&gt;-&nbsp;logs&nbsp;them&nbsp;all&nbsp;off&nbsp;at&nbsp;a&nbsp;particular&nbsp;time&lt;/div&gt;&lt;div&gt;-&nbsp;No&nbsp;proxy&nbsp;settings&nbsp;(intercept&nbsp;HTTP+HTTPS)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;div&gt;&lt;div&nbsp;class=&quot;gmail_signature&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;thanks,&lt;br&gt;&lt;br&gt;Jim&nbsp;Potter&lt;br&gt;Network&nbsp;Manager&lt;br&gt;Oasis&nbsp;Brislington&nbsp;(formerly&nbsp;Brislington&nbsp;Enterprise&nbsp;College)&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;26&nbsp;May&nbsp;2015&nbsp;at&nbsp;11:39,&nbsp;Mr&nbsp;J&nbsp;Potter&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:jpotter833@because.org.uk&quot;&nbsp;target=&quot;_blank&quot;&gt;jpotter833@because.org.uk&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi&nbsp;Amos,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;OK&nbsp;this&nbsp;looks&nbsp;promising&nbsp;(if&nbsp;not&nbsp;actually&nbsp;working...)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So&nbsp;I&nbsp;have&nbsp;a&nbsp;config&nbsp;line:&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;1&quot;&gt;external_acl_type&nbsp;userlookup&nbsp;ttl=60&nbsp;%SRC&nbsp;/opt/squid354/libexec/ext_sql_session_acl&nbsp;-dsn&nbsp;DBI:mysql:database=pf --user&nbsp;root&nbsp;--password&nbsp;xxxx&nbsp;--table&nbsp;currentUsers&nbsp;--uidcol&nbsp;ip&nbsp; --usercol&nbsp;uid&nbsp;--tagcol&nbsp;ip&nbsp;--persist&nbsp;--debug&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Where&nbsp;currentUsers&nbsp;looks&nbsp;like:&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;1&quot;&gt;mysql&gt;&nbsp;select&nbsp;*&nbsp;from&nbsp;currentUsers;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;1&quot;&gt;+------+--------------+---------+&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;1&quot;&gt;|&nbsp;uid&nbsp; |&nbsp;ip&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;enabled&nbsp;|&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;1&quot;&gt;+------+--------------+---------+&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;1&quot;&gt;|&nbsp;0003&nbsp;|&nbsp;10.15.228.12&nbsp;|&nbsp;1&nbsp; &nbsp; &nbsp; &nbsp;|&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;1&quot;&gt;+------+--------------+---------+&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;so&nbsp;running&nbsp;this&nbsp;externally&nbsp;I&nbsp;use:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;1&quot;&gt;/opt/squid354/libexec/ext_sql_session_acl&nbsp;-dsn&nbsp;DBI:mysql:database=pf&nbsp;--user&nbsp;root&nbsp;--password&nbsp;fv89j8j6eg2&nbsp;--table&nbsp;currentUsers&nbsp;--uidcol&nbsp;ip&nbsp;--usercol&nbsp;uid&nbsp;--tagcol&nbsp;ip&nbsp;--debug&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;this&nbsp;replies&nbsp;with&nbsp;a&nbsp;username&nbsp;if&nbsp;I&nbsp;put&nbsp;in:&lt;/div&gt;&lt;div&gt;&lt;anything&gt;&nbsp;10.15.228.12&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So&nbsp;what&nbsp;is&nbsp;the&nbsp;&lt;anything&gt;&nbsp;about?&nbsp;And&nbsp;I&#39;m&nbsp;still&nbsp;not&nbsp;getting&nbsp;any&nbsp;username&nbsp;in&nbsp;my&nbsp;logfiles.&nbsp;Do&nbsp;I&nbsp;need&nbsp;to&nbsp;use&nbsp;the&nbsp;acl&nbsp;name&nbsp;somewhere&nbsp;else&nbsp;in&nbsp;the&nbsp;config&nbsp;file&nbsp;too? &lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;thanks,&lt;br&gt;&lt;br&gt;Jim&nbsp;Potter&lt;br&gt;Network&nbsp;Manager&lt;br&gt;Oasis&nbsp;Brislington&nbsp;(formerly&nbsp;Brislington&nbsp;Enterprise&nbsp;College)&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;br&gt;&lt;/span&gt;&lt;div&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;25&nbsp;May&nbsp;2015&nbsp;at&nbsp;12:07,&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&nbsp;target=&quot;_blank&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;span&gt;On&nbsp;25/05/2015&nbsp;8:38&nbsp;p.m.,&nbsp;Mr&nbsp;J&nbsp;Potter&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;Hi&nbsp;all,&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;I&#39;m&nbsp;setting&nbsp;up&nbsp;a&nbsp;system&nbsp;for&nbsp;using&nbsp;iPads&nbsp;in&nbsp;our&nbsp;school,&nbsp;and&nbsp;I&#39;m&nbsp;stuck&nbsp;a&nbsp;bit&lt;br&gt;<br>
&gt;&nbsp;on&nbsp;tracking&nbsp;what&nbsp;the&nbsp;students&nbsp;are&nbsp;doing&nbsp;on&nbsp;them.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;First&nbsp;up,&nbsp;I&nbsp;reaaly&nbsp;don&#39;t&nbsp;want&nbsp;a&nbsp;Pop-up&nbsp;login&nbsp;box&nbsp;from&nbsp;a&nbsp;407&nbsp;response&nbsp;from&nbsp;a&lt;br&gt;<br>
&gt;&nbsp;proxy&nbsp;server,&nbsp;so&nbsp;I&#39;m&nbsp;looking&nbsp;for&nbsp;some&nbsp;other&nbsp;way&nbsp;to&nbsp;track&nbsp;who&nbsp;is&nbsp;doing&nbsp;what.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;What&nbsp;i&nbsp;have&nbsp;set&nbsp;up&nbsp;so&nbsp;far&nbsp;is&nbsp;PacketFence&nbsp;with&nbsp;an&nbsp;SSL-bump&nbsp;transparent&nbsp;proxy&lt;br&gt;<br>
&gt;&nbsp;(I&#39;ve&nbsp;put&nbsp;the&nbsp;CAs&nbsp;o&nbsp;all&nbsp;the&nbsp;ipads)&nbsp;which&nbsp;works&nbsp;well&nbsp;in&nbsp;that&nbsp;users&nbsp;have&nbsp;to&lt;br&gt;<br>
&gt;&nbsp;log&nbsp;in&nbsp;before&nbsp;they&nbsp;get&nbsp;internet&nbsp;access.&nbsp;This&nbsp;works&nbsp;(they&nbsp;get&nbsp;a&nbsp;web&nbsp;page,&lt;br&gt;<br>
&gt;&nbsp;login&nbsp;and&nbsp;get&nbsp;50&nbsp;minutes&nbsp;of&nbsp;internet&nbsp;before&nbsp;it&nbsp;disconnects&nbsp;them),&nbsp;but&nbsp;the&lt;br&gt;<br>
&gt;&nbsp;only&nbsp;way&nbsp;I&nbsp;have&nbsp;of&nbsp;tracking&nbsp;users&nbsp;is&nbsp;by&nbsp;working&nbsp;out&nbsp;who&nbsp;was&nbsp;on&nbsp;each&nbsp;ipad&lt;br&gt;<br>
&gt;&nbsp;(from&nbsp;packetfence)&nbsp;then&nbsp;matching&nbsp;it&nbsp;against&nbsp;squid&nbsp;logs,&nbsp;which&nbsp;is&nbsp;messy.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;Squid&nbsp;comes&nbsp;bundled&nbsp;with&nbsp;a&nbsp;ext_sql_session_acl&nbsp;helper&nbsp;that&nbsp;looks&nbsp;up&nbsp;a&lt;br&gt;<br>
database&nbsp;and&nbsp;produces&nbsp;OK/ERR&nbsp;(and&nbsp;username&nbsp;for&nbsp;logging)&nbsp;depending&nbsp;on&lt;br&gt;<br>
whether&nbsp;the&nbsp;key&nbsp;given&nbsp;to&nbsp;it&nbsp;exists&nbsp;in&nbsp;the&nbsp;DB&nbsp;already.&lt;br&gt;<br>
&lt;&lt;a&nbsp;href=&quot;http://www.squid-cache.org/Versions/v4/manuals/ext_sql_session_acl.html&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.squid-cache.org/Versions/v4/manuals/ext_sql_session_acl.html&lt;/a&gt;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
You&nbsp;just&nbsp;need&nbsp;to&nbsp;get&nbsp;an&nbsp;UID&nbsp;metric.&nbsp;IP&nbsp;address,&nbsp;MAC&nbsp;address,&nbsp;and/or&lt;br&gt;<br>
EUI-64&nbsp;(IPv6&nbsp;link-local)&nbsp;are&nbsp;suitable&nbsp;there.&nbsp;It&nbsp;sounds&nbsp;like&nbsp;your&lt;br&gt;<br>
packetfence&nbsp;would&nbsp;be&nbsp;a&nbsp;good&nbsp;way&nbsp;to&nbsp;populate&nbsp;that&nbsp;DB&nbsp;too.&lt;br&gt;<br>
&lt;span&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;One&nbsp;plan&nbsp;I&nbsp;had&nbsp;would&nbsp;be&nbsp;to&nbsp;add/remove&nbsp;entries&nbsp;in&nbsp;dns&nbsp;or&nbsp;hosts&nbsp;for&nbsp;users,&lt;br&gt;<br>
&gt;&nbsp;eg &nbsp;IP&nbsp;address&nbsp;10.2.3.4 &nbsp; -&gt;&nbsp;hostname &nbsp;fbloggs &nbsp;(the&nbsp;user&#39;s&nbsp;login&nbsp;code)&nbsp;so&lt;br&gt;<br>
&gt;&nbsp;usernames&nbsp;would&nbsp;show&nbsp;up&nbsp;in&nbsp;the&nbsp;client&nbsp;hostname&nbsp;field,&nbsp;but&nbsp;squid&nbsp;caches&lt;br&gt;<br>
&gt;&nbsp;these&nbsp;I&nbsp;think.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;Yes.&nbsp;Dont&nbsp;do&nbsp;that&nbsp;with&nbsp;DNS.&lt;br&gt;<br>
&lt;br&gt;<br>
Amos&lt;br&gt;<br>
&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
