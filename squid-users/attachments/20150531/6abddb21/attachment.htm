<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.0&nbsp;TRANSITIONAL//EN&quot;&gt;<br>
&lt;HTML&gt;<br>
&lt;HEAD&gt;<br>
&nbsp;&nbsp;&lt;META&nbsp;HTTP-EQUIV=&quot;Content-Type&quot;&nbsp;CONTENT=&quot;text/html;&nbsp;CHARSET=UTF-8&quot;&gt;<br>
&nbsp;&nbsp;&lt;META&nbsp;NAME=&quot;GENERATOR&quot;&nbsp;CONTENT=&quot;GtkHTML/4.6.6&quot;&gt;<br>
&lt;/HEAD&gt;<br>
&lt;BODY&gt;<br>
So&nbsp;this&nbsp;has&nbsp;been&nbsp;REALLY&nbsp;good!&nbsp;&nbsp;The&nbsp;tl;dr:&nbsp;&nbsp;ssl-bumping&nbsp;is&nbsp;pretty&nbsp;easy&nbsp;even&nbsp;with&nbsp;intercept,&nbsp;ssl-bumping&nbsp;with&nbsp;access&nbsp;control&nbsp;is&nbsp;a&nbsp;little&nbsp;more&nbsp;difficult...jump&nbsp;to&nbsp;the&nbsp;config&nbsp;to&nbsp;skip&nbsp;the&nbsp;chit&nbsp;chat.&lt;BR&gt;<br>
&lt;BR&gt;<br>
My&nbsp;goal&nbsp;has&nbsp;always&nbsp;been&nbsp;to&nbsp;a&nbsp;content&nbsp;filter&nbsp;based&nbsp;on&nbsp;url&nbsp;regex.&nbsp;&nbsp;This&nbsp;works&nbsp;just&nbsp;fine&nbsp;for&nbsp;http&nbsp;traffic,&nbsp;but&nbsp;is&nbsp;much&nbsp;more&nbsp;difficult&nbsp;for&nbsp;https&nbsp;traffic&nbsp;just&nbsp;for&nbsp;the&nbsp;case&nbsp;of&nbsp;you&nbsp;may&nbsp;or&nbsp;may&nbsp;not&nbsp;know&nbsp;the&nbsp;host&nbsp;you're&nbsp;going&nbsp;to,&nbsp;depending&nbsp;on&nbsp;the&nbsp;site/app.&nbsp;&nbsp;I'll&nbsp;be&nbsp;real&nbsp;honest&nbsp;here....I'm&nbsp;only&nbsp;doing&nbsp;this&nbsp;to&nbsp;protect/filter&nbsp;the&nbsp;traffic&nbsp;of&nbsp;two&nbsp;kids,&nbsp;on&nbsp;laptops,&nbsp;iPhone,&nbsp;and&nbsp;Android&nbsp;phone,&nbsp;so&nbsp;it's&nbsp;a&nbsp;mixed&nbsp;bag&nbsp;of&nbsp;content&nbsp;and,&nbsp;since&nbsp;it's&nbsp;just&nbsp;the&nbsp;two&nbsp;of&nbsp;them&nbsp;in&nbsp;a&nbsp;home&nbsp;environment,&nbsp;I&nbsp;get&nbsp;to&nbsp;play&nbsp;around&nbsp;and&nbsp;see&nbsp;what&nbsp;works&nbsp;and&nbsp;what&nbsp;doesn't.&lt;BR&gt;<br>
&lt;BR&gt;<br>
Below&nbsp;is&nbsp;a&nbsp;close&nbsp;as&nbsp;I&nbsp;can&nbsp;get&nbsp;transparent&nbsp;intercept&nbsp;ssl-bump&nbsp;with&nbsp;content&nbsp;filtering&nbsp;with&nbsp;using&nbsp;a&nbsp;list&nbsp;of&nbsp;domains/urls&nbsp;with&nbsp;both&nbsp;http&nbsp;and&nbsp;https.&nbsp;&nbsp;I&nbsp;still&nbsp;have&nbsp;to&nbsp;use&nbsp;a&nbsp;list&nbsp;of&nbsp;broken&nbsp;sites,&nbsp;which&nbsp;are&nbsp;large&nbsp;netblocks&nbsp;(17.0.0.0/8..Apple&nbsp;anyone?)&nbsp;because&nbsp;some&nbsp;of&nbsp;these&nbsp;I&nbsp;just&nbsp;can't&nbsp;seem&nbsp;to&nbsp;get&nbsp;host/domain&nbsp;information&nbsp;during&nbsp;the&nbsp;ssl&nbsp;handshake.&nbsp;&nbsp;As&nbsp;I&nbsp;discovered&nbsp;after&nbsp;attempting&nbsp;to&nbsp;put&nbsp;this&nbsp;into&nbsp;&quot;production&quot;,&nbsp;I&nbsp;have&nbsp;not&nbsp;been&nbsp;able&nbsp;to&nbsp;emulate&nbsp;using&nbsp;wget&nbsp;or&nbsp;curl&nbsp;an&nbsp;https&nbsp;session&nbsp;that&nbsp;doesn't&nbsp;have&nbsp;any&nbsp;SNI&nbsp;information,&nbsp;so&nbsp;that&nbsp;threw&nbsp;me&nbsp;for&nbsp;a&nbsp;loop.&nbsp;&nbsp;TextNow&nbsp;is&nbsp;a&nbsp;great&nbsp;example&nbsp;(I'm&nbsp;including&nbsp;a&nbsp;packet&nbsp;capture&nbsp;of&nbsp;this&nbsp;in&nbsp;this&nbsp;post).&nbsp;&nbsp;There's&nbsp;no&nbsp;host&nbsp;information&nbsp;in&nbsp;the&nbsp;client&nbsp;hello....there's&nbsp;no&nbsp;host&nbsp;information&nbsp;in&nbsp;the&nbsp;server&nbsp;hello.....buried&nbsp;deep&nbsp;in&nbsp;the&nbsp;certificate&nbsp;ONLY&nbsp;is&nbsp;the&nbsp;&quot;commonName=.*textnow.me&quot;...that's&nbsp;it.&nbsp;&nbsp;This&nbsp;dashed&nbsp;my&nbsp;hopes&nbsp;of&nbsp;using&nbsp;an&nbsp;url_regex&nbsp;for&nbsp;access&nbsp;control&nbsp;with&nbsp;all&nbsp;https&nbsp;sessions.&nbsp;&nbsp;I&nbsp;have&nbsp;&quot;%ssl::&gt;cert_subject&quot;&nbsp;in&nbsp;my&nbsp;logging,&nbsp;and&nbsp;I&nbsp;never&nbsp;did&nbsp;see&nbsp;this&nbsp;log&nbsp;in&nbsp;any&nbsp;of&nbsp;my&nbsp;tests...and&nbsp;I&nbsp;tested&nbsp;a&nbsp;BUNCH&nbsp;of&nbsp;different&nbsp;peek/stare/splice/bump&nbsp;cominations..so&nbsp;I&nbsp;don't&nbsp;think&nbsp;squid&nbsp;is&nbsp;actually&nbsp;seeing&nbsp;this&nbsp;from&nbsp;the&nbsp;certificate.&lt;BR&gt;<br>
&lt;BR&gt;<br>
Another&nbsp;challenge&nbsp;is&nbsp;getting&nbsp;http&nbsp;url_regex&nbsp;filtering&nbsp;to&nbsp;work&nbsp;with&nbsp;https&nbsp;filtering.&nbsp;&nbsp;My&nbsp;method&nbsp;of&nbsp;filtering&nbsp;means&nbsp;not&nbsp;having&nbsp;an&nbsp;&quot;http_access&nbsp;allow&nbsp;localnet&quot;,&nbsp;which&nbsp;directly&nbsp;conflicted&nbsp;with&nbsp;also&nbsp;trying&nbsp;to&nbsp;filter&nbsp;https.&nbsp;&nbsp;The&nbsp;solution&nbsp;was&nbsp;to&nbsp;add&nbsp;an&nbsp;acl&nbsp;for&nbsp;port&nbsp;443,&nbsp;then&nbsp;http_access&nbsp;to&nbsp;just&nbsp;allow&nbsp;it,&nbsp;as&nbsp;our&nbsp;filtering&nbsp;was&nbsp;going&nbsp;to&nbsp;happen&nbsp;for&nbsp;https&nbsp;further&nbsp;down.&lt;BR&gt;<br>
&lt;BR&gt;<br>
I&nbsp;know&nbsp;there's&nbsp;a&nbsp;fair&nbsp;amount&nbsp;of&nbsp;people&nbsp;who&nbsp;just&nbsp;want&nbsp;to&nbsp;plop&nbsp;in&nbsp;some&nbsp;config&nbsp;files,&nbsp;run&nbsp;a&nbsp;few&nbsp;commands,&nbsp;and&nbsp;be&nbsp;up&nbsp;and&nbsp;running.&nbsp;&nbsp;The&nbsp;below&nbsp;configuration&nbsp;has&nbsp;two&nbsp;additional&nbsp;files&nbsp;it&nbsp;references,&nbsp;http_url.txt,&nbsp;which&nbsp;is&nbsp;an&nbsp;a&nbsp;list&nbsp;of&nbsp;domains/urls&nbsp;(\.apple\.com&nbsp;for&nbsp;example),&nbsp;and&nbsp;the&nbsp;aptly&nbsp;named&nbsp;broken,&nbsp;which&nbsp;is&nbsp;a&nbsp;IP&nbsp;list&nbsp;(17.0.0.0/8).&nbsp;&nbsp;The&nbsp;broken&nbsp;list&nbsp;should&nbsp;be&nbsp;(semi)&nbsp;trusted&nbsp;and&nbsp;are&nbsp;sites&nbsp;that&nbsp;we&nbsp;just&nbsp;can't&nbsp;get&nbsp;SNI&nbsp;or&nbsp;hostname&nbsp;information&nbsp;from.&nbsp;&nbsp;If&nbsp;you've&nbsp;created&nbsp;a&nbsp;single&nbsp;cert/key&nbsp;pair&nbsp;from&nbsp;the&nbsp;Squid&nbsp;documentation,&nbsp;you&nbsp;won't&nbsp;need&nbsp;the&nbsp;key=&nbsp;line&nbsp;in&nbsp;your&nbsp;https_port&nbsp;directive.&nbsp;&nbsp;If&nbsp;you've&nbsp;followed&nbsp;along&nbsp;in&nbsp;my&nbsp;posts,&nbsp;you&nbsp;already&nbsp;have&nbsp;the&nbsp;configure&nbsp;line&nbsp;from&nbsp;my&nbsp;previous&nbsp;posts.&nbsp;&nbsp;Change&nbsp;the&nbsp;commands/config&nbsp;to&nbsp;fir&nbsp;where&nbsp;your&nbsp;squid&nbsp;config&nbsp;and&nbsp;ssl_db&nbsp;are.&nbsp;&nbsp;So&nbsp;after&nbsp;configuring,&nbsp;make&nbsp;sure&nbsp;you:&lt;BR&gt;<br>
&lt;BR&gt;<br>
sudo&nbsp;/opt/libexec/ssl_crtd&nbsp;-c&nbsp;-s&nbsp;/opt/var/ssl_db&lt;BR&gt;<br>
sudo&nbsp;chown&nbsp;-R&nbsp;nobody&nbsp;/opt/var/ssl_db/&lt;BR&gt;<br>
&lt;BR&gt;<br>
As&nbsp;I&nbsp;believe&nbsp;in&nbsp;a&nbsp;lot&nbsp;of&nbsp;logging,&nbsp;and&nbsp;actually&nbsp;looking&nbsp;at&nbsp;said&nbsp;logging,&nbsp;below&nbsp;is&nbsp;what&nbsp;you&nbsp;can&nbsp;expect&nbsp;to&nbsp;see&nbsp;in&nbsp;your&nbsp;logs&nbsp;(mine&nbsp;logs&nbsp;to&nbsp;syslog,&nbsp;again,&nbsp;change&nbsp;this&nbsp;if&nbsp;you&nbsp;log&nbsp;to&nbsp;a&nbsp;different&nbsp;file):&lt;BR&gt;<br>
&lt;BR&gt;<br>
Allowed&nbsp;http&nbsp;to&nbsp;.apple.com&nbsp;in&nbsp;http_url.txt:&lt;BR&gt;<br>
&lt;TT&gt;May&nbsp;31&nbsp;17:03:48&nbsp;gateway&nbsp;(squid-1):&nbsp;192.168.1.100&nbsp;-&nbsp;-&nbsp;[31/May/2015:17:03:48&nbsp;-0600]&nbsp;&quot;GET&nbsp;&lt;A&nbsp;HREF=&quot;http://init.ess.apple.com/WebObjects/VCInit.woa/wa/getBag?&quot;&gt;http://init.ess.apple.com/WebObjects/VCInit.woa/wa/getBag?&lt;/A&gt;&nbsp;HTTP/1.1&quot;&nbsp;-&nbsp;-&nbsp;200&nbsp;5243&nbsp;TCP_MISS:ORIGINAL_DST&nbsp;-&lt;/TT&gt;&lt;BR&gt;<br>
Denied&nbsp;http&nbsp;to&nbsp;symcb.com&nbsp;not&nbsp;in&nbsp;http_url.txt&lt;BR&gt;<br>
&lt;TT&gt;May&nbsp;31&nbsp;17:03:48&nbsp;gateway&nbsp;(squid-1):&nbsp;192.168.1.100&nbsp;-&nbsp;-&nbsp;[31/May/2015:17:03:48&nbsp;-0600]&nbsp;&quot;GET&nbsp;&lt;A&nbsp;HREF=&quot;http://sd.symcb.com/sd.crt&quot;&gt;http://sd.symcb.com/sd.crt&lt;/A&gt;&nbsp;HTTP/1.1&quot;&nbsp;-&nbsp;-&nbsp;403&nbsp;3618&nbsp;TCP_DENIED:HIER_NONE&nbsp;-&lt;/TT&gt;&lt;BR&gt;<br>
Spliced&nbsp;https&nbsp;IP&nbsp;in&nbsp;broken.txt&nbsp;(google&nbsp;block&nbsp;216.58.192.0/19)&lt;BR&gt;<br>
&lt;TT&gt;May&nbsp;31&nbsp;17:04:34&nbsp;gateway&nbsp;(squid-1):&nbsp;192.168.1.101&nbsp;-&nbsp;-&nbsp;[31/May/2015:17:04:34&nbsp;-0600]&nbsp;&quot;CONNECT&nbsp;216.58.216.138:443&nbsp;HTTP/1.1&quot;&nbsp;-&nbsp;-&nbsp;200&nbsp;568&nbsp;TCP_TUNNEL:ORIGINAL_DST&nbsp;peek&lt;/TT&gt;&lt;BR&gt;<br>
Spliced&nbsp;https&nbsp;IP&nbsp;in&nbsp;broken.txt&nbsp;that&nbsp;we&nbsp;got&nbsp;SNI&nbsp;or&nbsp;bumped&nbsp;site&nbsp;in&nbsp;http_url.txt&nbsp;look&nbsp;exactly&nbsp;the&nbsp;same&lt;BR&gt;<br>
&lt;TT&gt;May&nbsp;31&nbsp;17:09:45&nbsp;gateway&nbsp;(squid-1):&nbsp;192.168.1.100&nbsp;-&nbsp;-&nbsp;[31/May/2015:17:09:45&nbsp;-0600]&nbsp;&quot;CONNECT&nbsp;23.222.157.21:443&nbsp;HTTP/1.1&quot;&nbsp;init.itunes.apple.com&nbsp;-&nbsp;200&nbsp;30314&nbsp;TCP_TUNNEL:ORIGINAL_DST&nbsp;peek&lt;/TT&gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
The&nbsp;only&nbsp;drag&nbsp;with&nbsp;the&nbsp;configuration&nbsp;is&nbsp;you&nbsp;won't&nbsp;see&nbsp;when&nbsp;an&nbsp;https&nbsp;session&nbsp;is&nbsp;terminated&nbsp;when&nbsp;the&nbsp;IP/url&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;broken.txt,&nbsp;or&nbsp;the&nbsp;http_url.txt:&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;TT&gt;[17:20:53&nbsp;jlay@analysis:~$]&nbsp;wget&nbsp;-d&nbsp;--ca-certificate=/etc/ssl/certs/sslsplit.crt&nbsp;&lt;A&nbsp;HREF=&quot;https://www.yahoo.com&quot;&gt;https://www.yahoo.com&lt;/A&gt;&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;Setting&nbsp;--ca-certificate&nbsp;(cacertificate)&nbsp;to&nbsp;/etc/ssl/certs/sslsplit.crt&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;DEBUG&nbsp;output&nbsp;created&nbsp;by&nbsp;Wget&nbsp;1.16.1&nbsp;on&nbsp;linux-gnu.&lt;/TT&gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;TT&gt;URI&nbsp;encoding&nbsp;=&nbsp;&#8216;UTF-8&#8217;&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;--2015-05-31&nbsp;17:20:59--&nbsp;&nbsp;&lt;A&nbsp;HREF=&quot;https://www.yahoo.com/&quot;&gt;https://www.yahoo.com/&lt;/A&gt;&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;Resolving&nbsp;&lt;A&nbsp;HREF=&quot;http://www.yahoo.com&quot;&gt;www.yahoo.com&lt;/A&gt;&nbsp;(&lt;A&nbsp;HREF=&quot;http://www.yahoo.com&quot;&gt;www.yahoo.com&lt;/A&gt;)...&nbsp;206.190.36.45,&nbsp;206.190.36.105,&nbsp;2001:4998:c:a06::2:4008&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;Caching&nbsp;&lt;A&nbsp;HREF=&quot;http://www.yahoo.com&quot;&gt;www.yahoo.com&lt;/A&gt;&nbsp;=&gt;&nbsp;206.190.36.45&nbsp;206.190.36.105&nbsp;2001:4998:c:a06::2:4008&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;Connecting&nbsp;to&nbsp;&lt;A&nbsp;HREF=&quot;http://www.yahoo.com&quot;&gt;www.yahoo.com&lt;/A&gt;&nbsp;(&lt;A&nbsp;HREF=&quot;http://www.yahoo.com&quot;&gt;www.yahoo.com&lt;/A&gt;)|206.190.36.45|:443...&nbsp;connected.&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;Created&nbsp;socket&nbsp;3.&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;Releasing&nbsp;0x00007fdf67eecdd0&nbsp;(new&nbsp;refcount&nbsp;1).&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;Initiating&nbsp;SSL&nbsp;handshake.&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;SSL&nbsp;handshake&nbsp;failed.&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;Closed&nbsp;fd&nbsp;3&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;Unable&nbsp;to&nbsp;establish&nbsp;SSL&nbsp;connection.&lt;/TT&gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;TT&gt;May&nbsp;31&nbsp;17:20:59&nbsp;gateway&nbsp;(squid-1):&nbsp;192.168.1.6&nbsp;-&nbsp;-&nbsp;[31/May/2015:17:20:59&nbsp;-0600]&nbsp;&quot;CONNECT&nbsp;206.190.36.45:443&nbsp;HTTP/1.1&quot;&nbsp;www.yahoo.com&nbsp;-&nbsp;200&nbsp;0&nbsp;TAG_NONE:ORIGINAL_DST&nbsp;peek&nbsp;&lt;/TT&gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
Full&nbsp;config&nbsp;below:&lt;BR&gt;<br>
####################################&lt;BR&gt;<br>
&lt;TT&gt;acl&nbsp;localnet&nbsp;src&nbsp;192.168.1.0/24&lt;/TT&gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;TT&gt;acl&nbsp;SSL_ports&nbsp;port&nbsp;443&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;80&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;443&lt;/TT&gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;TT&gt;acl&nbsp;CONNECT&nbsp;method&nbsp;CONNECT&lt;/TT&gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;TT&gt;acl&nbsp;allowed_http_sites&nbsp;url_regex&nbsp;&quot;/opt/etc/squid/http_url.txt&quot;&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;acl&nbsp;allow_https&nbsp;port&nbsp;443&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;acl&nbsp;broken&nbsp;dst&nbsp;&quot;/opt/etc/squid/broken.txt&quot;&lt;/TT&gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;TT&gt;http_access&nbsp;deny&nbsp;!Safe_ports&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;http_access&nbsp;deny&nbsp;CONNECT&nbsp;!SSL_Ports&lt;/TT&gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;TT&gt;http_access&nbsp;allow&nbsp;allow_https&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;http_access&nbsp;allow&nbsp;allowed_http_sites&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;http_access&nbsp;deny&nbsp;!allowed_http_sites&lt;/TT&gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;TT&gt;http_access&nbsp;deny&nbsp;all&lt;/TT&gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;TT&gt;acl&nbsp;step1&nbsp;at_step&nbsp;SslBump1&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;acl&nbsp;step2&nbsp;at_step&nbsp;SslBump2&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;acl&nbsp;step3&nbsp;at_step&nbsp;SslBump3&lt;/TT&gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;TT&gt;ssl_bump&nbsp;peek&nbsp;step1&nbsp;broken&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;ssl_bump&nbsp;peek&nbsp;step2&nbsp;broken&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;ssl_bump&nbsp;splice&nbsp;broken&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;ssl_bump&nbsp;peek&nbsp;step1&nbsp;all&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;ssl_bump&nbsp;peek&nbsp;step2&nbsp;all&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;acl&nbsp;allowed_https_sites&nbsp;ssl::server_name_regex&nbsp;&quot;/opt/etc/squid/http_url.txt&quot;&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;ssl_bump&nbsp;bump&nbsp;allowed_https_sites&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;ssl_bump&nbsp;terminate&nbsp;!allowed_https_sites&lt;/TT&gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;TT&gt;sslproxy_cert_error&nbsp;allow&nbsp;all&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;sslproxy_capath&nbsp;/etc/ssl/certs&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;sslproxy_flags&nbsp;DONT_VERIFY_PEER&nbsp;&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;sslproxy_options&nbsp;ALL&lt;/TT&gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;TT&gt;sslcrtd_program&nbsp;/opt/libexec/ssl_crtd&nbsp;-s&nbsp;/opt/var/ssl_db&nbsp;-M&nbsp;4MB&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;sslcrtd_children&nbsp;5&lt;/TT&gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;TT&gt;http_port&nbsp;3128&nbsp;intercept&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;https_port&nbsp;3129&nbsp;intercept&nbsp;ssl-bump&nbsp;cert=/opt/etc/squid/certs/sslsplit_ca_cert.pem&nbsp;cafile=/opt/etc/squid/certs/sslsplit_ca_cert.pem&nbsp;key=/opt/etc/squid/certs/sslsplit_ca_key.pem&nbsp;&nbsp;generate-host-certificates=on&nbsp;dynamic_cert_mem_cache_size=4MB&nbsp;sslflags=NO_SESSION_REUSE&lt;/TT&gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;TT&gt;logformat&nbsp;mine&nbsp;%&gt;a&nbsp;%[ui&nbsp;%[un&nbsp;[%tl]&nbsp;&quot;%rm&nbsp;%ru&nbsp;HTTP/%rv&quot;&nbsp;%ssl::&gt;sni&nbsp;%ssl::&gt;cert_subject&nbsp;%&gt;Hs&nbsp;%&lt;st&nbsp;%Ss:%Sh&nbsp;%ssl::bump_mode&nbsp;&lt;/TT&gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;TT&gt;access_log&nbsp;syslog:daemon.info&nbsp;mine&lt;/TT&gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;TT&gt;refresh_pattern&nbsp;-i&nbsp;(cgi-bin|\?)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;refresh_pattern&nbsp;.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;20%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4320&lt;/TT&gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;TT&gt;coredump_dir&nbsp;/opt/var&lt;/TT&gt;&lt;BR&gt;<br>
##############################&lt;BR&gt;<br>
&lt;BR&gt;<br>
Thanks&nbsp;all&nbsp;for&nbsp;being&nbsp;patient&nbsp;while&nbsp;I&nbsp;continued&nbsp;to&nbsp;post&nbsp;my&nbsp;learning&nbsp;and&nbsp;all&nbsp;my&nbsp;mistakes.&nbsp;&nbsp;If&nbsp;there's&nbsp;anything&nbsp;that&nbsp;I've&nbsp;missed,&nbsp;or&nbsp;if&nbsp;there's&nbsp;another&nbsp;method&nbsp;for&nbsp;trying&nbsp;to&nbsp;accomplish&nbsp;what&nbsp;I've&nbsp;tried&nbsp;to&nbsp;do&nbsp;I'm&nbsp;all&nbsp;eyes.&lt;BR&gt;<br>
&lt;BR&gt;<br>
James&lt;BR&gt;<br>
&lt;BR&gt;<br>
P.S.&nbsp;Things&nbsp;I'd&nbsp;love&nbsp;to&nbsp;see&nbsp;in&nbsp;Squid&nbsp;some&nbsp;day:&lt;BR&gt;<br>
&lt;BR&gt;<br>
acl's&nbsp;being&nbsp;AND'd&nbsp;(http_access&nbsp;allow&nbsp;allowed_sites&nbsp;AND&nbsp;localnet)&lt;BR&gt;<br>
Full&nbsp;on&nbsp;separate&nbsp;http_access,&nbsp;https_access&nbsp;directives&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;/BODY&gt;<br>
&lt;/HTML&gt;<br>

</tt>
