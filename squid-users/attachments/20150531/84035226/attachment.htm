<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.0&nbsp;TRANSITIONAL//EN&quot;&gt;<br>
&lt;HTML&gt;<br>
&lt;HEAD&gt;<br>
&nbsp;&nbsp;&lt;META&nbsp;HTTP-EQUIV=&quot;Content-Type&quot;&nbsp;CONTENT=&quot;text/html;&nbsp;CHARSET=UTF-8&quot;&gt;<br>
&nbsp;&nbsp;&lt;META&nbsp;NAME=&quot;GENERATOR&quot;&nbsp;CONTENT=&quot;GtkHTML/4.6.6&quot;&gt;<br>
&lt;/HEAD&gt;<br>
&lt;BODY&gt;<br>
On&nbsp;Mon,&nbsp;2015-06-01&nbsp;at&nbsp;13:00&nbsp;+1200,&nbsp;Amos&nbsp;Jeffries&nbsp;wrote:<br>
&lt;BLOCKQUOTE&nbsp;TYPE=CITE&gt;<br>
&lt;PRE&gt;<br>
On&nbsp;1/06/2015&nbsp;11:56&nbsp;a.m.,&nbsp;James&nbsp;Lay&nbsp;wrote:<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;So&nbsp;this&nbsp;has&nbsp;been&nbsp;REALLY&nbsp;good!&nbsp;&nbsp;The&nbsp;tl;dr:&nbsp;&nbsp;ssl-bumping&nbsp;is&nbsp;pretty&nbsp;easy&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;even&nbsp;with&nbsp;intercept,&nbsp;ssl-bumping&nbsp;with&nbsp;access&nbsp;control&nbsp;is&nbsp;a&nbsp;little&nbsp;more&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;difficult...jump&nbsp;to&nbsp;the&nbsp;config&nbsp;to&nbsp;skip&nbsp;the&nbsp;chit&nbsp;chat.&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;My&nbsp;goal&nbsp;has&nbsp;always&nbsp;been&nbsp;to&nbsp;a&nbsp;content&nbsp;filter&nbsp;based&nbsp;on&nbsp;url&nbsp;regex.&nbsp;&nbsp;This&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;works&nbsp;just&nbsp;fine&nbsp;for&nbsp;http&nbsp;traffic,&nbsp;but&nbsp;is&nbsp;much&nbsp;more&nbsp;difficult&nbsp;for&nbsp;https&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;traffic&nbsp;just&nbsp;for&nbsp;the&nbsp;case&nbsp;of&nbsp;you&nbsp;may&nbsp;or&nbsp;may&nbsp;not&nbsp;know&nbsp;the&nbsp;host&nbsp;you're&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;going&nbsp;to,&nbsp;depending&nbsp;on&nbsp;the&nbsp;site/app.&nbsp;&nbsp;I'll&nbsp;be&nbsp;real&nbsp;honest&nbsp;here....I'm&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;only&nbsp;doing&nbsp;this&nbsp;to&nbsp;protect/filter&nbsp;the&nbsp;traffic&nbsp;of&nbsp;two&nbsp;kids,&nbsp;on&nbsp;laptops,&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;iPhone,&nbsp;and&nbsp;Android&nbsp;phone,&nbsp;so&nbsp;it's&nbsp;a&nbsp;mixed&nbsp;bag&nbsp;of&nbsp;content&nbsp;and,&nbsp;since&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;it's&nbsp;just&nbsp;the&nbsp;two&nbsp;of&nbsp;them&nbsp;in&nbsp;a&nbsp;home&nbsp;environment,&nbsp;I&nbsp;get&nbsp;to&nbsp;play&nbsp;around&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;and&nbsp;see&nbsp;what&nbsp;works&nbsp;and&nbsp;what&nbsp;doesn't.&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;Below&nbsp;is&nbsp;a&nbsp;close&nbsp;as&nbsp;I&nbsp;can&nbsp;get&nbsp;transparent&nbsp;intercept&nbsp;ssl-bump&nbsp;with&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;content&nbsp;filtering&nbsp;with&nbsp;using&nbsp;a&nbsp;list&nbsp;of&nbsp;domains/urls&nbsp;with&nbsp;both&nbsp;http&nbsp;and&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;https.&nbsp;&nbsp;I&nbsp;still&nbsp;have&nbsp;to&nbsp;use&nbsp;a&nbsp;list&nbsp;of&nbsp;broken&nbsp;sites,&nbsp;which&nbsp;are&nbsp;large&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;netblocks&nbsp;(17.0.0.0/8..Apple&nbsp;anyone?)&nbsp;because&nbsp;some&nbsp;of&nbsp;these&nbsp;I&nbsp;just&nbsp;can't&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;seem&nbsp;to&nbsp;get&nbsp;host/domain&nbsp;information&nbsp;during&nbsp;the&nbsp;ssl&nbsp;handshake.&nbsp;&nbsp;As&nbsp;I&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;discovered&nbsp;after&nbsp;attempting&nbsp;to&nbsp;put&nbsp;this&nbsp;into&nbsp;&quot;production&quot;,&nbsp;I&nbsp;have&nbsp;not&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;been&nbsp;able&nbsp;to&nbsp;emulate&nbsp;using&nbsp;wget&nbsp;or&nbsp;curl&nbsp;an&nbsp;https&nbsp;session&nbsp;that&nbsp;doesn't&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;have&nbsp;any&nbsp;SNI&nbsp;information,&nbsp;so&nbsp;that&nbsp;threw&nbsp;me&nbsp;for&nbsp;a&nbsp;loop.&nbsp;&nbsp;TextNow&nbsp;is&nbsp;a&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;great&nbsp;example&nbsp;(I'm&nbsp;including&nbsp;a&nbsp;packet&nbsp;capture&nbsp;of&nbsp;this&nbsp;in&nbsp;this&nbsp;post).&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;There's&nbsp;no&nbsp;host&nbsp;information&nbsp;in&nbsp;the&nbsp;client&nbsp;hello....there's&nbsp;no&nbsp;host&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;information&nbsp;in&nbsp;the&nbsp;server&nbsp;hello.....buried&nbsp;deep&nbsp;in&nbsp;the&nbsp;certificate&nbsp;ONLY&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;is&nbsp;the&nbsp;&quot;commonName=.*textnow.me&quot;...that's&nbsp;it.&nbsp;&nbsp;This&nbsp;dashed&nbsp;my&nbsp;hopes&nbsp;of&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;using&nbsp;an&nbsp;url_regex&nbsp;for&nbsp;access&nbsp;control&nbsp;with&nbsp;all&nbsp;https&nbsp;sessions.&nbsp;&nbsp;I&nbsp;have&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&quot;%ssl::&gt;cert_subject&quot;&nbsp;in&nbsp;my&nbsp;logging,&nbsp;and&nbsp;I&nbsp;never&nbsp;did&nbsp;see&nbsp;this&nbsp;log&nbsp;in&nbsp;any&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;of&nbsp;my&nbsp;tests...and&nbsp;I&nbsp;tested&nbsp;a&nbsp;BUNCH&nbsp;of&nbsp;different&nbsp;peek/stare/splice/bump&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;cominations..so&nbsp;I&nbsp;don't&nbsp;think&nbsp;squid&nbsp;is&nbsp;actually&nbsp;seeing&nbsp;this&nbsp;from&nbsp;the&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;certificate.&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;Another&nbsp;challenge&nbsp;is&nbsp;getting&nbsp;http&nbsp;url_regex&nbsp;filtering&nbsp;to&nbsp;work&nbsp;with&nbsp;https&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;filtering.&nbsp;&nbsp;My&nbsp;method&nbsp;of&nbsp;filtering&nbsp;means&nbsp;not&nbsp;having&nbsp;an&nbsp;&quot;http_access&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;allow&nbsp;localnet&quot;,&nbsp;which&nbsp;directly&nbsp;conflicted&nbsp;with&nbsp;also&nbsp;trying&nbsp;to&nbsp;filter&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;https.&nbsp;&nbsp;The&nbsp;solution&nbsp;was&nbsp;to&nbsp;add&nbsp;an&nbsp;acl&nbsp;for&nbsp;port&nbsp;443,&nbsp;then&nbsp;http_access&nbsp;to&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;just&nbsp;allow&nbsp;it,&nbsp;as&nbsp;our&nbsp;filtering&nbsp;was&nbsp;going&nbsp;to&nbsp;happen&nbsp;for&nbsp;https&nbsp;further&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;down.&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;I&nbsp;know&nbsp;there's&nbsp;a&nbsp;fair&nbsp;amount&nbsp;of&nbsp;people&nbsp;who&nbsp;just&nbsp;want&nbsp;to&nbsp;plop&nbsp;in&nbsp;some&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;config&nbsp;files,&nbsp;run&nbsp;a&nbsp;few&nbsp;commands,&nbsp;and&nbsp;be&nbsp;up&nbsp;and&nbsp;running.&nbsp;&nbsp;The&nbsp;below&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;configuration&nbsp;has&nbsp;two&nbsp;additional&nbsp;files&nbsp;it&nbsp;references,&nbsp;http_url.txt,&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;which&nbsp;is&nbsp;an&nbsp;a&nbsp;list&nbsp;of&nbsp;domains/urls&nbsp;(\.apple\.com&nbsp;for&nbsp;example),&nbsp;and&nbsp;the&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;aptly&nbsp;named&nbsp;broken,&nbsp;which&nbsp;is&nbsp;a&nbsp;IP&nbsp;list&nbsp;(17.0.0.0/8).&nbsp;&nbsp;The&nbsp;broken&nbsp;list&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;should&nbsp;be&nbsp;(semi)&nbsp;trusted&nbsp;and&nbsp;are&nbsp;sites&nbsp;that&nbsp;we&nbsp;just&nbsp;can't&nbsp;get&nbsp;SNI&nbsp;or&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;hostname&nbsp;information&nbsp;from.&nbsp;&nbsp;If&nbsp;you've&nbsp;created&nbsp;a&nbsp;single&nbsp;cert/key&nbsp;pair&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;from&nbsp;the&nbsp;Squid&nbsp;documentation,&nbsp;you&nbsp;won't&nbsp;need&nbsp;the&nbsp;key=&nbsp;line&nbsp;in&nbsp;your&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;https_port&nbsp;directive.&nbsp;&nbsp;If&nbsp;you've&nbsp;followed&nbsp;along&nbsp;in&nbsp;my&nbsp;posts,&nbsp;you&nbsp;already&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;have&nbsp;the&nbsp;configure&nbsp;line&nbsp;from&nbsp;my&nbsp;previous&nbsp;posts.&nbsp;&nbsp;Change&nbsp;the&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;commands/config&nbsp;to&nbsp;fir&nbsp;where&nbsp;your&nbsp;squid&nbsp;config&nbsp;and&nbsp;ssl_db&nbsp;are.&nbsp;&nbsp;So&nbsp;after&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;configuring,&nbsp;make&nbsp;sure&nbsp;you:&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;sudo&nbsp;/opt/libexec/ssl_crtd&nbsp;-c&nbsp;-s&nbsp;/opt/var/ssl_db&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;sudo&nbsp;chown&nbsp;-R&nbsp;nobody&nbsp;/opt/var/ssl_db/&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;As&nbsp;I&nbsp;believe&nbsp;in&nbsp;a&nbsp;lot&nbsp;of&nbsp;logging,&nbsp;and&nbsp;actually&nbsp;looking&nbsp;at&nbsp;said&nbsp;logging,&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;below&nbsp;is&nbsp;what&nbsp;you&nbsp;can&nbsp;expect&nbsp;to&nbsp;see&nbsp;in&nbsp;your&nbsp;logs&nbsp;(mine&nbsp;logs&nbsp;to&nbsp;syslog,&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;again,&nbsp;change&nbsp;this&nbsp;if&nbsp;you&nbsp;log&nbsp;to&nbsp;a&nbsp;different&nbsp;file):&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;Allowed&nbsp;http&nbsp;to&nbsp;.apple.com&nbsp;in&nbsp;http_url.txt:&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;May&nbsp;31&nbsp;17:03:48&nbsp;gateway&nbsp;(squid-1):&nbsp;192.168.1.100&nbsp;-&nbsp;-&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;[31/May/2015:17:03:48&nbsp;-0600]&nbsp;&quot;GET&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;A&nbsp;HREF=&quot;http://init.ess.apple.com/WebObjects/VCInit.woa/wa/getBag&quot;&gt;http://init.ess.apple.com/WebObjects/VCInit.woa/wa/getBag&lt;/A&gt;?&nbsp;HTTP/1.1&quot;&nbsp;-&nbsp;-&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;200&nbsp;5243&nbsp;TCP_MISS:ORIGINAL_DST&nbsp;-&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;Denied&nbsp;http&nbsp;to&nbsp;symcb.com&nbsp;not&nbsp;in&nbsp;http_url.txt&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;May&nbsp;31&nbsp;17:03:48&nbsp;gateway&nbsp;(squid-1):&nbsp;192.168.1.100&nbsp;-&nbsp;-&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;[31/May/2015:17:03:48&nbsp;-0600]&nbsp;&quot;GET&nbsp;&lt;A&nbsp;HREF=&quot;http://sd.symcb.com/sd.crt&quot;&gt;http://sd.symcb.com/sd.crt&lt;/A&gt;&nbsp;HTTP/1.1&quot;&nbsp;-&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;-&nbsp;403&nbsp;3618&nbsp;TCP_DENIED:HIER_NONE&nbsp;-&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;Spliced&nbsp;https&nbsp;IP&nbsp;in&nbsp;broken.txt&nbsp;(google&nbsp;block&nbsp;216.58.192.0/19)&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;May&nbsp;31&nbsp;17:04:34&nbsp;gateway&nbsp;(squid-1):&nbsp;192.168.1.101&nbsp;-&nbsp;-&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;[31/May/2015:17:04:34&nbsp;-0600]&nbsp;&quot;CONNECT&nbsp;216.58.216.138:443&nbsp;HTTP/1.1&quot;&nbsp;-&nbsp;-&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;200&nbsp;568&nbsp;TCP_TUNNEL:ORIGINAL_DST&nbsp;peek&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;Spliced&nbsp;https&nbsp;IP&nbsp;in&nbsp;broken.txt&nbsp;that&nbsp;we&nbsp;got&nbsp;SNI&nbsp;or&nbsp;bumped&nbsp;site&nbsp;in&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;http_url.txt&nbsp;look&nbsp;exactly&nbsp;the&nbsp;same&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;May&nbsp;31&nbsp;17:09:45&nbsp;gateway&nbsp;(squid-1):&nbsp;192.168.1.100&nbsp;-&nbsp;-&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;[31/May/2015:17:09:45&nbsp;-0600]&nbsp;&quot;CONNECT&nbsp;23.222.157.21:443&nbsp;HTTP/1.1&quot;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;init.itunes.apple.com&nbsp;-&nbsp;200&nbsp;30314&nbsp;TCP_TUNNEL:ORIGINAL_DST&nbsp;peek&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;The&nbsp;only&nbsp;drag&nbsp;with&nbsp;the&nbsp;configuration&nbsp;is&nbsp;you&nbsp;won't&nbsp;see&nbsp;when&nbsp;an&nbsp;https&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;session&nbsp;is&nbsp;terminated&nbsp;when&nbsp;the&nbsp;IP/url&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;broken.txt,&nbsp;or&nbsp;the&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;http_url.txt:&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;[17:20:53&nbsp;jlay@analysis:~$]&nbsp;wget&nbsp;-d&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;--ca-certificate=/etc/ssl/certs/sslsplit.crt&nbsp;&lt;A&nbsp;HREF=&quot;https://www.yahoo.com&quot;&gt;https://www.yahoo.com&lt;/A&gt;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;Setting&nbsp;--ca-certificate&nbsp;(cacertificate)&nbsp;to&nbsp;/etc/ssl/certs/sslsplit.crt&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;DEBUG&nbsp;output&nbsp;created&nbsp;by&nbsp;Wget&nbsp;1.16.1&nbsp;on&nbsp;linux-gnu.&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;URI&nbsp;encoding&nbsp;=&nbsp;&#8216;UTF-8&#8217;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;--2015-05-31&nbsp;17:20:59--&nbsp;&nbsp;&lt;A&nbsp;HREF=&quot;https://www.yahoo.com/&quot;&gt;https://www.yahoo.com/&lt;/A&gt;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;Resolving&nbsp;&lt;A&nbsp;HREF=&quot;http://www.yahoo.com&quot;&gt;www.yahoo.com&lt;/A&gt;&nbsp;(&lt;A&nbsp;HREF=&quot;http://www.yahoo.com&quot;&gt;www.yahoo.com&lt;/A&gt;)...&nbsp;206.190.36.45,&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;206.190.36.105,&nbsp;2001:4998:c:a06::2:4008&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;Caching&nbsp;&lt;A&nbsp;HREF=&quot;http://www.yahoo.com&quot;&gt;www.yahoo.com&lt;/A&gt;&nbsp;=&gt;&nbsp;206.190.36.45&nbsp;206.190.36.105&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;2001:4998:c:a06::2:4008&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;Connecting&nbsp;to&nbsp;&lt;A&nbsp;HREF=&quot;http://www.yahoo.com&quot;&gt;www.yahoo.com&lt;/A&gt;&nbsp;(&lt;A&nbsp;HREF=&quot;http://www.yahoo.com&quot;&gt;www.yahoo.com&lt;/A&gt;)|206.190.36.45|:443...&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;connected.&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;Created&nbsp;socket&nbsp;3.&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;Releasing&nbsp;0x00007fdf67eecdd0&nbsp;(new&nbsp;refcount&nbsp;1).&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;Initiating&nbsp;SSL&nbsp;handshake.&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;SSL&nbsp;handshake&nbsp;failed.&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;Closed&nbsp;fd&nbsp;3&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;Unable&nbsp;to&nbsp;establish&nbsp;SSL&nbsp;connection.&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;May&nbsp;31&nbsp;17:20:59&nbsp;gateway&nbsp;(squid-1):&nbsp;192.168.1.6&nbsp;-&nbsp;-&nbsp;[31/May/2015:17:20:59&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;-0600]&nbsp;&quot;CONNECT&nbsp;206.190.36.45:443&nbsp;HTTP/1.1&quot;&nbsp;&lt;A&nbsp;HREF=&quot;http://www.yahoo.com&quot;&gt;www.yahoo.com&lt;/A&gt;&nbsp;-&nbsp;200&nbsp;0&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;TAG_NONE:ORIGINAL_DST&nbsp;peek&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;Full&nbsp;config&nbsp;below:&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;####################################&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;acl&nbsp;localnet&nbsp;src&nbsp;192.168.1.0/24&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;acl&nbsp;SSL_ports&nbsp;port&nbsp;443&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;80&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;443&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;acl&nbsp;CONNECT&nbsp;method&nbsp;CONNECT&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;acl&nbsp;allowed_http_sites&nbsp;url_regex&nbsp;&quot;/opt/etc/squid/http_url.txt&quot;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;acl&nbsp;allow_https&nbsp;port&nbsp;443&lt;/FONT&gt;<br>
<br>
Note&nbsp;how&nbsp;SSL_ports&nbsp;and&nbsp;allow_https&nbsp;ACL&nbsp;definitions&nbsp;are&nbsp;identical&nbsp;apart<br>
from&nbsp;the&nbsp;name.<br>
<br>
You&nbsp;can&nbsp;replace&nbsp;all&nbsp;uses&nbsp;of&nbsp;&quot;allow_https&quot;&nbsp;ACL&nbsp;in&nbsp;the&nbsp;rest&nbsp;of&nbsp;your&nbsp;config<br>
with&nbsp;&quot;SSL_Ports&quot;.<br>
<br>
<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;acl&nbsp;broken&nbsp;dst&nbsp;&quot;/opt/etc/squid/broken.txt&quot;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;http_access&nbsp;deny&nbsp;!Safe_ports&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;http_access&nbsp;deny&nbsp;CONNECT&nbsp;!SSL_Ports&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;http_access&nbsp;allow&nbsp;allow_https&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;http_access&nbsp;allow&nbsp;allowed_http_sites&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;http_access&nbsp;deny&nbsp;!allowed_http_sites&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;http_access&nbsp;deny&nbsp;all&lt;/FONT&gt;<br>
<br>
Two&nbsp;deny&nbsp;lines&nbsp;in&nbsp;a&nbsp;row&nbsp;are&nbsp;redundant&nbsp;when&nbsp;one&nbsp;is&nbsp;&quot;deny&nbsp;all&quot;.<br>
<br>
You&nbsp;can&nbsp;drop&nbsp;the&nbsp;&quot;deny&nbsp;!allowed_http_sites&quot;.<br>
<br>
<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;acl&nbsp;step1&nbsp;at_step&nbsp;SslBump1&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;acl&nbsp;step2&nbsp;at_step&nbsp;SslBump2&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;acl&nbsp;step3&nbsp;at_step&nbsp;SslBump3&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;ssl_bump&nbsp;peek&nbsp;step1&nbsp;broken&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;ssl_bump&nbsp;peek&nbsp;step2&nbsp;broken&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;ssl_bump&nbsp;splice&nbsp;broken&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;ssl_bump&nbsp;peek&nbsp;step1&nbsp;all&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;ssl_bump&nbsp;peek&nbsp;step2&nbsp;all&lt;/FONT&gt;<br>
<br>
The&nbsp;above&nbsp;lines&nbsp;are&nbsp;logically&nbsp;the&nbsp;same&nbsp;as:<br>
<br>
&nbsp;ssl_bump&nbsp;splice&nbsp;step3&nbsp;broken<br>
&nbsp;ssl_bump&nbsp;peek&nbsp;all<br>
<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;acl&nbsp;allowed_https_sites&nbsp;ssl::server_name_regex&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&quot;/opt/etc/squid/http_url.txt&quot;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;ssl_bump&nbsp;bump&nbsp;allowed_https_sites&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;ssl_bump&nbsp;terminate&nbsp;!allowed_https_sites&lt;/FONT&gt;<br>
<br>
If&nbsp;you&nbsp;used&nbsp;reject&nbsp;instead&nbsp;of&nbsp;terminate&nbsp;on&nbsp;this&nbsp;rule,&nbsp;you&nbsp;should&nbsp;get&nbsp;the<br>
log&nbsp;entries&nbsp;you&nbsp;mentioned&nbsp;wanting&nbsp;when&nbsp;connections&nbsp;are&nbsp;terminated.<br>
<br>
The&nbsp;not&nbsp;logging&nbsp;of&nbsp;&quot;terminate&quot;&nbsp;connectisno&nbsp;is&nbsp;a&nbsp;bug.&nbsp;Please&nbsp;report&nbsp;to<br>
bugzilla&nbsp;so&nbsp;we&nbsp;dont&nbsp;forget&nbsp;it.<br>
<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;sslproxy_cert_error&nbsp;allow&nbsp;all&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;sslproxy_capath&nbsp;/etc/ssl/certs&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;sslproxy_flags&nbsp;DONT_VERIFY_PEER&nbsp;&lt;/FONT&gt;<br>
<br>
The&nbsp;point&nbsp;of&nbsp;TLS&nbsp;is&nbsp;to&nbsp;verify&nbsp;the&nbsp;other&nbsp;endpoint&nbsp;of&nbsp;the&nbsp;connection&nbsp;is<br>
actually&nbsp;who&nbsp;they&nbsp;claim&nbsp;to&nbsp;be.&nbsp;The&nbsp;above&nbsp;config&nbsp;settings&nbsp;are&nbsp;a)&nbsp;not<br>
bothering&nbsp;to&nbsp;even&nbsp;check&nbsp;the&nbsp;claim,&nbsp;and&nbsp;b)&nbsp;silently&nbsp;ignoring&nbsp;whatever<br>
result&nbsp;the&nbsp;security&nbsp;check&nbsp;produces.<br>
<br>
*&nbsp;DONT_VERIFY_PEER&nbsp;is&nbsp;a&nbsp;debugging&nbsp;option.&nbsp;Not&nbsp;for&nbsp;use&nbsp;in&nbsp;&quot;production&quot;<br>
systems.&nbsp;It&nbsp;should&nbsp;not&nbsp;even&nbsp;be&nbsp;used&nbsp;in&nbsp;any&nbsp;real&nbsp;operational&nbsp;testing,<br>
only&nbsp;to&nbsp;see&nbsp;if&nbsp;the&nbsp;peer&nbsp;verification&nbsp;failures&nbsp;was&nbsp;the&nbsp;source&nbsp;of&nbsp;an&nbsp;issue.<br>
<br>
*&nbsp;sslproxy_cert_error&nbsp;allow&nbsp;all&nbsp;-&nbsp;is&nbsp;pure&nbsp;evil.&nbsp;The&nbsp;directive&nbsp;was&nbsp;only<br>
added&nbsp;so&nbsp;networks&nbsp;could&nbsp;continue&nbsp;to&nbsp;work&nbsp;during&nbsp;transition&nbsp;periods&nbsp;when<br>
a&nbsp;major&nbsp;vulnerability&nbsp;like&nbsp;CRIME/&nbsp;BREECH&nbsp;/&nbsp;POODLE&nbsp;were&nbsp;discovered&nbsp;and<br>
their&nbsp;library&nbsp;started&nbsp;erroring&nbsp;out&nbsp;on&nbsp;bad&nbsp;bevahiour,&nbsp;but&nbsp;the&nbsp;remote<br>
sites&nbsp;were&nbsp;being&nbsp;laggards.<br>
&nbsp;Theres&nbsp;a&nbsp;limited&nbsp;number&nbsp;of&nbsp;errors&nbsp;which&nbsp;are&nbsp;safe&nbsp;to&nbsp;ignore,&nbsp;and&nbsp;an&nbsp;even<br>
smaller&nbsp;sub-set&nbsp;of&nbsp;those&nbsp;which&nbsp;are&nbsp;actually&nbsp;needed&nbsp;on&nbsp;any&nbsp;given&nbsp;network.<br>
<br>
<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;sslproxy_options&nbsp;ALL&lt;/FONT&gt;<br>
<br>
&quot;ALL&quot;&nbsp;enables&nbsp;a&nbsp;lot&nbsp;of&nbsp;old&nbsp;features&nbsp;and&nbsp;hacks&nbsp;in&nbsp;OpenSSL&nbsp;(export&nbsp;grade<br>
ciphers&nbsp;and&nbsp;plaintext&nbsp;passwords,&nbsp;woohoo!)&nbsp;that&nbsp;are&nbsp;increasingly&nbsp;found&nbsp;to<br>
cause&nbsp;security&nbsp;vulenrabilities.<br>
<br>
<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;sslcrtd_program&nbsp;/opt/libexec/ssl_crtd&nbsp;-s&nbsp;/opt/var/ssl_db&nbsp;-M&nbsp;4MB&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;sslcrtd_children&nbsp;5&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;http_port&nbsp;3128&nbsp;intercept&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;https_port&nbsp;3129&nbsp;intercept&nbsp;ssl-bump&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;cert=/opt/etc/squid/certs/sslsplit_ca_cert.pem&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;cafile=/opt/etc/squid/certs/sslsplit_ca_cert.pem&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;key=/opt/etc/squid/certs/sslsplit_ca_key.pem&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;generate-host-certificates=on&nbsp;dynamic_cert_mem_cache_size=4MB&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;sslflags=NO_SESSION_REUSE&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;logformat&nbsp;mine&nbsp;%&gt;a&nbsp;%[ui&nbsp;%[un&nbsp;[%tl]&nbsp;&quot;%rm&nbsp;%ru&nbsp;HTTP/%rv&quot;&nbsp;%ssl::&gt;sni&nbsp;%&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;ssl::&gt;cert_subject&nbsp;%&gt;Hs&nbsp;%&lt;st&nbsp;%Ss:%Sh&nbsp;%ssl::bump_mode&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;access_log&nbsp;syslog:daemon.info&nbsp;mine&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;refresh_pattern&nbsp;-i&nbsp;(cgi-bin|\?)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;refresh_pattern&nbsp;.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;20%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4320&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;coredump_dir&nbsp;/opt/var&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;##############################&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;Thanks&nbsp;all&nbsp;for&nbsp;being&nbsp;patient&nbsp;while&nbsp;I&nbsp;continued&nbsp;to&nbsp;post&nbsp;my&nbsp;learning&nbsp;and&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;all&nbsp;my&nbsp;mistakes.&nbsp;&nbsp;If&nbsp;there's&nbsp;anything&nbsp;that&nbsp;I've&nbsp;missed,&nbsp;or&nbsp;if&nbsp;there's&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;another&nbsp;method&nbsp;for&nbsp;trying&nbsp;to&nbsp;accomplish&nbsp;what&nbsp;I've&nbsp;tried&nbsp;to&nbsp;do&nbsp;I'm&nbsp;all&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;eyes.&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;James&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;P.S.&nbsp;Things&nbsp;I'd&nbsp;love&nbsp;to&nbsp;see&nbsp;in&nbsp;Squid&nbsp;some&nbsp;day:&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;acl's&nbsp;being&nbsp;AND'd&nbsp;(http_access&nbsp;allow&nbsp;allowed_sites&nbsp;AND&nbsp;localnet)&lt;/FONT&gt;<br>
<br>
That&nbsp;aready&nbsp;exists.&nbsp;The&nbsp;AND&nbsp;is&nbsp;implicit&nbsp;in&nbsp;the&nbsp;order&nbsp;of&nbsp;the&nbsp;ACL&nbsp;checks,<br>
so&nbsp;the&nbsp;&quot;AND&nbsp;&quot;&nbsp;is&nbsp;redundant&nbsp;waste&nbsp;of&nbsp;space&nbsp;in&nbsp;the&nbsp;config&nbsp;file.<br>
<br>
eg,&nbsp;your&nbsp;above&nbsp;&quot;allowed_sites&nbsp;AND&nbsp;localnet&quot;&nbsp;rule&nbsp;is&nbsp;configured:<br>
&nbsp;&nbsp;http_access&nbsp;allow&nbsp;allowed_sites&nbsp;localnet<br>
<br>
This&nbsp;is&nbsp;why&nbsp;I&nbsp;keep&nbsp;pointing&nbsp;out&nbsp;how&nbsp;useless&nbsp;rules&nbsp;like&nbsp;&quot;ssl_bump&nbsp;peek<br>
step1&nbsp;all&quot;&nbsp;are.&nbsp;So&nbsp;you&nbsp;want&nbsp;to&nbsp;peek&nbsp;when&nbsp;&quot;step1&quot;,&nbsp;just&nbsp;peek&nbsp;based&nbsp;on<br>
step1,&nbsp;no&nbsp;need&nbsp;to&nbsp;check&nbsp;if&nbsp;true&nbsp;==&nbsp;true.<br>
<br>
<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;Full&nbsp;on&nbsp;separate&nbsp;http_access,&nbsp;https_access&nbsp;directives&lt;/FONT&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#737373&quot;&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
<br>
I&nbsp;consider&nbsp;this&nbsp;every&nbsp;now&nbsp;and&nbsp;again.&nbsp;But&nbsp;HTTPS&nbsp;is&nbsp;not&nbsp;actually&nbsp;a&nbsp;real<br>
thing.&nbsp;It&nbsp;is&nbsp;a&nbsp;TLS&nbsp;connection&nbsp;delivering&nbsp;regular&nbsp;HTTP&nbsp;messages.&nbsp;By&nbsp;the<br>
time&nbsp;the&nbsp;messages&nbsp;are&nbsp;inside&nbsp;Squid&nbsp;they&nbsp;dont&nbsp;have&nbsp;that&nbsp;TLS&nbsp;part&nbsp;any&nbsp;more<br>
than&nbsp;clear&nbsp;text&nbsp;HTTP&nbsp;has&nbsp;TCP&nbsp;headers.<br>
<br>
<br>
That&nbsp;said,&nbsp;if&nbsp;you&nbsp;want&nbsp;to&nbsp;go&nbsp;fancy&nbsp;you&nbsp;can&nbsp;use&nbsp;the&nbsp;&quot;allof&quot;&nbsp;ACL&nbsp;type.<br>
This&nbsp;ACL&nbsp;type&nbsp;lets&nbsp;you&nbsp;write&nbsp;an&nbsp;entire&nbsp;sub-tree&nbsp;of&nbsp;logical&nbsp;ACL&nbsp;tests&nbsp;and<br>
give&nbsp;it&nbsp;a&nbsp;name.&nbsp;Its&nbsp;not&nbsp;quite&nbsp;the&nbsp;same&nbsp;though.<br>
<br>
&nbsp;acl&nbsp;HTTP&nbsp;proto&nbsp;HTTP<br>
&nbsp;acl&nbsp;HTTPS&nbsp;proto&nbsp;HTTPS<br>
<br>
&nbsp;acl&nbsp;sites&nbsp;dstdomain&nbsp;...<br>
<br>
&nbsp;acl&nbsp;sites2&nbsp;dstdomain&nbsp;...<br>
&nbsp;acl&nbsp;site2paths&nbsp;urlpath_regex&nbsp;...<br>
<br>
&nbsp;acl&nbsp;443&nbsp;port&nbsp;443<br>
<br>
&nbsp;acl&nbsp;plain&nbsp;allof&nbsp;CONNECT&nbsp;443<br>
&nbsp;acl&nbsp;plain&nbsp;allof&nbsp;sites<br>
&nbsp;acl&nbsp;plain&nbsp;allof&nbsp;sites2&nbsp;site2paths<br>
&nbsp;acl&nbsp;plain&nbsp;allof&nbsp;localnet<br>
<br>
&nbsp;acl&nbsp;decrypted&nbsp;allof&nbsp;sites<br>
&nbsp;acl&nbsp;decrypted&nbsp;allof&nbsp;sites2&nbsp;site2paths<br>
&nbsp;acl&nbsp;decrypted&nbsp;allof&nbsp;localnet<br>
<br>
&nbsp;http_access&nbsp;allow&nbsp;HTTP&nbsp;plain<br>
&nbsp;http_access&nbsp;allow&nbsp;HTTPS&nbsp;decrypted<br>
&nbsp;http_access&nbsp;deny&nbsp;all<br>
<br>
Amos<br>
_______________________________________________<br>
squid-users&nbsp;mailing&nbsp;list<br>
&lt;A&nbsp;HREF=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/A&gt;<br>
&lt;A&nbsp;HREF=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/A&gt;<br>
&lt;/PRE&gt;<br>
&lt;/BLOCKQUOTE&gt;<br>
&lt;BR&gt;<br>
Awesome,&nbsp;awesome,&nbsp;and&nbsp;more&nbsp;awesome.&nbsp;&nbsp;Amos&nbsp;that&nbsp;you&nbsp;SO&nbsp;much&nbsp;for&nbsp;the&nbsp;information...I'll&nbsp;make&nbsp;the&nbsp;optimizations&nbsp;and&nbsp;changes&nbsp;and&nbsp;test...I&nbsp;won't&nbsp;bug&nbsp;the&nbsp;list&nbsp;with&nbsp;this&nbsp;anymore&nbsp;unless&nbsp;requested&nbsp;however.&nbsp;&nbsp;I&nbsp;will&nbsp;absolutely&nbsp;file&nbsp;the&nbsp;bug&nbsp;report&nbsp;on&nbsp;terminate.&lt;BR&gt;<br>
&lt;BR&gt;<br>
James<br>
&lt;/BODY&gt;<br>
&lt;/HTML&gt;<br>

</tt>
