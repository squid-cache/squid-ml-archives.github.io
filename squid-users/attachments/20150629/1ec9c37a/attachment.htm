<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hello,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;am&nbsp;experiencing&nbsp;an&nbsp;issue&nbsp;with&nbsp;squid&nbsp;3.5.5&nbsp;and&nbsp;FreeBSD&nbsp;10.1&nbsp;where&nbsp;tcp_outgoing_address&nbsp;correctly&nbsp;rewrites&nbsp;the&nbsp;source&nbsp;address&nbsp;of&nbsp;outgoing&nbsp;packets,&nbsp;but&nbsp;fails&nbsp;to&nbsp;bind&nbsp;the&nbsp;socket&nbsp;to&nbsp;the&nbsp;correct&nbsp;interface.&nbsp;I&#39;ve&nbsp;been&nbsp;using&nbsp;this&nbsp;kind&nbsp;of&nbsp;setup/configuration&nbsp;for&nbsp;quite&nbsp;some&nbsp;time&nbsp;(since&nbsp;the&nbsp;squid&nbsp;2.7&nbsp;days),&nbsp;so&nbsp;I&nbsp;believe&nbsp;something&nbsp;between&nbsp;squid&nbsp;3.3&nbsp;and&nbsp;squid&nbsp;3.5&nbsp;has&nbsp;broken&nbsp;this&nbsp;behavior,&nbsp;or&nbsp;it&nbsp;is&nbsp;a&nbsp;problem&nbsp;with&nbsp;FreeBSD&nbsp;10.x&nbsp;that&nbsp;I&nbsp;do&nbsp;not&nbsp;understand.&nbsp;FWIW&nbsp;squid&nbsp;3.3.3&nbsp;on&nbsp;FreeBSD&nbsp;9.x&nbsp;behaves&nbsp;correctly&nbsp;with&nbsp;the&nbsp;same&nbsp;config.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&#39;ve&nbsp;been&nbsp;able&nbsp;to&nbsp;replicate&nbsp;this&nbsp;on&nbsp;a&nbsp;non-production&nbsp;VM&nbsp;with&nbsp;a&nbsp;simple&nbsp;config.&nbsp;For&nbsp;example,&nbsp;I&nbsp;have&nbsp;two&nbsp;WAN&nbsp;interfaces:&nbsp;WAN1&nbsp;(em0/&lt;a&nbsp;href=&quot;http://192.168.92.246&quot;&gt;192.168.92.246&lt;/a&gt;)&nbsp;and&nbsp;WAN2&nbsp;(em1/&lt;a&nbsp;href=&quot;http://10.8.8.10&quot;&gt;10.8.8.10&lt;/a&gt;),&nbsp;and&nbsp;a&nbsp;LAN&nbsp;interface&nbsp;(em2/&lt;a&nbsp;href=&quot;http://192.168.5.1/24&quot;&gt;192.168.5.1/24&lt;/a&gt;).&nbsp;My&nbsp;default&nbsp;route&nbsp;points&nbsp;to&nbsp;the&nbsp;gateway&nbsp;for&nbsp;WAN1/em0.&nbsp;I&nbsp;have&nbsp;configured&nbsp;a&nbsp;tcp_outgoing_address&nbsp;for&nbsp;a&nbsp;single&nbsp;host&nbsp;on&nbsp;the&nbsp;LAN&nbsp;(192.168.5.2)&nbsp;to&nbsp;use&nbsp;outgoing&nbsp;address&nbsp;10.8.8.10&nbsp;(WAN2/em1).&nbsp;HTTP&nbsp;request&nbsp;packets&nbsp;from&nbsp;squid&nbsp;end&nbsp;up&nbsp;going&nbsp;out&nbsp;em0&nbsp;(the&nbsp;default&nbsp;route&nbsp;interface)&nbsp;with&nbsp;an&nbsp;ip&nbsp;of&nbsp;10.8.8.10.&nbsp;The&nbsp;source&nbsp;IP&nbsp;is&nbsp;correct&nbsp;but&nbsp;the&nbsp;packets&nbsp;egress&nbsp;the&nbsp;wrong&nbsp;interface,&nbsp;so&nbsp;they&nbsp;are&nbsp;obviously&nbsp;dropped&nbsp;by&nbsp;the&nbsp;upstream&nbsp;router&nbsp;on&nbsp;that&nbsp;incorrect&nbsp;interface.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;following&nbsp;is&nbsp;my&nbsp;test&nbsp;squid.conf&nbsp;and&nbsp;some&nbsp;basic&nbsp;network&nbsp;config.&nbsp;While&nbsp;I&nbsp;normally&nbsp;use&nbsp;squid&nbsp;as&nbsp;a&nbsp;transparent&nbsp;proxy&nbsp;in&nbsp;conjunction&nbsp;with&nbsp;the&nbsp;PF&nbsp;firewall&nbsp;and&nbsp;routing&nbsp;enabled,&nbsp;for&nbsp;the&nbsp;purposes&nbsp;of&nbsp;replicating&nbsp;the&nbsp;issue&nbsp;in&nbsp;my&nbsp;VM&nbsp;test&nbsp;environment&nbsp;I&nbsp;have&nbsp;disabled&nbsp;PF,&nbsp;routing,&nbsp;and&nbsp;connected&nbsp;directly&nbsp;to&nbsp;squid&nbsp;via&nbsp;my&nbsp;browser&#39;s&nbsp;proxy&nbsp;config.&nbsp;Attempts&nbsp;to&nbsp;load&nbsp;webpages&nbsp;time&nbsp;out&nbsp;unless&nbsp;I&nbsp;remove&nbsp;use&nbsp;of&nbsp;the&nbsp;tcp_outgoing_address&nbsp;directive.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#&nbsp;begin&nbsp;test&nbsp;squid.conf&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;acl&nbsp;SSL_ports&nbsp;port&nbsp;443&lt;/div&gt;&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;80&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #&nbsp;http&lt;/div&gt;&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;21&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #&nbsp;ftp&lt;/div&gt;&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;443&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;https&lt;/div&gt;&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;70&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #&nbsp;gopher&lt;/div&gt;&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;210&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;wais&lt;/div&gt;&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;1025-65535&nbsp; #&nbsp;unregistered&nbsp;ports&lt;/div&gt;&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;280&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;http-mgmt&lt;/div&gt;&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;488&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;gss-http&lt;/div&gt;&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;591&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;filemaker&lt;/div&gt;&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;777&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;multiling&nbsp;http&lt;/div&gt;&lt;div&gt;acl&nbsp;CONNECT&nbsp;method&nbsp;CONNECT&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;http_access&nbsp;allow&nbsp;localhost&nbsp;manager&lt;/div&gt;&lt;div&gt;http_access&nbsp;deny&nbsp;manager&lt;/div&gt;&lt;div&gt;http_access&nbsp;deny&nbsp;!Safe_ports&lt;/div&gt;&lt;div&gt;http_access&nbsp;deny&nbsp;CONNECT&nbsp;!SSL_ports&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;http_access&nbsp;allow&nbsp;all&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;acl&nbsp;wan2&nbsp;src&nbsp;192.168.5.2&lt;/div&gt;&lt;div&gt;tcp_outgoing_address&nbsp;10.8.8.10&nbsp;wan2&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;follow_x_forwarded_for&nbsp;allow&nbsp;localhost&lt;/div&gt;&lt;div&gt;acl_uses_indirect_client&nbsp;on&lt;/div&gt;&lt;div&gt;log_uses_indirect_client&nbsp;on&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;http_port&nbsp;3129&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;cache_replacement_policy&nbsp;heap&nbsp;LFUDA&lt;/div&gt;&lt;div&gt;maximum_object_size&nbsp;768&nbsp;MB&lt;/div&gt;&lt;div&gt;cache_dir&nbsp;aufs&nbsp;/squid/cache&nbsp;2048&nbsp;32&nbsp;512&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;access_log&nbsp; &nbsp; &nbsp; daemon:/squid/logs/access.log&nbsp;squid&lt;/div&gt;&lt;div&gt;cache_log&nbsp; &nbsp; &nbsp; &nbsp;/squid/logs/cache.log&lt;/div&gt;&lt;div&gt;cache_store_log&nbsp;none&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;logfile_rotate&nbsp;0&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;pid_filename&nbsp;/var/run/squid.pid&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#&nbsp;end&nbsp;test&nbsp;squid.conf&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;em0:&nbsp;flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt;&nbsp;metric&nbsp;0&nbsp;mtu&nbsp;1500&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&lt;/span&gt;options=9b&lt;RXCSUM,TXCSUM,VLAN_MTU,VLAN_HWTAGGING,VLAN_HWCSUM&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;ether&nbsp;00:0c:29:a3:33:93&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;inet&nbsp;192.168.92.246&nbsp;netmask&nbsp;0xffffff00&nbsp;broadcast&nbsp;192.168.92.255 &lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&lt;/span&gt;nd6&nbsp;options=9&lt;PERFORMNUD,IFDISABLED&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&lt;/span&gt;media:&nbsp;Ethernet&nbsp;autoselect&nbsp;(1000baseT&nbsp;&lt;full-duplex&gt;)&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&lt;/span&gt;status:&nbsp;active&lt;/div&gt;&lt;div&gt; &nbsp;  &lt;/div&gt;&lt;div&gt;em1:&nbsp;flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt;&nbsp;metric&nbsp;0&nbsp;mtu&nbsp;1500&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&lt;/span&gt;options=9b&lt;RXCSUM,TXCSUM,VLAN_MTU,VLAN_HWTAGGING,VLAN_HWCSUM&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;ether&nbsp;00:0c:29:a3:33:7f&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;inet&nbsp;10.8.8.10&nbsp;netmask&nbsp;0xffffff00&nbsp;broadcast&nbsp;10.8.8.255 &lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&lt;/span&gt;inet&nbsp;10.8.8.11&nbsp;netmask&nbsp;0xffffff00&nbsp;broadcast&nbsp;10.8.8.255 &lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&lt;/span&gt;inet&nbsp;10.8.8.12&nbsp;netmask&nbsp;0xffffff00&nbsp;broadcast&nbsp;10.8.8.255 &lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&lt;/span&gt;inet&nbsp;10.8.8.13&nbsp;netmask&nbsp;0xffffff00&nbsp;broadcast&nbsp;10.8.8.255 &lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&lt;/span&gt;inet&nbsp;10.8.8.14&nbsp;netmask&nbsp;0xffffff00&nbsp;broadcast&nbsp;10.8.8.255 &lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&lt;/span&gt;nd6&nbsp;options=9&lt;PERFORMNUD,IFDISABLED&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&lt;/span&gt;media:&nbsp;Ethernet&nbsp;autoselect&nbsp;(1000baseT&nbsp;&lt;full-duplex&gt;)&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&lt;/span&gt;status:&nbsp;active&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
&lt;p&nbsp;class=&quot;&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;root#&nbsp;netstat&nbsp;-rn&nbsp;|&nbsp;grep&nbsp;default&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;default&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;192.168.92.2&nbsp; &nbsp; &nbsp; &nbsp;UGS&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;em0&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;am&nbsp;hoping&nbsp;someone&nbsp;can&nbsp;shed&nbsp;some&nbsp;light&nbsp;on&nbsp;whether&nbsp;or&nbsp;not&nbsp;this&nbsp;may&nbsp;be&nbsp;a&nbsp;squid&nbsp;bug&nbsp;or&nbsp;something&nbsp;going&nbsp;on&nbsp;with&nbsp;FreeBSD.&nbsp;Thank&nbsp;you.&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-Nick&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
