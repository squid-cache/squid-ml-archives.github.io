<tt>
&lt;html&gt;<br>
&lt;head&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;class='hmmessage'&gt;&lt;div&nbsp;dir='ltr'&gt;<br>
<br>
&lt;style&gt;&lt;!--<br>
.hmmessage&nbsp;P<br>
{<br>
margin:0px;<br>
padding:0px<br>
}<br>
body.hmmessage<br>
{<br>
font-size:&nbsp;12pt;<br>
font-family:Calibri<br>
}<br>
--&gt;&lt;/style&gt;<br>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;The&nbsp;patch&nbsp;has&nbsp;been&nbsp;manually&nbsp;modified&nbsp;to&nbsp;meet&nbsp;code&nbsp;review.&lt;br&gt;&lt;br&gt;Here&nbsp;is&nbsp;the&nbsp;patch&nbsp;without&nbsp;any&nbsp;manuall&nbsp;modification:&lt;br&gt;&lt;br&gt;diff&nbsp;--git&nbsp;a/squid-3.5.6/src/ssl/PeerConnector.cc&nbsp;b/squid-3.5.6/src/ssl/PeerConnector.cc&lt;br&gt;index&nbsp;b4dfd8f..d307665&nbsp;100644&lt;br&gt;---&nbsp;a/squid-3.5.6/src/ssl/PeerConnector.cc&lt;br&gt;+++&nbsp;b/squid-3.5.6/src/ssl/PeerConnector.cc&lt;br&gt;@@&nbsp;-189,8&nbsp;+189,13&nbsp;@@&nbsp;Ssl::PeerConnector::initializeSsl()&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Use&nbsp;SNI&nbsp;TLS&nbsp;extension&nbsp;only&nbsp;when&nbsp;we&nbsp;connect&nbsp;directly&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;to&nbsp;the&nbsp;origin&nbsp;server&nbsp;and&nbsp;we&nbsp;know&nbsp;the&nbsp;server&nbsp;host&nbsp;name.&lt;br&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;char&nbsp;*sniServer&nbsp;=&nbsp;hostName&nbsp;?&nbsp;hostName-&gt;c_str()&nbsp;:&lt;br&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(!request-&gt;GetHostIsNumeric()&nbsp;?&nbsp;request-&gt;GetHost()&nbsp;:&nbsp;NULL);&lt;br&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;char&nbsp;*sniServer&nbsp;=&nbsp;NULL;&lt;br&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;bool&nbsp;redirected&nbsp;=&nbsp;request-&gt;flags.redirected&nbsp;&amp;&amp;&nbsp;::Config.onoff.redir_rewrites_host;&lt;br&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!hostName&nbsp;||&nbsp;redirected)&lt;br&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sniServer&nbsp;=&nbsp;request-&gt;GetHostIsNumeric()&nbsp;?&nbsp;request-&gt;GetHost()&nbsp;:&nbsp;NULL;&lt;br&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&lt;br&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sniServer&nbsp;=&nbsp;hostName-&gt;c_str();&lt;br&gt;+&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(sniServer)&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Ssl::setClientSNI(ssl,&nbsp;sniServer);&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&lt;br&gt;~&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;&lt;br&gt;Alex&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;&lt;div&gt;&gt;&nbsp;Date&#58;&nbsp;Tue,&nbsp;21&nbsp;Jul&nbsp;2015&nbsp;12&#58;59&#58;29&nbsp;-0700&lt;br&gt;&gt;&nbsp;From&#58;&nbsp;hack.back&#64;hotmail.com&lt;br&gt;&gt;&nbsp;To&#58;&nbsp;squid-users&#64;lists.squid-cache.org&lt;br&gt;&gt;&nbsp;Subject&#58;&nbsp;Re&#58;&nbsp;&#91;squid-users&#93;&nbsp;SSL&nbsp;connction&nbsp;failed&nbsp;due&nbsp;to&nbsp;SNI&nbsp;after&nbsp;content&#9;redirection&lt;br&gt;&gt;&nbsp;&lt;br&gt;&gt;&nbsp;&#58;&#126;/squid-3.5.6-20150716-r13865&#35;&nbsp;patch&nbsp;-p0&nbsp;--verbose&nbsp;&#60;&nbsp;sni.patch&lt;br&gt;&gt;&nbsp;Hmm...&nbsp;&nbsp;Looks&nbsp;like&nbsp;a&nbsp;unified&nbsp;diff&nbsp;to&nbsp;me...&lt;br&gt;&gt;&nbsp;The&nbsp;text&nbsp;leading&nbsp;up&nbsp;to&nbsp;this&nbsp;was&#58;&lt;br&gt;&gt;&nbsp;--------------------------&lt;br&gt;&gt;&nbsp;&#124;---&nbsp;src/ssl/PeerConnector.cc&lt;br&gt;&gt;&nbsp;&#124;&#43;&#43;&#43;&nbsp;src/ssl/PeerConnector.cc&lt;br&gt;&gt;&nbsp;--------------------------&lt;br&gt;&gt;&nbsp;Patching&nbsp;file&nbsp;src/ssl/PeerConnector.cc&nbsp;using&nbsp;Plan&nbsp;A...&lt;br&gt;&gt;&nbsp;patch&#58;&nbsp;&#42;&#42;&#42;&#42;&nbsp;malformed&nbsp;patch&nbsp;at&nbsp;line&nbsp;16&#58;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;debugs&#40;83,&nbsp;5,&lt;br&gt;&gt;&nbsp;&#34;SNIserve&nbsp;&#34;&nbsp;&#60;&#60;&nbsp;sniServer&#41;&#59;&lt;br&gt;&gt;&nbsp;&lt;br&gt;&gt;&nbsp;&lt;br&gt;&gt;&nbsp;&lt;br&gt;&gt;&nbsp;&lt;br&gt;&gt;&nbsp;&lt;br&gt;&gt;&nbsp;--&lt;br&gt;&gt;&nbsp;View&nbsp;this&nbsp;message&nbsp;in&nbsp;context&#58;&nbsp;http&#58;//squid-web-proxy-cache.1019090.n4.nabble.com/SSL-connction-failed-due-to-SNI-after-content-redirection-tp4672339p4672366.html&lt;br&gt;&gt;&nbsp;Sent&nbsp;from&nbsp;the&nbsp;Squid&nbsp;-&nbsp;Users&nbsp;mailing&nbsp;list&nbsp;archive&nbsp;at&nbsp;Nabble.com.&lt;br&gt;&gt;&nbsp;_______________________________________________&lt;br&gt;&gt;&nbsp;squid-users&nbsp;mailing&nbsp;list&lt;br&gt;&gt;&nbsp;squid-users&#64;lists.squid-cache.org&lt;br&gt;&gt;&nbsp;http&#58;//lists.squid-cache.org/listinfo/squid-users&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/body&gt;<br>
&lt;/html&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;&lt;/body&gt;<br>
&lt;/html&gt;
</tt>
