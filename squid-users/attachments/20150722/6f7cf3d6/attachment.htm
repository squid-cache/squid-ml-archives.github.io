<tt>
&lt;html&gt;<br>
&lt;head&gt;<br>
&lt;style&gt;&lt;!--<br>
.hmmessage&nbsp;P<br>
{<br>
margin:0px;<br>
padding:0px<br>
}<br>
body.hmmessage<br>
{<br>
font-size:&nbsp;12pt;<br>
font-family:Calibri<br>
}<br>
--&gt;&lt;/style&gt;&lt;/head&gt;<br>
&lt;body&nbsp;class='hmmessage'&gt;&lt;div&nbsp;dir='ltr'&gt;We&nbsp;do&nbsp;not&nbsp;use&nbsp;cache-peer.&nbsp;I&nbsp;thought&nbsp;cache-peer&nbsp;is&nbsp;for&nbsp;connecting&nbsp;another&nbsp;squid-like&nbsp;proxy&nbsp;server.&lt;br&gt;&lt;br&gt;Without&nbsp;ssl-bump,&nbsp;the&nbsp;connection&nbsp;is&nbsp;tunneled&nbsp;transparently,&nbsp;so&nbsp;there&nbsp;is&nbsp;no&nbsp;chance&nbsp;to&nbsp;redirect&nbsp;each&nbsp;HTTP&nbsp;requests&nbsp;proxied&nbsp;under&nbsp;SSL&nbsp;connection.&lt;br&gt;&lt;br&gt;We&nbsp;want&nbsp;to&nbsp;redirec&nbsp;each&nbsp;HTTP&nbsp;requests&nbsp;under&nbsp;SSL,&nbsp;so&nbsp;we&nbsp;have&nbsp;to&nbsp;use&nbsp;ssl-bump&nbsp;to&nbsp;terminate&nbsp;the&nbsp;connection,&nbsp;and&nbsp;squid&nbsp;open&nbsp;another&nbsp;connection&nbsp;to&nbsp;the&nbsp;server&nbsp;we&nbsp;use&nbsp;content&nbsp;redirect&nbsp;to&nbsp;specify.&nbsp;The&nbsp;code&nbsp;take&nbsp;effect&nbsp;when&nbsp;the&nbsp;squid&nbsp;opens&nbsp;the&nbsp;new&nbsp;connection&nbsp;to&nbsp;each&nbsp;designed&nbsp;server&nbsp;for&nbsp;each&nbsp;HTTPS&nbsp;requests.&lt;br&gt;&lt;br&gt;We&nbsp;terminated&nbsp;CONNECT&nbsp;call&nbsp;at&nbsp;squid&nbsp;also&nbsp;to&nbsp;ensure&nbsp;we&nbsp;can&nbsp;intercept&nbsp;HTTP&nbsp;requests&nbsp;at&nbsp;squid,&lt;br&gt;&lt;br&gt;Alex&lt;br&gt;&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;&lt;div&gt;&gt;&nbsp;To&#58;&nbsp;squid-users&#64;lists.squid-cache.org&lt;br&gt;&gt;&nbsp;From&#58;&nbsp;squid3&#64;treenet.co.nz&lt;br&gt;&gt;&nbsp;Date&#58;&nbsp;Thu,&nbsp;23&nbsp;Jul&nbsp;2015&nbsp;00&#58;21&#58;31&nbsp;&#43;1200&lt;br&gt;&gt;&nbsp;Subject&#58;&nbsp;Re&#58;&nbsp;&#91;squid-users&#93;&nbsp;SSL&nbsp;connction&nbsp;failed&nbsp;due&nbsp;to&nbsp;SNI&nbsp;after&nbsp;content&nbsp;redirection&lt;br&gt;&gt;&nbsp;&lt;br&gt;&gt;&nbsp;On&nbsp;22/07/2015&nbsp;12&#58;44&nbsp;p.m.,&nbsp;Alex&nbsp;Wu&nbsp;wrote&#58;&lt;br&gt;&gt;&nbsp;&#62;&nbsp;it&nbsp;depends&nbsp;on&nbsp;how&nbsp;you&nbsp;set&nbsp;up&nbsp;squid,&nbsp;and&nbsp;where&nbsp;the&nbsp;connection&nbsp;is&nbsp;broken.&nbsp;The&nbsp;patch&nbsp;addessed&nbsp;the&nbsp;issue&nbsp;that&nbsp;occured&nbsp;using&nbsp;sslbump&nbsp;and&nbsp;content&nbsp;redirect&nbsp;together.&lt;br&gt;&gt;&nbsp;&#62;&nbsp;&lt;br&gt;&gt;&nbsp;&lt;br&gt;&gt;&nbsp;I&#39;d&nbsp;like&nbsp;some&nbsp;clarification&nbsp;what&nbsp;the&nbsp;exact&nbsp;problem&nbsp;symptoms&nbsp;are&nbsp;please.&lt;br&gt;&gt;&nbsp;&lt;br&gt;&gt;&nbsp;AFAIK,&nbsp;both&nbsp;redirect&nbsp;and&nbsp;re-write&nbsp;actions&nbsp;happen&nbsp;a&nbsp;relatively&nbsp;long&nbsp;time&lt;br&gt;&gt;&nbsp;&#42;after&#42;&nbsp;the&nbsp;bumping&nbsp;TLS&nbsp;handshakes&nbsp;to&nbsp;server&nbsp;are&nbsp;completed.&nbsp;Its&nbsp;far&nbsp;too&lt;br&gt;&gt;&nbsp;late&nbsp;to&nbsp;send&nbsp;the&nbsp;pre-handshake&nbsp;SNI&nbsp;data&nbsp;to&nbsp;the&nbsp;server.&lt;br&gt;&gt;&nbsp;&lt;br&gt;&gt;&nbsp;I&nbsp;can&nbsp;see&nbsp;this&nbsp;change&nbsp;as&nbsp;affecting&nbsp;reverse-proxy&nbsp;/&nbsp;CDN&nbsp;configurations&lt;br&gt;&gt;&nbsp;with&nbsp;TLS&nbsp;on&nbsp;both&nbsp;connections.&nbsp;But&nbsp;you&nbsp;said&nbsp;this&nbsp;was&nbsp;SSL-bumping,&nbsp;and&lt;br&gt;&gt;&nbsp;reverse-proxy&nbsp;configurations&nbsp;already&nbsp;have&nbsp;a&nbsp;cache_peer&nbsp;option&nbsp;to&nbsp;set&nbsp;the&lt;br&gt;&gt;&nbsp;internal&nbsp;domain&nbsp;name&nbsp;without&nbsp;re-write/redirect.&lt;br&gt;&gt;&nbsp;&lt;br&gt;&gt;&nbsp;Amos&lt;br&gt;&gt;&nbsp;&lt;br&gt;&gt;&nbsp;_______________________________________________&lt;br&gt;&gt;&nbsp;squid-users&nbsp;mailing&nbsp;list&lt;br&gt;&gt;&nbsp;squid-users&#64;lists.squid-cache.org&lt;br&gt;&gt;&nbsp;http&#58;//lists.squid-cache.org/listinfo/squid-users&lt;br&gt;&lt;/div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;&lt;/body&gt;<br>
&lt;/html&gt;
</tt>
