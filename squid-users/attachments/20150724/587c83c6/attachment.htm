<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.0&nbsp;TRANSITIONAL//EN&quot;&gt;<br>
&lt;HTML&gt;<br>
&lt;HEAD&gt;<br>
&nbsp;&nbsp;&lt;META&nbsp;HTTP-EQUIV=&quot;Content-Type&quot;&nbsp;CONTENT=&quot;text/html;&nbsp;CHARSET=UTF-8&quot;&gt;<br>
&nbsp;&nbsp;&lt;META&nbsp;NAME=&quot;GENERATOR&quot;&nbsp;CONTENT=&quot;GtkHTML/4.6.6&quot;&gt;<br>
&lt;/HEAD&gt;<br>
&lt;BODY&gt;<br>
On&nbsp;Fri,&nbsp;2015-07-24&nbsp;at&nbsp;12:09&nbsp;+0000,&nbsp;Sebastian&nbsp;Kirschner&nbsp;wrote:<br>
&lt;BLOCKQUOTE&nbsp;TYPE=CITE&gt;<br>
&lt;PRE&gt;<br>
Hi&nbsp;,<br>
<br>
I&nbsp;minimized&nbsp;the&nbsp;configuration&nbsp;a&nbsp;little&nbsp;bit(you&nbsp;could&nbsp;see&nbsp;it&nbsp;at&nbsp;the&nbsp;bottom&nbsp;of&nbsp;these&nbsp;message).<br>
<br>
Also&nbsp;I&nbsp;still&nbsp;try&nbsp;to&nbsp;understand&nbsp;why&nbsp;these&nbsp;error&nbsp;happen&nbsp;,&nbsp;I&nbsp;increased&nbsp;the&nbsp;Debug&nbsp;level&nbsp;and&nbsp;saw&nbsp;that&nbsp;squid&nbsp;tried&nbsp;48&nbsp;times&nbsp;to&nbsp;peek&nbsp;but&nbsp;failed.<br>
At&nbsp;the&nbsp;end&nbsp;It&nbsp;says&nbsp;that&nbsp;it&nbsp;got&nbsp;an&nbsp;&quot;Hello&quot;,&nbsp;does&nbsp;it&nbsp;mean&nbsp;that&nbsp;squid&nbsp;received&nbsp;after&nbsp;48&nbsp;tries&nbsp;the&nbsp;&quot;Hello&quot;&nbsp;?<br>
<br>
If&nbsp;yes&nbsp;why&nbsp;it&nbsp;does&nbsp;need&nbsp;so&nbsp;many&nbsp;tries&nbsp;?<br>
<br>
-&gt;&nbsp;Part&nbsp;of&nbsp;debug&nbsp;log&nbsp;&lt;-<br>
2015/07/24&nbsp;11:05:42.866&nbsp;kid1|&nbsp;client_side.cc(4242)&nbsp;clientPeekAndSpliceSSL:&nbsp;Start&nbsp;peek&nbsp;and&nbsp;splice&nbsp;on&nbsp;FD&nbsp;11<br>
2015/07/24&nbsp;11:05:42.866&nbsp;kid1|&nbsp;bio.cc(120)&nbsp;read:&nbsp;FD&nbsp;11&nbsp;read&nbsp;11&nbsp;&lt;=&nbsp;11<br>
2015/07/24&nbsp;11:05:42.866&nbsp;kid1|&nbsp;bio.cc(146)&nbsp;readAndBuffer:&nbsp;read&nbsp;11&nbsp;out&nbsp;of&nbsp;11&nbsp;bytes<br>
2015/07/24&nbsp;11:05:42.866&nbsp;kid1|&nbsp;bio.cc(150)&nbsp;readAndBuffer:&nbsp;recorded&nbsp;11&nbsp;bytes&nbsp;of&nbsp;TLS&nbsp;client&nbsp;Hello<br>
2015/07/24&nbsp;11:05:42.866&nbsp;kid1|&nbsp;ModEpoll.cc(116)&nbsp;SetSelect:&nbsp;FD&nbsp;11,&nbsp;type=1,&nbsp;handler=1,&nbsp;client_data=0x7effbd078458,&nbsp;timeout=0<br>
2015/07/24&nbsp;11:05:42.866&nbsp;kid1|&nbsp;client_side.cc(4245)&nbsp;clientPeekAndSpliceSSL:&nbsp;SSL_accept&nbsp;failed.<br>
.<br>
.<br>
.<br>
2015/07/24&nbsp;11:05:42.874&nbsp;kid1|&nbsp;client_side.cc(4242)&nbsp;clientPeekAndSpliceSSL:&nbsp;Start&nbsp;peek&nbsp;and&nbsp;splice&nbsp;on&nbsp;FD&nbsp;11<br>
2015/07/24&nbsp;11:05:42.874&nbsp;kid1|&nbsp;bio.cc(120)&nbsp;read:&nbsp;FD&nbsp;11&nbsp;read&nbsp;6&nbsp;&lt;=&nbsp;11<br>
2015/07/24&nbsp;11:05:42.874&nbsp;kid1|&nbsp;bio.cc(146)&nbsp;readAndBuffer:&nbsp;read&nbsp;6&nbsp;out&nbsp;of&nbsp;11&nbsp;bytes<br>
2015/07/24&nbsp;11:05:42.874&nbsp;kid1|&nbsp;bio.cc(150)&nbsp;readAndBuffer:&nbsp;recorded&nbsp;6&nbsp;bytes&nbsp;of&nbsp;TLS&nbsp;client&nbsp;Hello<br>
2015/07/24&nbsp;11:05:42.875&nbsp;kid1|&nbsp;SBuf.cc(152)&nbsp;assign:&nbsp;SBuf2040&nbsp;from&nbsp;c-string,&nbsp;n=0)<br>
2015/07/24&nbsp;11:05:42.875&nbsp;kid1|&nbsp;SBuf.cc(152)&nbsp;assign:&nbsp;SBuf2038&nbsp;from&nbsp;c-string,&nbsp;n=13)<br>
2015/07/24&nbsp;11:05:42.875&nbsp;kid1|&nbsp;ModEpoll.cc(116)&nbsp;SetSelect:&nbsp;FD&nbsp;11,&nbsp;type=1,&nbsp;handler=1,&nbsp;client_data=0x7effbd078458,&nbsp;timeout=0<br>
2015/07/24&nbsp;11:05:42.875&nbsp;kid1|&nbsp;client_side.cc(4245)&nbsp;clientPeekAndSpliceSSL:&nbsp;SSL_accept&nbsp;failed.<br>
2015/07/24&nbsp;11:05:42.875&nbsp;kid1|&nbsp;SBuf.cc(152)&nbsp;assign:&nbsp;SBuf2025&nbsp;from&nbsp;c-string,&nbsp;n=4294967295)<br>
2015/07/24&nbsp;11:05:42.875&nbsp;kid1|&nbsp;client_side.cc(4259)&nbsp;clientPeekAndSpliceSSL:&nbsp;I&nbsp;got&nbsp;hello.&nbsp;Start&nbsp;forwarding&nbsp;the&nbsp;request!!!<br>
<br>
-&gt;&nbsp;new&nbsp;configuration&nbsp;&lt;-<br>
acl&nbsp;localnet&nbsp;src&nbsp;192.168.0.0/16&nbsp;#&nbsp;RFC1918&nbsp;possible&nbsp;internal&nbsp;network<br>
<br>
acl&nbsp;SSL_ports&nbsp;port&nbsp;443<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;80&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;http<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;21&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;ftp<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;443&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;https<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;70&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;gopher<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;210&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;wais<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;1025-65535&nbsp;&nbsp;#&nbsp;unregistered&nbsp;ports<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;280&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;http-mgmt<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;488&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;gss-http<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;591&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;filemaker<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;777&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;multiling&nbsp;http<br>
acl&nbsp;CONNECT&nbsp;method&nbsp;CONNECT<br>
<br>
http_access&nbsp;deny&nbsp;!Safe_ports<br>
http_access&nbsp;deny&nbsp;CONNECT&nbsp;!SSL_ports<br>
http_access&nbsp;allow&nbsp;localhost&nbsp;manager<br>
http_access&nbsp;deny&nbsp;manager<br>
http_access&nbsp;allow&nbsp;localnet<br>
http_access&nbsp;allow&nbsp;localhost<br>
http_access&nbsp;deny&nbsp;all<br>
<br>
#&nbsp;Listening&nbsp;Ports<br>
http_port&nbsp;127.0.0.1:3120<br>
http_port&nbsp;192.168.1.104:3128&nbsp;intercept<br>
https_port&nbsp;192.168.1.104:3129&nbsp;intercept&nbsp;ssl-bump&nbsp;generate-host-certificates=on&nbsp;dynamic_cert_mem_cache_size=10MB&nbsp;cert=/etc/squid3/ssl_cert/myCA.pem<br>
<br>
#&nbsp;some&nbsp;configuration&nbsp;options<br>
cache_effective_user&nbsp;proxy<br>
cache_effective_group&nbsp;proxy<br>
access_log&nbsp;/var/squid/logs/access.log<br>
cache_log&nbsp;/var/squid/logs/cache.log<br>
pinger_enable&nbsp;on<br>
pinger_program&nbsp;/lib/squid3/pinger<br>
sslproxy_capath&nbsp;/etc/ssl/certs<br>
sslcrtd_program&nbsp;/lib/squid3/ssl_crtd&nbsp;-s&nbsp;/var/squid/certs&nbsp;-M&nbsp;4MB&nbsp;-b&nbsp;2048<br>
<br>
#ACLs<br>
acl&nbsp;step1&nbsp;at_step&nbsp;SslBump1<br>
acl&nbsp;step2&nbsp;at_step&nbsp;SslBump2<br>
acl&nbsp;step3&nbsp;at_step&nbsp;SslBump3<br>
acl&nbsp;bypass&nbsp;ssl::server_name&nbsp;&lt;A&nbsp;HREF=&quot;http://www.google.de&quot;&gt;www.google.de&lt;/A&gt;<br>
<br>
ssl_bump&nbsp;peek&nbsp;step1<br>
ssl_bump&nbsp;splice&nbsp;bypass&nbsp;step2<br>
ssl_bump&nbsp;bump&nbsp;all<br>
<br>
#&nbsp;Debugging&nbsp;if&nbsp;needeed<br>
debug_options&nbsp;all,6&nbsp;6,0&nbsp;16,0&nbsp;18,0&nbsp;19,0&nbsp;20,0&nbsp;32,0&nbsp;47,0&nbsp;79,0&nbsp;90,0&nbsp;92,0<br>
<br>
#&nbsp;Leave&nbsp;coredumps&nbsp;in&nbsp;the&nbsp;first&nbsp;cache&nbsp;dir<br>
coredump_dir&nbsp;/var/spool/squid3<br>
<br>
#<br>
#&nbsp;Add&nbsp;any&nbsp;of&nbsp;your&nbsp;own&nbsp;refresh_pattern&nbsp;entries&nbsp;above&nbsp;these.<br>
#<br>
refresh_pattern&nbsp;^ftp:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1440&nbsp;&nbsp;&nbsp;&nbsp;20%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10080<br>
refresh_pattern&nbsp;^gopher:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1440&nbsp;&nbsp;&nbsp;&nbsp;0%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1440<br>
refresh_pattern&nbsp;-i&nbsp;(/cgi-bin/|\?)&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0<br>
refresh_pattern&nbsp;.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;20%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4320<br>
<br>
<br>
Mit&nbsp;freundlichen&nbsp;Gr&#252;&#223;en&nbsp;/&nbsp;Best&nbsp;Regards<br>
<br>
Sebastian<br>
_______________________________________________<br>
squid-users&nbsp;mailing&nbsp;list<br>
&lt;A&nbsp;HREF=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/A&gt;<br>
&lt;A&nbsp;HREF=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/A&gt;<br>
&lt;/PRE&gt;<br>
&lt;/BLOCKQUOTE&gt;<br>
&lt;BR&gt;<br>
Is&nbsp;that&nbsp;all&nbsp;sites&nbsp;or&nbsp;just&nbsp;a&nbsp;few&nbsp;special&nbsp;sites?&lt;BR&gt;<br>
&lt;BR&gt;<br>
James<br>
&lt;/BODY&gt;<br>
&lt;/HTML&gt;<br>

</tt>
