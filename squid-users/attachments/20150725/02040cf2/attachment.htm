<tt>
&lt;html&gt;<br>
&lt;head&gt;<br>
&lt;style&gt;&lt;!--<br>
.hmmessage&nbsp;P<br>
{<br>
margin:0px;<br>
padding:0px<br>
}<br>
body.hmmessage<br>
{<br>
font-size:&nbsp;12pt;<br>
font-family:Calibri<br>
}<br>
--&gt;&lt;/style&gt;&lt;/head&gt;<br>
&lt;body&nbsp;class='hmmessage'&gt;&lt;div&nbsp;dir='ltr'&gt;I&nbsp;may&nbsp;concur&nbsp;with&nbsp;the&nbsp;way&nbsp;it&nbsp;is.&lt;br&gt;&lt;br&gt;For&nbsp;shared&nbsp;memory,&nbsp;if&nbsp;it&nbsp;is&nbsp;created&nbsp;by&nbsp;worker,&nbsp;it&nbsp;might&nbsp;trigger&nbsp;a&nbsp;race&nbsp;condition.&nbsp;Also,&nbsp;the&nbsp;size&nbsp;of&nbsp;shared&nbsp;segment&nbsp;is&nbsp;fixed&nbsp;across&nbsp;all&nbsp;processes,&nbsp;so&nbsp;each&nbsp;worker&nbsp;cannot&nbsp;create&nbsp;a&nbsp;different&nbsp;size&nbsp;of&nbsp;shared&nbsp;memory.&nbsp;So&nbsp;the&nbsp;current&nbsp;code&nbsp;simply&nbsp;lets&nbsp;master&nbsp;process&nbsp;create&nbsp;it,&nbsp;and&nbsp;wokrer&nbsp;just&nbsp;attaches&nbsp;to&nbsp;it.&lt;br&gt;&lt;br&gt;Alex&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;&lt;div&gt;&gt;&nbsp;Subject&#58;&nbsp;Re&#58;&nbsp;&#91;squid-users&#93;&nbsp;cannot&nbsp;leave&nbsp;empty&nbsp;workers&lt;br&gt;&gt;&nbsp;To&#58;&nbsp;alex_wu2012&#64;hotmail.com&#59;&nbsp;squid-users&#64;lists.squid-cache.org&lt;br&gt;&gt;&nbsp;From&#58;&nbsp;squid3&#64;treenet.co.nz&lt;br&gt;&gt;&nbsp;Date&#58;&nbsp;Sat,&nbsp;25&nbsp;Jul&nbsp;2015&nbsp;12&#58;54&#58;47&nbsp;&#43;1200&lt;br&gt;&gt;&nbsp;&lt;br&gt;&gt;&nbsp;On&nbsp;25/07/2015&nbsp;11&#58;53&nbsp;a.m.,&nbsp;Alex&nbsp;Wu&nbsp;wrote&#58;&lt;br&gt;&gt;&nbsp;&#62;&nbsp;further&nbsp;analysis&nbsp;indicated&nbsp;that&nbsp;master&nbsp;process&nbsp;created&nbsp;quid-ssl_session_cache.shm.&lt;br&gt;&gt;&nbsp;&#62;&nbsp;&lt;br&gt;&gt;&nbsp;&#62;&nbsp;In&nbsp;other&nbsp;words,&nbsp;it&nbsp;needs&nbsp;a&nbsp;https_port&nbsp;or&nbsp;http_port&nbsp;with&nbsp;ssl-bump&nbsp;in&nbsp;outside&nbsp;any&nbsp;process&nbsp;number&nbsp;to&nbsp;create&nbsp;this&nbsp;shared&nbsp;memeory&nbsp;segment.&lt;br&gt;&gt;&nbsp;&#62;&nbsp;&lt;br&gt;&gt;&nbsp;&#62;&nbsp;Furthermore,&nbsp;the&nbsp;code&nbsp;&nbsp;should&nbsp;be&nbsp;simplied&nbsp;like&nbsp;this&#58;&lt;br&gt;&gt;&nbsp;&#62;&nbsp;&lt;br&gt;&gt;&nbsp;&#62;&nbsp;diff&nbsp;--git&nbsp;a/squid-3.5.6/src/ssl/support.cc&nbsp;b/squid-3.5.6/src/ssl/support.cc&lt;br&gt;&gt;&nbsp;&#62;&nbsp;index&nbsp;85305ce..0ce95f9&nbsp;100644&lt;br&gt;&gt;&nbsp;&#62;&nbsp;---&nbsp;a/squid-3.5.6/src/ssl/support.cc&lt;br&gt;&gt;&nbsp;&#62;&nbsp;&#43;&#43;&#43;&nbsp;b/squid-3.5.6/src/ssl/support.cc&lt;br&gt;&gt;&nbsp;&#62;&nbsp;&#64;&#64;&nbsp;-2084,9&nbsp;&#43;2084,6&nbsp;&#64;&#64;&nbsp;SharedSessionCacheRr&#58;&#58;useConfig&#40;&#41;&lt;br&gt;&gt;&nbsp;&#62;&nbsp;&nbsp;void&lt;br&gt;&gt;&nbsp;&#62;&nbsp;&nbsp;SharedSessionCacheRr&#58;&#58;create&#40;&#41;&lt;br&gt;&gt;&nbsp;&#62;&nbsp;&nbsp;&#123;&lt;br&gt;&gt;&nbsp;&#62;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;&#40;&#33;isSslServer&#40;&#41;&#41;&nbsp;//no&nbsp;need&nbsp;to&nbsp;configure&nbsp;ssl&nbsp;session&nbsp;cache.&lt;br&gt;&gt;&nbsp;&#62;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&#59;&lt;br&gt;&gt;&nbsp;&#62;&nbsp;-&lt;br&gt;&gt;&nbsp;&#62;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;items&#59;&lt;br&gt;&gt;&nbsp;&#62;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;items&nbsp;&#61;&nbsp;Config.SSL.sessionCacheSize&nbsp;/&nbsp;sizeof&#40;Ipc&#58;&#58;MemMap&#58;&#58;Slot&#41;&#59;&lt;br&gt;&gt;&nbsp;&#62;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;&#40;items&#41;&lt;br&gt;&gt;&nbsp;&#62;&nbsp;&lt;br&gt;&gt;&nbsp;&#62;&nbsp;&lt;br&gt;&gt;&nbsp;&#62;&nbsp;&lt;br&gt;&gt;&nbsp;&#62;&nbsp;This&nbsp;code&nbsp;is&nbsp;called&nbsp;in&nbsp;master&nbsp;that&nbsp;may&nbsp;not&nbsp;have&nbsp;configuration&nbsp;to&nbsp;ensure&nbsp;isSsslServer&nbsp;return&nbsp;true.&lt;br&gt;&gt;&nbsp;&#62;&nbsp;&lt;br&gt;&gt;&nbsp;&lt;br&gt;&gt;&nbsp;The&nbsp;bug&nbsp;is&nbsp;in&nbsp;why&nbsp;that&nbsp;SharedSessionCacheRr&nbsp;is&nbsp;not&nbsp;being&nbsp;run&nbsp;by&nbsp;the&nbsp;worker.&lt;br&gt;&gt;&nbsp;&lt;br&gt;&gt;&nbsp;AFAIK,&nbsp;it&nbsp;is&nbsp;the&nbsp;way&nbsp;the&nbsp;worker&nbsp;is&nbsp;supposed&nbsp;to&nbsp;attach&nbsp;to&nbsp;the&nbsp;shared&lt;br&gt;&gt;&nbsp;memory.&nbsp;First&nbsp;process&nbsp;to&nbsp;access&nbsp;the&nbsp;SHM&nbsp;does&nbsp;the&nbsp;create,&nbsp;others&nbsp;attach.&lt;br&gt;&gt;&nbsp;&lt;br&gt;&gt;&nbsp;Amos&lt;br&gt;&gt;&nbsp;&lt;br&gt;&lt;/div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;&lt;/body&gt;<br>
&lt;/html&gt;
</tt>
