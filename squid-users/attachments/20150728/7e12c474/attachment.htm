<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Tue,&nbsp;Jul&nbsp;28,&nbsp;2015&nbsp;at&nbsp;12:54&nbsp;PM,&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&nbsp;target=&quot;_blank&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;On&nbsp;29/07/2015&nbsp;5:53&nbsp;a.m.,&nbsp;Tory&nbsp;M&nbsp;Blue&nbsp;wrote:&lt;br&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&gt; &nbsp;I&nbsp;just&nbsp;reproduced&nbsp;this&nbsp;by&nbsp;hand,&nbsp;using&nbsp;an&nbsp;HTTP&nbsp;sniffer&nbsp;tool. &nbsp;I&nbsp;requested&lt;br&gt;<br>
&gt;&nbsp;the&nbsp;same&nbsp;URL&nbsp;twice,&nbsp;with&nbsp;about&nbsp;a&nbsp;0.25&nbsp;second&nbsp;delay&nbsp;between&nbsp;fetches,&nbsp;and&nbsp;the&lt;br&gt;<br>
&gt;&nbsp;2nd&nbsp;attempt&nbsp;was&nbsp;ALSO&nbsp;A&nbsp;MISS. &nbsp;Then&nbsp;I&nbsp;waited&nbsp;1&nbsp;second&nbsp;and&nbsp;tried&nbsp;a&nbsp;3rd&nbsp;time,&lt;br&gt;<br>
&gt;&nbsp;and&nbsp;it&nbsp;was&nbsp;FINALLY&nbsp;a&nbsp;hit.&lt;br&gt;<br>
&lt;br&gt;<br>
Had&nbsp;the&nbsp;first&nbsp;request&nbsp;finished&nbsp;being&nbsp;delivered&nbsp;to&nbsp;your&nbsp;testing&nbsp;tool&lt;br&gt;<br>
before&nbsp;the&nbsp;second&nbsp;request&nbsp;was&nbsp;sent?&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Yes&nbsp;our&nbsp;testing&nbsp;is&nbsp;completely&nbsp;sequential&nbsp;meaning&nbsp;the&nbsp;connection&nbsp;has&nbsp;to&nbsp;complete&nbsp;before&nbsp;we&nbsp;launch&nbsp;another,&nbsp;even&nbsp;by&nbsp;hand.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;br&gt;<br>
&gt;&nbsp;Squid&nbsp;v3&nbsp;seems&nbsp;to&nbsp;have&nbsp;changed&nbsp;the&nbsp;way&nbsp;it&nbsp;stores&nbsp;objects. &nbsp;Maybe&nbsp;it&nbsp;is&lt;br&gt;<br>
&gt;&nbsp;doing&nbsp;some&nbsp;sort&nbsp;of&nbsp;&quot;asynchronous&quot;&nbsp;background&nbsp;store&nbsp;now,&nbsp;so&nbsp;if&nbsp;you&nbsp;send&nbsp;in&lt;br&gt;<br>
&gt;&nbsp;sequential&nbsp;requests&nbsp;without&nbsp;a&nbsp;delay&nbsp;between,&nbsp;it&nbsp;may&nbsp;not&nbsp;actually&nbsp;have&lt;br&gt;<br>
&gt;&nbsp;finished&nbsp;storing&nbsp;it&nbsp;yet,&nbsp;so&nbsp;it&nbsp;doesn&#39;t&nbsp;report&nbsp;a&nbsp;&quot;hit&quot;. &nbsp;Meaning,&nbsp;the&nbsp;first&lt;br&gt;<br>
&gt;&nbsp;&quot;miss&quot;&nbsp;response&nbsp;may&nbsp;have&nbsp;fired&nbsp;off&nbsp;a&nbsp;thread&nbsp;to&nbsp;store&nbsp;the&nbsp;object,&nbsp;and&nbsp;not&lt;br&gt;<br>
&gt;&nbsp;doing&nbsp;it&nbsp;in&nbsp;the&nbsp;main&nbsp;thread&nbsp;anymore&nbsp;like&nbsp;in&nbsp;v2,&nbsp;if&nbsp;you&nbsp;get&nbsp;my&nbsp;meaning.&lt;br&gt;<br>
&lt;br&gt;<br>
Squid-3&nbsp;in-transit&nbsp;objects&nbsp;are&nbsp;not&nbsp;listed&nbsp;as&nbsp;existing&nbsp;in&nbsp;cache_mem&lt;br&gt;<br>
storage&nbsp;until&nbsp;they&nbsp;have&nbsp;completely&nbsp;(and&nbsp;successfully)&nbsp;finished&nbsp;their&lt;br&gt;<br>
first&nbsp;use.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
You&nbsp;can&nbsp;configure&nbsp;&quot;collapsed_forwarding&nbsp;on&quot;&nbsp;to&nbsp;enable&nbsp;the&nbsp;Squid-2.7&lt;br&gt;<br>
behaviour.&nbsp;Treating&nbsp;the&nbsp;in-transit&nbsp;objects&nbsp;list&nbsp;as&nbsp;if&nbsp;it&nbsp;were&nbsp;another&lt;br&gt;<br>
cache&nbsp;area.&lt;br&gt;<br>
&lt;br&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;The&nbsp;document&nbsp;cite&nbsp;this&nbsp;is&nbsp;quite&nbsp;a&nbsp;bit&nbsp;different&nbsp;and&nbsp;not&nbsp;something&nbsp;I&nbsp;want&nbsp;to&nbsp;embark&nbsp;upon. &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
&gt;&lt;br&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
Timing&nbsp;between&nbsp;*completion*&nbsp;of&nbsp;the&nbsp;first&nbsp;request&nbsp;and&nbsp;starting&nbsp;of&nbsp;the&lt;br&gt;<br>
second&nbsp;is&nbsp;the&nbsp;critical.&nbsp;If&nbsp;the&nbsp;first&nbsp;request&nbsp;has&nbsp;not&nbsp;finished,&nbsp;theres&nbsp;no&lt;br&gt;<br>
hope&nbsp;of&nbsp;a&nbsp;HIT.&lt;br&gt;<br>
&lt;br&gt;<br>
Also&nbsp;size&nbsp;of&nbsp;memory&nbsp;cache&nbsp;relative&nbsp;to&nbsp;the&nbsp;churn&nbsp;currently&nbsp;going&nbsp;on&nbsp;also&lt;br&gt;<br>
matters.&nbsp;If&nbsp;you&nbsp;wait&nbsp;too&nbsp;long&nbsp;between&nbsp;the&nbsp;test&nbsp;requests&nbsp;it&nbsp;will&nbsp;be&lt;br&gt;<br>
pushed&nbsp;out&nbsp;and&nbsp;get&nbsp;a&nbsp;MISS&nbsp;again&nbsp;anyway.&nbsp;But&nbsp;I&nbsp;dont&nbsp;think&nbsp;that&nbsp;is&nbsp;a&lt;br&gt;<br>
factor&nbsp;with&nbsp;250ms&nbsp;being&nbsp;your&nbsp;timing.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Again&nbsp;completely&nbsp;synchronous,&nbsp;something&nbsp;is&nbsp;not&nbsp;happening&nbsp;as&nbsp;it&nbsp;should&nbsp;under&nbsp;a&nbsp;busy&nbsp;condition,&nbsp;we&nbsp;tested&nbsp;this&nbsp;as&nbsp;far&nbsp;out&nbsp;as&nbsp;5&nbsp;seconds&nbsp;and&nbsp;still&nbsp;got&nbsp;a&nbsp;miss. &nbsp;We&nbsp;have&nbsp;added&nbsp;&quot;5&quot;&nbsp;retries&nbsp;to&nbsp;our&nbsp;monitor,&nbsp;but&nbsp;I&nbsp;do&nbsp;think&nbsp;something&nbsp;is&nbsp; a&nbsp;miss&nbsp;(no&nbsp;pun&nbsp;intended). &nbsp;Single&nbsp;client&nbsp;hitting&nbsp;a&nbsp;single&nbsp;server&nbsp;in&nbsp;a&nbsp;synchronous&nbsp;manner,&nbsp;should&nbsp;allow&nbsp;for&nbsp;a&nbsp;pretty&nbsp;quick&nbsp;cache&nbsp;hit,&nbsp;but&nbsp;it&#39;s&nbsp;not.&nbsp; &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;my&nbsp;high/low&nbsp;water&nbsp;marks&nbsp;are&nbsp;so&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;cache_swap_high&nbsp;90&lt;br&gt;&lt;/div&gt;&lt;div&gt;<br>
&lt;p&nbsp;class=&quot;p1&quot;&gt;&lt;span&nbsp;class=&quot;s1&quot;&gt;cache_swap_low&nbsp;80&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;p1&quot;&gt;&lt;span&nbsp;class=&quot;s1&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;p1&quot;&gt;&lt;span&nbsp;class=&quot;s1&quot;&gt;My&nbsp;space&nbsp;available&nbsp;is&nbsp;so&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;p1&quot;&gt;&lt;span&nbsp;class=&quot;s1&quot;&gt;<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;p1&quot;&gt;&lt;span&nbsp;class=&quot;s1&quot;&gt;Filesystem &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Size &nbsp;Used&nbsp;Avail&nbsp;Use%&nbsp;Mounted&nbsp;on&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;p1&quot;&gt;&lt;span&nbsp;class=&quot;s1&quot;&gt;<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;p1&quot;&gt;&lt;span&nbsp;class=&quot;s1&quot;&gt;/dev/ram0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;17G&nbsp; &nbsp;14G &nbsp;2.3G &nbsp;86%&nbsp;/cache01&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;p1&quot;&gt;&lt;span&nbsp;class=&quot;s1&quot;&gt;Any&nbsp;other&nbsp;data&nbsp;I&nbsp;could&nbsp;grab&nbsp;from&nbsp;the&nbsp;stats&nbsp;that&nbsp;would&nbsp;help.&nbsp;I&nbsp;do&nbsp;believe&nbsp;something&nbsp;is&nbsp;not&nbsp;quite&nbsp;right&nbsp;but&nbsp;we&nbsp;have&nbsp;ways&nbsp;to&nbsp;get&nbsp;around&nbsp;it&nbsp;for&nbsp;now,&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;p1&quot;&gt;&lt;span&nbsp;class=&quot;s1&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;p1&quot;&gt;&lt;span&nbsp;class=&quot;s1&quot;&gt;Thanks&nbsp;Amons&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;p1&quot;&gt;&lt;span&nbsp;class=&quot;s1&quot;&gt;Tory&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
