<tt>
&lt;p&nbsp;dir=&quot;ltr&quot;&gt;There&nbsp;is&nbsp;a&nbsp;project&nbsp;for&nbsp;icap&nbsp;that&nbsp;does&nbsp;exactly&nbsp;what&nbsp;you&nbsp;want.&nbsp;This&nbsp;is&nbsp;like&nbsp;a&nbsp;L8&nbsp;filter,&nbsp;meanwhile&nbsp;dns&nbsp;is&nbsp;L5.&lt;/p&gt;<br>
&lt;p&nbsp;dir=&quot;ltr&quot;&gt;The&nbsp;higher,&nbsp;the&nbsp;better&lt;/p&gt;<br>
&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Jul&nbsp;31,&nbsp;2015&nbsp;5:20&nbsp;PM,&nbsp;&quot;Amos&nbsp;Jeffries&quot;&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&nbsp;type=&quot;attribution&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;On&nbsp;1/08/2015&nbsp;8:49&nbsp;a.m.,&nbsp;Stanford&nbsp;Prescott&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;Hi&nbsp;Amos.&nbsp;I&nbsp;wanted&nbsp;to&nbsp;try&nbsp;out&nbsp;the&nbsp;&quot;ssl-bump&nbsp;splice&quot;&nbsp;to&nbsp;send&nbsp;traffic&nbsp;to&nbsp;a&lt;br&gt;<br>
&gt;&nbsp;peer&nbsp;found&nbsp;in&nbsp;the&nbsp;recent&nbsp;snapshots&nbsp;for&nbsp;3.5.6/7&nbsp;to&nbsp;block&nbsp;Google&nbsp;images.&nbsp;I&lt;br&gt;<br>
&gt;&nbsp;compiled&nbsp;configured&nbsp;and&nbsp;installed&nbsp;the&nbsp;latest&nbsp;3.5&nbsp;snapshot&nbsp;and&nbsp;added&nbsp;the&lt;br&gt;<br>
&gt;&nbsp;directives&nbsp;you&nbsp;listed&nbsp;above&nbsp;to&nbsp;squid.conf&nbsp;but&nbsp;I&nbsp;am&nbsp;not&nbsp;sure&nbsp;I&nbsp;got&nbsp;them&lt;br&gt;<br>
&gt;&nbsp;right.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;s1_tls_connect &nbsp; &nbsp; &nbsp;at_step&nbsp;SslBump1&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;s2_tls_client_hello&nbsp;at_step&nbsp;SslBump2&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;s3_tls_server_hello&nbsp;at_step&nbsp;SslBump3&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;tls_server_name_is_ip&nbsp;ssl::server_name_regex&nbsp;^[0-9]+.[0-9]+.[0-9]+.[0-9]+n&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;google&nbsp;ssl::server_name&nbsp;.&lt;a&nbsp;href=&quot;http://google.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;google.com&lt;/a&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;ssl_bump&nbsp;peek&nbsp;s1_tls_connect &nbsp; &nbsp; &nbsp;all&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;nobumpSites&nbsp;ssl::server_name&nbsp;.&lt;a&nbsp;href=&quot;http://wellsfargo.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;wellsfargo.com&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;ssl_bump&nbsp;splice&nbsp;s2_tls_client_hello&nbsp;nobumpSites&lt;br&gt;<br>
&gt;&nbsp;ssl_bump&nbsp;splice&nbsp;s2_tls_client_hello&nbsp;google&lt;br&gt;<br>
&gt;&nbsp;ssl_bump&nbsp;stare&nbsp;s2_tls_client_hello&nbsp;all&lt;br&gt;<br>
&gt;&nbsp;ssl_bump&nbsp;bump &nbsp;s3_tls_server_hello&nbsp;all&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;cache_peer&nbsp;&lt;a&nbsp;href=&quot;http://forcesafesearch.google.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;forcesafesearch.google.com&lt;/a&gt;&nbsp;parent&nbsp;443&nbsp;0&nbsp;\&lt;br&gt;<br>
&gt;&nbsp;name=GS&nbsp;originserver&nbsp;no-query&nbsp;no-netdb-exchange&nbsp;no-digest&lt;br&gt;<br>
&lt;br&gt;<br>
Sorry,&nbsp;I&nbsp;missed&nbsp;out&nbsp;the&nbsp;&#39;ssl&#39;&nbsp;option&nbsp;on&nbsp;the&nbsp;peer.&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;search&nbsp;dstdomain&nbsp;.&lt;a&nbsp;href=&quot;http://google.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;google.com&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;cache_peer_access&nbsp;GS&nbsp;allow&nbsp;search&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
cache_peer_access&nbsp;GS&nbsp;deny&nbsp;all&lt;br&gt;<br>
&gt;&nbsp;sslproxy_cert_error&nbsp;allow&nbsp;tls_server_name_is_ip&lt;br&gt;<br>
&gt;&nbsp;sslproxy_cert_error&nbsp;deny&nbsp;all&lt;br&gt;<br>
&gt;&nbsp;sslproxy_flags&nbsp;DONT_VERIFY_PEER&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;When&nbsp;restarting&nbsp;Squid&nbsp;and&nbsp;searching&nbsp;in&nbsp;Google&nbsp;images&nbsp;for&nbsp;&quot;sex&quot;&nbsp;it&nbsp;still&lt;br&gt;<br>
&gt;&nbsp;shows&nbsp;images&nbsp;that&nbsp;I&nbsp;want&nbsp;to&nbsp;be&nbsp;able&nbsp;to&nbsp;block&nbsp;with&nbsp;safesearch.&lt;br&gt;<br>
&lt;br&gt;<br>
Other&nbsp;than&nbsp;the&nbsp;it&nbsp;I&nbsp;missed&nbsp;out&nbsp;mentioning.&nbsp;it&nbsp;looks&nbsp;okay&nbsp;to&nbsp;me.&nbsp;Though&nbsp;I&lt;br&gt;<br>
have&nbsp;not&nbsp;tested&nbsp;any&nbsp;of&nbsp;this&nbsp;myself&nbsp;so&nbsp;YMMV.&lt;br&gt;<br>
&lt;br&gt;<br>
Amos&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;On&nbsp;Thu,&nbsp;Jul&nbsp;16,&nbsp;2015&nbsp;at&nbsp;11:24&nbsp;PM,&nbsp;Amos&nbsp;Jeffries&nbsp;wrote:&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;On&nbsp;19/05/2015&nbsp;5:49&nbsp;a.m.,&nbsp;Andres&nbsp;Granados&nbsp;wrote:&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;hello!I&nbsp;need&nbsp;help&nbsp;on&nbsp;how&nbsp;to&nbsp;block&nbsp;pornographic&nbsp;images&nbsp;of&nbsp;google,&nbsp;I&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;was&nbsp;trying&nbsp;different&nbsp;options&nbsp;and&nbsp;still&nbsp;do&nbsp;not&nbsp;succeed,&nbsp;try:&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;http_reply_access&nbsp;with&nbsp;request_header_add,&nbsp;and&nbsp;even&nbsp;with&nbsp;a&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;configuration&nbsp;dns,&nbsp;I&nbsp;think&nbsp;is&nbsp;to&nbsp;request_header_add&nbsp;the&nbsp;best,&nbsp;though&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;not&nbsp;it&nbsp;has&nbsp;worked&nbsp;for&nbsp;me,&nbsp;I&nbsp;hope&nbsp;your&nbsp;help,&nbsp;is&nbsp;to&nbsp;implement&nbsp;a&nbsp;school,&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;thanks!&lt;br&gt;<br>
&gt;&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;FYI;&nbsp;Christos&nbsp;has&nbsp;added&nbsp;a&nbsp;tweak&nbsp;to&nbsp;the&nbsp;&quot;ssl-bump&nbsp;splice&quot;&nbsp;handling&nbsp;that&lt;br&gt;<br>
&gt;&gt;&nbsp;permits&nbsp;sending&nbsp;the&nbsp;traffic&nbsp;to&nbsp;a&nbsp;cache_peer&nbsp;configured&nbsp;something&nbsp;like&nbsp;this:&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt; &nbsp;acl&nbsp;example&nbsp;ssl::server_name&nbsp;.&lt;a&nbsp;href=&quot;http://example.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;example.com&lt;/a&gt;&lt;br&gt;<br>
&gt;&gt; &nbsp;ssl_bump&nbsp;splice&nbsp;example&lt;br&gt;<br>
&gt;&gt; &nbsp;ssl_bump&nbsp;peek&nbsp;all&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt; &nbsp;cache_peer&nbsp;&lt;a&nbsp;href=&quot;http://forcesafesearch.example.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;forcesafesearch.example.com&lt;/a&gt;&nbsp;parent&nbsp;443&nbsp;0&nbsp;\&lt;br&gt;<br>
&gt;&gt; &nbsp; &nbsp; name=GS&nbsp;\&lt;br&gt;<br>
&gt;&gt; &nbsp; &nbsp; originserver&nbsp;no-query&nbsp;no-netdb-exchange&nbsp;no-digest&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt; &nbsp;acl&nbsp;search&nbsp;dstdomain&nbsp;.&lt;a&nbsp;href=&quot;http://example.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;example.com&lt;/a&gt;&lt;br&gt;<br>
&gt;&gt; &nbsp;cache_peer_access&nbsp;GS&nbsp;allow&nbsp;search&lt;br&gt;<br>
&gt;&gt; &nbsp;cache_peer_access&nbsp;GS&nbsp;deny&nbsp;all&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;The&nbsp;idea&nbsp;being&nbsp;that&nbsp;you&nbsp;can&nbsp;use&nbsp;this&nbsp;on&nbsp;intercepted&nbsp;(or&nbsp;forward-proxy)&lt;br&gt;<br>
&gt;&gt;&nbsp;HTTPS&nbsp;traffic&nbsp;instead&nbsp;of&nbsp;hacking&nbsp;about&nbsp;with&nbsp;DNS&nbsp;to&nbsp;direct&nbsp;clients&nbsp;at&nbsp;the&lt;br&gt;<br>
&gt;&gt;&nbsp;servers&nbsp;Google&nbsp;use&nbsp;to&nbsp;present&nbsp;&quot;safe&quot;&nbsp;searching.&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;This&nbsp;should&nbsp;be&nbsp;available&nbsp;in&nbsp;3.5.7,&nbsp;or&nbsp;the&nbsp;current&nbsp;3.5&nbsp;snaphots.&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;Cheers&lt;br&gt;<br>
&gt;&gt;&nbsp;Amos&lt;br&gt;<br>
&gt;&gt;&nbsp;_______________________________________________&lt;br&gt;<br>
&gt;&gt;&nbsp;squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>

</tt>
