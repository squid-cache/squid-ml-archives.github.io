<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;Hi&nbsp;Eliezer,<br>
&lt;br&gt; &lt;br&gt;Thanks&nbsp;you&nbsp;for&nbsp;feedback,<br>
&lt;br&gt; &lt;br&gt;   &nbsp;•&nbsp;Squid&nbsp;version&nbsp;installed&nbsp;is2.6.STABLE21 &nbsp;and&nbsp;may&nbsp;be&nbsp;this&nbsp;version&nbsp;not&nbsp;handling&nbsp;these&nbsp;requests&nbsp;correctly&nbsp;?<br>
&lt;br&gt; &lt;br&gt;setting&nbsp;for&nbsp;cache&nbsp;peer&nbsp;: <br>
&lt;br&gt;http_port&nbsp;80&nbsp;accel&nbsp;defaultsite=&lt;a&nbsp;href=&quot;http://add.ptr.lu&quot;&gt;add.ptr.lu&lt;/a&gt; &nbsp;vhost<br>
&lt;br&gt;https_port&nbsp;443&nbsp;cert=/root/add.ptr.lu.pem&nbsp;key=/root/add.ptr.lu.key&nbsp;accel&nbsp;defaultsite=&lt;a&nbsp;href=&quot;http://add.ptr.lu&quot;&gt;add.ptr.lu&lt;/a&gt;&nbsp;vhost<br>
&lt;br&gt;cache_peer&nbsp;15.40.40.47&nbsp;parent&nbsp;8000&nbsp;0&nbsp;no-query&nbsp;originserver&nbsp;front-end-https=on&nbsp;name=ProdAccel <br>
&lt;br&gt;cache_peer&nbsp;15.40.40.47&nbsp;parent&nbsp;8001&nbsp;0&nbsp;no-query&nbsp;originserver&nbsp;name=TestAccel<br>
&lt;br&gt; &lt;br&gt;   &nbsp;•&nbsp;From&nbsp;access&nbsp;logs,&nbsp;we&nbsp;do&nbsp;not&nbsp;see&nbsp;any&nbsp;TCP_DENIED&nbsp;log&nbsp;event&nbsp;for&nbsp;the&nbsp;&#39;&lt;a&nbsp;href=&quot;http://add.ptr.lu&quot;&gt;add.ptr.lu&lt;/a&gt;&#39;&nbsp;request.<br>
&lt;br&gt; &lt;br&gt;&gt;&nbsp;2015/06/12&nbsp;17:11:36|&nbsp;Starting&nbsp;Squid&nbsp;Cache&nbsp;version&nbsp;2.6.STABLE21&nbsp;for&nbsp;i686-redhat-linux-gnu...&nbsp;&gt;&nbsp;2015/06/12&nbsp;17:11:36|&nbsp;Process&nbsp;ID&nbsp;3897&nbsp;&gt;&nbsp;...&nbsp;&gt;&nbsp;2015/06/12&nbsp;17:11:36|&nbsp;Accepting&nbsp;accelerated&nbsp;HTTP&nbsp;connections&nbsp;at&nbsp;0.0.0.0,&nbsp;port&nbsp;8000,&nbsp;FD&nbsp;18.&nbsp;&gt;&nbsp;2015/06/12&nbsp;17:11:36|&nbsp;Accepting&nbsp;proxy&nbsp;HTTP&nbsp;connections&nbsp;at&nbsp;0.0.0.0,&nbsp;port&nbsp;3128,&nbsp;FD&nbsp;19.&nbsp;&gt;&nbsp;2015/06/12&nbsp;17:11:36|&nbsp;Accepting&nbsp;HTTPS&nbsp;connections&nbsp;at&nbsp;0.0.0.0,&nbsp;port&nbsp;443,&nbsp;FD&nbsp;20.&nbsp;&gt;&nbsp;2015/06/12&nbsp;17:11:36|&nbsp;Accepting&nbsp;ICP&nbsp;messages&nbsp;at&nbsp;0.0.0.0,&nbsp;port&nbsp;3130,&nbsp;FD&nbsp;21.&nbsp;&gt;&nbsp;2015/06/12&nbsp;17:11:36|&nbsp;WCCP&nbsp;Disabled.&nbsp;&gt;&nbsp;2015/06/12&nbsp;17:11:36|&nbsp;Configuring&nbsp;Parent&nbsp;&lt;a&nbsp;href=&quot;http://158.64.50.47/8000/0&quot;&gt;158.64.50.47/8000/0&lt;/a&gt;&nbsp;&gt;&nbsp;2015/06/12&nbsp;17:11:36|&nbsp;Configuring&nbsp;Parent&nbsp;&lt;a&nbsp;href=&quot;http://158.64.50.47/8001/0&quot;&gt;158.64.50.47/8001/0&lt;/a&gt; <br>
&lt;br&gt; &lt;br&gt;   &nbsp;•&nbsp;Port&nbsp;8000&nbsp;is&nbsp;the&nbsp;port&nbsp;using&nbsp;for&nbsp;backend &nbsp;webserver<br>
&lt;br&gt;   &nbsp;•&nbsp;So&nbsp;I&nbsp;try&nbsp;to&nbsp;access&nbsp;from&nbsp;external&nbsp;,&nbsp;I&nbsp;try&nbsp;&lt;a&nbsp;href=&quot;https://add.ptr.lu&quot;&gt;https://add.ptr.lu&lt;/a&gt;&nbsp;,&nbsp;I&nbsp;receive&nbsp;a&nbsp;issue&nbsp;with&nbsp;new&nbsp;url&nbsp;&lt;a&nbsp;href=&quot;https://add.ptr.lu:8000/register&quot;&gt;https://add.ptr.lu:8000/register&lt;/a&gt;<br>
&lt;br&gt;   &nbsp; &lt;br&gt;   &nbsp;So&nbsp;I&nbsp;supposed&nbsp;that&nbsp;it&nbsp;cannot&nbsp;return&nbsp;with&nbsp;this&nbsp;url&nbsp;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;2015-08-18&nbsp;18:22&nbsp;GMT+02:00&nbsp;Eliezer&nbsp;Croitoru&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:eliezer@ngtech.co.il&quot;&nbsp;target=&quot;_blank&quot;&gt;eliezer@ngtech.co.il&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;Well&nbsp;it&#39;s&nbsp;a&nbsp;bit&nbsp;weird&nbsp;since&nbsp;squid&nbsp;is&nbsp;capable&nbsp;of&nbsp;handling&nbsp;these&nbsp;requests&nbsp;and&nbsp;it&nbsp;should&nbsp;not&nbsp;pass&nbsp;a&nbsp;port&nbsp;as&nbsp;a&nbsp;part&nbsp;of&nbsp;the&nbsp;HTTP&nbsp;protocol.&lt;br&gt;<br>
&lt;br&gt;<br>
What&nbsp;settings&nbsp;have&nbsp;you&nbsp;tried&nbsp;for&nbsp;a&nbsp;cache&nbsp;peer?&lt;br&gt;<br>
Have&nbsp;you&nbsp;tried&nbsp;matching&nbsp;with&nbsp;a&nbsp;domain&nbsp;name&nbsp;matching?&lt;br&gt;<br>
Did&nbsp;you&nbsp;had&nbsp;the&nbsp;chance&nbsp;to&nbsp;get&nbsp;the&nbsp;access.log&nbsp;with&nbsp;or&nbsp;without&nbsp;the&nbsp;url_rewrite?&lt;br&gt;<br>
&lt;br&gt;<br>
How&nbsp;did&nbsp;you&nbsp;got&nbsp;a&nbsp;request&nbsp;with&nbsp;port&nbsp;8000?&nbsp;You&nbsp;can&nbsp;always&nbsp;use&nbsp;the&nbsp;&quot;port&quot;&nbsp;acl&nbsp;to&nbsp;match&nbsp;it.&lt;br&gt;<br>
If&nbsp;you&nbsp;are&nbsp;receiving&nbsp;url&nbsp;on&nbsp;port&nbsp;80&nbsp;you&nbsp;should&nbsp;not&nbsp;have&nbsp;any&nbsp;issues.&lt;br&gt;<br>
&lt;br&gt;<br>
If&nbsp;you&nbsp;can&nbsp;give&nbsp;me&nbsp;couple&nbsp;examples&nbsp;of&nbsp;urls&nbsp;which&nbsp;you&nbsp;get&nbsp;I&nbsp;might&nbsp;be&nbsp;able&nbsp;to&nbsp;understand&nbsp;a&nbsp;bit&nbsp;more.&lt;span&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
Eliezer&lt;/font&gt;&lt;/span&gt;&lt;div&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;18/08/2015&nbsp;18:20,&nbsp;Hicham&nbsp;Berni&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
Hi&nbsp;Eliezer,&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;try&nbsp;first&nbsp;with&nbsp;cache_peer&nbsp;,&nbsp;but&nbsp;it&nbsp;was&nbsp;not&nbsp;running&nbsp;for&nbsp;this&nbsp;specific&lt;br&gt;<br>
web-server&nbsp;port&nbsp;configuration&nbsp;(&nbsp;8000&nbsp;and&nbsp;error&nbsp;was&nbsp;that&nbsp;we&nbsp;received&nbsp;url&lt;br&gt;<br>
with&nbsp;port&nbsp;number),&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;noted&nbsp;that&nbsp;current&nbsp;configuration&nbsp;was&nbsp;using&nbsp;rewrite&nbsp;url&nbsp;program&nbsp;(&nbsp;for&nbsp;test&lt;br&gt;<br>
with&nbsp;port&nbsp;number&nbsp;8001)&nbsp;and&nbsp;I&nbsp;supposed&nbsp;that&nbsp;it&nbsp;could&nbsp;be&nbsp;same&nbsp;problem&nbsp;by&lt;br&gt;<br>
using&nbsp;port&nbsp;8000&nbsp;instead&nbsp;80&nbsp;(&nbsp;webdesign&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;change&nbsp;port&nbsp;number)&lt;br&gt;<br>
&lt;br&gt;<br>
When&nbsp;i&nbsp;tried &nbsp;with&nbsp;rewrite&nbsp;url&nbsp;program&nbsp;,&nbsp;it&nbsp;ran&nbsp;but&nbsp;just&nbsp;for&nbsp;production&lt;br&gt;<br>
url &nbsp;and&nbsp;not&nbsp;test&nbsp;url.&lt;br&gt;<br>
&lt;br&gt;<br>
2015-08-18&nbsp;16:46&nbsp;GMT+02:00&nbsp;Eliezer&nbsp;Croitoru&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:eliezer@ngtech.co.il&quot;&nbsp;target=&quot;_blank&quot;&gt;eliezer@ngtech.co.il&lt;/a&gt;&gt;:&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
Hey&nbsp;Berni,&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;was&nbsp;wondering&nbsp;to&nbsp;myself,&nbsp;why&nbsp;do&nbsp;you&nbsp;need&nbsp;to&nbsp;rewrite&nbsp;the&nbsp;url?&lt;br&gt;<br>
Can&#39;t&nbsp;you&nbsp;just&nbsp;use&nbsp;a&nbsp;cache_peer&nbsp;and&nbsp;couple&nbsp;acls?&lt;br&gt;<br>
&lt;br&gt;<br>
Eliezer&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;18/08/2015&nbsp;16:43,&nbsp;Hicham&nbsp;Berni&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
Hi,&lt;br&gt;<br>
&lt;br&gt;<br>
We&nbsp;have&nbsp;a&nbsp;squid&nbsp;reverse&nbsp;configuration,&nbsp;and&nbsp;we&nbsp;need&nbsp;to&nbsp;change &nbsp;backend&lt;br&gt;<br>
webserver &nbsp;with&nbsp;a&nbsp;new&nbsp;webserver&nbsp;with&nbsp;new&nbsp;IP&nbsp;and&nbsp;port&nbsp;(80&nbsp;--&gt;&nbsp;8000)&nbsp;.&lt;br&gt;<br>
&lt;br&gt;<br>
Old&nbsp;squid&nbsp;configuration&nbsp;used&nbsp;url_rewrite_program.&nbsp;I&nbsp;&#39;not&nbsp;familar&nbsp;with&nbsp;this&lt;br&gt;<br>
configuration.&lt;br&gt;<br>
With&nbsp;port&nbsp;changing&nbsp;on&nbsp;new&nbsp;web&nbsp;server&nbsp;(&nbsp;80&nbsp;--&gt;&nbsp;8000)&nbsp;,&nbsp;i&nbsp;find&nbsp;that&nbsp;i&nbsp;had&nbsp;to&lt;br&gt;<br>
add&nbsp;new&nbsp;production&nbsp;web&nbsp;on&nbsp;url_rerite_program.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;tried&nbsp;to&nbsp;change&nbsp;program&nbsp;,&nbsp;but&nbsp;i&nbsp;met&nbsp;a&nbsp;issue.&lt;br&gt;<br>
&lt;br&gt;<br>
on&nbsp;part&nbsp;1&nbsp;--&gt;&nbsp;current&nbsp;rewrite&nbsp;program&nbsp;configuration &nbsp;running&nbsp;today&nbsp;and&lt;br&gt;<br>
correctly &nbsp;for&nbsp;testurl&nbsp;--&gt;&nbsp;running&nbsp;fine&lt;br&gt;<br>
on&nbsp;part&nbsp;2&nbsp;--&gt;&nbsp;configuration&nbsp;with&nbsp;change &nbsp;for&nbsp;testurl&nbsp;and&nbsp;productionurl&nbsp;-&gt;&lt;br&gt;<br>
OK&nbsp;for&nbsp;productionurl&nbsp;and&nbsp;KO&nbsp;for&nbsp;testurl&lt;br&gt;<br>
&lt;br&gt;<br>
An&nbsp;idea&nbsp;if&nbsp;something&nbsp;is&nbsp;wrong&nbsp;on&nbsp;change&nbsp;?&lt;br&gt;<br>
&lt;br&gt;<br>
Part&nbsp;1) &nbsp;old&nbsp;configuration&nbsp;:&lt;br&gt;<br>
&lt;br&gt;<br>
#!/usr/bin/perl&lt;br&gt;<br>
&lt;br&gt;<br>
$INTERNALIP=&quot;15.40.40.40&quot;;&lt;br&gt;<br>
$PRODUCTIONURL=&quot;&lt;a&nbsp;href=&quot;http://add.ptr.lu&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;add.ptr.lu&lt;/a&gt;&quot;;&lt;br&gt;<br>
$TESTURL=&quot;&lt;a&nbsp;href=&quot;http://test.add.ptr.lu&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;test.add.ptr.lu&lt;/a&gt;&quot;;&lt;br&gt;<br>
$TESTPORT=&quot;8001&quot;;&lt;br&gt;<br>
&lt;br&gt;<br>
#&nbsp;turn&nbsp;off&nbsp;write&nbsp;buffering&lt;br&gt;<br>
$|&nbsp;=&nbsp;1;&lt;br&gt;<br>
while&nbsp;(&lt;&gt;)&nbsp;{&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; &nbsp;#&nbsp;get&nbsp;the&nbsp;URL&nbsp;from&nbsp;the&nbsp;request&lt;br&gt;<br>
 &nbsp; &nbsp;chomp($url&nbsp;=&nbsp;$_);&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; &nbsp;if&nbsp;($url&nbsp;=~&nbsp;m/($INTERNALIP|$TESTURL):$TESTPORT/)&lt;br&gt;<br>
 &nbsp; &nbsp;{&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;#&nbsp;fix&nbsp;up&nbsp;the&nbsp;cname&nbsp;and&nbsp;port&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;$url&nbsp;=~&nbsp;s^:$TESTPORT^^;&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;$url&nbsp;=~&nbsp;s^$INTERNALIP^$TESTURL^;&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;#&nbsp;fix&nbsp;the&nbsp;protocol&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;$url&nbsp;=~&nbsp;s^https://^http://^;&lt;br&gt;<br>
 &nbsp; &nbsp;}&lt;br&gt;<br>
 &nbsp; &nbsp;else&lt;br&gt;<br>
 &nbsp; &nbsp;{&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;#&nbsp;fix&nbsp;up&nbsp;the&nbsp;name&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;$url&nbsp;=~&nbsp;s^$INTERNALIP^$PRODUCTIONURL^;&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;#&nbsp;fix&nbsp;the&nbsp;protocol&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;$url&nbsp;=~&nbsp;s^http://^https://^;&lt;br&gt;<br>
 &nbsp; &nbsp;}&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; &nbsp;#&nbsp;return&nbsp;the&nbsp;fixed&nbsp;URL&nbsp;to&nbsp;squid&lt;br&gt;<br>
 &nbsp; &nbsp;print&nbsp;&quot;$url\n&quot;;&lt;br&gt;<br>
}&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Part&nbsp;2)&nbsp;configuration&nbsp;with&nbsp;changes&lt;br&gt;<br>
&lt;br&gt;<br>
#!/usr/bin/perl&lt;br&gt;<br>
&lt;br&gt;<br>
$INTERNALIP=&quot;15.40.40.40&quot;;&lt;br&gt;<br>
$PRODUCTIONURL=&quot;&lt;a&nbsp;href=&quot;http://add.ptr.lu&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;add.ptr.lu&lt;/a&gt;&quot;;&lt;br&gt;<br>
$TESTURL=&quot;&lt;a&nbsp;href=&quot;http://test.add.ptr.lu&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;test.add.ptr.lu&lt;/a&gt;&quot;;&lt;br&gt;<br>
$TESTPORT=&quot;8001&quot;;&lt;br&gt;<br>
$PRODPORT=&quot;8000&quot;;&lt;br&gt;<br>
&lt;br&gt;<br>
#&nbsp;turn&nbsp;off&nbsp;write&nbsp;buffering&lt;br&gt;<br>
$|&nbsp;=&nbsp;1;&lt;br&gt;<br>
while&nbsp;(&lt;&gt;)&nbsp;{&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; &nbsp;#&nbsp;get&nbsp;the&nbsp;URL&nbsp;from&nbsp;the&nbsp;request&lt;br&gt;<br>
 &nbsp; &nbsp;chomp($url&nbsp;=&nbsp;$_);&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; &nbsp;if&nbsp;($url&nbsp;=~&nbsp;m/($INTERNALIP|$TESTURL):$TESTPORT/)&lt;br&gt;<br>
 &nbsp; &nbsp;{&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;#&nbsp;fix&nbsp;up&nbsp;the&nbsp;cname&nbsp;and&nbsp;port&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;$url&nbsp;=~&nbsp;s^:$TESTPORT^^;&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;$url&nbsp;=~&nbsp;s^$INTERNALIP^$TESTURL^;&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;#&nbsp;fix&nbsp;the&nbsp;protocol&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;$url&nbsp;=~&nbsp;s^https://^http://^;&lt;br&gt;<br>
 &nbsp; &nbsp;}&lt;br&gt;<br>
&lt;br&gt;<br>
elsif&nbsp;($url&nbsp;=~&nbsp;m/($INTERNALIP|$PRODUCTIONURL):$PRODPORT/)&lt;br&gt;<br>
 &nbsp; &nbsp;{&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;#&nbsp;fix&nbsp;up&nbsp;the&nbsp;cname&nbsp;and&nbsp;port&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;$url&nbsp;=~&nbsp;s^:$PRODPORT^^;&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;$url&nbsp;=~&nbsp;s^$INTERNALIP^$PRODURL^;&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;#&nbsp;fix&nbsp;the&nbsp;protocol&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;$url&nbsp;=~&nbsp;s^https://^http://^;&lt;br&gt;<br>
 &nbsp; &nbsp;}&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; &nbsp;else&lt;br&gt;<br>
 &nbsp; &nbsp;{&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;#&nbsp;fix&nbsp;up&nbsp;the&nbsp;name&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;$url&nbsp;=~&nbsp;s^$INTERNALIP^$PRODUCTIONURL^;&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;#&nbsp;fix&nbsp;the&nbsp;protocol&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;$url&nbsp;=~&nbsp;s^http://^https://^;&lt;br&gt;<br>
 &nbsp; &nbsp;}&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; &nbsp;#&nbsp;return&nbsp;the&nbsp;fixed&nbsp;URL&nbsp;to&nbsp;squid&lt;br&gt;<br>
 &nbsp; &nbsp;print&nbsp;&quot;$url\n&quot;;&lt;br&gt;<br>
}&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
_______________________________________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
