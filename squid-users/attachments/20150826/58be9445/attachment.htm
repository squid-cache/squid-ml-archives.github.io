<tt>
&lt;html&gt;<br>
&nbsp;&nbsp;&lt;head&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;http-equiv=&quot;content-type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&gt;<br>
&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&lt;body&nbsp;text=&quot;#000000&quot;&nbsp;bgcolor=&quot;#FFFFFF&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;After&nbsp;I&nbsp;sent&nbsp;you&nbsp;my&nbsp;previous&nbsp;email,&nbsp;I&nbsp;continued&nbsp;investigating&nbsp;the<br>
&nbsp;&nbsp;&nbsp;&nbsp;subject&nbsp;..&nbsp;I&nbsp;made&nbsp;a&nbsp;change&nbsp;in&nbsp;the&nbsp;source&nbsp;code&nbsp;as&nbsp;follows:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;File:&nbsp;/src/http.cc&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;HttpStateData::haveParsedReplyHeaders()&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;   &nbsp;.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;   &nbsp;.  &nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#####&nbsp;THIS&nbsp;IS&nbsp;NEW&nbsp;STUFF&nbsp;###########&nbsp;  &nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;   &nbsp;if&nbsp;(rep-&gt;header.has(HDR_VARY))&nbsp;{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;   &nbsp;rep-&gt;header.delById(HDR_VARY);&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;   &nbsp;debugs(11,3,&nbsp;&quot;Vary&nbsp;detected.&nbsp;Hack&nbsp;Cleaning&nbsp;it&nbsp;up&quot;);&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;   &nbsp;}&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#####&nbsp;END&nbsp;OF&nbsp;NEW&nbsp;STUFF&nbsp;###########&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#if&nbsp;X_ACCELERATOR_VARY&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;   &nbsp;if&nbsp;(rep-&gt;header.has(HDR_X_ACCELERATOR_VARY))&nbsp;{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;   &nbsp;rep-&gt;header.delById(HDR_X_ACCELERATOR_VARY);&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;   &nbsp;debugs(11,3,&nbsp;&quot;HDR_X_ACCELERATOR_VARY&nbsp;Vary&nbsp;detected.&nbsp;Hack<br>
&nbsp;&nbsp;&nbsp;&nbsp;Cleaning&nbsp;it&nbsp;up&quot;);&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;   &nbsp;}&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#endif&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;   &nbsp;.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;   &nbsp;.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Deleting&nbsp;Vary&nbsp;from&nbsp;the&nbsp;header&nbsp;at&nbsp;this&nbsp;point&nbsp;gives&nbsp;me&nbsp;hits&nbsp;in&nbsp;every<br>
&nbsp;&nbsp;&nbsp;&nbsp;object&nbsp;I&nbsp;test&nbsp;(that&nbsp;previously&nbsp;didn't&nbsp;hit)&nbsp;..&nbsp;web&nbsp;browser&nbsp;never<br>
&nbsp;&nbsp;&nbsp;&nbsp;receives&nbsp;the&nbsp;Vary&nbsp;in&nbsp;the&nbsp;response&nbsp;header.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Now&nbsp;I&nbsp;read&nbsp;your&nbsp;answer&nbsp;and&nbsp;you&nbsp;say&nbsp;that&nbsp;this&nbsp;is&nbsp;a&nbsp;critical&nbsp;validity<br>
&nbsp;&nbsp;&nbsp;&nbsp;check&nbsp;and&nbsp;that&nbsp;worries&nbsp;me.&nbsp;Taking&nbsp;away&nbsp;the&nbsp;vary&nbsp;altogether&nbsp;at&nbsp;this<br>
&nbsp;&nbsp;&nbsp;&nbsp;point&nbsp;could&nbsp;lead&nbsp;to&nbsp;the&nbsp;problems&nbsp;that&nbsp;you&nbsp;described?&nbsp;If&nbsp;that&nbsp;is&nbsp;the<br>
&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;..&nbsp;I&nbsp;have&nbsp;to&nbsp;investigate&nbsp;other&nbsp;alternatives.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Thanks,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Sebastian&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;class=&quot;moz-cite-prefix&quot;&gt;El&nbsp;26/08/15&nbsp;a&nbsp;las&nbsp;16:11,&nbsp;Amos&nbsp;Jeffries<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;escribió:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;class=&quot;&nbsp;cite&quot;&nbsp;id=&quot;mid_55DE0F5B_2070703_treenet_co_nz&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cite=&quot;mid:55DE0F5B.2070703@treenet.co.nz&quot;&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;On&nbsp;27/08/2015&nbsp;4:11&nbsp;a.m.,&nbsp;Sebastián&nbsp;Goicochea&nbsp;wrote:<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;class=&quot;&nbsp;cite&quot;&nbsp;id=&quot;Cite_8362959&quot;&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;Hello&nbsp;Amos,&nbsp;thanks&nbsp;for&nbsp;your&nbsp;help.&nbsp;I've&nbsp;disabled&nbsp;our&nbsp;rewriter&nbsp;helper&nbsp;but<br>
the&nbsp;errors&nbsp;remain&nbsp;the&nbsp;same.&nbsp;So&nbsp;I&nbsp;think&nbsp;that's&nbsp;not&nbsp;the&nbsp;reason.<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;You&nbsp;emptied&nbsp;the&nbsp;cache,&nbsp;or&nbsp;at&nbsp;least&nbsp;altered&nbsp;the&nbsp;cache_dir&nbsp;line&nbsp;to&nbsp;point<br>
at&nbsp;a&nbsp;new&nbsp;empty&nbsp;cache_dir&nbsp;during&nbsp;the&nbsp;test&nbsp;after&nbsp;disabling&nbsp;the&nbsp;helper?<br>
anything&nbsp;it&nbsp;might&nbsp;have&nbsp;done&nbsp;to&nbsp;the&nbsp;cache&nbsp;contents&nbsp;is&nbsp;already&nbsp;done&nbsp;to&nbsp;the<br>
data&nbsp;stored&nbsp;there&nbsp;by&nbsp;the&nbsp;time&nbsp;you&nbsp;disable&nbsp;it.<br>
<br>
<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;class=&quot;&nbsp;cite&quot;&nbsp;id=&quot;Cite_9071284&quot;&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;I've&nbsp;been&nbsp;reading&nbsp;some&nbsp;older&nbsp;mails&nbsp;from&nbsp;the&nbsp;list&nbsp;and&nbsp;a&nbsp;guy&nbsp;named&nbsp;Hussam<br>
Al-Tayeb&nbsp;exchanged&nbsp;some&nbsp;interesting&nbsp;mails&nbsp;with&nbsp;you&nbsp;a&nbsp;couple&nbsp;of&nbsp;months<br>
ago&nbsp;..&nbsp;That&nbsp;got&nbsp;me&nbsp;thinking,&nbsp;can&nbsp;I&nbsp;completely&nbsp;disable&nbsp;Vary&nbsp;checking?&nbsp;I<br>
know&nbsp;is&nbsp;an&nbsp;http&nbsp;violation&nbsp;and&nbsp;not&nbsp;recommended,&nbsp;but&nbsp;if&nbsp;I&nbsp;could&nbsp;disable&nbsp;it<br>
using&nbsp;an&nbsp;ACL&nbsp;for&nbsp;certain&nbsp;sites&nbsp;that&nbsp;are&nbsp;missconfigured&nbsp;and&nbsp;I&nbsp;have&nbsp;the<br>
certainty&nbsp;that&nbsp;the&nbsp;content&nbsp;is&nbsp;exactly&nbsp;the&nbsp;same&nbsp;no&nbsp;matter&nbsp;what&nbsp;..&nbsp;I&nbsp;could<br>
get&nbsp;better&nbsp;performance.&nbsp;(It's&nbsp;ok&nbsp;if&nbsp;I&nbsp;have&nbsp;to&nbsp;patch&nbsp;something&nbsp;and<br>
recompile&nbsp;squid)<br>
If&nbsp;this&nbsp;is&nbsp;not&nbsp;possible,&nbsp;what&nbsp;about&nbsp;&quot;bypassing&quot;&nbsp;content&nbsp;that&nbsp;has&nbsp;the<br>
Vary&nbsp;in&nbsp;its&nbsp;response&nbsp;header&nbsp;so&nbsp;squid&nbsp;does&nbsp;not&nbsp;make&nbsp;this&nbsp;2&nbsp;lookups&nbsp;only<br>
to&nbsp;find&nbsp;that&nbsp;it&nbsp;has&nbsp;to&nbsp;retrieve&nbsp;it&nbsp;from&nbsp;the&nbsp;original&nbsp;server&nbsp;anyway?<br>
<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;Its&nbsp;not&nbsp;a&nbsp;violation&nbsp;of&nbsp;HTTP.&nbsp;It&nbsp;is&nbsp;a&nbsp;critical&nbsp;internal&nbsp;validity&nbsp;check<br>
for&nbsp;the&nbsp;cache&nbsp;index&nbsp;itself.<br>
<br>
Preventing&nbsp;the&nbsp;contents&nbsp;of&nbsp;say&nbsp;your&nbsp;bank&nbsp;account&nbsp;display&nbsp;page&nbsp;being&nbsp;sent<br>
to&nbsp;someone&nbsp;else&nbsp;fetching&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://google.com/&quot;&gt;http://google.com/&lt;/a&gt;.&nbsp;That&nbsp;kind&nbsp;of&nbsp;critical.<br>
<br>
If&nbsp;the&nbsp;Vary&nbsp;meta&nbsp;object&nbsp;is&nbsp;not&nbsp;pointing&nbsp;at&nbsp;the&nbsp;object&nbsp;its&nbsp;supposed&nbsp;to<br>
be.&nbsp;Then&nbsp;the&nbsp;object&nbsp;it&nbsp;was&nbsp;supposed&nbsp;to&nbsp;be&nbsp;pointing&nbsp;at&nbsp;could&nbsp;be&nbsp;anything<br>
at&nbsp;all.<br>
<br>
<br>
For&nbsp;your&nbsp;other&nbsp;question.&nbsp;Yes,&nbsp;3.5&nbsp;has&nbsp;the&nbsp;store_miss&nbsp;directive&nbsp;now.<br>
&lt;a&nbsp;class=&quot;moz-txt-link-rfc2396E&quot;&nbsp;href=&quot;http://master.squid-cache.org/Doc/config/store_miss/&quot;&gt;&lt;http://master.squid-cache.org/Doc/config/store_miss/&gt;&lt;/a&gt;.<br>
You&nbsp;can&nbsp;use&nbsp;ACLs&nbsp;in&nbsp;there&nbsp;to&nbsp;check&nbsp;for&nbsp;either&nbsp;the&nbsp;known&nbsp;URLs&nbsp;or&nbsp;the&nbsp;Vary<br>
header&nbsp;existence&nbsp;on&nbsp;replies&nbsp;and&nbsp;prevent&nbsp;caching&nbsp;of&nbsp;those&nbsp;objects.&nbsp;I'm<br>
not&nbsp;sure&nbsp;how&nbsp;that&nbsp;will&nbsp;interact&nbsp;with&nbsp;the&nbsp;vary&nbsp;objects&nbsp;in&nbsp;your&nbsp;case&nbsp;but<br>
none&nbsp;I&nbsp;know&nbsp;of&nbsp;using&nbsp;it&nbsp;has&nbsp;mentioned&nbsp;any&nbsp;issues.<br>
<br>
Amos<br>
<br>
_______________________________________________<br>
squid-users&nbsp;mailing&nbsp;list<br>
&lt;a&nbsp;class=&quot;moz-txt-link-abbreviated&quot;&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;<br>
&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
