<tt>
&lt;html&gt;<br>
&nbsp;&nbsp;&lt;head&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;http-equiv=&quot;content-type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&gt;<br>
&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&lt;body&nbsp;text=&quot;#000000&quot;&nbsp;bgcolor=&quot;#FFFFFF&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Amos,&nbsp;I&nbsp;spent&nbsp;a&nbsp;couple&nbsp;of&nbsp;days&nbsp;doing&nbsp;some&nbsp;test&nbsp;with&nbsp;the&nbsp;info&nbsp;you<br>
&nbsp;&nbsp;&nbsp;&nbsp;gave&nbsp;me:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Retested&nbsp;emptying&nbsp;the&nbsp;cache&nbsp;several&nbsp;times,&nbsp;disabled&nbsp;the&nbsp;rewriter,<br>
&nbsp;&nbsp;&nbsp;&nbsp;different&nbsp;config&nbsp;files&nbsp;..&nbsp;all&nbsp;I&nbsp;could&nbsp;think&nbsp;of&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Downloaded&nbsp;fresh&nbsp;3.5.8&nbsp;tar.gz&nbsp;(just&nbsp;in&nbsp;case&nbsp;it&nbsp;was&nbsp;some&nbsp;3.5.4&nbsp;thing)<br>
&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;compiled&nbsp;it&nbsp;using&nbsp;this&nbsp;configure&nbsp;options:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Squid&nbsp;Cache:&nbsp;Version&nbsp;3.5.8&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Service&nbsp;Name:&nbsp;squid&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;configure&nbsp;options: &nbsp;'--prefix=/usr/local'<br>
&nbsp;&nbsp;&nbsp;&nbsp;'--datadir=/usr/local/share'&nbsp;'--bindir=/usr/local/sbin'<br>
&nbsp;&nbsp;&nbsp;&nbsp;'--libexecdir=/usr/local/lib/squid'&nbsp;'--localstatedir=/var'<br>
&nbsp;&nbsp;&nbsp;&nbsp;'--sysconfdir=/etc/squid3'&nbsp;'--enable-delay-pools'&nbsp;'--enable-ssl'<br>
&nbsp;&nbsp;&nbsp;&nbsp;'--enable-ssl-crtd'&nbsp;'--enable-linux-netfilter'&nbsp;'--enable-eui'<br>
&nbsp;&nbsp;&nbsp;&nbsp;'--enable-snmp'&nbsp;'--enable-gnuregex'&nbsp;'--enable-ltdl-convenience'<br>
&nbsp;&nbsp;&nbsp;&nbsp;'--enable-removal-policies=lru&nbsp;heap'&nbsp;'--enable-http-violations'<br>
&nbsp;&nbsp;&nbsp;&nbsp;'--with-openssl'&nbsp;'--with-filedescriptors=24321'&nbsp;'--enable-poll'<br>
&nbsp;&nbsp;&nbsp;&nbsp;'--enable-epoll'&nbsp;'--enable-storeio=ufs,aufs,diskd,rock'<br>
&nbsp;&nbsp;&nbsp;&nbsp;'--disable-ipv6'&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;And&nbsp;the&nbsp;problem&nbsp;appeared&nbsp;again,&nbsp;I&nbsp;am&nbsp;suspicious&nbsp;that&nbsp;the&nbsp;problem&nbsp;is<br>
&nbsp;&nbsp;&nbsp;&nbsp;in&nbsp;the&nbsp;configuration,&nbsp;I&nbsp;even&nbsp;removed&nbsp;all&nbsp;my&nbsp;refresh&nbsp;patterns,&nbsp;but:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;2015/09/02&nbsp;15:03:42&nbsp;kid1|&nbsp;varyEvaluateMatch:&nbsp;Oops.&nbsp;Not&nbsp;a&nbsp;Vary&nbsp;match<br>
&nbsp;&nbsp;&nbsp;&nbsp;on&nbsp;second&nbsp;attempt,&nbsp;'&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;href=&quot;http://assets.pinterest.com/js/pinit.js&quot;&gt;http://assets.pinterest.com/js/pinit.js&lt;/a&gt;'<br>
&nbsp;&nbsp;&nbsp;&nbsp;'accept-encoding=&quot;gzip,%20deflate&quot;'&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;2015/09/02&nbsp;15:03:42&nbsp;kid1|&nbsp;clientProcessHit:&nbsp;Vary&nbsp;object&nbsp;loop!&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;2015/09/02&nbsp;15:03:43&nbsp;kid1|&nbsp;varyEvaluateMatch:&nbsp;Oops.&nbsp;Not&nbsp;a&nbsp;Vary&nbsp;match<br>
&nbsp;&nbsp;&nbsp;&nbsp;on&nbsp;second&nbsp;attempt,&nbsp;'&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;href=&quot;http://static.cmptch.com/v/lib/str.html&quot;&gt;http://static.cmptch.com/v/lib/str.html&lt;/a&gt;'<br>
&nbsp;&nbsp;&nbsp;&nbsp;'accept-encoding=&quot;gzip,%20deflate,%20sdch&quot;'&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;2015/09/02&nbsp;15:03:43&nbsp;kid1|&nbsp;clientProcessHit:&nbsp;Vary&nbsp;object&nbsp;loop!&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;2015/09/02&nbsp;15:03:43&nbsp;kid1|&nbsp;varyEvaluateMatch:&nbsp;Oops.&nbsp;Not&nbsp;a&nbsp;Vary&nbsp;match<br>
&nbsp;&nbsp;&nbsp;&nbsp;on&nbsp;second&nbsp;attempt,&nbsp;'&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;<br>
href=&quot;http://pstatic.bestpriceninja.com/nwp/v0_0_773/release/Shared/Extra/IFrameStoreReciever.js&quot;&gt;http://pstatic.bestpriceninja.com/nwp/v0_0_773/release/Shared/Extra/IFrameStoreReciever.js&lt;/a&gt;'<br>
&nbsp;&nbsp;&nbsp;&nbsp;'accept-encoding=&quot;gzip,%20deflate,%20sdch&quot;'&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;2015/09/02&nbsp;15:03:43&nbsp;kid1|&nbsp;clientProcessHit:&nbsp;Vary&nbsp;object&nbsp;loop!&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;2015/09/02&nbsp;15:03:59&nbsp;kid1|&nbsp;varyEvaluateMatch:&nbsp;Oops.&nbsp;Not&nbsp;a&nbsp;Vary&nbsp;match<br>
&nbsp;&nbsp;&nbsp;&nbsp;on&nbsp;second&nbsp;attempt,&nbsp;'&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;href=&quot;http://static.xvideos.com/v2/css/xv-video-styles.css?v=7&quot;&gt;http://static.xvideos.com/v2/css/xv-video-styles.css?v=7&lt;/a&gt;'<br>
&nbsp;&nbsp;&nbsp;&nbsp;'accept-encoding=&quot;gzip,deflate&quot;'&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;2015/09/02&nbsp;15:03:59&nbsp;kid1|&nbsp;clientProcessHit:&nbsp;Vary&nbsp;object&nbsp;loop!&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;2015/09/02&nbsp;15:03:59&nbsp;kid1|&nbsp;varyEvaluateMatch:&nbsp;Oops.&nbsp;Not&nbsp;a&nbsp;Vary&nbsp;match<br>
&nbsp;&nbsp;&nbsp;&nbsp;on&nbsp;second&nbsp;attempt,&nbsp;'&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;href=&quot;http://s7.addthis.com/js/250/addthis_widget.js&quot;&gt;http://s7.addthis.com/js/250/addthis_widget.js&lt;/a&gt;'<br>
&nbsp;&nbsp;&nbsp;&nbsp;'accept-encoding=&quot;gzip,deflate&quot;'&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;2015/09/02&nbsp;15:03:59&nbsp;kid1|&nbsp;clientProcessHit:&nbsp;Vary&nbsp;object&nbsp;loop!&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Later&nbsp;on&nbsp;I&nbsp;tested&nbsp;it&nbsp;with&nbsp;this&nbsp;short&nbsp;config&nbsp;file&nbsp;and&nbsp;the&nbsp;problem<br>
&nbsp;&nbsp;&nbsp;&nbsp;persisted:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;http_access&nbsp;allow&nbsp;localhost&nbsp;manager&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;http_access&nbsp;deny&nbsp;manager&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;acl&nbsp;purge&nbsp;method&nbsp;PURGE&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;http_access&nbsp;allow&nbsp;purge&nbsp;localhost&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;http_access&nbsp;deny&nbsp;purge&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;acl&nbsp;all&nbsp;src&nbsp;all&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;acl&nbsp;localhost&nbsp;src&nbsp;127.0.0.1/32&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;acl&nbsp;localnet&nbsp;src&nbsp;127.0.0.0/8&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;80&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;acl&nbsp;snmppublic&nbsp;snmp_community&nbsp;public&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;http_access&nbsp;deny&nbsp;!Safe_ports&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;http_access&nbsp;allow&nbsp;all&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;dns_v4_first&nbsp;on&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;cache_mem&nbsp;1024&nbsp;MB&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;maximum_object_size_in_memory&nbsp;64&nbsp;KB&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;memory_cache_mode&nbsp;always&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;maximum_object_size&nbsp;150000&nbsp;KB&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;minimum_object_size&nbsp;100&nbsp;bytes&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;collapsed_forwarding&nbsp;on&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;logfile_rotate&nbsp;5&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;mime_table&nbsp;/etc/squid3/mime.conf&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;debug_options&nbsp;ALL,1&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;store_id_access&nbsp;deny&nbsp;all&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;store_id_bypass&nbsp;on&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;refresh_pattern&nbsp;^ftp:   &nbsp;   &nbsp;   &nbsp;   &nbsp;   &nbsp;1440   &nbsp;20%   &nbsp;10080&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;refresh_pattern&nbsp;^gopher:   &nbsp;   &nbsp;   &nbsp;   &nbsp;1440   &nbsp;0%   &nbsp;1440&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;refresh_pattern&nbsp;^&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http:\/\/movies\.apple\.com&quot;&gt;http:\/\/movies\.apple\.com&lt;/a&gt;      &nbsp;   &nbsp;86400  <br>
&nbsp;&nbsp;&nbsp;&nbsp;20%    &nbsp;86400&nbsp;override-expire&nbsp;override-lastmod&nbsp;ignore-no-cache<br>
&nbsp;&nbsp;&nbsp;&nbsp;ignore-private&nbsp;ignore-reload&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;refresh_pattern&nbsp;-i&nbsp;\.flv$      &nbsp;   &nbsp;   &nbsp;   &nbsp;10080  &nbsp;90%    &nbsp;999999<br>
&nbsp;&nbsp;&nbsp;&nbsp;ignore-no-cache&nbsp;override-expire&nbsp;ignore-private&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;refresh_pattern&nbsp;-i&nbsp;\.mov$      &nbsp;   &nbsp;   &nbsp;   &nbsp;10080  &nbsp;90%    &nbsp;999999<br>
&nbsp;&nbsp;&nbsp;&nbsp;ignore-no-cache&nbsp;override-expire&nbsp;ignore-private&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;refresh_pattern&nbsp;windowsupdate.com/.*\.(cab|exe)&nbsp;4320&nbsp;100%&nbsp;43200<br>
&nbsp;&nbsp;&nbsp;&nbsp;reload-into-ims&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;refresh_pattern&nbsp;download.microsoft.com/.*\.(cab|exe)&nbsp;4320&nbsp;100%&nbsp;43200<br>
&nbsp;&nbsp;&nbsp;&nbsp;reload-into-ims&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;refresh_pattern&nbsp;-i<br>
&nbsp;&nbsp;&nbsp;&nbsp;\.(deb|rpm|exe|zip|tar|tgz|ram|rar|bin|ppt|doc|pdf|tiff)$&nbsp;10080&nbsp;90%<br>
&nbsp;&nbsp;&nbsp;&nbsp;43200&nbsp;override-expire&nbsp;ignore-no-cache&nbsp;ignore-private&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;refresh_pattern&nbsp;-i&nbsp;(/cgi-bin/)&nbsp;   &nbsp;   &nbsp;   &nbsp;0   &nbsp;0%   &nbsp;0&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;refresh_pattern&nbsp;.   &nbsp;   &nbsp;   &nbsp;   &nbsp;   &nbsp;0   &nbsp;20%   &nbsp;4320&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;quick_abort_min&nbsp;0&nbsp;KB&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;quick_abort_max&nbsp;0&nbsp;KB&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;quick_abort_pct&nbsp;100&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;range_offset_limit&nbsp;0&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;negative_ttl&nbsp;1&nbsp;minute&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;negative_dns_ttl&nbsp;1&nbsp;minute&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;read_ahead_gap&nbsp;128&nbsp;KB&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;request_header_max_size&nbsp;100&nbsp;KB&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;reply_header_max_size&nbsp;100&nbsp;KB&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;via&nbsp;off&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;acl&nbsp;apache&nbsp;rep_header&nbsp;Server&nbsp;^Apache&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;half_closed_clients&nbsp;off&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;cache_mgr&nbsp;webmaster&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;cache_effective_user&nbsp;squid&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;cache_effective_group&nbsp;squid&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;httpd_suppress_version_string&nbsp;on&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;snmp_access&nbsp;allow&nbsp;snmppublic&nbsp;localhost&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;snmp_access&nbsp;deny&nbsp;all&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;snmp_incoming_address&nbsp;127.0.0.1&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;error_directory&nbsp;/etc/squid3/errors/English&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;max_filedescriptors&nbsp;65535&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;ipcache_size&nbsp;1024&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;forwarded_for&nbsp;off&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;log_icp_queries&nbsp;off&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;icp_access&nbsp;allow&nbsp;localnet&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;icp_access&nbsp;deny&nbsp;all&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;htcp_access&nbsp;allow&nbsp;localnet&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;htcp_access&nbsp;deny&nbsp;all&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;digest_rebuild_period&nbsp;15&nbsp;minutes&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;digest_rewrite_period&nbsp;15&nbsp;minutes&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;strip_query_terms&nbsp;off&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;max_open_disk_fds&nbsp;150&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;cache_replacement_policy&nbsp;heap&nbsp;LFUDA&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;memory_pools&nbsp;off&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;http_port&nbsp;9001&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;http_port&nbsp;901&nbsp;tproxy&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;${process_number}&nbsp;=&nbsp;1&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;access_log&nbsp;stdio:/var/log/squid/1/access.log&nbsp;squid&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;cache_log&nbsp;/var/log/squid/1/cache.log&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;cache_store_log&nbsp;none&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;cache_swap_state&nbsp;/var/log/squid/1/%s.swap.state&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;else&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp; access_log&nbsp;none&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp; cache_log&nbsp;/dev/null&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;endif&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;pid_filename&nbsp;/var/run/squid1.pid&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;visible_hostname&nbsp;localhost&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;snmp_port&nbsp;1611&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;icp_port&nbsp;3131&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;htcp_port&nbsp;4828&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;cachemgr_passwd&nbsp;admin&nbsp;thisisnotmyrealpassword&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;memory_cache_shared &nbsp;off&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;cache_dir&nbsp;rock &nbsp;/cache1/rock1&nbsp;256 &nbsp;min-size=100&nbsp;max-size=3000 &nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;cache_dir&nbsp;rock &nbsp;/cache1/rock2&nbsp;2000 &nbsp;min-size=3000&nbsp;max-size=20000 &nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;cache_dir&nbsp;diskd&nbsp;/cache1/diskd2&nbsp;60000&nbsp;16&nbsp;256&nbsp;min-size=20000 <br>
&nbsp;&nbsp;&nbsp;&nbsp;max-size=200000&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;cache_dir&nbsp;diskd&nbsp;/cache2/2&nbsp;100000&nbsp;16&nbsp;256&nbsp;min-size=200000 <br>
&nbsp;&nbsp;&nbsp;&nbsp;max-size=1048576&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;cache_dir&nbsp;diskd&nbsp;/cache2/1&nbsp;680000&nbsp;16&nbsp;256&nbsp;min-size=1048576&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Any&nbsp;ideas&nbsp;what&nbsp;could&nbsp;be&nbsp;wrong?&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Thanks,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Sebastian&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;class=&quot;moz-cite-prefix&quot;&gt;El&nbsp;26/08/15&nbsp;a&nbsp;las&nbsp;17:15,&nbsp;Amos&nbsp;Jeffries<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;escribió:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;class=&quot;&nbsp;cite&quot;&nbsp;id=&quot;mid_55DE1E48_1090900_treenet_co_nz&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cite=&quot;mid:55DE1E48.1090900@treenet.co.nz&quot;&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;On&nbsp;27/08/2015&nbsp;7:53&nbsp;a.m.,&nbsp;Sebastián&nbsp;Goicochea&nbsp;wrote:<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;class=&quot;&nbsp;cite&quot;&nbsp;id=&quot;Cite_6570844&quot;&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;After&nbsp;I&nbsp;sent&nbsp;you&nbsp;my&nbsp;previous&nbsp;email,&nbsp;I&nbsp;continued&nbsp;investigating&nbsp;the<br>
subject&nbsp;..&nbsp;I&nbsp;made&nbsp;a&nbsp;change&nbsp;in&nbsp;the&nbsp;source&nbsp;code&nbsp;as&nbsp;follows:<br>
<br>
File:&nbsp;/src/http.cc<br>
<br>
HttpStateData::haveParsedReplyHeaders()<br>
{<br>
&nbsp;&nbsp;&nbsp;&nbsp;.<br>
&nbsp;&nbsp;&nbsp;&nbsp;.<br>
#####&nbsp;THIS&nbsp;IS&nbsp;NEW&nbsp;STUFF&nbsp;###########<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(rep-&gt;header.has(HDR_VARY))&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;rep-&gt;header.delById(HDR_VARY);<br>
&nbsp;&nbsp;&nbsp;&nbsp;debugs(11,3,&nbsp;&quot;Vary&nbsp;detected.&nbsp;Hack&nbsp;Cleaning&nbsp;it&nbsp;up&quot;);<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
#####&nbsp;END&nbsp;OF&nbsp;NEW&nbsp;STUFF&nbsp;###########<br>
<br>
#if&nbsp;X_ACCELERATOR_VARY<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(rep-&gt;header.has(HDR_X_ACCELERATOR_VARY))&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;rep-&gt;header.delById(HDR_X_ACCELERATOR_VARY);<br>
&nbsp;&nbsp;&nbsp;&nbsp;debugs(11,3,&nbsp;&quot;HDR_X_ACCELERATOR_VARY&nbsp;Vary&nbsp;detected.&nbsp;Hack&nbsp;Cleaning&nbsp;it<br>
up&quot;);<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
#endif<br>
&nbsp;&nbsp;&nbsp;&nbsp;.<br>
&nbsp;&nbsp;&nbsp;&nbsp;.<br>
<br>
<br>
Deleting&nbsp;Vary&nbsp;from&nbsp;the&nbsp;header&nbsp;at&nbsp;this&nbsp;point&nbsp;gives&nbsp;me&nbsp;hits&nbsp;in&nbsp;every<br>
object&nbsp;I&nbsp;test&nbsp;(that&nbsp;previously&nbsp;didn't&nbsp;hit)&nbsp;..&nbsp;web&nbsp;browser&nbsp;never&nbsp;receives<br>
the&nbsp;Vary&nbsp;in&nbsp;the&nbsp;response&nbsp;header.<br>
Now&nbsp;I&nbsp;read&nbsp;your&nbsp;answer&nbsp;and&nbsp;you&nbsp;say&nbsp;that&nbsp;this&nbsp;is&nbsp;a&nbsp;critical&nbsp;validity<br>
check&nbsp;and&nbsp;that&nbsp;worries&nbsp;me.&nbsp;Taking&nbsp;away&nbsp;the&nbsp;vary&nbsp;altogether&nbsp;at&nbsp;this&nbsp;point<br>
could&nbsp;lead&nbsp;to&nbsp;the&nbsp;problems&nbsp;that&nbsp;you&nbsp;described?&nbsp;If&nbsp;that&nbsp;is&nbsp;the&nbsp;case&nbsp;..&nbsp;I<br>
have&nbsp;to&nbsp;investigate&nbsp;other&nbsp;alternatives.<br>
<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;I'll&nbsp;have&nbsp;to&nbsp;look&nbsp;into&nbsp;that&nbsp;function&nbsp;when&nbsp;I'm&nbsp;back&nbsp;at&nbsp;the&nbsp;code&nbsp;later&nbsp;to<br>
confirm&nbsp;this.&nbsp;But&nbsp;IIRC&nbsp;that&nbsp;function&nbsp;is&nbsp;acting&nbsp;directly&nbsp;on&nbsp;a&nbsp;freshly<br>
received&nbsp;reply&nbsp;message.&nbsp;You&nbsp;are&nbsp;not&nbsp;removing&nbsp;the&nbsp;validity&nbsp;check,&nbsp;you&nbsp;are<br>
removing&nbsp;Squids&nbsp;ability&nbsp;to&nbsp;see&nbsp;that&nbsp;it&nbsp;is&nbsp;a&nbsp;Vary&nbsp;object&nbsp;at&nbsp;all.&nbsp;So&nbsp;it&nbsp;is<br>
never&nbsp;even&nbsp;cached&nbsp;as&nbsp;one.<br>
<br>
The&nbsp;side&nbsp;effect&nbsp;of&nbsp;that&nbsp;is&nbsp;that&nbsp;clients&nbsp;asking&nbsp;for&nbsp;non-gzip&nbsp;can&nbsp;get&nbsp;the<br>
cached&nbsp;gzip&nbsp;copy,&nbsp;etc.&nbsp;but&nbsp;at&nbsp;least&nbsp;its&nbsp;the&nbsp;same&nbsp;URL.&nbsp;So&nbsp;the&nbsp;security<br>
risks&nbsp;are&nbsp;gone.&nbsp;But&nbsp;the&nbsp;user&nbsp;experience&nbsp;is&nbsp;not&nbsp;always&nbsp;good&nbsp;either&nbsp;way.<br>
<br>
Amos<br>
<br>
_______________________________________________<br>
squid-users&nbsp;mailing&nbsp;list<br>
&lt;a&nbsp;class=&quot;moz-txt-link-abbreviated&quot;&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;<br>
&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
