<tt>
&lt;html&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;Thanks&nbsp;Amos.&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;To&nbsp;clarify&nbsp;about&nbsp;the&nbsp;user&nbsp;agents:&nbsp;I’m&nbsp;talking&nbsp;about&nbsp;anything&nbsp;with&nbsp;a&nbsp;(logged)&nbsp;SSL&nbsp;bump&nbsp;mode&nbsp;of&nbsp;“splice”&nbsp;—&nbsp;I’m&nbsp;not&nbsp;expecting&nbsp;to&nbsp;see&nbsp;one&nbsp;for&nbsp;the&nbsp;synthetic&nbsp;(“peek&quot;)&nbsp;connections.&nbsp;In&nbsp;this&nbsp;case&nbsp;it’s&nbsp;actually&nbsp;&lt;i&nbsp;class=&quot;&quot;&gt;intercepted&lt;/i&gt;&nbsp;spliced&nbsp;connections.&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;Wondering&nbsp;why&nbsp;a&nbsp;spliced&nbsp;connection&nbsp;doesn't&nbsp;log&nbsp;a&nbsp;UA&nbsp;when&nbsp;an&nbsp;explicit&nbsp;CONNECT&nbsp;does.&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;On&nbsp;8&nbsp;Sep&nbsp;2015,&nbsp;at&nbsp;5:17&nbsp;pm,&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&nbsp;class=&quot;&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;On&nbsp;8/09/2015&nbsp;5:36&nbsp;p.m.,&nbsp;Dan&nbsp;Charlesworth&nbsp;wrote:&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;Hello&nbsp;all&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;I’ve&nbsp;been&nbsp;testing&nbsp;out&nbsp;an&nbsp;SSL&nbsp;bumping&nbsp;config&nbsp;using&nbsp;3.5.8&nbsp;for&nbsp;the&nbsp;last&nbsp;week&nbsp;or&nbsp;so&nbsp;and&nbsp;am&nbsp;scratching&nbsp;my&nbsp;head&nbsp;over&nbsp;a&nbsp;couple&nbsp;of&nbsp;things.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;First,&nbsp;here’s&nbsp;my&nbsp;config&nbsp;(shout&nbsp;out&nbsp;to&nbsp;James&nbsp;Lay):&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;acl&nbsp;tcp_level&nbsp;at_step&nbsp;SslBump1&lt;br&nbsp;class=&quot;&quot;&gt;acl&nbsp;client_hello_peeked&nbsp;at_step&nbsp;SslBump2&lt;br&nbsp;class=&quot;&quot;&gt;acl&nbsp;bump_bypass_domains&nbsp;ssl::server_name&nbsp;“/path/to/some/domains.txt&quot;&lt;br&nbsp;class=&quot;&quot;&gt;ssl_bump&nbsp;splice&nbsp;client_hello_peeked&nbsp;bump_bypass_domains&lt;br&nbsp;class=&quot;&quot;&gt;ssl_bump&nbsp;bump&nbsp;client_hello_peeked&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;1.&nbsp;Why&nbsp;don’t&nbsp;spliced&nbsp;connections&nbsp;get&nbsp;a&nbsp;user&nbsp;agent&nbsp;logged&nbsp;like&nbsp;explicit&nbsp;CONNECTs&nbsp;do?&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/blockquote&gt;&lt;br&nbsp;class=&quot;&quot;&gt;If&nbsp;you&nbsp;are&nbsp;talking&nbsp;about&nbsp;the&nbsp;synthetic&nbsp;CONNECT&nbsp;created&nbsp;on&nbsp;intercepted&lt;br&nbsp;class=&quot;&quot;&gt;traffic&nbsp;it&nbsp;is&nbsp;because&nbsp;there&nbsp;is&nbsp;no&nbsp;User-Agent&nbsp;header&nbsp;and&nbsp;nothing&nbsp;to&lt;br&nbsp;class=&quot;&quot;&gt;create&nbsp;one&nbsp;from.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;If&nbsp;you&nbsp;are&nbsp;seeing&nbsp;explicit&nbsp;CONNECT&nbsp;come&nbsp;in&nbsp;and&nbsp;not&nbsp;have&nbsp;a&nbsp;User-Agent&lt;br&nbsp;class=&quot;&quot;&gt;header&nbsp;when&nbsp;they&nbsp;are&nbsp;spliced.&nbsp;That&nbsp;would&nbsp;seem&nbsp;to&nbsp;be&nbsp;a&nbsp;bug.&nbsp;The&lt;br&nbsp;class=&quot;&quot;&gt;splice/bump&nbsp;stuff&nbsp;should&nbsp;not&nbsp;be&nbsp;affecting&nbsp;the&nbsp;original&nbsp;CONNECT&nbsp;message&lt;br&nbsp;class=&quot;&quot;&gt;the&nbsp;client&nbsp;sent.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;2.&nbsp;Safari&nbsp;produces&nbsp;this&nbsp;error&nbsp;visiting&nbsp;all&nbsp;sorts&nbsp;of&nbsp;websites&nbsp;(github,&nbsp;wikipedia,&nbsp;gmail):&lt;br&nbsp;class=&quot;&quot;&gt;Error&nbsp;negotiating&nbsp;SSL&nbsp;connection&nbsp;on&nbsp;FD&nbsp;15:&nbsp;error:140A1175:SSL&nbsp;routines:SSL_BYTES_TO_CIPHER_LIST:inappropriate&nbsp;fallback&nbsp;(1/-1)&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;…&nbsp;whereas&nbsp;Chrome&nbsp;and&nbsp;Firefox&nbsp;do&nbsp;not.&nbsp;What’s&nbsp;the&nbsp;story&nbsp;with&nbsp;this&nbsp;one?&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/blockquote&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&quot;inappropriate&nbsp;fallback&quot;&nbsp;means&nbsp;the&nbsp;client&nbsp;is&nbsp;claiming&nbsp;it&nbsp;has&nbsp;been&nbsp;forced&lt;br&nbsp;class=&quot;&quot;&gt;down&nbsp;to&nbsp;the&nbsp;SSLv3&nbsp;(or&nbsp;some&nbsp;low/insecure&nbsp;TLS&nbsp;version)&nbsp;because&nbsp;no&nbsp;more&lt;br&nbsp;class=&quot;&quot;&gt;secure&nbsp;version&nbsp;was&nbsp;permitted.&nbsp;But&nbsp;the&nbsp;server&nbsp;is&nbsp;aware&nbsp;that&nbsp;it&nbsp;does&lt;br&nbsp;class=&quot;&quot;&gt;support&nbsp;a&nbsp;higher&nbsp;version.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;It&nbsp;can&nbsp;happen&nbsp;two&nbsp;ways:&lt;br&nbsp;class=&quot;&quot;&gt;1)&nbsp;somebody&nbsp;is&nbsp;MITM'ing&nbsp;the&nbsp;connection&nbsp;and&nbsp;performing&nbsp;the&nbsp;POODLE&nbsp;attack.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;2)&nbsp;client&nbsp;has&nbsp;misconfigured&nbsp;TLS/SSL&nbsp;support.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;TLS&nbsp;agents&nbsp;are&nbsp;supposed&nbsp;to&nbsp;support&nbsp;a&nbsp;_continuous_&nbsp;range&nbsp;of&nbsp;protocol&lt;br&nbsp;class=&quot;&quot;&gt;versions&nbsp;from&nbsp;the&nbsp;set&nbsp;{&nbsp;SSLv2,&nbsp;SSLv3,&nbsp;TLSv1.0,&nbsp;TLSv1.1,&nbsp;TLSv1.2,&nbsp;TLSv1.3&lt;br&nbsp;class=&quot;&quot;&gt;},&nbsp;the&nbsp;client&nbsp;states&nbsp;what&nbsp;it&nbsp;highest&nbsp;is&nbsp;and&nbsp;if&nbsp;it&nbsp;is&nbsp;in&nbsp;the&nbsp;servers&nbsp;set&lt;br&nbsp;class=&quot;&quot;&gt;that&nbsp;gets&nbsp;used.&nbsp;If&nbsp;it&nbsp;gets&nbsp;rejected&nbsp;the&nbsp;client&nbsp;has&nbsp;to&nbsp;fallback&nbsp;to&nbsp;its&lt;br&nbsp;class=&quot;&quot;&gt;next-lower&nbsp;version&nbsp;and&nbsp;try&nbsp;again.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;(2)&nbsp;happens&nbsp;when&nbsp;somebody&nbsp;pokes&nbsp;a&nbsp;hole&nbsp;by&nbsp;disabling&nbsp;one&nbsp;of&nbsp;the&nbsp;protocol&lt;br&nbsp;class=&quot;&quot;&gt;versions&nbsp;in&nbsp;the&nbsp;middle&nbsp;of&nbsp;their&nbsp;otherwise&nbsp;supported&nbsp;range.&nbsp;Usually&nbsp;it&nbsp;is&lt;br&nbsp;class=&quot;&quot;&gt;the&nbsp;client,&nbsp;but&nbsp;servers&nbsp;can&nbsp;do&nbsp;it&nbsp;too.&nbsp;When&nbsp;the&nbsp;'hole'&nbsp;overlaps&nbsp;with&nbsp;the&lt;br&nbsp;class=&quot;&quot;&gt;highest&nbsp;supported&nbsp;version&nbsp;of&nbsp;the&nbsp;other&nbsp;end&nbsp;the&nbsp;fallback&nbsp;mechanism&nbsp;breaks&lt;br&nbsp;class=&quot;&quot;&gt;with&nbsp;the&nbsp;behaviour&nbsp;you&nbsp;see.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;The&nbsp;solution&nbsp;is&nbsp;to&nbsp;ensure&nbsp;the&nbsp;TLS&nbsp;versions&nbsp;supported&nbsp;by&nbsp;the&nbsp;client&nbsp;are&nbsp;a&lt;br&nbsp;class=&quot;&quot;&gt;continuous&nbsp;range.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;*&nbsp;SSLv2&nbsp;should&nbsp;be&nbsp;dead&nbsp;and&nbsp;buried.&nbsp;Disabled&nbsp;everywhere.&nbsp;Kill&nbsp;it&nbsp;ASAP&nbsp;if&lt;br&nbsp;class=&quot;&quot;&gt;you&nbsp;see&nbsp;it&nbsp;enabled&nbsp;anywhere.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;*&nbsp;SSLv3&nbsp;_should_&nbsp;be&nbsp;disabled&nbsp;now&nbsp;too.&nbsp;Using&nbsp;it&nbsp;is&nbsp;actively&nbsp;dangerous.&nbsp;In&lt;br&nbsp;class=&quot;&quot;&gt;the&nbsp;event&nbsp;that&nbsp;it&nbsp;cannot&nbsp;be&nbsp;disabled&nbsp;then&nbsp;TLSv1.0&nbsp;through&nbsp;to&nbsp;the&nbsp;highest&lt;br&nbsp;class=&quot;&quot;&gt;supported&nbsp;TLS&nbsp;version&nbsp;also&nbsp;*need*&nbsp;to&nbsp;be&nbsp;enabled.&nbsp;No&nbsp;poking&nbsp;holes&nbsp;to&lt;br&nbsp;class=&quot;&quot;&gt;disable&nbsp;TLSv1.0&nbsp;with&nbsp;SSLv3&nbsp;still&nbsp;active.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;*&nbsp;TLSv1.0&nbsp;is&nbsp;a&nbsp;good&nbsp;idea&nbsp;to&nbsp;disable.&nbsp;It&nbsp;is&nbsp;not&nbsp;dangerous&nbsp;yet&nbsp;but&nbsp;very&lt;br&nbsp;class=&quot;&quot;&gt;will&nbsp;soon&nbsp;be,&nbsp;and&nbsp;there&nbsp;are&nbsp;a&nbsp;lot&nbsp;of&nbsp;its&nbsp;ciphers&nbsp;which&nbsp;_are_&nbsp;actively&lt;br&nbsp;class=&quot;&quot;&gt;dangerous&nbsp;and&nbsp;require&nbsp;disabling&nbsp;if&nbsp;its&nbsp;going&nbsp;to&nbsp;be&nbsp;allowed.&nbsp;The&nbsp;only&lt;br&nbsp;class=&quot;&quot;&gt;reasons&nbsp;to&nbsp;have&nbsp;it&nbsp;enabled&nbsp;are&nbsp;old&nbsp;TLSv1.0-only&nbsp;software&nbsp;or&nbsp;when&nbsp;SSLv3&lt;br&nbsp;class=&quot;&quot;&gt;is&nbsp;required.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;Amos&lt;br&nbsp;class=&quot;&quot;&gt;_______________________________________________&lt;br&nbsp;class=&quot;&quot;&gt;squid-users&nbsp;mailing&nbsp;list&lt;br&nbsp;class=&quot;&quot;&gt;&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;class=&quot;&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&nbsp;class=&quot;&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/blockquote&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
