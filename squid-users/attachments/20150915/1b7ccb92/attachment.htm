<tt>
&lt;html&gt;<br>
&nbsp;&nbsp;&lt;head&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;http-equiv=&quot;content-type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&gt;<br>
&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&lt;body&nbsp;text=&quot;#000000&quot;&nbsp;bgcolor=&quot;#FFFFFF&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Amos,&nbsp;thanks&nbsp;for&nbsp;your&nbsp;answer.&nbsp;I&nbsp;understand&nbsp;your&nbsp;point&nbsp;in<br>
&nbsp;&nbsp;&nbsp;&nbsp;collapsed_forwarding&nbsp;not&nbsp;being&nbsp;triggered&nbsp;because&nbsp;the&nbsp;requests&nbsp;are<br>
&nbsp;&nbsp;&nbsp;&nbsp;not&nbsp;concurrent,&nbsp;nevertheless&nbsp;if&nbsp;I&nbsp;use&nbsp;collapsed_forwarding&nbsp;the&nbsp;Vary<br>
&nbsp;&nbsp;&nbsp;&nbsp;loop&nbsp;appears,&nbsp;if&nbsp;I&nbsp;disable&nbsp;it,&nbsp;format&nbsp;the&nbsp;cache_dir&nbsp;and&nbsp;start&nbsp;over<br>
&nbsp;&nbsp;&nbsp;&nbsp;..&nbsp;It&nbsp;does&nbsp;not&nbsp;appear.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;you&nbsp;think&nbsp;I&nbsp;could&nbsp;do&nbsp;something&nbsp;else&nbsp;to&nbsp;debug&nbsp;this&nbsp;I'll&nbsp;be&nbsp;glad&nbsp;to<br>
&nbsp;&nbsp;&nbsp;&nbsp;do&nbsp;it.&nbsp;For&nbsp;now&nbsp;I've&nbsp;disabled&nbsp;collapsed_forwarding&nbsp;in&nbsp;my&nbsp;production<br>
&nbsp;&nbsp;&nbsp;&nbsp;servers&nbsp;and&nbsp;everything&nbsp;looks&nbsp;good&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Regards,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Sebastian&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;class=&quot;moz-cite-prefix&quot;&gt;El&nbsp;15/09/15&nbsp;a&nbsp;las&nbsp;07:37,&nbsp;Amos&nbsp;Jeffries<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;escribió:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;class=&quot;&nbsp;cite&quot;&nbsp;id=&quot;mid_55F7F4E1_4060603_treenet_co_nz&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cite=&quot;mid:55F7F4E1.4060603@treenet.co.nz&quot;&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;On&nbsp;15/09/2015&nbsp;9:16&nbsp;a.m.,&nbsp;Sebastián&nbsp;Goicochea&nbsp;wrote:<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;class=&quot;&nbsp;cite&quot;&nbsp;id=&quot;Cite_8080637&quot;&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;I&nbsp;could&nbsp;finally&nbsp;isolate&nbsp;the&nbsp;problem,&nbsp;it&nbsp;only&nbsp;happens&nbsp;if&nbsp;you&nbsp;are&nbsp;using<br>
collapsed_forwarding.<br>
<br>
If&nbsp;you&nbsp;want,&nbsp;you&nbsp;can&nbsp;use&nbsp;this&nbsp;script&nbsp;to&nbsp;replicate&nbsp;it:<br>
<br>
#!/bin/bash<br>
H='--header'<br>
<br>
echo&nbsp;&quot;With&nbsp;Firefox&quot;<br>
wget&nbsp;-d&nbsp;&nbsp;\<br>
$H='Accept:<br>
text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'&nbsp;\<br>
$H='Accept-Encoding:&nbsp;gzip,&nbsp;deflate'&nbsp;\<br>
$H='Accept-Language:&nbsp;en-us,en;q=0.5'&nbsp;\<br>
$H='Cache-Control:&nbsp;max-age=0'&nbsp;\<br>
$H='Connection:&nbsp;keep-alive'&nbsp;\<br>
-U&nbsp;'Mozilla/5.0&nbsp;(Windows&nbsp;NT&nbsp;5.1;&nbsp;rv:10.0.2)&nbsp;Gecko/20100101<br>
Firefox/10.0.2'&nbsp;\<br>
-O&nbsp;/dev/null&nbsp;\<br>
&nbsp;$1<br>
<br>
echo&nbsp;&quot;With&nbsp;Chrome&quot;<br>
wget&nbsp;-d&nbsp;&nbsp;\<br>
$H='Accept:text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'\<br>
<br>
$H='Accept-Charset:ISO-8859-1,utf-8;q=0.7,*;q=0.3'\<br>
$H='Accept-Encoding:gzip,deflate,sdch'\<br>
$H='Accept-Language:es-ES,es;q=0.8'\<br>
$H='Cache-Control:no-cache'\<br>
$H='Connection:keep-alive'\<br>
$H='Pragma:no-cache'\<br>
-U&nbsp;'User-Agent:Mozilla/5.0&nbsp;(X11;&nbsp;Linux&nbsp;x86_64)&nbsp;AppleWebKit/537.32<br>
(KHTML,&nbsp;like&nbsp;Gecko)&nbsp;Chrome/27.0.1425.0&nbsp;Safari/537.32&nbsp;SUSE/27.0.1425.0'\<br>
-O&nbsp;/dev/null&nbsp;\<br>
&nbsp;$1<br>
#&nbsp;End&nbsp;of&nbsp;script<br>
<br>
script&nbsp;usage:&nbsp;./wgets.sh<br>
&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://www.clarin.com/external-images/GranDTUnificada_5729dd7a1487678526c23516a5083661.jpg&quot;&gt;http://www.clarin.com/external-images/GranDTUnificada_5729dd7a1487678526c23516a5083661.jpg&lt;/a&gt;<br>
<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;That&nbsp;script&nbsp;is&nbsp;not&nbsp;doing&nbsp;what&nbsp;you&nbsp;think&nbsp;it&nbsp;is.<br>
<br>
The&nbsp;requests&nbsp;are&nbsp;being&nbsp;made&nbsp;in&nbsp;series&nbsp;with&nbsp;the&nbsp;first&nbsp;one&nbsp;finishing<br>
before&nbsp;the&nbsp;second&nbsp;starts.&nbsp;Your&nbsp;access.log&nbsp;timing&nbsp;confirms&nbsp;that&nbsp;with&nbsp;a<br>
whole&nbsp;18ms&nbsp;between&nbsp;the&nbsp;two&nbsp;requests.<br>
<br>
So&nbsp;I&nbsp;dont&nbsp;think&nbsp;this&nbsp;script&nbsp;is&nbsp;actually&nbsp;triggering&nbsp;the&nbsp;collapsed<br>
forwarding&nbsp;behaviour.&nbsp;Or&nbsp;it&nbsp;should&nbsp;not&nbsp;be&nbsp;if&nbsp;it&nbsp;is.<br>
<br>
<br>
Also,&nbsp;look&nbsp;closely&nbsp;for&nbsp;the&nbsp;&quot;\r\n&quot;&nbsp;between&nbsp;headers.<br>
<br>
[User-Agent:&nbsp;Wget/1.12<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;class=&quot;&nbsp;cite&quot;&nbsp;id=&quot;Cite_5059878&quot;&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;(linux-gnu)\r\nAccept:<br>
text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8--header=Accept-Charset:ISO-8859-1,utf-8;q=0.7,*;q=0.3--header=Accept-Encoding:gzip,deflate,sdch--header=Accept-Language:es-ES,es;q=0.8--header=Cache-Control:no-cache--header=Connection:keep-alive--header=Pragma:no-cache-U\r\nHost:<br>
&lt;a&nbsp;class=&quot;moz-txt-link-abbreviated&quot;&nbsp;href=&quot;http://www.clarin.com\r\nConnection&quot;&gt;www.clarin.com\r\nConnection&lt;/a&gt;:&nbsp;Keep-Alive\r\n]<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;class=&quot;&nbsp;cite&quot;&nbsp;id=&quot;Cite_3693845&quot;&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;cache.log&nbsp;output:<br>
2015/09/14&nbsp;14:05:01&nbsp;kid1|&nbsp;clientProcessHit:&nbsp;Vary&nbsp;object&nbsp;loop!<br>
2015/09/14&nbsp;14:05:27&nbsp;kid1|&nbsp;varyEvaluateMatch:&nbsp;Oops.&nbsp;Not&nbsp;a&nbsp;Vary&nbsp;match&nbsp;on<br>
second&nbsp;attempt,<br>
'&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://www.clarin.com/external-images/GranDTUnificada_5729dd7a1487678526c23516a5083661.jpg&quot;&gt;http://www.clarin.com/external-images/GranDTUnificada_5729dd7a1487678526c23516a5083661.jpg&lt;/a&gt;'<br>
'accept-encoding=&quot;gzip,%20deflate&quot;,<br>
user-agent=&quot;Mozilla%2F5.0%20(Windows%20NT%205.1%3B%20rv%3A10.0.2)%20Gecko%2F20100101%20Firefox%2F10.0.2&quot;'<br>
<br>
2015/09/14&nbsp;14:05:27&nbsp;kid1|&nbsp;clientProcessHit:&nbsp;Vary&nbsp;object&nbsp;loop!<br>
2015/09/14&nbsp;14:05:27&nbsp;kid1|&nbsp;varyEvaluateMatch:&nbsp;Oops.&nbsp;Not&nbsp;a&nbsp;Vary&nbsp;match&nbsp;on<br>
second&nbsp;attempt,<br>
'&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://www.clarin.com/external-images/GranDTUnificada_5729dd7a1487678526c23516a5083661.jpg&quot;&gt;http://www.clarin.com/external-images/GranDTUnificada_5729dd7a1487678526c23516a5083661.jpg&lt;/a&gt;'<br>
'accept-encoding,&nbsp;user-agent=&quot;Wget%2F1.12%20(linux-gnu)&quot;'<br>
2015/09/14&nbsp;14:05:27&nbsp;kid1|&nbsp;clientProcessHit:&nbsp;Vary&nbsp;object&nbsp;loop!<br>
<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;class=&quot;&nbsp;cite&quot;&nbsp;id=&quot;Cite_8281468&quot;&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;What&nbsp;do&nbsp;you&nbsp;think?&nbsp;Is&nbsp;this&nbsp;the&nbsp;expected&nbsp;behaviour?<br>
<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;There&nbsp;is&nbsp;something&nbsp;slightly&nbsp;odd.&nbsp;I'm&nbsp;not&nbsp;sure&nbsp;if&nbsp;its&nbsp;wrong&nbsp;exactly,&nbsp;but<br>
definitely&nbsp;odd.<br>
<br>
<br>
Its&nbsp;not&nbsp;clear&nbsp;if&nbsp;the&nbsp;cache.log&nbsp;output&nbsp;is&nbsp;from&nbsp;the&nbsp;first&nbsp;or&nbsp;second<br>
request.&nbsp;I&nbsp;assume&nbsp;(big&nbsp;IF)&nbsp;that&nbsp;above&nbsp;cache.log&nbsp;is&nbsp;the&nbsp;first&nbsp;one&nbsp;finding<br>
some&nbsp;prior&nbsp;Firefox&nbsp;entry,&nbsp;then&nbsp;the&nbsp;second&nbsp;one&nbsp;finding&nbsp;the&nbsp;first&nbsp;ones&nbsp;entry.<br>
<br>
Its&nbsp;very&nbsp;weird&nbsp;that&nbsp;the&nbsp;second&nbsp;one&nbsp;gets&nbsp;&quot;Not&nbsp;a&nbsp;Vary&nbsp;match&quot;.&nbsp;The&nbsp;lookups<br>
should&nbsp;have&nbsp;been&nbsp;the&nbsp;same&nbsp;regardless&nbsp;of&nbsp;your&nbsp;script&nbsp;breakage.<br>
<br>
Amos<br>
_______________________________________________<br>
squid-users&nbsp;mailing&nbsp;list<br>
&lt;a&nbsp;class=&quot;moz-txt-link-abbreviated&quot;&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;<br>
&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
