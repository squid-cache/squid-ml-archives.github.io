<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;I&nbsp;have&nbsp;configured&nbsp;a&nbsp;Squid&nbsp;3&nbsp;proxy&nbsp;server&nbsp;on&nbsp;Debian&nbsp;7,&nbsp;integrated&nbsp;with&nbsp;Samba&nbsp;4&nbsp;domain.&lt;br&gt;&lt;br&gt;For&nbsp;windows&nbsp;machines&nbsp;integrated&nbsp;in&nbsp;the&nbsp;domain,&nbsp;Squid&nbsp;uses&nbsp;the&nbsp;network&nbsp;user&nbsp;credential&nbsp;to&nbsp;allow&nbsp;navigation.&lt;br&gt;&lt;br&gt;On&nbsp;Linux&nbsp;stations,&nbsp;even&nbsp;in&nbsp;the&nbsp;domain,&nbsp;when&nbsp;is&nbsp;opened&nbsp;the&nbsp;browser,&nbsp;the&nbsp;user&#39;s&nbsp;password&nbsp;is&nbsp;requested.&nbsp;When&nbsp;the&nbsp;user&nbsp;type&nbsp;the&nbsp;correct&nbsp;password&nbsp;in&nbsp;the&nbsp;first&nbsp;time,&nbsp;access&nbsp;is&nbsp;allowed.&nbsp;However&nbsp;if&nbsp;the&nbsp;user&nbsp;wrong&nbsp;the&nbsp;password,&nbsp;a&nbsp;new&nbsp;authentication&nbsp;is&nbsp;required.&nbsp;Now&nbsp;is&nbsp;that&nbsp;the&nbsp;problem&nbsp;starts.&nbsp;Even&nbsp;that&nbsp;user&nbsp;to&nbsp;enter&nbsp;the&nbsp;correct&nbsp;password,&nbsp;appear&nbsp;again&nbsp;a&nbsp;box&nbsp;asking&nbsp;the&nbsp;username&nbsp;and&nbsp;password.&nbsp;In&nbsp;this&nbsp;point&nbsp;is&nbsp;not&nbsp;more&nbsp;possible&nbsp;authenticate&nbsp;in&nbsp;the&nbsp;proxy.&nbsp;It&nbsp;is&nbsp;as&nbsp;if&nbsp;the&nbsp;user&nbsp;were&nbsp;wrong&nbsp;the&nbsp;password.&nbsp;To&nbsp;work&nbsp;the&nbsp;user&nbsp;needs&nbsp;logout&nbsp;and&nbsp;logon&nbsp;again&nbsp;and&nbsp;enter&nbsp;the&nbsp;correct&nbsp;password&nbsp;first&nbsp;time&nbsp;in&nbsp;the&nbsp;browser.&lt;br&gt;&lt;br&gt;Does&nbsp;anyone&nbsp;have&nbsp;an&nbsp;idea&nbsp;what&nbsp;can&nbsp;be?&lt;br&gt;&lt;br&gt;This&nbsp;is&nbsp;my&nbsp;squid.conf&lt;br&gt;&lt;br&gt;###&nbsp;Configuracoes&nbsp;Basicas&lt;br&gt;http_port&nbsp;3128&lt;br&gt;&lt;br&gt;#hierarchy_stoplist&nbsp;cgi-bin&nbsp;?&lt;br&gt;&lt;br&gt;###&nbsp;Bloqueia&nbsp;o&nbsp;cache&nbsp;de&nbsp;CGI&#39;s&lt;br&gt;acl&nbsp;QUERY&nbsp;urlpath_regex&nbsp;cgi-bin&nbsp;\?&lt;br&gt;cache&nbsp;deny&nbsp;QUERY&lt;br&gt;&lt;br&gt;maximum_object_size&nbsp;4096&nbsp;KB&lt;br&gt;minimum_object_size&nbsp;0&nbsp;KB&lt;br&gt;maximum_object_size_in_memory&nbsp;64&nbsp;KB&lt;br&gt;cache_mem&nbsp;60&nbsp;MB&lt;br&gt;&lt;br&gt;#Para&nbsp;não&nbsp;bloquear&nbsp;downloads&lt;br&gt;quick_abort_min&nbsp;-1&nbsp;KB&lt;br&gt;&lt;br&gt;detect_broken_pconn&nbsp;on&lt;br&gt;&lt;br&gt;pipeline_prefetch&nbsp;on&lt;br&gt;&lt;br&gt;fqdncache_size&nbsp;1024&lt;br&gt;&lt;br&gt;###&nbsp;Parametros&nbsp;de&nbsp;atualizacao&nbsp;da&nbsp;memoria&nbsp;cache&lt;br&gt;refresh_pattern&nbsp;^ftp:   &nbsp;1440   &nbsp;20%   &nbsp;10080&lt;br&gt;refresh_pattern&nbsp;^gopher:   &nbsp;1440   &nbsp;0%   &nbsp;1440&lt;br&gt;refresh_pattern&nbsp;-i&nbsp;(/cgi-bin/|\?)&nbsp;0&nbsp;0%&nbsp;   &nbsp;0&lt;br&gt;refresh_pattern&nbsp;.   &nbsp;   &nbsp;0   &nbsp;20%   &nbsp;4320&lt;br&gt;&lt;br&gt;###&nbsp;Parametros&nbsp;de&nbsp;cache&nbsp;em&nbsp;RAM&nbsp;e&nbsp;HD&lt;br&gt;cache_swap_low&nbsp;90&lt;br&gt;cache_swap_high&nbsp;95&lt;br&gt;&lt;br&gt;###&nbsp;Localizacao&nbsp;dos&nbsp;logs&lt;br&gt;cache_access_log&nbsp;/var/log/squid3/access.log&lt;br&gt;cache_log&nbsp;/var/log/squid3/cache.log&lt;br&gt;cache_store_log&nbsp;/var/log/squid3/store.log&lt;br&gt;&lt;br&gt;&lt;br&gt;###&nbsp;define&nbsp;a&nbsp;localizacao&nbsp;do&nbsp;cache&nbsp;de&nbsp;disco,&nbsp;tamanho,&nbsp;qtd&nbsp;de&nbsp;diretorios&nbsp;pai&nbsp;e&nbsp;subdiretorios&lt;br&gt;cache_dir&nbsp;aufs&nbsp;/var/spool/squid3&nbsp;600&nbsp;16&nbsp;256&lt;br&gt;&lt;br&gt;#Controle&nbsp;do&nbsp;arquivo&nbsp;de&nbsp;log&lt;br&gt;logfile_rotate&nbsp;10&lt;br&gt;&lt;br&gt;hosts_file&nbsp;/etc/hosts&lt;br&gt;&lt;br&gt;#Libera&nbsp;acesso&nbsp;ao&nbsp;site&nbsp;da&nbsp;caixa&lt;br&gt;acl&nbsp;caixa&nbsp;dstdomain&nbsp;.&lt;a&nbsp;href=&quot;http://caixa.gov.br&quot;&gt;caixa.gov.br&lt;/a&gt;&lt;br&gt;always_direct&nbsp;allow&nbsp;caixa&lt;br&gt;cache&nbsp;deny&nbsp;caixa&lt;br&gt;&lt;br&gt;&lt;br&gt;###&nbsp;Realiza&nbsp;a&nbsp;autenticacao&nbsp;no&nbsp;AD&nbsp;via&nbsp;Winbind&lt;br&gt;&lt;br&gt;#&nbsp;NTLM&nbsp;&lt;br&gt;#&nbsp;para&nbsp;quem&nbsp;esta&nbsp;logado&nbsp;em&nbsp;maquinas&nbsp;windows,&nbsp;aproveita&nbsp;a&nbsp;senha&nbsp;do&nbsp;logon&lt;br&gt;auth_param&nbsp;ntlm&nbsp;program&nbsp;/usr/bin/ntlm_auth&nbsp;--helper-protocol=squid-2.5-ntlmssp&lt;br&gt;auth_param&nbsp;ntlm&nbsp;children&nbsp;30&lt;br&gt;&lt;br&gt;#auth_param&nbsp;ntlm&nbsp;keep_alive&nbsp;on&lt;br&gt;&lt;br&gt;&lt;br&gt;#&nbsp;para&nbsp;clientes&nbsp;nao&nbsp;windows,&nbsp;user/senha&nbsp;tem&nbsp;de&nbsp;ser&nbsp;solicitado&lt;br&gt;auth_param&nbsp;basic&nbsp;program&nbsp;/usr/bin/ntlm_auth&nbsp;--helper-protocol=squid-2.5-basic&lt;br&gt;auth_param&nbsp;basic&nbsp;children&nbsp;5&lt;br&gt;auth_param&nbsp;basic&nbsp;realm&nbsp;&quot;Acesso&nbsp;Monitorado&quot;&lt;br&gt;auth_param&nbsp;basic&nbsp;credentialsttl&nbsp;2&nbsp;hours&lt;br&gt;&lt;br&gt;external_acl_type&nbsp;ad_group&nbsp;ipv4&nbsp;ttl=600&nbsp;children-max=35&nbsp;%LOGIN&nbsp;/usr/lib/squid3/ext_wbinfo_group_acl&lt;br&gt;&lt;br&gt;&lt;br&gt;###&nbsp;ACLs&lt;br&gt;&lt;br&gt;#acl&nbsp;manager&nbsp;proto&nbsp;cache_object&lt;br&gt;acl&nbsp;localhost&nbsp;src&nbsp;&lt;a&nbsp;href=&quot;http://192.168.0.1/32&quot;&gt;192.168.0.1/32&lt;/a&gt;&lt;br&gt;acl&nbsp;SSL_ports&nbsp;port&nbsp;22&nbsp;443&nbsp;563&nbsp;   &nbsp;#&nbsp;https,&nbsp;snews&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;80   &nbsp;   &nbsp;#&nbsp;http&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;21   &nbsp;   &nbsp;#&nbsp;ftp&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;443&nbsp;563   &nbsp;#&nbsp;https,&nbsp;snews&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;70   &nbsp;   &nbsp;#&nbsp;gopher&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;210   &nbsp;   &nbsp;#&nbsp;wais&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;1025-65535   &nbsp;#&nbsp;unregistered&nbsp;ports&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;280   &nbsp;   &nbsp;#&nbsp;http-mgmt&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;488   &nbsp;   &nbsp;#&nbsp;gss-http&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;591   &nbsp;   &nbsp;#&nbsp;filemaker&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;777   &nbsp;   &nbsp;#&nbsp;multiling&nbsp;http&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;3001       &nbsp;#&nbsp;imprenssa&nbsp;nacional&lt;br&gt;&lt;br&gt;acl&nbsp;purge&nbsp;method&nbsp;PURGE&lt;br&gt;acl&nbsp;CONNECT&nbsp;method&nbsp;CONNECT&lt;br&gt;&lt;br&gt;&lt;br&gt;###&nbsp;Regras&nbsp;iniciais&nbsp;do&nbsp;Squid&lt;br&gt;&lt;br&gt;http_access&nbsp;allow&nbsp;manager&nbsp;localhost&lt;br&gt;http_access&nbsp;deny&nbsp;manager&lt;br&gt;http_access&nbsp;allow&nbsp;purge&nbsp;localhost&lt;br&gt;http_access&nbsp;deny&nbsp;purge&lt;br&gt;http_access&nbsp;deny&nbsp;!Safe_ports&lt;br&gt;http_access&nbsp;deny&nbsp;CONNECT&nbsp;!SSL_ports&lt;br&gt;&lt;br&gt;#acl&nbsp;manager&nbsp;proto&nbsp;cache_object&lt;br&gt;&lt;br&gt;acl&nbsp;connect_abertas&nbsp;maxconn&nbsp;8&lt;br&gt;&lt;br&gt;&lt;br&gt;#&nbsp;acl&nbsp;ligada&nbsp;a&nbsp;autenticacao&lt;br&gt;acl&nbsp;grupo_admins&nbsp;external&nbsp;ad_group&nbsp;gg_webadmins&lt;br&gt;acl&nbsp;grupo_liberado&nbsp;external&nbsp;ad_group&nbsp;gg_webliberados&nbsp;&lt;br&gt;acl&nbsp;grupo_restrito&nbsp;external&nbsp;ad_group&nbsp;gg_webcontrolados&lt;br&gt;&lt;br&gt;&lt;br&gt;###&nbsp;Bloqueia&nbsp;extensoes&nbsp;de&nbsp;arquivos&lt;br&gt;acl&nbsp;extensoes_bloqueadas&nbsp;url_regex&nbsp;-i&nbsp;&quot;/etc/squid3/acls/extensoes-proibidas&quot;&lt;br&gt;&lt;br&gt;###&nbsp;Liberar&nbsp;alguns&nbsp;sites&lt;br&gt;acl&nbsp;sites_liberados&nbsp;url_regex&nbsp;-i&nbsp;&quot;/etc/squid3/acls/sites-permitidos&quot;&lt;br&gt;&lt;br&gt;###&nbsp;Bloqueia&nbsp;sites&nbsp;por&nbsp;URL&lt;br&gt;acl&nbsp;sites_bloqueados&nbsp;url_regex&nbsp;-i&nbsp;&quot;/etc/squid3/acls/sites-proibidos&quot;&lt;br&gt;&lt;br&gt;###&nbsp;Realiza&nbsp;o&nbsp;bloqueio&nbsp;por&nbsp;palavras&lt;br&gt;acl&nbsp;palavras_bloqueadas&nbsp;url_regex&nbsp;-i&nbsp;&quot;/etc/squid3/acls/palavras-proibidas&quot;&lt;br&gt;&lt;br&gt;&lt;br&gt;###&nbsp;Exige&nbsp;autenticacao&lt;br&gt;acl&nbsp;autenticados&nbsp;proxy_auth&nbsp;REQUIRED&lt;br&gt;&lt;br&gt;&lt;br&gt;#libera&nbsp;o&nbsp;grupo&nbsp;internet&lt;br&gt;http_access&nbsp;allow&nbsp;grupo_admins&lt;br&gt;&lt;br&gt;http_access&nbsp;deny&nbsp;extensoes_bloqueadas&lt;br&gt;http_access&nbsp;allow&nbsp;sites_liberados&lt;br&gt;http_access&nbsp;deny&nbsp;sites_bloqueados&nbsp;&lt;br&gt;http_access&nbsp;deny&nbsp;palavras_bloqueadas&nbsp;&lt;br&gt;&lt;br&gt;#####&nbsp;Libera&nbsp;acesso&nbsp;ao&nbsp;grupo&nbsp;de&nbsp;chefes&lt;br&gt;http_access&nbsp;allow&nbsp;grupo_liberado&lt;br&gt;&lt;br&gt;###&nbsp;Liberando&nbsp;midia&nbsp;social&nbsp;e&nbsp;musica&nbsp;no&nbsp;horario&nbsp;do&nbsp;almoco&lt;br&gt;acl&nbsp;almoco&nbsp;time&nbsp;11:30-13:30&lt;br&gt;http_access&nbsp;allow&nbsp;almoco&lt;br&gt;&lt;br&gt;#bloqueia&nbsp;midia&nbsp;social&nbsp;durante&nbsp;o&nbsp;expediente&lt;br&gt;acl&nbsp;social_proibido&nbsp;url_regex&nbsp;-i&nbsp;&quot;/etc/squid3/acls/media-social&quot;&lt;br&gt;http_access&nbsp;deny&nbsp;social_proibido&lt;br&gt;&lt;br&gt;#&nbsp;Regra&nbsp;para&nbsp;bloqueio&nbsp;de&nbsp;extensoes&nbsp;de&nbsp;radios&nbsp;online&nbsp;/&nbsp;arquivos&nbsp;de&nbsp;streaming:&lt;br&gt;acl&nbsp;streaming&nbsp;req_mime_type&nbsp;-i&nbsp;&quot;/etc/squid3/acls/mimeaplicativo&quot;&lt;br&gt;&lt;br&gt;#acl&nbsp;proibir_musica&nbsp;urlpath_regex&nbsp;-i&nbsp;&quot;/etc/squid3/acls/audioextension&quot;&lt;br&gt;acl&nbsp;proibir_musica&nbsp;url_regex&nbsp;-i&nbsp;&quot;/etc/squid3/acls/audioextension&quot;&lt;br&gt;http_access&nbsp;deny&nbsp;proibir_musica&lt;br&gt;http_reply_access&nbsp;deny&nbsp;streaming&nbsp;&lt;br&gt;&lt;br&gt;###&nbsp;Controle&nbsp;de&nbsp;banda&lt;br&gt;###&nbsp;So&nbsp;existe&nbsp;um&nbsp;pool&nbsp;(1)&lt;br&gt;delay_pools&nbsp;1&lt;br&gt;###&nbsp;nr&nbsp;do&nbsp;pool&nbsp;(1)&nbsp;e&nbsp;tipo&nbsp;de&nbsp;classe&nbsp;(2):&nbsp;total&nbsp;da&nbsp;banda&nbsp;disponivel&nbsp;e&nbsp;total&nbsp;de&nbsp;banda&nbsp;por&nbsp;usuario&nbsp;&lt;br&gt;delay_class&nbsp;1&nbsp;2&lt;br&gt;&lt;br&gt;###&nbsp;aprox&nbsp;32Mbps&nbsp;para&nbsp;todos&nbsp;e&nbsp;500Kbps&nbsp;para&nbsp;cada&nbsp;usuario&nbsp;&lt;br&gt;delay_parameters&nbsp;1&nbsp;4194304/4194304&nbsp;64000/64000&lt;br&gt;delay_access&nbsp;1&nbsp;allow&nbsp;grupo_restrito&lt;br&gt;&lt;br&gt;http_access&nbsp;allow&nbsp;grupo_restrito&lt;br&gt;&lt;br&gt;#liberando&nbsp;acesso&nbsp;a&nbsp;todos&nbsp;os&nbsp;usuarios&nbsp;autenticados&lt;br&gt;#http_access&nbsp;deny&nbsp;!autenticados&lt;br&gt;http_access&nbsp;allow&nbsp;autenticados&lt;br&gt;&lt;br&gt;###&nbsp;Rede&nbsp;Local&nbsp;#####&lt;br&gt;acl&nbsp;rede_local&nbsp;src&nbsp;&lt;a&nbsp;href=&quot;http://192.168.0.0/22&quot;&gt;192.168.0.0/22&lt;/a&gt;&lt;br&gt;&lt;br&gt;###&nbsp;Nega&nbsp;acesso&nbsp;de&nbsp;quem&nbsp;nao&nbsp;esta&nbsp;na&nbsp;rede&nbsp;local&lt;br&gt;http_access&nbsp;deny&nbsp;!rede_local&lt;br&gt;&lt;br&gt;#negando&nbsp;o&nbsp;acesso&nbsp;para&nbsp;todos&nbsp;que&nbsp;nao&nbsp;estiverem&nbsp;nas&nbsp;regras&nbsp;anteriores&lt;br&gt;http_access&nbsp;deny&nbsp;all&lt;br&gt;&lt;br&gt;visible_hostname&nbsp;&lt;a&nbsp;href=&quot;http://proxy.empresa.com.br&quot;&gt;proxy.empresa.com.br&lt;/a&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;###&nbsp;Erros&nbsp;em&nbsp;portugues&lt;br&gt;error_directory&nbsp;/usr/share/squid3/errors/Portuguese&lt;br&gt;&lt;br&gt;#cache_effective_user&nbsp;proxy&lt;br&gt;coredump_dir&nbsp;/var/spool/squid3&lt;br&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
