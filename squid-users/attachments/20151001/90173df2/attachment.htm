<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.0&nbsp;TRANSITIONAL//EN&quot;&gt;<br>
&lt;HTML&gt;<br>
&lt;HEAD&gt;<br>
&nbsp;&nbsp;&lt;META&nbsp;HTTP-EQUIV=&quot;Content-Type&quot;&nbsp;CONTENT=&quot;text/html;&nbsp;CHARSET=UTF-8&quot;&gt;<br>
&nbsp;&nbsp;&lt;META&nbsp;NAME=&quot;GENERATOR&quot;&nbsp;CONTENT=&quot;GtkHTML/4.6.6&quot;&gt;<br>
&lt;/HEAD&gt;<br>
&lt;BODY&gt;<br>
On&nbsp;Thu,&nbsp;2015-10-01&nbsp;at&nbsp;13:26&nbsp;+0200,&nbsp;Job&nbsp;wrote:<br>
&lt;BLOCKQUOTE&nbsp;TYPE=CITE&gt;<br>
&lt;PRE&gt;<br>
Hello,<br>
<br>
by&nbsp;reading&nbsp;the&nbsp;3.5&nbsp;Squid&nbsp;verson&nbsp;&quot;Peek&nbsp;and&nbsp;splice&quot;&nbsp;features:<br>
&lt;A&nbsp;HREF=&quot;http://wiki.squid-cache.org/Features/SslPeekAndSplice&quot;&gt;http://wiki.squid-cache.org/Features/SslPeekAndSplice&lt;/A&gt;<br>
<br>
i&nbsp;would&nbsp;like&nbsp;to&nbsp;ask&nbsp;you&nbsp;two&nbsp;questions,&nbsp;please:<br>
<br>
1.&nbsp;in&nbsp;this&nbsp;implementations,&nbsp;i&nbsp;have&nbsp;to&nbsp;install&nbsp;the&nbsp;selfmade&nbsp;Certification&nbsp;Authority&nbsp;as&nbsp;for&nbsp;SSL&nbsp;Bump?<br>
2.&nbsp;how&nbsp;can&nbsp;i&nbsp;block&nbsp;domain&nbsp;(dstdomain&nbsp;with&nbsp;squid)&nbsp;with&nbsp;Peek&nbsp;and&nbsp;Splice?&nbsp;It&nbsp;seems&nbsp;not&nbsp;possible&nbsp;by&nbsp;reading&nbsp;the&nbsp;document<br>
<br>
Thank&nbsp;you&nbsp;for&nbsp;your&nbsp;patience&nbsp;and&nbsp;many&nbsp;thanks!<br>
<br>
Francesco<br>
_______________________________________________<br>
squid-users&nbsp;mailing&nbsp;list<br>
&lt;A&nbsp;HREF=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/A&gt;<br>
&lt;A&nbsp;HREF=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/A&gt;<br>
&lt;/PRE&gt;<br>
&lt;/BLOCKQUOTE&gt;<br>
&lt;BR&gt;<br>
I've&nbsp;found&nbsp;that&nbsp;with&nbsp;peek/splice,&nbsp;instead&nbsp;of&nbsp;stare/bump,&nbsp;I&nbsp;did&nbsp;not&nbsp;need&nbsp;to&nbsp;install&nbsp;the&nbsp;certificate&nbsp;on&nbsp;the&nbsp;end&nbsp;device&nbsp;(daughter&nbsp;got&nbsp;a&nbsp;new&nbsp;phone&nbsp;and&nbsp;I&nbsp;forgot&nbsp;to&nbsp;install&nbsp;it...still&nbsp;worked&nbsp;anyway...cool).&lt;BR&gt;<br>
&lt;BR&gt;<br>
Config&nbsp;below&nbsp;for&nbsp;exactly&nbsp;what&nbsp;you're&nbsp;wanting...change&nbsp;netblocks&nbsp;to&nbsp;what&nbsp;you're&nbsp;using&nbsp;and&nbsp;change&nbsp;cert&nbsp;locations&nbsp;and&nbsp;what&nbsp;not.&nbsp;&nbsp;Before&nbsp;just&nbsp;doing&nbsp;a&nbsp;copy/paste&nbsp;and&nbsp;go,&nbsp;I&nbsp;would&nbsp;recommend&nbsp;reading&nbsp;the&nbsp;docs&nbsp;to&nbsp;get&nbsp;a&nbsp;better&nbsp;understanding&nbsp;of&nbsp;what&nbsp;the&nbsp;below&nbsp;directives&nbsp;mean.&nbsp;&nbsp;The&nbsp;file&nbsp;http_url.txt&nbsp;is&nbsp;regex&nbsp;so&nbsp;it&nbsp;will&nbsp;have&nbsp;entries&nbsp;like&nbsp;\.apple\.com.&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;TT&gt;acl&nbsp;localnet&nbsp;src&nbsp;192.168.1.0/24&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;acl&nbsp;SSL_ports&nbsp;port&nbsp;443&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;80&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;443&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;acl&nbsp;CONNECT&nbsp;method&nbsp;CONNECT&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;acl&nbsp;allowed_http_sites&nbsp;url_regex&nbsp;&quot;/opt/etc/squid/http_url.txt&quot;&lt;/TT&gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;TT&gt;http_access&nbsp;deny&nbsp;!Safe_ports&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;http_access&nbsp;deny&nbsp;CONNECT&nbsp;!SSL_Ports&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;http_access&nbsp;allow&nbsp;SSL_ports&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;http_access&nbsp;allow&nbsp;allowed_http_sites&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;http_access&nbsp;deny&nbsp;all&lt;/TT&gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;TT&gt;acl&nbsp;step1&nbsp;at_step&nbsp;SslBump1&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;acl&nbsp;step2&nbsp;at_step&nbsp;SslBump2&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;acl&nbsp;step3&nbsp;at_step&nbsp;SslBump3&lt;/TT&gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;TT&gt;ssl_bump&nbsp;peek&nbsp;all&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;acl&nbsp;allowed_https_sites&nbsp;ssl::server_name_regex&nbsp;&quot;/opt/etc/squid/http_url.txt&quot;&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;ssl_bump&nbsp;splice&nbsp;allowed_https_sites&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;ssl_bump&nbsp;terminate&nbsp;all&lt;/TT&gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;TT&gt;sslproxy_capath&nbsp;/etc/ssl/certs&lt;/TT&gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;TT&gt;sslcrtd_program&nbsp;/opt/libexec/ssl_crtd&nbsp;-s&nbsp;/opt/var/ssl_db&nbsp;-M&nbsp;4MB&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;sslcrtd_children&nbsp;5&lt;/TT&gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;TT&gt;http_port&nbsp;3128&nbsp;intercept&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;https_port&nbsp;3129&nbsp;intercept&nbsp;ssl-bump&nbsp;cert=/opt/etc/squid/certs/sslsplit_ca_cert.pem&nbsp;cafile=/opt/etc/squid/certs/sslsplit_ca_cert.pem&nbsp;key=/opt/etc/squid/certs/sslsplit_ca_key.pem&nbsp;&nbsp;generate-host-certificates=on&nbsp;dynamic_cert_mem_cache_size=4MB&nbsp;sslflags=NO_SESSION_REUSE&lt;/TT&gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;TT&gt;logformat&nbsp;mine&nbsp;%&gt;a&nbsp;%[ui&nbsp;%[un&nbsp;[%tl]&nbsp;&quot;%rm&nbsp;%ru&nbsp;HTTP/%rv&quot;&nbsp;%ssl::&gt;sni&nbsp;%ssl::&gt;cert_subject&nbsp;%&gt;Hs&nbsp;%&lt;st&nbsp;%Ss:%Sh&lt;/TT&gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;TT&gt;access_log&nbsp;syslog:daemon.info&nbsp;mine&lt;/TT&gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;TT&gt;refresh_pattern&nbsp;-i&nbsp;(cgi-bin|\?)&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&lt;/TT&gt;&lt;BR&gt;<br>
&lt;TT&gt;refresh_pattern&nbsp;.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;20%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4320&lt;/TT&gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;TT&gt;coredump_dir&nbsp;/opt/var&lt;/TT&gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
James<br>
&lt;/BODY&gt;<br>
&lt;/HTML&gt;<br>

</tt>
