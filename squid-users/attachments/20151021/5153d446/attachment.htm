<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html&nbsp;charset=utf-8&quot;&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&quot;&nbsp;class=&quot;&quot;&gt;Hello,&nbsp;&lt;br&nbsp;class=&quot;&quot;&gt;So&nbsp;what&nbsp;I&nbsp;am&nbsp;trying&nbsp;to&nbsp;accomplish&nbsp;here&nbsp;is&nbsp;to&nbsp;basically&nbsp;have&nbsp;a&nbsp;whitelist&nbsp;of&nbsp;domains&nbsp;that&nbsp;is&nbsp;allowed&nbsp;via&nbsp;http/https.&nbsp;If&nbsp;the&nbsp;UID&nbsp;is&nbsp;squid,apache,&nbsp;or&nbsp;root&nbsp;then&nbsp;basically&nbsp;you&nbsp;will&nbsp;bypass&nbsp;squid&nbsp;and&nbsp;anything&nbsp;is&nbsp;allowed.&nbsp;This&nbsp;was&nbsp;working&nbsp;well&nbsp;on&nbsp;3.4.2&nbsp;however&nbsp;once&nbsp;I&nbsp;moved&nbsp;to&nbsp;3.5.10&nbsp;it&nbsp;no&nbsp;longer&nbsp;works&nbsp;properly.&nbsp;I&nbsp;also&nbsp;noticed&nbsp;that&nbsp;there&nbsp;are&nbsp;“new”&nbsp;features&nbsp;peek,slice&nbsp;etc&nbsp;which&nbsp;is&nbsp;probably&nbsp;my&nbsp;issue&nbsp;since&nbsp;I&nbsp;was&nbsp;not&nbsp;using&nbsp;it.&nbsp;I&nbsp;have&nbsp;tried&nbsp;several&nbsp;combination&nbsp;and&nbsp;have&nbsp;only&nbsp;gotten&nbsp;it&nbsp;to&nbsp;work&nbsp;for&nbsp;http&nbsp;traffic.&nbsp;All&nbsp;https&nbsp;traffic&nbsp;is&nbsp;currently&nbsp;being&nbsp;blocked&nbsp;by&nbsp;the&nbsp;configuration.&nbsp;Below&nbsp;are&nbsp;my&nbsp;configurations.&nbsp;&nbsp;I&nbsp;don’t&nbsp;need&nbsp;to&nbsp;&quot;inspect&quot;&nbsp;any&nbsp;of&nbsp;the&nbsp;traffic&nbsp;just&nbsp;want&nbsp;to&nbsp;have&nbsp;a&nbsp;whitelist&nbsp;of&nbsp;allowed&nbsp;domains&nbsp;if&nbsp;you&nbsp;are&nbsp;not&nbsp;UID&nbsp;squid,apache,&nbsp;or&nbsp;root&nbsp;via&nbsp;http/https.&nbsp;Any&nbsp;help&nbsp;would&nbsp;be&nbsp;appreciated&nbsp;!!&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;#####&nbsp;IPTABLES&lt;br&nbsp;class=&quot;&quot;&gt;$iptables&nbsp;-L&nbsp;-t&nbsp;nat&lt;br&nbsp;class=&quot;&quot;&gt;Chain&nbsp;PREROUTING&nbsp;(policy&nbsp;ACCEPT)&lt;br&nbsp;class=&quot;&quot;&gt;target&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prot&nbsp;opt&nbsp;source&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destination&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;Chain&nbsp;POSTROUTING&nbsp;(policy&nbsp;ACCEPT)&lt;br&nbsp;class=&quot;&quot;&gt;target&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prot&nbsp;opt&nbsp;source&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destination&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;Chain&nbsp;OUTPUT&nbsp;(policy&nbsp;ACCEPT)&lt;br&nbsp;class=&quot;&quot;&gt;target&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prot&nbsp;opt&nbsp;source&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destination&lt;br&nbsp;class=&quot;&quot;&gt;natoutlogaccept&nbsp;&nbsp;tcp&nbsp;&nbsp;--&nbsp;&nbsp;anywhere&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;anywhere&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;multiport&nbsp;dports&nbsp;http,https&nbsp;owner&nbsp;UID&nbsp;match&nbsp;squid&lt;br&nbsp;class=&quot;&quot;&gt;natoutlogaccept&nbsp;&nbsp;tcp&nbsp;&nbsp;--&nbsp;&nbsp;anywhere&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;anywhere&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;multiport&nbsp;dports&nbsp;http,https&nbsp;owner&nbsp;UID&nbsp;match&nbsp;apache&lt;br&nbsp;class=&quot;&quot;&gt;natoutlogaccept&nbsp;&nbsp;tcp&nbsp;&nbsp;--&nbsp;&nbsp;anywhere&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;anywhere&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;multiport&nbsp;dports&nbsp;http,https&nbsp;owner&nbsp;UID&nbsp;match&nbsp;root&lt;br&nbsp;class=&quot;&quot;&gt;REDIRECT&nbsp;&nbsp;&nbsp;tcp&nbsp;&nbsp;--&nbsp;&nbsp;anywhere&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;anywhere&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tcp&nbsp;dpt:http&nbsp;redir&nbsp;ports&nbsp;3401&lt;br&nbsp;class=&quot;&quot;&gt;REDIRECT&nbsp;&nbsp;&nbsp;tcp&nbsp;&nbsp;--&nbsp;&nbsp;anywhere&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;anywhere&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tcp&nbsp;dpt:https&nbsp;redir&nbsp;ports&nbsp;4827&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;Chain&nbsp;natoutlogaccept&nbsp;(3&nbsp;references)&lt;br&nbsp;class=&quot;&quot;&gt;target&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prot&nbsp;opt&nbsp;source&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destination&lt;br&nbsp;class=&quot;&quot;&gt;LOG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;all&nbsp;&nbsp;--&nbsp;&nbsp;anywhere&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;anywhere&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOG&nbsp;level&nbsp;debug&nbsp;prefix&nbsp;`nat&nbsp;out&nbsp;iptables&nbsp;accept&nbsp;'&lt;br&nbsp;class=&quot;&quot;&gt;ACCEPT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;all&nbsp;&nbsp;--&nbsp;&nbsp;anywhere&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;anywhere&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;#####&nbsp;Squid.conf&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;sslproxy_cert_error&nbsp;allow&nbsp;all&lt;br&nbsp;class=&quot;&quot;&gt;sslproxy_flags&nbsp;DONT_VERIFY_PEER&lt;br&nbsp;class=&quot;&quot;&gt;sslcrtd_program&nbsp;/usr/lib64/squid/ssl_crtd&nbsp;-s&nbsp;/home/squid/ssl_db&nbsp;-M&nbsp;4MB&lt;br&nbsp;class=&quot;&quot;&gt;sslcrtd_children&nbsp;50&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;https_port&nbsp;4827&nbsp;intercept&nbsp;ssl-bump&nbsp;generate-host-certificates=on&nbsp;dynamic_cert_mem_cache_size=4MB&nbsp;cert=/etc/squid/certs/squid.aarp.org.crt&nbsp;key=/etc/squid/certs/squid.key&lt;br&nbsp;class=&quot;&quot;&gt;#&nbsp;HTTPS&nbsp;forward&nbsp;port&lt;br&nbsp;class=&quot;&quot;&gt;https_port&nbsp;127.0.0.1:6887&nbsp;cert=/etc/squid/certs/squid.crt&nbsp;key=/etc/squid/certs/squid.key&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;http_port&nbsp;3401&nbsp;transparent&lt;br&nbsp;class=&quot;&quot;&gt;#&nbsp;HTTP&nbsp;forward&nbsp;port&lt;br&nbsp;class=&quot;&quot;&gt;http_port&nbsp;127.0.0.1:6886&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;logformat&nbsp;squid&nbsp;%tl.%03tu&nbsp;%6tr&nbsp;%&gt;a&nbsp;%Ss/%03Hs&nbsp;%&lt;st&nbsp;%rm&nbsp;%ru&nbsp;%[un&nbsp;%Sh/%&lt;a&nbsp;%mt&lt;br&nbsp;class=&quot;&quot;&gt;access_log&nbsp;/var/log/squid/access.log&nbsp;squid&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;always_direct&nbsp;allow&nbsp;all&lt;br&nbsp;class=&quot;&quot;&gt;cache&nbsp;deny&nbsp;all&lt;br&nbsp;class=&quot;&quot;&gt;cache_dir&nbsp;ufs&nbsp;/home/squid/cache&nbsp;100&nbsp;16&nbsp;256&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;acl&nbsp;step1&nbsp;at_step&nbsp;SslBump1&lt;br&nbsp;class=&quot;&quot;&gt;acl&nbsp;step2&nbsp;at_step&nbsp;SslBump2&lt;br&nbsp;class=&quot;&quot;&gt;acl&nbsp;step3&nbsp;at_step&nbsp;SslBump3&lt;br&nbsp;class=&quot;&quot;&gt;acl&nbsp;nobumpSites&nbsp;ssl::server_name&nbsp;&quot;/etc/squid/allowed_domains/allowed_domains&quot;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;ssl_bump&nbsp;peek&nbsp;step1&nbsp;all&lt;br&nbsp;class=&quot;&quot;&gt;ssl_bump&nbsp;splice&nbsp;nobumpSites&lt;br&nbsp;class=&quot;&quot;&gt;ssl_bump&nbsp;bump&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;acl&nbsp;http&nbsp;proto&nbsp;http&lt;br&nbsp;class=&quot;&quot;&gt;acl&nbsp;https&nbsp;proto&nbsp;https&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;acl&nbsp;port_80&nbsp;port&nbsp;80&lt;br&nbsp;class=&quot;&quot;&gt;acl&nbsp;port_443&nbsp;port&nbsp;443&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;http_access&nbsp;allow&nbsp;http&nbsp;port_80&nbsp;nobumpSites&lt;br&nbsp;class=&quot;&quot;&gt;http_access&nbsp;allow&nbsp;https&nbsp;port_443&nbsp;nobumpSites&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;http_access&nbsp;deny&nbsp;all&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;#####&nbsp;allowed_domains&lt;br&nbsp;class=&quot;&quot;&gt;.&lt;a&nbsp;href=&quot;http://cnn.com&quot;&nbsp;class=&quot;&quot;&gt;cnn.com&lt;/a&gt;&lt;br&nbsp;class=&quot;&quot;&gt;.&lt;a&nbsp;href=&quot;http://google.com&quot;&nbsp;class=&quot;&quot;&gt;google.com&lt;/a&gt;&lt;br&nbsp;class=&quot;&quot;&gt;.&lt;a&nbsp;href=&quot;http://facebook.com&quot;&nbsp;class=&quot;&quot;&gt;facebook.com&lt;/a&gt;&lt;br&nbsp;class=&quot;&quot;&gt;….etc&nbsp;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;####&nbsp;squid&nbsp;log&lt;br&nbsp;class=&quot;&quot;&gt;TAG_NONE/403&nbsp;350&nbsp;HEAD&nbsp;&lt;a&nbsp;href=&quot;https://www.facebook.com/&quot;&nbsp;class=&quot;&quot;&gt;https://www.facebook.com/&lt;/a&gt;&nbsp;-&nbsp;HIER_NONE/-&nbsp;text/html&lt;br&nbsp;class=&quot;&quot;&gt;TCP_MISS/200&nbsp;593&nbsp;GET&nbsp;&lt;a&nbsp;href=&quot;http://www.cnn.com/&quot;&nbsp;class=&quot;&quot;&gt;http://www.cnn.com/&lt;/a&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
