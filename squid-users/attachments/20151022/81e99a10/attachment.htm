<tt>
&lt;p&nbsp;dir=&quot;ltr&quot;&gt;Would&nbsp;it&nbsp;be&nbsp;fair&nbsp;to&nbsp;say&nbsp;best&nbsp;practiceÂ &nbsp;is&nbsp;to&nbsp;get&nbsp;kerbose&nbsp;working&nbsp;in&nbsp;favour&nbsp;of&nbsp;ntlm&nbsp;?&lt;/p&gt;<br>
&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;21/10/2015&nbsp;3:18&nbsp;PM,&nbsp;&quot;Amos&nbsp;Jeffries&quot;&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&nbsp;type=&quot;attribution&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;On&nbsp;2015-10-21&nbsp;15:38,&nbsp;Ilias&nbsp;Clifton&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
On&nbsp;20/10/2015&nbsp;4:04&nbsp;p.m.,&nbsp;Ilias&nbsp;Clifton&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;Hi&nbsp;All,&lt;br&gt;<br>
&gt;&nbsp;I&#39;ve&nbsp;been&nbsp;following&nbsp;the&nbsp;guide&nbsp;at&nbsp;this&nbsp;location&nbsp;for&nbsp;Active&nbsp;Directory&nbsp;integration&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;http://wiki.bitbinary.com/index.php/Active_Directory_Integrated_Squid_Proxy%5Bhttp://wiki.bitbinary.com/index.php/&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://wiki.bitbinary.com/index.php/Active_Directory_Integrated_Squid_Proxy[http://wiki.bitbinary.com/index.php/&lt;/a&gt;&gt;Active_Directory_Integrated_Squid_Proxy]&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;First,&nbsp;some&nbsp;versions&nbsp;for&nbsp;sanity..&lt;br&gt;<br>
&gt;&nbsp;Ubuntu&nbsp;:&nbsp;14.04.3&nbsp;LTS&lt;br&gt;<br>
&gt;&nbsp;Squid&nbsp;:&nbsp;3.3.8&nbsp;(from&nbsp;ubuntu&nbsp;repositories)&lt;br&gt;<br>
&gt;&nbsp;Samba&nbsp;:&nbsp;4.1.6-Ubuntu&lt;br&gt;<br>
&gt;&nbsp;DC&nbsp;:&nbsp;Windows&nbsp;Server&nbsp;2012&nbsp;R2&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;am&nbsp;currently&nbsp;testing&nbsp;the&nbsp;authentication,&nbsp;negotiate&nbsp;kerberos&nbsp;and&nbsp;basic&nbsp;ldap&nbsp;are&lt;br&gt;<br>
&gt;&nbsp;both&nbsp;working&nbsp;correctly.&nbsp;However&nbsp;ntlm&nbsp;is&nbsp;not&nbsp;and&nbsp;I&nbsp;don&#39;t&nbsp;seem&nbsp;to&nbsp;making&nbsp;any&lt;br&gt;<br>
&gt;&nbsp;progress&nbsp;on&nbsp;debugging&nbsp;further.&lt;br&gt;<br>
&lt;br&gt;<br>
Date:&nbsp;Tue,&nbsp;20&nbsp;Oct&nbsp;2015&nbsp;18:06:17&nbsp;+1300&lt;br&gt;<br>
From:&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&nbsp;target=&quot;_blank&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Your&nbsp;version&nbsp;of&nbsp;Squid&nbsp;has&nbsp;big&nbsp;problems&nbsp;with&nbsp;(4)&nbsp;and&nbsp;some&nbsp;with&nbsp;(2),&nbsp;and&lt;br&gt;<br>
your&nbsp;DC&nbsp;server&nbsp;version&nbsp;has&nbsp;big&nbsp;problems&nbsp;with&nbsp;(1)&nbsp;and&nbsp;(3).&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Amos&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
Hi&nbsp;Amos,&lt;br&gt;<br>
&lt;br&gt;<br>
Thank&nbsp;you&nbsp;for&nbsp;your&nbsp;detailed&nbsp;answer.&lt;br&gt;<br>
&lt;br&gt;<br>
So&nbsp;what&nbsp;is&nbsp;the&nbsp;best&nbsp;way&nbsp;to&nbsp;authenticate&nbsp;users&nbsp;in&nbsp;a&nbsp;mixed&nbsp;environment?&lt;br&gt;<br>
I&#39;ve&nbsp;got&nbsp;Windows&nbsp;domain&nbsp;PCs&nbsp;with&nbsp;IE/firefox/chrome.&nbsp;Linux&nbsp;PCs&nbsp;with&lt;br&gt;<br>
Firefox/chrome.&nbsp;Windows&nbsp;non-domain&nbsp;joined&nbsp;PCs&nbsp;with&nbsp;IE/firefox/chrome&nbsp;-&lt;br&gt;<br>
plus&nbsp;various&nbsp;mobile&nbsp;devices.&lt;br&gt;<br>
&lt;br&gt;<br>
I&#39;ve&nbsp;tried&nbsp;getting&nbsp;rid&nbsp;of&nbsp;ntlm&nbsp;and&nbsp;just&nbsp;using&nbsp;negotiate&nbsp;kerberos&nbsp;and&lt;br&gt;<br>
ldap&nbsp;for&nbsp;basic,&nbsp;is&nbsp;that&nbsp;all&nbsp;I&nbsp;need?&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
I&nbsp;believe&nbsp;thats&nbsp;at&nbsp;least&nbsp;very&nbsp;close&nbsp;to&nbsp;the&nbsp;solution.&nbsp;The&nbsp;getting&nbsp;rid&nbsp;of&nbsp;NTLM&nbsp;is&nbsp;something&nbsp;that&nbsp;needs&nbsp;to&nbsp;happen&nbsp;at&nbsp;the&nbsp;client&nbsp;end&nbsp;though,&nbsp;so&nbsp;IE&nbsp;does&nbsp;not&nbsp;attempt&nbsp;to&nbsp;use&nbsp;it&nbsp;over&nbsp;Negotiate&nbsp;scheme.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
On&nbsp;the&nbsp;non-domain&nbsp;joined&nbsp;PCs,&nbsp;if&nbsp;I&nbsp;disable&nbsp;&#39;Enable&nbsp;Integrated&nbsp;Windows&lt;br&gt;<br>
Authentication&#39;,&nbsp;they&nbsp;now&nbsp;correctly&nbsp;use&nbsp;basic&nbsp;ldap.&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
And&nbsp;thats&nbsp;the&nbsp;way&nbsp;to&nbsp;do&nbsp;it&nbsp;IIRC.&nbsp;Someone&nbsp;more&nbsp;familiar&nbsp;may&nbsp;know&nbsp;a&nbsp;better&nbsp;way.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
My&nbsp;config&nbsp;now&nbsp;looks&nbsp;like..&lt;br&gt;<br>
&lt;br&gt;<br>
###&nbsp;negotiate&nbsp;kerberos&nbsp;and&nbsp;ntlm&nbsp;authentication&lt;br&gt;<br>
auth_param&nbsp;negotiate&nbsp;program&nbsp;/usr/lib/squid3/negotiate_kerberos_auth&lt;br&gt;<br>
-d&nbsp;-s&nbsp;GSS_C_NO_NAME&lt;br&gt;<br>
auth_param&nbsp;negotiate&nbsp;children&nbsp;10&lt;br&gt;<br>
auth_param&nbsp;negotiate&nbsp;keep_alive&nbsp;off&lt;br&gt;<br>
&lt;br&gt;<br>
###&nbsp;provide&nbsp;basic&nbsp;authentication&nbsp;via&nbsp;ldap&nbsp;for&nbsp;clients&nbsp;not&lt;br&gt;<br>
authenticated&nbsp;via&nbsp;kerberos/ntlm&lt;br&gt;<br>
auth_param&nbsp;basic&nbsp;program&nbsp;/usr/lib/squid3/basic_ldap_auth&nbsp;-R&nbsp;-b&lt;br&gt;<br>
&quot;DC=domain,DC=local&quot;&nbsp;-D&nbsp;proxyuser&nbsp;at&nbsp;domain.local&nbsp;-W&lt;br&gt;<br>
/etc/squid3/ldappass.txt&nbsp;-f&nbsp;sAMAccountName=%s&nbsp;-h&nbsp;dc1.domain.local&lt;br&gt;<br>
auth_param&nbsp;basic&nbsp;children&nbsp;10&lt;br&gt;<br>
auth_param&nbsp;basic&nbsp;realm&nbsp;Internet&nbsp;Proxy&lt;br&gt;<br>
auth_param&nbsp;basic&nbsp;credentialsttl&nbsp;30&nbsp;minutes&lt;br&gt;<br>
&lt;br&gt;<br>
###&nbsp;ldap&nbsp;authorisation&lt;br&gt;<br>
external_acl_type&nbsp;memberof&nbsp;%LOGIN&nbsp;/usr/lib/squid3/ext_ldap_group_acl&lt;br&gt;<br>
-R&nbsp;-K&nbsp;-S&nbsp;-b&nbsp;&quot;DC=domain,DC=local&quot;&nbsp;-D&nbsp;proxyuser&nbsp;at&nbsp;domain.local&nbsp;-W&lt;br&gt;<br>
/etc/squid3/ldappass.txt&nbsp;-f&lt;br&gt;<br>
&quot;(&amp;(objectclass=person)(sAMAccountName=%v)(memberof=cn=%g,OU=Proxy,DC=domain,DC=local))&quot;&lt;br&gt;<br>
-h&nbsp;dc1.domain.local&lt;br&gt;<br>
&lt;br&gt;<br>
Does&nbsp;that&nbsp;look&nbsp;ok?&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
Looks&nbsp;reasonable&nbsp;for&nbsp;a&nbsp;small&nbsp;installation.&nbsp;If&nbsp;you&nbsp;have&nbsp;a&nbsp;medium&nbsp;to&nbsp;large&nbsp;network&nbsp;you&nbsp;may&nbsp;find&nbsp;Squid&nbsp;mentioning&nbsp;queue&nbsp;issues&nbsp;and&nbsp;requesting&nbsp;more&nbsp;helper&nbsp;children&nbsp;be&nbsp;configured.&nbsp;Simply&nbsp;increasing&nbsp;the&nbsp;numbers&nbsp;there&nbsp;should&nbsp;resolve&nbsp;that.&lt;br&gt;<br>
&lt;br&gt;<br>
Amos&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>

</tt>
