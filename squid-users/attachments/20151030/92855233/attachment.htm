<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;Thanks&nbsp;for&nbsp;your&nbsp;reply&nbsp;Alex,&lt;br&gt;&lt;br&gt;&lt;/div&gt;I&nbsp;understood&nbsp;your&nbsp;considerations.&nbsp;Maybe,&nbsp;I&nbsp;really&nbsp;didn&#39;t&nbsp;understand&nbsp;very&nbsp;well&nbsp;how&nbsp;the&nbsp;SslBump&nbsp;works,&nbsp;the&nbsp;differences&nbsp;between&nbsp;peek&nbsp;and&nbsp;splice&nbsp;and&nbsp;steps&nbsp;SslBump1,&nbsp;2&nbsp;and&nbsp;3.&lt;br&gt;&lt;pre&gt;&lt;/pre&gt;I&#39;m&nbsp;searching&nbsp;and&nbsp;studing&nbsp;about&nbsp;this&nbsp;last&nbsp;two&nbsp;days,&nbsp;and&nbsp;I&nbsp;need&nbsp;to&nbsp;undertand&nbsp;better&nbsp;about&nbsp;this&nbsp;questions.&lt;br&gt;&lt;br&gt;&lt;/div&gt;There&#39;s&nbsp;a&nbsp;way&nbsp;to&nbsp;join&nbsp;ssl_bump&nbsp;+&nbsp;a&nbsp;simple&nbsp;acl?&nbsp;Basicly,&nbsp;I&nbsp;would&nbsp;like&nbsp;to&nbsp;permit&nbsp;access&nbsp;to&nbsp;some&nbsp;sites,&nbsp;like&nbsp;facebbok,&nbsp;linkedin,&nbsp;for&nbsp;example.&nbsp;during&nbsp;a&nbsp;period&nbsp;of&nbsp;day&nbsp;time,&nbsp;for&nbsp;example:&lt;br&gt;&lt;br&gt;acl&nbsp;after_work&nbsp;time&nbsp;MTWHFAS&nbsp;18:00-21:00&lt;br&gt;ssl_bump&nbsp;terminate&nbsp;deny_https_sites&nbsp;!after_work&lt;br&gt;&lt;br&gt;&lt;/div&gt;Thanks,&lt;br&gt;&lt;div&gt;&lt;br&gt;&lt;br&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;2015-10-29&nbsp;20:35&nbsp;GMT-02:00&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&nbsp;target=&quot;_blank&quot;&gt;rousskov@measurement-factory.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;On&nbsp;10/29/2015&nbsp;04:09&nbsp;PM,&nbsp;Rodrigo&nbsp;de&nbsp;Lima&nbsp;Silva&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;I&#39;ve&nbsp;been&nbsp;configured&nbsp;Squid&nbsp;version&nbsp;3.5.9&nbsp;and&nbsp;transparent&nbsp;proxy.&nbsp;To&nbsp;do&lt;br&gt;<br>
&gt;&nbsp;this.&nbsp;I&nbsp;used&nbsp;the&nbsp;&quot;peek&nbsp;and&nbsp;splice&quot;&nbsp;feature&nbsp;to&nbsp;works&nbsp;with&nbsp;https&nbsp;protocol&lt;br&gt;<br>
&gt;&nbsp;in&nbsp;transparent&nbsp;mode.&nbsp;It&#39;s&nbsp;works&nbsp;fine.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;There&nbsp;is&nbsp;a&nbsp;&quot;acl&quot;&nbsp;to&nbsp;block&nbsp;some&nbsp;sites,&nbsp;like&nbsp;&lt;a&nbsp;href=&quot;http://facebook.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;facebook.com&lt;/a&gt;&lt;br&gt;<br>
&lt;/span&gt;&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://facebook.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://facebook.com&lt;/a&gt;&gt;,&nbsp;&lt;a&nbsp;href=&quot;http://linkedin.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;linkedin.com&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://linkedin.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://linkedin.com&lt;/a&gt;&gt;,&nbsp;etc...&nbsp;It&#39;s&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;&quot;&gt;&gt;&nbsp;works&nbsp;fine&nbsp;too.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;deny_https_sites&nbsp;ssl::server_name_regex&nbsp;&quot;/etc/squid/https_url.txt&quot;&lt;br&gt;<br>
&gt;&nbsp;ssl_bump&nbsp;terminate&nbsp;deny_https_sites&lt;br&gt;<br>
&gt;&nbsp;ssl_bump&nbsp;peek&nbsp;all&lt;br&gt;<br>
&gt;&nbsp;ssl_bump&nbsp;splice&nbsp;all&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;The&nbsp;above&nbsp;is&nbsp;kind&nbsp;of&nbsp;wrong&nbsp;because&nbsp;it&nbsp;may&nbsp;terminate&nbsp;before&nbsp;learning&lt;br&gt;<br>
enough&nbsp;about&nbsp;the&nbsp;connection.&nbsp;You&nbsp;should&nbsp;terminate&nbsp;after&nbsp;peeking:&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp;acl&nbsp;...&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp;ssl_bump&nbsp;peek&nbsp;all&lt;br&gt;<br>
 &nbsp;ssl_bump&nbsp;terminate&nbsp;deny_https_sites&lt;br&gt;<br>
 &nbsp;ssl_bump&nbsp;splice&nbsp;all&lt;br&gt;<br>
&lt;br&gt;<br>
Peeking&nbsp;feeds&nbsp;your&nbsp;deny_https_sites&nbsp;ACL&nbsp;with&nbsp;information.&nbsp;Without&lt;br&gt;<br>
peeking,&nbsp;that&nbsp;ACL&nbsp;may&nbsp;only&nbsp;have&nbsp;IP&nbsp;addresses&nbsp;to&nbsp;work&nbsp;with&nbsp;(especially&nbsp;in&lt;br&gt;<br>
an&nbsp;interception&nbsp;environment).&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;But,&nbsp;now,&nbsp;I&nbsp;need&nbsp;to&nbsp;do&nbsp;an&nbsp;rule&nbsp;to&nbsp;permit&nbsp;access&nbsp;for&nbsp;specific&nbsp;users,&nbsp;or&lt;br&gt;<br>
&gt;&nbsp;ip&nbsp;address.&nbsp;But,&nbsp;I&nbsp;don&#39;t&nbsp;know&nbsp;if&nbsp;it&#39;s&nbsp;possible&nbsp;with&nbsp;ssl_bump.&nbsp;I&nbsp;tried&lt;br&gt;<br>
&gt;&nbsp;somethink&nbsp;like:&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;ssl_bump&nbsp;terminate&nbsp;deny_https_sites&nbsp;!permited_ips&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;or&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;ssl_bump&nbsp;peek&nbsp;deny_https_sites&nbsp;permited_ips&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;There&nbsp;is&nbsp;one&nbsp;way&nbsp;to&nbsp;do&nbsp;this?&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;The&nbsp;first&nbsp;variant&nbsp;is&nbsp;theoretically&nbsp;correct,&nbsp;but&nbsp;I&nbsp;recommend&nbsp;avoiding&lt;br&gt;<br>
negation&nbsp;in&nbsp;ACLs:&nbsp;An&nbsp;ACL&nbsp;result&nbsp;is&nbsp;not&nbsp;a&nbsp;boolean&nbsp;&quot;match&quot;&nbsp;or&nbsp;&quot;mismatch&quot;.&lt;br&gt;<br>
It&nbsp;is&nbsp;actually&nbsp;closer&nbsp;to&nbsp;&quot;match&quot;,&nbsp;&quot;mismatch&quot;,&nbsp;&quot;do&nbsp;not&nbsp;know&quot;,&nbsp;or&nbsp;&quot;error&quot;.&lt;br&gt;<br>
Negating&nbsp;four&nbsp;values&nbsp;correctly&nbsp;is&nbsp;difficult,&nbsp;and&nbsp;Squid&nbsp;itself&nbsp;has&nbsp;had&lt;br&gt;<br>
many&nbsp;bugs&nbsp;in&nbsp;that&nbsp;area.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
If&nbsp;you&nbsp;can&nbsp;truly&nbsp;identify&nbsp;&quot;specific&nbsp;users&quot;&nbsp;by&nbsp;IP,&nbsp;then&nbsp;do&nbsp;that&nbsp;first&nbsp;(no&lt;br&gt;<br>
need&nbsp;to&nbsp;peek):&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp;ssl_bump&nbsp;splice&nbsp;permited_ips&lt;br&gt;<br>
 &nbsp;ssl_bump&nbsp;peek&nbsp;all&lt;br&gt;<br>
 &nbsp;ssl_bump&nbsp;terminate&nbsp;deny_https_sites&lt;br&gt;<br>
 &nbsp;ssl_bump&nbsp;splice&nbsp;all&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
If&nbsp;your&nbsp;actual&nbsp;&quot;specific&nbsp;user&quot;&nbsp;ACL&nbsp;needs&nbsp;host&nbsp;name&nbsp;information,&nbsp;then&nbsp;let&lt;br&gt;<br>
Squid&nbsp;peek&nbsp;first:&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp;ssl_bump&nbsp;peek&nbsp;all&lt;br&gt;<br>
 &nbsp;ssl_bump&nbsp;splice&nbsp;specific_users&lt;br&gt;<br>
 &nbsp;ssl_bump&nbsp;terminate&nbsp;deny_https_sites&lt;br&gt;<br>
 &nbsp;ssl_bump&nbsp;splice&nbsp;all&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Your&nbsp;questions&nbsp;indicate&nbsp;that&nbsp;you&nbsp;may&nbsp;not&nbsp;understand&nbsp;how&nbsp;Squid&nbsp;evaluates&lt;br&gt;<br>
ACL&nbsp;rules.&nbsp;Proceed&nbsp;with&nbsp;caution&nbsp;and&nbsp;try&nbsp;reading&nbsp;a&nbsp;guide&nbsp;book&nbsp;or&nbsp;a&nbsp;good&lt;br&gt;<br>
tutorial.&nbsp;The&nbsp;basic&nbsp;single-rule&nbsp;evaluation&nbsp;algorithm&nbsp;is&nbsp;not&nbsp;specific&nbsp;to&lt;br&gt;<br>
SslBump&nbsp;(although&nbsp;multiple&nbsp;ssl_bump&nbsp;directives&nbsp;add&nbsp;more&nbsp;complexity).&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Good&nbsp;luck,&lt;br&gt;<br>
&lt;br&gt;<br>
Alex.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;br&gt;--&nbsp;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_signature&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Rodrigo&nbsp;Lima &nbsp;-&nbsp;rodrigodlima[at]gmail[dot]com&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/div&gt;<br>

</tt>
