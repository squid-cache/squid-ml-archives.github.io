<tt>
&lt;font&nbsp;size=2&nbsp;face=&quot;sans-serif&quot;&gt;Thank&nbsp;you&nbsp;Amos,&nbsp;I&nbsp;was&nbsp;pretty&nbsp;brain&nbsp;drained<br>
by&nbsp;the&nbsp;time&nbsp;I&nbsp;posted&nbsp;so&nbsp;please&nbsp;excuse&nbsp;my&nbsp;pasting&nbsp;slip&nbsp;up.&lt;/font&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;font&nbsp;size=2&nbsp;face=&quot;sans-serif&quot;&gt;I&nbsp;tried&nbsp;adding&nbsp;&nbsp;no-netdb-exchange<br>
and&nbsp;no-digest&nbsp;to&nbsp;the&nbsp;cache_peer&nbsp;lines,&nbsp;the&nbsp;first&nbsp;one&nbsp;eliminated&nbsp;the&nbsp;forward<br>
loop&nbsp;warnings&nbsp;but&nbsp;I&nbsp;am&nbsp;still&nbsp;experiencing&nbsp;the&nbsp;first&nbsp;request&nbsp;coming&nbsp;from<br>
the&nbsp;cache&nbsp;and&nbsp;then&nbsp;subsequent&nbsp;requests&nbsp;going&nbsp;direct.&nbsp;Also&nbsp;I&nbsp;did&nbsp;disable<br>
the&nbsp;tproxy&nbsp;port.&lt;/font&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;font&nbsp;size=2&nbsp;face=&quot;sans-serif&quot;&gt;I&nbsp;now&nbsp;suspect&nbsp;some&nbsp;sort&nbsp;of&nbsp;logic&nbsp;bug<br>
in&nbsp;the&nbsp;code&nbsp;as&nbsp;is&nbsp;shows&nbsp;in&nbsp;the&nbsp;cache&nbsp;logs&nbsp;carp.cc&nbsp;is&nbsp;not&nbsp;called&nbsp;a&nbsp;second<br>
time&nbsp;before&nbsp;peer_select.cc&nbsp;on&nbsp;the&nbsp;second&nbsp;attempt.&nbsp;Unfortunately&nbsp;my&nbsp;programming<br>
skills&nbsp;are&nbsp;poor&nbsp;and&nbsp;have&nbsp;limited&nbsp;time&nbsp;to&nbsp;look&nbsp;at&nbsp;this&nbsp;issue.&lt;/font&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;font&nbsp;size=2&nbsp;face=&quot;sans-serif&quot;&gt;For&nbsp;now&nbsp;to&nbsp;work-around&nbsp;this&nbsp;behaviour<br>
I&nbsp;will&nbsp;use&nbsp;the&nbsp;never_direct&nbsp;directive,&nbsp;but&nbsp;if&nbsp;you&nbsp;would&nbsp;like&nbsp;to&nbsp;investigate<br>
further&nbsp;I&nbsp;have&nbsp;provided&nbsp;level&nbsp;2&nbsp;and&nbsp;3&nbsp;debug&nbsp;cache&nbsp;logs&nbsp;that&nbsp;you&nbsp;could&nbsp;look<br>
at.&lt;/font&gt;<br>
&lt;br&gt;&lt;a&nbsp;href=&quot;https://droplet-wlg.solnetsolutions.co.nz/public.php?service=files&amp;t=8a3b73eff46a9cf1a91829c0b9d0016a&quot;&gt;&lt;font&nbsp;size=2&nbsp;color=blue&nbsp;face=&quot;sans-serif&quot;&gt;https://droplet-wlg.solnetsolutions.co.nz/public.php?service=files&amp;t=8a3b73eff46a9cf1a91829c0b9d0016a&lt;/font&gt;&lt;/a&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;font&nbsp;size=2&nbsp;face=&quot;sans-serif&quot;&gt;Cheers&lt;/font&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;font&nbsp;size=2&nbsp;color=#0000a1&nbsp;face=&quot;Verdana&quot;&gt;&lt;b&gt;Mike&nbsp;Hodgkinson&lt;/b&gt;&lt;/font&gt;<br>
&lt;br&gt;&lt;font&nbsp;size=2&nbsp;color=#4f4f4f&nbsp;face=&quot;Verdana&quot;&gt;&lt;b&gt;Internal&nbsp;Support&nbsp;Engineer&lt;/b&gt;&lt;/font&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;font&nbsp;size=2&nbsp;color=#4f4f4f&nbsp;face=&quot;Verdana&quot;&gt;Mobile&nbsp;&nbsp;+64&nbsp;21&nbsp;754&nbsp;339&lt;/font&gt;<br>
&lt;br&gt;&lt;font&nbsp;size=2&nbsp;color=#4f4f4f&nbsp;face=&quot;Verdana&quot;&gt;Phone&nbsp;&nbsp;+64&nbsp;4&nbsp;462&nbsp;5064&lt;/font&gt;<br>
&lt;br&gt;&lt;font&nbsp;size=2&nbsp;color=#4f4f4f&nbsp;face=&quot;Verdana&quot;&gt;Email&nbsp;&nbsp;&nbsp;mike.hodgkinson@solnet.co.nz&lt;/font&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;font&nbsp;size=2&nbsp;color=#4f4f4f&nbsp;face=&quot;Verdana&quot;&gt;&lt;b&gt;Solnet&nbsp;Solutions&nbsp;Limited&lt;/b&gt;&lt;br&gt;<br>
Level&nbsp;12,&nbsp;Solnet&nbsp;House&lt;/font&gt;<br>
&lt;br&gt;&lt;font&nbsp;size=2&nbsp;color=#4f4f4f&nbsp;face=&quot;Verdana&quot;&gt;70&nbsp;The&nbsp;Terrace,&nbsp;Wellington<br>
6011&lt;br&gt;<br>
PO&nbsp;Box&nbsp;397,&nbsp;Wellington&nbsp;6140&lt;/font&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;a&nbsp;href=http://www.solnet.co.nz/&nbsp;target=blank&gt;&lt;font&nbsp;size=2&nbsp;color=#0000a1&nbsp;face=&quot;Verdana&quot;&gt;&lt;b&gt;www.solnet.co.nz&lt;/b&gt;&lt;/font&gt;&lt;/a&gt;&lt;font&nbsp;size=2&nbsp;color=#a2a2a2&nbsp;face=&quot;Verdana&quot;&gt;&nbsp;&nbsp;&lt;/font&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;font&nbsp;size=1&nbsp;color=#5f5f5f&nbsp;face=&quot;sans-serif&quot;&gt;From:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&lt;/font&gt;&lt;font&nbsp;size=1&nbsp;face=&quot;sans-serif&quot;&gt;Amos&nbsp;Jeffries&nbsp;&lt;squid3@treenet.co.nz&gt;&lt;/font&gt;<br>
&lt;br&gt;&lt;font&nbsp;size=1&nbsp;color=#5f5f5f&nbsp;face=&quot;sans-serif&quot;&gt;To:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&lt;/font&gt;<br>
&lt;br&gt;&lt;font&nbsp;size=1&nbsp;color=#5f5f5f&nbsp;face=&quot;sans-serif&quot;&gt;Date:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&lt;/font&gt;&lt;font&nbsp;size=1&nbsp;face=&quot;sans-serif&quot;&gt;30/10/2015&nbsp;11:03&nbsp;p.m.&lt;/font&gt;<br>
&lt;br&gt;&lt;font&nbsp;size=1&nbsp;color=#5f5f5f&nbsp;face=&quot;sans-serif&quot;&gt;Subject:&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&lt;/font&gt;&lt;font&nbsp;size=1&nbsp;face=&quot;sans-serif&quot;&gt;Re:&nbsp;[squid-users]<br>
Squid&nbsp;with&nbsp;SMP,&nbsp;CARP&nbsp;and&nbsp;a&nbsp;forwarding&nbsp;loop&lt;/font&gt;<br>
&lt;br&gt;&lt;font&nbsp;size=1&nbsp;color=#5f5f5f&nbsp;face=&quot;sans-serif&quot;&gt;Sent&nbsp;by:&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&lt;/font&gt;&lt;font&nbsp;size=1&nbsp;face=&quot;sans-serif&quot;&gt;&quot;squid-users&quot;<br>
&lt;squid-users-bounces@lists.squid-cache.org&gt;&lt;/font&gt;<br>
&lt;br&gt;<br>
&lt;hr&nbsp;noshade&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;On&nbsp;30/10/2015&nbsp;1:45&nbsp;p.m.,&nbsp;Mike.Hodgkinson&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;have&nbsp;been&nbsp;attempting&nbsp;to&nbsp;setup&nbsp;a&nbsp;squid&nbsp;forward&nbsp;proxy&nbsp;with&nbsp;one&nbsp;frontend<br>
&lt;br&gt;<br>
&gt;&nbsp;and&nbsp;two&nbsp;backends&nbsp;as&nbsp;per&nbsp;configuration&nbsp;example&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;/font&gt;&lt;/tt&gt;&lt;a&nbsp;href=&quot;http://wiki.squid-cache.org/ConfigExamples/SmpCarpCluster&quot;&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;http://wiki.squid-cache.org/ConfigExamples/SmpCarpCluster&lt;/font&gt;&lt;/tt&gt;&lt;/a&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;My&nbsp;issue&nbsp;is&nbsp;that&nbsp;only&nbsp;the&nbsp;first&nbsp;attempt&nbsp;comes&nbsp;from&nbsp;the&nbsp;cache&nbsp;and&nbsp;then<br>
&lt;br&gt;<br>
&gt;&nbsp;additional&nbsp;requests&nbsp;are&nbsp;downloaded&nbsp;direct&nbsp;by&nbsp;the&nbsp;frontend&nbsp;instead<br>
of&nbsp;from&nbsp;&lt;br&gt;<br>
&gt;&nbsp;the&nbsp;backend&nbsp;caches.&nbsp;I&nbsp;suspect&nbsp;it&nbsp;is&nbsp;due&nbsp;to&nbsp;a&nbsp;detected&nbsp;forwarding&nbsp;loop<br>
&lt;br&gt;<br>
&gt;&nbsp;which&nbsp;shows&nbsp;up&nbsp;in&nbsp;the&nbsp;logs:&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;2015/10/30&nbsp;13:07:49.239&nbsp;kid1|&nbsp;44,3|&nbsp;peer_select.cc(137)&nbsp;peerSelect:<br>
&lt;br&gt;<br>
&gt;&nbsp;e:=XIWV/0x7f7bfee2e730*2&nbsp;&lt;/font&gt;&lt;/tt&gt;&lt;a&nbsp;href=http://127.0.0.1:40/&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;http://127.0.0.1:40&lt;/font&gt;&lt;/tt&gt;&lt;/a&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&lt;br&gt;<br>
&gt;&nbsp;02/squid-internal-dynamic/netdb&lt;br&gt;<br>
&gt;&nbsp;2015/10/30&nbsp;13:07:49.239&nbsp;kid1|&nbsp;20,3|&nbsp;store.cc(466)&nbsp;lock:&nbsp;peerSelect<br>
locked&nbsp;&lt;br&gt;<br>
&gt;&nbsp;key&nbsp;64AAA11C8DEF57153B10BA2C9D2F3D60&nbsp;e:=XIWV/0x7f7bfee2e730*3&lt;br&gt;<br>
&gt;&nbsp;2015/10/30&nbsp;13:07:49.240&nbsp;kid1|&nbsp;44,3|&nbsp;peer_select.cc(441)&nbsp;peerSelectFoo:<br>
GET&nbsp;&lt;br&gt;<br>
&gt;&nbsp;127.0.0.1&lt;br&gt;<br>
&gt;&nbsp;2015/10/30&nbsp;13:07:49.240&nbsp;kid1|&nbsp;44,3|&nbsp;peer_select.cc(468)&nbsp;peerSelectFoo:<br>
&lt;br&gt;<br>
&gt;&nbsp;peerSelectFoo:&nbsp;direct&nbsp;=&nbsp;DIRECT_YES&nbsp;(forwarding&nbsp;loop&nbsp;detected)&lt;br&gt;<br>
&gt;&nbsp;2015/10/30&nbsp;13:07:49.240&nbsp;kid1|&nbsp;44,3|&nbsp;peer_select.cc(477)&nbsp;peerSelectFoo:<br>
&lt;br&gt;<br>
&gt;&nbsp;peerSelectFoo:&nbsp;direct&nbsp;=&nbsp;DIRECT_YES&lt;br&gt;<br>
&gt;&nbsp;2015/10/30&nbsp;13:07:49.240&nbsp;kid1|&nbsp;44,2|&nbsp;peer_select.cc(258)&nbsp;&lt;br&gt;<br>
&gt;&nbsp;peerSelectDnsPaths:&nbsp;Find&nbsp;IP&nbsp;destination&nbsp;for:&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;/font&gt;&lt;/tt&gt;&lt;a&nbsp;href=&quot;http://127.0.0.1:4002/squid-internal-dynamic/netdb'&quot;&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;http://127.0.0.1:4002/squid-internal-dynamic/netdb'&lt;/font&gt;&lt;/tt&gt;&lt;/a&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;<br>
via&nbsp;127.0.0.1&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;can&nbsp;force&nbsp;the&nbsp;backend&nbsp;caches&nbsp;to&nbsp;be&nbsp;used&nbsp;successfully&nbsp;with&nbsp;this&nbsp;option<br>
&lt;br&gt;<br>
&gt;&nbsp;&quot;never_direct&nbsp;allow&nbsp;all&quot;&nbsp;however&nbsp;I&nbsp;would&nbsp;like&nbsp;to&nbsp;resolve<br>
the&nbsp;underlying&nbsp;&lt;br&gt;<br>
&gt;&nbsp;issue.&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;above&nbsp;is&nbsp;an&nbsp;internal&nbsp;Squid&nbsp;request&nbsp;from&nbsp;the&nbsp;fontend&nbsp;to&nbsp;its&nbsp;backends.&lt;br&gt;<br>
This&nbsp;one&nbsp;specifically&nbsp;is&nbsp;going&nbsp;direct&nbsp;due&nbsp;to&nbsp;a&nbsp;hack&nbsp;in&nbsp;the&nbsp;code.&lt;br&gt;<br>
&lt;br&gt;<br>
You&nbsp;can&nbsp;avoid&nbsp;it&nbsp;by&nbsp;adding&nbsp;&quot;no-netdb-exchange&quot;&nbsp;to&nbsp;the&nbsp;cache_peer<br>
lines.&lt;br&gt;<br>
I'm&nbsp;not&nbsp;sure&nbsp;if&nbsp;that&nbsp;will&nbsp;affect&nbsp;the&nbsp;CARP&nbsp;selection&nbsp;since&nbsp;these&nbsp;requests&lt;br&gt;<br>
are&nbsp;one&nbsp;of&nbsp;the&nbsp;types&nbsp;feeding&nbsp;into&nbsp;the&nbsp;peer&nbsp;up/down/overloaded&lt;br&gt;<br>
monitoring.&nbsp;With&nbsp;&quot;no-query&quot;&nbsp;also&nbsp;in&nbsp;use&nbsp;you&nbsp;will&nbsp;be&nbsp;left&nbsp;with<br>
the&nbsp;client&lt;br&gt;<br>
HTTP&nbsp;traffic&nbsp;being&nbsp;the&nbsp;only&nbsp;source&nbsp;of&nbsp;that&nbsp;data&nbsp;which&nbsp;carp&nbsp;depends&nbsp;on.&lt;br&gt;<br>
&lt;br&gt;<br>
Or&nbsp;using&nbsp;that&nbsp;&quot;never_direct&nbsp;allow&nbsp;all&quot;&nbsp;will&nbsp;override&nbsp;that&nbsp;code<br>
hack.&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;have&nbsp;no&nbsp;iptables&nbsp;configured&nbsp;on&nbsp;this&nbsp;server&nbsp;and&nbsp;have&nbsp;made&nbsp;sure&nbsp;the<br>
&lt;br&gt;<br>
&gt;&nbsp;environment&nbsp;variable&nbsp;http_proxy&nbsp;is&nbsp;not&nbsp;set.&nbsp;Also&nbsp;I&nbsp;have&nbsp;tested&nbsp;this<br>
on&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Squid&nbsp;3.4.8&nbsp;and&nbsp;3.5.10&nbsp;on&nbsp;Debian.&lt;br&gt;<br>
&lt;br&gt;<br>
Since&nbsp;you&nbsp;have&nbsp;no&nbsp;iptables&nbsp;rules&nbsp;configured&nbsp;the&nbsp;traffic&nbsp;arriving&nbsp;in&nbsp;port&lt;br&gt;<br>
3129&nbsp;will&nbsp;be&nbsp;completely&nbsp;borked.&lt;br&gt;<br>
&lt;br&gt;<br>
Either,&nbsp;remove&nbsp;that&nbsp;port&nbsp;3129&nbsp;line&nbsp;from&nbsp;the&nbsp;frontend&nbsp;config&nbsp;and&nbsp;use&nbsp;port&lt;br&gt;<br>
3128&nbsp;for&nbsp;testing&nbsp;until&nbsp;you&nbsp;are&nbsp;ready&nbsp;to&nbsp;setup&nbsp;TPROXY&nbsp;properly;&lt;br&gt;<br>
&lt;br&gt;<br>
Or,&nbsp;setup&nbsp;the&nbsp;TPROXY&nbsp;iptables&nbsp;and&nbsp;routing&nbsp;rules&nbsp;and&nbsp;test&nbsp;the&nbsp;proxy&lt;br&gt;<br>
exactly&nbsp;as&nbsp;the&nbsp;clients&nbsp;would&nbsp;be&nbsp;using&nbsp;it.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;My&nbsp;config&nbsp;is&nbsp;below:&lt;br&gt;<br>
&gt;&nbsp;#/etc/squid/squid.conf#&lt;br&gt;<br>
&gt;&nbsp;debug_options&nbsp;=&nbsp;ALL,3&lt;br&gt;<br>
&gt;&nbsp;cachemgr_passwd&nbsp;******&lt;br&gt;<br>
&lt;br&gt;<br>
NOTE:&nbsp;if&nbsp;that&nbsp;was&nbsp;your&nbsp;actual&nbsp;password&nbsp;you&nbsp;now&nbsp;need&nbsp;to&nbsp;change&nbsp;it.&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;localnet&nbsp;src&nbsp;10.1.0.0/16&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;localnet&nbsp;src&nbsp;10.2.0.0/16&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;localnet&nbsp;src&nbsp;192.168.0.0/23&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;localnet&nbsp;src&nbsp;fe80::/10&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;squid_servers&nbsp;src&nbsp;10.1.209.0/24&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp;See&nbsp;below...&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;snip&gt;&lt;br&gt;<br>
&gt;&nbsp;#/etc/squid/squid-frontend.conf#&lt;br&gt;<br>
&gt;&nbsp;http_port&nbsp;3128&lt;br&gt;<br>
&gt;&nbsp;http_port&nbsp;3129&nbsp;tproxy&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;allow&nbsp;localhost&nbsp;manager&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;deny&nbsp;manager&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;allow&nbsp;localhost&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;allow&nbsp;localnet&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;allow&nbsp;squid_servers&lt;br&gt;<br>
&lt;br&gt;<br>
With&nbsp;squid_servers&nbsp;IP&nbsp;range&nbsp;being&nbsp;entirely&nbsp;within&nbsp;&quot;localnet&quot;<br>
this&lt;br&gt;<br>
&quot;http_access&nbsp;allow&nbsp;squid_servers&quot;&nbsp;line&nbsp;is&nbsp;not&nbsp;doing&nbsp;anything.&lt;br&gt;<br>
You&nbsp;can&nbsp;simplify&nbsp;by&nbsp;removing&nbsp;it.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;htcp_access&nbsp;allow&nbsp;squid_servers&lt;br&gt;<br>
&gt;&nbsp;htcp_access&nbsp;deny&nbsp;all&lt;br&gt;<br>
&gt;&nbsp;cache_peer&nbsp;127.0.0.1&nbsp;parent&nbsp;4002&nbsp;0&nbsp;carp&nbsp;login=PASS&nbsp;name=backend-kid2<br>
&lt;br&gt;<br>
&gt;&nbsp;no-query&lt;br&gt;<br>
&gt;&nbsp;cache_peer&nbsp;127.0.0.1&nbsp;parent&nbsp;4003&nbsp;0&nbsp;carp&nbsp;login=PASS&nbsp;name=backend-kid3<br>
&lt;br&gt;<br>
&gt;&nbsp;no-query&lt;br&gt;<br>
&gt;&nbsp;prefer_direct&nbsp;off&lt;br&gt;<br>
&gt;&nbsp;nonhierarchical_direct&nbsp;off&lt;br&gt;<br>
&gt;&nbsp;memory_replacement_policy&nbsp;heap&nbsp;LRU&lt;br&gt;<br>
&gt;&nbsp;cache_mem&nbsp;2048&nbsp;MB&lt;br&gt;<br>
&gt;&nbsp;access_log&nbsp;/var/log/squid3/frontend.access.log&lt;br&gt;<br>
&gt;&nbsp;cache_log&nbsp;/var/log/squid3/frontend.cache.log&lt;br&gt;<br>
&gt;&nbsp;visible_hostname&nbsp;frontend.cloud.solnet.nz&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;#/etc/squid/squid-backend.conf#&lt;br&gt;<br>
&gt;&nbsp;http_port&nbsp;127.0.01:400${process_number}&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;allow&nbsp;localhost&lt;br&gt;<br>
&gt;&nbsp;cache_mem&nbsp;5&nbsp;MB&lt;br&gt;<br>
&gt;&nbsp;cache_replacement_policy&nbsp;heap&nbsp;LFUDA&lt;br&gt;<br>
&gt;&nbsp;maximum_object_size&nbsp;1&nbsp;GB&lt;br&gt;<br>
&gt;&nbsp;cache_dir&nbsp;rock&nbsp;/cache/rock&nbsp;20480&nbsp;max-size=32768&lt;br&gt;<br>
&gt;&nbsp;cache_dir&nbsp;aufs&nbsp;/cache/${process_number}&nbsp;20480&nbsp;128&nbsp;128&nbsp;min-size=32769&lt;br&gt;<br>
&gt;&nbsp;visible_hostname&nbsp;backend${process_number}.cloud.solnet.nz&lt;br&gt;<br>
&gt;&nbsp;access_log&nbsp;/var/log/squid3/backend${process_number}.access.log&lt;br&gt;<br>
&gt;&nbsp;cache_log&nbsp;/var/log/squid3/backend${process_number}.cache.log&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;did&nbsp;have&nbsp;visible_hostname&nbsp;set&nbsp;to&nbsp;backend.cloud.solnet.nz&nbsp;but&nbsp;that<br>
did&nbsp;&lt;br&gt;<br>
&gt;&nbsp;not&nbsp;help&nbsp;either.&lt;br&gt;<br>
&lt;br&gt;<br>
Nod.&nbsp;All&nbsp;that&nbsp;did&nbsp;previously&nbsp;was&nbsp;prevent&nbsp;forwarding&nbsp;loops&nbsp;between&nbsp;the&lt;br&gt;<br>
backends&nbsp;in&nbsp;case&nbsp;something&nbsp;unusually&nbsp;nasty&nbsp;happened&nbsp;in&nbsp;the&lt;br&gt;<br>
routing/iptabels&nbsp;layers.&nbsp;What&nbsp;you&nbsp;have&nbsp;now&nbsp;is&nbsp;okay&nbsp;and&nbsp;slightly&nbsp;better&lt;br&gt;<br>
for&nbsp;diagnosing&nbsp;the&nbsp;issues.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Amos&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
squid-users@lists.squid-cache.org&lt;br&gt;<br>
&lt;/font&gt;&lt;/tt&gt;&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/font&gt;&lt;/tt&gt;&lt;/a&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&lt;br&gt;<br>
&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;Attention:<br>
This&nbsp;email&nbsp;may&nbsp;contain&nbsp;information&nbsp;intended&nbsp;for&nbsp;the&nbsp;sole&nbsp;use&nbsp;of<br>
the&nbsp;original&nbsp;recipient.&nbsp;Please&nbsp;respect&nbsp;this&nbsp;when&nbsp;sharing&nbsp;or<br>
disclosing&nbsp;this&nbsp;email's&nbsp;contents&nbsp;with&nbsp;any&nbsp;third&nbsp;party.&nbsp;If&nbsp;you<br>
believe&nbsp;you&nbsp;have&nbsp;received&nbsp;this&nbsp;email&nbsp;in&nbsp;error,&nbsp;please&nbsp;delete&nbsp;it<br>
and&nbsp;notify&nbsp;the&nbsp;sender&nbsp;or&nbsp;postmaster@solnetsolutions.co.nz&nbsp;as<br>
soon&nbsp;as&nbsp;possible.&nbsp;The&nbsp;content&nbsp;of&nbsp;this&nbsp;email&nbsp;does&nbsp;not&nbsp;necessarily<br>
reflect&nbsp;the&nbsp;views&nbsp;of&nbsp;Solnet&nbsp;Solutions&nbsp;Ltd.<br>

</tt>
