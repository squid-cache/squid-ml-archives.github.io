<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;Hi,&lt;br&gt;&lt;br&gt;&lt;/div&gt;I&#39;m&nbsp;trying&nbsp;to&nbsp;improve&nbsp;our&nbsp;cache&nbsp;hit&nbsp;ratio. &nbsp;We&nbsp;have&nbsp;a&nbsp;fairly&nbsp;complicated&nbsp;layer&nbsp;of&nbsp;squid&nbsp;3.10&nbsp;proxies&nbsp;as&nbsp;previously&nbsp;detailed.&lt;br&gt;&lt;br&gt;Problem&nbsp;1. &nbsp;Some&nbsp;of&nbsp;the&nbsp;traffic&nbsp;is&nbsp;identified&nbsp;by&nbsp;domain&nbsp;to&nbsp;go&nbsp;to&nbsp;another&nbsp;layer&nbsp;of&nbsp;proxies. &nbsp;I&#39;ve&nbsp;called&nbsp;this&nbsp;proxy&nbsp;otherl1proxy&nbsp;in&nbsp;the&nbsp;squid.conf&nbsp;below. &nbsp;I&#39;ve&nbsp;noticed&nbsp;that&nbsp;this&nbsp;traffic&nbsp;is&nbsp;not&nbsp;cached&nbsp;at&nbsp;all&nbsp;on&nbsp;either&nbsp;set&nbsp;of&nbsp;proxies.  &nbsp;I&#39;d&nbsp;like&nbsp;it&nbsp;cached&nbsp;at&nbsp;the&nbsp;top&nbsp;layer&nbsp;if&nbsp;possible&nbsp;because&nbsp;these&nbsp;will&nbsp;be&nbsp;the&nbsp;largest&nbsp;servers&nbsp;with&nbsp;the&nbsp;largest&nbsp;caches. &nbsp;I&#39;ve&nbsp;removed&nbsp;&#39;originserver&#39;&nbsp;from&nbsp;the&nbsp;squid.conf&nbsp;to&nbsp;test&nbsp;but&nbsp;that&nbsp;didn&#39;t&nbsp;seem&nbsp;to&nbsp;help.&lt;br&gt;&lt;br&gt;&lt;/div&gt;Problem&nbsp;2. &nbsp;We&nbsp;are&nbsp;not&nbsp;caching&nbsp;any&nbsp;https&nbsp;traffic. &nbsp;Is&nbsp;it&nbsp;possible&nbsp;to&nbsp;cache&nbsp;https&nbsp;traffic,&nbsp;and&nbsp;if&nbsp;so&nbsp;how&nbsp;would&nbsp;one&nbsp;do&nbsp;it? &nbsp;As&nbsp;many&nbsp;websites&nbsp;are&nbsp;moving&nbsp;towards&nbsp;https&nbsp;for&nbsp;all&nbsp;traffic&nbsp;this&nbsp;lowers&nbsp;the&nbsp;effectiveness&nbsp;of&nbsp;cache...&lt;br&gt;&lt;br&gt;&lt;/div&gt;squid.conf&nbsp;below&lt;br&gt;&lt;br&gt;&lt;/div&gt;Thanks,&lt;br&gt;&lt;/div&gt;John&lt;br&gt;&lt;br&gt;#&nbsp;Recommended&nbsp;minimum&nbsp;configuration:&lt;br&gt;#&lt;br&gt;acl&nbsp;manager&nbsp;proto&nbsp;cache_object&lt;br&gt;acl&nbsp;localhost&nbsp;src&nbsp;&lt;a&nbsp;href=&quot;http://127.0.0.1/32&quot;&gt;127.0.0.1/32&lt;/a&gt;&nbsp;::1&lt;br&gt;acl&nbsp;to_localhost&nbsp;dst&nbsp;&lt;a&nbsp;href=&quot;http://127.0.0.0/8&quot;&gt;127.0.0.0/8&lt;/a&gt;&nbsp;&lt;a&nbsp;href=&quot;http://0.0.0.0/32&quot;&gt;0.0.0.0/32&lt;/a&gt;&nbsp;::1&lt;br&gt;&lt;br&gt;#&nbsp;Example&nbsp;rule&nbsp;allowing&nbsp;access&nbsp;from&nbsp;your&nbsp;local&nbsp;networks.&lt;br&gt;#&nbsp;Adapt&nbsp;to&nbsp;list&nbsp;your&nbsp;(internal)&nbsp;IP&nbsp;networks&nbsp;from&nbsp;where&nbsp;browsing&lt;br&gt;#&nbsp;should&nbsp;be&nbsp;allowed&lt;br&gt;acl&nbsp;localnet&nbsp;src&nbsp;&lt;a&nbsp;href=&quot;http://10.0.0.0/8&quot;&gt;10.0.0.0/8&lt;/a&gt;    &nbsp;#&nbsp;RFC1918&nbsp;possible&nbsp;internal&nbsp;network&lt;br&gt;acl&nbsp;localnet&nbsp;src&nbsp;&lt;a&nbsp;href=&quot;http://172.16.0.0/12&quot;&gt;172.16.0.0/12&lt;/a&gt; &nbsp;#&nbsp;RFC1918&nbsp;possible&nbsp;internal&nbsp;network&lt;br&gt;acl&nbsp;localnet&nbsp;src&nbsp;&lt;a&nbsp;href=&quot;http://192.168.0.0/16&quot;&gt;192.168.0.0/16&lt;/a&gt;&nbsp;#&nbsp;RFC1918&nbsp;possible&nbsp;internal&nbsp;network&lt;br&gt;acl&nbsp;localnet&nbsp;src&nbsp;fc00::/7      &nbsp;#&nbsp;RFC&nbsp;4193&nbsp;local&nbsp;private&nbsp;network&nbsp;range&lt;br&gt;acl&nbsp;localnet&nbsp;src&nbsp;fe80::/10     &nbsp;#&nbsp;RFC&nbsp;4291&nbsp;link-local&nbsp;(directly&nbsp;plugged)&nbsp;machines&lt;br&gt;&lt;br&gt;acl&nbsp;httpacl&nbsp;port&nbsp;80&lt;br&gt;acl&nbsp;SSL_ports&nbsp;port&nbsp;443&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;80         &nbsp;#&nbsp;http&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;21         &nbsp;#&nbsp;ftp&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;443        &nbsp;#&nbsp;https&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;70         &nbsp;#&nbsp;gopher&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;210        &nbsp;#&nbsp;wais&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;1025-65535 &nbsp;#&nbsp;unregistered&nbsp;ports&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;280        &nbsp;#&nbsp;http-mgmt&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;488        &nbsp;#&nbsp;gss-http&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;591        &nbsp;#&nbsp;filemaker&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;777        &nbsp;#&nbsp;multiling&nbsp;http&lt;br&gt;acl&nbsp;CONNECT&nbsp;method&nbsp;CONNECT&lt;br&gt;&lt;br&gt;#&lt;br&gt;#&nbsp;Recommended&nbsp;minimum&nbsp;Access&nbsp;Permission&nbsp;configuration:&lt;br&gt;#&lt;br&gt;#&nbsp;Only&nbsp;allow&nbsp;cachemgr&nbsp;access&nbsp;from&nbsp;localhost&lt;br&gt;http_access&nbsp;allow&nbsp;manager&nbsp;localhost&lt;br&gt;http_access&nbsp;deny&nbsp;manager&lt;br&gt;&lt;br&gt;#&nbsp;Deny&nbsp;requests&nbsp;to&nbsp;certain&nbsp;unsafe&nbsp;ports&lt;br&gt;http_access&nbsp;deny&nbsp;!Safe_ports&lt;br&gt;&lt;br&gt;#&nbsp;Deny&nbsp;CONNECT&nbsp;to&nbsp;other&nbsp;than&nbsp;secure&nbsp;SSL&nbsp;ports&lt;br&gt;http_access&nbsp;deny&nbsp;CONNECT&nbsp;!SSL_ports&lt;br&gt;&lt;br&gt;#&nbsp;We&nbsp;strongly&nbsp;recommend&nbsp;the&nbsp;following&nbsp;be&nbsp;uncommented&nbsp;to&nbsp;protect&nbsp;innocent&lt;br&gt;#&nbsp;web&nbsp;applications&nbsp;running&nbsp;on&nbsp;the&nbsp;proxy&nbsp;server&nbsp;who&nbsp;think&nbsp;the&nbsp;only&lt;br&gt;#&nbsp;one&nbsp;who&nbsp;can&nbsp;access&nbsp;services&nbsp;on&nbsp;&quot;localhost&quot;&nbsp;is&nbsp;a&nbsp;local&nbsp;user&lt;br&gt;#http_access&nbsp;deny&nbsp;to_localhost&lt;br&gt;&lt;br&gt;#&lt;br&gt;#&nbsp;INSERT&nbsp;YOUR&nbsp;OWN&nbsp;RULE(S)&nbsp;HERE&nbsp;TO&nbsp;ALLOW&nbsp;ACCESS&nbsp;FROM&nbsp;YOUR&nbsp;CLIENTS&lt;br&gt;#&lt;br&gt;&lt;br&gt;negative_ttl&nbsp;3600&nbsp;seconds&lt;br&gt;&lt;br&gt;#&nbsp;Example&nbsp;rule&nbsp;allowing&nbsp;access&nbsp;from&nbsp;your&nbsp;local&nbsp;networks.&lt;br&gt;#&nbsp;Adapt&nbsp;localnet&nbsp;in&nbsp;the&nbsp;ACL&nbsp;section&nbsp;to&nbsp;list&nbsp;your&nbsp;(internal)&nbsp;IP&nbsp;networks&lt;br&gt;#&nbsp;from&nbsp;where&nbsp;browsing&nbsp;should&nbsp;be&nbsp;allowed&lt;br&gt;http_access&nbsp;allow&nbsp;localnet&lt;br&gt;http_access&nbsp;allow&nbsp;localhost&lt;br&gt;&lt;br&gt;#&nbsp;And&nbsp;finally&nbsp;deny&nbsp;all&nbsp;other&nbsp;access&nbsp;to&nbsp;this&nbsp;proxy&lt;br&gt;http_access&nbsp;deny&nbsp;all&lt;br&gt;&lt;br&gt;#&nbsp;Squid&nbsp;normally&nbsp;listens&nbsp;to&nbsp;port&nbsp;3128&lt;br&gt;http_port&nbsp;3128&nbsp;transparent&lt;br&gt;http_port&nbsp;3130&lt;br&gt;&lt;br&gt;#&nbsp;We&nbsp;recommend&nbsp;you&nbsp;to&nbsp;use&nbsp;at&nbsp;least&nbsp;the&nbsp;following&nbsp;line.&lt;br&gt;hierarchy_stoplist&nbsp;cgi-bin&nbsp;?&lt;br&gt;&lt;br&gt;#&nbsp;Uncomment&nbsp;and&nbsp;adjust&nbsp;the&nbsp;following&nbsp;to&nbsp;add&nbsp;a&nbsp;disk&nbsp;cache&nbsp;directory.&lt;br&gt;access_log&nbsp;/logs/squid/access.log&lt;br&gt;cache_log&nbsp;/logs/squid/cache.log&lt;br&gt;&lt;br&gt;#&nbsp;Leave&nbsp;coredumps&nbsp;in&nbsp;the&nbsp;first&nbsp;cache&nbsp;dir&lt;br&gt;coredump_dir&nbsp;/var/spool/squid&lt;br&gt;&lt;br&gt;visible_hostname&nbsp;&lt;a&nbsp;href=&quot;http://domain.com&quot;&gt;domain.com&lt;/a&gt;&lt;br&gt;&lt;br&gt;#&nbsp;Add&nbsp;any&nbsp;of&nbsp;your&nbsp;own&nbsp;refresh_pattern&nbsp;entries&nbsp;above&nbsp;these.&lt;br&gt;refresh_pattern&nbsp;-i&nbsp;(robots\.txt)$&nbsp;60&nbsp;40%&nbsp;240&lt;br&gt;refresh_pattern&nbsp;-i&nbsp;\.(html|htm|css|js)$&nbsp;1440&nbsp;40%&nbsp;259200&lt;br&gt;refresh_pattern&nbsp;-i&nbsp;\.(gif|png|jpg|jpeg|ico|otf|woff|eot|ttf|svg)$&nbsp;10080&nbsp;90%&nbsp;259200&nbsp;override-expire&nbsp;ignore-no-cache&nbsp;ignore-no-store&nbsp;ignore-private&lt;br&gt;refresh_pattern&nbsp;^ftp:  &nbsp;1440 &nbsp;20%&nbsp;10080&lt;br&gt;refresh_pattern&nbsp;^gopher: &nbsp;1440 &nbsp;0% &nbsp;1440&lt;br&gt;refresh_pattern&nbsp;-i&nbsp;(/cgi-bin/|\?)&nbsp;0&nbsp;0% &nbsp;0&lt;br&gt;refresh_pattern&nbsp;.  &nbsp;0&nbsp;20%&nbsp;4320&lt;br&gt;&lt;br&gt;cache_peer&nbsp;otherl1proxy&nbsp;parent&nbsp;3128&nbsp;0&nbsp;no-query&nbsp;originserver&nbsp;no-digest&nbsp;name=other_l1_proxy&lt;br&gt;acl&nbsp;sites_other_l1_proxy&nbsp;dstdomain&nbsp;.&lt;a&nbsp;href=&quot;http://othersite.com&quot;&gt;othersite.com&lt;/a&gt;&lt;br&gt;cache_peer_access&nbsp;other_l1_proxy&nbsp;allow&nbsp;sites_other_l1_proxy&lt;br&gt;cache_peer_access&nbsp;other_l1_proxy&nbsp;deny&nbsp;all&lt;br&gt;&lt;br&gt;cache_peer&nbsp;httpelb &nbsp;parent&nbsp;80&nbsp;0&nbsp;no-query&nbsp;no-digest&nbsp;name=http_peer&lt;br&gt;cache_peer_access&nbsp;http_peer&nbsp;allow&nbsp;httpacl&lt;br&gt;cache_peer&nbsp;httpselb &nbsp;parent&nbsp;3129&nbsp;0&nbsp;no-query&nbsp;no-digest&nbsp;name=https_peer&lt;br&gt;cache_peer_access&nbsp;https_peer&nbsp;deny&nbsp;httpacl&lt;br&gt;never_direct&nbsp;allow&nbsp;all&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
