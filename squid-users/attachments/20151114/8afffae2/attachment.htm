<tt>
&lt;html&gt;<br>
&lt;head&gt;<br>
&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;style=&quot;font-family:&nbsp;Monospace;&quot;&gt;<br>
&lt;div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;face=&quot;monospace&quot;&gt;Hi&nbsp;Alex,&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;face=&quot;monospace&quot;&gt;&lt;br&gt;<br>
&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;face=&quot;monospace&quot;&gt;okay,&nbsp;I&nbsp;think&nbsp;I&nbsp;understand&nbsp;a&nbsp;little&nbsp;more.&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;face=&quot;monospace&quot;&gt;&lt;br&gt;<br>
&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;face=&quot;monospace&quot;&gt;I&nbsp;am&nbsp;trying&nbsp;to&nbsp;get&nbsp;the&nbsp;old&nbsp;server-first&nbsp;method&nbsp;working&nbsp;with&nbsp;new&nbsp;peek&nbsp;and&nbsp;splice&nbsp;but&nbsp;without&nbsp;success.&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;face=&quot;monospace&quot;&gt;&lt;br&gt;<br>
&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;face=&quot;monospace&quot;&gt;I&nbsp;have&nbsp;built&nbsp;a&nbsp;RPM&nbsp;package&nbsp;with&nbsp;latest&nbsp;3.5.11&nbsp;source&nbsp;based&nbsp;on&nbsp;&lt;/font&gt;&lt;a&nbsp;href=&quot;http://www1.ngtech.co.il/repo/centos/6/SRPMS/squid-3.5.9-1.el6.src.rpm&quot;&gt;http://www1.ngtech.co.il/repo/centos/6/SRPMS/squid-3.5.9-1.el6.src.rpm&lt;/a&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;Squid&nbsp;is&nbsp;configured&nbsp;with&nbsp;SSL&nbsp;bump&nbsp;similar&nbsp;to&nbsp;the&nbsp;configuration&nbsp;suggested&nbsp;by&nbsp;Sebastian.&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;In&nbsp;my&nbsp;view&nbsp;it's&nbsp;a&nbsp;good&nbsp;idea&nbsp;to&nbsp;give&nbsp;a&nbsp;detailed&nbsp;description&nbsp;of&nbsp;my&nbsp;setup&nbsp;with&nbsp;real&nbsp;IPs&nbsp;and&nbsp;hostnames:&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;1.&nbsp;Client&nbsp;machine&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;OS:&nbsp;CentOS&nbsp;6.6&nbsp;x86_64&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;IP:&nbsp;10.0.0.2/24&nbsp;(internal&nbsp;network)&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;Default&nbsp;Gateway:&nbsp;10.0.0.1&nbsp;(=&nbsp;Squid&nbsp;machine)&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;2.&nbsp;Squid&nbsp;machine&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;OS:&nbsp;CentOS&nbsp;6.6&nbsp;x86_64&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;IP&nbsp;1:&nbsp;10.0.0.1/24&nbsp;(internal&nbsp;network)&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;IP&nbsp;2:&nbsp;172.31.1.15/24&nbsp;(outgoing&nbsp;interface,&nbsp;behind&nbsp;a&nbsp;router)&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;#&nbsp;iptables&nbsp;-L&nbsp;-n&nbsp;-t&nbsp;nat&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;Chain&nbsp;PREROUTING&nbsp;(policy&nbsp;ACCEPT)&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;target&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prot&nbsp;opt&nbsp;source&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destination&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;DNAT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tcp&nbsp;&nbsp;--&nbsp;&nbsp;0.0.0.0/0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0.0.0/0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tcp&nbsp;dpt:80&nbsp;to:10.0.0.1:3129&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;DNAT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tcp&nbsp;&nbsp;--&nbsp;&nbsp;0.0.0.0/0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0.0.0/0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tcp&nbsp;dpt:443&nbsp;to:10.0.0.1:3443&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;&lt;br&gt;<br>
&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;Chain&nbsp;POSTROUTING&nbsp;(policy&nbsp;ACCEPT)&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;target&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prot&nbsp;opt&nbsp;source&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destination&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;MASQUERADE&nbsp;&nbsp;all&nbsp;&nbsp;--&nbsp;&nbsp;0.0.0.0/0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0.0.0/0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;&lt;br&gt;<br>
&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;Chain&nbsp;OUTPUT&nbsp;(policy&nbsp;ACCEPT)&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;target&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prot&nbsp;opt&nbsp;source&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destination&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/font&gt;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;#&nbsp;squid&nbsp;-v&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;Squid&nbsp;Cache:&nbsp;Version&nbsp;3.5.11&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;Service&nbsp;Name:&nbsp;squid&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;configure&nbsp;options:&nbsp;&nbsp;'--build=x86_64-redhat-linux-gnu'&nbsp;'--host=x86_64-redhat-linux-gnu'&nbsp;'--target=x86_64-redhat-linux-gnu'&nbsp;'--program-prefix='&nbsp;'--prefix=/usr'&nbsp;'--exec-prefix=/usr'&nbsp;'--bindir=/usr/bin'&nbsp;'--sbindir=/usr/sbin'<br>
&nbsp;'--sysconfdir=/etc'&nbsp;'--datadir=/usr/share'&nbsp;'--includedir=/usr/include'&nbsp;'--libdir=/usr/lib64'&nbsp;'--libexecdir=/usr/libexec'&nbsp;'--sharedstatedir=/var/lib'&nbsp;'--mandir=/usr/share/man'&nbsp;'--infodir=/usr/share/info'&nbsp;'--exec_prefix=/usr'&nbsp;'--libexecdir=/usr/lib64/squid'<br>
&nbsp;'--localstatedir=/var'&nbsp;'--datadir=/usr/share/squid'&nbsp;'--sysconfdir=/etc/squid'&nbsp;'--with-logdir=$(localstatedir)/log/squid'&nbsp;'--with-pidfile=$(localstatedir)/run/squid.pid'&nbsp;'--disable-dependency-tracking'&nbsp;'--enable-follow-x-forwarded-for'&nbsp;'--enable-auth'&nbsp;'--enable-auth-basic=DB,LDAP,NCSA,NIS,PAM,POP3,RADIUS,SASL,SMB,getpwnam'<br>
&nbsp;'--enable-auth-ntlm=smb_lm,fake'&nbsp;'--enable-auth-digest=file,LDAP'&nbsp;'--enable-auth-negotiate=kerberos,wrapper'&nbsp;'--enable-external-acl-helpers=wbinfo_group,kerberos_ldap_group'&nbsp;'--enable-cache-digests'&nbsp;'--enable-cachemgr-hostname=localhost'&nbsp;'--enable-delay-pools'<br>
&nbsp;'--enable-epoll'&nbsp;'--enable-icap-client'&nbsp;'--enable-ident-lookups'&nbsp;'--enable-linux-netfilter'&nbsp;'--enable-removal-policies=heap,lru'&nbsp;'--enable-snmp'&nbsp;'--enable-storeio=aufs,diskd,ufs,rock'&nbsp;'--enable-wccpv2'&nbsp;'--enable-esi'&nbsp;'--enable-ssl-crtd'&nbsp;'--enable-icmp'&nbsp;'--with-aio'<br>
&nbsp;'--with-default-user=squid'&nbsp;'--with-filedescriptors=16384'&nbsp;'--with-dl'&nbsp;'--with-openssl'&nbsp;'--with-pthreads'&nbsp;'--with-included-ltdl'&nbsp;'--disable-arch-native'&nbsp;'--without-nettle'&nbsp;'build_alias=x86_64-redhat-linux-gnu'&nbsp;'host_alias=x86_64-redhat-linux-gnu'&nbsp;'target_alias=x86_64-redhat-linux-gnu'<br>
&nbsp;'CFLAGS=-O2&nbsp;-g&nbsp;-pipe&nbsp;-Wall&nbsp;-Wp,-D_FORTIFY_SOURCE=2&nbsp;-fexceptions&nbsp;-fstack-protector&nbsp;--param=ssp-buffer-size=4&nbsp;-m64&nbsp;-mtune=generic'&nbsp;'CXXFLAGS=-O2&nbsp;-g&nbsp;-pipe&nbsp;-Wall&nbsp;-Wp,-D_FORTIFY_SOURCE=2&nbsp;-fexceptions&nbsp;-fstack-protector&nbsp;--param=ssp-buffer-size=4&nbsp;-m64&nbsp;-mtune=generic<br>
&nbsp;-fPIC'&nbsp;'PKG_CONFIG_PATH=/usr/lib64/pkgconfig:/usr/share/pkgconfig'&nbsp;--enable-ltdl-convenience&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;#&nbsp;Squid&nbsp;configruation&nbsp;file&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;#&nbsp;Rules&nbsp;allowing&nbsp;access&nbsp;from&nbsp;your&nbsp;local&nbsp;networks&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;acl&nbsp;localnet&nbsp;src&nbsp;10.0.0.0/8&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&quot;&gt;<br>
&lt;/span&gt;#&nbsp;RFC1918&nbsp;possible&nbsp;internal&nbsp;network&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;acl&nbsp;localnet&nbsp;src&nbsp;172.16.0.0/12&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&quot;&gt;<br>
&lt;/span&gt;#&nbsp;RFC1918&nbsp;possible&nbsp;internal&nbsp;network&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;acl&nbsp;localnet&nbsp;src&nbsp;192.168.0.0/16&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&quot;&gt;<br>
&lt;/span&gt;#&nbsp;RFC1918&nbsp;possible&nbsp;internal&nbsp;network&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;acl&nbsp;localnet&nbsp;src&nbsp;fc00::/7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;RFC&nbsp;4193&nbsp;local&nbsp;private&nbsp;network&nbsp;range&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;acl&nbsp;localnet&nbsp;src&nbsp;fe80::/10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;RFC&nbsp;4291&nbsp;link-local&nbsp;(directly&nbsp;plugged)&nbsp;machines&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;acl&nbsp;SSL_ports&nbsp;port&nbsp;443&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;80&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&quot;&gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&quot;&gt;&lt;/span&gt;#&nbsp;http&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;21&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&quot;&gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&quot;&gt;&lt;/span&gt;#&nbsp;ftp&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;443&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&quot;&gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&quot;&gt;&lt;/span&gt;#&nbsp;https&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;70&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&quot;&gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&quot;&gt;&lt;/span&gt;#&nbsp;gopher&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;210&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&quot;&gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&quot;&gt;&lt;/span&gt;#&nbsp;wais&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;1025-65535&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&quot;&gt;<br>
&lt;/span&gt;#&nbsp;unregistered&nbsp;ports&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;280&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&quot;&gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&quot;&gt;&lt;/span&gt;#&nbsp;http-mgmt&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;488&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&quot;&gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&quot;&gt;&lt;/span&gt;#&nbsp;gss-http&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;591&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&quot;&gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&quot;&gt;&lt;/span&gt;#&nbsp;filemaker&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;777&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&quot;&gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&quot;&gt;&lt;/span&gt;#&nbsp;multiling&nbsp;http&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;acl&nbsp;CONNECT&nbsp;method&nbsp;CONNECT&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;#&nbsp;SSL&nbsp;Bump&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;acl&nbsp;step1&nbsp;at_step&nbsp;SslBump1&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;acl&nbsp;MYSITE&nbsp;ssl::server_name&nbsp;school.bettermarks.com&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;ssl_bump&nbsp;peek&nbsp;step1&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;ssl_bump&nbsp;bump&nbsp;MYSITE&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;ssl_bump&nbsp;splice&nbsp;all&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;#&nbsp;Deny&nbsp;requests&nbsp;to&nbsp;certain&nbsp;unsafe&nbsp;ports&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;http_access&nbsp;deny&nbsp;!Safe_ports&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;#&nbsp;Deny&nbsp;CONNECT&nbsp;to&nbsp;other&nbsp;than&nbsp;secure&nbsp;SSL&nbsp;ports&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;http_access&nbsp;deny&nbsp;CONNECT&nbsp;!SSL_ports&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;#&nbsp;Only&nbsp;allow&nbsp;cachemgr&nbsp;access&nbsp;from&nbsp;localhost&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;http_access&nbsp;allow&nbsp;localhost&nbsp;manager&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;http_access&nbsp;deny&nbsp;manager&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;#&nbsp;Only&nbsp;allow&nbsp;purge&nbsp;from&nbsp;localhast&nbsp;(squidclient&nbsp;-m&nbsp;PURGE&nbsp;&lt;object-url&gt;&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;acl&nbsp;Purge&nbsp;method&nbsp;PURGE&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;http_access&nbsp;allow&nbsp;localhost&nbsp;Purge&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;http_access&nbsp;deny&nbsp;Purge&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;#&nbsp;Allow&nbsp;access&nbsp;from&nbsp;your&nbsp;local&nbsp;networks&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;http_access&nbsp;allow&nbsp;localnet&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;http_access&nbsp;allow&nbsp;localhost&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;#&nbsp;And&nbsp;finally&nbsp;deny&nbsp;all&nbsp;other&nbsp;access&nbsp;to&nbsp;this&nbsp;proxy&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;http_access&nbsp;deny&nbsp;all&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;#&nbsp;Squid&nbsp;normally&nbsp;listens&nbsp;to&nbsp;port&nbsp;3128&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;http_port&nbsp;3128&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;http_port&nbsp;10.0.0.1:3129&nbsp;intercept&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;https_port&nbsp;10.0.0.1:3443&nbsp;intercept&nbsp;ssl-bump&nbsp;cert=/etc/squid/certs/bettermarks.com-chain.crt&nbsp;key=/etc/squid/certs/bettermarks.com-unsecure.key&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;##&nbsp;Memory&nbsp;only&nbsp;caching&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;#&nbsp;Cache&nbsp;memory&nbsp;size&nbsp;(default:&nbsp;256&nbsp;MB)&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;cache_mem&nbsp;512&nbsp;MB&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;#&nbsp;Max&nbsp;object&nbsp;size&nbsp;in&nbsp;memory&nbsp;(default:&nbsp;512&nbsp;KB)&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;maximum_object_size_in_memory&nbsp;2&nbsp;MB&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;#&nbsp;Uncomment&nbsp;and&nbsp;adjust&nbsp;the&nbsp;following&nbsp;to&nbsp;add&nbsp;a&nbsp;disk&nbsp;cache&nbsp;directory.&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;#cache_dir&nbsp;ufs&nbsp;/var/spool/squid&nbsp;100&nbsp;16&nbsp;256&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;#&nbsp;Leave&nbsp;coredumps&nbsp;in&nbsp;the&nbsp;first&nbsp;cache&nbsp;dir&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;coredump_dir&nbsp;/var/spool/squid&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;##&nbsp;Refresh&nbsp;patterns&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;#&nbsp;BM&nbsp;static&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;refresh_pattern&nbsp;-i&nbsp;^https:\/\/(school|cdn)\.bettermarks\.com\/static\/.*?&nbsp;1440&nbsp;100%&nbsp;1440&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;#&nbsp;BM&nbsp;dynamic&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;refresh_pattern&nbsp;-i&nbsp;^https:\/\/school\.bettermarks\.com\/.*?&nbsp;0&nbsp;0%&nbsp;0&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;#&nbsp;default&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;refresh_pattern&nbsp;^ftp:&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&quot;&gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&quot;&gt;&lt;/span&gt;1440&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&quot;&gt;<br>
&lt;/span&gt;20%&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&quot;&gt;&nbsp;&lt;/span&gt;10080&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;refresh_pattern&nbsp;^gopher:&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&quot;&gt;<br>
&lt;/span&gt;1440&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&quot;&gt;&nbsp;&lt;/span&gt;0%&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&quot;&gt;<br>
&lt;/span&gt;1440&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;refresh_pattern&nbsp;-i&nbsp;(/cgi-bin/|\?)&nbsp;0&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&quot;&gt;<br>
&lt;/span&gt;0%&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&quot;&gt;&nbsp;&lt;/span&gt;0&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;refresh_pattern&nbsp;.&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&quot;&gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&quot;&gt;&lt;/span&gt;0&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&quot;&gt;<br>
&lt;/span&gt;20%&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&quot;&gt;&nbsp;&lt;/span&gt;4320&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;#&nbsp;Cache&nbsp;log&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;debug_options&nbsp;ALL,1&nbsp;33,5&nbsp;&nbsp;83,5&nbsp;89,5&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;My&nbsp;first&nbsp;goal&nbsp;is&nbsp;to&nbsp;replace&nbsp;the&nbsp;old&nbsp;working&nbsp;server-first&nbsp;bumping&nbsp;method:&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;#&nbsp;SSL&nbsp;Bump&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;acl&nbsp;MYSITE&nbsp;dst&nbsp;212.45.105.89&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;ssl_bump&nbsp;server-first&nbsp;MYSITE&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;ssl_bump&nbsp;none&nbsp;all&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;with&nbsp;the&nbsp;new&nbsp;peek&nbsp;and&nbsp;splice&nbsp;method:&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;<br>
&lt;div&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;#&nbsp;SSL&nbsp;Bump&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;acl&nbsp;step1&nbsp;at_step&nbsp;SslBump1&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;acl&nbsp;MYSITE&nbsp;ssl::server_name&nbsp;school.bettermarks.com&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;ssl_bump&nbsp;peek&nbsp;step1&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;ssl_bump&nbsp;bump&nbsp;MYSITE&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;ssl_bump&nbsp;splice&nbsp;all&lt;/font&gt;&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;face=&quot;monospace&quot;&gt;&lt;/font&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;The&nbsp;hostname&nbsp;school.bettermarks.com&nbsp;has&nbsp;the&nbsp;dedicated&nbsp;IP&nbsp;address&nbsp;212.45.105.89&nbsp;and&nbsp;points&nbsp;to&nbsp;a&nbsp;F5&nbsp;loadbalancer&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;that&nbsp;terminates&nbsp;SSL&nbsp;for&nbsp;*.bettermarks.com&nbsp;using&nbsp;the&nbsp;same&nbsp;certificate&nbsp;as&nbsp;Squid.&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;I&nbsp;have&nbsp;called&nbsp;the&nbsp;following&nbsp;command&nbsp;on&nbsp;the&nbsp;client&nbsp;machine:&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#ff0000&quot;&gt;#&nbsp;curl&nbsp;-v&nbsp;&lt;a&nbsp;href=&quot;https://school.bettermarks.com/static/flexclient4/bm_exerciseseries.swf&quot;&gt;https://school.bettermarks.com/&lt;/a&gt;&lt;path-to-file&gt;&nbsp;-o&nbsp;/dev/null&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;*&nbsp;About&nbsp;to&nbsp;connect()&nbsp;to&nbsp;school.bettermarks.com&nbsp;port&nbsp;443&nbsp;(#0)&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;*&nbsp;&nbsp;&nbsp;Trying&nbsp;212.45.105.89...&nbsp;connected&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;*&nbsp;Connected&nbsp;to&nbsp;school.bettermarks.com&nbsp;(212.45.105.89)&nbsp;port&nbsp;443&nbsp;(#0)&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;*&nbsp;Initializing&nbsp;NSS&nbsp;with&nbsp;certpath:&nbsp;sql:/etc/pki/nssdb&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;*&nbsp;&nbsp;&nbsp;CAfile:&nbsp;/etc/pki/tls/certs/ca-bundle.crt&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;&nbsp;&nbsp;CApath:&nbsp;none&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;The&nbsp;command&nbsp;have&nbsp;failed&nbsp;&nbsp;after&nbsp;a&nbsp;while&nbsp;with:&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;*&nbsp;NSS&nbsp;error&nbsp;-5938&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;*&nbsp;Closing&nbsp;connection&nbsp;#0&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;*&nbsp;SSL&nbsp;connect&nbsp;error&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;Squid's&nbsp;access.log:&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;1447179870.180&nbsp;&nbsp;&nbsp;&nbsp;172&nbsp;10.0.0.2&nbsp;TAG_NONE/200&nbsp;0&nbsp;CONNECT&nbsp;212.45.105.89:443&nbsp;-&nbsp;ORIGINAL_DST/212.45.105.89&nbsp;-&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;&lt;br&gt;<br>
&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;&lt;br&gt;<br>
&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;font&nbsp;color=&quot;#000000&quot;&gt;&lt;font&nbsp;face=&quot;monospace&quot;&gt;More&nbsp;information&nbsp;follows&nbsp;in&nbsp;my&nbsp;next&nbsp;post&nbsp;(to&nbsp;&lt;/font&gt;&lt;/font&gt;&lt;font&nbsp;face=&quot;monospace&quot;&gt;&lt;span&nbsp;class=&quot;b5&quot;&gt;not&nbsp;exceed&lt;/span&gt;&lt;span&nbsp;class=&quot;b4&quot;&gt;&nbsp;th&lt;/span&gt;&lt;span&nbsp;class=&quot;b5&quot;&gt;e&nbsp;maximum&nbsp;post&nbsp;size).&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;<br>
&lt;span&nbsp;class=&quot;b5&quot;&gt;&lt;font&nbsp;face=&quot;monospace&quot;&gt;<br>
&lt;div&gt;&lt;span&nbsp;class=&quot;b5&quot;&gt;&lt;font&nbsp;face=&quot;monospace&quot;&gt;&lt;br&gt;<br>
&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;<br>
Stefan&lt;br&gt;<br>
&lt;/font&gt;&lt;/span&gt;<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;monospace&quot;&gt;&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;&lt;br&gt;<br>
&lt;/font&gt;&lt;/font&gt;&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;-x-evo-signature-wrapper&quot;&gt;&lt;span&gt;<br>
&lt;pre&gt;&lt;br&gt;&lt;/pre&gt;<br>
&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;Am&nbsp;Dienstag,&nbsp;den&nbsp;10.11.2015,&nbsp;08:49&nbsp;-0700&nbsp;schrieb&nbsp;Alex&nbsp;Rousskov:&lt;/div&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&lt;div&gt;On&nbsp;11/10/2015&nbsp;07:05&nbsp;AM,&nbsp;Stefan&nbsp;Kutzke&nbsp;wrote:&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&lt;div&gt;My&nbsp;assumption&nbsp;is&nbsp;that&nbsp;I&nbsp;have&nbsp;to&nbsp;use&nbsp;in&nbsp;Squid's&nbsp;config:&lt;/div&gt;<br>
&lt;/blockquote&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&lt;div&gt;acl&nbsp;MYSITE&nbsp;ssl:server_name&nbsp;.mydomain.com&lt;/div&gt;<br>
&lt;div&gt;ssl_bump&nbsp;bump&nbsp;MYSITE&lt;/div&gt;<br>
&lt;div&gt;ssl_bump&nbsp;splice&nbsp;all&lt;/div&gt;<br>
&lt;/blockquote&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&lt;div&gt;This&nbsp;results&nbsp;in&nbsp;tunneling&nbsp;all&nbsp;https&nbsp;traffic,&nbsp;nothing&nbsp;will&nbsp;be&nbsp;bumped&nbsp;and&lt;/div&gt;<br>
&lt;div&gt;cached.&nbsp;&lt;/div&gt;<br>
&lt;/blockquote&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;Yes,&nbsp;probably&nbsp;because&nbsp;MYSITE&nbsp;(ssl::server_name)&nbsp;often&nbsp;needs&nbsp;SNI&nbsp;and&nbsp;SNI&lt;/div&gt;<br>
&lt;div&gt;is&nbsp;not&nbsp;available&nbsp;during&nbsp;step1&nbsp;when&nbsp;MYSITE&nbsp;is&nbsp;evaluated&nbsp;in&nbsp;your&nbsp;config.&lt;/div&gt;<br>
&lt;div&gt;In&nbsp;other&nbsp;words,&nbsp;your&nbsp;config&nbsp;is&nbsp;equivalent&nbsp;to&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&nbsp;ssl_bump&nbsp;splice&nbsp;all&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;unless&nbsp;reverse&nbsp;DNS&nbsp;works&nbsp;perfectly&nbsp;well.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&lt;div&gt;I'm&nbsp;a&nbsp;little&nbsp;bit&nbsp;confused&nbsp;about&nbsp;the&nbsp;documentation:&lt;/div&gt;<br>
&lt;/blockquote&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&lt;div&gt;Under&nbsp;the&nbsp;headline&nbsp;&quot;Processing&nbsp;steps&quot;:&lt;/div&gt;<br>
&lt;div&gt;*Step&nbsp;2:*&lt;/div&gt;<br>
&lt;div&gt;&nbsp;1.&nbsp;Get&nbsp;TLS&nbsp;clientHello&nbsp;info,&nbsp;including&nbsp;*SNI*&nbsp;where&nbsp;available.&nbsp;&lt;/div&gt;<br>
&lt;/blockquote&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&lt;div&gt;Under&nbsp;the&nbsp;headline&nbsp;&quot;Actions&quot;:&lt;/div&gt;<br>
&lt;div&gt;peek/stare&nbsp;Receive&nbsp;client&nbsp;*SNI&nbsp;(step1)*,&nbsp;...&lt;/div&gt;<br>
&lt;/blockquote&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;I&nbsp;know&nbsp;it&nbsp;is&nbsp;confusing,&nbsp;but&nbsp;I&nbsp;cannot&nbsp;find&nbsp;a&nbsp;better&nbsp;way&nbsp;to&nbsp;explain&nbsp;this&lt;/div&gt;<br>
&lt;div&gt;in&nbsp;brief&nbsp;documentation&nbsp;without&nbsp;pictures.&nbsp;Improvements&nbsp;are&nbsp;welcomed.&nbsp;The&lt;/div&gt;<br>
&lt;div&gt;key&nbsp;here&nbsp;is&nbsp;that&nbsp;ssl_bump&nbsp;rules&nbsp;are&nbsp;evaluated&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;step&nbsp;and&lt;/div&gt;<br>
&lt;div&gt;usually&nbsp;allow&nbsp;Squid&nbsp;to&nbsp;do&nbsp;something&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;next&nbsp;step.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;For&nbsp;example,&nbsp;during&nbsp;step1,&nbsp;Squid&nbsp;does&nbsp;not&nbsp;have&nbsp;SNI.&nbsp;If&nbsp;a&nbsp;peek&nbsp;rule&lt;/div&gt;<br>
&lt;div&gt;matches&nbsp;during&nbsp;step1,&nbsp;then&nbsp;Squid&nbsp;proceeds&nbsp;to&nbsp;step2.&nbsp;At&nbsp;the&nbsp;beginning&nbsp;of&lt;/div&gt;<br>
&lt;div&gt;step2,&nbsp;Squid&nbsp;gets&nbsp;SNI.&nbsp;Thus,&nbsp;a&nbsp;step1&nbsp;peek&nbsp;rule&nbsp;controls&nbsp;whether&nbsp;Squid&lt;/div&gt;<br>
&lt;div&gt;will&nbsp;get&nbsp;SNI&nbsp;(during&nbsp;step2).&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&lt;div&gt;Is&nbsp;it&nbsp;possible&nbsp;to&nbsp;achieve&nbsp;my&nbsp;goal&nbsp;with&nbsp;Squid&nbsp;in&nbsp;transparent&nbsp;mode?&lt;/div&gt;<br>
&lt;/blockquote&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;I&nbsp;should&nbsp;be&nbsp;possible,&nbsp;but&nbsp;I&nbsp;do&nbsp;not&nbsp;know&nbsp;whether&nbsp;anybody&nbsp;has&nbsp;done&nbsp;exactly&lt;/div&gt;<br>
&lt;div&gt;that&nbsp;so&nbsp;there&nbsp;could&nbsp;be&nbsp;some&nbsp;minor&nbsp;bugs&nbsp;along&nbsp;the&nbsp;way.&nbsp;You&nbsp;need&lt;/div&gt;<br>
&lt;div&gt;configuration&nbsp;suggested&nbsp;by&nbsp;Sebastian&nbsp;and&nbsp;the&nbsp;latest&nbsp;Squid&nbsp;you&nbsp;can&nbsp;build.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;HTH,&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;Alex.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
