<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;font&nbsp;face=&quot;tahoma,&nbsp;sans-serif&quot;&nbsp;color=&quot;#444444&quot;&gt;Hi&nbsp;guys&lt;/font&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;tahoma,&nbsp;sans-serif&quot;&nbsp;color=&quot;#444444&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;color=&quot;#444444&quot;&nbsp;face=&quot;tahoma,&nbsp;sans-serif&quot;&gt;I&#39;ve&nbsp;managed&nbsp;squid&nbsp;to&nbsp;work&nbsp;with&nbsp;AD,&nbsp;and authorize users&nbsp;based&nbsp;on&nbsp;what&nbsp;AD&nbsp;group&nbsp;they&nbsp;are&nbsp;in.&nbsp;I&nbsp;use&nbsp;Squid-Analyzer&nbsp;for&nbsp;doing&nbsp;reports&nbsp;from&nbsp;access.log.&nbsp;I&#39;ve&nbsp;found&nbsp;2 anomalies with&nbsp;authorization&nbsp;so&nbsp;far.&nbsp;In&nbsp;access&nbsp;log,&nbsp;I&nbsp;see&nbsp;that&nbsp;user&nbsp;is&nbsp;authorized&nbsp;based&nbsp;on&nbsp;his&nbsp;PC&nbsp;name&lt;/font&gt;&lt;span&nbsp;style=&quot;color:rgb(68,68,68);font-family:tahoma,sans-serif&quot;&gt;(not&nbsp;desired)&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(68,68,68);font-family:tahoma,sans-serif&quot;&gt; and&nbsp;not&nbsp;on&nbsp;the&nbsp;user&nbsp;account&nbsp;name.&nbsp;I&#39;ve&nbsp;just&nbsp;enabled&nbsp;debugging&nbsp;on&nbsp;negotiate&nbsp;wrapper,&nbsp;so&nbsp;I&nbsp;will&nbsp;monitor&nbsp;these&nbsp;logs&nbsp;also.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;color=&quot;#444444&quot;&nbsp;face=&quot;tahoma,&nbsp;sans-serif&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;color=&quot;#444444&quot;&nbsp;face=&quot;tahoma,&nbsp;sans-serif&quot;&gt;But&nbsp;in&nbsp;the&nbsp;meantime,&nbsp;have&nbsp;you&nbsp;got&nbsp;any&nbsp;idea&nbsp;why&nbsp;could&nbsp;this&nbsp;happen&nbsp;?&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;tahoma,&nbsp;sans-serif&quot;&nbsp;color=&quot;#444444&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(68,68,68);font-family:tahoma,sans-serif&quot;&gt;&lt;b&gt;PC&nbsp;NAME&nbsp;AUTH:&lt;/b&gt;&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;color=&quot;#444444&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;1447562119.348&nbsp; &nbsp; &nbsp; 0&nbsp;10.13.34.31&nbsp;TCP_DENIED/407&nbsp;3834&nbsp;CONNECT&nbsp;&lt;a&nbsp;href=&quot;http://clients2.google.com:443&quot;&nbsp;target=&quot;_blank&quot;&gt;clients2.google.com:443&lt;/a&gt;&nbsp;-&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;HIER_NONE/-&nbsp;text/html&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;1447562119.374&nbsp; &nbsp; &nbsp; 2&nbsp;10.13.34.31&nbsp;TCP_DENIED/407&nbsp;4094&nbsp;CONNECT&nbsp;&lt;a&nbsp;href=&quot;http://clients2.google.com:443&quot;&nbsp;target=&quot;_blank&quot;&gt;clients2.google.com:443&lt;/a&gt;&nbsp;-&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;HIER_NONE/-&nbsp;text/html&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;1447562239.350&nbsp;119976&nbsp;10.13.34.31&nbsp;TCP_MISS/200&nbsp; &nbsp;4200&nbsp;CONNECT&nbsp;&lt;a&nbsp;href=&quot;http://clients2.google.com:443&quot;&nbsp;target=&quot;_blank&quot;&gt;clients2.google.com:443&lt;/a&gt;&nbsp;icz800639-03$&nbsp;HIER_DIRECT/&lt;a&nbsp;href=&quot;http://173.194.116.231&quot;&nbsp;target=&quot;_blank&quot;&gt;173.194.116.231&lt;/a&gt;&nbsp;-&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:monospace,monospace&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:monospace,monospace&quot;&gt;&lt;b&nbsp;style=&quot;font-family:tahoma,sans-serif&quot;&gt;USER&nbsp;NAME&nbsp;AUTH:&lt;/b&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;&lt;div&gt;1447562039.176&nbsp; &nbsp; &nbsp; 0&nbsp;10.13.34.31&nbsp;TCP_DENIED/407&nbsp;3850&nbsp;CONNECT&nbsp;&lt;a&nbsp;href=&quot;http://lyncwebext.inventec.com:443&quot;&nbsp;target=&quot;_blank&quot;&gt;lyncwebext.inventec.com:443&lt;/a&gt;&nbsp;-&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;HIER_NONE/-&nbsp;text/html&lt;/div&gt;&lt;div&gt;1447562039.215&nbsp; &nbsp; &nbsp;27&nbsp;10.13.34.31&nbsp;TCP_DENIED/407&nbsp;4110&nbsp;CONNECT&nbsp;&lt;a&nbsp;href=&quot;http://lyncwebext.inventec.com:443&quot;&nbsp;target=&quot;_blank&quot;&gt;lyncwebext.inventec.com:443&lt;/a&gt;&nbsp;-&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;HIER_NONE/-&nbsp;text/html&lt;/div&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;1447562041.118&nbsp; &nbsp;2702&nbsp;10.13.34.31&nbsp;TCP_MISS/200&nbsp; &nbsp;6213&nbsp;CONNECT&nbsp;&lt;a&nbsp;href=&quot;http://lyncwebext.inventec.com:443&quot;&nbsp;target=&quot;_blank&quot;&gt;lyncwebext.inventec.com:443&lt;/a&gt;&nbsp;icz800639&nbsp;HIER_DIRECT/&lt;a&nbsp;href=&quot;http://10.8.100.165&quot;&nbsp;target=&quot;_blank&quot;&gt;10.8.100.165&lt;/a&gt;&nbsp;-&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:monospace,monospace&quot;&gt;&lt;b&gt;Squid.conf&lt;/b&gt;&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:monospace,monospace&quot;&gt;#########################################&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;#&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&lt;/span&gt;Enable&nbsp;KERBEROS&nbsp;authentication&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&lt;/span&gt;#&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;#########################################&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;auth_param&nbsp;negotiate&nbsp;program&nbsp;/usr/local/bin/negotiate_wrapper&nbsp;-d&nbsp;--ntlm&nbsp;/usr/bin/ntlm_auth&nbsp;--diagnostics&nbsp;--helper-protocol=squid-2.5-ntlmssp&nbsp;--domain=ICZ&nbsp;--kerberos&nbsp;/usr/lib64/squid/negotiate_kerberos_auth&nbsp;-s&nbsp;GSS_C_NO_NAME&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;auth_param&nbsp;negotiate&nbsp;children&nbsp;20&nbsp;startup=0&nbsp;idle=1&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;auth_param&nbsp;negotiate&nbsp;keep_alive&nbsp;off&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;#########################################&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;#&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;Enable&nbsp;NTLM&nbsp;authentication&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;#&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;#########################################&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;#auth_param&nbsp;ntlm&nbsp;program&nbsp;/usr/bin/ntlm_auth&nbsp;--diagnostics&nbsp;--helper-protocol=squid-2.5-ntlmssp&nbsp;--domain=ICZ&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;#auth_param&nbsp;ntlm&nbsp;children&nbsp;10&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;#auth_param&nbsp;ntlm&nbsp;keep_alive&nbsp;off&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;#########################################&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;#&nbsp;&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&lt;/span&gt;ENABLE&nbsp;LDAP&nbsp;AUTH&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;#&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;#########################################&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;auth_param&nbsp;basic&nbsp;program&nbsp;/usr/lib64/squid/basic_ldap_auth&nbsp;-R&nbsp;-b&nbsp;&quot;dc=icz,dc=inventec&quot;&nbsp;-D&nbsp;squid@icz.inventec&nbsp;-W&nbsp;/etc/squid/ldappass.txt&nbsp;-f&nbsp;sAMAccountName=%s&nbsp;-h&nbsp;icz-dc-1.icz.inventec&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;auth_param&nbsp;basic&nbsp;children&nbsp;10&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;auth_param&nbsp;basic&nbsp;realm&nbsp;Please&nbsp;enter&nbsp;user&nbsp;name&nbsp;to&nbsp;access&nbsp;the&nbsp;internet&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;auth_param&nbsp;basic&nbsp;credentialsttl&nbsp;1&nbsp;hour&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;external_acl_type&nbsp;ldap_group&nbsp;ttl=3600&nbsp;negative_ttl=0&nbsp;children-max=50&nbsp;children-startup=10&nbsp; %LOGIN&nbsp;/usr/lib64/squid/ext_wbinfo_group_acl&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;tahoma,&nbsp;sans-serif&quot;&gt;Thank&nbsp;you&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
