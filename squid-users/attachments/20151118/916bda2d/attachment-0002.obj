### /etc/squid3/squid.conf Configuration File ####

### cache manager
cache_mgr rrobertson@ihcrc.org

### negotiate kerberos and ntlm authentication
auth_param negotiate program /usr/local/bin/negotiate_wrapper -d --ntlm /usr/bin/ntlm_auth --diagnostics --helper-protocol=squid-2.5-ntlmssp --domain=IHCRC --kerberos /usr/lib/squid/negotiate_kerberos_auth -d -s GSS_C_NO_NAME
auth_param negotiate children 10
auth_param negotiate keep_alive off

### pure ntlm authentication
auth_param ntlm program /usr/bin/ntlm_auth --diagnostics --helper-protocol=squid-2.5-ntlmssp --domain=IHCRC
auth_param ntlm children 10
auth_param ntlm keep_alive off

### provide basic authentication via ldap for clients not authenticated via kerberos/ntlm
auth_parm basic program /usr/lib/squid3/basic_ldap_auth -R -b "dc=ihcrc,dc=org" -D squid@ihcrc.org -W /etc/squid3/ldappass.txt -f sAMAccountName=%s -h srv-dataserver2.ihcrc.org
auth_param basic children 10
auth_param basic realm Internet Proxy
auth_param basic credentialsttl 1 minute

### ldap authorization
external_acl_type memberof %LOGIN /usr/lib/squid3/ext_ldap_group_acl -R -K -S -b "dc=ihcrc,dc=org" -D squid@ihcrc.org -W /etc/squid3/ldappass.txt -f "(&(objectclass=person)(sAMAccountName=%v)(memberof=cn%g,ou=INFORMATION_SYSTEMS,dc=ihcrc,dc=org" -h srv-dataserver2.ihcrc.org

### acl for proxy auth and ldap authorizations
acl auth proxy_auth REQUIRED
#	aclname		acltype		typename	activedirectorygroup
acl	FullAccess	external	memberof	"/etc/squid3/full_access.txt"
acl	allowedsites	dstdomain	"/etc/squid3/allowedsites.txt"
acl	blockedsites	dstdomain	"/etc/squid3/blockedsites.txt"
acl	exceptedsites	dstdomain	"/etc/squid3/exceptedsites.txt"
acl	prioritysites	dstdomain	"/etc/squid3/prioritysites.txt"

### squid defaults
acl manager proto cache_object
acl localhost src 127.0.0.1/32 ::1
acl to_localhost dst 127.0.0.0/8 0.0.0.0/32 ::1
acl SSL_ports port 443
acl safe_ports port 80		# http
acl safe_ports port 21		# ftp
acl safe_ports port 443		# https
acl safe_ports port 70		# gopher
acl safe_ports port 210		# wais
acl safe_ports port 1025-65535	# unregistered ports
acl safe_ports port 280		# http-mgmt
acl safe_ports port 488		# gss-http
acl safe_ports port 591		# filemaker
acl safe_ports port 777		# multiling http
acl CONNECT method CONNECT
http_access allow manager localhost
http_access deny manager
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow localhost

### http_access rules
# allow unrestricted access to prioritysites
http_access allow prioritysites
# enforce authentication, order of rules is important for authorization levels
http_access deny !auth
# prevent access to basic auth prompt for BlockedAccess users
http_access allow allowedsites
http_access allow FullAccess auth
# DO NOT REMOVE THE FOLLOWING LINE
http_access deny all

### logging
# don't log allowedsites, prioritysites, AnonymousAccess
access_log /var/log/squid3/access.log
squid !allowedsites

### squid Debian defaults
http_port 3128
hierarchy_stoplist cgi-bin ?
coredump_dir /var/spool/squid3
refresh_pattern	^ftp:		1440	20%	10080
refresh_pattern ^gopher:	1440	0%	1440
refresh_pattern -i (/cgi-bin/|\?) 0	0%	0
refresh_pattern .		0	20%	4320
