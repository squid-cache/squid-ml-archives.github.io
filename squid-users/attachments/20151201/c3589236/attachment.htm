<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Finally,&nbsp;we&nbsp;found&nbsp;the&nbsp;root&nbsp;cause,&nbsp;it&nbsp;is&nbsp;kernel&nbsp;issue&nbsp;with&nbsp;specific&nbsp;version&nbsp;on&nbsp;ubuntu&nbsp;14.04.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;We&nbsp;prepared&nbsp;new&nbsp;environment&nbsp;for&nbsp;testing,&nbsp;3.3.8，3.5.11，2.7&nbsp;on&nbsp;ubuntu&nbsp;12.04&nbsp;and&nbsp;14.04.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;3.3.8，3.5.11&nbsp;on&nbsp;ubuntu&nbsp;12.04&nbsp;is&nbsp;ok&lt;br&gt;&lt;/div&gt;&lt;div&gt;2.7&nbsp;on&nbsp;ubuntu&nbsp;14.04&nbsp;is&nbsp;ok&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;3.3.8，3.5.11&nbsp;on&nbsp;ubuntu&nbsp;14.04&nbsp;is&nbsp;abnormal.&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;found&nbsp;this &lt;a&nbsp;href=&quot;https://bugs.launchpad.net/ubuntu/+source/linux-meta-lts-trusty/+bug/1516738&quot;&gt;https://bugs.launchpad.net/ubuntu/+source/linux-meta-lts-trusty/+bug/1516738&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;helvetica,&nbsp;sans-serif&quot;&gt;and&nbsp;I&nbsp;downgrade&nbsp;kernel&nbsp;version&nbsp;to &lt;span&nbsp;style=&quot;color:rgb(51,51,51);line-height:18px&quot;&gt;3.13.0-57&nbsp;on&nbsp;ubuntu&nbsp;14.04,&nbsp;memory&nbsp;usage&nbsp;is&nbsp;normal&nbsp;now.&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;helvetica,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(51,51,51);line-height:18px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;helvetica,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(51,51,51);line-height:18px&quot;&gt;I&nbsp;don&#39;t&nbsp;know&nbsp;how&nbsp;was&nbsp;it&nbsp;introduced&nbsp;into&nbsp;kernel&nbsp;on&nbsp;ubuntu&nbsp;14.04,&nbsp;but&nbsp;it&nbsp;is&nbsp;really&nbsp;works&nbsp;for&nbsp;me.&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;helvetica,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(51,51,51);line-height:18px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;helvetica,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(51,51,51);line-height:18px&quot;&gt;Thanks&nbsp;for&nbsp;you&nbsp;help&nbsp;.&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;helvetica,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(51,51,51);line-height:18px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;helvetica,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(51,51,51);line-height:18px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;helvetica,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(51,51,51);line-height:18px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;2015-11-30&nbsp;16:55&nbsp;GMT+08:00&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&nbsp;target=&quot;_blank&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;On&nbsp;30/11/2015&nbsp;9:31&nbsp;p.m.,&nbsp;风声&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;We&nbsp;did&nbsp;not&nbsp;enable&nbsp;squid&nbsp;cache,&nbsp;so&nbsp;I&nbsp;think&nbsp;memory&nbsp;is&nbsp;ok&nbsp;for&nbsp;our&nbsp;case,&nbsp;and&nbsp;we&lt;br&gt;<br>
&gt;&nbsp;run&nbsp;squid&nbsp;servers&nbsp;(without&nbsp;cache,&nbsp;without&nbsp;cache&nbsp;cluster,&nbsp;just&nbsp;as&nbsp;forward&lt;br&gt;<br>
&gt;&nbsp;proxy)&nbsp;more&nbsp;than&nbsp;100&nbsp;servers&nbsp;more&nbsp;than&nbsp;1&nbsp;years&nbsp;in&nbsp;AWS&nbsp;serveral&nbsp;regions&nbsp;with&lt;br&gt;<br>
&gt;&nbsp;EC2&nbsp;c3.xlarge&nbsp;on&nbsp;ubuntu&nbsp;12.04.&nbsp;It&nbsp;was&nbsp;always&nbsp;running&nbsp;well.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Just&nbsp;after&nbsp;upgrade&nbsp;ubuntu&nbsp;14.04,&nbsp;we&nbsp;found&nbsp;the&nbsp;memory&nbsp;usage&nbsp;increased.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Server&nbsp;Spec:&nbsp;AWS&nbsp;EC2&nbsp;c3.xlarge&nbsp;(4&nbsp;Cores,&nbsp;7.5GB&nbsp;Memory,&nbsp;2&nbsp;x&nbsp;40&nbsp;GB&nbsp;SSD)&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Before&nbsp;upgrade:&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;12.04:&lt;br&gt;<br>
&gt;&nbsp;Memory&nbsp;usage&nbsp;is&nbsp;always&nbsp;less&nbsp;than&nbsp;50%&nbsp;(3.5GB),&nbsp;will&nbsp;increase&nbsp;or&nbsp;decrease&lt;br&gt;<br>
&gt;&nbsp;because&nbsp;traffic&nbsp;changes&lt;br&gt;<br>
&gt;&nbsp;CPU&nbsp;is&nbsp;very&nbsp;low,&nbsp;same&nbsp;as&nbsp;Disk&nbsp;IO,&nbsp;B/W&nbsp;(In&nbsp;or&nbsp;Out)&nbsp;is&nbsp;500Mb/s&nbsp;at&nbsp;most,&nbsp;is&lt;br&gt;<br>
&gt;&nbsp;around&nbsp;200Mb/s&nbsp;most&nbsp;of&nbsp;time.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;14:04&lt;br&gt;<br>
&gt;&nbsp;Memory&nbsp;usage&nbsp;is&nbsp;about&nbsp;80-90&nbsp;%&nbsp;(nearly&nbsp;7GB),&nbsp;will&nbsp;increase&nbsp;,&nbsp;but&nbsp;it&nbsp;decrease&lt;br&gt;<br>
&gt;&nbsp;very&nbsp;slow,&nbsp;and&nbsp;always&nbsp;keeping&nbsp;more&nbsp;than&nbsp;50%&nbsp;(3.5GB),&lt;br&gt;<br>
&gt;&nbsp;CPU&nbsp;is&nbsp;very&nbsp;low,&nbsp;same&nbsp;as&nbsp;Disk&nbsp;IO,&nbsp;B/W&nbsp;(In&nbsp;or&nbsp;Out)&nbsp;is&nbsp;500Mb/s&nbsp;at&nbsp;most,&nbsp;is&lt;br&gt;<br>
&gt;&nbsp;around&nbsp;200Mb/s&nbsp;most&nbsp;of&nbsp;time.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;tested&nbsp;with&nbsp;squid-3.3.8&nbsp;(ubuntu&nbsp;offical&nbsp;packages),&nbsp;and&nbsp;squid-3.5.11&nbsp;on&lt;br&gt;<br>
&gt;&nbsp;12.04&nbsp;and&nbsp;14.04,&nbsp;I&nbsp;think&nbsp;it&nbsp;is&nbsp;most&nbsp;likely&nbsp;ubuntu&nbsp;related&nbsp;issue&nbsp;?&nbsp;because&lt;br&gt;<br>
&gt;&nbsp;same&nbsp;version,&nbsp;same&nbsp;configs,&nbsp;but&nbsp;different&nbsp;OS&nbsp;versions.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;Most&nbsp;likely.&nbsp;Though&nbsp;a&nbsp;whole&nbsp;OS&nbsp;of&nbsp;difference&nbsp;has&nbsp;many&nbsp;moving&nbsp;parts.&nbsp;By&lt;br&gt;<br>
keeping&nbsp;Squid&nbsp;the&nbsp;same&nbsp;you&nbsp;have&nbsp;eliminated&nbsp;it&nbsp;specifically&nbsp;as&nbsp;the&nbsp;cause.&lt;br&gt;<br>
But&nbsp;all&nbsp;the&nbsp;libraries&nbsp;it&nbsp;uses&nbsp;will&nbsp;be&nbsp;different&nbsp;in&nbsp;each&nbsp;OS.&lt;br&gt;<br>
&lt;br&gt;<br>
If&nbsp;there&nbsp;was&nbsp;a&nbsp;32-bit&nbsp;to&nbsp;64-bit&nbsp;change&nbsp;in&nbsp;the&nbsp;hardware&nbsp;or&nbsp;memory&lt;br&gt;<br>
allocation&nbsp;system&nbsp;you&nbsp;could&nbsp;also&nbsp;see&nbsp;this&nbsp;same&nbsp;change.&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;<br>
Amos&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
