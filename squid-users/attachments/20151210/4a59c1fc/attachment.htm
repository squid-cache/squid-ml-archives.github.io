<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;div&gt;Hi,&lt;br&gt;&lt;br&gt;My&nbsp;problem&nbsp;with&nbsp;Squid&nbsp;3.4.8&nbsp;is&nbsp;the&nbsp;following&nbsp;:&lt;br&gt;&lt;br&gt;The&nbsp;ext_ldap_group_acl&nbsp;locates&nbsp;the&nbsp;user&nbsp;group&nbsp;of&nbsp;a&nbsp;user,&nbsp;but&nbsp;even&nbsp;if&nbsp;find&nbsp;the&nbsp;first&nbsp;group&nbsp;(eg&nbsp;&quot;administrators&quot;)&nbsp;in&nbsp;which&nbsp;the&nbsp;user&nbsp;is&nbsp;a&nbsp;member&nbsp;continue&nbsp;to&nbsp;search&nbsp;for&nbsp;all&nbsp;groups&nbsp;that&nbsp;the&nbsp;user&nbsp;is&nbsp;a&nbsp;member,&nbsp;so&nbsp;authenticate&nbsp;the&nbsp;user&nbsp;only&nbsp;in&nbsp;his&nbsp;last&nbsp;group,&nbsp;in&nbsp;the&nbsp;my&nbsp;case&nbsp;is&nbsp;the&nbsp;Domain&nbsp;Users&nbsp;group.&lt;br&gt;&lt;br&gt;This&nbsp;way,&nbsp;only&nbsp;rules&nbsp;to&nbsp;Domain&nbsp;Users&nbsp;is&nbsp;working&nbsp;in&nbsp;my&nbsp;Squid&nbsp;Server.&nbsp;Rules&nbsp;to&nbsp;admins&nbsp;users&nbsp;and&nbsp;others&nbsp;do&nbsp;not&nbsp;work.&lt;br&gt;&lt;br&gt;I&nbsp;have&nbsp;the&nbsp;message&nbsp;in &nbsp;/var/log/squid3/cache.log:&lt;br&gt;&lt;br&gt;2015/12/10&nbsp;06:36:33&nbsp;kid1|&nbsp;helperOpenServers:&nbsp;Starting&nbsp;1/50&nbsp;&#39;basic_ldap_auth&#39;&nbsp;processes&lt;br&gt;ext_ldap_group_acl.cc(583):&nbsp;pid=24059&nbsp;:Connected&nbsp;OK&lt;br&gt;ext_ldap_group_acl.cc(722):&nbsp;pid=24059&nbsp;:group&nbsp;filter&nbsp;&#39;(&amp;(objectclass=person)(sAMAccountName=ze)(memberof=cn=webadmins,DC=empresa,DC=com,DC=br&nbsp;))&#39;,&nbsp;searchbase&nbsp;&#39;DC=empresa,DC=com,DC=br&#39;&lt;br&gt;2015/12/10&nbsp;06:36:34&nbsp;kid1|&nbsp;Starting&nbsp;new&nbsp;redirector&nbsp;helpers...&lt;br&gt;2015/12/10&nbsp;06:36:34&nbsp;kid1|&nbsp;helperOpenServers:&nbsp;Starting&nbsp;1/20&nbsp;&#39;squidGuard&#39;&nbsp;processes&lt;br&gt;ext_ldap_group_acl.cc(583):&nbsp;pid=24059&nbsp;:Connected&nbsp;OK&lt;br&gt;ext_ldap_group_acl.cc(722):&nbsp;pid=24059&nbsp;:group&nbsp;filter&nbsp;&#39;(&amp;(objectclass=person)(sAMAccountName=ze)(memberof=cn=webliberados,DC=empresa,DC=com,DC=br &nbsp;))&#39;,&nbsp;searchbase&nbsp;&#39;DC=empresa,DC=com,DC=br&#39;&lt;br&gt;ext_ldap_group_acl.cc(583):&nbsp;pid=24060&nbsp;:Connected&nbsp;OK&lt;br&gt;ext_ldap_group_acl.cc(722):&nbsp;pid=24060&nbsp;:group&nbsp;filter&nbsp;&#39;(&amp;(objectclass=person)(sAMAccountName=ze)(memberof=cn=domain%20users,DC=empresa,DC=com,DC=br))&#39;,&nbsp;searchbase&nbsp;&#39;DC=empresa,DC=com,DC=br&#39;&lt;br&gt;2015/12/10&nbsp;06:38:04&nbsp;kid1|&nbsp;Starting&nbsp;new&nbsp;redirector&nbsp;helpers...&lt;br&gt;&lt;br&gt;&lt;br&gt;Here&nbsp;is&nbsp;my&nbsp;squid.conf&lt;br&gt;&lt;br&gt;http_port&nbsp;3128&lt;br&gt;cache_mem&nbsp;512&nbsp;MB&lt;br&gt;cache_swap_low&nbsp;80&lt;br&gt;cache_swap_high&nbsp;90&lt;br&gt;maximum_object_size&nbsp;512&nbsp;MB&lt;br&gt;minimum_object_size&nbsp;0&nbsp;KB&lt;br&gt;maximum_object_size_in_memory&nbsp;4096&nbsp;KB&lt;br&gt;cache_replacement_policy&nbsp;heap&nbsp;LFUDA&lt;br&gt;memory_replacement_policy&nbsp;heap&nbsp;LFUDA&lt;br&gt;quick_abort_min&nbsp;-1&nbsp;KB&lt;br&gt;detect_broken_pconn&nbsp;on&lt;br&gt;fqdncache_size&nbsp;1024&lt;br&gt;refresh_pattern&nbsp;^ftp:   &nbsp;1440   &nbsp;20%   &nbsp;10080&lt;br&gt;refresh_pattern&nbsp;^gopher:   &nbsp;1440   &nbsp;0%   &nbsp;1440&lt;br&gt;refresh_pattern&nbsp;-i&nbsp;(/cgi-bin/|\?)&nbsp;0&nbsp;0%&nbsp;   &nbsp;0&lt;br&gt;refresh_pattern&nbsp;.   &nbsp;   &nbsp;0   &nbsp;20%   &nbsp;4320&lt;br&gt;access_log&nbsp;/var/log/squid3/access.log&lt;br&gt;cache_log&nbsp;/var/log/squid3/cache.log&lt;br&gt;cache_dir&nbsp;aufs&nbsp;/var/spool/squid3&nbsp;600&nbsp;16&nbsp;256&lt;br&gt;&lt;br&gt;auth_param&nbsp;basic&nbsp;program&nbsp;/usr/lib/squid3/basic_ldap_auth&nbsp;-R&nbsp;-b&nbsp;DC=empresa,DC=com,DC=br&nbsp;-D&nbsp;CN=proxy,CN=Users,DC=empresa,DC=com,DC=br&nbsp;-w&nbsp;12345&nbsp;-h&nbsp;192.168.0.25&nbsp;-p&nbsp;389&nbsp;-s&nbsp;sub&nbsp;-v&nbsp;3&nbsp;-f&nbsp;&quot;sAMAccountName=%s&quot;&lt;br&gt;auth_param&nbsp;basic&nbsp;children&nbsp;50&lt;br&gt;auth_param&nbsp;basic&nbsp;realm&nbsp;Proxy&nbsp;Server&nbsp;Squid&lt;br&gt;auth_param&nbsp;basic&nbsp;credentialsttl&nbsp;2&nbsp;hours&lt;br&gt;auth_param&nbsp;basic&nbsp;casesensitive&nbsp;off&lt;br&gt;&lt;br&gt;external_acl_type&nbsp;ad_group&nbsp;%LOGIN&nbsp;/usr/lib/squid3/ext_ldap_group_acl&nbsp;-d&nbsp;-R&nbsp;-b&nbsp;DC=empresa,DC=com,DC=br&nbsp;-D&nbsp;&lt;a&nbsp;href=&quot;mailto:proxy@empresa.com.br&quot;&gt;proxy@empresa.com.br&lt;/a&gt;&nbsp;-w&nbsp;12345&nbsp;-f&nbsp;&quot;(&amp;(objectclass=person)(sAMAccountName=%v)(memberof=cn=%a,DC=empresa,DC=com,DC=br&nbsp;))&quot;&nbsp;-h&nbsp;192.168.0.25&lt;br&gt;&lt;br&gt;visible_hostname&nbsp;&lt;a&nbsp;href=&quot;http://proxy.empresa.com.br&quot;&gt;proxy.empresa.com.br&lt;/a&gt;&lt;br&gt;acl&nbsp;localhost&nbsp;src&nbsp;&lt;a&nbsp;href=&quot;http://192.168.0.1/32&quot;&gt;192.168.0.1/32&lt;/a&gt;&lt;br&gt;acl&nbsp;SSL_ports&nbsp;port&nbsp;22&nbsp;443&nbsp;563&nbsp;&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;21   &nbsp;   &nbsp; &lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;70   &nbsp;   &nbsp; &lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;80&nbsp;   &nbsp;   &nbsp; &lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;88   &nbsp;   &nbsp; &lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;210   &nbsp;   &nbsp;&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;280   &nbsp;   &nbsp; &lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;389&nbsp;   &nbsp;   &nbsp; &lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;443&nbsp;   &nbsp;   &nbsp; &lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;464&nbsp;   &nbsp;   &nbsp;&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;488   &nbsp;   &nbsp; &lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;563   &nbsp;   &nbsp; &lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;591   &nbsp;   &nbsp;&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;777   &nbsp;   &nbsp; &lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;1025-65535   &nbsp;&lt;br&gt;acl&nbsp;purge&nbsp;method&nbsp;PURGE&lt;br&gt;acl&nbsp;CONNECT&nbsp;method&nbsp;CONNECT&lt;br&gt;http_access&nbsp;deny&nbsp;!Safe_ports&lt;br&gt;http_access&nbsp;deny&nbsp;CONNECT&nbsp;!SSL_ports&lt;br&gt;http_access&nbsp;allow&nbsp;manager&nbsp;localhost&lt;br&gt;http_access&nbsp;deny&nbsp;manager&lt;br&gt;http_access&nbsp;allow&nbsp;purge&nbsp;localhost&lt;br&gt;http_access&nbsp;deny&nbsp;purge&lt;br&gt;acl&nbsp;grupo_admins&nbsp;external&nbsp;ad_group&nbsp;webadmins&lt;br&gt;acl&nbsp;grupo_liberado&nbsp;external&nbsp;ad_group&nbsp;webliberados&nbsp;&lt;br&gt;acl&nbsp;grupo_restrito&nbsp;external&nbsp;ad_group&nbsp;domain%20users&lt;br&gt;acl&nbsp;autenticados&nbsp;proxy_auth&nbsp;REQUIRED&lt;br&gt;http_access&nbsp;deny&nbsp;!autenticados&lt;br&gt;http_access&nbsp;allow&nbsp;grupo_admins&lt;br&gt;acl&nbsp;extensoes_bloqueadas&nbsp;url_regex&nbsp;-i&nbsp;&quot;/etc/squid3/acls/extensoes-proibidas&quot;&lt;br&gt;acl&nbsp;sites_liberados&nbsp;url_regex&nbsp;-i&nbsp;&quot;/etc/squid3/acls/sites-permitidos&quot;&lt;br&gt;acl&nbsp;sites_bloqueados&nbsp;url_regex&nbsp;-i&nbsp;&quot;/etc/squid3/acls/sites-proibidos&quot;&lt;br&gt;http_access&nbsp;deny&nbsp;extensoes_bloqueadas&lt;br&gt;http_access&nbsp;allow&nbsp;sites_liberados&lt;br&gt;http_access&nbsp;deny&nbsp;sites_bloqueados&nbsp;&lt;br&gt;http_access&nbsp;allow&nbsp;grupo_liberado&lt;br&gt;redirect_program&nbsp;/usr/bin/squidGuard&lt;br&gt;redirect_children&nbsp;20&lt;br&gt;redirector_bypass&nbsp;on&lt;br&gt;http_access&nbsp;allow&nbsp;grupo_restrito&lt;br&gt;acl&nbsp;lan&nbsp;src&nbsp;&lt;a&nbsp;href=&quot;http://192.168.0.0/22&quot;&gt;192.168.0.0/22&lt;/a&gt;&lt;br&gt;http_access&nbsp;allow&nbsp;lan&lt;br&gt;http_access&nbsp;deny&nbsp;all&lt;br&gt;error_directory&nbsp;/usr/share/squid3/errors/en&lt;br&gt;coredump_dir&nbsp;/var/spool/squid3&lt;br&gt;&lt;br&gt;&lt;/div&gt;Regards,&lt;br&gt;&lt;br&gt;&lt;/div&gt;Márcio&lt;br&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
