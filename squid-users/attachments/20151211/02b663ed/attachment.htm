<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;No&nbsp;suggestions?&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;2015-12-07&nbsp;14:57&nbsp;GMT+01:00&nbsp;Fabio&nbsp;Bucci&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:fabietto82@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;fabietto82@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Thanks&nbsp;Amos.&lt;div&gt;So,&nbsp;what&nbsp;do&nbsp;you&nbsp;suggest?&nbsp;Implement&nbsp;kerberos&nbsp;authetication&nbsp;instead&nbsp;NTLM&nbsp;one?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;have&nbsp;to&nbsp;check&nbsp;if&nbsp;netscaler&nbsp;is&nbsp;able&nbsp;to&nbsp;perform&nbsp;that&nbsp;kind&nbsp;hack&nbsp;you&nbsp;wrote&nbsp;before.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks&nbsp;again,&lt;/div&gt;&lt;div&gt;Fabio&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;2015-12-05&nbsp;7:22&nbsp;GMT+01:00&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&nbsp;target=&quot;_blank&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;span&gt;On&nbsp;5/12/2015&nbsp;5:39&nbsp;a.m.,&nbsp;Fabio&nbsp;Bucci&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;Thanks&nbsp;Amos.&lt;br&gt;<br>
&gt;&nbsp;Actually&nbsp;my&nbsp;load&nbsp;balancing&nbsp;is&nbsp;configured&nbsp;to&nbsp;perform&nbsp;round&nbsp;robin&nbsp;balancing&lt;br&gt;<br>
&gt;&nbsp;between&nbsp;the&nbsp;two&nbsp;nodes.&nbsp;I&nbsp;added&nbsp;a&nbsp;session&nbsp;persistance&nbsp;by&nbsp;source&nbsp;ip&nbsp;in&nbsp;order&lt;br&gt;<br>
&gt;&nbsp;to&nbsp;avoid&nbsp;to&nbsp;login&nbsp;again&nbsp;with&nbsp;some&nbsp;sites.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;my&nbsp;squid.conf&nbsp;is&nbsp;very&nbsp;simple:&lt;br&gt;<br>
&gt;&nbsp;auth_param&nbsp;ntlm&nbsp;program&nbsp;/usr/bin/ntlm_auth&lt;br&gt;<br>
&gt;&nbsp;--helper-protocol=squid-2.5-ntlmssp&lt;br&gt;<br>
&gt;&nbsp;auth_param&nbsp;ntlm&nbsp;children&nbsp;100&lt;br&gt;<br>
&gt;&nbsp;auth_param&nbsp;ntlm&nbsp;keep_alive&nbsp;off&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;auth&nbsp;proxy_auth&nbsp;REQUIRED&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;allow&nbsp;auth&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;Okay.&nbsp;That&nbsp;*should*&nbsp;work.&nbsp;With&nbsp;some&nbsp;NTLM-specific&nbsp;caveats.&lt;br&gt;<br>
&lt;span&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;forwarded_for&nbsp;on&lt;br&gt;<br>
&gt;&nbsp;follow_x_forwarded_for&nbsp;allow&nbsp;netscaler&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;If&nbsp;the&nbsp;LB&nbsp;is&nbsp;touching&nbsp;the&nbsp;traffic&nbsp;enough&nbsp;to&nbsp;add&nbsp;headers&nbsp;then&nbsp;it&nbsp;is&nbsp;a&lt;br&gt;<br>
proxy.&nbsp;NTLM&nbsp;does&nbsp;not&nbsp;work&nbsp;at&nbsp;all&nbsp;well&nbsp;through&nbsp;proxies.&nbsp;NTLM&nbsp;as&nbsp;a&nbsp;whole&lt;br&gt;<br>
is&nbsp;based&nbsp;on&nbsp;the&nbsp;assumption&nbsp;that&nbsp;there&nbsp;is&nbsp;one&nbsp;(and&nbsp;only&nbsp;one)&nbsp;TCP&lt;br&gt;<br>
connection&nbsp;between&nbsp;it&nbsp;and&nbsp;the&nbsp;proxy&nbsp;-&nbsp;the&nbsp;credentials&nbsp;are&nbsp;tied&nbsp;to&nbsp;the&lt;br&gt;<br>
TCP&nbsp;connection&nbsp;state.&lt;br&gt;<br>
&lt;br&gt;<br>
There&nbsp;is&nbsp;one&nbsp;VERY&nbsp;slim&nbsp;hack&nbsp;that&nbsp;lets&nbsp;NTLM&nbsp;pass&nbsp;straight&nbsp;through&nbsp;a&lt;br&gt;<br>
frontend&nbsp;proxy/LB.&nbsp;That&nbsp;is&nbsp;by&nbsp;pinning&nbsp;the&nbsp;LB&#39;s&nbsp;inbound&nbsp;and&nbsp;outbound&nbsp;TCP&lt;br&gt;<br>
connections&nbsp;together.&nbsp;This&nbsp;is&nbsp;not&nbsp;just&nbsp;session&nbsp;persistence,&nbsp;but&nbsp;absolute&lt;br&gt;<br>
prohibition&nbsp;on&nbsp;any&nbsp;other&nbsp;traffic&nbsp;(even&nbsp;from&nbsp;other&nbsp;connections&nbsp;by&nbsp;the&lt;br&gt;<br>
same&nbsp;client)&nbsp;being&nbsp;sent&nbsp;to&nbsp;that&nbsp;outbound&nbsp;LB-&gt;proxy&nbsp;connection.&nbsp;Some&nbsp;LB&lt;br&gt;<br>
can&nbsp;do&nbsp;it,&nbsp;some&nbsp;can&#39;t.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;recommend&nbsp;advertising&nbsp;both/all&nbsp;proxy&nbsp;IPs&nbsp;to&nbsp;the&nbsp;clients&nbsp;and&nbsp;letting&lt;br&gt;<br>
each&nbsp;select&nbsp;the&nbsp;one(s)&nbsp;it&nbsp;wants&nbsp;to&nbsp;contact.&nbsp;That&nbsp;way&nbsp;the&nbsp;client&nbsp;can&lt;br&gt;<br>
perform&nbsp;NTLM&nbsp;directly&nbsp;to&nbsp;the&nbsp;Squid.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;the&nbsp;other&nbsp;hand&nbsp;NTLM&nbsp;was&nbsp;deprecated&nbsp;back&nbsp;in&nbsp;2006,&nbsp;you&nbsp;should&nbsp;try&lt;br&gt;<br>
migrating&nbsp;to&nbsp;Negotiate/Kerberos.&nbsp;Kerberos&nbsp;is&nbsp;a&nbsp;bit&nbsp;of&nbsp;a&nbsp;learning&nbsp;curve&lt;br&gt;<br>
and&nbsp;can&nbsp;be&nbsp;tricky&nbsp;working&nbsp;with&nbsp;older&nbsp;client&nbsp;software.&nbsp;But&nbsp;is&nbsp;*way*&nbsp;more&lt;br&gt;<br>
efficient&nbsp;and&nbsp;friendlier&nbsp;to&nbsp;HTTP&nbsp;(but&nbsp;still&nbsp;not&nbsp;fully).&lt;br&gt;<br>
&lt;div&gt;&lt;div&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
Amos&lt;br&gt;<br>
&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
