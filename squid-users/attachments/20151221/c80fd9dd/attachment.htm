<tt>
&lt;html&gt;<br>
&nbsp;&nbsp;&lt;head&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;http-equiv=&quot;content-type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=UTF-8&quot;&gt;<br>
&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&lt;body&gt;<br>
Hello,&nbsp;&lt;div&gt;&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;I'm&nbsp;having&nbsp;a&nbsp;hard&nbsp;time&nbsp;trying&nbsp;to&nbsp;use&nbsp;ECDH&nbsp;support&nbsp;in&nbsp;Squid&nbsp;and&nbsp;I&nbsp;tried&nbsp;a&nbsp;few&nbsp;different&nbsp;releases&nbsp;since&nbsp;v.&nbsp;4&nbsp;is&nbsp;out.&nbsp;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;line-height:&nbsp;1.5&quot;&gt;Squid&nbsp;version:&lt;/span&gt;&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;Squid&nbsp;Cache:&nbsp;Version&nbsp;4.0.3-20151216-r14446&lt;/div&gt;&lt;div&gt;Service&nbsp;Name:&nbsp;squid&lt;/div&gt;&lt;div&gt;configure&nbsp;options:&nbsp;&nbsp;'--with-openssl'&nbsp;'--enable-basic-auth-helpers=squid_radius_auth'&nbsp;'--enable-auth'&nbsp;--enable-ltdl-convenience&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;OpenSSL&nbsp;is&nbsp;1.0.1q&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;Relevant&nbsp;https_port&nbsp;settings&nbsp;line&nbsp;in&nbsp;my&nbsp;squid.conf:&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;https_port&nbsp;443&nbsp;cert=/root/ssl/squid.crt&nbsp;key=/root/ssl/squid.key&nbsp;tls-cafile=/root/ssl/ca.crt&nbsp;cipher=ECDH+AESGCM:DH+AESGCM:ECDH+AES:DH+AES:DH+AES:RSA+AESGCM:RSA+AES:!aNULL:!MD5:!DSS&nbsp;tls-dh=secp384r1:/usr/local/squid/etc/dhparam.pem&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;When&nbsp;I&nbsp;try&nbsp;to&nbsp;run&nbsp;it,&nbsp;I&nbsp;get&nbsp;the&nbsp;following&nbsp;error:&nbsp;&lt;/div&gt;&lt;div&gt;&lt;div&gt;2015/12/21&nbsp;09:01:05|&nbsp;ERROR:&nbsp;Unable&nbsp;to&nbsp;set&nbsp;Ephemeral&nbsp;ECDH:&nbsp;error:00000000:lib(0):func(0):reason(0)&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;Full&nbsp;https_port&nbsp;part&nbsp;from&nbsp;the&nbsp;debug&nbsp;when&nbsp;rynning&nbsp;squid&nbsp;-X:&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;2015/12/21&nbsp;09:02:24.000|&nbsp;Initializing&nbsp;https_port&nbsp;[::]:443&nbsp;TLS&nbsp;context&lt;/div&gt;&lt;div&gt;2015/12/21&nbsp;09:02:24.001|&nbsp;24,7|&nbsp;SBuf.cc(180)&nbsp;rawSpace:&nbsp;reserving&nbsp;1&nbsp;for&nbsp;SBuf135&lt;/div&gt;&lt;div&gt;2015/12/21&nbsp;09:02:24.001|&nbsp;24,7|&nbsp;SBuf.cc(187)&nbsp;rawSpace:&nbsp;SBuf135&nbsp;not&nbsp;growing&lt;/div&gt;&lt;div&gt;2015/12/21&nbsp;09:02:24.001|&nbsp;24,7|&nbsp;SBuf.cc(180)&nbsp;rawSpace:&nbsp;reserving&nbsp;1&nbsp;for&nbsp;SBuf134&lt;/div&gt;&lt;div&gt;2015/12/21&nbsp;09:02:24.001|&nbsp;24,7|&nbsp;SBuf.cc(187)&nbsp;rawSpace:&nbsp;SBuf134&nbsp;not&nbsp;growing&lt;/div&gt;&lt;div&gt;2015/12/21&nbsp;09:02:24.001|&nbsp;Using&nbsp;certificate&nbsp;in&nbsp;/root/ssl/squid.crt&lt;/div&gt;&lt;div&gt;2015/12/21&nbsp;09:02:24.027|&nbsp;83,5|&nbsp;support.cc(512)&nbsp;configureSslContext:&nbsp;Using&nbsp;chiper&nbsp;suite&nbsp;ECDH+AESGCM:DH+AESGCM:ECDH+AES:DH+AES:DH+AES:RSA+AESGCM:RSA+AES:!aNULL:!MD5:!DSS.&lt;/div&gt;&lt;div&gt;2015/12/21&nbsp;09:02:24.027|&nbsp;24,7|&nbsp;SBuf.cc(180)&nbsp;rawSpace:&nbsp;reserving&nbsp;1&nbsp;for&nbsp;SBuf124&lt;/div&gt;&lt;div&gt;2015/12/21&nbsp;09:02:24.027|&nbsp;24,7|&nbsp;SBuf.cc(187)&nbsp;rawSpace:&nbsp;SBuf124&nbsp;not&nbsp;growing&lt;/div&gt;&lt;div&gt;2015/12/21&nbsp;09:02:24.027|&nbsp;83,9|&nbsp;support.cc(521)&nbsp;configureSslContext:&nbsp;Setting&nbsp;RSA&nbsp;key&nbsp;generation&nbsp;callback.&lt;/div&gt;&lt;div&gt;2015/12/21&nbsp;09:02:24.027|&nbsp;83,9|&nbsp;ServerOptions.cc(164)&nbsp;updateContextEecdh:&nbsp;Setting&nbsp;Ephemeral&nbsp;ECDH&nbsp;curve&nbsp;to&nbsp;secp384r1.&lt;/div&gt;&lt;div&gt;2015/12/21&nbsp;09:02:24.027|&nbsp;24,7|&nbsp;SBuf.cc(180)&nbsp;rawSpace:&nbsp;reserving&nbsp;1&nbsp;for&nbsp;SBuf130&lt;/div&gt;&lt;div&gt;2015/12/21&nbsp;09:02:24.027|&nbsp;24,8|&nbsp;SBuf.cc(1000)&nbsp;cow:&nbsp;SBuf130&nbsp;new&nbsp;size:10&lt;/div&gt;&lt;div&gt;2015/12/21&nbsp;09:02:24.027|&nbsp;24,8|&nbsp;SBuf.cc(970)&nbsp;reAlloc:&nbsp;SBuf130&nbsp;new&nbsp;size:&nbsp;10&lt;/div&gt;&lt;div&gt;2015/12/21&nbsp;09:02:24.027|&nbsp;24,9|&nbsp;MemBlob.cc(56)&nbsp;MemBlob:&nbsp;constructed,&nbsp;this=0x1f94670&nbsp;id=blob125&nbsp;reserveSize=10&lt;/div&gt;&lt;div&gt;2015/12/21&nbsp;09:02:24.027|&nbsp;24,8|&nbsp;MemBlob.cc(101)&nbsp;memAlloc:&nbsp;blob125&nbsp;memAlloc:&nbsp;requested=10,&nbsp;received=40&lt;/div&gt;&lt;div&gt;2015/12/21&nbsp;09:02:24.027|&nbsp;24,7|&nbsp;SBuf.cc(979)&nbsp;reAlloc:&nbsp;SBuf130&nbsp;new&nbsp;store&nbsp;capacity:&nbsp;40&lt;/div&gt;&lt;div&gt;2015/12/21&nbsp;09:02:24.027|&nbsp;ERROR:&nbsp;Unable&nbsp;to&nbsp;set&nbsp;Ephemeral&nbsp;ECDH:&nbsp;error:00000000:lib(0):func(0):reason(0)&lt;/div&gt;&lt;div&gt;2015/12/21&nbsp;09:02:24.034|&nbsp;83,8|&nbsp;PeerOptions.cc(534)&nbsp;updateContextCa:&nbsp;Setting&nbsp;CA&nbsp;certificate&nbsp;locations.&lt;/div&gt;&lt;div&gt;2015/12/21&nbsp;09:02:24.034|&nbsp;24,8|&nbsp;SBuf.cc(89)&nbsp;SBuf:&nbsp;SBuf149&nbsp;created&nbsp;from&nbsp;id&nbsp;SBuf138&lt;/div&gt;&lt;div&gt;2015/12/21&nbsp;09:02:24.034|&nbsp;24,7|&nbsp;SBuf.cc(180)&nbsp;rawSpace:&nbsp;reserving&nbsp;1&nbsp;for&nbsp;SBuf122&lt;/div&gt;&lt;div&gt;2015/12/21&nbsp;09:02:24.034|&nbsp;24,8|&nbsp;SBuf.cc(1000)&nbsp;cow:&nbsp;SBuf122&nbsp;new&nbsp;size:1&lt;/div&gt;&lt;div&gt;2015/12/21&nbsp;09:02:24.034|&nbsp;24,8|&nbsp;SBuf.cc(970)&nbsp;reAlloc:&nbsp;SBuf122&nbsp;new&nbsp;size:&nbsp;1&lt;/div&gt;&lt;div&gt;2015/12/21&nbsp;09:02:24.034|&nbsp;24,9|&nbsp;MemBlob.cc(56)&nbsp;MemBlob:&nbsp;constructed,&nbsp;this=0x1f96070&nbsp;id=blob126&nbsp;reserveSize=1&lt;/div&gt;&lt;div&gt;2015/12/21&nbsp;09:02:24.034|&nbsp;24,8|&nbsp;MemBlob.cc(101)&nbsp;memAlloc:&nbsp;blob126&nbsp;memAlloc:&nbsp;requested=1,&nbsp;received=40&lt;/div&gt;&lt;div&gt;2015/12/21&nbsp;09:02:24.034|&nbsp;24,7|&nbsp;SBuf.cc(979)&nbsp;reAlloc:&nbsp;SBuf122&nbsp;new&nbsp;store&nbsp;capacity:&nbsp;40&lt;/div&gt;&lt;div&gt;2015/12/21&nbsp;09:02:24.034|&nbsp;24,7|&nbsp;SBuf.cc(180)&nbsp;rawSpace:&nbsp;reserving&nbsp;1&nbsp;for&nbsp;SBuf149&lt;/div&gt;&lt;div&gt;2015/12/21&nbsp;09:02:24.034|&nbsp;24,7|&nbsp;SBuf.cc(187)&nbsp;rawSpace:&nbsp;SBuf149&nbsp;not&nbsp;growing&lt;/div&gt;&lt;div&gt;2015/12/21&nbsp;09:02:24.034|&nbsp;WARNING:&nbsp;Ignoring&nbsp;error&nbsp;setting&nbsp;CA&nbsp;certificate&nbsp;locations:&nbsp;error:0B064071:x509&nbsp;certificate&nbsp;routines:ADD_CERT_DIR:invalid&nbsp;directory&lt;/div&gt;&lt;div&gt;2015/12/21&nbsp;09:02:24.035|&nbsp;24,8|&nbsp;SBuf.cc(135)&nbsp;~SBuf:&nbsp;SBuf149&nbsp;destructed&lt;/div&gt;&lt;div&gt;2015/12/21&nbsp;09:02:24.035|&nbsp;83,9|&nbsp;support.cc(548)&nbsp;configureSslContext:&nbsp;Not&nbsp;requiring&nbsp;any&nbsp;client&nbsp;certificates&lt;/div&gt;&lt;div&gt;2015/12/21&nbsp;09:02:24.035|&nbsp;21,3|&nbsp;tools.cc(499)&nbsp;leave_suid:&nbsp;leave_suid:&nbsp;PID&nbsp;13102&nbsp;called&lt;/div&gt;&lt;div&gt;2015/12/21&nbsp;09:02:24.035|&nbsp;21,3|&nbsp;tools.cc(521)&nbsp;leave_suid:&nbsp;leave_suid:&nbsp;PID&nbsp;13102&nbsp;giving&nbsp;up&nbsp;root,&nbsp;becoming&nbsp;'nobody'&lt;/div&gt;&lt;div&gt;2015/12/21&nbsp;09:02:24.035|&nbsp;0,9|&nbsp;debug.cc(403)&nbsp;parseOptions:&nbsp;command-line&nbsp;-X&nbsp;overrides:&nbsp;ALL,1&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;Is&nbsp;there&nbsp;anybody&nbsp;running&nbsp;it&nbsp;successfully&nbsp;with&nbsp;ECDH&nbsp;support&nbsp;willing&nbsp;to&nbsp;share&nbsp;some&nbsp;insights&nbsp;and&nbsp;a&nbsp;config&nbsp;sample?&nbsp;&lt;/div&gt;&lt;div&gt;Thanks&nbsp;in&nbsp;advance.&nbsp;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;/&gt;&lt;/div&gt;&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
