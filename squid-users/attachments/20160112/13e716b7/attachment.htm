<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;I&nbsp;recently&nbsp;upgraded&nbsp;to&nbsp;Squid&nbsp;v3.5.13&nbsp;and&nbsp;am&nbsp;encountering&nbsp;at&nbsp;least&nbsp;two&nbsp;errors&nbsp;when&nbsp;processing&nbsp;certain&nbsp;HTTPS&nbsp;connections. &nbsp;I&nbsp;am&nbsp;not&nbsp;sure&nbsp;if&nbsp;it&nbsp;is&nbsp;a&nbsp;bug&nbsp;or&nbsp;a&nbsp;configuration&nbsp;error&nbsp;on&nbsp;my&nbsp;part.&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;first&nbsp;error&nbsp;I&nbsp;am&nbsp;seeing&nbsp;is&nbsp;when&nbsp;&lt;a&nbsp;href=&quot;http://shutterfly.com&quot;&gt;shutterfly.com&lt;/a&gt;&nbsp;is&nbsp;accessed&nbsp;by&nbsp;a&nbsp;user. &nbsp;The&nbsp;issue&nbsp;occurs&nbsp;regardless&nbsp;of&nbsp;whether&nbsp;I&nbsp;splice&nbsp;or&nbsp;bump&nbsp;the&nbsp;site. &nbsp;A&nbsp;user&nbsp;can&nbsp;browse&nbsp;to&nbsp;the&nbsp;page,&nbsp;but&nbsp;if&nbsp;they&nbsp;click&nbsp;on&nbsp;anything&nbsp;on&nbsp;the&nbsp;site,&nbsp;squid&nbsp;encounters&nbsp;a&nbsp;fault. &nbsp;The&nbsp;system&nbsp;does&nbsp;not&nbsp;crash;&nbsp;it&nbsp;recovers,&nbsp;but&nbsp;the&nbsp;proxy&nbsp;is&nbsp;down&nbsp;for&nbsp;about&nbsp;30&nbsp;seconds. &nbsp;Note&nbsp;that&nbsp;this&nbsp;occurs&nbsp;in&nbsp;regular&nbsp;forward&nbsp;proxy&nbsp;mode,&nbsp;not&nbsp;intercept&nbsp;mode.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;My&nbsp;knowledge&nbsp;of&nbsp;SSL&nbsp;is&nbsp;somewhat&nbsp;limited,&nbsp;so&nbsp;I&nbsp;am&nbsp;not&nbsp;sure&nbsp;if&nbsp;I&nbsp;have&nbsp;misconfigured&nbsp;things&nbsp;in&nbsp;a&nbsp;way&nbsp;that&nbsp;creates&nbsp;the&nbsp;problem. &nbsp;Two&nbsp;questions&nbsp;I&nbsp;have&nbsp;are&nbsp;(a)&nbsp;to&nbsp;apply&nbsp;ECDH&nbsp;properly,&nbsp;must&nbsp;an&nbsp;optional&nbsp;cipher&nbsp;be&nbsp;chosen&nbsp;for&nbsp;the&nbsp;tls-dh&nbsp;option?&nbsp;and&nbsp;(b)&nbsp;to&nbsp;properly&nbsp;apply&nbsp;ECDH,&nbsp;do&nbsp;I&nbsp;have&nbsp;to&nbsp;recreate&nbsp;the&nbsp;dhparam&nbsp;file&nbsp;using&nbsp;an&nbsp;ECDH&nbsp;cipher&nbsp;(I&#39;m&nbsp;currently&nbsp;using&nbsp;the&nbsp;dhparam&nbsp;file&nbsp;that&nbsp;I&nbsp;previously&nbsp;had)?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Separate&nbsp;from&nbsp;the&nbsp;above&nbsp;(or&nbsp;perhaps&nbsp;related),&nbsp;the&nbsp;second&nbsp;issue&nbsp;I&nbsp;am&nbsp;also&nbsp;seeing&nbsp;are&nbsp;odd&nbsp;errors&nbsp;in&nbsp;the&nbsp;cache.log&nbsp;that&nbsp;are&nbsp;causing&nbsp;squid&nbsp;to&nbsp;fault&nbsp;and&nbsp;recover. &nbsp;I&nbsp;am&nbsp;not&nbsp;yet&nbsp;sure&nbsp;which&nbsp;sites&nbsp;are&nbsp;causing&nbsp;the&nbsp;issue,&nbsp;but&nbsp;I&nbsp;am&nbsp;seeing&nbsp;the&nbsp;following&nbsp;error:&nbsp;FATAL:&nbsp;dying&nbsp;from&nbsp;an&nbsp;unhandled&nbsp;exception:&nbsp;!theConsumer. &nbsp;This&nbsp;error&nbsp;seems&nbsp;to&nbsp;be&nbsp;consistently&nbsp;preceded&nbsp;by&nbsp;&quot;Error&nbsp;negotiating&nbsp;SSL&nbsp;on&nbsp;FD&nbsp;25:&nbsp;error:14077102:SSL&nbsp;routines:SSL23_GET_SERVER_HELLO:unsupported&nbsp;protocol&nbsp;(1/-1/0)&quot;.&lt;/div&gt;<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;The&nbsp;prior&nbsp;version&nbsp;I&nbsp;was&nbsp;running&nbsp;was&nbsp;v3.5.12&nbsp;and&nbsp;I&nbsp;know&nbsp;that&nbsp;version&nbsp;had&nbsp;no&nbsp;problems&nbsp;when&nbsp;accessing&nbsp;&lt;a&nbsp;href=&quot;http://shutterfly.com&quot;&gt;shutterfly.com&lt;/a&gt;&nbsp;nor&nbsp;the&nbsp;odd&nbsp;FATAL&nbsp;message&nbsp;I&nbsp;am&nbsp;seeing&nbsp;with&nbsp;the&nbsp;below&nbsp;configuration.&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Following&nbsp;is&nbsp;more&nbsp;detailed&nbsp;info&nbsp;for&nbsp;the&nbsp;first&nbsp;problem&nbsp;I&nbsp;am&nbsp;encountering&nbsp;above&nbsp;with&nbsp;&lt;a&nbsp;href=&quot;http://shutterfly.com&quot;&gt;shutterfly.com&lt;/a&gt;. &nbsp;Please&nbsp;let&nbsp;me&nbsp;know&nbsp;additional&nbsp;information&nbsp;is&nbsp;needed.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Cache.log&nbsp;extracts&nbsp;when&nbsp;accessing&nbsp;&lt;a&nbsp;href=&quot;http://shutterfly.com&quot;&gt;shutterfly.com&lt;/a&gt;:&lt;/div&gt;&lt;div&gt;--------------------------------------------------------------------&lt;/div&gt;<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
&lt;p&nbsp;class=&quot;&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;2016/01/12&nbsp;22:39:59&nbsp;kid1|&nbsp;Error&nbsp;negotiating&nbsp;SSL&nbsp;on&nbsp;FD&nbsp;91:&nbsp;error:14077102:SSL&nbsp;routines:SSL23_GET_SERVER_HELLO:unsupported&nbsp;protocol&nbsp;(1/-1/0)&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;2016/01/12&nbsp;22:39:59&nbsp;kid1|&nbsp;Error&nbsp;negotiating&nbsp;SSL&nbsp;on&nbsp;FD&nbsp;98:&nbsp;error:14077102:SSL&nbsp;routines:SSL23_GET_SERVER_HELLO:unsupported&nbsp;protocol&nbsp;(1/-1/0)&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;2016/01/12&nbsp;22:39:59&nbsp;kid1|&nbsp;Error&nbsp;negotiating&nbsp;SSL&nbsp;on&nbsp;FD&nbsp;89:&nbsp;error:14077102:SSL&nbsp;routines:SSL23_GET_SERVER_HELLO:unsupported&nbsp;protocol&nbsp;(1/-1/0)&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;2016/01/12&nbsp;22:40:02&nbsp;kid1|&nbsp;Error&nbsp;negotiating&nbsp;SSL&nbsp;on&nbsp;FD&nbsp;62:&nbsp;error:14090086:SSL&nbsp;routines:SSL3_GET_SERVER_CERTIFICATE:certificate&nbsp;verify&nbsp;failed&nbsp;(1/-1/0)&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;2016/01/12&nbsp;22:40:02&nbsp;kid1|&nbsp;Error&nbsp;negotiating&nbsp;SSL&nbsp;on&nbsp;FD&nbsp;63:&nbsp;error:14090086:SSL&nbsp;routines:SSL3_GET_SERVER_CERTIFICATE:certificate&nbsp;verify&nbsp;failed&nbsp;(1/-1/0)&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;2016/01/12&nbsp;22:40:03&nbsp;kid1|&nbsp;Error&nbsp;negotiating&nbsp;SSL&nbsp;on&nbsp;FD&nbsp;56:&nbsp;error:14077102:SSL&nbsp;routines:SSL23_GET_SERVER_HELLO:unsupported&nbsp;protocol&nbsp;(1/-1/0)&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;2016/01/12&nbsp;22:40:03&nbsp;kid1|&nbsp;Error&nbsp;negotiating&nbsp;SSL&nbsp;on&nbsp;FD&nbsp;56:&nbsp;error:14077102:SSL&nbsp;routines:SSL23_GET_SERVER_HELLO:unsupported&nbsp;protocol&nbsp;(1/-1/0)&lt;/span&gt;&lt;/p&gt;<br>
&lt;div&gt;2016/01/12&nbsp;22:40:03&nbsp;kid1|&nbsp;Error&nbsp;negotiating&nbsp;SSL&nbsp;on&nbsp;FD&nbsp;58:&nbsp;error:14077102:SSL&nbsp;routines:SSL23_GET_SERVER_HELLO:unsupported&nbsp;protocol&nbsp;(1/-1/0)&nbsp; &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Extracts&nbsp;from&nbsp;my&nbsp;squid.conf&nbsp;file:&lt;/div&gt;&lt;div&gt;----------------------------------------------&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;http_port&nbsp;&lt;a&nbsp;href=&quot;http://127.0.0.1:3128&quot;&gt;127.0.0.1:3128&lt;/a&gt;&lt;br&gt;&lt;br&gt;http_port&nbsp;&lt;a&nbsp;href=&quot;http://192.168.10.1:3128&quot;&gt;192.168.10.1:3128&lt;/a&gt;&nbsp;ssl-bump&nbsp;generate-host-certificates=on&nbsp;dynamic_cert_mem_cache_size=4MB&nbsp;cert=cert.pem&nbsp;tls-dh=cert.dhparam.pem&lt;br&gt;&lt;br&gt;http_port&nbsp;&lt;a&nbsp;href=&quot;http://192.168.10.1:3129&quot;&gt;192.168.10.1:3129&lt;/a&gt;&nbsp;intercept&nbsp; disable-pmtu-discovery=transparent&nbsp;name=http_icept&lt;br&gt;&lt;br&gt;https_port&nbsp;&lt;a&nbsp;href=&quot;http://192.168.10.1:3130&quot;&gt;192.168.10.1:3130&lt;/a&gt;&nbsp;intercept&nbsp; disable-pmtu-discovery=transparent&nbsp;ssl-bump&nbsp;generate-host-certificates=on&nbsp;dynamic_cert_mem_cache_size=4MB&nbsp;cert=cert.pem&nbsp;tls-dh=cert.dhparam.pem&nbsp;name=https_icept&lt;br&gt;&lt;br&gt;sslcrtd_program&nbsp;/usr/lib/squid/ssl_crtd&nbsp;-s&nbsp;/disk/dyn-certs/sslcrtd_db&nbsp;-M&nbsp;4MB&lt;br&gt;&lt;br&gt;...&lt;br&gt;&lt;br&gt;ssl_bump&nbsp;peek&nbsp;SSL_Step1&nbsp;!dont_peek_or_stare&nbsp;mynet&lt;br&gt;&lt;br&gt;ssl_bump&nbsp;splice&nbsp;dont_bump_me&nbsp;mynet&lt;br&gt;&lt;br&gt;ssl_bump&nbsp;bump&nbsp;mynet&lt;br&gt;&lt;br&gt;ssl_bump&nbsp;terminate&nbsp;all&lt;br&gt;&lt;br&gt;&lt;br&gt;#&nbsp;Various&nbsp;SSL&nbsp;Proxy&nbsp;Config&nbsp;Stuff&lt;br&gt;&lt;br&gt;sslproxy_cert_error&nbsp;allow&nbsp;broken_certs&lt;br&gt;&lt;br&gt;sslproxy_cert_error&nbsp;deny&nbsp;all&lt;br&gt;&lt;br&gt;sslproxy_cert_sign_hash&nbsp;sha256&lt;br&gt;&lt;br&gt;sslproxy_capath&nbsp;/etc/ssl/certs/&lt;br&gt;&lt;br&gt;sslproxy_foreign_intermediate_certs&nbsp;/etc/ssl/certs/&lt;br&gt;&lt;br&gt;sslproxy_options&nbsp;No_Compression,NO_TLSv1,NO_SSLv2,NO_SSLv3,SINGLE_DH_USE,CIPHER_SERVER_PREFERENCE&lt;br&gt;&lt;br&gt;sslproxy_cipher&nbsp;EECDH+ECDSA+AESGCM:EECDH+aRSA+AESGCM:EECDH+ECDSA+SHA384:EECDH+ECDSA+SHA256:EECDH+aRSA+SHA384:EECDH+aRSA+SHA256:EECDH+aRSA+RC4:EECDH:EDH+aRSA:HIGH:!RC4:!aNULL:!eNULL:!LOW:!3DES:!MD5:!EXP:!PSK:!SRP:!DSS&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;------------------------&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;Dave&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_signature&quot;&gt;___________________________________________________________&lt;br&gt;Dave&nbsp;Marcos&lt;br&gt;&lt;/div&gt;<br>
&lt;/div&gt;&lt;/div&gt;<br>

</tt>
