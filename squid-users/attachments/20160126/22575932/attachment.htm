<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;Hello,&lt;/span&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;I&nbsp;attempting&nbsp;to&nbsp;terminate&nbsp;https&nbsp;traffic&nbsp;based&nbsp;on&nbsp;ACLs&nbsp;using&nbsp;ssl_bumping&nbsp;WITHOUT&nbsp;de-crypting&nbsp;the&nbsp;traffic&nbsp;in&nbsp;intercept/transparent&nbsp;mode. &nbsp;Has&nbsp;anyone&nbsp;got&nbsp;this&nbsp;to&nbsp;work&nbsp;before?&nbsp;I&nbsp;have&nbsp;copied&nbsp;my&nbsp;configuration&nbsp;and&nbsp;what&nbsp;my&nbsp;iptables&nbsp;nat&nbsp;rules&nbsp;look&nbsp;like. &lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt; I&nbsp;am&nbsp;using&nbsp;squid&nbsp;3.5.13&nbsp;with&nbsp;the&nbsp;following&nbsp;compile&nbsp;options:&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px&quot;&gt;&lt;span&nbsp;name=&quot;searchHitInReadingPane&quot;&nbsp;style=&quot;background-color:rgb(255,238,148)&quot;&gt;Squid&lt;/span&gt; Cache:&nbsp;Version&nbsp;3.5.12&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px&quot;&gt;Service&nbsp;Name: &lt;span&nbsp;name=&quot;searchHitInReadingPane&quot;&nbsp;style=&quot;background-color:rgb(255,238,148)&quot;&gt;squid&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0);font-family:Calibri,Arial,Helvetica,sans-serif;font-size:16px&quot;&gt;configure&nbsp;options:&nbsp; &#39;--prefix=/usr&#39;&nbsp;&#39;--localstatedir=/var&#39;&nbsp;&#39;--libexecdir=/lib/&lt;span&nbsp;name=&quot;searchHitInReadingPane&quot;&nbsp;style=&quot;background-color:rgb(255,238,148)&quot;&gt;squid&lt;/span&gt;3&#39;&nbsp;&#39;--datadir=/share/&lt;span&nbsp;name=&quot;searchHitInReadingPane&quot;&nbsp;style=&quot;background-color:rgb(255,238,148)&quot;&gt;squid&lt;/span&gt;3&#39;&nbsp;&#39;--sysconfdir=/etc/&lt;span&nbsp;name=&quot;searchHitInReadingPane&quot;&nbsp;style=&quot;background-color:rgb(255,238,148)&quot;&gt;squid&lt;/span&gt;3&#39;&nbsp;&#39;--with-default-user=proxy&#39;&nbsp;&#39;--with-logdir=/var/log/&lt;span&nbsp;name=&quot;searchHitInReadingPane&quot;&nbsp;style=&quot;background-color:rgb(255,238,148)&quot;&gt;squid&lt;/span&gt;3&#39;&nbsp;&#39;--with-pidfile=/var/run/&lt;span&nbsp;name=&quot;searchHitInReadingPane&quot;&nbsp;style=&quot;background-color:rgb(255,238,148)&quot;&gt;squid&lt;/span&gt;3.pid&#39;&nbsp;&#39;--with-openssl&#39;&nbsp;&#39;-enable-ssl-crtd&#39;&nbsp;&#39;--enable-icap-client&#39;&nbsp;&#39;--with-large-files&#39;&nbsp;--enable-ltdl-convenience&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;squid.conf:&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;div&gt;acl&nbsp;social&nbsp;dstdomain&nbsp;.&lt;a&nbsp;href=&quot;http://google.com/&quot;&nbsp;target=&quot;_blank&quot;&gt;google.com&lt;/a&gt; .&lt;a&nbsp;href=&quot;http://facebook.com/&quot;&nbsp;target=&quot;_blank&quot;&gt;facebook.com&lt;/a&gt; .&lt;a&nbsp;href=&quot;http://reddit.com/&quot;&nbsp;target=&quot;_blank&quot;&gt;reddit.com&lt;/a&gt;&lt;/div&gt;&lt;div&gt;acl&nbsp;step1&nbsp;at_step&nbsp;SslBump1&lt;/div&gt;&lt;div&gt;acl&nbsp;step2&nbsp;at_step&nbsp;SslBump2&lt;/div&gt;&lt;div&gt;ssl_bump&nbsp;stare&nbsp;step2&nbsp;all&lt;/div&gt;&lt;div&gt;ssl_bump&nbsp;terminate&nbsp;social&lt;/div&gt;&lt;div&gt;acl&nbsp;localnet&nbsp;src &lt;a&nbsp;href=&quot;http://192.168.50.0/24&quot;&nbsp;target=&quot;_blank&quot;&gt;192.168.50.0/24&lt;/a&gt;&lt;/div&gt;&lt;div&gt;acl&nbsp;SSL_ports&nbsp;port&nbsp;443&lt;/div&gt;&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;80&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;#&nbsp;http&lt;/div&gt;&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;21&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;#&nbsp;ftp&lt;/div&gt;&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;443&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;#&nbsp;https&lt;/div&gt;&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;70&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;#&nbsp;gopher&lt;/div&gt;&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;210&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;#&nbsp;wais&lt;/div&gt;&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;1025-65535&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;#&nbsp;unregistered&nbsp;ports&lt;/div&gt;&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;280&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;#&nbsp;http-mgmt&lt;/div&gt;&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;488&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;#&nbsp;gss-http&lt;/div&gt;&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;591&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;#&nbsp;filemaker&lt;/div&gt;&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;777&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;#&nbsp;multiling&nbsp;http&lt;/div&gt;&lt;div&gt;acl&nbsp;CONNECT&nbsp;method&nbsp;CONNECT&lt;/div&gt;&lt;div&gt;http_access&nbsp;allow&nbsp;manager&nbsp;localhost&lt;/div&gt;&lt;div&gt;http_access&nbsp;deny&nbsp;manager&lt;/div&gt;&lt;div&gt;http_access&nbsp;deny&nbsp;!Safe_ports&lt;/div&gt;&lt;div&gt;http_access&nbsp;deny&nbsp;CONNECT&nbsp;!SSL_ports&lt;/div&gt;&lt;div&gt;http_access&nbsp;allow&nbsp;localnet&lt;/div&gt;&lt;div&gt;http_access&nbsp;allow&nbsp;localhost&lt;/div&gt;&lt;div&gt;http_access&nbsp;allow&nbsp;all&lt;/div&gt;&lt;div&gt;http_port&nbsp;3128&nbsp;transparent&lt;/div&gt;&lt;div&gt;https_port&nbsp;3129&nbsp;intercept&nbsp;ssl-bump&nbsp;cert=/etc/squid3/ssl_cert/squidSSL.pem&lt;/div&gt;&lt;div&gt;cache_dir&nbsp;ufs&nbsp;/cache/squid3/spool&nbsp;100&nbsp;16&nbsp;256&lt;/div&gt;&lt;div&gt;access_log&nbsp;syslog:&lt;a&nbsp;href=&quot;http://local5.info/&quot;&nbsp;target=&quot;_blank&quot;&gt;local5.info&lt;/a&gt; squid&lt;/div&gt;&lt;div&gt;coredump_dir&nbsp;/var/spool/squid3&lt;/div&gt;&lt;div&gt;url_rewrite_program&nbsp;/usr/bin/squidGuard&nbsp;-c&nbsp;/cache/config/daemons/squidguard/squidGuard.conf&lt;/div&gt;&lt;div&gt;url_rewrite_children&nbsp;15&lt;/div&gt;&lt;div&gt;url_rewrite_access&nbsp;allow&nbsp;all&lt;/div&gt;&lt;div&gt;refresh_pattern&nbsp;^ftp:&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;1440&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;20%&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;10080&lt;/div&gt;&lt;div&gt;refresh_pattern&nbsp;^gopher:&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;1440&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;0%&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;1440&lt;/div&gt;&lt;div&gt;refresh_pattern&nbsp;-i&nbsp;(/cgi-bin/|\?)&nbsp;0&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&lt;/span&gt;0%&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;refresh_pattern&nbsp;.&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;0&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;20%&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;4320&lt;/div&gt;&lt;div&gt;icap_enable&nbsp;on&lt;/div&gt;&lt;div&gt;icap_send_client_ip&nbsp;on&lt;/div&gt;&lt;div&gt;icap_send_client_username&nbsp;on&lt;/div&gt;&lt;div&gt;icap_client_username_encode&nbsp;off&lt;/div&gt;&lt;div&gt;icap_client_username_header&nbsp;X-Authenticated-User&lt;/div&gt;&lt;div&gt;icap_preview_enable&nbsp;on&lt;/div&gt;&lt;div&gt;icap_preview_size&nbsp;1024&lt;/div&gt;&lt;div&gt;icap_service&nbsp;service_req&nbsp;reqmod_precache&nbsp;bypass=1&nbsp;icap://&lt;a&nbsp;href=&quot;http://127.0.0.1:1344/squidclamav&quot;&nbsp;target=&quot;_blank&quot;&gt;127.0.0.1:1344/squidclamav&lt;/a&gt;&lt;/div&gt;&lt;div&gt;adaptation_access&nbsp;service_req&nbsp;allow&nbsp;all&lt;/div&gt;&lt;div&gt;icap_service&nbsp;service_resp&nbsp;respmod_precache&nbsp;bypass=1&nbsp;icap://&lt;a&nbsp;href=&quot;http://127.0.0.1:1344/squidclamav&quot;&nbsp;target=&quot;_blank&quot;&gt;127.0.0.1:1344/squidclamav&lt;/a&gt;&lt;/div&gt;&lt;div&gt;adaptation_access&nbsp;service_resp&nbsp;allow&nbsp;all&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;iptables&nbsp;-L&nbsp;-v&nbsp;-t&nbsp;nat(only&nbsp;relevant&nbsp;rules):&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;div&gt;Chain&nbsp;PREROUTING&nbsp;(policy&nbsp;ACCEPT&nbsp;1083&nbsp;packets,&nbsp;233K&nbsp;bytes)&lt;/div&gt;&lt;div&gt; pkts&nbsp;bytes&nbsp;target&nbsp; &nbsp; &nbsp;prot&nbsp;opt&nbsp;in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &lt;/div&gt;&lt;div&gt; &nbsp;157&nbsp; 9420&nbsp;DNAT&nbsp; &nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; eth1&nbsp; &nbsp;any&nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tcp&nbsp;dpt:https&nbsp;to:&lt;a&nbsp;href=&quot;http://192.168.11.1:3129/&quot;&nbsp;target=&quot;_blank&quot;&gt;192.168.11.1:3129&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Chain&nbsp;PREROUTING-daemon-tcp&nbsp;(1&nbsp;references)&lt;/div&gt;&lt;div&gt; pkts&nbsp;bytes&nbsp;target&nbsp; &nbsp; &nbsp;prot&nbsp;opt&nbsp;in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp;  &lt;/div&gt;&lt;div&gt; &nbsp;443&nbsp;26580&nbsp;DNAT&nbsp; &nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; eth1&nbsp; &nbsp;any&nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tcp&nbsp;dpt:http&nbsp;/*&nbsp;7:PFD::CF-3128&nbsp;*/&nbsp;to:&lt;a&nbsp;href=&quot;http://192.168.11.1:3128/&quot;&nbsp;target=&quot;_blank&quot;&gt;192.168.11.1:3128&lt;/a&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp;0&nbsp;DNAT&nbsp; &nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; eth2&nbsp; &nbsp;any&nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tcp&nbsp;dpt:http&nbsp;/*&nbsp;8:PFD::CF-3128&nbsp;*/&nbsp;to:&lt;a&nbsp;href=&quot;http://172.17.0.1:3128/&quot;&nbsp;target=&quot;_blank&quot;&gt;172.17.0.1:3128&lt;/a&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;Right&nbsp;now&nbsp;I&nbsp;can&#39;t&nbsp;get&nbsp;it&nbsp;to&nbsp;terminate&nbsp;ANY&nbsp;https&nbsp;traffic.&nbsp;All&nbsp;it&nbsp;does&nbsp;is&nbsp;allow&nbsp;it&nbsp;through.&nbsp; &lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;Any&nbsp;and&nbsp;all&nbsp;help&nbsp;would&nbsp;be&nbsp;greatly&nbsp;appreciated!&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;~&nbsp;Extremely&nbsp;Confused&nbsp;Squid&nbsp;User&nbsp;~&lt;/div&gt;&lt;/div&gt;<br>

</tt>
