<tt>
&lt;html&gt;<br>
&nbsp;&nbsp;&lt;head&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&nbsp;http-equiv=&quot;Content-Type&quot;&gt;<br>
&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&lt;body&nbsp;text=&quot;#000000&quot;&nbsp;bgcolor=&quot;#FFFFFF&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;-----BEGIN&nbsp;PGP&nbsp;SIGNED&nbsp;MESSAGE-----&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Hash:&nbsp;SHA256&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp; &lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;rule&nbsp;is&nbsp;simple.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;threads&nbsp;on&nbsp;processor(s)&nbsp;are&nbsp;in&nbsp;the&nbsp;queue&nbsp;to&nbsp;the&nbsp;disk&nbsp;-&nbsp;the<br>
&nbsp;&nbsp;&nbsp;&nbsp;bottleneck&nbsp;is&nbsp;disk.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;the&nbsp;disks&nbsp;or&nbsp;network&nbsp;interfaces&nbsp;(IO&nbsp;threads)&nbsp;waits&nbsp;execution&nbsp;on<br>
&nbsp;&nbsp;&nbsp;&nbsp;processor(s)&nbsp;-&nbsp;CPU(s)&nbsp;bottleneck.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;PS.&nbsp;And,&nbsp;man,&nbsp;1600&nbsp;users&nbsp;is&nbsp;not&nbsp;a&nbsp;high&nbsp;load.&nbsp;Really&nbsp;high&nbsp;load<br>
&nbsp;&nbsp;&nbsp;&nbsp;starting&nbsp;with&nbsp;15-30k&nbsp;users.&nbsp;;)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;24.02.16&nbsp;2:04,&nbsp;Yuri&nbsp;Voinov&nbsp;пишет:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&nbsp;style=&quot;white-space:&nbsp;pre;&quot;&gt;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;Agreed.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;High-load&nbsp;big&nbsp;enough&nbsp;caches&nbsp;must&nbsp;utilize&nbsp;_an&nbsp;adequate_<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hardware&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;configuration&nbsp;with&nbsp;enough&nbsp;capacity&nbsp;to&nbsp;meet&nbsp;you&nbsp;expectations.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;And,&nbsp;of&nbsp;course,&nbsp;cache&nbsp;software&nbsp;configuration&nbsp;must&nbsp;fit&nbsp;this<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hardware,&nbsp;to&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;maximize&nbsp;approaches.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;24.02.16&nbsp;1:55,&nbsp;Amos&nbsp;Jeffries&nbsp;пишет:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&nbsp;[&nbsp;pPS&nbsp;please&nbsp;dont&nbsp;hijack&nbsp;other&nbsp;peoples&nbsp;threads&nbsp;...&nbsp;this<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;has&nbsp;nothing&nbsp;to&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&nbsp;do&nbsp;with&nbsp;YouTube&nbsp;]&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&nbsp;On&nbsp;24/02/2016&nbsp;8:11&nbsp;a.m.,&nbsp;Heiler&nbsp;Bemerguy&nbsp;wrote:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&gt;&nbsp;Thanks&nbsp;Alex.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&gt;&nbsp;We&nbsp;have&nbsp;a&nbsp;simple&nbsp;cache_dir&nbsp;config&nbsp;like&nbsp;this,&nbsp;with&nbsp;no<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;workers&quot;&nbsp;defined:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&gt;&nbsp;cache_dir&nbsp;rock&nbsp;/cache2&nbsp;80000&nbsp;min-size=0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;max-size=32767&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&gt;&nbsp;cache_dir&nbsp;aufs&nbsp;/cache&nbsp;320000&nbsp;96&nbsp;256&nbsp;min-size=32768&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&gt;&nbsp;And&nbsp;we&nbsp;are&nbsp;suffering&nbsp;from&nbsp;a&nbsp;100%&nbsp;CPU&nbsp;use&nbsp;by&nbsp;a&nbsp;single<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;squid&nbsp;thread.&nbsp;We&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&gt;&nbsp;have&nbsp;lots&nbsp;of&nbsp;ram,&nbsp;cores&nbsp;and&nbsp;disk&nbsp;space..&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&nbsp;Squid&nbsp;is&nbsp;essentially&nbsp;single-threaded&nbsp;(not&nbsp;completely,&nbsp;so<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dual-core&nbsp;has&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&nbsp;benefit,&nbsp;but&nbsp;close).&nbsp;Without&nbsp;SMP&nbsp;enabled&nbsp;you&nbsp;will&nbsp;not<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;benefit&nbsp;from&nbsp;those&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&nbsp;&quot;lots&nbsp;of&nbsp;cores&quot;.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&gt;&nbsp;but&nbsp;also&nbsp;too&nbsp;many&nbsp;users:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&gt;&nbsp;Number&nbsp;of&nbsp;clients&nbsp;accessing&nbsp;cache:     &nbsp;1634&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&gt;&nbsp;Number&nbsp;of&nbsp;HTTP&nbsp;requests&nbsp;received:      &nbsp;3276691&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&gt;&nbsp;Average&nbsp;HTTP&nbsp;requests&nbsp;per&nbsp;minute&nbsp;since&nbsp;start:  <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;12807.1&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&gt;&nbsp;Select&nbsp;loop&nbsp;called:&nbsp;60353401&nbsp;times,&nbsp;22.017&nbsp;ms&nbsp;avg&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&nbsp;What&nbsp;GHz&nbsp;rating&nbsp;is&nbsp;each&nbsp;CPU&nbsp;core? &nbsp;200-250&nbsp;RPS&nbsp;is<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;roughly&nbsp;in&nbsp;the&nbsp;range&nbsp;I&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&nbsp;would&nbsp;expect&nbsp;from&nbsp;a&nbsp;1.xGHz&nbsp;core&nbsp;going&nbsp;full&nbsp;speed&nbsp;/&nbsp;100%<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;usage.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&nbsp;Are&nbsp;you&nbsp;using&nbsp;RAID&nbsp;on&nbsp;the&nbsp;disk&nbsp;storage?&nbsp;IME,&nbsp;RAID&nbsp;can<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;more&nbsp;than&nbsp;halve&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&nbsp;the&nbsp;speed&nbsp;of&nbsp;the&nbsp;proxy.&nbsp;Although&nbsp;the&nbsp;CPU&nbsp;thrashing<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;effect&nbsp;is&nbsp;mostly&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&nbsp;hidden&nbsp;away&nbsp;out&nbsp;of&nbsp;sight&nbsp;in&nbsp;the&nbsp;disk&nbsp;controller<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;processor(s).&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&gt;&nbsp;Getting&nbsp;rid&nbsp;of&nbsp;this&nbsp;big&nbsp;aufs&nbsp;and&nbsp;spreading&nbsp;to&nbsp;many<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rock&nbsp;stores&nbsp;will&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&gt;&nbsp;improve&nbsp;things&nbsp;here?&nbsp;I've&nbsp;already&nbsp;shrunk&nbsp;the&nbsp;acls<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;patterns/regexes&nbsp;etc&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&nbsp;YMMV&nbsp;but&nbsp;I&nbsp;doubt&nbsp;it.&nbsp;AUFS&nbsp;has&nbsp;64&nbsp;disk&nbsp;I/O&nbsp;threads&nbsp;taking<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;advantage&nbsp;of&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&nbsp;those&nbsp;other&nbsp;cores.&nbsp;Without&nbsp;SMP&nbsp;rock&nbsp;is&nbsp;restricted&nbsp;to<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fewer&nbsp;threads&nbsp;for&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&nbsp;its&nbsp;I/O&nbsp;and&nbsp;most&nbsp;work&nbsp;is&nbsp;being&nbsp;done&nbsp;by&nbsp;the&nbsp;main&nbsp;worker<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;core&nbsp;anyway&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&nbsp;without&nbsp;the&nbsp;disk&nbsp;IO&nbsp;portion.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&nbsp;With&nbsp;CPU&nbsp;maxing&nbsp;out&nbsp;as&nbsp;the&nbsp;bottleneck&nbsp;I&nbsp;would&nbsp;be&nbsp;looking<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;config&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&nbsp;perforemance&nbsp;(you&nbsp;say&nbsp;you&nbsp;have&nbsp;done&nbsp;that&nbsp;already),&nbsp;then<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Squid&nbsp;SMP&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&nbsp;workers&nbsp;as&nbsp;the&nbsp;next&nbsp;workaround.&nbsp;With&nbsp;disk&nbsp;efficiencies<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;later&nbsp;if/when&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&nbsp;they&nbsp;become&nbsp;relevant.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&nbsp;Amos&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&nbsp;_______________________________________________&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&nbsp;squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-abbreviated&quot;&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&gt;&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&lt;/span&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;-----BEGIN&nbsp;PGP&nbsp;SIGNATURE-----<br>
&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Version:&nbsp;GnuPG&nbsp;v2<br>
&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp; &lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;iQEcBAEBCAAGBQJWzMJRAAoJENNXIZxhPexGYYkH/jzBXz01wAl3/kvGD75Ya6Nr<br>
&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;lmdMX6nVx+3UHPIwC24RJJcJrxaRfHAuXA1NSArvu5iM90O9WDkYcJYLO6FCOeuk<br>
&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;qha3eMl+KTcFpk7GunaZNF1G6O/kIS5VymFs0lc9tuz6W1GNUmuvfcVIXCc7XDC5<br>
&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;SM6SY/u7gnnRvxhUyYlrLhb7TdS4uQ5HShqBhaMtkAM5LFVLnPAK9rTxEYr2A7Qq<br>
&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;hQVkn1lBm/sTImd1fhts3Qkr7F3GDUsOpfmMGeGUIvKCPm9sMTc01trK1Rcb3cre<br>
&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;dhuluPvbFCguuxvDRCMvoU6DpEkvZDjNL+kN+gLI5SfrqlcZjb4xRosKt5d18Y0=<br>
&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;=i5/S<br>
&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;-----END&nbsp;PGP&nbsp;SIGNATURE-----<br>
&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
