<tt>
&lt;html&gt;<br>
&nbsp;&nbsp;&lt;head&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&nbsp;http-equiv=&quot;Content-Type&quot;&gt;<br>
&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&lt;body&nbsp;bgcolor=&quot;#FFFFFF&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;I&nbsp;waited&nbsp;squid&nbsp;-z&nbsp;to&nbsp;finish..&nbsp;did&nbsp;a&nbsp;&quot;ps&nbsp;auxw&nbsp;|grep&nbsp;squid&quot;&nbsp;a&nbsp;dozen<br>
&nbsp;&nbsp;&nbsp;&nbsp;times&nbsp;to&nbsp;check..&nbsp;THEN&nbsp;I&nbsp;started&nbsp;it.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;It&nbsp;may&nbsp;have&nbsp;tried&nbsp;to&nbsp;serve&nbsp;something,&nbsp;as&nbsp;lots&nbsp;of&nbsp;users&nbsp;we're&nbsp;already<br>
&nbsp;&nbsp;&nbsp;&nbsp;conecting&nbsp;to&nbsp;it&nbsp;right&nbsp;after&nbsp;it&nbsp;started,&nbsp;but&nbsp;I'm&nbsp;still&nbsp;seeing&nbsp;a&nbsp;flood<br>
&nbsp;&nbsp;&nbsp;&nbsp;of&nbsp;warnings&nbsp;on&nbsp;error.log:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;i&gt;2016/02/25&nbsp;15:06:38&nbsp;kid1|&nbsp;WARNING:&nbsp;swapfile&nbsp;header&nbsp;inconsistent<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;available&nbsp;data&lt;/i&gt;&lt;i&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/i&gt;&lt;i&gt;2016/02/25&nbsp;15:06:38&nbsp;kid1|&nbsp;WARNING:&nbsp;swapfile&nbsp;header<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inconsistent&nbsp;with&nbsp;available&nbsp;data&lt;/i&gt;&lt;i&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/i&gt;&lt;i&gt;2016/02/25&nbsp;15:06:38&nbsp;kid1|&nbsp;WARNING:&nbsp;swapfile&nbsp;header<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inconsistent&nbsp;with&nbsp;available&nbsp;data&lt;/i&gt;&lt;i&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/i&gt;&lt;i&gt;2016/02/25&nbsp;15:06:39&nbsp;kid1|&nbsp;WARNING:&nbsp;swapfile&nbsp;header<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inconsistent&nbsp;with&nbsp;available&nbsp;data&lt;/i&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;It's&nbsp;curious&nbsp;that&nbsp;with&nbsp;only&nbsp;one&nbsp;cache_dir&nbsp;(the&nbsp;first&nbsp;one),&nbsp;I&nbsp;didn't<br>
&nbsp;&nbsp;&nbsp;&nbsp;receive&nbsp;any&nbsp;of&nbsp;these&nbsp;errors...&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Maybe&nbsp;the&nbsp;non-rounded&nbsp;&quot;4097&quot;&nbsp;value&nbsp;is&nbsp;causing&nbsp;an&nbsp;issue?&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Best&nbsp;Regards,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;class=&quot;moz-signature&quot;&nbsp;cols=&quot;72&quot;&gt;--&nbsp;<br>
Heiler&nbsp;Bemerguy&nbsp;-&nbsp;(91)&nbsp;98151-4894<br>
Assessor&nbsp;TÃ©cnico&nbsp;-&nbsp;CINBESA&nbsp;(91)&nbsp;3184-1751&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;class=&quot;moz-cite-prefix&quot;&gt;Em&nbsp;25/02/2016&nbsp;14:18,&nbsp;Amos&nbsp;Jeffries<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;escreveu:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;cite=&quot;mid:56CF374E.6040600@treenet.co.nz&quot;&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;On&nbsp;26/02/2016&nbsp;5:58&nbsp;a.m.,&nbsp;Heiler&nbsp;Bemerguy&nbsp;wrote:<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;<br>
Hi&nbsp;Alex,&nbsp;Eliezer,&nbsp;Yuri,&nbsp;Amos..<br>
<br>
So,&nbsp;to&nbsp;start&nbsp;from&nbsp;the&nbsp;start,&nbsp;after&nbsp;seeing&nbsp;squid&nbsp;was&nbsp;totally&nbsp;stable&nbsp;and<br>
fast,&nbsp;running&nbsp;with&nbsp;NO&nbsp;cache_dirs,&nbsp;I&nbsp;tried&nbsp;to&nbsp;add&nbsp;only&nbsp;2&nbsp;rockstore<br>
cache_dirs&nbsp;to&nbsp;test.<br>
<br>
conf:<br>
/cache_dir&nbsp;rock&nbsp;/cache2/rock1&nbsp;20000&nbsp;min-size=0&nbsp;max-size=4096<br>
slot-size=2048//<br>
//cache_dir&nbsp;rock&nbsp;/cache2/rock2&nbsp;30000&nbsp;min-size=4097&nbsp;max-size=16384<br>
slot-size=4096/<br>
(ps.:&nbsp;I&nbsp;know&nbsp;it&nbsp;would&nbsp;be&nbsp;nice&nbsp;to&nbsp;use&nbsp;one&nbsp;store&nbsp;PER&nbsp;partition/disk/lun<br>
whatever..&nbsp;but&nbsp;I'm&nbsp;trying&nbsp;to&nbsp;lessen&nbsp;disk&nbsp;wasting&nbsp;by&nbsp;using&nbsp;small<br>
slot-sizes&nbsp;for&nbsp;small&nbsp;files..&nbsp;am&nbsp;I&nbsp;wrong?)<br>
<br>
Then&nbsp;squid&nbsp;-z:<br>
/2016/02/25&nbsp;13:42:00&nbsp;kid2|&nbsp;Creating&nbsp;Rock&nbsp;db:&nbsp;/cache2/rock1/rock//<br>
//2016/02/25&nbsp;13:42:00&nbsp;kid3|&nbsp;Creating&nbsp;Rock&nbsp;db:&nbsp;/cache2/rock2/rock/<br>
<br>
Then&nbsp;running&nbsp;squid&nbsp;for&nbsp;the&nbsp;first&nbsp;time&nbsp;with&nbsp;these&nbsp;newly&nbsp;created&nbsp;rock<br>
stores....<br>
<br>
/2016/02/25&nbsp;13:42:09&nbsp;kid3|&nbsp;Loading&nbsp;cache_dir&nbsp;#1&nbsp;from&nbsp;/cache2/rock2/rock//<br>
//2016/02/25&nbsp;13:42:09&nbsp;kid2|&nbsp;Loading&nbsp;cache_dir&nbsp;#0&nbsp;from&nbsp;/cache2/rock1/rock//<br>
//2016/02/25&nbsp;13:42:09&nbsp;kid3|&nbsp;Store&nbsp;rebuilding&nbsp;is&nbsp;0.01%&nbsp;complete//<br>
//2016/02/25&nbsp;13:42:09&nbsp;kid2|&nbsp;Store&nbsp;rebuilding&nbsp;is&nbsp;0.01%&nbsp;complete/<br>
<br>
Rebuilding&nbsp;what?&nbsp;just&nbsp;creating&nbsp;the&nbsp;huge&nbsp;files&nbsp;I&nbsp;think...<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;<br>
The&nbsp;cache&nbsp;index&nbsp;for&nbsp;those&nbsp;rock&nbsp;DB.<br>
<br>
Unlike&nbsp;UFS&nbsp;which&nbsp;stores&nbsp;a&nbsp;swap.state&nbsp;file,&nbsp;rock&nbsp;rebuilds&nbsp;its&nbsp;index&nbsp;on<br>
each&nbsp;startup.<br>
<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;<br>
Then:<br>
/2016/02/25&nbsp;13:42:19&nbsp;kid1|&nbsp;WARNING:&nbsp;swapfile&nbsp;header&nbsp;inconsistent&nbsp;with<br>
available&nbsp;data<br>
2016/02/25&nbsp;13:42:21&nbsp;kid2|&nbsp;WARNING:&nbsp;cache_dir[0]:&nbsp;Ignoring&nbsp;malformed<br>
cache&nbsp;entry&nbsp;meta&nbsp;data&nbsp;at&nbsp;6943832064<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;&lt;snip&nbsp;repeats&gt;<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;2016/02/25&nbsp;13:42:40&nbsp;kid1|&nbsp;ctx:&nbsp;enter&nbsp;level&nbsp;&nbsp;0:<br>
'&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://static.bn-static.com/pg/0plcB0QjJpBbwN7rMMDjKKO5Z63Nhu3zfPw==.gif&quot;&gt;http://static.bn-static.com/pg/0plcB0QjJpBbwN7rMMDjKKO5Z63Nhu3zfPw==.gif&lt;/a&gt;'<br>
2016/02/25&nbsp;13:42:40&nbsp;kid1|&nbsp;WARNING:&nbsp;swapfile&nbsp;header&nbsp;inconsistent&nbsp;with<br>
available&nbsp;data<br>
2016/02/25&nbsp;13:42:40&nbsp;kid2|&nbsp;WARNING:&nbsp;cache_dir[0]:&nbsp;Ignoring&nbsp;malformed<br>
cache&nbsp;entry&nbsp;meta&nbsp;data&nbsp;at&nbsp;19581075456<br>
2016/02/25&nbsp;13:42:41&nbsp;kid2|&nbsp;WARNING:&nbsp;cache_dir[0]:&nbsp;Ignoring&nbsp;malformed<br>
cache&nbsp;entry&nbsp;meta&nbsp;data&nbsp;at&nbsp;19757760512<br>
2016/02/25&nbsp;13:42:43&nbsp;kid2|&nbsp;Finished&nbsp;rebuilding&nbsp;storage&nbsp;from&nbsp;disk.<br>
2016/02/25&nbsp;13:42:43&nbsp;kid2|&nbsp;&nbsp;&nbsp;10239992&nbsp;Entries&nbsp;scanned<br>
2016/02/25&nbsp;13:42:43&nbsp;kid2|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;14&nbsp;Invalid&nbsp;entries.///<br>
<br>
What&nbsp;entry?&nbsp;why&nbsp;malformed?&nbsp;Wasn't&nbsp;it&nbsp;just&nbsp;a&nbsp;empty&nbsp;store?!&nbsp;it&nbsp;just<br>
created&nbsp;it.......<br>
<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;<br>
<br>
Did&nbsp;you&nbsp;wait&nbsp;for&nbsp;the&nbsp;-z&nbsp;background&nbsp;processes&nbsp;to&nbsp;finish&nbsp;creating&nbsp;the&nbsp;50GB<br>
of&nbsp;disk&nbsp;allocation&nbsp;before&nbsp;starting&nbsp;the&nbsp;main&nbsp;Squid&nbsp;process&nbsp;?<br>
<br>
Are&nbsp;your&nbsp;workers&nbsp;trying&nbsp;to&nbsp;serve&nbsp;up&nbsp;traffic&nbsp;to&nbsp;or&nbsp;from&nbsp;the&nbsp;cache&nbsp;before<br>
the&nbsp;rebuild&nbsp;has&nbsp;completed?<br>
<br>
<br>
As&nbsp;you&nbsp;can&nbsp;see&nbsp;from&nbsp;the&nbsp;log&nbsp;timestamps&nbsp;on&nbsp;startup&nbsp;it&nbsp;will&nbsp;take&nbsp;~30-60<br>
sec&nbsp;for&nbsp;the&nbsp;rock&nbsp;caches&nbsp;of&nbsp;that&nbsp;size&nbsp;to&nbsp;be&nbsp;loaded&nbsp;in&nbsp;your&nbsp;system.<br>
<br>
<br>
Amos<br>
<br>
_______________________________________________<br>
squid-users&nbsp;mailing&nbsp;list<br>
&lt;a&nbsp;class=&quot;moz-txt-link-abbreviated&quot;&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;<br>
&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
