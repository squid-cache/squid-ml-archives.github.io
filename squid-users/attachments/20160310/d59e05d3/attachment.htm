<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;Thank&nbsp;you&nbsp;for&nbsp;your&nbsp;response,&nbsp;Eliezer.&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;I&nbsp;added&nbsp;the&nbsp;logformat&nbsp;command&nbsp;that&nbsp;you&nbsp;suggested.&nbsp;I&nbsp;needed&nbsp;to&nbsp;modify&nbsp;it&nbsp;slightly,&nbsp;since&nbsp;I&#39;m&nbsp;running&nbsp;squid&nbsp;3.1&nbsp;(I&nbsp;changed&nbsp;&lt;a&nbsp;to&nbsp;&lt;A&nbsp;and&nbsp;removed&nbsp;%&gt;eui).&nbsp;An&nbsp;example&nbsp;of&nbsp;what&nbsp;I&nbsp;am&nbsp;seeing&nbsp;in&nbsp;/var/log/squid/access.log&nbsp;is:&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;40px;border:none;padding:0px&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;1457630282.410&nbsp; &nbsp; 490&nbsp;172.31.169.175&nbsp;TCP_MISS/200&nbsp;4621&nbsp;GET&nbsp;https://&lt;server&gt;/tw4/index.php/Two&nbsp;-&nbsp;FIRST_UP_PARENT/&lt;a&nbsp;href=&quot;http://127.0.0.1&quot;&gt;127.0.0.1&lt;/a&gt;&nbsp;text/html&nbsp;Q-CC:&nbsp;&quot;max-age=0&quot;&nbsp;&quot;max-age=0&quot;&nbsp;Q-P:&nbsp;&quot;-&quot;&nbsp;&quot;-&quot;&nbsp;REP-CC:&nbsp;&quot;s-maxage=18000,&nbsp;must-revalidate,&nbsp;max-age=0&quot;&nbsp;REP-EXP:&nbsp;&quot;-&quot;&nbsp;VARY:&nbsp;&quot;-&quot;&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;I&nbsp;am&nbsp;testing&nbsp;from&nbsp;a&nbsp;desktop&nbsp;browser&nbsp;(Chrome&nbsp;and&nbsp;IE).&nbsp;I&nbsp;am&nbsp;entering&nbsp;the&nbsp;page&nbsp;address&nbsp;directly&nbsp;rather&nbsp;than&nbsp;doing&nbsp;a&nbsp;browser&nbsp;refresh.&nbsp;I&nbsp;am&nbsp;watching&nbsp;/var/log/squid/access.log&nbsp;and&nbsp;/var/log/httpd/access.log&nbsp;to&nbsp;see&nbsp;what&nbsp;requests&nbsp;squid&nbsp;and&nbsp;apache&nbsp;are&nbsp;receiving.&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;Thank&nbsp;you,&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;br&gt;Cindy&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;pre&nbsp;style=&quot;white-space:pre-wrap;color:rgb(0,0,0)&quot;&gt;Hey&nbsp;Cindy,<br>
<br>
I&nbsp;do&nbsp;not&nbsp;have&nbsp;too&nbsp;much&nbsp;experience&nbsp;with&nbsp;MediaWIKI&nbsp;but&nbsp;I&nbsp;ran&nbsp;some&nbsp;test&nbsp;on&nbsp;<br>
it&nbsp;in&nbsp;the&nbsp;past&nbsp;for&nbsp;both&nbsp;caching&nbsp;and&nbsp;other&nbsp;things.<br>
I&nbsp;am&nbsp;using&nbsp;this&nbsp;logformat&nbsp;to&nbsp;detect&nbsp;couple&nbsp;things&nbsp;that&nbsp;are&nbsp;related&nbsp;to&nbsp;<br>
caching:<br>
logformat&nbsp;cache_headers&nbsp;%ts.%03tu&nbsp;%6tr&nbsp;%&gt;a&nbsp;%Ss/%03&gt;Hs&nbsp;%&lt;st&nbsp;%rm&nbsp;%ru&nbsp;%[un&nbsp;<br>
%Sh/%&lt;a&nbsp;%mt&nbsp;Q-CC:&nbsp;&quot;%{Cache-Control}&gt;h&quot;&nbsp;&quot;%{Cache-Control}&gt;ha&quot;&nbsp;Q-P:&nbsp;<br>
&quot;%{Pragma}&gt;h&quot;&nbsp;&quot;%{Pragma}&gt;ha&quot;&nbsp;REP-CC:&nbsp;&quot;%{Cache-Control}&lt;h&quot;&nbsp;REP-EXP:&nbsp;<br>
&quot;%{Expires}&lt;h&quot;&nbsp;VARY:&nbsp;&quot;%{Vary}&lt;h&quot;&nbsp;%&gt;eui<br>
access_log&nbsp;daemon:/var/log/squid/access.log&nbsp;cache_headers<br>
<br>
The&nbsp;headers:<br>
Cache-Control:&nbsp;s-maxage=18000,&nbsp;must-revalidate,&nbsp;max-age=0<br>
<br>
clearly&nbsp;states&nbsp;that&nbsp;the&nbsp;response&nbsp;should&nbsp;not&nbsp;be&nbsp;cached&nbsp;by&nbsp;the&nbsp;client&nbsp;but&nbsp;<br>
supposed&nbsp;to&nbsp;be&nbsp;cached&nbsp;by&nbsp;a&nbsp;surrogate.<br>
How&nbsp;do&nbsp;you&nbsp;test&nbsp;caching?&nbsp;wget?&nbsp;curl?&nbsp;script?&nbsp;netcat?&nbsp;a&nbsp;desktop&nbsp;browser?<br>
<br>
Eliezer<br>
<br>
On&nbsp;10/03/2016&nbsp;16:22,&nbsp;Cindy&nbsp;Cicalese&nbsp;wrote:<br>
&gt;&lt;i&gt;&nbsp;I&nbsp;am&nbsp;using&nbsp;Squid&nbsp;for&nbsp;caching&nbsp;with&nbsp;Apache&nbsp;and&nbsp;MediaWiki&nbsp;over&nbsp;HTTPS&nbsp;only.<br>
&lt;/i&gt;&gt;&lt;i&gt;&nbsp;Unfortunately,&nbsp;no&nbsp;pages&nbsp;are&nbsp;being&nbsp;cached;&nbsp;each&nbsp;request&nbsp;is&nbsp;being&nbsp;sent<br>
&lt;/i&gt;&gt;&lt;i&gt;&nbsp;from&nbsp;Squid&nbsp;to&nbsp;Apache.&nbsp;I&nbsp;would&nbsp;appreciate&nbsp;help&nbsp;figuring&nbsp;out&nbsp;how&nbsp;to&nbsp;get<br>
&lt;/i&gt;&gt;&lt;i&gt;&nbsp;caching&nbsp;to&nbsp;work.<br>
&lt;/i&gt;&gt;&lt;i&gt;<br>
&lt;/i&gt;&gt;&lt;i&gt;&nbsp;My&nbsp;configuration&nbsp;is&nbsp;as&nbsp;follows:<br>
&lt;/i&gt;&gt;&lt;i&gt;<br>
&lt;/i&gt;&gt;&lt;i&gt;&nbsp;&nbsp;&nbsp;*&nbsp;Squid&nbsp;is&nbsp;configured&nbsp;to&nbsp;listen&nbsp;on&nbsp;&lt;external&nbsp;ip&gt;:443&nbsp;for&nbsp;HTTPS<br>
&lt;/i&gt;&gt;&lt;i&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;requests&nbsp;and&nbsp;forwards&nbsp;them&nbsp;to&nbsp;Apache&nbsp;on&nbsp;port&nbsp;8080<br>
&lt;/i&gt;&gt;&lt;i&gt;<br>
&lt;/i&gt;&gt;&lt;i&gt;&nbsp;https_port&nbsp;&lt;external&nbsp;ip&gt;:443&nbsp;cert=&lt;path&nbsp;to&nbsp;cert&gt;&nbsp;key=&lt;path&nbsp;to&nbsp;key&gt;<br>
&lt;/i&gt;&gt;&lt;i&gt;&nbsp;defaultsite=&lt;server&nbsp;name&gt;&nbsp;vhost<br>
&lt;/i&gt;&gt;&lt;i&gt;&nbsp;cache_peer&nbsp;127.0.0.1&nbsp;parent&nbsp;8080&nbsp;no-query&nbsp;originserver&nbsp;login=PASS<br>
&lt;/i&gt;&gt;&lt;i&gt;<br>
&lt;/i&gt;&gt;&lt;i&gt;&nbsp;&nbsp;&nbsp;*&nbsp;Squid&nbsp;also&nbsp;listens&nbsp;on&nbsp;&lt;a&nbsp;href=&quot;http://127.0.0.1:80&quot;&gt;127.0.0.1:80&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://127.0.0.1/&quot;&gt;http://127.0.0.1:80&lt;/a&gt;&gt;&nbsp;for&nbsp;PURGE<br>
&lt;/i&gt;&gt;&lt;i&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;requests&nbsp;from&nbsp;MediaWiki&nbsp;because&nbsp;I&nbsp;could&nbsp;not&nbsp;figure&nbsp;out&nbsp;how&nbsp;to<br>
&lt;/i&gt;&gt;&lt;i&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;configure&nbsp;MediaWiki&nbsp;to&nbsp;send&nbsp;PURGE&nbsp;requests&nbsp;with&nbsp;HTTPS<br>
&lt;/i&gt;&gt;&lt;i&gt;<br>
&lt;/i&gt;&gt;&lt;i&gt;&nbsp;http_port&nbsp;&lt;a&nbsp;href=&quot;http://127.0.0.1:80&quot;&gt;127.0.0.1:80&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://127.0.0.1/&quot;&gt;http://127.0.0.1:80&lt;/a&gt;&gt;&nbsp;defaultsite=&lt;server&nbsp;name&gt;&nbsp;vhost<br>
&lt;/i&gt;&gt;&lt;i&gt;<br>
&lt;/i&gt;&gt;&lt;i&gt;&nbsp;&nbsp;&nbsp;*&nbsp;Apache&nbsp;is&nbsp;listening&nbsp;on&nbsp;&lt;a&nbsp;href=&quot;http://127.0.0.1:8080&quot;&gt;127.0.0.1:8080&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://127.0.0.1:8080/&quot;&gt;http://127.0.0.1:8080&lt;/a&gt;&gt;&nbsp;for<br>
&lt;/i&gt;&gt;&lt;i&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;requests&nbsp;from&nbsp;Squid<br>
&lt;/i&gt;&gt;&lt;i&gt;&nbsp;&nbsp;&nbsp;*&nbsp;Apache&nbsp;is&nbsp;also&nbsp;listening&nbsp;on&nbsp;&lt;external&nbsp;ip&gt;:80&nbsp;which&nbsp;is&nbsp;set&nbsp;up&nbsp;as&nbsp;a<br>
&lt;/i&gt;&gt;&lt;i&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;permanent&nbsp;redirect&nbsp;to&nbsp;HTTPS<br>
&lt;/i&gt;&gt;&lt;i&gt;&nbsp;&nbsp;&nbsp;*&nbsp;MediaWiki&nbsp;is&nbsp;configured&nbsp;as&nbsp;follows:<br>
&lt;/i&gt;&gt;&lt;i&gt;<br>
&lt;/i&gt;&gt;&lt;i&gt;&nbsp;$wgUseSquid&nbsp;=&nbsp;true;<br>
&lt;/i&gt;&gt;&lt;i&gt;&nbsp;$wgSquidServers&nbsp;=&nbsp;array(&#39;127.0.0.1&#39;);&nbsp;//&nbsp;this&nbsp;is&nbsp;where&nbsp;PURGE&nbsp;requests<br>
&lt;/i&gt;&gt;&lt;i&gt;&nbsp;are&nbsp;sent<br>
&lt;/i&gt;&gt;&lt;i&gt;&nbsp;$wgSquidServersNoPurge&nbsp;=&nbsp;array(&#39;&lt;external&nbsp;ip&gt;&#39;);<br>
&lt;/i&gt;&gt;&lt;i&gt;<br>
&lt;/i&gt;&gt;&lt;i&gt;&nbsp;GET&nbsp;requests&nbsp;are&nbsp;being&nbsp;received&nbsp;by&nbsp;MediaWiki&nbsp;with&nbsp;Cache-Control:<br>
&lt;/i&gt;&gt;&lt;i&gt;&nbsp;max-age=0&nbsp;in&nbsp;the&nbsp;headers.&nbsp;The&nbsp;response&nbsp;sent&nbsp;by&nbsp;MediaWiki&nbsp;includes&nbsp;the<br>
&lt;/i&gt;&gt;&lt;i&gt;&nbsp;following&nbsp;headers:<br>
&lt;/i&gt;&gt;&lt;i&gt;<br>
&lt;/i&gt;&gt;&lt;i&gt;&nbsp;Cache-Control:&nbsp;s-maxage=18000,&nbsp;must-revalidate,&nbsp;max-age=0<br>
&lt;/i&gt;&gt;&lt;i&gt;&nbsp;X-Cache:&nbsp;MISS&nbsp;from&nbsp;&lt;server&nbsp;name&gt;<br>
&lt;/i&gt;&gt;&lt;i&gt;&nbsp;X-Cache-Lookup:&nbsp;HIT&nbsp;from&nbsp;&lt;server&nbsp;name&gt;:80<br>
&lt;/i&gt;&gt;&lt;i&gt;<br>
&lt;/i&gt;&gt;&lt;i&gt;&nbsp;I&nbsp;am&nbsp;suspicious&nbsp;why&nbsp;the&nbsp;last&nbsp;line&nbsp;says&nbsp;port&nbsp;80&nbsp;rather&nbsp;than&nbsp;8080,&nbsp;but&nbsp;I&#39;m<br>
&lt;/i&gt;&gt;&lt;i&gt;&nbsp;not&nbsp;sure&nbsp;if&nbsp;that&nbsp;is&nbsp;relevant.<br>
&lt;/i&gt;&gt;&lt;i&gt;<br>
&lt;/i&gt;&gt;&lt;i&gt;&nbsp;Please&nbsp;let&nbsp;me&nbsp;know&nbsp;if&nbsp;there&nbsp;is&nbsp;an&nbsp;more&nbsp;relevant&nbsp;information&nbsp;that&nbsp;will<br>
&lt;/i&gt;&gt;&lt;i&gt;&nbsp;help&nbsp;to&nbsp;troubleshoot&nbsp;this.&nbsp;Thank&nbsp;you&nbsp;in&nbsp;advance&nbsp;for&nbsp;your&nbsp;assistance!<br>
&lt;/i&gt;&gt;&lt;i&gt;<br>
&lt;/i&gt;&gt;&lt;i&gt;&nbsp;Cindy<br>
&lt;/i&gt;&gt;&lt;/pre&gt;&lt;/div&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
