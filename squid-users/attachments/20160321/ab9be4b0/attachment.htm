<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Yeah&nbsp;I&nbsp;know&nbsp;that,&nbsp;but&nbsp;there&nbsp;are&nbsp;issues&nbsp;with&nbsp;invoking&nbsp;peek:&nbsp;like&nbsp;the&nbsp;host&nbsp;forgery&nbsp;checks&nbsp;suddenly&nbsp;kick&nbsp;in,&nbsp;and&nbsp;squid&nbsp;starts&nbsp;seeing&nbsp;SSL&nbsp;errors&nbsp;(probably&nbsp;due&nbsp;to&nbsp;CentOS6&nbsp;not&nbsp;supporting&nbsp;the&nbsp;newest&nbsp;standards&nbsp;that&nbsp;Chrome&nbsp;uses)&nbsp;and&nbsp;then&nbsp;squid&nbsp;starts&nbsp;blocking&nbsp;things.&nbsp;That&#39;s&nbsp;why&nbsp;I&#39;m&nbsp;sticking&nbsp;to&nbsp;this&nbsp;simplest&nbsp;case&nbsp;for&nbsp;the&nbsp;moment&nbsp;and&nbsp;avoid&nbsp;the&nbsp;&quot;peek&quot;&nbsp;call&lt;div&gt;&lt;br&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks!&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Jason&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Mon,&nbsp;Mar&nbsp;21,&nbsp;2016&nbsp;at&nbsp;8:53&nbsp;PM,&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&nbsp;target=&quot;_blank&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;On&nbsp;21/03/2016&nbsp;10:29&nbsp;a.m.,&nbsp;Jason&nbsp;Haar&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;Hi&nbsp;there&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;I&#39;m&nbsp;wanting&nbsp;to&nbsp;use&nbsp;tls&nbsp;intercept&nbsp;to&nbsp;just&nbsp;log&nbsp;(well&nbsp;OK,&nbsp;and&nbsp;potentially&lt;br&gt;<br>
&gt;&nbsp;block)&nbsp;HTTPS&nbsp;sites&nbsp;based&nbsp;on&nbsp;hostnames&nbsp;(from&nbsp;SNI),&nbsp;but&nbsp;have&nbsp;had&nbsp;problems&lt;br&gt;<br>
&gt;&nbsp;even&nbsp;in&nbsp;peek-and-splice&nbsp;mode.&nbsp;So&nbsp;I&#39;m&nbsp;willing&nbsp;to&nbsp;compromise&nbsp;and&nbsp;instead&nbsp;just&lt;br&gt;<br>
&gt;&nbsp;intercept&nbsp;that&nbsp;traffic,&nbsp;log&nbsp;it,&nbsp;block&nbsp;on&nbsp;IP&nbsp;addresses&nbsp;if&nbsp;need&nbsp;be,&nbsp;and&nbsp;don&#39;t&lt;br&gt;<br>
&gt;&nbsp;use&nbsp;ssl-bump&nbsp;beyond&nbsp;that.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;So&nbsp;far&nbsp;the&nbsp;following&nbsp;seems&nbsp;to&nbsp;work&nbsp;perfectly,&nbsp;can&nbsp;someone&nbsp;confirm&nbsp;this&nbsp;is&lt;br&gt;<br>
&gt;&nbsp;&quot;supported&quot;&nbsp;-&nbsp;ie&nbsp;that&nbsp;I&#39;m&nbsp;not&nbsp;relying&nbsp;on&nbsp;some&nbsp;bug&nbsp;that&nbsp;might&nbsp;get&nbsp;fixed&lt;br&gt;<br>
&gt;&nbsp;later?&nbsp;;-)&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;It&nbsp;is&nbsp;supporteed.&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;&quot;&gt;&lt;br&gt;<br>
&gt;&nbsp;sslcrtd_program&nbsp;/usr/lib64/squid/ssl_crtd&nbsp;-s&nbsp;/var/lib/squid/ssl_db&nbsp;-M&nbsp;256MB&lt;br&gt;<br>
&gt;&nbsp;sslcrtd_children&nbsp;32&nbsp;startup=15&nbsp;idle=5&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;SSL_https&nbsp;port&nbsp;443&lt;br&gt;<br>
&gt;&nbsp;ssl_bump&nbsp;splice&nbsp;SSL_https&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;BlacklistedHTTPSsites&nbsp;dstdomain&lt;br&gt;<br>
&gt;&nbsp;&quot;/etc/squid/acl-BlacklistedHTTPSsites.txt&quot;&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;deny&nbsp;BlacklistedHTTPSsites&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;The&nbsp;&quot;bug&quot;&nbsp;comment&nbsp;comes&nbsp;down&nbsp;to&nbsp;how&nbsp;acl&nbsp;seems&nbsp;to&nbsp;work.&nbsp;I&nbsp;half-expected&nbsp;the&lt;br&gt;<br>
&gt;&nbsp;above&nbsp;not&nbsp;to&nbsp;work&nbsp;-&nbsp;but&nbsp;it&nbsp;does.&nbsp;It&nbsp;would&nbsp;appear&nbsp;squid&nbsp;will&nbsp;treat&nbsp;an&lt;br&gt;<br>
&gt;&nbsp;intercept&#39;s&nbsp;dst&nbsp;IP&nbsp;as&nbsp;the&nbsp;&quot;dns&nbsp;name&quot;&nbsp;as&nbsp;that&#39;s&nbsp;all&nbsp;it&#39;s&nbsp;got&nbsp;-&nbsp;so&lt;br&gt;<br>
&gt;&nbsp;&quot;dstdomain&quot;&nbsp;works&nbsp;fine&nbsp;for&nbsp;both&nbsp;CONNECT&nbsp;and&nbsp;intercept&nbsp;IFF&nbsp;the&nbsp;acl&nbsp;contains&lt;br&gt;<br>
&gt;&nbsp;IP&nbsp;addresses&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;This&nbsp;is&nbsp;because&nbsp;the&nbsp;ssl_bump&nbsp;rules&nbsp;are&nbsp;saying&nbsp;to&nbsp;splice&nbsp;immediately&nbsp;when&lt;br&gt;<br>
only&nbsp;the&nbsp;pseudo-CONNECT&nbsp;with&nbsp;an&nbsp;IP&nbsp;address&nbsp;is&nbsp;known.&lt;br&gt;<br>
&lt;br&gt;<br>
If&nbsp;you&nbsp;use&nbsp;this:&lt;br&gt;<br>
 ssl_bump&nbsp;peek&nbsp;all&lt;br&gt;<br>
 ssl_bump&nbsp;splice&nbsp;all&lt;br&gt;<br>
&lt;br&gt;<br>
it&nbsp;will&nbsp;peek&nbsp;at&nbsp;the&nbsp;client&nbsp;SNI&nbsp;and&nbsp;server&nbsp;public&nbsp;cert&nbsp;details&nbsp;before&lt;br&gt;<br>
dropping&nbsp;back&nbsp;to&nbsp;a&nbsp;transparent&nbsp;pass-tru.&nbsp;Then&nbsp;it&nbsp;will&nbsp;have&nbsp;that&nbsp;domain&lt;br&gt;<br>
and&nbsp;any&nbsp;other&nbsp;non-encrypted&nbsp;details&nbsp;available&nbsp;for&nbsp;logging.&lt;br&gt;<br>
&lt;br&gt;<br>
Amos&lt;br&gt;<br>
&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;--&nbsp;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_signature&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;Cheers&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Jason&nbsp;Haar&lt;/div&gt;&lt;div&gt;Information&nbsp;Security&nbsp;Manager,&nbsp;Trimble&nbsp;Navigation&nbsp;Ltd.&lt;/div&gt;&lt;div&gt;Phone:&nbsp;+1&nbsp;408&nbsp;481&nbsp;8171&lt;/div&gt;&lt;div&gt;PGP&nbsp;Fingerprint:&nbsp;7A2E&nbsp;0407&nbsp;C9A6&nbsp;CAF6&nbsp;2B9F&nbsp;8422&nbsp;C063&nbsp;5EBB&nbsp;FE1D&nbsp;66D1&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/div&gt;<br>

</tt>
