<tt>
&lt;p&nbsp;dir=&quot;ltr&quot;&gt;I&nbsp;understand,&nbsp;buggy&nbsp;I&nbsp;really&nbsp;need&nbsp;to&nbsp;take&nbsp;out&nbsp;this&nbsp;sniproxy&nbsp;in&nbsp;favor&nbsp;of&nbsp;squid.&lt;/p&gt;<br>
&lt;p&nbsp;dir=&quot;ltr&quot;&gt;I&#39;m&nbsp;planning&nbsp;that&nbsp;this&nbsp;path&nbsp;needs&nbsp;the&nbsp;HTTP&nbsp;violation&nbsp;flag&nbsp;on&nbsp;compile&nbsp;time,&nbsp;and&nbsp;by&nbsp;default&nbsp;value&nbsp;is&nbsp;off. &nbsp;So&nbsp;when&nbsp;turning&nbsp;on,&nbsp;it&nbsp;won&#39;t&nbsp;be&nbsp;an&nbsp;accident.&lt;br&gt;<br>
Host_verify_header&nbsp;would&nbsp;be&nbsp;a&nbsp;good&nbsp;name&nbsp;for&nbsp;this&nbsp;on/off&nbsp;option&lt;br&gt;<br>
&lt;/p&gt;<br>
&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;Le&nbsp;24&nbsp;mars&nbsp;2016&nbsp;4:05&nbsp;AM,&nbsp;&quot;Amos&nbsp;Jeffries&quot;&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&nbsp;a&nbsp;écrit :&lt;br&nbsp;type=&quot;attribution&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;On&nbsp;24/03/2016&nbsp;3:56&nbsp;p.m.,&nbsp;Luis&nbsp;Daniel&nbsp;Lucio&nbsp;Quiroz&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;As&nbsp;A&nbsp;side&nbsp;note,&nbsp;I&nbsp;am&nbsp;reading&nbsp;the&nbsp;code&nbsp;seems&nbsp;file&lt;br&gt;<br>
&gt;&nbsp;src/client_side_request.cc&nbsp;function&lt;br&gt;<br>
&gt;&nbsp;ClientRequestContext::hostHeaderVerify()&nbsp;is&nbsp;responsible&nbsp;for&nbsp;this.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;And&nbsp;to&nbsp;be&nbsp;exact&nbsp;this&nbsp;option:&lt;br&gt;<br>
&gt; &nbsp; &nbsp; if&nbsp;(ia&nbsp;!=&nbsp;NULL&nbsp;&amp;&amp;&nbsp;ia-&gt;count&nbsp;&gt;&nbsp;0)&nbsp;{&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; &nbsp;//&nbsp;Is&nbsp;the&nbsp;NAT&nbsp;destination&nbsp;IP&nbsp;in&nbsp;DNS?&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; &nbsp;for&nbsp;(int&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;ia-&gt;count;&nbsp;++i)&nbsp;{&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if&nbsp;(clientConn-&gt;local.matchIPAddr(ia-&gt;in_addrs[i])&nbsp;==&nbsp;0)&nbsp;{&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;debugs(85,&nbsp;3,&nbsp;HERE&nbsp;&lt;&lt;&nbsp;&quot;validate&nbsp;IP&nbsp;&quot;&nbsp;&lt;&lt;&nbsp;clientConn-&gt;local&nbsp;&lt;&lt;&lt;br&gt;<br>
&gt;&nbsp;&quot;&nbsp;possible&nbsp;from&nbsp;Host:&quot;);&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;http-&gt;request-&gt;flags.hostVerified&nbsp;=&nbsp;true;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;http-&gt;doCallouts();&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;debugs(85,&nbsp;3,&nbsp;HERE&nbsp;&lt;&lt;&nbsp;&quot;validate&nbsp;IP&nbsp;&quot;&nbsp;&lt;&lt;&nbsp;clientConn-&gt;local&nbsp;&lt;&lt;&nbsp;&quot;&lt;br&gt;<br>
&gt;&nbsp;non-match&nbsp;from&nbsp;Host:&nbsp;IP&nbsp;&quot;&nbsp;&lt;&lt;&nbsp;ia-&gt;in_addrs[i]);&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; &nbsp;}&lt;br&gt;<br>
&gt; &nbsp; &nbsp;}&lt;br&gt;<br>
&gt; &nbsp; &nbsp;debugs(85,&nbsp;3,&nbsp;HERE&nbsp;&lt;&lt;&nbsp;&quot;FAIL:&nbsp;validate&nbsp;IP&nbsp;&quot;&nbsp;&lt;&lt;&nbsp;clientConn-&gt;local&nbsp;&lt;&lt;&nbsp;&quot;&lt;br&gt;<br>
&gt;&nbsp;possible&nbsp;from&nbsp;Host:&quot;);&lt;br&gt;<br>
&gt; &nbsp; &nbsp;hostHeaderVerifyFailed(&quot;local&nbsp;IP&quot;,&nbsp;&quot;any&nbsp;domain&nbsp;IP&quot;);&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;As&nbsp;far&nbsp;as&nbsp;I&nbsp;understand&nbsp;there&nbsp;is&nbsp;no&nbsp;a&nbsp;possible&nbsp;way.&lt;br&gt;<br>
&gt;&nbsp;Would&nbsp;you&nbsp;be&nbsp;interested&nbsp;on&nbsp;a&nbsp;patch&nbsp;to&nbsp;allow&nbsp;this&nbsp;behaivour&nbsp;optional?&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
This&nbsp;is&nbsp;the&nbsp;CVE-2009-0801&nbsp;protection.&lt;br&gt;<br>
&lt;br&gt;<br>
Any&nbsp;patch&nbsp;altering&nbsp;it&nbsp;needs&nbsp;to&nbsp;retain&nbsp;that&nbsp;protection&nbsp;as&nbsp;there&nbsp;are&nbsp;known&lt;br&gt;<br>
attacks&nbsp;in&nbsp;the&nbsp;wild.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Also&nbsp;be&nbsp;aware&nbsp;that&nbsp;the&nbsp;SNI&nbsp;field&nbsp;of&nbsp;TLS&nbsp;is&nbsp;*not*&nbsp;a&nbsp;exact&nbsp;equivalent&nbsp;for&lt;br&gt;<br>
Host.&nbsp;SNI&nbsp;lacks&nbsp;the&nbsp;ability&nbsp;to&nbsp;distinguish&nbsp;relative&nbsp;vs&nbsp;absoute&nbsp;domains&lt;br&gt;<br>
and&nbsp;aternative&nbsp;port&nbsp;numbers&nbsp;-&nbsp;both&nbsp;of&nbsp;which&nbsp;are&nbsp;common&nbsp;occurances&nbsp;in&lt;br&gt;<br>
Host&nbsp;headers.&lt;br&gt;<br>
&lt;br&gt;<br>
Amos&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>

</tt>
