<tt>
&lt;html&gt;<br>
&lt;head&gt;<br>
&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=iso-8859-1&quot;&gt;<br>
&lt;style&nbsp;type=&quot;text/css&quot;&nbsp;style=&quot;display:none;&quot;&gt;&lt;!--&nbsp;P&nbsp;{margin-top:0;margin-bottom:0;}&nbsp;--&gt;&lt;/style&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;dir=&quot;ltr&quot;&gt;<br>
&lt;div&nbsp;id=&quot;divtagdefaultwrapper&quot;&nbsp;style=&quot;font-size:12pt;&nbsp;color:#000000;&nbsp;background-color:#FFFFFF;&nbsp;font-family:Calibri,Arial,Helvetica,sans-serif&quot;&gt;<br>
&lt;p&gt;Hi&nbsp;users&nbsp;:)&lt;/p&gt;<br>
&lt;p&gt;&lt;br&gt;<br>
&lt;/p&gt;<br>
&lt;p&gt;What&nbsp;I&nbsp;want&nbsp;to&nbsp;do:&nbsp;I&nbsp;have&nbsp;a&nbsp;dedicated&nbsp;server&nbsp;and&nbsp;I&nbsp;want&nbsp;to&nbsp;make&nbsp;it&nbsp;as&nbsp;a&nbsp;transparent&nbsp;adblocker&nbsp;through&nbsp;a&nbsp;VPN.&nbsp;So&nbsp;I&nbsp;have&nbsp;installed&nbsp;and&nbsp;configured&nbsp;OpenVPN&nbsp;and&nbsp;route&nbsp;my&nbsp;traffic&nbsp;from&nbsp;the&nbsp;VPN&nbsp;tun&nbsp;into&nbsp;the&nbsp;squid&nbsp;proxy.&lt;/p&gt;<br>
&lt;p&gt;&lt;br&gt;<br>
&lt;/p&gt;<br>
&lt;p&gt;What&nbsp;is&nbsp;the&nbsp;problem:&nbsp;Websites&nbsp;based&nbsp;on&nbsp;http&nbsp;work&nbsp;great&nbsp;but&nbsp;those&nbsp;based&nbsp;on&nbsp;httpS&nbsp;doesn't&nbsp;work&nbsp;at&nbsp;all.&nbsp;&lt;/p&gt;<br>
&lt;p&gt;&lt;br&gt;<br>
&lt;/p&gt;<br>
&lt;p&gt;I&nbsp;have&nbsp;already&nbsp;tried&nbsp;two&nbsp;squid&nbsp;configurations&nbsp;and&nbsp;look&nbsp;for&nbsp;that&nbsp;problem&nbsp;in&nbsp;the&nbsp;user&nbsp;mail&nbsp;list&nbsp;history&nbsp;but&nbsp;I&nbsp;can't&nbsp;find&nbsp;any&nbsp;workaround&nbsp;that&nbsp;works.&lt;/p&gt;<br>
&lt;p&gt;&lt;br&gt;<br>
&lt;/p&gt;<br>
&lt;p&gt;My&nbsp;compilation&nbsp;options&nbsp;(squid&nbsp;3.5.15&nbsp;-with-openssl&nbsp;is&nbsp;enabled):&lt;/p&gt;<br>
&lt;p&gt;'--build=x86_64-linux-gnu'&nbsp;'--prefix=/usr'&nbsp;'--includedir=${prefix}/include'&nbsp;'--mandir=${prefix}/share/man'&nbsp;'--infodir=${prefix}/share/info'&nbsp;'--sysconfdir=/etc'&nbsp;'--localstatedir=/var'&nbsp;'--libexecdir=${prefix}/lib/squid3'&nbsp;'--srcdir=.'&nbsp;'--disable-maintainer-mode'<br>
&nbsp;'--disable-dependency-tracking'&nbsp;'--disable-silent-rules'&nbsp;'BUILDCXXFLAGS=-g&nbsp;-O2&nbsp;-fPIE&nbsp;-fstack-protector-strong&nbsp;-Wformat&nbsp;-Werror=format-security&nbsp;-fPIE&nbsp;-pie&nbsp;-Wl,-z,relro&nbsp;-Wl,-z,now'&nbsp;'--datadir=/usr/share/squid'&nbsp;'--sysconfdir=/etc/squid'&nbsp;'--libexecdir=/usr/lib/squid'<br>
&nbsp;'--mandir=/usr/share/man'&nbsp;'--enable-inline'&nbsp;'--disable-arch-native'&nbsp;'--enable-async-io=8'&nbsp;'--enable-storeio=ufs,aufs,diskd,rock'&nbsp;'--enable-removal-policies=lru,heap'&nbsp;'--enable-delay-pools'&nbsp;'--enable-cache-digests'&nbsp;'--enable-icap-client'&nbsp;'--enable-follow-x-forwarded-for'<br>
&nbsp;'--enable-auth-basic=DB,fake,getpwnam,LDAP,NCSA,NIS,PAM,POP3,RADIUS,SASL,SMB'&nbsp;'--enable-auth-digest=file,LDAP'&nbsp;'--enable-auth-negotiate=kerberos,wrapper'&nbsp;'--enable-auth-ntlm=fake,smb_lm'&nbsp;'--enable-external-acl-helpers=file_userip,kerberos_ldap_group,LDAP_group,session,SQL_session,unix_group,wbinfo_group'<br>
&nbsp;'--enable-url-rewrite-helpers=fake'&nbsp;'--enable-eui'&nbsp;'--enable-esi'&nbsp;'--enable-icmp'&nbsp;'--enable-zph-qos'&nbsp;'--enable-ecap'&nbsp;'--disable-translation'&nbsp;'--with-openssl=/etc/ssl'&nbsp;'--enable-ssl-crtd'&nbsp;'--with-swapdir=/var/spool/squid'&nbsp;'--with-logdir=/var/log/squid'&nbsp;'--with-pidfile=/var/run/squid.pid'<br>
&nbsp;'--with-filedescriptors=65536'&nbsp;'--with-large-files'&nbsp;'--with-default-user=proxy'&nbsp;'--enable-build-info=&nbsp;linux'&nbsp;'--enable-linux-netfilter'&nbsp;'build_alias=x86_64-linux-gnu'&nbsp;'CFLAGS=-g&nbsp;-O2&nbsp;-fPIE&nbsp;-fstack-protector-strong&nbsp;-Wformat&nbsp;-Werror=format-security&nbsp;-Wall'&nbsp;'LDFLAGS=-fPIE<br>
&nbsp;-pie&nbsp;-Wl,-z,relro&nbsp;-Wl,-z,now'&nbsp;'CPPFLAGS=-Wdate-time&nbsp;-D_FORTIFY_SOURCE=2'&nbsp;'CXXFLAGS=-g&nbsp;-O2&nbsp;-fPIE&nbsp;-fstack-protector-strong&nbsp;-Wformat&nbsp;-Werror=format-security'&lt;br&gt;<br>
&lt;/p&gt;<br>
&lt;p&gt;&lt;br&gt;<br>
&lt;/p&gt;<br>
&lt;p&gt;My&nbsp;iptable&nbsp;conf&nbsp;(port&nbsp;22:&nbsp;my&nbsp;ssh&nbsp;server/&nbsp;input&nbsp;port&nbsp;443:&nbsp;my&nbsp;OpenVPN&nbsp;server):&lt;/p&gt;<br>
&lt;p&gt;&lt;/p&gt;<br>
&lt;div&gt;-P&nbsp;INPUT&nbsp;DROP&lt;/div&gt;<br>
&lt;div&gt;-P&nbsp;FORWARD&nbsp;DROP&lt;/div&gt;<br>
&lt;div&gt;-P&nbsp;OUTPUT&nbsp;DROP&lt;/div&gt;<br>
&lt;div&gt;-A&nbsp;INPUT&nbsp;-m&nbsp;state&nbsp;--state&nbsp;RELATED,ESTABLISHED&nbsp;-j&nbsp;ACCEPT&lt;/div&gt;<br>
&lt;div&gt;-A&nbsp;INPUT&nbsp;-i&nbsp;lo&nbsp;-j&nbsp;ACCEPT&lt;/div&gt;<br>
&lt;div&gt;-A&nbsp;INPUT&nbsp;-p&nbsp;tcp&nbsp;-m&nbsp;tcp&nbsp;--dport&nbsp;22&nbsp;-j&nbsp;ACCEPT&lt;/div&gt;<br>
&lt;div&gt;-A&nbsp;INPUT&nbsp;-p&nbsp;tcp&nbsp;-m&nbsp;tcp&nbsp;--dport&nbsp;53&nbsp;-j&nbsp;ACCEPT&lt;/div&gt;<br>
&lt;div&gt;-A&nbsp;INPUT&nbsp;-p&nbsp;udp&nbsp;-m&nbsp;udp&nbsp;--dport&nbsp;53&nbsp;-j&nbsp;ACCEPT&lt;/div&gt;<br>
&lt;div&gt;-A&nbsp;INPUT&nbsp;-i&nbsp;eth0&nbsp;-p&nbsp;tcp&nbsp;-m&nbsp;state&nbsp;--state&nbsp;NEW&nbsp;-m&nbsp;tcp&nbsp;--dport&nbsp;443&nbsp;-j&nbsp;ACCEPT&lt;/div&gt;<br>
&lt;div&gt;-A&nbsp;INPUT&nbsp;-i&nbsp;tun0&nbsp;-j&nbsp;ACCEPT&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;font-size:12pt&quot;&gt;-A&nbsp;FORWARD&nbsp;-i&nbsp;tun0&nbsp;-j&nbsp;ACCEPT&lt;/span&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;-A&nbsp;FORWARD&nbsp;-o&nbsp;tun0&nbsp;-j&nbsp;ACCEPT&lt;/div&gt;<br>
&lt;div&gt;-A&nbsp;FORWARD&nbsp;-i&nbsp;tun0&nbsp;-o&nbsp;eth0&nbsp;-m&nbsp;state&nbsp;--state&nbsp;RELATED,ESTABLISHED&nbsp;-j&nbsp;ACCEPT&lt;/div&gt;<br>
&lt;div&gt;-A&nbsp;FORWARD&nbsp;-i&nbsp;eth0&nbsp;-o&nbsp;tun0&nbsp;-m&nbsp;state&nbsp;--state&nbsp;RELATED,ESTABLISHED&nbsp;-j&nbsp;ACCEPT&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;font-size:12pt&quot;&gt;-A&nbsp;OUTPUT&nbsp;-m&nbsp;state&nbsp;--state&nbsp;RELATED,ESTABLISHED&nbsp;-j&nbsp;ACCEPT&lt;/span&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;-A&nbsp;OUTPUT&nbsp;-o&nbsp;lo&nbsp;-j&nbsp;ACCEPT&lt;/div&gt;<br>
&lt;div&gt;-A&nbsp;OUTPUT&nbsp;-p&nbsp;tcp&nbsp;-m&nbsp;tcp&nbsp;--dport&nbsp;22&nbsp;-j&nbsp;ACCEPT&lt;/div&gt;<br>
&lt;div&gt;-A&nbsp;OUTPUT&nbsp;-p&nbsp;tcp&nbsp;-m&nbsp;tcp&nbsp;--dport&nbsp;53&nbsp;-j&nbsp;ACCEPT&lt;/div&gt;<br>
&lt;div&gt;-A&nbsp;OUTPUT&nbsp;-p&nbsp;udp&nbsp;-m&nbsp;udp&nbsp;--dport&nbsp;53&nbsp;-j&nbsp;ACCEPT&lt;/div&gt;<br>
&lt;div&gt;-A&nbsp;OUTPUT&nbsp;-p&nbsp;tcp&nbsp;-m&nbsp;tcp&nbsp;--dport&nbsp;80&nbsp;-j&nbsp;ACCEPT&lt;/div&gt;<br>
&lt;div&gt;-A&nbsp;OUTPUT&nbsp;-p&nbsp;udp&nbsp;-m&nbsp;udp&nbsp;--dport&nbsp;123&nbsp;-j&nbsp;ACCEPT&lt;/div&gt;<br>
&lt;div&gt;-A&nbsp;OUTPUT&nbsp;-o&nbsp;tun0&nbsp;-j&nbsp;ACCEPT&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;font-size:12pt&quot;&gt;-A&nbsp;OUTPUT&nbsp;-p&nbsp;icmp&nbsp;-j&nbsp;ACCEPT&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;font-size:12pt&quot;&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;<br>
&lt;span&nbsp;style=&quot;font-family:Calibri,Arial,Helvetica,sans-serif;&nbsp;font-size:16px&quot;&gt;My&nbsp;iptable&nbsp;conf&nbsp;(nat&nbsp;table):&lt;/span&gt;&lt;br&gt;<br>
&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;font-size:12pt&quot;&gt;<br>
&lt;div&gt;-P&nbsp;PREROUTING&nbsp;ACCEPT&lt;/div&gt;<br>
&lt;div&gt;-P&nbsp;INPUT&nbsp;ACCEPT&lt;/div&gt;<br>
&lt;div&gt;-P&nbsp;OUTPUT&nbsp;ACCEPT&lt;/div&gt;<br>
&lt;div&gt;-P&nbsp;POSTROUTING&nbsp;ACCEPT&lt;/div&gt;<br>
&lt;div&gt;-A&nbsp;PREROUTING&nbsp;-s&nbsp;10.8.0.0/24&nbsp;-p&nbsp;tcp&nbsp;-m&nbsp;tcp&nbsp;--dport&nbsp;80&nbsp;-j&nbsp;REDIRECT&nbsp;--to-ports&nbsp;3129&lt;/div&gt;<br>
&lt;div&gt;-A&nbsp;PREROUTING&nbsp;-s&nbsp;10.8.0.0/24&nbsp;-p&nbsp;tcp&nbsp;-m&nbsp;tcp&nbsp;--dport&nbsp;443&nbsp;-j&nbsp;REDIRECT&nbsp;--to-ports&nbsp;3130&lt;/div&gt;<br>
&lt;div&gt;-A&nbsp;POSTROUTING&nbsp;-s&nbsp;10.8.0.0/24&nbsp;-o&nbsp;eth0&nbsp;-j&nbsp;MASQUERADE&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;<br>
&lt;div&nbsp;style=&quot;font-family:Calibri,Arial,Helvetica,sans-serif;&nbsp;font-size:16px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12pt&quot;&gt;This&nbsp;iptables&nbsp;configuration&nbsp;works&nbsp;great&nbsp;to&nbsp;route&nbsp;vpn&nbsp;input&nbsp;trafic&nbsp;into&nbsp;squid.&lt;/span&gt;&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/span&gt;&lt;/div&gt;<br>
&lt;p&gt;&lt;br&gt;<br>
&lt;/p&gt;<br>
&lt;p&gt;1st&nbsp;squid&nbsp;conf&nbsp;I've&nbsp;tried&nbsp;(based&nbsp;on&nbsp;this&nbsp;tutorial&nbsp;&lt;a&nbsp;href=&quot;http://monblog.system-linux.net/blog/2013/03/23/mettre-en-oeuvre-squid-transparent-https-sous-debian/&quot;&nbsp;id=&quot;LPlnk853063&quot;&nbsp;title=&quot;http://monblog.system-linux.net/blog/2013/03/23/mettre-en-oeuvre-squid-transparent-https-sous-debian/<br>
Ctrl&#43;Cliquer&nbsp;ou&nbsp;appuyer&nbsp;pour&nbsp;suivre&nbsp;le&nbsp;lien&quot;&gt;http://monblog.system-linux.net/blog/2013/03/23/mettre-en-oeuvre-squid-transparent-https-sous-debian/&lt;/a&gt;&nbsp;and<br>
&nbsp;others):&lt;/p&gt;<br>
&lt;p&gt;&lt;/p&gt;<br>
&lt;div&gt;#&lt;/div&gt;<br>
&lt;div&gt;#&nbsp;Recommended&nbsp;minimum&nbsp;configuration:&lt;/div&gt;<br>
&lt;div&gt;#&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;#&nbsp;Example&nbsp;rule&nbsp;allowing&nbsp;access&nbsp;from&nbsp;your&nbsp;local&nbsp;networks.&lt;/div&gt;<br>
&lt;div&gt;#&nbsp;Adapt&nbsp;to&nbsp;list&nbsp;your&nbsp;(internal)&nbsp;IP&nbsp;networks&nbsp;from&nbsp;where&nbsp;browsing&lt;/div&gt;<br>
&lt;div&gt;#&nbsp;should&nbsp;be&nbsp;allowed&lt;/div&gt;<br>
&lt;div&gt;acl&nbsp;localnet&nbsp;src&nbsp;10.8.0.0/24&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;<br>
&lt;/span&gt;#&nbsp;RFC1918&nbsp;possible&nbsp;internal&nbsp;network&lt;/div&gt;<br>
&lt;div&gt;acl&nbsp;localnet&nbsp;src&nbsp;fc00::/7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;RFC&nbsp;4193&nbsp;local&nbsp;private&nbsp;network&nbsp;range&lt;/div&gt;<br>
&lt;div&gt;acl&nbsp;localnet&nbsp;src&nbsp;fe80::/10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;RFC&nbsp;4291&nbsp;link-local&nbsp;(directly&nbsp;plugged)&nbsp;machines&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;acl&nbsp;SSL_ports&nbsp;port&nbsp;443&lt;/div&gt;<br>
&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;80&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&lt;/span&gt;<br>
#&nbsp;http&lt;/div&gt;<br>
&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;21&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&lt;/span&gt;<br>
#&nbsp;ftp&lt;/div&gt;<br>
&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;443&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;<br>
&lt;/span&gt;#&nbsp;https&lt;/div&gt;<br>
&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;70&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&lt;/span&gt;<br>
#&nbsp;gopher&lt;/div&gt;<br>
&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;210&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;<br>
&lt;/span&gt;#&nbsp;wais&lt;/div&gt;<br>
&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;1025-65535&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;<br>
&lt;/span&gt;#&nbsp;unregistered&nbsp;ports&lt;/div&gt;<br>
&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;280&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;<br>
&lt;/span&gt;#&nbsp;http-mgmt&lt;/div&gt;<br>
&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;488&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;<br>
&lt;/span&gt;#&nbsp;gss-http&lt;/div&gt;<br>
&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;591&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;<br>
&lt;/span&gt;#&nbsp;filemaker&lt;/div&gt;<br>
&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;777&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;<br>
&lt;/span&gt;#&nbsp;multiling&nbsp;http&lt;/div&gt;<br>
&lt;div&gt;acl&nbsp;CONNECT&nbsp;method&nbsp;CONNECT&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;#&lt;/div&gt;<br>
&lt;div&gt;#&nbsp;Recommended&nbsp;minimum&nbsp;Access&nbsp;Permission&nbsp;configuration:&lt;/div&gt;<br>
&lt;div&gt;#&lt;/div&gt;<br>
&lt;div&gt;#&nbsp;Deny&nbsp;requests&nbsp;to&nbsp;certain&nbsp;unsafe&nbsp;ports&lt;/div&gt;<br>
&lt;div&gt;http_access&nbsp;deny&nbsp;!Safe_ports&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;#&nbsp;Deny&nbsp;CONNECT&nbsp;to&nbsp;other&nbsp;than&nbsp;secure&nbsp;SSL&nbsp;ports&lt;/div&gt;<br>
&lt;div&gt;http_access&nbsp;deny&nbsp;CONNECT&nbsp;!SSL_ports&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;#&nbsp;Only&nbsp;allow&nbsp;cachemgr&nbsp;access&nbsp;from&nbsp;localhost&lt;/div&gt;<br>
&lt;div&gt;http_access&nbsp;allow&nbsp;localhost&nbsp;manager&lt;/div&gt;<br>
&lt;div&gt;http_access&nbsp;deny&nbsp;manager&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;#&nbsp;We&nbsp;strongly&nbsp;recommend&nbsp;the&nbsp;following&nbsp;be&nbsp;uncommented&nbsp;to&nbsp;protect&nbsp;innocent&lt;/div&gt;<br>
&lt;div&gt;#&nbsp;web&nbsp;applications&nbsp;running&nbsp;on&nbsp;the&nbsp;proxy&nbsp;server&nbsp;who&nbsp;think&nbsp;the&nbsp;only&lt;/div&gt;<br>
&lt;div&gt;#&nbsp;one&nbsp;who&nbsp;can&nbsp;access&nbsp;services&nbsp;on&nbsp;&quot;localhost&quot;&nbsp;is&nbsp;a&nbsp;local&nbsp;user&lt;/div&gt;<br>
&lt;div&gt;#http_access&nbsp;deny&nbsp;to_localhost&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;#&lt;/div&gt;<br>
&lt;div&gt;#&nbsp;INSERT&nbsp;YOUR&nbsp;OWN&nbsp;RULE(S)&nbsp;HERE&nbsp;TO&nbsp;ALLOW&nbsp;ACCESS&nbsp;FROM&nbsp;YOUR&nbsp;CLIENTS&lt;/div&gt;<br>
&lt;div&gt;#&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;#&nbsp;Example&nbsp;rule&nbsp;allowing&nbsp;access&nbsp;from&nbsp;your&nbsp;local&nbsp;networks.&lt;/div&gt;<br>
&lt;div&gt;#&nbsp;Adapt&nbsp;localnet&nbsp;in&nbsp;the&nbsp;ACL&nbsp;section&nbsp;to&nbsp;list&nbsp;your&nbsp;(internal)&nbsp;IP&nbsp;networks&lt;/div&gt;<br>
&lt;div&gt;#&nbsp;from&nbsp;where&nbsp;browsing&nbsp;should&nbsp;be&nbsp;allowed&lt;/div&gt;<br>
&lt;div&gt;http_access&nbsp;allow&nbsp;localnet&lt;/div&gt;<br>
&lt;div&gt;http_access&nbsp;allow&nbsp;localhost&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;#&nbsp;And&nbsp;finally&nbsp;deny&nbsp;all&nbsp;other&nbsp;access&nbsp;to&nbsp;this&nbsp;proxy&lt;/div&gt;<br>
&lt;div&gt;http_access&nbsp;deny&nbsp;all&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;#&nbsp;Squid&nbsp;normally&nbsp;listens&nbsp;to&nbsp;port&nbsp;3128&lt;/div&gt;<br>
&lt;div&gt;http_port&nbsp;10.8.0.1:3128&lt;/div&gt;<br>
&lt;div&gt;http_port&nbsp;10.8.0.1:3129&nbsp;transparent&lt;/div&gt;<br>
&lt;div&gt;https_port&nbsp;10.8.0.1:3130&nbsp;intercept&nbsp;ssl-bump&nbsp;key=/etc/squid/ssl_cert2/key.key&nbsp;cert=/etc/squid/ssl_cert2/cert.pem&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;#&nbsp;Uncomment&nbsp;and&nbsp;adjust&nbsp;the&nbsp;following&nbsp;to&nbsp;add&nbsp;a&nbsp;disk&nbsp;cache&nbsp;directory.&lt;/div&gt;<br>
&lt;div&gt;#cache_dir&nbsp;ufs&nbsp;/var/spool/squid&nbsp;100&nbsp;16&nbsp;256&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;#&nbsp;Leave&nbsp;coredumps&nbsp;in&nbsp;the&nbsp;first&nbsp;cache&nbsp;dir&lt;/div&gt;<br>
&lt;div&gt;coredump_dir&nbsp;/var/spool/squid&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;#&lt;/div&gt;<br>
&lt;div&gt;#&nbsp;Add&nbsp;any&nbsp;of&nbsp;your&nbsp;own&nbsp;refresh_pattern&nbsp;entries&nbsp;above&nbsp;these.&lt;/div&gt;<br>
&lt;div&gt;#&lt;/div&gt;<br>
&lt;div&gt;refresh_pattern&nbsp;^ftp:&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&lt;/span&gt;<br>
1440&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&lt;/span&gt;20%&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;<br>
&lt;/span&gt;10080&lt;/div&gt;<br>
&lt;div&gt;refresh_pattern&nbsp;^gopher:&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;<br>
&lt;/span&gt;1440&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&lt;/span&gt;0%&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;<br>
&lt;/span&gt;1440&lt;/div&gt;<br>
&lt;div&gt;refresh_pattern&nbsp;-i&nbsp;(/cgi-bin/|\?)&nbsp;0&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;<br>
&lt;/span&gt;0%&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&lt;/span&gt;0&lt;/div&gt;<br>
&lt;div&gt;refresh_pattern&nbsp;.&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&lt;/span&gt;<br>
0&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&lt;/span&gt;20%&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;<br>
&lt;/span&gt;4320&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;2nd&nbsp;conf&nbsp;I&nbsp;have&nbsp;tried&nbsp;(based&nbsp;on&nbsp;many&nbsp;tutorials&nbsp;and&nbsp;the&nbsp;official&nbsp;squid&nbsp;wiki&nbsp;especially&nbsp;to&nbsp;configure&nbsp;Ssl&nbsp;Bump/Peek&nbsp;and&nbsp;Slice&nbsp;function):&lt;/div&gt;<br>
&lt;div&gt;<br>
&lt;div&gt;#&lt;/div&gt;<br>
&lt;div&gt;#&nbsp;Recommended&nbsp;minimum&nbsp;configuration:&lt;/div&gt;<br>
&lt;div&gt;#&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;#&nbsp;Example&nbsp;rule&nbsp;allowing&nbsp;access&nbsp;from&nbsp;your&nbsp;local&nbsp;networks.&lt;/div&gt;<br>
&lt;div&gt;#&nbsp;Adapt&nbsp;to&nbsp;list&nbsp;your&nbsp;(internal)&nbsp;IP&nbsp;networks&nbsp;from&nbsp;where&nbsp;browsing&lt;/div&gt;<br>
&lt;div&gt;#&nbsp;should&nbsp;be&nbsp;allowed&lt;/div&gt;<br>
&lt;div&gt;acl&nbsp;localnet&nbsp;src&nbsp;10.8.0.0/24&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;<br>
&lt;/span&gt;#&nbsp;RFC1918&nbsp;possible&nbsp;internal&nbsp;network&lt;/div&gt;<br>
&lt;div&gt;acl&nbsp;localnet&nbsp;src&nbsp;fc00::/7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;RFC&nbsp;4193&nbsp;local&nbsp;private&nbsp;network&nbsp;range&lt;/div&gt;<br>
&lt;div&gt;acl&nbsp;localnet&nbsp;src&nbsp;fe80::/10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;RFC&nbsp;4291&nbsp;link-local&nbsp;(directly&nbsp;plugged)&nbsp;machines&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;acl&nbsp;SSL_ports&nbsp;port&nbsp;443&lt;/div&gt;<br>
&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;80&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&lt;/span&gt;<br>
#&nbsp;http&lt;/div&gt;<br>
&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;21&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&lt;/span&gt;<br>
#&nbsp;ftp&lt;/div&gt;<br>
&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;443&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;<br>
&lt;/span&gt;#&nbsp;https&lt;/div&gt;<br>
&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;70&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&lt;/span&gt;<br>
#&nbsp;gopher&lt;/div&gt;<br>
&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;210&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;<br>
&lt;/span&gt;#&nbsp;wais&lt;/div&gt;<br>
&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;1025-65535&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;<br>
&lt;/span&gt;#&nbsp;unregistered&nbsp;ports&lt;/div&gt;<br>
&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;280&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;<br>
&lt;/span&gt;#&nbsp;http-mgmt&lt;/div&gt;<br>
&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;488&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;<br>
&lt;/span&gt;#&nbsp;gss-http&lt;/div&gt;<br>
&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;591&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;<br>
&lt;/span&gt;#&nbsp;filemaker&lt;/div&gt;<br>
&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;777&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;<br>
&lt;/span&gt;#&nbsp;multiling&nbsp;http&lt;/div&gt;<br>
&lt;div&gt;acl&nbsp;CONNECT&nbsp;method&nbsp;CONNECT&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;#&lt;/div&gt;<br>
&lt;div&gt;#&nbsp;Recommended&nbsp;minimum&nbsp;Access&nbsp;Permission&nbsp;configuration:&lt;/div&gt;<br>
&lt;div&gt;#&lt;/div&gt;<br>
&lt;div&gt;#&nbsp;Deny&nbsp;requests&nbsp;to&nbsp;certain&nbsp;unsafe&nbsp;ports&lt;/div&gt;<br>
&lt;div&gt;http_access&nbsp;deny&nbsp;!Safe_ports&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;#&nbsp;Deny&nbsp;CONNECT&nbsp;to&nbsp;other&nbsp;than&nbsp;secure&nbsp;SSL&nbsp;ports&lt;/div&gt;<br>
&lt;div&gt;http_access&nbsp;deny&nbsp;CONNECT&nbsp;!SSL_ports&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;#&nbsp;Only&nbsp;allow&nbsp;cachemgr&nbsp;access&nbsp;from&nbsp;localhost&lt;/div&gt;<br>
&lt;div&gt;http_access&nbsp;allow&nbsp;localhost&nbsp;manager&lt;/div&gt;<br>
&lt;div&gt;http_access&nbsp;deny&nbsp;manager&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;#&nbsp;We&nbsp;strongly&nbsp;recommend&nbsp;the&nbsp;following&nbsp;be&nbsp;uncommented&nbsp;to&nbsp;protect&nbsp;innocent&lt;/div&gt;<br>
&lt;div&gt;#&nbsp;web&nbsp;applications&nbsp;running&nbsp;on&nbsp;the&nbsp;proxy&nbsp;server&nbsp;who&nbsp;think&nbsp;the&nbsp;only&lt;/div&gt;<br>
&lt;div&gt;#&nbsp;one&nbsp;who&nbsp;can&nbsp;access&nbsp;services&nbsp;on&nbsp;&quot;localhost&quot;&nbsp;is&nbsp;a&nbsp;local&nbsp;user&lt;/div&gt;<br>
&lt;div&gt;#http_access&nbsp;deny&nbsp;to_localhost&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;#&lt;/div&gt;<br>
&lt;div&gt;#&nbsp;INSERT&nbsp;YOUR&nbsp;OWN&nbsp;RULE(S)&nbsp;HERE&nbsp;TO&nbsp;ALLOW&nbsp;ACCESS&nbsp;FROM&nbsp;YOUR&nbsp;CLIENTS&lt;/div&gt;<br>
&lt;div&gt;#&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;#&nbsp;Example&nbsp;rule&nbsp;allowing&nbsp;access&nbsp;from&nbsp;your&nbsp;local&nbsp;networks.&lt;/div&gt;<br>
&lt;div&gt;#&nbsp;Adapt&nbsp;localnet&nbsp;in&nbsp;the&nbsp;ACL&nbsp;section&nbsp;to&nbsp;list&nbsp;your&nbsp;(internal)&nbsp;IP&nbsp;networks&lt;/div&gt;<br>
&lt;div&gt;#&nbsp;from&nbsp;where&nbsp;browsing&nbsp;should&nbsp;be&nbsp;allowed&lt;/div&gt;<br>
&lt;div&gt;http_access&nbsp;allow&nbsp;localnet&lt;/div&gt;<br>
&lt;div&gt;http_access&nbsp;allow&nbsp;localhost&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;#&nbsp;And&nbsp;finally&nbsp;deny&nbsp;all&nbsp;other&nbsp;access&nbsp;to&nbsp;this&nbsp;proxy&lt;/div&gt;<br>
&lt;div&gt;http_access&nbsp;deny&nbsp;all&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;always_direct&nbsp;allow&nbsp;all&nbsp;&lt;/div&gt;<br>
&lt;div&gt;sslproxy_cert_error&nbsp;allow&nbsp;all&lt;/div&gt;<br>
&lt;div&gt;sslproxy_cafile&nbsp;/etc/ssl/certs/ca-certificates.crt&lt;/div&gt;<br>
&lt;div&gt;sslcrtd_program&nbsp;/usr/lib/squid/ssl_crtd&nbsp;-s&nbsp;/var/lib/ssl_db&nbsp;-M&nbsp;4MB&lt;/div&gt;<br>
&lt;div&gt;#&nbsp;Squid&nbsp;normally&nbsp;listens&nbsp;to&nbsp;port&nbsp;3128&lt;/div&gt;<br>
&lt;div&gt;http_port&nbsp;10.8.0.1:3128&lt;/div&gt;<br>
&lt;div&gt;http_port&nbsp;10.8.0.1:3129&nbsp;transparent&lt;/div&gt;<br>
&lt;div&gt;https_port&nbsp;10.8.0.1:3130&nbsp;intercept&nbsp;ssl-bump&nbsp;generate-host-certificates=on&nbsp;dynamic_cert_mem_cache_size=6MB&nbsp;cert=/etc/squid/ssl_cert/myCA.pem&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;acl&nbsp;step1&nbsp;at_step&nbsp;SslBump1&lt;/div&gt;<br>
&lt;div&gt;acl&nbsp;step2&nbsp;at_step&nbsp;SslBump2&lt;/div&gt;<br>
&lt;div&gt;acl&nbsp;step3&nbsp;at_step&nbsp;SslBump3&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;ssl_bump&nbsp;peek&nbsp;step1&nbsp;all&lt;/div&gt;<br>
&lt;div&gt;ssl_bump&nbsp;stare&nbsp;step2&lt;/div&gt;<br>
&lt;div&gt;ssl_bump&nbsp;bump&nbsp;step3&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;#&nbsp;Uncomment&nbsp;and&nbsp;adjust&nbsp;the&nbsp;following&nbsp;to&nbsp;add&nbsp;a&nbsp;disk&nbsp;cache&nbsp;directory.&lt;/div&gt;<br>
&lt;div&gt;#cache_dir&nbsp;ufs&nbsp;/var/spool/squid&nbsp;100&nbsp;16&nbsp;256&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;#&nbsp;Leave&nbsp;coredumps&nbsp;in&nbsp;the&nbsp;first&nbsp;cache&nbsp;dir&lt;/div&gt;<br>
&lt;div&gt;coredump_dir&nbsp;/var/spool/squid&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;#&lt;/div&gt;<br>
&lt;div&gt;#&nbsp;Add&nbsp;any&nbsp;of&nbsp;your&nbsp;own&nbsp;refresh_pattern&nbsp;entries&nbsp;above&nbsp;these.&lt;/div&gt;<br>
&lt;div&gt;#&lt;/div&gt;<br>
&lt;div&gt;refresh_pattern&nbsp;^ftp:&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&lt;/span&gt;<br>
1440&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&lt;/span&gt;20%&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;<br>
&lt;/span&gt;10080&lt;/div&gt;<br>
&lt;div&gt;refresh_pattern&nbsp;^gopher:&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;<br>
&lt;/span&gt;1440&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&lt;/span&gt;0%&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;<br>
&lt;/span&gt;1440&lt;/div&gt;<br>
&lt;div&gt;refresh_pattern&nbsp;-i&nbsp;(/cgi-bin/|\?)&nbsp;0&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;<br>
&lt;/span&gt;0%&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&lt;/span&gt;0&lt;/div&gt;<br>
&lt;div&gt;refresh_pattern&nbsp;.&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&lt;/span&gt;<br>
0&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&lt;/span&gt;20%&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;<br>
&lt;/span&gt;4320&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;Unfortunately&nbsp;none&nbsp;of&nbsp;these&nbsp;conf&nbsp;work.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;With&nbsp;the&nbsp;first&nbsp;conf:&lt;/div&gt;<br>
&lt;div&gt;If&nbsp;i&nbsp;try&nbsp;to&nbsp;connect&nbsp;to&nbsp;&lt;a&nbsp;href=&quot;https://openclassrooms.com/&quot;&nbsp;id=&quot;LPlnk724252&quot;&gt;https://openclassrooms.com/&lt;/a&gt;&nbsp;for&nbsp;example&nbsp;I&nbsp;get&nbsp;a&nbsp;warning&nbsp;about&nbsp;that&nbsp;the&nbsp;certificate&nbsp;is&nbsp;not&nbsp;trust.&nbsp;I&nbsp;can&nbsp;overpass&nbsp;this&nbsp;warning&nbsp;(by&nbsp;clicking&nbsp;on&nbsp;&quot;continue&nbsp;on&nbsp;this&nbsp;website&nbsp;(dangerous)&quot;)<br>
&nbsp;but&nbsp;after&nbsp;few&nbsp;seconds&nbsp;I&nbsp;get&nbsp;an&nbsp;error&nbsp;generated&nbsp;by&nbsp;squid:&lt;/div&gt;<br>
&lt;div&gt;<br>
&lt;div&gt;&quot;L'erreur&nbsp;suivante&nbsp;s'est&nbsp;produite&nbsp;en&nbsp;essayant&nbsp;d'accéder&nbsp;à&nbsp;l'URL&nbsp;:&nbsp;https://openclassrooms.com/&lt;/div&gt;<br>
&lt;div&gt;La&nbsp;connexion&nbsp;190.93.240.239&nbsp;a&nbsp;échouée.&lt;/div&gt;<br>
&lt;div&gt;Le&nbsp;système&nbsp;a&nbsp;retourné&nbsp;:&nbsp;(110)&nbsp;Connection&nbsp;timed&nbsp;out&nbsp;&nbsp;&nbsp;&lt;&nbsp;-----&nbsp;Important&nbsp;line&lt;/div&gt;<br>
&lt;div&gt;L'hôte&nbsp;distant&nbsp;ou&nbsp;le&nbsp;réseau&nbsp;sont&nbsp;peut-être&nbsp;défaillant.&nbsp;Veuillez&nbsp;renouveler&nbsp;votre&nbsp;requête.&lt;/div&gt;<br>
&lt;div&gt;Votre&nbsp;administrateur&nbsp;proxy&nbsp;est&nbsp;webmaster.&quot;&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;In&nbsp;access.log&nbsp;I&nbsp;get:&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;<br>
&lt;div&gt;1459756883.952&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;42&nbsp;10.8.0.6&nbsp;TCP_MISS/200&nbsp;565&nbsp;GET&nbsp;http://www.google-analytics.com/__utm.gif?&nbsp;-&nbsp;ORIGINAL_DST/216.58.214.78&nbsp;image/gif&lt;/div&gt;<br>
&lt;div&gt;1459756885.636&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;14&nbsp;10.8.0.6&nbsp;TCP_MISS/204&nbsp;262&nbsp;GET&nbsp;http://www.gstatic.com/generate_204&nbsp;-&nbsp;ORIGINAL_DST/216.58.214.67&nbsp;-&lt;/div&gt;<br>
&lt;div&gt;1459756890.842&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;17&nbsp;10.8.0.6&nbsp;TCP_MISS/302&nbsp;505&nbsp;GET&nbsp;http://openclassrooms.com/&nbsp;-&nbsp;ORIGINAL_DST/190.93.240.239&nbsp;-&lt;/div&gt;<br>
&lt;div&gt;1459756891.129&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;14&nbsp;10.8.0.6&nbsp;TCP_MISS/204&nbsp;262&nbsp;GET&nbsp;http://www.gstatic.com/generate_204&nbsp;-&nbsp;ORIGINAL_DST/216.58.214.67&nbsp;-&lt;/div&gt;<br>
&lt;div&gt;1459756961.902&nbsp;&nbsp;60814&nbsp;10.8.0.6&nbsp;TCP_MISS/503&nbsp;4850&nbsp;GET&nbsp;https://openclassrooms.com/&nbsp;-&nbsp;ORIGINAL_DST/190.93.240.239&nbsp;text/html&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;In&nbsp;cache.log&nbsp;there&nbsp;is&nbsp;nothing&nbsp;especial.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;When&nbsp;I&nbsp;try&nbsp;to&nbsp;connect&nbsp;to&nbsp;&lt;a&nbsp;href=&quot;https://www.google.fr&quot;&nbsp;id=&quot;LPlnk244955&quot;&nbsp;title=&quot;https://www.google.fr<br>
Ctrl&#43;Cliquer&nbsp;ou&nbsp;appuyer&nbsp;pour&nbsp;suivre&nbsp;le&nbsp;lien&quot;&gt;<br>
https://www.google.fr&lt;/a&gt;&nbsp;I&nbsp;get&nbsp;a&nbsp;warning&nbsp;(from&nbsp;my&nbsp;browser,&nbsp;here&nbsp;Chrome)&nbsp;but&nbsp;I&nbsp;can't&nbsp;overpass&nbsp;it&nbsp;(due&nbsp;to&nbsp;HSTS&nbsp;technologie).&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;With&nbsp;the&nbsp;second&nbsp;conf&nbsp;(which&nbsp;is&nbsp;supposed&nbsp;to&nbsp;dynamically&nbsp;generate&nbsp;certificate&nbsp;from&nbsp;the&nbsp;original&nbsp;certificate&nbsp;to&nbsp;overpass&nbsp;HSTS&nbsp;-&nbsp;at&nbsp;least&nbsp;this&nbsp;I&nbsp;did&nbsp;think&nbsp;but&nbsp;it&nbsp;doesn't&nbsp;work):&lt;/div&gt;<br>
&lt;div&gt;Both&nbsp;of&nbsp;google&nbsp;or&nbsp;openclassroom&nbsp;websites&nbsp;generate&nbsp;the&nbsp;same&nbsp;result:&lt;/div&gt;<br>
&lt;div&gt;On&nbsp;browser&nbsp;I&nbsp;get&nbsp;a&nbsp;&lt;span&gt;ERR_TIMED_OUT.&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&gt;&lt;br&gt;<br>
&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&gt;In&nbsp;access.log:&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&gt;<br>
&lt;div&gt;1459755020.622&nbsp;&nbsp;59785&nbsp;10.8.0.6&nbsp;TAG_NONE/200&nbsp;0&nbsp;CONNECT&nbsp;46.228.47.114:443&nbsp;-&nbsp;ORIGINAL_DST/46.228.47.114&nbsp;-&lt;/div&gt;<br>
&lt;div&gt;1459755043.645&nbsp;&nbsp;60448&nbsp;10.8.0.6&nbsp;TAG_NONE/200&nbsp;0&nbsp;CONNECT&nbsp;46.228.47.115:443&nbsp;-&nbsp;ORIGINAL_DST/46.228.47.115&nbsp;-&lt;/div&gt;<br>
&lt;div&gt;1459755045.000&nbsp;&nbsp;60058&nbsp;10.8.0.6&nbsp;TAG_NONE/200&nbsp;0&nbsp;CONNECT&nbsp;216.58.211.106:443&nbsp;-&nbsp;ORIGINAL_DST/216.58.211.106&nbsp;-&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;In&nbsp;store.log&nbsp;I&nbsp;get&nbsp;SOMETIMES&nbsp;(rarely)&nbsp;this:&lt;/div&gt;<br>
&lt;div&gt;<br>
&lt;div&gt;2016/04/01&nbsp;11:43:05|&nbsp;Pinger&nbsp;exiting.&lt;/div&gt;<br>
&lt;div&gt;2016/04/01&nbsp;11:46:02&nbsp;kid1|&nbsp;Error&nbsp;negotiating&nbsp;SSL&nbsp;connection&nbsp;on&nbsp;FD&nbsp;27:&nbsp;Closed&nbsp;by&nbsp;client&lt;/div&gt;<br>
&lt;div&gt;2016/04/01&nbsp;11:46:09&nbsp;kid1|&nbsp;Error&nbsp;negotiating&nbsp;SSL&nbsp;connection&nbsp;on&nbsp;FD&nbsp;36:&nbsp;Closed&nbsp;by&nbsp;client&lt;/div&gt;<br>
&lt;div&gt;2016/04/01&nbsp;11:46:16&nbsp;kid1|&nbsp;Error&nbsp;negotiating&nbsp;SSL&nbsp;connection&nbsp;on&nbsp;FD&nbsp;30:&nbsp;Closed&nbsp;by&nbsp;client&lt;/div&gt;<br>
&lt;div&gt;2016/04/01&nbsp;11:46:23&nbsp;kid1|&nbsp;Error&nbsp;negotiating&nbsp;SSL&nbsp;connection&nbsp;on&nbsp;FD&nbsp;38:&nbsp;error:14076102:SSL&nbsp;routines:SSL23_GET_CLIENT_HELLO:unsupported&nbsp;protocol&nbsp;(1/-1)&lt;/div&gt;<br>
&lt;div&gt;2016/04/01&nbsp;11:46:31&nbsp;kid1|&nbsp;Error&nbsp;negotiating&nbsp;SSL&nbsp;connection&nbsp;on&nbsp;FD&nbsp;18:&nbsp;error:14076102:SSL&nbsp;routines:SSL23_GET_CLIENT_HELLO:unsupported&nbsp;protocol&nbsp;(1/-1)&lt;/div&gt;<br>
&lt;div&gt;2016/04/01&nbsp;11:46:38&nbsp;kid1|&nbsp;Error&nbsp;negotiating&nbsp;SSL&nbsp;connection&nbsp;on&nbsp;FD&nbsp;43:&nbsp;error:14076102:SSL&nbsp;routines:SSL23_GET_CLIENT_HELLO:unsupported&nbsp;protocol&nbsp;(1/-1)&lt;/div&gt;<br>
&lt;div&gt;2016/04/01&nbsp;11:46:46&nbsp;kid1|&nbsp;Error&nbsp;negotiating&nbsp;SSL&nbsp;connection&nbsp;on&nbsp;FD&nbsp;10:&nbsp;error:14076102:SSL&nbsp;routines:SSL23_GET_CLIENT_HELLO:unsupported&nbsp;protocol&nbsp;(1/-1)&lt;/div&gt;<br>
&lt;div&gt;2016/04/01&nbsp;11:46:54&nbsp;kid1|&nbsp;Error&nbsp;negotiating&nbsp;SSL&nbsp;connection&nbsp;on&nbsp;FD&nbsp;33:&nbsp;error:14076102:SSL&nbsp;routines:SSL23_GET_CLIENT_HELLO:unsupported&nbsp;protocol&nbsp;(1/-1)&lt;/div&gt;<br>
&lt;div&gt;2016/04/01&nbsp;11:47:32&nbsp;kid1|&nbsp;Error&nbsp;negotiating&nbsp;SSL&nbsp;connection&nbsp;on&nbsp;FD&nbsp;14:&nbsp;error:14076102:SSL&nbsp;routines:SSL23_GET_CLIENT_HELLO:unsupported&nbsp;protocol&nbsp;(1/-1)&lt;/div&gt;<br>
&lt;div&gt;2016/04/01&nbsp;11:47:40&nbsp;kid1|&nbsp;Error&nbsp;negotiating&nbsp;SSL&nbsp;connection&nbsp;on&nbsp;FD&nbsp;28:&nbsp;error:14076102:SSL&nbsp;routines:SSL23_GET_CLIENT_HELLO:unsupported&nbsp;protocol&nbsp;(1/-1)&lt;/div&gt;<br>
&lt;div&gt;2016/04/01&nbsp;11:47:48&nbsp;kid1|&nbsp;Error&nbsp;negotiating&nbsp;SSL&nbsp;connection&nbsp;on&nbsp;FD&nbsp;10:&nbsp;error:14076102:SSL&nbsp;routines:SSL23_GET_CLIENT_HELLO:unsupported&nbsp;protocol&nbsp;(1/-1)&lt;/div&gt;<br>
&lt;div&gt;2016/04/01&nbsp;11:47:55&nbsp;kid1|&nbsp;Error&nbsp;negotiating&nbsp;SSL&nbsp;connection&nbsp;on&nbsp;FD&nbsp;16:&nbsp;error:14076102:SSL&nbsp;routines:SSL23_GET_CLIENT_HELLO:unsupported&nbsp;protocol&nbsp;(1/-1)&lt;/div&gt;<br>
&lt;div&gt;2016/04/01&nbsp;11:48:03&nbsp;kid1|&nbsp;Error&nbsp;negotiating&nbsp;SSL&nbsp;connection&nbsp;on&nbsp;FD&nbsp;27:&nbsp;error:14076102:SSL&nbsp;routines:SSL23_GET_CLIENT_HELLO:unsupported&nbsp;protocol&nbsp;(1/-1)&lt;/div&gt;<br>
&lt;div&gt;2016/04/01&nbsp;11:48:54&nbsp;kid1|&nbsp;Error&nbsp;negotiating&nbsp;SSL&nbsp;connection&nbsp;on&nbsp;FD&nbsp;10:&nbsp;error:14076102:SSL&nbsp;routines:SSL23_GET_CLIENT_HELLO:unsupported&nbsp;protocol&nbsp;(1/-1)&lt;/div&gt;<br>
&lt;div&gt;2016/04/01&nbsp;11:49:01&nbsp;kid1|&nbsp;Error&nbsp;negotiating&nbsp;SSL&nbsp;connection&nbsp;on&nbsp;FD&nbsp;14:&nbsp;error:14076102:SSL&nbsp;routines:SSL23_GET_CLIENT_HELLO:unsupported&nbsp;protocol&nbsp;(1/-1)&lt;/div&gt;<br>
&lt;div&gt;2016/04/01&nbsp;11:49:08&nbsp;kid1|&nbsp;Error&nbsp;negotiating&nbsp;SSL&nbsp;connection&nbsp;on&nbsp;FD&nbsp;18:&nbsp;error:14076102:SSL&nbsp;routines:SSL23_GET_CLIENT_HELLO:unsupported&nbsp;protocol&nbsp;(1/-1)&lt;/div&gt;<br>
&lt;div&gt;2016/04/01&nbsp;11:49:15&nbsp;kid1|&nbsp;Error&nbsp;negotiating&nbsp;SSL&nbsp;connection&nbsp;on&nbsp;FD&nbsp;28:&nbsp;error:14076102:SSL&nbsp;routines:SSL23_GET_CLIENT_HELLO:unsupported&nbsp;protocol&nbsp;(1/-1)&lt;/div&gt;<br>
&lt;div&gt;2016/04/01&nbsp;11:49:24&nbsp;kid1|&nbsp;Error&nbsp;negotiating&nbsp;SSL&nbsp;connection&nbsp;on&nbsp;FD&nbsp;36:&nbsp;error:14076102:SSL&nbsp;routines:SSL23_GET_CLIENT_HELLO:unsupported&nbsp;protocol&nbsp;(1/-1)&lt;/div&gt;<br>
&lt;div&gt;2016/04/01&nbsp;11:49:31&nbsp;kid1|&nbsp;Error&nbsp;negotiating&nbsp;SSL&nbsp;connection&nbsp;on&nbsp;FD&nbsp;38:&nbsp;Closed&nbsp;by&nbsp;client&lt;/div&gt;<br>
&lt;div&gt;2016/04/01&nbsp;11:49:38&nbsp;kid1|&nbsp;Error&nbsp;negotiating&nbsp;SSL&nbsp;connection&nbsp;on&nbsp;FD&nbsp;40:&nbsp;Closed&nbsp;by&nbsp;client&lt;/div&gt;<br>
&lt;div&gt;2016/04/01&nbsp;11:49:45&nbsp;kid1|&nbsp;Error&nbsp;negotiating&nbsp;SSL&nbsp;connection&nbsp;on&nbsp;FD&nbsp;53:&nbsp;Closed&nbsp;by&nbsp;client&lt;/div&gt;<br>
&lt;div&gt;2016/04/01&nbsp;11:49:53&nbsp;kid1|&nbsp;Error&nbsp;negotiating&nbsp;SSL&nbsp;connection&nbsp;on&nbsp;FD&nbsp;59:&nbsp;error:14076102:SSL&nbsp;routines:SSL23_GET_CLIENT_HELLO:unsupported&nbsp;protocol&nbsp;(1/-1)&lt;/div&gt;<br>
&lt;div&gt;2016/04/01&nbsp;12:22:55&nbsp;kid1|&nbsp;Logfile:&nbsp;opening&nbsp;log&nbsp;stdio:/var/log/squid/netdb.state&lt;/div&gt;<br>
&lt;div&gt;2016/04/01&nbsp;12:22:55&nbsp;kid1|&nbsp;Logfile:&nbsp;closing&nbsp;log&nbsp;stdio:/var/log/squid/netdb.state&lt;/div&gt;<br>
&lt;div&gt;2016/04/01&nbsp;12:22:55&nbsp;kid1|&nbsp;NETDB&nbsp;state&nbsp;saved;&nbsp;4&nbsp;entries,&nbsp;0&nbsp;msec&lt;/div&gt;<br>
&lt;div&gt;2016/04/01&nbsp;13:04:35&nbsp;kid1|&nbsp;Logfile:&nbsp;opening&nbsp;log&nbsp;stdio:/var/log/squid/netdb.state&lt;/div&gt;<br>
&lt;div&gt;2016/04/01&nbsp;13:04:35&nbsp;kid1|&nbsp;Logfile:&nbsp;closing&nbsp;log&nbsp;stdio:/var/log/squid/netdb.state&lt;/div&gt;<br>
&lt;div&gt;2016/04/01&nbsp;13:04:35&nbsp;kid1|&nbsp;NETDB&nbsp;state&nbsp;saved;&nbsp;4&nbsp;entries,&nbsp;0&nbsp;msec&lt;/div&gt;<br>
&lt;div&gt;2016/04/01&nbsp;13:54:40&nbsp;kid1|&nbsp;Logfile:&nbsp;opening&nbsp;log&nbsp;stdio:/var/log/squid/netdb.state&lt;/div&gt;<br>
&lt;div&gt;2016/04/01&nbsp;13:54:40&nbsp;kid1|&nbsp;Logfile:&nbsp;closing&nbsp;log&nbsp;stdio:/var/log/squid/netdb.state&lt;/div&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;Whatever&nbsp;configuration&nbsp;that&nbsp;I&nbsp;used&nbsp;I&nbsp;have&nbsp;import&nbsp;certificate&nbsp;into&nbsp;my&nbsp;browser&nbsp;correctly.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;Can&nbsp;you&nbsp;help&nbsp;me&nbsp;??&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;Thanks&nbsp;in&nbsp;advance&nbsp;and&nbsp;sorry&nbsp;if&nbsp;my&nbsp;English&nbsp;is&nbsp;not&nbsp;perfect.&nbsp;I&nbsp;can&nbsp;send&nbsp;you&nbsp;any&nbsp;other&nbsp;informations&nbsp;that&nbsp;you&nbsp;would&nbsp;need.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:Calibri,sans-serif;&nbsp;font-size:16px&quot;&gt;Best&nbsp;regards,&lt;/span&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;Raph&lt;/div&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;&lt;/div&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;br&gt;<br>
&lt;p&gt;&lt;/p&gt;<br>
&lt;p&gt;&lt;br&gt;<br>
&lt;/p&gt;<br>
&lt;/div&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
