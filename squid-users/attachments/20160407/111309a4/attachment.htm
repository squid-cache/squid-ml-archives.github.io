<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;7&nbsp;April&nbsp;2016&nbsp;at&nbsp;19:35,&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&nbsp;target=&quot;_blank&quot;&gt;rousskov@measurement-factory.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;On&nbsp;04/07/2016&nbsp;08:21&nbsp;AM,&nbsp;Odhiambo&nbsp;Washington&nbsp;wrote:&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;&quot;&gt;&lt;br&gt;<br>
&gt;&nbsp;On&nbsp;7&nbsp;April&nbsp;2016&nbsp;at&nbsp;17:16,&nbsp;Amos&nbsp;Jeffries&nbsp;wrote:&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; On&nbsp;7/04/2016&nbsp;3:16&nbsp;a.m.,&nbsp;Odhiambo&nbsp;Washington&nbsp;wrote:&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;I&nbsp;am&nbsp;getting&nbsp;the&nbsp;following&nbsp;error&nbsp;in&nbsp;cache.log:&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;Squid&nbsp;Cache&nbsp;(Version&nbsp;3.5.16):&nbsp;Terminated&nbsp;abnormally.&lt;br&gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&gt; &nbsp; &nbsp; &gt;&nbsp;FATAL:&nbsp;Ipc::Mem::Segment::create&nbsp;failed&nbsp;to&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;shm_open(/opt/squid-3.5/var/run/squid/cf__metadata.shm):&nbsp;(17)&nbsp;File&nbsp;exists&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;However,&nbsp;that&nbsp;file&nbsp;doesn&#39;t&nbsp;exist.&lt;br&gt;<br>
&lt;br&gt;<br>
&gt; &nbsp; &nbsp; This&nbsp;can&nbsp;happen&nbsp;if&nbsp;you&nbsp;have&nbsp;a&nbsp;startup&nbsp;script&nbsp;the&nbsp;runs&nbsp;&#39;squid&nbsp;-z&#39;&nbsp;or&lt;br&gt;<br>
&gt; &nbsp; &nbsp; similar&nbsp;just&nbsp;prior&nbsp;to&nbsp;starting&nbsp;the&nbsp;main&nbsp;proxy,&nbsp;and&nbsp;not&nbsp;waiting&lt;br&gt;<br>
&gt; &nbsp; &nbsp; sufficiently&nbsp;long&nbsp;for&nbsp;the&nbsp;-z&nbsp;run&nbsp;to&nbsp;finish.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&gt;&nbsp;I&nbsp;am&nbsp;gonna&nbsp;check&nbsp;this&nbsp;out&nbsp;again&nbsp;tonight&nbsp;although&nbsp;I&nbsp;doubt&nbsp;if&nbsp;that&nbsp;is&nbsp;the&lt;br&gt;<br>
&gt;&nbsp;cause.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;run&nbsp;squid&nbsp;using&nbsp;daemontools,&nbsp;invoked&nbsp;as:&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;exec&nbsp;setuidgid&nbsp;root&nbsp;/opt/squid-3.5/sbin/squid&nbsp;-f&lt;br&gt;<br>
&gt;&nbsp;/opt/squid-3.5/etc/squid.conf&nbsp;-N&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;/opt/squid-3.5/var/run/squid/&nbsp;is&nbsp;actually&nbsp;empty&nbsp;when&nbsp;I&nbsp;get&nbsp;this&nbsp;error.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;I&nbsp;see&nbsp;two&nbsp;possibilities:&lt;br&gt;<br>
&lt;br&gt;<br>
1.&nbsp;The&nbsp;file&nbsp;was&nbsp;there&nbsp;at&nbsp;the&nbsp;time&nbsp;the&nbsp;error&nbsp;was&nbsp;triggered&nbsp;but&nbsp;was&nbsp;not&lt;br&gt;<br>
there&nbsp;at&nbsp;the&nbsp;time&nbsp;you&nbsp;checked&nbsp;the&nbsp;directory.&nbsp;This&nbsp;would&nbsp;mean&nbsp;that&lt;br&gt;<br>
something&nbsp;is&nbsp;starting&nbsp;a&nbsp;second&nbsp;Squid&nbsp;while&nbsp;the&nbsp;first&nbsp;Squid&nbsp;has&nbsp;not&lt;br&gt;<br>
removed&nbsp;the&nbsp;shared&nbsp;memory&nbsp;segment&nbsp;file&nbsp;(yet).&nbsp;Amos&nbsp;mentioned&nbsp;one&nbsp;such&lt;br&gt;<br>
common&nbsp;scenario&nbsp;(not&nbsp;waiting&nbsp;for&nbsp;background&nbsp;squid-z)&nbsp;but&nbsp;there&nbsp;are&lt;br&gt;<br>
others,&nbsp;possibly&nbsp;including&nbsp;handling&nbsp;of&nbsp;Squid&nbsp;crashes.&nbsp;Do&nbsp;you&nbsp;see&nbsp;any&lt;br&gt;<br>
other&nbsp;errors,&nbsp;assertions,&nbsp;or&nbsp;FATAL&nbsp;messages&nbsp;in&nbsp;your&nbsp;cache.log?&lt;br&gt;<br>
&lt;br&gt;<br>
2.&nbsp;Squid&nbsp;code&nbsp;that&nbsp;is&nbsp;trying&nbsp;to&nbsp;open&nbsp;the&nbsp;shared&nbsp;segment&nbsp;is&nbsp;broken&nbsp;or,&lt;br&gt;<br>
more&nbsp;likely,&nbsp;not&nbsp;compatible&nbsp;with&nbsp;your&nbsp;FreeBSD&nbsp;environment.&nbsp;For&nbsp;example,&lt;br&gt;<br>
it&nbsp;tries&nbsp;to&nbsp;exclusively&nbsp;create&nbsp;a&nbsp;shared&nbsp;segment&nbsp;using&nbsp;the&nbsp;wrong&nbsp;name.&lt;br&gt;<br>
&lt;br&gt;<br>
If&nbsp;you&nbsp;can&nbsp;reproduce&nbsp;this,&nbsp;I&nbsp;recommend&nbsp;starting&nbsp;Squid&nbsp;via&nbsp;strace&nbsp;(or&lt;br&gt;<br>
equivalent)&nbsp;to&nbsp;see&nbsp;the&nbsp;system&nbsp;calls&nbsp;that&nbsp;Squid&nbsp;is&nbsp;making&nbsp;when&nbsp;calling&lt;br&gt;<br>
shm_open()&nbsp;and&nbsp;the&nbsp;exact&nbsp;call&nbsp;parameters.&nbsp;This&nbsp;can&nbsp;confirm&nbsp;or&nbsp;eliminate&lt;br&gt;<br>
#2&nbsp;as&nbsp;the&nbsp;suspect.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
HTH,&lt;br&gt;<br>
&lt;br&gt;<br>
Alex.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;All&nbsp;I&nbsp;get&nbsp;from&nbsp;running strace&nbsp;-ff&nbsp;-vvv&nbsp;-o&nbsp;/tmp/squid-strace.txt&nbsp;/opt/squid-3.5/sbin/squid&nbsp;-f&nbsp;/opt/squid-3.5/etc/squid.conf:&lt;/div&gt;&lt;div&gt;..&lt;/div&gt;&lt;div&gt;pread:&nbsp;Device&nbsp;busy&lt;/div&gt;&lt;div&gt;pread:&nbsp;Device&nbsp;busy&lt;/div&gt;&lt;div&gt;pread:&nbsp;Device&nbsp;busy&lt;/div&gt;&lt;div&gt;pread:&nbsp;Device&nbsp;busy&lt;/div&gt;&lt;div&gt;pread:&nbsp;Device&nbsp;busy&lt;/div&gt;&lt;div&gt;pread:&nbsp;Device&nbsp;busy&lt;/div&gt;&lt;div&gt;pread:&nbsp;Device&nbsp;busy&lt;/div&gt;&lt;div&gt;pread:&nbsp;Device&nbsp;busy&lt;/div&gt;&lt;div&gt;pread:&nbsp;Device&nbsp;busy&lt;/div&gt;&lt;div&gt;pread:&nbsp;Device&nbsp;busy&lt;/div&gt;&lt;div&gt;pread:&nbsp;Device&nbsp;busy&lt;/div&gt;&lt;div&gt;pread:&nbsp;Device&nbsp;busy&lt;/div&gt;&lt;div&gt;PIOCRUN:&nbsp;Input/output&nbsp;error&lt;/div&gt;&lt;div&gt;trouble&nbsp;opening&nbsp;proc&nbsp;file &lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;--&nbsp;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_signature&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;Best&nbsp;regards,&lt;br&gt;Odhiambo&nbsp;WASHINGTON,&lt;br&gt;Nairobi,KE&lt;br&gt;+254&nbsp;7&nbsp;3200&nbsp;0004/+254&nbsp;7&nbsp;2274&nbsp;3223&lt;br&gt;&quot;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;Oh,&nbsp;the&nbsp;cruft.&lt;/span&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;&quot;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/div&gt;&lt;/div&gt;<br>

</tt>
