<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hello,&lt;br&gt;I&nbsp;had&nbsp;a&nbsp;squid&nbsp;(3.5.15)&nbsp;instance&nbsp;(named&nbsp;t1)&nbsp;in&nbsp;reverse-proxy&nbsp;mode:&lt;br&gt;&lt;br&gt;http_port&nbsp;80&nbsp;accel&lt;br&gt;cache_peer&nbsp;&lt;a&nbsp;href=&quot;http://up.example.com&quot;&gt;up.example.com&lt;/a&gt;&nbsp;parent&nbsp;80&nbsp;0&nbsp;default&nbsp;no-query&nbsp;no-digest&nbsp;no-netdb-exchange&nbsp;originserver&nbsp;name=origin&lt;br&gt;&lt;br&gt;It&nbsp;works&nbsp;great,&nbsp;no&nbsp;problems&nbsp;so&nbsp;far.&lt;br&gt;&lt;br&gt;Now&nbsp;I&nbsp;wanted&nbsp;to&nbsp;add&nbsp;an&nbsp;instance&nbsp;(named&nbsp;t2),&nbsp;having&nbsp;both&nbsp;in&nbsp;sibling&nbsp;relation&nbsp;(cache&nbsp;hierarchy):&lt;br&gt;&lt;br&gt;on&nbsp;t1:&lt;br&gt;http_port&nbsp;80&nbsp;accel&lt;br&gt;cache_peer&nbsp;&lt;a&nbsp;href=&quot;http://up.example.com&quot;&gt;up.example.com&lt;/a&gt;&nbsp;parent&nbsp;80&nbsp;0&nbsp;default&nbsp;no-query&nbsp;no-digest&nbsp;no-netdb-exchange&nbsp;originserver&lt;br&gt;cache_peer&nbsp;t2&nbsp;sibling&nbsp;80&nbsp;4827&nbsp;htcp&nbsp;no-digest&lt;br&gt;&lt;br&gt;on&nbsp;t2:&lt;br&gt;http_port&nbsp;80&nbsp;accel&lt;br&gt;cache_peer&nbsp;&lt;a&nbsp;href=&quot;http://up.example.com&quot;&gt;up.example.com&lt;/a&gt;&nbsp;parent&nbsp;80&nbsp;0&nbsp;default&nbsp;no-query&nbsp;no-digest&nbsp;no-netdb-exchange&nbsp;originserver&lt;br&gt;cache_peer&nbsp;t1&nbsp;sibling&nbsp;80&nbsp;4827&nbsp;htcp&nbsp;no-digest&lt;br&gt;&lt;br&gt;Since&nbsp;t1&nbsp;had&nbsp;many&nbsp;files&nbsp;cached,&nbsp;t2&nbsp;started&nbsp;pulling&nbsp;files&nbsp;from&nbsp;t1,&nbsp;but&nbsp;sometimes,&nbsp;the&nbsp;following&nbsp;error&nbsp;occurs.&lt;br&gt;&lt;br&gt;Client&nbsp;request&nbsp;from&nbsp;t2:&lt;br&gt;GET&nbsp;/test.zip&nbsp;HTTP/1.1&lt;br&gt;User-Agent:&nbsp;Wget/1.17.1&nbsp;(linux-gnu)&lt;br&gt;Accept:&nbsp;*/*&lt;br&gt;Accept-Encoding:&nbsp;identity&lt;br&gt;Host:&nbsp;&lt;a&nbsp;href=&quot;http://cache.example.com&quot;&gt;cache.example.com&lt;/a&gt;&lt;br&gt;Connection:&nbsp;Keep-Alive&lt;br&gt;&lt;br&gt;t2&nbsp;asks&nbsp;t1&nbsp;via&nbsp;htcp:&lt;br&gt;GET&nbsp;&lt;a&nbsp;href=&quot;http://cache.example.com/test.zip&quot;&gt;http://cache.example.com/test.zip&lt;/a&gt;&lt;br&gt;User-Agent:&nbsp;Wget/1.17.1&nbsp;(linux-gnu)&lt;br&gt;Accept:&nbsp;*/*&lt;br&gt;Accept-Encoding:&nbsp;identity&lt;br&gt;Host:&nbsp;&lt;a&nbsp;href=&quot;http://cache.example.com&quot;&gt;cache.example.com&lt;/a&gt;&lt;br&gt;Via:&nbsp;1.1&nbsp;t2&nbsp;(squid/3.5.15)&lt;br&gt;Surrogate-Capability:&nbsp;t2=&quot;Surrogate/1.0&quot;&lt;br&gt;X-Forwarded-For:&nbsp;1.2.3.4&lt;br&gt;Cache-Control:&nbsp;max-age=259200&lt;br&gt;&lt;br&gt;t1&nbsp;replies&nbsp;to&nbsp;htcp&nbsp;with:&lt;br&gt;Age:&nbsp;782932&lt;br&gt;Expires:&nbsp;Sat,&nbsp;01&nbsp;Oct&nbsp;2016&nbsp;09:07:09&nbsp;GMT&lt;br&gt;Last-Modified:&nbsp;Sun,&nbsp;15&nbsp;Nov&nbsp;2015&nbsp;00:09:20&nbsp;GMT&lt;br&gt;Cache-to-Origin:&nbsp;&lt;a&nbsp;href=&quot;http://cache.example.com&quot;&gt;cache.example.com&lt;/a&gt;&nbsp;1&nbsp;0.001000&nbsp;1&lt;br&gt;&lt;br&gt;then&nbsp;t2&nbsp;requests&nbsp;the&nbsp;file&nbsp;from&nbsp;t1&nbsp;via&nbsp;http:&lt;br&gt;GET&nbsp;&lt;a&nbsp;href=&quot;http://cache.example.com/test.zip&quot;&gt;http://cache.example.com/test.zip&lt;/a&gt;&nbsp;HTTP/1.1&lt;br&gt;User-Agent:&nbsp;Wget/1.17.1&nbsp;(linux-gnu)&lt;br&gt;Accept:&nbsp;*/*&lt;br&gt;Accept-Encoding:&nbsp;identity&lt;br&gt;Host:&nbsp;&lt;a&nbsp;href=&quot;http://cache.example.com&quot;&gt;cache.example.com&lt;/a&gt;&lt;br&gt;Via:&nbsp;1.1&nbsp;t2&nbsp;(squid/3.5.15)&lt;br&gt;Surrogate-Capability:&nbsp;t2=&quot;Surrogate/1.0&quot;&lt;br&gt;X-Forwarded-For:&nbsp;1.2.3.4&lt;br&gt;Cache-Control:&nbsp;max-age=259200,&nbsp;only-if-cached&lt;br&gt;Connection:&nbsp;keep-alive&lt;br&gt;&lt;br&gt;and&nbsp;t1&nbsp;replies&nbsp;with&nbsp;504:&lt;br&gt;HTTP/1.1&nbsp;504&nbsp;Gateway&nbsp;Timeout&lt;br&gt;Server:&nbsp;squid/3.5.15&lt;br&gt;Mime-Version:&nbsp;1.0&lt;br&gt;Date:&nbsp;Wed,&nbsp;13&nbsp;Apr&nbsp;2016&nbsp;10:36:01&nbsp;GMT&lt;br&gt;Content-Type:&nbsp;text/html;charset=utf-8&lt;br&gt;Content-Length:&nbsp;4182&lt;br&gt;X-Squid-Error:&nbsp;ERR_ONLY_IF_CACHED_MISS&nbsp;0&lt;br&gt;Vary:&nbsp;Accept-Language&lt;br&gt;Content-Language:&nbsp;en&lt;br&gt;Age:&nbsp;1460543762&lt;br&gt;Warning:&nbsp;113&nbsp;t1&nbsp;(squid/3.5.15)&nbsp;This&nbsp;cache&nbsp;hit&nbsp;is&nbsp;still&nbsp;fresh&nbsp;and&nbsp;more&nbsp;than&nbsp;1&nbsp;day&nbsp;old&lt;br&gt;Warning:&nbsp;110&nbsp;squid/3.5.15&nbsp;&quot;Response&nbsp;is&nbsp;stale&quot;&lt;br&gt;Warning:&nbsp;111&nbsp;squid/3.5.15&nbsp;&quot;Revalidation&nbsp;failed&quot;&lt;br&gt;X-Cache:&nbsp;HIT&nbsp;from&nbsp;t1&lt;br&gt;X-Cache-Lookup:&nbsp;HIT&nbsp;from&nbsp;t1:80&lt;br&gt;Via:&nbsp;1.1&nbsp;t1&nbsp;(squid/3.5.15)&lt;br&gt;Connection:&nbsp;keep-alive&lt;br&gt;&lt;br&gt;I&nbsp;checked&nbsp;upstream&nbsp;(&lt;a&nbsp;href=&quot;http://up.example.com&quot;&gt;up.example.com&lt;/a&gt;)&nbsp;and&nbsp;there&nbsp;was&nbsp;no&nbsp;connection&nbsp;attempt.&nbsp;Tried&nbsp;with&nbsp;ICP/HTCP,&nbsp;same&nbsp;result.&nbsp;I&#39;m&nbsp;not&nbsp;sure,&nbsp;is&nbsp;this&nbsp;bug&nbsp;&lt;a&nbsp;href=&quot;http://bugs.squid-cache.org/show_bug.cgi?id=4223&quot;&gt;http://bugs.squid-cache.org/show_bug.cgi?id=4223&lt;/a&gt;?&lt;br&gt;&lt;br&gt;Thanks,&lt;br&gt;Tomas&nbsp;Mozes&lt;br&gt;&lt;/div&gt;<br>

</tt>
