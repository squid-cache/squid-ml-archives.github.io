<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;am&nbsp;trying&nbsp;my&nbsp;hands&nbsp;on&nbsp;ssl_bump&nbsp;and&nbsp;it&#39;s&nbsp;almost&nbsp;working,&nbsp;but&nbsp;that&#39;s&nbsp;ish-ish..&nbsp;because&nbsp;I&nbsp;have&nbsp;several&nbsp;problems.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;even&nbsp;wonder&nbsp;if&nbsp;this&nbsp;config&nbsp;is&nbsp;correct:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;b&gt;acl&nbsp;step1&nbsp;at_step&nbsp;SslBump1&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;acl&nbsp;step2&nbsp;at_step&nbsp;SslBump2&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;acl&nbsp;step3&nbsp;at_step&nbsp;SslBump3&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;&lt;br&gt;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;acl&nbsp;ssl_bump_broken_sites&nbsp; dstdomain&nbsp;&quot;/usr/local/etc/squid/ssl_bump_broken_sites.txt&quot;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;ssl_bump&nbsp;none&nbsp;ssl_bump_broken_sites&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;&lt;br&gt;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;&lt;br&gt;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;acl&nbsp;step1&nbsp;at_step&nbsp;SslBump1&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;ssl_bump&nbsp;peek&nbsp;step1&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;ssl_bump&nbsp;stare&nbsp;step2&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;ssl_bump&nbsp;bump&nbsp;all&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;&lt;br&gt;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;sslproxy_capath&nbsp;/etc/ssl/certs&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;sslproxy_cert_error&nbsp;allow&nbsp;all&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;#sslproxy_cert_error&nbsp;deny&nbsp;all&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;sslproxy_flags&nbsp;DONT_VERIFY_PEER&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;sslproxy_cafile&nbsp;/usr/local/share/certs/ca-root-nss.crt&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;cut&gt; &lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;lang=&quot;EN-US&quot;&nbsp;link=&quot;#0563C1&quot;&nbsp;vlink=&quot;#954F72&quot;&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;u&gt;&lt;/u&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-size:9pt;font-family:Verdana,sans-serif;color:rgb(30,30,30)&quot;&gt;The&nbsp;following&nbsp;error&nbsp;was&nbsp;encountered&nbsp;while&nbsp;trying&nbsp;to&nbsp;retrieve&nbsp;the&nbsp;URL: &lt;a&nbsp;href=&quot;https://org.ke.m-pesa.com/*&quot;&nbsp;target=&quot;_blank&quot;&gt;&lt;span&nbsp;style=&quot;color:blue&quot;&gt;https://org.ke.m-pesa.com/*&lt;/span&gt;&lt;/a&gt;&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;b&gt;&lt;span&nbsp;style=&quot;font-size:9pt;font-family:Verdana,sans-serif;color:rgb(30,30,30)&quot;&gt;Failed&nbsp;to&nbsp;establish&nbsp;a&nbsp;secure&nbsp;connection&nbsp;to&nbsp;196.201.214.212&lt;/span&gt;&lt;/b&gt;&lt;span&nbsp;style=&quot;font-size:9pt;font-family:Verdana,sans-serif;color:rgb(30,30,30)&quot;&gt;&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-size:9pt;font-family:Verdana,sans-serif;color:rgb(30,30,30)&quot;&gt;The&nbsp;system&nbsp;returned:&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-size:10pt;font-family:Arial,sans-serif;color:rgb(30,30,30)&quot;&gt;(92)&nbsp;Protocol&nbsp;error&nbsp;(TLS&nbsp;code:&nbsp;SQUID_ERR_SSL_HANDSHAKE)&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-size:9pt;font-family:Verdana,sans-serif;color:rgb(30,30,30)&quot;&gt;Handshake&nbsp;with&nbsp;SSL&nbsp;server&nbsp;failed:&nbsp;error:14094412:SSL&nbsp;routines:SSL3_READ_BYTES:sslv3&nbsp;alert&nbsp;bad&nbsp;certificate&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-size:9pt;font-family:Verdana,sans-serif;color:rgb(30,30,30)&quot;&gt;This&nbsp;proxy&nbsp;and&nbsp;the&nbsp;remote&nbsp;host&nbsp;failed&nbsp;to&nbsp;negotiate&nbsp;a&nbsp;mutually&nbsp;acceptable&nbsp;security&nbsp;settings&nbsp;for&nbsp;handling&nbsp;your&nbsp;request.&nbsp;It&nbsp;is&nbsp;possible&nbsp;that&nbsp;the&nbsp;remote&nbsp;host&nbsp;does&nbsp;not&nbsp;support&nbsp;secure&nbsp;connections,&nbsp;or&nbsp;the&nbsp;proxy&nbsp;is&nbsp;not&nbsp;satisfied&nbsp;with&nbsp;the&nbsp;host&nbsp;security&nbsp;credentials.&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-size:9pt;font-family:Verdana,sans-serif;color:rgb(30,30,30)&quot;&gt;Your&nbsp;cache&nbsp;administrator&nbsp;is &lt;a&nbsp;href=&quot;mailto:%3codhiambo@gmail.com%3e?subject=CacheErrorInfo%20-%20ERR_SECURE_CONNECT_FAIL&amp;body=CacheHost%3A%20gw.crownkenya.com%0D%0AErrPage%3A%20ERR_SECURE_CONNECT_FAIL%0D%0AErr%3A%20(92)%20Protocol%20error%0D%0ATimeStamp%3A%20Wed,%2020%20Apr%202016%2013%3A22%3A02%20GMT%0D%0A%0D%0AClientIP%3A%20192.168.54.63%0D%0AServerIP%3A%20196.201.214.212%0D%0A%0D%0AHTTP%20Request%3A%0D%0ACONNECT%20%2F%20HTTP%2F1.1%0AHost%3A%20196.201.214.212%3A443%0D%0A%0D%0A%0D%0A&quot;&nbsp;target=&quot;_blank&quot;&gt;&lt;span&nbsp;style=&quot;color:blue&quot;&gt;&lt;odhiambo@gmail.com&gt;&lt;/span&gt;&lt;/a&gt;.&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-size:9pt;font-family:Verdana,sans-serif;color:rgb(30,30,30)&quot;&gt;&lt;/cut&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-size:9pt;font-family:Verdana,sans-serif;color:rgb(30,30,30)&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;I&nbsp;thought&nbsp;I&nbsp;could&nbsp;mitigate&nbsp;that&nbsp;with&nbsp;the:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;b&gt;acl&nbsp;ssl_bump_broken_sites&nbsp; dstdomain&nbsp;&quot;/usr/local/etc/squid/ssl_bump_broken_sites.txt&quot;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;ssl_bump&nbsp;none&nbsp;ssl_bump_broken_sites&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;&lt;br&gt;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;..but&nbsp;that&nbsp;doesn&#39;t&nbsp;do&nbsp;it...&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Secondly,&nbsp;I&nbsp;had&nbsp;to&nbsp;import&nbsp;my&nbsp;CA&nbsp;to&nbsp;all&nbsp;devices&nbsp;(as&nbsp;a&nbsp;trusted&nbsp;CA)&nbsp;on&nbsp;the&nbsp;network&nbsp;so&nbsp;that&nbsp;they&nbsp;don&#39;t&nbsp;get&nbsp;the&nbsp;MITM&nbsp;notification.&nbsp;This&nbsp;is&nbsp;a&nbsp;challenge,&nbsp;because&nbsp;I&nbsp;have&nbsp;to&nbsp;do&nbsp;the&nbsp;same&nbsp;for&nbsp;smart&nbsp;phones&nbsp;too,&nbsp;and&nbsp;that&nbsp;is&nbsp;not&nbsp;easy.&nbsp;People&nbsp;don&#39;t&nbsp;like&nbsp;intrusive&nbsp;changes.&nbsp;For&nbsp;example&nbsp;on&nbsp;Android&nbsp;phone,&nbsp;you&nbsp;have&nbsp;to&nbsp;set&nbsp;screen&nbsp;security&nbsp;before&nbsp;you&nbsp;can&nbsp;import&nbsp;such&nbsp;a&nbsp;CA,&nbsp;and&nbsp;after&nbsp;you&nbsp;do,&nbsp;you&nbsp;cannot&nbsp;disable&nbsp;the&nbsp;screen&nbsp;security!&nbsp;Now,&nbsp;that&nbsp;is&nbsp;not&nbsp;something&nbsp;people&nbsp;want.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Another&nbsp;issue&nbsp;is&nbsp;that&nbsp;we&nbsp;allow&nbsp;guests&nbsp;who&nbsp;come&nbsp;in&nbsp;to&nbsp;the&nbsp;premises&nbsp;to&nbsp;use&nbsp;our&nbsp;Wi-Fi&nbsp;(on&nbsp;a&nbsp;different&nbsp;SSID).&nbsp;Without&nbsp;them&nbsp;importing&nbsp;the&nbsp;CA,&nbsp;they&nbsp;get&nbsp;the&nbsp;MITM&nbsp;notification&nbsp;and&nbsp;cannot&nbsp;browse.&nbsp;This&nbsp;is&nbsp;because&nbsp;they&nbsp;get&nbsp;assigned&nbsp;IPs&nbsp;in&nbsp;the&nbsp;same&nbsp;subnet&nbsp;we&nbsp;use&nbsp;in&nbsp;the&nbsp;office.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;--&nbsp;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_signature&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;Best&nbsp;regards,&lt;br&gt;Odhiambo&nbsp;WASHINGTON,&lt;br&gt;Nairobi,KE&lt;br&gt;+254&nbsp;7&nbsp;3200&nbsp;0004/+254&nbsp;7&nbsp;2274&nbsp;3223&lt;br&gt;&quot;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;Oh,&nbsp;the&nbsp;cruft.&lt;/span&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;&quot;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/div&gt;&lt;/div&gt;<br>

</tt>
