<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Wow&nbsp;that&nbsp;worked!&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks!&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Fri,&nbsp;May&nbsp;6,&nbsp;2016&nbsp;at&nbsp;5:00&nbsp;PM,&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&nbsp;target=&quot;_blank&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;On&nbsp;6/05/2016&nbsp;5:51&nbsp;p.m.,&nbsp;Victor&nbsp;Hugo&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;Here&#39;s&nbsp;a&nbsp;strange&nbsp;one&nbsp;for&nbsp;you&nbsp;though,&nbsp;if&nbsp;I&nbsp;change:&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;whitelist-regex&nbsp;url_regex&nbsp;-i&nbsp;&lt;a&nbsp;href=&quot;http://reddit.com/r/news&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;reddit.com/r/news&lt;/a&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;to:&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;whitelist-regex&nbsp;url_regex&nbsp;-i&nbsp;reddit\.com\/r\/news&nbsp;www\.reddit\.com\:443&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;it&nbsp;works&nbsp;every&nbsp;2nd&nbsp;time&nbsp;but&nbsp;the&nbsp;match&nbsp;is&nbsp;too&nbsp;greedy&nbsp;and&nbsp;allows&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;http://www.reddit.com/r/anything&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;www.reddit.com/r/anything&lt;/a&gt;&nbsp;every&nbsp;2nd&nbsp;time.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;That&nbsp;first&nbsp;regex&nbsp;pattern&nbsp;requires&nbsp;a&nbsp;path&nbsp;&quot;/r/news&quot;&nbsp;to&nbsp;exist.&nbsp;CONNECT&lt;br&gt;<br>
messages&nbsp;do&nbsp;not&nbsp;have&nbsp;paths.&lt;br&gt;<br>
&lt;br&gt;<br>
That&nbsp;second&nbsp;pattern&nbsp;you&nbsp;are&nbsp;now&nbsp;adding&nbsp;matches&nbsp;(and&nbsp;thus&nbsp;allows)&nbsp;the&lt;br&gt;<br>
CONNECT&nbsp;message&nbsp;authority-URI&nbsp;built&nbsp;from&nbsp;the&nbsp;traffic&nbsp;SNI&nbsp;details.&lt;br&gt;<br>
&lt;br&gt;<br>
They&nbsp;are&nbsp;two&nbsp;different&nbsp;regex&nbsp;patterns&nbsp;so&nbsp;if&nbsp;*either&nbsp;one*&nbsp;matches&nbsp;the&nbsp;ACL&lt;br&gt;<br>
test&nbsp;will&nbsp;be&nbsp;a&nbsp;match.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Try&nbsp;adding&nbsp;this&nbsp;line&nbsp;*after*&nbsp;the&nbsp;default&nbsp;&quot;deny&nbsp;CONNECT&nbsp;!SSL_ports&quot;&nbsp;line:&lt;br&gt;<br>
 acl&nbsp;reddit&nbsp;dstdomain&nbsp;.&lt;a&nbsp;href=&quot;http://reddit.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;reddit.com&lt;/a&gt;&lt;br&gt;<br>
 http_access&nbsp;allow&nbsp;CONNECT&nbsp;SSL_ports&nbsp;reddit&lt;br&gt;<br>
&lt;br&gt;<br>
That&nbsp;should&nbsp;allow&nbsp;the&nbsp;CONNECT&#39;s&nbsp;stuff&nbsp;to&nbsp;happen&nbsp;and&nbsp;your&nbsp;ssl_bump&nbsp;and&lt;br&gt;<br>
http_access&nbsp;rules&nbsp;then&nbsp;handle&nbsp;the&nbsp;HTTPS.&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
Amos&lt;br&gt;<br>
&lt;/font&gt;&lt;/span&gt;&lt;div&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;Victor&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;it&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;On&nbsp;Thu,&nbsp;Feb&nbsp;11,&nbsp;2016&nbsp;at&nbsp;10:05&nbsp;AM,&nbsp;Victor&nbsp;Hugo&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:fourtrials@gmail.com&quot;&gt;fourtrials@gmail.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;Hi,&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;I&nbsp;was&nbsp;wondering&nbsp;if&nbsp;it&nbsp;is&nbsp;possible&nbsp;to&nbsp;filter&nbsp;HTTPS&nbsp;URLs&nbsp;using&nbsp;squid&nbsp;(for&lt;br&gt;<br>
&gt;&gt;&nbsp;example&nbsp;to&nbsp;blacklist&nbsp;&lt;a&nbsp;href=&quot;http://reddit.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;reddit.com&lt;/a&gt;&nbsp;but&nbsp;allow&nbsp;&lt;a&nbsp;href=&quot;https://www.reddit.com/r/news/&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://www.reddit.com/r/news/&lt;/a&gt;)?&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;I&nbsp;thought&nbsp;this&nbsp;may&nbsp;be&nbsp;possible&nbsp;using&nbsp;ssl_bump&nbsp;and&nbsp;url_regex.&nbsp;I&nbsp;have&nbsp;been&lt;br&gt;<br>
&gt;&gt;&nbsp;trying&nbsp;this&nbsp;using&nbsp;squid&nbsp;3.5.13&nbsp;but&nbsp;with&nbsp;no&nbsp;success.&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;Here&nbsp;is&nbsp;the&nbsp;squid&nbsp;configuration&nbsp;that&nbsp;I&nbsp;have&nbsp;tried&nbsp;but&nbsp;doesn&#39;t&nbsp;seem&nbsp;to&nbsp;work&lt;br&gt;<br>
&gt;&gt;&nbsp;(it&nbsp;works&nbsp;for&nbsp;http&nbsp;sites&nbsp;though):&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;localnet&nbsp;src&nbsp;&lt;a&nbsp;href=&quot;http://10.0.0.0/8&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;10.0.0.0/8&lt;/a&gt;&nbsp;#&nbsp;RFC1918&nbsp;possible&nbsp;internal&nbsp;network&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;localnet&nbsp;src&nbsp;&lt;a&nbsp;href=&quot;http://172.16.0.0/12&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;172.16.0.0/12&lt;/a&gt;&nbsp;#&nbsp;RFC1918&nbsp;possible&nbsp;internal&nbsp;network&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;localnet&nbsp;src&nbsp;&lt;a&nbsp;href=&quot;http://192.168.0.0/16&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;192.168.0.0/16&lt;/a&gt;&nbsp;#&nbsp;RFC1918&nbsp;possible&nbsp;internal&nbsp;network&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;localnet&nbsp;src&nbsp;fc00::/7 &nbsp; &nbsp; &nbsp; #&nbsp;RFC&nbsp;4193&nbsp;local&nbsp;private&nbsp;network&nbsp;range&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;localnet&nbsp;src&nbsp;fe80::/10 &nbsp; &nbsp; &nbsp;#&nbsp;RFC&nbsp;4291&nbsp;link-local&nbsp;(directly&nbsp;plugged)&lt;br&gt;<br>
&gt;&gt;&nbsp;machines&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;SSL_ports&nbsp;port&nbsp;443&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;80&nbsp;#&nbsp;http&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;21&nbsp;#&nbsp;ftp&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;443&nbsp;#&nbsp;https&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;70&nbsp;#&nbsp;gopher&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;210&nbsp;#&nbsp;wais&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;1025-65535&nbsp;#&nbsp;unregistered&nbsp;ports&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;280&nbsp;#&nbsp;http-mgmt&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;488&nbsp;#&nbsp;gss-http&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;591&nbsp;#&nbsp;filemaker&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;777&nbsp;#&nbsp;multiling&nbsp;http&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;CONNECT&nbsp;method&nbsp;CONNECT&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;http_access&nbsp;deny&nbsp;!Safe_ports&lt;br&gt;<br>
&gt;&gt;&nbsp;http_access&nbsp;deny&nbsp;CONNECT&nbsp;!SSL_ports&lt;br&gt;<br>
&gt;&gt;&nbsp;http_access&nbsp;allow&nbsp;localhost&nbsp;manager&lt;br&gt;<br>
&gt;&gt;&nbsp;http_access&nbsp;deny&nbsp;manager&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;whitelist-regex&nbsp;url_regex&nbsp;-i&nbsp;&lt;a&nbsp;href=&quot;http://reddit.com/r/news&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;reddit.com/r/news&lt;/a&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;http_port&nbsp;3129&nbsp;ssl-bump&lt;br&gt;<br>
&gt;&gt;&nbsp;cert=/opt/squid-3.5.13/etc/squid3/ssl_cert/myCA.pem&lt;br&gt;<br>
&gt;&gt;&nbsp;generate-host-certificates=on&nbsp;dynamic_cert_mem_cache_size=4MB&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;bump_sites&nbsp;ssl::server_name&nbsp;.&lt;a&nbsp;href=&quot;http://reddit.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;reddit.com&lt;/a&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;ssl_bump&nbsp;bump&nbsp;bump_sites&lt;br&gt;<br>
&gt;&gt;&nbsp;ssl_bump&nbsp;splice&nbsp;!bump_sites&lt;br&gt;<br>
&gt;&gt;&nbsp;http_access&nbsp;allow&nbsp;whitelist-regex&lt;br&gt;<br>
&gt;&gt;&nbsp;http_access&nbsp;allow&nbsp;localhost&lt;br&gt;<br>
&gt;&gt;&nbsp;http_access&nbsp;deny&nbsp;all&lt;br&gt;<br>
&gt;&gt;&nbsp;coredump_dir&nbsp;/opt/squid-3.5.13/var/spool/squid3&lt;br&gt;<br>
&gt;&gt;&nbsp;refresh_pattern&nbsp;^ftp:&nbsp;1440&nbsp;20%&nbsp;10080&lt;br&gt;<br>
&gt;&gt;&nbsp;refresh_pattern&nbsp;^gopher:&nbsp;1440&nbsp;0%&nbsp;1440&lt;br&gt;<br>
&gt;&gt;&nbsp;refresh_pattern&nbsp;-i&nbsp;(/cgi-bin/|\?)&nbsp;0&nbsp;0%&nbsp;0&lt;br&gt;<br>
&gt;&gt;&nbsp;refresh_pattern&nbsp;.&nbsp;0&nbsp;20%&nbsp;4320&lt;br&gt;<br>
&gt;&gt;&nbsp;pinger_enable&nbsp;off&lt;br&gt;<br>
&gt;&gt;&nbsp;Relevant&nbsp;access.log&nbsp;output&nbsp;(IP&nbsp;addresses&nbsp;redacted&nbsp;to&nbsp;x.x.x.x):&lt;br&gt;<br>
&gt;&gt;&nbsp;1455145755.589 &nbsp; &nbsp; &nbsp;0&nbsp;x.x.x.x&nbsp;TCP_DENIED/200&nbsp;0&nbsp;CONNECT&nbsp;&lt;a&nbsp;href=&quot;http://www.reddit.com:443&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;www.reddit.com:443&lt;/a&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;-&nbsp;HIER_NONE/-&nbsp;-&lt;br&gt;<br>
&gt;&gt;&nbsp;1455145755.669 &nbsp; &nbsp; &nbsp;0&nbsp;x.x.x.x&nbsp;TAG_NONE/403&nbsp;4011&nbsp;GET&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;a&nbsp;href=&quot;https://www.reddit.com/r/news&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://www.reddit.com/r/news&lt;/a&gt;&nbsp;-&nbsp;HIER_NONE/-&nbsp;text/html&lt;br&gt;<br>
&gt;&gt;&nbsp;1455145755.782 &nbsp; &nbsp; &nbsp;0&nbsp;x.x.x.x&nbsp;TCP_DENIED/200&nbsp;0&nbsp;CONNECT&nbsp;&lt;a&nbsp;href=&quot;http://www.reddit.com:443&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;www.reddit.com:443&lt;/a&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;-&nbsp;HIER_NONE/-&nbsp;-&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;I&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;whitelist&nbsp;the&nbsp;dstdomain&nbsp;.&lt;a&nbsp;href=&quot;http://reddit.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;reddit.com&lt;/a&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;(i.e&nbsp;whitelist-ssldomain&nbsp;dstdomain&nbsp;.&lt;a&nbsp;href=&quot;http://reddit.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;reddit.com&lt;/a&gt;)&nbsp;as&nbsp;that&nbsp;would&nbsp;allow&lt;br&gt;<br>
&gt;&gt;&nbsp;access&nbsp;to&nbsp;all&nbsp;of&nbsp;the&nbsp;other&nbsp;subreddits.&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;Appreciate&nbsp;any&nbsp;help&nbsp;or&nbsp;suggestions&nbsp;you&nbsp;have.&nbsp;Thanks.&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;Victor&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
