<tt>
&lt;html&gt;<br>
&nbsp;&nbsp;&lt;head&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&nbsp;http-equiv=&quot;Content-Type&quot;&gt;<br>
&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&lt;body&nbsp;bgcolor=&quot;#FFFFFF&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;Hi&nbsp;guys&lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;I&nbsp;just&nbsp;enabled&nbsp;&quot;collapsed_forwarding&quot; &nbsp;and&nbsp;noticed&nbsp;a&nbsp;lot&nbsp;of&nbsp;&quot;Vary<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;object&nbsp;loop!&quot;&nbsp;that&nbsp;wasn't&nbsp;there&nbsp;before..&lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;2016/05/12&nbsp;19:17:22&nbsp;kid3|&nbsp;varyEvaluateMatch:&nbsp;Oops.&nbsp;Not&nbsp;a&nbsp;Vary<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;on&nbsp;second&nbsp;attempt,<br>
'&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://ego.globo.com/paparazzo/noticia/2016/05/tulio-maravilha-fala-de-video-intimo-com-mulher-gente-ve-e-deleta.html&quot;&gt;http://ego.globo.com/paparazzo/noticia/2016/05/tulio-maravilha-fala-de-video-intimo-com-mulher-gente-ve-e-deleta.html&lt;/a&gt;'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'accept-encoding=&quot;gzip,%20deflate,%20sdch&quot;,<br>
user-agent=&quot;Mozilla%2F5.0%20(Windows%20NT%206.1)%20AppleWebKit%2F537.36%20(KHTML,%20like%20Gecko)%20Chrome%2F50.0.2661.102%20Safari%2F537.36&quot;'&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2016/05/12&nbsp;19:17:22&nbsp;kid3|&nbsp;clientProcessHit:&nbsp;Vary&nbsp;object&nbsp;loop!&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2016/05/12&nbsp;19:17:22&nbsp;kid3|&nbsp;varyEvaluateMatch:&nbsp;Oops.&nbsp;Not&nbsp;a&nbsp;Vary<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;on&nbsp;second&nbsp;attempt,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://ego.globo.com/fonts/typography.css&quot;&gt;http://ego.globo.com/fonts/typography.css&lt;/a&gt;'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'accept-encoding=&quot;gzip,%20deflate,%20sdch&quot;,<br>
user-agent=&quot;Mozilla%2F5.0%20(Windows%20NT%206.1)%20AppleWebKit%2F537.36%20(KHTML,%20like%20Gecko)%20Chrome%2F50.0.2661.102%20Safari%2F537.36&quot;'&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2016/05/12&nbsp;19:17:22&nbsp;kid3|&nbsp;clientProcessHit:&nbsp;Vary&nbsp;object&nbsp;loop!&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2016/05/12&nbsp;19:17:22&nbsp;kid3|&nbsp;varyEvaluateMatch:&nbsp;Oops.&nbsp;Not&nbsp;a&nbsp;Vary<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;on&nbsp;second&nbsp;attempt,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://ego.globo.com/dynamo/scripts/js/glb.recaptcha.js&quot;&gt;http://ego.globo.com/dynamo/scripts/js/glb.recaptcha.js&lt;/a&gt;'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'accept-encoding=&quot;gzip,%20deflate,%20sdch&quot;,<br>
user-agent=&quot;Mozilla%2F5.0%20(Windows%20NT%206.1)%20AppleWebKit%2F537.36%20(KHTML,%20like%20Gecko)%20Chrome%2F50.0.2661.102%20Safari%2F537.36&quot;'&lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;I&nbsp;don't&nbsp;know&nbsp;if&nbsp;it's&nbsp;helping&nbsp;with&nbsp;the&nbsp;segmented&nbsp;downloads&nbsp;(that<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this&nbsp;thread&nbsp;is&nbsp;about...)&nbsp;though.&lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;Best&nbsp;Regards,&lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;class=&quot;moz-signature&quot;&nbsp;cols=&quot;72&quot;&gt;--&nbsp;<br>
Heiler&nbsp;Bemerguy&nbsp;-&nbsp;(91)&nbsp;98151-4894<br>
Assessor&nbsp;Técnico&nbsp;-&nbsp;CINBESA&nbsp;(91)&nbsp;3184-1751&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;class=&quot;moz-cite-prefix&quot;&gt;Em&nbsp;12/05/2016&nbsp;18:21,&nbsp;Alex&nbsp;Rousskov<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;escreveu:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;cite=&quot;mid:5734F3D6.2020205@measurement-factory.com&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;On&nbsp;05/12/2016&nbsp;02:36&nbsp;PM,&nbsp;Amos&nbsp;Jeffries&nbsp;wrote:<br>
<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;Have&nbsp;you&nbsp;given&nbsp;collapsed_forwarding&nbsp;a&nbsp;try?&nbsp;Its&nbsp;supposed&nbsp;to&nbsp;prevent&nbsp;all<br>
the&nbsp;duplicate&nbsp;requests&nbsp;making&nbsp;all&nbsp;those&nbsp;extra&nbsp;upstream&nbsp;connections&nbsp;unti<br>
at&nbsp;least&nbsp;the&nbsp;first&nbsp;one&nbsp;has&nbsp;finished&nbsp;getting&nbsp;the&nbsp;object.<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;<br>
For&nbsp;the&nbsp;record,&nbsp;collapsed&nbsp;forwarding&nbsp;collapses&nbsp;requests&nbsp;_before_&nbsp;there<br>
is&nbsp;any&nbsp;response&nbsp;[header],&nbsp;not&nbsp;after&nbsp;the&nbsp;&quot;first&quot;&nbsp;request&nbsp;got&nbsp;the&nbsp;object<br>
[body].&nbsp;Once&nbsp;there&nbsp;is&nbsp;a&nbsp;response&nbsp;[header],&nbsp;the&nbsp;usual&nbsp;caching&nbsp;code&nbsp;path<br>
kicks&nbsp;in&nbsp;and&nbsp;no&nbsp;collapsing&nbsp;is&nbsp;needed.<br>
<br>
Cache&nbsp;hits&nbsp;on&nbsp;that&nbsp;&quot;usual&nbsp;caching&nbsp;code&nbsp;path&quot;&nbsp;read&nbsp;from&nbsp;a&nbsp;&quot;public&quot;&nbsp;cache<br>
entry.&nbsp;Normally,&nbsp;those&nbsp;public&nbsp;entries&nbsp;are&nbsp;created&nbsp;when&nbsp;Squid&nbsp;receives&nbsp;a<br>
response&nbsp;[header].&nbsp;Collapsed&nbsp;forwarding&nbsp;creates&nbsp;that&nbsp;entry&nbsp;before&nbsp;Squids<br>
gets&nbsp;the&nbsp;response&nbsp;[header],&nbsp;and,&nbsp;hence,&nbsp;before&nbsp;Squid&nbsp;can&nbsp;know&nbsp;for&nbsp;sure<br>
whether&nbsp;the&nbsp;response&nbsp;is&nbsp;going&nbsp;to&nbsp;be&nbsp;cachable,&nbsp;with&nbsp;all&nbsp;the&nbsp;risks&nbsp;that<br>
entails.<br>
<br>
<br>
Please&nbsp;do&nbsp;not&nbsp;misinterpret&nbsp;my&nbsp;email&nbsp;as&nbsp;a&nbsp;recommendation&nbsp;to&nbsp;give&nbsp;(or&nbsp;not<br>
to&nbsp;give)&nbsp;collapsed&nbsp;forwarding&nbsp;a&nbsp;try.&nbsp;I&nbsp;have&nbsp;_not_&nbsp;analyzed&nbsp;the&nbsp;problems<br>
discussed&nbsp;on&nbsp;this&nbsp;thread.&nbsp;I&nbsp;just&nbsp;wanted&nbsp;to&nbsp;correct&nbsp;the&nbsp;description<br>
above.&nbsp;Nothing&nbsp;more.<br>
<br>
<br>
HTH,<br>
<br>
Alex.<br>
<br>
_______________________________________________<br>
squid-users&nbsp;mailing&nbsp;list<br>
&lt;a&nbsp;class=&quot;moz-txt-link-abbreviated&quot;&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;<br>
&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
