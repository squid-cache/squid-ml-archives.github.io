<tt>
&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;div&nbsp;style=&quot;color:#000;&nbsp;background-color:#fff;&nbsp;font-family:HelveticaNeue-Light,&nbsp;Helvetica&nbsp;Neue&nbsp;Light,&nbsp;Helvetica&nbsp;Neue,&nbsp;Helvetica,&nbsp;Arial,&nbsp;Lucida&nbsp;Grande,&nbsp;sans-serif;font-size:16px&quot;&gt;&lt;div&nbsp;id=&quot;yui_3_16_0_ym19_1_1464992752115_16871&quot;&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(20,&nbsp;20,&nbsp;20);&nbsp;font-family:&nbsp;verdana,&nbsp;sans-serif;&nbsp;font-size:&nbsp;14.6667px;&nbsp;line-height:&nbsp;20.5333px;&quot;&nbsp;id=&quot;yui_3_16_0_ym19_1_1464992752115_16872&quot;&gt;So&nbsp;I&nbsp;have&nbsp;squid&nbsp;(latest)&nbsp;running&nbsp;in&nbsp;a&nbsp;a&nbsp;jail,&nbsp;and&nbsp;I&nbsp;am&nbsp;able&nbsp;to&nbsp;use&nbsp;it&nbsp;communicate&nbsp;with&nbsp;it&nbsp;via&nbsp;the&nbsp;browser.&nbsp;But&nbsp;I&nbsp;am&nbsp;trying&nbsp;to&nbsp;set&nbsp;it&nbsp;up&nbsp;so&nbsp;that&nbsp;I&nbsp;can&nbsp;use&nbsp;a&nbsp;proxy.pac&nbsp;file.&nbsp;I&nbsp;have&nbsp;the&nbsp;proxy.pac&nbsp;configured.&nbsp;Firefox&nbsp;is&nbsp;being&nbsp;used&nbsp;as&nbsp;my&nbsp;testbed.&nbsp;When&nbsp;I&nbsp;switch&nbsp;over&nbsp;the&nbsp;pac&nbsp;file&nbsp;I&nbsp;get&nbsp;nothing&nbsp;in&nbsp;the&nbsp;logs.&nbsp;Not&nbsp;sure&nbsp;why.&nbsp;&nbsp;&nbsp;Below&nbsp;is&nbsp;my&nbsp;config.&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:&nbsp;Calibri,&nbsp;sans-serif;&quot;&nbsp;id=&quot;yui_3_16_0_ym19_1_1464992752115_16873&quot;&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(20,&nbsp;20,&nbsp;20);&nbsp;font-family:&nbsp;verdana,&nbsp;sans-serif;&nbsp;font-size:&nbsp;14.6667px;&nbsp;line-height:&nbsp;20.5333px;&quot;&nbsp;id=&quot;yui_3_16_0_ym19_1_1464992752115_16874&quot;&gt;&lt;br&nbsp;id=&quot;yui_3_16_0_ym19_1_1464992752115_16875&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:&nbsp;Calibri,&nbsp;sans-serif;&quot;&nbsp;dir=&quot;ltr&quot;&nbsp;id=&quot;yui_3_16_0_ym19_1_1464992752115_16876&quot;&gt;&lt;pre&nbsp;style=&quot;padding:&nbsp;10px;&nbsp;font-family:&nbsp;Consolas,&nbsp;&quot;Courier&nbsp;New&quot;,&nbsp;Courier,&nbsp;monospace;&nbsp;line-height:&nbsp;1.24;&nbsp;word-wrap:&nbsp;normal;&nbsp;font-size:&nbsp;10pt;&nbsp;border-radius:&nbsp;5px;&nbsp;overflow:&nbsp;auto;&nbsp;min-height:&nbsp;30px;&nbsp;max-height:&nbsp;500px;&nbsp;direction:&nbsp;ltr;&nbsp;color:&nbsp;rgb(20,&nbsp;20,&nbsp;20);&quot;&nbsp;id=&quot;yui_3_16_0_ym19_1_1464992752115_16877&quot;&gt;root@proxy:/usr/local/etc/squid&nbsp;#&nbsp;cat&nbsp;squid.conf<br>
#<br>
#&nbsp;Recommended&nbsp;minimum&nbsp;configuration:<br>
#<br>
<br>
#&nbsp;Example&nbsp;rule&nbsp;allowing&nbsp;access&nbsp;from&nbsp;your&nbsp;local&nbsp;networks.<br>
#&nbsp;Adapt&nbsp;to&nbsp;list&nbsp;your&nbsp;(internal)&nbsp;IP&nbsp;networks&nbsp;from&nbsp;where&nbsp;browsing<br>
#&nbsp;should&nbsp;be&nbsp;allowed<br>
acl&nbsp;localnet&nbsp;src&nbsp;10.0.0.0/8&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;RFC1918&nbsp;possible&nbsp;internal&nbsp;network<br>
acl&nbsp;localnet&nbsp;src&nbsp;172.16.0.0/12&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;RFC1918&nbsp;possible&nbsp;internal&nbsp;network<br>
acl&nbsp;localnet&nbsp;src&nbsp;192.168.0.0/16&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;RFC1918&nbsp;possible&nbsp;internal&nbsp;network<br>
acl&nbsp;localnet&nbsp;src&nbsp;fc00::/7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;RFC&nbsp;4193&nbsp;local&nbsp;private&nbsp;network&nbsp;range<br>
acl&nbsp;localnet&nbsp;src&nbsp;fe80::/10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;RFC&nbsp;4291&nbsp;link-local&nbsp;(directly&nbsp;plugged)&nbsp;machines<br>
<br>
acl&nbsp;SSL_ports&nbsp;port&nbsp;443<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;80&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;http<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;21&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;ftp<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;443&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;https<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;70&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;gopher<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;210&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;wais<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;1025-65535&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;unregistered&nbsp;ports<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;280&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;http-mgmt<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;488&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;gss-http<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;591&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;filemaker<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;777&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;multiling&nbsp;http<br>
acl&nbsp;CONNECT&nbsp;method&nbsp;CONNECT<br>
<br>
acl&nbsp;our_networks&nbsp;src&nbsp;10.150.1.0/24<br>
#<br>
#&nbsp;Recommended&nbsp;minimum&nbsp;Access&nbsp;Permission&nbsp;configuration:<br>
#<br>
#&nbsp;Deny&nbsp;requests&nbsp;to&nbsp;certain&nbsp;unsafe&nbsp;ports<br>
http_access&nbsp;deny&nbsp;!Safe_ports<br>
<br>
#&nbsp;Deny&nbsp;CONNECT&nbsp;to&nbsp;other&nbsp;than&nbsp;secure&nbsp;SSL&nbsp;ports<br>
http_access&nbsp;deny&nbsp;CONNECT&nbsp;!SSL_ports<br>
<br>
#&nbsp;Only&nbsp;allow&nbsp;cachemgr&nbsp;access&nbsp;from&nbsp;localhost<br>
http_access&nbsp;allow&nbsp;localhost&nbsp;manager&nbsp;our_networks<br>
http_access&nbsp;deny&nbsp;manager<br>
<br>
#&nbsp;We&nbsp;strongly&nbsp;recommend&nbsp;the&nbsp;following&nbsp;be&nbsp;uncommented&nbsp;to&nbsp;protect&nbsp;innocent<br>
#&nbsp;web&nbsp;applications&nbsp;running&nbsp;on&nbsp;the&nbsp;proxy&nbsp;server&nbsp;who&nbsp;think&nbsp;the&nbsp;only<br>
#&nbsp;one&nbsp;who&nbsp;can&nbsp;access&nbsp;services&nbsp;on&nbsp;&quot;localhost&quot;&nbsp;is&nbsp;a&nbsp;local&nbsp;user<br>
#http_access&nbsp;deny&nbsp;to_localhost<br>
<br>
#<br>
#&nbsp;INSERT&nbsp;YOUR&nbsp;OWN&nbsp;RULE(S)&nbsp;HERE&nbsp;TO&nbsp;ALLOW&nbsp;ACCESS&nbsp;FROM&nbsp;YOUR&nbsp;CLIENTS<br>
#<br>
<br>
#&nbsp;Example&nbsp;rule&nbsp;allowing&nbsp;access&nbsp;from&nbsp;your&nbsp;local&nbsp;networks.<br>
#&nbsp;Adapt&nbsp;localnet&nbsp;in&nbsp;the&nbsp;ACL&nbsp;section&nbsp;to&nbsp;list&nbsp;your&nbsp;(internal)&nbsp;IP&nbsp;networks<br>
#&nbsp;from&nbsp;where&nbsp;browsing&nbsp;should&nbsp;be&nbsp;allowed<br>
http_access&nbsp;allow&nbsp;localnet<br>
http_access&nbsp;allow&nbsp;localhost<br>
<br>
#&nbsp;And&nbsp;finally&nbsp;deny&nbsp;all&nbsp;other&nbsp;access&nbsp;to&nbsp;this&nbsp;proxy<br>
http_access&nbsp;deny&nbsp;all<br>
<br>
#&nbsp;Squid&nbsp;normally&nbsp;listens&nbsp;to&nbsp;port&nbsp;3128<br>
http_port&nbsp;3128<br>
<br>
#&nbsp;Uncomment&nbsp;and&nbsp;adjust&nbsp;the&nbsp;following&nbsp;to&nbsp;add&nbsp;a&nbsp;disk&nbsp;cache&nbsp;directory.<br>
#cache_dir&nbsp;ufs&nbsp;/var/squid/cache&nbsp;100&nbsp;16&nbsp;256<br>
<br>
#&nbsp;Leave&nbsp;coredumps&nbsp;in&nbsp;the&nbsp;first&nbsp;cache&nbsp;dir<br>
coredump_dir&nbsp;/var/squid/cache<br>
<br>
#<br>
#&nbsp;Add&nbsp;any&nbsp;of&nbsp;your&nbsp;own&nbsp;refresh_pattern&nbsp;entries&nbsp;above&nbsp;these.<br>
#<br>
refresh_pattern&nbsp;^ftp:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1440&nbsp;&nbsp;&nbsp;&nbsp;20%&nbsp;&nbsp;&nbsp;&nbsp;10080<br>
refresh_pattern&nbsp;^gopher:&nbsp;&nbsp;&nbsp;&nbsp;1440&nbsp;&nbsp;&nbsp;&nbsp;0%&nbsp;&nbsp;&nbsp;&nbsp;1440<br>
refresh_pattern&nbsp;-i&nbsp;(/cgi-bin/|\?)&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;0%&nbsp;&nbsp;&nbsp;&nbsp;0<br>
refresh_pattern&nbsp;.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;20%&nbsp;&nbsp;&nbsp;&nbsp;4320<br>
<br>
visible_hostname&nbsp;proxy01.borg.local<br>
<br>
access_log&nbsp;/var/log/squid/access.log&nbsp;squid<br>
#logformat&nbsp;custom&nbsp;%{%Y-%m-%d&nbsp;%H:%M:%S}tl&nbsp;%03tu&nbsp;%&gt;a&nbsp;%tr&nbsp;%ul&nbsp;%ui&nbsp;%&gt;Hs&nbsp;%mt&nbsp;%rm&nbsp;%ru&nbsp;%rv&nbsp;%st&nbsp;%Sh&nbsp;%Ss<br>
logformat&nbsp;squid&nbsp;%tl&nbsp;%6tr&nbsp;%&gt;a&nbsp;%Ss/%03Hs&nbsp;%&lt;st&nbsp;%rm&nbsp;%ru&nbsp;%un&nbsp;%Sh/%&lt;A&nbsp;%mt<br>
client_db&nbsp;on<br>
dns_defnames&nbsp;on<br>
httpd_suppress_version_string&nbsp;on<br>
retry_on_error&nbsp;on<br>
uri_whitespace&nbsp;strip<br>
strip_query_terms&nbsp;off<br>
#pipeline_prefetch&nbsp;on<br>
<br>
cache&nbsp;deny&nbsp;all<br>
#cache_dir&nbsp;null&nbsp;/tmp<br>
ident_lookup_access&nbsp;deny&nbsp;all<br>
<br>
##&nbsp;disable&nbsp;ads&nbsp;(&nbsp;&lt;a&nbsp;href=&quot;http://pgl.yoyo.org/adservers/&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;nofollow&quot;&nbsp;style=&quot;color:&nbsp;rgb(102,&nbsp;0,&nbsp;0);&nbsp;text-decoration:&nbsp;none;&nbsp;border-radius:&nbsp;5px;&nbsp;padding-right:&nbsp;3px;&nbsp;padding-left:&nbsp;3px;&quot;&nbsp;id=&quot;yui_3_16_0_ym19_1_1464992752115_16878&quot;&gt;http://pgl.yoyo.org/adservers/&lt;/a&gt;&nbsp;)<br>
acl&nbsp;adsites&nbsp;url_regex&nbsp;-i&nbsp;&quot;/usr/local/etc/squid/ad_block.txt&quot;<br>
http_access&nbsp;deny&nbsp;adsites<br>
deny_info&nbsp;&lt;a&nbsp;href=&quot;http://proxy.borg.local/blocked.html&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;nofollow&quot;&nbsp;style=&quot;color:&nbsp;rgb(102,&nbsp;0,&nbsp;0);&nbsp;text-decoration:&nbsp;none;&nbsp;border-radius:&nbsp;5px;&nbsp;padding-right:&nbsp;3px;&nbsp;padding-left:&nbsp;3px;&quot;&nbsp;id=&quot;yui_3_16_0_ym19_1_1464992752115_16879&quot;&gt;http://proxy.borg.local/blocked.html&lt;/a&gt;&nbsp;adsites<br>
root@proxy:/usr/local/etc/squid&nbsp;#&nbsp;<br>
<br>
Proxy.pac<br>
<br>
function&nbsp;FindProxyForURL(url,&nbsp;host)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;//Don't&nbsp;proxy&nbsp;connections&nbsp;to&nbsp;the&nbsp;UTM&nbsp;web&nbsp;interface<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(shExpMatch(url,&nbsp;&quot;&lt;a&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;nofollow&quot;&nbsp;style=&quot;color:&nbsp;rgb(102,&nbsp;0,&nbsp;0);&nbsp;text-decoration:&nbsp;none;&nbsp;border-radius:&nbsp;5px;&nbsp;padding-right:&nbsp;3px;&nbsp;padding-left:&nbsp;3px;&quot;&nbsp;id=&quot;yui_3_16_0_ym19_1_1464992752115_16880&quot;&nbsp;href=&quot;&quot;&gt;https://${asg_hostname}*&lt;/a&gt;&quot;))&nbsp;return&nbsp;&quot;DIRECT&quot;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(shExpMatch(url,&nbsp;&quot;https://&quot;&nbsp;+&nbsp;dnsResolve(host)&nbsp;+&nbsp;&quot;*&quot;))&nbsp;return&nbsp;&quot;DIRECT&quot;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;//Exclude&nbsp;non-fqdn&nbsp;hosts&nbsp;from&nbsp;being&nbsp;proxied<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(isPlainHostName(host))&nbsp;return&nbsp;&quot;DIRECT&quot;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;//Don't&nbsp;proxy&nbsp;connections&nbsp;to&nbsp;the&nbsp;exempted&nbsp;URL&nbsp;matches<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(shExpMatch(url,&nbsp;&quot;*borg.local*&quot;))&nbsp;return&nbsp;&quot;DIRECT&quot;;<br>
&nbsp;&nbsp;&nbsp;if&nbsp;(isInNet(myIpAddress(),&nbsp;&quot;10.150.0.0&quot;,&nbsp;&quot;255.255.0.0&quot;))&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{return&nbsp;&quot;PROXY&nbsp;proxy.borg.local:3128&quot;&nbsp;;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&quot;DIRECT&quot;;<br>
}&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
