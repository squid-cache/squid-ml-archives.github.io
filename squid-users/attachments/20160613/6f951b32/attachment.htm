<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&#39;ve&nbsp;got&nbsp;a&nbsp;reliable&nbsp;but&nbsp;slow&nbsp;backend&nbsp;that&nbsp;sends&nbsp;cacheble&nbsp;responses.&nbsp;When&nbsp;I&nbsp;run&nbsp;a&nbsp;manual&nbsp;test,&nbsp;I&nbsp;can&nbsp;see&nbsp;I&nbsp;miss&nbsp;the&nbsp;cache&nbsp;every&nbsp;one&nbsp;in&nbsp;a&nbsp;while&nbsp;and&nbsp;got&nbsp;hits&nbsp;most&nbsp;of&nbsp;the&nbsp;time.&nbsp;This&nbsp;is&nbsp;also&nbsp;reflected&nbsp;in&nbsp;the&nbsp;response&nbsp;time,&nbsp;200+&nbsp;ms&nbsp;for&nbsp;a&nbsp;miss,&nbsp;~20ms&nbsp;for&nbsp;a&nbsp;hit. &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;However&nbsp;when&nbsp;I&nbsp;request&nbsp;the&nbsp;same&nbsp;resource&nbsp;multiple&nbsp;times&nbsp;at&nbsp;the&nbsp;same&nbsp;instant,&nbsp;I&nbsp;see&nbsp;multiple&nbsp;requests&nbsp;at&nbsp;the&nbsp;origin&nbsp;server.&nbsp;Ideally&nbsp;I&nbsp;would&nbsp;like&nbsp;to&nbsp;have&nbsp;only&nbsp;a&nbsp;single&nbsp;request&nbsp;to&nbsp;the&nbsp;origin&nbsp;server&nbsp;and&nbsp;queuing&nbsp;all&nbsp;other&nbsp;incoming&nbsp;requests&nbsp;in&nbsp;Squid.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;&#39;collapsed_forwarding&nbsp;on&#39;&nbsp;option&nbsp;seems&nbsp;to&nbsp;do&nbsp;exactly&nbsp;as&nbsp;I&nbsp;want,&nbsp;however&nbsp;when&nbsp;I&nbsp;turned&nbsp;this&nbsp;option&nbsp;and&nbsp;restarted&nbsp;Squid&nbsp;I&nbsp;still&nbsp;see&nbsp;multiple&nbsp;requests&nbsp;at&nbsp;the&nbsp;backend. &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&#39;ve&nbsp;tried&nbsp;to&nbsp;add&nbsp;a&nbsp;cache_dir&nbsp;as&nbsp;suggested&nbsp;in&nbsp;section&nbsp;&#39;Known&nbsp;issues&nbsp;and&nbsp;shortcomings&#39;&nbsp;on&nbsp; &lt;a&nbsp;href=&quot;http://wiki.squid-cache.org/Features/CollapsedForwarding&quot;&gt;http://wiki.squid-cache.org/Features/CollapsedForwarding&lt;/a&gt; but&nbsp;to&nbsp;no&nbsp;avail. &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&#39;ve&nbsp;placed&nbsp;the&nbsp;config&nbsp;directive&nbsp;on&nbsp;multiple&nbsp;locations&nbsp;in&nbsp;the&nbsp;configuration&nbsp;file,&nbsp;both&nbsp;before&nbsp;and&nbsp;after&nbsp;the&nbsp;http_port&nbsp;directive&nbsp;as&nbsp;well&nbsp;as&nbsp;the&nbsp;cache_dir&nbsp;directive.&nbsp;Again&nbsp;no&nbsp;results. &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Is&nbsp;the&nbsp;collapsed_forwarding&nbsp;directive&nbsp;the&nbsp;correct&nbsp;one&nbsp;to&nbsp;use&nbsp;for&nbsp;my&nbsp;use-case&nbsp;or&nbsp;am&nbsp;i&nbsp;missing&nbsp;something?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&#39;m&nbsp;using&nbsp;the&nbsp;default&nbsp;configuration&nbsp;of&nbsp;version&nbsp;3.5.19&nbsp;with&nbsp;the&nbsp;following&nbsp;changes: &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;#Queue&nbsp;incoming&nbsp;requests&nbsp;when&nbsp;a&nbsp;request&nbsp;is&nbsp;send&nbsp;to&nbsp;the&nbsp;backend.&nbsp;I.E.&nbsp;collapse&nbsp;request&nbsp;into&nbsp;a&nbsp;single&nbsp;backend&nbsp;request.&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;collapsed_forwarding&nbsp;on&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;#&nbsp;Squid&nbsp;normally&nbsp;listens&nbsp;to&nbsp;port&nbsp;3128&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;http_port&nbsp;3128&nbsp;accel&nbsp;no-vhost&nbsp;defaultsite=localhost&nbsp;ignore-cc&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;#Backend&nbsp;requires&nbsp;basic&nbsp;auth&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;cache_peer&nbsp;127.0.0.1&nbsp;parent&nbsp;53142&nbsp;0&nbsp;no-query&nbsp;originserver&nbsp;name=myAccel&nbsp;login=username:password&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;#Allow&nbsp;caching&nbsp;of&nbsp;files&nbsp;that&nbsp;have&nbsp;a&nbsp;ttl&nbsp;of&nbsp;1&nbsp;seconds&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;minimum_expiry_time&nbsp;1&nbsp;seconds&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;acl&nbsp;our_sites&nbsp;dstdomain&nbsp;localhost&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;http_access&nbsp;allow&nbsp;our_sites&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;cache_peer_access&nbsp;myAccel&nbsp;allow&nbsp;our_sites&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;cache_peer_access&nbsp;myAccel&nbsp;deny&nbsp;all&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;See&nbsp;also: &lt;a&nbsp;href=&quot;http://serverfault.com/questions/782877/on-multiple-request-to-squid-send-a-single-request-to-a-backend-and-queue-other&quot;&gt;http://serverfault.com/questions/782877/on-multiple-request-to-squid-send-a-single-request-to-a-backend-and-queue-other&lt;/a&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
