<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Thanks&nbsp;so&nbsp;much&nbsp;for&nbsp;your&nbsp;help&nbsp;on&nbsp;this. &nbsp;So&nbsp;I&#39;m&nbsp;changing&nbsp;it&nbsp;up&nbsp;a&nbsp;little&nbsp;bit. &nbsp;Disregard&nbsp;the&nbsp;backend&nbsp;server&nbsp;certificates. &nbsp;I&#39;m&nbsp;using&nbsp;3&nbsp;frontend&nbsp;servers&nbsp;but&nbsp;I&nbsp;want&nbsp;to&nbsp;use&nbsp;LetsEncrypt&nbsp;to&nbsp;create&nbsp;the&nbsp;SAN&nbsp;certificate&nbsp;for&nbsp;them.&nbsp;Is&nbsp;the&nbsp;concept&nbsp;the&nbsp;same&nbsp;with&nbsp;how&nbsp;you&nbsp;described&nbsp;this? &nbsp;Just&nbsp;as&nbsp;I&nbsp;mentioned,&nbsp;one&nbsp;of&nbsp;the&nbsp;servers&nbsp;is&nbsp;running&nbsp;the&nbsp;letsencrypt&nbsp;process&nbsp;which&nbsp;communicates&nbsp;with&nbsp;letsencrypt&nbsp;and&nbsp;then&nbsp;tries&nbsp;to&nbsp;resolve&nbsp;all&nbsp;of&nbsp;the&nbsp;dns&nbsp;names&nbsp;and&nbsp;correspondingly&nbsp;checks&nbsp;the&nbsp;/.well-known/acme-challenge&nbsp;directory. &nbsp;This&nbsp;is&nbsp;what&nbsp;I&#39;ve&nbsp;got&nbsp;in&nbsp;my&nbsp;config:&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;#&nbsp;LetsEncrypt&nbsp;Cache-peer-access&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;cache_peer&nbsp;&lt;a&nbsp;href=&quot;http://dev02-server.com&quot;&nbsp;target=&quot;_blank&quot;&gt;dev02-server.com&lt;/a&gt;&nbsp;parent&nbsp;80&nbsp;0&nbsp;no-query&nbsp;originserver&nbsp;default&nbsp;name=dev02-server_80&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;cache_peer&nbsp;dev02-&lt;/font&gt;&lt;span&nbsp;style=&quot;font-family:monospace,monospace&quot;&gt;&lt;a&nbsp;href=&quot;http://server01.com&quot;&nbsp;target=&quot;_blank&quot;&gt;server01.com&lt;/a&gt;&lt;/span&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt; parent&nbsp;80&nbsp;0&nbsp;no-query&nbsp;originserver &lt;/font&gt;&lt;span&nbsp;style=&quot;font-family:monospace,monospace&quot;&gt;default&lt;/span&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt; name=dev02-server01_80&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;cache_peer&nbsp;dev02-&lt;/font&gt;&lt;span&nbsp;style=&quot;font-family:monospace,monospace&quot;&gt;&lt;a&nbsp;href=&quot;http://server02.com&quot;&nbsp;target=&quot;_blank&quot;&gt;server02.com&lt;/a&gt;&lt;/span&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt; parent&nbsp;80&nbsp;0&nbsp;no-query&nbsp;originserver &lt;/font&gt;&lt;span&nbsp;style=&quot;font-family:monospace,monospace&quot;&gt;default&lt;/span&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt; name=dev02-server02_80&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;acl&nbsp;acme&nbsp;urlpath_regex&nbsp;^/.well-known/acme-challenge&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;cache_peer_access&nbsp;dev02-server_80&nbsp;allow&nbsp;acme&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;cache_peer_access&nbsp;dev02-server01_80&nbsp;deny&nbsp;acme&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace,&nbsp;monospace&quot;&gt;cache_peer_access&nbsp;dev02-server02_80&nbsp;deny&nbsp;acme&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Where&nbsp;dev02-server_80&nbsp;is&nbsp;running&nbsp;letsencrypt&nbsp;and&nbsp;the&nbsp;other&nbsp;two&nbsp;are&nbsp;the&nbsp;squid&nbsp;servers.&nbsp; &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What&nbsp;I&#39;m&nbsp;expecting&nbsp;to&nbsp;do&nbsp;here&nbsp;is&nbsp;a&nbsp;wget&nbsp;(to&nbsp;test&nbsp;this)&nbsp;on&nbsp;&lt;a&nbsp;href=&quot;http://dev02-server-main.com&quot;&gt;dev02-server-main.com&lt;/a&gt;&nbsp;which&nbsp;resolves&nbsp;to&nbsp;the&nbsp;IP&#39;s&nbsp;of&nbsp;&lt;a&nbsp;href=&quot;http://server01.com&quot;&gt;server01.com&lt;/a&gt;&nbsp;and&nbsp;&lt;a&nbsp;href=&quot;http://server02.com&quot;&gt;server02.com&lt;/a&gt;. &nbsp;I&#39;m&nbsp;still&nbsp;getting&nbsp;an&nbsp;error&nbsp;403&nbsp;Forbidden.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Sat,&nbsp;Jun&nbsp;25,&nbsp;2016&nbsp;at&nbsp;12:51&nbsp;AM,&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&nbsp;target=&quot;_blank&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-style:solid;border-left-color:rgb(204,204,204);padding-left:1ex&quot;&gt;&lt;span&gt;On&nbsp;25/06/2016&nbsp;4:48&nbsp;a.m.,&nbsp;Bidwell,&nbsp;Christopher&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;Hi&nbsp;all,&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;I&#39;m&nbsp;very&nbsp;new&nbsp;to&nbsp;squid&nbsp;and&nbsp;we&nbsp;are&nbsp;wanting&nbsp;to&nbsp;implement&nbsp;letsencrypt&nbsp;for&nbsp;our&lt;br&gt;<br>
&gt;&nbsp;ssl&nbsp;certificates.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Here&#39;s&nbsp;the&nbsp;scenario:&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;We&#39;ve&nbsp;got&nbsp;several&nbsp;frontend&nbsp;servers&nbsp;running&nbsp;squid&nbsp;that&nbsp;are&nbsp;caching&nbsp;from&nbsp;the&lt;br&gt;<br>
&gt;&nbsp;backend&nbsp;systems.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;Ok,&lt;br&gt;<br>
&lt;span&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;i.e.&nbsp;&lt;a&nbsp;href=&quot;http://test.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;test.com&lt;/a&gt;&nbsp;-&gt;&nbsp;10.0.0.1,&nbsp;10.0.1.1,&nbsp;10.0.2.1&nbsp;(all&nbsp;physically&nbsp;separated&lt;br&gt;<br>
&gt;&nbsp;from&nbsp;one&nbsp;another)&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;Ok,&lt;br&gt;<br>
&lt;span&gt;&lt;br&gt;<br>
&gt;&nbsp;Each&nbsp;internal&nbsp;server&nbsp;also&nbsp;has&nbsp;its&nbsp;own&nbsp;dns&nbsp;name:&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;http://web1.test.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;web1.test.com&lt;/a&gt;&nbsp;-&gt;&nbsp;10.0.0.1&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;http://web2.test.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;web2.test.com&lt;/a&gt;&nbsp;-&gt;&nbsp;10.0.1.1&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;http://web3.test.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;web3.test.com&lt;/a&gt;&nbsp;-&gt;&nbsp;10.0.2.1&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Note&nbsp;that&nbsp;these&nbsp;are&nbsp;all&nbsp;public.&nbsp;Using&nbsp;10.&nbsp;as&nbsp;examples.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;Ok,&nbsp;but&nbsp;dangerous.&nbsp;That&nbsp;allows&nbsp;the&nbsp;frontend&nbsp;to&nbsp;be&nbsp;bypassed&nbsp;whenever&nbsp;a&lt;br&gt;<br>
client&nbsp;wants.&nbsp;So&nbsp;you&nbsp;will&nbsp;need&nbsp;to&nbsp;ensure&nbsp;security&nbsp;to&nbsp;the&nbsp;backend&nbsp;stays&lt;br&gt;<br>
in&nbsp;sync&nbsp;with&nbsp;the&nbsp;frontend.&nbsp;If&nbsp;you&nbsp;don&#39;t&nbsp;have&nbsp;to,&nbsp;its&nbsp;best&nbsp;to&nbsp;avoid&nbsp;that&lt;br&gt;<br>
trouble&nbsp;and&nbsp;filter&nbsp;everything&nbsp;consistently&nbsp;through&nbsp;the&nbsp;frontend.&lt;br&gt;<br>
&lt;br&gt;<br>
That&nbsp;also&nbsp;allows&nbsp;the&nbsp;backends&nbsp;to&nbsp;avoid&nbsp;public&nbsp;CAs&nbsp;like&nbsp;LetsEncrypt&lt;br&gt;<br>
entirely.&nbsp;You&nbsp;can&nbsp;use&nbsp;a&nbsp;single&nbsp;custom&nbsp;CA&nbsp;exclusively&nbsp;for&nbsp;the&lt;br&gt;<br>
frontend&lt;-&gt;backend&nbsp;traffic&nbsp;and&nbsp;have&nbsp;much&nbsp;better&nbsp;security&nbsp;settings&nbsp;on&lt;br&gt;<br>
those&nbsp;internal&nbsp;links&nbsp;since&nbsp;you&nbsp;no&nbsp;longer&nbsp;have&nbsp;to&nbsp;worry&nbsp;about&nbsp;random&lt;br&gt;<br>
visitors&nbsp;capabilities.&lt;br&gt;<br>
&lt;span&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;I&#39;d&nbsp;like&nbsp;to&nbsp;create&nbsp;a&nbsp;SAN&nbsp;certificate&nbsp;naming&nbsp;the&nbsp;3&nbsp;internal&nbsp;systems&nbsp;in&lt;br&gt;<br>
&gt;&nbsp;addition&nbsp;to&nbsp;the&nbsp;public&nbsp;name:&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;http://test.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;test.com&lt;/a&gt;,&nbsp;&lt;a&nbsp;href=&quot;http://web1.test.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;web1.test.com&lt;/a&gt;,&nbsp;&lt;a&nbsp;href=&quot;http://web2.test.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;web2.test.com&lt;/a&gt;,&nbsp;and&nbsp;&lt;a&nbsp;href=&quot;http://web3.test.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;web3.test.com&lt;/a&gt;.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;On&nbsp;the&nbsp;letsencrypt&nbsp;forum&nbsp;they&nbsp;said&nbsp;that&nbsp;I&nbsp;could&nbsp;do&nbsp;a&nbsp;HTTP&nbsp;301&nbsp;redirect&nbsp;from&lt;br&gt;<br>
&gt;&nbsp;the&nbsp;squid&nbsp;servers&nbsp;to&nbsp;the&nbsp;backend&nbsp;letsencrypt&nbsp;server&nbsp;where&nbsp;any&nbsp;match&nbsp;for:&lt;br&gt;<br>
&gt; &nbsp;/.well-known/acme-challenge/*&nbsp;would&nbsp;redirect&nbsp;with&nbsp;an&nbsp;HTTP&nbsp;301&nbsp;to&nbsp;that&lt;br&gt;<br>
&gt;&nbsp;backend&nbsp;letsencrypt&nbsp;server. &nbsp;I&#39;m&nbsp;not&nbsp;sure&nbsp;how&nbsp;to&nbsp;do&nbsp;this&nbsp;and&nbsp;the&nbsp;squid&lt;br&gt;<br>
&gt;&nbsp;documentation&nbsp;is&nbsp;not&nbsp;easy&nbsp;to&nbsp;comprehend.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Let&nbsp;me&nbsp;know&nbsp;if&nbsp;this&nbsp;isn&#39;t&nbsp;clear&nbsp;how&nbsp;I&#39;ve&nbsp;explained&nbsp;this.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;If&nbsp;LetsEncrypt&nbsp;are&nbsp;contacting&nbsp;web1&nbsp;for&nbsp;example.&nbsp;They&nbsp;should&nbsp;be&nbsp;going&nbsp;to&lt;br&gt;<br>
the&nbsp;backend&nbsp;directly.&nbsp;Since&nbsp;&lt;a&nbsp;href=&quot;http://web1.test.&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://web1.test.&lt;/a&gt;*&nbsp;is&nbsp;not&nbsp;a&nbsp;frontend&nbsp;request.&lt;br&gt;<br>
&lt;br&gt;<br>
Whatever&nbsp;server&nbsp;is&nbsp;performing&nbsp;the&nbsp;LetsEncrypt&nbsp;for&nbsp;the&nbsp;frontend&nbsp;needs&nbsp;to&lt;br&gt;<br>
know&nbsp;its&nbsp;doing&nbsp;it&nbsp;for&nbsp;the&nbsp;generic&nbsp;domain&nbsp;as&nbsp;well&nbsp;as&nbsp;itself.&nbsp;Squid&nbsp;is&nbsp;not&lt;br&gt;<br>
a&nbsp;web&nbsp;server,&nbsp;so&nbsp;you&nbsp;need&nbsp;to&nbsp;nominate&nbsp;a&nbsp;backend&nbsp;to&nbsp;do&nbsp;that&nbsp;(could&nbsp;be&nbsp;a&lt;br&gt;<br>
new&nbsp;one&nbsp;just&nbsp;of&nbsp;LetsEncrypt&nbsp;stuff).&lt;br&gt;<br>
&lt;br&gt;<br>
For&nbsp;example&nbsp;doing&nbsp;it&nbsp;on&nbsp;web1&nbsp;would&nbsp;mean&nbsp;fitting&nbsp;these&nbsp;lines&nbsp;into&nbsp;your&lt;br&gt;<br>
existing&nbsp;config&nbsp;(this&nbsp;order,&nbsp;but&nbsp;not&nbsp;necesarily&nbsp;together&nbsp;like&nbsp;this):&lt;br&gt;<br>
&lt;br&gt;<br>
 acl&nbsp;acme&nbsp;urlpath_regex&nbsp;^/.well-known/acme-challenge&lt;br&gt;<br>
 cache_peer_access&nbsp;web1&nbsp;allow&nbsp;acme&lt;br&gt;<br>
 cache_peer_access&nbsp;web2&nbsp;deny&nbsp;acme&lt;br&gt;<br>
 cache_peer_access&nbsp;web3&nbsp;deny&nbsp;acme&lt;br&gt;<br>
&lt;br&gt;<br>
No&nbsp;&quot;redirect&quot;&nbsp;involved.&nbsp;Just&nbsp;tell&nbsp;Squid&nbsp;that&nbsp;server&nbsp;is&nbsp;where&nbsp;those&nbsp;URL&lt;br&gt;<br>
are&nbsp;handled.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Amos&lt;br&gt;<br>
&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
