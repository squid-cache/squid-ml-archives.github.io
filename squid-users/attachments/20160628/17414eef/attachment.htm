<tt>
&lt;div&gt;Dear&nbsp;all,&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
&lt;div&gt;i&nbsp;have&nbsp;a&nbsp;strange&nbsp;problem&nbsp;with&nbsp;my&nbsp;squid&nbsp;3.5.19&nbsp;and&nbsp;authentication&nbsp;NTLM.&lt;/div&gt;<br>
&lt;div&gt;On&nbsp;my&nbsp;configuration&nbsp;i&nbsp;have&nbsp;2&nbsp;auth&nbsp;method:&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
&lt;div&gt;NTLM&nbsp;negotiated&nbsp;with&nbsp;ntlm_auth&nbsp;from&nbsp;samba&nbsp;3&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
&lt;div&gt;auth_param&nbsp;ntlm&nbsp;program&nbsp;/usr/local/samba/bin/ntlm_auth&nbsp;--helper-protocol=squid-2.5-ntlmssp&lt;br&nbsp;/&gt;auth_param&nbsp;ntlm&nbsp;children&nbsp;200&nbsp;startup=100&nbsp;idle=10&nbsp;concurrency=0&lt;br&nbsp;/&gt;auth_param&nbsp;ntlm&nbsp;keep_alive&nbsp;on&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;&lt;/div&gt;<br>
&lt;div&gt;and&nbsp;as&nbsp;a&nbsp;fallback&nbsp;basic&nbsp;ntlm&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
&lt;div&gt;auth_param&nbsp;basic&nbsp;program&nbsp;/usr/local/samba/bin/ntlm_auth&nbsp;--helper-protocol=squid-2.5-basic&lt;br&nbsp;/&gt;auth_param&nbsp;basic&nbsp;children&nbsp;25&nbsp;startup=15&nbsp;idle=5&nbsp;concurrency=0&lt;br&nbsp;/&gt;auth_param&nbsp;basic&nbsp;realm&nbsp;PROXY&nbsp;AUTHORIZATION&nbsp;REQUIRED&lt;br&nbsp;/&gt;auth_param&nbsp;basic&nbsp;credentialsttl&nbsp;30&nbsp;minutes&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
&lt;div&gt;TTL&lt;/div&gt;<br>
&lt;div&gt;&lt;br&nbsp;/&gt;authenticate_cache_garbage_interval&nbsp;1&nbsp;hours&lt;br&nbsp;/&gt;authenticate_ttl&nbsp;30&nbsp;minutes&lt;br&nbsp;/&gt;authenticate_ip_ttl&nbsp;30&nbsp;minutes&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;&lt;/div&gt;<br>
&lt;div&gt;Groups&nbsp;identification&nbsp;with&nbsp;LDAPS&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
&lt;div&gt;external_acl_type&nbsp;NAV&nbsp;children-max=200&nbsp;children-startup=100&nbsp;children-idle=10&nbsp;ttl=1800&nbsp;%LOGIN&lt;br&nbsp;/&gt;/usr/local/squid/libexec/ext_ldap_group_acl&nbsp;-s&nbsp;sub&nbsp;-b&nbsp;&quot;dc=domain,dc=xxx&quot;&nbsp;-D&nbsp;&quot;cn=squid,cn=Users,dc&lt;br&nbsp;/&gt;=domain,dc=xxx&quot;&nbsp;-w&nbsp;&quot;password&quot;&nbsp;-f&nbsp;&quot;(&amp;(objectclass=person)(sAMAccountName=%v)(membero&lt;br&nbsp;/&gt;f=cn=%a,ou=INTERNET,ou=AAA,dc=domain,dc=xxx))&quot;&nbsp;-S&nbsp;-K&nbsp;-H&nbsp;ldaps://domain.xxx:3269&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
&lt;div&gt;...&nbsp;and&nbsp;all&nbsp;work&nbsp;very&nbsp;well.&lt;/div&gt;<br>
&lt;div&gt;Sometimes&nbsp;and&nbsp;randomly,&nbsp;my&nbsp;users&nbsp;reported&nbsp;to&nbsp;me&nbsp;that&nbsp;squid&nbsp;cannot&nbsp;do&nbsp;ntlm&nbsp;transparent&nbsp;authentication&nbsp;and&nbsp;request&nbsp;for&nbsp;user/password&nbsp;pair&nbsp;(falling&nbsp;back&nbsp;to&nbsp;ntlm&nbsp;basic).&lt;/div&gt;<br>
&lt;div&gt;Entering&nbsp;right&nbsp;credential&nbsp;does&nbsp;not&nbsp;work&nbsp;and&nbsp;to&nbsp;proceed&nbsp;further&nbsp;&nbsp;users&nbsp;need&nbsp;to&nbsp;click&nbsp;on&nbsp;&quot;abort&quot;&nbsp;button&nbsp;many&nbsp;times.&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
&lt;div&gt;On&nbsp;my&nbsp;cache.log&nbsp;i&nbsp;see:&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
&lt;div&gt;Login&nbsp;for&nbsp;user&nbsp;[DOMAIN][userx]@[PC_XXX]&nbsp;failed&nbsp;due&nbsp;to&nbsp;[Access&nbsp;denied]&lt;br&nbsp;/&gt;NTLMSSP&nbsp;BH:&nbsp;NT_STATUS_ACCESS_DENIED&lt;br&nbsp;/&gt;2016/06/27&nbsp;22:59:06&nbsp;kid1|&nbsp;ERROR:&nbsp;NTLM&nbsp;Authentication&nbsp;validating&nbsp;user.&nbsp;Result:&nbsp;{result=BH,&nbsp;notes={mes&lt;br&nbsp;/&gt;sage:&nbsp;NT_STATUS_ACCESS_DENIED;&nbsp;}}&lt;br&nbsp;/&gt;2016/06/27&nbsp;23:00:02|&nbsp;Set&nbsp;Current&nbsp;Directory&nbsp;to&nbsp;/squid/log&lt;br&nbsp;/&gt;2016/06/27&nbsp;23:10:01|&nbsp;Set&nbsp;Current&nbsp;Directory&nbsp;to&nbsp;/squid/log&lt;br&nbsp;/&gt;2016/06/27&nbsp;23:20:01|&nbsp;Set&nbsp;Current&nbsp;Directory&nbsp;to&nbsp;/squid/log&lt;br&nbsp;/&gt;2016/06/27&nbsp;23:21:09&nbsp;kid1|&nbsp;Logfile:&nbsp;opening&nbsp;log&nbsp;stdio:/var/log/squid/netdb.state&lt;br&nbsp;/&gt;2016/06/27&nbsp;23:21:09&nbsp;kid1|&nbsp;Logfile:&nbsp;closing&nbsp;log&nbsp;stdio:/var/log/squid/netdb.state&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
&lt;div&gt;every&nbsp;times&nbsp;a&nbsp;user&nbsp;receive&nbsp;credential&nbsp;request.&lt;/div&gt;<br>
&lt;div&gt;After&nbsp;aborting&nbsp;each&nbsp;requests&nbsp;squid&nbsp;do,&nbsp;users&nbsp;can&nbsp;surf&nbsp;the&nbsp;internet&nbsp;without&nbsp;problems&nbsp;and&nbsp;i&nbsp;cannot&nbsp;replicate&nbsp;the&nbsp;issue.&lt;/div&gt;<br>
&lt;div&gt;Trying&nbsp;to&nbsp;close&nbsp;the&nbsp;browser,&nbsp;clear&nbsp;cache,&nbsp;and&nbsp;going&nbsp;to&nbsp;the&nbsp;same&nbsp;site&nbsp;does&nbsp;not&nbsp;produce&nbsp;same&nbsp;error.&lt;/div&gt;<br>
&lt;div&gt;Stopping&nbsp;squid,&nbsp;remove&nbsp;cache,&nbsp;starting&nbsp;squid&nbsp;does&nbsp;not&nbsp;produce&nbsp;same&nbsp;error.&lt;/div&gt;<br>
&lt;div&gt;It's&nbsp;totally&nbsp;random&nbsp;and&nbsp;i'm&nbsp;going&nbsp;mad&nbsp;to&nbsp;understand&nbsp;why.&lt;/div&gt;<br>
&lt;div&gt;Can&nbsp;someone&nbsp;help&nbsp;me&nbsp;to&nbsp;debug&nbsp;and&nbsp;understand&nbsp;the&nbsp;problem?&lt;/div&gt;<br>
&lt;div&gt;Any&nbsp;help&nbsp;will&nbsp;be&nbsp;appreciated.&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
&lt;div&gt;Many&nbsp;thanks.&lt;/div&gt;<br>
&lt;div&gt;Giulius.&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;font&nbsp;face=Verdana,Arial&nbsp;size=2&gt;----&lt;br&gt;<br>
&nbsp;ZE-Light&nbsp;e&nbsp;ZE-Pro:&nbsp;servizi&nbsp;zimbra&nbsp;per&nbsp;caselle&nbsp;con&nbsp;dominio&nbsp;email.it,&nbsp;per&nbsp;tutti&nbsp;i&nbsp;dettagli&nbsp;&nbsp;&lt;a&nbsp;href=&quot;http://posta.email.it/caselle-di-posta-z-email-it/?utm_campaign=email_Zimbra_102014=main_footer&quot;&nbsp;target=&quot;_blank&quot;&gt;clicca&nbsp;qui&lt;/a&gt;&lt;br&gt;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;Sponsor:&lt;br&gt;<br>
&nbsp;Registra&nbsp;i&nbsp;domini&nbsp;che&nbsp;desideri&nbsp;ed&nbsp;inizia&nbsp;a&nbsp;creare&nbsp;il&nbsp;tuo&nbsp;sito&nbsp;web&lt;br&gt;<br>
&nbsp;&lt;a&nbsp;href=&quot;http://adv.email.it/cgi-bin/foclick.cgi?mid=13323&amp;d=20160628&quot;&nbsp;target=&quot;_blank&quot;&nbsp;&gt;Clicca&nbsp;qui&lt;/a&gt;&nbsp;&lt;/font&gt;&lt;br&gt;<br>
<br>
<br>

</tt>
