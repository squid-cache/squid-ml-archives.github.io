<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&#39;m&nbsp;using&nbsp;squid&nbsp;3.5.19&nbsp;on&nbsp;RHEL6&nbsp;and&nbsp;have&nbsp;configured&nbsp;SSL&nbsp;bump,&nbsp;which&nbsp;for&nbsp;the&nbsp;most&nbsp;part&nbsp;is&nbsp;working&nbsp;great.&lt;/div&gt;&lt;div&gt;The&nbsp;issue&nbsp;I&nbsp;have&nbsp;is&nbsp;I&nbsp;need&nbsp;to&nbsp;install&nbsp;some&nbsp;additional&nbsp;CA&nbsp;certs&nbsp;that&nbsp;are&nbsp;not&nbsp;provided&nbsp;by&nbsp;the&nbsp;ca-certificates-2015&nbsp;RPM&nbsp;in&nbsp;the&nbsp;/etc/pki/tls/cert.pem&nbsp;file&nbsp;(symlinked&nbsp;to&nbsp;/etc/pki/tls/certs/ca-bundle.crt).&lt;/div&gt;&lt;div&gt;I&#39;ve&nbsp;tried&nbsp;adding&nbsp;both&nbsp;the&nbsp;cafile&nbsp;and&nbsp;capath&nbsp;options&nbsp;to&nbsp;the&nbsp;http_port&nbsp;entry&nbsp;but&nbsp;neither&nbsp;seems&nbsp;to&nbsp;have&nbsp;any&nbsp;affect.&lt;/div&gt;&lt;div&gt;With&nbsp;the&nbsp;cafile&nbsp;option&nbsp;I&nbsp;can&nbsp;see&nbsp;squid&nbsp;open&nbsp;the&nbsp;file&nbsp;via&nbsp;an&nbsp;strace&nbsp;but&nbsp;when&nbsp;I&nbsp;connect&nbsp;to&nbsp;the&nbsp;server&nbsp;it&nbsp;fails&nbsp;with&nbsp;a&nbsp;503&nbsp;as&nbsp;the&nbsp;SSL&nbsp;session&nbsp;to&nbsp;the&nbsp;remote&nbsp;side&nbsp;is&nbsp;failing&nbsp;to&nbsp;verify.&lt;/div&gt;&lt;div&gt;With&nbsp;the&nbsp;capath&nbsp;option,&nbsp;strace&nbsp;shows&nbsp;that&nbsp;squid&nbsp;never&nbsp;attempts&nbsp;to&nbsp;open&nbsp;any&nbsp;files&nbsp;in&nbsp;that&nbsp;directory.&lt;/div&gt;&lt;div&gt;Dynamic&nbsp;certificate&nbsp;generation&nbsp;between&nbsp;squid&nbsp;and&nbsp;the&nbsp;client&nbsp;is&nbsp;working&nbsp;fine&nbsp;however.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;cafile&nbsp;strace&nbsp;(strace&nbsp;-fp&nbsp;&lt;squid_pid&gt;&nbsp;-e&nbsp;trace=open):&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;[pid&nbsp;27532]&nbsp;open(&quot;/var/lib/ssl_db/index.txt&quot;,&nbsp;O_RDWR)&nbsp;=&nbsp;3&lt;/div&gt;&lt;div&gt;[pid&nbsp;27532]&nbsp;open(&quot;/var/lib/ssl_db/index.txt&quot;,&nbsp;O_RDONLY)&nbsp;=&nbsp;4&lt;/div&gt;&lt;div&gt;[pid&nbsp;27532]&nbsp;open(&quot;/etc/localtime&quot;,&nbsp;O_RDONLY)&nbsp;=&nbsp;4&lt;/div&gt;&lt;div&gt;[pid&nbsp;27532]&nbsp;open(&quot;/var/lib/ssl_db/certs/3EA5A8686DE52F6FBED1CD16F119603FF223563F.pem&quot;,&nbsp;O_RDONLY)&nbsp;=&nbsp;4&lt;/div&gt;&lt;div&gt;[pid&nbsp;27532]&nbsp;open(&quot;/var/lib/ssl_db/certs/3EA5A8686DE52F6FBED1CD16F119603FF223563F.pem&quot;,&nbsp;O_RDONLY)&nbsp;=&nbsp;4&lt;/div&gt;&lt;div&gt;[pid&nbsp;27528]&nbsp;open(&quot;/etc/squid/ssl/cafile.pem&quot;,&nbsp;O_RDONLY)&nbsp;=&nbsp;13&lt;/div&gt;&lt;div&gt;[pid&nbsp;27528]&nbsp;open(&quot;/etc/pki/tls/cert.pem&quot;,&nbsp;O_RDONLY)&nbsp;=&nbsp;13&lt;/div&gt;&lt;div&gt;[pid&nbsp;27532]&nbsp;open(&quot;/var/lib/ssl_db/index.txt&quot;,&nbsp;O_RDWR)&nbsp;=&nbsp;3&lt;/div&gt;&lt;div&gt;[pid&nbsp;27532]&nbsp;open(&quot;/var/lib/ssl_db/index.txt&quot;,&nbsp;O_RDONLY)&nbsp;=&nbsp;4&lt;/div&gt;&lt;div&gt;[pid&nbsp;27532]&nbsp;open(&quot;/var/lib/ssl_db/certs/666F7FE36508EC9B6E154D4FA0AE36DAFE9AC520.pem&quot;,&nbsp;O_RDONLY)&nbsp;=&nbsp;4&lt;/div&gt;&lt;div&gt;[pid&nbsp;27532]&nbsp;open(&quot;/var/lib/ssl_db/certs/666F7FE36508EC9B6E154D4FA0AE36DAFE9AC520.pem&quot;,&nbsp;O_RDONLY)&nbsp;=&nbsp;4&lt;/div&gt;&lt;div&gt;[pid&nbsp;27528]&nbsp;open(&quot;/etc/squid/ssl/cafile.pem&quot;,&nbsp;O_RDONLY)&nbsp;=&nbsp;13&lt;/div&gt;&lt;div&gt;[pid&nbsp;27528]&nbsp;open(&quot;/etc/pki/tls/cert.pem&quot;,&nbsp;O_RDONLY)&nbsp;=&nbsp;13&lt;/div&gt;&lt;div&gt;[pid&nbsp;27528]&nbsp;open(&quot;/etc/squid/ssl/cafile.pem&quot;,&nbsp;O_RDONLY)&nbsp;=&nbsp;13&lt;/div&gt;&lt;div&gt;[pid&nbsp;27528]&nbsp;open(&quot;/etc/pki/tls/cert.pem&quot;,&nbsp;O_RDONLY)&nbsp;=&nbsp;13&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Subsequent&nbsp;error&nbsp;in&nbsp;the&nbsp;access&nbsp;log:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;[29/Jun/2016:18:46:30&nbsp;+1000]&nbsp;198.142.126.173&nbsp;TAG_NONE:HIER_DIRECT/200&nbsp;&quot;CONNECT&nbsp;&lt;a&nbsp;href=&quot;http://www.example.com:443&quot;&gt;www.example.com:443&lt;/a&gt;&nbsp;HTTP/1.1&quot;&nbsp;- &lt;a&nbsp;href=&quot;http://www.example.com&quot;&gt;www.example.com&lt;/a&gt; 130&nbsp;0&nbsp;-&nbsp;14&lt;/div&gt;&lt;div&gt;[29/Jun/2016:18:46:30&nbsp;+1000]&nbsp;198.142.126.173&nbsp;TAG_NONE:HIER_NONE/503&nbsp;&quot;GET&nbsp;&lt;a&nbsp;href=&quot;https://www.example.com/postorders/postorders.php&quot;&gt;https://www.example.com/postorders/postorders.php&lt;/a&gt;&nbsp;HTTP/1.1&quot;&nbsp;-&nbsp;-&nbsp;249&nbsp;4699&nbsp;-&nbsp;-&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Relevant&nbsp;config:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;sslproxy_options&nbsp;NO_SSLv2&lt;/div&gt;&lt;div&gt;sslproxy_cert_sign&nbsp;signTrusted&lt;/div&gt;&lt;div&gt;sslproxy_cert_sign_hash&nbsp;sha1&lt;/div&gt;&lt;div&gt;sslcrtd_children&nbsp;8&nbsp;startup=1&nbsp;idle=1&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;acl&nbsp;step1&nbsp;at_step&nbsp;SslBump1&lt;/div&gt;&lt;div&gt;ssl_bump&nbsp;peek&nbsp;step1&nbsp;sslbump_src&lt;/div&gt;&lt;div&gt;ssl_bump&nbsp;bump&nbsp;sslbump_dst&nbsp;sslbump_src&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;ssl_bump&nbsp;none&nbsp;all&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#http_port&nbsp;3128&nbsp;ssl-bump&nbsp;generate-host-certificates=on&nbsp;dynamic_cert_mem_cache_size=8MB&nbsp;capath=/etc/squid/ssl/cacerts/&nbsp;key=/etc/squid/ssl_cert/mitm_root_ca.key&nbsp; cert=/etc/squid/ssl_cert/mitm_root_ca.crt&lt;/div&gt;&lt;/div&gt;&lt;div&gt;http_port&nbsp;3128&nbsp;ssl-bump&nbsp;generate-host-certificates=on&nbsp;dynamic_cert_mem_cache_size=8MB&nbsp;cafile=/etc/squid/ssl/cafile.pem&nbsp;key=/etc/squid/ssl_cert/mitm_root_ca.key&nbsp; cert=/etc/squid/ssl_cert/mitm_root_ca.crt&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;can&nbsp;work&nbsp;around&nbsp;the&nbsp;issue&nbsp;by&nbsp;appending&nbsp;the&nbsp;additional&nbsp;CA&nbsp;certs&nbsp;to&nbsp;the&nbsp;Redhat&nbsp;managed&nbsp;/etc/pki/tls/certs/ca-bundle.crt&nbsp;file&nbsp;but&nbsp;this&nbsp;is&nbsp;not&nbsp;ideal.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Are&nbsp;the&nbsp;cafile&nbsp;and&nbsp;capath&nbsp;options&nbsp;supposed&nbsp;to&nbsp;work&nbsp;like&nbsp;this&nbsp;i.e.&nbsp;do&nbsp;they&nbsp;allow&nbsp;you&nbsp;to&nbsp;complement&nbsp;the&nbsp;OS&nbsp;supplied&nbsp;CA&nbsp;certs&nbsp;for&nbsp;remote&nbsp;site&nbsp;verification&nbsp;or&nbsp;have&nbsp;I&nbsp;completely&nbsp;misread&nbsp;the&nbsp;documentation?&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;cafile=&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;File&nbsp;containing&nbsp;additional&nbsp;CA&nbsp;certificates&nbsp;to&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;use&nbsp;when&nbsp;verifying&nbsp;client&nbsp;certificates.&nbsp;If&nbsp;unset&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;clientca&nbsp;will&nbsp;be&nbsp;used.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;capath=&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;Directory&nbsp;containing&nbsp;additional&nbsp;CA&nbsp;certificates&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;and&nbsp;CRL&nbsp;lists&nbsp;to&nbsp;use&nbsp;when&nbsp;verifying&nbsp;client&nbsp;certificates.&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Many&nbsp;thanks&nbsp;and&nbsp;any&nbsp;help&nbsp;greatly&nbsp;appreciated,&lt;/div&gt;&lt;div&gt;Bruce&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
