<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;Hello&nbsp;there.&nbsp;We&#39;re&nbsp;using&nbsp;pfsense&nbsp;and&nbsp;squid-proxy&nbsp;to&nbsp;bump&nbsp;https&nbsp;connections&nbsp;between&nbsp;some&nbsp;of&nbsp;our&nbsp;machines&nbsp;and&nbsp;www.&nbsp;The&nbsp;setup&nbsp;seems&nbsp;to&nbsp;works&nbsp;fine&nbsp;for&nbsp;most&nbsp;of&nbsp;the&nbsp;https&nbsp;sites,&nbsp;but&nbsp;it&nbsp;doesn&#39;t&nbsp;work&nbsp;for&nbsp;the&nbsp;others.&lt;/span&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;One&nbsp;example&nbsp;to&nbsp;this&nbsp;sites&nbsp;is&nbsp;&quot;&lt;a&nbsp;href=&quot;http://docs.docker.com/&quot;&nbsp;target=&quot;_blank&quot;&gt;docs.docker.com&lt;/a&gt;&quot;.&nbsp;Even&nbsp;though&nbsp;we&nbsp;can&nbsp;connect&nbsp;to&nbsp;&quot;&lt;a&nbsp;href=&quot;http://docker.com/&quot;&nbsp;target=&quot;_blank&quot;&gt;docker.com&lt;/a&gt;&quot;,&nbsp;we&nbsp;can&#39;t&nbsp;connect&nbsp;to&nbsp;&quot;&lt;a&nbsp;href=&quot;http://docs.docker.com/&quot;&nbsp;target=&quot;_blank&quot;&gt;docs.docker.com&lt;/a&gt;&quot;.&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;The&nbsp;error&nbsp;we&nbsp;get&nbsp;is:&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;pre&nbsp;style=&quot;white-space:pre-wrap;font-family:sans-serif;color:rgb(30,30,30);font-size:12px&quot;&gt;(92)&nbsp;Protocol&nbsp;error&nbsp;(TLS&nbsp;code:&nbsp;SQUID_ERR_SSL_HANDSHAKE)&lt;/pre&gt;&lt;p&nbsp;style=&quot;font-family:verdana,sans-serif;color:rgb(30,30,30);font-size:12px&quot;&gt;Handshake&nbsp;with&nbsp;SSL&nbsp;server&nbsp;failed:&nbsp;error:14077410:SSL&nbsp;routines:SSL23_GET_SERVER_HELLO:sslv3&nbsp;alert&nbsp;handshake&nbsp;failure&lt;/p&gt;&lt;p&nbsp;style=&quot;font-family:verdana,sans-serif;color:rgb(30,30,30);font-size:12px&quot;&gt;Upon&nbsp;further&nbsp;investigation&nbsp;we&nbsp;found&nbsp;out&nbsp;that&nbsp;this&nbsp;happens&nbsp;because&nbsp;some&nbsp;sites&nbsp;require&nbsp;SNI&nbsp;to&nbsp;supply&nbsp;correct&nbsp;SSL&nbsp;certificate.&lt;/p&gt;&lt;p&nbsp;style=&quot;font-family:verdana,sans-serif;color:rgb(30,30,30);font-size:12px&quot;&gt;You&nbsp;can&nbsp;test&nbsp;this&nbsp;out&nbsp;with:&lt;/p&gt;&lt;p&nbsp;style=&quot;font-family:verdana,sans-serif;color:rgb(30,30,30);font-size:12px&quot;&gt;-------------------------------&lt;/p&gt;&lt;p&nbsp;style=&quot;font-family:verdana,sans-serif;color:rgb(30,30,30);font-size:12px&quot;&gt;openssl&nbsp;s_client&nbsp;-connect &lt;a&nbsp;href=&quot;http://docs.docker.com:443/&quot;&nbsp;target=&quot;_blank&quot;&gt;docs.docker.com:443&lt;/a&gt; -&gt;&nbsp;ERROR&lt;/p&gt;&lt;p&gt;&lt;font&nbsp;color=&quot;#1e1e1e&quot;&nbsp;face=&quot;verdana,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12px&quot;&gt;140612823746464:error:14077410:SSL&nbsp;routines:SSL23_GET_SERVER_HELLO:sslv3&nbsp;alert&nbsp;handshake&nbsp;failure:s23_clnt.c:744:&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;&lt;p&gt;&lt;font&nbsp;color=&quot;#1e1e1e&quot;&nbsp;face=&quot;verdana,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12px&quot;&gt;-------------------------------&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;&lt;p&nbsp;style=&quot;font-family:verdana,sans-serif;color:rgb(30,30,30);font-size:12px&quot;&gt;openssl&nbsp;s_client&nbsp;-connect &lt;a&nbsp;href=&quot;http://docs.docker.com:443/&quot;&nbsp;target=&quot;_blank&quot;&gt;docs.docker.com:443&lt;/a&gt; -servername &lt;a&nbsp;href=&quot;http://docs.docker.com/&quot;&nbsp;target=&quot;_blank&quot;&gt;docs.docker.com&lt;/a&gt; -&gt;&nbsp;Works&lt;/p&gt;&lt;p&nbsp;style=&quot;font-family:verdana,sans-serif;color:rgb(30,30,30);font-size:12px&quot;&gt;--------------------------------&lt;/p&gt;&lt;p&nbsp;style=&quot;font-family:verdana,sans-serif;color:rgb(30,30,30);font-size:12px&quot;&gt;Squid&nbsp;seems&nbsp;to&nbsp;make&nbsp;https&nbsp;request&nbsp;without&nbsp;the&nbsp;SNI.&nbsp;How&nbsp;can&nbsp;we&nbsp;configure&nbsp;Squid&nbsp;to&nbsp;use&nbsp;SNI?&nbsp;Thanks.&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
