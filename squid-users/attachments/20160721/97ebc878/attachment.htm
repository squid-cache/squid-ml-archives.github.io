<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;Amos,&lt;/span&gt;&lt;span&nbsp;class=&quot;im&quot;&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&gt; &lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;There&nbsp;is&nbsp;a&nbsp;different&nbsp;config&nbsp;example&nbsp;for&nbsp;REDIRECT &lt;/span&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;&lt;/span&gt;&lt;a&nbsp;href=&quot;http://wiki.squid-cache.org/ConfigExamples/Intercept/LinuxRedirect&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&nbsp;style=&quot;font-size:12.8px&quot;&gt;http://wiki.squid-cache.org/ConfigExamples/Intercept/LinuxRedirect&lt;/a&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;Ty,&nbsp;I&#39;m&nbsp;going&nbsp;to&nbsp;try&nbsp;it&nbsp;using&nbsp;REDIRECT.&nbsp;I&nbsp;was&nbsp;unwilling&nbsp;to&nbsp;follow&nbsp;the&nbsp;DNAT&nbsp;guide&nbsp;because&nbsp;of&nbsp;having&nbsp;to&nbsp;enable&nbsp;ip-forwarding&nbsp;in&nbsp;a&nbsp;non-router&nbsp;machine.&nbsp;The&nbsp;REDIRECT&nbsp;version&nbsp;seems&nbsp;cleaner&nbsp;and&nbsp;is&nbsp;similar&nbsp;to&nbsp;what&nbsp;I&#39;ve&nbsp;being&nbsp;doing&nbsp;using&nbsp;the&nbsp;embedded&nbsp;proxy&nbsp;on&nbsp;the&nbsp;Mikrotik&nbsp;router.&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;Antony,&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;&gt; &lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;That&nbsp;won&#39;t&nbsp;work. &nbsp;You&nbsp;*must*&nbsp;perform&nbsp;the&nbsp;DNAT&nbsp;on&nbsp;the&nbsp;machine&nbsp;running&nbsp;Squid&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;Just&nbsp;for&nbsp;curiosity&#39;s&nbsp;sake,&nbsp;why&nbsp;there&nbsp;is&nbsp;such&nbsp;restriction?&nbsp;I thought squid&nbsp;didn&#39;t&nbsp;entered&nbsp;the&nbsp;picture&nbsp;until&nbsp;after&nbsp;DNAT&nbsp;was&nbsp;done,&nbsp;and&nbsp;that&nbsp;by&nbsp;then&nbsp;it&nbsp;wouldn&#39;t&nbsp;know&nbsp;where&nbsp;it&nbsp;happened.&nbsp;Does&nbsp;it&nbsp;somehow&nbsp;queries&nbsp;the&nbsp;system&nbsp;to&nbsp;know&nbsp;the&nbsp;original&nbsp;request&nbsp;destination?&nbsp;Wouldn&#39;t&nbsp;simply&nbsp;relying&nbsp;on&nbsp;the&nbsp;HOST&nbsp;header&nbsp;of&nbsp;the&nbsp;request&nbsp;suffice?&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;Ty.&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;2016-07-21&nbsp;3:07&nbsp;GMT-03:00&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&nbsp;target=&quot;_blank&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;On&nbsp;21/07/2016&nbsp;8:50&nbsp;a.m.,&nbsp;Antony&nbsp;Stone&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;On&nbsp;Wednesday&nbsp;20&nbsp;July&nbsp;2016&nbsp;at&nbsp;22:44:46,&nbsp;Bruno&nbsp;de&nbsp;Paula&nbsp;Larini&nbsp;wrote:&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;Em&nbsp;20/07/2016&nbsp;17:10,&nbsp;Antony&nbsp;Stone&nbsp;escreveu:&lt;br&gt;<br>
&gt;&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;You&nbsp;*must*&nbsp;perform&nbsp;the&nbsp;DNAT&nbsp;on&nbsp;the&nbsp;machine&nbsp;running&nbsp;Squid,&nbsp;which&nbsp;means&nbsp;that&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;the&nbsp;packets&nbsp;from&nbsp;your&nbsp;clients&nbsp;must&nbsp;pass&nbsp;through&nbsp;the&nbsp;Squid&nbsp;server,&nbsp;either&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;because&nbsp;it&nbsp;is&nbsp;in&nbsp;the&nbsp;default&nbsp;route,&nbsp;or&nbsp;because&nbsp;you&nbsp;use&nbsp;some&nbsp;form&nbsp;of&nbsp;policy&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;routing&nbsp;(not&nbsp;NAT)&nbsp;to&nbsp;direct&nbsp;port&nbsp;80&nbsp;requests&nbsp;through&nbsp;it.&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;If&nbsp;that&#39;s&nbsp;the&nbsp;case&nbsp;I&nbsp;think&nbsp;it&nbsp;would&nbsp;be&nbsp;better&nbsp;if&nbsp;the&nbsp;document&nbsp;instructed&lt;br&gt;<br>
&gt;&gt;&nbsp;to&nbsp;use&nbsp;REDIRECT&nbsp;--to-port&nbsp;instead&nbsp;DNAT&nbsp;as&nbsp;an&nbsp;implicit&nbsp;way&nbsp;to&nbsp;explain&nbsp;that.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;Primarily&nbsp;because&nbsp;the&nbsp;document&nbsp;you&nbsp;are&nbsp;looking&nbsp;at&nbsp;Bruno&nbsp;is&nbsp;the&nbsp;one&nbsp;for&lt;br&gt;<br>
DNAT.&nbsp;There&nbsp;is&nbsp;a&nbsp;different&nbsp;config&nbsp;example&nbsp;for&nbsp;REDIRECT&lt;br&gt;<br>
 &lt;&lt;a&nbsp;href=&quot;http://wiki.squid-cache.org/ConfigExamples/Intercept/LinuxRedirect&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://wiki.squid-cache.org/ConfigExamples/Intercept/LinuxRedirect&lt;/a&gt;&gt;&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;&quot;&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;What&nbsp;is&nbsp;unclear&nbsp;about:&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;*NOTE:*&nbsp;This&nbsp;configuration&nbsp;is&nbsp;given&nbsp;for&nbsp;use&nbsp;*on&nbsp;the&nbsp;squid&nbsp;box*.&nbsp;This&nbsp;is&lt;br&gt;<br>
&gt;&nbsp;required&nbsp;to&nbsp;perform&nbsp;intercept&nbsp;accurately&nbsp;and&nbsp;securely. &nbsp;To&nbsp;intercept&nbsp;from&nbsp;a&lt;br&gt;<br>
&gt;&nbsp;gateway&nbsp;machine&nbsp;and&nbsp;direct&nbsp;traffic&nbsp;at&nbsp;a&nbsp;separate&nbsp;squid&nbsp;box&nbsp;use&nbsp;policy&nbsp;routing.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; ?&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Antony.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;As&nbsp;to&nbsp;why&nbsp;we&nbsp;even&nbsp;have&nbsp;a&nbsp;DNAT&nbsp;page.&nbsp;That&nbsp;is&nbsp;because&nbsp;at&nbsp;high&nbsp;traffic&lt;br&gt;<br>
loads&nbsp;DNAT&nbsp;is&nbsp;measurably&nbsp;faster&nbsp;for&nbsp;iptables&nbsp;to&nbsp;perform&nbsp;than&nbsp;REDIRECT.&lt;br&gt;<br>
On&nbsp;machinery&nbsp;where&nbsp;the&nbsp;IPs&nbsp;are&nbsp;static&nbsp;and&nbsp;performance&nbsp;is&nbsp;needed,&nbsp;DNAT&lt;br&gt;<br>
*on&nbsp;the&nbsp;same&nbsp;machine*&nbsp;is&nbsp;the&nbsp;best&nbsp;way&nbsp;to&nbsp;go.&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;<br>
Amos&lt;br&gt;<br>
&lt;/font&gt;&lt;/span&gt;&lt;div&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
