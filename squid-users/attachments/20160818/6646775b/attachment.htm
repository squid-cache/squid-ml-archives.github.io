<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;My&nbsp;Kerberos&nbsp;Authentication&nbsp;doesn&#39;t&nbsp;work.&nbsp;This&nbsp;is&nbsp;very&nbsp;hard!&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;My&nbsp;Squid3&nbsp;is&nbsp;join&nbsp;in&nbsp;the&nbsp;Domain&lt;/div&gt;&lt;div&gt;kinit&nbsp;and&nbsp;klist&nbsp;are&nbsp;ok&lt;/div&gt;&lt;div&gt;wbinfo&nbsp;-g&nbsp;and&nbsp;wbinfo&nbsp;-u&nbsp;are&nbsp;ok&nbsp;too.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;have&nbsp;created&nbsp;the&nbsp;squid3&nbsp;file&nbsp;in&nbsp;/etc/default&nbsp;with&nbsp;the&nbsp;following&nbsp;content: &lt;/div&gt;&lt;div&gt;KRB5_KTNAME=/etc/squid3/HTTP.keytab&lt;/div&gt;&lt;div&gt;export&nbsp;KRB5_KTNAME&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;have&nbsp;two&nbsp;keytab&nbsp;files:&lt;/div&gt;&lt;div&gt;/etc/krb5.keytab&nbsp;and&nbsp;/etc/squid3/HTTP.keytab&nbsp;(both&nbsp;are&nbsp;identical)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;have&nbsp;installed&nbsp;libsasl2-modules-gssapi-mit&nbsp;libsasl2-modules&nbsp;packages&nbsp;because&nbsp;my&nbsp;Squid&nbsp;server&nbsp;is&nbsp;Debian&nbsp;8.&nbsp;But&nbsp;I&nbsp;didn&#39;t&nbsp;use&nbsp;msktutil&nbsp;tool.&nbsp;I&nbsp;have&nbsp;only&nbsp;joined&nbsp;Squid&nbsp;server&nbsp;in&nbsp;the&nbsp;Domain&nbsp;(net&nbsp;ads&nbsp;join&nbsp;-U&nbsp;administrator)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;How&nbsp;can&nbsp;I&nbsp;debbug&nbsp;the&nbsp;problem?&lt;/div&gt;&lt;div&gt;How&nbsp;can&nbsp;I&nbsp;test&nbsp;kerberos&nbsp;authentication&nbsp;in&nbsp;terminal&nbsp;(command&nbsp;line)?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Below&nbsp;is&nbsp;my&nbsp;squid.conf&nbsp;file:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;###&nbsp;Configuracoes&nbsp;Basicas&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;cache_mgr&nbsp;&lt;a&nbsp;href=&quot;mailto:administrator@empresa.com.br&quot;&gt;administrator@empresa.com.br&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;http_port&nbsp;3128&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#debug_options&nbsp;ALL,111,2&nbsp;29,9&nbsp;84,6&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;cache_mem&nbsp;512&nbsp;MB&lt;/div&gt;&lt;div&gt;cache_swap_low&nbsp;80&lt;/div&gt;&lt;div&gt;cache_swap_high&nbsp;90&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;maximum_object_size&nbsp;512&nbsp;MB&lt;/div&gt;&lt;div&gt;minimum_object_size&nbsp;0&nbsp;KB&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;maximum_object_size_in_memory&nbsp;4096&nbsp;KB&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;cache_replacement_policy&nbsp;heap&nbsp;LFUDA&lt;/div&gt;&lt;div&gt;memory_replacement_policy&nbsp;heap&nbsp;LFUDA&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#Para&nbsp;não&nbsp;bloquear&nbsp;downloads&lt;/div&gt;&lt;div&gt;quick_abort_min&nbsp;-1&nbsp;KB&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#Resolve&nbsp;um&nbsp;problema&nbsp;com&nbsp;conexoes&nbsp;persistentes&lt;/div&gt;&lt;div&gt;detect_broken_pconn&nbsp;on&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;fqdncache_size&nbsp;1024&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;###&nbsp;Parametros&nbsp;de&nbsp;atualizacao&nbsp;da&nbsp;memoria&nbsp;cache&lt;/div&gt;&lt;div&gt;refresh_pattern&nbsp;^ftp:&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;1440&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;20%&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;10080&lt;/div&gt;&lt;div&gt;refresh_pattern&nbsp;^gopher:&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;1440&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;0%&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;1440&lt;/div&gt;&lt;div&gt;refresh_pattern&nbsp;-i&nbsp;(/cgi-bin/|\?)&nbsp;0&nbsp;0%&nbsp;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;refresh_pattern&nbsp;.&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;0&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&lt;/span&gt;20%&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;4320&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;###&nbsp;Localizacao&nbsp;dos&nbsp;logs&lt;/div&gt;&lt;div&gt;access_log&nbsp;/var/log/squid3/access.log&lt;/div&gt;&lt;div&gt;cache_log&nbsp;/var/log/squid3/cache.log&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;###&nbsp;define&nbsp;a&nbsp;localizacao&nbsp;do&nbsp;cache&nbsp;de&nbsp;disco,&nbsp;tamanho,&nbsp;qtd&nbsp;de&nbsp;diretorios&nbsp;pai&nbsp;e&nbsp;subdiretorios&lt;/div&gt;&lt;div&gt;cache_dir&nbsp;aufs&nbsp;/var/spool/squid3&nbsp;600&nbsp;16&nbsp;256&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;auth_param&nbsp;negotiate&nbsp;program&nbsp;/usr/lib/squid3/negotiate_kerberos_auth&nbsp;-s&nbsp;HTTP/&lt;a&nbsp;href=&quot;mailto:proxy.empresa.com.br@EMPRESA.COM.BR&quot;&gt;proxy.empresa.com.br@EMPRESA.COM.BR&lt;/a&gt;&lt;/div&gt;&lt;div&gt;auth_param&nbsp;negotiate&nbsp;children&nbsp;20&lt;/div&gt;&lt;div&gt;auth_param&nbsp;negotiate&nbsp;keep_alive&nbsp;on&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;visible_hostname&nbsp;&lt;a&nbsp;href=&quot;http://proxy.empresa.com.br&quot;&gt;proxy.empresa.com.br&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;###&nbsp;acls&lt;/div&gt;&lt;div&gt;#acl&nbsp;manager&nbsp;proto&nbsp;cache_object&lt;/div&gt;&lt;div&gt;acl&nbsp;localhost&nbsp;src&nbsp;&lt;a&nbsp;href=&quot;http://192.168.200.7/32&quot;&gt;192.168.200.7/32&lt;/a&gt;&lt;/div&gt;&lt;div&gt;acl&nbsp;to_localhost&nbsp;dst&nbsp;&lt;a&nbsp;href=&quot;http://192.168.200.7/32&quot;&gt;192.168.200.7/32&lt;/a&gt;&lt;/div&gt;&lt;div&gt;acl&nbsp;SSL_ports&nbsp;port&nbsp;22&nbsp;443&nbsp;563&nbsp;7071&nbsp;10000&nbsp;#&nbsp;ssh,&nbsp;https,&nbsp;snews,&nbsp;zimbra,&nbsp;webmin&lt;/div&gt;&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;21&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&nbsp;#&nbsp;ftp&lt;/div&gt;&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;70&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&nbsp;#&nbsp;gopher&lt;/div&gt;&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;80&nbsp;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&nbsp;#&nbsp;http&lt;/div&gt;&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;88&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&nbsp;#&nbsp;kerberos&lt;/div&gt;&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;210&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&nbsp;#&nbsp;wais&lt;/div&gt;&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;280&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&nbsp;#&nbsp;http-mgmt&lt;/div&gt;&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;389&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&nbsp;#&nbsp;ldap&lt;/div&gt;&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;443&nbsp;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&nbsp;#&nbsp;https&lt;/div&gt;&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;488&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&nbsp;#&nbsp;gss-http&lt;/div&gt;&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;563&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&nbsp;#&nbsp;snews&lt;/div&gt;&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;591&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&nbsp;#&nbsp;filemaker&lt;/div&gt;&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;777&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&nbsp;#&nbsp;multiling&nbsp;http&lt;/div&gt;&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;3001&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;imprenssa&nbsp;nacional&lt;/div&gt;&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;8080&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&lt;/span&gt;&nbsp;#&nbsp;http&lt;/div&gt;&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;1025-65535&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&nbsp;#&nbsp;unregistered&nbsp;ports&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;acl&nbsp;purge&nbsp;method&nbsp;PURGE&lt;/div&gt;&lt;div&gt;acl&nbsp;CONNECT&nbsp;method&nbsp;CONNECT&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;###&nbsp;Regras&nbsp;iniciais&nbsp;do&nbsp;Squid&lt;/div&gt;&lt;div&gt;http_access&nbsp;allow&nbsp;localhost&lt;/div&gt;&lt;div&gt;http_access&nbsp;allow&nbsp;purge&nbsp;localhost&lt;/div&gt;&lt;div&gt;http_access&nbsp;deny&nbsp;purge&lt;/div&gt;&lt;div&gt;http_access&nbsp;deny&nbsp;!Safe_ports&lt;/div&gt;&lt;div&gt;http_access&nbsp;deny&nbsp;CONNECT&nbsp;!SSL_ports&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;###&nbsp;Exige&nbsp;autenticacao&lt;/div&gt;&lt;div&gt;acl&nbsp;autenticados&nbsp;proxy_auth&nbsp;REQUIRED&lt;/div&gt;&lt;div&gt;http_access&nbsp;allow&nbsp;autenticados&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;###&nbsp;Rede&nbsp;do&nbsp;Local&nbsp;#####&lt;/div&gt;&lt;div&gt;acl&nbsp;rede_local&nbsp;src&nbsp;&lt;a&nbsp;href=&quot;http://192.168.200.0/22&quot;&gt;192.168.200.0/22&lt;/a&gt; &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;###&nbsp;Nega&nbsp;acesso&nbsp;de&nbsp;quem&nbsp;nao&nbsp;esta&nbsp;na&nbsp;rede&nbsp;local&lt;/div&gt;&lt;div&gt;http_access&nbsp;allow&nbsp;rede_local &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#negando&nbsp;o&nbsp;acesso&nbsp;para&nbsp;todos&nbsp;que&nbsp;nao&nbsp;estiverem&nbsp;nas&nbsp;regras&nbsp;anteriores&lt;/div&gt;&lt;div&gt;http_access&nbsp;deny&nbsp;all&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;###&nbsp;Erros&nbsp;em&nbsp;portugues&lt;/div&gt;&lt;div&gt;error_directory&nbsp;/usr/share/squid3/errors/pt-br&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#cache_effective_user&nbsp;proxy&lt;/div&gt;&lt;div&gt;coredump_dir&nbsp;/var/spool/squid3&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Regards,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Márcio&lt;/div&gt;&lt;/div&gt;<br>

</tt>
