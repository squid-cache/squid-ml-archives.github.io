<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Oh,&nbsp;an&nbsp;a&nbsp;tiny&nbsp;little&nbsp;detail&nbsp;:) &lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;p&nbsp;style=&quot;margin:0px;font-size:11px;line-height:normal;font-family:Menlo&quot;&gt;&lt;span&nbsp;style=&quot;&quot;&gt;#&nbsp;squid&nbsp;-v&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0px;font-size:11px;line-height:normal;font-family:Menlo&quot;&gt;&lt;span&nbsp;style=&quot;&quot;&gt;Squid&nbsp;Cache:&nbsp;Version&nbsp;4.0.13&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0px;font-size:11px;line-height:normal;font-family:Menlo&quot;&gt;&lt;span&nbsp;style=&quot;&quot;&gt;Service&nbsp;Name:&nbsp;squid&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0px;font-size:11px;line-height:normal;font-family:Menlo&quot;&gt;&lt;span&nbsp;style=&quot;&quot;&gt;configure&nbsp;options: &nbsp;&#39;--with-openssl&#39;&nbsp;&#39;--prefix=/usr&#39;&nbsp;&#39;--localstatedir=/var&#39;&nbsp;&#39;--libexecdir=/lib/squid&#39;&nbsp;&#39;--datadir=/share/squid&#39;&nbsp;&#39;--sysconfdir=/etc/squid&#39;&nbsp;&#39;--with-default-user=proxy&#39;&nbsp;&#39;--with-logdir=/var/log/squid&#39;&nbsp;&#39;--with-pidfile=/var/run/squid.pid&#39;&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Wed,&nbsp;Aug&nbsp;24,&nbsp;2016&nbsp;at&nbsp;4:37&nbsp;PM,&nbsp;Diogenes&nbsp;S.&nbsp;Jesus&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:splash@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;splash@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;This&nbsp;configuration&nbsp;here&nbsp;covers&nbsp;the&nbsp;use&nbsp;case&nbsp;described&nbsp;by&nbsp;the&nbsp;OP: &lt;div&gt;&lt;a&nbsp;href=&quot;https://gist.githubusercontent.com/splashx/758ff0c59ea291f32edafc516fdaad73/raw/8050fa054821657812961050332b38a56e7e3e68/&quot;&nbsp;target=&quot;_blank&quot;&gt;https://gist.&lt;wbr&gt;githubusercontent.com/splashx/&lt;wbr&gt;758ff0c59ea291f32edafc516fdaad&lt;wbr&gt;73/raw/&lt;wbr&gt;8050fa054821657812961050332b38&lt;wbr&gt;a56e7e3e68/&lt;/a&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;If&nbsp;everything&nbsp;works&nbsp;well,&nbsp;you&#39;ll&nbsp;notice&nbsp;you&nbsp;won&#39;t&nbsp;support&nbsp;HTTP&nbsp;proxy&nbsp;at&nbsp;all,&nbsp;but&nbsp;users&nbsp;can&nbsp;reach&nbsp; both&nbsp;HTTP&nbsp;and&nbsp;HTTPS&nbsp;target&nbsp;websites&nbsp;via&nbsp;your&nbsp;HTTPS&nbsp;proxy.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;p&nbsp;style=&quot;margin:0px;font-size:11px;line-height:normal;font-family:Menlo&quot;&gt;#&nbsp;netstat&nbsp;-nltp&lt;/p&gt;&lt;p&nbsp;style=&quot;margin:0px;font-size:11px;line-height:normal;font-family:Menlo&quot;&gt;Active&nbsp;Internet&nbsp;connections&nbsp;(only&nbsp;servers)&lt;/p&gt;&lt;p&nbsp;style=&quot;margin:0px;font-size:11px;line-height:normal;font-family:Menlo&quot;&gt;Proto&nbsp;Recv-Q&nbsp;Send-Q&nbsp;Local&nbsp;Address&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Foreign&nbsp;Address&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;State&nbsp; &nbsp; &nbsp; &nbsp;PID/Program&nbsp;name&lt;/p&gt;&lt;p&nbsp;style=&quot;margin:0px;font-size:11px;line-height:normal;font-family:Menlo&quot;&gt;tcp &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp;0&nbsp;&lt;a&nbsp;href=&quot;http://0.0.0.0:22&quot;&nbsp;target=&quot;_blank&quot;&gt;0.0.0.0:22&lt;/a&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0:*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;LISTEN &nbsp; &nbsp; &nbsp;32109/sshd&nbsp; &nbsp; &nbsp; &lt;/p&gt;&lt;p&nbsp;style=&quot;margin:0px;font-size:11px;line-height:normal;font-family:Menlo&quot;&gt;tcp6&nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp;0&nbsp;:::80&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;:::* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;LISTEN &nbsp; &nbsp; &nbsp;26627/apache2 &nbsp; &lt;/p&gt;&lt;p&nbsp;style=&quot;margin:0px;font-size:11px;line-height:normal;font-family:Menlo&quot;&gt;tcp6&nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp;0&nbsp;:::3443&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;:::* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;LISTEN &nbsp; &nbsp; &nbsp;7303/(squid-1)&nbsp; &lt;/p&gt;&lt;p&nbsp;style=&quot;margin:0px;font-size:11px;line-height:normal;font-family:Menlo&quot;&gt;tcp6&nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp;0&nbsp;:::22&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;:::* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;LISTEN &nbsp; &nbsp; &nbsp;32109/sshd&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;div&gt;The&nbsp;user&nbsp;connects&nbsp;to&nbsp;the&nbsp;proxy&nbsp;ONLY&nbsp;via&nbsp;HTTPS&nbsp;Proxy&nbsp;on&nbsp;port&nbsp;3443&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;All&nbsp;traffic&nbsp;between&nbsp;the&nbsp;OP&nbsp;and&nbsp;the&nbsp;proxy&nbsp;is&nbsp;encrypted&nbsp;using&nbsp;TLS. &lt;/div&gt;&lt;div&gt;A)&nbsp;If&nbsp;the&nbsp;user&nbsp;enters&nbsp;&lt;a&nbsp;href=&quot;http://target.example.com&quot;&nbsp;target=&quot;_blank&quot;&gt;http://target.example.com&lt;/a&gt;,&nbsp;between&nbsp;the&nbsp;proxy&nbsp;and&nbsp;the&nbsp;target&nbsp;you&#39;ll&nbsp;see&nbsp;HTTP. &lt;/div&gt;&lt;div&gt;B)&nbsp;If&nbsp;the&nbsp;user&nbsp;enters&nbsp;&lt;a&nbsp;href=&quot;https://target.example.com&quot;&nbsp;target=&quot;_blank&quot;&gt;https://target.example.com&lt;/a&gt;,&nbsp;between&nbsp;the&nbsp;proxy&nbsp;and&nbsp;the&nbsp;target&nbsp;you&#39;ll&nbsp;see&nbsp;HTTPS.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;If&nbsp;you&nbsp;sniff&nbsp;the&nbsp;traffic&nbsp;between&nbsp;the&nbsp;client&nbsp;and&nbsp;the&nbsp;proxy,&nbsp;you&#39;ll&nbsp;see&nbsp;TLS.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Tested&nbsp;with:&lt;/div&gt;&lt;div&gt;&lt;p&nbsp;style=&quot;margin:0px;font-size:11px;line-height:normal;font-family:Menlo&quot;&gt;&lt;span&gt;$&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(234,234,234)&quot;&gt;&nbsp;&lt;/span&gt;&lt;span&gt;/Applications/Firefox\&nbsp;2.app/Contents/MacOS/firefox&nbsp;-v&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0px;font-size:11px;line-height:normal;font-family:Menlo&quot;&gt;&lt;span&gt;Mozilla&nbsp;Firefox&nbsp;48.0&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Firefox&nbsp;set&nbsp;up&nbsp;to&nbsp;use&nbsp;PAC:&nbsp;Preferences&nbsp;&gt;&nbsp;Advanced&nbsp;&gt;&nbsp;Network&nbsp;&gt;&nbsp;Settings:&nbsp;&quot;Automatic&nbsp;Proxy&nbsp;Configuration&quot;: &lt;a&nbsp;href=&quot;http://squid.example.com/proxy.pac&quot;&nbsp;target=&quot;_blank&quot;&gt;http://squid.&lt;wbr&gt;example.com/proxy.pac&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;downside&nbsp;here&nbsp;of&nbsp;course&nbsp;is&nbsp;the&nbsp;limited&nbsp;amount&nbsp;of&nbsp;clients&nbsp;supporting&nbsp;HTTPS&nbsp;Proxy&nbsp;settings.&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Dio&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Wed,&nbsp;Aug&nbsp;24,&nbsp;2016&nbsp;at&nbsp;3:46&nbsp;PM,&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&nbsp;target=&quot;_blank&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;Just&nbsp;to&nbsp;rewind&nbsp;this&nbsp;conversation&nbsp;to&nbsp;the&nbsp;actual&nbsp;problem&nbsp;...&lt;br&gt;<br>
&lt;span&gt;&lt;br&gt;<br>
On&nbsp;24/08/2016&nbsp;11:42&nbsp;p.m.,&nbsp;Samuraiii&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;On&nbsp;24.8.2016&nbsp;13:18,&nbsp;Antony&nbsp;Stone&nbsp;wrote:&lt;br&gt;<br>
&gt;&gt;&nbsp;Unfortunately&nbsp;it&#39;s&nbsp;not&nbsp;Squid&nbsp;that&#39;s&nbsp;the&nbsp;challenge&nbsp;-&nbsp;it&#39;s&nbsp;the&nbsp;browser.&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;If&nbsp;you&#39;re&nbsp;using&nbsp;Firefox&nbsp;and/or&nbsp;Chrome,&nbsp;you&nbsp;should&nbsp;be&nbsp;okay.&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;See&nbsp;&quot;Encrypted&nbsp;browser-Squid&nbsp;connection&quot;&nbsp;at&nbsp;the&nbsp;bottom&nbsp;of&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;a&nbsp;href=&quot;http://wiki.squid-cache.org/Features/HTTPS&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://wiki.squid-cache.org/Fe&lt;wbr&gt;atures/HTTPS&lt;/a&gt;&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;Antony.&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;have&nbsp;seen&nbsp;that,&nbsp;it&nbsp;is&nbsp;the&nbsp;cause&nbsp;of&nbsp;my&nbsp;subscription&nbsp;to&nbsp;this&nbsp;list.&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;haven&#39;t&nbsp;been&nbsp;able&nbsp;to&nbsp;find&nbsp;any&nbsp;usable&nbsp;hints.&lt;br&gt;<br>
&gt;&nbsp;My&nbsp;config&nbsp;attempt&nbsp;fails&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;&lt;snip&gt;&lt;br&gt;<br>
&lt;span&gt;&gt;&lt;br&gt;<br>
&gt;&nbsp;https_port&nbsp;8443&nbsp;\&lt;br&gt;<br>
&gt; &nbsp; &nbsp; cert=/etc/letsencrypt/live/&lt;a&nbsp;href=&quot;http://sklad.duckdns.org/cert.pem&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;sk&lt;wbr&gt;lad.duckdns.org/cert.pem&lt;/a&gt;&nbsp;\&lt;br&gt;<br>
&gt; &nbsp; &nbsp; key=/etc/letsencrypt/live/&lt;a&nbsp;href=&quot;http://sklad.duckdns.org/key.pem&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;skl&lt;wbr&gt;ad.duckdns.org/key.pem&lt;/a&gt;&nbsp;\&lt;br&gt;<br>
&gt; &nbsp; &nbsp; cleintca=/etc/letsencrypt/liv&lt;wbr&gt;e/&lt;a&nbsp;href=&quot;http://sklad.duckdns.org/fullchain.pem&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;sklad.duckdns.org/fullchain.&lt;wbr&gt;pem&lt;/a&gt;&nbsp;\&lt;br&gt;<br>
&gt; &nbsp; &nbsp; tls-dh=/etc/ssl/certs/&lt;wbr&gt;dhparam.pem&nbsp;\&lt;br&gt;<br>
&gt; &nbsp; &nbsp; sslproxy_options=NO_SSLv2,NO_&lt;wbr&gt;SSLv3,SINGLE_DH_USE&nbsp;\&lt;br&gt;<br>
&gt; &nbsp; &nbsp; cipher=HIGH&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;As&nbsp;Dio&nbsp;mentioned&nbsp;the&nbsp;cleintca=&nbsp;(or&nbsp;rather&nbsp;clientca=)&nbsp;is&nbsp;for&lt;br&gt;<br>
authenticating&nbsp;clients&nbsp;ceritficates.&nbsp;Don&#39;t&nbsp;use&nbsp;that&nbsp;unless&nbsp;you&nbsp;are&lt;br&gt;<br>
requiring&nbsp;client&nbsp;certs&nbsp;in&nbsp;TLS.&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;rest&nbsp;of&nbsp;your&nbsp;config&nbsp;looks&nbsp;reasonable&nbsp;to&nbsp;me.&nbsp;I&nbsp;suspect&nbsp;you&nbsp;have&nbsp;found&lt;br&gt;<br>
a&nbsp;bug&nbsp;introduced&nbsp;during&nbsp;all&nbsp;the&nbsp;SSL-Bump&nbsp;code&nbsp;changes.&nbsp;Please&nbsp;make&nbsp;a&lt;br&gt;<br>
bugzilla&nbsp;report&nbsp;and&nbsp;include&nbsp;your&nbsp;exact&nbsp;Squid&nbsp;version&nbsp;(found&nbsp;with&nbsp;the&lt;br&gt;<br>
&#39;squid&nbsp;-v&#39;&nbsp;command),&nbsp;the&nbsp;https_port&nbsp;line(s)&nbsp;and&nbsp;the&nbsp;exact&nbsp;error&nbsp;message&lt;br&gt;<br>
produced&nbsp;on&nbsp;startup.&lt;br&gt;<br>
&lt;span&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;<br>
Amos&lt;br&gt;<br>
&lt;/font&gt;&lt;/span&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;<br>
______________________________&lt;wbr&gt;_________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.&lt;wbr&gt;org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/l&lt;wbr&gt;istinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;--&nbsp;&lt;br&gt;&lt;div&nbsp;data-smartmail=&quot;gmail_signature&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;br&gt;--------&lt;br&gt;&lt;br&gt;Diogenes&nbsp;S.&nbsp;de&nbsp;Jesus&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/span&gt;&lt;/div&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;--&nbsp;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_signature&quot;&nbsp;data-smartmail=&quot;gmail_signature&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;br&gt;--------&lt;br&gt;&lt;br&gt;Diogenes&nbsp;S.&nbsp;de&nbsp;Jesus&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/div&gt;<br>

</tt>
