<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;div&gt;I&nbsp;have&nbsp;trouble&nbsp;to&nbsp;authenticate&nbsp;Squid3&nbsp;with&nbsp;kerberos&nbsp;in&nbsp;Samba4&nbsp;domain.&nbsp;I&#39;m&nbsp;using&nbsp;CentOS&nbsp;7&nbsp;and&nbsp;Squid&nbsp;3.3.8&nbsp;(yum&nbsp;install&nbsp;squid)&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;When&nbsp;I&nbsp;type&nbsp;the&nbsp;bellow&nbsp;command&nbsp;in&nbsp;terminal:&nbsp;&lt;br&gt;/usr/lib64/squid/negotiate_kerberos_auth&nbsp;-d&nbsp;-i&nbsp;-s&nbsp;HTTP/&lt;a&nbsp;href=&quot;mailto:proxy.cms.ensino.br@CMS.ENSINO.BR&quot;&gt;proxy.cms.ensino.br@CMS.ENSINO.BR&lt;/a&gt;&lt;br&gt;john&nbsp;xyz@12345&lt;br&gt;&lt;br&gt;I&nbsp;have&nbsp;the&nbsp;following&nbsp;error:&lt;br&gt;negotiate_kerberos_auth.cc(315):&nbsp;pid=6364&nbsp;:2016/08/27&nbsp;10:44:33|&nbsp;negotiate_kerberos_auth:&nbsp;DEBUG:&nbsp;Got&nbsp;&#39;john&nbsp;xyz@12345&#39;&nbsp;from&nbsp;squid&nbsp;(length:&nbsp;14).&lt;br&gt;negotiate_kerberos_auth.cc(362):&nbsp;pid=6364&nbsp;:2016/08/27&nbsp;10:44:33|&nbsp;negotiate_kerberos_auth:&nbsp;ERROR:&nbsp;Invalid&nbsp;request&nbsp;[john&nbsp;xyz@12345]&lt;br&gt;BH&nbsp;invalid&nbsp;request&nbsp;&lt;br&gt;&lt;br&gt;&lt;br&gt;Here&nbsp;are&nbsp;my&nbsp;files&nbsp;configuration:&lt;br&gt;&lt;br&gt;/etc/krb5.conf&lt;br&gt;[libdefaults]&lt;br&gt;   &nbsp;default_realm&nbsp;=&nbsp;&lt;a&nbsp;href=&quot;http://CMS.ENSINO.BR&quot;&gt;CMS.ENSINO.BR&lt;/a&gt;&lt;br&gt;[realms]&lt;br&gt;   &nbsp;&lt;a&nbsp;href=&quot;http://CMS.ENSINO.BR&quot;&gt;CMS.ENSINO.BR&lt;/a&gt;&nbsp;=&nbsp;{&lt;br&gt;   &nbsp;kdc&nbsp;=&nbsp;&lt;a&nbsp;href=&quot;http://dc1.cms.ensino.br:88&quot;&gt;dc1.cms.ensino.br:88&lt;/a&gt;&lt;br&gt;   &nbsp;admin_server&nbsp;=&nbsp;&lt;a&nbsp;href=&quot;http://dc1.cms.ensino.br&quot;&gt;dc1.cms.ensino.br&lt;/a&gt;&lt;br&gt;   &nbsp;default_domain&nbsp;=&nbsp;&lt;a&nbsp;href=&quot;http://CMS.ENSINO.BR&quot;&gt;CMS.ENSINO.BR&lt;/a&gt;&nbsp;&lt;br&gt;   &nbsp;}&lt;br&gt;[domain_realm]&lt;br&gt;   &nbsp;.&lt;a&nbsp;href=&quot;http://cms.ensino.br&quot;&gt;cms.ensino.br&lt;/a&gt;&nbsp;=&nbsp;&lt;a&nbsp;href=&quot;http://CMS.ENSINO.BR&quot;&gt;CMS.ENSINO.BR&lt;/a&gt;&lt;br&gt;   &nbsp;&lt;a&nbsp;href=&quot;http://cms.ensino.br&quot;&gt;cms.ensino.br&lt;/a&gt;&nbsp;=&nbsp;&lt;a&nbsp;href=&quot;http://CMS.ENSINO.BR&quot;&gt;CMS.ENSINO.BR&lt;/a&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;Keytab&nbsp;name:&nbsp;FILE:/etc/krb5.keytab&lt;br&gt;KVNO&nbsp;Principal&lt;br&gt;----&nbsp;--------------------------------------------------------------------------&lt;br&gt;  &nbsp;1&nbsp;proxy-k$@&lt;a&nbsp;href=&quot;http://CMS.ENSINO.BR&quot;&gt;CMS.ENSINO.BR&lt;/a&gt;&lt;br&gt;  &nbsp;1&nbsp;proxy-k$@&lt;a&nbsp;href=&quot;http://CMS.ENSINO.BR&quot;&gt;CMS.ENSINO.BR&lt;/a&gt;&lt;br&gt;  &nbsp;1&nbsp;proxy-k$@&lt;a&nbsp;href=&quot;http://CMS.ENSINO.BR&quot;&gt;CMS.ENSINO.BR&lt;/a&gt;&lt;br&gt;  &nbsp;1&nbsp;HTTP/&lt;a&nbsp;href=&quot;mailto:proxy.cms.ensino.br@CMS.ENSINO.BR&quot;&gt;proxy.cms.ensino.br@CMS.ENSINO.BR&lt;/a&gt;&lt;br&gt;  &nbsp;1&nbsp;HTTP/&lt;a&nbsp;href=&quot;mailto:proxy.cms.ensino.br@CMS.ENSINO.BR&quot;&gt;proxy.cms.ensino.br@CMS.ENSINO.BR&lt;/a&gt;&lt;br&gt;  &nbsp;1&nbsp;HTTP/&lt;a&nbsp;href=&quot;mailto:proxy.cms.ensino.br@CMS.ENSINO.BR&quot;&gt;proxy.cms.ensino.br@CMS.ENSINO.BR&lt;/a&gt;&lt;br&gt;  &nbsp;1&nbsp;host/&lt;a&nbsp;href=&quot;mailto:proxy.cms.ensino.br@CMS.ENSINO.BR&quot;&gt;proxy.cms.ensino.br@CMS.ENSINO.BR&lt;/a&gt;&lt;br&gt;  &nbsp;1&nbsp;host/&lt;a&nbsp;href=&quot;mailto:proxy.cms.ensino.br@CMS.ENSINO.BR&quot;&gt;proxy.cms.ensino.br@CMS.ENSINO.BR&lt;/a&gt;&lt;br&gt;  &nbsp;1&nbsp;host/&lt;a&nbsp;href=&quot;mailto:proxy.cms.ensino.br@CMS.ENSINO.BR&quot;&gt;proxy.cms.ensino.br@CMS.ENSINO.BR&lt;/a&gt;&lt;br&gt;  &nbsp;1&nbsp;host/&lt;a&nbsp;href=&quot;mailto:proxy.cms.ensino.br@CMS.ENSINO.BR&quot;&gt;proxy.cms.ensino.br@CMS.ENSINO.BR&lt;/a&gt;&lt;br&gt;  &nbsp;1&nbsp;host/&lt;a&nbsp;href=&quot;mailto:proxy.cms.ensino.br@CMS.ENSINO.BR&quot;&gt;proxy.cms.ensino.br@CMS.ENSINO.BR&lt;/a&gt;&lt;br&gt;  &nbsp;1&nbsp;host/&lt;a&nbsp;href=&quot;mailto:PROXY@CMS.ENSINO.BR&quot;&gt;PROXY@CMS.ENSINO.BR&lt;/a&gt;&lt;br&gt;  &nbsp;1&nbsp;host/&lt;a&nbsp;href=&quot;mailto:PROXY@CMS.ENSINO.BR&quot;&gt;PROXY@CMS.ENSINO.BR&lt;/a&gt;&lt;br&gt;  &nbsp;1&nbsp;host/&lt;a&nbsp;href=&quot;mailto:PROXY@CMS.ENSINO.BR&quot;&gt;PROXY@CMS.ENSINO.BR&lt;/a&gt;&lt;br&gt;  &nbsp;1&nbsp;host/&lt;a&nbsp;href=&quot;mailto:PROXY@CMS.ENSINO.BR&quot;&gt;PROXY@CMS.ENSINO.BR&lt;/a&gt;&lt;br&gt;  &nbsp;1&nbsp;host/&lt;a&nbsp;href=&quot;mailto:PROXY@CMS.ENSINO.BR&quot;&gt;PROXY@CMS.ENSINO.BR&lt;/a&gt;&lt;br&gt;  &nbsp;1&nbsp;PROXY$@&lt;a&nbsp;href=&quot;http://CMS.ENSINO.BR&quot;&gt;CMS.ENSINO.BR&lt;/a&gt;&lt;br&gt;  &nbsp;1&nbsp;PROXY$@&lt;a&nbsp;href=&quot;http://CMS.ENSINO.BR&quot;&gt;CMS.ENSINO.BR&lt;/a&gt;&lt;br&gt;  &nbsp;1&nbsp;PROXY$@&lt;a&nbsp;href=&quot;http://CMS.ENSINO.BR&quot;&gt;CMS.ENSINO.BR&lt;/a&gt;&lt;br&gt;  &nbsp;1&nbsp;PROXY$@&lt;a&nbsp;href=&quot;http://CMS.ENSINO.BR&quot;&gt;CMS.ENSINO.BR&lt;/a&gt;&lt;br&gt;  &nbsp;1&nbsp;PROXY$@&lt;a&nbsp;href=&quot;http://CMS.ENSINO.BR&quot;&gt;CMS.ENSINO.BR&lt;/a&gt;&lt;br&gt;  &nbsp;1&nbsp;proxy-k$@&lt;a&nbsp;href=&quot;http://CMS.ENSINO.BR&quot;&gt;CMS.ENSINO.BR&lt;/a&gt;&lt;br&gt;  &nbsp;1&nbsp;proxy-k$@&lt;a&nbsp;href=&quot;http://CMS.ENSINO.BR&quot;&gt;CMS.ENSINO.BR&lt;/a&gt;&lt;br&gt;  &nbsp;1&nbsp;HTTP/&lt;a&nbsp;href=&quot;mailto:proxy.cms.ensino.br@CMS.ENSINO.BR&quot;&gt;proxy.cms.ensino.br@CMS.ENSINO.BR&lt;/a&gt;&lt;br&gt;  &nbsp;1&nbsp;HTTP/&lt;a&nbsp;href=&quot;mailto:proxy.cms.ensino.br@CMS.ENSINO.BR&quot;&gt;proxy.cms.ensino.br@CMS.ENSINO.BR&lt;/a&gt;&lt;br&gt;  &nbsp;1&nbsp;HTTP/&lt;a&nbsp;href=&quot;mailto:PROXY@CMS.ENSINO.BR&quot;&gt;PROXY@CMS.ENSINO.BR&lt;/a&gt;&lt;br&gt;  &nbsp;1&nbsp;HTTP/&lt;a&nbsp;href=&quot;mailto:PROXY@CMS.ENSINO.BR&quot;&gt;PROXY@CMS.ENSINO.BR&lt;/a&gt;&lt;br&gt;  &nbsp;1&nbsp;HTTP/&lt;a&nbsp;href=&quot;mailto:PROXY@CMS.ENSINO.BR&quot;&gt;PROXY@CMS.ENSINO.BR&lt;/a&gt;&lt;br&gt;  &nbsp;1&nbsp;HTTP/&lt;a&nbsp;href=&quot;mailto:PROXY@CMS.ENSINO.BR&quot;&gt;PROXY@CMS.ENSINO.BR&lt;/a&gt;&lt;br&gt;  &nbsp;1&nbsp;HTTP/&lt;a&nbsp;href=&quot;mailto:PROXY@CMS.ENSINO.BR&quot;&gt;PROXY@CMS.ENSINO.BR&lt;/a&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;Keytab&nbsp;name:&nbsp;FILE:/etc/squid/PROXY.keytab&lt;br&gt;KVNO&nbsp;Principal&lt;br&gt;----&nbsp;--------------------------------------------------------------------------&lt;br&gt;  &nbsp;1&nbsp;proxy-k$@&lt;a&nbsp;href=&quot;http://CMS.ENSINO.BR&quot;&gt;CMS.ENSINO.BR&lt;/a&gt;&lt;br&gt;  &nbsp;1&nbsp;proxy-k$@&lt;a&nbsp;href=&quot;http://CMS.ENSINO.BR&quot;&gt;CMS.ENSINO.BR&lt;/a&gt;&lt;br&gt;  &nbsp;1&nbsp;proxy-k$@&lt;a&nbsp;href=&quot;http://CMS.ENSINO.BR&quot;&gt;CMS.ENSINO.BR&lt;/a&gt;&lt;br&gt;  &nbsp;1&nbsp;HTTP/&lt;a&nbsp;href=&quot;mailto:proxy.cms.ensino.br@CMS.ENSINO.BR&quot;&gt;proxy.cms.ensino.br@CMS.ENSINO.BR&lt;/a&gt;&lt;br&gt;  &nbsp;1&nbsp;HTTP/&lt;a&nbsp;href=&quot;mailto:proxy.cms.ensino.br@CMS.ENSINO.BR&quot;&gt;proxy.cms.ensino.br@CMS.ENSINO.BR&lt;/a&gt;&lt;br&gt;  &nbsp;1&nbsp;HTTP/&lt;a&nbsp;href=&quot;mailto:proxy.cms.ensino.br@CMS.ENSINO.BR&quot;&gt;proxy.cms.ensino.br@CMS.ENSINO.BR&lt;/a&gt;&lt;br&gt;  &nbsp;1&nbsp;host/&lt;a&nbsp;href=&quot;mailto:proxy.cms.ensino.br@CMS.ENSINO.BR&quot;&gt;proxy.cms.ensino.br@CMS.ENSINO.BR&lt;/a&gt;&lt;br&gt;  &nbsp;1&nbsp;host/&lt;a&nbsp;href=&quot;mailto:proxy.cms.ensino.br@CMS.ENSINO.BR&quot;&gt;proxy.cms.ensino.br@CMS.ENSINO.BR&lt;/a&gt;&lt;br&gt;  &nbsp;1&nbsp;host/&lt;a&nbsp;href=&quot;mailto:proxy.cms.ensino.br@CMS.ENSINO.BR&quot;&gt;proxy.cms.ensino.br@CMS.ENSINO.BR&lt;/a&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;/etc/sysconfig/squid&lt;br&gt;#&nbsp;default&nbsp;squid&nbsp;options&lt;br&gt;SQUID_OPTS=&quot;&quot;&lt;br&gt;#&nbsp;Time&nbsp;to&nbsp;wait&nbsp;for&nbsp;Squid&nbsp;to&nbsp;shut&nbsp;down&nbsp;when&nbsp;asked.&nbsp;Should&nbsp;not&nbsp;be&nbsp;necessary&lt;br&gt;#&nbsp;most&nbsp;of&nbsp;the&nbsp;time.&lt;br&gt;SQUID_SHUTDOWN_TIMEOUT=100&lt;br&gt;#&nbsp;default&nbsp;squid&nbsp;conf&nbsp;file&lt;br&gt;SQUID_CONF=&quot;/etc/squid/squid.conf&quot;&lt;br&gt;&lt;br&gt;KRB5_KTNAME=/etc/squid/PROXY.keytab&lt;br&gt;export&nbsp;KRB5_KTNAME&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;kinit&nbsp;and&nbsp;klist&nbsp;commands&nbsp;are&nbsp;OK.&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;Best&nbsp;Regards,&lt;br&gt;&lt;br&gt;&lt;/div&gt;Márcio&lt;br&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
