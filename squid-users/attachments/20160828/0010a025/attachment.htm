<tt>
&lt;HTML&gt;&lt;HEAD&gt;&lt;/HEAD&gt;<br>
&lt;BODY&nbsp;dir=ltr&gt;<br>
&lt;DIV&nbsp;dir=ltr&gt;<br>
&lt;DIV&nbsp;style=&quot;FONT-SIZE:&nbsp;10pt;&nbsp;FONT-FAMILY:&nbsp;'Arial';&nbsp;COLOR:&nbsp;#000000&quot;&gt;<br>
&lt;DIV&gt;&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;HI&nbsp;Marcio,&lt;/DIV&gt;<br>
&lt;DIV&gt;&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&nbsp;&nbsp;The&nbsp;helper&nbsp;need&nbsp;a&nbsp;Kerberos&nbsp;token&nbsp;as&nbsp;input.&nbsp;&nbsp;Please&nbsp;have&nbsp;a&nbsp;look&nbsp;<br>
at&nbsp;test_negotiate_auth.sh&nbsp;&nbsp;which&nbsp;is&nbsp;in&nbsp;src/auth/negotiate/kerberos&nbsp;of&nbsp;the&nbsp;<br>
trunk&nbsp;version.&nbsp;The&nbsp;squid&nbsp;hostname&nbsp;must&nbsp;match&nbsp;the&nbsp;entry&nbsp;in&nbsp;your&nbsp;keytab&nbsp;and&nbsp;you&nbsp;<br>
must&nbsp;have&nbsp;done&nbsp;kinit&nbsp;to&nbsp;authenticate&nbsp;against&nbsp;a&nbsp;Kerberos&nbsp;server&nbsp;(e.g.&nbsp;AD)&nbsp;as&nbsp;user&nbsp;<br>
first.&lt;/DIV&gt;<br>
&lt;DIV&gt;&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;Regards&lt;/DIV&gt;<br>
&lt;DIV&gt;Markus&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&nbsp;<br>
style=&quot;BORDER-TOP-COLOR:&nbsp;#000000;&nbsp;BORDER-BOTTOM-COLOR:&nbsp;#000000;&nbsp;PADDING-LEFT:&nbsp;5px;&nbsp;MARGIN-LEFT:&nbsp;5px;&nbsp;BORDER-LEFT:&nbsp;#000000&nbsp;4px&nbsp;solid;&nbsp;BORDER-RIGHT-COLOR:&nbsp;#000000&quot;&gt;<br>
&lt;DIV&nbsp;<br>
style='FONT-SIZE:&nbsp;small;&nbsp;TEXT-DECORATION:&nbsp;none;&nbsp;FONT-FAMILY:&nbsp;&quot;Calibri&quot;;&nbsp;FONT-WEIGHT:&nbsp;normal;&nbsp;COLOR:&nbsp;#000000;&nbsp;FONT-STYLE:&nbsp;normal;&nbsp;DISPLAY:&nbsp;inline'&gt;<br>
&lt;DIV&gt;&quot;Marcio&nbsp;Demetrio&nbsp;Bacci&quot;&nbsp;&lt;marciobacci@gmail.com&gt;&nbsp;wrote&nbsp;in&nbsp;message&nbsp;<br>
news:CA+0TdyqEAt4L5KO4zrJNJ1aUe64mY2Re7z95KFdqW7Y8SV_qbg@mail.gmail.com...&lt;/DIV&gt;&lt;/DIV&gt;&lt;/DIV&gt;<br>
&lt;DIV&nbsp;<br>
style=&quot;BORDER-TOP-COLOR:&nbsp;#000000;&nbsp;BORDER-BOTTOM-COLOR:&nbsp;#000000;&nbsp;PADDING-LEFT:&nbsp;5px;&nbsp;MARGIN-LEFT:&nbsp;5px;&nbsp;BORDER-LEFT:&nbsp;#000000&nbsp;4px&nbsp;solid;&nbsp;BORDER-RIGHT-COLOR:&nbsp;#000000&quot;&gt;<br>
&lt;DIV&nbsp;<br>
style='FONT-SIZE:&nbsp;small;&nbsp;TEXT-DECORATION:&nbsp;none;&nbsp;FONT-FAMILY:&nbsp;&quot;Calibri&quot;;&nbsp;FONT-WEIGHT:&nbsp;normal;&nbsp;COLOR:&nbsp;#000000;&nbsp;FONT-STYLE:&nbsp;normal;&nbsp;DISPLAY:&nbsp;inline'&gt;<br>
&lt;DIV&nbsp;dir=ltr&gt;<br>
&lt;DIV&gt;<br>
&lt;DIV&gt;I&nbsp;have&nbsp;trouble&nbsp;to&nbsp;authenticate&nbsp;Squid3&nbsp;with&nbsp;kerberos&nbsp;in&nbsp;Samba4&nbsp;domain.&nbsp;I'm&nbsp;<br>
using&nbsp;CentOS&nbsp;7&nbsp;and&nbsp;Squid&nbsp;3.3.8&nbsp;(yum&nbsp;install&nbsp;squid)&lt;BR&gt;&lt;BR&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;When&nbsp;I&nbsp;type&nbsp;the&nbsp;bellow&nbsp;command&nbsp;in&nbsp;terminal:&nbsp;<br>
&lt;BR&gt;/usr/lib64/squid/negotiate_kerberos_auth&nbsp;-d&nbsp;-i&nbsp;-s&nbsp;<br>
HTTP/&lt;A&gt;proxy.cms.ensino.br@CMS.ENSINO.BR&lt;/A&gt;&lt;BR&gt;john&nbsp;xyz@12345&lt;BR&gt;&lt;BR&gt;I&nbsp;have&nbsp;<br>
the&nbsp;following&nbsp;error:&lt;BR&gt;negotiate_kerberos_auth.cc(315):&nbsp;pid=6364&nbsp;:2016/08/27&nbsp;<br>
10:44:33|&nbsp;negotiate_kerberos_auth:&nbsp;DEBUG:&nbsp;Got&nbsp;'john&nbsp;xyz@12345'&nbsp;from&nbsp;squid&nbsp;<br>
(length:&nbsp;14).&lt;BR&gt;negotiate_kerberos_auth.cc(362):&nbsp;pid=6364&nbsp;:2016/08/27&nbsp;10:44:33|&nbsp;<br>
negotiate_kerberos_auth:&nbsp;ERROR:&nbsp;Invalid&nbsp;request&nbsp;[john&nbsp;xyz@12345]&lt;BR&gt;BH&nbsp;invalid&nbsp;<br>
request&nbsp;&lt;BR&gt;&lt;BR&gt;&lt;BR&gt;Here&nbsp;are&nbsp;my&nbsp;files&nbsp;<br>
configuration:&lt;BR&gt;&lt;BR&gt;/etc/krb5.conf&lt;BR&gt;[libdefaults]&lt;BR&gt;&nbsp;&nbsp;&nbsp;&nbsp;<br>
default_realm&nbsp;=&nbsp;&lt;A&nbsp;<br>
href=&quot;http://CMS.ENSINO.BR&quot;&gt;CMS.ENSINO.BR&lt;/A&gt;&lt;BR&gt;[realms]&lt;BR&gt;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&lt;A&nbsp;href=&quot;http://CMS.ENSINO.BR&quot;&gt;CMS.ENSINO.BR&lt;/A&gt;&nbsp;=&nbsp;{&lt;BR&gt;&nbsp;&nbsp;&nbsp;&nbsp;kdc&nbsp;=&nbsp;<br>
&lt;A&nbsp;<br>
href=&quot;http://dc1.cms.ensino.br:88&quot;&gt;dc1.cms.ensino.br:88&lt;/A&gt;&lt;BR&gt;&nbsp;&nbsp;&nbsp;&nbsp;<br>
admin_server&nbsp;=&nbsp;&lt;A&nbsp;<br>
href=&quot;http://dc1.cms.ensino.br&quot;&gt;dc1.cms.ensino.br&lt;/A&gt;&lt;BR&gt;&nbsp;&nbsp;&nbsp;&nbsp;<br>
default_domain&nbsp;=&nbsp;&lt;A&nbsp;href=&quot;http://CMS.ENSINO.BR&quot;&gt;CMS.ENSINO.BR&lt;/A&gt;&nbsp;<br>
&lt;BR&gt;&nbsp;&nbsp;&nbsp;&nbsp;}&lt;BR&gt;[domain_realm]&lt;BR&gt;&nbsp;&nbsp;&nbsp;&nbsp;.&lt;A&nbsp;<br>
href=&quot;http://cms.ensino.br&quot;&gt;cms.ensino.br&lt;/A&gt;&nbsp;=&nbsp;&lt;A&nbsp;<br>
href=&quot;http://CMS.ENSINO.BR&quot;&gt;CMS.ENSINO.BR&lt;/A&gt;&lt;BR&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;A&nbsp;<br>
href=&quot;http://cms.ensino.br&quot;&gt;cms.ensino.br&lt;/A&gt;&nbsp;=&nbsp;&lt;A&nbsp;<br>
href=&quot;http://CMS.ENSINO.BR&quot;&gt;CMS.ENSINO.BR&lt;/A&gt;&lt;BR&gt;&lt;BR&gt;&lt;BR&gt;&lt;BR&gt;Keytab&nbsp;name:&nbsp;<br>
FILE:/etc/krb5.keytab&lt;BR&gt;KVNO&nbsp;Principal&lt;BR&gt;----&nbsp;<br>
--------------------------------------------------------------------------&lt;BR&gt;&nbsp;&nbsp;&nbsp;<br>
1&nbsp;proxy-k$@&lt;A&nbsp;href=&quot;http://CMS.ENSINO.BR&quot;&gt;CMS.ENSINO.BR&lt;/A&gt;&lt;BR&gt;&nbsp;&nbsp;&nbsp;1&nbsp;<br>
proxy-k$@&lt;A&nbsp;href=&quot;http://CMS.ENSINO.BR&quot;&gt;CMS.ENSINO.BR&lt;/A&gt;&lt;BR&gt;&nbsp;&nbsp;&nbsp;1&nbsp;<br>
proxy-k$@&lt;A&nbsp;href=&quot;http://CMS.ENSINO.BR&quot;&gt;CMS.ENSINO.BR&lt;/A&gt;&lt;BR&gt;&nbsp;&nbsp;&nbsp;1&nbsp;<br>
HTTP/&lt;A&gt;proxy.cms.ensino.br@CMS.ENSINO.BR&lt;/A&gt;&lt;BR&gt;&nbsp;&nbsp;&nbsp;1&nbsp;<br>
HTTP/&lt;A&gt;proxy.cms.ensino.br@CMS.ENSINO.BR&lt;/A&gt;&lt;BR&gt;&nbsp;&nbsp;&nbsp;1&nbsp;<br>
HTTP/&lt;A&gt;proxy.cms.ensino.br@CMS.ENSINO.BR&lt;/A&gt;&lt;BR&gt;&nbsp;&nbsp;&nbsp;1&nbsp;<br>
host/&lt;A&gt;proxy.cms.ensino.br@CMS.ENSINO.BR&lt;/A&gt;&lt;BR&gt;&nbsp;&nbsp;&nbsp;1&nbsp;<br>
host/&lt;A&gt;proxy.cms.ensino.br@CMS.ENSINO.BR&lt;/A&gt;&lt;BR&gt;&nbsp;&nbsp;&nbsp;1&nbsp;<br>
host/&lt;A&gt;proxy.cms.ensino.br@CMS.ENSINO.BR&lt;/A&gt;&lt;BR&gt;&nbsp;&nbsp;&nbsp;1&nbsp;<br>
host/&lt;A&gt;proxy.cms.ensino.br@CMS.ENSINO.BR&lt;/A&gt;&lt;BR&gt;&nbsp;&nbsp;&nbsp;1&nbsp;<br>
host/&lt;A&gt;proxy.cms.ensino.br@CMS.ENSINO.BR&lt;/A&gt;&lt;BR&gt;&nbsp;&nbsp;&nbsp;1&nbsp;<br>
host/&lt;A&gt;PROXY@CMS.ENSINO.BR&lt;/A&gt;&lt;BR&gt;&nbsp;&nbsp;&nbsp;1&nbsp;<br>
host/&lt;A&gt;PROXY@CMS.ENSINO.BR&lt;/A&gt;&lt;BR&gt;&nbsp;&nbsp;&nbsp;1&nbsp;<br>
host/&lt;A&gt;PROXY@CMS.ENSINO.BR&lt;/A&gt;&lt;BR&gt;&nbsp;&nbsp;&nbsp;1&nbsp;<br>
host/&lt;A&gt;PROXY@CMS.ENSINO.BR&lt;/A&gt;&lt;BR&gt;&nbsp;&nbsp;&nbsp;1&nbsp;<br>
host/&lt;A&gt;PROXY@CMS.ENSINO.BR&lt;/A&gt;&lt;BR&gt;&nbsp;&nbsp;&nbsp;1&nbsp;PROXY$@&lt;A&nbsp;<br>
href=&quot;http://CMS.ENSINO.BR&quot;&gt;CMS.ENSINO.BR&lt;/A&gt;&lt;BR&gt;&nbsp;&nbsp;&nbsp;1&nbsp;PROXY$@&lt;A&nbsp;<br>
href=&quot;http://CMS.ENSINO.BR&quot;&gt;CMS.ENSINO.BR&lt;/A&gt;&lt;BR&gt;&nbsp;&nbsp;&nbsp;1&nbsp;PROXY$@&lt;A&nbsp;<br>
href=&quot;http://CMS.ENSINO.BR&quot;&gt;CMS.ENSINO.BR&lt;/A&gt;&lt;BR&gt;&nbsp;&nbsp;&nbsp;1&nbsp;PROXY$@&lt;A&nbsp;<br>
href=&quot;http://CMS.ENSINO.BR&quot;&gt;CMS.ENSINO.BR&lt;/A&gt;&lt;BR&gt;&nbsp;&nbsp;&nbsp;1&nbsp;PROXY$@&lt;A&nbsp;<br>
href=&quot;http://CMS.ENSINO.BR&quot;&gt;CMS.ENSINO.BR&lt;/A&gt;&lt;BR&gt;&nbsp;&nbsp;&nbsp;1&nbsp;proxy-k$@&lt;A&nbsp;<br>
href=&quot;http://CMS.ENSINO.BR&quot;&gt;CMS.ENSINO.BR&lt;/A&gt;&lt;BR&gt;&nbsp;&nbsp;&nbsp;1&nbsp;proxy-k$@&lt;A&nbsp;<br>
href=&quot;http://CMS.ENSINO.BR&quot;&gt;CMS.ENSINO.BR&lt;/A&gt;&lt;BR&gt;&nbsp;&nbsp;&nbsp;1&nbsp;<br>
HTTP/&lt;A&gt;proxy.cms.ensino.br@CMS.ENSINO.BR&lt;/A&gt;&lt;BR&gt;&nbsp;&nbsp;&nbsp;1&nbsp;<br>
HTTP/&lt;A&gt;proxy.cms.ensino.br@CMS.ENSINO.BR&lt;/A&gt;&lt;BR&gt;&nbsp;&nbsp;&nbsp;1&nbsp;<br>
HTTP/&lt;A&gt;PROXY@CMS.ENSINO.BR&lt;/A&gt;&lt;BR&gt;&nbsp;&nbsp;&nbsp;1&nbsp;<br>
HTTP/&lt;A&gt;PROXY@CMS.ENSINO.BR&lt;/A&gt;&lt;BR&gt;&nbsp;&nbsp;&nbsp;1&nbsp;<br>
HTTP/&lt;A&gt;PROXY@CMS.ENSINO.BR&lt;/A&gt;&lt;BR&gt;&nbsp;&nbsp;&nbsp;1&nbsp;<br>
HTTP/&lt;A&gt;PROXY@CMS.ENSINO.BR&lt;/A&gt;&lt;BR&gt;&nbsp;&nbsp;&nbsp;1&nbsp;<br>
HTTP/&lt;A&gt;PROXY@CMS.ENSINO.BR&lt;/A&gt;&lt;BR&gt;&lt;BR&gt;&lt;BR&gt;Keytab&nbsp;name:&nbsp;<br>
FILE:/etc/squid/PROXY.keytab&lt;BR&gt;KVNO&nbsp;Principal&lt;BR&gt;----&nbsp;<br>
--------------------------------------------------------------------------&lt;BR&gt;&nbsp;&nbsp;&nbsp;<br>
1&nbsp;proxy-k$@&lt;A&nbsp;href=&quot;http://CMS.ENSINO.BR&quot;&gt;CMS.ENSINO.BR&lt;/A&gt;&lt;BR&gt;&nbsp;&nbsp;&nbsp;1&nbsp;<br>
proxy-k$@&lt;A&nbsp;href=&quot;http://CMS.ENSINO.BR&quot;&gt;CMS.ENSINO.BR&lt;/A&gt;&lt;BR&gt;&nbsp;&nbsp;&nbsp;1&nbsp;<br>
proxy-k$@&lt;A&nbsp;href=&quot;http://CMS.ENSINO.BR&quot;&gt;CMS.ENSINO.BR&lt;/A&gt;&lt;BR&gt;&nbsp;&nbsp;&nbsp;1&nbsp;<br>
HTTP/&lt;A&gt;proxy.cms.ensino.br@CMS.ENSINO.BR&lt;/A&gt;&lt;BR&gt;&nbsp;&nbsp;&nbsp;1&nbsp;<br>
HTTP/&lt;A&gt;proxy.cms.ensino.br@CMS.ENSINO.BR&lt;/A&gt;&lt;BR&gt;&nbsp;&nbsp;&nbsp;1&nbsp;<br>
HTTP/&lt;A&gt;proxy.cms.ensino.br@CMS.ENSINO.BR&lt;/A&gt;&lt;BR&gt;&nbsp;&nbsp;&nbsp;1&nbsp;<br>
host/&lt;A&gt;proxy.cms.ensino.br@CMS.ENSINO.BR&lt;/A&gt;&lt;BR&gt;&nbsp;&nbsp;&nbsp;1&nbsp;<br>
host/&lt;A&gt;proxy.cms.ensino.br@CMS.ENSINO.BR&lt;/A&gt;&lt;BR&gt;&nbsp;&nbsp;&nbsp;1&nbsp;<br>
host/&lt;A&gt;proxy.cms.ensino.br@CMS.ENSINO.BR&lt;/A&gt;&lt;BR&gt;&lt;BR&gt;&lt;BR&gt;/etc/sysconfig/squid&lt;BR&gt;#&nbsp;<br>
default&nbsp;squid&nbsp;options&lt;BR&gt;SQUID_OPTS=&quot;&quot;&lt;BR&gt;#&nbsp;Time&nbsp;to&nbsp;wait&nbsp;for&nbsp;Squid&nbsp;to&nbsp;shut&nbsp;down&nbsp;<br>
when&nbsp;asked.&nbsp;Should&nbsp;not&nbsp;be&nbsp;necessary&lt;BR&gt;#&nbsp;most&nbsp;of&nbsp;the&nbsp;<br>
time.&lt;BR&gt;SQUID_SHUTDOWN_TIMEOUT=100&lt;BR&gt;#&nbsp;default&nbsp;squid&nbsp;conf&nbsp;<br>
file&lt;BR&gt;SQUID_CONF=&quot;/etc/squid/squid.conf&quot;&lt;BR&gt;&lt;BR&gt;KRB5_KTNAME=/etc/squid/PROXY.keytab&lt;BR&gt;export&nbsp;<br>
KRB5_KTNAME&lt;BR&gt;&lt;BR&gt;&lt;BR&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;kinit&nbsp;and&nbsp;klist&nbsp;commands&nbsp;are&nbsp;OK.&lt;BR&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&nbsp;&lt;/DIV&gt;Best&nbsp;Regards,&lt;BR&gt;&lt;BR&gt;&lt;/DIV&gt;Márcio&lt;BR&gt;<br>
&lt;DIV&gt;<br>
&lt;DIV&gt;<br>
&lt;DIV&gt;&nbsp;&lt;/DIV&gt;&lt;/DIV&gt;&lt;/DIV&gt;&lt;/DIV&gt;<br>
&lt;P&gt;<br>
&lt;HR&gt;<br>
_______________________________________________&lt;BR&gt;squid-users&nbsp;mailing&nbsp;<br>
list&lt;BR&gt;squid-users@lists.squid-cache.org&lt;BR&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;BR&gt;&lt;/DIV&gt;&lt;/DIV&gt;&lt;/DIV&gt;&lt;/DIV&gt;&lt;/BODY&gt;&lt;/HTML&gt;<br>

</tt>
