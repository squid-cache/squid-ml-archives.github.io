<tt>
&lt;html&gt;<br>
&lt;head&gt;<br>
&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&gt;<br>
&lt;/head&gt;<br>
&lt;body&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;On&nbsp;Wed,&nbsp;2016-09-21&nbsp;at&nbsp;08:34&nbsp;-0600,&nbsp;Alex&nbsp;Rousskov&nbsp;wrote:&lt;/div&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&lt;pre&gt;On&nbsp;09/21/2016&nbsp;07:53&nbsp;AM,&nbsp;Jasper&nbsp;Van&nbsp;Der&nbsp;Westhuizen&nbsp;wrote:<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
I&nbsp;have&nbsp;been&nbsp;having&nbsp;some&nbsp;problems&nbsp;with&nbsp;Squid&nbsp;using<br>
100%&nbsp;CPU&nbsp;at&nbsp;times&nbsp;which&nbsp;impacts&nbsp;my&nbsp;users&nbsp;browsing&nbsp;experience.&nbsp;<br>
&lt;/blockquote&gt;<br>
<br>
Sustained&nbsp;100%&nbsp;CPU&nbsp;load&nbsp;at&nbsp;~100/s&nbsp;rates&nbsp;with&nbsp;regular&nbsp;traffic&nbsp;on<br>
reasonable&nbsp;hardware&nbsp;is&nbsp;a&nbsp;sign&nbsp;(albeit&nbsp;not&nbsp;a&nbsp;proof!)&nbsp;of&nbsp;a&nbsp;Squid&nbsp;bug<br>
(including&nbsp;long&nbsp;searches&nbsp;and&nbsp;similar&nbsp;optimization&nbsp;problems).<br>
&lt;/pre&gt;<br>
&lt;/blockquote&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;I&nbsp;seem&nbsp;to&nbsp;have&nbsp;gotten&nbsp;better&nbsp;results/performance&nbsp;by&nbsp;doing&nbsp;some&nbsp;config&nbsp;changed.&nbsp;I&nbsp;removed&nbsp;a&nbsp;whole&nbsp;bunch&nbsp;of&nbsp;pattern_refresh&nbsp;lines&nbsp;and&nbsp;replaced&nbsp;them&nbsp;with&nbsp;better&nbsp;formulated&nbsp;lines.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&lt;pre&gt;<br>
<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
During&nbsp;the&nbsp;last&nbsp;time&nbsp;I&nbsp;had&nbsp;a&nbsp;proxy&nbsp;servers&nbsp;CPU&nbsp;reach&nbsp;100%&nbsp;I&nbsp;ran&nbsp;a<br>
cachemgr&nbsp;export&nbsp;and&nbsp;below&nbsp;is&nbsp;an&nbsp;extract.<br>
&lt;/blockquote&gt;<br>
<br>
Next&nbsp;time&nbsp;this&nbsp;happens,&nbsp;consider&nbsp;getting&nbsp;a&nbsp;stack&nbsp;trace&nbsp;or&nbsp;two&nbsp;from&nbsp;the<br>
process&nbsp;showing&nbsp;sustained&nbsp;100%&nbsp;CPU&nbsp;utilization.&nbsp;It&nbsp;is&nbsp;possible&nbsp;to&nbsp;do<br>
that&nbsp;without&nbsp;killing&nbsp;the&nbsp;processes&nbsp;(at&nbsp;least&nbsp;on&nbsp;Linux).&nbsp;I&nbsp;do&nbsp;not&nbsp;have<br>
step-by-step&nbsp;instructions,&nbsp;but&nbsp;you&nbsp;can&nbsp;find&nbsp;them.&nbsp;Make&nbsp;sure&nbsp;you&nbsp;run&nbsp;(or<br>
at&nbsp;least&nbsp;use&nbsp;for&nbsp;getting&nbsp;the&nbsp;stack&nbsp;trace?)&nbsp;an&nbsp;unstripped&nbsp;Squid&nbsp;binary,<br>
preferably&nbsp;built&nbsp;with&nbsp;--disable-optimizations.<br>
<br>
If&nbsp;the&nbsp;place&nbsp;where&nbsp;Squid&nbsp;gets&nbsp;stuck&nbsp;is&nbsp;known,&nbsp;somebody&nbsp;may&nbsp;volunteer&nbsp;to<br>
fix&nbsp;the&nbsp;corresponding&nbsp;code.<br>
<br>
&lt;/pre&gt;<br>
&lt;/blockquote&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;I&nbsp;do&nbsp;not&nbsp;have&nbsp;much&nbsp;experience&nbsp;with&nbsp;strace.&nbsp;What&nbsp;I&nbsp;found&nbsp;now&nbsp;after&nbsp;making&nbsp;changes&nbsp;to&nbsp;my&nbsp;squid.conf&nbsp;file,&nbsp;my&nbsp;cache&nbsp;drive&nbsp;gets&nbsp;*hammered*&nbsp;at&nbsp;times&nbsp;of&nbsp;high&nbsp;usage.&nbsp;Especially&nbsp;in&nbsp;the&nbsp;morning&nbsp;when&nbsp;all&nbsp;the&nbsp;users&nbsp;come&nbsp;online.&nbsp;I&nbsp;have&nbsp;huge&nbsp;amounts&nbsp;of&nbsp;writes&nbsp;happening<br>
&nbsp;and&nbsp;this&nbsp;creates&nbsp;CPU&nbsp;wait&nbsp;and&nbsp;the&nbsp;user&nbsp;experience&nbsp;goes&nbsp;out&nbsp;of&nbsp;the&nbsp;window.&nbsp;My&nbsp;proxies&nbsp;are&nbsp;VM's&nbsp;with&nbsp;separate&nbsp;drives&nbsp;for&nbsp;the&nbsp;cache,&nbsp;running&nbsp;on&nbsp;reiserfs(previously&nbsp;EXT3).&nbsp;My&nbsp;L1&nbsp;and&nbsp;L2&nbsp;directory&nbsp;structure&nbsp;is&nbsp;32&nbsp;and&nbsp;256&nbsp;respectively&nbsp;with&nbsp;the&nbsp;aufs&nbsp;store&nbsp;type.&nbsp;In<br>
&nbsp;my&nbsp;VMWare&nbsp;cluster&nbsp;I&nbsp;see&nbsp;high&nbsp;write&nbsp;latency&nbsp;to&nbsp;the&nbsp;cache&nbsp;disks.&nbsp;&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;Is&nbsp;there&nbsp;anything&nbsp;that&nbsp;you&nbsp;guys&nbsp;can&nbsp;suggest&nbsp;I&nbsp;do&nbsp;around&nbsp;the&nbsp;cache?&nbsp;Should&nbsp;I&nbsp;try&nbsp;a&nbsp;different&nbsp;store&nbsp;type?&nbsp;A&nbsp;different&nbsp;filesystem&nbsp;type&nbsp;perhaps?&nbsp;&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;Kind&nbsp;Regards&lt;/div&gt;<br>
&lt;div&gt;Jasper&lt;/div&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;mc&nbsp;type=&quot;body&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;font&nbsp;face=&quot;Arial;&quot;&nbsp;size=&quot;1&quot;&gt;Disclaimer:&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://www.shopriteholdings.co.za/Pages/ShopriteE-mailDisclaimer.aspx&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.shopriteholdings.co.za/Pages/ShopriteE-mailDisclaimer.aspx&lt;/a&gt;<br>
&lt;/font&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
