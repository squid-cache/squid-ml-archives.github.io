<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;After&nbsp;enabling&nbsp;IPv6&nbsp;in&nbsp;the&nbsp;kernel,&nbsp;building&nbsp;squid&nbsp;with&nbsp;IPv6&nbsp;and&nbsp;firewalling&nbsp;IPv6&nbsp;no&nbsp;crash&nbsp;was&nbsp;observed&nbsp;any&nbsp;more.&nbsp;&lt;br&gt;&lt;br&gt;Thanks&nbsp;for&nbsp;the&nbsp;tip&nbsp;Amos.&lt;br&gt;&lt;div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Sat,&nbsp;Jun&nbsp;11,&nbsp;2016&nbsp;at&nbsp;7:14&nbsp;AM,&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&nbsp;target=&quot;_blank&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;On&nbsp;3/06/2016&nbsp;3:47&nbsp;a.m.,&nbsp;Tomas&nbsp;Mozes&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;On&nbsp;Wed,&nbsp;Jun&nbsp;1,&nbsp;2016&nbsp;at&nbsp;1:53&nbsp;PM,&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;On&nbsp;31/05/2016&nbsp;9:56&nbsp;p.m.,&nbsp;Tomas&nbsp;Mozes&nbsp;wrote:&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;On&nbsp;Thu,&nbsp;May&nbsp;26,&nbsp;2016&nbsp;at&nbsp;8:04&nbsp;AM,&nbsp;Amos&nbsp;Jeffries&nbsp;wrote:&lt;br&gt;<br>
&gt;&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&gt;&gt;&nbsp;On&nbsp;24/05/2016&nbsp;7:52&nbsp;p.m.,&nbsp;Tomas&nbsp;Mozes&nbsp;wrote:&lt;br&gt;<br>
&gt;&gt;&gt;&gt;&gt;&nbsp;Hello,&lt;br&gt;<br>
&gt;&gt;&gt;&gt;&gt;&nbsp;on&nbsp;two&nbsp;different&nbsp;squid&nbsp;servers&nbsp;I&#39;ve&nbsp;observed&nbsp;a&nbsp;crash&nbsp;of&nbsp;pinger.&nbsp;First&lt;br&gt;<br>
&gt;&gt;&nbsp;it&lt;br&gt;<br>
&gt;&gt;&gt;&gt;&gt;&nbsp;appeared&nbsp;on&nbsp;version&nbsp;3.5.15&nbsp;and&nbsp;later&nbsp;on&nbsp;version&nbsp;3.5.17.&lt;br&gt;<br>
&gt;&gt;&gt;&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&gt;&gt;&gt;&nbsp;Cache.log&nbsp;contains&nbsp;these&nbsp;lines:&lt;br&gt;<br>
&gt;&gt;&gt;&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&gt;&gt;&gt;&nbsp;(pinger):&nbsp;Address.cc:671:&nbsp;void&nbsp;Ip::Address::getAddrInfo(&lt;wbr&gt;addrinfo*&amp;,&lt;br&gt;<br>
&gt;&gt;&nbsp;int)&lt;br&gt;<br>
&gt;&gt;&gt;&gt;&gt;&nbsp;const:&nbsp;Assertion&nbsp;`false&#39;&nbsp;failed.&lt;br&gt;<br>
&gt;&gt;&gt;&gt;&gt;&nbsp;2016/05/14&nbsp;21:55:25&nbsp;kid1|&nbsp;Bad&nbsp;opcode:&nbsp;112&nbsp;from&lt;br&gt;<br>
&gt;&gt;&gt;&gt;&gt;&nbsp;[6661:6c73:6522:2061:7420:&lt;wbr&gt;6c69:6e65:2036]&lt;br&gt;<br>
&gt;&gt;&gt;&gt;&gt;&nbsp;2016/05/14&nbsp;21:59:13&nbsp;kid1|&nbsp;recv:&nbsp;(111)&nbsp;Connection&nbsp;refused&lt;br&gt;<br>
&gt;&gt;&gt;&gt;&gt;&nbsp;2016/05/14&nbsp;21:59:13&nbsp;kid1|&nbsp;Closing&nbsp;Pinger&nbsp;socket&nbsp;on&nbsp;FD&nbsp;17&lt;br&gt;<br>
&gt;&gt;&gt;&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&gt;&gt;&gt;&nbsp;On&nbsp;both&nbsp;servers,&nbsp;that&nbsp;IPv6&nbsp;address&nbsp;was&nbsp;the&nbsp;same&nbsp;-&lt;br&gt;<br>
&gt;&gt;&gt;&gt;&gt;&nbsp;6661:6c73:6522:2061:7420:6c69:&lt;wbr&gt;6e65:2036&lt;br&gt;<br>
&gt;&gt;&gt;&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&gt;&gt;&nbsp;That&nbsp;is&nbsp;the&nbsp;hexadecimal&nbsp;representation&nbsp;of&nbsp;the&nbsp;error:&lt;br&gt;<br>
&gt;&gt;&gt;&gt;Â &nbsp;false&quot;&nbsp;at&nbsp;line&nbsp;6&lt;br&gt;<br>
&gt;&gt;&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&gt;&gt;&nbsp;Which&nbsp;means&nbsp;that&nbsp;your&nbsp;kernel&nbsp;is&nbsp;producing&nbsp;garbage&nbsp;when&nbsp;asked&nbsp;to&nbsp;resolve&lt;br&gt;<br>
&gt;&gt;&gt;&gt;&nbsp;an&nbsp;IPv6&nbsp;address&nbsp;or&nbsp;respond&nbsp;to&nbsp;an&nbsp;ICMPv6&nbsp;packet.&lt;br&gt;<br>
&gt;&gt;&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;Cannot&nbsp;we&nbsp;prevent&nbsp;Squid&nbsp;from&nbsp;crashing&nbsp;in&nbsp;these&nbsp;cases?&lt;br&gt;<br>
&gt;&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;Squid&nbsp;is&nbsp;not&nbsp;crashing.&nbsp;The&nbsp;pinger&nbsp;is.&nbsp;Squid&nbsp;continues&nbsp;with&nbsp;degraded&lt;br&gt;<br>
&gt;&gt;&nbsp;service&nbsp;latency.&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Yes,&nbsp;sorry,&nbsp;I&nbsp;wasn&#39;t&nbsp;specific.&nbsp;I&nbsp;meant&nbsp;like&nbsp;some&nbsp;part&nbsp;of&nbsp;Squid,&nbsp;not&nbsp;the&lt;br&gt;<br>
&gt;&nbsp;Squid&nbsp;caching&nbsp;process&nbsp;itself.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;What&nbsp;kind&nbsp;of&nbsp;continued&nbsp;operations&nbsp;would&nbsp;you&nbsp;expect&nbsp;a&nbsp;program&nbsp;to&nbsp;do&nbsp;when&lt;br&gt;<br>
&gt;&gt;&nbsp;it&nbsp;discovers&nbsp;at&nbsp;least&nbsp;some&nbsp;portion&nbsp;of&nbsp;its&nbsp;RAM&nbsp;has&nbsp;been&nbsp;filled&nbsp;with&lt;br&gt;<br>
&gt;&gt;&nbsp;garbage&nbsp;by&nbsp;the&nbsp;system&nbsp;kernel?&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;In&nbsp;the&nbsp;worst&nbsp;case&nbsp;-&nbsp;wouldn&#39;t&nbsp;it&nbsp;be&nbsp;possible&nbsp;for&nbsp;the&nbsp;master&nbsp;process&nbsp;to&lt;br&gt;<br>
&gt;&nbsp;restart&nbsp;it?&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;For&nbsp;most&nbsp;helpers&nbsp;that&nbsp;is&nbsp;exacty&nbsp;what&nbsp;happens,&nbsp;but&nbsp;with&nbsp;frequent&nbsp;enough&lt;br&gt;<br>
failures&nbsp;killing&nbsp;Squid.&nbsp;That&nbsp;latter&nbsp;bit&nbsp;has&nbsp;been&nbsp;part&nbsp;of&nbsp;the&nbsp;problem&lt;br&gt;<br>
preventing&nbsp;this&nbsp;one&nbsp;being&nbsp;the&nbsp;same&nbsp;so&nbsp;far.&lt;br&gt;<br>
&lt;br&gt;<br>
This&nbsp;paticular&nbsp;helper&nbsp;needs&nbsp;root&nbsp;permission&nbsp;to&nbsp;use&nbsp;ICMP&nbsp;sockets.&nbsp;It&nbsp;has&lt;br&gt;<br>
a&nbsp;long&nbsp;history&nbsp;of&nbsp;being&nbsp;installed&nbsp;with&nbsp;wrong&nbsp;ownership&nbsp;and&nbsp;access&lt;br&gt;<br>
permissions,&nbsp;which&nbsp;cause&nbsp;it&nbsp;to&nbsp;exit&nbsp;early.&nbsp;So&nbsp;the&nbsp;most&nbsp;common&nbsp;form&nbsp;of&nbsp;it&lt;br&gt;<br>
dying&nbsp;is&nbsp;not&nbsp;a&nbsp;situation&nbsp;in&nbsp;which&nbsp;Squid&nbsp;can&nbsp;reasonably&nbsp;restart&nbsp;it&nbsp;-&nbsp;or&lt;br&gt;<br>
risks&nbsp;almost&nbsp;certainly&nbsp;dying&nbsp;itself.&lt;br&gt;<br>
&lt;br&gt;<br>
Thesituation&nbsp;has&nbsp;been&nbsp;improving&nbsp;in&nbsp;recent&nbsp;years&nbsp;though.&nbsp;So&nbsp;I&#39;m&nbsp;hopeful&lt;br&gt;<br>
we&nbsp;will&nbsp;get&nbsp;there&nbsp;eventually.&nbsp;If&nbsp;you&nbsp;wish&nbsp;to&nbsp;sponsor&nbsp;some&nbsp;work&nbsp;to&nbsp;speed&lt;br&gt;<br>
that&nbsp;up&nbsp;it&nbsp;could&nbsp;be&nbsp;made&nbsp;a&nbsp;configurable&nbsp;action.&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;Now&nbsp;cross&nbsp;your&nbsp;fingers&nbsp;and&nbsp;pray&nbsp;that&nbsp;no&nbsp;other&nbsp;programs&nbsp;on&nbsp;your&nbsp;whole&lt;br&gt;<br>
&gt;&gt;&nbsp;system&nbsp;(network,&nbsp;if&nbsp;you&nbsp;did&nbsp;the&nbsp;same&nbsp;&quot;disable&quot;&nbsp;on&nbsp;other&nbsp;machines)&nbsp;are&lt;br&gt;<br>
&gt;&gt;&nbsp;behaving&nbsp;badly&nbsp;in&nbsp;secret&nbsp;when&nbsp;given&nbsp;the&nbsp;garbage&nbsp;by&nbsp;the&nbsp;kernel&nbsp;like&lt;br&gt;<br>
&gt;&gt;&nbsp;Squid&#39;s&nbsp;pinger&nbsp;was.&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;You&nbsp;know,&nbsp;the&nbsp;strange&nbsp;thing&nbsp;is&nbsp;I&nbsp;only&nbsp;found&nbsp;those&nbsp;strings&nbsp;on&nbsp;google&lt;br&gt;<br>
&gt;&nbsp;attached&nbsp;with&nbsp;Squid.&nbsp;No&nbsp;other&nbsp;place.&nbsp;If&nbsp;it&#39;s&nbsp;a&nbsp;general&nbsp;issue&nbsp;in&nbsp;the&nbsp;Linux&lt;br&gt;<br>
&gt;&nbsp;kernel,&nbsp;then&nbsp;it&#39;s&nbsp;been&nbsp;there&nbsp;for&nbsp;years,&nbsp;unnoticed.&nbsp;And&nbsp;as&nbsp;I&nbsp;mentioned&lt;br&gt;<br>
&gt;&nbsp;before,&nbsp;it&nbsp;happened&nbsp;on&nbsp;two&nbsp;machines,&nbsp;separate&nbsp;from&nbsp;each&nbsp;other,&nbsp;in&lt;br&gt;<br>
&gt;&nbsp;completely&nbsp;different&nbsp;data-centers&nbsp;with&nbsp;the&nbsp;same&nbsp;error&nbsp;message.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;What&nbsp;would&nbsp;you&nbsp;suggest?&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;I&nbsp;suggest&nbsp;enabling&nbsp;IPv6&nbsp;within&nbsp;your&nbsp;network.&nbsp;:-)&nbsp;It&nbsp;can&nbsp;be&nbsp;firewalled&nbsp;if&lt;br&gt;<br>
you&nbsp;want&nbsp;it&nbsp;not&nbsp;to&nbsp;be&nbsp;used,&nbsp;same&nbsp;as&nbsp;any&nbsp;other&nbsp;digital&nbsp;service.&lt;br&gt;<br>
&lt;br&gt;<br>
That&nbsp;will&nbsp;also&nbsp;give&nbsp;you&nbsp;a&nbsp;way&nbsp;to&nbsp;measure&nbsp;whether&nbsp;you&nbsp;have&nbsp;reached&lt;br&gt;<br>
tipping&nbsp;point&nbsp;of&nbsp;it&nbsp;being&nbsp;useful.&nbsp;The&nbsp;global&nbsp;traffic&nbsp;passed&nbsp;12%&nbsp;last&lt;br&gt;<br>
weekend&nbsp;and&nbsp;growth&nbsp;rate&nbsp;is&nbsp;somewhere&nbsp;between&nbsp;exponential&nbsp;and&nbsp;hyperbolic&lt;br&gt;<br>
despite&nbsp;a&nbsp;lot&nbsp;of&nbsp;networks&nbsp;still&nbsp;clinging&nbsp;to&nbsp;IPv4.&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;<br>
Amos&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
