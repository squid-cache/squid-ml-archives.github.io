<tt>
&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;div&gt;On&nbsp;Sun,&nbsp;2016-10-09&nbsp;at&nbsp;12:43&nbsp;-0600,&nbsp;Alex&nbsp;Rousskov&nbsp;wrote:&lt;/div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;pre&gt;On&nbsp;10/09/2016&nbsp;11:02&nbsp;AM,&nbsp;James&nbsp;Lay&nbsp;wrote:<br>
<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
WARNING:&nbsp;Squid&nbsp;is&nbsp;configured&nbsp;to&nbsp;use&nbsp;ICAP&nbsp;method&nbsp;REQMOD&nbsp;for&nbsp;service<br>
icap://localhost:1344/srv_cfg_filter&nbsp;but&nbsp;OPTIONS&nbsp;response&nbsp;declares&nbsp;the<br>
methods&nbsp;are&nbsp;RESPMOD<br>
&lt;/blockquote&gt;<br>
<br>
If&nbsp;your&nbsp;srv_content_filtering.so&nbsp;service&nbsp;does&nbsp;not&nbsp;need&nbsp;to&nbsp;see&nbsp;HTTP<br>
requests,&nbsp;then&nbsp;you&nbsp;can&nbsp;remove&nbsp;srv_cfg_filter_req&nbsp;from&nbsp;your&nbsp;Squid<br>
configuration.<br>
<br>
If&nbsp;your&nbsp;srv_content_filtering.so&nbsp;service&nbsp;needs&nbsp;to&nbsp;see&nbsp;both&nbsp;HTTP&nbsp;requests<br>
and&nbsp;responses,&nbsp;then&nbsp;you&nbsp;have&nbsp;two&nbsp;options,&nbsp;in&nbsp;no&nbsp;particular&nbsp;order:<br>
<br>
A)&nbsp;Tell&nbsp;c-icap&nbsp;and/or&nbsp;srv_content_filtering.so&nbsp;to&nbsp;send&nbsp;a&nbsp;&quot;Methods:<br>
REQMOD,RESPMOD&quot;&nbsp;ICAP&nbsp;response&nbsp;header&nbsp;field&nbsp;in&nbsp;OPTIONS&nbsp;response.&nbsp;Sorry,&nbsp;I<br>
do&nbsp;not&nbsp;know&nbsp;how&nbsp;to&nbsp;do&nbsp;that&nbsp;in&nbsp;c-icap&nbsp;and&nbsp;even&nbsp;whether&nbsp;that&nbsp;is&nbsp;actually<br>
possible&nbsp;with&nbsp;that&nbsp;software.&nbsp;Please&nbsp;note&nbsp;that&nbsp;using&nbsp;one&nbsp;service&nbsp;URI&nbsp;for<br>
two&nbsp;modes&nbsp;is&nbsp;not&nbsp;uncommon&nbsp;in&nbsp;the&nbsp;ICAP&nbsp;world,&nbsp;but&nbsp;violates&nbsp;the&nbsp;following<br>
ICAP&nbsp;RFC&nbsp;3507&nbsp;MUST:<br>
<br>
&nbsp;&nbsp;Each&nbsp;service&nbsp;should&nbsp;have&nbsp;a&nbsp;distinct&nbsp;URI<br>
&nbsp;&nbsp;and&nbsp;support&nbsp;only&nbsp;one&nbsp;method&nbsp;in&nbsp;addition&nbsp;to&nbsp;OPTIONS<br>
<br>
B)&nbsp;Use&nbsp;different&nbsp;ICAP&nbsp;service&nbsp;URIs&nbsp;for&nbsp;different&nbsp;services&nbsp;(REQMOD&nbsp;and<br>
RESPMOD)&nbsp;and&nbsp;configure&nbsp;each&nbsp;service&nbsp;appropriately&nbsp;on&nbsp;both&nbsp;Squid&nbsp;and<br>
c-icap&nbsp;side.&nbsp;This&nbsp;is&nbsp;what&nbsp;RFC&nbsp;3507&nbsp;wants&nbsp;you&nbsp;to&nbsp;do.&nbsp;For&nbsp;example,&nbsp;some<br>
ICAP&nbsp;servers&nbsp;and&nbsp;services&nbsp;would&nbsp;allow&nbsp;you&nbsp;to&nbsp;use&nbsp;these&nbsp;URIs:<br>
<br>
&nbsp;&nbsp;*&nbsp;for&nbsp;REQMOD:&nbsp;icap://localhost:1344/srv_cfg_filter?mode=REQMOD<br>
&nbsp;&nbsp;*&nbsp;for&nbsp;RESPMOD:&nbsp;icap://localhost:1344/srv_cfg_filter?mode=RESPMOD<br>
<br>
<br>
IIRC,&nbsp;Squid&nbsp;will&nbsp;try&nbsp;to&nbsp;use&nbsp;your&nbsp;service&nbsp;in&nbsp;both&nbsp;modes&nbsp;despite&nbsp;that<br>
WARNING.&nbsp;However,&nbsp;I&nbsp;do&nbsp;not&nbsp;know&nbsp;whether&nbsp;c-icap&nbsp;and&nbsp;that&nbsp;service&nbsp;itself<br>
will&nbsp;be&nbsp;happy&nbsp;about&nbsp;receiving&nbsp;REQMOD&nbsp;requests.<br>
<br>
<br>
HTH,<br>
<br>
Alex.<br>
<br>
<br>
<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
Here's&nbsp;the&nbsp;icap&nbsp;snippet&nbsp;from&nbsp;squid.conf:<br>
<br>
icap_enable&nbsp;on<br>
icap_send_client_ip&nbsp;on<br>
icap_persistent_connections&nbsp;on<br>
icap_service&nbsp;srv_cfg_filter_req&nbsp;reqmod_precache<br>
icap://localhost:1344/srv_cfg_filter&nbsp;bypass=on<br>
adaptation_access&nbsp;srv_cfg_filter_req&nbsp;allow&nbsp;all<br>
icap_service&nbsp;srv_cfg_filter_resp&nbsp;respmod_precache<br>
icap://localhost:1344/srv_cfg_filter&nbsp;bypass=off<br>
adaptation_access&nbsp;srv_cfg_filter_resp&nbsp;allow&nbsp;all<br>
<br>
interesting&nbsp;c-icap.conf&nbsp;bits:<br>
<br>
ModulesDir&nbsp;/opt/icap/lib/c_icap<br>
ServicesDir&nbsp;/opt/icap/lib/c_icap<br>
acl&nbsp;localhost&nbsp;src&nbsp;127.0.0.1/255.255.255.255<br>
acl&nbsp;PERMIT_REQUESTS&nbsp;type&nbsp;REQMOD&nbsp;RESPMOD<br>
icap_access&nbsp;allow&nbsp;localhost&nbsp;PERMIT_REQUESTS<br>
icap_access&nbsp;deny&nbsp;all<br>
Include&nbsp;srv_content_filtering.conf<br>
<br>
lastly,&nbsp;srv_content_filtering.conf:<br>
<br>
Service&nbsp;srv_cfg_filter&nbsp;srv_content_filtering.so<br>
srv_content_filtering.Match&nbsp;default&nbsp;body&nbsp;/(test)/ig&nbsp;score=5<br>
LogFormat&nbsp;mySrvContentFiltering&nbsp;&quot;%tl,&nbsp;%&gt;a&nbsp;%im&nbsp;%is&nbsp;%huo&nbsp;&nbsp;[Scores:<br>
%{srv_content_filtering:scores}Sa]&nbsp;[ActionFilter:<br>
%{srv_content_filtering:action_filter}Sa]&nbsp;[Action:<br>
%{srv_content_filtering:action}Sa]&quot;<br>
<br>
not&nbsp;sure&nbsp;why&nbsp;I&nbsp;can't&nbsp;seem&nbsp;to&nbsp;get&nbsp;this&nbsp;to&nbsp;fly...any&nbsp;assistance&nbsp;would&nbsp;be<br>
appreciated...thank&nbsp;you.<br>
&lt;/blockquote&gt;&lt;/pre&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thank&nbsp;you&nbsp;Alex....I&nbsp;followed:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;a&nbsp;href=&quot;http://wiki.squid-cache.org/ConfigExamples/ContentAdaptation/C-ICAP&quot;&gt;http://wiki.squid-cache.org/ConfigExamples/ContentAdaptation/C-ICAP&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;As&nbsp;best&nbsp;I&nbsp;could,&nbsp;but&nbsp;it&nbsp;looks&nbsp;like&nbsp;that&nbsp;adapter&nbsp;needs&nbsp;something&nbsp;different.&nbsp;&nbsp;I'll&nbsp;report&nbsp;my&nbsp;results&nbsp;here&nbsp;once&nbsp;I&nbsp;get&nbsp;it&nbsp;fixed.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;James&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
