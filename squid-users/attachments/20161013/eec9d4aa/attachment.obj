workers 4

http_port 3127
http_port 3128
http_port 3130 transparent
http_port 8080
https_port 8443 cert=sslfilter.crt key=sslfilter.key ssl-bump intercept generate-host-certificates=on version=1 options=NO_SSLv2,NO_SSLv3,SINGLE_DH_USE
acl QUERY urlpath_regex cgi-bin \?
cache deny QUERY
acl apache rep_header Server ^Apache
cache_mem 32 MB
access_log /var/log/squid/access.log
cache_log /var/log/squid/cache.log
cache_store_log none
mime_table /etc/squid/mime.conf
pid_filename /var/run/squid.pid
debug_options ALL,1
dns_defnames on
auth_param basic program /usr/bin/ntlm.py --helper-protocol=squid-2.5-basic
auth_param basic children 5
auth_param basic realm WF
auth_param basic credentialsttl 2 hours
auth_param basic casesensitive off
external_acl_type external_db ttl=1 negative_ttl=150 children-startup=20 %SRC /usr/bin/external.py
refresh_pattern ^ftp:		1440	20%	10080
refresh_pattern ^gopher:	1440	0%	1440
refresh_pattern .		0	20%	4320
client_lifetime 10 minutes
half_closed_clients off
acl SSL_ports port 443 563 81
acl Safe_ports port 80		# http
acl Safe_ports port 81
acl Safe_ports port 21		# ftp
acl Safe_ports port 443 563	# https, snews
acl Safe_ports port 70		# gopher
acl Safe_ports port 210		# wais
acl Safe_ports port 1025-65535	# unregistered ports
acl Safe_ports port 280		# http-mgmt
acl Safe_ports port 488		# gss-http
acl Safe_ports port 591		# filemaker
acl Safe_ports port 777		# multiling http
acl CONNECT method CONNECT
acl POLL method POLL
acl SUBSCRIBE method SUBSCRIBE
acl SEARCH method SEARCH
acl UNLOCK method UNLOCK
acl LOCK method LOCK
acl MOVE method MOVE
acl COPY method COPY
acl DELETE method DELETE
acl MKCOL method MKCOL
acl PROPPATCH method PROPPATCH
acl PROPFIND method PROPFIND
acl HEAD method HEAD
acl ntlm_port myportname 3128
acl alwaysdirect dstdomain "/etc/squid/always_direct"
acl external_db_users external external_db
acl windowsupdate dstdomain "/etc/squid/non-auth_destinations"
acl wuCONNECT dstdomain "/etc/squid/non-auth_destinations"
acl tallow dstdomain "/etc/squid/tallow"
http_access allow manager localhost
http_access allow manager all
http_access deny manager
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow localhost
http_access allow external_db_users
http_access allow HEAD
http_access allow PROPFIND
http_access allow PROPPATCH
http_access allow MKCOL
http_access allow DELETE
http_access allow COPY
http_access allow MOVE
http_access allow LOCK
http_access allow UNLOCK
http_access allow SEARCH
http_access allow SUBSCRIBE
http_access allow POLL
http_access allow alwaysdirect
http_access allow CONNECT wuCONNECT
http_access allow windowsupdate
acl NATedHTTPS myport 8443
http_access allow NATedHTTPS
http_access allow tallow
http_access deny all
http_reply_access allow all
icp_access deny all
cache_effective_user squid
cache_effective_group squid
visible_hostname squidbox-1
forwarded_for on
always_direct allow all
never_direct allow all
icon_directory /usr/share/squid/icons
error_directory /usr/share/squid/errors/tr
coredump_dir /var/cache/squid
persistent_connection_after_error off
detect_broken_pconn on
pipeline_prefetch off
always_direct allow all
acl step1 at_step SslBump1
acl step2 at_step SslBump2
acl https_bypass_networks dst "/etc/squid/https_filter_exception_networks"
acl https_bypass ssl::server_name "/etc/squid/https_filter_exceptions"
ssl_bump peek step1
ssl_bump splice https_bypass
ssl_bump splice https_bypass_networks
ssl_bump bump all
sslproxy_cert_error allow all
sslcrtd_program /var/lib/squid/ssl_crtd -s /var/lib/squid/ssl_db -M 4MB
sslcrtd_children 10
sslproxy_cafile /etc/pki/tls/cert.pem
sslproxy_cipher EECDH+ECDSA+AESGCM:EECDH+aRSA+AESGCM:EECDH+ECDSA+SHA384:EECDH+ECDSA+SHA256:EECDH+aRSA+SHA384:EECDH+aRSA+SHA256:EECDH+aRSA+RC4:EECDH:EDH+aRSA:HIGH:!RC4:!aNULL:!eNULL:!LOW:!3DES:!MD5:!EXP:!PSK:!SRP:!DSS
icap_enable on
icap_send_client_ip on
icap_send_client_username on
icap_client_username_header X-Client-Username
icap_service service_req_14 reqmod_precache bypass=on icap://127.0.0.1:1344/req
adaptation_access service_req_14 allow all
icap_service service_avi_resp respmod_precache icap://127.0.0.1:1344/virus_scan bypass=on routing=on
icap_service service_resp_14 respmod_precache bypass=on icap://127.0.0.1:1344/resp
adaptation_service_chain response_chain service_avi_resp service_resp_14
adaptation_access response_chain allow all
adaptation_meta X-Local-Port "%lp"
adaptation_meta X-Current-Time "%ts.%03tu"
adaptation_meta X-Transaction-Start-Time "%tS"
icap_206_enable off
via off
request_header_access X-Forwarded-For deny all
acl IMAGE urlpath_regex -i .(jpeg|jpg|jpe|jp2|gif|tiff?|pcx|png|bmp|pic|ico)$
cache allow IMAGE
cache deny all
