<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi&lt;div&gt;&lt;br&gt;Replying&nbsp;to&nbsp;the&nbsp;list&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Yes&nbsp;i&nbsp;get&nbsp;that&nbsp;error&nbsp;on&nbsp;many&nbsp;different&nbsp;sites&nbsp;same&nbsp;exact&nbsp;error&nbsp;about&nbsp;host&nbsp;headers.&lt;/div&gt;&lt;div&gt;Also&nbsp;if&nbsp;you&nbsp;watch&nbsp;the&nbsp;TTL&nbsp;on&nbsp;the&nbsp;amazonaws&nbsp;url&nbsp;i&nbsp;provided&nbsp;it&nbsp;changes&nbsp;from&nbsp;3&nbsp;to&nbsp;5&nbsp;to&nbsp;10&nbsp;seconds&nbsp;to&nbsp;60&nbsp;to&nbsp;10&nbsp;back&nbsp;and&nbsp;forth.&lt;br&gt;If&nbsp;you&nbsp;go&nbsp;online&nbsp;to&nbsp;an&nbsp;dns&nbsp;lookup&nbsp;site&nbsp;like&nbsp;kloth&nbsp;i&nbsp;see&nbsp;via&nbsp;kloth&nbsp;5&nbsp;seconds&nbsp;TTL&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;i&nbsp;get&nbsp;a&nbsp;different&nbsp;TTL&nbsp;value&nbsp;at&nbsp;different&nbsp;times,&nbsp;it&nbsp;appears&nbsp;they&nbsp;dont&nbsp;have&nbsp;a&nbsp;set&nbsp;TTL&nbsp;but&nbsp;they&nbsp;change&nbsp;it&nbsp;often&nbsp;and&nbsp;it&nbsp;varies.&lt;/div&gt;&lt;div&gt;Right&nbsp;now&nbsp;it&nbsp;appears&nbsp;to&nbsp;be&nbsp;a&nbsp;ttl&nbsp;of&nbsp;60&nbsp;seconds&nbsp;as&nbsp;you&nbsp;found&nbsp;but&nbsp;earlier&nbsp;and&nbsp;over&nbsp;the&nbsp;weekend&nbsp;it&nbsp;has&nbsp;shown&nbsp;5&nbsp;seconds&nbsp;and&nbsp;even&nbsp;AWS&nbsp;support&nbsp;verified&nbsp;it&nbsp;can&nbsp;vary&nbsp;as&nbsp;low&nbsp;as&nbsp;5&nbsp;seconds.&lt;/div&gt;&lt;div&gt;That&nbsp;being&nbsp;said&nbsp;,&nbsp;when&nbsp;it&nbsp;is&nbsp;changing&nbsp;every&nbsp;3-5&nbsp;seconds&nbsp;which&nbsp;comes&nbsp;and&nbsp;goes&nbsp;,&nbsp;squid&nbsp;gives&nbsp;the&nbsp;header&nbsp;forgery&nbsp;errors&nbsp;as&nbsp;shown&nbsp;before.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Tue,&nbsp;Oct&nbsp;18,&nbsp;2016&nbsp;at&nbsp;12:30&nbsp;PM,&nbsp;&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:garryd@comnet.uz&quot;&nbsp;target=&quot;_blank&quot;&gt;garryd@comnet.uz&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;On&nbsp;2016-10-18&nbsp;18:32,&nbsp;John&nbsp;Wright&nbsp;wrote:&lt;br&gt;<br>
&lt;/span&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;<br>
Hi,&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;have&nbsp;a&nbsp;constant&nbsp;problem&nbsp;with&nbsp;Host&nbsp;header&nbsp;forgery&nbsp;detection&nbsp;on&nbsp;squid&lt;br&gt;<br>
doing&nbsp;peek&nbsp;and&nbsp;splice.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;see&nbsp;this&nbsp;most&nbsp;commonly&nbsp;with&nbsp;CDN,&nbsp;Amazon&nbsp;and&nbsp;microsoft&nbsp;due&nbsp;to&nbsp;the&lt;br&gt;<br>
fact&nbsp;there&nbsp;TTL&nbsp;is&nbsp;only&nbsp;5&nbsp;seconds&nbsp;on&nbsp;certain&nbsp;dns&nbsp;entries&nbsp;im&nbsp;connecting&lt;br&gt;<br>
to. &nbsp;So&nbsp;when&nbsp;my&nbsp;client&nbsp;connects&nbsp;through&nbsp;my&nbsp;squid&nbsp;i&nbsp;get&nbsp;host&nbsp;header&lt;br&gt;<br>
issues&nbsp;due&nbsp;to&nbsp;the&nbsp;contstant&nbsp;dns&nbsp;changes&nbsp;at&nbsp;these&nbsp;destinations.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;have&nbsp;ready&nbsp;many&nbsp;things&nbsp;online&nbsp;but&nbsp;how&nbsp;do&nbsp;i&nbsp;get&nbsp;around&nbsp;this. &nbsp;I&lt;br&gt;<br>
basically&nbsp;want&nbsp;to&nbsp;allow&nbsp;certain&nbsp;domains&nbsp;or&nbsp;ip&nbsp;subnets&nbsp;to&nbsp;not&nbsp;hit&nbsp;the&lt;br&gt;<br>
host&nbsp;header&nbsp;error&nbsp;(as&nbsp;things&nbsp;break&nbsp;at&nbsp;this&nbsp;point&nbsp;for&nbsp;me&nbsp;).&lt;br&gt;<br>
&lt;br&gt;<br>
Any&nbsp;ideas&nbsp;?&lt;br&gt;<br>
&lt;br&gt;<br>
One&nbsp;example&nbsp;is&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;&lt;a&nbsp;href=&quot;http://sls.update.microsoft.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;sls.update.microsoft.com&lt;/a&gt;&nbsp;[1]&lt;span&nbsp;class=&quot;&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
Yes&nbsp;my&nbsp;client&nbsp;and&nbsp;Squid&nbsp;use&nbsp;same&nbsp;DNS&nbsp;server,&nbsp;i&nbsp;have&nbsp;even&nbsp;setup&nbsp;my&lt;br&gt;<br>
squid&nbsp;as&nbsp;a&nbsp;bind&nbsp;server&nbsp;and&nbsp;tried&nbsp;that&nbsp;just&nbsp;for&nbsp;fun&nbsp;same&nbsp;issue. &nbsp;Fact&lt;br&gt;<br>
is&nbsp;the&nbsp;DNS&nbsp;at&nbsp;these&nbsp;places&nbsp;changes&nbsp;so&nbsp;fast&nbsp;(5&nbsp;seconds)&nbsp;the&nbsp;dns&lt;br&gt;<br>
response&nbsp;keeps&nbsp;changing/&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;just&nbsp;need&nbsp;these&nbsp;approved&nbsp;destinations&nbsp;to&nbsp;make&nbsp;it&nbsp;through&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;/span&gt;<br>
Links:&lt;br&gt;<br>
------&lt;br&gt;<br>
[1]&nbsp;&lt;a&nbsp;href=&quot;http://sls.update.microsoft.com/&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://sls.update.microsoft.co&lt;wbr&gt;m/&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
Hi,&lt;br&gt;<br>
&lt;br&gt;<br>
Are&nbsp;you&nbsp;sure,&nbsp;that&nbsp;Squid&nbsp;and&nbsp;all&nbsp;your&nbsp;clients&nbsp;use&nbsp;same&nbsp;_caching_&nbsp;DNS&nbsp;server?&nbsp;For&nbsp;example,&nbsp;here&nbsp;results&nbsp;from&nbsp;my&nbsp;server&nbsp;for&nbsp;name&nbsp;&lt;a&nbsp;href=&quot;http://sls.update.microsoft.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;sls.update.microsoft.com&lt;/a&gt;:&lt;br&gt;<br>
&lt;br&gt;<br>
$&nbsp;dig&nbsp;&lt;a&nbsp;href=&quot;http://sls.update.microsoft.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;sls.update.microsoft.com&lt;/a&gt;&lt;br&gt;<br>
...&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://sls.update.microsoft.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;sls.update.microsoft.com&lt;/a&gt;.&nbsp;3345 &nbsp;IN &nbsp; &nbsp; &nbsp;CNAME &nbsp; &lt;a&nbsp;href=&quot;http://sls.update.microsoft.com.nsatc.net&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;sls.update.microsoft.com.nsat&lt;wbr&gt;c.net&lt;/a&gt;.&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://sls.update.microsoft.com.nsatc.net&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;sls.update.microsoft.com.nsatc&lt;wbr&gt;.net&lt;/a&gt;.&nbsp;215&nbsp;IN&nbsp;A &nbsp; &nbsp;157.56.77.141&lt;br&gt;<br>
...&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Second&nbsp;request&nbsp;after&nbsp;3&nbsp;seconds:&lt;br&gt;<br>
&lt;br&gt;<br>
$&nbsp;dig&nbsp;&lt;a&nbsp;href=&quot;http://sls.update.microsoft.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;sls.update.microsoft.com&lt;/a&gt;&lt;br&gt;<br>
...&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://sls.update.microsoft.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;sls.update.microsoft.com&lt;/a&gt;.&nbsp;3342 &nbsp;IN &nbsp; &nbsp; &nbsp;CNAME &nbsp; &lt;a&nbsp;href=&quot;http://sls.update.microsoft.com.nsatc.net&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;sls.update.microsoft.com.nsat&lt;wbr&gt;c.net&lt;/a&gt;.&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://sls.update.microsoft.com.nsatc.net&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;sls.update.microsoft.com.nsatc&lt;wbr&gt;.net&lt;/a&gt;.&nbsp;212&nbsp;IN&nbsp;A &nbsp; &nbsp;157.56.77.141&lt;br&gt;<br>
...&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Here&nbsp;I&nbsp;see&nbsp;that&nbsp;the&nbsp;TTL&nbsp;for&nbsp;the&nbsp;target&nbsp;A&nbsp;record&nbsp;is&nbsp;300&nbsp;seconds&nbsp;(not&nbsp;5&nbsp;seconds),&nbsp;and&nbsp;_caching_&nbsp;DNS&nbsp;server&nbsp;will&nbsp;serve&nbsp;same&nbsp;A&nbsp;record&nbsp;for&nbsp;all&nbsp;clients&nbsp;at&nbsp;least&nbsp;5&nbsp;minutes.&nbsp;That&nbsp;behaviour&nbsp;will&nbsp;not&nbsp;introduce&nbsp;false&nbsp;positives&nbsp;for&nbsp;host&nbsp;forgery&nbsp;detection.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;other&nbsp;hand,&nbsp;if&nbsp;the&nbsp;DNS&nbsp;server&nbsp;is&nbsp;not&nbsp;_caching_,&nbsp;you&nbsp;would&nbsp;get&nbsp;different&nbsp;A&nbsp;records&nbsp;for&nbsp;each&nbsp;request.&nbsp;For&nbsp;example,&nbsp;below&nbsp;are&nbsp;results&nbsp;from&nbsp;authoritative&nbsp;DNS&nbsp;server&nbsp;for&nbsp;zone&nbsp;&lt;a&nbsp;href=&quot;http://nsatc.net&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;nsatc.net&lt;/a&gt;:&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
$&nbsp;dig&nbsp;@&lt;a&nbsp;href=&quot;http://e.ns.nsatc.net&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;e.ns.nsatc.net&lt;/a&gt;&nbsp;&lt;a&nbsp;href=&quot;http://sls.update.microsoft.com.nsatc.net&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;sls.update.microsoft.com.nsatc&lt;wbr&gt;.net&lt;/a&gt;&lt;br&gt;<br>
...&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://sls.update.microsoft.com.nsatc.net&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;sls.update.microsoft.com.nsatc&lt;wbr&gt;.net&lt;/a&gt;.&nbsp;300&nbsp;IN&nbsp;A &nbsp; &nbsp;&lt;a&nbsp;href=&quot;tel:157.55.240.220&quot;&nbsp;value=&quot;+15755240220&quot;&nbsp;target=&quot;_blank&quot;&gt;157.55.240.220&lt;/a&gt;&lt;br&gt;<br>
...&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Second&nbsp;request&nbsp;after&nbsp;5&nbsp;seconds:&lt;br&gt;<br>
&lt;br&gt;<br>
$&nbsp;dig&nbsp;@&lt;a&nbsp;href=&quot;http://e.ns.nsatc.net&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;e.ns.nsatc.net&lt;/a&gt;&nbsp;&lt;a&nbsp;href=&quot;http://sls.update.microsoft.com.nsatc.net&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;sls.update.microsoft.com.nsatc&lt;wbr&gt;.net&lt;/a&gt;&lt;br&gt;<br>
...&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://sls.update.microsoft.com.nsatc.net&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;sls.update.microsoft.com.nsatc&lt;wbr&gt;.net&lt;/a&gt;.&nbsp;300&nbsp;IN&nbsp;A &nbsp; &nbsp;157.56.96.54&lt;br&gt;<br>
...&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Here&nbsp;I&nbsp;see,&nbsp;that&nbsp;the&nbsp;DNS&nbsp;server&nbsp;serves&nbsp;exactly&nbsp;one&nbsp;A&nbsp;record&nbsp;in&nbsp;round-robin&nbsp;fashion.&nbsp;Same&nbsp;true&nbsp;for&nbsp;Google&nbsp;public&nbsp;DNS&nbsp;services.&nbsp;That&nbsp;behavior&nbsp;could&nbsp;cause&nbsp;troubles&nbsp;for&nbsp;host&nbsp;forgery&nbsp;detection.&lt;br&gt;<br>
&lt;br&gt;<br>
HTH&lt;br&gt;<br>
&lt;br&gt;<br>
Garri&lt;br&gt;<br>
______________________________&lt;wbr&gt;_________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.&lt;wbr&gt;org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/l&lt;wbr&gt;istinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;--&nbsp;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_signature&quot;&nbsp;data-smartmail=&quot;gmail_signature&quot;&gt;Thank&nbsp;you&nbsp;for&nbsp;your&nbsp;time,&lt;br&gt;&lt;br&gt;John&nbsp;Wright&lt;br&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;/div&gt;<br>

</tt>
