<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hello, &lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;am&nbsp;having&nbsp;problems&nbsp;with&nbsp;squid&nbsp;&amp;&nbsp;SSL.&nbsp;I&nbsp;have&nbsp;setup&nbsp;squid&nbsp;in&nbsp;reverse-proxy&nbsp;configuration&nbsp;and&nbsp;overall&nbsp;it&nbsp;works&nbsp;fine,&nbsp;however&nbsp;for&nbsp;security&nbsp;reasons&nbsp;I&nbsp;had&nbsp;to&nbsp;disable&nbsp;some&nbsp;of&nbsp;the&nbsp;ciphers.&nbsp;I&nbsp;have&nbsp;taken&nbsp;an&nbsp;example&nbsp;configuration&nbsp;from &lt;a&nbsp;href=&quot;http://www.rawiriblundell.com/?p=1442&quot;&gt;http://www.rawiriblundell.com/?p=1442&lt;/a&gt;&nbsp;and&nbsp;my&nbsp;https_port&nbsp;line&nbsp;looks&nbsp;pretty&nbsp;much&nbsp;like&nbsp;this&nbsp;(this&nbsp;is&nbsp;the&nbsp;example&nbsp;from&nbsp;the&nbsp;website&nbsp;but&nbsp;the&nbsp;disabled&nbsp;ciphers&nbsp;are&nbsp;the&nbsp;same&nbsp;for&nbsp;me&nbsp;as&nbsp;well):&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(102,102,102);font-family:monospace;font-size:17px&quot;&gt;https_port&nbsp; 443&nbsp;accel&nbsp;defaultsite=someinternalhost&nbsp;vhost&nbsp;cert=/etc/squid/CertAuth/supersecret.crt&nbsp;key=/etc/squid/CertAuth/supersecret.key&nbsp;options=NO_SSLv2,NO_SSLv3,CIPHER_SERVER_PREFERENCE&nbsp;cipher=ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4&nbsp;dhparams=/etc/squid/CertAuth/dhparams.pem&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;During&nbsp;my&nbsp;build&nbsp;I&nbsp;have&nbsp;included&nbsp;the&nbsp;config&nbsp;options&nbsp;--enable-ssl&nbsp;and&nbsp;--with-openssl=/usr&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Using&nbsp;the&nbsp;proxy&nbsp;through&nbsp;a&nbsp;browser&nbsp;works&nbsp;fine,&nbsp;but&nbsp;if&nbsp;I&nbsp;try &lt;span&nbsp;style=&quot;color:rgb(0,0,0);font-family:&quot;andale&nbsp;mono&quot;,monospace;font-size:smaller&quot;&gt;nmap&nbsp;--script&nbsp;ssl-enum-ciphers&nbsp;-p&nbsp;443&nbsp;&lt;host&gt;&nbsp;or&nbsp;openssl&nbsp;s_client&nbsp;-cipher&nbsp;&#39;RC4-SHA&#39;&nbsp;-connect&nbsp;&lt;host&gt; &lt;/span&gt;these&nbsp;commands&nbsp;result&nbsp;in&nbsp;complete&nbsp;DoS&nbsp;for&nbsp;a&nbsp;few&nbsp;minutes.&nbsp;I&nbsp;figured&nbsp;out&nbsp;that&nbsp;only&nbsp;the&nbsp;unsupported&nbsp;or&nbsp;disabled&nbsp;ciphers&nbsp;cause&nbsp;this&nbsp;problem.&nbsp;Also&nbsp;when&nbsp;I&nbsp;do&nbsp;the&nbsp;openssl&nbsp;connection&nbsp;as&nbsp;shown&nbsp;above&nbsp;the&nbsp;proxy&nbsp;will&nbsp;be&nbsp;unresponsive&nbsp;as&nbsp;long&nbsp;as&nbsp;openssl&nbsp;is&nbsp;trying&nbsp;to&nbsp;connect&nbsp;using&nbsp;the&nbsp;disabled&nbsp;cipher.&nbsp;As&nbsp;soon&nbsp;as&nbsp;it&nbsp;finishes&nbsp;(eg&nbsp;times&nbsp;out&nbsp;unable&nbsp;to&nbsp;connect&nbsp;using&nbsp;RC4)&nbsp;the&nbsp;proxy&nbsp;starts&nbsp;serving&nbsp;requests&nbsp;again.&nbsp;I&nbsp;should&nbsp;mention&nbsp;that&nbsp;I&nbsp;am&nbsp;running&nbsp;squid&nbsp;inside&nbsp;a&nbsp;docker&nbsp;container&nbsp;if&nbsp;this&nbsp;matters&nbsp;at&nbsp;all. &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;errors&nbsp;in&nbsp;my&nbsp;logs&nbsp;are&nbsp;: &lt;/div&gt;&lt;div&gt;&quot;Error&nbsp;negotiating&nbsp;SSL&nbsp;connection&nbsp;on&nbsp;FD&nbsp;22:&nbsp;error&nbsp;1408A0C1:SSL&nbsp;routines:SSL3_GET_CLIENT_HELLO:&nbsp;no&nbsp;shared&nbsp;cipher&nbsp;(1/-1)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&quot;Error&nbsp;negotiating&nbsp;SSL&nbsp;connection&nbsp;on&nbsp;FD&nbsp;25:&nbsp;error&nbsp;1408A10B:SSL&nbsp;routines:SSL3_GET_CLIENT_HELLO:&nbsp;wrong&nbsp;version&nbsp;number&nbsp;(1/-1)&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;P.S&nbsp;I&nbsp;also&nbsp;tried&nbsp;squid&nbsp;4,&nbsp;and&nbsp;got&nbsp;exactly&nbsp;the&nbsp;same&nbsp;problem.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Any&nbsp;help&nbsp;will&nbsp;be&nbsp;much&nbsp;appreciated &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks!&lt;/div&gt;&lt;/div&gt;<br>

</tt>
