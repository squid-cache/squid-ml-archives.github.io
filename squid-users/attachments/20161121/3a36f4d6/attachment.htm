<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;without&nbsp;restricting&nbsp;the&nbsp;ciphers&nbsp;seems&nbsp;to&nbsp;work&nbsp;fine,&nbsp;however&nbsp;some&nbsp;of&nbsp;the&nbsp;ciphers&nbsp;are&nbsp;vulnerable&nbsp;to&nbsp;attacks...Furthermore&nbsp;I&nbsp;think&nbsp;if&nbsp;I&nbsp;try&nbsp;some&nbsp;weird&nbsp;cipher&nbsp;which&nbsp;Squid&nbsp;is&nbsp;not&nbsp;supporting&nbsp;the&nbsp;same&nbsp;thing&nbsp;will&nbsp;happen...&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Mon,&nbsp;Nov&nbsp;21,&nbsp;2016&nbsp;at&nbsp;5:12&nbsp;PM,&nbsp;Eliezer&nbsp;Croitoru&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:eliezer@ngtech.co.il&quot;&nbsp;target=&quot;_blank&quot;&gt;eliezer@ngtech.co.il&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;But&nbsp;what&nbsp;happens&nbsp;when&nbsp;you&nbsp;are&nbsp;not&nbsp;restricting&nbsp;the&nbsp;cipher&nbsp;with&nbsp;all&nbsp;this&nbsp;mess&lt;br&gt;<br>
in&nbsp;the&nbsp;options?&lt;br&gt;<br>
Would&nbsp;then&nbsp;also&nbsp;the&nbsp;DOS&nbsp;from&nbsp;nmap&nbsp;result&nbsp;the&nbsp;same&nbsp;issue?&lt;br&gt;<br>
&lt;br&gt;<br>
Eliezer&lt;br&gt;<br>
&lt;br&gt;<br>
----&lt;br&gt;<br>
Eliezer&nbsp;Croitoru&nbsp;&lt;&lt;a&nbsp;href=&quot;http://ngtech.co.il/lmgtfy/&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://ngtech.co.il/lmgtfy/&lt;/a&gt;&gt;&lt;br&gt;<br>
Linux&nbsp;System&nbsp;Administrator&lt;br&gt;<br>
Mobile:&nbsp;&lt;a&nbsp;href=&quot;tel:%2B972-5-28704261&quot;&nbsp;value=&quot;+972528704261&quot;&gt;+972-5-28704261&lt;/a&gt;&lt;br&gt;<br>
Email:&nbsp;&lt;a&nbsp;href=&quot;mailto:eliezer@ngtech.co.il&quot;&gt;eliezer@ngtech.co.il&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
From:&nbsp;squid-users&nbsp;[mailto:&lt;a&nbsp;href=&quot;mailto:squid-users-bounces@lists.squid-cache.org&quot;&gt;squid-users-bounces@&lt;wbr&gt;lists.squid-cache.org&lt;/a&gt;]&nbsp;On&lt;br&gt;<br>
Behalf&nbsp;Of&nbsp;Martin&nbsp;Tenev&lt;br&gt;<br>
Sent:&nbsp;Monday,&nbsp;November&nbsp;21,&nbsp;2016&nbsp;19:01&lt;br&gt;<br>
To:&nbsp;&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.&lt;wbr&gt;org&lt;/a&gt;&lt;br&gt;<br>
Subject:&nbsp;[squid-users]&nbsp;Squid&nbsp;3.5.21&nbsp;&quot;hangs&quot;&nbsp;when&nbsp;trying&nbsp;to&nbsp;connect&nbsp;using&lt;br&gt;<br>
unsupported&nbsp;cipher&nbsp;(complete&nbsp;DoS)&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;br&gt;<br>
Hello,&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;am&nbsp;having&nbsp;problems&nbsp;with&nbsp;squid&nbsp;&amp;&nbsp;SSL.&nbsp;I&nbsp;have&nbsp;setup&nbsp;squid&nbsp;in&nbsp;reverse-proxy&lt;br&gt;<br>
configuration&nbsp;and&nbsp;overall&nbsp;it&nbsp;works&nbsp;fine,&nbsp;however&nbsp;for&nbsp;security&nbsp;reasons&nbsp;I&nbsp;had&lt;br&gt;<br>
to&nbsp;disable&nbsp;some&nbsp;of&nbsp;the&nbsp;ciphers.&nbsp;I&nbsp;have&nbsp;taken&nbsp;an&nbsp;example&nbsp;configuration&nbsp;from&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://www.rawiriblundell.com/?p=1442&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.rawiriblundell.com/&lt;wbr&gt;?p=1442&lt;/a&gt;&nbsp;and&nbsp;my&nbsp;https_port&nbsp;line&nbsp;looks&nbsp;pretty&lt;br&gt;<br>
much&nbsp;like&nbsp;this&nbsp;(this&nbsp;is&nbsp;the&nbsp;example&nbsp;from&nbsp;the&nbsp;website&nbsp;but&nbsp;the&nbsp;disabled&lt;br&gt;<br>
ciphers&nbsp;are&nbsp;the&nbsp;same&nbsp;for&nbsp;me&nbsp;as&nbsp;well):&lt;br&gt;<br>
&lt;br&gt;<br>
https_portÂ &nbsp;443&nbsp;accel&nbsp;defaultsite=someinternalhost&nbsp;vhost&lt;br&gt;<br>
cert=/etc/squid/CertAuth/&lt;wbr&gt;supersecret.crt&lt;br&gt;<br>
key=/etc/squid/CertAuth/&lt;wbr&gt;supersecret.key&lt;br&gt;<br>
options=NO_SSLv2,NO_SSLv3,&lt;wbr&gt;CIPHER_SERVER_PREFERENCE&lt;br&gt;<br>
cipher=ECDHE-RSA-AES256-GCM-&lt;wbr&gt;SHA384:ECDHE-RSA-AES128-GCM-&lt;wbr&gt;SHA256:DHE-RSA-AES25&lt;br&gt;<br>
6-GCM-SHA384:DHE-RSA-AES128-&lt;wbr&gt;GCM-SHA256:ECDHE-RSA-AES256-&lt;wbr&gt;SHA384:ECDHE-RSA-AES&lt;br&gt;<br>
128-SHA256:ECDHE-RSA-AES256-&lt;wbr&gt;SHA:ECDHE-RSA-AES128-SHA:DHE-&lt;wbr&gt;RSA-AES256-SHA256:D&lt;br&gt;<br>
HE-RSA-AES128-SHA256:DHE-RSA-&lt;wbr&gt;AES256-SHA:DHE-RSA-AES128-SHA:&lt;wbr&gt;ECDHE-RSA-DES-CBC&lt;br&gt;<br>
3-SHA:EDH-RSA-DES-CBC3-SHA:&lt;wbr&gt;AES256-GCM-SHA384:AES128-GCM-&lt;wbr&gt;SHA256:AES256-SHA256&lt;br&gt;<br>
:AES128-SHA256:AES256-SHA:&lt;wbr&gt;AES128-SHA:DES-CBC3-SHA:HIGH:!&lt;wbr&gt;aNULL:!eNULL:!EXPORT&lt;br&gt;<br>
:!DES:!MD5:!PSK:!RC4&nbsp;dhparams=/etc/squid/CertAuth/&lt;wbr&gt;dhparams.pem&lt;br&gt;<br>
&lt;br&gt;<br>
During&nbsp;my&nbsp;build&nbsp;I&nbsp;have&nbsp;included&nbsp;the&nbsp;config&nbsp;options&nbsp;--enable-ssl&nbsp;and&lt;br&gt;<br>
--with-openssl=/usr&lt;br&gt;<br>
&lt;br&gt;<br>
Using&nbsp;the&nbsp;proxy&nbsp;through&nbsp;a&nbsp;browser&nbsp;works&nbsp;fine,&nbsp;but&nbsp;if&nbsp;I&nbsp;try&nbsp;nmap&nbsp;--script&lt;br&gt;<br>
ssl-enum-ciphers&nbsp;-p&nbsp;443&nbsp;&lt;host&gt;&nbsp;or&nbsp;openssl&nbsp;s_client&nbsp;-cipher&nbsp;&#39;RC4-SHA&#39;&lt;br&gt;<br>
-connect&nbsp;&lt;host&gt;&nbsp;these&nbsp;commands&nbsp;result&nbsp;in&nbsp;complete&nbsp;DoS&nbsp;for&nbsp;a&nbsp;few&nbsp;minutes.&nbsp;I&lt;br&gt;<br>
figured&nbsp;out&nbsp;that&nbsp;only&nbsp;the&nbsp;unsupported&nbsp;or&nbsp;disabled&nbsp;ciphers&nbsp;cause&nbsp;this&lt;br&gt;<br>
problem.&nbsp;Also&nbsp;when&nbsp;I&nbsp;do&nbsp;the&nbsp;openssl&nbsp;connection&nbsp;as&nbsp;shown&nbsp;above&nbsp;the&nbsp;proxy&nbsp;will&lt;br&gt;<br>
be&nbsp;unresponsive&nbsp;as&nbsp;long&nbsp;as&nbsp;openssl&nbsp;is&nbsp;trying&nbsp;to&nbsp;connect&nbsp;using&nbsp;the&nbsp;disabled&lt;br&gt;<br>
cipher.&nbsp;As&nbsp;soon&nbsp;as&nbsp;it&nbsp;finishes&nbsp;(eg&nbsp;times&nbsp;out&nbsp;unable&nbsp;to&nbsp;connect&nbsp;using&nbsp;RC4)&lt;br&gt;<br>
the&nbsp;proxy&nbsp;starts&nbsp;serving&nbsp;requests&nbsp;again.&nbsp;I&nbsp;should&nbsp;mention&nbsp;that&nbsp;I&nbsp;am&nbsp;running&lt;br&gt;<br>
squid&nbsp;inside&nbsp;a&nbsp;docker&nbsp;container&nbsp;if&nbsp;this&nbsp;matters&nbsp;at&nbsp;all.&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;errors&nbsp;in&nbsp;my&nbsp;logs&nbsp;are&nbsp;:&lt;br&gt;<br>
&quot;Error&nbsp;negotiating&nbsp;SSL&nbsp;connection&nbsp;on&nbsp;FD&nbsp;22:&nbsp;error&nbsp;1408A0C1:SSL&lt;br&gt;<br>
routines:SSL3_GET_CLIENT_&lt;wbr&gt;HELLO:&nbsp;no&nbsp;shared&nbsp;cipher&nbsp;(1/-1)&lt;br&gt;<br>
&lt;br&gt;<br>
&quot;Error&nbsp;negotiating&nbsp;SSL&nbsp;connection&nbsp;on&nbsp;FD&nbsp;25:&nbsp;error&nbsp;1408A10B:SSL&lt;br&gt;<br>
routines:SSL3_GET_CLIENT_&lt;wbr&gt;HELLO:&nbsp;wrong&nbsp;version&nbsp;number&nbsp;(1/-1)&lt;br&gt;<br>
&lt;br&gt;<br>
P.S&nbsp;I&nbsp;also&nbsp;tried&nbsp;squid&nbsp;4,&nbsp;and&nbsp;got&nbsp;exactly&nbsp;the&nbsp;same&nbsp;problem.&lt;br&gt;<br>
&lt;br&gt;<br>
Any&nbsp;help&nbsp;will&nbsp;be&nbsp;much&nbsp;appreciated&lt;br&gt;<br>
&lt;br&gt;<br>
Thanks!&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
