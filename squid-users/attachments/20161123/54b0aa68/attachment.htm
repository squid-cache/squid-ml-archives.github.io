<tt>
&lt;html&gt;&lt;body&gt;&lt;div&gt;Hello&nbsp;Garri,&lt;/div&gt;&lt;div&gt;Thank&nbsp;You&nbsp;for&nbsp;explain&nbsp;Squid&nbsp;and&nbsp;FTP.&lt;/div&gt;&lt;div&gt;1.&nbsp;Directive&nbsp;read_timeout&nbsp;work&nbsp;OK&lt;/div&gt;&lt;div&gt;2.&nbsp;I&nbsp;will&nbsp;sometime&nbsp;upgrade&nbsp;Squid&nbsp;to&nbsp;ver.&nbsp;3.5&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thank&nbsp;You&lt;/div&gt;&lt;div&gt;Ludek&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;p&gt;----------&nbsp;Původní&nbsp;zpráva&nbsp;----------&lt;br&gt;Od:&nbsp;Garri&nbsp;Djavadyan&nbsp;&lt;garryd@comnet.uz&gt;&lt;br&gt;Komu:&nbsp;squid-users@lists.squid-cache.org&lt;br&gt;Datum:&nbsp;23.&nbsp;11.&nbsp;2016&nbsp;7:58:09&lt;br&gt;Předmět:&nbsp;Re:&nbsp;[squid-users]&nbsp;FTP&nbsp;interrupted&lt;/p&gt;&lt;br&gt;&lt;blockquote&gt;On&nbsp;Wed,&nbsp;2016-11-23&nbsp;at&nbsp;07:17&nbsp;+0100,&nbsp;ludek_coufal&nbsp;wrote:&lt;br&gt;&gt;&nbsp;Hello&nbsp;Garri,&lt;br&gt;&gt;&nbsp;client&nbsp;FTP&nbsp;-&nbsp;Total&nbsp;Commander&nbsp;(I&nbsp;test&nbsp;WinSCP,&nbsp;FileZilla&nbsp;with&nbsp;same&lt;br&gt;&gt;&nbsp;result&nbsp;-&nbsp;after&nbsp;15&nbsp;min&nbsp;connection&nbsp;interrupted)&nbsp;with&nbsp;proxy&nbsp;server&nbsp;-&lt;br&gt;&gt;&nbsp;proxy&nbsp;server&nbsp;HTTP&nbsp;with&nbsp;FTP&nbsp;support:&lt;br&gt;&gt;&nbsp;part&nbsp;of&nbsp;squid.conf:&lt;br&gt;&gt;&nbsp;*********************************************************************&lt;br&gt;&gt;&nbsp;******************&lt;br&gt;&gt;&nbsp;acl&nbsp;SSL_ports&nbsp;port&nbsp;21&lt;br&gt;&gt;&nbsp;acl&nbsp;SSL_ports&nbsp;port&nbsp;1024-65535&lt;br&gt;&gt;&nbsp;acl&nbsp;SSL_ports&nbsp;port&nbsp;443&lt;br&gt;&gt;&nbsp;acl&nbsp;SSL_ports&nbsp;port&nbsp;8443&lt;br&gt;&gt;&nbsp;acl&nbsp;SSL_ports&nbsp;port&nbsp;6400&lt;br&gt;&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;80&nbsp;&nbsp;#&nbsp;http&lt;br&gt;&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;21&nbsp;&nbsp;#&nbsp;ftp&lt;br&gt;&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;443&nbsp;&nbsp;#&nbsp;https&lt;br&gt;&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;70&nbsp;&nbsp;#&nbsp;gopher&lt;br&gt;&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;210&nbsp;&nbsp;#&nbsp;wais&lt;br&gt;&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;1025-65535&nbsp;#&nbsp;unregistered&nbsp;ports&lt;br&gt;&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;280&nbsp;&nbsp;#&nbsp;http-mgmt&lt;br&gt;&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;488&nbsp;&nbsp;#&nbsp;gss-http&lt;br&gt;&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;591&nbsp;&nbsp;#&nbsp;filemaker&lt;br&gt;&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;777&nbsp;&nbsp;#&nbsp;multiling&nbsp;http&lt;br&gt;&gt;&nbsp;acl&nbsp;CONNECT&nbsp;method&nbsp;CONNECT&lt;br&gt;&gt;&nbsp;acl&nbsp;FTP&nbsp;proto&nbsp;FTP&lt;br&gt;&gt;&nbsp;always_direct&nbsp;allow&nbsp;FTP&lt;br&gt;&gt;&nbsp;&lt;br&gt;&gt;&nbsp;http_access&nbsp;deny&nbsp;!Safe_ports&lt;br&gt;&gt;&nbsp;#&nbsp;Deny&nbsp;CONNECT&nbsp;to&nbsp;other&nbsp;than&nbsp;secure&nbsp;SSL&nbsp;ports&lt;br&gt;&gt;&nbsp;http_access&nbsp;deny&nbsp;CONNECT&nbsp;!SSL_ports&lt;br&gt;&gt;&nbsp;#&nbsp;Only&nbsp;allow&nbsp;cachemgr&nbsp;access&nbsp;from&nbsp;localhost&lt;br&gt;&gt;&nbsp;http_access&nbsp;allow&nbsp;localhost&nbsp;manager&lt;br&gt;&gt;&nbsp;http_access&nbsp;deny&nbsp;manager&lt;br&gt;&gt;&nbsp;&lt;br&gt;&gt;&nbsp;###############&lt;br&gt;&gt;&nbsp;#&nbsp;http_access&nbsp;deny&nbsp;localnet&nbsp;!bandwidth_auth&lt;br&gt;&gt;&nbsp;###############&lt;br&gt;&gt;&nbsp;http_access&nbsp;allow&nbsp;localhost&lt;br&gt;&gt;&nbsp;&lt;br&gt;&gt;&nbsp;#&nbsp;And&nbsp;finally&nbsp;deny&nbsp;all&nbsp;other&nbsp;access&nbsp;to&nbsp;this&nbsp;proxy&lt;br&gt;&gt;&nbsp;http_access&nbsp;deny&nbsp;all&lt;br&gt;&gt;&nbsp;#&nbsp;Squid&nbsp;normally&nbsp;listens&nbsp;to&nbsp;port&nbsp;3128&lt;br&gt;&gt;&nbsp;#http_port&nbsp;3128&nbsp;transparent&lt;br&gt;&gt;&nbsp;http_port&nbsp;3128&lt;br&gt;&gt;&nbsp;ftp_port&nbsp;21&lt;br&gt;&gt;&nbsp;#&nbsp;Uncomment&nbsp;and&nbsp;adjust&nbsp;the&nbsp;following&nbsp;to&nbsp;add&nbsp;a&nbsp;disk&nbsp;cache&nbsp;directory.&lt;br&gt;&gt;&nbsp;#cache_dir&nbsp;ufs&nbsp;/var/log/squid/cache&nbsp;100&nbsp;16&nbsp;256&lt;br&gt;&gt;&nbsp;#&nbsp;Leave&nbsp;coredumps&nbsp;in&nbsp;the&nbsp;first&nbsp;cache&nbsp;dir&lt;br&gt;&gt;&nbsp;coredump_dir&nbsp;/var/log/squid/cache&lt;br&gt;&gt;&nbsp;#&lt;br&gt;&gt;&nbsp;#&nbsp;Add&nbsp;any&nbsp;of&nbsp;your&nbsp;own&nbsp;refresh_pattern&nbsp;entries&nbsp;above&nbsp;these.&lt;br&gt;&gt;&nbsp;#&lt;br&gt;&gt;&nbsp;refresh_pattern&nbsp;^ftp:&nbsp;&nbsp;1440&nbsp;20%&nbsp;10080&lt;br&gt;&gt;&nbsp;refresh_pattern&nbsp;^gopher:&nbsp;1440&nbsp;0%&nbsp;1440&lt;br&gt;&gt;&nbsp;refresh_pattern&nbsp;-i&nbsp;(/cgi-bin/|\?)&nbsp;0&nbsp;0%&nbsp;0&lt;br&gt;&gt;&nbsp;refresh_pattern&nbsp;.&nbsp;&nbsp;0&nbsp;20%&nbsp;4320&lt;br&gt;&gt;&nbsp;logfile_rotate&nbsp;2&lt;br&gt;&gt;&nbsp;*********************************************************************&lt;br&gt;&gt;&nbsp;****&lt;br&gt;&gt;&nbsp;When&nbsp;I&nbsp;add&nbsp;ftp_port&nbsp;21&nbsp;in&nbsp;squid.conf&nbsp;and&nbsp;proxy.reload&nbsp;I&nbsp;get&nbsp;this&lt;br&gt;&gt;&nbsp;message:&lt;br&gt;&gt;&nbsp;/etc/squid/squid.conf:129&nbsp;unrecognized:&nbsp;'ftp_port'&lt;br&gt;&gt;&nbsp;I&nbsp;found&nbsp;this:&nbsp;http://www.squid-cache.org/Doc/config/ftp_port/&lt;br&gt;&gt;&nbsp;Our&nbsp;version&nbsp;is&nbsp;&nbsp;Squid&nbsp;Cache&nbsp;ver.&nbsp;3.3.8&lt;br&gt;&lt;br&gt;Hi&nbsp;Ludek,&lt;br&gt;&lt;br&gt;With&nbsp;the&nbsp;above&nbsp;config,&nbsp;your&nbsp;FTP&nbsp;clients&nbsp;use&nbsp;CONNECT&nbsp;methods.&nbsp;Squid&lt;br&gt;simply&nbsp;tunnels&nbsp;connections&nbsp;from&nbsp;FTP&nbsp;client&nbsp;to&nbsp;FTP&nbsp;server.&nbsp;When&nbsp;you&lt;br&gt;upload&nbsp;a&nbsp;file&nbsp;over&nbsp;FTP&nbsp;data&nbsp;channel,&nbsp;FTP&nbsp;control&nbsp;channel&nbsp;is&nbsp;idle&nbsp;and&lt;br&gt;Squid&nbsp;terminates&nbsp;the&nbsp;control&nbsp;connection&nbsp;after&nbsp;15&nbsp;minutes&nbsp;[1]&nbsp;by&lt;br&gt;default.&nbsp;It&nbsp;is&nbsp;because&nbsp;Squid&nbsp;don't&nbsp;know&nbsp;about&nbsp;relations&nbsp;between&lt;br&gt;tunneled&nbsp;control&nbsp;channel&nbsp;and&nbsp;data&nbsp;channel.&nbsp;You&nbsp;can&nbsp;try&nbsp;to&nbsp;increase&lt;br&gt;default&nbsp;timeout.&nbsp;But&nbsp;more&nbsp;elegant&nbsp;solution&nbsp;is&nbsp;to&nbsp;use&nbsp;FTP&nbsp;relay&nbsp;function&lt;br&gt;(ftp_port).&lt;br&gt;&lt;br&gt;The&nbsp;ftp_port&nbsp;directive&nbsp;only&nbsp;available&nbsp;in&nbsp;Squid-3.5&nbsp;and&nbsp;above.&nbsp;You&lt;br&gt;should&nbsp;upgrade&nbsp;Squid&nbsp;to&nbsp;latest&nbsp;3.5.22&nbsp;as&nbsp;Eliezer&nbsp;already&nbsp;advised&nbsp;you.&lt;br&gt;&lt;br&gt;When&nbsp;you&nbsp;configure&nbsp;ftp_port,&nbsp;in&nbsp;Filezilla&nbsp;you&nbsp;should&nbsp;disable&lt;br&gt;connection-&gt;generic&nbsp;proxy&nbsp;and&nbsp;enable&nbsp;connection-&gt;ftp-&gt;ftp&nbsp;proxy&nbsp;with&lt;br&gt;following&nbsp;settings:&lt;br&gt;&lt;br&gt;Type:&nbsp;custom&lt;br&gt;---&lt;br&gt;USER&nbsp;%u@%h&lt;br&gt;PASS&nbsp;%p&lt;br&gt;---&lt;br&gt;Proxy&nbsp;host:&nbsp;Squid's&nbsp;IP&nbsp;adress&lt;br&gt;&lt;br&gt;&lt;br&gt;[1]&nbsp;http://www.squid-cache.org/Doc/config/read_timeout/&lt;br&gt;&lt;br&gt;&lt;br&gt;Garri&lt;br&gt;_______________________________________________&lt;br&gt;squid-users&nbsp;mailing&nbsp;list&lt;br&gt;squid-users@lists.squid-cache.org&lt;br&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/blockquote&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
