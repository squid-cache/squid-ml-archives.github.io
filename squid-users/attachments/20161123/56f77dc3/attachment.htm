<tt>
&lt;html&gt;&lt;body&gt;&lt;div&gt;Hello&nbsp;Garri,&lt;/div&gt;&lt;div&gt;client&nbsp;FTP&nbsp;-&nbsp;Total&nbsp;Commander&nbsp;(I&nbsp;test&nbsp;WinSCP,&nbsp;FileZilla&nbsp;with&nbsp;same&nbsp;result&nbsp;-&nbsp;after&nbsp;15&nbsp;min&nbsp;connection&nbsp;interrupted)&nbsp;with&nbsp;proxy&nbsp;server&nbsp;-&nbsp;proxy&nbsp;server&nbsp;HTTP&nbsp;with&nbsp;FTP&nbsp;support:&lt;/div&gt;&lt;div&gt;part&nbsp;of&nbsp;squid.conf:&lt;/div&gt;&lt;div&gt;***************************************************************************************&lt;/div&gt;&lt;div&gt;acl&nbsp;SSL_ports&nbsp;port&nbsp;21&lt;br&gt;acl&nbsp;SSL_ports&nbsp;port&nbsp;1024-65535&lt;/div&gt;&lt;div&gt;acl&nbsp;SSL_ports&nbsp;port&nbsp;443&lt;br&gt;acl&nbsp;SSL_ports&nbsp;port&nbsp;8443&lt;br&gt;acl&nbsp;SSL_ports&nbsp;port&nbsp;6400&lt;/div&gt;&lt;div&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;80&nbsp;&nbsp;#&nbsp;http&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;21&nbsp;&nbsp;#&nbsp;ftp&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;443&nbsp;&nbsp;#&nbsp;https&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;70&nbsp;&nbsp;#&nbsp;gopher&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;210&nbsp;&nbsp;#&nbsp;wais&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;1025-65535&nbsp;#&nbsp;unregistered&nbsp;ports&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;280&nbsp;&nbsp;#&nbsp;http-mgmt&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;488&nbsp;&nbsp;#&nbsp;gss-http&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;591&nbsp;&nbsp;#&nbsp;filemaker&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;777&nbsp;&nbsp;#&nbsp;multiling&nbsp;http&lt;br&gt;&lt;/div&gt;&lt;div&gt;acl&nbsp;CONNECT&nbsp;method&nbsp;CONNECT&lt;/div&gt;&lt;div&gt;acl&nbsp;FTP&nbsp;proto&nbsp;FTP&lt;br&gt;always_direct&nbsp;allow&nbsp;FTP&lt;/div&gt;&lt;div&gt;&lt;br&gt;http_access&nbsp;deny&nbsp;!Safe_ports&lt;/div&gt;&lt;div&gt;#&nbsp;Deny&nbsp;CONNECT&nbsp;to&nbsp;other&nbsp;than&nbsp;secure&nbsp;SSL&nbsp;ports&lt;br&gt;http_access&nbsp;deny&nbsp;CONNECT&nbsp;!SSL_ports&lt;/div&gt;&lt;div&gt;#&nbsp;Only&nbsp;allow&nbsp;cachemgr&nbsp;access&nbsp;from&nbsp;localhost&lt;br&gt;http_access&nbsp;allow&nbsp;localhost&nbsp;manager&lt;br&gt;http_access&nbsp;deny&nbsp;manager&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;###############&lt;br&gt;#&nbsp;http_access&nbsp;deny&nbsp;localnet&nbsp;!bandwidth_auth&lt;br&gt;###############&lt;/div&gt;&lt;div&gt;http_access&nbsp;allow&nbsp;localhost&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#&nbsp;And&nbsp;finally&nbsp;deny&nbsp;all&nbsp;other&nbsp;access&nbsp;to&nbsp;this&nbsp;proxy&lt;br&gt;http_access&nbsp;deny&nbsp;all&lt;/div&gt;&lt;div&gt;#&nbsp;Squid&nbsp;normally&nbsp;listens&nbsp;to&nbsp;port&nbsp;3128&lt;br&gt;#http_port&nbsp;3128&nbsp;transparent&lt;br&gt;http_port&nbsp;3128&lt;/div&gt;&lt;div&gt;ftp_port&nbsp;21&lt;/div&gt;&lt;div&gt;#&nbsp;Uncomment&nbsp;and&nbsp;adjust&nbsp;the&nbsp;following&nbsp;to&nbsp;add&nbsp;a&nbsp;disk&nbsp;cache&nbsp;directory.&lt;br&gt;#cache_dir&nbsp;ufs&nbsp;/var/log/squid/cache&nbsp;100&nbsp;16&nbsp;256&lt;/div&gt;&lt;div&gt;#&nbsp;Leave&nbsp;coredumps&nbsp;in&nbsp;the&nbsp;first&nbsp;cache&nbsp;dir&lt;br&gt;coredump_dir&nbsp;/var/log/squid/cache&lt;/div&gt;&lt;div&gt;#&lt;br&gt;#&nbsp;Add&nbsp;any&nbsp;of&nbsp;your&nbsp;own&nbsp;refresh_pattern&nbsp;entries&nbsp;above&nbsp;these.&lt;br&gt;#&lt;br&gt;refresh_pattern&nbsp;^ftp:&nbsp;&nbsp;1440&nbsp;20%&nbsp;10080&lt;br&gt;refresh_pattern&nbsp;^gopher:&nbsp;1440&nbsp;0%&nbsp;1440&lt;br&gt;refresh_pattern&nbsp;-i&nbsp;(/cgi-bin/|\?)&nbsp;0&nbsp;0%&nbsp;0&lt;br&gt;refresh_pattern&nbsp;.&nbsp;&nbsp;0&nbsp;20%&nbsp;4320&lt;/div&gt;&lt;div&gt;logfile_rotate&nbsp;2&nbsp;&lt;/div&gt;&lt;div&gt;*************************************************************************&lt;/div&gt;&lt;div&gt;When&nbsp;I&nbsp;add&nbsp;ftp_port&nbsp;21&nbsp;in&nbsp;squid.conf&nbsp;and&nbsp;proxy.reload&nbsp;I&nbsp;get&nbsp;this&nbsp;message:&lt;/div&gt;&lt;div&gt;/etc/squid/squid.conf:129&nbsp;unrecognized:&nbsp;'ftp_port'&lt;/div&gt;&lt;div&gt;I&nbsp;found&nbsp;this:&nbsp;http://www.squid-cache.org/Doc/config/ftp_port/&lt;/div&gt;&lt;div&gt;Our&nbsp;version&nbsp;is&nbsp;&nbsp;Squid&nbsp;Cache&nbsp;ver.&nbsp;3.3.8&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thank&nbsp;You&lt;/div&gt;&lt;div&gt;Ludek&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;p&gt;----------&nbsp;Původní&nbsp;zpráva&nbsp;----------&lt;br&gt;Od:&nbsp;Garri&nbsp;Djavadyan&nbsp;&lt;garryd@comnet.uz&gt;&lt;br&gt;Komu:&nbsp;squid-users@lists.squid-cache.org&lt;br&gt;Datum:&nbsp;22.&nbsp;11.&nbsp;2016&nbsp;19:18:35&lt;br&gt;Předmět:&nbsp;Re:&nbsp;[squid-users]&nbsp;FTP&nbsp;interrupted&lt;/p&gt;&lt;br&gt;&lt;blockquote&gt;On&nbsp;2016-11-22&nbsp;22:24,&nbsp;Garri&nbsp;Djavadyan&nbsp;wrote:&lt;br&gt;&gt;&nbsp;On&nbsp;2016-11-22&nbsp;17:05,&nbsp;ludek_coufal&nbsp;wrote:&lt;br&gt;&gt;&gt;&nbsp;Hello,&lt;br&gt;&gt;&gt;&nbsp;Squid&nbsp;Cache&nbsp;ver.&nbsp;3.3.8&nbsp;on&nbsp;CentOs&nbsp;Linux&nbsp;7.2.1511&lt;br&gt;&gt;&gt;&nbsp;&lt;br&gt;&gt;&gt;&nbsp;FTP&nbsp;connection&nbsp;from&nbsp;local&nbsp;net&nbsp;over&nbsp;linux&nbsp;server&nbsp;CentOs&nbsp;firewall&nbsp;with&lt;br&gt;&gt;&gt;&nbsp;Squid&nbsp;proxy&nbsp;to&nbsp;internet&nbsp;FTP&nbsp;server&nbsp;is&nbsp;interrupted&nbsp;every&nbsp;15&nbsp;min&nbsp;(900&lt;br&gt;&gt;&gt;&nbsp;sec).&lt;br&gt;&gt;&gt;&nbsp;Large&nbsp;file&nbsp;upload&nbsp;is&nbsp;interrupted.&lt;br&gt;&gt;&gt;&nbsp;Direct&nbsp;connection&nbsp;without&nbsp;Squid&nbsp;proxy&nbsp;work&nbsp;OK.&lt;br&gt;&gt;&nbsp;&lt;br&gt;&gt;&nbsp;Hi,&lt;br&gt;&gt;&nbsp;&lt;br&gt;&gt;&nbsp;The&nbsp;issue&nbsp;may&nbsp;occur,&nbsp;if&nbsp;FTP&nbsp;client&nbsp;uses&nbsp;CONNECT&nbsp;method&nbsp;to&nbsp;connect&nbsp;to&lt;br&gt;&gt;&nbsp;remote&nbsp;FTP&nbsp;servers.&nbsp;You&nbsp;can&nbsp;find&nbsp;details&nbsp;in&nbsp;the&nbsp;following&nbsp;thread:&lt;br&gt;&gt;&nbsp;&lt;br&gt;&gt;&nbsp;http://www.squid-cache.org/mail-archive/squid-users/200609/0111.html&lt;br&gt;&lt;br&gt;If&nbsp;your&nbsp;FTP&nbsp;client&nbsp;connects&nbsp;to&nbsp;Squid's&nbsp;http_port&nbsp;then&nbsp;it&nbsp;uses&nbsp;CONNECT&nbsp;&lt;br&gt;method.&nbsp;To&nbsp;solve&nbsp;the&nbsp;problem&nbsp;try&nbsp;to&nbsp;use&nbsp;ftp_port&nbsp;and&nbsp;disable&nbsp;proxy&nbsp;&lt;br&gt;settings&nbsp;on&nbsp;FTP&nbsp;client.&lt;br&gt;For&nbsp;example:&lt;br&gt;&lt;br&gt;1.&nbsp;Configure&nbsp;ftp_port.&lt;br&gt;#&nbsp;diff&nbsp;etc/squid.conf.default&nbsp;etc/squid.conf&lt;br&gt;59a60&lt;br&gt;&gt;&nbsp;ftp_port&nbsp;21&lt;br&gt;&lt;br&gt;2.&nbsp;Connect&nbsp;from&nbsp;FTP&nbsp;client,&nbsp;where:&lt;br&gt;${squid_ip}&nbsp;-&nbsp;Squid's&nbsp;IP&nbsp;address&lt;br&gt;${squid_ftp_port}&nbsp;-&nbsp;configured&nbsp;ftp_port&lt;br&gt;${username}&nbsp;-&nbsp;username&nbsp;on&nbsp;remote&nbsp;FTP&nbsp;server&lt;br&gt;${ftp_server}&nbsp;-&nbsp;remote&nbsp;FTP&nbsp;server&nbsp;name/IP&lt;br&gt;${password}&nbsp;-&nbsp;password&nbsp;for&nbsp;remote&nbsp;FTP&nbsp;server&lt;br&gt;&lt;br&gt;$&nbsp;ftp&nbsp;${squid_ip}&nbsp;${squid_ftp_port}&lt;br&gt;Connected&nbsp;to&nbsp;localhost.localdomain.&lt;br&gt;220&nbsp;Service&nbsp;ready&lt;br&gt;Name&nbsp;(localhost:garry):&nbsp;${username}@${ftp_server}&lt;br&gt;530&nbsp;Must&nbsp;login&nbsp;first&lt;br&gt;530&nbsp;Must&nbsp;login&nbsp;first&lt;br&gt;SSL&nbsp;not&nbsp;available&lt;br&gt;331&nbsp;Please&nbsp;specify&nbsp;the&nbsp;password.&lt;br&gt;Password:&nbsp;${password}&lt;br&gt;230&nbsp;Login&nbsp;successful.&lt;br&gt;Remote&nbsp;system&nbsp;type&nbsp;is&nbsp;UNIX.&lt;br&gt;Using&nbsp;binary&nbsp;mode&nbsp;to&nbsp;transfer&nbsp;files.&lt;br&gt;ftp&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;Garri&lt;br&gt;_______________________________________________&lt;br&gt;squid-users&nbsp;mailing&nbsp;list&lt;br&gt;squid-users@lists.squid-cache.org&lt;br&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/blockquote&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
