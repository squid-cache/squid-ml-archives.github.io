<tt>
&lt;html&gt;<br>
&lt;head&gt;<br>
&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=Windows-1252&quot;&gt;<br>
&lt;style&nbsp;type=&quot;text/css&quot;&nbsp;style=&quot;display:none;&quot;&gt;&lt;!--&nbsp;P&nbsp;{margin-top:0;margin-bottom:0;}&nbsp;--&gt;&lt;/style&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;dir=&quot;ltr&quot;&gt;<br>
&lt;div&nbsp;id=&quot;divtagdefaultwrapper&quot;&nbsp;dir=&quot;ltr&quot;&nbsp;style=&quot;font-size:12pt;&nbsp;color:#000000;&nbsp;font-family:Calibri,Arial,Helvetica,sans-serif&quot;&gt;<br>
&lt;p&gt;&lt;br&gt;<br>
&lt;/p&gt;<br>
&lt;meta&nbsp;content=&quot;text/html;&nbsp;charset=UTF-8&quot;&gt;<br>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;<br>
&lt;div&nbsp;id=&quot;x_divtagdefaultwrapper&quot;&nbsp;dir=&quot;ltr&quot;&nbsp;style=&quot;font-size:12pt;&nbsp;color:#000000;&nbsp;font-family:Calibri,Arial,Helvetica,sans-serif&quot;&gt;<br>
&lt;p&gt;Hello&nbsp;Eliezer&nbsp;and&nbsp;thanks&nbsp;again.&lt;/p&gt;<br>
&lt;p&gt;&lt;br&gt;<br>
&lt;/p&gt;<br>
&lt;p&gt;I&nbsp;ran&nbsp;the&nbsp;script&nbsp;with&nbsp;the&nbsp;tproxy&nbsp;argument.&lt;/p&gt;<br>
&lt;p&gt;&lt;br&gt;<br>
&lt;/p&gt;<br>
&lt;p&gt;Tried&nbsp;to&nbsp;reconnect&nbsp;skype&nbsp;for&nbsp;business...&nbsp;&lt;/p&gt;<br>
&lt;p&gt;&lt;br&gt;<br>
&lt;/p&gt;<br>
&lt;p&gt;After&nbsp;about&nbsp;a&nbsp;3&nbsp;min&nbsp;wait,&nbsp;a&nbsp;pop&nbsp;up&nbsp;saying&nbsp;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-size:&nbsp;10pt;&quot;&gt;<br>
&quot;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-family:&nbsp;Bitter,&nbsp;sans-serif;&nbsp;font-weight:&nbsp;inherit;&nbsp;font-size:&nbsp;10pt;&quot;&gt;Skype&nbsp;for&nbsp;Business&nbsp;couldn’t&nbsp;find&nbsp;a&nbsp;skype&nbsp;for&nbsp;business&nbsp;server&lt;/span&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-family:&nbsp;Bitter,&nbsp;sans-serif;&nbsp;font-size:&nbsp;10pt;&nbsp;font-weight:&nbsp;inherit;&quot;&gt;&quot;&lt;/span&gt;&lt;span&nbsp;style=&quot;font-weight:&nbsp;inherit;&nbsp;font-size:&nbsp;10pt;&nbsp;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;&nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;font-weight:&nbsp;inherit;&nbsp;font-size:&nbsp;12pt;&quot;&gt;&nbsp;and&nbsp;access<br>
&nbsp;log&nbsp;shows:&nbsp;&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&gt;&lt;br&gt;<br>
&lt;/p&gt;<br>
&lt;div&gt;1481061269.006&nbsp;&nbsp;&nbsp;&nbsp;400&nbsp;10.0.0.38&nbsp;TCP_MISS/200&nbsp;1068&nbsp;GET&nbsp;http://lyncdiscover.solcv.com/?&nbsp;-&nbsp;ORIGINAL_DST/132.245.1.28&nbsp;application/vnd.microsoft.rtc.autodiscover&#43;xml&lt;/div&gt;<br>
&lt;div&gt;1481061269.270&nbsp;&nbsp;&nbsp;&nbsp;667&nbsp;10.0.0.38&nbsp;TAG_NONE/200&nbsp;0&nbsp;CONNECT&nbsp;132.245.1.28:443&nbsp;-&nbsp;HIER_NONE/-&nbsp;-&lt;/div&gt;<br>
&lt;div&gt;1481061269.270&nbsp;&nbsp;&nbsp;&nbsp;665&nbsp;10.0.0.38&nbsp;TCP_TUNNEL/200&nbsp;5568&nbsp;CONNECT&nbsp;lyncdiscover.solcv.com:443&nbsp;-&nbsp;ORIGINAL_DST/132.245.1.28&nbsp;-&lt;/div&gt;<br>
&lt;div&gt;1481061269.770&nbsp;&nbsp;&nbsp;&nbsp;596&nbsp;10.0.0.38&nbsp;TAG_NONE/200&nbsp;0&nbsp;CONNECT&nbsp;52.112.64.14:443&nbsp;-&nbsp;HIER_NONE/-&nbsp;-&lt;/div&gt;<br>
&lt;div&gt;1481061269.770&nbsp;&nbsp;&nbsp;&nbsp;594&nbsp;10.0.0.38&nbsp;TCP_TUNNEL/200&nbsp;6981&nbsp;CONNECT&nbsp;webdir0a.online.lync.com:443&nbsp;-&nbsp;ORIGINAL_DST/52.112.64.14&nbsp;-&lt;/div&gt;<br>
&lt;div&gt;1481061270.679&nbsp;&nbsp;&nbsp;&nbsp;897&nbsp;10.0.0.38&nbsp;TAG_NONE/200&nbsp;0&nbsp;CONNECT&nbsp;52.112.64.14:443&nbsp;-&nbsp;HIER_NONE/-&nbsp;-&lt;/div&gt;<br>
&lt;div&gt;1481061270.679&nbsp;&nbsp;&nbsp;&nbsp;895&nbsp;10.0.0.38&nbsp;TCP_TUNNEL/200&nbsp;7733&nbsp;CONNECT&nbsp;webdir0a.online.lync.com:443&nbsp;-&nbsp;ORIGINAL_DST/52.112.64.14&nbsp;-&lt;/div&gt;<br>
&lt;div&gt;1481061272.178&nbsp;&nbsp;&nbsp;&nbsp;841&nbsp;10.0.0.38&nbsp;TAG_NONE/200&nbsp;0&nbsp;CONNECT&nbsp;23.100.120.65:443&nbsp;-&nbsp;HIER_NONE/-&nbsp;-&lt;/div&gt;<br>
&lt;div&gt;1481061272.178&nbsp;&nbsp;&nbsp;&nbsp;840&nbsp;10.0.0.38&nbsp;TCP_TUNNEL/200&nbsp;20539&nbsp;CONNECT&nbsp;login.microsoftonline.com:443&nbsp;-&nbsp;ORIGINAL_DST/23.100.120.65&nbsp;-&lt;/div&gt;<br>
&lt;div&gt;1481061273.713&nbsp;&nbsp;&nbsp;&nbsp;641&nbsp;10.0.0.38&nbsp;TAG_NONE/200&nbsp;0&nbsp;CONNECT&nbsp;52.112.64.14:443&nbsp;-&nbsp;HIER_NONE/-&nbsp;-&lt;/div&gt;<br>
&lt;div&gt;1481061273.713&nbsp;&nbsp;&nbsp;&nbsp;640&nbsp;10.0.0.38&nbsp;TCP_TUNNEL/200&nbsp;8037&nbsp;CONNECT&nbsp;webdir0a.online.lync.com:443&nbsp;-&nbsp;ORIGINAL_DST/52.112.64.14&nbsp;-&lt;/div&gt;<br>
&lt;div&gt;1481061273.751&nbsp;&nbsp;&nbsp;3054&nbsp;10.0.0.38&nbsp;TAG_NONE/200&nbsp;0&nbsp;CONNECT&nbsp;52.112.64.14:443&nbsp;-&nbsp;HIER_NONE/-&nbsp;-&lt;/div&gt;<br>
&lt;div&gt;1481061273.751&nbsp;&nbsp;&nbsp;3052&nbsp;10.0.0.38&nbsp;TCP_TUNNEL/200&nbsp;24458&nbsp;CONNECT&nbsp;webdir0a.online.lync.com:443&nbsp;-&nbsp;ORIGINAL_DST/52.112.64.14&nbsp;-&lt;/div&gt;<br>
&lt;div&gt;1481061273.751&nbsp;&nbsp;&nbsp;1544&nbsp;10.0.0.38&nbsp;TAG_NONE/200&nbsp;0&nbsp;CONNECT&nbsp;52.112.64.14:443&nbsp;-&nbsp;HIER_NONE/-&nbsp;-&lt;/div&gt;<br>
&lt;div&gt;1481061273.751&nbsp;&nbsp;&nbsp;1543&nbsp;10.0.0.38&nbsp;TCP_TUNNEL/200&nbsp;11653&nbsp;CONNECT&nbsp;webdir0a.online.lync.com:443&nbsp;-&nbsp;ORIGINAL_DST/52.112.64.14&nbsp;-&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;so&nbsp;I&nbsp;added&nbsp;more&nbsp;ip&nbsp;ranges&nbsp;to&nbsp;the&nbsp;cidr-to-bypass.txt&nbsp;and&nbsp;ran&nbsp;the&nbsp;script&nbsp;again&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;1481063243.370&nbsp;&nbsp;&nbsp;&nbsp;371&nbsp;10.0.0.38&nbsp;TCP_MISS/200&nbsp;1068&nbsp;GET&nbsp;http://lyncdiscover.solcv.com/?&nbsp;-&nbsp;ORIGINAL_DST/134.170.113.210&nbsp;application/vnd.microsoft.rtc.autodiscover&#43;xml&lt;/div&gt;<br>
&lt;div&gt;1481063278.271&nbsp;&nbsp;74233&nbsp;10.0.0.38&nbsp;TAG_NONE/200&nbsp;0&nbsp;CONNECT&nbsp;104.208.31.113:443&nbsp;-&nbsp;HIER_NONE/-&nbsp;-&lt;/div&gt;<br>
&lt;div&gt;1481063278.271&nbsp;&nbsp;74231&nbsp;10.0.0.38&nbsp;TCP_TUNNEL/200&nbsp;6746&nbsp;CONNECT&nbsp;pipe.skype.com:443&nbsp;-&nbsp;ORIGINAL_DST/104.208.31.113&nbsp;-&lt;/div&gt;<br>
&lt;div&gt;1481063344.143&nbsp;&nbsp;60720&nbsp;10.0.0.38&nbsp;TAG_NONE/200&nbsp;0&nbsp;CONNECT&nbsp;104.208.31.113:443&nbsp;-&nbsp;HIER_NONE/-&nbsp;-&lt;/div&gt;<br>
&lt;div&gt;1481063344.143&nbsp;&nbsp;60719&nbsp;10.0.0.38&nbsp;TCP_TUNNEL/200&nbsp;6389&nbsp;CONNECT&nbsp;pipe.skype.com:443&nbsp;-&nbsp;ORIGINAL_DST/104.208.31.113&nbsp;-&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;a&nbsp;new&nbsp;set&nbsp;showed&nbsp;up...&lt;/div&gt;<br>
&lt;span&nbsp;id=&quot;x_ms-rterangepaste-end&quot;&gt;&lt;/span&gt;<br>
&lt;div&nbsp;id=&quot;x_divtagdefaultwrapper&quot;&nbsp;dir=&quot;ltr&quot;&nbsp;style=&quot;font-size:12pt;&nbsp;color:#000000;&nbsp;font-family:Calibri,Arial,Helvetica,sans-serif&quot;&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;<br>
what&nbsp;more&nbsp;can&nbsp;we&nbsp;do?&lt;/div&gt;<br>
&lt;div&nbsp;id=&quot;x_divtagdefaultwrapper&quot;&nbsp;dir=&quot;ltr&quot;&nbsp;style=&quot;font-size:12pt;&nbsp;color:#000000;&nbsp;font-family:Calibri,Arial,Helvetica,sans-serif&quot;&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;id=&quot;x_divtagdefaultwrapper&quot;&nbsp;dir=&quot;ltr&quot;&nbsp;style=&quot;font-size:12pt;&nbsp;color:#000000;&nbsp;font-family:Calibri,Arial,Helvetica,sans-serif&quot;&gt;<br>
keep&nbsp;adding&nbsp;ip&nbsp;ranges?&lt;/div&gt;<br>
&lt;div&nbsp;id=&quot;x_divtagdefaultwrapper&quot;&nbsp;dir=&quot;ltr&quot;&nbsp;style=&quot;font-size:12pt;&nbsp;color:#000000;&nbsp;font-family:Calibri,Arial,Helvetica,sans-serif&quot;&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;id=&quot;x_divtagdefaultwrapper&quot;&nbsp;dir=&quot;ltr&quot;&nbsp;style=&quot;font-size:12pt;&nbsp;color:#000000;&nbsp;font-family:Calibri,Arial,Helvetica,sans-serif&quot;&gt;<br>
thanks&lt;br&gt;<br>
&lt;p&gt;&lt;/p&gt;<br>
&lt;p&gt;&lt;br&gt;<br>
&lt;/p&gt;<br>
&lt;div&nbsp;id=&quot;x_Signature&quot;&gt;<br>
&lt;div&nbsp;id=&quot;x_divtagdefaultwrapper&quot;&nbsp;style=&quot;font-size:12pt;&nbsp;color:#000000;&nbsp;background-color:#FFFFFF;&nbsp;font-family:Calibri,Arial,Helvetica,sans-serif&quot;&gt;<br>
&lt;img&nbsp;class=&quot;&quot;&nbsp;style=&quot;font-family:&nbsp;Calibri,&nbsp;Arial,&nbsp;Helvetica,&nbsp;sans-serif;&nbsp;font-size:&nbsp;16px;&nbsp;margin:&nbsp;5px;&nbsp;background-color:&nbsp;rgb(255,&nbsp;255,&nbsp;255);&nbsp;user-select:&nbsp;none;&quot;&nbsp;src=&quot;https://encrypted-tbn1.gstatic.com/images?q=tbn:ANd9GcQfU2bXCBPGhd5da40t2NysagP5_TdzOv6NOC14r3PXrn5b8k8cog&quot;&gt;&lt;span&nbsp;style=&quot;font-family:Calibri,Arial,Helvetica,sans-serif;&nbsp;font-size:16px;&nbsp;background-color:rgb(255,255,255)&quot;&gt;&nbsp;&lt;/span&gt;&lt;font&nbsp;color=&quot;#008000&quot;&nbsp;style=&quot;font-family:Calibri,Arial,Helvetica,sans-serif;&nbsp;font-size:16px;&nbsp;background-color:rgb(255,255,255)&quot;&gt;&lt;em&gt;&lt;strong&gt;&nbsp;Piensa<br>
&nbsp;en&nbsp;el&nbsp;medio&nbsp;ambiente&nbsp;antes&nbsp;de&nbsp;imprimir&nbsp;este&nbsp;email.&lt;/strong&gt;&lt;/em&gt;&lt;/font&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;hr&nbsp;tabindex=&quot;-1&quot;&nbsp;style=&quot;display:inline-block;&nbsp;width:98%&quot;&gt;<br>
&lt;div&nbsp;id=&quot;x_divRplyFwdMsg&quot;&nbsp;dir=&quot;ltr&quot;&gt;&lt;font&nbsp;face=&quot;Calibri,&nbsp;sans-serif&quot;&nbsp;color=&quot;#000000&quot;&nbsp;style=&quot;font-size:11pt&quot;&gt;&lt;b&gt;From:&lt;/b&gt;&nbsp;Eliezer&nbsp;Croitoru&nbsp;&lt;eliezer@ngtech.co.il&gt;&lt;br&gt;<br>
&lt;b&gt;Sent:&lt;/b&gt;&nbsp;Tuesday,&nbsp;December&nbsp;6,&nbsp;2016&nbsp;4:36:56&nbsp;PM&lt;br&gt;<br>
&lt;b&gt;To:&lt;/b&gt;&nbsp;Sameh&nbsp;Onaissi&lt;br&gt;<br>
&lt;b&gt;Cc:&lt;/b&gt;&nbsp;'Amos&nbsp;Jeffries';&nbsp;squid-users@lists.squid-cache.org&lt;br&gt;<br>
&lt;b&gt;Subject:&lt;/b&gt;&nbsp;RE:&nbsp;[squid-users]&nbsp;Skype&nbsp;for&nbsp;Business&nbsp;behind&nbsp;a&nbsp;transparent&nbsp;squid&nbsp;(TProxy)&nbsp;HTTP/S&lt;/font&gt;<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;font&nbsp;size=&quot;2&quot;&gt;&lt;span&nbsp;style=&quot;font-size:10pt&quot;&gt;<br>
&lt;div&nbsp;class=&quot;PlainText&quot;&gt;Try&nbsp;the&nbsp;next&nbsp;script:&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://gist.github.com/elico/a54c2c8f8e1a2407b42210896b960f4b&quot;&nbsp;id=&quot;LPlnk273968&quot;&nbsp;previewremoved=&quot;true&quot;&gt;https://gist.github.com/elico/a54c2c8f8e1a2407b42210896b960f4b&lt;/a&gt;<br>
&lt;div&nbsp;id=&quot;LPBorder_GT_14810628504760.8225681429369067&quot;&nbsp;style=&quot;margin-bottom:20px;&nbsp;overflow:auto;&nbsp;width:100%;&nbsp;text-indent:0px&quot;&gt;<br>
&lt;table&nbsp;id=&quot;LPContainer_14810628504660.7446787752577129&quot;&nbsp;cellspacing=&quot;0&quot;&nbsp;style=&quot;width:90%;&nbsp;background-color:rgb(255,255,255);&nbsp;overflow:auto;&nbsp;padding-top:20px;&nbsp;padding-bottom:20px;&nbsp;margin-top:20px;&nbsp;border-top:1px&nbsp;dotted&nbsp;rgb(200,200,200);&nbsp;border-bottom:1px&nbsp;dotted&nbsp;rgb(200,200,200)&quot;&gt;<br>
&lt;tbody&gt;<br>
&lt;tr&nbsp;valign=&quot;top&quot;&nbsp;style=&quot;border-spacing:0px&quot;&gt;<br>
&lt;td&nbsp;id=&quot;ImageCell_14810628504690.014656199523058078&quot;&nbsp;colspan=&quot;1&quot;&nbsp;style=&quot;width:250px;&nbsp;display:table-cell;&nbsp;padding-right:20px&quot;&gt;<br>
&lt;div&nbsp;id=&quot;LPImageContainer_14810628504700.6632045022411099&quot;&nbsp;style=&quot;background-color:rgb(255,255,255);&nbsp;height:250px;&nbsp;margin:auto;&nbsp;display:table;&nbsp;width:250px&quot;&gt;<br>
&lt;a&nbsp;id=&quot;LPImageAnchor_14810628504710.6671165442983282&quot;&nbsp;href=&quot;https://gist.github.com/elico/a54c2c8f8e1a2407b42210896b960f4b&quot;&nbsp;target=&quot;_blank&quot;&nbsp;style=&quot;display:table-cell;&nbsp;text-align:center&quot;&gt;&lt;img&nbsp;id=&quot;LPThumbnailImageID_14810628504710.7887906178523953&quot;&nbsp;width=&quot;250&quot;&nbsp;height=&quot;250&quot;&nbsp;style=&quot;display:inline-block;&nbsp;max-width:250px;&nbsp;max-height:250px;&nbsp;height:250px;&nbsp;width:250px;&nbsp;border-width:0px;&nbsp;vertical-align:bottom&quot;&nbsp;src=&quot;https://avatars1.githubusercontent.com/u/1786800?v=3&amp;s=400&quot;&gt;&lt;/a&gt;&lt;/div&gt;<br>
&lt;/td&gt;<br>
&lt;td&nbsp;id=&quot;TextCell_14810628504720.43586649826761903&quot;&nbsp;colspan=&quot;2&quot;&nbsp;style=&quot;vertical-align:&nbsp;top;&nbsp;padding:&nbsp;0px;&nbsp;display:&nbsp;table-cell;&nbsp;position:&nbsp;relative;&quot;&gt;<br>
&lt;div&nbsp;id=&quot;LPRemovePreviewContainer_14810628504730.7141174157237569&quot;&gt;&lt;/div&gt;<br>
&lt;div&nbsp;id=&quot;LPTitle_14810628504730.3240138338158447&quot;&nbsp;style=&quot;top:0px;&nbsp;color:rgb(0,120,215);&nbsp;font-weight:normal;&nbsp;font-size:21px;&nbsp;font-family:wf_segoe-ui_light,&quot;Segoe&nbsp;UI&nbsp;Light&quot;,&quot;Segoe&nbsp;WP&nbsp;Light&quot;,&quot;Segoe&nbsp;UI&quot;,&quot;Segoe&nbsp;WP&quot;,Tahoma,Arial,sans-serif;&nbsp;line-height:21px&quot;&gt;<br>
&lt;a&nbsp;id=&quot;LPUrlAnchor_14810628504740.2064126283733443&quot;&nbsp;href=&quot;https://gist.github.com/elico/a54c2c8f8e1a2407b42210896b960f4b&quot;&nbsp;target=&quot;_blank&quot;&nbsp;style=&quot;text-decoration:none&quot;&gt;bypass&nbsp;squid&nbsp;interception&nbsp;for&nbsp;skype&lt;/a&gt;&lt;/div&gt;<br>
&lt;div&nbsp;id=&quot;LPMetadata_14810628504740.9264634574728159&quot;&nbsp;style=&quot;margin:10px&nbsp;0px&nbsp;16px;&nbsp;color:rgb(102,102,102);&nbsp;font-weight:normal;&nbsp;font-family:wf_segoe-ui_normal,&quot;Segoe&nbsp;UI&quot;,&quot;Segoe&nbsp;WP&quot;,Tahoma,Arial,sans-serif;&nbsp;font-size:14px;&nbsp;line-height:14px&quot;&gt;<br>
gist.github.com&lt;/div&gt;<br>
&lt;div&nbsp;id=&quot;LPDescription_14810628504750.5332242304904289&quot;&nbsp;style=&quot;display:block;&nbsp;color:rgb(102,102,102);&nbsp;font-weight:normal;&nbsp;font-family:wf_segoe-ui_normal,&quot;Segoe&nbsp;UI&quot;,&quot;Segoe&nbsp;WP&quot;,Tahoma,Arial,sans-serif;&nbsp;font-size:14px;&nbsp;line-height:20px;&nbsp;max-height:100px;&nbsp;overflow:hidden&quot;&gt;<br>
bypass&nbsp;squid&nbsp;interception&nbsp;for&nbsp;skype&lt;/div&gt;<br>
&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;/tbody&gt;<br>
&lt;/table&gt;<br>
&lt;/div&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
It&nbsp;has&nbsp;two&nbsp;modes:&nbsp;regular&nbsp;and&nbsp;tproxy.&lt;br&gt;<br>
In&nbsp;your&nbsp;case&nbsp;you&nbsp;should&nbsp;run&nbsp;the&nbsp;script&nbsp;with:&lt;br&gt;<br>
$&nbsp;bypass-skype-cidr.sh&nbsp;tproxy&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;tproxy&nbsp;flag&nbsp;should&nbsp;do&nbsp;the&nbsp;trick&nbsp;for&nbsp;you.&lt;br&gt;<br>
&lt;br&gt;<br>
Let&nbsp;me&nbsp;know&nbsp;if&nbsp;it&nbsp;works&nbsp;for&nbsp;you.&lt;br&gt;<br>
&lt;br&gt;<br>
Eliezer&lt;br&gt;<br>
&lt;br&gt;<br>
----&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://ngtech.co.il/lmgtfy/&quot;&nbsp;id=&quot;LPlnk505784&quot;&nbsp;previewremoved=&quot;true&quot;&gt;http://ngtech.co.il/lmgtfy/&lt;/a&gt;&lt;br&gt;<br>
Linux&nbsp;System&nbsp;Administrator&lt;br&gt;<br>
Mobile:&nbsp;&#43;972-5-28704261&lt;br&gt;<br>
Email:&nbsp;eliezer@ngtech.co.il&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
From:&nbsp;Sameh&nbsp;Onaissi&nbsp;[&lt;a&nbsp;href=&quot;mailto:sameh.onaissi@solcv.com&quot;&gt;mailto:sameh.onaissi@solcv.com&lt;/a&gt;]<br>
&lt;br&gt;<br>
Sent:&nbsp;Tuesday,&nbsp;December&nbsp;6,&nbsp;2016&nbsp;9:24&nbsp;PM&lt;br&gt;<br>
To:&nbsp;Eliezer&nbsp;Croitoru&nbsp;&lt;eliezer@ngtech.co.il&gt;&lt;br&gt;<br>
Cc:&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;squid3@treenet.co.nz&gt;;&nbsp;squid-users@lists.squid-cache.org&lt;br&gt;<br>
Subject:&nbsp;Re:&nbsp;[squid-users]&nbsp;Skype&nbsp;for&nbsp;Business&nbsp;behind&nbsp;a&nbsp;transparent&nbsp;squid&nbsp;(TProxy)&nbsp;HTTP/S&lt;br&gt;<br>
&lt;br&gt;<br>
Yes&nbsp;please,&nbsp;I&nbsp;would&nbsp;appreciate&nbsp;help&nbsp;with&nbsp;that&nbsp;script.&nbsp;&nbsp;&lt;br&gt;<br>
&lt;br&gt;<br>
As&nbsp;I&nbsp;aforementioned,&nbsp;totally&nbsp;new&nbsp;to&nbsp;all&nbsp;this&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Piensa&nbsp;en&nbsp;el&nbsp;medio&nbsp;ambiente&nbsp;antes&nbsp;de&nbsp;imprimir&nbsp;este&nbsp;email.&nbsp;&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;Dec&nbsp;6,&nbsp;2016,&nbsp;at&nbsp;1:27&nbsp;PM,&nbsp;Eliezer&nbsp;Croitoru&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:eliezer@ngtech.co.il&quot;&gt;mailto:eliezer@ngtech.co.il&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
Now&nbsp;you&nbsp;can&nbsp;enhance&nbsp;the&nbsp;script&nbsp;by&nbsp;adding&nbsp;manually&nbsp;the&nbsp;ntop&nbsp;skype&nbsp;related&nbsp;networks&nbsp;based&nbsp;on:&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://github.com/ntop/nDPI/blob/d9a2d9a6bd4d476d666d26cb713952760a975d92/src/lib/ndpi_content_match.c.inc#L286&quot;&gt;https://github.com/ntop/nDPI/blob/d9a2d9a6bd4d476d666d26cb713952760a975d92/src/lib/ndpi_content_match.c.inc#L286&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
/*&lt;br&gt;<br>
Skype&nbsp;(Microsoft&nbsp;CDN)&lt;br&gt;<br>
157.56.135.64/26,&nbsp;157.56.185.0/26,&nbsp;157.56.52.0/26,&lt;br&gt;<br>
157.56.53.128/25,&nbsp;157.56.198.0/26&lt;br&gt;<br>
157.60.0.0/16,&nbsp;157.54.0.0/15&nbsp;&lt;br&gt;<br>
13.107.3.128/32&lt;br&gt;<br>
13.107.3.129/32&lt;br&gt;<br>
111.221.64.0&nbsp;-&nbsp;111.221.127.255&lt;br&gt;<br>
91.190.216.0/21&nbsp;(AS198015&nbsp;Skype&nbsp;Communications&nbsp;Sarl)&lt;br&gt;<br>
91.190.218.0/24&lt;br&gt;<br>
40.126.129.109/32&lt;br&gt;<br>
65.55.223.0/26&lt;br&gt;<br>
*/&lt;br&gt;<br>
&lt;br&gt;<br>
If&nbsp;you&nbsp;need&nbsp;help&nbsp;scripting&nbsp;this&nbsp;let&nbsp;me&nbsp;know.&lt;br&gt;<br>
&lt;br&gt;<br>
Eliezer&lt;br&gt;<br>
&lt;br&gt;<br>
----&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://ngtech.co.il/lmgtfy/&quot;&gt;http://ngtech.co.il/lmgtfy/&lt;/a&gt;&lt;br&gt;<br>
Linux&nbsp;System&nbsp;Administrator&lt;br&gt;<br>
Mobile:&nbsp;&#43;972-5-28704261&lt;br&gt;<br>
Email:&nbsp;&lt;a&nbsp;href=&quot;mailto:eliezer@ngtech.co.il&quot;&gt;mailto:eliezer@ngtech.co.il&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
From:&nbsp;Sameh&nbsp;Onaissi&nbsp;[&lt;a&nbsp;href=&quot;mailto:sameh.onaissi@solcv.com&quot;&gt;mailto:sameh.onaissi@solcv.com&lt;/a&gt;]<br>
&lt;br&gt;<br>
Sent:&nbsp;Tuesday,&nbsp;December&nbsp;6,&nbsp;2016&nbsp;7:29&nbsp;PM&lt;br&gt;<br>
To:&nbsp;Eliezer&nbsp;Croitoru&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:eliezer@ngtech.co.il&quot;&gt;mailto:eliezer@ngtech.co.il&lt;/a&gt;&gt;&lt;br&gt;<br>
Cc:&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&gt;mailto:squid3@treenet.co.nz&lt;/a&gt;&gt;;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;mailto:squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
Subject:&nbsp;Re:&nbsp;[squid-users]&nbsp;Skype&nbsp;for&nbsp;Business&nbsp;behind&nbsp;a&nbsp;transparent&nbsp;squid&nbsp;(TProxy)&nbsp;HTTP/S&lt;br&gt;<br>
&lt;br&gt;<br>
Hello,&nbsp;&lt;br&gt;<br>
&lt;br&gt;<br>
OK,&nbsp;I&nbsp;added&nbsp;the&nbsp;ssl_bump&nbsp;slice&nbsp;on&nbsp;the&nbsp;skype&nbsp;domains&nbsp;text&nbsp;file&lt;br&gt;<br>
I&nbsp;installed&nbsp;ipset&nbsp;and&nbsp;ran&nbsp;the&nbsp;script.&lt;br&gt;<br>
&lt;br&gt;<br>
Now&nbsp;access.log&nbsp;has&nbsp;much&nbsp;less&nbsp;skype&nbsp;related&nbsp;logs:&lt;br&gt;<br>
&lt;br&gt;<br>
What&nbsp;is&nbsp;left&nbsp;is:&lt;br&gt;<br>
1481044996.398&nbsp;&nbsp;&nbsp;3412&nbsp;10.0.0.11&nbsp;TAG_NONE/200&nbsp;0&nbsp;CONNECT&nbsp;132.245.1.32:443&nbsp;-&nbsp;ORIGINAL_DST/132.245.1.32&nbsp;-&lt;br&gt;<br>
1481044996.423&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;10.0.0.11&nbsp;TAG_NONE/400&nbsp;3998&nbsp;REGISTER&nbsp;sip:solcv.comSIP/2.0&nbsp;-&nbsp;HIER_NONE/-&nbsp;text/html&lt;br&gt;<br>
1481045000.296&nbsp;&nbsp;&nbsp;&nbsp;372&nbsp;10.0.0.11&nbsp;TAG_NONE/200&nbsp;0&nbsp;CONNECT&nbsp;134.170.113.207:443&nbsp;-&nbsp;ORIGINAL_DST/134.170.113.207&nbsp;-&lt;br&gt;<br>
1481045000.325&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;10.0.0.11&nbsp;TAG_NONE/400&nbsp;3998&nbsp;REGISTER&nbsp;sip:solcv.comSIP/2.0&nbsp;-&nbsp;HIER_NONE/-&nbsp;text/html&lt;br&gt;<br>
1481045008.685&nbsp;&nbsp;&nbsp;4259&nbsp;10.0.0.11&nbsp;TAG_NONE/200&nbsp;0&nbsp;CONNECT&nbsp;134.170.113.207:443&nbsp;-&nbsp;ORIGINAL_DST/134.170.113.207&nbsp;-&lt;br&gt;<br>
1481045008.726&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;10.0.0.11&nbsp;TAG_NONE/400&nbsp;3998&nbsp;REGISTER&nbsp;sip:solcv.comSIP/2.0&nbsp;-&nbsp;HIER_NONE/-&nbsp;text/html&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
although&nbsp;&lt;a&nbsp;href=&quot;http://solve.com&quot;&gt;http://solve.com&lt;/a&gt;&nbsp;is&nbsp;in&nbsp;the&nbsp;text&nbsp;file.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;ran&nbsp;whois&nbsp;on&nbsp;the&nbsp;first&nbsp;IP&nbsp;and&nbsp;got:&lt;br&gt;<br>
&lt;br&gt;<br>
NetRange:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;132.245.0.0&nbsp;-&nbsp;132.245.255.255&lt;br&gt;<br>
CIDR:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;132.245.0.0/16&lt;br&gt;<br>
NetName:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MICROSOFT&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Same&nbsp;with&nbsp;the&nbsp;134.170.&nbsp;address.&nbsp;Can&nbsp;we&nbsp;slice&nbsp;that&nbsp;range?&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Sameh&nbsp;Onaissi&lt;br&gt;<br>
Ingeniero&nbsp;de&nbsp;Soporte&lt;br&gt;<br>
Sol&nbsp;Cable&nbsp;Visión&lt;br&gt;<br>
Cel:&nbsp;316-3023424&lt;br&gt;<br>
Email:&nbsp;&lt;a&nbsp;href=&quot;mailto:sameh.onaissi@solcv.com&quot;&gt;mailto:sameh.onaissi@solcv.com&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Piensa&nbsp;en&nbsp;el&nbsp;medio&nbsp;ambiente&nbsp;antes&nbsp;de&nbsp;imprimir&nbsp;este&nbsp;email.&nbsp;&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;Dec&nbsp;6,&nbsp;2016,&nbsp;at&nbsp;12:11&nbsp;PM,&nbsp;Eliezer&nbsp;Croitoru&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:eliezer@ngtech.co.il&quot;&gt;mailto:eliezer@ngtech.co.il&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
Hey,&lt;br&gt;<br>
&lt;br&gt;<br>
Depends&nbsp;on&nbsp;your&nbsp;OS&nbsp;you&nbsp;will&nbsp;need&nbsp;to&nbsp;installthe&nbsp;&nbsp;ipset&nbsp;package.&lt;br&gt;<br>
Try&nbsp;to&nbsp;run&nbsp;“apt-get&nbsp;install&nbsp;ipset”.&lt;br&gt;<br>
And&nbsp;then&nbsp;run&nbsp;the&nbsp;script.&lt;br&gt;<br>
&lt;br&gt;<br>
Eliezer&lt;br&gt;<br>
&lt;br&gt;<br>
----&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://ngtech.co.il/lmgtfy/&quot;&gt;http://ngtech.co.il/lmgtfy/&lt;/a&gt;&lt;br&gt;<br>
Linux&nbsp;System&nbsp;Administrator&lt;br&gt;<br>
Mobile:&nbsp;&#43;972-5-28704261&lt;br&gt;<br>
Email:&nbsp;&lt;a&nbsp;href=&quot;mailto:eliezer@ngtech.co.il&quot;&gt;mailto:eliezer@ngtech.co.il&lt;/a&gt;&lt;br&gt;<br>
&lt;Untitled&nbsp;Attachment&nbsp;1.jpg&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
From:&nbsp;Sameh&nbsp;Onaissi&nbsp;[&lt;a&nbsp;href=&quot;mailto:sameh.onaissi@solcv.com&quot;&gt;mailto:sameh.onaissi@solcv.com&lt;/a&gt;]<br>
&lt;br&gt;<br>
Sent:&nbsp;Tuesday,&nbsp;December&nbsp;6,&nbsp;2016&nbsp;5:23&nbsp;PM&lt;br&gt;<br>
To:&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&gt;mailto:squid3@treenet.co.nz&lt;/a&gt;&gt;&lt;br&gt;<br>
Cc:&nbsp;Eliezer&nbsp;Croitoru&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:eliezer@ngtech.co.il&quot;&gt;mailto:eliezer@ngtech.co.il&lt;/a&gt;&gt;&lt;br&gt;<br>
Subject:&nbsp;Re:&nbsp;[squid-users]&nbsp;Skype&nbsp;for&nbsp;Business&nbsp;behind&nbsp;a&nbsp;transparent&nbsp;squid&nbsp;(TProxy)&nbsp;HTTP/S&lt;br&gt;<br>
&lt;br&gt;<br>
Amos,&nbsp;thanks&nbsp;for&nbsp;the&nbsp;reply.&nbsp;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
This&nbsp;is&nbsp;getting&nbsp;more&nbsp;confusing.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;changed&nbsp;the&nbsp;script&nbsp;to:&nbsp;&lt;a&nbsp;href=&quot;http://pastebin.com/jLgywstg&quot;&gt;http://pastebin.com/jLgywstg&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
And&nbsp;I&nbsp;ran&nbsp;it,&nbsp;but&nbsp;I&nbsp;am&nbsp;getting&nbsp;errors:&lt;br&gt;<br>
&lt;br&gt;<br>
sudo&nbsp;sh&nbsp;&lt;a&nbsp;href=&quot;http://bypass.sh/&quot;&gt;http://bypass.sh/&lt;/a&gt;&nbsp;&#43;&nbsp;iptables&nbsp;-t&nbsp;mangle&nbsp;-L&nbsp;PREROUTING&nbsp;&#43;&nbsp;grep&nbsp;bypasspool&nbsp;&#43;&nbsp;[&nbsp;1&nbsp;-ne&nbsp;0&nbsp;]&nbsp;&#43;&nbsp;iptables&nbsp;-t&nbsp;mangle&nbsp;-I&nbsp;PREROUTING&nbsp;-m&nbsp;set&nbsp;--match-set&nbsp;bypasspool&nbsp;dst,src&nbsp;-j&nbsp;DIVERT&nbsp;iptables<br>
&lt;a&nbsp;href=&quot;http://v1.6.0/&quot;&gt;http://v1.6.0/&lt;/a&gt;&nbsp;Set&nbsp;bypasspool&nbsp;doesn't&nbsp;exist.&nbsp;Try&nbsp;`iptables&nbsp;-h'&nbsp;or&nbsp;'iptables&nbsp;--help'&nbsp;for&nbsp;more&nbsp;information.&nbsp;&#43;&nbsp;ipset&nbsp;create&nbsp;bypasspool&nbsp;hash:ip<br>
&lt;a&nbsp;href=&quot;http://bypass.sh/&quot;&gt;http://bypass.sh/&lt;/a&gt;&nbsp;10:&nbsp;&lt;a&nbsp;href=&quot;http://bypass.sh/&quot;&gt;<br>
http://bypass.sh/&lt;/a&gt;&nbsp;ipset:&nbsp;not&nbsp;found&nbsp;&#43;&nbsp;read&nbsp;item&nbsp;&#43;&nbsp;echohttp://lyncdiscover.solcv.com/<br>
&lt;a&nbsp;href=&quot;http://lyncdiscover.solcv.com/&quot;&gt;http://lyncdiscover.solcv.com/&lt;/a&gt;&nbsp;&#43;&nbsp;host&nbsp;-4<br>
&lt;a&nbsp;href=&quot;http://lyncdiscover.solcv.com/&quot;&gt;http://lyncdiscover.solcv.com/&lt;/a&gt;&nbsp;&#43;&nbsp;grep&nbsp;has&nbsp;address&nbsp;&#43;&nbsp;awk&nbsp;{print&nbsp;$4}&nbsp;&#43;&nbsp;xargs&nbsp;-l1&nbsp;ipset&nbsp;add&nbsp;bypasspool&nbsp;xargs:&nbsp;ipset:&nbsp;No&nbsp;such&nbsp;file&nbsp;or&nbsp;directory&nbsp;&#43;&nbsp;read&nbsp;item&nbsp;&#43;&nbsp;echo<br>
&lt;a&nbsp;href=&quot;http://webdir0a.online.lync.com/http://webdir0a.online.lync.com/&quot;&gt;http://webdir0a.online.lync.com/http://webdir0a.online.lync.com/&lt;/a&gt;&nbsp;&#43;&nbsp;host&nbsp;-4<br>
&lt;a&nbsp;href=&quot;http://webdir0a.online.lync.com/&quot;&gt;http://webdir0a.online.lync.com/&lt;/a&gt;&nbsp;&#43;&nbsp;grep&nbsp;has&nbsp;address&nbsp;&#43;&nbsp;awk&nbsp;{print&nbsp;$4}&nbsp;&#43;&nbsp;xargs&nbsp;-l1&nbsp;ipset&nbsp;add&nbsp;bypasspool&nbsp;xargs:&nbsp;ipset:&nbsp;No&nbsp;such&nbsp;file&nbsp;or&nbsp;directory&lt;br&gt;<br>
&lt;br&gt;<br>
…&nbsp;this&nbsp;goes&nbsp;on&nbsp;the&nbsp;same&nbsp;for&nbsp;all&nbsp;the&nbsp;domains&nbsp;in&nbsp;the&nbsp;text&nbsp;file&lt;br&gt;<br>
&lt;br&gt;<br>
My&nbsp;iptables&nbsp;is&nbsp;still&nbsp;&lt;&lt;a&nbsp;href=&quot;http://pastebin.com/SqpbmYQQ&quot;&gt;http://pastebin.com/SqpbmYQQ&lt;/a&gt;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;did&nbsp;not&nbsp;quite&nbsp;understand&nbsp;what&nbsp;you&nbsp;meant&nbsp;by&nbsp;&lt;br&gt;<br>
You&nbsp;should&nbsp;test&nbsp;whether&nbsp;-m&nbsp;set&nbsp;or&nbsp;-m&nbsp;socket&nbsp;work&nbsp;faster&nbsp;and&nbsp;put&nbsp;that&nbsp;one&lt;br&gt;<br>
first.&nbsp;My&nbsp;change&nbsp;above&nbsp;places&nbsp;it&nbsp;at&nbsp;line&nbsp;2&nbsp;(after&nbsp;-m&nbsp;socket)&nbsp;assuming&lt;br&gt;<br>
your&nbsp;iptables&nbsp;script&nbsp;is&nbsp;still&nbsp;&lt;&lt;a&nbsp;href=&quot;http://pastebin.com/SqpbmYQQ&quot;&gt;http://pastebin.com/SqpbmYQQ&lt;/a&gt;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
should&nbsp;I&nbsp;incorporate&nbsp;the&nbsp;bypass&nbsp;script&nbsp;into&nbsp;my&nbsp;iptables.sh&nbsp;script?&nbsp;run&nbsp;iptables&nbsp;first&nbsp;then&nbsp;bypass?&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;a&nbsp;side&nbsp;note,&nbsp;would&nbsp;adding&nbsp;ssl_bump&nbsp;exceptions&nbsp;to&nbsp;squid.conf&nbsp;do&nbsp;it?&lt;br&gt;<br>
Something&nbsp;like:&nbsp;&lt;br&gt;<br>
&lt;br&gt;<br>
acl&nbsp;skype_domains&nbsp;&lt;path&nbsp;to&nbsp;file&gt;&lt;br&gt;<br>
ssl_bump&nbsp;splice&nbsp;skype_domains&lt;br&gt;<br>
ssl_bump&nbsp;bump&nbsp;all&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Again,&nbsp;thanks&nbsp;again&nbsp;for&nbsp;your&nbsp;help.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;Untitled&nbsp;Attachment&nbsp;2.jpg&gt;&nbsp;Piensa&nbsp;en&nbsp;el&nbsp;medio&nbsp;ambiente&nbsp;antes&nbsp;de&nbsp;imprimir&nbsp;este&nbsp;email.&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;Dec&nbsp;6,&nbsp;2016,&nbsp;at&nbsp;9:50&nbsp;AM,&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&gt;mailto:squid3@treenet.co.nz&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;7/12/2016&nbsp;3:19&nbsp;a.m.,&nbsp;Sameh&nbsp;Onaissi&nbsp;wrote:&lt;br&gt;<br>
Hello,&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;tried&nbsp;doing&nbsp;the&nbsp;changes&nbsp;to&nbsp;nat/REDIRECT&nbsp;in&nbsp;iptables.sh&nbsp;and&nbsp;I&nbsp;must&nbsp;have&nbsp;messed&nbsp;up&nbsp;somewhere,&nbsp;so&nbsp;I&nbsp;am&nbsp;sticking&nbsp;with&nbsp;mangle/tproxy&nbsp;for&nbsp;now&nbsp;since&nbsp;squid&nbsp;is&nbsp;working&nbsp;with&nbsp;them.&lt;br&gt;<br>
&lt;br&gt;<br>
How&nbsp;can&nbsp;I&nbsp;change&nbsp;Eliezer’s&nbsp;script&nbsp;to&nbsp;mangle/tproxy?&nbsp;&lt;a&nbsp;href=&quot;https://gist.github.com/elico/e0faadf0cc63942c5aaade808a87deef&quot;&gt;<br>
https://gist.github.com/elico/e0faadf0cc63942c5aaade808a87deef&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
Excuse&nbsp;my&nbsp;novice&nbsp;knowledge&nbsp;in&nbsp;iptables.&lt;br&gt;<br>
&lt;br&gt;<br>
No&nbsp;worries.&lt;br&gt;<br>
&lt;br&gt;<br>
You&nbsp;need&nbsp;to&nbsp;change&nbsp;where&nbsp;iptables&nbsp;attaches&nbsp;the&nbsp;'bypasspool'.&nbsp;Both&nbsp;the&lt;br&gt;<br>
table/location&nbsp;(-t)&nbsp;and&nbsp;the&nbsp;jump/action&nbsp;(-j).&lt;br&gt;<br>
&lt;br&gt;<br>
iptables&nbsp;-t&nbsp;mangle&nbsp;-L&nbsp;PREROUTING&nbsp;|grep&nbsp;bypasspool&lt;br&gt;<br>
if&nbsp;[&nbsp;&quot;$?&quot;&nbsp;-ne&nbsp;&quot;0&quot;&nbsp;];then&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp;&nbsp;iptables&nbsp;-t&nbsp;mangle&nbsp;-I&nbsp;2&nbsp;PREROUTING&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;-m&nbsp;set&nbsp;--match-set&nbsp;bypasspool&nbsp;dst,src&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;-j&nbsp;DIVERT&lt;br&gt;<br>
&lt;br&gt;<br>
fi&lt;br&gt;<br>
&lt;br&gt;<br>
You&nbsp;should&nbsp;test&nbsp;whether&nbsp;-m&nbsp;set&nbsp;or&nbsp;-m&nbsp;socket&nbsp;work&nbsp;faster&nbsp;and&nbsp;put&nbsp;that&nbsp;one&lt;br&gt;<br>
first.&nbsp;My&nbsp;change&nbsp;above&nbsp;places&nbsp;it&nbsp;at&nbsp;line&nbsp;2&nbsp;(after&nbsp;-m&nbsp;socket)&nbsp;assuming&lt;br&gt;<br>
your&nbsp;iptables&nbsp;script&nbsp;is&nbsp;still&nbsp;&lt;&lt;a&nbsp;href=&quot;http://pastebin.com/SqpbmYQQ&quot;&gt;http://pastebin.com/SqpbmYQQ&lt;/a&gt;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
(Your&nbsp;script&nbsp;should&nbsp;do&nbsp;that&nbsp;line&nbsp;adding,&nbsp;not&nbsp;Eliezers&nbsp;-&nbsp;so&nbsp;that&nbsp;you&nbsp;can&lt;br&gt;<br>
be&nbsp;sure&nbsp;the&nbsp;order&nbsp;is&nbsp;always&nbsp;correct).&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
BTW:&nbsp;you&nbsp;should&nbsp;use&nbsp;iptables-save&nbsp;/&nbsp;iptables-restore&nbsp;instead&nbsp;of&nbsp;a&nbsp;slow&lt;br&gt;<br>
script&nbsp;calling&nbsp;iptables&nbsp;&quot;manually&quot;.&nbsp;Those&nbsp;other&nbsp;tools&nbsp;will&nbsp;ensure&nbsp;there&lt;br&gt;<br>
are&nbsp;no&nbsp;gaps&nbsp;in&nbsp;the&nbsp;firewall&nbsp;initialization&nbsp;for&nbsp;nasty&nbsp;traffic&nbsp;to&nbsp;sneak&lt;br&gt;<br>
through.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;am&nbsp;looking&nbsp;at&nbsp;access.log&nbsp;to&nbsp;collect&nbsp;all&nbsp;domains&nbsp;I&nbsp;see&nbsp;heading&nbsp;to&nbsp;skype&nbsp;for&nbsp;business,&nbsp;as&nbsp;well&nbsp;as&nbsp;IPs.&nbsp;My&nbsp;question&nbsp;is,&nbsp;can&nbsp;I&nbsp;add&nbsp;the&nbsp;domains&nbsp;AND&nbsp;IPs&nbsp;into&nbsp;the&nbsp;domains-to-bypass.txt&nbsp;that&nbsp;the&nbsp;above&nbsp;script&nbsp;uses?&lt;br&gt;<br>
&lt;br&gt;<br>
IIRC&nbsp;you&nbsp;should&nbsp;be&nbsp;able&nbsp;to&nbsp;use&nbsp;domain&nbsp;as&nbsp;the&nbsp;parameter&nbsp;to&nbsp;ipset.&nbsp;But&nbsp;it&lt;br&gt;<br>
will&nbsp;resolve&nbsp;the&nbsp;domain&nbsp;immediately&nbsp;and&nbsp;only&nbsp;add&nbsp;those&nbsp;IPs&nbsp;that&nbsp;it&nbsp;finds&lt;br&gt;<br>
at&nbsp;that&nbsp;time&nbsp;into&nbsp;the&nbsp;pool.&nbsp;Any&nbsp;future&nbsp;changes,&nbsp;or&nbsp;a&nbsp;hidden&nbsp;set&nbsp;of&nbsp;IPs&lt;br&gt;<br>
that&nbsp;rotate&nbsp;in/out&nbsp;will&nbsp;not&nbsp;be&nbsp;listed.&lt;br&gt;<br>
&lt;br&gt;<br>
Amos&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
