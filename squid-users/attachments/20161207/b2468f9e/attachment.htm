<tt>
&lt;html&gt;<br>
&lt;head&gt;<br>
&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=iso-8859-1&quot;&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&quot;&nbsp;class=&quot;&quot;&gt;<br>
iptables&nbsp;is&nbsp;the&nbsp;same..&nbsp;here&nbsp;is&nbsp;after&nbsp;I&nbsp;ran&nbsp;the&nbsp;script&nbsp;twice&nbsp;(with&nbsp;and&nbsp;without&nbsp;proxy)<br>
&lt;div&nbsp;class=&quot;&quot;&gt;&lt;a&nbsp;href=&quot;http://pastebin.com/YFtbG6St&quot;&nbsp;class=&quot;&quot;&gt;http://pastebin.com/YFtbG6St&lt;/a&gt;&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;I&nbsp;have&nbsp;a&nbsp;script&nbsp;that&nbsp;bridges&nbsp;the&nbsp;two&nbsp;network&nbsp;cards,&nbsp;that&nbsp;uses&nbsp;nat,&nbsp;hence&nbsp;having&nbsp;both&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;I&nbsp;can&nbsp;send&nbsp;you&nbsp;all&nbsp;the&nbsp;scripts&nbsp;I&nbsp;run&nbsp;to&nbsp;set&nbsp;up&nbsp;squid&nbsp;and&nbsp;the&nbsp;bypasses&nbsp;so&nbsp;you&nbsp;can&nbsp;reproduce&nbsp;the&nbsp;situation.&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;thanks&nbsp;again!&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-family:&nbsp;Helvetica;&nbsp;font-size:&nbsp;12px;&nbsp;font-style:&nbsp;normal;&nbsp;font-variant-caps:&nbsp;normal;&nbsp;font-weight:&nbsp;normal;&nbsp;letter-spacing:&nbsp;normal;&nbsp;orphans:&nbsp;auto;&nbsp;text-align:&nbsp;start;&nbsp;text-indent:&nbsp;0px;&nbsp;text-transform:&nbsp;none;&nbsp;white-space:&nbsp;normal;&nbsp;widows:&nbsp;auto;&nbsp;word-spacing:&nbsp;0px;&nbsp;-webkit-text-stroke-width:&nbsp;0px;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-family:&nbsp;Helvetica;&nbsp;font-size:&nbsp;12px;&nbsp;font-style:&nbsp;normal;&nbsp;font-variant-caps:&nbsp;normal;&nbsp;font-weight:&nbsp;normal;&nbsp;letter-spacing:&nbsp;normal;&nbsp;orphans:&nbsp;auto;&nbsp;text-align:&nbsp;start;&nbsp;text-indent:&nbsp;0px;&nbsp;text-transform:&nbsp;none;&nbsp;white-space:&nbsp;normal;&nbsp;widows:&nbsp;auto;&nbsp;word-spacing:&nbsp;0px;&nbsp;-webkit-text-stroke-width:&nbsp;0px;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-family:&nbsp;Helvetica;&nbsp;font-size:&nbsp;12px;&nbsp;font-style:&nbsp;normal;&nbsp;font-variant-caps:&nbsp;normal;&nbsp;font-weight:&nbsp;normal;&nbsp;letter-spacing:&nbsp;normal;&nbsp;orphans:&nbsp;auto;&nbsp;text-align:&nbsp;start;&nbsp;text-indent:&nbsp;0px;&nbsp;text-transform:&nbsp;none;&nbsp;white-space:&nbsp;normal;&nbsp;widows:&nbsp;auto;&nbsp;word-spacing:&nbsp;0px;&nbsp;-webkit-text-stroke-width:&nbsp;0px;&quot;&gt;<br>
&lt;span&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-family:&nbsp;Helvetica;&nbsp;font-size:&nbsp;12px;&nbsp;font-style:&nbsp;normal;&nbsp;font-variant-caps:&nbsp;normal;&nbsp;font-weight:&nbsp;normal;&nbsp;letter-spacing:&nbsp;normal;&nbsp;orphans:&nbsp;auto;&nbsp;text-align:&nbsp;start;&nbsp;text-indent:&nbsp;0px;&nbsp;text-transform:&nbsp;none;&nbsp;white-space:&nbsp;normal;&nbsp;widows:&nbsp;auto;&nbsp;word-spacing:&nbsp;0px;&nbsp;-webkit-text-stroke-width:&nbsp;0px;&quot;&gt;&lt;span&gt;&lt;img&nbsp;height=&quot;38&quot;&nbsp;width=&quot;45&quot;&nbsp;apple-inline=&quot;yes&quot;&nbsp;id=&quot;F1E45F27-2FE3-42ED-B11D-051C4067FA49&quot;&nbsp;apple-width=&quot;yes&quot;&nbsp;apple-height=&quot;yes&quot;&nbsp;src=&quot;cid:2FD1C3AB-E45C-49F0-84AB-0F8AC658BD11@routerb408e2.com&quot;&nbsp;class=&quot;&quot;&gt;&lt;/span&gt;&lt;em&nbsp;style=&quot;font-variant-caps:&nbsp;normal;&nbsp;font-weight:&nbsp;normal;&nbsp;letter-spacing:&nbsp;normal;&nbsp;orphans:&nbsp;auto;&nbsp;text-align:&nbsp;start;&nbsp;text-indent:&nbsp;0px;&nbsp;text-transform:&nbsp;none;&nbsp;white-space:&nbsp;normal;&nbsp;widows:&nbsp;auto;&nbsp;word-spacing:&nbsp;0px;&nbsp;-webkit-text-stroke-width:&nbsp;0px;&nbsp;color:&nbsp;rgb(0,&nbsp;128,&nbsp;0);&nbsp;font-family:&nbsp;Calibri,&nbsp;Arial,&nbsp;Helvetica,&nbsp;sans-serif;&nbsp;font-size:&nbsp;16px;&nbsp;background-color:&nbsp;rgb(255,&nbsp;255,&nbsp;255);&quot;&nbsp;class=&quot;&quot;&gt;&lt;strong&nbsp;class=&quot;&quot;&gt;Piensa<br>
&nbsp;en&nbsp;el&nbsp;medio&nbsp;ambiente&nbsp;antes&nbsp;de&nbsp;imprimir&nbsp;este&nbsp;email.&lt;/strong&gt;&lt;/em&gt;&nbsp;&lt;/span&gt;&lt;/div&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;div&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;On&nbsp;Dec&nbsp;7,&nbsp;2016,&nbsp;at&nbsp;12:12&nbsp;PM,&nbsp;Eliezer&nbsp;Croitoru&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:eliezer@ngtech.co.il&quot;&nbsp;class=&quot;&quot;&gt;eliezer@ngtech.co.il&lt;/a&gt;&gt;&nbsp;wrote:&lt;/div&gt;<br>
&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;Are&nbsp;you&nbsp;sure&nbsp;this&nbsp;setup&nbsp;works?&lt;br&nbsp;class=&quot;&quot;&gt;<br>
You&nbsp;have&nbsp;both&nbsp;REDIRECT&nbsp;and&nbsp;TPROXY&nbsp;on&nbsp;the&nbsp;same&nbsp;machine&nbsp;so&nbsp;you&nbsp;need&nbsp;to&nbsp;bypass&lt;br&nbsp;class=&quot;&quot;&gt;<br>
for&nbsp;both&nbsp;of&nbsp;these.&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Is&nbsp;this&nbsp;iptables-save&nbsp;snapshot&nbsp;after&nbsp;you&nbsp;ran&nbsp;the&nbsp;script?&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Also&nbsp;for&nbsp;this&nbsp;to&nbsp;work&nbsp;you&nbsp;will&nbsp;need&nbsp;to&nbsp;use&nbsp;the&nbsp;updated&nbsp;version&nbsp;of&nbsp;the&nbsp;script&lt;br&nbsp;class=&quot;&quot;&gt;<br>
at:&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;a&nbsp;href=&quot;https://gist.github.com/elico/a54c2c8f8e1a2407b42210896b960f4b&quot;&nbsp;class=&quot;&quot;&gt;https://gist.github.com/elico/a54c2c8f8e1a2407b42210896b960f4b&lt;/a&gt;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
And&nbsp;run&nbsp;it&nbsp;twice...&nbsp;once&nbsp;with&nbsp;tproxy&nbsp;and&nbsp;the&nbsp;other&nbsp;without&nbsp;tproxy.&lt;br&nbsp;class=&quot;&quot;&gt;<br>
After&nbsp;you&nbsp;run&nbsp;the&nbsp;script&nbsp;share&nbsp;the&nbsp;snapshot&nbsp;of&nbsp;&quot;iptables-save&quot;&nbsp;and&nbsp;&quot;ipset&lt;br&nbsp;class=&quot;&quot;&gt;<br>
list&quot;.&lt;br&nbsp;class=&quot;&quot;&gt;<br>
If&nbsp;it&nbsp;can&nbsp;be&nbsp;reproducible&nbsp;here&nbsp;when&nbsp;I&nbsp;will&nbsp;be&nbsp;using&nbsp;SKYPE&nbsp;I&nbsp;would&nbsp;be&nbsp;able&nbsp;to&lt;br&nbsp;class=&quot;&quot;&gt;<br>
test&nbsp;it&nbsp;but&nbsp;I&nbsp;believe&nbsp;it&nbsp;should&nbsp;work&nbsp;good&nbsp;enough&nbsp;to&nbsp;minimize&nbsp;the&nbsp;issue.&lt;br&nbsp;class=&quot;&quot;&gt;<br>
The&nbsp;above&nbsp;depends&nbsp;only&nbsp;on&nbsp;one&nbsp;thing:&nbsp;NTOP&nbsp;Skype&nbsp;networks&nbsp;identification.&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Maybe&nbsp;I&nbsp;have&nbsp;mentioned&nbsp;but&nbsp;there&nbsp;is&nbsp;another&nbsp;script&nbsp;which&nbsp;I&nbsp;wrote&nbsp;that&nbsp;is&lt;br&nbsp;class=&quot;&quot;&gt;<br>
more&nbsp;simplified&nbsp;at:&lt;br&nbsp;class=&quot;&quot;&gt;<br>
https://gist.github.com/elico/e0faadf0cc63942c5aaade808a87deef&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
But&nbsp;can&nbsp;be&nbsp;adapted&nbsp;to&nbsp;be&nbsp;used&nbsp;against&nbsp;skype&nbsp;known&nbsp;domains.&lt;br&nbsp;class=&quot;&quot;&gt;<br>
The&nbsp;next&nbsp;level&nbsp;would&nbsp;be&nbsp;to&nbsp;use&nbsp;some&nbsp;kind&nbsp;of&nbsp;splice&nbsp;rules&nbsp;with&nbsp;an&lt;br&nbsp;class=&quot;&quot;&gt;<br>
external_acl&nbsp;helper.&lt;br&nbsp;class=&quot;&quot;&gt;<br>
The&nbsp;external_acl&nbsp;helper&nbsp;can&nbsp;receive&nbsp;information&nbsp;from&nbsp;squid&nbsp;about&nbsp;the&nbsp;request&lt;br&nbsp;class=&quot;&quot;&gt;<br>
SNI&nbsp;and&nbsp;to&nbsp;verify&nbsp;if&nbsp;the&nbsp;server&nbsp;only&nbsp;serves&nbsp;skype&nbsp;domains&nbsp;or&nbsp;others.&lt;br&nbsp;class=&quot;&quot;&gt;<br>
The&nbsp;above&nbsp;is&nbsp;a&nbsp;much&nbsp;more&nbsp;deeper&nbsp;level&nbsp;and&nbsp;I&nbsp;think&nbsp;that&nbsp;the&nbsp;first&nbsp;scripts&lt;br&nbsp;class=&quot;&quot;&gt;<br>
should&nbsp;be&nbsp;enough&nbsp;to&nbsp;resolve&nbsp;most&nbsp;of&nbsp;the&nbsp;issues.&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Eliezer&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
----&lt;br&nbsp;class=&quot;&quot;&gt;<br>
http://ngtech.co.il/lmgtfy/&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Linux&nbsp;System&nbsp;Administrator&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Mobile:&nbsp;&#43;972-5-28704261&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Email:&nbsp;eliezer@ngtech.co.il&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
From:&nbsp;Sameh&nbsp;Onaissi&nbsp;[mailto:sameh.onaissi@solcv.com]&nbsp;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Sent:&nbsp;Wednesday,&nbsp;December&nbsp;7,&nbsp;2016&nbsp;6:09&nbsp;PM&lt;br&nbsp;class=&quot;&quot;&gt;<br>
To:&nbsp;Eliezer&nbsp;Croitoru&nbsp;&lt;eliezer@ngtech.co.il&gt;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Cc:&nbsp;squid-users@lists.squid-cache.org&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Subject:&nbsp;Re:&nbsp;[squid-users]&nbsp;Skype&nbsp;for&nbsp;Business&nbsp;behind&nbsp;a&nbsp;transparent&nbsp;squid&lt;br&nbsp;class=&quot;&quot;&gt;<br>
(TProxy)&nbsp;HTTP/S&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
iptables-save:&nbsp;&nbsp;http://pastebin.com/9JrVANtt&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
ipset&nbsp;list&nbsp;:&nbsp;http://pastebin.com/wtMtzaQe&lt;br&nbsp;class=&quot;&quot;&gt;<br>
http://pastebin.com/wtMtzaQe&lt;br&nbsp;class=&quot;&quot;&gt;<br>
http://pastebin.com/wtMtzaQe&lt;br&nbsp;class=&quot;&quot;&gt;<br>
pastebin.com&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
http://pastebin.com/9JrVANtt&lt;br&nbsp;class=&quot;&quot;&gt;<br>
http://pastebin.com/9JrVANtt&lt;br&nbsp;class=&quot;&quot;&gt;<br>
pastebin.com&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&nbsp;&nbsp;Piensa&nbsp;en&nbsp;el&nbsp;medio&nbsp;ambiente&nbsp;antes&nbsp;de&nbsp;imprimir&nbsp;este&nbsp;email.&lt;br&nbsp;class=&quot;&quot;&gt;<br>
________________________________________&lt;br&nbsp;class=&quot;&quot;&gt;<br>
From:&nbsp;Eliezer&nbsp;Croitoru&nbsp;&lt;mailto:eliezer@ngtech.co.il&gt;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Sent:&nbsp;Wednesday,&nbsp;December&nbsp;7,&nbsp;2016&nbsp;10:58:18&nbsp;AM&lt;br&nbsp;class=&quot;&quot;&gt;<br>
To:&nbsp;Sameh&nbsp;Onaissi&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Cc:&nbsp;mailto:squid-users@lists.squid-cache.org&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Subject:&nbsp;RE:&nbsp;[squid-users]&nbsp;Skype&nbsp;for&nbsp;Business&nbsp;behind&nbsp;a&nbsp;transparent&nbsp;squid&lt;br&nbsp;class=&quot;&quot;&gt;<br>
(TProxy)&nbsp;HTTP/S&nbsp;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&nbsp;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Give&nbsp;us&nbsp;the&nbsp;&quot;iptables-save&quot;&nbsp;output&nbsp;and&nbsp;also&nbsp;&quot;ipset&nbsp;list&quot;.&lt;br&nbsp;class=&quot;&quot;&gt;<br>
(or&nbsp;what&nbsp;ever&nbsp;was&nbsp;the&nbsp;command&nbsp;of&nbsp;ipset&nbsp;to&nbsp;dump&nbsp;the&nbsp;content&nbsp;of&nbsp;the&nbsp;list).&lt;br&nbsp;class=&quot;&quot;&gt;<br>
After&nbsp;this&nbsp;we&nbsp;can&nbsp;understand&nbsp;what&nbsp;is&nbsp;causing&nbsp;this&nbsp;issue.&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Eliezer&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
----&lt;br&nbsp;class=&quot;&quot;&gt;<br>
http://ngtech.co.il/lmgtfy/&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Linux&nbsp;System&nbsp;Administrator&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Mobile:&nbsp;&#43;972-5-28704261&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Email:&nbsp;mailto:eliezer@ngtech.co.il&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
From:&nbsp;Sameh&nbsp;Onaissi&nbsp;[mailto:sameh.onaissi@solcv.com]&nbsp;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Sent:&nbsp;Wednesday,&nbsp;December&nbsp;7,&nbsp;2016&nbsp;5:23&nbsp;PM&lt;br&nbsp;class=&quot;&quot;&gt;<br>
To:&nbsp;Eliezer&nbsp;Croitoru&nbsp;&lt;mailto:eliezer@ngtech.co.il&gt;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Cc:&nbsp;mailto:squid-users@lists.squid-cache.org&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Subject:&nbsp;Re:&nbsp;[squid-users]&nbsp;Skype&nbsp;for&nbsp;Business&nbsp;behind&nbsp;a&nbsp;transparent&nbsp;squid&lt;br&nbsp;class=&quot;&quot;&gt;<br>
(TProxy)&nbsp;HTTP/S&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Still&nbsp;not&nbsp;working&nbsp;and&nbsp;I&nbsp;do&nbsp;not&nbsp;know&nbsp;what&nbsp;to&nbsp;do&nbsp;next.&nbsp;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
access.log&nbsp;shows&nbsp;IPs&nbsp;and&nbsp;domains&nbsp;that&nbsp;are&nbsp;supposed&nbsp;to&nbsp;be&nbsp;bypassed&nbsp;already.&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Any&nbsp;further&nbsp;instructions&nbsp;are&nbsp;hugely&nbsp;appreciated.&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Piensa&nbsp;en&nbsp;el&nbsp;medio&nbsp;ambiente&nbsp;antes&nbsp;de&nbsp;imprimir&nbsp;este&nbsp;email.&nbsp;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
On&nbsp;Dec&nbsp;7,&nbsp;2016,&nbsp;at&nbsp;9:50&nbsp;AM,&nbsp;Eliezer&nbsp;Croitoru&nbsp;&lt;mailto:eliezer@ngtech.co.il&gt;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
wrote:&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Was&nbsp;there&nbsp;any&nbsp;progress&nbsp;with&nbsp;the&nbsp;script&nbsp;and&nbsp;the&nbsp;issues?&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Eliezer&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
----&lt;br&nbsp;class=&quot;&quot;&gt;<br>
http://ngtech.co.il/lmgtfy/&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Linux&nbsp;System&nbsp;Administrator&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Mobile:&nbsp;&#43;972-5-28704261&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Email:&nbsp;mailto:eliezer@ngtech.co.il&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
From:&nbsp;Sameh&nbsp;Onaissi&nbsp;[mailto:sameh.onaissi@solcv.com]&nbsp;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Sent:&nbsp;Wednesday,&nbsp;December&nbsp;7,&nbsp;2016&nbsp;12:36&nbsp;AM&lt;br&nbsp;class=&quot;&quot;&gt;<br>
To:&nbsp;Eliezer&nbsp;Croitoru&nbsp;&lt;mailto:eliezer@ngtech.co.il&gt;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Cc:&nbsp;'Amos&nbsp;Jeffries'&nbsp;&lt;mailto:squid3@treenet.co.nz&gt;;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
mailto:squid-users@lists.squid-cache.org&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Subject:&nbsp;Re:&nbsp;[squid-users]&nbsp;Skype&nbsp;for&nbsp;Business&nbsp;behind&nbsp;a&nbsp;transparent&nbsp;squid&lt;br&nbsp;class=&quot;&quot;&gt;<br>
(TProxy)&nbsp;HTTP/S&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Hello&nbsp;Eliezer&nbsp;and&nbsp;thanks&nbsp;again.&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
I&nbsp;ran&nbsp;the&nbsp;script&nbsp;with&nbsp;the&nbsp;tproxy&nbsp;argument.&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Tried&nbsp;to&nbsp;reconnect&nbsp;skype&nbsp;for&nbsp;business...&nbsp;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
After&nbsp;about&nbsp;a&nbsp;3&nbsp;min&nbsp;wait,&nbsp;a&nbsp;pop&nbsp;up&nbsp;saying&nbsp;&quot;Skype&nbsp;for&nbsp;Business&nbsp;couldn't&nbsp;find&lt;br&nbsp;class=&quot;&quot;&gt;<br>
a&nbsp;skype&nbsp;for&nbsp;business&nbsp;server&quot;&nbsp;&nbsp;and&nbsp;access&nbsp;log&nbsp;shows:&nbsp;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
1481061269.006&nbsp;&nbsp;&nbsp;&nbsp;400&nbsp;10.0.0.38&nbsp;TCP_MISS/200&nbsp;1068&nbsp;GET&lt;br&nbsp;class=&quot;&quot;&gt;<br>
http://lyncdiscover.solcv.com/?&nbsp;-&nbsp;ORIGINAL_DST/132.245.1.28&lt;br&nbsp;class=&quot;&quot;&gt;<br>
application/vnd.microsoft.rtc.autodiscover&#43;xml&lt;br&nbsp;class=&quot;&quot;&gt;<br>
1481061269.270&nbsp;&nbsp;&nbsp;&nbsp;667&nbsp;10.0.0.38&nbsp;TAG_NONE/200&nbsp;0&nbsp;CONNECT&nbsp;132.245.1.28:443&nbsp;-&lt;br&nbsp;class=&quot;&quot;&gt;<br>
HIER_NONE/-&nbsp;-&lt;br&nbsp;class=&quot;&quot;&gt;<br>
1481061269.270&nbsp;&nbsp;&nbsp;&nbsp;665&nbsp;10.0.0.38&nbsp;TCP_TUNNEL/200&nbsp;5568&nbsp;CONNECT&lt;br&nbsp;class=&quot;&quot;&gt;<br>
lyncdiscover.solcv.com:443&nbsp;-&nbsp;ORIGINAL_DST/132.245.1.28&nbsp;-&lt;br&nbsp;class=&quot;&quot;&gt;<br>
1481061269.770&nbsp;&nbsp;&nbsp;&nbsp;596&nbsp;10.0.0.38&nbsp;TAG_NONE/200&nbsp;0&nbsp;CONNECT&nbsp;52.112.64.14:443&nbsp;-&lt;br&nbsp;class=&quot;&quot;&gt;<br>
HIER_NONE/-&nbsp;-&lt;br&nbsp;class=&quot;&quot;&gt;<br>
1481061269.770&nbsp;&nbsp;&nbsp;&nbsp;594&nbsp;10.0.0.38&nbsp;TCP_TUNNEL/200&nbsp;6981&nbsp;CONNECT&lt;br&nbsp;class=&quot;&quot;&gt;<br>
webdir0a.online.lync.com:443&nbsp;-&nbsp;ORIGINAL_DST/52.112.64.14&nbsp;-&lt;br&nbsp;class=&quot;&quot;&gt;<br>
1481061270.679&nbsp;&nbsp;&nbsp;&nbsp;897&nbsp;10.0.0.38&nbsp;TAG_NONE/200&nbsp;0&nbsp;CONNECT&nbsp;52.112.64.14:443&nbsp;-&lt;br&nbsp;class=&quot;&quot;&gt;<br>
HIER_NONE/-&nbsp;-&lt;br&nbsp;class=&quot;&quot;&gt;<br>
1481061270.679&nbsp;&nbsp;&nbsp;&nbsp;895&nbsp;10.0.0.38&nbsp;TCP_TUNNEL/200&nbsp;7733&nbsp;CONNECT&lt;br&nbsp;class=&quot;&quot;&gt;<br>
webdir0a.online.lync.com:443&nbsp;-&nbsp;ORIGINAL_DST/52.112.64.14&nbsp;-&lt;br&nbsp;class=&quot;&quot;&gt;<br>
1481061272.178&nbsp;&nbsp;&nbsp;&nbsp;841&nbsp;10.0.0.38&nbsp;TAG_NONE/200&nbsp;0&nbsp;CONNECT&nbsp;23.100.120.65:443&nbsp;-&lt;br&nbsp;class=&quot;&quot;&gt;<br>
HIER_NONE/-&nbsp;-&lt;br&nbsp;class=&quot;&quot;&gt;<br>
1481061272.178&nbsp;&nbsp;&nbsp;&nbsp;840&nbsp;10.0.0.38&nbsp;TCP_TUNNEL/200&nbsp;20539&nbsp;CONNECT&lt;br&nbsp;class=&quot;&quot;&gt;<br>
login.microsoftonline.com:443&nbsp;-&nbsp;ORIGINAL_DST/23.100.120.65&nbsp;-&lt;br&nbsp;class=&quot;&quot;&gt;<br>
1481061273.713&nbsp;&nbsp;&nbsp;&nbsp;641&nbsp;10.0.0.38&nbsp;TAG_NONE/200&nbsp;0&nbsp;CONNECT&nbsp;52.112.64.14:443&nbsp;-&lt;br&nbsp;class=&quot;&quot;&gt;<br>
HIER_NONE/-&nbsp;-&lt;br&nbsp;class=&quot;&quot;&gt;<br>
1481061273.713&nbsp;&nbsp;&nbsp;&nbsp;640&nbsp;10.0.0.38&nbsp;TCP_TUNNEL/200&nbsp;8037&nbsp;CONNECT&lt;br&nbsp;class=&quot;&quot;&gt;<br>
webdir0a.online.lync.com:443&nbsp;-&nbsp;ORIGINAL_DST/52.112.64.14&nbsp;-&lt;br&nbsp;class=&quot;&quot;&gt;<br>
1481061273.751&nbsp;&nbsp;&nbsp;3054&nbsp;10.0.0.38&nbsp;TAG_NONE/200&nbsp;0&nbsp;CONNECT&nbsp;52.112.64.14:443&nbsp;-&lt;br&nbsp;class=&quot;&quot;&gt;<br>
HIER_NONE/-&nbsp;-&lt;br&nbsp;class=&quot;&quot;&gt;<br>
1481061273.751&nbsp;&nbsp;&nbsp;3052&nbsp;10.0.0.38&nbsp;TCP_TUNNEL/200&nbsp;24458&nbsp;CONNECT&lt;br&nbsp;class=&quot;&quot;&gt;<br>
webdir0a.online.lync.com:443&nbsp;-&nbsp;ORIGINAL_DST/52.112.64.14&nbsp;-&lt;br&nbsp;class=&quot;&quot;&gt;<br>
1481061273.751&nbsp;&nbsp;&nbsp;1544&nbsp;10.0.0.38&nbsp;TAG_NONE/200&nbsp;0&nbsp;CONNECT&nbsp;52.112.64.14:443&nbsp;-&lt;br&nbsp;class=&quot;&quot;&gt;<br>
HIER_NONE/-&nbsp;-&lt;br&nbsp;class=&quot;&quot;&gt;<br>
1481061273.751&nbsp;&nbsp;&nbsp;1543&nbsp;10.0.0.38&nbsp;TCP_TUNNEL/200&nbsp;11653&nbsp;CONNECT&lt;br&nbsp;class=&quot;&quot;&gt;<br>
webdir0a.online.lync.com:443&nbsp;-&nbsp;ORIGINAL_DST/52.112.64.14&nbsp;-&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
so&nbsp;I&nbsp;added&nbsp;more&nbsp;ip&nbsp;ranges&nbsp;to&nbsp;the&nbsp;cidr-to-bypass.txt&nbsp;and&nbsp;ran&nbsp;the&nbsp;script&nbsp;again&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
1481063243.370&nbsp;&nbsp;&nbsp;&nbsp;371&nbsp;10.0.0.38&nbsp;TCP_MISS/200&nbsp;1068&nbsp;GET&lt;br&nbsp;class=&quot;&quot;&gt;<br>
http://lyncdiscover.solcv.com/?&nbsp;-&nbsp;ORIGINAL_DST/134.170.113.210&lt;br&nbsp;class=&quot;&quot;&gt;<br>
application/vnd.microsoft.rtc.autodiscover&#43;xml&lt;br&nbsp;class=&quot;&quot;&gt;<br>
1481063278.271&nbsp;&nbsp;74233&nbsp;10.0.0.38&nbsp;TAG_NONE/200&nbsp;0&nbsp;CONNECT&nbsp;104.208.31.113:443&nbsp;-&lt;br&nbsp;class=&quot;&quot;&gt;<br>
HIER_NONE/-&nbsp;-&lt;br&nbsp;class=&quot;&quot;&gt;<br>
1481063278.271&nbsp;&nbsp;74231&nbsp;10.0.0.38&nbsp;TCP_TUNNEL/200&nbsp;6746&nbsp;CONNECT&lt;br&nbsp;class=&quot;&quot;&gt;<br>
pipe.skype.com:443&nbsp;-&nbsp;ORIGINAL_DST/104.208.31.113&nbsp;-&lt;br&nbsp;class=&quot;&quot;&gt;<br>
1481063344.143&nbsp;&nbsp;60720&nbsp;10.0.0.38&nbsp;TAG_NONE/200&nbsp;0&nbsp;CONNECT&nbsp;104.208.31.113:443&nbsp;-&lt;br&nbsp;class=&quot;&quot;&gt;<br>
HIER_NONE/-&nbsp;-&lt;br&nbsp;class=&quot;&quot;&gt;<br>
1481063344.143&nbsp;&nbsp;60719&nbsp;10.0.0.38&nbsp;TCP_TUNNEL/200&nbsp;6389&nbsp;CONNECT&lt;br&nbsp;class=&quot;&quot;&gt;<br>
pipe.skype.com:443&nbsp;-&nbsp;ORIGINAL_DST/104.208.31.113&nbsp;-&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
a&nbsp;new&nbsp;set&nbsp;showed&nbsp;up...&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
what&nbsp;more&nbsp;can&nbsp;we&nbsp;do?&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
keep&nbsp;adding&nbsp;ip&nbsp;ranges?&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
thanks&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&nbsp;&nbsp;Piensa&nbsp;en&nbsp;el&nbsp;medio&nbsp;ambiente&nbsp;antes&nbsp;de&nbsp;imprimir&nbsp;este&nbsp;email.&lt;br&nbsp;class=&quot;&quot;&gt;<br>
________________________________________&lt;br&nbsp;class=&quot;&quot;&gt;<br>
From:&nbsp;Eliezer&nbsp;Croitoru&nbsp;&lt;mailto:eliezer@ngtech.co.il&gt;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Sent:&nbsp;Tuesday,&nbsp;December&nbsp;6,&nbsp;2016&nbsp;4:36:56&nbsp;PM&lt;br&nbsp;class=&quot;&quot;&gt;<br>
To:&nbsp;Sameh&nbsp;Onaissi&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Cc:&nbsp;'Amos&nbsp;Jeffries';&nbsp;mailto:squid-users@lists.squid-cache.org&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Subject:&nbsp;RE:&nbsp;[squid-users]&nbsp;Skype&nbsp;for&nbsp;Business&nbsp;behind&nbsp;a&nbsp;transparent&nbsp;squid&lt;br&nbsp;class=&quot;&quot;&gt;<br>
(TProxy)&nbsp;HTTP/S&nbsp;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&nbsp;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Try&nbsp;the&nbsp;next&nbsp;script:&lt;br&nbsp;class=&quot;&quot;&gt;<br>
https://gist.github.com/elico/a54c2c8f8e1a2407b42210896b960f4b&nbsp;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
https://gist.github.com/elico/a54c2c8f8e1a2407b42210896b960f4b&lt;br&nbsp;class=&quot;&quot;&gt;<br>
https://gist.github.com/elico/a54c2c8f8e1a2407b42210896b960f4b&lt;br&nbsp;class=&quot;&quot;&gt;<br>
gist.github.com&lt;br&nbsp;class=&quot;&quot;&gt;<br>
bypass&nbsp;squid&nbsp;interception&nbsp;for&nbsp;skype&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
It&nbsp;has&nbsp;two&nbsp;modes:&nbsp;regular&nbsp;and&nbsp;tproxy.&lt;br&nbsp;class=&quot;&quot;&gt;<br>
In&nbsp;your&nbsp;case&nbsp;you&nbsp;should&nbsp;run&nbsp;the&nbsp;script&nbsp;with:&lt;br&nbsp;class=&quot;&quot;&gt;<br>
$&nbsp;bypass-skype-cidr.sh&nbsp;tproxy&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
The&nbsp;tproxy&nbsp;flag&nbsp;should&nbsp;do&nbsp;the&nbsp;trick&nbsp;for&nbsp;you.&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Let&nbsp;me&nbsp;know&nbsp;if&nbsp;it&nbsp;works&nbsp;for&nbsp;you.&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Eliezer&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
----&lt;br&nbsp;class=&quot;&quot;&gt;<br>
http://ngtech.co.il/lmgtfy/&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Linux&nbsp;System&nbsp;Administrator&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Mobile:&nbsp;&#43;972-5-28704261&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Email:&nbsp;mailto:eliezer@ngtech.co.il&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
From:&nbsp;Sameh&nbsp;Onaissi&nbsp;[mailto:sameh.onaissi@solcv.com]&nbsp;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Sent:&nbsp;Tuesday,&nbsp;December&nbsp;6,&nbsp;2016&nbsp;9:24&nbsp;PM&lt;br&nbsp;class=&quot;&quot;&gt;<br>
To:&nbsp;Eliezer&nbsp;Croitoru&nbsp;&lt;mailto:eliezer@ngtech.co.il&gt;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Cc:&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;mailto:squid3@treenet.co.nz&gt;;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
mailto:squid-users@lists.squid-cache.org&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Subject:&nbsp;Re:&nbsp;[squid-users]&nbsp;Skype&nbsp;for&nbsp;Business&nbsp;behind&nbsp;a&nbsp;transparent&nbsp;squid&lt;br&nbsp;class=&quot;&quot;&gt;<br>
(TProxy)&nbsp;HTTP/S&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Yes&nbsp;please,&nbsp;I&nbsp;would&nbsp;appreciate&nbsp;help&nbsp;with&nbsp;that&nbsp;script.&nbsp;&nbsp;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
As&nbsp;I&nbsp;aforementioned,&nbsp;totally&nbsp;new&nbsp;to&nbsp;all&nbsp;this&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Piensa&nbsp;en&nbsp;el&nbsp;medio&nbsp;ambiente&nbsp;antes&nbsp;de&nbsp;imprimir&nbsp;este&nbsp;email.&nbsp;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
On&nbsp;Dec&nbsp;6,&nbsp;2016,&nbsp;at&nbsp;1:27&nbsp;PM,&nbsp;Eliezer&nbsp;Croitoru&nbsp;&lt;mailto:eliezer@ngtech.co.il&gt;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
wrote:&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Now&nbsp;you&nbsp;can&nbsp;enhance&nbsp;the&nbsp;script&nbsp;by&nbsp;adding&nbsp;manually&nbsp;the&nbsp;ntop&nbsp;skype&nbsp;related&lt;br&nbsp;class=&quot;&quot;&gt;<br>
networks&nbsp;based&nbsp;on:&lt;br&nbsp;class=&quot;&quot;&gt;<br>
https://github.com/ntop/nDPI/blob/d9a2d9a6bd4d476d666d26cb713952760a975d92/s&lt;br&nbsp;class=&quot;&quot;&gt;<br>
rc/lib/ndpi_content_match.c.inc#L286&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
/*&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Skype&nbsp;(Microsoft&nbsp;CDN)&lt;br&nbsp;class=&quot;&quot;&gt;<br>
157.56.135.64/26,&nbsp;157.56.185.0/26,&nbsp;157.56.52.0/26,&lt;br&nbsp;class=&quot;&quot;&gt;<br>
157.56.53.128/25,&nbsp;157.56.198.0/26&lt;br&nbsp;class=&quot;&quot;&gt;<br>
157.60.0.0/16,&nbsp;157.54.0.0/15&nbsp;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
13.107.3.128/32&lt;br&nbsp;class=&quot;&quot;&gt;<br>
13.107.3.129/32&lt;br&nbsp;class=&quot;&quot;&gt;<br>
111.221.64.0&nbsp;-&nbsp;111.221.127.255&lt;br&nbsp;class=&quot;&quot;&gt;<br>
91.190.216.0/21&nbsp;(AS198015&nbsp;Skype&nbsp;Communications&nbsp;Sarl)&lt;br&nbsp;class=&quot;&quot;&gt;<br>
91.190.218.0/24&lt;br&nbsp;class=&quot;&quot;&gt;<br>
40.126.129.109/32&lt;br&nbsp;class=&quot;&quot;&gt;<br>
65.55.223.0/26&lt;br&nbsp;class=&quot;&quot;&gt;<br>
*/&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
If&nbsp;you&nbsp;need&nbsp;help&nbsp;scripting&nbsp;this&nbsp;let&nbsp;me&nbsp;know.&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Eliezer&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
----&lt;br&nbsp;class=&quot;&quot;&gt;<br>
http://ngtech.co.il/lmgtfy/&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Linux&nbsp;System&nbsp;Administrator&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Mobile:&nbsp;&#43;972-5-28704261&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Email:&nbsp;mailto:eliezer@ngtech.co.il&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
From:&nbsp;Sameh&nbsp;Onaissi&nbsp;[mailto:sameh.onaissi@solcv.com]&nbsp;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Sent:&nbsp;Tuesday,&nbsp;December&nbsp;6,&nbsp;2016&nbsp;7:29&nbsp;PM&lt;br&nbsp;class=&quot;&quot;&gt;<br>
To:&nbsp;Eliezer&nbsp;Croitoru&nbsp;&lt;mailto:eliezer@ngtech.co.il&gt;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Cc:&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;mailto:squid3@treenet.co.nz&gt;;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
mailto:squid-users@lists.squid-cache.org&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Subject:&nbsp;Re:&nbsp;[squid-users]&nbsp;Skype&nbsp;for&nbsp;Business&nbsp;behind&nbsp;a&nbsp;transparent&nbsp;squid&lt;br&nbsp;class=&quot;&quot;&gt;<br>
(TProxy)&nbsp;HTTP/S&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Hello,&nbsp;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
OK,&nbsp;I&nbsp;added&nbsp;the&nbsp;ssl_bump&nbsp;slice&nbsp;on&nbsp;the&nbsp;skype&nbsp;domains&nbsp;text&nbsp;file&lt;br&nbsp;class=&quot;&quot;&gt;<br>
I&nbsp;installed&nbsp;ipset&nbsp;and&nbsp;ran&nbsp;the&nbsp;script.&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Now&nbsp;access.log&nbsp;has&nbsp;much&nbsp;less&nbsp;skype&nbsp;related&nbsp;logs:&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
What&nbsp;is&nbsp;left&nbsp;is:&lt;br&nbsp;class=&quot;&quot;&gt;<br>
1481044996.398&nbsp;&nbsp;&nbsp;3412&nbsp;10.0.0.11&nbsp;TAG_NONE/200&nbsp;0&nbsp;CONNECT&nbsp;132.245.1.32:443&nbsp;-&lt;br&nbsp;class=&quot;&quot;&gt;<br>
ORIGINAL_DST/132.245.1.32&nbsp;-&lt;br&nbsp;class=&quot;&quot;&gt;<br>
1481044996.423&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;10.0.0.11&nbsp;TAG_NONE/400&nbsp;3998&nbsp;REGISTER&lt;br&nbsp;class=&quot;&quot;&gt;<br>
sip:solcv.comSIP/2.0&nbsp;-&nbsp;HIER_NONE/-&nbsp;text/html&lt;br&nbsp;class=&quot;&quot;&gt;<br>
1481045000.296&nbsp;&nbsp;&nbsp;&nbsp;372&nbsp;10.0.0.11&nbsp;TAG_NONE/200&nbsp;0&nbsp;CONNECT&nbsp;134.170.113.207:443&nbsp;-&lt;br&nbsp;class=&quot;&quot;&gt;<br>
ORIGINAL_DST/134.170.113.207&nbsp;-&lt;br&nbsp;class=&quot;&quot;&gt;<br>
1481045000.325&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;10.0.0.11&nbsp;TAG_NONE/400&nbsp;3998&nbsp;REGISTER&lt;br&nbsp;class=&quot;&quot;&gt;<br>
sip:solcv.comSIP/2.0&nbsp;-&nbsp;HIER_NONE/-&nbsp;text/html&lt;br&nbsp;class=&quot;&quot;&gt;<br>
1481045008.685&nbsp;&nbsp;&nbsp;4259&nbsp;10.0.0.11&nbsp;TAG_NONE/200&nbsp;0&nbsp;CONNECT&nbsp;134.170.113.207:443&nbsp;-&lt;br&nbsp;class=&quot;&quot;&gt;<br>
ORIGINAL_DST/134.170.113.207&nbsp;-&lt;br&nbsp;class=&quot;&quot;&gt;<br>
1481045008.726&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;10.0.0.11&nbsp;TAG_NONE/400&nbsp;3998&nbsp;REGISTER&lt;br&nbsp;class=&quot;&quot;&gt;<br>
sip:solcv.comSIP/2.0&nbsp;-&nbsp;HIER_NONE/-&nbsp;text/html&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
although&nbsp;http://solve.com&nbsp;is&nbsp;in&nbsp;the&nbsp;text&nbsp;file.&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
I&nbsp;ran&nbsp;whois&nbsp;on&nbsp;the&nbsp;first&nbsp;IP&nbsp;and&nbsp;got:&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
NetRange:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;132.245.0.0&nbsp;-&nbsp;132.245.255.255&lt;br&nbsp;class=&quot;&quot;&gt;<br>
CIDR:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;132.245.0.0/16&lt;br&nbsp;class=&quot;&quot;&gt;<br>
NetName:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MICROSOFT&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Same&nbsp;with&nbsp;the&nbsp;134.170.&nbsp;address.&nbsp;Can&nbsp;we&nbsp;slice&nbsp;that&nbsp;range?&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Sameh&nbsp;Onaissi&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Ingeniero&nbsp;de&nbsp;Soporte&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Sol&nbsp;Cable&nbsp;Visión&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Cel:&nbsp;316-3023424&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Email:&nbsp;mailto:sameh.onaissi@solcv.com&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Piensa&nbsp;en&nbsp;el&nbsp;medio&nbsp;ambiente&nbsp;antes&nbsp;de&nbsp;imprimir&nbsp;este&nbsp;email.&nbsp;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
On&nbsp;Dec&nbsp;6,&nbsp;2016,&nbsp;at&nbsp;12:11&nbsp;PM,&nbsp;Eliezer&nbsp;Croitoru&nbsp;&lt;mailto:eliezer@ngtech.co.il&gt;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
wrote:&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Hey,&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Depends&nbsp;on&nbsp;your&nbsp;OS&nbsp;you&nbsp;will&nbsp;need&nbsp;to&nbsp;installthe&nbsp;&nbsp;ipset&nbsp;package.&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Try&nbsp;to&nbsp;run&nbsp;&quot;apt-get&nbsp;install&nbsp;ipset&quot;.&lt;br&nbsp;class=&quot;&quot;&gt;<br>
And&nbsp;then&nbsp;run&nbsp;the&nbsp;script.&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Eliezer&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
----&lt;br&nbsp;class=&quot;&quot;&gt;<br>
http://ngtech.co.il/lmgtfy/&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Linux&nbsp;System&nbsp;Administrator&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Mobile:&nbsp;&#43;972-5-28704261&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Email:&nbsp;mailto:eliezer@ngtech.co.il&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;Untitled&nbsp;Attachment&nbsp;1.jpg&gt;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
From:&nbsp;Sameh&nbsp;Onaissi&nbsp;[mailto:sameh.onaissi@solcv.com]&nbsp;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Sent:&nbsp;Tuesday,&nbsp;December&nbsp;6,&nbsp;2016&nbsp;5:23&nbsp;PM&lt;br&nbsp;class=&quot;&quot;&gt;<br>
To:&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;mailto:squid3@treenet.co.nz&gt;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Cc:&nbsp;Eliezer&nbsp;Croitoru&nbsp;&lt;mailto:eliezer@ngtech.co.il&gt;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Subject:&nbsp;Re:&nbsp;[squid-users]&nbsp;Skype&nbsp;for&nbsp;Business&nbsp;behind&nbsp;a&nbsp;transparent&nbsp;squid&lt;br&nbsp;class=&quot;&quot;&gt;<br>
(TProxy)&nbsp;HTTP/S&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Amos,&nbsp;thanks&nbsp;for&nbsp;the&nbsp;reply.&nbsp;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
This&nbsp;is&nbsp;getting&nbsp;more&nbsp;confusing.&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
I&nbsp;changed&nbsp;the&nbsp;script&nbsp;to:&nbsp;http://pastebin.com/jLgywstg&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
And&nbsp;I&nbsp;ran&nbsp;it,&nbsp;but&nbsp;I&nbsp;am&nbsp;getting&nbsp;errors:&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
sudo&nbsp;sh&nbsp;http://bypass.sh/&nbsp;&#43;&nbsp;iptables&nbsp;-t&nbsp;mangle&nbsp;-L&nbsp;PREROUTING&nbsp;&#43;&nbsp;grep&lt;br&nbsp;class=&quot;&quot;&gt;<br>
bypasspool&nbsp;&#43;&nbsp;[&nbsp;1&nbsp;-ne&nbsp;0&nbsp;]&nbsp;&#43;&nbsp;iptables&nbsp;-t&nbsp;mangle&nbsp;-I&nbsp;PREROUTING&nbsp;-m&nbsp;set&lt;br&nbsp;class=&quot;&quot;&gt;<br>
--match-set&nbsp;bypasspool&nbsp;dst,src&nbsp;-j&nbsp;DIVERT&nbsp;iptables&nbsp;http://v1.6.0/&nbsp;Set&lt;br&nbsp;class=&quot;&quot;&gt;<br>
bypasspool&nbsp;doesn't&nbsp;exist.&nbsp;Try&nbsp;`iptables&nbsp;-h'&nbsp;or&nbsp;'iptables&nbsp;--help'&nbsp;for&nbsp;more&lt;br&nbsp;class=&quot;&quot;&gt;<br>
information.&nbsp;&#43;&nbsp;ipset&nbsp;create&nbsp;bypasspool&nbsp;hash:ip&nbsp;http://bypass.sh/&nbsp;10:&lt;br&nbsp;class=&quot;&quot;&gt;<br>
http://bypass.sh/&nbsp;ipset:&nbsp;not&nbsp;found&nbsp;&#43;&nbsp;read&nbsp;item&nbsp;&#43;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
echohttp://lyncdiscover.solcv.com/&nbsp;http://lyncdiscover.solcv.com/&nbsp;&#43;&nbsp;host&nbsp;-4&lt;br&nbsp;class=&quot;&quot;&gt;<br>
http://lyncdiscover.solcv.com/&nbsp;&#43;&nbsp;grep&nbsp;has&nbsp;address&nbsp;&#43;&nbsp;awk&nbsp;{print&nbsp;$4}&nbsp;&#43;&nbsp;xargs&lt;br&nbsp;class=&quot;&quot;&gt;<br>
-l1&nbsp;ipset&nbsp;add&nbsp;bypasspool&nbsp;xargs:&nbsp;ipset:&nbsp;No&nbsp;such&nbsp;file&nbsp;or&nbsp;directory&nbsp;&#43;&nbsp;read&nbsp;item&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&#43;&nbsp;echo&nbsp;http://webdir0a.online.lync.com/http://webdir0a.online.lync.com/&nbsp;&#43;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
host&nbsp;-4&nbsp;http://webdir0a.online.lync.com/&nbsp;&#43;&nbsp;grep&nbsp;has&nbsp;address&nbsp;&#43;&nbsp;awk&nbsp;{print&nbsp;$4}&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&#43;&nbsp;xargs&nbsp;-l1&nbsp;ipset&nbsp;add&nbsp;bypasspool&nbsp;xargs:&nbsp;ipset:&nbsp;No&nbsp;such&nbsp;file&nbsp;or&nbsp;directory&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
.&nbsp;this&nbsp;goes&nbsp;on&nbsp;the&nbsp;same&nbsp;for&nbsp;all&nbsp;the&nbsp;domains&nbsp;in&nbsp;the&nbsp;text&nbsp;file&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
My&nbsp;iptables&nbsp;is&nbsp;still&nbsp;&lt;http://pastebin.com/SqpbmYQQ&gt;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
I&nbsp;did&nbsp;not&nbsp;quite&nbsp;understand&nbsp;what&nbsp;you&nbsp;meant&nbsp;by&nbsp;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
You&nbsp;should&nbsp;test&nbsp;whether&nbsp;-m&nbsp;set&nbsp;or&nbsp;-m&nbsp;socket&nbsp;work&nbsp;faster&nbsp;and&nbsp;put&nbsp;that&nbsp;one&lt;br&nbsp;class=&quot;&quot;&gt;<br>
first.&nbsp;My&nbsp;change&nbsp;above&nbsp;places&nbsp;it&nbsp;at&nbsp;line&nbsp;2&nbsp;(after&nbsp;-m&nbsp;socket)&nbsp;assuming&lt;br&nbsp;class=&quot;&quot;&gt;<br>
your&nbsp;iptables&nbsp;script&nbsp;is&nbsp;still&nbsp;&lt;http://pastebin.com/SqpbmYQQ&gt;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
should&nbsp;I&nbsp;incorporate&nbsp;the&nbsp;bypass&nbsp;script&nbsp;into&nbsp;my&nbsp;iptables.sh&nbsp;script?&nbsp;run&lt;br&nbsp;class=&quot;&quot;&gt;<br>
iptables&nbsp;first&nbsp;then&nbsp;bypass?&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
On&nbsp;a&nbsp;side&nbsp;note,&nbsp;would&nbsp;adding&nbsp;ssl_bump&nbsp;exceptions&nbsp;to&nbsp;squid.conf&nbsp;do&nbsp;it?&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Something&nbsp;like:&nbsp;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
acl&nbsp;skype_domains&nbsp;&lt;path&nbsp;to&nbsp;file&gt;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
ssl_bump&nbsp;splice&nbsp;skype_domains&lt;br&nbsp;class=&quot;&quot;&gt;<br>
ssl_bump&nbsp;bump&nbsp;all&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Again,&nbsp;thanks&nbsp;again&nbsp;for&nbsp;your&nbsp;help.&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;Untitled&nbsp;Attachment&nbsp;2.jpg&gt;&nbsp;Piensa&nbsp;en&nbsp;el&nbsp;medio&nbsp;ambiente&nbsp;antes&nbsp;de&nbsp;imprimir&lt;br&nbsp;class=&quot;&quot;&gt;<br>
este&nbsp;email.&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
On&nbsp;Dec&nbsp;6,&nbsp;2016,&nbsp;at&nbsp;9:50&nbsp;AM,&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;mailto:squid3@treenet.co.nz&gt;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
wrote:&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
On&nbsp;7/12/2016&nbsp;3:19&nbsp;a.m.,&nbsp;Sameh&nbsp;Onaissi&nbsp;wrote:&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Hello,&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
I&nbsp;tried&nbsp;doing&nbsp;the&nbsp;changes&nbsp;to&nbsp;nat/REDIRECT&nbsp;in&nbsp;iptables.sh&nbsp;and&nbsp;I&nbsp;must&nbsp;have&lt;br&nbsp;class=&quot;&quot;&gt;<br>
messed&nbsp;up&nbsp;somewhere,&nbsp;so&nbsp;I&nbsp;am&nbsp;sticking&nbsp;with&nbsp;mangle/tproxy&nbsp;for&nbsp;now&nbsp;since&nbsp;squid&lt;br&nbsp;class=&quot;&quot;&gt;<br>
is&nbsp;working&nbsp;with&nbsp;them.&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
How&nbsp;can&nbsp;I&nbsp;change&nbsp;Eliezer's&nbsp;script&nbsp;to&nbsp;mangle/tproxy?&lt;br&nbsp;class=&quot;&quot;&gt;<br>
https://gist.github.com/elico/e0faadf0cc63942c5aaade808a87deef&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Excuse&nbsp;my&nbsp;novice&nbsp;knowledge&nbsp;in&nbsp;iptables.&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
No&nbsp;worries.&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
You&nbsp;need&nbsp;to&nbsp;change&nbsp;where&nbsp;iptables&nbsp;attaches&nbsp;the&nbsp;'bypasspool'.&nbsp;Both&nbsp;the&lt;br&nbsp;class=&quot;&quot;&gt;<br>
table/location&nbsp;(-t)&nbsp;and&nbsp;the&nbsp;jump/action&nbsp;(-j).&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
iptables&nbsp;-t&nbsp;mangle&nbsp;-L&nbsp;PREROUTING&nbsp;|grep&nbsp;bypasspool&lt;br&nbsp;class=&quot;&quot;&gt;<br>
if&nbsp;[&nbsp;&quot;$?&quot;&nbsp;-ne&nbsp;&quot;0&quot;&nbsp;];then&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&nbsp;&nbsp;iptables&nbsp;-t&nbsp;mangle&nbsp;-I&nbsp;2&nbsp;PREROUTING&nbsp;\&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;-m&nbsp;set&nbsp;--match-set&nbsp;bypasspool&nbsp;dst,src&nbsp;\&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;-j&nbsp;DIVERT&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
fi&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
You&nbsp;should&nbsp;test&nbsp;whether&nbsp;-m&nbsp;set&nbsp;or&nbsp;-m&nbsp;socket&nbsp;work&nbsp;faster&nbsp;and&nbsp;put&nbsp;that&nbsp;one&lt;br&nbsp;class=&quot;&quot;&gt;<br>
first.&nbsp;My&nbsp;change&nbsp;above&nbsp;places&nbsp;it&nbsp;at&nbsp;line&nbsp;2&nbsp;(after&nbsp;-m&nbsp;socket)&nbsp;assuming&lt;br&nbsp;class=&quot;&quot;&gt;<br>
your&nbsp;iptables&nbsp;script&nbsp;is&nbsp;still&nbsp;&lt;http://pastebin.com/SqpbmYQQ&gt;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
(Your&nbsp;script&nbsp;should&nbsp;do&nbsp;that&nbsp;line&nbsp;adding,&nbsp;not&nbsp;Eliezers&nbsp;-&nbsp;so&nbsp;that&nbsp;you&nbsp;can&lt;br&nbsp;class=&quot;&quot;&gt;<br>
be&nbsp;sure&nbsp;the&nbsp;order&nbsp;is&nbsp;always&nbsp;correct).&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
BTW:&nbsp;you&nbsp;should&nbsp;use&nbsp;iptables-save&nbsp;/&nbsp;iptables-restore&nbsp;instead&nbsp;of&nbsp;a&nbsp;slow&lt;br&nbsp;class=&quot;&quot;&gt;<br>
script&nbsp;calling&nbsp;iptables&nbsp;&quot;manually&quot;.&nbsp;Those&nbsp;other&nbsp;tools&nbsp;will&nbsp;ensure&nbsp;there&lt;br&nbsp;class=&quot;&quot;&gt;<br>
are&nbsp;no&nbsp;gaps&nbsp;in&nbsp;the&nbsp;firewall&nbsp;initialization&nbsp;for&nbsp;nasty&nbsp;traffic&nbsp;to&nbsp;sneak&lt;br&nbsp;class=&quot;&quot;&gt;<br>
through.&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
I&nbsp;am&nbsp;looking&nbsp;at&nbsp;access.log&nbsp;to&nbsp;collect&nbsp;all&nbsp;domains&nbsp;I&nbsp;see&nbsp;heading&nbsp;to&nbsp;skype&nbsp;for&lt;br&nbsp;class=&quot;&quot;&gt;<br>
business,&nbsp;as&nbsp;well&nbsp;as&nbsp;IPs.&nbsp;My&nbsp;question&nbsp;is,&nbsp;can&nbsp;I&nbsp;add&nbsp;the&nbsp;domains&nbsp;AND&nbsp;IPs&nbsp;into&lt;br&nbsp;class=&quot;&quot;&gt;<br>
the&nbsp;domains-to-bypass.txt&nbsp;that&nbsp;the&nbsp;above&nbsp;script&nbsp;uses?&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
IIRC&nbsp;you&nbsp;should&nbsp;be&nbsp;able&nbsp;to&nbsp;use&nbsp;domain&nbsp;as&nbsp;the&nbsp;parameter&nbsp;to&nbsp;ipset.&nbsp;But&nbsp;it&lt;br&nbsp;class=&quot;&quot;&gt;<br>
will&nbsp;resolve&nbsp;the&nbsp;domain&nbsp;immediately&nbsp;and&nbsp;only&nbsp;add&nbsp;those&nbsp;IPs&nbsp;that&nbsp;it&nbsp;finds&lt;br&nbsp;class=&quot;&quot;&gt;<br>
at&nbsp;that&nbsp;time&nbsp;into&nbsp;the&nbsp;pool.&nbsp;Any&nbsp;future&nbsp;changes,&nbsp;or&nbsp;a&nbsp;hidden&nbsp;set&nbsp;of&nbsp;IPs&lt;br&nbsp;class=&quot;&quot;&gt;<br>
that&nbsp;rotate&nbsp;in/out&nbsp;will&nbsp;not&nbsp;be&nbsp;listed.&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
Amos&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/div&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;/div&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
