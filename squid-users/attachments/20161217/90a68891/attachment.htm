<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;Here&nbsp;is&nbsp;some&nbsp;information&nbsp;about&nbsp;my&nbsp;squid&nbsp;version,&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;Squid&nbsp;Cache:&nbsp;Version&nbsp;3.5.22-20161115-r14113&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;Service&nbsp;Name:&nbsp;squid&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;configure&nbsp;options:&nbsp; &#39;--prefix=/usr&#39;&nbsp;&#39;--localstatedir=/var/squid&#39;&nbsp;&#39;--libexecdir=/lib/squid&#39;&nbsp;&#39;--srcdir=.&#39;&nbsp;&#39;--datadir=/share/squid&#39;&nbsp;&#39;--sysconfdir=/etc/squid&#39;&nbsp;&#39;--with-default-user=proxy&#39;&nbsp;&#39;--with-logdir=/var/log/squid&#39;&nbsp;&#39;--with-pidfile=/var/run/&lt;wbr&gt;squid.pid&#39;&nbsp;&#39;--with-openssl&#39;&nbsp;&#39;--enable-ssl-crtd&#39;&nbsp;&#39;--enable-inline&#39;&nbsp;&#39;--disable-arch-native&#39;&nbsp;&#39;--enable-async-io=8&#39;&nbsp;&#39;--enable-storeio=ufs,aufs,&lt;wbr&gt;diskd,rock&#39;&nbsp;&#39;--enable-removal-policies=&lt;wbr&gt;lru,heap&#39;&nbsp;&#39;--enable-delay-pools&#39;&nbsp;&#39;--enable-follow-x-forwarded-&lt;wbr&gt;for&#39;&nbsp;&#39;--enable-url-rewrite-helpers=&lt;wbr&gt;fake&#39;&nbsp;&#39;--enable-ecap&#39;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;My&nbsp;squid&nbsp;config&nbsp;file&nbsp;is&nbsp;located&nbsp;at, &lt;a&nbsp;href=&quot;http://pastebin.com/raw/LvDxEF4x&quot;&nbsp;target=&quot;_blank&quot;&gt;http://pastebin.com/raw/&lt;wbr&gt;LvDxEF4x&lt;/a&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;Now&nbsp;the&nbsp;issue&nbsp;is&nbsp;whenever&nbsp;someone&nbsp;requests&nbsp;a&nbsp;page&nbsp;which&nbsp;contains&nbsp;web&nbsp;socket&nbsp;requests&nbsp;response&nbsp;is&nbsp;always&nbsp;bad&nbsp;request. &lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;Here&nbsp;is&nbsp;an&nbsp;example,&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;Request&nbsp;URL:wss://&lt;a&nbsp;href=&quot;http://w4.web.whatsapp.com/ws&quot;&nbsp;target=&quot;_blank&quot;&gt;w4.web.whatsapp.com/&lt;wbr&gt;ws&lt;/a&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;Request&nbsp;Method:GET&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;Status&nbsp;Code:400&nbsp;Bad&nbsp;Request&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;Response&nbsp;Headers&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;#################&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;Connection:keep-alive&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;Date:Sat,&nbsp;17&nbsp;Dec&nbsp;2016&nbsp;09:05:36&nbsp;GMT&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;Transfer-Encoding:chunked&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;X-Cache:MISS&nbsp;from&nbsp;Proxy&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;Request&nbsp;Headers&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;#################&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;Accept-Encoding:gzip,&nbsp;deflate,&nbsp;sdch,&nbsp;br&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;Accept-Language:en-US,en;q=0.8&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;Cache-Control:no-cache&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;Connection:Upgrade&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;Host:&lt;a&nbsp;href=&quot;http://w4.web.whatsapp.com/&quot;&nbsp;target=&quot;_blank&quot;&gt;w4.web.whatsapp.com&lt;/a&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;Origin:&lt;a&nbsp;href=&quot;https://web.whatsapp.com/&quot;&nbsp;target=&quot;_blank&quot;&gt;https://web.whatsapp.&lt;wbr&gt;com&lt;/a&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;Pragma:no-cache&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;Sec-WebSocket-Extensions:&lt;wbr&gt;permessage-deflate;&nbsp;client_max_window_bits&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;Sec-WebSocket-Key:&lt;wbr&gt;kzrB2ZcMHDAqvjDNXnjL/w==&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;Sec-WebSocket-Version:13&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;Upgrade:websocket&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;User-Agent:Mozilla/5.0&nbsp;(X11;&nbsp;Linux&nbsp;x86_64)&nbsp;AppleWebKit/537.36&nbsp;(KHTML,&nbsp;like&nbsp;Gecko)&nbsp;Chrome/55.0.2883.75&nbsp;Safari/537.36&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;My&nbsp;question&nbsp;is&nbsp;how&nbsp;we&nbsp;can&nbsp;work&nbsp;with&nbsp;web&nbsp;socket&nbsp;requests&nbsp;in&nbsp;squid&nbsp;or&nbsp;if&nbsp;not&nbsp;by&nbsp;pass&nbsp;them&nbsp;squid.&nbsp;My&nbsp;squid&nbsp;instance&nbsp;is&nbsp;in&nbsp;interception&nbsp;mode&nbsp;and&nbsp;requests&nbsp;are&nbsp;intercepted&nbsp;at&nbsp;instance&nbsp;via&nbsp;iptables&nbsp;and&nbsp;forwarded&nbsp;to&nbsp;squid&nbsp;using&nbsp;below&nbsp;rules,&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;div&gt;SQUIDIP=192.168.1.1&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#&nbsp;your&nbsp;proxy&nbsp;listening&nbsp;port&lt;/div&gt;&lt;div&gt;SQUIDHTTPPORT=3128&lt;/div&gt;&lt;div&gt;SQUIDHTTPSPORT=3129&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;iptables&nbsp;-t&nbsp;nat&nbsp;-A&nbsp;PREROUTING&nbsp;-s&nbsp;$SQUIDIP&nbsp;-p&nbsp;tcp&nbsp;--dport&nbsp;80&nbsp;-j&nbsp;ACCEPT&lt;/div&gt;&lt;div&gt;iptables&nbsp;-t&nbsp;nat&nbsp;-A&nbsp;PREROUTING&nbsp;-p&nbsp;tcp&nbsp;--dport&nbsp;80&nbsp;-j&nbsp;REDIRECT&nbsp;--to-port&nbsp;$SQUIDHTTPPORT&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;iptables&nbsp;-t&nbsp;nat&nbsp;-A&nbsp;PREROUTING&nbsp;-s&nbsp;$SQUIDIP&nbsp;-p&nbsp;tcp&nbsp;--dport&nbsp;443&nbsp;-j&nbsp;ACCEPT&lt;/div&gt;&lt;div&gt;iptables&nbsp;-t&nbsp;nat&nbsp;-A&nbsp;PREROUTING&nbsp;-p&nbsp;tcp&nbsp;--dport&nbsp;443&nbsp;-j&nbsp;REDIRECT&nbsp;--to-port&nbsp;$SQUIDHTTPSPORT&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;iptables&nbsp;-t&nbsp;nat&nbsp;-A&nbsp;POSTROUTING&nbsp;-j&nbsp;MASQUERADE&lt;/div&gt;&lt;div&gt;iptables&nbsp;-t&nbsp;mangle&nbsp;-A&nbsp;PREROUTING&nbsp;-p&nbsp;tcp&nbsp;--dport&nbsp;$SQUIDHTTPPORT&nbsp;-j&nbsp;DROP&lt;/div&gt;&lt;div&gt;iptables&nbsp;-t&nbsp;mangle&nbsp;-A&nbsp;PREROUTING&nbsp;-p&nbsp;tcp&nbsp;--dport&nbsp;$SQUIDHTTPSPORT&nbsp;-j&nbsp;DROP&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;If&nbsp;anyone&nbsp;can&nbsp;help&nbsp;me&nbsp;with&nbsp;this&nbsp;it&nbsp;would&nbsp;be&nbsp;really&nbsp;awesome.&nbsp;Thanks&nbsp;for&nbsp;your&nbsp;support.&lt;/div&gt;&lt;/div&gt;<br>

</tt>
