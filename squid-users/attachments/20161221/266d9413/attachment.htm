<tt>
&lt;html&gt;<br>
&lt;head&gt;<br>
&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=gb2312&quot;&gt;<br>
&lt;style&nbsp;type=&quot;text/css&quot;&nbsp;style=&quot;display:none;&quot;&gt;&lt;!--&nbsp;P&nbsp;{margin-top:0;margin-bottom:0;}&nbsp;--&gt;&lt;/style&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;dir=&quot;ltr&quot;&gt;<br>
&lt;div&nbsp;id=&quot;divtagdefaultwrapper&quot;&nbsp;style=&quot;font-size:12pt;color:#000000;font-family:Calibri,Arial,Helvetica,sans-serif;&quot;&nbsp;dir=&quot;ltr&quot;&gt;<br>
&lt;p&gt;Hi&nbsp;Alex,&lt;/p&gt;<br>
&lt;p&gt;&lt;br&gt;<br>
&lt;/p&gt;<br>
&lt;p&gt;Many&nbsp;thanks&nbsp;for&nbsp;your&nbsp;reply&nbsp;and&nbsp;sorry&nbsp;for&nbsp;the&nbsp;&lt;span&gt;misleading.&nbsp;&lt;span&gt;In&nbsp;fact&nbsp;I&nbsp;just&nbsp;want&nbsp;to&nbsp;log&nbsp;the&nbsp;number&nbsp;of&nbsp;encrypted&nbsp;bytes&nbsp;received&nbsp;from&nbsp;the&nbsp;HTTPS&nbsp;client,&nbsp;not&nbsp;the&nbsp;decrypted&nbsp;HTTPS&nbsp;body&nbsp;sizes.&nbsp;Do&nbsp;you&nbsp;know&nbsp;how&nbsp;to&nbsp;do&nbsp;this?&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&gt;&lt;span&gt;&lt;span&gt;&lt;br&gt;<br>
&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&gt;&lt;span&gt;&lt;span&gt;I&nbsp;also&nbsp;build&nbsp;squid&nbsp;&lt;span&gt;3.5.23&nbsp;with&nbsp;default&nbsp;parameter,&nbsp;and&nbsp;seems&nbsp;squid&nbsp;log&nbsp;still&nbsp;ignore&nbsp;the<br>
&lt;span&nbsp;style=&quot;font-family:&nbsp;Calibri,&nbsp;Arial,&nbsp;Helvetica,&nbsp;sans-serif,&nbsp;'Apple&nbsp;Color&nbsp;Emoji',&nbsp;'Segoe&nbsp;UI&nbsp;Emoji',&nbsp;NotoColorEmoji,&nbsp;'Segoe&nbsp;UI&nbsp;Symbol',&nbsp;'Android&nbsp;Emoji',&nbsp;EmojiSymbols;&nbsp;font-size:&nbsp;16px;&quot;&gt;<br>
encrypted&nbsp;bytes(except&nbsp;&quot;CONNECT&quot;&nbsp;header)&lt;/span&gt;&nbsp;that&nbsp;the&nbsp;client&nbsp;send&nbsp;to&nbsp;squid&nbsp;server.&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;&lt;br&gt;<br>
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;Below&nbsp;is&nbsp;two&nbsp;Get&nbsp;and&nbsp;Post&nbsp;commands&nbsp;and&nbsp;you&nbsp;can&nbsp;see&nbsp;there&nbsp;is&nbsp;no&nbsp;difference&nbsp;with&nbsp;their&nbsp;total&nbsp;size(%st&nbsp;3520)&nbsp;in&nbsp;the&nbsp;logs:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;<br>
&lt;span&nbsp;style=&quot;font-family:&nbsp;Calibri,&nbsp;Arial,&nbsp;Helvetica,&nbsp;sans-serif,&nbsp;'Apple&nbsp;Color&nbsp;Emoji',&nbsp;'Segoe&nbsp;UI&nbsp;Emoji',&nbsp;NotoColorEmoji,&nbsp;'Segoe&nbsp;UI&nbsp;Symbol',&nbsp;'Android&nbsp;Emoji',&nbsp;EmojiSymbols;&nbsp;font-size:&nbsp;16px;&quot;&gt;curl&nbsp;--proxy<br>
&lt;span&nbsp;style=&quot;font-family:&nbsp;Calibri,&nbsp;Arial,&nbsp;Helvetica,&nbsp;sans-serif,&nbsp;'Apple&nbsp;Color&nbsp;Emoji',&nbsp;'Segoe&nbsp;UI&nbsp;Emoji',&nbsp;NotoColorEmoji,&nbsp;'Segoe&nbsp;UI&nbsp;Symbol',&nbsp;'Android&nbsp;Emoji',&nbsp;EmojiSymbols;&nbsp;font-size:&nbsp;16px;&quot;&gt;<br>
48.96.17.25:3128&lt;/span&gt;&nbsp;&nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;Calibri,&nbsp;Arial,&nbsp;Helvetica,&nbsp;sans-serif,&nbsp;'Apple&nbsp;Color&nbsp;Emoji',&nbsp;'Segoe&nbsp;UI&nbsp;Emoji',&nbsp;NotoColorEmoji,&nbsp;'Segoe&nbsp;UI&nbsp;Symbol',&nbsp;'Android&nbsp;Emoji',&nbsp;EmojiSymbols;&nbsp;font-size:&nbsp;16px;&quot;&gt;&lt;a&nbsp;href=&quot;https://showip.net&quot;&nbsp;class=&quot;OWAAutoLink&quot;&nbsp;id=&quot;LPlnk970132&quot;&nbsp;previewremoved=&quot;true&quot;&gt;https://showip.net&lt;/a&gt;&lt;/span&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;12pt;&quot;&gt;curl&nbsp;&lt;span&nbsp;style=&quot;font-family:&nbsp;Calibri,&nbsp;Arial,&nbsp;Helvetica,&nbsp;sans-serif,&nbsp;'Apple&nbsp;Color&nbsp;Emoji',&nbsp;'Segoe&nbsp;UI&nbsp;Emoji',&nbsp;NotoColorEmoji,&nbsp;'Segoe&nbsp;UI&nbsp;Symbol',&nbsp;'Android&nbsp;Emoji',&nbsp;EmojiSymbols;&nbsp;font-size:&nbsp;16px;&quot;&gt;<br>
--proxy&nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;Calibri,&nbsp;Arial,&nbsp;Helvetica,&nbsp;sans-serif,&nbsp;'Apple&nbsp;Color&nbsp;Emoji',&nbsp;'Segoe&nbsp;UI&nbsp;Emoji',&nbsp;NotoColorEmoji,&nbsp;'Segoe&nbsp;UI&nbsp;Symbol',&nbsp;'Android&nbsp;Emoji',&nbsp;EmojiSymbols;&nbsp;font-size:&nbsp;16px;&quot;&gt;48.96.17.25:3128&nbsp;&lt;/span&gt;-d'test'<br>
&lt;/span&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;12pt;&quot;&gt;https://showip.net&lt;/span&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;12pt;&quot;&gt;<br>
&lt;div&gt;1482292236.816&nbsp;&nbsp;&nbsp;1700&nbsp;&lt;span&nbsp;style=&quot;font-family:&nbsp;Calibri,&nbsp;Arial,&nbsp;Helvetica,&nbsp;sans-serif,&nbsp;'Apple&nbsp;Color&nbsp;Emoji',&nbsp;'Segoe&nbsp;UI&nbsp;Emoji',&nbsp;NotoColorEmoji,&nbsp;'Segoe&nbsp;UI&nbsp;Symbol',&nbsp;'Android&nbsp;Emoji',&nbsp;EmojiSymbols;&nbsp;font-size:&nbsp;16px;&quot;&gt;<br>
48.96.17.25&lt;/span&gt;&nbsp;TCP_TUNNEL/200&nbsp;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(255,&nbsp;0,&nbsp;0);&quot;&gt;3408&lt;b&gt;&nbsp;112&nbsp;3520<br>
&lt;/b&gt;0&nbsp;112&lt;/span&gt;&nbsp;CONNECT&nbsp;showip.net:443&nbsp;-&nbsp;HIER_DIRECT/showip.net:23.253.100.206&nbsp;-&lt;/div&gt;<br>
&lt;div&gt;1482292258.735&nbsp;&nbsp;&nbsp;1234&nbsp;&lt;span&nbsp;style=&quot;font-family:&nbsp;Calibri,&nbsp;Arial,&nbsp;Helvetica,&nbsp;sans-serif,&nbsp;'Apple&nbsp;Color&nbsp;Emoji',&nbsp;'Segoe&nbsp;UI&nbsp;Emoji',&nbsp;NotoColorEmoji,&nbsp;'Segoe&nbsp;UI&nbsp;Symbol',&nbsp;'Android&nbsp;Emoji',&nbsp;EmojiSymbols;&nbsp;font-size:&nbsp;16px;&quot;&gt;<br>
48.96.17.25&lt;/span&gt;&nbsp;TCP_TUNNEL/200&nbsp;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(255,&nbsp;0,&nbsp;0);&quot;&gt;3408&lt;b&gt;&nbsp;112&nbsp;3520<br>
&lt;/b&gt;0&nbsp;112&lt;/span&gt;&nbsp;CONNECT&nbsp;showip.net:443&nbsp;-&nbsp;HIER_DIRECT/showip.net:23.253.100.206&nbsp;-&lt;/div&gt;<br>
&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;<br>
&lt;div&gt;&lt;/div&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;logformat&nbsp;in&nbsp;squid.conf&nbsp;is:&lt;/div&gt;<br>
&lt;span&gt;&lt;span&gt;logformat&nbsp;squid&nbsp;%ts.%03tu&nbsp;%6tr&nbsp;%&gt;a&nbsp;%Ss/%03Hs&nbsp;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(255,&nbsp;0,&nbsp;0);&quot;&gt;<br>
%&lt;st&lt;b&gt;&nbsp;%&gt;st&nbsp;%st&nbsp;&lt;/b&gt;%&lt;sh&nbsp;%&gt;sh&lt;/span&gt;&nbsp;%rm&nbsp;%ru&nbsp;%un&nbsp;%Sh/%&lt;A:%&lt;a&nbsp;%mt&lt;/span&gt;&lt;b&gt;&lt;/b&gt;&lt;/span&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
For&nbsp;Https,&nbsp;%&gt;st&nbsp;is&nbsp;&lt;span&nbsp;style=&quot;font-family:&nbsp;Calibri,&nbsp;Arial,&nbsp;Helvetica,&nbsp;sans-serif,&nbsp;'Apple&nbsp;Color&nbsp;Emoji',&nbsp;'Segoe&nbsp;UI&nbsp;Emoji',&nbsp;NotoColorEmoji,&nbsp;'Segoe&nbsp;UI&nbsp;Symbol',&nbsp;'Android&nbsp;Emoji',&nbsp;EmojiSymbols;&nbsp;font-size:&nbsp;16px;&quot;&gt;<br>
supposed&lt;/span&gt;&nbsp;to&nbsp;be&nbsp;&quot;&lt;span&gt;Total&nbsp;bytes&nbsp;received&nbsp;from&nbsp;client&quot;&nbsp;and&nbsp;%st&nbsp;is&nbsp;supposed&nbsp;to&nbsp;be&nbsp;&quot;&lt;span&nbsp;style=&quot;font-family:&nbsp;Calibri,&nbsp;Arial,&nbsp;Helvetica,&nbsp;sans-serif,&nbsp;'Apple&nbsp;Color&nbsp;Emoji',&nbsp;'Segoe&nbsp;UI&nbsp;Emoji',&nbsp;NotoColorEmoji,&nbsp;'Segoe&nbsp;UI&nbsp;Symbol',&nbsp;'Android&nbsp;Emoji',&nbsp;EmojiSymbols;&nbsp;font-size:&nbsp;16px;&quot;&gt;Total<br>
&nbsp;bytes&nbsp;received&nbsp;from&nbsp;client&nbsp;and&nbsp;sent&nbsp;to&nbsp;client&lt;/span&gt;&quot;,&nbsp;right?&nbsp;But&nbsp;why&nbsp;they&nbsp;have&nbsp;no&nbsp;change&nbsp;while&nbsp;the&nbsp;client&nbsp;send&nbsp;more&nbsp;data&nbsp;to&nbsp;squid&nbsp;server?&nbsp;Is&nbsp;this&nbsp;a&nbsp;bug?&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;&lt;span&gt;&lt;/span&gt;Thanks&nbsp;for&nbsp;all&nbsp;your&nbsp;help!&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;Regards,&lt;/div&gt;<br>
&lt;div&gt;Edwin&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;<br>
&lt;div&gt;<br>
&lt;hr&nbsp;tabindex=&quot;-1&quot;&nbsp;style=&quot;display:inline-block;&nbsp;width:98%&quot;&gt;<br>
&lt;div&nbsp;id=&quot;x_divRplyFwdMsg&quot;&nbsp;dir=&quot;ltr&quot;&gt;&lt;font&nbsp;face=&quot;Calibri,&nbsp;sans-serif&quot;&nbsp;color=&quot;#000000&quot;&nbsp;style=&quot;font-size:11pt&quot;&gt;On&nbsp;20&nbsp;December&nbsp;2016&nbsp;at&nbsp;16:38&lt;b&gt;,&lt;/b&gt;&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;rousskov@measurement-factory.com&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;/font&gt;<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;font&nbsp;size=&quot;2&quot;&gt;&lt;span&nbsp;style=&quot;font-size:10pt;&quot;&gt;<br>
&lt;div&nbsp;class=&quot;PlainText&quot;&gt;&gt;&nbsp;I&nbsp;want&nbsp;to&nbsp;calculate&nbsp;all&nbsp;bytes&nbsp;when&nbsp;a&nbsp;request&nbsp;is&nbsp;sent&nbsp;to&nbsp;squid,&lt;br&gt;<br>
&lt;br&gt;<br>
According&nbsp;to&nbsp;squid.conf.documented,&nbsp;you&nbsp;can&nbsp;use&nbsp;the&nbsp;following&nbsp;logformat&lt;br&gt;<br>
%codes&nbsp;to&nbsp;get&nbsp;unencrypted&nbsp;HTTP&nbsp;request&nbsp;sizes:&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;including:&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;&nbsp;1.&nbsp;the&nbsp;header&nbsp;length&nbsp;that&nbsp;client&nbsp;will&nbsp;send&nbsp;to&nbsp;squid&lt;br&gt;<br>
&lt;br&gt;<br>
[&lt;a&nbsp;href=&quot;http::&quot;&gt;http::&lt;/a&gt;]&gt;sh&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Size&nbsp;of&nbsp;request&nbsp;headers&nbsp;received&nbsp;from&nbsp;client&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;&nbsp;2.&nbsp;the&nbsp;post&nbsp;content&nbsp;length&nbsp;that&nbsp;send&nbsp;to&nbsp;squid&lt;br&gt;<br>
&lt;br&gt;<br>
[&lt;a&nbsp;href=&quot;http::&quot;&gt;http::&lt;/a&gt;]&gt;st&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Total&nbsp;size&nbsp;of&nbsp;request&nbsp;received&nbsp;from&nbsp;client.&lt;br&gt;<br>
&lt;br&gt;<br>
minus&lt;br&gt;<br>
&lt;br&gt;<br>
[&lt;a&nbsp;href=&quot;http::&quot;&gt;http::&lt;/a&gt;]&gt;sh&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Size&nbsp;of&nbsp;request&nbsp;headers&nbsp;received&nbsp;from&nbsp;client&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;&nbsp;3.&nbsp;the&nbsp;response&nbsp;length&nbsp;squid&nbsp;will&nbsp;reply&nbsp;to&nbsp;client&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
[&lt;a&nbsp;href=&quot;http::&quot;&gt;http::&lt;/a&gt;]&lt;st&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Total&nbsp;size&nbsp;of&nbsp;reply&nbsp;sent&nbsp;to&nbsp;client&nbsp;(after&nbsp;adaptation)&lt;br&gt;<br>
&lt;br&gt;<br>
minus&lt;br&gt;<br>
&lt;br&gt;<br>
[&lt;a&nbsp;href=&quot;http::&quot;&gt;http::&lt;/a&gt;]&lt;sh&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Size&nbsp;of&nbsp;reply&nbsp;headers&nbsp;sent&nbsp;to&nbsp;client&nbsp;(after&nbsp;adaptation)&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Please&nbsp;note&nbsp;that&nbsp;you&nbsp;need&nbsp;Squid&nbsp;v3.5.22&nbsp;or&nbsp;later&nbsp;for&nbsp;many&nbsp;size-related&lt;br&gt;<br>
logformat&nbsp;%codes&nbsp;to&nbsp;work&nbsp;reasonably&nbsp;well&nbsp;in&nbsp;some&nbsp;environments.&nbsp;There&lt;br&gt;<br>
were&nbsp;many&nbsp;size&nbsp;logging&nbsp;bugs&nbsp;in&nbsp;earlier&nbsp;versions!&lt;br&gt;<br>
&lt;br&gt;<br>
If&nbsp;some&nbsp;of&nbsp;these&nbsp;%codes&nbsp;do&nbsp;not&nbsp;work&nbsp;in&nbsp;your&nbsp;tests&nbsp;with&nbsp;the&nbsp;latest&nbsp;Squid,&lt;br&gt;<br>
please&nbsp;consider&nbsp;filing&nbsp;a&nbsp;but&nbsp;report&nbsp;with&nbsp;an&nbsp;isolated&nbsp;test&nbsp;case&lt;br&gt;<br>
illustrating&nbsp;the&nbsp;problem.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;don't&nbsp;need&nbsp;to&nbsp;know&nbsp;the&nbsp;request&nbsp;content,&nbsp;just&nbsp;want&nbsp;to&nbsp;know&nbsp;how&nbsp;many&lt;br&gt;<br>
&gt;&nbsp;bytes&nbsp;the&nbsp;client&nbsp;totally&nbsp;send&nbsp;including&nbsp;the&nbsp;post&nbsp;and&nbsp;https&nbsp;bytes,&nbsp;is&nbsp;it&lt;br&gt;<br>
&gt;&nbsp;possible&nbsp;to&nbsp;do&nbsp;this?&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;only&nbsp;way&nbsp;to&nbsp;measure&nbsp;the&nbsp;size&nbsp;of&nbsp;encrypted&nbsp;HTTP&nbsp;message&nbsp;parts&nbsp;is&nbsp;to&lt;br&gt;<br>
decrypt&nbsp;that&nbsp;message.&nbsp;Thus,&nbsp;if&nbsp;you&nbsp;want&nbsp;to&nbsp;log&nbsp;HTTPS&nbsp;POST&nbsp;body&nbsp;sizes&nbsp;(as&lt;br&gt;<br>
opposed&nbsp;to&nbsp;just&nbsp;the&nbsp;number&nbsp;of&nbsp;encrypted&nbsp;bytes&nbsp;received&nbsp;from&nbsp;the&nbsp;HTTPS&lt;br&gt;<br>
client),&nbsp;then&nbsp;you&nbsp;have&nbsp;to&nbsp;tell&nbsp;Squid&nbsp;to&nbsp;decrypt&nbsp;that&nbsp;traffic.&nbsp;In&nbsp;most&lt;br&gt;<br>
cases,&nbsp;decryption&nbsp;is&nbsp;not&nbsp;worth&nbsp;the&nbsp;associated&nbsp;headaches&nbsp;if&nbsp;you&nbsp;just&nbsp;want&lt;br&gt;<br>
to&nbsp;log&nbsp;sizes.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
HTH,&lt;br&gt;<br>
&lt;br&gt;<br>
Alex.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
