<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hey&nbsp;Eliezer,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;issue&nbsp;was&nbsp;with&nbsp;whatsapp&nbsp;web&nbsp;socket&nbsp;was&nbsp;not&nbsp;working,&nbsp;here&nbsp;is&nbsp;detailed&nbsp;information&nbsp;about&nbsp;issue&lt;/div&gt;&lt;div&gt;------------&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;Here&nbsp;is&nbsp;some&nbsp;information&nbsp;about&nbsp;my&nbsp;squid&nbsp;version,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Squid&nbsp;Cache:&nbsp;Version&nbsp;3.5.22-20161115-r14113&lt;/div&gt;&lt;div&gt;Service&nbsp;Name:&nbsp;squid&lt;/div&gt;&lt;div&gt;configure&nbsp;options:&nbsp; &#39;--prefix=/usr&#39;&nbsp;&#39;--localstatedir=/var/squid&#39;&nbsp;&#39;--libexecdir=/lib/squid&#39;&nbsp;&#39;--srcdir=.&#39;&nbsp;&#39;--datadir=/share/squid&#39;&nbsp;&#39;--sysconfdir=/etc/squid&#39;&nbsp;&#39;--with-default-user=proxy&#39;&nbsp;&#39;--with-logdir=/var/log/squid&#39;&nbsp;&#39;--with-pidfile=/var/run/squid.pid&#39;&nbsp;&#39;--with-openssl&#39;&nbsp;&#39;--enable-ssl-crtd&#39;&nbsp;&#39;--enable-inline&#39;&nbsp;&#39;--disable-arch-native&#39;&nbsp;&#39;--enable-async-io=8&#39;&nbsp;&#39;--enable-storeio=ufs,aufs,diskd,rock&#39;&nbsp;&#39;--enable-removal-policies=lru,heap&#39;&nbsp;&#39;--enable-delay-pools&#39;&nbsp;&#39;--enable-follow-x-forwarded-for&#39;&nbsp;&#39;--enable-url-rewrite-helpers=fake&#39;&nbsp;&#39;--enable-ecap&#39;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;My&nbsp;squid&nbsp;config&nbsp;file&nbsp;is&nbsp;located&nbsp;at,&nbsp;&lt;a&nbsp;href=&quot;http://pastebin.com/raw/LvDxEF4x&quot;&gt;http://pastebin.com/raw/LvDxEF4x&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Now&nbsp;the&nbsp;issue&nbsp;is&nbsp;whenever&nbsp;someone&nbsp;requests&nbsp;a&nbsp;page&nbsp;which&nbsp;contains&nbsp;web&nbsp;socket&nbsp;requests&nbsp;response&nbsp;is&nbsp;always&nbsp;bad&nbsp;request. &lt;/div&gt;&lt;div&gt;Here&nbsp;is&nbsp;an&nbsp;example,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Request&nbsp;URL:wss://&lt;a&nbsp;href=&quot;http://w4.web.whatsapp.com/ws&quot;&gt;w4.web.whatsapp.com/ws&lt;/a&gt;&lt;/div&gt;&lt;div&gt;Request&nbsp;Method:GET&lt;/div&gt;&lt;div&gt;Status&nbsp;Code:400&nbsp;Bad&nbsp;Request&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Response&nbsp;Headers&lt;/div&gt;&lt;div&gt;#################&lt;/div&gt;&lt;div&gt;Connection:keep-alive&lt;/div&gt;&lt;div&gt;Date:Sat,&nbsp;17&nbsp;Dec&nbsp;2016&nbsp;09:05:36&nbsp;GMT&lt;/div&gt;&lt;div&gt;Transfer-Encoding:chunked&lt;/div&gt;&lt;div&gt;X-Cache:MISS&nbsp;from&nbsp;Proxy&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Request&nbsp;Headers&lt;/div&gt;&lt;div&gt;#################&lt;/div&gt;&lt;div&gt;Accept-Encoding:gzip,&nbsp;deflate,&nbsp;sdch,&nbsp;br&lt;/div&gt;&lt;div&gt;Accept-Language:en-US,en;q=0.8&lt;/div&gt;&lt;div&gt;Cache-Control:no-cache&lt;/div&gt;&lt;div&gt;Connection:Upgrade&lt;/div&gt;&lt;div&gt;Host:&lt;a&nbsp;href=&quot;http://w4.web.whatsapp.com&quot;&gt;w4.web.whatsapp.com&lt;/a&gt;&lt;/div&gt;&lt;div&gt;Origin:&lt;a&nbsp;href=&quot;https://web.whatsapp.com&quot;&gt;https://web.whatsapp.com&lt;/a&gt;&lt;/div&gt;&lt;div&gt;Pragma:no-cache&lt;/div&gt;&lt;div&gt;Sec-WebSocket-Extensions:permessage-deflate;&nbsp;client_max_window_bits&lt;/div&gt;&lt;div&gt;Sec-WebSocket-Key:kzrB2ZcMHDAqvjDNXnjL/w==&lt;/div&gt;&lt;div&gt;Sec-WebSocket-Version:13&lt;/div&gt;&lt;div&gt;Upgrade:websocket&lt;/div&gt;&lt;div&gt;User-Agent:Mozilla/5.0&nbsp;(X11;&nbsp;Linux&nbsp;x86_64)&nbsp;AppleWebKit/537.36&nbsp;(KHTML,&nbsp;like&nbsp;Gecko)&nbsp;Chrome/55.0.2883.75&nbsp;Safari/537.36&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;My&nbsp;question&nbsp;is&nbsp;how&nbsp;we&nbsp;can&nbsp;work&nbsp;with&nbsp;web&nbsp;socket&nbsp;requests&nbsp;in&nbsp;squid&nbsp;or&nbsp;if&nbsp;not&nbsp;by&nbsp;pass&nbsp;them&nbsp;squid.&nbsp;My&nbsp;squid&nbsp;instance&nbsp;is&nbsp;in&nbsp;interception&nbsp;mode&nbsp;and&nbsp;requests&nbsp;are&nbsp;intercepted&nbsp;at&nbsp;instance&nbsp;via&nbsp;iptables&nbsp;and&nbsp;forwarded&nbsp;to&nbsp;squid&nbsp;using&nbsp;below&nbsp;rules,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;SQUIDIP=192.168.1.1&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#&nbsp;your&nbsp;proxy&nbsp;listening&nbsp;port&lt;/div&gt;&lt;div&gt;SQUIDHTTPPORT=3128&lt;/div&gt;&lt;div&gt;SQUIDHTTPSPORT=3129&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;iptables&nbsp;-t&nbsp;nat&nbsp;-A&nbsp;PREROUTING&nbsp;-s&nbsp;$SQUIDIP&nbsp;-p&nbsp;tcp&nbsp;--dport&nbsp;80&nbsp;-j&nbsp;ACCEPT&lt;/div&gt;&lt;div&gt;iptables&nbsp;-t&nbsp;nat&nbsp;-A&nbsp;PREROUTING&nbsp;-p&nbsp;tcp&nbsp;--dport&nbsp;80&nbsp;-j&nbsp;REDIRECT&nbsp;--to-port&nbsp;$SQUIDHTTPPORT&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;iptables&nbsp;-t&nbsp;nat&nbsp;-A&nbsp;PREROUTING&nbsp;-s&nbsp;$SQUIDIP&nbsp;-p&nbsp;tcp&nbsp;--dport&nbsp;443&nbsp;-j&nbsp;ACCEPT&lt;/div&gt;&lt;div&gt;iptables&nbsp;-t&nbsp;nat&nbsp;-A&nbsp;PREROUTING&nbsp;-p&nbsp;tcp&nbsp;--dport&nbsp;443&nbsp;-j&nbsp;REDIRECT&nbsp;--to-port&nbsp;$SQUIDHTTPSPORT&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;iptables&nbsp;-t&nbsp;nat&nbsp;-A&nbsp;POSTROUTING&nbsp;-j&nbsp;MASQUERADE&lt;/div&gt;&lt;div&gt;iptables&nbsp;-t&nbsp;mangle&nbsp;-A&nbsp;PREROUTING&nbsp;-p&nbsp;tcp&nbsp;--dport&nbsp;$SQUIDHTTPPORT&nbsp;-j&nbsp;DROP&lt;/div&gt;&lt;div&gt;iptables&nbsp;-t&nbsp;mangle&nbsp;-A&nbsp;PREROUTING&nbsp;-p&nbsp;tcp&nbsp;--dport&nbsp;$SQUIDHTTPSPORT&nbsp;-j&nbsp;DROP&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;If&nbsp;anyone&nbsp;can&nbsp;help&nbsp;me&nbsp;with&nbsp;this&nbsp;it&nbsp;would&nbsp;be&nbsp;really&nbsp;awesome.&nbsp;Thanks&nbsp;for&nbsp;your&nbsp;support.&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;----------------------------------------------------------&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;Solution&nbsp;to&nbsp;above&nbsp;problem&nbsp;was,&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;div&gt;acl&nbsp;serverIsws&nbsp;ssl::server_name_regex&nbsp;^w[0-9]+\.web\.whatsapp\.com$&lt;/div&gt;&lt;span&nbsp;class=&quot;gmail-im&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;acl&nbsp;step1&nbsp;at_step&nbsp;SslBump1&lt;/div&gt;&lt;div&gt;ssl_bump&nbsp;peek&nbsp;step1&lt;/div&gt;&lt;/span&gt;&lt;div&gt;ssl_bump&nbsp;splice&nbsp;serverIsws&lt;/div&gt;&lt;div&gt;ssl_bump&nbsp;bump&nbsp;!serverIsws&nbsp;all&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;[&nbsp;above&nbsp;is&nbsp;a&nbsp;feature&nbsp;of&nbsp;whatsapp&nbsp;which&nbsp;allows&nbsp;you&nbsp;to&nbsp;connect&nbsp;to &lt;a&nbsp;href=&quot;http://web.whatsapp.com/&quot;&nbsp;target=&quot;_blank&quot;&gt;web.whatsapp.com&lt;/a&gt; from&nbsp;browser]&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;now&nbsp;what&nbsp;happens&nbsp;at&nbsp;request&nbsp;level&nbsp;is&nbsp;following,&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;div&gt;Request&nbsp;URL:wss://&lt;a&nbsp;href=&quot;http://w8.web.whatsapp.com/ws&quot;&nbsp;target=&quot;_blank&quot;&gt;w8.web.whatsapp.com/&lt;wbr&gt;ws&lt;/a&gt;&lt;/div&gt;&lt;div&gt;Request&nbsp;Method:GET&lt;/div&gt;&lt;div&gt;Status&nbsp;Code:101&nbsp;Switching&nbsp;Protocols&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;------------------------------&lt;wbr&gt;----&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Response&nbsp;Headers&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Connection:Upgrade&lt;/div&gt;&lt;div&gt;Sec-WebSocket-Accept:Z6CC+&lt;wbr&gt;QVdvB0cCHPbJAQMaHKL2uQ=&lt;/div&gt;&lt;div&gt;Upgrade:websocket&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;------------------------------&lt;wbr&gt;----&lt;/div&gt;&lt;div&gt;Request&nbsp;Headers&lt;br&gt;&lt;/div&gt;&lt;span&nbsp;class=&quot;gmail-im&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Accept-Encoding:gzip,&nbsp;deflate,&nbsp;sdch,&nbsp;br&lt;/div&gt;&lt;div&gt;Accept-Language:en-US,en;q=0.8&lt;/div&gt;&lt;div&gt;Cache-Control:no-cache&lt;/div&gt;&lt;div&gt;Connection:Upgrade&lt;/div&gt;&lt;/span&gt;&lt;div&gt;Host:&lt;a&nbsp;href=&quot;http://w8.web.whatsapp.com/&quot;&nbsp;target=&quot;_blank&quot;&gt;w8.web.whatsapp.com&lt;/a&gt;&lt;/div&gt;&lt;span&nbsp;class=&quot;gmail-im&quot;&gt;&lt;div&gt;Origin:&lt;a&nbsp;href=&quot;https://web.whatsapp.com/&quot;&nbsp;target=&quot;_blank&quot;&gt;https://web.whatsapp.&lt;wbr&gt;com&lt;/a&gt;&lt;/div&gt;&lt;div&gt;Pragma:no-cache&lt;/div&gt;&lt;div&gt;Sec-WebSocket-Extensions:&lt;wbr&gt;permessage-deflate;&nbsp;client_max_window_bits&lt;/div&gt;&lt;/span&gt;&lt;div&gt;Sec-WebSocket-Key:mbCFLN/&lt;wbr&gt;Q1KMt58t6DoQI9Q==&lt;/div&gt;&lt;span&nbsp;class=&quot;gmail-im&quot;&gt;&lt;div&gt;Sec-WebSocket-Version:13&lt;/div&gt;&lt;div&gt;Upgrade:websocket&lt;/div&gt;&lt;div&gt;User-Agent:Mozilla/5.0&nbsp;(X11;&nbsp;Linux&nbsp;x86_64)&nbsp;AppleWebKit/537.36&nbsp;(KHTML,&nbsp;like&nbsp;Gecko)&nbsp;Chrome/55.0.2883.75&nbsp;Safari/537.36&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So&nbsp;basically&nbsp;websockets&nbsp;are&nbsp;connected&nbsp;as&nbsp;normal&nbsp;https&nbsp;request(&nbsp;i&nbsp;think&nbsp;this&nbsp;is&nbsp;a&nbsp;very&nbsp;nature&nbsp;of&nbsp;Web&nbsp;sockets&nbsp;and&nbsp;define&nbsp;somewhere&nbsp;in&nbsp;web&nbsp;socket&nbsp;standards).&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Now&nbsp;the&nbsp;problem&nbsp;statement&nbsp;is,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;ssl_bump&nbsp;bump&nbsp;!serverIsws&nbsp;all&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:12.8px&quot;&gt;If&nbsp;i&nbsp;remove&nbsp;!serverIsws&nbsp;then&nbsp;it&nbsp;stops&nbsp;working.&nbsp;as&nbsp;per&nbsp;alex&nbsp;it&nbsp;shoudn&#39;t&nbsp;happen&nbsp;and&nbsp;its&nbsp;a&nbsp;bug&nbsp;most&nbsp;probably.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Mon,&nbsp;Jan&nbsp;2,&nbsp;2017&nbsp;at&nbsp;7:17&nbsp;PM,&nbsp;Eliezer&nbsp;Croitoru&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:eliezer@ngtech.co.il&quot;&nbsp;target=&quot;_blank&quot;&gt;eliezer@ngtech.co.il&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;Can&nbsp;we&nbsp;start&nbsp;from&nbsp;0.&lt;br&gt;<br>
Currently&nbsp;when&nbsp;squid&nbsp;knows&nbsp;about&nbsp;the&nbsp;Connection&nbsp;being&nbsp;a&nbsp;one&nbsp;with&nbsp;websocket&nbsp;support&nbsp;it&nbsp;is&nbsp;already&nbsp;too&nbsp;late&nbsp;to&nbsp;do&nbsp;anything&nbsp;about&nbsp;this&nbsp;specific&nbsp;connection.&lt;br&gt;<br>
The&nbsp;only&nbsp;option&nbsp;for&nbsp;now&nbsp;is&nbsp;to&nbsp;identify&nbsp;these&nbsp;using&nbsp;some&nbsp;ICAP&nbsp;service&nbsp;that&nbsp;will&nbsp;for&nbsp;example&nbsp;redirect&nbsp;the&nbsp;request&nbsp;after&nbsp;a&nbsp;small&nbsp;delay&nbsp;that&nbsp;will&nbsp;add&nbsp;the&nbsp;destination&nbsp;domain&nbsp;ip&nbsp;address&nbsp;to&nbsp;a&nbsp;bypass&nbsp;list.&lt;br&gt;<br>
It’s&nbsp;not&nbsp;trivial&nbsp;but&nbsp;I&nbsp;have&nbsp;seen&nbsp;such&nbsp;implementation&nbsp;on&nbsp;ssl&nbsp;bump.&lt;br&gt;<br>
&lt;br&gt;<br>
Can&nbsp;you&nbsp;please&nbsp;redirect&nbsp;me&nbsp;to&nbsp;the&nbsp;specific&nbsp;email&nbsp;with&nbsp;the&nbsp;bug&nbsp;details?&lt;br&gt;<br>
&lt;br&gt;<br>
Eliezer&lt;br&gt;<br>
&lt;br&gt;<br>
----&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://ngtech.co.il/lmgtfy/&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://ngtech.co.il/lmgtfy/&lt;/a&gt;&lt;br&gt;<br>
Linux&nbsp;System&nbsp;Administrator&lt;br&gt;<br>
Mobile:&nbsp;+972-5-28704261&lt;br&gt;<br>
Email:&nbsp;&lt;a&nbsp;href=&quot;mailto:eliezer@ngtech.co.il&quot;&gt;eliezer@ngtech.co.il&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
From:&nbsp;squid-users&nbsp;[mailto:&lt;a&nbsp;href=&quot;mailto:squid-users-bounces@lists.squid-cache.org&quot;&gt;squid-users-bounces@&lt;wbr&gt;lists.squid-cache.org&lt;/a&gt;]&nbsp;On&nbsp;Behalf&nbsp;Of&nbsp;Hardik&nbsp;Dangar&lt;br&gt;<br>
Sent:&nbsp;Monday,&nbsp;January&nbsp;2,&nbsp;2017&nbsp;8:47&nbsp;AM&lt;br&gt;<br>
To:&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&gt;rousskov@measurement-factory.&lt;wbr&gt;com&lt;/a&gt;&gt;&lt;br&gt;<br>
Cc:&nbsp;Squid&nbsp;Users&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-&lt;wbr&gt;cache.org&lt;/a&gt;&gt;&lt;br&gt;<br>
Subject:&nbsp;Re:&nbsp;[squid-users]&nbsp;Squid&nbsp;Websocket&nbsp;Issue&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;im&nbsp;HOEnZb&quot;&gt;&lt;br&gt;<br>
@amos&nbsp;or&nbsp;anyone&nbsp;else&nbsp;from&nbsp;dev&nbsp;team&lt;br&gt;<br>
&lt;br&gt;<br>
Can&nbsp;you&nbsp;confirm&nbsp;this&nbsp;is&nbsp;intentional&nbsp;behavior&nbsp;or&nbsp;bug&nbsp;?&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;&lt;div&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;On&nbsp;Mon,&nbsp;Jan&nbsp;2,&nbsp;2017&nbsp;at&nbsp;9:18&nbsp;AM,&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;mailto:&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&gt;rousskov@measurement-&lt;wbr&gt;factory.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;<br>
On&nbsp;12/27/2016&nbsp;04:50&nbsp;AM,&nbsp;Hardik&nbsp;Dangar&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;If&nbsp;i&nbsp;remove&nbsp;!serverIsws&nbsp;somehow&nbsp;websockets&nbsp;will&nbsp;not&nbsp;work.&lt;br&gt;<br>
&lt;br&gt;<br>
Then&nbsp;there&nbsp;is&nbsp;a&nbsp;bug&nbsp;somewhere&nbsp;AFAICT.&nbsp;It&nbsp;is&nbsp;your&nbsp;call&nbsp;whether&nbsp;to&nbsp;find&lt;br&gt;<br>
out&nbsp;what&nbsp;that&nbsp;bug&nbsp;is&nbsp;[while&nbsp;continuing&nbsp;to&nbsp;use&nbsp;a&nbsp;potentially&nbsp;dangerous&lt;br&gt;<br>
workaround].&lt;br&gt;<br>
&lt;br&gt;<br>
Alex.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;On&nbsp;Tue,&nbsp;Dec&nbsp;20,&nbsp;2016&nbsp;at&nbsp;10:27&nbsp;PM,&nbsp;Alex&nbsp;Rousskov&nbsp;wrote:&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; On&nbsp;12/20/2016&nbsp;02:42&nbsp;AM,&nbsp;Hardik&nbsp;Dangar&nbsp;wrote:&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;Following&nbsp;changes&nbsp;in&nbsp;config&nbsp;works&nbsp;and&nbsp;whatsapp&nbsp;starts&nbsp;working,&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;acl&nbsp;serverIsws&nbsp;ssl::server_name_regex&nbsp;^w[0-9]+\.web\.whatsapp\.com$&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;acl&nbsp;step1&nbsp;at_step&nbsp;SslBump1&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;ssl_bump&nbsp;peek&nbsp;step1&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;ssl_bump&nbsp;splice&nbsp;serverIsws&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;ssl_bump&nbsp;bump&nbsp;!serverIsws&nbsp;all&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; You&nbsp;do&nbsp;not&nbsp;need&nbsp;the&nbsp;&quot;!serverIsws&quot;&nbsp;part&nbsp;because&nbsp;if&nbsp;serverIsws&nbsp;matches,&lt;br&gt;<br>
&gt; &nbsp; &nbsp; then&nbsp;the&nbsp;splice&nbsp;rule&nbsp;wins,&nbsp;and&nbsp;Squid&nbsp;does&nbsp;not&nbsp;reach&nbsp;the&nbsp;bump&nbsp;rule.&nbsp;This&lt;br&gt;<br>
&gt; &nbsp; &nbsp; configuration&nbsp;is&nbsp;sufficient:&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; ssl_bump&nbsp;peek&nbsp;step1&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; ssl_bump&nbsp;splice&nbsp;serverIsws&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; ssl_bump&nbsp;bump&nbsp;all&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; In&nbsp;theory,&nbsp;adding&nbsp;&quot;!serverIsws&quot;&nbsp;does&nbsp;not&nbsp;hurt.&nbsp;However,&nbsp;negating&nbsp;complex&lt;br&gt;<br>
&gt; &nbsp; &nbsp; ACLs&nbsp;is&nbsp;tricky/dangerous&nbsp;and&nbsp;should&nbsp;be&nbsp;avoided&nbsp;when&nbsp;possible.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; Alex.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
