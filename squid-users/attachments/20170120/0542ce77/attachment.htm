<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;Hello,&nbsp;I&nbsp;have&nbsp;a&nbsp;question&nbsp;regarding&nbsp;a&nbsp;native&nbsp;FTP&nbsp;relay&nbsp;(squid&#39;s&nbsp;version&nbsp;is&nbsp;3.5.23).&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;br&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;I&#39;ve&nbsp;tried&nbsp;to&nbsp;test&nbsp;this&nbsp;feature&nbsp;like&nbsp;this:&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;br&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;[Filezilla&nbsp;Client,&nbsp;1.1.1.2]&nbsp;&lt;-----&gt;&nbsp;[&nbsp;Router:&nbsp;iptables&nbsp;+&nbsp;squid&nbsp;]&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;-----&gt;&nbsp;[vsftpd&nbsp;server,&nbsp;5.5.5.10]&lt;/span&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;router&nbsp;is&nbsp;CentOS&nbsp;6.5&nbsp;machine. &lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;Firewall&nbsp;settings&nbsp;are:&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;br&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;ip&nbsp;route&nbsp;flush&nbsp;table&nbsp;100&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;ip&nbsp;rule&nbsp;add&nbsp;fwmark&nbsp;1&nbsp;lookup&nbsp;100&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;ip&nbsp;route&nbsp;add&nbsp;local &lt;/span&gt;&lt;a&nbsp;href=&quot;http://0.0.0.0/0&quot;&nbsp;target=&quot;_blank&quot;&nbsp;style=&quot;font-size:12.8px&quot;&gt;0.0.0.0/0&lt;/a&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt; dev&nbsp;lo&nbsp;table&nbsp;100&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;br&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;iptables&nbsp;-t&nbsp;mangle&nbsp;-N&nbsp;DIVERT&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;iptables&nbsp;-t&nbsp;mangle&nbsp;-A&nbsp;DIVERT&nbsp;-j&nbsp;MARK&nbsp;--set-mark&nbsp;0x01/0x01&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;iptables&nbsp;-t&nbsp;mangle&nbsp;-A&nbsp;DIVERT&nbsp;-j&nbsp;ACCEPT&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;iptables&nbsp;-t&nbsp;mangle&nbsp;-A&nbsp;PREROUTING&nbsp;-p&nbsp;tcp&nbsp;-m&nbsp;socket&nbsp;-j&nbsp;DIVERT&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;iptables&nbsp;-t&nbsp;mangle&nbsp;-A&nbsp;PREROUTING&nbsp;-p&nbsp;tcp&nbsp;--dport&nbsp;21&nbsp;-j&nbsp;TPROXY&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;--tproxy-mark&nbsp;0x1/0x1&nbsp;--on-port&nbsp;2121&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;iptables&nbsp;-t&nbsp;mangle&nbsp;-A&nbsp;PREROUTING&nbsp;-p&nbsp;tcp&nbsp;--dport&nbsp;80&nbsp;-j&nbsp;TPROXY&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;--tproxy-mark&nbsp;0x1/0x1&nbsp;--on-port&nbsp;3128&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;br&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;No&nbsp;other&nbsp;rules&nbsp;are&nbsp;defined&nbsp;and&nbsp;default&nbsp;policy&nbsp;for&nbsp;INPUT/OUTPUT/FORWARD&nbsp;is&nbsp;ACCEPT.&nbsp;The&nbsp;rp_filter&nbsp;is&nbsp;disabled.&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;br&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;Squid&#39;s&nbsp;configuration&nbsp;file&nbsp;is&nbsp;attached.&lt;/span&gt;&lt;br&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;br&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;With&nbsp;HTTP&nbsp;everything&nbsp;works&nbsp;fine,&nbsp;however&nbsp;FTP&nbsp;causes&nbsp;a&nbsp;problem. &lt;/span&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;A&nbsp;client&nbsp;successfully&nbsp;connects&nbsp;and&nbsp;authenticates,&nbsp;but&nbsp;when&nbsp;it&nbsp;tries&nbsp;to &lt;/span&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;execute&nbsp;LIST&nbsp;or&nbsp;RETR&nbsp;(when&nbsp;data&nbsp;connection&nbsp;should&nbsp;be&nbsp;established), &lt;/span&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;Filezilla&nbsp;says&nbsp;&quot;Connection&nbsp;closed&nbsp;by&nbsp;server&quot;.&nbsp;Meanwhile&nbsp;squid&nbsp;says&nbsp;the&nbsp;following:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;commBind:&nbsp;Cannot&nbsp;bind&nbsp;socket&nbsp;FD&nbsp;17&nbsp;to&nbsp;&lt;a&nbsp;href=&quot;http://1.1.1.2&quot;&gt;1.1.1.2&lt;/a&gt;:&nbsp;(99)&nbsp;Cannot&nbsp;assign&nbsp;requested&nbsp;address&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;What&nbsp;can&nbsp;be&nbsp;wrong&nbsp;with&nbsp;this&nbsp;setup?&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
