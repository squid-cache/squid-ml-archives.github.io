# squid.conf - squid-3.5.20

# Address of current server
http_port x.x.x.x:8080

icp_port 0

# Address of same server
tcp_outgoing_address x.x.x.x

# Address of DNS server on internal network
dns_nameservers z.z.z.z

no_cache deny QUERY

cache_mem 64 MB

maximum_object_size 150000 KB
minimum_object_size 2 KB
maximum_object_size_in_memory 32 KB

cache_dir ufs /var/spool/squid 7168 32 256
coredump_dir /var/spool/squid

forwarded_for off

refresh_pattern ^ftp:		1440	20%	10080
refresh_pattern ^gopher:	1440	0%	1440
refresh_pattern .		0	20%	4320

# Recommended minimum configuration:
acl all src 0.0.0.0/0.0.0.0
acl manager proto cache_object
acl localhost src 127.0.0.1/255.255.255.255
acl to_localhost dst 127.0.0.0/8
acl SSL_ports port 443 563 2096 2083
acl Safe_ports port 80		# http
acl Safe_ports port 21		# ftp
acl Safe_ports port 443 563	# https, snews
acl Safe_ports port 70		# gopher
acl Safe_ports port 210		# wais
acl Safe_ports port 1025-65535	# unregistered ports
acl Safe_ports port 280		# http-mgmt
acl Safe_ports port 488		# gss-http
acl Safe_ports port 591		# filemaker
acl Safe_ports port 777		# multiling http
acl CONNECT method CONNECT

http_access allow manager localhost
http_access deny manager

http_access deny !Safe_ports

http_access deny CONNECT !SSL_ports

http_access allow localhost

######################################################
#           Groups of Internal IP Addresses          #
######################################################

acl test src 10.0.0.5


######################################################
#               Time Schedules                       #
######################################################

acl __time__day time SMTWHFA 7:35-22:35


######################################################
#               Specific Domains and URLs            #
######################################################

acl __domain__ubuntu dstdomain .ubuntu.com
acl __domain__squid_2 dstdomain .youtube.com


######################################################
#               Permissions                          #
######################################################

http_access allow __time__day test __domain__ubuntu
http_access allow __time__day test __domain__squid_2

http_access deny all
http_reply_access allow all
icp_access allow all


######################################################
#               Squid 2                              #
######################################################

# Address of second Gateway to the Internet
cache_peer z.z.z.z parent 8080 7 no-query

cache_peer_access z.z.z.z allow __domain__squid_2
cache_peer_access z.z.z.z allow CONNECT __domain__squid_2

always_direct deny __domain__squid_2
always_direct deny CONNECT __domain__squid_2

never_direct allow __domain__squid_2
never_direct allow CONNECT __domain__squid_2

always_direct allow localhost
always_direct allow CONNECT
always_direct allow all

never_direct deny localhost
never_direct deny CONNECT
never_direct deny all

no_cache deny CONNECT
no_cache deny localhost

