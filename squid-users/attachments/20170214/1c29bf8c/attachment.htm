<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;openssl&nbsp;test&nbsp;to&nbsp;reproduce&nbsp;the&nbsp;error:&lt;br&gt;&lt;br&gt;openssl&nbsp;s_client &nbsp;-connect&nbsp;&lt;a&nbsp;href=&quot;http://www.coursera.org:443&quot;&gt;www.coursera.org:443&lt;/a&gt;&nbsp;-&nbsp;FAILS&nbsp;(Testing&nbsp;with&nbsp;cousera&nbsp;since&nbsp;it&nbsp;is&nbsp;also&nbsp;hosted&nbsp;on&nbsp;cloudfront,&nbsp;and&nbsp;uses&nbsp;TLS/SNI)&lt;br&gt;&lt;br&gt;CONNECTED(00000003)&lt;br&gt;140225331586752:error:14077410:SSL&nbsp;routines:SSL23_GET_SERVER_HELLO:sslv3&nbsp;alert&nbsp;handshake&nbsp;failure:s23_clnt.c:757:&lt;br&gt;&lt;br&gt;openssl&nbsp;s_client &nbsp;-connect&nbsp;&lt;a&nbsp;href=&quot;http://www.coursera.org:443&quot;&gt;www.coursera.org:443&lt;/a&gt;&nbsp;-servername&nbsp;&lt;a&nbsp;href=&quot;http://www.coursera.org&quot;&gt;www.coursera.org&lt;/a&gt;&nbsp;-&nbsp;SUCCEEDS&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;Also,&nbsp;with&nbsp;nginx,&nbsp;if&nbsp;I&nbsp;switch&nbsp;off&nbsp;the&nbsp;proxy_ssl_server_name&nbsp;flag,&nbsp;I&nbsp;get&nbsp;the&nbsp;same&nbsp;openssl&nbsp;error&nbsp;as&nbsp;squid,&lt;br&gt;&lt;br&gt;2017/02/14&nbsp;09:20:39&nbsp;[error]&nbsp;23604#0:&nbsp;*6&nbsp;SSL_do_handshake()&nbsp;failed&nbsp;(SSL:&nbsp;error:14077410:SSL&nbsp;routines:SSL23_GET_SERVER_HELLO:sslv3&nbsp;alert&nbsp;handshake&nbsp;failure)&nbsp;while&nbsp;S&lt;br&gt;SL&nbsp;handshaking&nbsp;to&nbsp;upstream,...&quot;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;makes&nbsp;me&nbsp;suspect&nbsp;that&nbsp;squid&nbsp;is&nbsp;not&nbsp;sending&nbsp;the&nbsp;servername&nbsp;...&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;14&nbsp;February&nbsp;2017&nbsp;at&nbsp;02:40,&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&nbsp;target=&quot;_blank&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;On&nbsp;14/02/2017&nbsp;4:40&nbsp;a.m.,&nbsp;Philip&nbsp;Munaawa&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;am&nbsp;trying&nbsp;to&nbsp;reverse&nbsp;proxy&nbsp;a&nbsp;site&nbsp;hosted&nbsp;on&nbsp;cloudfront,&nbsp;using&nbsp;the&nbsp;normal&lt;br&gt;<br>
&gt;&nbsp;https_port&nbsp;accel.&nbsp;I&nbsp;have&nbsp;the&nbsp;key/cert&nbsp;pair&nbsp;for&nbsp;the&nbsp;origin.&nbsp;The&nbsp;cloudfront&lt;br&gt;<br>
&gt;&nbsp;uses&nbsp;TLS/SNI&nbsp;to&nbsp;negotiate&nbsp;an&nbsp;SSL&nbsp;connection.&nbsp;However,&nbsp;when&nbsp;I&nbsp;try&nbsp;to&nbsp;connect&lt;br&gt;<br>
&gt;&nbsp;through&nbsp;the&nbsp;proxy,&nbsp;I&nbsp;get&nbsp;the&nbsp;error&nbsp;below&nbsp;in&nbsp;the&nbsp;logs:&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Error&nbsp;negotiating&nbsp;SSL&nbsp;on&nbsp;FD&nbsp;39:&nbsp;error:14094410:SSL&lt;br&gt;<br>
&gt;&nbsp;routines:SSL3_READ_BYTES:sslv3&nbsp;alert&nbsp;handshake&nbsp;failure&nbsp;(1/0/0)&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;have&nbsp;seen&nbsp;a&nbsp;similar&nbsp;issie&nbsp;with&nbsp;nginx,&nbsp;which&nbsp;was&nbsp;resolved&nbsp;by&nbsp;adding&nbsp;a&lt;br&gt;<br>
&gt;&nbsp;switch&nbsp;to&nbsp;send&nbsp;the&nbsp;server_host_name.&nbsp;see:&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;http://stackoverflow.com/questions/25329941/nginx-caching-proxy-fails-with-ssl23-get-server-hellosslv3-alert-handshake-fail&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://stackoverflow.com/&lt;wbr&gt;questions/25329941/nginx-&lt;wbr&gt;caching-proxy-fails-with-&lt;wbr&gt;ssl23-get-server-hellosslv3-&lt;wbr&gt;alert-handshake-fail&lt;/a&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Does&nbsp;squid&nbsp;(3.5.24)&nbsp;have&nbsp;a&nbsp;similar&nbsp;switch/functionality?&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;The&nbsp;only&nbsp;thing&nbsp;that&nbsp;SSL23_SERVER_HELLO&nbsp;and&nbsp;SSL3_READ_BYTES&nbsp;have&nbsp;in&lt;br&gt;<br>
common&nbsp;is&nbsp;that&nbsp;they&nbsp;are&nbsp;errors.&nbsp;So&nbsp;no&nbsp;they&nbsp;are&nbsp;not&nbsp;&quot;similar&quot;.&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;server&nbsp;is&nbsp;closing&nbsp;the&nbsp;connection&nbsp;without&nbsp;reporting&nbsp;what&nbsp;the&nbsp;problem&lt;br&gt;<br>
actually&nbsp;is.&nbsp;Squid-3.5&nbsp;should&nbsp;already&nbsp;be&nbsp;sending&nbsp;SNI&nbsp;using&nbsp;the&lt;br&gt;<br>
cache_peer&nbsp;hostname&nbsp;or&nbsp;request-URL&nbsp;hostname.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;&lt;a&nbsp;href=&quot;http://openssl.6102.n7.nabble.com/error-14094410-SSL-routines-SSL3-READ-BYTES-sslv3-alert-handshake-failure-td12398.html&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://openssl.6102.n7.&lt;wbr&gt;nabble.com/error-14094410-SSL-&lt;wbr&gt;routines-SSL3-READ-BYTES-&lt;wbr&gt;sslv3-alert-handshake-failure-&lt;wbr&gt;td12398.html&lt;/a&gt;&gt;&lt;br&gt;<br>
has&nbsp;some&nbsp;hints&nbsp;from&nbsp;Dave&nbsp;Thompson&nbsp;on&nbsp;how&nbsp;to&nbsp;find&nbsp;out&nbsp;what&nbsp;is&nbsp;going&nbsp;on&lt;br&gt;<br>
with&nbsp;the&nbsp;server.&lt;br&gt;<br>
&lt;br&gt;<br>
Amos&lt;br&gt;<br>
&lt;br&gt;<br>
______________________________&lt;wbr&gt;_________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.&lt;wbr&gt;org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/&lt;wbr&gt;listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
