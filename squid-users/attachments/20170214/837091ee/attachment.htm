<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;Is&nbsp;this&nbsp;squid&nbsp;box&nbsp;a&nbsp;router&nbsp;or&nbsp;just&nbsp;a&nbsp;proxy?&lt;/div&gt;&lt;div&gt;-&nbsp;just&nbsp;a&nbsp;proxy&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What&nbsp;tcpdump&nbsp;command&nbsp;did&nbsp;you&nbsp;ran?&lt;/div&gt;&lt;div&gt;-&nbsp;sudo&nbsp;tcpdump&nbsp;-i&nbsp;eth0&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What&nbsp;is&nbsp;the&nbsp;networks&nbsp;that&nbsp;are&nbsp;involved?&lt;/div&gt;&lt;div&gt;Setup:&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;Client&nbsp; &nbsp; &nbsp; &nbsp; (192.168.1.8)&nbsp;---&gt;&nbsp; |&nbsp; &nbsp; &nbsp;Rotuer&nbsp; &nbsp; &nbsp; &nbsp; |&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;gateway/dhcp&nbsp;|&nbsp;---&gt;&nbsp;Internet&lt;br&gt;Squid&nbsp;box&nbsp;(192.168.1.2)&nbsp;---&gt;&nbsp; |&nbsp; 192.168.1.1&nbsp; &nbsp;|&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Here&nbsp;Client&nbsp;(debian),&nbsp;squid&nbsp;(debian)&nbsp;and&nbsp;router&nbsp;are&nbsp;three&nbsp;separate&nbsp;devices.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What&nbsp;is&nbsp;the&nbsp;gateway&nbsp;and&nbsp;dhcp&nbsp;for&nbsp;this&nbsp;network?&lt;/div&gt;&lt;div&gt;-&nbsp;Router&nbsp;is&nbsp;both&nbsp;gateway&nbsp;and&nbsp;dhcp&nbsp;server&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;If&nbsp;the&nbsp;client&nbsp;is&nbsp;a&nbsp;linux&nbsp;box&nbsp;then&nbsp;we&nbsp;need&nbsp;the&nbsp;output&nbsp;of:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;ifconfig:&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;eth0&nbsp; &nbsp;Link&nbsp;encap:Ethernet&nbsp; HWaddr&nbsp;b8:27:eb:91:83:20&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;inet&nbsp;addr:192.168.1.8&nbsp; Bcast:192.168.1.255&nbsp; Mask:255.255.255.0&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;inet6&nbsp;addr:&nbsp;fe80::6236:7570:1f1e:d238/64&nbsp;Scope:Link&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UP&nbsp;BROADCAST&nbsp;RUNNING&nbsp;MULTICAST&nbsp; MTU:1500&nbsp; Metric:1&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;RX&nbsp;packets:3214&nbsp;errors:0&nbsp;dropped:0&nbsp;overruns:0&nbsp;frame:0&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TX&nbsp;packets:8985&nbsp;errors:0&nbsp;dropped:0&nbsp;overruns:0&nbsp;carrier:0&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;collisions:0&nbsp;txqueuelen:1000&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;RX&nbsp;bytes:478898&nbsp;(467.6&nbsp;KiB)&nbsp; TX&nbsp;bytes:2308050&nbsp;(2.2&nbsp;MiB)&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;ip&nbsp;route:&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;default&nbsp;via&nbsp;192.168.1.1&nbsp;dev&nbsp;eth0&lt;br&gt;&lt;a&nbsp;href=&quot;http://169.254.0.0/16&quot;&gt;169.254.0.0/16&lt;/a&gt;&nbsp;dev&nbsp;eth0&nbsp; proto&nbsp;kernel&nbsp; scope&nbsp;link&nbsp; src&nbsp;169.254.219.186&nbsp; metric&nbsp;202&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Mon,&nbsp;Feb&nbsp;13,&nbsp;2017&nbsp;at&nbsp;10:44&nbsp;PM,&nbsp;Eliezer&nbsp;Croitoru&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:eliezer@ngtech.co.il&quot;&nbsp;target=&quot;_blank&quot;&gt;eliezer@ngtech.co.il&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;Hey,&lt;br&gt;<br>
&lt;br&gt;<br>
There&nbsp;are&nbsp;couple&nbsp;missing&nbsp;pieces(in&nbsp;my&nbsp;eyes)&nbsp;in&nbsp;order&nbsp;to&nbsp;understand&nbsp;the&nbsp;picture.&lt;br&gt;<br>
Is&nbsp;this&nbsp;squid&nbsp;box&nbsp;a&nbsp;router&nbsp;or&nbsp;just&nbsp;a&nbsp;proxy?&lt;br&gt;<br>
What&nbsp;tcpdump&nbsp;command&nbsp;did&nbsp;you&nbsp;ran?&lt;br&gt;<br>
What&nbsp;is&nbsp;the&nbsp;networks&nbsp;that&nbsp;are&nbsp;involved?&lt;br&gt;<br>
What&nbsp;is&nbsp;the&nbsp;gateway&nbsp;and&nbsp;dhcp&nbsp;for&nbsp;this&nbsp;network?&lt;br&gt;<br>
If&nbsp;the&nbsp;client&nbsp;is&nbsp;a&nbsp;linux&nbsp;box&nbsp;then&nbsp;we&nbsp;need&nbsp;the&nbsp;output&nbsp;of:&lt;br&gt;<br>
$&nbsp;ifconfig&lt;br&gt;<br>
$&nbsp;route&nbsp;-n&lt;br&gt;<br>
Or&lt;br&gt;<br>
$&nbsp;ip&nbsp;route&lt;br&gt;<br>
&lt;br&gt;<br>
Thanks,&lt;br&gt;<br>
Eliezer&lt;br&gt;<br>
&lt;br&gt;<br>
----&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://ngtech.co.il/lmgtfy/&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://ngtech.co.il/lmgtfy/&lt;/a&gt;&lt;br&gt;<br>
Linux&nbsp;System&nbsp;Administrator&lt;br&gt;<br>
Mobile:&nbsp;&lt;a&nbsp;href=&quot;tel:%2B972-5-28704261&quot;&nbsp;value=&quot;+972528704261&quot;&gt;+972-5-28704261&lt;/a&gt;&lt;br&gt;<br>
Email:&nbsp;&lt;a&nbsp;href=&quot;mailto:eliezer@ngtech.co.il&quot;&gt;eliezer@ngtech.co.il&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
From:&nbsp;squid-users&nbsp;[mailto:&lt;a&nbsp;href=&quot;mailto:squid-users-bounces@lists.squid-cache.org&quot;&gt;squid-users-bounces@&lt;wbr&gt;lists.squid-cache.org&lt;/a&gt;]&nbsp;On&nbsp;Behalf&nbsp;Of&nbsp;John&nbsp;Pearson&lt;br&gt;<br>
Sent:&nbsp;Tuesday,&nbsp;February&nbsp;14,&nbsp;2017&nbsp;8:25&nbsp;AM&lt;br&gt;<br>
To:&nbsp;Squid&nbsp;Users&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-&lt;wbr&gt;cache.org&lt;/a&gt;&gt;&lt;br&gt;<br>
Subject:&nbsp;[squid-users]&nbsp;Squid&nbsp;on&nbsp;separate&nbsp;box&nbsp;and&nbsp;it&nbsp;can&#39;t&nbsp;see&nbsp;packets&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;&quot;&gt;&lt;br&gt;<br>
Hi&nbsp;all,&lt;br&gt;<br>
I&nbsp;have&nbsp;squid&nbsp;on&nbsp;a&nbsp;separate&nbsp;box&nbsp;on&nbsp;my&nbsp;network&nbsp;with&nbsp;ip&nbsp;address&nbsp;192.168.1.2&lt;br&gt;<br>
&lt;br&gt;<br>
In&nbsp;squid.conf&nbsp;I&nbsp;have:&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;http_port&nbsp;&lt;a&nbsp;href=&quot;http://0.0.0.0:3128&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://0.0.0.0:3128&lt;/a&gt;&lt;br&gt;<br>
http_port&nbsp;&lt;a&nbsp;href=&quot;http://0.0.0.0:3129&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://0.0.0.0:3129&lt;/a&gt;&nbsp;intercept&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;&quot;&gt;&lt;br&gt;<br>
-------&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;squid&nbsp;box:&lt;br&gt;<br>
&lt;br&gt;<br>
$&nbsp;sudo&nbsp;netstat&nbsp;-lnp&nbsp;|&nbsp;grep&nbsp;squid&lt;br&gt;<br>
&lt;/span&gt;tcp &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp;0&nbsp;&lt;a&nbsp;href=&quot;http://0.0.0.0:3128&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://0.0.0.0:3128&lt;/a&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0:* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; LISTEN &nbsp; &nbsp; &nbsp;2639/(squid-1)&lt;br&gt;<br>
tcp &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp;0&nbsp;&lt;a&nbsp;href=&quot;http://0.0.0.0:3129&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://0.0.0.0:3129&lt;/a&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0:* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; LISTEN &nbsp; &nbsp; &nbsp;2639/(squid-1)&lt;br&gt;<br>
udp &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp;0&nbsp;&lt;a&nbsp;href=&quot;http://0.0.0.0:37444&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://0.0.0.0:37444&lt;/a&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0:* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2639/(squid-1)&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;udp6 &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; &nbsp;0&nbsp;:::41465 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;:::* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2639/(squid-1)&lt;br&gt;<br>
&lt;br&gt;<br>
-------&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;followed&nbsp;this&nbsp;example:&nbsp;&lt;a&nbsp;href=&quot;http://wiki.squid-cache.org/ConfigExamples/Intercept/LinuxRedirect&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://wiki.squid-cache.org/&lt;wbr&gt;ConfigExamples/Intercept/&lt;wbr&gt;LinuxRedirect&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
iptables:&lt;br&gt;<br>
&lt;br&gt;<br>
#&nbsp;your&nbsp;proxy&nbsp;IP&lt;br&gt;<br>
SQUIDIP=192.168.1.2&lt;br&gt;<br>
&lt;br&gt;<br>
#&nbsp;your&nbsp;proxy&nbsp;listening&nbsp;port&lt;br&gt;<br>
SQUIDPORT=3129&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
iptables&nbsp;-t&nbsp;nat&nbsp;-A&nbsp;PREROUTING&nbsp;-s&nbsp;$SQUIDIP&nbsp;-p&nbsp;tcp&nbsp;--dport&nbsp;80&nbsp;-j&nbsp;ACCEPT&lt;br&gt;<br>
iptables&nbsp;-t&nbsp;nat&nbsp;-A&nbsp;PREROUTING&nbsp;-p&nbsp;tcp&nbsp;--dport&nbsp;80&nbsp;-j&nbsp;REDIRECT&nbsp;--to-port&nbsp;$SQUIDPORT&lt;br&gt;<br>
iptables&nbsp;-t&nbsp;nat&nbsp;-A&nbsp;POSTROUTING&nbsp;-j&nbsp;MASQUERADE&lt;br&gt;<br>
iptables&nbsp;-t&nbsp;mangle&nbsp;-A&nbsp;PREROUTING&nbsp;-p&nbsp;tcp&nbsp;--dport&nbsp;$SQUIDPORT&nbsp;-j&nbsp;DROP&lt;br&gt;<br>
&lt;br&gt;<br>
------&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;am&nbsp;redirecting&nbsp;port&nbsp;80&nbsp;packets&nbsp;on&nbsp;my&nbsp;router&nbsp;to&nbsp;squid&nbsp;box&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;one&nbsp;of&nbsp;the&nbsp;clients:&nbsp;192.168.1.8,&nbsp;I&nbsp;am&nbsp;running&lt;br&gt;<br>
wget&nbsp;-v&nbsp;--bind-address=192.168.1.8&nbsp;&lt;a&nbsp;href=&quot;http://squid-cache.org:80&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://squid-cache.org:80&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;squid&nbsp;box,&nbsp;I&nbsp;am&nbsp;running&nbsp;tcpdump&nbsp;and&nbsp;I&nbsp;am&nbsp;able&nbsp;to&nbsp;see&nbsp;those&nbsp;packets:&lt;br&gt;<br>
&lt;br&gt;<br>
22:09:58.962316&nbsp;IP&nbsp;192.168.1.8.52219&nbsp;&gt;&nbsp;lists.squid-cache.org.http:&nbsp;Flags&nbsp;[S],&nbsp;seq&nbsp;1999822717,&nbsp;win&nbsp;29200,&nbsp;options&nbsp;[mss&nbsp;1460,sackOK,TS&nbsp;val&nbsp;26932460&nbsp;ecr&nbsp;0,nop,wscale&nbsp;7],&nbsp;length&nbsp;0&lt;br&gt;<br>
22:09:59.958994&nbsp;IP&nbsp;192.168.1.8.52219&nbsp;&gt;&nbsp;lists.squid-cache.org.http:&nbsp;Flags&nbsp;[S],&nbsp;seq&nbsp;1999822717,&nbsp;win&nbsp;29200,&nbsp;options&nbsp;[mss&nbsp;1460,sackOK,TS&nbsp;val&nbsp;26932560&nbsp;ecr&nbsp;0,nop,wscale&nbsp;7],&nbsp;length&nbsp;0&lt;br&gt;<br>
22:10:01.958981&nbsp;IP&nbsp;192.168.1.8.52219&nbsp;&gt;&nbsp;lists.squid-cache.org.http:&nbsp;Flags&nbsp;[S],&nbsp;seq&nbsp;1999822717,&nbsp;win&nbsp;29200,&nbsp;options&nbsp;[mss&nbsp;1460,sackOK,TS&nbsp;val&nbsp;26932760&nbsp;ecr&nbsp;0,nop,wscale&nbsp;7],&nbsp;length&nbsp;0&lt;br&gt;<br>
&lt;br&gt;<br>
But&nbsp;squid&nbsp;is&nbsp;not&nbsp;seeing&nbsp;them.&nbsp;Squid&nbsp;log&nbsp;is&nbsp;empty.&lt;br&gt;<br>
&lt;br&gt;<br>
Need&nbsp;advice.&nbsp;Thanks!&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
