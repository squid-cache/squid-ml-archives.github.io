<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Thanks&nbsp;for&nbsp;help,&nbsp;finally&nbsp;it&nbsp;seems&nbsp;to&nbsp;be&nbsp;working&nbsp;with&nbsp;following&nbsp;configuration&lt;div&gt;&lt;br&gt;&lt;div&gt;&lt;div&gt;http_port&nbsp;3128&nbsp;name=port_3128&lt;/div&gt;&lt;div&gt;http_port&nbsp;3127&nbsp;name=port_3127&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;nonhierarchical_direct&nbsp;off&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;acl&nbsp;port_3128_acl&nbsp;myportname&nbsp;port_3128&lt;/div&gt;&lt;div&gt;acl&nbsp;port_3127_acl&nbsp;myportname&nbsp;port_3127&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;always_direct&nbsp;deny&nbsp;port_3128_acl&lt;/div&gt;&lt;div&gt;always_direct&nbsp;deny&nbsp;port_3127_acl&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;never_direct&nbsp;allow&nbsp;port_3128_acl&lt;/div&gt;&lt;div&gt;never_direct&nbsp;allow&nbsp;port_3127_acl&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#&nbsp;3128&lt;/div&gt;&lt;div&gt;cache_peer&nbsp;proxy1&nbsp;parent&nbsp;3128&nbsp;0&nbsp;proxy-only&nbsp;default&nbsp; name=proxy3128&lt;/div&gt;&lt;div&gt;cache_peer_access&nbsp;proxy3128&nbsp;allow&nbsp;port_3128_acl&lt;/div&gt;&lt;div&gt;cache_peer_access&nbsp;proxy3128&nbsp;deny&nbsp;all&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#&nbsp;3127 &lt;/div&gt;&lt;div&gt;cache_peer&nbsp;proxy2&nbsp;parent&nbsp;3128&nbsp;0&nbsp;proxy-only&nbsp;default&nbsp; name=proxy3127&lt;/div&gt;&lt;div&gt;cache_peer_access&nbsp;proxy3127&nbsp;allow&nbsp;port_3127_acl&lt;/div&gt;&lt;div&gt;cache_peer_access&nbsp;proxy3127&nbsp;deny&nbsp;all&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;div&gt;For&nbsp;some&nbsp;reason&nbsp;&#39;&lt;span&nbsp;style=&quot;color:rgb(80,0,80);font-size:12.8px&quot;&gt;no-query&nbsp;originserver&#39;&nbsp;version&nbsp;didn&#39;t&nbsp;work,&nbsp;so&nbsp;I&nbsp;had&nbsp;to&nbsp;change&nbsp;it&nbsp;back&nbsp;to&nbsp;&#39;&lt;/span&gt;&lt;font&nbsp;color=&quot;#500050&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;proxy-only&nbsp;default&lt;/span&gt;&lt;/font&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80);font-size:12.8px&quot;&gt;&#39;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;2017-02-20&nbsp;23:26&nbsp;GMT+02:00&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&nbsp;target=&quot;_blank&quot;&gt;rousskov@measurement-factory.com&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;On&nbsp;02/20/2017&nbsp;02:08&nbsp;PM,&nbsp;Damir&nbsp;Bagapov&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;need&nbsp;to&nbsp;configure&nbsp;squid&nbsp;in&nbsp;a&nbsp;way&nbsp;when&nbsp;all&nbsp;incoming&nbsp;requests&nbsp;to&lt;br&gt;<br>
&gt;&nbsp;3128&nbsp;port&nbsp;will&nbsp;be&nbsp;redirected&nbsp;to&nbsp;proxy1&nbsp;(as&nbsp;it&nbsp;works&nbsp;now),&nbsp;and&nbsp;all&lt;br&gt;<br>
&gt;&nbsp;incoming&nbsp;requests&nbsp;to&nbsp;3127&nbsp;will&nbsp;be&nbsp;redirected&nbsp;to&nbsp;proxy2.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&gt;&nbsp;http_port&nbsp;3128&lt;br&gt;<br>
&gt;&nbsp;http_port&nbsp;3127&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;port_3128&nbsp;port&nbsp;3128&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;port_3127&nbsp;port&nbsp;3127&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;#&nbsp;3128&lt;br&gt;<br>
&gt;&nbsp;cache_peer&nbsp;proxy01&nbsp;parent&nbsp;3128&nbsp;0&nbsp;no-query&nbsp;originserver&nbsp;name=proxy3128&lt;br&gt;<br>
&gt;&nbsp;cache_peer_access&nbsp;proxy3128&nbsp;allow&nbsp;port_3128&lt;br&gt;<br>
&gt;&nbsp;cache_peer_access&nbsp;proxy3128&nbsp;deny&nbsp;port_3127&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;#&nbsp;3127&lt;br&gt;<br>
&gt;&nbsp;cache_peer&nbsp;proxy02&nbsp;parent&nbsp;3128&nbsp;0&nbsp;no-query&nbsp;originserver&nbsp;name=proxy3127&lt;br&gt;<br>
&gt;&nbsp;cache_peer_access&nbsp;proxy3127&nbsp;allow&nbsp;port_3127&lt;br&gt;<br>
&gt;&nbsp;cache_peer_access&nbsp;proxy3127&nbsp;deny&nbsp;port_3128&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;You&nbsp;probably&nbsp;want&nbsp;to&nbsp;use&nbsp;the&nbsp;&quot;myport&quot;&nbsp;ACLs&nbsp;instead&nbsp;of&nbsp;the&nbsp;&quot;port&quot;&nbsp;ACLs&lt;br&gt;<br>
because&nbsp;you&nbsp;route&nbsp;based&nbsp;on&nbsp;the&nbsp;Squid&nbsp;listening&nbsp;port,&nbsp;not&nbsp;the&nbsp;origin&lt;br&gt;<br>
server&nbsp;listening&nbsp;port.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;hope&nbsp;you&nbsp;do&nbsp;not&nbsp;need&nbsp;those&nbsp;&quot;deny&quot;&nbsp;rules&nbsp;for&nbsp;cache_peer_access&lt;br&gt;<br>
directives&nbsp;because&nbsp;the&nbsp;default&nbsp;--&nbsp;reverse&nbsp;the&nbsp;last&nbsp;action&nbsp;[for&nbsp;the&nbsp;same&lt;br&gt;<br>
peer]&nbsp;--&nbsp;should&nbsp;work&nbsp;fine.&nbsp;If&nbsp;you&nbsp;want&nbsp;or&nbsp;need&nbsp;to&nbsp;have&nbsp;explicit&nbsp;deny&lt;br&gt;<br>
rules,&nbsp;use&nbsp;&quot;deny&nbsp;all&quot;&nbsp;to&nbsp;clarify&nbsp;the&nbsp;intent&nbsp;and&nbsp;avoid&nbsp;the&nbsp;&quot;what&nbsp;if&nbsp;none&lt;br&gt;<br>
of&nbsp;the&nbsp;cache_peer_access&nbsp;rules&nbsp;match&nbsp;for&nbsp;a&nbsp;peer?&quot;&nbsp;concerns.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
HTH,&lt;br&gt;<br>
&lt;br&gt;<br>
Alex.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;--&nbsp;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_signature&quot;&nbsp;data-smartmail=&quot;gmail_signature&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Best&nbsp;regards,&lt;div&gt;Damir&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/div&gt;<br>

</tt>
