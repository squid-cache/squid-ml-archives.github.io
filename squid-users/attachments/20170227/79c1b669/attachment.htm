<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;27&nbsp;February&nbsp;2017&nbsp;at&nbsp;08:41,&nbsp;Test&nbsp;User&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:tuser6485@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;tuser6485@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;On&nbsp;Mon,&nbsp;Feb&nbsp;27,&nbsp;2017&nbsp;at&nbsp;2:53&nbsp;AM,&nbsp;Eliezer&nbsp;Croitoru&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:eliezer@ngtech.co.il&quot;&gt;eliezer@ngtech.co.il&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;Let&nbsp;me&nbsp;know&nbsp;if&nbsp;you&nbsp;need&nbsp;some&nbsp;help..&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;&quot;&gt;&gt;&lt;br&gt;<br>
&gt;&nbsp;Eliezer&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;----&lt;br&gt;<br>
&gt;&nbsp;Eliezer&nbsp;Croitoru&lt;br&gt;<br>
&gt;&nbsp;Linux&nbsp;System&nbsp;Administrator&lt;br&gt;<br>
&gt;&nbsp;Mobile:&nbsp;+972-5-28704261&lt;br&gt;<br>
&gt;&nbsp;Email:&nbsp;&lt;a&nbsp;href=&quot;mailto:eliezer@ngtech.co.il&quot;&gt;eliezer@ngtech.co.il&lt;/a&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;-----Original&nbsp;Message-----&lt;br&gt;<br>
&lt;/span&gt;&lt;div&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&gt;&nbsp;From:&nbsp;squid-users&nbsp;[mailto:&lt;a&nbsp;href=&quot;mailto:squid-users-bounces@lists.squid-cache.org&quot;&gt;squid-users-bounces@&lt;wbr&gt;lists.squid-cache.org&lt;/a&gt;]&nbsp;On&nbsp;Behalf&nbsp;Of&nbsp;Eliezer&nbsp;Croitoru&lt;br&gt;<br>
&gt;&nbsp;Sent:&nbsp;Sunday,&nbsp;February&nbsp;26,&nbsp;2017&nbsp;8:51&nbsp;PM&lt;br&gt;<br>
&gt;&nbsp;To:&nbsp;&#39;Test&nbsp;User&#39;&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:tuser6485@gmail.com&quot;&gt;tuser6485@gmail.com&lt;/a&gt;&gt;&lt;br&gt;<br>
&gt;&nbsp;Cc:&nbsp;&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.&lt;wbr&gt;org&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;Subject:&nbsp;Re:&nbsp;[squid-users]&nbsp;SSL-Bump:&nbsp;NAT/TPROXY&nbsp;lookup&nbsp;failed&nbsp;to&nbsp;locate&nbsp;original&nbsp;IPs&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Hey&nbsp;Michael,&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;The&nbsp;details&nbsp;you&nbsp;attached&nbsp;explained&nbsp;pretty&nbsp;well&nbsp;the&nbsp;cause&nbsp;for&nbsp;the&nbsp;issues&nbsp;you&nbsp;have&nbsp;described.&lt;br&gt;<br>
&gt;&nbsp;What&nbsp;you&nbsp;will&nbsp;need&nbsp;to&nbsp;do&nbsp;in&nbsp;order&nbsp;to&nbsp;make&nbsp;this&nbsp;setup&nbsp;to&nbsp;work&nbsp;can&nbsp;be&nbsp;done&nbsp;in&nbsp;more&nbsp;then&nbsp;one&nbsp;way.&lt;br&gt;<br>
&gt;&nbsp;For&nbsp;a&nbsp;sysadmin&nbsp;the&nbsp;simplest&nbsp;way&nbsp;is&nbsp;to&nbsp;create&nbsp;a&nbsp;VPN&nbsp;or&nbsp;some&nbsp;kind&nbsp;of&nbsp;a&nbsp;tunnel&nbsp;between&nbsp;the&nbsp;AWS&nbsp;instance&nbsp;to&nbsp;the&nbsp;local&nbsp;router.&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;am&nbsp;almost&nbsp;sure&nbsp;that&nbsp;you&nbsp;can&nbsp;use&nbsp;haproxy&nbsp;to&nbsp;do&nbsp;a&nbsp;local&nbsp;tproxy&nbsp;or&nbsp;interception&nbsp;that&nbsp;will&nbsp;forward&nbsp;the&nbsp;traffic&nbsp;to&nbsp;the&nbsp;remote&nbsp;squid&nbsp;with&nbsp;the&nbsp;PROXY&nbsp;protocol&nbsp;keeping&nbsp;original&nbsp;source&nbsp;and&nbsp;original&nbsp;destination&nbsp;visible&nbsp;to&nbsp;the&nbsp;remote&nbsp;squid.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;The&nbsp;choice&nbsp;will&nbsp;depend&nbsp;on&nbsp;both:&lt;br&gt;<br>
&gt;&nbsp;-&nbsp;your&nbsp;skills&nbsp;and&nbsp;will&nbsp;to&nbsp;dig&nbsp;some&nbsp;time&nbsp;about&nbsp;couple&nbsp;subjects&lt;br&gt;<br>
&gt;&nbsp;-&nbsp;The&nbsp;availability&nbsp;of&nbsp;static&nbsp;IP&nbsp;addresses(both&nbsp;local&nbsp;and&nbsp;AWS).&lt;br&gt;<br>
&gt;&nbsp;-&nbsp;The&nbsp;OS&nbsp;on&nbsp;both&nbsp;sides&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;believe&nbsp;that&nbsp;the&nbsp;next&nbsp;haproxy&nbsp;settings&nbsp;can&nbsp;be&nbsp;used&nbsp;as&nbsp;a&nbsp;compromise&nbsp;to&nbsp;a&nbsp;tunnel:&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;http://ngtech.co.il/paste/1605/&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://ngtech.co.il/paste/&lt;wbr&gt;1605/&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;And&nbsp;some&nbsp;tproxy&nbsp;route&nbsp;and&nbsp;iptables&nbsp;rules&nbsp;..&lt;br&gt;<br>
&gt;&nbsp;With&nbsp;a&nbsp;squid.conf&nbsp;which&nbsp;will&nbsp;be&nbsp;similar&nbsp;to:&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;frontend&nbsp;src&nbsp;100.0.0.1&lt;br&gt;<br>
&gt;&nbsp;proxy_protocol_access&nbsp;allow&nbsp;frontend&lt;br&gt;<br>
&gt;&nbsp;http_port&nbsp;3127&lt;br&gt;<br>
&gt;&nbsp;http_port&nbsp;3128&nbsp;require-proxy-header&nbsp;...&nbsp;ssl-bump&nbsp;settings&lt;br&gt;<br>
&gt;&nbsp;##END&nbsp;of&nbsp;example&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;However&nbsp;I&nbsp;do&nbsp;still&nbsp;believe&nbsp;that&nbsp;the&nbsp;more&nbsp;secure&nbsp;way&nbsp;would&nbsp;be&nbsp;to&nbsp;use&nbsp;some&nbsp;kind&nbsp;of&nbsp;vpn&nbsp;tunnel&nbsp;like&nbsp;OpenVPN&nbsp;between&nbsp;the&nbsp;local&nbsp;router&nbsp;to&nbsp;the&nbsp;remote&nbsp;AWS&nbsp;instance.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;All&nbsp;The&nbsp;Bests,&lt;br&gt;<br>
&gt;&nbsp;Eliezer&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;----&lt;br&gt;<br>
&gt;&nbsp;Eliezer&nbsp;Croitoru&lt;br&gt;<br>
&gt;&nbsp;Linux&nbsp;System&nbsp;Administrator&lt;br&gt;<br>
&gt;&nbsp;Mobile:&nbsp;+972-5-28704261&lt;br&gt;<br>
&gt;&nbsp;Email:&nbsp;&lt;a&nbsp;href=&quot;mailto:eliezer@ngtech.co.il&quot;&gt;eliezer@ngtech.co.il&lt;/a&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;-----Original&nbsp;Message-----&lt;br&gt;<br>
&gt;&nbsp;From:&nbsp;Test&nbsp;User&nbsp;[mailto:&lt;a&nbsp;href=&quot;mailto:tuser6485@gmail.com&quot;&gt;tuser6485@gmail.com&lt;/a&gt;]&lt;br&gt;<br>
&gt;&nbsp;Sent:&nbsp;Sunday,&nbsp;February&nbsp;26,&nbsp;2017&nbsp;8:38&nbsp;AM&lt;br&gt;<br>
&gt;&nbsp;To:&nbsp;Eliezer&nbsp;Croitoru&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:eliezer@ngtech.co.il&quot;&gt;eliezer@ngtech.co.il&lt;/a&gt;&gt;&lt;br&gt;<br>
&gt;&nbsp;Cc:&nbsp;&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.&lt;wbr&gt;org&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;Subject:&nbsp;Re:&nbsp;[squid-users]&nbsp;SSL-Bump:&nbsp;NAT/TPROXY&nbsp;lookup&nbsp;failed&nbsp;to&nbsp;locate&nbsp;original&nbsp;IPs&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;On&nbsp;Sun,&nbsp;Feb&nbsp;26,&nbsp;2017&nbsp;at&nbsp;10:40&nbsp;AM,&nbsp;Eliezer&nbsp;Croitoru&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:eliezer@ngtech.co.il&quot;&gt;eliezer@ngtech.co.il&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;<br>
&gt;&gt;&nbsp;Hey&nbsp;Michael,&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;You&nbsp;will&nbsp;need&nbsp;to&nbsp;clear&nbsp;out&nbsp;couple&nbsp;things&nbsp;for&nbsp;us.&lt;br&gt;<br>
&gt;&gt;&nbsp;First&nbsp;we&nbsp;will&nbsp;need&nbsp;one&nbsp;of&nbsp;the&nbsp;next&nbsp;ouputs&nbsp;or&nbsp;both:&lt;br&gt;<br>
&gt;&gt;&nbsp;iptables-save&lt;br&gt;<br>
&gt;&gt;&nbsp;iptables&nbsp;-L&nbsp;-nv&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;And&nbsp;then&nbsp;clear&nbsp;out&nbsp;where&nbsp;is&nbsp;this&nbsp;proxy&nbsp;sittings&nbsp;and&nbsp;the&nbsp;network&nbsp;structure.&lt;br&gt;<br>
&gt;&gt;&nbsp;It&#39;s&nbsp;not&nbsp;clear&nbsp;if&nbsp;the&nbsp;squid&nbsp;box&nbsp;is&nbsp;the&nbsp;router&nbsp;or&nbsp;a&nbsp;machine&nbsp;somewhere&nbsp;on&nbsp;AWS.&lt;br&gt;<br>
&gt;&gt;&nbsp;If&nbsp;you&nbsp;wish&nbsp;to&nbsp;pass&nbsp;traffic&nbsp;from&nbsp;a&nbsp;local&nbsp;router&nbsp;to&nbsp;a&nbsp;one&nbsp;on&nbsp;AWS&nbsp;you&nbsp;will&nbsp;need&nbsp;to&nbsp;create&nbsp;a&nbsp;tunnel&nbsp;like&nbsp;using&nbsp;OpenVPN&nbsp;or&nbsp;a&nbsp;similar&nbsp;solution&nbsp;and&nbsp;to&nbsp;use&nbsp;some&nbsp;routing&nbsp;rules&nbsp;to&nbsp;pass&nbsp;the&nbsp;traffic&nbsp;from&nbsp;the&nbsp;local&nbsp;LAN&nbsp;to&nbsp;AWS&nbsp;without&nbsp;removing&nbsp;the&nbsp;original&nbsp;destination&nbsp;address.&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;When&nbsp;more&nbsp;details&nbsp;on&nbsp;the&nbsp;setup&nbsp;will&nbsp;be&nbsp;available&nbsp;it&nbsp;will&nbsp;be&nbsp;much&nbsp;simpler&nbsp;to&nbsp;understand&nbsp;what&nbsp;is&nbsp;the&nbsp;root&nbsp;for&nbsp;some&nbsp;of&nbsp;the&nbsp;issues&nbsp;you&nbsp;are&nbsp;having.&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;All&nbsp;The&nbsp;Bests,&lt;br&gt;<br>
&gt;&gt;&nbsp;Eliezer&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;----&lt;br&gt;<br>
&gt;&gt;&nbsp;Eliezer&nbsp;Croitoru&lt;br&gt;<br>
&gt;&gt;&nbsp;Linux&nbsp;System&nbsp;Administrator&lt;br&gt;<br>
&gt;&gt;&nbsp;Mobile:&nbsp;+972-5-28704261&lt;br&gt;<br>
&gt;&gt;&nbsp;Email:&nbsp;&lt;a&nbsp;href=&quot;mailto:eliezer@ngtech.co.il&quot;&gt;eliezer@ngtech.co.il&lt;/a&gt;&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;-----Original&nbsp;Message-----&lt;br&gt;<br>
&gt;&gt;&nbsp;From:&nbsp;squid-users&nbsp;[mailto:&lt;a&nbsp;href=&quot;mailto:squid-users-bounces@lists.squid-cache.org&quot;&gt;squid-users-bounces@&lt;wbr&gt;lists.squid-cache.org&lt;/a&gt;]&nbsp;On&nbsp;Behalf&nbsp;Of&nbsp;Test&nbsp;User&lt;br&gt;<br>
&gt;&gt;&nbsp;Sent:&nbsp;Friday,&nbsp;February&nbsp;24,&nbsp;2017&nbsp;8:52&nbsp;AM&lt;br&gt;<br>
&gt;&gt;&nbsp;To:&nbsp;&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.&lt;wbr&gt;org&lt;/a&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;Subject:&nbsp;[squid-users]&nbsp;SSL-Bump:&nbsp;NAT/TPROXY&nbsp;lookup&nbsp;failed&nbsp;to&nbsp;locate&nbsp;original&nbsp;IPs&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;Hi,&lt;br&gt;<br>
&gt;&gt;&nbsp;Sorry&nbsp;I&nbsp;am&nbsp;asking&nbsp;this&nbsp;question&nbsp;again.&nbsp;I&nbsp;am&nbsp;trying&nbsp;to&nbsp;setup&nbsp;HTTPS&lt;br&gt;<br>
&gt;&gt;&nbsp;proxy&nbsp;using&nbsp;ssl-bump.&nbsp;I&nbsp;have&nbsp;followed&lt;br&gt;<br>
&gt;&gt;&nbsp;steps&nbsp;mentioned&nbsp;in:&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;a&nbsp;href=&quot;http://wiki.squid-cache.org/ConfigExamples/Intercept/SslBumpExplicit&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://wiki.squid-cache.org/&lt;wbr&gt;ConfigExamples/Intercept/&lt;wbr&gt;SslBumpExplicit&lt;/a&gt;&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;Following&nbsp;are&nbsp;Squid&nbsp;setup&nbsp;details:&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;Squid&nbsp;Cache:&nbsp;Version&nbsp;3.5.12&lt;br&gt;<br>
&gt;&gt;&nbsp;Service&nbsp;Name:&nbsp;squid&lt;br&gt;<br>
&gt;&gt;&nbsp;Ubuntu&nbsp;linux&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;configure&nbsp;options: &nbsp;&#39;--build=x86_64-linux-gnu&#39;&nbsp;&#39;--prefix=/usr&#39;&lt;br&gt;<br>
&gt;&gt;&nbsp;&#39;--includedir=${prefix}/&lt;wbr&gt;include&#39;&nbsp;&#39;--mandir=${prefix}/share/man&#39;&lt;br&gt;<br>
&gt;&gt;&nbsp;&#39;--infodir=${prefix}/share/&lt;wbr&gt;info&#39;&nbsp;&#39;--sysconfdir=/etc&#39;&lt;br&gt;<br>
&gt;&gt;&nbsp;&#39;--localstatedir=/var&#39;&nbsp;&#39;--libexecdir=${prefix}/lib/&lt;wbr&gt;squid3&#39;&lt;br&gt;<br>
&gt;&gt;&nbsp;&#39;--srcdir=.&#39;&nbsp;&#39;--disable-maintainer-mode&#39;&lt;br&gt;<br>
&gt;&gt;&nbsp;&#39;--disable-dependency-&lt;wbr&gt;tracking&#39;&nbsp;&#39;--disable-silent-rules&#39;&lt;br&gt;<br>
&gt;&gt;&nbsp;&#39;BUILDCXXFLAGS=-g&nbsp;-O2&nbsp;-fPIE&nbsp;-fstack-protector-strong&nbsp;-Wformat&lt;br&gt;<br>
&gt;&gt;&nbsp;-Werror=format-security&nbsp;-Wl,-Bsymbolic-functions&nbsp;-fPIE&nbsp;-pie&lt;br&gt;<br>
&gt;&gt;&nbsp;-Wl,-z,relro&nbsp;-Wl,-z,now&#39;&nbsp;&#39;--datadir=/usr/share/squid&#39;&lt;br&gt;<br>
&gt;&gt;&nbsp;&#39;--sysconfdir=/etc/squid&#39;&nbsp;&#39;--libexecdir=/usr/lib/squid&#39;&lt;br&gt;<br>
&gt;&gt;&nbsp;&#39;--mandir=/usr/share/man&#39;&nbsp;&#39;--enable-inline&#39;&nbsp;&#39;--disable-arch-native&#39;&lt;br&gt;<br>
&gt;&gt;&nbsp;&#39;--enable-async-io=8&#39;&nbsp;&#39;--enable-storeio=ufs,aufs,&lt;wbr&gt;diskd,rock&#39;&lt;br&gt;<br>
&gt;&gt;&nbsp;&#39;--enable-removal-policies=&lt;wbr&gt;lru,heap&#39;&nbsp;&#39;--enable-delay-pools&#39;&lt;br&gt;<br>
&gt;&gt;&nbsp;&#39;--enable-cache-digests&#39;&nbsp;&#39;--enable-icap-client&#39;&lt;br&gt;<br>
&gt;&gt;&nbsp;&#39;--enable-follow-x-forwarded-&lt;wbr&gt;for&#39;&lt;br&gt;<br>
&gt;&gt;&nbsp;&#39;--enable-auth-basic=DB,fake,&lt;wbr&gt;getpwnam,LDAP,NCSA,NIS,PAM,&lt;wbr&gt;POP3,RADIUS,SASL,SMB&#39;&lt;br&gt;<br>
&gt;&gt;&nbsp;&#39;--enable-auth-digest=file,&lt;wbr&gt;LDAP&#39;&lt;br&gt;<br>
&gt;&gt;&nbsp;&#39;--enable-auth-negotiate=&lt;wbr&gt;kerberos,wrapper&#39;&lt;br&gt;<br>
&gt;&gt;&nbsp;&#39;--enable-auth-ntlm=fake,smb_&lt;wbr&gt;lm&#39;&lt;br&gt;<br>
&gt;&gt;&nbsp;&#39;--enable-external-acl-&lt;wbr&gt;helpers=file_userip,kerberos_&lt;wbr&gt;ldap_group,LDAP_group,session,&lt;wbr&gt;SQL_session,unix_group,wbinfo_&lt;wbr&gt;group&#39;&lt;br&gt;<br>
&gt;&gt;&nbsp;&#39;--enable-url-rewrite-helpers=&lt;wbr&gt;fake&#39;&nbsp;&#39;--enable-eui&#39;&nbsp;&#39;--enable-esi&#39;&lt;br&gt;<br>
&gt;&gt;&nbsp;&#39;--enable-icmp&#39;&nbsp;&#39;--enable-zph-qos&#39;&nbsp;&#39;--enable-ecap&#39;&nbsp;&#39;--with-openssl&#39;&lt;br&gt;<br>
&gt;&gt;&nbsp;&#39;--enable-ssl-crtd&#39;&nbsp;&#39;--disable-translation&#39;&lt;br&gt;<br>
&gt;&gt;&nbsp;&#39;--with-swapdir=/var/spool/&lt;wbr&gt;squid&#39;&nbsp;&#39;--with-logdir=/var/log/squid&#39;&lt;br&gt;<br>
&gt;&gt;&nbsp;&#39;--with-pidfile=/var/run/&lt;wbr&gt;squid.pid&#39;&nbsp;&#39;--with-filedescriptors=65536&#39;&lt;br&gt;<br>
&gt;&gt;&nbsp;&#39;--with-large-files&#39;&nbsp;&#39;--with-default-user=proxy&#39;&lt;br&gt;<br>
&gt;&gt;&nbsp;&#39;--enable-build-info=Ubuntu&nbsp;linux&#39;&nbsp;&#39;--enable-linux-netfilter&#39;&lt;br&gt;<br>
&gt;&gt;&nbsp;&#39;build_alias=x86_64-linux-gnu&#39;&nbsp;&#39;CFLAGS=-g&nbsp;-O2&nbsp;-fPIE&lt;br&gt;<br>
&gt;&gt;&nbsp;-fstack-protector-strong&nbsp;-Wformat&nbsp;-Werror=format-security&nbsp;-Wall&#39;&lt;br&gt;<br>
&gt;&gt;&nbsp;&#39;LDFLAGS=-Wl,-Bsymbolic-&lt;wbr&gt;functions&nbsp;-fPIE&nbsp;-pie&nbsp;-Wl,-z,relro&nbsp;-Wl,-z,now&#39;&lt;br&gt;<br>
&gt;&gt;&nbsp;&#39;CPPFLAGS=-Wdate-time&nbsp;-D_FORTIFY_SOURCE=2&#39;&nbsp;&#39;CXXFLAGS=-g&nbsp;-O2&nbsp;-fPIE&lt;br&gt;<br>
&gt;&gt;&nbsp;-fstack-protector-strong&nbsp;-Wformat&nbsp;-Werror=format-security&#39;&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;Following&nbsp;is&nbsp;my&nbsp;squid.conf&nbsp;file:&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;SSL_ports&nbsp;port&nbsp;443&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;80&nbsp;#&nbsp;http&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;21&nbsp;#&nbsp;ftp&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;443&nbsp;#&nbsp;https&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;70&nbsp;#&nbsp;gopher&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;210&nbsp;#&nbsp;wais&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;1025-65535&nbsp;#&nbsp;unregistered&nbsp;ports&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;280&nbsp;#&nbsp;http-mgmt&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;488&nbsp;#&nbsp;gss-http&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;591&nbsp;#&nbsp;filemaker&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;777&nbsp;#&nbsp;multiling&nbsp;http&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;CONNECT&nbsp;method&nbsp;CONNECT&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;step1&nbsp;at_step&nbsp;SslBump1&lt;br&gt;<br>
&gt;&gt;&nbsp;http_access&nbsp;deny&nbsp;!Safe_ports&lt;br&gt;<br>
&gt;&gt;&nbsp;http_access&nbsp;deny&nbsp;CONNECT&nbsp;!SSL_ports&lt;br&gt;<br>
&gt;&gt;&nbsp;http_access&nbsp;allow&nbsp;localhost&nbsp;manager&lt;br&gt;<br>
&gt;&gt;&nbsp;http_access&nbsp;deny&nbsp;manager&lt;br&gt;<br>
&gt;&gt;&nbsp;http_access&nbsp;allow&nbsp;localhost&lt;br&gt;<br>
&gt;&gt;&nbsp;http_access&nbsp;allow&nbsp;all&lt;br&gt;<br>
&gt;&gt;&nbsp;http_port&nbsp;3128&nbsp;ssl-bump&nbsp;\&lt;br&gt;<br>
&gt;&gt; &nbsp; cert=/etc/squid/ssl_cert/&lt;wbr&gt;squidCA.pem&nbsp;\&lt;br&gt;<br>
&gt;&gt; &nbsp; generate-host-certificates=on&nbsp;dynamic_cert_mem_cache_size=&lt;wbr&gt;4MB&lt;br&gt;<br>
&gt;&gt;&nbsp;https_port&nbsp;3129&nbsp;intercept&nbsp;ssl-bump&nbsp;generate-host-certificates=on&nbsp;\&lt;br&gt;<br>
&gt;&gt;&nbsp;dynamic_cert_mem_cache_size=&lt;wbr&gt;4MB&nbsp;cert=/etc/squid/ssl_cert/&lt;wbr&gt;squidCA.pem&nbsp;\&lt;br&gt;<br>
&gt;&gt;&nbsp;dhparams=/etc/squid/ssl_cert/&lt;wbr&gt;dhparam.pem&lt;br&gt;<br>
&gt;&gt;&nbsp;sslproxy_options&nbsp;NO_SSLv2,NO_SSLv3,SINGLE_DH_&lt;wbr&gt;USE&lt;br&gt;<br>
&gt;&gt;&nbsp;sslproxy_cipher&lt;br&gt;<br>
&gt;&gt;&nbsp;EECDH+ECDSA+AESGCM:EECDH+aRSA+&lt;wbr&gt;AESGCM:EECDH+ECDSA+SHA384:&lt;wbr&gt;EECDH+ECDSA+SHA256:EECDH+aRSA+&lt;wbr&gt;SHA384:EECDH+aRSA+SHA256:&lt;wbr&gt;EECDH+aRSA+RC4:EECDH:EDH+aRSA:&lt;wbr&gt;!RC4:!aNULL:!eNULL:!LOW:!3DES:&lt;wbr&gt;!MD5:!EXP:!PSK:!SRP:!DSS&lt;br&gt;<br>
&gt;&gt;&nbsp;sslcrtd_program&nbsp;/usr/lib/squid/ssl_crtd&nbsp;-s&nbsp;/var/spool/squid3_ssldb&nbsp;-M&nbsp;4MB&lt;br&gt;<br>
&gt;&gt;&nbsp;debug_options&nbsp;ALL,1&nbsp;3,5&nbsp;4,5&nbsp;11,5&nbsp;17,5&nbsp;23,5&nbsp;46,5&nbsp;78,5&nbsp;rotate=1&lt;br&gt;<br>
&gt;&gt;&nbsp;coredump_dir&nbsp;/var/spool/squid&lt;br&gt;<br>
&gt;&gt;&nbsp;refresh_pattern&nbsp;^ftp:&nbsp;1440&nbsp;20%&nbsp;10080&lt;br&gt;<br>
&gt;&gt;&nbsp;refresh_pattern&nbsp;^gopher:&nbsp;1440&nbsp;0%&nbsp;1440&lt;br&gt;<br>
&gt;&gt;&nbsp;refresh_pattern&nbsp;-i&nbsp;(/cgi-bin/|\?)&nbsp;0&nbsp;0%&nbsp;0&lt;br&gt;<br>
&gt;&gt;&nbsp;refresh_pattern&nbsp;(Release|Packages(.gz)*)$ &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp; 20% &nbsp; &nbsp; 2880&lt;br&gt;<br>
&gt;&gt;&nbsp;refresh_pattern&nbsp;.&nbsp;0&nbsp;20%&nbsp;4320&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;I&nbsp;get&nbsp;no&nbsp;errors&nbsp;while&nbsp;starting&nbsp;Squid.&nbsp;Following&nbsp;are&nbsp;the&nbsp;logs&nbsp;when&nbsp;Squid&nbsp;starts:&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53&nbsp;kid1|&nbsp;Set&nbsp;Current&nbsp;Directory&nbsp;to&nbsp;/var/spool/squid&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53&nbsp;kid1|&nbsp;Starting&nbsp;Squid&nbsp;Cache&nbsp;version&nbsp;3.5.12&nbsp;for&lt;br&gt;<br>
&gt;&gt;&nbsp;x86_64-pc-linux-gnu...&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53&nbsp;kid1|&nbsp;Service&nbsp;Name:&nbsp;squid&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53&nbsp;kid1|&nbsp;Process&nbsp;ID&nbsp;26236&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53&nbsp;kid1|&nbsp;Process&nbsp;Roles:&nbsp;worker&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53&nbsp;kid1|&nbsp;With&nbsp;65535&nbsp;file&nbsp;descriptors&nbsp;available&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53&nbsp;kid1|&nbsp;Initializing&nbsp;IP&nbsp;Cache...&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.756&nbsp;kid1|&nbsp;78,2|&nbsp;dns_internal.cc(1525)&nbsp;dnsInit:&lt;br&gt;<br>
&gt;&gt;&nbsp;idnsInit:&nbsp;attempt&nbsp;open&nbsp;DNS&nbsp;socket&nbsp;to:&nbsp;[::]&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.756&nbsp;kid1|&nbsp;78,2|&nbsp;dns_internal.cc(1534)&nbsp;dnsInit:&lt;br&gt;<br>
&gt;&gt;&nbsp;idnsInit:&nbsp;attempt&nbsp;open&nbsp;DNS&nbsp;socket&nbsp;to:&nbsp;0.0.0.0&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.756&nbsp;kid1|&nbsp;DNS&nbsp;Socket&nbsp;created&nbsp;at&nbsp;[::],&nbsp;FD&nbsp;6&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.756&nbsp;kid1|&nbsp;DNS&nbsp;Socket&nbsp;created&nbsp;at&nbsp;0.0.0.0,&nbsp;FD&nbsp;7&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.756&nbsp;kid1|&nbsp;Adding&nbsp;nameserver&nbsp;172.31.0.2&nbsp;from&nbsp;/etc/resolv.conf&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.756&nbsp;kid1|&nbsp;78,3|&nbsp;dns_internal.cc(321)&lt;br&gt;<br>
&gt;&gt;&nbsp;idnsAddNameserver:&nbsp;idnsAddNameserver:&nbsp;Added&nbsp;nameserver&nbsp;#0&lt;br&gt;<br>
&gt;&gt;&nbsp;(&lt;a&nbsp;href=&quot;http://172.31.0.2:53&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;172.31.0.2:53&lt;/a&gt;)&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.756&nbsp;kid1|&nbsp;Adding&nbsp;domain&lt;br&gt;<br>
&gt;&gt;&nbsp;ap-south-1.compute.internal&nbsp;from&nbsp;/etc/resolv.conf&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.756&nbsp;kid1|&nbsp;78,3|&nbsp;dns_internal.cc(350)&lt;br&gt;<br>
&gt;&gt;&nbsp;idnsAddPathComponent:&nbsp;idnsAddPathComponent:&nbsp;Added&nbsp;domain&nbsp;#0:&lt;br&gt;<br>
&gt;&gt;&nbsp;ap-south-1.compute.internal&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.756&nbsp;kid1|&nbsp;helperOpenServers:&nbsp;Starting&nbsp;5/32&lt;br&gt;<br>
&gt;&gt;&nbsp;&#39;ssl_crtd&#39;&nbsp;processes&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.775&nbsp;kid1|&nbsp;46,2|&nbsp;Format.cc(64)&nbsp;parse:&nbsp;got&lt;br&gt;<br>
&gt;&gt;&nbsp;definition&nbsp;&#39;%&gt;a/%&gt;A&nbsp;%un&nbsp;%&gt;rm&nbsp;myip=%la&nbsp;myport=%lp&#39;&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.775&nbsp;kid1|&nbsp;46,5|&nbsp;Token.cc(380)&nbsp;parse:&nbsp;scan&nbsp;for&lt;br&gt;<br>
&gt;&gt;&nbsp;possible&nbsp;Misc&nbsp;token&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.775&nbsp;kid1|&nbsp;46,5|&nbsp;Token.cc(384)&nbsp;parse:&nbsp;scan&nbsp;for&lt;br&gt;<br>
&gt;&gt;&nbsp;possible&nbsp;2C&nbsp;token&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.775&nbsp;kid1|&nbsp;46,5|&nbsp;Token.cc(389)&nbsp;parse:&nbsp;scan&nbsp;for&lt;br&gt;<br>
&gt;&gt;&nbsp;possible&nbsp;1C&nbsp;token&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.775&nbsp;kid1|&nbsp;46,5|&nbsp;Token.cc(380)&nbsp;parse:&nbsp;scan&nbsp;for&lt;br&gt;<br>
&gt;&gt;&nbsp;possible&nbsp;Misc&nbsp;token&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.775&nbsp;kid1|&nbsp;46,5|&nbsp;Token.cc(384)&nbsp;parse:&nbsp;scan&nbsp;for&lt;br&gt;<br>
&gt;&gt;&nbsp;possible&nbsp;2C&nbsp;token&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.775&nbsp;kid1|&nbsp;46,5|&nbsp;Token.cc(389)&nbsp;parse:&nbsp;scan&nbsp;for&lt;br&gt;<br>
&gt;&gt;&nbsp;possible&nbsp;1C&nbsp;token&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.775&nbsp;kid1|&nbsp;46,5|&nbsp;Token.cc(380)&nbsp;parse:&nbsp;scan&nbsp;for&lt;br&gt;<br>
&gt;&gt;&nbsp;possible&nbsp;Misc&nbsp;token&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.775&nbsp;kid1|&nbsp;46,5|&nbsp;Token.cc(384)&nbsp;parse:&nbsp;scan&nbsp;for&lt;br&gt;<br>
&gt;&gt;&nbsp;possible&nbsp;2C&nbsp;token&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.775&nbsp;kid1|&nbsp;46,5|&nbsp;Token.cc(380)&nbsp;parse:&nbsp;scan&nbsp;for&lt;br&gt;<br>
&gt;&gt;&nbsp;possible&nbsp;Misc&nbsp;token&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.775&nbsp;kid1|&nbsp;46,5|&nbsp;Token.cc(384)&nbsp;parse:&nbsp;scan&nbsp;for&lt;br&gt;<br>
&gt;&gt;&nbsp;possible&nbsp;2C&nbsp;token&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.775&nbsp;kid1|&nbsp;46,5|&nbsp;Token.cc(380)&nbsp;parse:&nbsp;scan&nbsp;for&lt;br&gt;<br>
&gt;&gt;&nbsp;possible&nbsp;Misc&nbsp;token&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.775&nbsp;kid1|&nbsp;46,5|&nbsp;Token.cc(384)&nbsp;parse:&nbsp;scan&nbsp;for&lt;br&gt;<br>
&gt;&gt;&nbsp;possible&nbsp;2C&nbsp;token&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.775&nbsp;kid1|&nbsp;46,5|&nbsp;Token.cc(380)&nbsp;parse:&nbsp;scan&nbsp;for&lt;br&gt;<br>
&gt;&gt;&nbsp;possible&nbsp;Misc&nbsp;token&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.775&nbsp;kid1|&nbsp;46,5|&nbsp;Token.cc(384)&nbsp;parse:&nbsp;scan&nbsp;for&lt;br&gt;<br>
&gt;&gt;&nbsp;possible&nbsp;2C&nbsp;token&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.775&nbsp;kid1|&nbsp;46,2|&nbsp;Format.cc(64)&nbsp;parse:&nbsp;got&lt;br&gt;<br>
&gt;&gt;&nbsp;definition&nbsp;&#39;%&gt;a/%&gt;A&nbsp;%un&nbsp;%&gt;rm&nbsp;myip=%la&nbsp;myport=%lp&#39;&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.775&nbsp;kid1|&nbsp;46,5|&nbsp;Token.cc(380)&nbsp;parse:&nbsp;scan&nbsp;for&lt;br&gt;<br>
&gt;&gt;&nbsp;possible&nbsp;Misc&nbsp;token&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.775&nbsp;kid1|&nbsp;46,5|&nbsp;Token.cc(384)&nbsp;parse:&nbsp;scan&nbsp;for&lt;br&gt;<br>
&gt;&gt;&nbsp;possible&nbsp;2C&nbsp;token&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.775&nbsp;kid1|&nbsp;46,5|&nbsp;Token.cc(389)&nbsp;parse:&nbsp;scan&nbsp;for&lt;br&gt;<br>
&gt;&gt;&nbsp;possible&nbsp;1C&nbsp;token&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.775&nbsp;kid1|&nbsp;46,5|&nbsp;Token.cc(380)&nbsp;parse:&nbsp;scan&nbsp;for&lt;br&gt;<br>
&gt;&gt;&nbsp;possible&nbsp;Misc&nbsp;token&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.775&nbsp;kid1|&nbsp;46,5|&nbsp;Token.cc(384)&nbsp;parse:&nbsp;scan&nbsp;for&lt;br&gt;<br>
&gt;&gt;&nbsp;possible&nbsp;2C&nbsp;token&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.775&nbsp;kid1|&nbsp;46,5|&nbsp;Token.cc(389)&nbsp;parse:&nbsp;scan&nbsp;for&lt;br&gt;<br>
&gt;&gt;&nbsp;possible&nbsp;1C&nbsp;token&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.775&nbsp;kid1|&nbsp;46,5|&nbsp;Token.cc(380)&nbsp;parse:&nbsp;scan&nbsp;for&lt;br&gt;<br>
&gt;&gt;&nbsp;possible&nbsp;Misc&nbsp;token&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.775&nbsp;kid1|&nbsp;46,5|&nbsp;Token.cc(384)&nbsp;parse:&nbsp;scan&nbsp;for&lt;br&gt;<br>
&gt;&gt;&nbsp;possible&nbsp;2C&nbsp;token&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.775&nbsp;kid1|&nbsp;46,5|&nbsp;Token.cc(380)&nbsp;parse:&nbsp;scan&nbsp;for&lt;br&gt;<br>
&gt;&gt;&nbsp;possible&nbsp;Misc&nbsp;token&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.775&nbsp;kid1|&nbsp;46,5|&nbsp;Token.cc(384)&nbsp;parse:&nbsp;scan&nbsp;for&lt;br&gt;<br>
&gt;&gt;&nbsp;possible&nbsp;2C&nbsp;token&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.775&nbsp;kid1|&nbsp;46,5|&nbsp;Token.cc(380)&nbsp;parse:&nbsp;scan&nbsp;for&lt;br&gt;<br>
&gt;&gt;&nbsp;possible&nbsp;Misc&nbsp;token&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.775&nbsp;kid1|&nbsp;46,5|&nbsp;Token.cc(384)&nbsp;parse:&nbsp;scan&nbsp;for&lt;br&gt;<br>
&gt;&gt;&nbsp;possible&nbsp;2C&nbsp;token&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.775&nbsp;kid1|&nbsp;46,5|&nbsp;Token.cc(380)&nbsp;parse:&nbsp;scan&nbsp;for&lt;br&gt;<br>
&gt;&gt;&nbsp;possible&nbsp;Misc&nbsp;token&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.775&nbsp;kid1|&nbsp;46,5|&nbsp;Token.cc(384)&nbsp;parse:&nbsp;scan&nbsp;for&lt;br&gt;<br>
&gt;&gt;&nbsp;possible&nbsp;2C&nbsp;token&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.775&nbsp;kid1|&nbsp;Logfile:&nbsp;opening&nbsp;log&lt;br&gt;<br>
&gt;&gt;&nbsp;daemon:/var/log/squid/access.&lt;wbr&gt;log&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.775&nbsp;kid1|&nbsp;Logfile&nbsp;Daemon:&nbsp;opening&nbsp;log&lt;br&gt;<br>
&gt;&gt;&nbsp;/var/log/squid/access.log&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.779&nbsp;kid1|&nbsp;23,5|&nbsp;url.cc(43)&nbsp;urlInitialize:&lt;br&gt;<br>
&gt;&gt;&nbsp;urlInitialize:&nbsp;Initializing...&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.779&nbsp;kid1|&nbsp;Local&nbsp;cache&nbsp;digest&nbsp;enabled;&lt;br&gt;<br>
&gt;&gt;&nbsp;rebuild/rewrite&nbsp;every&nbsp;3600/3600&nbsp;sec&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.779&nbsp;kid1|&nbsp;Store&nbsp;logging&nbsp;disabled&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.779&nbsp;kid1|&nbsp;Swap&nbsp;maxSize&nbsp;0&nbsp;+&nbsp;262144&nbsp;KB,&nbsp;estimated&lt;br&gt;<br>
&gt;&gt;&nbsp;20164&nbsp;objects&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.779&nbsp;kid1|&nbsp;Target&nbsp;number&nbsp;of&nbsp;buckets:&nbsp;1008&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.779&nbsp;kid1|&nbsp;Using&nbsp;8192&nbsp;Store&nbsp;buckets&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.779&nbsp;kid1|&nbsp;Max&nbsp;Mem &nbsp;size:&nbsp;262144&nbsp;KB&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.779&nbsp;kid1|&nbsp;Max&nbsp;Swap&nbsp;size:&nbsp;0&nbsp;KB&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.779&nbsp;kid1|&nbsp;Using&nbsp;Least&nbsp;Load&nbsp;store&nbsp;dir&nbsp;selection&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.779&nbsp;kid1|&nbsp;Set&nbsp;Current&nbsp;Directory&nbsp;to&nbsp;/var/spool/squid&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.785&nbsp;kid1|&nbsp;23,3|&nbsp;url.cc(357)&nbsp;urlParse:&nbsp;urlParse:&lt;br&gt;<br>
&gt;&gt;&nbsp;Split&nbsp;URL&nbsp;&#39;&lt;a&nbsp;href=&quot;http://ip-172-31-25-235:3128/squid-internal-static/icons/silk/image.png&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://ip-172-31-25-235:3128/&lt;wbr&gt;squid-internal-static/icons/&lt;wbr&gt;silk/image.png&lt;/a&gt;&#39;&lt;br&gt;<br>
&gt;&gt;&nbsp;into&nbsp;proto=&#39;http&#39;,&nbsp;host=&#39;ip-172-31-25-235&#39;,&nbsp;port=&#39;3128&#39;,&lt;br&gt;<br>
&gt;&gt;&nbsp;path=&#39;/squid-internal-static/&lt;wbr&gt;icons/silk/image.png&#39;&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.785&nbsp;kid1|&nbsp;23,3|&nbsp;url.cc(357)&nbsp;urlParse:&nbsp;urlParse:&lt;br&gt;<br>
&gt;&gt;&nbsp;Split&nbsp;URL&nbsp;&#39;&lt;a&nbsp;href=&quot;http://ip-172-31-25-235:3128/squid-internal-static/icons/silk/page_white_text.png&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://ip-172-31-25-235:3128/&lt;wbr&gt;squid-internal-static/icons/&lt;wbr&gt;silk/page_white_text.png&lt;/a&gt;&#39;&lt;br&gt;<br>
&gt;&gt;&nbsp;into&nbsp;proto=&#39;http&#39;,&nbsp;host=&#39;ip-172-31-25-235&#39;,&nbsp;port=&#39;3128&#39;,&lt;br&gt;<br>
&gt;&gt;&nbsp;path=&#39;/squid-internal-static/&lt;wbr&gt;icons/silk/page_white_text.&lt;wbr&gt;png&#39;&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;****several&nbsp;urlParse&nbsp;logs&nbsp;like&nbsp;above.&nbsp;Removing&nbsp;them&nbsp;to&nbsp;shorten&nbsp;the&lt;br&gt;<br>
&gt;&gt;&nbsp;email.&nbsp;Further&nbsp;logs&nbsp;below...****&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.815&nbsp;kid1|&nbsp;Finished&nbsp;loading&nbsp;MIME&nbsp;types&nbsp;and&nbsp;icons.&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.815&nbsp;kid1|&nbsp;HTCP&nbsp;Disabled.&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.815&nbsp;kid1|&nbsp;Pinger&nbsp;socket&nbsp;opened&nbsp;on&nbsp;FD&nbsp;25&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.815&nbsp;kid1|&nbsp;Squid&nbsp;plugin&nbsp;modules&nbsp;loaded:&nbsp;0&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.815&nbsp;kid1|&nbsp;Adaptation&nbsp;support&nbsp;is&nbsp;off.&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.815&nbsp;kid1|&nbsp;Accepting&nbsp;SSL&nbsp;bumped&nbsp;HTTP&nbsp;Socket&lt;br&gt;<br>
&gt;&gt;&nbsp;connections&nbsp;at&nbsp;local=[::]:3128&nbsp;remote=[::]&nbsp;FD&nbsp;22&nbsp;flags=9&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53.815&nbsp;kid1|&nbsp;Accepting&nbsp;NAT&nbsp;intercepted&nbsp;SSL&nbsp;bumped&lt;br&gt;<br>
&gt;&gt;&nbsp;HTTPS&nbsp;Socket&nbsp;connections&nbsp;at&nbsp;local=[::]:3129&nbsp;remote=[::]&nbsp;FD&nbsp;23&nbsp;flags=41&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53|&nbsp;pinger:&nbsp;Initialising&nbsp;ICMP&nbsp;pinger&nbsp;...&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53|&nbsp;pinger:&nbsp;ICMP&nbsp;socket&nbsp;opened.&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:53|&nbsp;pinger:&nbsp;ICMPv6&nbsp;socket&nbsp;opened&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;09:59:54&nbsp;kid1|&nbsp;storeLateRelease:&nbsp;released&nbsp;0&nbsp;objects&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;I&nbsp;tested&nbsp;this&nbsp;setup&nbsp;by&nbsp;providing&nbsp;proxy&nbsp;details&nbsp;to&nbsp;Firefox.&nbsp;Firefox&nbsp;was&lt;br&gt;<br>
&gt;&gt;&nbsp;able&nbsp;to&nbsp;show&nbsp;HTTP&nbsp;websites&nbsp;but&nbsp;when&nbsp;I&nbsp;tried&nbsp;to&nbsp;open&nbsp;an&nbsp;HTTPS&nbsp;website&nbsp;I&lt;br&gt;<br>
&gt;&gt;&nbsp;got&nbsp;following&nbsp;error:&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;11:00:50&nbsp;kid1|&nbsp;ERROR:&nbsp;NF&nbsp;getsockopt(ORIGINAL_DST)&nbsp;failed&nbsp;on&lt;br&gt;<br>
&gt;&gt;&nbsp;local=&lt;a&nbsp;href=&quot;http://172.31.25.235:3129&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;172.31.25.235:3129&lt;/a&gt;&nbsp;remote=&lt;a&nbsp;href=&quot;http://182.72.78.122:50655&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;182.72.78.122:50655&lt;/a&gt;&nbsp;FD&nbsp;7&nbsp;flags=33:&lt;br&gt;<br>
&gt;&gt;&nbsp;(92)&nbsp;Protocol&nbsp;not&nbsp;available&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;11:00:50&nbsp;kid1|&nbsp;ERROR:&nbsp;NAT/TPROXY&nbsp;lookup&nbsp;failed&nbsp;to&nbsp;locate&lt;br&gt;<br>
&gt;&gt;&nbsp;original&nbsp;IPs&nbsp;on&nbsp;local=&lt;a&nbsp;href=&quot;http://172.31.25.235:3129&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;172.31.25.235:3129&lt;/a&gt;&nbsp;remote=&lt;a&nbsp;href=&quot;http://182.72.78.122:50655&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;182.72.78.122:50655&lt;/a&gt;&nbsp;FD&lt;br&gt;<br>
&gt;&gt;&nbsp;7&nbsp;flags=33&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;11:00:50&nbsp;kid1|&nbsp;ERROR:&nbsp;NF&nbsp;getsockopt(ORIGINAL_DST)&nbsp;failed&nbsp;on&lt;br&gt;<br>
&gt;&gt;&nbsp;local=&lt;a&nbsp;href=&quot;http://172.31.25.235:3129&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;172.31.25.235:3129&lt;/a&gt;&nbsp;remote=&lt;a&nbsp;href=&quot;http://182.72.78.122:50656&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;182.72.78.122:50656&lt;/a&gt;&nbsp;FD&nbsp;7&nbsp;flags=33:&lt;br&gt;<br>
&gt;&gt;&nbsp;(92)&nbsp;Protocol&nbsp;not&nbsp;available&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;11:00:50&nbsp;kid1|&nbsp;ERROR:&nbsp;NAT/TPROXY&nbsp;lookup&nbsp;failed&nbsp;to&nbsp;locate&lt;br&gt;<br>
&gt;&gt;&nbsp;original&nbsp;IPs&nbsp;on&nbsp;local=&lt;a&nbsp;href=&quot;http://172.31.25.235:3129&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;172.31.25.235:3129&lt;/a&gt;&nbsp;remote=&lt;a&nbsp;href=&quot;http://182.72.78.122:50656&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;182.72.78.122:50656&lt;/a&gt;&nbsp;FD&lt;br&gt;<br>
&gt;&gt;&nbsp;7&nbsp;flags=33&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;11:00:50&nbsp;kid1|&nbsp;ERROR:&nbsp;NF&nbsp;getsockopt(ORIGINAL_DST)&nbsp;failed&nbsp;on&lt;br&gt;<br>
&gt;&gt;&nbsp;local=&lt;a&nbsp;href=&quot;http://172.31.25.235:3129&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;172.31.25.235:3129&lt;/a&gt;&nbsp;remote=&lt;a&nbsp;href=&quot;http://182.72.78.122:50657&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;182.72.78.122:50657&lt;/a&gt;&nbsp;FD&nbsp;7&nbsp;flags=33:&lt;br&gt;<br>
&gt;&gt;&nbsp;(92)&nbsp;Protocol&nbsp;not&nbsp;available&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/02/23&nbsp;11:00:50&nbsp;kid1|&nbsp;ERROR:&nbsp;NAT/TPROXY&nbsp;lookup&nbsp;failed&nbsp;to&nbsp;locate&lt;br&gt;<br>
&gt;&gt;&nbsp;original&nbsp;IPs&nbsp;on&nbsp;local=&lt;a&nbsp;href=&quot;http://172.31.25.235:3129&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;172.31.25.235:3129&lt;/a&gt;&nbsp;remote=&lt;a&nbsp;href=&quot;http://182.72.78.122:50657&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;182.72.78.122:50657&lt;/a&gt;&nbsp;FD&lt;br&gt;<br>
&gt;&gt;&nbsp;7&nbsp;flags=33&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;I&nbsp;googled&nbsp;this&nbsp;error&nbsp;and&nbsp;found&nbsp;this&nbsp;mail&nbsp;thread&nbsp;which&nbsp;had&nbsp;similar&nbsp;problems:&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;a&nbsp;href=&quot;http://squid-web-proxy-cache.1019090.n4.nabble.com/NAT-TPROXY-lookup-failed-to-locate-original-IPs-td4675464.html&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://squid-web-proxy-cache.&lt;wbr&gt;1019090.n4.nabble.com/NAT-&lt;wbr&gt;TPROXY-lookup-failed-to-&lt;wbr&gt;locate-original-IPs-td4675464.&lt;wbr&gt;html&lt;/a&gt;&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;I&nbsp;found&nbsp;this&nbsp;link&nbsp;from&nbsp;the&nbsp;above&nbsp;thread.&nbsp;I&nbsp;modified&nbsp;the&nbsp;steps&nbsp;for&lt;br&gt;<br>
&gt;&gt;&nbsp;HTTPS&nbsp;from&nbsp;the&nbsp;below&nbsp;link:&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;a&nbsp;href=&quot;http://wiki.squid-cache.org/ConfigExamples/Intercept/LinuxDnat&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://wiki.squid-cache.org/&lt;wbr&gt;ConfigExamples/Intercept/&lt;wbr&gt;LinuxDnat&lt;/a&gt;&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;Now&nbsp;my&nbsp;sysctl.conf&nbsp;is:&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;net.ipv4.conf.all.rp_filter=0&lt;br&gt;<br>
&gt;&gt;&nbsp;net.ipv4.ip_forward&nbsp;=&nbsp;1&lt;br&gt;<br>
&gt;&gt;&nbsp;net.ipv4.conf.default.rp_&lt;wbr&gt;filter&nbsp;=&nbsp;0&lt;br&gt;<br>
&gt;&gt;&nbsp;net.ipv4.conf.default.accept_&lt;wbr&gt;source_route&nbsp;=&nbsp;0&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;My&nbsp;iptables&nbsp;-t&nbsp;nat&nbsp;-L&nbsp;result:&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;Chain&nbsp;PREROUTING&nbsp;(policy&nbsp;ACCEPT)&lt;br&gt;<br>
&gt;&gt;&nbsp;target &nbsp; &nbsp; prot&nbsp;opt&nbsp;source &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; destination&lt;br&gt;<br>
&gt;&gt;&nbsp;ACCEPT &nbsp; &nbsp; tcp &nbsp;-- &nbsp;&lt;a&nbsp;href=&quot;http://ec2-35-154-101-8.ap-south-1.compute.amazonaws.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;ec2-35-154-101-8.ap-south-1.&lt;wbr&gt;compute.amazonaws.com&lt;/a&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;anywhere &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tcp&nbsp;dpt:https&lt;br&gt;<br>
&gt;&gt;&nbsp;DNAT &nbsp; &nbsp; &nbsp; tcp &nbsp;-- &nbsp;anywhere &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; anywhere &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tcp&lt;br&gt;<br>
&gt;&gt;&nbsp;dpt:https&nbsp;to:&lt;a&nbsp;href=&quot;http://35.154.101.8:3129&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;35.154.101.8:3129&lt;/a&gt;&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;Chain&nbsp;INPUT&nbsp;(policy&nbsp;ACCEPT)&lt;br&gt;<br>
&gt;&gt;&nbsp;target &nbsp; &nbsp; prot&nbsp;opt&nbsp;source &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; destination&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;Chain&nbsp;OUTPUT&nbsp;(policy&nbsp;ACCEPT)&lt;br&gt;<br>
&gt;&gt;&nbsp;target &nbsp; &nbsp; prot&nbsp;opt&nbsp;source &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; destination&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;Chain&nbsp;POSTROUTING&nbsp;(policy&nbsp;ACCEPT)&lt;br&gt;<br>
&gt;&gt;&nbsp;target &nbsp; &nbsp; prot&nbsp;opt&nbsp;source &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; destination&lt;br&gt;<br>
&gt;&gt;&nbsp;MASQUERADE &nbsp;all &nbsp;-- &nbsp;anywhere &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; anywhere&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;Once&nbsp;this&nbsp;was&nbsp;done,&nbsp;I&nbsp;tried&nbsp;to&nbsp;hit&nbsp;HTTPS&nbsp;website&nbsp;from&nbsp;Firefox&nbsp;and&nbsp;now&lt;br&gt;<br>
&gt;&gt;&nbsp;I&nbsp;get&nbsp;connection&nbsp;timeout&nbsp;error.&nbsp;Nothing&nbsp;shows&nbsp;in&nbsp;syslog,&nbsp;access.log&nbsp;or&lt;br&gt;<br>
&gt;&gt;&nbsp;cache.log.&nbsp;Could&nbsp;you&nbsp;please&nbsp;help&nbsp;me&nbsp;resolve&nbsp;this.&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;Thanks,&lt;br&gt;<br>
&gt;&gt;&nbsp;Michael&lt;br&gt;<br>
&gt;&gt;&nbsp;______________________________&lt;wbr&gt;_________________&lt;br&gt;<br>
&gt;&gt;&nbsp;squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.&lt;wbr&gt;org&lt;/a&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/&lt;wbr&gt;listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Thanks&nbsp;for&nbsp;replying&nbsp;Eliezer.&nbsp;Following&nbsp;are&nbsp;the&nbsp;outputs&nbsp;you&nbsp;asked:&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;1.&nbsp;iptables-save:&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;#&nbsp;Generated&nbsp;by&nbsp;iptables-save&nbsp;v1.6.0&nbsp;on&nbsp;Sun&nbsp;Feb&nbsp;26&nbsp;06:28:46&nbsp;2017&lt;br&gt;<br>
&gt;&nbsp;*filter&lt;br&gt;<br>
&gt;&nbsp;:INPUT&nbsp;ACCEPT&nbsp;[171:12090]&lt;br&gt;<br>
&gt;&nbsp;:FORWARD&nbsp;ACCEPT&nbsp;[0:0]&lt;br&gt;<br>
&gt;&nbsp;:OUTPUT&nbsp;ACCEPT&nbsp;[106:15187]&lt;br&gt;<br>
&gt;&nbsp;COMMIT&lt;br&gt;<br>
&gt;&nbsp;#&nbsp;Completed&nbsp;on&nbsp;Sun&nbsp;Feb&nbsp;26&nbsp;06:28:46&nbsp;2017&lt;br&gt;<br>
&gt;&nbsp;#&nbsp;Generated&nbsp;by&nbsp;iptables-save&nbsp;v1.6.0&nbsp;on&nbsp;Sun&nbsp;Feb&nbsp;26&nbsp;06:28:46&nbsp;2017&lt;br&gt;<br>
&gt;&nbsp;*mangle&lt;br&gt;<br>
&gt;&nbsp;:PREROUTING&nbsp;ACCEPT&nbsp;[89003:74850371]&lt;br&gt;<br>
&gt;&nbsp;:INPUT&nbsp;ACCEPT&nbsp;[88973:74849159]&lt;br&gt;<br>
&gt;&nbsp;:FORWARD&nbsp;ACCEPT&nbsp;[30:1212]&lt;br&gt;<br>
&gt;&nbsp;:OUTPUT&nbsp;ACCEPT&nbsp;[76710:51478183]&lt;br&gt;<br>
&gt;&nbsp;:POSTROUTING&nbsp;ACCEPT&nbsp;[76740:51479395]&lt;br&gt;<br>
&gt;&nbsp;-A&nbsp;PREROUTING&nbsp;-p&nbsp;tcp&nbsp;-m&nbsp;tcp&nbsp;--dport&nbsp;3129&nbsp;-j&nbsp;DROP&lt;br&gt;<br>
&gt;&nbsp;COMMIT&lt;br&gt;<br>
&gt;&nbsp;#&nbsp;Completed&nbsp;on&nbsp;Sun&nbsp;Feb&nbsp;26&nbsp;06:28:46&nbsp;2017&lt;br&gt;<br>
&gt;&nbsp;#&nbsp;Generated&nbsp;by&nbsp;iptables-save&nbsp;v1.6.0&nbsp;on&nbsp;Sun&nbsp;Feb&nbsp;26&nbsp;06:28:46&nbsp;2017&lt;br&gt;<br>
&gt;&nbsp;*nat&lt;br&gt;<br>
&gt;&nbsp;:PREROUTING&nbsp;ACCEPT&nbsp;[7766:436942]&lt;br&gt;<br>
&gt;&nbsp;:INPUT&nbsp;ACCEPT&nbsp;[7766:436942]&lt;br&gt;<br>
&gt;&nbsp;:OUTPUT&nbsp;ACCEPT&nbsp;[952:102330]&lt;br&gt;<br>
&gt;&nbsp;:POSTROUTING&nbsp;ACCEPT&nbsp;[0:0]&lt;br&gt;<br>
&gt;&nbsp;-A&nbsp;PREROUTING&nbsp;-s&nbsp;&lt;a&nbsp;href=&quot;http://35.154.101.8/32&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;35.154.101.8/32&lt;/a&gt;&nbsp;-p&nbsp;tcp&nbsp;-m&nbsp;tcp&nbsp;--dport&nbsp;443&nbsp;-j&nbsp;ACCEPT&lt;br&gt;<br>
&gt;&nbsp;-A&nbsp;PREROUTING&nbsp;-p&nbsp;tcp&nbsp;-m&nbsp;tcp&nbsp;--dport&nbsp;443&nbsp;-j&nbsp;DNAT&nbsp;--to-destination&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;http://35.154.101.8:3129&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;35.154.101.8:3129&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;-A&nbsp;POSTROUTING&nbsp;-j&nbsp;MASQUERADE&lt;br&gt;<br>
&gt;&nbsp;COMMIT&lt;br&gt;<br>
&gt;&nbsp;#&nbsp;Completed&nbsp;on&nbsp;Sun&nbsp;Feb&nbsp;26&nbsp;06:28:46&nbsp;2017&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;2.&nbsp;Also&nbsp;pasting&nbsp;sudo&nbsp;iptables&nbsp;-L&nbsp;-nv:&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Chain&nbsp;INPUT&nbsp;(policy&nbsp;ACCEPT&nbsp;216&nbsp;packets,&nbsp;16058&nbsp;bytes)&lt;br&gt;<br>
&gt; &nbsp;pkts&nbsp;bytes&nbsp;target &nbsp; &nbsp; prot&nbsp;opt&nbsp;in &nbsp; &nbsp; out &nbsp; &nbsp; source&lt;br&gt;<br>
&gt;&nbsp;destination&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Chain&nbsp;FORWARD&nbsp;(policy&nbsp;ACCEPT&nbsp;0&nbsp;packets,&nbsp;0&nbsp;bytes)&lt;br&gt;<br>
&gt; &nbsp;pkts&nbsp;bytes&nbsp;target &nbsp; &nbsp; prot&nbsp;opt&nbsp;in &nbsp; &nbsp; out &nbsp; &nbsp; source&lt;br&gt;<br>
&gt;&nbsp;destination&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Chain&nbsp;OUTPUT&nbsp;(policy&nbsp;ACCEPT&nbsp;161&nbsp;packets,&nbsp;24629&nbsp;bytes)&lt;br&gt;<br>
&gt; &nbsp;pkts&nbsp;bytes&nbsp;target &nbsp; &nbsp; prot&nbsp;opt&nbsp;in &nbsp; &nbsp; out &nbsp; &nbsp; source &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; destination&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;And&nbsp;then&nbsp;clear&nbsp;out&nbsp;where&nbsp;is&nbsp;this&nbsp;proxy&nbsp;sittings&nbsp;and&nbsp;the&nbsp;network&nbsp;structure.&lt;br&gt;<br>
&gt;&gt;&nbsp;It&#39;s&nbsp;not&nbsp;clear&nbsp;if&nbsp;the&nbsp;squid&nbsp;box&nbsp;is&nbsp;the&nbsp;router&nbsp;or&nbsp;a&nbsp;machine&nbsp;somewhere&nbsp;on&nbsp;AWS.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;[Michael]&nbsp;This&nbsp;proxy&nbsp;is&nbsp;installed&nbsp;on&nbsp;an&nbsp;AWS&nbsp;instance.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;If&nbsp;you&nbsp;wish&nbsp;to&nbsp;pass&nbsp;traffic&nbsp;from&nbsp;a&nbsp;local&nbsp;router&nbsp;to&nbsp;a&nbsp;one&nbsp;on&nbsp;AWS&nbsp;you&nbsp;will&nbsp;need&nbsp;to&nbsp;create&nbsp;a&nbsp;tunnel&nbsp;like&nbsp;using&nbsp;OpenVPN&nbsp;or&nbsp;a&nbsp;similar&nbsp;solution&nbsp;and&nbsp;to&nbsp;use&nbsp;some&nbsp;routing&nbsp;rules&nbsp;to&nbsp;pass&nbsp;the&nbsp;traffic&nbsp;from&nbsp;the&nbsp;local&nbsp;LAN&nbsp;to&nbsp;AWS&nbsp;without&nbsp;removing&nbsp;the&nbsp;original&nbsp;destination&nbsp;address.&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;[Michael]&nbsp;Does&nbsp;this&nbsp;mean,&nbsp;to&nbsp;make&nbsp;ssl-bump&nbsp;work,&nbsp;I&nbsp;will&nbsp;have&nbsp;to&nbsp;setup&lt;br&gt;<br>
&gt;&nbsp;a&nbsp;VPN&nbsp;server&nbsp;and&nbsp;configure&nbsp;the&nbsp;VPN&nbsp;clients&nbsp;to&nbsp;use&nbsp;this&nbsp;proxy&nbsp;via&nbsp;VPN&lt;br&gt;<br>
&gt;&nbsp;server?&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Thanks,&lt;br&gt;<br>
&gt;&nbsp;Michael.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;______________________________&lt;wbr&gt;_________________&lt;br&gt;<br>
&gt;&nbsp;squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.&lt;wbr&gt;org&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/&lt;wbr&gt;listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;Thanks&nbsp;for&nbsp;replying&nbsp;Eliezer.&nbsp;Your&nbsp;advice&nbsp;is&nbsp;much&nbsp;appreciated.&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;&quot;&gt;&lt;br&gt;<br>
&gt;&nbsp;The&nbsp;details&nbsp;you&nbsp;attached&nbsp;explained&nbsp;pretty&nbsp;well&nbsp;the&nbsp;cause&nbsp;for&nbsp;the&nbsp;issues&nbsp;you&nbsp;have&nbsp;described.&lt;br&gt;<br>
&gt;&nbsp;What&nbsp;you&nbsp;will&nbsp;need&nbsp;to&nbsp;do&nbsp;in&nbsp;order&nbsp;to&nbsp;make&nbsp;this&nbsp;setup&nbsp;to&nbsp;work&nbsp;can&nbsp;be&nbsp;done&nbsp;in&nbsp;more&nbsp;then&nbsp;one&nbsp;way.&lt;br&gt;<br>
&gt;&nbsp;For&nbsp;a&nbsp;sysadmin&nbsp;the&nbsp;simplest&nbsp;way&nbsp;is&nbsp;to&nbsp;create&nbsp;a&nbsp;VPN&nbsp;or&nbsp;some&nbsp;kind&nbsp;of&nbsp;a&nbsp;tunnel&nbsp;between&nbsp;the&nbsp;AWS&nbsp;instance&nbsp;to&nbsp;the&nbsp;local&nbsp;router.&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;am&nbsp;almost&nbsp;sure&nbsp;that&nbsp;you&nbsp;can&nbsp;use&nbsp;haproxy&nbsp;to&nbsp;do&nbsp;a&nbsp;local&nbsp;tproxy&nbsp;or&nbsp;interception&nbsp;that&nbsp;will&nbsp;forward&nbsp;the&nbsp;traffic&nbsp;to&nbsp;the&nbsp;remote&nbsp;squid&nbsp;with&nbsp;the&nbsp;PROXY&nbsp;protocol&nbsp;keeping&nbsp;original&nbsp;source&nbsp;and&nbsp;original&nbsp;destination&nbsp;visible&nbsp;to&nbsp;the&nbsp;remote&nbsp;squid.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;The&nbsp;choice&nbsp;will&nbsp;depend&nbsp;on&nbsp;both:&lt;br&gt;<br>
&gt;&nbsp;-&nbsp;your&nbsp;skills&nbsp;and&nbsp;will&nbsp;to&nbsp;dig&nbsp;some&nbsp;time&nbsp;about&nbsp;couple&nbsp;subjects&lt;br&gt;<br>
&gt;&nbsp;-&nbsp;The&nbsp;availability&nbsp;of&nbsp;static&nbsp;IP&nbsp;addresses(both&nbsp;local&nbsp;and&nbsp;AWS).&lt;br&gt;<br>
&gt;&nbsp;-&nbsp;The&nbsp;OS&nbsp;on&nbsp;both&nbsp;sides&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;[Michael]&nbsp;Actually,&nbsp;my&nbsp;original&nbsp;setup&nbsp;involves&nbsp;a&nbsp;VPN&nbsp;server.&nbsp;I&nbsp;wasn&#39;t&lt;br&gt;<br>
using&nbsp;it&nbsp;because&nbsp;I&nbsp;wanted&nbsp;to&nbsp;setup&nbsp;ssl-bump&nbsp;with&nbsp;simplest&nbsp;possible&lt;br&gt;<br>
settings.&nbsp;My&nbsp;actual&nbsp;setup&nbsp;involves:&lt;br&gt;<br>
&lt;br&gt;<br>
1.&nbsp;strongSwan&nbsp;IPSec&nbsp;VPN&nbsp;server&lt;br&gt;<br>
2.&nbsp;Squid&nbsp;Proxy&nbsp;server&lt;br&gt;<br>
3.&nbsp;Clients&nbsp;will&nbsp;be&nbsp;IPSec&nbsp;VPN&nbsp;clients.&nbsp;I&nbsp;can&nbsp;specify&nbsp;the&nbsp;IP&nbsp;address&nbsp;and&lt;br&gt;<br>
port&nbsp;of&nbsp;HTTPS&nbsp;Proxy&nbsp;server&nbsp;in&nbsp;IPSec&nbsp;VPN&nbsp;client&nbsp;itself.&lt;br&gt;<br>
&lt;br&gt;<br>
In&nbsp;the&nbsp;above&nbsp;setup&nbsp;described,&nbsp;will&nbsp;I&nbsp;have&nbsp;to&nbsp;do&nbsp;something&nbsp;extra&nbsp;to&lt;br&gt;<br>
make&nbsp;ssl-bump&nbsp;work?&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;br&gt;<br>
Thanks,&lt;br&gt;<br>
Michael.&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;/div&gt;What&nbsp;is&nbsp;the&nbsp;benefit&nbsp;of&nbsp;ssl-bump&nbsp;in&nbsp;this&nbsp;scenario?&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;--&nbsp;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_signature&quot;&nbsp;data-smartmail=&quot;gmail_signature&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;Best&nbsp;regards,&lt;br&gt;Odhiambo&nbsp;WASHINGTON,&lt;br&gt;Nairobi,KE&lt;br&gt;+254&nbsp;7&nbsp;3200&nbsp;0004/+254&nbsp;7&nbsp;2274&nbsp;3223&lt;br&gt;&quot;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;Oh,&nbsp;the&nbsp;cruft.&lt;/span&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;&quot;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/div&gt;&lt;/div&gt;<br>

</tt>
