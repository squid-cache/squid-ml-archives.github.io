<tt>
<br>
&lt;HTML&gt;&lt;BODY&gt;Hello.&nbsp;I&nbsp;have&nbsp;the&nbsp;squid&nbsp;3.5.24&nbsp;from&nbsp;source:&lt;br&gt;configure&nbsp;options:&nbsp;&nbsp;'--build=x86_64-linux-gnu'&nbsp;'--prefix=/usr'&nbsp;'--includedir=/include'&nbsp;'--mandir=/share/man'&nbsp;'--infodir=/share/info'&nbsp;'--sysconfdir=/etc'&nbsp;'--localstatedir=/var'&nbsp;'--libexecdir=/lib/squid'&nbsp;'--srcdir=.'&nbsp;'--disable-maintainer-mode'&nbsp;'--disable-dependency-tracking'&nbsp;'--disable-silent-rules'&nbsp;'--datadir=/usr/share/squid'&nbsp;'--sysconfdir=/etc/squid'&nbsp;'--mandir=/usr/share/man'&nbsp;'--enable-inline'&nbsp;'--disable-arch-native'&nbsp;'--enable-async-io=8'&nbsp;'--enable-storeio=ufs,aufs,diskd,rock'&nbsp;'--enable-removal-policies=lru,heap'&nbsp;'--enable-delay-pools'&nbsp;'--enable-cache-digests'&nbsp;'--enable-icap-client'&nbsp;'--enable-follow-x-forwarded-for'&nbsp;'--enable-auth-basic=DB,fake,getpwnam,LDAP,NCSA,NIS,PAM,POP3,RADIUS,SASL,SMB'&nbsp;'--enable-auth-digest=file,LDAP'&nbsp;'--enable-auth-negotiate=kerberos,wrapper'&nbsp;'--enable-auth-ntlm=fake,smb_lm'&nbsp;'--enable-external-acl-helpers=file_userip,kerberos_ldap_group,LDAP_group,session,SQL_session,unix_group,wbinfo_group'&nbsp;'--enable-url-rewrite-helpers=fake'&nbsp;'--enable-eui'&nbsp;'--enable-esi'&nbsp;'--enable-icmp'&nbsp;'--enable-zph-qos'&nbsp;'--enable-ecap'&nbsp;'--disable-translation'&nbsp;'--with-swapdir=/var/spool/squid'&nbsp;'--with-logdir=/var/log/squid'&nbsp;'--with-pidfile=/var/run/squid.pid'&nbsp;'--with-filedescriptors=65536'&nbsp;'--with-large-files'&nbsp;'--with-default-user=proxy'&nbsp;'--enable-ssl'&nbsp;'--enable-ssl-crtd'&nbsp;'--with-openssl'&nbsp;'--enable-linux-netfilter'&nbsp;'CFLAGS=-g&nbsp;-O2&nbsp;-fPIE&nbsp;-fstack-protector-strong&nbsp;-Wformat&nbsp;-Werror=format-security&nbsp;-Wall'&nbsp;'LDFLAGS=-fPIE&nbsp;-pie&nbsp;-Wl,-z,relro&nbsp;-Wl,-z,now'&nbsp;'CPPFLAGS=-D_FORTIFY_SOURCE=2'&nbsp;'CXXFLAGS=-g&nbsp;-O2&nbsp;-fPIE&nbsp;-fstack-protector-strong&nbsp;-Wformat&nbsp;-Werror=format-security'&nbsp;'build_alias=x86_64-linux-gnu'&lt;br&gt;&lt;br&gt;&lt;p&gt;I&nbsp;also&nbsp;have&nbsp;this&nbsp;configuration:&lt;/p&gt;&lt;p&gt;max_filedesc&nbsp;35000&lt;br&gt;acl&nbsp;localnet&nbsp;src&nbsp;172.16.16.0/24&lt;br&gt;acl&nbsp;localnet&nbsp;src&nbsp;172.22.1.0/24&lt;br&gt;acl&nbsp;SSL_ports&nbsp;port&nbsp;443&lt;br&gt;acl&nbsp;CONNECT&nbsp;method&nbsp;CONNECT&lt;br&gt;acl&nbsp;AdminsIP&nbsp;src&nbsp;&quot;/etc/squid/admips.txt&quot;&lt;br&gt;acl&nbsp;BlackList&nbsp;dstdomain&nbsp;&quot;/etc/squid/BL.txt&quot;&lt;br&gt;acl&nbsp;BlockInetExlWhite&nbsp;src&nbsp;&quot;/etc/squid/BI.txt&quot;&lt;br&gt;acl&nbsp;WhiteList&nbsp;dstdomain&nbsp;&quot;/etc/squid/WL.txt&quot;&lt;br&gt;acl&nbsp;manager&nbsp;proto&nbsp;manager&lt;br&gt;via&nbsp;off&lt;br&gt;forwarded_for&nbsp;off&lt;br&gt;follow_x_forwarded_for&nbsp;deny&nbsp;all&lt;br&gt;visible_hostname&nbsp;my.server.com&lt;br&gt;hosts_file&nbsp;/etc/hosts&lt;br&gt;dns_nameservers&nbsp;172.16.16.11&lt;br&gt;ipcache_size&nbsp;10240&lt;br&gt;negative_dns_ttl&nbsp;5&nbsp;minutes&lt;br&gt;fqdncache_size&nbsp;10240&lt;br&gt;http_access&nbsp;deny&nbsp;!Safe_ports&lt;br&gt;http_access&nbsp;deny&nbsp;CONNECT&nbsp;!SSL_ports&lt;br&gt;http_access&nbsp;allow&nbsp;manager&lt;br&gt;http_access&nbsp;deny&nbsp;manager&lt;br&gt;cachemgr_passwd&nbsp;password&nbsp;all&lt;br&gt;http_access&nbsp;allow&nbsp;localhost&lt;br&gt;http_access&nbsp;allow&nbsp;AdminsIP&lt;br&gt;http_access&nbsp;deny&nbsp;BlockInetExlWhite&nbsp;!WhiteList&lt;br&gt;http_access&nbsp;deny&nbsp;BlackList&lt;br&gt;http_access&nbsp;allow&nbsp;localnet&lt;br&gt;http_access&nbsp;deny&nbsp;all&lt;br&gt;cache&nbsp;deny&nbsp;all&lt;br&gt;http_port&nbsp;0.0.0.0:3128&nbsp;intercept&lt;br&gt;http_port&nbsp;0.0.0.0:3130&lt;br&gt;https_port&nbsp;0.0.0.0:3129&nbsp;intercept&nbsp;ssl-bump&nbsp;generate-host-certificates=on&nbsp;dynamic_cert_mem_cache_size=4MB&nbsp;cert=/etc/squid/ssl/myCA.pem&lt;br&gt;always_direct&nbsp;allow&nbsp;all&lt;br&gt;sslproxy_cert_error&nbsp;allow&nbsp;all&lt;br&gt;sslproxy_flags&nbsp;DONT_VERIFY_PEER&lt;br&gt;acl&nbsp;blocked&nbsp;ssl::server_name&nbsp;&quot;/etc/squid/BL.txt&quot;&lt;br&gt;acl&nbsp;step1&nbsp;at_step&nbsp;SslBump1&lt;br&gt;ssl_bump&nbsp;peek&nbsp;step1&lt;br&gt;ssl_bump&nbsp;terminate&nbsp;blocked&lt;br&gt;ssl_bump&nbsp;splice&nbsp;all&lt;br&gt;sslcrtd_program&nbsp;/lib/squid/ssl_crtd&nbsp;-s&nbsp;/var/lib/ssl_db&nbsp;-M&nbsp;4MB&lt;br&gt;coredump_dir&nbsp;/var/spool/squid&lt;br&gt;refresh_pattern&nbsp;^ftp:&nbsp;1440&nbsp;20%&nbsp;10080&lt;br&gt;refresh_pattern&nbsp;^gopher:&nbsp;1440&nbsp;0%&nbsp;1440&lt;br&gt;refresh_pattern&nbsp;-i&nbsp;(/cgi-bin/|\?)&nbsp;0&nbsp;0%&nbsp;0&lt;br&gt;refresh_pattern&nbsp;.&nbsp;0&nbsp;20%&nbsp;4320&lt;br&gt;maximum_object_size&nbsp;61440&nbsp;KB&lt;br&gt;minimum_object_size&nbsp;3&nbsp;KB&lt;br&gt;cache_swap_low&nbsp;90&lt;br&gt;cache_swap_high&nbsp;95&lt;br&gt;maximum_object_size_in_memory&nbsp;512&nbsp;KB&lt;br&gt;memory_replacement_policy&nbsp;lru&lt;br&gt;logfile_rotate&nbsp;0&lt;br&gt;cache_mgr&nbsp;&lt;a&nbsp;href=&quot;mailto:admin@my.server.com&quot;&nbsp;data-mce-href=&quot;mailto:admin@my.server.com&quot;&gt;admin@my.server.com&lt;/a&gt;&nbsp;&lt;br&gt;&lt;br&gt;All&nbsp;users&nbsp;in&nbsp;my&nbsp;company&nbsp;have&nbsp;enabled&nbsp;auto-proxy-config&nbsp;in&nbsp;OS&nbsp;with&nbsp;wpad&nbsp;url&nbsp;configuration,&nbsp;below&nbsp;you&nbsp;can&nbsp;see&nbsp;wpad.dat:&lt;br&gt;&lt;/p&gt;&lt;p&gt;function&nbsp;FindProxyForURL(url,&nbsp;host)&nbsp;{&lt;br&gt;&nbsp;var&nbsp;proxy_on&nbsp;=&nbsp;&quot;PROXY&nbsp;172.16.16.30:3130&quot;;&lt;br&gt;&nbsp;var&nbsp;proxy_off&nbsp;=&nbsp;&quot;DIRECT&quot;;&lt;br&gt;&nbsp;var&nbsp;network&nbsp;=&nbsp;&quot;172.16.16.0&quot;;&lt;br&gt;&nbsp;var&nbsp;network1&nbsp;=&nbsp;&quot;192.168.100.0&quot;;&lt;br&gt;&nbsp;var&nbsp;subnet&nbsp;=&nbsp;&quot;255.255.255.0&quot;;&lt;br&gt;&nbsp;&lt;br&gt;&nbsp;var&nbsp;proxy_bypass&nbsp;=&nbsp;new&nbsp;Array(&lt;br&gt;&nbsp;&quot;*.slack.com&quot;,&lt;br&gt;&nbsp;&quot;*.slack-edge.com&quot;,&lt;br&gt;&nbsp;&quot;*.slack-msgs.com&quot;,&lt;br&gt;&nbsp;&quot;*slack-files.com&quot;,&lt;br&gt;&nbsp;&quot;*slack-imgs.com&quot;,&lt;br&gt;&nbsp;&quot;*slack-edge.com&quot;,&lt;br&gt;&nbsp;&quot;*slack-core.com&quot;,&lt;br&gt;&nbsp;&quot;*slack-redir.net&quot;,&lt;br&gt;&nbsp;&quot;192.168.100.0&quot;,&lt;br&gt;&nbsp;&quot;127.0.0.1&quot;,&lt;br&gt;&nbsp;&quot;localhost&quot;&lt;br&gt;&nbsp;);&lt;/p&gt;&lt;p&gt;if&nbsp;(isInNet(host,&nbsp;network,&nbsp;subnet))&nbsp;{&lt;br&gt;&nbsp;return&nbsp;proxy_off;&lt;br&gt;&nbsp;}&lt;br&gt;&nbsp;if&nbsp;(isInNet(host,&nbsp;network1,&nbsp;subnet))&nbsp;{&lt;br&gt;&nbsp;return&nbsp;proxy_off;&lt;br&gt;&nbsp;}&lt;br&gt;&nbsp;&lt;br&gt;&nbsp;for&nbsp;(var&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;proxy_bypass.length;&nbsp;i++)&nbsp;{&lt;br&gt;&nbsp;if&nbsp;(shExpMatch(host,&nbsp;proxy_bypass[i]))&nbsp;{&lt;br&gt;&nbsp;return&nbsp;DIRECT;&lt;br&gt;&nbsp;}&lt;br&gt;&nbsp;}&lt;br&gt;&nbsp;&lt;br&gt;&nbsp;if&nbsp;(shExpMatch(url,&nbsp;&quot;http:*&quot;)&nbsp;||&lt;br&gt;&nbsp;shExpMatch(url,&nbsp;&quot;https:*&quot;)&nbsp;||&lt;br&gt;&nbsp;shExpMatch(url,&nbsp;&quot;ftp:*&quot;))&nbsp;{&lt;br&gt;&nbsp;return&nbsp;proxy_on;&lt;br&gt;&nbsp;}&lt;br&gt;&nbsp;&lt;br&gt;&nbsp;//&nbsp;Finally,&nbsp;send&nbsp;all&nbsp;other&nbsp;requests&nbsp;direct.&lt;br&gt;&nbsp;return&nbsp;proxy_off;&lt;br&gt;}&lt;br&gt;&lt;br&gt;In&nbsp;the&nbsp;wpad&nbsp;web&nbsp;server&nbsp;I&nbsp;can&nbsp;see&nbsp;logs:&lt;/p&gt;&lt;p&gt;188.xxx.xxx.xxx&nbsp;-&nbsp;-&nbsp;[06/Mar/2017:11:20:21&nbsp;+0300]&nbsp;&quot;GET&nbsp;/wpad.dat&nbsp;HTTP/1.1&quot;&nbsp;200&nbsp;1324&nbsp;&quot;-&quot;&nbsp;&quot;Mozilla/5.0&nbsp;(X11;&nbsp;Linux&nbsp;x86_64)&nbsp;AppleWebKit/537.36&nbsp;(KHTML,&nbsp;like&nbsp;Gecko)&nbsp;Slack/2.5.1&nbsp;Chrome/53.0.2785.143&nbsp;Electron/1.4.15&nbsp;Safari/537.36&quot;&lt;br&gt;188.xxx.xxx.xxx&nbsp;-&nbsp;-&nbsp;[06/Mar/2017:11:57:29&nbsp;+0300]&nbsp;&quot;GET&nbsp;/wpad.dat&nbsp;HTTP/1.1&quot;&nbsp;200&nbsp;1324&nbsp;&quot;-&quot;&nbsp;&quot;Mozilla/5.0&nbsp;(X11;&nbsp;Linux&nbsp;x86_64)&nbsp;AppleWebKit/537.36&nbsp;(KHTML,&nbsp;like&nbsp;Gecko)&nbsp;Chrome/56.0.2924.87&nbsp;Safari/537.36&quot;&lt;br&gt;188.xxx.xxx.xxx&nbsp;-&nbsp;-&nbsp;[06/Mar/2017:11:57:29&nbsp;+0300]&nbsp;&quot;GET&nbsp;/wpad.dat&nbsp;HTTP/1.1&quot;&nbsp;200&nbsp;1324&nbsp;&quot;-&quot;&nbsp;&quot;Mozilla/5.0&nbsp;(X11;&nbsp;Linux&nbsp;x86_64)&nbsp;AppleWebKit/537.36&nbsp;(KHTML,&nbsp;like&nbsp;Gecko)&nbsp;Chrome/56.0.2924.87&nbsp;Safari/537.36&quot;&lt;br&gt;188.xxx.xxx.xxx&nbsp;-&nbsp;-&nbsp;[06/Mar/2017:11:57:29&nbsp;+0300]&nbsp;&quot;GET&nbsp;/wpad.dat&nbsp;HTTP/1.1&quot;&nbsp;200&nbsp;1324&nbsp;&quot;-&quot;&nbsp;&quot;Mozilla/5.0&nbsp;(X11;&nbsp;Linux&nbsp;x86_64)&nbsp;AppleWebKit/537.36&nbsp;(KHTML,&nbsp;like&nbsp;Gecko)&nbsp;Slack/2.5.1&nbsp;Chrome/53.0.2785.143&nbsp;Electron/1.4.15&nbsp;Safari/537.36&quot;&lt;br&gt;188.xxx.xxx.xxx&nbsp;-&nbsp;-&nbsp;[06/Mar/2017:13:13:01&nbsp;+0300]&nbsp;&quot;GET&nbsp;/wpad.dat&nbsp;HTTP/1.1&quot;&nbsp;200&nbsp;1324&nbsp;&quot;-&quot;&nbsp;&quot;Mozilla/5.0&nbsp;(Windows&nbsp;NT&nbsp;6.1;&nbsp;WOW64)&nbsp;AppleWebKit/537.36&nbsp;(KHTML,&nbsp;like&nbsp;Gecko)&nbsp;Chrome/56.0.2924.87&nbsp;Safari/537.36&quot;&lt;/p&gt;I&nbsp;see&nbsp;the&nbsp;problems&nbsp;when&nbsp;to&nbsp;try&nbsp;work&nbsp;with&nbsp;slack&nbsp;app&nbsp;or&nbsp;gmail&nbsp;apps&nbsp;(e.g.&nbsp;calendar),&nbsp;in&nbsp;the&nbsp;squid&nbsp;log&nbsp;I&nbsp;see&nbsp;many&nbsp;entries:&lt;br&gt;&lt;p&gt;2017/03/06&nbsp;14:38:03|&nbsp;SECURITY&nbsp;ALERT:&nbsp;Host&nbsp;header&nbsp;forgery&nbsp;detected&nbsp;on&nbsp;local=54.230.99.128:443&nbsp;remote=172.16.16.123:64857&nbsp;FD&nbsp;748&nbsp;flags=33&nbsp;(local&nbsp;IP&nbsp;does&nbsp;not&nbsp;match&nbsp;any&nbsp;domain&nbsp;IP)&lt;br&gt;2017/03/06&nbsp;14:38:03|&nbsp;SECURITY&nbsp;ALERT:&nbsp;on&nbsp;URL:&nbsp;slack.com:443&lt;br&gt;2017/03/06&nbsp;14:38:30|&nbsp;SECURITY&nbsp;ALERT:&nbsp;Host&nbsp;header&nbsp;forgery&nbsp;detected&nbsp;on&nbsp;local=54.230.99.128:443&nbsp;remote=172.16.16.123:64875&nbsp;FD&nbsp;505&nbsp;flags=33&nbsp;(local&nbsp;IP&nbsp;does&nbsp;not&nbsp;match&nbsp;any&nbsp;domain&nbsp;IP)&lt;br&gt;2017/03/06&nbsp;14:38:30|&nbsp;SECURITY&nbsp;ALERT:&nbsp;on&nbsp;URL:&nbsp;slack.com:443&lt;br&gt;2017/03/06&nbsp;14:38:37|&nbsp;SECURITY&nbsp;ALERT:&nbsp;Host&nbsp;header&nbsp;forgery&nbsp;detected&nbsp;on&nbsp;local=54.230.99.128:443&nbsp;remote=172.16.16.123:64881&nbsp;FD&nbsp;678&nbsp;flags=33&nbsp;(local&nbsp;IP&nbsp;does&nbsp;not&nbsp;match&nbsp;any&nbsp;domain&nbsp;IP)&lt;br&gt;Could&nbsp;you&nbsp;help&nbsp;me&nbsp;please?&lt;br&gt;P.S.&nbsp;Sorry&nbsp;for&nbsp;my&nbsp;bad&nbsp;english.&lt;/p&gt;&lt;br&gt;&lt;/BODY&gt;&lt;/HTML&gt;<br>

</tt>
