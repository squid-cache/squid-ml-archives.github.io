<tt>
&lt;html&gt;<br>
&lt;head&gt;<br>
&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;text=&quot;#000000&quot;&nbsp;bgcolor=&quot;#FFFFFF&quot;&gt;<br>
&gt;&gt;&nbsp;Hi,&nbsp;everybody!&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;I&nbsp;have&nbsp;my&nbsp;Squid&nbsp;3.4.8&nbsp;running&nbsp;in&nbsp;Debian&nbsp;Jessie.&nbsp;It&nbsp;has&nbsp;been&nbsp;working&nbsp;with&nbsp;Active&nbsp;Directory&nbsp;authentication&nbsp;for&nbsp;more&nbsp;than&nbsp;a&nbsp;year&nbsp;without&nbsp;any&nbsp;kind&nbsp;of&nbsp;problem.&nbsp;But&nbsp;since&nbsp;a&nbsp;couple&nbsp;of&nbsp;weeks&nbsp;ago,&nbsp;suddenly,&nbsp;it&nbsp;stopped&nbsp;authenticate&nbsp;users,&nbsp;asking&nbsp;for&nbsp;credentials&nbsp;(username<br>
&nbsp;and&nbsp;pass)&nbsp;and&nbsp;they&nbsp;are&nbsp;not&nbsp;able&nbsp;to&nbsp;browse.&nbsp;I&nbsp;am&nbsp;getting&nbsp;this&nbsp;messages&nbsp;in&nbsp;/var/log/cache.log:&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/03/04&nbsp;12:04:25.806&nbsp;kid1|&nbsp;WARNING:&nbsp;external&nbsp;ACL&nbsp;'Grupos_AD'&nbsp;queue&nbsp;overload.&nbsp;Request&nbsp;rejected&nbsp;'user1&nbsp;it_group'.&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;This&nbsp;means&nbsp;that&nbsp;your&nbsp;AD&nbsp;is&nbsp;not&nbsp;keeping&nbsp;up&nbsp;with&nbsp;the&nbsp;traffic&nbsp;through&nbsp;your&lt;br&gt;<br>
&gt;proxy.&lt;br&gt;<br>
&gt;Since&nbsp;your&nbsp;Squid&nbsp;has&nbsp;children=100&nbsp;it&nbsp;will&nbsp;queue&nbsp;up&nbsp;to&nbsp;200&nbsp;transactions&lt;br&gt;<br>
&gt;waiting&nbsp;for&nbsp;the&nbsp;helper&nbsp;before&nbsp;this&nbsp;message&nbsp;is&nbsp;shown.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;Dis&nbsp;cache.log&nbsp;have&nbsp;anything&nbsp;else&nbsp;from&nbsp;the&nbsp;external&nbsp;helper?&nbsp;you&nbsp;have&lt;br&gt;<br>
&gt;debug&nbsp;mode&nbsp;enabled&nbsp;(-d)&nbsp;so&nbsp;it&nbsp;should&nbsp;be&nbsp;reporting&nbsp;if&nbsp;there&nbsp;are&nbsp;any&lt;br&gt;<br>
&gt;issues&nbsp;with&nbsp;AD&nbsp;other&nbsp;than&nbsp;simply&nbsp;slowness.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
Yes.&nbsp;I&nbsp;found&nbsp;this:&lt;br&gt;<br>
14:53:48&nbsp;[root@server&nbsp;squid3]#&nbsp;tail&nbsp;-f&nbsp;/var/log/squid3/cache.log&nbsp;|&nbsp;grep&nbsp;helper&lt;br&gt;<br>
2017/03/16&nbsp;14:54:19.527&nbsp;kid1|&nbsp;Acl.cc(62)&nbsp;AuthenticateAcl:&nbsp;returning&nbsp;2&nbsp;sending&nbsp;credentials&nbsp;to&nbsp;helper.&lt;br&gt;<br>
2017/03/16&nbsp;14:54:19.532&nbsp;kid1|&nbsp;Acl.cc(62)&nbsp;AuthenticateAcl:&nbsp;returning&nbsp;2&nbsp;sending&nbsp;credentials&nbsp;to&nbsp;helper.&lt;br&gt;<br>
2017/03/16&nbsp;14:54:20.743&nbsp;kid1|&nbsp;Acl.cc(62)&nbsp;AuthenticateAcl:&nbsp;returning&nbsp;2&nbsp;sending&nbsp;credentials&nbsp;to&nbsp;helper.&lt;br&gt;<br>
&lt;br&gt;<br>
And&nbsp;this:&lt;br&gt;<br>
2017/03/16&nbsp;14:53:47.887&nbsp;kid1|&nbsp;Acl.cc(118)&nbsp;FindByName:&nbsp;ACL::FindByName&nbsp;'it_group'&lt;br&gt;<br>
2017/03/16&nbsp;14:53:47.887&nbsp;kid1|&nbsp;Gadgets.cc(71)&nbsp;aclGetDenyInfoPage:&nbsp;got&nbsp;called&nbsp;for&nbsp;it_group&lt;br&gt;<br>
2017/03/16&nbsp;14:53:48.028&nbsp;kid1|&nbsp;Acl.cc(157)&nbsp;matches:&nbsp;checking&nbsp;it_group&lt;br&gt;<br>
2017/03/16&nbsp;14:53:48.028&nbsp;kid1|&nbsp;Acl.cc(177)&nbsp;matches:&nbsp;checked:&nbsp;it_group&nbsp;=&nbsp;-1&lt;br&gt;<br>
2017/03/16&nbsp;14:53:48.028&nbsp;kid1|&nbsp;Gadgets.cc(103)&nbsp;aclIsProxyAuth:&nbsp;aclIsProxyAuth:&nbsp;called&nbsp;for&nbsp;it_group&lt;br&gt;<br>
2017/03/16&nbsp;14:53:48.028&nbsp;kid1|&nbsp;Acl.cc(118)&nbsp;FindByName:&nbsp;ACL::FindByName&nbsp;'it_group'&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;After&nbsp;some&nbsp;research&nbsp;I&nbsp;found&nbsp;this&nbsp;thread&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://www.squid-cache.org/mail-archive/squid-users/200902/0386.html&quot;&gt;<br>
http://www.squid-cache.org/mail-archive/squid-users/200902/0386.html&lt;/a&gt;&nbsp;and&nbsp;followed&nbsp;the&nbsp;suggestions&nbsp;posted&nbsp;by&nbsp;Amos.&nbsp;But&nbsp;nothing&nbsp;happened.&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;I&nbsp;tried&nbsp;rejoining&nbsp;the&nbsp;server&nbsp;to&nbsp;domain.&nbsp;Everything&nbsp;was&nbsp;fine&nbsp;in&nbsp;that&nbsp;way:&nbsp;wbinfo&nbsp;-u,&nbsp;wbinfo&nbsp;-g&nbsp;and&nbsp;wbinfo&nbsp;-P&nbsp;correctly&nbsp;returns&nbsp;all&nbsp;the&nbsp;users,&nbsp;groups&nbsp;and&nbsp;information&nbsp;of&nbsp;the&nbsp;domain.&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;After&nbsp;restart&nbsp;Squid&nbsp;service,&nbsp;I&nbsp;noticed&nbsp;that&nbsp;neither&nbsp;helper&nbsp;ext_wbinfo_group_acl&nbsp;nor&nbsp;pinger&nbsp;are&nbsp;started:&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;12:04:01&nbsp;[root&nbsp;at&nbsp;server&nbsp;]#&nbsp;systemctl&nbsp;status&nbsp;squid3.service&nbsp;-l&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;NOTE:&nbsp;do&nbsp;not&nbsp;trust&nbsp;systemd&nbsp;information&nbsp;about&nbsp;Squid-3.&nbsp;The&nbsp;two&nbsp;are&nbsp;not&lt;br&gt;<br>
&gt;compatible&nbsp;and&nbsp;systemd&nbsp;often&nbsp;says&nbsp;incorrect&nbsp;things&nbsp;because&nbsp;it&nbsp;makes&lt;br&gt;<br>
&gt;incorrect&nbsp;assumptions&nbsp;about&nbsp;the&nbsp;squid&nbsp;process(es).&nbsp;Especially&nbsp;if&nbsp;there&lt;br&gt;<br>
&gt;has&nbsp;been&nbsp;a&nbsp;process&nbsp;crash&nbsp;and&nbsp;auto-restart&nbsp;at&nbsp;any&nbsp;point&nbsp;during&nbsp;Squid&lt;br&gt;<br>
&gt;operation.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;●&nbsp;squid3.service&nbsp;-&nbsp;LSB:&nbsp;Squid&nbsp;HTTP&nbsp;Proxy&nbsp;version&nbsp;3.x&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;Loaded:&nbsp;loaded&nbsp;(/etc/init.d/squid3)&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;Active:&nbsp;active&nbsp;(running)&nbsp;since&nbsp;sáb&nbsp;2017-03-04&nbsp;12:04:01&nbsp;ART;&nbsp;3s&nbsp;ago&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;Process:&nbsp;4537&nbsp;ExecStop=/etc/init.d/squid3&nbsp;stop&nbsp;(code=exited,&nbsp;status=0/SUCCESS)&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;Process:&nbsp;4560&nbsp;ExecStart=/etc/init.d/squid3&nbsp;start&nbsp;(code=exited,&nbsp;status=0/SUCCESS)&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;CGroup:&nbsp;/system.slice/squid3.service&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;├─4593&nbsp;/usr/sbin/squid3&nbsp;-YC&nbsp;-f&nbsp;/etc/squid3/squid.conf&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;├─4595&nbsp;(squid-1)&nbsp;-YC&nbsp;-f&nbsp;/etc/squid3/squid.conf&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;└─4596&nbsp;(ntlm_auth)&nbsp;--helper-protocol=squid-2.5-ntlmssp&nbsp;--DOMAIN=MYDOMAIN&lt;br&gt;<br>
&gt;&gt;&nbsp;mar&nbsp;04&nbsp;12:04:01&nbsp;server.mydomain.com&nbsp;squid3[4560]:&nbsp;Starting&nbsp;Squid&nbsp;HTTP&nbsp;Proxy&nbsp;3.x:&nbsp;squid3&lt;br&gt;<br>
&gt;&gt;&nbsp;2017/03/04&nbsp;12:04:01|&nbsp;WARNING:&nbsp;external_acl_type&nbsp;option&nbsp;children=N&nbsp;has&nbsp;been&nbsp;deprecated&nbsp;in&nbsp;favor&nbsp;of&nbsp;children-max=N&nbsp;and&nbsp;children-startup=N&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;Please&nbsp;note&nbsp;the&nbsp;warning&nbsp;and&nbsp;update&nbsp;your&nbsp;config&nbsp;file.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;mar&nbsp;04&nbsp;12:04:01&nbsp;server.mydomain.com&nbsp;squid3[4593]:&nbsp;Squid&nbsp;Parent:&nbsp;will&nbsp;start&nbsp;1&nbsp;kids&lt;br&gt;<br>
&gt;&gt;&nbsp;mar&nbsp;04&nbsp;12:04:01&nbsp;server.mydomain.com&nbsp;squid3[4593]:&nbsp;Squid&nbsp;Parent:&nbsp;(squid-1)&nbsp;process&nbsp;4595&nbsp;started&lt;br&gt;<br>
&gt;&gt;&nbsp;mar&nbsp;04&nbsp;12:04:01&nbsp;server.mydomain.com&nbsp;squid3[4560]:&nbsp;.&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;12:04:30&nbsp;[root&nbsp;at&nbsp;server&nbsp;]#&nbsp;ps&nbsp;fax&nbsp;|&nbsp;grep&nbsp;ext_wbinfo_group_acl&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;1418&nbsp;pts/0&nbsp;&nbsp;&nbsp;&nbsp;S&#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0:00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\_&nbsp;grep&nbsp;ext_wbinfo_group_acl&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;If&nbsp;I&nbsp;run&nbsp;echo&nbsp;&quot;mydomain\user1&nbsp;it_group&quot;&nbsp;|&nbsp;/usr/lib/squid3/ext_wbinfo_group_acl&nbsp;-d,&nbsp;it&nbsp;returns&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;Debugging&nbsp;mode&nbsp;ON.&lt;br&gt;<br>
&gt;&gt;&nbsp;Got&nbsp;mydomain\user1&nbsp;it_group&nbsp;from&nbsp;squid&lt;br&gt;<br>
&gt;&gt;&nbsp;User:&nbsp;&nbsp;-mydomain\user1-&lt;br&gt;<br>
&gt;&gt;&nbsp;Group:&nbsp;-it_group-&lt;br&gt;<br>
&gt;&gt;&nbsp;SID:&nbsp;&nbsp;&nbsp;-S-1-5-21-2290000000-711000000-3300000000-3949-&lt;br&gt;<br>
&gt;&gt;&nbsp;GID:&nbsp;&nbsp;&nbsp;-10006-&lt;br&gt;<br>
&gt;&gt;&nbsp;Sending&nbsp;OK&nbsp;to&nbsp;squid&lt;br&gt;<br>
&gt;&gt;&nbsp;OK&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;What&nbsp;it's&nbsp;a&nbsp;good,&nbsp;because&nbsp;that&nbsp;user&nbsp;belongs&nbsp;to&nbsp;that&nbsp;group.&nbsp;If&nbsp;I&nbsp;change&nbsp;the&nbsp;group&nbsp;name,&nbsp;it&nbsp;returns&nbsp;an&nbsp;ERR.&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;Here&nbsp;is&nbsp;my&nbsp;squid.conf:&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;#===========================================================================&lt;br&gt;<br>
&gt;&gt;&nbsp;http_port&nbsp;3128&lt;br&gt;<br>
&gt;&gt;&nbsp;visible_hostname&nbsp;proxy.squid&lt;br&gt;<br>
&gt;&gt;&nbsp;cache_mgr&nbsp;server&nbsp;at&nbsp;proxy.com&lt;br&gt;<br>
&gt;&gt;&nbsp;cache_effective_user&nbsp;proxy&lt;br&gt;<br>
&gt;&gt;&nbsp;error_directory&nbsp;/usr/share/squid3/errors/es&lt;br&gt;<br>
&gt;&gt;&nbsp;err_page_stylesheet&nbsp;/etc/squid3/estilo.css&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;####################################################&lt;br&gt;<br>
&gt;&gt;&nbsp;#******************************Ports*************************************#&lt;br&gt;<br>
&gt;&gt;&nbsp;####################################################&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;#acl&nbsp;manager&nbsp;proto&nbsp;cache_object&lt;br&gt;<br>
&gt;&gt;&nbsp;#acl&nbsp;all&nbsp;src&nbsp;0.0.0.0/0.0.0.0&lt;br&gt;<br>
&gt;&gt;&nbsp;#acl&nbsp;localhost&nbsp;src&nbsp;127.0.0.1/32&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;SSL_ports&nbsp;port&nbsp;443&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;80&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;21&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;443&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;70&nbsp;#prot&nbsp;gopher&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;210&nbsp;#whais&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;280&nbsp;#http-mgmt&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;488&nbsp;#gss-http&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;591&nbsp;#filemaker&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;8080&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;2481&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;20010&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;Safe_ports&nbsp;port&nbsp;777&nbsp;#multi&nbsp;http&lt;br&gt;<br>
&gt;&gt;&nbsp;#acl&nbsp;purge&nbsp;method&nbsp;PURGE&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;CONNECT&nbsp;method&nbsp;CONNECT&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;acl_uses_indirect_client&nbsp;on&lt;br&gt;<br>
&gt;&gt;&nbsp;delay_pool_uses_indirect_client&nbsp;on&lt;br&gt;<br>
&gt;&gt;&nbsp;log_uses_indirect_client&nbsp;on&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;##############################################################&lt;br&gt;<br>
&gt;&gt;&nbsp;#*******************Active&nbsp;Directory&nbsp;HELPERS**************************#&lt;br&gt;<br>
&gt;&gt;&nbsp;##############################################################&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;auth_param&nbsp;ntlm&nbsp;program&nbsp;/usr/bin/ntlm_auth&nbsp;--helper-protocol=squid-2.5-ntlmssp&nbsp;--DOMAIN=MYDOMAIN&lt;br&gt;<br>
&gt;&gt;&nbsp;auth_param&nbsp;ntlm&nbsp;children&nbsp;100&lt;br&gt;<br>
&gt;&gt;&nbsp;auth_param&nbsp;ntlm&nbsp;keep_alive&nbsp;off&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;auth_param&nbsp;basic&nbsp;program&nbsp;/usr/bin/ntlm_auth&nbsp;--helper-protocol=squid-2.5-basic&lt;br&gt;<br>
&gt;&gt;&nbsp;auth_param&nbsp;basic&nbsp;children&nbsp;100&lt;br&gt;<br>
&gt;&gt;&nbsp;auth_param&nbsp;basic&nbsp;realm&nbsp;Servidor&nbsp;proxy-cache&lt;br&gt;<br>
&gt;&gt;&nbsp;auth_param&nbsp;basic&nbsp;credentialsttl&nbsp;2&nbsp;hours&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;#######################################################################&lt;br&gt;<br>
&gt;&gt;&nbsp;#****************************ACL******************************************#&lt;br&gt;<br>
&gt;&gt;&nbsp;###########################################################################&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;#---------------------------ACL&nbsp;Active&nbsp;Directory------------------------#&lt;br&gt;<br>
&gt;&gt;&nbsp;external_acl_type&nbsp;Grupos_AD&nbsp;ttl=10&nbsp;negative_ttl=10&nbsp;children=100&nbsp;%LOGIN&nbsp;/usr/lib/squid3/ext_wbinfo_group_acl&nbsp;-d&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;it_group&nbsp;external&nbsp;Grupos_AD&nbsp;it_group&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;------------------Acceso&nbsp;sólo&nbsp;a&nbsp;usuarios&nbsp;autenticados--------------------#&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;auth&nbsp;proxy_auth&nbsp;REQUIRED&lt;br&gt;<br>
&gt;&gt;&nbsp;http_access&nbsp;deny&nbsp;!auth&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;#-----------------------------Grupo&nbsp;*it_group*----------------------------#&lt;br&gt;<br>
&gt;&gt;&nbsp;http_access&nbsp;allow&nbsp;it_group&nbsp;allow&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;What&nbsp;is&nbsp;this&nbsp;extra&nbsp;&quot;allow&quot;&nbsp;on&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;line&nbsp;for?&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;I&nbsp;dont&nbsp;see&nbsp;any&nbsp;ACL&nbsp;named&nbsp;&quot;allow&quot;&nbsp;in&nbsp;the&nbsp;above&nbsp;config.&nbsp;So&nbsp;that&nbsp;may&nbsp;be&lt;br&gt;<br>
&gt;preventing&nbsp;Squid&nbsp;from&nbsp;restarting,&nbsp;which&nbsp;would&nbsp;confuse&nbsp;systemd.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
This&nbsp;is&nbsp;only&nbsp;a&nbsp;mistake.&nbsp;ACL&nbsp;&quot;allow&quot;&nbsp;does&nbsp;not&nbsp;exist.&nbsp;So&nbsp;it&nbsp;should&nbsp;be:&lt;br&gt;<br>
#-----------------------------Grupo&nbsp;*it_group*----------------------------#&lt;br&gt;<br>
http_access&nbsp;allow&nbsp;it_group&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;http_access&nbsp;allow&nbsp;manager&nbsp;localhost&lt;br&gt;<br>
&gt;&gt;&nbsp;http_access&nbsp;deny&nbsp;manager&lt;br&gt;<br>
&gt;&gt;&nbsp;#http_access&nbsp;allow&nbsp;purge&nbsp;localhost&lt;br&gt;<br>
&gt;&gt;&nbsp;#http_access&nbsp;deny&nbsp;purge&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;Please&nbsp;move&nbsp;the&nbsp;below&nbsp;two&nbsp;lines&nbsp;up&nbsp;to&nbsp;be&nbsp;the&nbsp;very&nbsp;first&nbsp;http_access&lt;br&gt;<br>
&gt;lines&nbsp;in&nbsp;your&nbsp;config.&nbsp;Part&nbsp;of&nbsp;their&nbsp;purpose&nbsp;is&nbsp;to&nbsp;protect&nbsp;against&nbsp;some&lt;br&gt;<br>
&gt;DoS&nbsp;conditions&nbsp;which&nbsp;can&nbsp;cause&nbsp;exactly&nbsp;this&nbsp;type&nbsp;of&nbsp;overload&nbsp;on&nbsp;headers.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
I'll&nbsp;move&nbsp;it.&lt;br&gt;<br>
&gt;&gt;&nbsp;http_access&nbsp;deny&nbsp;!Safe_ports&lt;br&gt;<br>
&gt;&gt;&nbsp;http_access&nbsp;deny&nbsp;CONNECT&nbsp;!SSL_PORTS&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;http_access&nbsp;deny&nbsp;all&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;dead_peer_timeout&nbsp;20&nbsp;seconds&lt;br&gt;<br>
&gt;&gt;&nbsp;strip_query_terms&nbsp;on&lt;br&gt;<br>
&gt;&gt;&nbsp;debug_options&nbsp;ALL,1&nbsp;33,2&nbsp;28,9&lt;br&gt;<br>
&gt;&gt;&nbsp;coredump_dir&nbsp;/var/spool/squid3&lt;br&gt;<br>
&gt;&gt;&nbsp;ftp_passive&nbsp;on&lt;br&gt;<br>
&gt;&gt;&nbsp;ftp_sanitycheck&nbsp;off&lt;br&gt;<br>
&gt;&gt;&nbsp;ftp_telnet_protocol&nbsp;off&lt;br&gt;<br>
&gt;&gt;&nbsp;read_ahead_gap&nbsp;1&nbsp;MB&lt;br&gt;<br>
&gt;&gt;&nbsp;positive_dns_ttl&nbsp;6&nbsp;hours&lt;br&gt;<br>
&gt;&gt;&nbsp;forward_max_tries&nbsp;25&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;############################################################################&lt;br&gt;<br>
&gt;&gt;&nbsp;#*************************Log********************************#&lt;br&gt;<br>
&gt;&gt;&nbsp;############################################################################&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;logformat&nbsp;squid&nbsp;%ts.%03tu&nbsp;%6tr&nbsp;%&gt;a&nbsp;%Ss/%03&gt;Hs&nbsp;%&lt;st&nbsp;%rm&nbsp;%ru&nbsp;%un&nbsp;%Sh/%&lt;A&nbsp;%mt&lt;br&gt;<br>
&gt;&gt;&nbsp;cache_access_log&nbsp;/var/log/squid3/access.log&lt;br&gt;<br>
&gt;&gt;&nbsp;cache_log&nbsp;/var/log/squid3/cache.log&lt;br&gt;<br>
&gt;&gt;&nbsp;logfile_rotate&nbsp;0&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;############################################################################&lt;br&gt;<br>
&gt;&gt;&nbsp;#******************Cache&nbsp;and&nbsp;memory***************************#&lt;br&gt;<br>
&gt;&gt;&nbsp;############################################################################&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;cache_mem&nbsp;1024&nbsp;MB&lt;br&gt;<br>
&gt;&gt;&nbsp;maximum_object_size_in_memory&nbsp;1024&nbsp;KB&lt;br&gt;<br>
&gt;&gt;&nbsp;memory_cache_mode&nbsp;always&lt;br&gt;<br>
&gt;&gt;&nbsp;cache_dir&nbsp;aufs&nbsp;/var/spool/squid3&nbsp;15000&nbsp;16&nbsp;256&lt;br&gt;<br>
&gt;&gt;&nbsp;maximum_object_size&nbsp;96&nbsp;MB&lt;br&gt;<br>
&gt;&gt;&nbsp;minimum_object_size&nbsp;10&nbsp;KB&lt;br&gt;<br>
&gt;&gt;&nbsp;#cache_replacement_policy&nbsp;heap&nbsp;LFUDA&lt;br&gt;<br>
&gt;&gt;&nbsp;cache_replacement_policy&nbsp;heap&nbsp;GDSF&lt;br&gt;<br>
&gt;&gt;&nbsp;memory_replacement_policy&nbsp;heap&nbsp;GDSF&lt;br&gt;<br>
&gt;&gt;&nbsp;#memory_replacement_policy&nbsp;lru&lt;br&gt;<br>
&gt;&gt;&nbsp;cache_store_log&nbsp;none&lt;br&gt;<br>
&gt;&gt;&nbsp;#log_fqdn&nbsp;off&lt;br&gt;<br>
&gt;&gt;&nbsp;log_icp_queries&nbsp;off&lt;br&gt;<br>
&gt;&gt;&nbsp;buffered_logs&nbsp;off&lt;br&gt;<br>
&gt;&gt;&nbsp;#emulate_httpd_log&nbsp;off&lt;br&gt;<br>
&gt;&gt;&nbsp;redirect_rewrites_host_header&nbsp;off&lt;br&gt;<br>
&gt;&gt;&nbsp;cache_swap_low&nbsp;80&lt;br&gt;<br>
&gt;&gt;&nbsp;cache_swap_high&nbsp;95&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;#===========================================================================&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;It&nbsp;is&nbsp;really&nbsp;weird,&nbsp;I&nbsp;really&nbsp;don't&nbsp;know&nbsp;how&nbsp;to&nbsp;solve&nbsp;this.&nbsp;I&nbsp;hope&nbsp;my&nbsp;explanation&nbsp;was&nbsp;clear.&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;For&nbsp;testing&nbsp;purposes,&nbsp;I&nbsp;have&nbsp;another&nbsp;Squid&nbsp;working&nbsp;with&nbsp;the&nbsp;same&nbsp;AD&nbsp;server,&nbsp;and&nbsp;it&nbsp;is&nbsp;going&nbsp;fine:&nbsp;the&nbsp;helper&nbsp;and&nbsp;pinger&nbsp;are&nbsp;executed&nbsp;as&nbsp;you&nbsp;can&nbsp;see&nbsp;here:&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;root&nbsp;at&nbsp;debian-test-server:/etc/squid3#&nbsp;systemctl&nbsp;status&nbsp;squid3.service&lt;br&gt;<br>
&gt;&gt;&nbsp;●&nbsp;squid3.service&nbsp;-&nbsp;LSB:&nbsp;Squid&nbsp;HTTP&nbsp;Proxy&nbsp;version&nbsp;3.x&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;Loaded:&nbsp;loaded&nbsp;(/etc/init.d/squid3)&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;Active:&nbsp;active&nbsp;(running)&nbsp;since&nbsp;lun&nbsp;2017-02-13&nbsp;07:35:01&nbsp;ART;&nbsp;2&nbsp;weeks&nbsp;5&nbsp;days&nbsp;ago&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;Process:&nbsp;570&nbsp;ExecStart=/etc/init.d/squid3&nbsp;start&nbsp;(code=exited,&nbsp;status=0/SUCCESS)&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;CGroup:&nbsp;/system.slice/squid3.service&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;├─&nbsp;1017&nbsp;/usr/sbin/squid3&nbsp;-YC&nbsp;-f&nbsp;/etc/squid3/squid.conf&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;├─&nbsp;1020&nbsp;(squid-1)&nbsp;-YC&nbsp;-f&nbsp;/etc/squid3/squid.conf&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;├─&nbsp;1945&nbsp;/usr/bin/perl&nbsp;-w&nbsp;/usr/lib/squid3/ext_wbinfo_group_acl&nbsp;-d&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;├─&nbsp;1968&nbsp;(ntlm_auth)&nbsp;--helper-protocol=squid-2.5-ntlmssp&nbsp;--DOMAIN=MYDOMAIN&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;├─&nbsp;1969&nbsp;(ntlm_auth)&nbsp;--helper-protocol=squid-2.5-ntlmssp&nbsp;--DOMAIN=MYDOMAIN&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;├─&nbsp;1970&nbsp;(ntlm_auth)&nbsp;--helper-protocol=squid-2.5-ntlmssp&nbsp;--DOMAIN=MYDOMAIN&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;├─&nbsp;1971&nbsp;(ntlm_auth)&nbsp;--helper-protocol=squid-2.5-ntlmssp&nbsp;--DOMAIN=MYDOMAIN&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;├─&nbsp;1972&nbsp;(ntlm_auth)&nbsp;--helper-protocol=squid-2.5-ntlmssp&nbsp;--DOMAIN=MYDOMAIN&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;├─&nbsp;1973&nbsp;(ntlm_auth)&nbsp;--helper-protocol=squid-2.5-ntlmssp&nbsp;--DOMAIN=MYDOMAIN&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;├─&nbsp;1974&nbsp;(ntlm_auth)&nbsp;--helper-protocol=squid-2.5-ntlmssp&nbsp;--DOMAIN=MYDOMAIN&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;├─&nbsp;1993&nbsp;/usr/bin/perl&nbsp;-w&nbsp;/usr/lib/squid3/ext_wbinfo_group_acl&nbsp;-d&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;├─&nbsp;2029&nbsp;/usr/bin/perl&nbsp;-w&nbsp;/usr/lib/squid3/ext_wbinfo_group_acl&nbsp;-d&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;├─63477&nbsp;(pinger)&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;├─63478&nbsp;(ntlm_auth)&nbsp;--helper-protocol=squid-2.5-ntlmssp&nbsp;--DOMAIN=MYDOMAIN&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;├─63479&nbsp;(ntlm_auth)&nbsp;--helper-protocol=squid-2.5-basic&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;└─63480&nbsp;/usr/bin/perl&nbsp;-w&nbsp;/usr/lib/squid3/ext_wbinfo_group_acl&nbsp;-d&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;As&nbsp;configured&nbsp;your&nbsp;Squid&nbsp;should&nbsp;be&nbsp;starting&nbsp;exactly&nbsp;100&nbsp;of&nbsp;each&nbsp;-&nbsp;no&lt;br&gt;<br>
&gt;more,&nbsp;no&nbsp;less.&nbsp;I&nbsp;suspect&nbsp;from&nbsp;both&nbsp;these&nbsp;traces&nbsp;that&nbsp;you&nbsp;dont&nbsp;actually&lt;br&gt;<br>
&gt;need&nbsp;100&nbsp;of&nbsp;each&nbsp;helper&nbsp;running,&nbsp;or&nbsp;systemd&nbsp;is&nbsp;confused&nbsp;already.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;The&nbsp;current&nbsp;Squid&nbsp;versions&nbsp;can&nbsp;auto-start&nbsp;helpers&nbsp;as&nbsp;needed.&nbsp;See&nbsp;the&lt;br&gt;<br>
&gt;auth_param&nbsp;and&nbsp;external_acl_type&nbsp;documentation&nbsp;for&nbsp;the&nbsp;max=,&nbsp;startup=&lt;br&gt;<br>
&gt;and&nbsp;idle=&nbsp;options.&nbsp;That&nbsp;may&nbsp;help&nbsp;a&nbsp;little,&nbsp;or&nbsp;at&nbsp;least&nbsp;allow&nbsp;you&nbsp;to&lt;br&gt;<br>
&gt;configure&nbsp;higher&nbsp;max&nbsp;limits&nbsp;to&nbsp;cope&nbsp;with&nbsp;slow&nbsp;AD&nbsp;periods.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;tried&nbsp;with&nbsp;those&nbsp;params&nbsp;but&nbsp;nothing&nbsp;happens.&nbsp;The&nbsp;helper&nbsp;doesn't&nbsp;&nbsp;auto-start.&nbsp;&lt;br&gt;<br>
&lt;i&gt;external_acl_type&nbsp;Grupos_AD&nbsp;ttl=10&nbsp;children-max=10&nbsp;children-startup=10&nbsp;children-idle=10&nbsp;%LOGIN&nbsp;/usr/lib/squid3/ext_wbinfo_group_acl&nbsp;-d&lt;/i&gt;&lt;i&gt;&lt;br&gt;<br>
&lt;/i&gt;&lt;br&gt;<br>
And&nbsp;as&nbsp;suggested&nbsp;in&nbsp;the&nbsp;Squid&nbsp;wiki&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://www.squid-cache.org/Doc/config/auth_param/&quot;&gt;<br>
http://www.squid-cache.org/Doc/config/auth_param/&lt;/a&gt;,&nbsp;I&nbsp;used&nbsp;this&nbsp;values&nbsp;for:&nbsp;&lt;br&gt;<br>
&lt;i&gt;auth_param&nbsp;ntlm&nbsp;program&nbsp;/usr/bin/ntlm_auth&nbsp;--helper-protocol=squid-2.5-ntlmssp&nbsp;--DOMAIN=RENTAS&lt;/i&gt;&lt;i&gt;&lt;br&gt;<br>
&lt;/i&gt;&lt;i&gt;auth_param&nbsp;ntlm&nbsp;children&nbsp;20&nbsp;startup=0&nbsp;idle=1&lt;/i&gt;&lt;i&gt;&lt;br&gt;<br>
&lt;/i&gt;&lt;i&gt;auth_param&nbsp;ntlm&nbsp;keep_alive&nbsp;off&lt;/i&gt;&lt;i&gt;&lt;br&gt;<br>
&lt;/i&gt;&lt;i&gt;&lt;br&gt;<br>
&lt;/i&gt;&lt;i&gt;auth_param&nbsp;basic&nbsp;program&nbsp;/usr/bin/ntlm_auth&nbsp;--helper-protocol=squid-2.5-basic&lt;/i&gt;&lt;i&gt;&lt;br&gt;<br>
&lt;/i&gt;&lt;i&gt;auth_param&nbsp;basic&nbsp;children&nbsp;5&nbsp;startup=5&nbsp;idle=1&lt;/i&gt;&lt;i&gt;&lt;br&gt;<br>
&lt;/i&gt;&lt;i&gt;auth_param&nbsp;basic&nbsp;realm&nbsp;DPR-proxy&lt;/i&gt;&lt;i&gt;&lt;br&gt;<br>
&lt;/i&gt;&lt;i&gt;auth_param&nbsp;basic&nbsp;credentialsttl&nbsp;2&nbsp;hours&lt;/i&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;Another&nbsp;possibility&nbsp;is&nbsp;converting&nbsp;to&nbsp;the&nbsp;LDAP&nbsp;group&nbsp;lookup&nbsp;instead&nbsp;of&lt;br&gt;<br>
&gt;using&nbsp;the&nbsp;wbinfo&nbsp;tool&nbsp;to&nbsp;do&nbsp;lookups.&nbsp;I&nbsp;know&nbsp;that&nbsp;LDAP&nbsp;does&nbsp;not&nbsp;suffer&lt;br&gt;<br>
&gt;from&nbsp;wbind&nbsp;connection&nbsp;limits,&nbsp;which&nbsp;might&nbsp;be&nbsp;part&nbsp;of&nbsp;your&nbsp;issue.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;Amos&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
Please&nbsp;Amos&nbsp;provide&nbsp;me&nbsp;further&nbsp;guidance.&nbsp;Cannot&nbsp;find&nbsp;a&nbsp;solution&nbsp;to&nbsp;this.&nbsp;Thanks!&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;moz-signature&quot;&gt;--&nbsp;&lt;br&gt;<br>
&lt;b&gt;Verónica&nbsp;Ovando&lt;/b&gt;&lt;/div&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
