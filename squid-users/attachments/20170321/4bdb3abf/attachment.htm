<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;class=&quot;gmail_default&quot;&nbsp;style=&quot;font-family:georgia,serif&quot;&gt;Thanks&nbsp;a&nbsp;lot&nbsp;for&nbsp;the&nbsp;information.&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_default&quot;&nbsp;style=&quot;font-family:georgia,serif&quot;&gt;I&nbsp;will&nbsp;try&nbsp;this&nbsp;and&nbsp;give&nbsp;feedback.&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_default&quot;&nbsp;style=&quot;font-family:georgia,serif&quot;&gt;Best&nbsp;Regards&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Tue,&nbsp;Mar&nbsp;21,&nbsp;2017&nbsp;at&nbsp;1:00&nbsp;PM,&nbsp;&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:squid-users-request@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users-request@lists.squid-cache.org&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;Send&nbsp;squid-users&nbsp;mailing&nbsp;list&nbsp;submissions&nbsp;to&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.&lt;wbr&gt;org&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
To&nbsp;subscribe&nbsp;or&nbsp;unsubscribe&nbsp;via&nbsp;the&nbsp;World&nbsp;Wide&nbsp;Web,&nbsp;visit&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/&lt;wbr&gt;listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
or,&nbsp;via&nbsp;email,&nbsp;send&nbsp;a&nbsp;message&nbsp;with&nbsp;subject&nbsp;or&nbsp;body&nbsp;&#39;help&#39;&nbsp;to&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;&lt;a&nbsp;href=&quot;mailto:squid-users-request@lists.squid-cache.org&quot;&gt;squid-users-request@lists.&lt;wbr&gt;squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
You&nbsp;can&nbsp;reach&nbsp;the&nbsp;person&nbsp;managing&nbsp;the&nbsp;list&nbsp;at&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;&lt;a&nbsp;href=&quot;mailto:squid-users-owner@lists.squid-cache.org&quot;&gt;squid-users-owner@lists.squid-&lt;wbr&gt;cache.org&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
When&nbsp;replying,&nbsp;please&nbsp;edit&nbsp;your&nbsp;Subject&nbsp;line&nbsp;so&nbsp;it&nbsp;is&nbsp;more&nbsp;specific&lt;br&gt;<br>
than&nbsp;&quot;Re:&nbsp;Contents&nbsp;of&nbsp;squid-users&nbsp;digest...&quot;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Today&#39;s&nbsp;Topics:&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; 1.&nbsp;Re:&nbsp;Squid&nbsp;Transparent/intercept&nbsp;Issues&nbsp;(Antony&nbsp;Stone)&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
------------------------------&lt;wbr&gt;------------------------------&lt;wbr&gt;----------&lt;br&gt;<br>
&lt;br&gt;<br>
Message:&nbsp;1&lt;br&gt;<br>
Date:&nbsp;Tue,&nbsp;21&nbsp;Mar&nbsp;2017&nbsp;12:12:01&nbsp;+0100&lt;br&gt;<br>
From:&nbsp;Antony&nbsp;Stone&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:Antony.Stone@squid.open.source.it&quot;&gt;Antony.Stone@squid.open.&lt;wbr&gt;source.it&lt;/a&gt;&gt;&lt;br&gt;<br>
To:&nbsp;&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.&lt;wbr&gt;org&lt;/a&gt;&lt;br&gt;<br>
Subject:&nbsp;Re:&nbsp;[squid-users]&nbsp;Squid&nbsp;Transparent/intercept&nbsp;Issues&lt;br&gt;<br>
Message-ID:&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:201703211212.01346.Antony.Stone@squid.open.source.it&quot;&gt;201703211212.01346.Antony.&lt;wbr&gt;Stone@squid.open.source.it&lt;/a&gt;&gt;&lt;br&gt;<br>
Content-Type:&nbsp;Text/Plain; &nbsp;charset=&quot;utf-8&quot;&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;Tuesday&nbsp;21&nbsp;March&nbsp;2017&nbsp;at&nbsp;12:00:05,&nbsp;christian&nbsp;brendan&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;Today&#39;s&nbsp;Topics:&lt;br&gt;<br>
&gt;&nbsp;&gt; &nbsp; &nbsp;1.&nbsp;Re:&nbsp;Squid&nbsp;Transparent/intercept&nbsp;Issues&nbsp;(Antony&nbsp;Stone)&lt;br&gt;<br>
&gt;&nbsp;&gt; &nbsp; &nbsp;2.&nbsp;Re:&nbsp;SMP&nbsp;and&nbsp;AUFS&nbsp;(Matus&nbsp;UHLAR&nbsp;-&nbsp;fantomas)&lt;br&gt;<br>
&gt;&nbsp;&gt; &nbsp; &nbsp;3.&nbsp;Re:&nbsp;SMP&nbsp;and&nbsp;AUFS&nbsp;(Alex&nbsp;Rousskov)&lt;br&gt;<br>
&gt;&nbsp;&gt; &nbsp; &nbsp;4.&nbsp;Re:&nbsp;squid&nbsp;workers&nbsp;question&nbsp;(Alex&nbsp;Rousskov)&lt;br&gt;<br>
&gt;&nbsp;&gt; &nbsp; &nbsp;5.&nbsp;Re:&nbsp;squid&nbsp;workers&nbsp;question&nbsp;(Matus&nbsp;UHLAR&nbsp;-&nbsp;fantomas)&lt;br&gt;<br>
&gt;&nbsp;&gt; &nbsp; &nbsp;6.&nbsp;Re:&nbsp;SSL&nbsp;Bump&nbsp;issues&nbsp;(Alex&nbsp;Rousskov)&lt;br&gt;<br>
&gt;&nbsp;&gt; &nbsp; &nbsp;7.&nbsp;blocking&nbsp;or&nbsp;allowing&nbsp;specific&nbsp;youtube&nbsp;videos&nbsp;(Sohan&nbsp;Wijetunga)&lt;br&gt;<br>
&lt;br&gt;<br>
Please&nbsp;edit&nbsp;your&nbsp;reply&nbsp;when&nbsp;responding&nbsp;to&nbsp;a&nbsp;digest&nbsp;email,&nbsp;deleting&nbsp;everything&lt;br&gt;<br>
not&nbsp;specific&nbsp;to&nbsp;your&nbsp;question.&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;Date:&nbsp;Mon,&nbsp;20&nbsp;Mar&nbsp;2017&nbsp;16:56:17&nbsp;+0100&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;From:&nbsp;Antony&nbsp;Stone&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;To:&nbsp;&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.&lt;wbr&gt;org&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;Subject:&nbsp;Re:&nbsp;[squid-users]&nbsp;Squid&nbsp;Transparent/intercept&nbsp;Issues&lt;br&gt;<br>
&gt;&nbsp;&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;On&nbsp;Monday&nbsp;20&nbsp;March&nbsp;2017&nbsp;at&nbsp;16:26:40,&nbsp;christian&nbsp;brendan&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;&gt;&nbsp;Hello&nbsp;Everyone,&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;&gt;&nbsp;Squid&nbsp;Cache:&nbsp;Version&nbsp;3.5.20&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;&gt;&nbsp;OS:&nbsp;CentOS&nbsp;7&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;&gt;&nbsp;I&nbsp;have&nbsp;used&nbsp;squid&nbsp;for&nbsp;quite&nbsp;some&nbsp;times&nbsp;non&nbsp;transparently&nbsp;and&nbsp;it&nbsp;works,&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;&gt;&nbsp;problem&nbsp;kicks&nbsp;in&nbsp;when:&nbsp;http_port&nbsp;3128&nbsp;transparent&nbsp;is&nbsp;enabled.&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;&gt;&nbsp;Access&nbsp;denied&nbsp;error&nbsp;page&nbsp;shows&nbsp;up&nbsp;when&nbsp;transparent&nbsp;is&nbsp;enabled&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;&gt;&nbsp;ERRORThe&nbsp;requested&nbsp;URL&nbsp;could&nbsp;not&nbsp;be&nbsp;retrieved&lt;br&gt;<br>
&gt;&nbsp;&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;How&nbsp;are&nbsp;you&nbsp;getting&nbsp;the&nbsp;packets&nbsp;to&nbsp;the&nbsp;Squid&nbsp;server&nbsp;for&nbsp;interception?&lt;br&gt;<br>
&gt;&nbsp;&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;Is&nbsp;the&nbsp;Squid&nbsp;server&nbsp;in&nbsp;the&nbsp;default&nbsp;route&nbsp;between&nbsp;your&nbsp;clients&nbsp;and&nbsp;the&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;Internet,&nbsp;or&nbsp;are&nbsp;you&nbsp;redirecting&nbsp;the&nbsp;packets&nbsp;to&nbsp;the&nbsp;Squid&nbsp;server&nbsp;somehow?&lt;br&gt;<br>
&gt;&nbsp;&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;Please&nbsp;give&nbsp;*details*&nbsp;of&nbsp;how&nbsp;you&nbsp;are&nbsp;intercepting&nbsp;and&nbsp;sending&nbsp;the&nbsp;packets&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;to&nbsp;Squid&nbsp;(eg:&nbsp;iptables&nbsp;rules,&nbsp;and&nbsp;which&nbsp;machine/s&nbsp;the&nbsp;rules&nbsp;are&nbsp;running&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;on).&lt;br&gt;<br>
&gt;&nbsp;&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;Antony.&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;​@Antony.Stone&lt;br&gt;<br>
&gt;&nbsp;1.&nbsp;​I&nbsp;am&nbsp;using&nbsp;mikrotik&nbsp;routerboard&nbsp;to&nbsp;redirect&nbsp;traffic,&nbsp;with&nbsp;this&nbsp;rule:&lt;br&gt;<br>
&gt;&nbsp;dd&nbsp;action=dst-nat&nbsp;chain=dstnat&nbsp;comment=&quot;Redirect&nbsp;port&nbsp;80&nbsp;to&nbsp;SquidProxy&quot;&lt;br&gt;<br>
&gt;&nbsp;dst-port=80&nbsp;protocol=tcp&nbsp;\&nbsp;src-address=10.24.7.100&nbsp;to-addresses=10.24.7.101&lt;br&gt;<br>
&gt;&nbsp;to-ports=3128&lt;br&gt;<br>
&lt;br&gt;<br>
Okay,&nbsp;so&nbsp;there&#39;s&nbsp;your&nbsp;problem,&nbsp;then.&lt;br&gt;<br>
&lt;br&gt;<br>
You&nbsp;must&nbsp;not&nbsp;use&nbsp;DSTNAT&nbsp;on&nbsp;a&nbsp;separate&nbsp;router&nbsp;to&nbsp;send&nbsp;packets&nbsp;to&nbsp;Squid&nbsp;for&lt;br&gt;<br>
intercept.&lt;br&gt;<br>
&lt;br&gt;<br>
(This&nbsp;used&nbsp;to&nbsp;work&nbsp;in&nbsp;older&nbsp;versions&nbsp;of&nbsp;Squid,&nbsp;but&nbsp;does&nbsp;not&nbsp;work&nbsp;any&nbsp;more&nbsp;and&lt;br&gt;<br>
is&nbsp;documented&nbsp;on&nbsp;the&nbsp;wiki,&nbsp;for&nbsp;example&nbsp;at&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://wiki.squid-cache.org/ConfigExamples/Intercept/LinuxDnat&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://wiki.squid-cache.org/&lt;wbr&gt;ConfigExamples/Intercept/&lt;wbr&gt;LinuxDnat&lt;/a&gt;&nbsp;)&lt;br&gt;<br>
&lt;br&gt;<br>
Note&nbsp;the&nbsp;wording:&nbsp;&quot;NOTE:&nbsp;This&nbsp;configuration&nbsp;is&nbsp;given&nbsp;for&nbsp;use&nbsp;on&nbsp;the&nbsp;squid&nbsp;box.&quot;&lt;br&gt;<br>
That&nbsp;means&nbsp;the&nbsp;NAT&nbsp;rules&nbsp;*must*&nbsp;be&nbsp;running&nbsp;on&nbsp;the&nbsp;Squid&nbsp;box&nbsp;itself&nbsp;and&nbsp;not&nbsp;(in&lt;br&gt;<br>
your&nbsp;case)&nbsp;on&nbsp;the&nbsp;Mikrotik&nbsp;router.&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;3.​&nbsp;It&nbsp;is&nbsp;not&nbsp;in&nbsp;default&nbsp;route,&nbsp;packets&nbsp;is&nbsp;been&nbsp;redirected.&lt;br&gt;<br>
&lt;br&gt;<br>
In&nbsp;that&nbsp;case&nbsp;you&nbsp;need&nbsp;to&nbsp;use&nbsp;policy&nbsp;routing&nbsp;to&nbsp;get&nbsp;the&nbsp;packets&nbsp;*unchanged*&nbsp;to&lt;br&gt;<br>
the&nbsp;Squid&nbsp;box&nbsp;-&nbsp;see&nbsp;the&nbsp;above&nbsp;link,&nbsp;and&nbsp;also&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://wiki.squid-cache.org/ConfigExamples/Intercept/IptablesPolicyRoute&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://wiki.squid-cache.org/&lt;wbr&gt;ConfigExamples/Intercept/&lt;wbr&gt;IptablesPolicyRoute&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;​4.&nbsp;There&nbsp;is&nbsp;no&nbsp;iptable&nbsp;rules,&nbsp;firewall&nbsp;is&nbsp;disabled&nbsp;for&nbsp;this&nbsp;test.&lt;br&gt;<br>
&lt;br&gt;<br>
You&nbsp;have&nbsp;to&nbsp;have&nbsp;a&nbsp;REDIRECT&nbsp;rule&nbsp;on&nbsp;the&nbsp;machine&nbsp;running&nbsp;Squid&nbsp;to&nbsp;get&nbsp;it&nbsp;to&nbsp;see&lt;br&gt;<br>
the&nbsp;packets&nbsp;(once&nbsp;they&nbsp;are&nbsp;no&nbsp;longer&nbsp;being&nbsp;DNATted).&lt;br&gt;<br>
&lt;br&gt;<br>
Please&nbsp;try&nbsp;to&nbsp;follow&nbsp;the&nbsp;guidelines&nbsp;at&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://wiki.squid-cache.org/ConfigExamples/Intercept/LinuxDnat&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://wiki.squid-cache.org/&lt;wbr&gt;ConfigExamples/Intercept/&lt;wbr&gt;LinuxDnat&lt;/a&gt;&nbsp;and&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://wiki.squid-cache.org/ConfigExamples/Intercept/IptablesPolicyRoute&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://wiki.squid-cache.org/&lt;wbr&gt;ConfigExamples/Intercept/&lt;wbr&gt;IptablesPolicyRoute&lt;/a&gt;&nbsp;and&lt;br&gt;<br>
then&nbsp;come&nbsp;back&nbsp;to&nbsp;us&nbsp;with&nbsp;details&nbsp;of&nbsp;what&nbsp;you&#39;ve&nbsp;tried,&nbsp;if&nbsp;there&nbsp;are&nbsp;still&lt;br&gt;<br>
problems.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Regards,&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Antony.&lt;br&gt;<br>
&lt;br&gt;<br>
--&lt;br&gt;<br>
A&nbsp;user&nbsp;interface&nbsp;is&nbsp;like&nbsp;a&nbsp;joke.&lt;br&gt;<br>
If&nbsp;you&nbsp;have&nbsp;to&nbsp;explain&nbsp;it,&nbsp;it&nbsp;didn&#39;t&nbsp;work.&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Please&nbsp;reply&nbsp;to&nbsp;the&nbsp;list;&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; please&nbsp;*don&#39;t*&nbsp;CC&nbsp;me.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
------------------------------&lt;br&gt;<br>
&lt;br&gt;<br>
Subject:&nbsp;Digest&nbsp;Footer&lt;br&gt;<br>
&lt;br&gt;<br>
______________________________&lt;wbr&gt;_________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.&lt;wbr&gt;org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/&lt;wbr&gt;listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
------------------------------&lt;br&gt;<br>
&lt;br&gt;<br>
End&nbsp;of&nbsp;squid-users&nbsp;Digest,&nbsp;Vol&nbsp;31,&nbsp;Issue&nbsp;61&lt;br&gt;<br>
******************************&lt;wbr&gt;*************&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
