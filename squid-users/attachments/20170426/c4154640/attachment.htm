<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;Hi,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;I&nbsp;have&nbsp;the&nbsp;same&nbsp;issue&nbsp;as&nbsp;Nil.&nbsp;I&nbsp;have&nbsp;set&nbsp;No_DEFAULT_CA&nbsp;and&nbsp;also&nbsp;did&nbsp;&quot;generate-host-certificates=off&quot;. &nbsp;I&nbsp;see&nbsp;with&nbsp;these&nbsp;changes &lt;span&nbsp;style=&quot;color:rgb(80,0,80);font-size:12.8px&quot;&gt;it&nbsp;takes&nbsp;more&nbsp;time&nbsp;reach&nbsp;2GB&nbsp;but&nbsp;it&nbsp;does&nbsp;reach&nbsp;there&nbsp;(in&nbsp;about&nbsp;6&nbsp;hours&nbsp;for&nbsp;me&nbsp;with&nbsp;peak&nbsp;usage).&lt;/span&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;These&nbsp;were&nbsp;my&nbsp;settings. &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;https_port&nbsp;&lt;a&nbsp;href=&quot;http://192.168.0.10:3129&quot;&nbsp;target=&quot;_blank&quot;&gt;192.168.0.10:3129&lt;/a&gt;&nbsp;generate-host-certificates=off&nbsp;dynamic_cert_mem_cache_size=&lt;wbr&gt;4MB&nbsp;cert=/etc/squid/myserver.pem&nbsp;intercept&nbsp;ssl-bump&nbsp;sslflags=NO_DEFAULT_CA&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;https_port&nbsp;&lt;a&nbsp;href=&quot;http://192.168.0.10:3128&quot;&nbsp;target=&quot;_blank&quot;&gt;192.168.0.10:3128&lt;/a&gt; generate-&lt;wbr&gt;host-certificates=off&nbsp;dynamic_cert_mem_cache_size=&lt;wbr&gt;4MB&nbsp;cert=/etc/squid/myserver.pem&nbsp;intercept&nbsp;ssl-bump&nbsp;sslflags=NO_DEFAULT_CA&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;did&nbsp;a&nbsp;10&nbsp;minutes&nbsp;test&nbsp;to&nbsp;compare&nbsp;the&nbsp;behavior&nbsp;in&nbsp;Squid&nbsp;3.3&nbsp;and&nbsp;squid&nbsp;3.5.&nbsp;My&nbsp;test&nbsp;scenario&nbsp;was&nbsp;kept&nbsp;exactly&nbsp;same&nbsp;except&nbsp;for&nbsp;following&nbsp;diff&nbsp;in&nbsp;squid&nbsp;3.5.&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;acl&nbsp;exceptions&nbsp;ssl::server_name_regex&nbsp;&quot;/etc/squid/exception_list.txt&quot;&lt;/div&gt;&lt;div&gt;acl&nbsp;step1&nbsp;at_step&nbsp;SslBump1&lt;/div&gt;&lt;div&gt;acl&nbsp;step2&nbsp;at_step&nbsp;SslBump2&lt;/div&gt;&lt;div&gt;ssl_bump&nbsp;peek&nbsp;step1&nbsp;all&nbsp;!exceptions&lt;/div&gt;&lt;div&gt;ssl_bump&nbsp;splice&nbsp;step2&nbsp;!exceptions&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Here&nbsp;are&nbsp;the&nbsp;results&nbsp;after&nbsp;10mins&nbsp;-&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1.&nbsp;When&nbsp;I&nbsp;didn&#39;t&nbsp;use&nbsp;NO_DEFAULT_CA&nbsp;and&nbsp;generate-host-certificates=on&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Squid&nbsp;3.3&nbsp;=&nbsp;550MB&lt;/div&gt;&lt;div&gt;Squid&nbsp;3.5&nbsp;=&nbsp;1.1GB&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2.&nbsp;When&nbsp;I&nbsp;use&nbsp;NO_DEFAULT_CA&nbsp;and&nbsp;generate-host-certificates=off&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Squid&nbsp;3.3&nbsp;=&nbsp;402MB&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;Squid&nbsp;3.5&nbsp;=&nbsp;560MB&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So&nbsp;it&nbsp;looks&nbsp;like&nbsp;Squid&nbsp;3.5&nbsp;have&nbsp;higher&nbsp;mem&nbsp;usage&nbsp;than&nbsp;3.3&nbsp;in&nbsp;both&nbsp;cases&nbsp;which&nbsp;makes&nbsp;me&nbsp;wonder,&nbsp;is&nbsp;it&nbsp;that&nbsp;more&nbsp;CAs&nbsp;are&nbsp;being&nbsp;loaded&nbsp;into&nbsp;cache&nbsp;in&nbsp;3.5&nbsp;?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Also,&nbsp;is&nbsp;there&nbsp;any&nbsp;more&nbsp;change&nbsp; I&nbsp;can&nbsp;do&nbsp;to&nbsp;my&nbsp;config&nbsp;to&nbsp;arrest&nbsp;the&nbsp;memory&nbsp;growth&nbsp;to&nbsp;2GB&nbsp; in&nbsp;3.5&nbsp;in&nbsp;my&nbsp;production&nbsp;system&nbsp;?&nbsp;I&nbsp;got&nbsp;only&nbsp;4Gb&nbsp;RAM.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks&nbsp;and&nbsp;Regards,&lt;br&gt;&lt;/div&gt;&lt;div&gt;Davis&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Wed,&nbsp;Apr&nbsp;26,&nbsp;2017&nbsp;at&nbsp;8:38&nbsp;AM,&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&nbsp;target=&quot;_blank&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;On&nbsp;26/04/17&nbsp;10:53,&nbsp;Yuri&nbsp;Voinov&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
Ok,&nbsp;but&nbsp;how&nbsp;NO_DEFAULT_CA&nbsp;should&nbsp;help&nbsp;with&nbsp;this?&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/span&gt;<br>
It&nbsp;prevents&nbsp;OpenSSL&nbsp;copying&nbsp;that&nbsp;1MB&nbsp;into&nbsp;each&nbsp;incoming&nbsp;client&nbsp;connections&nbsp;memory.&nbsp;The&nbsp;CAs&nbsp;are&nbsp;only&nbsp;useful&nbsp;there&nbsp;when&nbsp;you&nbsp;have&nbsp;some&nbsp;of&nbsp;the&nbsp;global&nbsp;CAs&nbsp;as&nbsp;root&nbsp;for&nbsp;client&nbsp;certificates&nbsp;-&nbsp;in&nbsp;which&nbsp;case&nbsp;you&nbsp;still&nbsp;only&nbsp;want&nbsp;to&nbsp;trust&nbsp;the&nbsp;roots&nbsp;you&nbsp;paid&nbsp;for&nbsp;service&nbsp;and&nbsp;not&nbsp;all&nbsp;of&nbsp;them.&lt;br&gt;<br>
&lt;br&gt;<br>
Just&nbsp;something&nbsp;to&nbsp;try&nbsp;if&nbsp;there&nbsp;are&nbsp;huge&nbsp;memory&nbsp;issues&nbsp;with&nbsp;TLS/SSL&nbsp;proxying.&nbsp;The&nbsp;default&nbsp;behaviour&nbsp;is&nbsp;fixed&nbsp;for&nbsp;Squid-4&nbsp;with&nbsp;the&nbsp;config&nbsp;options&nbsp;changes.&nbsp;But&nbsp;due&nbsp;to&nbsp;being&nbsp;a&nbsp;major&nbsp;surprise&nbsp;for&nbsp;anyone&nbsp;already&nbsp;relying&nbsp;on&nbsp;global&nbsp;roots&nbsp;for&nbsp;client&nbsp;certs&nbsp;it&nbsp;remains&nbsp;a&nbsp;problem&nbsp;in&nbsp;3.5.&lt;div&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
Amos&lt;br&gt;<br>
&lt;br&gt;<br>
______________________________&lt;wbr&gt;_________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.&lt;wbr&gt;org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/l&lt;wbr&gt;istinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
