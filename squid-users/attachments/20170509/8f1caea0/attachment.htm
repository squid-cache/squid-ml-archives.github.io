<tt>
&lt;html&gt;<br>
&lt;head&gt;<br>
&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=Windows-1252&quot;&gt;<br>
&lt;style&nbsp;type=&quot;text/css&quot;&nbsp;style=&quot;display:none;&quot;&gt;&lt;!--&nbsp;P&nbsp;{margin-top:0;margin-bottom:0;}&nbsp;--&gt;&lt;/style&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;dir=&quot;ltr&quot;&gt;<br>
&lt;div&nbsp;id=&quot;divtagdefaultwrapper&quot;&nbsp;dir=&quot;ltr&quot;&nbsp;style=&quot;font-size:12pt;&nbsp;color:#000000;&nbsp;font-family:Calibri,Arial,Helvetica,sans-serif&quot;&gt;<br>
&lt;p&gt;Hello&nbsp;list,&lt;/p&gt;<br>
&lt;p&gt;&lt;br&gt;<br>
&lt;/p&gt;<br>
&lt;p&gt;I&nbsp;need&nbsp;your&nbsp;help&nbsp;with&nbsp;a&nbsp;Squid-Proxy&nbsp;(3.5)&nbsp;NTLM&nbsp;Auth,&nbsp;the&nbsp;aim&nbsp;is&nbsp;to&nbsp;use&nbsp;SSO&nbsp;for&nbsp;my&nbsp;windows&nbsp;clients.&lt;/p&gt;<br>
&lt;p&gt;My&nbsp;Windows-Clients&nbsp;are&nbsp;using&nbsp;Active-Directory&nbsp;running&nbsp;on&nbsp;a&nbsp;Samba4-PDC.&lt;/p&gt;<br>
&lt;p&gt;I&nbsp;set&nbsp;up&nbsp;ldap&nbsp;basic&nbsp;auth&nbsp;in&nbsp;a&nbsp;developer&nbsp;environment,&nbsp;now&nbsp;I&nbsp;want&nbsp;to&nbsp;achieve&nbsp;SSO.&nbsp;(using&nbsp;NTLM?)&lt;/p&gt;<br>
&lt;p&gt;The&nbsp;Documentation&nbsp;on&nbsp;&lt;a&nbsp;href=&quot;http://wiki.squid-cache.org/ConfigExamples/Authenticate/Ntlm&quot;&nbsp;class=&quot;OWAAutoLink&quot;&nbsp;id=&quot;LPlnk469215&quot;&nbsp;previewremoved=&quot;true&quot;&gt;<br>
http://wiki.squid-cache.org/ConfigExamples/Authenticate/Ntlm&lt;/a&gt;&nbsp;doesn't&nbsp;really&nbsp;help&nbsp;me&nbsp;enough&nbsp;(on&nbsp;my&nbsp;knowledge&nbsp;about&nbsp;squid&nbsp;and&nbsp;forms&nbsp;of&nbsp;authentication/samba).&lt;/p&gt;<br>
&lt;p&gt;&lt;br&gt;<br>
&lt;/p&gt;<br>
&lt;p&gt;Tests:&lt;/p&gt;<br>
&lt;p&gt;-&gt;&nbsp;testing&nbsp;Kerberos&lt;/p&gt;<br>
&lt;p&gt;I'm&nbsp;able&nbsp;to&nbsp;obtain&nbsp;(kinit)&nbsp;tickets&nbsp;and&nbsp;list&nbsp;them&nbsp;(klist)&lt;br&gt;<br>
&lt;/p&gt;<br>
&lt;p&gt;&lt;br&gt;<br>
&lt;/p&gt;<br>
&lt;p&gt;&lt;/p&gt;<br>
&lt;div&gt;root@xxx-testproxy01:~#&nbsp;kinit&nbsp;Administrator&lt;br&gt;<br>
Password&nbsp;for&nbsp;Administrator@X-XXX.LOCAL:&nbsp;&lt;br&gt;<br>
root@xxx-testproxy01:~#&nbsp;klist&lt;br&gt;<br>
Ticket&nbsp;cache:&nbsp;FILE:/tmp/krb5cc_0&lt;br&gt;<br>
Default&nbsp;principal:&nbsp;Administrator@X-XXX.LOCAL&lt;br&gt;<br>
&lt;br&gt;<br>
Valid&nbsp;starting&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Expires&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Service&nbsp;principal&lt;br&gt;<br>
2017-05-09&nbsp;08:43:25&nbsp;&nbsp;2017-05-09&nbsp;18:43:25&nbsp;&nbsp;krbtgt/X-XXX.LOCAL@X-XXX.LOCAL&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;renew&nbsp;until&nbsp;2017-05-10&nbsp;08:43:21&lt;br&gt;<br>
&lt;br&gt;<br>
-&gt;&nbsp;testing&nbsp;Samba:&lt;br&gt;<br>
I&nbsp;joined&nbsp;my&nbsp;domain&nbsp;X-XXX.&lt;br&gt;<br>
Test&nbsp;support&nbsp;for&nbsp;ntlm:&lt;br&gt;<br>
&lt;div&gt;root@xxx-testproxy01:~#&nbsp;wbinfo&nbsp;-a&nbsp;testuser%&lt;span&gt;xxxxxxxxxxx&lt;/span&gt;&lt;br&gt;<br>
plaintext&nbsp;password&nbsp;authentication&nbsp;succeeded&lt;br&gt;<br>
challenge/response&nbsp;password&nbsp;authentication&nbsp;succeeded&lt;/div&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;root@xxx-testproxy01:~#&nbsp;wbinfo&nbsp;-a&nbsp;testuser%xxxxxxxxxxx&lt;br&gt;<br>
plaintext&nbsp;password&nbsp;authentication&nbsp;succeeded&lt;br&gt;<br>
challenge/response&nbsp;password&nbsp;authentication&nbsp;succeeded&lt;br&gt;<br>
root@xxx-testproxy01:~#&nbsp;wbinfo&nbsp;-t&lt;br&gt;<br>
checking&nbsp;the&nbsp;trust&nbsp;secret&nbsp;for&nbsp;domain&nbsp;X-XXX&nbsp;via&nbsp;RPC&nbsp;calls&nbsp;succeeded&lt;br&gt;<br>
root@xxx-testproxy01:~#&nbsp;wbinfo&nbsp;-g&lt;br&gt;<br>
X-XXX\cert&nbsp;publishers&lt;br&gt;<br>
...&lt;br&gt;<br>
X-XXX\webusers&lt;br&gt;<br>
&lt;br&gt;<br>
-&gt;&nbsp;Testing&nbsp;NTLM-helper:&lt;br&gt;<br>
&lt;div&gt;Now&nbsp;here's&nbsp;my&nbsp;problem.&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;br&gt;<br>
&lt;div&gt;root@xxx-testproxy01:~#&nbsp;/usr/bin/ntlm_auth&nbsp;--helper-protocol=squid-2.5-ntlmssp&nbsp;--username=testuser&nbsp;--password=&lt;span&gt;xxxxxxxxxxx&lt;/span&gt;&lt;br&gt;<br>
x-xxx\testuser&lt;span&gt;&nbsp;xxxxxxxxxxx&lt;/span&gt;&lt;br&gt;<br>
SPNEGO&nbsp;request&nbsp;[testuser&nbsp;&lt;span&gt;xxxxxxxxxxx&lt;/span&gt;]&nbsp;invalid&nbsp;prefix&lt;br&gt;<br>
BH&nbsp;SPNEGO&nbsp;request&nbsp;invalid&nbsp;prefix&lt;/div&gt;<br>
&lt;br&gt;<br>
&lt;div&gt;root@xxx-testproxy01:~#&nbsp;/usr/bin/ntlm_auth&nbsp;--helper-protocol=squid-2.5-basic&nbsp;--username=testuser&nbsp;--password=&lt;span&gt;xxxxxxxxxxx&lt;/span&gt;&lt;br&gt;<br>
x-xxx\testuser&nbsp;&lt;span&gt;xxxxxxxxxxx&lt;/span&gt;&lt;br&gt;<br>
OK&lt;/div&gt;<br>
&lt;br&gt;<br>
What&nbsp;is&nbsp;ntlmssp?&nbsp;I&nbsp;read&nbsp;both&nbsp;helpers&nbsp;on&nbsp;tutorials.&nbsp;If&nbsp;I&nbsp;need&nbsp;both,&nbsp;why&nbsp;do&nbsp;I&nbsp;need&nbsp;both?&lt;br&gt;<br>
My&nbsp;squid&nbsp;is&nbsp;starting&nbsp;how&nbsp;it&nbsp;should,&nbsp;logs&nbsp;are&nbsp;looking&nbsp;normal,&nbsp;PopUp&nbsp;for&nbsp;authentication&nbsp;appears&nbsp;aswell,&nbsp;but&nbsp;I&nbsp;can't&nbsp;log&nbsp;in.&nbsp;I&nbsp;shoudn't&nbsp;need&nbsp;to&nbsp;authenticate&nbsp;in&nbsp;the&nbsp;first&nbsp;place&nbsp;because&nbsp;it&nbsp;should&nbsp;use&nbsp;SSO.&lt;br&gt;<br>
What&nbsp;is&nbsp;missing/faulty?&lt;br&gt;<br>
The&nbsp;rest&nbsp;of&nbsp;squid&nbsp;is&nbsp;basic&nbsp;stuff:&lt;br&gt;<br>
&lt;div&gt;auth_param&nbsp;ntlm&nbsp;program&nbsp;/usr/bin/ntlm_auth&nbsp;–helper-protocol=squid-2.5-ntlmssp&nbsp;--username=testuser&nbsp;--password=Passme123&lt;br&gt;<br>
auth_param&nbsp;ntlm&nbsp;children&nbsp;10&lt;br&gt;<br>
auth_param&nbsp;basic&nbsp;program&nbsp;/usr/bin/ntlm_auth&nbsp;–helper-protocol=squid-2.5-basic&nbsp;--username=testuser&nbsp;--password=Passme123&lt;br&gt;<br>
auth_param&nbsp;basic&nbsp;children&nbsp;5&lt;br&gt;<br>
auth_param&nbsp;basic&nbsp;realm&nbsp;Proxy&nbsp;Server&lt;br&gt;<br>
auth_param&nbsp;basic&nbsp;credentialsttl&nbsp;2&nbsp;hours&lt;br&gt;<br>
auth_param&nbsp;basic&nbsp;casesensitive&nbsp;off&lt;br&gt;<br>
authenticate_cache_garbage_interval&nbsp;10&nbsp;seconds&lt;/div&gt;<br>
...&lt;br&gt;<br>
&lt;div&gt;acl&nbsp;auth&nbsp;proxy_auth&nbsp;REQUIRED&lt;br&gt;<br>
&lt;div&gt;acl&nbsp;SSL_ports&nbsp;port&nbsp;443&lt;br&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;80&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;http&lt;br&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;21&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;ftp&lt;br&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;443&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;https&lt;br&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;70&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;gopher&lt;br&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;210&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;wais&lt;br&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;1025-65535&nbsp;&nbsp;#&nbsp;unregistered&nbsp;ports&lt;br&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;280&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;http-mgmt&lt;br&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;488&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;gss-http&lt;br&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;591&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;filemaker&lt;br&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;777&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;multiling&nbsp;http&lt;br&gt;<br>
acl&nbsp;CONNECT&nbsp;method&nbsp;CONNECT&lt;br&gt;<br>
...<br>
&lt;div&gt;http_access&nbsp;deny&nbsp;!Safe_ports&lt;br&gt;<br>
&lt;br&gt;<br>
#&nbsp;Deny&nbsp;CONNECT&nbsp;to&nbsp;other&nbsp;than&nbsp;secure&nbsp;SSL&nbsp;ports&lt;br&gt;<br>
http_access&nbsp;deny&nbsp;CONNECT&nbsp;!SSL_ports&lt;br&gt;<br>
&lt;br&gt;<br>
#&nbsp;Only&nbsp;allow&nbsp;cachemgr&nbsp;access&nbsp;from&nbsp;localhost&lt;br&gt;<br>
http_access&nbsp;allow&nbsp;localnet&lt;br&gt;<br>
&lt;span&gt;http_access&nbsp;allow&nbsp;&lt;/span&gt;localhost&nbsp;manager&lt;br&gt;<br>
http_access&nbsp;deny&nbsp;!auth&lt;br&gt;<br>
http_access&nbsp;allow&nbsp;auth&lt;/div&gt;<br>
&lt;div&gt;http_access&nbsp;deny&nbsp;all&lt;br&gt;<br>
&lt;/div&gt;<br>
...&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;url_rewrite_program&nbsp;/usr/bin/squidGuard&nbsp;-c&nbsp;/etc/squidguard/squidGuard.conf&lt;br&gt;<br>
url_rewrite_children&nbsp;5&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;<br>
Does&nbsp;anyone&nbsp;know&nbsp;further?&nbsp;Thanks&nbsp;in&nbsp;advance.&lt;br&gt;<br>
-&nbsp;Kevin&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;p&gt;&lt;/p&gt;<br>
&lt;/div&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
