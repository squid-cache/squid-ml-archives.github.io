http_port 3127
http_port 3128
http_port 3130 transparent
http_port 8080
https_port 8443 cert=/opt/squid/etc/squid/certs/sslfilter2.crt key=/opt/squid/etc/squid/certs/sslfilter2.key ssl-bump intercept generate-host-certificates=on options=NO_SSLv3,SINGLE_DH_USE
cache_peer 127.0.0.1 parent 8080 0 no-query login=*:nopassword no-netdb-exchange no-digest
acl QUERY urlpath_regex cgi-bin \?
cache deny QUERY
acl apache rep_header Server ^Apache
cache_mem 32 MB
access_log /opt/squid/var/log/squid/access.log squid
cache_log /opt/squid/var/log/squid/cache.log squid
cache_store_log none
mime_table /opt/squid/etc/squid/mime.conf
pid_filename /var/run/squid.pid
debug_options ALL,1
dns_defnames on
auth_param ntlm program /opt/squid/sbin/squid_ntlm_auth.py --helper-protocol=squid-2.5-ntlmssp
auth_param ntlm children 5
auth_param ntlm keep_alive off
auth_param basic program /opt/squid/sbin/squid_ntlm_auth.py --helper-protocol=squid-2.5-basic
auth_param basic children 5
auth_param basic realm Squid
auth_param basic credentialsttl 2 hours
auth_param basic casesensitive off
external_acl_type external_db ttl=30 negative_ttl=150 children-max=5 children-startup=5 %SRC /opt/squid/sbin/external_acl_manager.py
refresh_pattern ^ftp:		1440	20%	10080
refresh_pattern ^gopher:	1440	0%	1440
refresh_pattern .		0	20%	4320
acl SSL_ports port 443 563 81
acl Safe_ports port 80		# http
acl Safe_ports port 81
acl Safe_ports port 21		# ftp
acl Safe_ports port 443 563	# https, snews
acl Safe_ports port 70		# gopher
acl Safe_ports port 210		# wais
acl Safe_ports port 1025-65535	# unregistered ports
acl Safe_ports port 280		# http-mgmt
acl Safe_ports port 488		# gss-http
acl Safe_ports port 591		# filemaker
acl Safe_ports port 777		# multiling http
acl CONNECT method CONNECT
acl POLL method POLL
acl SUBSCRIBE method SUBSCRIBE
acl SEARCH method SEARCH
acl UNLOCK method UNLOCK
acl LOCK method LOCK
acl MOVE method MOVE
acl COPY method COPY
acl DELETE method DELETE
acl MKCOL method MKCOL
acl PROPPATCH method PROPPATCH
acl PROPFIND method PROPFIND
acl HEAD method HEAD
acl ntlm_port myportname 3128
acl authorized_users proxy_auth REQUIRED
acl alwaysdirect dstdomain "/opt/squid/etc/squid/always_direct"
acl external_db_users external external_db
acl windowsupdate dstdomain "/opt/squid/etc/squid/non-auth_destinations"
acl wuCONNECT dstdomain "/opt/squid/etc/squid/non-auth_destinations"
http_access allow manager localhost
http_access deny manager
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow localhost
http_access allow ntlm_port authorized_users
http_access allow external_db_users
http_access allow HEAD
http_access allow PROPFIND
http_access allow PROPPATCH
http_access allow MKCOL
http_access allow DELETE
http_access allow COPY
http_access allow MOVE
http_access allow LOCK
http_access allow UNLOCK
http_access allow SEARCH
http_access allow SUBSCRIBE
http_access allow POLL
http_access allow alwaysdirect
http_access allow CONNECT wuCONNECT
http_access allow windowsupdate
acl NATedHTTPS myport 8443
http_access allow NATedHTTPS
http_access deny all
http_reply_access allow all
icp_access deny all
cache_effective_user squid
cache_effective_group squid
visible_hostname squid-1
always_direct allow all
never_direct allow all
icon_directory /opt/squid/share/squid/icons
error_directory /opt/squid/share/squid/errors/tr
coredump_dir /opt/squid/var/cache/squid
pipeline_prefetch off
icap_enable off
icap_send_client_ip on
icap_send_client_username on
icap_client_username_header X-Client-Username
icap_service service_req_14 reqmod_precache bypass=on icap://127.0.0.1:1344/squid_request_check
adaptation_access service_req_14 allow all
icap_service service_avi_resp respmod_precache icap://127.0.0.1:1344/virus_scan bypass=on routing=on
icap_service service_resp_14 respmod_precache bypass=on icap://127.0.0.1:1344/squid_content_filter
adaptation_service_chain response_chain service_avi_resp service_resp_14
adaptation_access response_chain allow all
adaptation_meta X-Local-Port "%lp"
adaptation_meta X-Current-Time "%ts.%03tu"
adaptation_meta X-Transaction-Start-Time "%tS"
acl step1 at_step SslBump1
acl step2 at_step SslBump2
acl https_bypass_networks dst "/opt/squid/etc/squid/https_filter_exception_networks"
acl https_bypass ssl::server_name "/opt/squid/etc/squid/https_filter_exceptions"
ssl_bump peek step1
ssl_bump splice https_bypass
ssl_bump splice https_bypass_networks
ssl_bump bump all
sslproxy_cert_error allow all
sslcrtd_program /opt/squid/lib/security_file_certgen -s /opt/squid/var/lib/squid/ssl_db -M 4MB
sslcrtd_children 10
tls_outgoing_options cafile=/etc/pki/tls/cert.pem
tls_outgoing_options cipher=EECDH+ECDSA+AESGCM:EECDH+aRSA+AESGCM:EECDH+ECDSA+SHA384:EECDH+ECDSA+SHA256:EECDH+aRSA+SHA384:EECDH+aRSA+SHA256:EECDH+aRSA+RC4:EECDH:EDH+aRSA:HIGH:!RC4:!aNULL:!eNULL:!LOW:!3DES:!MD5:!EXP:!PSK:!SRP:!DSS
tls_outgoing_options options=NO_SSLv3
via off
request_header_access X-Forwarded-For deny all
acl IMAGE urlpath_regex -i .(jpeg|jpg|jpe|jp2|gif|tiff?|pcx|png|bmp|pic|ico)$
cache allow IMAGE
cache deny all
