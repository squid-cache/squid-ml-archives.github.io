<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Thanks&nbsp;for&nbsp;your&nbsp;reply,&nbsp;Amos.&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Mon,&nbsp;Jun&nbsp;12,&nbsp;2017&nbsp;at&nbsp;9:50&nbsp;PM,&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&nbsp;target=&quot;_blank&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;On&nbsp;13/06/17&nbsp;13:48,&nbsp;David&nbsp;Kewley&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
I&nbsp;want&nbsp;my&nbsp;clients&nbsp;to&nbsp;explicitly&nbsp;address&nbsp;squid&nbsp;as&nbsp;a&nbsp;proxy&nbsp;(not&nbsp;use&nbsp;tproxy),&nbsp;but&nbsp;have&nbsp;squid&nbsp;spoof&nbsp;the&nbsp;source&nbsp;addresses&nbsp;in&nbsp;the&nbsp;forwarded&nbsp;connection,&nbsp;so&nbsp;that&nbsp;further&nbsp;hops&nbsp;know&nbsp;the&nbsp;original&nbsp;source&nbsp;address&nbsp;from&nbsp;the&nbsp;IPv4&nbsp;headers.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;could&nbsp;find&nbsp;no&nbsp;indication&nbsp;that&nbsp;anyone&nbsp;else&nbsp;has&nbsp;done&nbsp;this,&nbsp;and&nbsp;when&nbsp;I&nbsp;tried&nbsp;various&nbsp;things,&nbsp;I&nbsp;could&nbsp;not&nbsp;get&nbsp;it&nbsp;working.&lt;br&gt;<br>
&lt;br&gt;<br>
Is&nbsp;this&nbsp;possible&nbsp;today?&nbsp;If&nbsp;not,&nbsp;is&nbsp;it&nbsp;worth&nbsp;considering&nbsp;as&nbsp;a&nbsp;future&nbsp;feature?&nbsp;Or&nbsp;am&nbsp;I&nbsp;overlooking&nbsp;a&nbsp;reason&nbsp;that&nbsp;this&nbsp;cannot&nbsp;work&nbsp;even&nbsp;in&nbsp;theory?&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/span&gt;<br>
It&nbsp;is&nbsp;not&nbsp;possible.&lt;br&gt;<br>
&lt;br&gt;<br>
No,&nbsp;it&nbsp;is&nbsp;a&nbsp;terrible&nbsp;idea.&lt;br&gt;<br>
&lt;br&gt;<br>
It&nbsp;is&nbsp;prohibited&nbsp;by&nbsp;the&nbsp;OS&nbsp;kernel&nbsp;as&nbsp;part&nbsp;of&nbsp;the&nbsp;anti-malware&nbsp;protections,&nbsp;in&nbsp;this&nbsp;case&nbsp;to&nbsp;prevent&nbsp;the&nbsp;local&nbsp;machine&nbsp;being&nbsp;used&nbsp;to&nbsp;attack&nbsp;its&nbsp;surrounding&nbsp;network&nbsp;nodes.&nbsp;And&nbsp;by&nbsp;Squid&nbsp;to&nbsp;make&nbsp;it&nbsp;harder&nbsp;to&nbsp;use&nbsp;Squid&nbsp;as&nbsp;viral&nbsp;payload&nbsp;and&nbsp;damage&nbsp;the&nbsp;brand&nbsp;reputation.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What&nbsp;exactly&nbsp;is&nbsp;the&nbsp;&quot;it&quot;&nbsp;that&nbsp;you&#39;re&nbsp;saying&nbsp;is&nbsp;prohibited&nbsp;by&nbsp;the&nbsp;OS&nbsp;kernel?&nbsp;Source&nbsp;spoofing&nbsp;alone,&nbsp;or&nbsp;something&nbsp;else?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
Also,&nbsp;HTTP&nbsp;contains&nbsp;multiplexing&nbsp;and&nbsp;persistent&nbsp;connections.&nbsp;So&nbsp;there&nbsp;is&nbsp;no&nbsp;particular&nbsp;relation&nbsp;between&nbsp;one&nbsp;incoming/client&nbsp;connection&nbsp;and&nbsp;the&nbsp;outgoing/server&nbsp;connection(s)&nbsp;the&nbsp;traffic&nbsp;from&nbsp;that&nbsp;client&nbsp;goes&nbsp;out&nbsp;on.&nbsp;Added&nbsp;to&nbsp;that,&nbsp;a&nbsp;client&nbsp;request&nbsp;may&nbsp;generate&nbsp;multiple&nbsp;outgoing&nbsp;requests&nbsp;of&nbsp;various&nbsp;types,&nbsp;or&nbsp;Squid&nbsp;may&nbsp;itself&nbsp;generate&nbsp;traffic&nbsp;for&nbsp;its&nbsp;own&nbsp;needs&nbsp;without&nbsp;any&nbsp;client&nbsp;interaction.&lt;br&gt;<br>
&lt;br&gt;<br>
So&nbsp;doing&nbsp;this&nbsp;just&nbsp;degrades&nbsp;the&nbsp;proxy&nbsp;performance.&nbsp;And&nbsp;not&nbsp;in&nbsp;a&nbsp;small&nbsp;way&nbsp;-&nbsp;intercepted&nbsp;traffic&nbsp;pinning&nbsp;everything&nbsp;as&nbsp;this&nbsp;would&nbsp;need&nbsp;comes&nbsp;out&nbsp;about&nbsp;10%&nbsp;nominal&nbsp;(90%&nbsp;reduction),&nbsp;and&nbsp;at&nbsp;the&nbsp;extreme&nbsp;end&nbsp;proxies&nbsp;with&nbsp;NTLM&nbsp;going&nbsp;through&nbsp;to&nbsp;an&nbsp;origin&nbsp;see&nbsp;only&nbsp;1%&nbsp;of&nbsp;nominal&nbsp;performance.&nbsp;Nominal&nbsp;for&nbsp;me&nbsp;being&nbsp;what&nbsp;I&nbsp;clocked&nbsp;a&nbsp;big&nbsp;clients&nbsp;network&nbsp;doing&nbsp;in&nbsp;real-world&nbsp;traffic&nbsp;a&nbsp;few&nbsp;years&nbsp;back:&nbsp;~20000&nbsp;requests&nbsp;per&nbsp;second&nbsp;a&nbsp;few&nbsp;years&nbsp;back&nbsp;(Squid&nbsp;Project&nbsp;got&nbsp;approx&nbsp;2x&nbsp;that&nbsp;in&nbsp;controlled&nbsp;lab&nbsp;tests).&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Good&nbsp;to&nbsp;know&nbsp;there&nbsp;are&nbsp;strong&nbsp;performance&nbsp;implications,&nbsp;thanks.&nbsp;I&nbsp;don&#39;t&nbsp;understand&nbsp;these&nbsp;systems&nbsp;deeply&nbsp;enough&nbsp;to&nbsp;have&nbsp;anticipated&nbsp;this,&nbsp;so&nbsp;I&nbsp;appreciate&nbsp;the&nbsp;heads-up.&nbsp;Too&nbsp;many&nbsp;systems&nbsp;to&nbsp;learn,&nbsp;too&nbsp;quickly...&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
I&nbsp;got&nbsp;the&nbsp;nearly-equivalent&nbsp;functionality&nbsp;working&nbsp;for&nbsp;reverse&nbsp;proxying&nbsp;using&nbsp;nginx,&nbsp;but&nbsp;so&nbsp;far&nbsp;I&#39;ve&nbsp;found&nbsp;no&nbsp;way&nbsp;to&nbsp;do&nbsp;it&nbsp;with&nbsp;forward&nbsp;proxying.&nbsp;Nginx&nbsp;doesn&#39;t&nbsp;do&nbsp;https&nbsp;forward&nbsp;proxying&nbsp;(no&nbsp;handling&nbsp;of&nbsp;CONNECT).&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/span&gt;<br>
So&nbsp;Nginx&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;attack&nbsp;networks&nbsp;from&nbsp;inside.&nbsp;Good&nbsp;no&nbsp;know&nbsp;we&nbsp;now&nbsp;have&nbsp;to&nbsp;watch&nbsp;out&nbsp;for&nbsp;that&nbsp;in&nbsp;viral&nbsp;payloads&nbsp;too.&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&quot;Can&nbsp;be&nbsp;used&nbsp;to&nbsp;attack&quot;&nbsp;because&nbsp;of&nbsp;source&nbsp;spoofing,&nbsp;or&nbsp;something&nbsp;else?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
If&nbsp;squid&nbsp;can&#39;t&nbsp;do&nbsp;what&nbsp;I&#39;m&nbsp;looking&nbsp;for&nbsp;today,&nbsp;I&nbsp;would&nbsp;welcome&nbsp;pointers&nbsp;to&nbsp;other&nbsp;possible&nbsp;approaches.&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/span&gt;<br>
Squid&nbsp;supports&nbsp;X-Forwarded-For&nbsp;fully&nbsp;-&nbsp;it&nbsp;was&nbsp;invented&nbsp;by&nbsp;Squid&nbsp;devs&nbsp;back&nbsp;in&nbsp;the&nbsp;day,&nbsp;and&nbsp;Squid&nbsp;is&nbsp;still&nbsp;the&nbsp;authoritative&nbsp;implementation&nbsp;for&nbsp;how&nbsp;it&nbsp;is&nbsp;supposed&nbsp;to&nbsp;work.&nbsp;As&nbsp;an&nbsp;old&nbsp;feature&nbsp;just&nbsp;about&nbsp;all&nbsp;other&nbsp;HTTP&nbsp;server&nbsp;and&nbsp;intermediary&nbsp;software&nbsp;have&nbsp;support&nbsp;for&nbsp;that&nbsp;too&nbsp;so&nbsp;you&nbsp;should&nbsp;have&nbsp;no&nbsp;issue&nbsp;pulling&nbsp;the&nbsp;data&nbsp;out&nbsp;at&nbsp;the&nbsp;receiving&nbsp;end,&nbsp;or&nbsp;in&nbsp;HTTP&nbsp;processing&nbsp;DPI&nbsp;software&nbsp;/&nbsp;firewalls&nbsp;etc.&nbsp;It&nbsp;is&nbsp;sent&nbsp;on&nbsp;all&nbsp;outgoing&nbsp;Squid&nbsp;messages&nbsp;unless&nbsp;you&nbsp;explicitly&nbsp;configure&nbsp;something&nbsp;else&nbsp;to&nbsp;happen&nbsp;with&nbsp;the&nbsp;forwarded_for&nbsp;directive.&lt;br&gt;<br>
Â &lt;&lt;a&nbsp;href=&quot;http://www.squid-cache.org/Doc/config/forwarded_for/&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.squid-cache.org/D&lt;wbr&gt;oc/config/forwarded_for/&lt;/a&gt;&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&#39;ll&nbsp;ask&nbsp;the&nbsp;team&nbsp;managing&nbsp;the&nbsp;next-hop&nbsp;device&nbsp;to&nbsp;evaluate&nbsp;that&nbsp;possibility;&nbsp;it&nbsp;looks&nbsp;to&nbsp;me&nbsp;from&nbsp;the&nbsp;docs&nbsp;like&nbsp;it&nbsp;might&nbsp;work.&nbsp;Thanks&nbsp;for&nbsp;the&nbsp;suggestion.&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;David&lt;/div&gt;&lt;/div&gt;<br>

</tt>
