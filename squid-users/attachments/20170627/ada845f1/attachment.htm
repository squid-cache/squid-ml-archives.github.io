<tt>
&lt;div&nbsp;dir=&quot;auto&quot;&gt;You&nbsp;need&nbsp;an&nbsp;ICAP&nbsp;server&nbsp;intelligent&nbsp;enough&nbsp;to&nbsp;differentiate&nbsp;between&nbsp;the&nbsp;file&nbsp;types. &nbsp;Squid&nbsp;is&nbsp;a&nbsp;proxy&nbsp;and&nbsp;can&nbsp;only&nbsp;deal&nbsp;with&nbsp;the&nbsp;protocol. &nbsp;An&nbsp;ICAP&nbsp;server&nbsp;can&nbsp;deal&nbsp;with&nbsp;the&nbsp;content. &nbsp;C-icap&nbsp;and&nbsp;ecap&nbsp;are&nbsp;a&nbsp;couple&nbsp;options&nbsp;that&nbsp;seem&nbsp;to&nbsp;be&nbsp;available. &nbsp;I&nbsp;havr&nbsp;no&nbsp;experience&nbsp;with&nbsp;either.&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Jun&nbsp;27,&nbsp;2017&nbsp;7:53&nbsp;AM,&nbsp;&quot;Daniel&nbsp;Rieken&quot;&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:danielrieken89@gmail.com&quot;&gt;danielrieken89@gmail.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&nbsp;type=&quot;attribution&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;Hello,&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;would&nbsp;like&nbsp;to&nbsp;block&nbsp;my&nbsp;users&nbsp;from&nbsp;downloading&nbsp;doc-&nbsp;and&nbsp;docm-files,&lt;br&gt;<br>
but&nbsp;not&nbsp;docx.&lt;br&gt;<br>
&lt;br&gt;<br>
So&nbsp;this&nbsp;works&nbsp;fine&nbsp;for&nbsp;me:&lt;br&gt;<br>
/etc/squid3/blockExtensions.&lt;wbr&gt;acl:&lt;br&gt;<br>
\.doc(\?.*)?$&lt;br&gt;<br>
\.docm(\?.*)?$&lt;br&gt;<br>
&lt;br&gt;<br>
acl&nbsp;blockExtensions&nbsp;urlpath_regex&nbsp;-i&nbsp;&quot;/etc/squid3/blockExtensions.&lt;wbr&gt;acl&quot;&lt;br&gt;<br>
http_access&nbsp;deny&nbsp;blockExtensions&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
But&nbsp;in&nbsp;some&nbsp;cases&nbsp;the&nbsp;URL&nbsp;doesn&#39;t&nbsp;contain&nbsp;the&nbsp;extension&nbsp;(e.g.&nbsp;doc).&lt;br&gt;<br>
For&nbsp;URLs&nbsp;like&nbsp;this&nbsp;the&nbsp;above&nbsp;ACL&nbsp;doesn&#39;t&nbsp;work:&lt;br&gt;<br>
-&nbsp;&lt;a&nbsp;href=&quot;http://www.example.org/download.pl?file=wordfile&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.example.org/&lt;wbr&gt;download.pl?file=wordfile&lt;/a&gt;&lt;br&gt;<br>
-&nbsp;&lt;a&nbsp;href=&quot;http://www.example.org/invoice-5479657415/&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.example.org/&lt;wbr&gt;invoice-5479657415/&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
Here&nbsp;I&nbsp;need&nbsp;to&nbsp;work&nbsp;with&nbsp;mime-types:&lt;br&gt;<br>
acl&nbsp;blockMime&nbsp;rep_mime_type&nbsp;application/msword&lt;br&gt;<br>
acl&nbsp;blockMime&nbsp;rep_mime_type&nbsp;application/vnd.ms-word.&lt;wbr&gt;document.macroEnabled.12&lt;br&gt;<br>
http_reply_access&nbsp;deny&nbsp;blockMime&lt;br&gt;<br>
&lt;br&gt;<br>
This&nbsp;works&nbsp;fine,&nbsp;too.&nbsp;But&nbsp;I&nbsp;see&nbsp;a&nbsp;problem:&nbsp;The&nbsp;mime-type&nbsp;is&nbsp;defined&nbsp;on&lt;br&gt;<br>
the&nbsp;webserver.&nbsp;So&nbsp;the&nbsp;badguy&nbsp;could&nbsp;configure&nbsp;his&nbsp;webserver&nbsp;to&nbsp;serve&nbsp;a&lt;br&gt;<br>
doc-file&nbsp;as&nbsp;application/i.am.not.a.docfile&nbsp;and&nbsp;the&nbsp;above&nbsp;ACL&nbsp;isn&#39;t&lt;br&gt;<br>
working&nbsp;anymore.&lt;br&gt;<br>
Is&nbsp;there&nbsp;any&nbsp;way&nbsp;to&nbsp;make&nbsp;squid&nbsp;block&nbsp;doc-&nbsp;and&nbsp;docm&nbsp;files&nbsp;based&nbsp;on&nbsp;the&lt;br&gt;<br>
response-headers&nbsp;file-type?&lt;br&gt;<br>
Or&nbsp;in&nbsp;other&nbsp;words:&nbsp;Is&nbsp;squid&nbsp;able&nbsp;to&nbsp;match&nbsp;the&nbsp;&quot;doc&quot;&nbsp;in&nbsp;the&lt;br&gt;<br>
Content-Disposition&nbsp;header&nbsp;of&nbsp;the&nbsp;response?&lt;br&gt;<br>
&lt;br&gt;<br>
HTTP/1.0&nbsp;200&nbsp;OK&lt;br&gt;<br>
Date:&nbsp;Tue,&nbsp;27&nbsp;Jun&nbsp;2017&nbsp;11:40:57&nbsp;GMT&lt;br&gt;<br>
Server:&nbsp;Apache&nbsp;Phusion_Passenger/4.0.10&nbsp;mod_bwlimited/1.4&lt;br&gt;<br>
Cache-Control:&nbsp;no-cache,&nbsp;no-store,&nbsp;max-age=0,&nbsp;must-revalidate&lt;br&gt;<br>
Pragma:&nbsp;no-cache&lt;br&gt;<br>
Content-Type:&nbsp;application/baddoc&lt;br&gt;<br>
Content-Disposition:&nbsp;attachment;&lt;br&gt;<br>
filename=&quot;gescanntes-Dokument-&lt;wbr&gt;VPPAW-072-JCD3032.doc&quot;&lt;br&gt;<br>
Content-Transfer-Encoding:&nbsp;binary&lt;br&gt;<br>
X-Powered-By:&nbsp;PHP/5.3.29&lt;br&gt;<br>
Connection:&nbsp;close&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Regards,&nbsp;Daniel&lt;br&gt;<br>
______________________________&lt;wbr&gt;_________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.&lt;wbr&gt;org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/&lt;wbr&gt;listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
