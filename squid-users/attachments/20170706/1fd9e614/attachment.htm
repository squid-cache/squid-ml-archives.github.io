<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi.&nbsp;Sorry&nbsp;that&nbsp;I&#39;m&nbsp;answering&nbsp;to&nbsp;the&nbsp;old&nbsp;thread.&nbsp;I&nbsp;was&nbsp;on&nbsp;vacation&nbsp;and&nbsp;didn&#39;t&nbsp;have&nbsp;a&nbsp;chance&nbsp;to&nbsp;test&nbsp;the&nbsp;proposed&nbsp;solution.&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Dieter,&nbsp;yes,&nbsp;I&#39;m&nbsp;on&nbsp;the&nbsp;old&nbsp;CentOS&nbsp;6&nbsp;based&nbsp;OS&nbsp;(Amazon&nbsp;Linux)&nbsp;but&nbsp;with&nbsp;a&nbsp;new&nbsp;kernel 4.9.27.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Amos,&nbsp;thank&nbsp;you&nbsp;for&nbsp;the&nbsp;suggestions&nbsp;about&nbsp;configure&nbsp;flags&nbsp;and&nbsp;squid&nbsp;config&nbsp;options,&nbsp;I&nbsp;fixed&nbsp;all&nbsp;issues&nbsp;you&nbsp;pointed&nbsp;to.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Unfortunately&nbsp;following&nbsp;workarounds&nbsp;didn&#39;t&nbsp;help:&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;client_idle_pconn_timeout&nbsp;30&nbsp;seconds&lt;br&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;half_closed_clients&nbsp;on&lt;/div&gt;&lt;div&gt;*&nbsp;client_persistent_connections&nbsp;off&lt;/div&gt;&lt;div&gt;*&nbsp;server_persistent_connections&nbsp;off&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;However&nbsp;I&nbsp;assumed&nbsp;that&nbsp;this&nbsp;is&nbsp;a&nbsp;bug&nbsp;and&nbsp;that&nbsp;I&nbsp;can&nbsp;find&nbsp;older&nbsp;version&nbsp;which&nbsp;worked&nbsp;fine.&nbsp;I&nbsp;started&nbsp;testing&nbsp;from&nbsp;3.1.x&nbsp;all&nbsp;the&nbsp;way&nbsp;to&nbsp;3.5.26&nbsp;and&nbsp;this&nbsp;is&nbsp;what&nbsp;I&nbsp;found:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;All&nbsp;versions&nbsp;until&nbsp;3.5.21&nbsp;work&nbsp;fine.&nbsp;There&nbsp;no&nbsp;issues&nbsp;with&nbsp;huge&nbsp;amount&nbsp;of&nbsp;TIME_WAIT&nbsp;connections&nbsp;under&nbsp;load.&lt;/div&gt;&lt;div&gt;*&nbsp;3.5.20&nbsp;is&nbsp;the&nbsp;latest&nbsp;stable&nbsp;version.&lt;/div&gt;&lt;div&gt;*&nbsp;3.5.21&nbsp;is&nbsp;the&nbsp;first&nbsp;broken&nbsp;version.&lt;/div&gt;&lt;div&gt;*&nbsp;3.5.23,&nbsp;3.5.25,&nbsp;3.5.26&nbsp;are&nbsp;broken&nbsp;as&nbsp;well.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;effectively&nbsp;means&nbsp;that&nbsp;bug&nbsp;is&nbsp;somewhere&nbsp;in&nbsp;between&nbsp;3.5.20&nbsp;and&nbsp;3.5.21.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;hope&nbsp;this&nbsp;helps&nbsp;and&nbsp;I&nbsp;hope&nbsp;you&#39;ll&nbsp;be&nbsp;able&nbsp;to&nbsp;find&nbsp;an&nbsp;issue.&nbsp;If&nbsp;you&nbsp;can&nbsp;create&nbsp;a&nbsp;bug&nbsp;report&nbsp;based&nbsp;on&nbsp;this&nbsp;information&nbsp;and&nbsp;post&nbsp;it&nbsp;here&nbsp;it&nbsp;would&nbsp;be&nbsp;awesome.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thank&nbsp;you.&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Wed,&nbsp;Jun&nbsp;7,&nbsp;2017&nbsp;at&nbsp;4:34&nbsp;AM,&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&nbsp;target=&quot;_blank&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;On&nbsp;07/06/17&nbsp;12:13,&nbsp;Ivan&nbsp;Larionov&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
Hi!&lt;br&gt;<br>
&lt;br&gt;<br>
We&nbsp;recently&nbsp;updated&nbsp;from&nbsp;squid&nbsp;v2&nbsp;to&nbsp;v3&nbsp;and&nbsp;now&nbsp;see&nbsp;huge&nbsp;increase&nbsp;in&nbsp;connections&nbsp;in&nbsp;TIME_WAIT&nbsp;state&nbsp;on&nbsp;our&nbsp;squid&nbsp;servers&nbsp;(verified&nbsp;that&nbsp;this&nbsp;is&nbsp;clients&nbsp;connections).&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/span&gt;<br>
The&nbsp;biggest&nbsp;change&nbsp;between&nbsp;2.7&nbsp;and&nbsp;3.5&nbsp;in&nbsp;this&nbsp;area&nbsp;is&nbsp;that&nbsp;2.7&nbsp;was&nbsp;HTTP/1.0&nbsp;which&nbsp;closed&nbsp;TCP&nbsp;connections&nbsp;after&nbsp;each&nbsp;request&nbsp;by&nbsp;default,&nbsp;and&nbsp;3.5&nbsp;is&nbsp;HTTP/1.1&nbsp;which&nbsp;does&nbsp;not.&nbsp;So&nbsp;connections&nbsp;are&nbsp;more&nbsp;likely&nbsp;to&nbsp;persist&nbsp;until&nbsp;they&nbsp;hit&nbsp;some&nbsp;TCP&nbsp;timeout&nbsp;then&nbsp;enter&nbsp;the&nbsp;slow&nbsp;TIME_WAIT&nbsp;process.&lt;br&gt;<br>
&lt;br&gt;<br>
There&nbsp;were&nbsp;also&nbsp;some&nbsp;other&nbsp;bugs&nbsp;identified&nbsp;in&nbsp;older&nbsp;3.5&nbsp;releases&nbsp;which&nbsp;increased&nbsp;the&nbsp;TIME_WAIT&nbsp;specifically.&nbsp;I&nbsp;thought&nbsp;those&nbsp;were&nbsp;almost&nbsp;all&nbsp;fixed&nbsp;by&nbsp;now,&nbsp;but&nbsp;YMMV&nbsp;whether&nbsp;you&nbsp;hit&nbsp;the&nbsp;remaining&nbsp;issues.&lt;br&gt;<br>
 A&nbsp;workaround&nbsp;it&nbsp;to&nbsp;set&nbsp;&lt;&lt;a&nbsp;href=&quot;http://www.squid-cache.org/Doc/config/client_idle_pconn_timeout/&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.squid-cache.org/Do&lt;wbr&gt;c/config/client_idle_pconn_tim&lt;wbr&gt;eout/&lt;/a&gt;&gt;&nbsp;to&nbsp;a&nbsp;shorter&nbsp;value&nbsp;than&nbsp;the&nbsp;default &nbsp;2min.&nbsp;eg&nbsp;you&nbsp;might&nbsp;want&nbsp;it&nbsp;to&nbsp;be&nbsp;30sec&nbsp;or&nbsp;so.&lt;span&nbsp;class=&quot;&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
See&nbsp;versions&nbsp;and&nbsp;amount&nbsp;of&nbsp;such&nbsp;connections&nbsp;under&nbsp;the&nbsp;same&nbsp;load&nbsp;with&nbsp;the&nbsp;same&nbsp;configs&nbsp;(except&nbsp;some&nbsp;incompatible&nbsp;stuff):&lt;br&gt;<br>
&lt;br&gt;<br>
squid&nbsp;2.7.STABLE9&lt;br&gt;<br>
&lt;br&gt;<br>
configure&nbsp;options: &nbsp;&#39;--program-prefix=&#39;&nbsp;&#39;--prefix=/usr&#39;&nbsp;&#39;--exec-prefix=/usr&#39;&nbsp;&#39;--bindir=/usr/bin&#39;&nbsp;&#39;--sbindir=/usr/sbin&#39;&nbsp;&#39;--sysconfdir=/etc&#39;&nbsp;&#39;--includedir=/usr/include&#39;&nbsp;&#39;--libdir=/usr/lib&#39;&nbsp;&#39;--libexecdir=/usr/libexec&#39;&nbsp;&#39;--sharedstatedir=/usr/com&#39;&nbsp;&#39;--mandir=/usr/share/man&#39;&nbsp;&#39;--infodir=/usr/share/info&#39;&nbsp;&#39;--exec_prefix=/usr&#39;&nbsp;&#39;--bindir=/usr/sbin&#39;&nbsp;&#39;--libexecdir=/usr/lib/squid&#39;&nbsp;&#39;--localstatedir=/var&#39;&nbsp;&#39;--datadir=/usr/share&#39;&nbsp;&#39;--sysconfdir=/etc/squid&#39;&nbsp;&#39;--enable-epoll&#39;&nbsp;&#39;--enable-removal-policies=hea&lt;wbr&gt;p,lru&#39;&nbsp;&#39;--enable-storeio=aufs&#39;&nbsp;&#39;--enable-delay-pools&#39;&nbsp;&#39;--with-pthreads&#39;&nbsp;&#39;--enable-cache-digests&#39;&nbsp;&#39;--enable-useragent-log&#39;&nbsp;&#39;--enable-referer-log&#39;&nbsp;&#39;--with-large-files&#39;&nbsp;&#39;--with-maxfd=16384&#39;&nbsp;&#39;--enable-err-languages=Englis&lt;wbr&gt;h&#39;&lt;br&gt;<br>
&lt;br&gt;<br>
#&nbsp;netstat&nbsp;-tn&nbsp;|&nbsp;grep&nbsp;TIME_WAIT&nbsp;|&nbsp;grep&nbsp;3128&nbsp;|&nbsp;wc&nbsp;-l&lt;br&gt;<br>
95&lt;br&gt;<br>
&lt;br&gt;<br>
squid&nbsp;3.5.25&lt;br&gt;<br>
&lt;br&gt;<br>
configure&nbsp;options: &nbsp;&#39;--program-prefix=&#39;&nbsp;&#39;--prefix=/usr&#39;&nbsp;&#39;--exec-prefix=/usr&#39;&nbsp;&#39;--bindir=/usr/sbin&#39;&nbsp;&#39;--sbindir=/usr/sbin&#39;&nbsp;&#39;--sysconfdir=/etc/squid&#39;&nbsp;&#39;--libdir=/usr/lib&#39;&nbsp;&#39;--libexecdir=/usr/lib/squid&#39;&nbsp;&#39;--includedir=/usr/include&#39;&nbsp;&#39;--datadir=/usr/share&#39;&nbsp;&#39;--sharedstatedir=/usr/com&#39;&nbsp;&#39;--localstatedir=/var&#39;&nbsp;&#39;--mandir=/usr/share/man&#39;&nbsp;&#39;--infodir=/usr/share/info&#39;&nbsp;&#39;--enable-epoll&#39;&nbsp;&#39;--enable-removal-policies=hea&lt;wbr&gt;p,lru&#39;&nbsp;&#39;--enable-storeio=aufs&#39;&nbsp;&#39;--enable-delay-pools&#39;&nbsp;&#39;--with-pthreads&#39;&nbsp;&#39;--enable-cache-digests&#39;&nbsp;&#39;--enable-useragent-log&#39;&nbsp;&#39;--enable-referer-log&#39;&nbsp;&#39;--with-large-files&#39;&nbsp;&#39;--with-maxfd=16384&#39;&nbsp;&#39;--enable-err-languages=Englis&lt;wbr&gt;h&#39;&nbsp;&#39;--enable-htcp&#39;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/span&gt;<br>
FYI,&nbsp;these&nbsp;options&nbsp;are&nbsp;not&nbsp;doing&nbsp;anything&nbsp;for&nbsp;Squid-3:&lt;br&gt;<br>
 &nbsp;&#39;--enable-useragent-log&#39;&nbsp;&#39;--enable-referer-log&#39;&nbsp;&#39;--enable-err-languages=Englis&lt;wbr&gt;h&#39;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&gt;<br>
#&nbsp;netstat&nbsp;-tn&nbsp;|&nbsp;grep&nbsp;TIME_WAIT&nbsp;|&nbsp;grep&nbsp;3128&nbsp;|&nbsp;wc&nbsp;-l&lt;br&gt;&lt;/span&gt;<br>
11277&lt;br&gt;<br>
&lt;br&gt;<br>
Config:&lt;br&gt;<br>
&lt;br&gt;<br>
http_port&nbsp;&lt;a&nbsp;href=&quot;http://0.0.0.0:3128&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;0.0.0.0:3128&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://0.0.0.0:3128&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://0.0.0.0:3128&lt;/a&gt;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
acl&nbsp;localnet&nbsp;src&nbsp;&lt;a&nbsp;href=&quot;http://10.0.0.0/8&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;10.0.0.0/8&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://10.0.0.0/8&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://10.0.0.0/8&lt;/a&gt;&gt; &nbsp; &nbsp; #&nbsp;RFC1918&nbsp;possible&nbsp;internal&nbsp;network&lt;br&gt;<br>
acl&nbsp;localnet&nbsp;src&nbsp;&lt;a&nbsp;href=&quot;http://172.16.0.0/12&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;172.16.0.0/12&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://172.16.0.0/12&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://172.16.0.0/12&lt;/a&gt;&gt; &nbsp;#&nbsp;RFC1918&nbsp;possible&nbsp;internal&nbsp;network&lt;br&gt;<br>
acl&nbsp;localnet&nbsp;src&nbsp;&lt;a&nbsp;href=&quot;http://192.168.0.0/16&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;192.168.0.0/16&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://192.168.0.0/16&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://192.168.0.0/16&lt;/a&gt;&gt;&nbsp;#&nbsp;RFC1918&nbsp;possible&nbsp;internal&nbsp;network&lt;div&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;br&gt;<br>
acl&nbsp;localnet&nbsp;src&nbsp;fc00::/7 &nbsp; &nbsp; &nbsp; #&nbsp;RFC&nbsp;4193&nbsp;local&nbsp;private&nbsp;network&nbsp;range&lt;br&gt;<br>
acl&nbsp;localnet&nbsp;src&nbsp;fe80::/10 &nbsp; &nbsp; &nbsp;#&nbsp;RFC&nbsp;4291&nbsp;link-local&nbsp;(directly&nbsp;plugged)&nbsp;machines&lt;br&gt;<br>
&lt;br&gt;<br>
acl&nbsp;SSL_ports&nbsp;port&nbsp;443&lt;br&gt;<br>
&lt;br&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;80 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;http&lt;br&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;21 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;ftp&lt;br&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;443 &nbsp; &nbsp; &nbsp; &nbsp; #&nbsp;https&lt;br&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;70 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;gopher&lt;br&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;210 &nbsp; &nbsp; &nbsp; &nbsp; #&nbsp;wais&lt;br&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;280 &nbsp; &nbsp; &nbsp; &nbsp; #&nbsp;http-mgmt&lt;br&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;488 &nbsp; &nbsp; &nbsp; &nbsp; #&nbsp;gss-http&lt;br&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;591 &nbsp; &nbsp; &nbsp; &nbsp; #&nbsp;filemaker&lt;br&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;777 &nbsp; &nbsp; &nbsp; &nbsp; #&nbsp;multiling&nbsp;http&lt;br&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;1025-65535 &nbsp;#&nbsp;unregistered&nbsp;ports&lt;br&gt;<br>
&lt;br&gt;<br>
acl&nbsp;CONNECT&nbsp;method&nbsp;CONNECT&lt;br&gt;<br>
&lt;br&gt;<br>
###&nbsp;START&nbsp;CUSTOM&lt;br&gt;<br>
acl&nbsp;Purge_method&nbsp;method&nbsp;PURGE&lt;br&gt;<br>
&lt;br&gt;<br>
#&nbsp;Allow&nbsp;localhost&nbsp;to&nbsp;selectively&nbsp;flush&nbsp;the&nbsp;cache&lt;br&gt;<br>
http_access&nbsp;allow&nbsp;localhost&nbsp;Purge_method&lt;br&gt;<br>
http_access&nbsp;deny&nbsp;Purge_method&lt;br&gt;<br>
###&nbsp;END&nbsp;CUSTOM&lt;br&gt;<br>
&lt;br&gt;<br>
###&nbsp;ALLOW&nbsp;ACCESS&nbsp;TO&nbsp;ALL&nbsp;PORTS&lt;br&gt;<br>
#&nbsp;http_access&nbsp;deny&nbsp;!Safe_ports&lt;br&gt;<br>
http_access&nbsp;deny&nbsp;CONNECT&nbsp;!SSL_ports&lt;br&gt;<br>
http_access&nbsp;allow&nbsp;localhost&nbsp;manager&lt;br&gt;<br>
http_access&nbsp;deny&nbsp;manager&lt;br&gt;<br>
&lt;br&gt;<br>
http_access&nbsp;allow&nbsp;localnet&lt;br&gt;<br>
http_access&nbsp;allow&nbsp;localhost&lt;br&gt;<br>
http_access&nbsp;deny&nbsp;all&lt;br&gt;<br>
&lt;br&gt;<br>
###&nbsp;START&nbsp;CUSTOM&lt;br&gt;<br>
#&nbsp;Disable&nbsp;icp&lt;br&gt;<br>
icp_port&nbsp;0&lt;br&gt;<br>
#&nbsp;Allow&nbsp;ICP&nbsp;queries&nbsp;from&nbsp;local&nbsp;networks&nbsp;only&lt;br&gt;<br>
icp_access&nbsp;allow&nbsp;localnet&lt;br&gt;<br>
icp_access&nbsp;allow&nbsp;localhost&lt;br&gt;<br>
icp_access&nbsp;deny&nbsp;all&lt;br&gt;<br>
&lt;br&gt;<br>
#&nbsp;Disable&nbsp;htcp&lt;br&gt;<br>
htcp_port&nbsp;0&lt;br&gt;<br>
#&nbsp;Allow&nbsp;HTCP&nbsp;queries&nbsp;from&nbsp;local&nbsp;networks&nbsp;only&lt;br&gt;<br>
htcp_access&nbsp;allow&nbsp;localnet&lt;br&gt;<br>
htcp_access&nbsp;allow&nbsp;localhost&lt;br&gt;<br>
htcp_access&nbsp;deny&nbsp;all&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
FYI:&nbsp;setting&nbsp;icp_access&nbsp;and&nbsp;htcp_access&nbsp;is&nbsp;pointless&nbsp;when&nbsp;the&nbsp;relevant&nbsp;port&nbsp;is&nbsp;0.&nbsp;That&nbsp;port&nbsp;0&nbsp;disables&nbsp;the&nbsp;entire&nbsp;component.&lt;span&nbsp;class=&quot;&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
#&nbsp;Check&nbsp;for&nbsp;custom&nbsp;request&nbsp;header&lt;br&gt;<br>
acl&nbsp;custom_acl&nbsp;req_header&nbsp;x-use-custom-proxy&nbsp;-i&nbsp;true&lt;br&gt;<br>
#&nbsp;Check&nbsp;for&nbsp;x-use-new-proxy&nbsp;request&nbsp;header&lt;br&gt;<br>
acl&nbsp;custom_new_acl&nbsp;req_header&nbsp;x-use-new-proxy&nbsp;-i&nbsp;true&lt;br&gt;<br>
&lt;br&gt;<br>
#&nbsp;first_proxy&lt;br&gt;<br>
cache_peer&nbsp;127.0.0.1&nbsp;parent&nbsp;18070&nbsp;0&nbsp;no-query&nbsp;no-digest&nbsp;name=first_proxy&lt;br&gt;<br>
cache_peer_access&nbsp;first_proxy&nbsp;deny&nbsp;custom_acl&lt;br&gt;<br>
cache_peer_access&nbsp;first_proxy&nbsp;deny&nbsp;custom_new_acl&lt;br&gt;<br>
&lt;br&gt;<br>
#&nbsp;second_proxy&lt;br&gt;<br>
cache_peer&nbsp;127.0.0.1&nbsp;parent&nbsp;18079&nbsp;0&nbsp;no-query&nbsp;no-digest&nbsp;name=second_proxy&lt;br&gt;<br>
cache_peer_access&nbsp;second_proxy&nbsp;allow&nbsp;custom_acl&lt;br&gt;<br>
cache_peer_access&nbsp;second_proxy&nbsp;allow&nbsp;custom_new_acl&lt;br&gt;<br>
cache_peer_access&nbsp;second_proxy&nbsp;deny&nbsp;all&lt;br&gt;<br>
&lt;br&gt;<br>
never_direct&nbsp;allow&nbsp;all&lt;br&gt;<br>
&lt;br&gt;<br>
cache_mem&nbsp;4620591&nbsp;KB&lt;br&gt;<br>
maximum_object_size_in_memory&nbsp;8&nbsp;KB&lt;br&gt;<br>
memory_replacement_policy&nbsp;heap&nbsp;LRU&lt;br&gt;<br>
cache_replacement_policy&nbsp;heap&nbsp;LRU&lt;br&gt;<br>
&lt;br&gt;<br>
cache_dir&nbsp;aufs&nbsp;/mnt/services/squid/cache&nbsp;891289&nbsp;16&nbsp;256&lt;br&gt;<br>
&lt;br&gt;<br>
minimum_object_size&nbsp;64&nbsp;bytes&nbsp;#&nbsp;none-zero&nbsp;so&nbsp;we&nbsp;dont&nbsp;cache&nbsp;mistakes&lt;br&gt;<br>
maximum_object_size&nbsp;102400&nbsp;KB&lt;br&gt;<br>
&lt;br&gt;<br>
logformat&nbsp;combined&nbsp;%&gt;a&nbsp;%ui&nbsp;%un&nbsp;[%tl]&nbsp;&quot;%rm&nbsp;%ru&nbsp;HTTP/%rv&quot;&nbsp;%&gt;Hs&nbsp;%&lt;st&nbsp;%tr&nbsp;&quot;%{Referer}&gt;h&quot;&nbsp;&quot;%{User-Agent}&gt;h&quot;&nbsp;%Ss:%Sh&lt;br&gt;<br>
logformat&nbsp;squid&nbsp;%ts.%03tu&nbsp;%6tr&nbsp;%&gt;a&nbsp;%Ss/%03&gt;Hs&nbsp;%&lt;st&nbsp;%rm&nbsp;%ru&nbsp;%un&nbsp;%Sh/%&lt;A&nbsp;%mt&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/span&gt;<br>
Please&nbsp;do&nbsp;not&nbsp;re-define&nbsp;these&nbsp;formats.&nbsp;If&nbsp;you&nbsp;want&nbsp;to&nbsp;use&nbsp;the&nbsp;default&nbsp;format&nbsp;they&nbsp;are&nbsp;defined&nbsp;internally&nbsp;by&nbsp;Squid3,&nbsp;if&nbsp;you&nbsp;want&nbsp;any&nbsp;customizations&nbsp;use&nbsp;a&nbsp;different&nbsp;format&nbsp;name.&lt;span&nbsp;class=&quot;&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
access_log&nbsp;stdio:/var/log/squid/access.lo&lt;wbr&gt;g&nbsp;combined&lt;br&gt;<br>
cache_log&nbsp;/var/log/squid/cache.log&lt;br&gt;<br>
cache_store_log&nbsp;none&lt;br&gt;<br>
logfile_rotate&nbsp;0&lt;br&gt;<br>
&lt;br&gt;<br>
client_db&nbsp;off&lt;br&gt;<br>
&lt;br&gt;<br>
pid_filename&nbsp;/var/run/squid.pid&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
coredump_dir&nbsp;/var/cache&lt;br&gt;<br>
###&nbsp;END&nbsp;CUSTOM&lt;br&gt;<br>
&lt;br&gt;<br>
refresh_pattern&nbsp;^ftp: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1440 &nbsp; &nbsp;20% &nbsp; &nbsp; 10080&lt;br&gt;<br>
refresh_pattern&nbsp;^gopher: &nbsp; &nbsp; &nbsp; &nbsp;1440 &nbsp; &nbsp;0% &nbsp; &nbsp; &nbsp;1440&lt;br&gt;<br>
#&nbsp;refresh_pattern&nbsp;-i&nbsp;(/cgi-bin/|\?)&nbsp;0 &nbsp; &nbsp; 0% &nbsp; &nbsp; &nbsp;0&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/span&gt;<br>
Please&nbsp;do&nbsp;not&nbsp;remove&nbsp;that&nbsp;cgi-bin&nbsp;pattern.&nbsp;It&nbsp;is&nbsp;there&nbsp;to&nbsp;protect&nbsp;the&nbsp;cache&nbsp;against&nbsp;servers&nbsp;with&nbsp;broken/ancient&nbsp;CGI&nbsp;engines.&nbsp;It&nbsp;is&nbsp;designed&nbsp;explicitly&nbsp;so&nbsp;modern&nbsp;dynamic&nbsp;sites&nbsp;that&nbsp;provide&nbsp;proper&nbsp;cacheability&nbsp;headers&nbsp;can&nbsp;still&nbsp;be&nbsp;stored.&nbsp;So&nbsp;no&nbsp;harm&nbsp;and&nbsp;only&nbsp;benefits&nbsp;from&nbsp;in&nbsp;leaving&nbsp;it&nbsp;there.&lt;span&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Amos&lt;/font&gt;&lt;/span&gt;&lt;div&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
______________________________&lt;wbr&gt;_________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.&lt;wbr&gt;org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/l&lt;wbr&gt;istinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;--&nbsp;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_signature&quot;&nbsp;data-smartmail=&quot;gmail_signature&quot;&gt;With&nbsp;best&nbsp;regards,&nbsp;Ivan&nbsp;Larionov.&lt;/div&gt;<br>
&lt;/div&gt;<br>

</tt>
