<tt>
&lt;html&gt;<br>
&nbsp;&nbsp;&lt;head&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&nbsp;http-equiv=&quot;Content-Type&quot;&gt;<br>
&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&lt;body&nbsp;bgcolor=&quot;#FFFFFF&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;class=&quot;moz-cite-prefix&quot;&gt;On&nbsp;2017-07-27&nbsp;18:15,&nbsp;Max&nbsp;Ashton&nbsp;wrote:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote<br>
cite=&quot;mid:HE1PR0501MB2780A304D31AA0BDAE26CBF3D1BE0@HE1PR0501MB2780.eurprd05.prod.outlook.com&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;Hi&nbsp;guys,<br>
<br>
I&nbsp;have&nbsp;just&nbsp;configured&nbsp;our&nbsp;squid&nbsp;proxy&nbsp;to&nbsp;use&nbsp;ntlm&nbsp;authentication.<br>
<br>
I&nbsp;am&nbsp;failing&nbsp;to&nbsp;find&nbsp;correct&nbsp;file&nbsp;permission&nbsp;for&nbsp;the&nbsp;/var/lib/samba/winbindd_privileged&nbsp;folder.&nbsp;Squid&nbsp;failed&nbsp;to&nbsp;authenticate&nbsp;using&nbsp;winbind&nbsp;when&nbsp;the&nbsp;following&nbsp;file&nbsp;permissions&nbsp;are&nbsp;set&nbsp;750,&nbsp;I&nbsp;get&nbsp;the&nbsp;following&nbsp;error&nbsp;in&nbsp;the&nbsp;log.<br>
<br>
NTLM&nbsp;Authentication&nbsp;validating&nbsp;user.&nbsp;Result:&nbsp;{result=BH,&nbsp;notes={message:&nbsp;NT_STATUS_UNSUCCESSFUL&nbsp;NT_STATUS_UNSUCCESSFUL;<br>
<br>
If&nbsp;I&nbsp;then&nbsp;change&nbsp;the&nbsp;permissions&nbsp;on&nbsp;winbindd_privileged&nbsp;to&nbsp;757&nbsp;everything&nbsp;works&nbsp;fine.&nbsp;However,&nbsp;this&nbsp;is&nbsp;not&nbsp;good&nbsp;practice&nbsp;and&nbsp;if&nbsp;the&nbsp;server&nbsp;restarts&nbsp;then&nbsp;winbind&nbsp;fails&nbsp;to&nbsp;start&nbsp;throwing&nbsp;the&nbsp;error&nbsp;&quot;incorrect&nbsp;permissions&nbsp;set,&nbsp;757&nbsp;should&nbsp;be&nbsp;750&quot;.&nbsp;Changing&nbsp;the&nbsp;permissions&nbsp;back&nbsp;allows&nbsp;winbind&nbsp;to&nbsp;start&nbsp;but&nbsp;squid&nbsp;then&nbsp;stops&nbsp;authenticating.<br>
<br>
My&nbsp;first&nbsp;though&nbsp;is&nbsp;that&nbsp;the&nbsp;squid&nbsp;user&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;correct&nbsp;group,&nbsp;so&nbsp;I&nbsp;add&nbsp;the&nbsp;proxy&nbsp;user&nbsp;into&nbsp;the&nbsp;winbindd_priv&nbsp;group&nbsp;using<br>
<br>
sudo&nbsp;usermod&nbsp;-a&nbsp;-G&nbsp;winbindd_priv&nbsp;proxy<br>
<br>
Check&nbsp;this&nbsp;with&nbsp;members&nbsp;winbindd_priv,&nbsp;indeed&nbsp;proxy&nbsp;is&nbsp;a&nbsp;member.<br>
<br>
I&nbsp;then&nbsp;check&nbsp;that&nbsp;winbindd_priv&nbsp;is&nbsp;the&nbsp;assigned&nbsp;group&nbsp;for&nbsp;the&nbsp;folder,&nbsp;first&nbsp;I<br>
<br>
Sudo&nbsp;chown&nbsp;root:winbindd_priv&nbsp;/var/lib/samba/winbindd_privileged/<br>
<br>
to&nbsp;assigns&nbsp;it.<br>
<br>
Then<br>
<br>
Sudo&nbsp;ls&nbsp;-l&nbsp;root:winbindd_priv&nbsp;/var/lib/samba<br>
<br>
drwxr-x---&nbsp;&nbsp;2&nbsp;root&nbsp;winbindd_priv&nbsp;&nbsp;&nbsp;&nbsp;4096&nbsp;Jul&nbsp;27&nbsp;15:27&nbsp;winbindd_privileged<br>
<br>
It&nbsp;appears&nbsp;my&nbsp;proxy&nbsp;is&nbsp;not&nbsp;running&nbsp;as&nbsp;the&nbsp;&quot;proxy&quot;&nbsp;user&nbsp;(&nbsp;I&nbsp;compiled&nbsp;squid&nbsp;with&nbsp;&nbsp;--with-default-user=proxy&nbsp;\)<br>
<br>
As&nbsp;a&nbsp;note&nbsp;I&nbsp;have&nbsp;tried&nbsp;adding&nbsp;every&nbsp;user&nbsp;to&nbsp;winbindd_priv,&nbsp;same&nbsp;issue&nbsp;occurs.<br>
<br>
Any&nbsp;ideas&nbsp;or&nbsp;suggestions&nbsp;on&nbsp;how&nbsp;I&nbsp;can&nbsp;get&nbsp;ntlm&nbsp;working&nbsp;without&nbsp;the&nbsp;777&nbsp;file&nbsp;permission&nbsp;would&nbsp;be&nbsp;great<br>
<br>
Kind&nbsp;Regards<br>
Max&nbsp;Ashton<br>
JJO&nbsp;plc&nbsp;IT<br>
<br>
<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;fieldset&nbsp;class=&quot;mimeAttachmentHeader&quot;&gt;&lt;/fieldset&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;_______________________________________________<br>
squid-users&nbsp;mailing&nbsp;list<br>
&lt;a&nbsp;class=&quot;moz-txt-link-abbreviated&quot;&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;<br>
&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;So&nbsp;what&nbsp;user&nbsp;are&nbsp;your&nbsp;squid&nbsp;running&nbsp;as?&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;There&nbsp;is&nbsp;a&nbsp;config&nbsp;directive&nbsp;&quot;cache_effective_user&quot;&nbsp;-<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://www.squid-cache.org/Doc/config/cache_effective_user/&quot;&gt;http://www.squid-cache.org/Doc/config/cache_effective_user/&lt;/a&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;On&nbsp;centOS,&nbsp;squid&nbsp;is&nbsp;running&nbsp;as&nbsp;'squid'&nbsp;by&nbsp;default;&nbsp;adding&nbsp;squid&nbsp;to<br>
&nbsp;&nbsp;&nbsp;&nbsp;group&nbsp;'wbpriv'&nbsp;-&nbsp;default&nbsp;centOS-winbind&nbsp;group&nbsp;-&nbsp;allows&nbsp;to&nbsp;run<br>
&nbsp;&nbsp;&nbsp;&nbsp;NTLM/negotiate&nbsp;authenticator&nbsp;without&nbsp;issue.&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;What&nbsp;OS?&nbsp;Is&nbsp;selinux&nbsp;enabled&nbsp;and&nbsp;enforcing&nbsp;policy&nbsp;applied?&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;class=&quot;moz-signature&quot;&nbsp;cols=&quot;72&quot;&gt;--&nbsp;<br>
Greets,&nbsp;Dijx&lt;/pre&gt;<br>
&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
