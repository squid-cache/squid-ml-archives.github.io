<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;We&nbsp;have&nbsp;cluster&nbsp;of&nbsp;squids&nbsp;in&nbsp;reverse&nbsp;proxy&nbsp;mode.&nbsp;Each&nbsp;one&nbsp;of&nbsp;those&nbsp;is&nbsp;sibling&nbsp;to&nbsp;others&nbsp;and&nbsp;they&nbsp;all&nbsp;have&nbsp;same&nbsp;originservers&nbsp;as&nbsp;parents.&nbsp;Siblings&nbsp;are&nbsp;configured&nbsp;with&nbsp;no-proxy&nbsp;keyword&nbsp;to&nbsp;achieve&nbsp;that&nbsp;they&nbsp;don&#39;t&nbsp;cache&nbsp;what&nbsp;other&nbsp;siblings&nbsp;already&nbsp;have&nbsp;in&nbsp;their&nbsp;cache.&nbsp;This&nbsp;is&nbsp;to&nbsp;minimize&nbsp;data&nbsp;usage&nbsp;costs&nbsp;from&nbsp;origin&nbsp;servers.&nbsp;What&nbsp;is&nbsp;in&nbsp;our&nbsp;cluster&nbsp;should&nbsp;never&nbsp;be&nbsp;fetched&nbsp;again&nbsp;from&nbsp;origin&nbsp;because&nbsp;it&nbsp;never&nbsp;changes.&nbsp;It&#39;s&nbsp;not&nbsp;typical&nbsp;web&nbsp;cache,&nbsp;it&#39;s&nbsp;CDN&nbsp;system&nbsp;for&nbsp;content&nbsp;that&nbsp;we&nbsp;create&nbsp;and&nbsp;control&nbsp;and&nbsp;squid&nbsp;is&nbsp;just&nbsp;one&nbsp;of&nbsp;the&nbsp;internal&nbsp;parts&nbsp;and&nbsp;not&nbsp;exposed&nbsp;directly&nbsp;to&nbsp;the&nbsp;clients.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So&nbsp;far&nbsp;digest_generation&nbsp;has&nbsp;been&nbsp;set&nbsp;to&nbsp;off&nbsp;and&nbsp;only&nbsp;ICP&nbsp;has&nbsp;been&nbsp;used&nbsp;between&nbsp;siblings.&nbsp;Mostly&nbsp;because&nbsp;digest&nbsp;stats&nbsp;had&nbsp;shown&nbsp;many&nbsp;rejects&nbsp;(not&nbsp;containing&nbsp;100%&nbsp;of&nbsp;cache&nbsp;objects)&nbsp;and&nbsp;documentation&nbsp;about&nbsp;digests&nbsp;is&nbsp;confusing&nbsp;up&nbsp;to&nbsp;statements&nbsp;that&nbsp;while&nbsp;rebuilding&nbsp;digest,&nbsp;squid&nbsp;will&nbsp;stop&nbsp;serving&nbsp;requests.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Since&nbsp;we&nbsp;need&nbsp;to&nbsp;have&nbsp;more&nbsp;siblings&nbsp;and&nbsp;more&nbsp;far&nbsp;away&nbsp;from&nbsp;each&nbsp;other,&nbsp;ICP&nbsp;overhead&nbsp;becomes&nbsp;an&nbsp;issue&nbsp;(time&nbsp;spent&nbsp;on&nbsp;query).&nbsp;Having&nbsp;proper&nbsp;digest&nbsp;with&nbsp;all&nbsp;of&nbsp;the&nbsp;objects&nbsp;in&nbsp;cache_dir&nbsp;included&nbsp;in&nbsp;digest&nbsp;could&nbsp;be&nbsp;better&nbsp;solution&nbsp;due&nbsp;to&nbsp;not&nbsp;having&nbsp;delay&nbsp;of&nbsp;initial&nbsp;ICP&nbsp;request.&nbsp;Digest&nbsp;documentation&nbsp;states&nbsp;that&nbsp;it&#39;s&nbsp;including&nbsp;based&nbsp;on&nbsp;refresh_pattern.&nbsp;It&#39;s&nbsp;a&nbsp;problem&nbsp;because&nbsp;to&nbsp;get&nbsp;squid&nbsp;working&nbsp;as&nbsp;we&nbsp;want,&nbsp;we&nbsp;had&nbsp;to&nbsp;use&nbsp;offline_mode&nbsp;on.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Questions:&lt;/div&gt;&lt;div&gt;*&nbsp;What&nbsp;is&nbsp;the&nbsp;relationship&nbsp;between&nbsp;cache&nbsp;digests&nbsp;and&nbsp;ICP?&nbsp;If&nbsp;they&nbsp;are&nbsp;active&nbsp;together,&nbsp;how&nbsp;are&nbsp;they&nbsp;used&nbsp;together?&lt;/div&gt;&lt;div&gt;*&nbsp;How&nbsp;are&nbsp;objects&nbsp;added&nbsp;to&nbsp;digest&nbsp;when&nbsp;rebuilding?&nbsp;Does&nbsp;this&nbsp;include&nbsp;lot&nbsp;of&nbsp;disk&nbsp;i/o&nbsp;like&nbsp;scanning&nbsp;all&nbsp;cache_dir&nbsp;files&nbsp;or&nbsp;is&nbsp;it&nbsp;based&nbsp;on&nbsp;swap.state&nbsp;contents?&lt;/div&gt;&lt;div&gt;*&nbsp;How&nbsp;can&nbsp;i&nbsp;see&nbsp;which&nbsp;objects&nbsp;are&nbsp;listed&nbsp;in&nbsp;cache&nbsp;digest?&lt;/div&gt;&lt;div&gt;*&nbsp;Why&nbsp;does&nbsp;sibling&nbsp;false&nbsp;positive&nbsp;result&nbsp;in&nbsp;sending&nbsp;client&nbsp;504&nbsp;and&nbsp;not&nbsp;trying&nbsp;next&nbsp;sibling&nbsp;or&nbsp;parent? CD_SIBLING_HIT/&lt;a&nbsp;href=&quot;http://192.168.1.52&quot;&gt;192.168.1.52&lt;/a&gt;  TCP_MISS/504.&nbsp;How&nbsp;to&nbsp;achieve&nbsp;proceeding&nbsp;with&nbsp;next&nbsp;cache_peer?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Best&nbsp;regards,&lt;/div&gt;&lt;div&gt;Veiko&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
